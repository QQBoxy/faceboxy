(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const S of c.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&a(S)}).observe(document,{childList:!0,subtree:!0});function s(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerpolicy&&(c.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?c.credentials="include":r.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(r){if(r.ep)return;r.ep=!0;const c=s(r);fetch(r.href,c)}})();function tH(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var sT={exports:{}},uT={},kl={exports:{}},ya={};var fC=Symbol.for("react.element"),Yoe=Symbol.for("react.portal"),Joe=Symbol.for("react.fragment"),Qoe=Symbol.for("react.strict_mode"),Zoe=Symbol.for("react.profiler"),eae=Symbol.for("react.provider"),tae=Symbol.for("react.context"),nae=Symbol.for("react.forward_ref"),rae=Symbol.for("react.suspense"),iae=Symbol.for("react.memo"),oae=Symbol.for("react.lazy"),fU=Symbol.iterator;function aae(h){return h===null||typeof h!="object"?null:(h=fU&&h[fU]||h["@@iterator"],typeof h=="function"?h:null)}var nH={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},rH=Object.assign,iH={};function g_(h,i,s){this.props=h,this.context=i,this.refs=iH,this.updater=s||nH}g_.prototype.isReactComponent={};g_.prototype.setState=function(h,i){if(typeof h!="object"&&typeof h!="function"&&h!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,h,i,"setState")};g_.prototype.forceUpdate=function(h){this.updater.enqueueForceUpdate(this,h,"forceUpdate")};function oH(){}oH.prototype=g_.prototype;function WR(h,i,s){this.props=h,this.context=i,this.refs=iH,this.updater=s||nH}var VR=WR.prototype=new oH;VR.constructor=WR;rH(VR,g_.prototype);VR.isPureReactComponent=!0;var dU=Array.isArray,aH=Object.prototype.hasOwnProperty,HR={current:null},sH={key:!0,ref:!0,__self:!0,__source:!0};function uH(h,i,s){var a,r={},c=null,S=null;if(i!=null)for(a in i.ref!==void 0&&(S=i.ref),i.key!==void 0&&(c=""+i.key),i)aH.call(i,a)&&!sH.hasOwnProperty(a)&&(r[a]=i[a]);var E=arguments.length-2;if(E===1)r.children=s;else if(1<E){for(var A=Array(E),U=0;U<E;U++)A[U]=arguments[U+2];r.children=A}if(h&&h.defaultProps)for(a in E=h.defaultProps,E)r[a]===void 0&&(r[a]=E[a]);return{$$typeof:fC,type:h,key:c,ref:S,props:r,_owner:HR.current}}function sae(h,i){return{$$typeof:fC,type:h.type,key:i,ref:h.ref,props:h.props,_owner:h._owner}}function GR(h){return typeof h=="object"&&h!==null&&h.$$typeof===fC}function uae(h){var i={"=":"=0",":":"=2"};return"$"+h.replace(/[=:]/g,function(s){return i[s]})}var hU=/\/+/g;function _I(h,i){return typeof h=="object"&&h!==null&&h.key!=null?uae(""+h.key):i.toString(36)}function bO(h,i,s,a,r){var c=typeof h;(c==="undefined"||c==="boolean")&&(h=null);var S=!1;if(h===null)S=!0;else switch(c){case"string":case"number":S=!0;break;case"object":switch(h.$$typeof){case fC:case Yoe:S=!0}}if(S)return S=h,r=r(S),h=a===""?"."+_I(S,0):a,dU(r)?(s="",h!=null&&(s=h.replace(hU,"$&/")+"/"),bO(r,i,s,"",function(U){return U})):r!=null&&(GR(r)&&(r=sae(r,s+(!r.key||S&&S.key===r.key?"":(""+r.key).replace(hU,"$&/")+"/")+h)),i.push(r)),1;if(S=0,a=a===""?".":a+":",dU(h))for(var E=0;E<h.length;E++){c=h[E];var A=a+_I(c,E);S+=bO(c,i,s,A,r)}else if(A=aae(h),typeof A=="function")for(h=A.call(h),E=0;!(c=h.next()).done;)c=c.value,A=a+_I(c,E++),S+=bO(c,i,s,A,r);else if(c==="object")throw i=String(h),Error("Objects are not valid as a React child (found: "+(i==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.");return S}function NA(h,i,s){if(h==null)return h;var a=[],r=0;return bO(h,a,"","",function(c){return i.call(s,c,r++)}),a}function cae(h){if(h._status===-1){var i=h._result;i=i(),i.then(function(s){(h._status===0||h._status===-1)&&(h._status=1,h._result=s)},function(s){(h._status===0||h._status===-1)&&(h._status=2,h._result=s)}),h._status===-1&&(h._status=0,h._result=i)}if(h._status===1)return h._result.default;throw h._result}var Eh={current:null},xO={transition:null},lae={ReactCurrentDispatcher:Eh,ReactCurrentBatchConfig:xO,ReactCurrentOwner:HR};ya.Children={map:NA,forEach:function(h,i,s){NA(h,function(){i.apply(this,arguments)},s)},count:function(h){var i=0;return NA(h,function(){i++}),i},toArray:function(h){return NA(h,function(i){return i})||[]},only:function(h){if(!GR(h))throw Error("React.Children.only expected to receive a single React element child.");return h}};ya.Component=g_;ya.Fragment=Joe;ya.Profiler=Zoe;ya.PureComponent=WR;ya.StrictMode=Qoe;ya.Suspense=rae;ya.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=lae;ya.cloneElement=function(h,i,s){if(h==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+h+".");var a=rH({},h.props),r=h.key,c=h.ref,S=h._owner;if(i!=null){if(i.ref!==void 0&&(c=i.ref,S=HR.current),i.key!==void 0&&(r=""+i.key),h.type&&h.type.defaultProps)var E=h.type.defaultProps;for(A in i)aH.call(i,A)&&!sH.hasOwnProperty(A)&&(a[A]=i[A]===void 0&&E!==void 0?E[A]:i[A])}var A=arguments.length-2;if(A===1)a.children=s;else if(1<A){E=Array(A);for(var U=0;U<A;U++)E[U]=arguments[U+2];a.children=E}return{$$typeof:fC,type:h.type,key:r,ref:c,props:a,_owner:S}};ya.createContext=function(h){return h={$$typeof:tae,_currentValue:h,_currentValue2:h,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},h.Provider={$$typeof:eae,_context:h},h.Consumer=h};ya.createElement=uH;ya.createFactory=function(h){var i=uH.bind(null,h);return i.type=h,i};ya.createRef=function(){return{current:null}};ya.forwardRef=function(h){return{$$typeof:nae,render:h}};ya.isValidElement=GR;ya.lazy=function(h){return{$$typeof:oae,_payload:{_status:-1,_result:h},_init:cae}};ya.memo=function(h,i){return{$$typeof:iae,type:h,compare:i===void 0?null:i}};ya.startTransition=function(h){var i=xO.transition;xO.transition={};try{h()}finally{xO.transition=i}};ya.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};ya.useCallback=function(h,i){return Eh.current.useCallback(h,i)};ya.useContext=function(h){return Eh.current.useContext(h)};ya.useDebugValue=function(){};ya.useDeferredValue=function(h){return Eh.current.useDeferredValue(h)};ya.useEffect=function(h,i){return Eh.current.useEffect(h,i)};ya.useId=function(){return Eh.current.useId()};ya.useImperativeHandle=function(h,i,s){return Eh.current.useImperativeHandle(h,i,s)};ya.useInsertionEffect=function(h,i){return Eh.current.useInsertionEffect(h,i)};ya.useLayoutEffect=function(h,i){return Eh.current.useLayoutEffect(h,i)};ya.useMemo=function(h,i){return Eh.current.useMemo(h,i)};ya.useReducer=function(h,i,s){return Eh.current.useReducer(h,i,s)};ya.useRef=function(h){return Eh.current.useRef(h)};ya.useState=function(h){return Eh.current.useState(h)};ya.useSyncExternalStore=function(h,i,s){return Eh.current.useSyncExternalStore(h,i,s)};ya.useTransition=function(){return Eh.current.useTransition()};ya.version="18.2.0";(function(h){h.exports=ya})(kl);const cH=tH(kl.exports);var fae=kl.exports,dae=Symbol.for("react.element"),hae=Symbol.for("react.fragment"),pae=Object.prototype.hasOwnProperty,mae=fae.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,gae={key:!0,ref:!0,__self:!0,__source:!0};function lH(h,i,s){var a,r={},c=null,S=null;s!==void 0&&(c=""+s),i.key!==void 0&&(c=""+i.key),i.ref!==void 0&&(S=i.ref);for(a in i)pae.call(i,a)&&!gae.hasOwnProperty(a)&&(r[a]=i[a]);if(h&&h.defaultProps)for(a in i=h.defaultProps,i)r[a]===void 0&&(r[a]=i[a]);return{$$typeof:dae,type:h,key:c,ref:S,props:r,_owner:mae.current}}uT.Fragment=hae;uT.jsx=lH;uT.jsxs=lH;(function(h){h.exports=uT})(sT);const qR=sT.exports.Fragment,Rp=sT.exports.jsx,vae=sT.exports.jsxs;var RF={},fH={exports:{}},Ym={},dH={exports:{}},hH={};(function(h){function i(ze,Ut){var Ft=ze.length;ze.push(Ut);e:for(;0<Ft;){var pt=Ft-1>>>1,vt=ze[pt];if(0<r(vt,Ut))ze[pt]=Ut,ze[Ft]=vt,Ft=pt;else break e}}function s(ze){return ze.length===0?null:ze[0]}function a(ze){if(ze.length===0)return null;var Ut=ze[0],Ft=ze.pop();if(Ft!==Ut){ze[0]=Ft;e:for(var pt=0,vt=ze.length,rn=vt>>>1;pt<rn;){var xt=2*(pt+1)-1,_t=ze[xt],Xt=xt+1,sn=ze[Xt];if(0>r(_t,Ft))Xt<vt&&0>r(sn,_t)?(ze[pt]=sn,ze[Xt]=Ft,pt=Xt):(ze[pt]=_t,ze[xt]=Ft,pt=xt);else if(Xt<vt&&0>r(sn,Ft))ze[pt]=sn,ze[Xt]=Ft,pt=Xt;else break e}}return Ut}function r(ze,Ut){var Ft=ze.sortIndex-Ut.sortIndex;return Ft!==0?Ft:ze.id-Ut.id}if(typeof performance=="object"&&typeof performance.now=="function"){var c=performance;h.unstable_now=function(){return c.now()}}else{var S=Date,E=S.now();h.unstable_now=function(){return S.now()-E}}var A=[],U=[],B=1,D=null,R=3,W=!1,j=!1,H=!1,I=typeof setTimeout=="function"?setTimeout:null,Q=typeof clearTimeout=="function"?clearTimeout:null,Y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function q(ze){for(var Ut=s(U);Ut!==null;){if(Ut.callback===null)a(U);else if(Ut.startTime<=ze)a(U),Ut.sortIndex=Ut.expirationTime,i(A,Ut);else break;Ut=s(U)}}function ae(ze){if(H=!1,q(ze),!j)if(s(A)!==null)j=!0,Bt(oe);else{var Ut=s(U);Ut!==null&&Ot(ae,Ut.startTime-ze)}}function oe(ze,Ut){j=!1,H&&(H=!1,Q(pe),pe=-1),W=!0;var Ft=R;try{for(q(Ut),D=s(A);D!==null&&(!(D.expirationTime>Ut)||ze&&!lt());){var pt=D.callback;if(typeof pt=="function"){D.callback=null,R=D.priorityLevel;var vt=pt(D.expirationTime<=Ut);Ut=h.unstable_now(),typeof vt=="function"?D.callback=vt:D===s(A)&&a(A),q(Ut)}else a(A);D=s(A)}if(D!==null)var rn=!0;else{var xt=s(U);xt!==null&&Ot(ae,xt.startTime-Ut),rn=!1}return rn}finally{D=null,R=Ft,W=!1}}var ye=!1,_e=null,pe=-1,me=5,Ge=-1;function lt(){return!(h.unstable_now()-Ge<me)}function It(){if(_e!==null){var ze=h.unstable_now();Ge=ze;var Ut=!0;try{Ut=_e(!0,ze)}finally{Ut?wt():(ye=!1,_e=null)}}else ye=!1}var wt;if(typeof Y=="function")wt=function(){Y(It)};else if(typeof MessageChannel<"u"){var we=new MessageChannel,yt=we.port2;we.port1.onmessage=It,wt=function(){yt.postMessage(null)}}else wt=function(){I(It,0)};function Bt(ze){_e=ze,ye||(ye=!0,wt())}function Ot(ze,Ut){pe=I(function(){ze(h.unstable_now())},Ut)}h.unstable_IdlePriority=5,h.unstable_ImmediatePriority=1,h.unstable_LowPriority=4,h.unstable_NormalPriority=3,h.unstable_Profiling=null,h.unstable_UserBlockingPriority=2,h.unstable_cancelCallback=function(ze){ze.callback=null},h.unstable_continueExecution=function(){j||W||(j=!0,Bt(oe))},h.unstable_forceFrameRate=function(ze){0>ze||125<ze?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):me=0<ze?Math.floor(1e3/ze):5},h.unstable_getCurrentPriorityLevel=function(){return R},h.unstable_getFirstCallbackNode=function(){return s(A)},h.unstable_next=function(ze){switch(R){case 1:case 2:case 3:var Ut=3;break;default:Ut=R}var Ft=R;R=Ut;try{return ze()}finally{R=Ft}},h.unstable_pauseExecution=function(){},h.unstable_requestPaint=function(){},h.unstable_runWithPriority=function(ze,Ut){switch(ze){case 1:case 2:case 3:case 4:case 5:break;default:ze=3}var Ft=R;R=ze;try{return Ut()}finally{R=Ft}},h.unstable_scheduleCallback=function(ze,Ut,Ft){var pt=h.unstable_now();switch(typeof Ft=="object"&&Ft!==null?(Ft=Ft.delay,Ft=typeof Ft=="number"&&0<Ft?pt+Ft:pt):Ft=pt,ze){case 1:var vt=-1;break;case 2:vt=250;break;case 5:vt=1073741823;break;case 4:vt=1e4;break;default:vt=5e3}return vt=Ft+vt,ze={id:B++,callback:Ut,priorityLevel:ze,startTime:Ft,expirationTime:vt,sortIndex:-1},Ft>pt?(ze.sortIndex=Ft,i(U,ze),s(A)===null&&ze===s(U)&&(H?(Q(pe),pe=-1):H=!0,Ot(ae,Ft-pt))):(ze.sortIndex=vt,i(A,ze),j||W||(j=!0,Bt(oe))),ze},h.unstable_shouldYield=lt,h.unstable_wrapCallback=function(ze){var Ut=R;return function(){var Ft=R;R=Ut;try{return ze.apply(this,arguments)}finally{R=Ft}}}})(hH);(function(h){h.exports=hH})(dH);var pH=kl.exports,Km=dH.exports;function li(h){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+h,s=1;s<arguments.length;s++)i+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+h+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var mH=new Set,HS={};function _w(h,i){o_(h,i),o_(h+"Capture",i)}function o_(h,i){for(HS[h]=i,h=0;h<i.length;h++)mH.add(i[h])}var F1=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),PF=Object.prototype.hasOwnProperty,yae=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,pU={},mU={};function bae(h){return PF.call(mU,h)?!0:PF.call(pU,h)?!1:yae.test(h)?mU[h]=!0:(pU[h]=!0,!1)}function xae(h,i,s,a){if(s!==null&&s.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return a?!1:s!==null?!s.acceptsBooleans:(h=h.toLowerCase().slice(0,5),h!=="data-"&&h!=="aria-");default:return!1}}function wae(h,i,s,a){if(i===null||typeof i>"u"||xae(h,i,s,a))return!0;if(a)return!1;if(s!==null)switch(s.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function Sh(h,i,s,a,r,c,S){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=a,this.attributeNamespace=r,this.mustUseProperty=s,this.propertyName=h,this.type=i,this.sanitizeURL=c,this.removeEmptyString=S}var df={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(h){df[h]=new Sh(h,0,!1,h,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(h){var i=h[0];df[i]=new Sh(i,1,!1,h[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(h){df[h]=new Sh(h,2,!1,h.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(h){df[h]=new Sh(h,2,!1,h,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(h){df[h]=new Sh(h,3,!1,h.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(h){df[h]=new Sh(h,3,!0,h,null,!1,!1)});["capture","download"].forEach(function(h){df[h]=new Sh(h,4,!1,h,null,!1,!1)});["cols","rows","size","span"].forEach(function(h){df[h]=new Sh(h,6,!1,h,null,!1,!1)});["rowSpan","start"].forEach(function(h){df[h]=new Sh(h,5,!1,h.toLowerCase(),null,!1,!1)});var $R=/[\-:]([a-z])/g;function XR(h){return h[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(h){var i=h.replace($R,XR);df[i]=new Sh(i,1,!1,h,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(h){var i=h.replace($R,XR);df[i]=new Sh(i,1,!1,h,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(h){var i=h.replace($R,XR);df[i]=new Sh(i,1,!1,h,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(h){df[h]=new Sh(h,1,!1,h.toLowerCase(),null,!1,!1)});df.xlinkHref=new Sh("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(h){df[h]=new Sh(h,1,!1,h.toLowerCase(),null,!0,!0)});function KR(h,i,s,a){var r=df.hasOwnProperty(i)?df[i]:null;(r!==null?r.type!==0:a||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(wae(i,s,r,a)&&(s=null),a||r===null?bae(i)&&(s===null?h.removeAttribute(i):h.setAttribute(i,""+s)):r.mustUseProperty?h[r.propertyName]=s===null?r.type===3?!1:"":s:(i=r.attributeName,a=r.attributeNamespace,s===null?h.removeAttribute(i):(r=r.type,s=r===3||r===4&&s===!0?"":""+s,a?h.setAttributeNS(a,i,s):h.setAttribute(i,s))))}var B1=pH.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,IA=Symbol.for("react.element"),L2=Symbol.for("react.portal"),B2=Symbol.for("react.fragment"),YR=Symbol.for("react.strict_mode"),LF=Symbol.for("react.profiler"),gH=Symbol.for("react.provider"),vH=Symbol.for("react.context"),JR=Symbol.for("react.forward_ref"),BF=Symbol.for("react.suspense"),jF=Symbol.for("react.suspense_list"),QR=Symbol.for("react.memo"),Rb=Symbol.for("react.lazy"),yH=Symbol.for("react.offscreen"),gU=Symbol.iterator;function sS(h){return h===null||typeof h!="object"?null:(h=gU&&h[gU]||h["@@iterator"],typeof h=="function"?h:null)}var Nu=Object.assign,EI;function kS(h){if(EI===void 0)try{throw Error()}catch(s){var i=s.stack.trim().match(/\n( *(at )?)/);EI=i&&i[1]||""}return`
`+EI+h}var SI=!1;function CI(h,i){if(!h||SI)return"";SI=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(U){var a=U}Reflect.construct(h,[],i)}else{try{i.call()}catch(U){a=U}h.call(i.prototype)}else{try{throw Error()}catch(U){a=U}h()}}catch(U){if(U&&a&&typeof U.stack=="string"){for(var r=U.stack.split(`
`),c=a.stack.split(`
`),S=r.length-1,E=c.length-1;1<=S&&0<=E&&r[S]!==c[E];)E--;for(;1<=S&&0<=E;S--,E--)if(r[S]!==c[E]){if(S!==1||E!==1)do if(S--,E--,0>E||r[S]!==c[E]){var A=`
`+r[S].replace(" at new "," at ");return h.displayName&&A.includes("<anonymous>")&&(A=A.replace("<anonymous>",h.displayName)),A}while(1<=S&&0<=E);break}}}finally{SI=!1,Error.prepareStackTrace=s}return(h=h?h.displayName||h.name:"")?kS(h):""}function _ae(h){switch(h.tag){case 5:return kS(h.type);case 16:return kS("Lazy");case 13:return kS("Suspense");case 19:return kS("SuspenseList");case 0:case 2:case 15:return h=CI(h.type,!1),h;case 11:return h=CI(h.type.render,!1),h;case 1:return h=CI(h.type,!0),h;default:return""}}function zF(h){if(h==null)return null;if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case B2:return"Fragment";case L2:return"Portal";case LF:return"Profiler";case YR:return"StrictMode";case BF:return"Suspense";case jF:return"SuspenseList"}if(typeof h=="object")switch(h.$$typeof){case vH:return(h.displayName||"Context")+".Consumer";case gH:return(h._context.displayName||"Context")+".Provider";case JR:var i=h.render;return h=h.displayName,h||(h=i.displayName||i.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case QR:return i=h.displayName||null,i!==null?i:zF(h.type)||"Memo";case Rb:i=h._payload,h=h._init;try{return zF(h(i))}catch{}}return null}function Eae(h){var i=h.type;switch(h.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return h=i.render,h=h.displayName||h.name||"",i.displayName||(h!==""?"ForwardRef("+h+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return zF(i);case 8:return i===YR?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function Yb(h){switch(typeof h){case"boolean":case"number":case"string":case"undefined":return h;case"object":return h;default:return""}}function bH(h){var i=h.type;return(h=h.nodeName)&&h.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function Sae(h){var i=bH(h)?"checked":"value",s=Object.getOwnPropertyDescriptor(h.constructor.prototype,i),a=""+h[i];if(!h.hasOwnProperty(i)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var r=s.get,c=s.set;return Object.defineProperty(h,i,{configurable:!0,get:function(){return r.call(this)},set:function(S){a=""+S,c.call(this,S)}}),Object.defineProperty(h,i,{enumerable:s.enumerable}),{getValue:function(){return a},setValue:function(S){a=""+S},stopTracking:function(){h._valueTracker=null,delete h[i]}}}}function FA(h){h._valueTracker||(h._valueTracker=Sae(h))}function xH(h){if(!h)return!1;var i=h._valueTracker;if(!i)return!0;var s=i.getValue(),a="";return h&&(a=bH(h)?h.checked?"true":"false":h.value),h=a,h!==s?(i.setValue(h),!0):!1}function IO(h){if(h=h||(typeof document<"u"?document:void 0),typeof h>"u")return null;try{return h.activeElement||h.body}catch{return h.body}}function UF(h,i){var s=i.checked;return Nu({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??h._wrapperState.initialChecked})}function vU(h,i){var s=i.defaultValue==null?"":i.defaultValue,a=i.checked!=null?i.checked:i.defaultChecked;s=Yb(i.value!=null?i.value:s),h._wrapperState={initialChecked:a,initialValue:s,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function wH(h,i){i=i.checked,i!=null&&KR(h,"checked",i,!1)}function WF(h,i){wH(h,i);var s=Yb(i.value),a=i.type;if(s!=null)a==="number"?(s===0&&h.value===""||h.value!=s)&&(h.value=""+s):h.value!==""+s&&(h.value=""+s);else if(a==="submit"||a==="reset"){h.removeAttribute("value");return}i.hasOwnProperty("value")?VF(h,i.type,s):i.hasOwnProperty("defaultValue")&&VF(h,i.type,Yb(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(h.defaultChecked=!!i.defaultChecked)}function yU(h,i,s){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var a=i.type;if(!(a!=="submit"&&a!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+h._wrapperState.initialValue,s||i===h.value||(h.value=i),h.defaultValue=i}s=h.name,s!==""&&(h.name=""),h.defaultChecked=!!h._wrapperState.initialChecked,s!==""&&(h.name=s)}function VF(h,i,s){(i!=="number"||IO(h.ownerDocument)!==h)&&(s==null?h.defaultValue=""+h._wrapperState.initialValue:h.defaultValue!==""+s&&(h.defaultValue=""+s))}var AS=Array.isArray;function J2(h,i,s,a){if(h=h.options,i){i={};for(var r=0;r<s.length;r++)i["$"+s[r]]=!0;for(s=0;s<h.length;s++)r=i.hasOwnProperty("$"+h[s].value),h[s].selected!==r&&(h[s].selected=r),r&&a&&(h[s].defaultSelected=!0)}else{for(s=""+Yb(s),i=null,r=0;r<h.length;r++){if(h[r].value===s){h[r].selected=!0,a&&(h[r].defaultSelected=!0);return}i!==null||h[r].disabled||(i=h[r])}i!==null&&(i.selected=!0)}}function HF(h,i){if(i.dangerouslySetInnerHTML!=null)throw Error(li(91));return Nu({},i,{value:void 0,defaultValue:void 0,children:""+h._wrapperState.initialValue})}function bU(h,i){var s=i.value;if(s==null){if(s=i.children,i=i.defaultValue,s!=null){if(i!=null)throw Error(li(92));if(AS(s)){if(1<s.length)throw Error(li(93));s=s[0]}i=s}i==null&&(i=""),s=i}h._wrapperState={initialValue:Yb(s)}}function _H(h,i){var s=Yb(i.value),a=Yb(i.defaultValue);s!=null&&(s=""+s,s!==h.value&&(h.value=s),i.defaultValue==null&&h.defaultValue!==s&&(h.defaultValue=s)),a!=null&&(h.defaultValue=""+a)}function xU(h){var i=h.textContent;i===h._wrapperState.initialValue&&i!==""&&i!==null&&(h.value=i)}function EH(h){switch(h){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function GF(h,i){return h==null||h==="http://www.w3.org/1999/xhtml"?EH(i):h==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":h}var RA,SH=function(h){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,s,a,r){MSApp.execUnsafeLocalFunction(function(){return h(i,s,a,r)})}:h}(function(h,i){if(h.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in h)h.innerHTML=i;else{for(RA=RA||document.createElement("div"),RA.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=RA.firstChild;h.firstChild;)h.removeChild(h.firstChild);for(;i.firstChild;)h.appendChild(i.firstChild)}});function GS(h,i){if(i){var s=h.firstChild;if(s&&s===h.lastChild&&s.nodeType===3){s.nodeValue=i;return}}h.textContent=i}var IS={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Cae=["Webkit","ms","Moz","O"];Object.keys(IS).forEach(function(h){Cae.forEach(function(i){i=i+h.charAt(0).toUpperCase()+h.substring(1),IS[i]=IS[h]})});function CH(h,i,s){return i==null||typeof i=="boolean"||i===""?"":s||typeof i!="number"||i===0||IS.hasOwnProperty(h)&&IS[h]?(""+i).trim():i+"px"}function kH(h,i){h=h.style;for(var s in i)if(i.hasOwnProperty(s)){var a=s.indexOf("--")===0,r=CH(s,i[s],a);s==="float"&&(s="cssFloat"),a?h.setProperty(s,r):h[s]=r}}var kae=Nu({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function qF(h,i){if(i){if(kae[h]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(li(137,h));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(li(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(li(61))}if(i.style!=null&&typeof i.style!="object")throw Error(li(62))}}function $F(h,i){if(h.indexOf("-")===-1)return typeof i.is=="string";switch(h){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var XF=null;function ZR(h){return h=h.target||h.srcElement||window,h.correspondingUseElement&&(h=h.correspondingUseElement),h.nodeType===3?h.parentNode:h}var KF=null,Q2=null,Z2=null;function wU(h){if(h=pC(h)){if(typeof KF!="function")throw Error(li(280));var i=h.stateNode;i&&(i=hT(i),KF(h.stateNode,h.type,i))}}function AH(h){Q2?Z2?Z2.push(h):Z2=[h]:Q2=h}function OH(){if(Q2){var h=Q2,i=Z2;if(Z2=Q2=null,wU(h),i)for(h=0;h<i.length;h++)wU(i[h])}}function TH(h,i){return h(i)}function MH(){}var kI=!1;function DH(h,i,s){if(kI)return h(i,s);kI=!0;try{return TH(h,i,s)}finally{kI=!1,(Q2!==null||Z2!==null)&&(MH(),OH())}}function qS(h,i){var s=h.stateNode;if(s===null)return null;var a=hT(s);if(a===null)return null;s=a[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(h=h.type,a=!(h==="button"||h==="input"||h==="select"||h==="textarea")),h=!a;break e;default:h=!1}if(h)return null;if(s&&typeof s!="function")throw Error(li(231,i,typeof s));return s}var YF=!1;if(F1)try{var uS={};Object.defineProperty(uS,"passive",{get:function(){YF=!0}}),window.addEventListener("test",uS,uS),window.removeEventListener("test",uS,uS)}catch{YF=!1}function Aae(h,i,s,a,r,c,S,E,A){var U=Array.prototype.slice.call(arguments,3);try{i.apply(s,U)}catch(B){this.onError(B)}}var FS=!1,FO=null,RO=!1,JF=null,Oae={onError:function(h){FS=!0,FO=h}};function Tae(h,i,s,a,r,c,S,E,A){FS=!1,FO=null,Aae.apply(Oae,arguments)}function Mae(h,i,s,a,r,c,S,E,A){if(Tae.apply(this,arguments),FS){if(FS){var U=FO;FS=!1,FO=null}else throw Error(li(198));RO||(RO=!0,JF=U)}}function Ew(h){var i=h,s=h;if(h.alternate)for(;i.return;)i=i.return;else{h=i;do i=h,i.flags&4098&&(s=i.return),h=i.return;while(h)}return i.tag===3?s:null}function NH(h){if(h.tag===13){var i=h.memoizedState;if(i===null&&(h=h.alternate,h!==null&&(i=h.memoizedState)),i!==null)return i.dehydrated}return null}function _U(h){if(Ew(h)!==h)throw Error(li(188))}function Dae(h){var i=h.alternate;if(!i){if(i=Ew(h),i===null)throw Error(li(188));return i!==h?null:h}for(var s=h,a=i;;){var r=s.return;if(r===null)break;var c=r.alternate;if(c===null){if(a=r.return,a!==null){s=a;continue}break}if(r.child===c.child){for(c=r.child;c;){if(c===s)return _U(r),h;if(c===a)return _U(r),i;c=c.sibling}throw Error(li(188))}if(s.return!==a.return)s=r,a=c;else{for(var S=!1,E=r.child;E;){if(E===s){S=!0,s=r,a=c;break}if(E===a){S=!0,a=r,s=c;break}E=E.sibling}if(!S){for(E=c.child;E;){if(E===s){S=!0,s=c,a=r;break}if(E===a){S=!0,a=c,s=r;break}E=E.sibling}if(!S)throw Error(li(189))}}if(s.alternate!==a)throw Error(li(190))}if(s.tag!==3)throw Error(li(188));return s.stateNode.current===s?h:i}function IH(h){return h=Dae(h),h!==null?FH(h):null}function FH(h){if(h.tag===5||h.tag===6)return h;for(h=h.child;h!==null;){var i=FH(h);if(i!==null)return i;h=h.sibling}return null}var RH=Km.unstable_scheduleCallback,EU=Km.unstable_cancelCallback,Nae=Km.unstable_shouldYield,Iae=Km.unstable_requestPaint,cc=Km.unstable_now,Fae=Km.unstable_getCurrentPriorityLevel,e5=Km.unstable_ImmediatePriority,PH=Km.unstable_UserBlockingPriority,PO=Km.unstable_NormalPriority,Rae=Km.unstable_LowPriority,LH=Km.unstable_IdlePriority,cT=null,Oy=null;function Pae(h){if(Oy&&typeof Oy.onCommitFiberRoot=="function")try{Oy.onCommitFiberRoot(cT,h,void 0,(h.current.flags&128)===128)}catch{}}var rv=Math.clz32?Math.clz32:jae,Lae=Math.log,Bae=Math.LN2;function jae(h){return h>>>=0,h===0?32:31-(Lae(h)/Bae|0)|0}var PA=64,LA=4194304;function OS(h){switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return h&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return h}}function LO(h,i){var s=h.pendingLanes;if(s===0)return 0;var a=0,r=h.suspendedLanes,c=h.pingedLanes,S=s&268435455;if(S!==0){var E=S&~r;E!==0?a=OS(E):(c&=S,c!==0&&(a=OS(c)))}else S=s&~r,S!==0?a=OS(S):c!==0&&(a=OS(c));if(a===0)return 0;if(i!==0&&i!==a&&!(i&r)&&(r=a&-a,c=i&-i,r>=c||r===16&&(c&4194240)!==0))return i;if(a&4&&(a|=s&16),i=h.entangledLanes,i!==0)for(h=h.entanglements,i&=a;0<i;)s=31-rv(i),r=1<<s,a|=h[s],i&=~r;return a}function zae(h,i){switch(h){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Uae(h,i){for(var s=h.suspendedLanes,a=h.pingedLanes,r=h.expirationTimes,c=h.pendingLanes;0<c;){var S=31-rv(c),E=1<<S,A=r[S];A===-1?(!(E&s)||E&a)&&(r[S]=zae(E,i)):A<=i&&(h.expiredLanes|=E),c&=~E}}function QF(h){return h=h.pendingLanes&-1073741825,h!==0?h:h&1073741824?1073741824:0}function BH(){var h=PA;return PA<<=1,!(PA&4194240)&&(PA=64),h}function AI(h){for(var i=[],s=0;31>s;s++)i.push(h);return i}function dC(h,i,s){h.pendingLanes|=i,i!==536870912&&(h.suspendedLanes=0,h.pingedLanes=0),h=h.eventTimes,i=31-rv(i),h[i]=s}function Wae(h,i){var s=h.pendingLanes&~i;h.pendingLanes=i,h.suspendedLanes=0,h.pingedLanes=0,h.expiredLanes&=i,h.mutableReadLanes&=i,h.entangledLanes&=i,i=h.entanglements;var a=h.eventTimes;for(h=h.expirationTimes;0<s;){var r=31-rv(s),c=1<<r;i[r]=0,a[r]=-1,h[r]=-1,s&=~c}}function t5(h,i){var s=h.entangledLanes|=i;for(h=h.entanglements;s;){var a=31-rv(s),r=1<<a;r&i|h[a]&i&&(h[a]|=i),s&=~r}}var fs=0;function jH(h){return h&=-h,1<h?4<h?h&268435455?16:536870912:4:1}var zH,n5,UH,WH,VH,ZF=!1,BA=[],Ub=null,Wb=null,Vb=null,$S=new Map,XS=new Map,Lb=[],Vae="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function SU(h,i){switch(h){case"focusin":case"focusout":Ub=null;break;case"dragenter":case"dragleave":Wb=null;break;case"mouseover":case"mouseout":Vb=null;break;case"pointerover":case"pointerout":$S.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":XS.delete(i.pointerId)}}function cS(h,i,s,a,r,c){return h===null||h.nativeEvent!==c?(h={blockedOn:i,domEventName:s,eventSystemFlags:a,nativeEvent:c,targetContainers:[r]},i!==null&&(i=pC(i),i!==null&&n5(i)),h):(h.eventSystemFlags|=a,i=h.targetContainers,r!==null&&i.indexOf(r)===-1&&i.push(r),h)}function Hae(h,i,s,a,r){switch(i){case"focusin":return Ub=cS(Ub,h,i,s,a,r),!0;case"dragenter":return Wb=cS(Wb,h,i,s,a,r),!0;case"mouseover":return Vb=cS(Vb,h,i,s,a,r),!0;case"pointerover":var c=r.pointerId;return $S.set(c,cS($S.get(c)||null,h,i,s,a,r)),!0;case"gotpointercapture":return c=r.pointerId,XS.set(c,cS(XS.get(c)||null,h,i,s,a,r)),!0}return!1}function HH(h){var i=rw(h.target);if(i!==null){var s=Ew(i);if(s!==null){if(i=s.tag,i===13){if(i=NH(s),i!==null){h.blockedOn=i,VH(h.priority,function(){UH(s)});return}}else if(i===3&&s.stateNode.current.memoizedState.isDehydrated){h.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}h.blockedOn=null}function wO(h){if(h.blockedOn!==null)return!1;for(var i=h.targetContainers;0<i.length;){var s=eR(h.domEventName,h.eventSystemFlags,i[0],h.nativeEvent);if(s===null){s=h.nativeEvent;var a=new s.constructor(s.type,s);XF=a,s.target.dispatchEvent(a),XF=null}else return i=pC(s),i!==null&&n5(i),h.blockedOn=s,!1;i.shift()}return!0}function CU(h,i,s){wO(h)&&s.delete(i)}function Gae(){ZF=!1,Ub!==null&&wO(Ub)&&(Ub=null),Wb!==null&&wO(Wb)&&(Wb=null),Vb!==null&&wO(Vb)&&(Vb=null),$S.forEach(CU),XS.forEach(CU)}function lS(h,i){h.blockedOn===i&&(h.blockedOn=null,ZF||(ZF=!0,Km.unstable_scheduleCallback(Km.unstable_NormalPriority,Gae)))}function KS(h){function i(r){return lS(r,h)}if(0<BA.length){lS(BA[0],h);for(var s=1;s<BA.length;s++){var a=BA[s];a.blockedOn===h&&(a.blockedOn=null)}}for(Ub!==null&&lS(Ub,h),Wb!==null&&lS(Wb,h),Vb!==null&&lS(Vb,h),$S.forEach(i),XS.forEach(i),s=0;s<Lb.length;s++)a=Lb[s],a.blockedOn===h&&(a.blockedOn=null);for(;0<Lb.length&&(s=Lb[0],s.blockedOn===null);)HH(s),s.blockedOn===null&&Lb.shift()}var e_=B1.ReactCurrentBatchConfig,BO=!0;function qae(h,i,s,a){var r=fs,c=e_.transition;e_.transition=null;try{fs=1,r5(h,i,s,a)}finally{fs=r,e_.transition=c}}function $ae(h,i,s,a){var r=fs,c=e_.transition;e_.transition=null;try{fs=4,r5(h,i,s,a)}finally{fs=r,e_.transition=c}}function r5(h,i,s,a){if(BO){var r=eR(h,i,s,a);if(r===null)LI(h,i,a,jO,s),SU(h,a);else if(Hae(r,h,i,s,a))a.stopPropagation();else if(SU(h,a),i&4&&-1<Vae.indexOf(h)){for(;r!==null;){var c=pC(r);if(c!==null&&zH(c),c=eR(h,i,s,a),c===null&&LI(h,i,a,jO,s),c===r)break;r=c}r!==null&&a.stopPropagation()}else LI(h,i,a,null,s)}}var jO=null;function eR(h,i,s,a){if(jO=null,h=ZR(a),h=rw(h),h!==null)if(i=Ew(h),i===null)h=null;else if(s=i.tag,s===13){if(h=NH(i),h!==null)return h;h=null}else if(s===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;h=null}else i!==h&&(h=null);return jO=h,null}function GH(h){switch(h){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Fae()){case e5:return 1;case PH:return 4;case PO:case Rae:return 16;case LH:return 536870912;default:return 16}default:return 16}}var jb=null,i5=null,_O=null;function qH(){if(_O)return _O;var h,i=i5,s=i.length,a,r="value"in jb?jb.value:jb.textContent,c=r.length;for(h=0;h<s&&i[h]===r[h];h++);var S=s-h;for(a=1;a<=S&&i[s-a]===r[c-a];a++);return _O=r.slice(h,1<a?1-a:void 0)}function EO(h){var i=h.keyCode;return"charCode"in h?(h=h.charCode,h===0&&i===13&&(h=13)):h=i,h===10&&(h=13),32<=h||h===13?h:0}function jA(){return!0}function kU(){return!1}function Jm(h){function i(s,a,r,c,S){this._reactName=s,this._targetInst=r,this.type=a,this.nativeEvent=c,this.target=S,this.currentTarget=null;for(var E in h)h.hasOwnProperty(E)&&(s=h[E],this[E]=s?s(c):c[E]);return this.isDefaultPrevented=(c.defaultPrevented!=null?c.defaultPrevented:c.returnValue===!1)?jA:kU,this.isPropagationStopped=kU,this}return Nu(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=jA)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=jA)},persist:function(){},isPersistent:jA}),i}var v_={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(h){return h.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},o5=Jm(v_),hC=Nu({},v_,{view:0,detail:0}),Xae=Jm(hC),OI,TI,fS,lT=Nu({},hC,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:a5,button:0,buttons:0,relatedTarget:function(h){return h.relatedTarget===void 0?h.fromElement===h.srcElement?h.toElement:h.fromElement:h.relatedTarget},movementX:function(h){return"movementX"in h?h.movementX:(h!==fS&&(fS&&h.type==="mousemove"?(OI=h.screenX-fS.screenX,TI=h.screenY-fS.screenY):TI=OI=0,fS=h),OI)},movementY:function(h){return"movementY"in h?h.movementY:TI}}),AU=Jm(lT),Kae=Nu({},lT,{dataTransfer:0}),Yae=Jm(Kae),Jae=Nu({},hC,{relatedTarget:0}),MI=Jm(Jae),Qae=Nu({},v_,{animationName:0,elapsedTime:0,pseudoElement:0}),Zae=Jm(Qae),ese=Nu({},v_,{clipboardData:function(h){return"clipboardData"in h?h.clipboardData:window.clipboardData}}),tse=Jm(ese),nse=Nu({},v_,{data:0}),OU=Jm(nse),rse={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ise={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ose={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ase(h){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(h):(h=ose[h])?!!i[h]:!1}function a5(){return ase}var sse=Nu({},hC,{key:function(h){if(h.key){var i=rse[h.key]||h.key;if(i!=="Unidentified")return i}return h.type==="keypress"?(h=EO(h),h===13?"Enter":String.fromCharCode(h)):h.type==="keydown"||h.type==="keyup"?ise[h.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:a5,charCode:function(h){return h.type==="keypress"?EO(h):0},keyCode:function(h){return h.type==="keydown"||h.type==="keyup"?h.keyCode:0},which:function(h){return h.type==="keypress"?EO(h):h.type==="keydown"||h.type==="keyup"?h.keyCode:0}}),use=Jm(sse),cse=Nu({},lT,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),TU=Jm(cse),lse=Nu({},hC,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:a5}),fse=Jm(lse),dse=Nu({},v_,{propertyName:0,elapsedTime:0,pseudoElement:0}),hse=Jm(dse),pse=Nu({},lT,{deltaX:function(h){return"deltaX"in h?h.deltaX:"wheelDeltaX"in h?-h.wheelDeltaX:0},deltaY:function(h){return"deltaY"in h?h.deltaY:"wheelDeltaY"in h?-h.wheelDeltaY:"wheelDelta"in h?-h.wheelDelta:0},deltaZ:0,deltaMode:0}),mse=Jm(pse),gse=[9,13,27,32],s5=F1&&"CompositionEvent"in window,RS=null;F1&&"documentMode"in document&&(RS=document.documentMode);var vse=F1&&"TextEvent"in window&&!RS,$H=F1&&(!s5||RS&&8<RS&&11>=RS),MU=String.fromCharCode(32),DU=!1;function XH(h,i){switch(h){case"keyup":return gse.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function KH(h){return h=h.detail,typeof h=="object"&&"data"in h?h.data:null}var j2=!1;function yse(h,i){switch(h){case"compositionend":return KH(i);case"keypress":return i.which!==32?null:(DU=!0,MU);case"textInput":return h=i.data,h===MU&&DU?null:h;default:return null}}function bse(h,i){if(j2)return h==="compositionend"||!s5&&XH(h,i)?(h=qH(),_O=i5=jb=null,j2=!1,h):null;switch(h){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return $H&&i.locale!=="ko"?null:i.data;default:return null}}var xse={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function NU(h){var i=h&&h.nodeName&&h.nodeName.toLowerCase();return i==="input"?!!xse[h.type]:i==="textarea"}function YH(h,i,s,a){AH(a),i=zO(i,"onChange"),0<i.length&&(s=new o5("onChange","change",null,s,a),h.push({event:s,listeners:i}))}var PS=null,YS=null;function wse(h){sG(h,0)}function fT(h){var i=W2(h);if(xH(i))return h}function _se(h,i){if(h==="change")return i}var JH=!1;if(F1){var DI;if(F1){var NI="oninput"in document;if(!NI){var IU=document.createElement("div");IU.setAttribute("oninput","return;"),NI=typeof IU.oninput=="function"}DI=NI}else DI=!1;JH=DI&&(!document.documentMode||9<document.documentMode)}function FU(){PS&&(PS.detachEvent("onpropertychange",QH),YS=PS=null)}function QH(h){if(h.propertyName==="value"&&fT(YS)){var i=[];YH(i,YS,h,ZR(h)),DH(wse,i)}}function Ese(h,i,s){h==="focusin"?(FU(),PS=i,YS=s,PS.attachEvent("onpropertychange",QH)):h==="focusout"&&FU()}function Sse(h){if(h==="selectionchange"||h==="keyup"||h==="keydown")return fT(YS)}function Cse(h,i){if(h==="click")return fT(i)}function kse(h,i){if(h==="input"||h==="change")return fT(i)}function Ase(h,i){return h===i&&(h!==0||1/h===1/i)||h!==h&&i!==i}var ov=typeof Object.is=="function"?Object.is:Ase;function JS(h,i){if(ov(h,i))return!0;if(typeof h!="object"||h===null||typeof i!="object"||i===null)return!1;var s=Object.keys(h),a=Object.keys(i);if(s.length!==a.length)return!1;for(a=0;a<s.length;a++){var r=s[a];if(!PF.call(i,r)||!ov(h[r],i[r]))return!1}return!0}function RU(h){for(;h&&h.firstChild;)h=h.firstChild;return h}function PU(h,i){var s=RU(h);h=0;for(var a;s;){if(s.nodeType===3){if(a=h+s.textContent.length,h<=i&&a>=i)return{node:s,offset:i-h};h=a}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=RU(s)}}function ZH(h,i){return h&&i?h===i?!0:h&&h.nodeType===3?!1:i&&i.nodeType===3?ZH(h,i.parentNode):"contains"in h?h.contains(i):h.compareDocumentPosition?!!(h.compareDocumentPosition(i)&16):!1:!1}function eG(){for(var h=window,i=IO();i instanceof h.HTMLIFrameElement;){try{var s=typeof i.contentWindow.location.href=="string"}catch{s=!1}if(s)h=i.contentWindow;else break;i=IO(h.document)}return i}function u5(h){var i=h&&h.nodeName&&h.nodeName.toLowerCase();return i&&(i==="input"&&(h.type==="text"||h.type==="search"||h.type==="tel"||h.type==="url"||h.type==="password")||i==="textarea"||h.contentEditable==="true")}function Ose(h){var i=eG(),s=h.focusedElem,a=h.selectionRange;if(i!==s&&s&&s.ownerDocument&&ZH(s.ownerDocument.documentElement,s)){if(a!==null&&u5(s)){if(i=a.start,h=a.end,h===void 0&&(h=i),"selectionStart"in s)s.selectionStart=i,s.selectionEnd=Math.min(h,s.value.length);else if(h=(i=s.ownerDocument||document)&&i.defaultView||window,h.getSelection){h=h.getSelection();var r=s.textContent.length,c=Math.min(a.start,r);a=a.end===void 0?c:Math.min(a.end,r),!h.extend&&c>a&&(r=a,a=c,c=r),r=PU(s,c);var S=PU(s,a);r&&S&&(h.rangeCount!==1||h.anchorNode!==r.node||h.anchorOffset!==r.offset||h.focusNode!==S.node||h.focusOffset!==S.offset)&&(i=i.createRange(),i.setStart(r.node,r.offset),h.removeAllRanges(),c>a?(h.addRange(i),h.extend(S.node,S.offset)):(i.setEnd(S.node,S.offset),h.addRange(i)))}}for(i=[],h=s;h=h.parentNode;)h.nodeType===1&&i.push({element:h,left:h.scrollLeft,top:h.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<i.length;s++)h=i[s],h.element.scrollLeft=h.left,h.element.scrollTop=h.top}}var Tse=F1&&"documentMode"in document&&11>=document.documentMode,z2=null,tR=null,LS=null,nR=!1;function LU(h,i,s){var a=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;nR||z2==null||z2!==IO(a)||(a=z2,"selectionStart"in a&&u5(a)?a={start:a.selectionStart,end:a.selectionEnd}:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection(),a={anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset}),LS&&JS(LS,a)||(LS=a,a=zO(tR,"onSelect"),0<a.length&&(i=new o5("onSelect","select",null,i,s),h.push({event:i,listeners:a}),i.target=z2)))}function zA(h,i){var s={};return s[h.toLowerCase()]=i.toLowerCase(),s["Webkit"+h]="webkit"+i,s["Moz"+h]="moz"+i,s}var U2={animationend:zA("Animation","AnimationEnd"),animationiteration:zA("Animation","AnimationIteration"),animationstart:zA("Animation","AnimationStart"),transitionend:zA("Transition","TransitionEnd")},II={},tG={};F1&&(tG=document.createElement("div").style,"AnimationEvent"in window||(delete U2.animationend.animation,delete U2.animationiteration.animation,delete U2.animationstart.animation),"TransitionEvent"in window||delete U2.transitionend.transition);function dT(h){if(II[h])return II[h];if(!U2[h])return h;var i=U2[h],s;for(s in i)if(i.hasOwnProperty(s)&&s in tG)return II[h]=i[s];return h}var nG=dT("animationend"),rG=dT("animationiteration"),iG=dT("animationstart"),oG=dT("transitionend"),aG=new Map,BU="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ex(h,i){aG.set(h,i),_w(i,[h])}for(var FI=0;FI<BU.length;FI++){var RI=BU[FI],Mse=RI.toLowerCase(),Dse=RI[0].toUpperCase()+RI.slice(1);ex(Mse,"on"+Dse)}ex(nG,"onAnimationEnd");ex(rG,"onAnimationIteration");ex(iG,"onAnimationStart");ex("dblclick","onDoubleClick");ex("focusin","onFocus");ex("focusout","onBlur");ex(oG,"onTransitionEnd");o_("onMouseEnter",["mouseout","mouseover"]);o_("onMouseLeave",["mouseout","mouseover"]);o_("onPointerEnter",["pointerout","pointerover"]);o_("onPointerLeave",["pointerout","pointerover"]);_w("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));_w("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));_w("onBeforeInput",["compositionend","keypress","textInput","paste"]);_w("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));_w("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));_w("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var TS="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Nse=new Set("cancel close invalid load scroll toggle".split(" ").concat(TS));function jU(h,i,s){var a=h.type||"unknown-event";h.currentTarget=s,Mae(a,i,void 0,h),h.currentTarget=null}function sG(h,i){i=(i&4)!==0;for(var s=0;s<h.length;s++){var a=h[s],r=a.event;a=a.listeners;e:{var c=void 0;if(i)for(var S=a.length-1;0<=S;S--){var E=a[S],A=E.instance,U=E.currentTarget;if(E=E.listener,A!==c&&r.isPropagationStopped())break e;jU(r,E,U),c=A}else for(S=0;S<a.length;S++){if(E=a[S],A=E.instance,U=E.currentTarget,E=E.listener,A!==c&&r.isPropagationStopped())break e;jU(r,E,U),c=A}}}if(RO)throw h=JF,RO=!1,JF=null,h}function ru(h,i){var s=i[sR];s===void 0&&(s=i[sR]=new Set);var a=h+"__bubble";s.has(a)||(uG(i,h,2,!1),s.add(a))}function PI(h,i,s){var a=0;i&&(a|=4),uG(s,h,a,i)}var UA="_reactListening"+Math.random().toString(36).slice(2);function QS(h){if(!h[UA]){h[UA]=!0,mH.forEach(function(s){s!=="selectionchange"&&(Nse.has(s)||PI(s,!1,h),PI(s,!0,h))});var i=h.nodeType===9?h:h.ownerDocument;i===null||i[UA]||(i[UA]=!0,PI("selectionchange",!1,i))}}function uG(h,i,s,a){switch(GH(i)){case 1:var r=qae;break;case 4:r=$ae;break;default:r=r5}s=r.bind(null,i,s,h),r=void 0,!YF||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(r=!0),a?r!==void 0?h.addEventListener(i,s,{capture:!0,passive:r}):h.addEventListener(i,s,!0):r!==void 0?h.addEventListener(i,s,{passive:r}):h.addEventListener(i,s,!1)}function LI(h,i,s,a,r){var c=a;if(!(i&1)&&!(i&2)&&a!==null)e:for(;;){if(a===null)return;var S=a.tag;if(S===3||S===4){var E=a.stateNode.containerInfo;if(E===r||E.nodeType===8&&E.parentNode===r)break;if(S===4)for(S=a.return;S!==null;){var A=S.tag;if((A===3||A===4)&&(A=S.stateNode.containerInfo,A===r||A.nodeType===8&&A.parentNode===r))return;S=S.return}for(;E!==null;){if(S=rw(E),S===null)return;if(A=S.tag,A===5||A===6){a=c=S;continue e}E=E.parentNode}}a=a.return}DH(function(){var U=c,B=ZR(s),D=[];e:{var R=aG.get(h);if(R!==void 0){var W=o5,j=h;switch(h){case"keypress":if(EO(s)===0)break e;case"keydown":case"keyup":W=use;break;case"focusin":j="focus",W=MI;break;case"focusout":j="blur",W=MI;break;case"beforeblur":case"afterblur":W=MI;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":W=AU;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":W=Yae;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":W=fse;break;case nG:case rG:case iG:W=Zae;break;case oG:W=hse;break;case"scroll":W=Xae;break;case"wheel":W=mse;break;case"copy":case"cut":case"paste":W=tse;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":W=TU}var H=(i&4)!==0,I=!H&&h==="scroll",Q=H?R!==null?R+"Capture":null:R;H=[];for(var Y=U,q;Y!==null;){q=Y;var ae=q.stateNode;if(q.tag===5&&ae!==null&&(q=ae,Q!==null&&(ae=qS(Y,Q),ae!=null&&H.push(ZS(Y,ae,q)))),I)break;Y=Y.return}0<H.length&&(R=new W(R,j,null,s,B),D.push({event:R,listeners:H}))}}if(!(i&7)){e:{if(R=h==="mouseover"||h==="pointerover",W=h==="mouseout"||h==="pointerout",R&&s!==XF&&(j=s.relatedTarget||s.fromElement)&&(rw(j)||j[R1]))break e;if((W||R)&&(R=B.window===B?B:(R=B.ownerDocument)?R.defaultView||R.parentWindow:window,W?(j=s.relatedTarget||s.toElement,W=U,j=j?rw(j):null,j!==null&&(I=Ew(j),j!==I||j.tag!==5&&j.tag!==6)&&(j=null)):(W=null,j=U),W!==j)){if(H=AU,ae="onMouseLeave",Q="onMouseEnter",Y="mouse",(h==="pointerout"||h==="pointerover")&&(H=TU,ae="onPointerLeave",Q="onPointerEnter",Y="pointer"),I=W==null?R:W2(W),q=j==null?R:W2(j),R=new H(ae,Y+"leave",W,s,B),R.target=I,R.relatedTarget=q,ae=null,rw(B)===U&&(H=new H(Q,Y+"enter",j,s,B),H.target=q,H.relatedTarget=I,ae=H),I=ae,W&&j)t:{for(H=W,Q=j,Y=0,q=H;q;q=y2(q))Y++;for(q=0,ae=Q;ae;ae=y2(ae))q++;for(;0<Y-q;)H=y2(H),Y--;for(;0<q-Y;)Q=y2(Q),q--;for(;Y--;){if(H===Q||Q!==null&&H===Q.alternate)break t;H=y2(H),Q=y2(Q)}H=null}else H=null;W!==null&&zU(D,R,W,H,!1),j!==null&&I!==null&&zU(D,I,j,H,!0)}}e:{if(R=U?W2(U):window,W=R.nodeName&&R.nodeName.toLowerCase(),W==="select"||W==="input"&&R.type==="file")var oe=_se;else if(NU(R))if(JH)oe=kse;else{oe=Sse;var ye=Ese}else(W=R.nodeName)&&W.toLowerCase()==="input"&&(R.type==="checkbox"||R.type==="radio")&&(oe=Cse);if(oe&&(oe=oe(h,U))){YH(D,oe,s,B);break e}ye&&ye(h,R,U),h==="focusout"&&(ye=R._wrapperState)&&ye.controlled&&R.type==="number"&&VF(R,"number",R.value)}switch(ye=U?W2(U):window,h){case"focusin":(NU(ye)||ye.contentEditable==="true")&&(z2=ye,tR=U,LS=null);break;case"focusout":LS=tR=z2=null;break;case"mousedown":nR=!0;break;case"contextmenu":case"mouseup":case"dragend":nR=!1,LU(D,s,B);break;case"selectionchange":if(Tse)break;case"keydown":case"keyup":LU(D,s,B)}var _e;if(s5)e:{switch(h){case"compositionstart":var pe="onCompositionStart";break e;case"compositionend":pe="onCompositionEnd";break e;case"compositionupdate":pe="onCompositionUpdate";break e}pe=void 0}else j2?XH(h,s)&&(pe="onCompositionEnd"):h==="keydown"&&s.keyCode===229&&(pe="onCompositionStart");pe&&($H&&s.locale!=="ko"&&(j2||pe!=="onCompositionStart"?pe==="onCompositionEnd"&&j2&&(_e=qH()):(jb=B,i5="value"in jb?jb.value:jb.textContent,j2=!0)),ye=zO(U,pe),0<ye.length&&(pe=new OU(pe,h,null,s,B),D.push({event:pe,listeners:ye}),_e?pe.data=_e:(_e=KH(s),_e!==null&&(pe.data=_e)))),(_e=vse?yse(h,s):bse(h,s))&&(U=zO(U,"onBeforeInput"),0<U.length&&(B=new OU("onBeforeInput","beforeinput",null,s,B),D.push({event:B,listeners:U}),B.data=_e))}sG(D,i)})}function ZS(h,i,s){return{instance:h,listener:i,currentTarget:s}}function zO(h,i){for(var s=i+"Capture",a=[];h!==null;){var r=h,c=r.stateNode;r.tag===5&&c!==null&&(r=c,c=qS(h,s),c!=null&&a.unshift(ZS(h,c,r)),c=qS(h,i),c!=null&&a.push(ZS(h,c,r))),h=h.return}return a}function y2(h){if(h===null)return null;do h=h.return;while(h&&h.tag!==5);return h||null}function zU(h,i,s,a,r){for(var c=i._reactName,S=[];s!==null&&s!==a;){var E=s,A=E.alternate,U=E.stateNode;if(A!==null&&A===a)break;E.tag===5&&U!==null&&(E=U,r?(A=qS(s,c),A!=null&&S.unshift(ZS(s,A,E))):r||(A=qS(s,c),A!=null&&S.push(ZS(s,A,E)))),s=s.return}S.length!==0&&h.push({event:i,listeners:S})}var Ise=/\r\n?/g,Fse=/\u0000|\uFFFD/g;function UU(h){return(typeof h=="string"?h:""+h).replace(Ise,`
`).replace(Fse,"")}function WA(h,i,s){if(i=UU(i),UU(h)!==i&&s)throw Error(li(425))}function UO(){}var rR=null,iR=null;function oR(h,i){return h==="textarea"||h==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var aR=typeof setTimeout=="function"?setTimeout:void 0,Rse=typeof clearTimeout=="function"?clearTimeout:void 0,WU=typeof Promise=="function"?Promise:void 0,Pse=typeof queueMicrotask=="function"?queueMicrotask:typeof WU<"u"?function(h){return WU.resolve(null).then(h).catch(Lse)}:aR;function Lse(h){setTimeout(function(){throw h})}function BI(h,i){var s=i,a=0;do{var r=s.nextSibling;if(h.removeChild(s),r&&r.nodeType===8)if(s=r.data,s==="/$"){if(a===0){h.removeChild(r),KS(i);return}a--}else s!=="$"&&s!=="$?"&&s!=="$!"||a++;s=r}while(s);KS(i)}function Hb(h){for(;h!=null;h=h.nextSibling){var i=h.nodeType;if(i===1||i===3)break;if(i===8){if(i=h.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return h}function VU(h){h=h.previousSibling;for(var i=0;h;){if(h.nodeType===8){var s=h.data;if(s==="$"||s==="$!"||s==="$?"){if(i===0)return h;i--}else s==="/$"&&i++}h=h.previousSibling}return null}var y_=Math.random().toString(36).slice(2),ky="__reactFiber$"+y_,eC="__reactProps$"+y_,R1="__reactContainer$"+y_,sR="__reactEvents$"+y_,Bse="__reactListeners$"+y_,jse="__reactHandles$"+y_;function rw(h){var i=h[ky];if(i)return i;for(var s=h.parentNode;s;){if(i=s[R1]||s[ky]){if(s=i.alternate,i.child!==null||s!==null&&s.child!==null)for(h=VU(h);h!==null;){if(s=h[ky])return s;h=VU(h)}return i}h=s,s=h.parentNode}return null}function pC(h){return h=h[ky]||h[R1],!h||h.tag!==5&&h.tag!==6&&h.tag!==13&&h.tag!==3?null:h}function W2(h){if(h.tag===5||h.tag===6)return h.stateNode;throw Error(li(33))}function hT(h){return h[eC]||null}var uR=[],V2=-1;function tx(h){return{current:h}}function ou(h){0>V2||(h.current=uR[V2],uR[V2]=null,V2--)}function $s(h,i){V2++,uR[V2]=h.current,h.current=i}var Jb={},fd=tx(Jb),Pp=tx(!1),dw=Jb;function a_(h,i){var s=h.type.contextTypes;if(!s)return Jb;var a=h.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===i)return a.__reactInternalMemoizedMaskedChildContext;var r={},c;for(c in s)r[c]=i[c];return a&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=i,h.__reactInternalMemoizedMaskedChildContext=r),r}function Lp(h){return h=h.childContextTypes,h!=null}function WO(){ou(Pp),ou(fd)}function HU(h,i,s){if(fd.current!==Jb)throw Error(li(168));$s(fd,i),$s(Pp,s)}function cG(h,i,s){var a=h.stateNode;if(i=i.childContextTypes,typeof a.getChildContext!="function")return s;a=a.getChildContext();for(var r in a)if(!(r in i))throw Error(li(108,Eae(h)||"Unknown",r));return Nu({},s,a)}function VO(h){return h=(h=h.stateNode)&&h.__reactInternalMemoizedMergedChildContext||Jb,dw=fd.current,$s(fd,h),$s(Pp,Pp.current),!0}function GU(h,i,s){var a=h.stateNode;if(!a)throw Error(li(169));s?(h=cG(h,i,dw),a.__reactInternalMemoizedMergedChildContext=h,ou(Pp),ou(fd),$s(fd,h)):ou(Pp),$s(Pp,s)}var A1=null,pT=!1,jI=!1;function lG(h){A1===null?A1=[h]:A1.push(h)}function zse(h){pT=!0,lG(h)}function nx(){if(!jI&&A1!==null){jI=!0;var h=0,i=fs;try{var s=A1;for(fs=1;h<s.length;h++){var a=s[h];do a=a(!0);while(a!==null)}A1=null,pT=!1}catch(r){throw A1!==null&&(A1=A1.slice(h+1)),RH(e5,nx),r}finally{fs=i,jI=!1}}return null}var H2=[],G2=0,HO=null,GO=0,Wg=[],Vg=0,hw=null,M1=1,D1="";function Qx(h,i){H2[G2++]=GO,H2[G2++]=HO,HO=h,GO=i}function fG(h,i,s){Wg[Vg++]=M1,Wg[Vg++]=D1,Wg[Vg++]=hw,hw=h;var a=M1;h=D1;var r=32-rv(a)-1;a&=~(1<<r),s+=1;var c=32-rv(i)+r;if(30<c){var S=r-r%5;c=(a&(1<<S)-1).toString(32),a>>=S,r-=S,M1=1<<32-rv(i)+r|s<<r|a,D1=c+h}else M1=1<<c|s<<r|a,D1=h}function c5(h){h.return!==null&&(Qx(h,1),fG(h,1,0))}function l5(h){for(;h===HO;)HO=H2[--G2],H2[G2]=null,GO=H2[--G2],H2[G2]=null;for(;h===hw;)hw=Wg[--Vg],Wg[Vg]=null,D1=Wg[--Vg],Wg[Vg]=null,M1=Wg[--Vg],Wg[Vg]=null}var Xm=null,qm=null,xu=!1,ev=null;function dG(h,i){var s=Gg(5,null,null,0);s.elementType="DELETED",s.stateNode=i,s.return=h,i=h.deletions,i===null?(h.deletions=[s],h.flags|=16):i.push(s)}function qU(h,i){switch(h.tag){case 5:var s=h.type;return i=i.nodeType!==1||s.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(h.stateNode=i,Xm=h,qm=Hb(i.firstChild),!0):!1;case 6:return i=h.pendingProps===""||i.nodeType!==3?null:i,i!==null?(h.stateNode=i,Xm=h,qm=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(s=hw!==null?{id:M1,overflow:D1}:null,h.memoizedState={dehydrated:i,treeContext:s,retryLane:1073741824},s=Gg(18,null,null,0),s.stateNode=i,s.return=h,h.child=s,Xm=h,qm=null,!0):!1;default:return!1}}function cR(h){return(h.mode&1)!==0&&(h.flags&128)===0}function lR(h){if(xu){var i=qm;if(i){var s=i;if(!qU(h,i)){if(cR(h))throw Error(li(418));i=Hb(s.nextSibling);var a=Xm;i&&qU(h,i)?dG(a,s):(h.flags=h.flags&-4097|2,xu=!1,Xm=h)}}else{if(cR(h))throw Error(li(418));h.flags=h.flags&-4097|2,xu=!1,Xm=h}}}function $U(h){for(h=h.return;h!==null&&h.tag!==5&&h.tag!==3&&h.tag!==13;)h=h.return;Xm=h}function VA(h){if(h!==Xm)return!1;if(!xu)return $U(h),xu=!0,!1;var i;if((i=h.tag!==3)&&!(i=h.tag!==5)&&(i=h.type,i=i!=="head"&&i!=="body"&&!oR(h.type,h.memoizedProps)),i&&(i=qm)){if(cR(h))throw hG(),Error(li(418));for(;i;)dG(h,i),i=Hb(i.nextSibling)}if($U(h),h.tag===13){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(li(317));e:{for(h=h.nextSibling,i=0;h;){if(h.nodeType===8){var s=h.data;if(s==="/$"){if(i===0){qm=Hb(h.nextSibling);break e}i--}else s!=="$"&&s!=="$!"&&s!=="$?"||i++}h=h.nextSibling}qm=null}}else qm=Xm?Hb(h.stateNode.nextSibling):null;return!0}function hG(){for(var h=qm;h;)h=Hb(h.nextSibling)}function s_(){qm=Xm=null,xu=!1}function f5(h){ev===null?ev=[h]:ev.push(h)}var Use=B1.ReactCurrentBatchConfig;function Q0(h,i){if(h&&h.defaultProps){i=Nu({},i),h=h.defaultProps;for(var s in h)i[s]===void 0&&(i[s]=h[s]);return i}return i}var qO=tx(null),$O=null,q2=null,d5=null;function h5(){d5=q2=$O=null}function p5(h){var i=qO.current;ou(qO),h._currentValue=i}function fR(h,i,s){for(;h!==null;){var a=h.alternate;if((h.childLanes&i)!==i?(h.childLanes|=i,a!==null&&(a.childLanes|=i)):a!==null&&(a.childLanes&i)!==i&&(a.childLanes|=i),h===s)break;h=h.return}}function t_(h,i){$O=h,d5=q2=null,h=h.dependencies,h!==null&&h.firstContext!==null&&(h.lanes&i&&(Fp=!0),h.firstContext=null)}function Xg(h){var i=h._currentValue;if(d5!==h)if(h={context:h,memoizedValue:i,next:null},q2===null){if($O===null)throw Error(li(308));q2=h,$O.dependencies={lanes:0,firstContext:h}}else q2=q2.next=h;return i}var iw=null;function m5(h){iw===null?iw=[h]:iw.push(h)}function pG(h,i,s,a){var r=i.interleaved;return r===null?(s.next=s,m5(i)):(s.next=r.next,r.next=s),i.interleaved=s,P1(h,a)}function P1(h,i){h.lanes|=i;var s=h.alternate;for(s!==null&&(s.lanes|=i),s=h,h=h.return;h!==null;)h.childLanes|=i,s=h.alternate,s!==null&&(s.childLanes|=i),s=h,h=h.return;return s.tag===3?s.stateNode:null}var Pb=!1;function g5(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function mG(h,i){h=h.updateQueue,i.updateQueue===h&&(i.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,effects:h.effects})}function N1(h,i){return{eventTime:h,lane:i,tag:0,payload:null,callback:null,next:null}}function Gb(h,i,s){var a=h.updateQueue;if(a===null)return null;if(a=a.shared,Pa&2){var r=a.pending;return r===null?i.next=i:(i.next=r.next,r.next=i),a.pending=i,P1(h,s)}return r=a.interleaved,r===null?(i.next=i,m5(a)):(i.next=r.next,r.next=i),a.interleaved=i,P1(h,s)}function SO(h,i,s){if(i=i.updateQueue,i!==null&&(i=i.shared,(s&4194240)!==0)){var a=i.lanes;a&=h.pendingLanes,s|=a,i.lanes=s,t5(h,s)}}function XU(h,i){var s=h.updateQueue,a=h.alternate;if(a!==null&&(a=a.updateQueue,s===a)){var r=null,c=null;if(s=s.firstBaseUpdate,s!==null){do{var S={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};c===null?r=c=S:c=c.next=S,s=s.next}while(s!==null);c===null?r=c=i:c=c.next=i}else r=c=i;s={baseState:a.baseState,firstBaseUpdate:r,lastBaseUpdate:c,shared:a.shared,effects:a.effects},h.updateQueue=s;return}h=s.lastBaseUpdate,h===null?s.firstBaseUpdate=i:h.next=i,s.lastBaseUpdate=i}function XO(h,i,s,a){var r=h.updateQueue;Pb=!1;var c=r.firstBaseUpdate,S=r.lastBaseUpdate,E=r.shared.pending;if(E!==null){r.shared.pending=null;var A=E,U=A.next;A.next=null,S===null?c=U:S.next=U,S=A;var B=h.alternate;B!==null&&(B=B.updateQueue,E=B.lastBaseUpdate,E!==S&&(E===null?B.firstBaseUpdate=U:E.next=U,B.lastBaseUpdate=A))}if(c!==null){var D=r.baseState;S=0,B=U=A=null,E=c;do{var R=E.lane,W=E.eventTime;if((a&R)===R){B!==null&&(B=B.next={eventTime:W,lane:0,tag:E.tag,payload:E.payload,callback:E.callback,next:null});e:{var j=h,H=E;switch(R=i,W=s,H.tag){case 1:if(j=H.payload,typeof j=="function"){D=j.call(W,D,R);break e}D=j;break e;case 3:j.flags=j.flags&-65537|128;case 0:if(j=H.payload,R=typeof j=="function"?j.call(W,D,R):j,R==null)break e;D=Nu({},D,R);break e;case 2:Pb=!0}}E.callback!==null&&E.lane!==0&&(h.flags|=64,R=r.effects,R===null?r.effects=[E]:R.push(E))}else W={eventTime:W,lane:R,tag:E.tag,payload:E.payload,callback:E.callback,next:null},B===null?(U=B=W,A=D):B=B.next=W,S|=R;if(E=E.next,E===null){if(E=r.shared.pending,E===null)break;R=E,E=R.next,R.next=null,r.lastBaseUpdate=R,r.shared.pending=null}}while(1);if(B===null&&(A=D),r.baseState=A,r.firstBaseUpdate=U,r.lastBaseUpdate=B,i=r.shared.interleaved,i!==null){r=i;do S|=r.lane,r=r.next;while(r!==i)}else c===null&&(r.shared.lanes=0);mw|=S,h.lanes=S,h.memoizedState=D}}function KU(h,i,s){if(h=i.effects,i.effects=null,h!==null)for(i=0;i<h.length;i++){var a=h[i],r=a.callback;if(r!==null){if(a.callback=null,a=s,typeof r!="function")throw Error(li(191,r));r.call(a)}}}var gG=new pH.Component().refs;function dR(h,i,s,a){i=h.memoizedState,s=s(a,i),s=s==null?i:Nu({},i,s),h.memoizedState=s,h.lanes===0&&(h.updateQueue.baseState=s)}var mT={isMounted:function(h){return(h=h._reactInternals)?Ew(h)===h:!1},enqueueSetState:function(h,i,s){h=h._reactInternals;var a=_h(),r=$b(h),c=N1(a,r);c.payload=i,s!=null&&(c.callback=s),i=Gb(h,c,r),i!==null&&(iv(i,h,r,a),SO(i,h,r))},enqueueReplaceState:function(h,i,s){h=h._reactInternals;var a=_h(),r=$b(h),c=N1(a,r);c.tag=1,c.payload=i,s!=null&&(c.callback=s),i=Gb(h,c,r),i!==null&&(iv(i,h,r,a),SO(i,h,r))},enqueueForceUpdate:function(h,i){h=h._reactInternals;var s=_h(),a=$b(h),r=N1(s,a);r.tag=2,i!=null&&(r.callback=i),i=Gb(h,r,a),i!==null&&(iv(i,h,a,s),SO(i,h,a))}};function YU(h,i,s,a,r,c,S){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(a,c,S):i.prototype&&i.prototype.isPureReactComponent?!JS(s,a)||!JS(r,c):!0}function vG(h,i,s){var a=!1,r=Jb,c=i.contextType;return typeof c=="object"&&c!==null?c=Xg(c):(r=Lp(i)?dw:fd.current,a=i.contextTypes,c=(a=a!=null)?a_(h,r):Jb),i=new i(s,c),h.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=mT,h.stateNode=i,i._reactInternals=h,a&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=r,h.__reactInternalMemoizedMaskedChildContext=c),i}function JU(h,i,s,a){h=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(s,a),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(s,a),i.state!==h&&mT.enqueueReplaceState(i,i.state,null)}function hR(h,i,s,a){var r=h.stateNode;r.props=s,r.state=h.memoizedState,r.refs=gG,g5(h);var c=i.contextType;typeof c=="object"&&c!==null?r.context=Xg(c):(c=Lp(i)?dw:fd.current,r.context=a_(h,c)),r.state=h.memoizedState,c=i.getDerivedStateFromProps,typeof c=="function"&&(dR(h,i,c,s),r.state=h.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(i=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),i!==r.state&&mT.enqueueReplaceState(r,r.state,null),XO(h,s,r,a),r.state=h.memoizedState),typeof r.componentDidMount=="function"&&(h.flags|=4194308)}function dS(h,i,s){if(h=s.ref,h!==null&&typeof h!="function"&&typeof h!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(li(309));var a=s.stateNode}if(!a)throw Error(li(147,h));var r=a,c=""+h;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===c?i.ref:(i=function(S){var E=r.refs;E===gG&&(E=r.refs={}),S===null?delete E[c]:E[c]=S},i._stringRef=c,i)}if(typeof h!="string")throw Error(li(284));if(!s._owner)throw Error(li(290,h))}return h}function HA(h,i){throw h=Object.prototype.toString.call(i),Error(li(31,h==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":h))}function QU(h){var i=h._init;return i(h._payload)}function yG(h){function i(Q,Y){if(h){var q=Q.deletions;q===null?(Q.deletions=[Y],Q.flags|=16):q.push(Y)}}function s(Q,Y){if(!h)return null;for(;Y!==null;)i(Q,Y),Y=Y.sibling;return null}function a(Q,Y){for(Q=new Map;Y!==null;)Y.key!==null?Q.set(Y.key,Y):Q.set(Y.index,Y),Y=Y.sibling;return Q}function r(Q,Y){return Q=Xb(Q,Y),Q.index=0,Q.sibling=null,Q}function c(Q,Y,q){return Q.index=q,h?(q=Q.alternate,q!==null?(q=q.index,q<Y?(Q.flags|=2,Y):q):(Q.flags|=2,Y)):(Q.flags|=1048576,Y)}function S(Q){return h&&Q.alternate===null&&(Q.flags|=2),Q}function E(Q,Y,q,ae){return Y===null||Y.tag!==6?(Y=qI(q,Q.mode,ae),Y.return=Q,Y):(Y=r(Y,q),Y.return=Q,Y)}function A(Q,Y,q,ae){var oe=q.type;return oe===B2?B(Q,Y,q.props.children,ae,q.key):Y!==null&&(Y.elementType===oe||typeof oe=="object"&&oe!==null&&oe.$$typeof===Rb&&QU(oe)===Y.type)?(ae=r(Y,q.props),ae.ref=dS(Q,Y,q),ae.return=Q,ae):(ae=MO(q.type,q.key,q.props,null,Q.mode,ae),ae.ref=dS(Q,Y,q),ae.return=Q,ae)}function U(Q,Y,q,ae){return Y===null||Y.tag!==4||Y.stateNode.containerInfo!==q.containerInfo||Y.stateNode.implementation!==q.implementation?(Y=$I(q,Q.mode,ae),Y.return=Q,Y):(Y=r(Y,q.children||[]),Y.return=Q,Y)}function B(Q,Y,q,ae,oe){return Y===null||Y.tag!==7?(Y=cw(q,Q.mode,ae,oe),Y.return=Q,Y):(Y=r(Y,q),Y.return=Q,Y)}function D(Q,Y,q){if(typeof Y=="string"&&Y!==""||typeof Y=="number")return Y=qI(""+Y,Q.mode,q),Y.return=Q,Y;if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case IA:return q=MO(Y.type,Y.key,Y.props,null,Q.mode,q),q.ref=dS(Q,null,Y),q.return=Q,q;case L2:return Y=$I(Y,Q.mode,q),Y.return=Q,Y;case Rb:var ae=Y._init;return D(Q,ae(Y._payload),q)}if(AS(Y)||sS(Y))return Y=cw(Y,Q.mode,q,null),Y.return=Q,Y;HA(Q,Y)}return null}function R(Q,Y,q,ae){var oe=Y!==null?Y.key:null;if(typeof q=="string"&&q!==""||typeof q=="number")return oe!==null?null:E(Q,Y,""+q,ae);if(typeof q=="object"&&q!==null){switch(q.$$typeof){case IA:return q.key===oe?A(Q,Y,q,ae):null;case L2:return q.key===oe?U(Q,Y,q,ae):null;case Rb:return oe=q._init,R(Q,Y,oe(q._payload),ae)}if(AS(q)||sS(q))return oe!==null?null:B(Q,Y,q,ae,null);HA(Q,q)}return null}function W(Q,Y,q,ae,oe){if(typeof ae=="string"&&ae!==""||typeof ae=="number")return Q=Q.get(q)||null,E(Y,Q,""+ae,oe);if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case IA:return Q=Q.get(ae.key===null?q:ae.key)||null,A(Y,Q,ae,oe);case L2:return Q=Q.get(ae.key===null?q:ae.key)||null,U(Y,Q,ae,oe);case Rb:var ye=ae._init;return W(Q,Y,q,ye(ae._payload),oe)}if(AS(ae)||sS(ae))return Q=Q.get(q)||null,B(Y,Q,ae,oe,null);HA(Y,ae)}return null}function j(Q,Y,q,ae){for(var oe=null,ye=null,_e=Y,pe=Y=0,me=null;_e!==null&&pe<q.length;pe++){_e.index>pe?(me=_e,_e=null):me=_e.sibling;var Ge=R(Q,_e,q[pe],ae);if(Ge===null){_e===null&&(_e=me);break}h&&_e&&Ge.alternate===null&&i(Q,_e),Y=c(Ge,Y,pe),ye===null?oe=Ge:ye.sibling=Ge,ye=Ge,_e=me}if(pe===q.length)return s(Q,_e),xu&&Qx(Q,pe),oe;if(_e===null){for(;pe<q.length;pe++)_e=D(Q,q[pe],ae),_e!==null&&(Y=c(_e,Y,pe),ye===null?oe=_e:ye.sibling=_e,ye=_e);return xu&&Qx(Q,pe),oe}for(_e=a(Q,_e);pe<q.length;pe++)me=W(_e,Q,pe,q[pe],ae),me!==null&&(h&&me.alternate!==null&&_e.delete(me.key===null?pe:me.key),Y=c(me,Y,pe),ye===null?oe=me:ye.sibling=me,ye=me);return h&&_e.forEach(function(lt){return i(Q,lt)}),xu&&Qx(Q,pe),oe}function H(Q,Y,q,ae){var oe=sS(q);if(typeof oe!="function")throw Error(li(150));if(q=oe.call(q),q==null)throw Error(li(151));for(var ye=oe=null,_e=Y,pe=Y=0,me=null,Ge=q.next();_e!==null&&!Ge.done;pe++,Ge=q.next()){_e.index>pe?(me=_e,_e=null):me=_e.sibling;var lt=R(Q,_e,Ge.value,ae);if(lt===null){_e===null&&(_e=me);break}h&&_e&&lt.alternate===null&&i(Q,_e),Y=c(lt,Y,pe),ye===null?oe=lt:ye.sibling=lt,ye=lt,_e=me}if(Ge.done)return s(Q,_e),xu&&Qx(Q,pe),oe;if(_e===null){for(;!Ge.done;pe++,Ge=q.next())Ge=D(Q,Ge.value,ae),Ge!==null&&(Y=c(Ge,Y,pe),ye===null?oe=Ge:ye.sibling=Ge,ye=Ge);return xu&&Qx(Q,pe),oe}for(_e=a(Q,_e);!Ge.done;pe++,Ge=q.next())Ge=W(_e,Q,pe,Ge.value,ae),Ge!==null&&(h&&Ge.alternate!==null&&_e.delete(Ge.key===null?pe:Ge.key),Y=c(Ge,Y,pe),ye===null?oe=Ge:ye.sibling=Ge,ye=Ge);return h&&_e.forEach(function(It){return i(Q,It)}),xu&&Qx(Q,pe),oe}function I(Q,Y,q,ae){if(typeof q=="object"&&q!==null&&q.type===B2&&q.key===null&&(q=q.props.children),typeof q=="object"&&q!==null){switch(q.$$typeof){case IA:e:{for(var oe=q.key,ye=Y;ye!==null;){if(ye.key===oe){if(oe=q.type,oe===B2){if(ye.tag===7){s(Q,ye.sibling),Y=r(ye,q.props.children),Y.return=Q,Q=Y;break e}}else if(ye.elementType===oe||typeof oe=="object"&&oe!==null&&oe.$$typeof===Rb&&QU(oe)===ye.type){s(Q,ye.sibling),Y=r(ye,q.props),Y.ref=dS(Q,ye,q),Y.return=Q,Q=Y;break e}s(Q,ye);break}else i(Q,ye);ye=ye.sibling}q.type===B2?(Y=cw(q.props.children,Q.mode,ae,q.key),Y.return=Q,Q=Y):(ae=MO(q.type,q.key,q.props,null,Q.mode,ae),ae.ref=dS(Q,Y,q),ae.return=Q,Q=ae)}return S(Q);case L2:e:{for(ye=q.key;Y!==null;){if(Y.key===ye)if(Y.tag===4&&Y.stateNode.containerInfo===q.containerInfo&&Y.stateNode.implementation===q.implementation){s(Q,Y.sibling),Y=r(Y,q.children||[]),Y.return=Q,Q=Y;break e}else{s(Q,Y);break}else i(Q,Y);Y=Y.sibling}Y=$I(q,Q.mode,ae),Y.return=Q,Q=Y}return S(Q);case Rb:return ye=q._init,I(Q,Y,ye(q._payload),ae)}if(AS(q))return j(Q,Y,q,ae);if(sS(q))return H(Q,Y,q,ae);HA(Q,q)}return typeof q=="string"&&q!==""||typeof q=="number"?(q=""+q,Y!==null&&Y.tag===6?(s(Q,Y.sibling),Y=r(Y,q),Y.return=Q,Q=Y):(s(Q,Y),Y=qI(q,Q.mode,ae),Y.return=Q,Q=Y),S(Q)):s(Q,Y)}return I}var u_=yG(!0),bG=yG(!1),mC={},Ty=tx(mC),tC=tx(mC),nC=tx(mC);function ow(h){if(h===mC)throw Error(li(174));return h}function v5(h,i){switch($s(nC,i),$s(tC,h),$s(Ty,mC),h=i.nodeType,h){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:GF(null,"");break;default:h=h===8?i.parentNode:i,i=h.namespaceURI||null,h=h.tagName,i=GF(i,h)}ou(Ty),$s(Ty,i)}function c_(){ou(Ty),ou(tC),ou(nC)}function xG(h){ow(nC.current);var i=ow(Ty.current),s=GF(i,h.type);i!==s&&($s(tC,h),$s(Ty,s))}function y5(h){tC.current===h&&(ou(Ty),ou(tC))}var Mu=tx(0);function KO(h){for(var i=h;i!==null;){if(i.tag===13){var s=i.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if(i.flags&128)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===h)break;for(;i.sibling===null;){if(i.return===null||i.return===h)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var zI=[];function b5(){for(var h=0;h<zI.length;h++)zI[h]._workInProgressVersionPrimary=null;zI.length=0}var CO=B1.ReactCurrentDispatcher,UI=B1.ReactCurrentBatchConfig,pw=0,Du=null,Yc=null,Cl=null,YO=!1,BS=!1,rC=0,Wse=0;function ad(){throw Error(li(321))}function x5(h,i){if(i===null)return!1;for(var s=0;s<i.length&&s<h.length;s++)if(!ov(h[s],i[s]))return!1;return!0}function w5(h,i,s,a,r,c){if(pw=c,Du=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,CO.current=h===null||h.memoizedState===null?qse:$se,h=s(a,r),BS){c=0;do{if(BS=!1,rC=0,25<=c)throw Error(li(301));c+=1,Cl=Yc=null,i.updateQueue=null,CO.current=Xse,h=s(a,r)}while(BS)}if(CO.current=JO,i=Yc!==null&&Yc.next!==null,pw=0,Cl=Yc=Du=null,YO=!1,i)throw Error(li(300));return h}function _5(){var h=rC!==0;return rC=0,h}function Ey(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Cl===null?Du.memoizedState=Cl=h:Cl=Cl.next=h,Cl}function Kg(){if(Yc===null){var h=Du.alternate;h=h!==null?h.memoizedState:null}else h=Yc.next;var i=Cl===null?Du.memoizedState:Cl.next;if(i!==null)Cl=i,Yc=h;else{if(h===null)throw Error(li(310));Yc=h,h={memoizedState:Yc.memoizedState,baseState:Yc.baseState,baseQueue:Yc.baseQueue,queue:Yc.queue,next:null},Cl===null?Du.memoizedState=Cl=h:Cl=Cl.next=h}return Cl}function iC(h,i){return typeof i=="function"?i(h):i}function WI(h){var i=Kg(),s=i.queue;if(s===null)throw Error(li(311));s.lastRenderedReducer=h;var a=Yc,r=a.baseQueue,c=s.pending;if(c!==null){if(r!==null){var S=r.next;r.next=c.next,c.next=S}a.baseQueue=r=c,s.pending=null}if(r!==null){c=r.next,a=a.baseState;var E=S=null,A=null,U=c;do{var B=U.lane;if((pw&B)===B)A!==null&&(A=A.next={lane:0,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null}),a=U.hasEagerState?U.eagerState:h(a,U.action);else{var D={lane:B,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null};A===null?(E=A=D,S=a):A=A.next=D,Du.lanes|=B,mw|=B}U=U.next}while(U!==null&&U!==c);A===null?S=a:A.next=E,ov(a,i.memoizedState)||(Fp=!0),i.memoizedState=a,i.baseState=S,i.baseQueue=A,s.lastRenderedState=a}if(h=s.interleaved,h!==null){r=h;do c=r.lane,Du.lanes|=c,mw|=c,r=r.next;while(r!==h)}else r===null&&(s.lanes=0);return[i.memoizedState,s.dispatch]}function VI(h){var i=Kg(),s=i.queue;if(s===null)throw Error(li(311));s.lastRenderedReducer=h;var a=s.dispatch,r=s.pending,c=i.memoizedState;if(r!==null){s.pending=null;var S=r=r.next;do c=h(c,S.action),S=S.next;while(S!==r);ov(c,i.memoizedState)||(Fp=!0),i.memoizedState=c,i.baseQueue===null&&(i.baseState=c),s.lastRenderedState=c}return[c,a]}function wG(){}function _G(h,i){var s=Du,a=Kg(),r=i(),c=!ov(a.memoizedState,r);if(c&&(a.memoizedState=r,Fp=!0),a=a.queue,E5(CG.bind(null,s,a,h),[h]),a.getSnapshot!==i||c||Cl!==null&&Cl.memoizedState.tag&1){if(s.flags|=2048,oC(9,SG.bind(null,s,a,r,i),void 0,null),Al===null)throw Error(li(349));pw&30||EG(s,i,r)}return r}function EG(h,i,s){h.flags|=16384,h={getSnapshot:i,value:s},i=Du.updateQueue,i===null?(i={lastEffect:null,stores:null},Du.updateQueue=i,i.stores=[h]):(s=i.stores,s===null?i.stores=[h]:s.push(h))}function SG(h,i,s,a){i.value=s,i.getSnapshot=a,kG(i)&&AG(h)}function CG(h,i,s){return s(function(){kG(i)&&AG(h)})}function kG(h){var i=h.getSnapshot;h=h.value;try{var s=i();return!ov(h,s)}catch{return!0}}function AG(h){var i=P1(h,1);i!==null&&iv(i,h,1,-1)}function ZU(h){var i=Ey();return typeof h=="function"&&(h=h()),i.memoizedState=i.baseState=h,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:iC,lastRenderedState:h},i.queue=h,h=h.dispatch=Gse.bind(null,Du,h),[i.memoizedState,h]}function oC(h,i,s,a){return h={tag:h,create:i,destroy:s,deps:a,next:null},i=Du.updateQueue,i===null?(i={lastEffect:null,stores:null},Du.updateQueue=i,i.lastEffect=h.next=h):(s=i.lastEffect,s===null?i.lastEffect=h.next=h:(a=s.next,s.next=h,h.next=a,i.lastEffect=h)),h}function OG(){return Kg().memoizedState}function kO(h,i,s,a){var r=Ey();Du.flags|=h,r.memoizedState=oC(1|i,s,void 0,a===void 0?null:a)}function gT(h,i,s,a){var r=Kg();a=a===void 0?null:a;var c=void 0;if(Yc!==null){var S=Yc.memoizedState;if(c=S.destroy,a!==null&&x5(a,S.deps)){r.memoizedState=oC(i,s,c,a);return}}Du.flags|=h,r.memoizedState=oC(1|i,s,c,a)}function eW(h,i){return kO(8390656,8,h,i)}function E5(h,i){return gT(2048,8,h,i)}function TG(h,i){return gT(4,2,h,i)}function MG(h,i){return gT(4,4,h,i)}function DG(h,i){if(typeof i=="function")return h=h(),i(h),function(){i(null)};if(i!=null)return h=h(),i.current=h,function(){i.current=null}}function NG(h,i,s){return s=s!=null?s.concat([h]):null,gT(4,4,DG.bind(null,i,h),s)}function S5(){}function IG(h,i){var s=Kg();i=i===void 0?null:i;var a=s.memoizedState;return a!==null&&i!==null&&x5(i,a[1])?a[0]:(s.memoizedState=[h,i],h)}function FG(h,i){var s=Kg();i=i===void 0?null:i;var a=s.memoizedState;return a!==null&&i!==null&&x5(i,a[1])?a[0]:(h=h(),s.memoizedState=[h,i],h)}function RG(h,i,s){return pw&21?(ov(s,i)||(s=BH(),Du.lanes|=s,mw|=s,h.baseState=!0),i):(h.baseState&&(h.baseState=!1,Fp=!0),h.memoizedState=s)}function Vse(h,i){var s=fs;fs=s!==0&&4>s?s:4,h(!0);var a=UI.transition;UI.transition={};try{h(!1),i()}finally{fs=s,UI.transition=a}}function PG(){return Kg().memoizedState}function Hse(h,i,s){var a=$b(h);if(s={lane:a,action:s,hasEagerState:!1,eagerState:null,next:null},LG(h))BG(i,s);else if(s=pG(h,i,s,a),s!==null){var r=_h();iv(s,h,a,r),jG(s,i,a)}}function Gse(h,i,s){var a=$b(h),r={lane:a,action:s,hasEagerState:!1,eagerState:null,next:null};if(LG(h))BG(i,r);else{var c=h.alternate;if(h.lanes===0&&(c===null||c.lanes===0)&&(c=i.lastRenderedReducer,c!==null))try{var S=i.lastRenderedState,E=c(S,s);if(r.hasEagerState=!0,r.eagerState=E,ov(E,S)){var A=i.interleaved;A===null?(r.next=r,m5(i)):(r.next=A.next,A.next=r),i.interleaved=r;return}}catch{}finally{}s=pG(h,i,r,a),s!==null&&(r=_h(),iv(s,h,a,r),jG(s,i,a))}}function LG(h){var i=h.alternate;return h===Du||i!==null&&i===Du}function BG(h,i){BS=YO=!0;var s=h.pending;s===null?i.next=i:(i.next=s.next,s.next=i),h.pending=i}function jG(h,i,s){if(s&4194240){var a=i.lanes;a&=h.pendingLanes,s|=a,i.lanes=s,t5(h,s)}}var JO={readContext:Xg,useCallback:ad,useContext:ad,useEffect:ad,useImperativeHandle:ad,useInsertionEffect:ad,useLayoutEffect:ad,useMemo:ad,useReducer:ad,useRef:ad,useState:ad,useDebugValue:ad,useDeferredValue:ad,useTransition:ad,useMutableSource:ad,useSyncExternalStore:ad,useId:ad,unstable_isNewReconciler:!1},qse={readContext:Xg,useCallback:function(h,i){return Ey().memoizedState=[h,i===void 0?null:i],h},useContext:Xg,useEffect:eW,useImperativeHandle:function(h,i,s){return s=s!=null?s.concat([h]):null,kO(4194308,4,DG.bind(null,i,h),s)},useLayoutEffect:function(h,i){return kO(4194308,4,h,i)},useInsertionEffect:function(h,i){return kO(4,2,h,i)},useMemo:function(h,i){var s=Ey();return i=i===void 0?null:i,h=h(),s.memoizedState=[h,i],h},useReducer:function(h,i,s){var a=Ey();return i=s!==void 0?s(i):i,a.memoizedState=a.baseState=i,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:i},a.queue=h,h=h.dispatch=Hse.bind(null,Du,h),[a.memoizedState,h]},useRef:function(h){var i=Ey();return h={current:h},i.memoizedState=h},useState:ZU,useDebugValue:S5,useDeferredValue:function(h){return Ey().memoizedState=h},useTransition:function(){var h=ZU(!1),i=h[0];return h=Vse.bind(null,h[1]),Ey().memoizedState=h,[i,h]},useMutableSource:function(){},useSyncExternalStore:function(h,i,s){var a=Du,r=Ey();if(xu){if(s===void 0)throw Error(li(407));s=s()}else{if(s=i(),Al===null)throw Error(li(349));pw&30||EG(a,i,s)}r.memoizedState=s;var c={value:s,getSnapshot:i};return r.queue=c,eW(CG.bind(null,a,c,h),[h]),a.flags|=2048,oC(9,SG.bind(null,a,c,s,i),void 0,null),s},useId:function(){var h=Ey(),i=Al.identifierPrefix;if(xu){var s=D1,a=M1;s=(a&~(1<<32-rv(a)-1)).toString(32)+s,i=":"+i+"R"+s,s=rC++,0<s&&(i+="H"+s.toString(32)),i+=":"}else s=Wse++,i=":"+i+"r"+s.toString(32)+":";return h.memoizedState=i},unstable_isNewReconciler:!1},$se={readContext:Xg,useCallback:IG,useContext:Xg,useEffect:E5,useImperativeHandle:NG,useInsertionEffect:TG,useLayoutEffect:MG,useMemo:FG,useReducer:WI,useRef:OG,useState:function(){return WI(iC)},useDebugValue:S5,useDeferredValue:function(h){var i=Kg();return RG(i,Yc.memoizedState,h)},useTransition:function(){var h=WI(iC)[0],i=Kg().memoizedState;return[h,i]},useMutableSource:wG,useSyncExternalStore:_G,useId:PG,unstable_isNewReconciler:!1},Xse={readContext:Xg,useCallback:IG,useContext:Xg,useEffect:E5,useImperativeHandle:NG,useInsertionEffect:TG,useLayoutEffect:MG,useMemo:FG,useReducer:VI,useRef:OG,useState:function(){return VI(iC)},useDebugValue:S5,useDeferredValue:function(h){var i=Kg();return Yc===null?i.memoizedState=h:RG(i,Yc.memoizedState,h)},useTransition:function(){var h=VI(iC)[0],i=Kg().memoizedState;return[h,i]},useMutableSource:wG,useSyncExternalStore:_G,useId:PG,unstable_isNewReconciler:!1};function l_(h,i){try{var s="",a=i;do s+=_ae(a),a=a.return;while(a);var r=s}catch(c){r=`
Error generating stack: `+c.message+`
`+c.stack}return{value:h,source:i,stack:r,digest:null}}function HI(h,i,s){return{value:h,source:null,stack:s??null,digest:i??null}}function pR(h,i){try{console.error(i.value)}catch(s){setTimeout(function(){throw s})}}var Kse=typeof WeakMap=="function"?WeakMap:Map;function zG(h,i,s){s=N1(-1,s),s.tag=3,s.payload={element:null};var a=i.value;return s.callback=function(){ZO||(ZO=!0,SR=a),pR(h,i)},s}function UG(h,i,s){s=N1(-1,s),s.tag=3;var a=h.type.getDerivedStateFromError;if(typeof a=="function"){var r=i.value;s.payload=function(){return a(r)},s.callback=function(){pR(h,i)}}var c=h.stateNode;return c!==null&&typeof c.componentDidCatch=="function"&&(s.callback=function(){pR(h,i),typeof a!="function"&&(qb===null?qb=new Set([this]):qb.add(this));var S=i.stack;this.componentDidCatch(i.value,{componentStack:S!==null?S:""})}),s}function tW(h,i,s){var a=h.pingCache;if(a===null){a=h.pingCache=new Kse;var r=new Set;a.set(i,r)}else r=a.get(i),r===void 0&&(r=new Set,a.set(i,r));r.has(s)||(r.add(s),h=cue.bind(null,h,i,s),i.then(h,h))}function nW(h){do{var i;if((i=h.tag===13)&&(i=h.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return h;h=h.return}while(h!==null);return null}function rW(h,i,s,a,r){return h.mode&1?(h.flags|=65536,h.lanes=r,h):(h===i?h.flags|=65536:(h.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(i=N1(-1,1),i.tag=2,Gb(s,i,1))),s.lanes|=1),h)}var Yse=B1.ReactCurrentOwner,Fp=!1;function xh(h,i,s,a){i.child=h===null?bG(i,null,s,a):u_(i,h.child,s,a)}function iW(h,i,s,a,r){s=s.render;var c=i.ref;return t_(i,r),a=w5(h,i,s,a,c,r),s=_5(),h!==null&&!Fp?(i.updateQueue=h.updateQueue,i.flags&=-2053,h.lanes&=~r,L1(h,i,r)):(xu&&s&&c5(i),i.flags|=1,xh(h,i,a,r),i.child)}function oW(h,i,s,a,r){if(h===null){var c=s.type;return typeof c=="function"&&!N5(c)&&c.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(i.tag=15,i.type=c,WG(h,i,c,a,r)):(h=MO(s.type,null,a,i,i.mode,r),h.ref=i.ref,h.return=i,i.child=h)}if(c=h.child,!(h.lanes&r)){var S=c.memoizedProps;if(s=s.compare,s=s!==null?s:JS,s(S,a)&&h.ref===i.ref)return L1(h,i,r)}return i.flags|=1,h=Xb(c,a),h.ref=i.ref,h.return=i,i.child=h}function WG(h,i,s,a,r){if(h!==null){var c=h.memoizedProps;if(JS(c,a)&&h.ref===i.ref)if(Fp=!1,i.pendingProps=a=c,(h.lanes&r)!==0)h.flags&131072&&(Fp=!0);else return i.lanes=h.lanes,L1(h,i,r)}return mR(h,i,s,a,r)}function VG(h,i,s){var a=i.pendingProps,r=a.children,c=h!==null?h.memoizedState:null;if(a.mode==="hidden")if(!(i.mode&1))i.memoizedState={baseLanes:0,cachePool:null,transitions:null},$s(X2,Gm),Gm|=s;else{if(!(s&1073741824))return h=c!==null?c.baseLanes|s:s,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:h,cachePool:null,transitions:null},i.updateQueue=null,$s(X2,Gm),Gm|=h,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},a=c!==null?c.baseLanes:s,$s(X2,Gm),Gm|=a}else c!==null?(a=c.baseLanes|s,i.memoizedState=null):a=s,$s(X2,Gm),Gm|=a;return xh(h,i,r,s),i.child}function HG(h,i){var s=i.ref;(h===null&&s!==null||h!==null&&h.ref!==s)&&(i.flags|=512,i.flags|=2097152)}function mR(h,i,s,a,r){var c=Lp(s)?dw:fd.current;return c=a_(i,c),t_(i,r),s=w5(h,i,s,a,c,r),a=_5(),h!==null&&!Fp?(i.updateQueue=h.updateQueue,i.flags&=-2053,h.lanes&=~r,L1(h,i,r)):(xu&&a&&c5(i),i.flags|=1,xh(h,i,s,r),i.child)}function aW(h,i,s,a,r){if(Lp(s)){var c=!0;VO(i)}else c=!1;if(t_(i,r),i.stateNode===null)AO(h,i),vG(i,s,a),hR(i,s,a,r),a=!0;else if(h===null){var S=i.stateNode,E=i.memoizedProps;S.props=E;var A=S.context,U=s.contextType;typeof U=="object"&&U!==null?U=Xg(U):(U=Lp(s)?dw:fd.current,U=a_(i,U));var B=s.getDerivedStateFromProps,D=typeof B=="function"||typeof S.getSnapshotBeforeUpdate=="function";D||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(E!==a||A!==U)&&JU(i,S,a,U),Pb=!1;var R=i.memoizedState;S.state=R,XO(i,a,S,r),A=i.memoizedState,E!==a||R!==A||Pp.current||Pb?(typeof B=="function"&&(dR(i,s,B,a),A=i.memoizedState),(E=Pb||YU(i,s,E,a,R,A,U))?(D||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(i.flags|=4194308)):(typeof S.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=a,i.memoizedState=A),S.props=a,S.state=A,S.context=U,a=E):(typeof S.componentDidMount=="function"&&(i.flags|=4194308),a=!1)}else{S=i.stateNode,mG(h,i),E=i.memoizedProps,U=i.type===i.elementType?E:Q0(i.type,E),S.props=U,D=i.pendingProps,R=S.context,A=s.contextType,typeof A=="object"&&A!==null?A=Xg(A):(A=Lp(s)?dw:fd.current,A=a_(i,A));var W=s.getDerivedStateFromProps;(B=typeof W=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(E!==D||R!==A)&&JU(i,S,a,A),Pb=!1,R=i.memoizedState,S.state=R,XO(i,a,S,r);var j=i.memoizedState;E!==D||R!==j||Pp.current||Pb?(typeof W=="function"&&(dR(i,s,W,a),j=i.memoizedState),(U=Pb||YU(i,s,U,a,R,j,A)||!1)?(B||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(a,j,A),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(a,j,A)),typeof S.componentDidUpdate=="function"&&(i.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof S.componentDidUpdate!="function"||E===h.memoizedProps&&R===h.memoizedState||(i.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||E===h.memoizedProps&&R===h.memoizedState||(i.flags|=1024),i.memoizedProps=a,i.memoizedState=j),S.props=a,S.state=j,S.context=A,a=U):(typeof S.componentDidUpdate!="function"||E===h.memoizedProps&&R===h.memoizedState||(i.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||E===h.memoizedProps&&R===h.memoizedState||(i.flags|=1024),a=!1)}return gR(h,i,s,a,c,r)}function gR(h,i,s,a,r,c){HG(h,i);var S=(i.flags&128)!==0;if(!a&&!S)return r&&GU(i,s,!1),L1(h,i,c);a=i.stateNode,Yse.current=i;var E=S&&typeof s.getDerivedStateFromError!="function"?null:a.render();return i.flags|=1,h!==null&&S?(i.child=u_(i,h.child,null,c),i.child=u_(i,null,E,c)):xh(h,i,E,c),i.memoizedState=a.state,r&&GU(i,s,!0),i.child}function GG(h){var i=h.stateNode;i.pendingContext?HU(h,i.pendingContext,i.pendingContext!==i.context):i.context&&HU(h,i.context,!1),v5(h,i.containerInfo)}function sW(h,i,s,a,r){return s_(),f5(r),i.flags|=256,xh(h,i,s,a),i.child}var vR={dehydrated:null,treeContext:null,retryLane:0};function yR(h){return{baseLanes:h,cachePool:null,transitions:null}}function qG(h,i,s){var a=i.pendingProps,r=Mu.current,c=!1,S=(i.flags&128)!==0,E;if((E=S)||(E=h!==null&&h.memoizedState===null?!1:(r&2)!==0),E?(c=!0,i.flags&=-129):(h===null||h.memoizedState!==null)&&(r|=1),$s(Mu,r&1),h===null)return lR(i),h=i.memoizedState,h!==null&&(h=h.dehydrated,h!==null)?(i.mode&1?h.data==="$!"?i.lanes=8:i.lanes=1073741824:i.lanes=1,null):(S=a.children,h=a.fallback,c?(a=i.mode,c=i.child,S={mode:"hidden",children:S},!(a&1)&&c!==null?(c.childLanes=0,c.pendingProps=S):c=bT(S,a,0,null),h=cw(h,a,s,null),c.return=i,h.return=i,c.sibling=h,i.child=c,i.child.memoizedState=yR(s),i.memoizedState=vR,h):C5(i,S));if(r=h.memoizedState,r!==null&&(E=r.dehydrated,E!==null))return Jse(h,i,S,a,E,r,s);if(c){c=a.fallback,S=i.mode,r=h.child,E=r.sibling;var A={mode:"hidden",children:a.children};return!(S&1)&&i.child!==r?(a=i.child,a.childLanes=0,a.pendingProps=A,i.deletions=null):(a=Xb(r,A),a.subtreeFlags=r.subtreeFlags&14680064),E!==null?c=Xb(E,c):(c=cw(c,S,s,null),c.flags|=2),c.return=i,a.return=i,a.sibling=c,i.child=a,a=c,c=i.child,S=h.child.memoizedState,S=S===null?yR(s):{baseLanes:S.baseLanes|s,cachePool:null,transitions:S.transitions},c.memoizedState=S,c.childLanes=h.childLanes&~s,i.memoizedState=vR,a}return c=h.child,h=c.sibling,a=Xb(c,{mode:"visible",children:a.children}),!(i.mode&1)&&(a.lanes=s),a.return=i,a.sibling=null,h!==null&&(s=i.deletions,s===null?(i.deletions=[h],i.flags|=16):s.push(h)),i.child=a,i.memoizedState=null,a}function C5(h,i){return i=bT({mode:"visible",children:i},h.mode,0,null),i.return=h,h.child=i}function GA(h,i,s,a){return a!==null&&f5(a),u_(i,h.child,null,s),h=C5(i,i.pendingProps.children),h.flags|=2,i.memoizedState=null,h}function Jse(h,i,s,a,r,c,S){if(s)return i.flags&256?(i.flags&=-257,a=HI(Error(li(422))),GA(h,i,S,a)):i.memoizedState!==null?(i.child=h.child,i.flags|=128,null):(c=a.fallback,r=i.mode,a=bT({mode:"visible",children:a.children},r,0,null),c=cw(c,r,S,null),c.flags|=2,a.return=i,c.return=i,a.sibling=c,i.child=a,i.mode&1&&u_(i,h.child,null,S),i.child.memoizedState=yR(S),i.memoizedState=vR,c);if(!(i.mode&1))return GA(h,i,S,null);if(r.data==="$!"){if(a=r.nextSibling&&r.nextSibling.dataset,a)var E=a.dgst;return a=E,c=Error(li(419)),a=HI(c,a,void 0),GA(h,i,S,a)}if(E=(S&h.childLanes)!==0,Fp||E){if(a=Al,a!==null){switch(S&-S){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(a.suspendedLanes|S)?0:r,r!==0&&r!==c.retryLane&&(c.retryLane=r,P1(h,r),iv(a,h,r,-1))}return D5(),a=HI(Error(li(421))),GA(h,i,S,a)}return r.data==="$?"?(i.flags|=128,i.child=h.child,i=lue.bind(null,h),r._reactRetry=i,null):(h=c.treeContext,qm=Hb(r.nextSibling),Xm=i,xu=!0,ev=null,h!==null&&(Wg[Vg++]=M1,Wg[Vg++]=D1,Wg[Vg++]=hw,M1=h.id,D1=h.overflow,hw=i),i=C5(i,a.children),i.flags|=4096,i)}function uW(h,i,s){h.lanes|=i;var a=h.alternate;a!==null&&(a.lanes|=i),fR(h.return,i,s)}function GI(h,i,s,a,r){var c=h.memoizedState;c===null?h.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:a,tail:s,tailMode:r}:(c.isBackwards=i,c.rendering=null,c.renderingStartTime=0,c.last=a,c.tail=s,c.tailMode=r)}function $G(h,i,s){var a=i.pendingProps,r=a.revealOrder,c=a.tail;if(xh(h,i,a.children,s),a=Mu.current,a&2)a=a&1|2,i.flags|=128;else{if(h!==null&&h.flags&128)e:for(h=i.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&uW(h,s,i);else if(h.tag===19)uW(h,s,i);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===i)break e;for(;h.sibling===null;){if(h.return===null||h.return===i)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}a&=1}if($s(Mu,a),!(i.mode&1))i.memoizedState=null;else switch(r){case"forwards":for(s=i.child,r=null;s!==null;)h=s.alternate,h!==null&&KO(h)===null&&(r=s),s=s.sibling;s=r,s===null?(r=i.child,i.child=null):(r=s.sibling,s.sibling=null),GI(i,!1,r,s,c);break;case"backwards":for(s=null,r=i.child,i.child=null;r!==null;){if(h=r.alternate,h!==null&&KO(h)===null){i.child=r;break}h=r.sibling,r.sibling=s,s=r,r=h}GI(i,!0,s,null,c);break;case"together":GI(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function AO(h,i){!(i.mode&1)&&h!==null&&(h.alternate=null,i.alternate=null,i.flags|=2)}function L1(h,i,s){if(h!==null&&(i.dependencies=h.dependencies),mw|=i.lanes,!(s&i.childLanes))return null;if(h!==null&&i.child!==h.child)throw Error(li(153));if(i.child!==null){for(h=i.child,s=Xb(h,h.pendingProps),i.child=s,s.return=i;h.sibling!==null;)h=h.sibling,s=s.sibling=Xb(h,h.pendingProps),s.return=i;s.sibling=null}return i.child}function Qse(h,i,s){switch(i.tag){case 3:GG(i),s_();break;case 5:xG(i);break;case 1:Lp(i.type)&&VO(i);break;case 4:v5(i,i.stateNode.containerInfo);break;case 10:var a=i.type._context,r=i.memoizedProps.value;$s(qO,a._currentValue),a._currentValue=r;break;case 13:if(a=i.memoizedState,a!==null)return a.dehydrated!==null?($s(Mu,Mu.current&1),i.flags|=128,null):s&i.child.childLanes?qG(h,i,s):($s(Mu,Mu.current&1),h=L1(h,i,s),h!==null?h.sibling:null);$s(Mu,Mu.current&1);break;case 19:if(a=(s&i.childLanes)!==0,h.flags&128){if(a)return $G(h,i,s);i.flags|=128}if(r=i.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),$s(Mu,Mu.current),a)break;return null;case 22:case 23:return i.lanes=0,VG(h,i,s)}return L1(h,i,s)}var XG,bR,KG,YG;XG=function(h,i){for(var s=i.child;s!==null;){if(s.tag===5||s.tag===6)h.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return;s=s.return}s.sibling.return=s.return,s=s.sibling}};bR=function(){};KG=function(h,i,s,a){var r=h.memoizedProps;if(r!==a){h=i.stateNode,ow(Ty.current);var c=null;switch(s){case"input":r=UF(h,r),a=UF(h,a),c=[];break;case"select":r=Nu({},r,{value:void 0}),a=Nu({},a,{value:void 0}),c=[];break;case"textarea":r=HF(h,r),a=HF(h,a),c=[];break;default:typeof r.onClick!="function"&&typeof a.onClick=="function"&&(h.onclick=UO)}qF(s,a);var S;s=null;for(U in r)if(!a.hasOwnProperty(U)&&r.hasOwnProperty(U)&&r[U]!=null)if(U==="style"){var E=r[U];for(S in E)E.hasOwnProperty(S)&&(s||(s={}),s[S]="")}else U!=="dangerouslySetInnerHTML"&&U!=="children"&&U!=="suppressContentEditableWarning"&&U!=="suppressHydrationWarning"&&U!=="autoFocus"&&(HS.hasOwnProperty(U)?c||(c=[]):(c=c||[]).push(U,null));for(U in a){var A=a[U];if(E=r!=null?r[U]:void 0,a.hasOwnProperty(U)&&A!==E&&(A!=null||E!=null))if(U==="style")if(E){for(S in E)!E.hasOwnProperty(S)||A&&A.hasOwnProperty(S)||(s||(s={}),s[S]="");for(S in A)A.hasOwnProperty(S)&&E[S]!==A[S]&&(s||(s={}),s[S]=A[S])}else s||(c||(c=[]),c.push(U,s)),s=A;else U==="dangerouslySetInnerHTML"?(A=A?A.__html:void 0,E=E?E.__html:void 0,A!=null&&E!==A&&(c=c||[]).push(U,A)):U==="children"?typeof A!="string"&&typeof A!="number"||(c=c||[]).push(U,""+A):U!=="suppressContentEditableWarning"&&U!=="suppressHydrationWarning"&&(HS.hasOwnProperty(U)?(A!=null&&U==="onScroll"&&ru("scroll",h),c||E===A||(c=[])):(c=c||[]).push(U,A))}s&&(c=c||[]).push("style",s);var U=c;(i.updateQueue=U)&&(i.flags|=4)}};YG=function(h,i,s,a){s!==a&&(i.flags|=4)};function hS(h,i){if(!xu)switch(h.tailMode){case"hidden":i=h.tail;for(var s=null;i!==null;)i.alternate!==null&&(s=i),i=i.sibling;s===null?h.tail=null:s.sibling=null;break;case"collapsed":s=h.tail;for(var a=null;s!==null;)s.alternate!==null&&(a=s),s=s.sibling;a===null?i||h.tail===null?h.tail=null:h.tail.sibling=null:a.sibling=null}}function sd(h){var i=h.alternate!==null&&h.alternate.child===h.child,s=0,a=0;if(i)for(var r=h.child;r!==null;)s|=r.lanes|r.childLanes,a|=r.subtreeFlags&14680064,a|=r.flags&14680064,r.return=h,r=r.sibling;else for(r=h.child;r!==null;)s|=r.lanes|r.childLanes,a|=r.subtreeFlags,a|=r.flags,r.return=h,r=r.sibling;return h.subtreeFlags|=a,h.childLanes=s,i}function Zse(h,i,s){var a=i.pendingProps;switch(l5(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return sd(i),null;case 1:return Lp(i.type)&&WO(),sd(i),null;case 3:return a=i.stateNode,c_(),ou(Pp),ou(fd),b5(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(h===null||h.child===null)&&(VA(i)?i.flags|=4:h===null||h.memoizedState.isDehydrated&&!(i.flags&256)||(i.flags|=1024,ev!==null&&(AR(ev),ev=null))),bR(h,i),sd(i),null;case 5:y5(i);var r=ow(nC.current);if(s=i.type,h!==null&&i.stateNode!=null)KG(h,i,s,a,r),h.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!a){if(i.stateNode===null)throw Error(li(166));return sd(i),null}if(h=ow(Ty.current),VA(i)){a=i.stateNode,s=i.type;var c=i.memoizedProps;switch(a[ky]=i,a[eC]=c,h=(i.mode&1)!==0,s){case"dialog":ru("cancel",a),ru("close",a);break;case"iframe":case"object":case"embed":ru("load",a);break;case"video":case"audio":for(r=0;r<TS.length;r++)ru(TS[r],a);break;case"source":ru("error",a);break;case"img":case"image":case"link":ru("error",a),ru("load",a);break;case"details":ru("toggle",a);break;case"input":vU(a,c),ru("invalid",a);break;case"select":a._wrapperState={wasMultiple:!!c.multiple},ru("invalid",a);break;case"textarea":bU(a,c),ru("invalid",a)}qF(s,c),r=null;for(var S in c)if(c.hasOwnProperty(S)){var E=c[S];S==="children"?typeof E=="string"?a.textContent!==E&&(c.suppressHydrationWarning!==!0&&WA(a.textContent,E,h),r=["children",E]):typeof E=="number"&&a.textContent!==""+E&&(c.suppressHydrationWarning!==!0&&WA(a.textContent,E,h),r=["children",""+E]):HS.hasOwnProperty(S)&&E!=null&&S==="onScroll"&&ru("scroll",a)}switch(s){case"input":FA(a),yU(a,c,!0);break;case"textarea":FA(a),xU(a);break;case"select":case"option":break;default:typeof c.onClick=="function"&&(a.onclick=UO)}a=r,i.updateQueue=a,a!==null&&(i.flags|=4)}else{S=r.nodeType===9?r:r.ownerDocument,h==="http://www.w3.org/1999/xhtml"&&(h=EH(s)),h==="http://www.w3.org/1999/xhtml"?s==="script"?(h=S.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild)):typeof a.is=="string"?h=S.createElement(s,{is:a.is}):(h=S.createElement(s),s==="select"&&(S=h,a.multiple?S.multiple=!0:a.size&&(S.size=a.size))):h=S.createElementNS(h,s),h[ky]=i,h[eC]=a,XG(h,i,!1,!1),i.stateNode=h;e:{switch(S=$F(s,a),s){case"dialog":ru("cancel",h),ru("close",h),r=a;break;case"iframe":case"object":case"embed":ru("load",h),r=a;break;case"video":case"audio":for(r=0;r<TS.length;r++)ru(TS[r],h);r=a;break;case"source":ru("error",h),r=a;break;case"img":case"image":case"link":ru("error",h),ru("load",h),r=a;break;case"details":ru("toggle",h),r=a;break;case"input":vU(h,a),r=UF(h,a),ru("invalid",h);break;case"option":r=a;break;case"select":h._wrapperState={wasMultiple:!!a.multiple},r=Nu({},a,{value:void 0}),ru("invalid",h);break;case"textarea":bU(h,a),r=HF(h,a),ru("invalid",h);break;default:r=a}qF(s,r),E=r;for(c in E)if(E.hasOwnProperty(c)){var A=E[c];c==="style"?kH(h,A):c==="dangerouslySetInnerHTML"?(A=A?A.__html:void 0,A!=null&&SH(h,A)):c==="children"?typeof A=="string"?(s!=="textarea"||A!=="")&&GS(h,A):typeof A=="number"&&GS(h,""+A):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(HS.hasOwnProperty(c)?A!=null&&c==="onScroll"&&ru("scroll",h):A!=null&&KR(h,c,A,S))}switch(s){case"input":FA(h),yU(h,a,!1);break;case"textarea":FA(h),xU(h);break;case"option":a.value!=null&&h.setAttribute("value",""+Yb(a.value));break;case"select":h.multiple=!!a.multiple,c=a.value,c!=null?J2(h,!!a.multiple,c,!1):a.defaultValue!=null&&J2(h,!!a.multiple,a.defaultValue,!0);break;default:typeof r.onClick=="function"&&(h.onclick=UO)}switch(s){case"button":case"input":case"select":case"textarea":a=!!a.autoFocus;break e;case"img":a=!0;break e;default:a=!1}}a&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return sd(i),null;case 6:if(h&&i.stateNode!=null)YG(h,i,h.memoizedProps,a);else{if(typeof a!="string"&&i.stateNode===null)throw Error(li(166));if(s=ow(nC.current),ow(Ty.current),VA(i)){if(a=i.stateNode,s=i.memoizedProps,a[ky]=i,(c=a.nodeValue!==s)&&(h=Xm,h!==null))switch(h.tag){case 3:WA(a.nodeValue,s,(h.mode&1)!==0);break;case 5:h.memoizedProps.suppressHydrationWarning!==!0&&WA(a.nodeValue,s,(h.mode&1)!==0)}c&&(i.flags|=4)}else a=(s.nodeType===9?s:s.ownerDocument).createTextNode(a),a[ky]=i,i.stateNode=a}return sd(i),null;case 13:if(ou(Mu),a=i.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if(xu&&qm!==null&&i.mode&1&&!(i.flags&128))hG(),s_(),i.flags|=98560,c=!1;else if(c=VA(i),a!==null&&a.dehydrated!==null){if(h===null){if(!c)throw Error(li(318));if(c=i.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(li(317));c[ky]=i}else s_(),!(i.flags&128)&&(i.memoizedState=null),i.flags|=4;sd(i),c=!1}else ev!==null&&(AR(ev),ev=null),c=!0;if(!c)return i.flags&65536?i:null}return i.flags&128?(i.lanes=s,i):(a=a!==null,a!==(h!==null&&h.memoizedState!==null)&&a&&(i.child.flags|=8192,i.mode&1&&(h===null||Mu.current&1?Jc===0&&(Jc=3):D5())),i.updateQueue!==null&&(i.flags|=4),sd(i),null);case 4:return c_(),bR(h,i),h===null&&QS(i.stateNode.containerInfo),sd(i),null;case 10:return p5(i.type._context),sd(i),null;case 17:return Lp(i.type)&&WO(),sd(i),null;case 19:if(ou(Mu),c=i.memoizedState,c===null)return sd(i),null;if(a=(i.flags&128)!==0,S=c.rendering,S===null)if(a)hS(c,!1);else{if(Jc!==0||h!==null&&h.flags&128)for(h=i.child;h!==null;){if(S=KO(h),S!==null){for(i.flags|=128,hS(c,!1),a=S.updateQueue,a!==null&&(i.updateQueue=a,i.flags|=4),i.subtreeFlags=0,a=s,s=i.child;s!==null;)c=s,h=a,c.flags&=14680066,S=c.alternate,S===null?(c.childLanes=0,c.lanes=h,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=S.childLanes,c.lanes=S.lanes,c.child=S.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=S.memoizedProps,c.memoizedState=S.memoizedState,c.updateQueue=S.updateQueue,c.type=S.type,h=S.dependencies,c.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),s=s.sibling;return $s(Mu,Mu.current&1|2),i.child}h=h.sibling}c.tail!==null&&cc()>f_&&(i.flags|=128,a=!0,hS(c,!1),i.lanes=4194304)}else{if(!a)if(h=KO(S),h!==null){if(i.flags|=128,a=!0,s=h.updateQueue,s!==null&&(i.updateQueue=s,i.flags|=4),hS(c,!0),c.tail===null&&c.tailMode==="hidden"&&!S.alternate&&!xu)return sd(i),null}else 2*cc()-c.renderingStartTime>f_&&s!==1073741824&&(i.flags|=128,a=!0,hS(c,!1),i.lanes=4194304);c.isBackwards?(S.sibling=i.child,i.child=S):(s=c.last,s!==null?s.sibling=S:i.child=S,c.last=S)}return c.tail!==null?(i=c.tail,c.rendering=i,c.tail=i.sibling,c.renderingStartTime=cc(),i.sibling=null,s=Mu.current,$s(Mu,a?s&1|2:s&1),i):(sd(i),null);case 22:case 23:return M5(),a=i.memoizedState!==null,h!==null&&h.memoizedState!==null!==a&&(i.flags|=8192),a&&i.mode&1?Gm&1073741824&&(sd(i),i.subtreeFlags&6&&(i.flags|=8192)):sd(i),null;case 24:return null;case 25:return null}throw Error(li(156,i.tag))}function eue(h,i){switch(l5(i),i.tag){case 1:return Lp(i.type)&&WO(),h=i.flags,h&65536?(i.flags=h&-65537|128,i):null;case 3:return c_(),ou(Pp),ou(fd),b5(),h=i.flags,h&65536&&!(h&128)?(i.flags=h&-65537|128,i):null;case 5:return y5(i),null;case 13:if(ou(Mu),h=i.memoizedState,h!==null&&h.dehydrated!==null){if(i.alternate===null)throw Error(li(340));s_()}return h=i.flags,h&65536?(i.flags=h&-65537|128,i):null;case 19:return ou(Mu),null;case 4:return c_(),null;case 10:return p5(i.type._context),null;case 22:case 23:return M5(),null;case 24:return null;default:return null}}var qA=!1,cd=!1,tue=typeof WeakSet=="function"?WeakSet:Set,Mi=null;function $2(h,i){var s=h.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(a){Vu(h,i,a)}else s.current=null}function xR(h,i,s){try{s()}catch(a){Vu(h,i,a)}}var cW=!1;function nue(h,i){if(rR=BO,h=eG(),u5(h)){if("selectionStart"in h)var s={start:h.selectionStart,end:h.selectionEnd};else e:{s=(s=h.ownerDocument)&&s.defaultView||window;var a=s.getSelection&&s.getSelection();if(a&&a.rangeCount!==0){s=a.anchorNode;var r=a.anchorOffset,c=a.focusNode;a=a.focusOffset;try{s.nodeType,c.nodeType}catch{s=null;break e}var S=0,E=-1,A=-1,U=0,B=0,D=h,R=null;t:for(;;){for(var W;D!==s||r!==0&&D.nodeType!==3||(E=S+r),D!==c||a!==0&&D.nodeType!==3||(A=S+a),D.nodeType===3&&(S+=D.nodeValue.length),(W=D.firstChild)!==null;)R=D,D=W;for(;;){if(D===h)break t;if(R===s&&++U===r&&(E=S),R===c&&++B===a&&(A=S),(W=D.nextSibling)!==null)break;D=R,R=D.parentNode}D=W}s=E===-1||A===-1?null:{start:E,end:A}}else s=null}s=s||{start:0,end:0}}else s=null;for(iR={focusedElem:h,selectionRange:s},BO=!1,Mi=i;Mi!==null;)if(i=Mi,h=i.child,(i.subtreeFlags&1028)!==0&&h!==null)h.return=i,Mi=h;else for(;Mi!==null;){i=Mi;try{var j=i.alternate;if(i.flags&1024)switch(i.tag){case 0:case 11:case 15:break;case 1:if(j!==null){var H=j.memoizedProps,I=j.memoizedState,Q=i.stateNode,Y=Q.getSnapshotBeforeUpdate(i.elementType===i.type?H:Q0(i.type,H),I);Q.__reactInternalSnapshotBeforeUpdate=Y}break;case 3:var q=i.stateNode.containerInfo;q.nodeType===1?q.textContent="":q.nodeType===9&&q.documentElement&&q.removeChild(q.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(li(163))}}catch(ae){Vu(i,i.return,ae)}if(h=i.sibling,h!==null){h.return=i.return,Mi=h;break}Mi=i.return}return j=cW,cW=!1,j}function jS(h,i,s){var a=i.updateQueue;if(a=a!==null?a.lastEffect:null,a!==null){var r=a=a.next;do{if((r.tag&h)===h){var c=r.destroy;r.destroy=void 0,c!==void 0&&xR(i,s,c)}r=r.next}while(r!==a)}}function vT(h,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var s=i=i.next;do{if((s.tag&h)===h){var a=s.create;s.destroy=a()}s=s.next}while(s!==i)}}function wR(h){var i=h.ref;if(i!==null){var s=h.stateNode;switch(h.tag){case 5:h=s;break;default:h=s}typeof i=="function"?i(h):i.current=h}}function JG(h){var i=h.alternate;i!==null&&(h.alternate=null,JG(i)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(i=h.stateNode,i!==null&&(delete i[ky],delete i[eC],delete i[sR],delete i[Bse],delete i[jse])),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}function QG(h){return h.tag===5||h.tag===3||h.tag===4}function lW(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||QG(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&h.tag!==18;){if(h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function _R(h,i,s){var a=h.tag;if(a===5||a===6)h=h.stateNode,i?s.nodeType===8?s.parentNode.insertBefore(h,i):s.insertBefore(h,i):(s.nodeType===8?(i=s.parentNode,i.insertBefore(h,s)):(i=s,i.appendChild(h)),s=s._reactRootContainer,s!=null||i.onclick!==null||(i.onclick=UO));else if(a!==4&&(h=h.child,h!==null))for(_R(h,i,s),h=h.sibling;h!==null;)_R(h,i,s),h=h.sibling}function ER(h,i,s){var a=h.tag;if(a===5||a===6)h=h.stateNode,i?s.insertBefore(h,i):s.appendChild(h);else if(a!==4&&(h=h.child,h!==null))for(ER(h,i,s),h=h.sibling;h!==null;)ER(h,i,s),h=h.sibling}var lf=null,Z0=!1;function Mb(h,i,s){for(s=s.child;s!==null;)ZG(h,i,s),s=s.sibling}function ZG(h,i,s){if(Oy&&typeof Oy.onCommitFiberUnmount=="function")try{Oy.onCommitFiberUnmount(cT,s)}catch{}switch(s.tag){case 5:cd||$2(s,i);case 6:var a=lf,r=Z0;lf=null,Mb(h,i,s),lf=a,Z0=r,lf!==null&&(Z0?(h=lf,s=s.stateNode,h.nodeType===8?h.parentNode.removeChild(s):h.removeChild(s)):lf.removeChild(s.stateNode));break;case 18:lf!==null&&(Z0?(h=lf,s=s.stateNode,h.nodeType===8?BI(h.parentNode,s):h.nodeType===1&&BI(h,s),KS(h)):BI(lf,s.stateNode));break;case 4:a=lf,r=Z0,lf=s.stateNode.containerInfo,Z0=!0,Mb(h,i,s),lf=a,Z0=r;break;case 0:case 11:case 14:case 15:if(!cd&&(a=s.updateQueue,a!==null&&(a=a.lastEffect,a!==null))){r=a=a.next;do{var c=r,S=c.destroy;c=c.tag,S!==void 0&&(c&2||c&4)&&xR(s,i,S),r=r.next}while(r!==a)}Mb(h,i,s);break;case 1:if(!cd&&($2(s,i),a=s.stateNode,typeof a.componentWillUnmount=="function"))try{a.props=s.memoizedProps,a.state=s.memoizedState,a.componentWillUnmount()}catch(E){Vu(s,i,E)}Mb(h,i,s);break;case 21:Mb(h,i,s);break;case 22:s.mode&1?(cd=(a=cd)||s.memoizedState!==null,Mb(h,i,s),cd=a):Mb(h,i,s);break;default:Mb(h,i,s)}}function fW(h){var i=h.updateQueue;if(i!==null){h.updateQueue=null;var s=h.stateNode;s===null&&(s=h.stateNode=new tue),i.forEach(function(a){var r=fue.bind(null,h,a);s.has(a)||(s.add(a),a.then(r,r))})}}function X0(h,i){var s=i.deletions;if(s!==null)for(var a=0;a<s.length;a++){var r=s[a];try{var c=h,S=i,E=S;e:for(;E!==null;){switch(E.tag){case 5:lf=E.stateNode,Z0=!1;break e;case 3:lf=E.stateNode.containerInfo,Z0=!0;break e;case 4:lf=E.stateNode.containerInfo,Z0=!0;break e}E=E.return}if(lf===null)throw Error(li(160));ZG(c,S,r),lf=null,Z0=!1;var A=r.alternate;A!==null&&(A.return=null),r.return=null}catch(U){Vu(r,i,U)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)eq(i,h),i=i.sibling}function eq(h,i){var s=h.alternate,a=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:if(X0(i,h),wy(h),a&4){try{jS(3,h,h.return),vT(3,h)}catch(H){Vu(h,h.return,H)}try{jS(5,h,h.return)}catch(H){Vu(h,h.return,H)}}break;case 1:X0(i,h),wy(h),a&512&&s!==null&&$2(s,s.return);break;case 5:if(X0(i,h),wy(h),a&512&&s!==null&&$2(s,s.return),h.flags&32){var r=h.stateNode;try{GS(r,"")}catch(H){Vu(h,h.return,H)}}if(a&4&&(r=h.stateNode,r!=null)){var c=h.memoizedProps,S=s!==null?s.memoizedProps:c,E=h.type,A=h.updateQueue;if(h.updateQueue=null,A!==null)try{E==="input"&&c.type==="radio"&&c.name!=null&&wH(r,c),$F(E,S);var U=$F(E,c);for(S=0;S<A.length;S+=2){var B=A[S],D=A[S+1];B==="style"?kH(r,D):B==="dangerouslySetInnerHTML"?SH(r,D):B==="children"?GS(r,D):KR(r,B,D,U)}switch(E){case"input":WF(r,c);break;case"textarea":_H(r,c);break;case"select":var R=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!c.multiple;var W=c.value;W!=null?J2(r,!!c.multiple,W,!1):R!==!!c.multiple&&(c.defaultValue!=null?J2(r,!!c.multiple,c.defaultValue,!0):J2(r,!!c.multiple,c.multiple?[]:"",!1))}r[eC]=c}catch(H){Vu(h,h.return,H)}}break;case 6:if(X0(i,h),wy(h),a&4){if(h.stateNode===null)throw Error(li(162));r=h.stateNode,c=h.memoizedProps;try{r.nodeValue=c}catch(H){Vu(h,h.return,H)}}break;case 3:if(X0(i,h),wy(h),a&4&&s!==null&&s.memoizedState.isDehydrated)try{KS(i.containerInfo)}catch(H){Vu(h,h.return,H)}break;case 4:X0(i,h),wy(h);break;case 13:X0(i,h),wy(h),r=h.child,r.flags&8192&&(c=r.memoizedState!==null,r.stateNode.isHidden=c,!c||r.alternate!==null&&r.alternate.memoizedState!==null||(O5=cc())),a&4&&fW(h);break;case 22:if(B=s!==null&&s.memoizedState!==null,h.mode&1?(cd=(U=cd)||B,X0(i,h),cd=U):X0(i,h),wy(h),a&8192){if(U=h.memoizedState!==null,(h.stateNode.isHidden=U)&&!B&&h.mode&1)for(Mi=h,B=h.child;B!==null;){for(D=Mi=B;Mi!==null;){switch(R=Mi,W=R.child,R.tag){case 0:case 11:case 14:case 15:jS(4,R,R.return);break;case 1:$2(R,R.return);var j=R.stateNode;if(typeof j.componentWillUnmount=="function"){a=R,s=R.return;try{i=a,j.props=i.memoizedProps,j.state=i.memoizedState,j.componentWillUnmount()}catch(H){Vu(a,s,H)}}break;case 5:$2(R,R.return);break;case 22:if(R.memoizedState!==null){hW(D);continue}}W!==null?(W.return=R,Mi=W):hW(D)}B=B.sibling}e:for(B=null,D=h;;){if(D.tag===5){if(B===null){B=D;try{r=D.stateNode,U?(c=r.style,typeof c.setProperty=="function"?c.setProperty("display","none","important"):c.display="none"):(E=D.stateNode,A=D.memoizedProps.style,S=A!=null&&A.hasOwnProperty("display")?A.display:null,E.style.display=CH("display",S))}catch(H){Vu(h,h.return,H)}}}else if(D.tag===6){if(B===null)try{D.stateNode.nodeValue=U?"":D.memoizedProps}catch(H){Vu(h,h.return,H)}}else if((D.tag!==22&&D.tag!==23||D.memoizedState===null||D===h)&&D.child!==null){D.child.return=D,D=D.child;continue}if(D===h)break e;for(;D.sibling===null;){if(D.return===null||D.return===h)break e;B===D&&(B=null),D=D.return}B===D&&(B=null),D.sibling.return=D.return,D=D.sibling}}break;case 19:X0(i,h),wy(h),a&4&&fW(h);break;case 21:break;default:X0(i,h),wy(h)}}function wy(h){var i=h.flags;if(i&2){try{e:{for(var s=h.return;s!==null;){if(QG(s)){var a=s;break e}s=s.return}throw Error(li(160))}switch(a.tag){case 5:var r=a.stateNode;a.flags&32&&(GS(r,""),a.flags&=-33);var c=lW(h);ER(h,c,r);break;case 3:case 4:var S=a.stateNode.containerInfo,E=lW(h);_R(h,E,S);break;default:throw Error(li(161))}}catch(A){Vu(h,h.return,A)}h.flags&=-3}i&4096&&(h.flags&=-4097)}function rue(h,i,s){Mi=h,tq(h)}function tq(h,i,s){for(var a=(h.mode&1)!==0;Mi!==null;){var r=Mi,c=r.child;if(r.tag===22&&a){var S=r.memoizedState!==null||qA;if(!S){var E=r.alternate,A=E!==null&&E.memoizedState!==null||cd;E=qA;var U=cd;if(qA=S,(cd=A)&&!U)for(Mi=r;Mi!==null;)S=Mi,A=S.child,S.tag===22&&S.memoizedState!==null?pW(r):A!==null?(A.return=S,Mi=A):pW(r);for(;c!==null;)Mi=c,tq(c),c=c.sibling;Mi=r,qA=E,cd=U}dW(h)}else r.subtreeFlags&8772&&c!==null?(c.return=r,Mi=c):dW(h)}}function dW(h){for(;Mi!==null;){var i=Mi;if(i.flags&8772){var s=i.alternate;try{if(i.flags&8772)switch(i.tag){case 0:case 11:case 15:cd||vT(5,i);break;case 1:var a=i.stateNode;if(i.flags&4&&!cd)if(s===null)a.componentDidMount();else{var r=i.elementType===i.type?s.memoizedProps:Q0(i.type,s.memoizedProps);a.componentDidUpdate(r,s.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}var c=i.updateQueue;c!==null&&KU(i,c,a);break;case 3:var S=i.updateQueue;if(S!==null){if(s=null,i.child!==null)switch(i.child.tag){case 5:s=i.child.stateNode;break;case 1:s=i.child.stateNode}KU(i,S,s)}break;case 5:var E=i.stateNode;if(s===null&&i.flags&4){s=E;var A=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":A.autoFocus&&s.focus();break;case"img":A.src&&(s.src=A.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var U=i.alternate;if(U!==null){var B=U.memoizedState;if(B!==null){var D=B.dehydrated;D!==null&&KS(D)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(li(163))}cd||i.flags&512&&wR(i)}catch(R){Vu(i,i.return,R)}}if(i===h){Mi=null;break}if(s=i.sibling,s!==null){s.return=i.return,Mi=s;break}Mi=i.return}}function hW(h){for(;Mi!==null;){var i=Mi;if(i===h){Mi=null;break}var s=i.sibling;if(s!==null){s.return=i.return,Mi=s;break}Mi=i.return}}function pW(h){for(;Mi!==null;){var i=Mi;try{switch(i.tag){case 0:case 11:case 15:var s=i.return;try{vT(4,i)}catch(A){Vu(i,s,A)}break;case 1:var a=i.stateNode;if(typeof a.componentDidMount=="function"){var r=i.return;try{a.componentDidMount()}catch(A){Vu(i,r,A)}}var c=i.return;try{wR(i)}catch(A){Vu(i,c,A)}break;case 5:var S=i.return;try{wR(i)}catch(A){Vu(i,S,A)}}}catch(A){Vu(i,i.return,A)}if(i===h){Mi=null;break}var E=i.sibling;if(E!==null){E.return=i.return,Mi=E;break}Mi=i.return}}var iue=Math.ceil,QO=B1.ReactCurrentDispatcher,k5=B1.ReactCurrentOwner,qg=B1.ReactCurrentBatchConfig,Pa=0,Al=null,Tc=null,ff=0,Gm=0,X2=tx(0),Jc=0,aC=null,mw=0,yT=0,A5=0,zS=null,Dp=null,O5=0,f_=1/0,k1=null,ZO=!1,SR=null,qb=null,$A=!1,zb=null,eT=0,US=0,CR=null,OO=-1,TO=0;function _h(){return Pa&6?cc():OO!==-1?OO:OO=cc()}function $b(h){return h.mode&1?Pa&2&&ff!==0?ff&-ff:Use.transition!==null?(TO===0&&(TO=BH()),TO):(h=fs,h!==0||(h=window.event,h=h===void 0?16:GH(h.type)),h):1}function iv(h,i,s,a){if(50<US)throw US=0,CR=null,Error(li(185));dC(h,s,a),(!(Pa&2)||h!==Al)&&(h===Al&&(!(Pa&2)&&(yT|=s),Jc===4&&Bb(h,ff)),Bp(h,a),s===1&&Pa===0&&!(i.mode&1)&&(f_=cc()+500,pT&&nx()))}function Bp(h,i){var s=h.callbackNode;Uae(h,i);var a=LO(h,h===Al?ff:0);if(a===0)s!==null&&EU(s),h.callbackNode=null,h.callbackPriority=0;else if(i=a&-a,h.callbackPriority!==i){if(s!=null&&EU(s),i===1)h.tag===0?zse(mW.bind(null,h)):lG(mW.bind(null,h)),Pse(function(){!(Pa&6)&&nx()}),s=null;else{switch(jH(a)){case 1:s=e5;break;case 4:s=PH;break;case 16:s=PO;break;case 536870912:s=LH;break;default:s=PO}s=cq(s,nq.bind(null,h))}h.callbackPriority=i,h.callbackNode=s}}function nq(h,i){if(OO=-1,TO=0,Pa&6)throw Error(li(327));var s=h.callbackNode;if(n_()&&h.callbackNode!==s)return null;var a=LO(h,h===Al?ff:0);if(a===0)return null;if(a&30||a&h.expiredLanes||i)i=tT(h,a);else{i=a;var r=Pa;Pa|=2;var c=iq();(Al!==h||ff!==i)&&(k1=null,f_=cc()+500,uw(h,i));do try{sue();break}catch(E){rq(h,E)}while(1);h5(),QO.current=c,Pa=r,Tc!==null?i=0:(Al=null,ff=0,i=Jc)}if(i!==0){if(i===2&&(r=QF(h),r!==0&&(a=r,i=kR(h,r))),i===1)throw s=aC,uw(h,0),Bb(h,a),Bp(h,cc()),s;if(i===6)Bb(h,a);else{if(r=h.current.alternate,!(a&30)&&!oue(r)&&(i=tT(h,a),i===2&&(c=QF(h),c!==0&&(a=c,i=kR(h,c))),i===1))throw s=aC,uw(h,0),Bb(h,a),Bp(h,cc()),s;switch(h.finishedWork=r,h.finishedLanes=a,i){case 0:case 1:throw Error(li(345));case 2:Zx(h,Dp,k1);break;case 3:if(Bb(h,a),(a&130023424)===a&&(i=O5+500-cc(),10<i)){if(LO(h,0)!==0)break;if(r=h.suspendedLanes,(r&a)!==a){_h(),h.pingedLanes|=h.suspendedLanes&r;break}h.timeoutHandle=aR(Zx.bind(null,h,Dp,k1),i);break}Zx(h,Dp,k1);break;case 4:if(Bb(h,a),(a&4194240)===a)break;for(i=h.eventTimes,r=-1;0<a;){var S=31-rv(a);c=1<<S,S=i[S],S>r&&(r=S),a&=~c}if(a=r,a=cc()-a,a=(120>a?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*iue(a/1960))-a,10<a){h.timeoutHandle=aR(Zx.bind(null,h,Dp,k1),a);break}Zx(h,Dp,k1);break;case 5:Zx(h,Dp,k1);break;default:throw Error(li(329))}}}return Bp(h,cc()),h.callbackNode===s?nq.bind(null,h):null}function kR(h,i){var s=zS;return h.current.memoizedState.isDehydrated&&(uw(h,i).flags|=256),h=tT(h,i),h!==2&&(i=Dp,Dp=s,i!==null&&AR(i)),h}function AR(h){Dp===null?Dp=h:Dp.push.apply(Dp,h)}function oue(h){for(var i=h;;){if(i.flags&16384){var s=i.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var a=0;a<s.length;a++){var r=s[a],c=r.getSnapshot;r=r.value;try{if(!ov(c(),r))return!1}catch{return!1}}}if(s=i.child,i.subtreeFlags&16384&&s!==null)s.return=i,i=s;else{if(i===h)break;for(;i.sibling===null;){if(i.return===null||i.return===h)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Bb(h,i){for(i&=~A5,i&=~yT,h.suspendedLanes|=i,h.pingedLanes&=~i,h=h.expirationTimes;0<i;){var s=31-rv(i),a=1<<s;h[s]=-1,i&=~a}}function mW(h){if(Pa&6)throw Error(li(327));n_();var i=LO(h,0);if(!(i&1))return Bp(h,cc()),null;var s=tT(h,i);if(h.tag!==0&&s===2){var a=QF(h);a!==0&&(i=a,s=kR(h,a))}if(s===1)throw s=aC,uw(h,0),Bb(h,i),Bp(h,cc()),s;if(s===6)throw Error(li(345));return h.finishedWork=h.current.alternate,h.finishedLanes=i,Zx(h,Dp,k1),Bp(h,cc()),null}function T5(h,i){var s=Pa;Pa|=1;try{return h(i)}finally{Pa=s,Pa===0&&(f_=cc()+500,pT&&nx())}}function gw(h){zb!==null&&zb.tag===0&&!(Pa&6)&&n_();var i=Pa;Pa|=1;var s=qg.transition,a=fs;try{if(qg.transition=null,fs=1,h)return h()}finally{fs=a,qg.transition=s,Pa=i,!(Pa&6)&&nx()}}function M5(){Gm=X2.current,ou(X2)}function uw(h,i){h.finishedWork=null,h.finishedLanes=0;var s=h.timeoutHandle;if(s!==-1&&(h.timeoutHandle=-1,Rse(s)),Tc!==null)for(s=Tc.return;s!==null;){var a=s;switch(l5(a),a.tag){case 1:a=a.type.childContextTypes,a!=null&&WO();break;case 3:c_(),ou(Pp),ou(fd),b5();break;case 5:y5(a);break;case 4:c_();break;case 13:ou(Mu);break;case 19:ou(Mu);break;case 10:p5(a.type._context);break;case 22:case 23:M5()}s=s.return}if(Al=h,Tc=h=Xb(h.current,null),ff=Gm=i,Jc=0,aC=null,A5=yT=mw=0,Dp=zS=null,iw!==null){for(i=0;i<iw.length;i++)if(s=iw[i],a=s.interleaved,a!==null){s.interleaved=null;var r=a.next,c=s.pending;if(c!==null){var S=c.next;c.next=r,a.next=S}s.pending=a}iw=null}return h}function rq(h,i){do{var s=Tc;try{if(h5(),CO.current=JO,YO){for(var a=Du.memoizedState;a!==null;){var r=a.queue;r!==null&&(r.pending=null),a=a.next}YO=!1}if(pw=0,Cl=Yc=Du=null,BS=!1,rC=0,k5.current=null,s===null||s.return===null){Jc=1,aC=i,Tc=null;break}e:{var c=h,S=s.return,E=s,A=i;if(i=ff,E.flags|=32768,A!==null&&typeof A=="object"&&typeof A.then=="function"){var U=A,B=E,D=B.tag;if(!(B.mode&1)&&(D===0||D===11||D===15)){var R=B.alternate;R?(B.updateQueue=R.updateQueue,B.memoizedState=R.memoizedState,B.lanes=R.lanes):(B.updateQueue=null,B.memoizedState=null)}var W=nW(S);if(W!==null){W.flags&=-257,rW(W,S,E,c,i),W.mode&1&&tW(c,U,i),i=W,A=U;var j=i.updateQueue;if(j===null){var H=new Set;H.add(A),i.updateQueue=H}else j.add(A);break e}else{if(!(i&1)){tW(c,U,i),D5();break e}A=Error(li(426))}}else if(xu&&E.mode&1){var I=nW(S);if(I!==null){!(I.flags&65536)&&(I.flags|=256),rW(I,S,E,c,i),f5(l_(A,E));break e}}c=A=l_(A,E),Jc!==4&&(Jc=2),zS===null?zS=[c]:zS.push(c),c=S;do{switch(c.tag){case 3:c.flags|=65536,i&=-i,c.lanes|=i;var Q=zG(c,A,i);XU(c,Q);break e;case 1:E=A;var Y=c.type,q=c.stateNode;if(!(c.flags&128)&&(typeof Y.getDerivedStateFromError=="function"||q!==null&&typeof q.componentDidCatch=="function"&&(qb===null||!qb.has(q)))){c.flags|=65536,i&=-i,c.lanes|=i;var ae=UG(c,E,i);XU(c,ae);break e}}c=c.return}while(c!==null)}aq(s)}catch(oe){i=oe,Tc===s&&s!==null&&(Tc=s=s.return);continue}break}while(1)}function iq(){var h=QO.current;return QO.current=JO,h===null?JO:h}function D5(){(Jc===0||Jc===3||Jc===2)&&(Jc=4),Al===null||!(mw&268435455)&&!(yT&268435455)||Bb(Al,ff)}function tT(h,i){var s=Pa;Pa|=2;var a=iq();(Al!==h||ff!==i)&&(k1=null,uw(h,i));do try{aue();break}catch(r){rq(h,r)}while(1);if(h5(),Pa=s,QO.current=a,Tc!==null)throw Error(li(261));return Al=null,ff=0,Jc}function aue(){for(;Tc!==null;)oq(Tc)}function sue(){for(;Tc!==null&&!Nae();)oq(Tc)}function oq(h){var i=uq(h.alternate,h,Gm);h.memoizedProps=h.pendingProps,i===null?aq(h):Tc=i,k5.current=null}function aq(h){var i=h;do{var s=i.alternate;if(h=i.return,i.flags&32768){if(s=eue(s,i),s!==null){s.flags&=32767,Tc=s;return}if(h!==null)h.flags|=32768,h.subtreeFlags=0,h.deletions=null;else{Jc=6,Tc=null;return}}else if(s=Zse(s,i,Gm),s!==null){Tc=s;return}if(i=i.sibling,i!==null){Tc=i;return}Tc=i=h}while(i!==null);Jc===0&&(Jc=5)}function Zx(h,i,s){var a=fs,r=qg.transition;try{qg.transition=null,fs=1,uue(h,i,s,a)}finally{qg.transition=r,fs=a}return null}function uue(h,i,s,a){do n_();while(zb!==null);if(Pa&6)throw Error(li(327));s=h.finishedWork;var r=h.finishedLanes;if(s===null)return null;if(h.finishedWork=null,h.finishedLanes=0,s===h.current)throw Error(li(177));h.callbackNode=null,h.callbackPriority=0;var c=s.lanes|s.childLanes;if(Wae(h,c),h===Al&&(Tc=Al=null,ff=0),!(s.subtreeFlags&2064)&&!(s.flags&2064)||$A||($A=!0,cq(PO,function(){return n_(),null})),c=(s.flags&15990)!==0,s.subtreeFlags&15990||c){c=qg.transition,qg.transition=null;var S=fs;fs=1;var E=Pa;Pa|=4,k5.current=null,nue(h,s),eq(s,h),Ose(iR),BO=!!rR,iR=rR=null,h.current=s,rue(s),Iae(),Pa=E,fs=S,qg.transition=c}else h.current=s;if($A&&($A=!1,zb=h,eT=r),c=h.pendingLanes,c===0&&(qb=null),Pae(s.stateNode),Bp(h,cc()),i!==null)for(a=h.onRecoverableError,s=0;s<i.length;s++)r=i[s],a(r.value,{componentStack:r.stack,digest:r.digest});if(ZO)throw ZO=!1,h=SR,SR=null,h;return eT&1&&h.tag!==0&&n_(),c=h.pendingLanes,c&1?h===CR?US++:(US=0,CR=h):US=0,nx(),null}function n_(){if(zb!==null){var h=jH(eT),i=qg.transition,s=fs;try{if(qg.transition=null,fs=16>h?16:h,zb===null)var a=!1;else{if(h=zb,zb=null,eT=0,Pa&6)throw Error(li(331));var r=Pa;for(Pa|=4,Mi=h.current;Mi!==null;){var c=Mi,S=c.child;if(Mi.flags&16){var E=c.deletions;if(E!==null){for(var A=0;A<E.length;A++){var U=E[A];for(Mi=U;Mi!==null;){var B=Mi;switch(B.tag){case 0:case 11:case 15:jS(8,B,c)}var D=B.child;if(D!==null)D.return=B,Mi=D;else for(;Mi!==null;){B=Mi;var R=B.sibling,W=B.return;if(JG(B),B===U){Mi=null;break}if(R!==null){R.return=W,Mi=R;break}Mi=W}}}var j=c.alternate;if(j!==null){var H=j.child;if(H!==null){j.child=null;do{var I=H.sibling;H.sibling=null,H=I}while(H!==null)}}Mi=c}}if(c.subtreeFlags&2064&&S!==null)S.return=c,Mi=S;else e:for(;Mi!==null;){if(c=Mi,c.flags&2048)switch(c.tag){case 0:case 11:case 15:jS(9,c,c.return)}var Q=c.sibling;if(Q!==null){Q.return=c.return,Mi=Q;break e}Mi=c.return}}var Y=h.current;for(Mi=Y;Mi!==null;){S=Mi;var q=S.child;if(S.subtreeFlags&2064&&q!==null)q.return=S,Mi=q;else e:for(S=Y;Mi!==null;){if(E=Mi,E.flags&2048)try{switch(E.tag){case 0:case 11:case 15:vT(9,E)}}catch(oe){Vu(E,E.return,oe)}if(E===S){Mi=null;break e}var ae=E.sibling;if(ae!==null){ae.return=E.return,Mi=ae;break e}Mi=E.return}}if(Pa=r,nx(),Oy&&typeof Oy.onPostCommitFiberRoot=="function")try{Oy.onPostCommitFiberRoot(cT,h)}catch{}a=!0}return a}finally{fs=s,qg.transition=i}}return!1}function gW(h,i,s){i=l_(s,i),i=zG(h,i,1),h=Gb(h,i,1),i=_h(),h!==null&&(dC(h,1,i),Bp(h,i))}function Vu(h,i,s){if(h.tag===3)gW(h,h,s);else for(;i!==null;){if(i.tag===3){gW(i,h,s);break}else if(i.tag===1){var a=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof a.componentDidCatch=="function"&&(qb===null||!qb.has(a))){h=l_(s,h),h=UG(i,h,1),i=Gb(i,h,1),h=_h(),i!==null&&(dC(i,1,h),Bp(i,h));break}}i=i.return}}function cue(h,i,s){var a=h.pingCache;a!==null&&a.delete(i),i=_h(),h.pingedLanes|=h.suspendedLanes&s,Al===h&&(ff&s)===s&&(Jc===4||Jc===3&&(ff&130023424)===ff&&500>cc()-O5?uw(h,0):A5|=s),Bp(h,i)}function sq(h,i){i===0&&(h.mode&1?(i=LA,LA<<=1,!(LA&130023424)&&(LA=4194304)):i=1);var s=_h();h=P1(h,i),h!==null&&(dC(h,i,s),Bp(h,s))}function lue(h){var i=h.memoizedState,s=0;i!==null&&(s=i.retryLane),sq(h,s)}function fue(h,i){var s=0;switch(h.tag){case 13:var a=h.stateNode,r=h.memoizedState;r!==null&&(s=r.retryLane);break;case 19:a=h.stateNode;break;default:throw Error(li(314))}a!==null&&a.delete(i),sq(h,s)}var uq;uq=function(h,i,s){if(h!==null)if(h.memoizedProps!==i.pendingProps||Pp.current)Fp=!0;else{if(!(h.lanes&s)&&!(i.flags&128))return Fp=!1,Qse(h,i,s);Fp=!!(h.flags&131072)}else Fp=!1,xu&&i.flags&1048576&&fG(i,GO,i.index);switch(i.lanes=0,i.tag){case 2:var a=i.type;AO(h,i),h=i.pendingProps;var r=a_(i,fd.current);t_(i,s),r=w5(null,i,a,h,r,s);var c=_5();return i.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,Lp(a)?(c=!0,VO(i)):c=!1,i.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,g5(i),r.updater=mT,i.stateNode=r,r._reactInternals=i,hR(i,a,h,s),i=gR(null,i,a,!0,c,s)):(i.tag=0,xu&&c&&c5(i),xh(null,i,r,s),i=i.child),i;case 16:a=i.elementType;e:{switch(AO(h,i),h=i.pendingProps,r=a._init,a=r(a._payload),i.type=a,r=i.tag=hue(a),h=Q0(a,h),r){case 0:i=mR(null,i,a,h,s);break e;case 1:i=aW(null,i,a,h,s);break e;case 11:i=iW(null,i,a,h,s);break e;case 14:i=oW(null,i,a,Q0(a.type,h),s);break e}throw Error(li(306,a,""))}return i;case 0:return a=i.type,r=i.pendingProps,r=i.elementType===a?r:Q0(a,r),mR(h,i,a,r,s);case 1:return a=i.type,r=i.pendingProps,r=i.elementType===a?r:Q0(a,r),aW(h,i,a,r,s);case 3:e:{if(GG(i),h===null)throw Error(li(387));a=i.pendingProps,c=i.memoizedState,r=c.element,mG(h,i),XO(i,a,null,s);var S=i.memoizedState;if(a=S.element,c.isDehydrated)if(c={element:a,isDehydrated:!1,cache:S.cache,pendingSuspenseBoundaries:S.pendingSuspenseBoundaries,transitions:S.transitions},i.updateQueue.baseState=c,i.memoizedState=c,i.flags&256){r=l_(Error(li(423)),i),i=sW(h,i,a,s,r);break e}else if(a!==r){r=l_(Error(li(424)),i),i=sW(h,i,a,s,r);break e}else for(qm=Hb(i.stateNode.containerInfo.firstChild),Xm=i,xu=!0,ev=null,s=bG(i,null,a,s),i.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(s_(),a===r){i=L1(h,i,s);break e}xh(h,i,a,s)}i=i.child}return i;case 5:return xG(i),h===null&&lR(i),a=i.type,r=i.pendingProps,c=h!==null?h.memoizedProps:null,S=r.children,oR(a,r)?S=null:c!==null&&oR(a,c)&&(i.flags|=32),HG(h,i),xh(h,i,S,s),i.child;case 6:return h===null&&lR(i),null;case 13:return qG(h,i,s);case 4:return v5(i,i.stateNode.containerInfo),a=i.pendingProps,h===null?i.child=u_(i,null,a,s):xh(h,i,a,s),i.child;case 11:return a=i.type,r=i.pendingProps,r=i.elementType===a?r:Q0(a,r),iW(h,i,a,r,s);case 7:return xh(h,i,i.pendingProps,s),i.child;case 8:return xh(h,i,i.pendingProps.children,s),i.child;case 12:return xh(h,i,i.pendingProps.children,s),i.child;case 10:e:{if(a=i.type._context,r=i.pendingProps,c=i.memoizedProps,S=r.value,$s(qO,a._currentValue),a._currentValue=S,c!==null)if(ov(c.value,S)){if(c.children===r.children&&!Pp.current){i=L1(h,i,s);break e}}else for(c=i.child,c!==null&&(c.return=i);c!==null;){var E=c.dependencies;if(E!==null){S=c.child;for(var A=E.firstContext;A!==null;){if(A.context===a){if(c.tag===1){A=N1(-1,s&-s),A.tag=2;var U=c.updateQueue;if(U!==null){U=U.shared;var B=U.pending;B===null?A.next=A:(A.next=B.next,B.next=A),U.pending=A}}c.lanes|=s,A=c.alternate,A!==null&&(A.lanes|=s),fR(c.return,s,i),E.lanes|=s;break}A=A.next}}else if(c.tag===10)S=c.type===i.type?null:c.child;else if(c.tag===18){if(S=c.return,S===null)throw Error(li(341));S.lanes|=s,E=S.alternate,E!==null&&(E.lanes|=s),fR(S,s,i),S=c.sibling}else S=c.child;if(S!==null)S.return=c;else for(S=c;S!==null;){if(S===i){S=null;break}if(c=S.sibling,c!==null){c.return=S.return,S=c;break}S=S.return}c=S}xh(h,i,r.children,s),i=i.child}return i;case 9:return r=i.type,a=i.pendingProps.children,t_(i,s),r=Xg(r),a=a(r),i.flags|=1,xh(h,i,a,s),i.child;case 14:return a=i.type,r=Q0(a,i.pendingProps),r=Q0(a.type,r),oW(h,i,a,r,s);case 15:return WG(h,i,i.type,i.pendingProps,s);case 17:return a=i.type,r=i.pendingProps,r=i.elementType===a?r:Q0(a,r),AO(h,i),i.tag=1,Lp(a)?(h=!0,VO(i)):h=!1,t_(i,s),vG(i,a,r),hR(i,a,r,s),gR(null,i,a,!0,h,s);case 19:return $G(h,i,s);case 22:return VG(h,i,s)}throw Error(li(156,i.tag))};function cq(h,i){return RH(h,i)}function due(h,i,s,a){this.tag=h,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Gg(h,i,s,a){return new due(h,i,s,a)}function N5(h){return h=h.prototype,!(!h||!h.isReactComponent)}function hue(h){if(typeof h=="function")return N5(h)?1:0;if(h!=null){if(h=h.$$typeof,h===JR)return 11;if(h===QR)return 14}return 2}function Xb(h,i){var s=h.alternate;return s===null?(s=Gg(h.tag,i,h.key,h.mode),s.elementType=h.elementType,s.type=h.type,s.stateNode=h.stateNode,s.alternate=h,h.alternate=s):(s.pendingProps=i,s.type=h.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=h.flags&14680064,s.childLanes=h.childLanes,s.lanes=h.lanes,s.child=h.child,s.memoizedProps=h.memoizedProps,s.memoizedState=h.memoizedState,s.updateQueue=h.updateQueue,i=h.dependencies,s.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},s.sibling=h.sibling,s.index=h.index,s.ref=h.ref,s}function MO(h,i,s,a,r,c){var S=2;if(a=h,typeof h=="function")N5(h)&&(S=1);else if(typeof h=="string")S=5;else e:switch(h){case B2:return cw(s.children,r,c,i);case YR:S=8,r|=8;break;case LF:return h=Gg(12,s,i,r|2),h.elementType=LF,h.lanes=c,h;case BF:return h=Gg(13,s,i,r),h.elementType=BF,h.lanes=c,h;case jF:return h=Gg(19,s,i,r),h.elementType=jF,h.lanes=c,h;case yH:return bT(s,r,c,i);default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case gH:S=10;break e;case vH:S=9;break e;case JR:S=11;break e;case QR:S=14;break e;case Rb:S=16,a=null;break e}throw Error(li(130,h==null?h:typeof h,""))}return i=Gg(S,s,i,r),i.elementType=h,i.type=a,i.lanes=c,i}function cw(h,i,s,a){return h=Gg(7,h,a,i),h.lanes=s,h}function bT(h,i,s,a){return h=Gg(22,h,a,i),h.elementType=yH,h.lanes=s,h.stateNode={isHidden:!1},h}function qI(h,i,s){return h=Gg(6,h,null,i),h.lanes=s,h}function $I(h,i,s){return i=Gg(4,h.children!==null?h.children:[],h.key,i),i.lanes=s,i.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},i}function pue(h,i,s,a,r){this.tag=i,this.containerInfo=h,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=AI(0),this.expirationTimes=AI(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=AI(0),this.identifierPrefix=a,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function I5(h,i,s,a,r,c,S,E,A){return h=new pue(h,i,s,E,A),i===1?(i=1,c===!0&&(i|=8)):i=0,c=Gg(3,null,null,i),h.current=c,c.stateNode=h,c.memoizedState={element:a,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},g5(c),h}function mue(h,i,s){var a=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:L2,key:a==null?null:""+a,children:h,containerInfo:i,implementation:s}}function lq(h){if(!h)return Jb;h=h._reactInternals;e:{if(Ew(h)!==h||h.tag!==1)throw Error(li(170));var i=h;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(Lp(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(li(171))}if(h.tag===1){var s=h.type;if(Lp(s))return cG(h,s,i)}return i}function fq(h,i,s,a,r,c,S,E,A){return h=I5(s,a,!0,h,r,c,S,E,A),h.context=lq(null),s=h.current,a=_h(),r=$b(s),c=N1(a,r),c.callback=i??null,Gb(s,c,r),h.current.lanes=r,dC(h,r,a),Bp(h,a),h}function xT(h,i,s,a){var r=i.current,c=_h(),S=$b(r);return s=lq(s),i.context===null?i.context=s:i.pendingContext=s,i=N1(c,S),i.payload={element:h},a=a===void 0?null:a,a!==null&&(i.callback=a),h=Gb(r,i,S),h!==null&&(iv(h,r,S,c),SO(h,r,S)),S}function nT(h){if(h=h.current,!h.child)return null;switch(h.child.tag){case 5:return h.child.stateNode;default:return h.child.stateNode}}function vW(h,i){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var s=h.retryLane;h.retryLane=s!==0&&s<i?s:i}}function F5(h,i){vW(h,i),(h=h.alternate)&&vW(h,i)}function gue(){return null}var dq=typeof reportError=="function"?reportError:function(h){console.error(h)};function R5(h){this._internalRoot=h}wT.prototype.render=R5.prototype.render=function(h){var i=this._internalRoot;if(i===null)throw Error(li(409));xT(h,i,null,null)};wT.prototype.unmount=R5.prototype.unmount=function(){var h=this._internalRoot;if(h!==null){this._internalRoot=null;var i=h.containerInfo;gw(function(){xT(null,h,null,null)}),i[R1]=null}};function wT(h){this._internalRoot=h}wT.prototype.unstable_scheduleHydration=function(h){if(h){var i=WH();h={blockedOn:null,target:h,priority:i};for(var s=0;s<Lb.length&&i!==0&&i<Lb[s].priority;s++);Lb.splice(s,0,h),s===0&&HH(h)}};function P5(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)}function _T(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11&&(h.nodeType!==8||h.nodeValue!==" react-mount-point-unstable "))}function yW(){}function vue(h,i,s,a,r){if(r){if(typeof a=="function"){var c=a;a=function(){var U=nT(S);c.call(U)}}var S=fq(i,a,h,0,null,!1,!1,"",yW);return h._reactRootContainer=S,h[R1]=S.current,QS(h.nodeType===8?h.parentNode:h),gw(),S}for(;r=h.lastChild;)h.removeChild(r);if(typeof a=="function"){var E=a;a=function(){var U=nT(A);E.call(U)}}var A=I5(h,0,!1,null,null,!1,!1,"",yW);return h._reactRootContainer=A,h[R1]=A.current,QS(h.nodeType===8?h.parentNode:h),gw(function(){xT(i,A,s,a)}),A}function ET(h,i,s,a,r){var c=s._reactRootContainer;if(c){var S=c;if(typeof r=="function"){var E=r;r=function(){var A=nT(S);E.call(A)}}xT(i,S,h,r)}else S=vue(s,i,h,r,a);return nT(S)}zH=function(h){switch(h.tag){case 3:var i=h.stateNode;if(i.current.memoizedState.isDehydrated){var s=OS(i.pendingLanes);s!==0&&(t5(i,s|1),Bp(i,cc()),!(Pa&6)&&(f_=cc()+500,nx()))}break;case 13:gw(function(){var a=P1(h,1);if(a!==null){var r=_h();iv(a,h,1,r)}}),F5(h,1)}};n5=function(h){if(h.tag===13){var i=P1(h,134217728);if(i!==null){var s=_h();iv(i,h,134217728,s)}F5(h,134217728)}};UH=function(h){if(h.tag===13){var i=$b(h),s=P1(h,i);if(s!==null){var a=_h();iv(s,h,i,a)}F5(h,i)}};WH=function(){return fs};VH=function(h,i){var s=fs;try{return fs=h,i()}finally{fs=s}};KF=function(h,i,s){switch(i){case"input":if(WF(h,s),i=s.name,s.type==="radio"&&i!=null){for(s=h;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<s.length;i++){var a=s[i];if(a!==h&&a.form===h.form){var r=hT(a);if(!r)throw Error(li(90));xH(a),WF(a,r)}}}break;case"textarea":_H(h,s);break;case"select":i=s.value,i!=null&&J2(h,!!s.multiple,i,!1)}};TH=T5;MH=gw;var yue={usingClientEntryPoint:!1,Events:[pC,W2,hT,AH,OH,T5]},pS={findFiberByHostInstance:rw,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},bue={bundleType:pS.bundleType,version:pS.version,rendererPackageName:pS.rendererPackageName,rendererConfig:pS.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:B1.ReactCurrentDispatcher,findHostInstanceByFiber:function(h){return h=IH(h),h===null?null:h.stateNode},findFiberByHostInstance:pS.findFiberByHostInstance||gue,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var XA=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!XA.isDisabled&&XA.supportsFiber)try{cT=XA.inject(bue),Oy=XA}catch{}}Ym.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=yue;Ym.createPortal=function(h,i){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!P5(i))throw Error(li(200));return mue(h,i,null,s)};Ym.createRoot=function(h,i){if(!P5(h))throw Error(li(299));var s=!1,a="",r=dq;return i!=null&&(i.unstable_strictMode===!0&&(s=!0),i.identifierPrefix!==void 0&&(a=i.identifierPrefix),i.onRecoverableError!==void 0&&(r=i.onRecoverableError)),i=I5(h,1,!1,null,null,s,!1,a,r),h[R1]=i.current,QS(h.nodeType===8?h.parentNode:h),new R5(i)};Ym.findDOMNode=function(h){if(h==null)return null;if(h.nodeType===1)return h;var i=h._reactInternals;if(i===void 0)throw typeof h.render=="function"?Error(li(188)):(h=Object.keys(h).join(","),Error(li(268,h)));return h=IH(i),h=h===null?null:h.stateNode,h};Ym.flushSync=function(h){return gw(h)};Ym.hydrate=function(h,i,s){if(!_T(i))throw Error(li(200));return ET(null,h,i,!0,s)};Ym.hydrateRoot=function(h,i,s){if(!P5(h))throw Error(li(405));var a=s!=null&&s.hydratedSources||null,r=!1,c="",S=dq;if(s!=null&&(s.unstable_strictMode===!0&&(r=!0),s.identifierPrefix!==void 0&&(c=s.identifierPrefix),s.onRecoverableError!==void 0&&(S=s.onRecoverableError)),i=fq(i,null,h,1,s??null,r,!1,c,S),h[R1]=i.current,QS(h),a)for(h=0;h<a.length;h++)s=a[h],r=s._getVersion,r=r(s._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[s,r]:i.mutableSourceEagerHydrationData.push(s,r);return new wT(i)};Ym.render=function(h,i,s){if(!_T(i))throw Error(li(200));return ET(null,h,i,!1,s)};Ym.unmountComponentAtNode=function(h){if(!_T(h))throw Error(li(40));return h._reactRootContainer?(gw(function(){ET(null,null,h,!1,function(){h._reactRootContainer=null,h[R1]=null})}),!0):!1};Ym.unstable_batchedUpdates=T5;Ym.unstable_renderSubtreeIntoContainer=function(h,i,s,a){if(!_T(s))throw Error(li(200));if(h==null||h._reactInternals===void 0)throw Error(li(38));return ET(h,i,s,!1,a)};Ym.version="18.2.0-next-9e3b772b8-20220608";(function(h){function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(s){console.error(s)}}i(),h.exports=Ym})(fH);var bW=fH.exports;RF.createRoot=bW.createRoot,RF.hydrateRoot=bW.hydrateRoot;var hq={exports:{}};(function(h,i){(function(s,a){h.exports=a()})(window,function(){return function(s){var a={};function r(c){if(a[c])return a[c].exports;var S=a[c]={i:c,l:!1,exports:{}};return s[c].call(S.exports,S,S.exports,r),S.l=!0,S.exports}return r.m=s,r.c=a,r.d=function(c,S,E){r.o(c,S)||Object.defineProperty(c,S,{configurable:!1,enumerable:!0,get:E})},r.r=function(c){Object.defineProperty(c,"__esModule",{value:!0})},r.n=function(c){var S=c&&c.__esModule?function(){return c.default}:function(){return c};return r.d(S,"a",S),S},r.o=function(c,S){return Object.prototype.hasOwnProperty.call(c,S)},r.p="/",r(r.s=581)}([function(s,a,r){r.r(a),function(c,S,E,A){r.d(a,"AdadeltaOptimizer",function(){return tt}),r.d(a,"AdagradOptimizer",function(){return ut}),r.d(a,"AdamOptimizer",function(){return Nt}),r.d(a,"AdamaxOptimizer",function(){return Pt}),r.d(a,"Add",function(){return yf}),r.d(a,"AddN",function(){return Bh}),r.d(a,"BroadcastTo",function(){return il}),r.d(a,"DataStorage",function(){return qt}),r.d(a,"Div",function(){return Xo}),r.d(a,"ENV",function(){return H}),r.d(a,"Environment",function(){return W}),r.d(a,"FromPixels",function(){return Zg}),r.d(a,"FusedBatchNorm",function(){return jh}),r.d(a,"Identity",function(){return Ed}),r.d(a,"KernelBackend",function(){return un}),r.d(a,"MaxPoolWithArgmax",function(){return _f}),r.d(a,"MomentumOptimizer",function(){return Yt}),r.d(a,"NonMaxSuppressionV5",function(){return Fl}),r.d(a,"OneHot",function(){return Uh}),r.d(a,"Optimizer",function(){return nt}),r.d(a,"PadV2",function(){return ol}),r.d(a,"RMSPropOptimizer",function(){return gn}),r.d(a,"Rank",function(){return Se}),r.d(a,"Reduction",function(){return es}),r.d(a,"SGDOptimizer",function(){return jt}),r.d(a,"Square",function(){return zh}),r.d(a,"SquaredDifference",function(){return bf}),r.d(a,"Tensor",function(){return Qt}),r.d(a,"TensorBuffer",function(){return qr}),r.d(a,"Tile",function(){return wf}),r.d(a,"Transpose",function(){return xf}),r.d(a,"Variable",function(){return Ct}),r.d(a,"abs",function(){return Ls}),r.d(a,"acos",function(){return al}),r.d(a,"acosh",function(){return qa}),r.d(a,"add",function(){return ha}),r.d(a,"addN",function(){return Ld}),r.d(a,"addStrict",function(){return Af}),r.d(a,"all",function(){return Em}),r.d(a,"any",function(){return Yl}),r.d(a,"argMax",function(){return Uv}),r.d(a,"argMin",function(){return _g}),r.d(a,"asin",function(){return sl}),r.d(a,"asinh",function(){return mc}),r.d(a,"atan",function(){return Sd}),r.d(a,"atan2",function(){return Td}),r.d(a,"atanh",function(){return Cd}),r.d(a,"avgPool",function(){return ip}),r.d(a,"avgPool3d",function(){return _0}),r.d(a,"backend",function(){return Jg}),r.d(a,"backend_util",function(){return si}),r.d(a,"basicLSTMCell",function(){return Vv}),r.d(a,"batchNorm",function(){return Ff}),r.d(a,"batchNorm2d",function(){return Py}),r.d(a,"batchNorm3d",function(){return Gl}),r.d(a,"batchNorm4d",function(){return zd}),r.d(a,"batchNormalization",function(){return go}),r.d(a,"batchNormalization2d",function(){return Ry}),r.d(a,"batchNormalization3d",function(){return Rf}),r.d(a,"batchNormalization4d",function(){return Qh}),r.d(a,"batchToSpaceND",function(){return Jp}),r.d(a,"booleanMaskAsync",function(){return Mv}),r.d(a,"broadcastTo",function(){return Pf}),r.d(a,"browser",function(){return fe}),r.d(a,"buffer",function(){return Ii}),r.d(a,"cast",function(){return Qp}),r.d(a,"ceil",function(){return Rl}),r.d(a,"clipByValue",function(){return tm}),r.d(a,"clone",function(){return Lf}),r.d(a,"complex",function(){return Co}),r.d(a,"concat",function(){return $o}),r.d(a,"concat1d",function(){return Rh}),r.d(a,"concat2d",function(){return Yp}),r.d(a,"concat3d",function(){return gf}),r.d(a,"concat4d",function(){return Ph}),r.d(a,"conv1d",function(){return Iv}),r.d(a,"conv2d",function(){return qd}),r.d(a,"conv2dTranspose",function(){return bg}),r.d(a,"conv3d",function(){return By}),r.d(a,"conv3dTranspose",function(){return x0}),r.d(a,"cos",function(){return gc}),r.d(a,"cosh",function(){return e0}),r.d(a,"cumsum",function(){return Zp}),r.d(a,"customGrad",function(){return G}),r.d(a,"deprecationWarn",function(){return bd}),r.d(a,"depthToSpace",function(){return ng}),r.d(a,"depthwiseConv2d",function(){return b0}),r.d(a,"diag",function(){return Vf}),r.d(a,"disableDeprecationWarnings",function(){return Zm}),r.d(a,"dispose",function(){return zo}),r.d(a,"disposeVariables",function(){return mf}),r.d(a,"div",function(){return aa}),r.d(a,"divNoNan",function(){return cg}),r.d(a,"divStrict",function(){return mr}),r.d(a,"dot",function(){return w0}),r.d(a,"dropout",function(){return V1}),r.d(a,"elu",function(){return Kd}),r.d(a,"enableDebugMode",function(){return Qm}),r.d(a,"enableProdMode",function(){return qu}),r.d(a,"engine",function(){return Hp}),r.d(a,"env",function(){return j}),r.d(a,"equal",function(){return gg}),r.d(a,"equalStrict",function(){return m0}),r.d(a,"erf",function(){return nm}),r.d(a,"exp",function(){return Ef}),r.d(a,"expandDims",function(){return pc}),r.d(a,"expm1",function(){return ig}),r.d(a,"eye",function(){return hl}),r.d(a,"fft",function(){return gl}),r.d(a,"fill",function(){return Rs}),r.d(a,"findBackend",function(){return qp}),r.d(a,"findBackendFactory",function(){return eg}),r.d(a,"floor",function(){return kd}),r.d(a,"floorDiv",function(){return is}),r.d(a,"frame",function(){return Tg}),r.d(a,"fused",function(){return Wn}),r.d(a,"gather",function(){return wm}),r.d(a,"gatherND",function(){return Ag}),r.d(a,"gather_util",function(){return Ku}),r.d(a,"getBackend",function(){return Is}),r.d(a,"getGradient",function(){return q}),r.d(a,"getKernel",function(){return Y}),r.d(a,"getKernelsForBackend",function(){return ae}),r.d(a,"grad",function(){return Of}),r.d(a,"grads",function(){return Nd}),r.d(a,"greater",function(){return g0}),r.d(a,"greaterEqual",function(){return bm}),r.d(a,"greaterEqualStrict",function(){return v0}),r.d(a,"greaterStrict",function(){return vg}),r.d(a,"hammingWindow",function(){return Jd}),r.d(a,"hannWindow",function(){return Tm}),r.d(a,"ifft",function(){return as}),r.d(a,"imag",function(){return Za}),r.d(a,"image",function(){return et}),r.d(a,"inTopKAsync",function(){return A0}),r.d(a,"io",function(){return C}),r.d(a,"irfft",function(){return Om}),r.d(a,"isFinite",function(){return kf}),r.d(a,"isInf",function(){return Od}),r.d(a,"isNaN",function(){return im}),r.d(a,"keep",function(){return Dh}),r.d(a,"leakyRelu",function(){return Cm}),r.d(a,"less",function(){return kv}),r.d(a,"lessEqual",function(){return $l}),r.d(a,"lessEqualStrict",function(){return Ly}),r.d(a,"lessStrict",function(){return Av}),r.d(a,"linalg",function(){return L}),r.d(a,"linspace",function(){return Fh}),r.d(a,"localResponseNormalization",function(){return Am}),r.d(a,"log",function(){return Pl}),r.d(a,"log1p",function(){return rm}),r.d(a,"logSigmoid",function(){return Wh}),r.d(a,"logSoftmax",function(){return Qe}),r.d(a,"logSumExp",function(){return Eg}),r.d(a,"logicalAnd",function(){return rc}),r.d(a,"logicalNot",function(){return Zh}),r.d(a,"logicalOr",function(){return Ud}),r.d(a,"logicalXor",function(){return ql}),r.d(a,"losses",function(){return Yr}),r.d(a,"matMul",function(){return Vc}),r.d(a,"math",function(){return Z}),r.d(a,"max",function(){return E0}),r.d(a,"maxPool",function(){return Hc}),r.d(a,"maxPool3d",function(){return xg}),r.d(a,"maxPoolWithArgmax",function(){return Bv}),r.d(a,"maximum",function(){return Na}),r.d(a,"maximumStrict",function(){return io}),r.d(a,"mean",function(){return pl}),r.d(a,"memory",function(){return Th}),r.d(a,"min",function(){return Sg}),r.d(a,"minimum",function(){return Xu}),r.d(a,"minimumStrict",function(){return Pc}),r.d(a,"mod",function(){return cu}),r.d(a,"modStrict",function(){return Lc}),r.d(a,"moments",function(){return Wv}),r.d(a,"movingAverage",function(){return ml}),r.d(a,"mul",function(){return oa}),r.d(a,"mulStrict",function(){return vc}),r.d(a,"multiRNNCell",function(){return zy}),r.d(a,"multinomial",function(){return ps}),r.d(a,"neg",function(){return Da}),r.d(a,"nextFrame",function(){return Dn}),r.d(a,"norm",function(){return C0}),r.d(a,"notEqual",function(){return xm}),r.d(a,"notEqualStrict",function(){return Ov}),r.d(a,"oneHot",function(){return Uc}),r.d(a,"ones",function(){return Fu}),r.d(a,"onesLike",function(){return _s}),r.d(a,"op",function(){return Lt}),r.d(a,"outerProduct",function(){return Pv}),r.d(a,"pad",function(){return ic}),r.d(a,"pad1d",function(){return Ru}),r.d(a,"pad2d",function(){return ep}),r.d(a,"pad3d",function(){return lg}),r.d(a,"pad4d",function(){return h0}),r.d(a,"pool",function(){return _m}),r.d(a,"pow",function(){return lu}),r.d(a,"powStrict",function(){return bo}),r.d(a,"prelu",function(){return gs}),r.d(a,"print",function(){return ma}),r.d(a,"prod",function(){return Sm}),r.d(a,"profile",function(){return Mh}),r.d(a,"rand",function(){return p0}),r.d(a,"randomGamma",function(){return hg}),r.d(a,"randomNormal",function(){return Cv}),r.d(a,"randomUniform",function(){return pg}),r.d(a,"range",function(){return Rc}),r.d(a,"ready",function(){return Gp}),r.d(a,"real",function(){return xa}),r.d(a,"reciprocal",function(){return Sf}),r.d(a,"registerBackend",function(){return tg}),r.d(a,"registerGradient",function(){return ye}),r.d(a,"registerKernel",function(){return oe}),r.d(a,"relu",function(){return Cg}),r.d(a,"relu6",function(){return S0}),r.d(a,"removeBackend",function(){return Fc}),r.d(a,"reshape",function(){return Ps}),r.d(a,"reverse",function(){return zf}),r.d(a,"reverse1d",function(){return jy}),r.d(a,"reverse2d",function(){return np}),r.d(a,"reverse3d",function(){return rp}),r.d(a,"reverse4d",function(){return Uf}),r.d(a,"rfft",function(){return ap}),r.d(a,"round",function(){return Bs}),r.d(a,"rsqrt",function(){return Cf}),r.d(a,"scalar",function(){return Ar}),r.d(a,"scatterND",function(){return Hv}),r.d(a,"scatter_util",function(){return Hh}),r.d(a,"selu",function(){return km}),r.d(a,"separableConv2d",function(){return Kl}),r.d(a,"serialization",function(){return Le}),r.d(a,"setBackend",function(){return xd}),r.d(a,"setPlatform",function(){return Qg}),r.d(a,"setdiff1dAsync",function(){return Hi}),r.d(a,"sigmoid",function(){return Ad}),r.d(a,"sign",function(){return Vh}),r.d(a,"signal",function(){return k0}),r.d(a,"sin",function(){return om}),r.d(a,"sinh",function(){return am}),r.d(a,"slice",function(){return ms}),r.d(a,"slice1d",function(){return jv}),r.d(a,"slice2d",function(){return op}),r.d(a,"slice3d",function(){return zv}),r.d(a,"slice4d",function(){return wg}),r.d(a,"slice_util",function(){return Dd}),r.d(a,"softmax",function(){return je}),r.d(a,"softplus",function(){return bn}),r.d(a,"spaceToBatchND",function(){return Nl}),r.d(a,"sparseToDense",function(){return Gv}),r.d(a,"spectral",function(){return kg}),r.d(a,"split",function(){return $i}),r.d(a,"sqrt",function(){return uu}),r.d(a,"square",function(){return Bf}),r.d(a,"squaredDifference",function(){return mg}),r.d(a,"squaredDifferenceStrict",function(){return Es}),r.d(a,"squeeze",function(){return Ks}),r.d(a,"stack",function(){return Su}),r.d(a,"step",function(){return tr}),r.d(a,"stft",function(){return Mm}),r.d(a,"stridedSlice",function(){return Yd}),r.d(a,"sub",function(){return Ua}),r.d(a,"subStrict",function(){return Ss}),r.d(a,"sum",function(){return Jl}),r.d(a,"sumOutType",function(){return Rt}),r.d(a,"tan",function(){return js}),r.d(a,"tanh",function(){return vo}),r.d(a,"tensor",function(){return No}),r.d(a,"tensor1d",function(){return au}),r.d(a,"tensor2d",function(){return Eu}),r.d(a,"tensor3d",function(){return Dl}),r.d(a,"tensor4d",function(){return su}),r.d(a,"tensor5d",function(){return Ih}),r.d(a,"tensor6d",function(){return Xp}),r.d(a,"tensor_util",function(){return Mt}),r.d(a,"test_util",function(){return Gd}),r.d(a,"tidy",function(){return qi}),r.d(a,"tile",function(){return Vd}),r.d(a,"time",function(){return Yg}),r.d(a,"topk",function(){return Uy}),r.d(a,"train",function(){return vn}),r.d(a,"transpose",function(){return bt}),r.d(a,"truncatedNormal",function(){return tp}),r.d(a,"unregisterGradient",function(){return pe}),r.d(a,"unregisterKernel",function(){return _e}),r.d(a,"unsortedSegmentSum",function(){return yg}),r.d(a,"unstack",function(){return Lh}),r.d(a,"util",function(){return yr}),r.d(a,"valueAndGrad",function(){return se}),r.d(a,"valueAndGrads",function(){return ne}),r.d(a,"variable",function(){return Kp}),r.d(a,"variableGrads",function(){return N}),r.d(a,"version_core",function(){return Be}),r.d(a,"webgl",function(){return Xe}),r.d(a,"where",function(){return dl}),r.d(a,"whereAsync",function(){return Wd}),r.d(a,"zeros",function(){return uo}),r.d(a,"zerosLike",function(){return vi});var U=function(b,p){return(U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,m){l.__proto__=m}||function(l,m){for(var w in m)m.hasOwnProperty(w)&&(l[w]=m[w])})(b,p)};function B(b,p){function l(){this.constructor=b}U(b,p),b.prototype=p===null?Object.create(p):(l.prototype=p.prototype,new l)}function D(b,p,l,m){return new(l||(l=Promise))(function(w,P){function K(de){try{le(m.next(de))}catch(Ee){P(Ee)}}function ee(de){try{le(m.throw(de))}catch(Ee){P(Ee)}}function le(de){de.done?w(de.value):new l(function(Ee){Ee(de.value)}).then(K,ee)}le((m=m.apply(b,p||[])).next())})}function R(b,p){var l,m,w,P,K={label:0,sent:function(){if(1&w[0])throw w[1];return w[1]},trys:[],ops:[]};return P={next:ee(0),throw:ee(1),return:ee(2)},typeof Symbol=="function"&&(P[Symbol.iterator]=function(){return this}),P;function ee(le){return function(de){return function(Ee){if(l)throw new TypeError("Generator is already executing.");for(;K;)try{if(l=1,m&&(w=2&Ee[0]?m.return:Ee[0]?m.throw||((w=m.return)&&w.call(m),0):m.next)&&!(w=w.call(m,Ee[1])).done)return w;switch(m=0,w&&(Ee=[2&Ee[0],w.value]),Ee[0]){case 0:case 1:w=Ee;break;case 4:return K.label++,{value:Ee[1],done:!1};case 5:K.label++,m=Ee[1],Ee=[0];continue;case 7:Ee=K.ops.pop(),K.trys.pop();continue;default:if(!(w=(w=K.trys).length>0&&w[w.length-1])&&(Ee[0]===6||Ee[0]===2)){K=0;continue}if(Ee[0]===3&&(!w||Ee[1]>w[0]&&Ee[1]<w[3])){K.label=Ee[1];break}if(Ee[0]===6&&K.label<w[1]){K.label=w[1],w=Ee;break}if(w&&K.label<w[2]){K.label=w[2],K.ops.push(Ee);break}w[2]&&K.ops.pop(),K.trys.pop();continue}Ee=p.call(b,K)}catch(Te){Ee=[6,Te],m=0}finally{l=w=0}if(5&Ee[0])throw Ee[1];return{value:Ee[0]?Ee[1]:void 0,done:!0}}([le,de])}}}var W=function(){function b(p){this.global=p,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return b.prototype.setPlatform=function(p,l){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+l+"."),this.platformName=p,this.platform=l},b.prototype.registerFlag=function(p,l,m){if(this.flagRegistry[p]={evaluationFn:l,setHook:m},this.urlFlags[p]!=null){var w=this.urlFlags[p];console.warn("Setting feature override from URL "+p+": "+w+"."),this.set(p,w)}},b.prototype.get=function(p){return p in this.flags?this.flags[p]:(this.flags[p]=this.evaluateFlag(p),this.flags[p])},b.prototype.getNumber=function(p){return this.get(p)},b.prototype.getBool=function(p){return this.get(p)},b.prototype.getFlags=function(){return this.flags},Object.defineProperty(b.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),b.prototype.set=function(p,l){if(this.flagRegistry[p]==null)throw new Error("Cannot set flag "+p+" as it has not been registered.");this.flags[p]=l,this.flagRegistry[p].setHook!=null&&this.flagRegistry[p].setHook(l)},b.prototype.evaluateFlag=function(p){if(this.flagRegistry[p]==null)throw new Error("Cannot evaluate flag '"+p+"': no evaluation function found.");return this.flagRegistry[p].evaluationFn()},b.prototype.setFlags=function(p){this.flags=Object.assign({},p)},b.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},b.prototype.populateURLFlags=function(){var p=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var l,m,w=(l=this.global.location.search,m={},l.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(P){for(var K=[],ee=1;ee<arguments.length;ee++)K[ee-1]=arguments[ee];return function(le,de,Ee){le[decodeURIComponent(de)]=decodeURIComponent(Ee||"")}(m,K[0],K[1]),K.join("=")}),m);"tfjsflags"in w&&w.tfjsflags.split(",").forEach(function(P){var K=P.split(":"),ee=K[0],le=K[1];p.urlFlags[ee]=function(de,Ee){if((Ee=Ee.toLowerCase())==="true"||Ee==="false")return Ee==="true";if(""+ +Ee===Ee)return+Ee;throw new Error("Could not parse value flag value "+Ee+" for flag "+de+".")}(ee,le)})}},b}();function j(){return H}var H=null,I=new Map,Q=new Map;function Y(b,p){var l=me(b,p);return I.get(l)}function q(b){return Q.get(b)}function ae(b){for(var p=I.entries(),l=[];;){var m=p.next(),w=m.done,P=m.value;if(w)break;var K=P[0],ee=P[1];K.split("_")[0]===b&&l.push(ee)}return l}function oe(b){var p=b.kernelName,l=b.backendName,m=me(p,l);if(I.has(m))throw new Error("The kernel '"+p+"' for backend '"+l+"' is already registered");I.set(m,b)}function ye(b){var p=b.kernelName;Q.has(p)&&console.warn("Overriding the gradient for '"+p+"'"),Q.set(p,b)}function _e(b,p){var l=me(b,p);if(!I.has(l))throw new Error("The kernel '"+b+"' for backend '"+p+"' is not registered");I.delete(l)}function pe(b){if(!Q.has(b))throw new Error("The gradient '"+b+"' for backend is not registered");Q.delete(b)}function me(b,p){return p+"_"+b}function Ge(b){for(var p=b.length,l=0,m=0;p>0;)m=Math.random()*p|0,l=b[--p],b[p]=b[m],b[m]=l}function lt(b,p,l){return Math.max(b,Math.min(p,l))}function It(b){return b%2==0?b:b+1}function wt(b){for(var p=0,l=0;l<b.length;l++)p+=b[l];return p}function we(b,p){if(!b)throw new Error(typeof p=="string"?p:p())}function yt(b,p,l){l===void 0&&(l=""),we(Ut(b,p),function(){return l+" Shapes "+b+" and "+p+" must match"})}function Bt(b){we(b!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Ot(b,p,l){if(p===void 0&&(p=[]),l===void 0&&(l=!1),p==null&&(p=[]),Array.isArray(b)||ft(b)&&!l)for(var m=0;m<b.length;++m)Ot(b[m],p,l);else p.push(b);return p}function ze(b){if(b.length===0)return 1;for(var p=b[0],l=1;l<b.length;l++)p*=b[l];return p}function Ut(b,p){if(b===p)return!0;if(b==null||p==null||b.length!==p.length)return!1;for(var l=0;l<b.length;l++)if(b[l]!==p[l])return!1;return!0}function Ft(b){return b%1==0}function pt(b){if(Math.tanh!=null)return Math.tanh(b);if(b===1/0)return 1;if(b===-1/0)return-1;var p=Math.exp(2*b);return(p-1)/(p+1)}function vt(b){var p=Math.ceil(Math.sqrt(b));return[p,Math.ceil(b/p)]}function rn(b,p){return p<=b.length?b:b+" ".repeat(p-b.length)}function xt(b,p,l){return p===void 0&&(p=function(m){return 0}),new Promise(function(m,w){var P=0,K=function(){if(b())m();else{var ee=p(++P);l!=null&&P>=l?w():setTimeout(K,ee)}};K()})}function _t(b,p){for(var l=1,m=-1,w=0;w<b.length;++w)if(b[w]>=0)l*=b[w];else if(b[w]===-1){if(m!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+m+" and dim "+w);m=w}else if(b[w]<0)throw Error("Shapes can not be < 0. Found "+b[w]+" at dim "+w);if(m===-1){if(p>0&&p!==l)throw Error("Size("+p+") must match the product of shape "+b);return b}if(l===0)throw Error("Cannot infer the missing size in ["+b+"] when there are 0 elements");if(p%l!=0)throw Error("The implicit shape can't be a fractional number. Got "+p+" / "+l);var P=b.slice();return P[m]=p/l,P}function Xt(b,p){var l=p.length;return we((b=b==null?p.map(function(m,w){return w}):[].concat(b)).every(function(m){return m>=-l&&m<l}),function(){return"All values in axis param must be in range [-"+l+", "+l+") but got axis "+b}),we(b.every(function(m){return Ft(m)}),function(){return"All values in axis param must be integers but got axis "+b}),b.map(function(m){return m<0?l+m:m})}function sn(b,p){for(var l=[],m=[],w=p!=null&&Array.isArray(p)&&p.length===0,P=p==null||w?null:Xt(p,b).sort(),K=0,ee=0;ee<b.length;++ee){if(P!=null){if(P[K]===ee&&b[ee]!==1)throw new Error("Can't squeeze axis "+ee+" since its dim '"+b[ee]+"' is not 1");(P[K]==null||P[K]>ee)&&b[ee]===1&&(l.push(b[ee]),m.push(ee)),P[K]<=ee&&K++}b[ee]!==1&&(l.push(b[ee]),m.push(ee))}return{newShape:l,keptDims:m}}function kn(b,p){var l=null;if(b==null||b==="float32")l=new Float32Array(p);else if(b==="int32")l=new Int32Array(p);else{if(b!=="bool")throw new Error("Unknown data type "+b);l=new Uint8Array(p)}return l}function an(b,p){var l=null;if(b==null||b==="float32")l=new Float32Array(p);else if(b==="int32")l=new Int32Array(p);else if(b==="bool")l=new Uint8Array(p);else{if(b!=="string")throw new Error("Unknown data type "+b);l=new Array(p)}return l}function Ve(b,p){for(var l=0;l<b.length;l++){var m=b[l];if(isNaN(m)||!isFinite(m))throw Error("A tensor of type "+p+" being uploaded contains "+m+".")}}function Ye(b){return b==="bool"||b==="complex64"||b==="float32"||b==="int32"||b==="string"}function $e(b,p){return!(p==="complex64"||p==="float32"&&b!=="complex64"||p==="int32"&&b!=="float32"&&b!=="complex64"||p==="bool"&&b==="bool")}function ft(b){return b instanceof Float32Array||b instanceof Int32Array||b instanceof Uint8Array}function $t(b){if(b==="float32"||b==="int32")return 4;if(b==="complex64")return 8;if(b==="bool")return 1;throw new Error("Unknown dtype "+b)}function Jt(b){if(b==null)return 0;var p=0;return b.forEach(function(l){return p+=l.length}),p}function Pn(b){return typeof b=="string"||b instanceof String}function An(b){return typeof b=="boolean"}function Qn(b){return typeof b=="number"}function Ce(b){return Array.isArray(b)?Ce(b[0]):b instanceof Float32Array?"float32":b instanceof Int32Array||b instanceof Uint8Array?"int32":Qn(b)?"float32":Pn(b)?"string":An(b)?"bool":"float32"}function sr(b){return!!(b&&b.constructor&&b.call&&b.apply)}function Mr(b,p){for(var l=p;l<b;++l)if(b%l==0)return l;return b}function on(b){var p=b.length;if(p<2)return[];var l=new Array(p-1);l[p-2]=b[p-1];for(var m=p-3;m>=0;--m)l[m]=l[m+1]*b[m+1];return l}function Gt(b,p,l){if(p==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(b)&&(b=Ot(b)),l&&Ve(b,p),function(P,K){return P instanceof Float32Array&&K==="float32"||P instanceof Int32Array&&K==="int32"||P instanceof Uint8Array&&K==="bool"}(b,p))return b;if(p==null||p==="float32"||p==="complex64")return new Float32Array(b);if(p==="int32")return new Int32Array(b);if(p==="bool"){for(var m=new Uint8Array(b.length),w=0;w<m.length;++w)Math.round(b[w])!==0&&(m[w]=1);return m}throw new Error("Unknown data type "+p)}function Hn(b,p){if(b.length===0)return p[0];var l=b.reduce(function(m,w){return m*w});if(l===0)return[];if(l!==p.length)throw new Error("["+b+"] does not match the input size.");return function m(w,P,K){var ee=new Array;if(P.length===1)for(var le=P[0],de=0;de<le;de++)ee[de]=K[w+de];else{le=P[0];var Ee=P.slice(1),Te=Ee.reduce(function(Ne,Fe){return Ne*Fe});for(de=0;de<le;de++)ee[de]=m(w+de*Te,Ee,K)}return ee}(0,b,p)}function Kt(b,p){for(var l=Vt(b,p),m=0;m<l.length;m++)l[m]=1;return l}function Vt(b,p){if(p==null||p==="float32"||p==="complex64")return new Float32Array(b);if(p==="int32")return new Int32Array(b);if(p==="bool")return new Uint8Array(b);throw new Error("Unknown data type "+p)}function en(){return j().platform.now()}function Vn(b){b.forEach(function(p){we(Number.isInteger(p)&&p>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+b+"]."})})}function Dt(b,p){return p===void 0&&(p="utf-8"),p=p||"utf-8",j().platform.encode(b,p)}function On(b,p){return p===void 0&&(p="utf-8"),p=p||"utf-8",j().platform.decode(b,p)}function or(b,p,l){if(p===0)return 0;if(p===1)return b[0];for(var m=b[b.length-1],w=0;w<b.length-1;++w)m+=l[w]*b[w];return m}function ar(b,p,l){if(p===0)return[];if(p===1)return[b];for(var m=new Array(p),w=0;w<m.length-1;++w)m[w]=Math.floor(b/l[w]),b-=m[w]*l[w];return m[m.length-1]=b,m}var yr=Object.freeze({shuffle:Ge,clamp:lt,nearestLargerEven:It,sum:wt,randUniform:function(b,p){var l=Math.random();return p*l+(1-l)*b},distSquared:function(b,p){for(var l=0,m=0;m<b.length;m++){var w=Number(b[m])-Number(p[m]);l+=w*w}return l},assert:we,assertShapesMatch:yt,assertNonNull:Bt,flatten:Ot,sizeFromShape:ze,isScalarShape:function(b){return b.length===0},arraysEqual:Ut,isInt:Ft,tanh:pt,sizeToSquarishShape:vt,createShuffledIndices:function(b){for(var p=new Uint32Array(b),l=0;l<b;++l)p[l]=l;return Ge(p),p},rightPad:rn,repeatedTry:xt,inferFromImplicitShape:_t,parseAxisParam:Xt,squeezeShape:sn,getTypedArrayFromDType:kn,getArrayFromDType:an,checkConversionForErrors:Ve,isValidDtype:Ye,hasEncodingLoss:$e,isTypedArray:ft,bytesPerElement:$t,bytesFromStringArray:Jt,isString:Pn,isBoolean:An,isNumber:Qn,inferDtype:Ce,isFunction:sr,nearestDivisor:Mr,computeStrides:on,toTypedArray:Gt,toNestedArray:Hn,makeOnesTypedArray:Kt,makeZerosTypedArray:Vt,now:en,assertNonNegativeIntegerDimensions:Vn,fetch:function(b,p){return j().platform.fetch(b,p)},encodeString:Dt,decodeString:On,locToIndex:or,indexToLoc:ar}),kr=function(){function b(p,l){this.backendTimer=p,this.logger=l,l==null&&(this.logger=new dr)}return b.prototype.profileKernel=function(p,l,m){var w,P=this,K=this.backendTimer.time(function(){w=m()});return w.forEach(function(ee){ee.data().then(function(le){(function(de,Ee,Te){if(Ee!=="float32")return!1;for(var Ne=0;Ne<de.length;Ne++){var Fe=de[Ne];if(isNaN(Fe)||!isFinite(Fe))return console.warn("Found "+Fe+" in the result of '"+Te+"'"),!0}})(le,ee.dtype,p),K.then(function(de){var Ee="";de.getExtraProfileInfo!=null&&(Ee=de.getExtraProfileInfo()),P.logger.logKernelProfile(p,ee,le,de.kernelMs,l,Ee)})})}),w},b}(),dr=function(){function b(){}return b.prototype.logKernelProfile=function(p,l,m,w,P,K){var ee=typeof w=="number"?rn(w+"ms",9):w.error,le=rn(p,25),de=l.rank,Ee=l.size,Te=rn(l.shape.toString(),14),Ne="";for(var Fe in P){var qe=P[Fe].shape||l.shape,Je=qe.length;Ne+=Fe+": "+Je+"D "+(Je>0?qe:"")+" "}console.log("%c"+le+"	%c"+ee+"	%c"+de+"D "+Te+"	%c"+Ee+"	%c"+Ne+"	%c"+K,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},b}(),oi=20,Ur=3,Xr=7;function zn(b,p,l){return rn(Array.isArray(b)?parseFloat(b[0].toFixed(Xr))+" + "+parseFloat(b[1].toFixed(Xr))+"j":Pn(b)?"'"+b+"'":l==="bool"?ir(b):parseFloat(b.toFixed(Xr)).toString(),p)}function ir(b){return b===0?"false":"true"}function Or(b){for(var p=[],l=0;l<b.length;l+=2)p.push([b[l],b[l+1]]);return p}var qr=function(){function b(p,l,m){var w=this;if(this.dtype=l,this.shape=p.slice(),this.size=ze(p),m!=null){var P=m.length;we(P===this.size,function(){return"Length of values '"+P+"' does not match the size inferred by the shape '"+w.size+"'."})}if(l==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=m||an(l,this.size),this.strides=on(p)}return b.prototype.set=function(p){for(var l=this,m=[],w=1;w<arguments.length;w++)m[w-1]=arguments[w];m.length===0&&(m=[0]),we(m.length===this.rank,function(){return"The number of provided coordinates ("+m.length+") must match the rank ("+l.rank+")"});var P=this.locToIndex(m);this.values[P]=p},b.prototype.get=function(){for(var p=[],l=0;l<arguments.length;l++)p[l]=arguments[l];p.length===0&&(p=[0]);for(var m=0,w=0,P=p;w<P.length;w++){var K=P[w];if(K<0||K>=this.shape[m]){var ee="Requested out of range element at "+p+".   Buffer shape="+this.shape;throw new Error(ee)}m++}for(var le=p[p.length-1],de=0;de<p.length-1;++de)le+=this.strides[de]*p[de];return this.values[le]},b.prototype.locToIndex=function(p){if(this.rank===0)return 0;if(this.rank===1)return p[0];for(var l=p[p.length-1],m=0;m<p.length-1;++m)l+=this.strides[m]*p[m];return l},b.prototype.indexToLoc=function(p){if(this.rank===0)return[];if(this.rank===1)return[p];for(var l=new Array(this.shape.length),m=0;m<l.length-1;++m)l[m]=Math.floor(p/this.strides[m]),p-=l[m]*this.strides[m];return l[l.length-1]=p,l},Object.defineProperty(b.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),b.prototype.toTensor=function(){return Kr().makeTensor(this.values,this.shape,this.dtype)},b}(),Kr=null,Tt=null,Rr=null,Qt=function(){function b(p,l,m,w){this.kept=!1,this.isDisposedInternal=!1,this.shape=p.slice(),this.dtype=l||"float32",this.size=ze(p),this.strides=on(p),this.dataId=m,this.id=w,this.rankType=this.rank<5?this.rank.toString():"higher"}return b.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},b.prototype.asScalar=function(){return this.throwIfDisposed(),we(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},b.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},b.prototype.as2D=function(p,l){return this.throwIfDisposed(),this.reshape([p,l])},b.prototype.as3D=function(p,l,m){return this.throwIfDisposed(),this.reshape([p,l,m])},b.prototype.as4D=function(p,l,m,w){return this.throwIfDisposed(),this.reshape([p,l,m,w])},b.prototype.as5D=function(p,l,m,w,P){return this.throwIfDisposed(),this.reshape([p,l,m,w,P])},b.prototype.asType=function(p){return this.throwIfDisposed(),Tt.cast(this,p)},Object.defineProperty(b.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),b.prototype.buffer=function(){return D(this,void 0,void 0,function(){var p;return R(this,function(l){switch(l.label){case 0:return[4,this.data()];case 1:return p=l.sent(),[2,Tt.buffer(this.shape,this.dtype,p)]}})})},b.prototype.bufferSync=function(){return Tt.buffer(this.shape,this.dtype,this.dataSync())},b.prototype.array=function(){return D(this,void 0,void 0,function(){var p;return R(this,function(l){switch(l.label){case 0:return[4,this.data()];case 1:return p=l.sent(),[2,Hn(this.shape,p)]}})})},b.prototype.arraySync=function(){return Hn(this.shape,this.dataSync())},b.prototype.data=function(){return D(this,void 0,void 0,function(){var p,l;return R(this,function(m){switch(m.label){case 0:return this.throwIfDisposed(),p=Kr().read(this.dataId),this.dtype!=="string"?[3,2]:[4,p];case 1:l=m.sent();try{return[2,l.map(function(w){return On(w)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}m.label=2;case 2:return[2,p]}})})},b.prototype.dataSync=function(){this.throwIfDisposed();var p=Kr().readSync(this.dataId);if(this.dtype==="string")try{return p.map(function(l){return On(l)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return p},b.prototype.bytes=function(){return D(this,void 0,void 0,function(){var p;return R(this,function(l){switch(l.label){case 0:return this.throwIfDisposed(),[4,Kr().read(this.dataId)];case 1:return p=l.sent(),this.dtype==="string"?[2,p]:[2,new Uint8Array(p.buffer)]}})})},b.prototype.dispose=function(){this.isDisposed||(Kr().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(b.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),b.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},b.prototype.toFloat=function(){return this.asType("float32")},b.prototype.toInt=function(){return this.asType("int32")},b.prototype.toBool=function(){return this.asType("bool")},b.prototype.print=function(p){return p===void 0&&(p=!1),Tt.print(this,p)},b.prototype.reshape=function(p){return this.throwIfDisposed(),Tt.reshape(this,p)},b.prototype.reshapeAs=function(p){return this.throwIfDisposed(),this.reshape(p.shape)},b.prototype.expandDims=function(p){return p===void 0&&(p=0),Tt.expandDims(this,p)},b.prototype.cumsum=function(p,l,m){return p===void 0&&(p=0),l===void 0&&(l=!1),m===void 0&&(m=!1),Tt.cumsum(this,p,l,m)},b.prototype.squeeze=function(p){return this.throwIfDisposed(),Tt.squeeze(this,p)},b.prototype.clone=function(){return this.throwIfDisposed(),Tt.clone(this)},b.prototype.toString=function(p){return p===void 0&&(p=!1),function(l,m,w,P){var K=on(m),ee=function(Te,Ne,Fe,qe){var Je=ze(Ne),Ke=qe[qe.length-1],it=new Array(Ke).fill(0),gt=Ne.length,Et=Fe==="complex64"?Or(Te):Te;if(gt>1)for(var At=0;At<Je/Ke;At++)for(var Wt=At*Ke,cn=0;cn<Ke;cn++)it[cn]=Math.max(it[cn],zn(Et[Wt+cn],0,Fe).length);return it}(l,m,w,K),le=m.length,de=function Te(Ne,Fe,qe,Je,Ke,it){it===void 0&&(it=!0);var gt=qe==="complex64"?2:1,Et=Fe[0],At=Fe.length;if(At===0)return qe==="complex64"?[zn(Or(Ne)[0],0,qe)]:qe==="bool"?[ir(Ne[0])]:[Ne[0].toString()];if(At===1){if(Et>oi){var Wt=Ur*gt,cn=Array.from(Ne.slice(0,Wt)),pn=Array.from(Ne.slice((Et-Ur)*gt,Et*gt));return qe==="complex64"&&(cn=Or(cn),pn=Or(pn)),["["+cn.map(function(wr,vr){return zn(wr,Ke[vr],qe)}).join(", ")+", ..., "+pn.map(function(wr,vr){return zn(wr,Ke[Et-Ur+vr],qe)}).join(", ")+"]"]}return["["+(qe==="complex64"?Or(Ne):Array.from(Ne)).map(function(wr,vr){return zn(wr,Ke[vr],qe)}).join(", ")+"]"]}var ln=Fe.slice(1),dn=Je.slice(1),Nn=Je[0]*gt,jn=[];if(Et>oi){for(var Ln=0;Ln<Ur;Ln++){var ur=(hr=Ln*Nn)+Nn;jn.push.apply(jn,Te(Ne.slice(hr,ur),ln,qe,dn,Ke,!1))}for(jn.push("..."),Ln=Et-Ur;Ln<Et;Ln++)ur=(hr=Ln*Nn)+Nn,jn.push.apply(jn,Te(Ne.slice(hr,ur),ln,qe,dn,Ke,Ln===Et-1))}else for(Ln=0;Ln<Et;Ln++){var hr;ur=(hr=Ln*Nn)+Nn,jn.push.apply(jn,Te(Ne.slice(hr,ur),ln,qe,dn,Ke,Ln===Et-1))}var xr=At===2?",":"";for(jn[0]="["+jn[0]+xr,Ln=1;Ln<jn.length-1;Ln++)jn[Ln]=" "+jn[Ln]+xr;var Er=`,
`;for(Ln=2;Ln<At;Ln++)Er+=`
`;return jn[jn.length-1]=" "+jn[jn.length-1]+"]"+(it?"":Er),jn}(l,m,w,K,ee),Ee=["Tensor"];return P&&(Ee.push("  dtype: "+w),Ee.push("  rank: "+le),Ee.push("  shape: ["+m+"]"),Ee.push("  values:")),Ee.push(de.map(function(Te){return"    "+Te}).join(`
`)),Ee.join(`
`)}(this.dataSync(),this.shape,this.dtype,p)},b.prototype.gather=function(p,l){return l===void 0&&(l=0),this.throwIfDisposed(),Tt.gather(this,p,l)},b.prototype.matMul=function(p,l,m){return l===void 0&&(l=!1),m===void 0&&(m=!1),this.throwIfDisposed(),Tt.matMul(this,p,l,m)},b.prototype.dot=function(p){return this.throwIfDisposed(),Tt.dot(this,p)},b.prototype.norm=function(p,l,m){return p===void 0&&(p="euclidean"),l===void 0&&(l=null),m===void 0&&(m=!1),this.throwIfDisposed(),Tt.norm(this,p,l,m)},b.prototype.slice=function(p,l){return this.throwIfDisposed(),Tt.slice(this,p,l)},b.prototype.reverse=function(p){return this.throwIfDisposed(),Tt.reverse(this,p)},b.prototype.concat=function(p,l){return l===void 0&&(l=0),this.throwIfDisposed(),p instanceof b&&(p=[p]),Tt.concat([this].concat(p),l)},b.prototype.split=function(p,l){return l===void 0&&(l=0),this.throwIfDisposed(),Tt.split(this,p,l)},b.prototype.stack=function(p,l){return l===void 0&&(l=0),Tt.stack([this,p],l)},b.prototype.unstack=function(p){return p===void 0&&(p=0),Tt.unstack(this,p)},b.prototype.batchNormalization=function(p,l,m,w,P){return m===void 0&&(m=.001),Rr("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(p,l,P,w,m)},b.prototype.all=function(p,l){return p===void 0&&(p=null),l===void 0&&(l=!1),this.throwIfDisposed(),Tt.all(this,p,l)},b.prototype.any=function(p,l){return p===void 0&&(p=null),l===void 0&&(l=!1),this.throwIfDisposed(),Tt.any(this,p,l)},b.prototype.logSumExp=function(p,l){return p===void 0&&(p=null),l===void 0&&(l=!1),this.throwIfDisposed(),Tt.logSumExp(this,p,l)},b.prototype.sum=function(p,l){return p===void 0&&(p=null),l===void 0&&(l=!1),this.throwIfDisposed(),Tt.sum(this,p,l)},b.prototype.prod=function(p,l){return p===void 0&&(p=null),l===void 0&&(l=!1),this.throwIfDisposed(),Tt.prod(this,p,l)},b.prototype.mean=function(p,l){return p===void 0&&(p=null),l===void 0&&(l=!1),this.throwIfDisposed(),Tt.mean(this,p,l)},b.prototype.min=function(p,l){return p===void 0&&(p=null),l===void 0&&(l=!1),this.throwIfDisposed(),Tt.min(this,p,l)},b.prototype.max=function(p,l){return p===void 0&&(p=null),l===void 0&&(l=!1),this.throwIfDisposed(),Tt.max(this,p,l)},b.prototype.argMin=function(p){return p===void 0&&(p=null),this.throwIfDisposed(),Tt.argMin(this,p)},b.prototype.argMax=function(p){return p===void 0&&(p=null),this.throwIfDisposed(),Tt.argMax(this,p)},b.prototype.cast=function(p){return this.throwIfDisposed(),Tt.cast(this,p)},b.prototype.addStrict=function(p){return this.throwIfDisposed(),Tt.addStrict(this,p)},b.prototype.atan2=function(p){return this.throwIfDisposed(),Tt.atan2(this,p)},b.prototype.sub=function(p){return this.throwIfDisposed(),Tt.sub(this,p)},b.prototype.subStrict=function(p){return this.throwIfDisposed(),Tt.subStrict(this,p)},b.prototype.pow=function(p){return this.throwIfDisposed(),Tt.pow(this,p)},b.prototype.powStrict=function(p){return this.throwIfDisposed(),Tt.powStrict(this,p)},b.prototype.mul=function(p){return this.throwIfDisposed(),Tt.mul(this,p)},b.prototype.mulStrict=function(p){return this.throwIfDisposed(),Tt.mulStrict(this,p)},b.prototype.floorDiv=function(p){return this.throwIfDisposed(),Tt.floorDiv(this,p)},b.prototype.divStrict=function(p){return this.throwIfDisposed(),Tt.divStrict(this,p)},b.prototype.minimum=function(p){return this.throwIfDisposed(),Tt.minimum(this,p)},b.prototype.minimumStrict=function(p){return this.throwIfDisposed(),Tt.minimumStrict(this,p)},b.prototype.maximum=function(p){return this.throwIfDisposed(),Tt.maximum(this,p)},b.prototype.maximumStrict=function(p){return this.throwIfDisposed(),Tt.maximumStrict(this,p)},b.prototype.mod=function(p){return this.throwIfDisposed(),Tt.mod(this,p)},b.prototype.modStrict=function(p){return this.throwIfDisposed(),Tt.modStrict(this,p)},b.prototype.squaredDifferenceStrict=function(p){return this.throwIfDisposed(),Tt.squaredDifferenceStrict(this,p)},b.prototype.notEqual=function(p){return this.throwIfDisposed(),Tt.notEqual(this,p)},b.prototype.notEqualStrict=function(p){return this.throwIfDisposed(),Tt.notEqualStrict(this,p)},b.prototype.less=function(p){return this.throwIfDisposed(),Tt.less(this,p)},b.prototype.lessStrict=function(p){return this.throwIfDisposed(),Tt.lessStrict(this,p)},b.prototype.equal=function(p){return this.throwIfDisposed(),Tt.equal(this,p)},b.prototype.equalStrict=function(p){return this.throwIfDisposed(),Tt.equalStrict(this,p)},b.prototype.lessEqual=function(p){return this.throwIfDisposed(),Tt.lessEqual(this,p)},b.prototype.lessEqualStrict=function(p){return this.throwIfDisposed(),Tt.lessEqualStrict(this,p)},b.prototype.greater=function(p){return this.throwIfDisposed(),Tt.greater(this,p)},b.prototype.greaterStrict=function(p){return this.throwIfDisposed(),Tt.greaterStrict(this,p)},b.prototype.greaterEqual=function(p){return this.throwIfDisposed(),Tt.greaterEqual(this,p)},b.prototype.greaterEqualStrict=function(p){return this.throwIfDisposed(),Tt.greaterEqualStrict(this,p)},b.prototype.logicalAnd=function(p){return this.throwIfDisposed(),Tt.logicalAnd(this,p)},b.prototype.logicalOr=function(p){return this.throwIfDisposed(),Tt.logicalOr(this,p)},b.prototype.logicalNot=function(){return this.throwIfDisposed(),Tt.logicalNot(this)},b.prototype.logicalXor=function(p){return this.throwIfDisposed(),Tt.logicalXor(this,p)},b.prototype.where=function(p,l){return this.throwIfDisposed(),Tt.where(p,this,l)},b.prototype.neg=function(){return this.throwIfDisposed(),Tt.neg(this)},b.prototype.ceil=function(){return this.throwIfDisposed(),Tt.ceil(this)},b.prototype.floor=function(){return this.throwIfDisposed(),Tt.floor(this)},b.prototype.sign=function(){return this.throwIfDisposed(),Tt.sign(this)},b.prototype.isNaN=function(){return this.throwIfDisposed(),Tt.isNaN(this)},b.prototype.isInf=function(){return this.throwIfDisposed(),Tt.isInf(this)},b.prototype.isFinite=function(){return this.throwIfDisposed(),Tt.isFinite(this)},b.prototype.exp=function(){return this.throwIfDisposed(),Tt.exp(this)},b.prototype.expm1=function(){return this.throwIfDisposed(),Tt.expm1(this)},b.prototype.log=function(){return this.throwIfDisposed(),Tt.log(this)},b.prototype.log1p=function(){return this.throwIfDisposed(),Tt.log1p(this)},b.prototype.sqrt=function(){return this.throwIfDisposed(),Tt.sqrt(this)},b.prototype.rsqrt=function(){return this.throwIfDisposed(),Tt.rsqrt(this)},b.prototype.square=function(){return this.throwIfDisposed(),Tt.square(this)},b.prototype.reciprocal=function(){return this.throwIfDisposed(),Tt.reciprocal(this)},b.prototype.abs=function(){return this.throwIfDisposed(),Tt.abs(this)},b.prototype.clipByValue=function(p,l){return this.throwIfDisposed(),Tt.clipByValue(this,p,l)},b.prototype.relu=function(){return this.throwIfDisposed(),Tt.relu(this)},b.prototype.relu6=function(){return this.throwIfDisposed(),Tt.relu6(this)},b.prototype.elu=function(){return this.throwIfDisposed(),Tt.elu(this)},b.prototype.selu=function(){return this.throwIfDisposed(),Tt.selu(this)},b.prototype.leakyRelu=function(p){return p===void 0&&(p=.2),this.throwIfDisposed(),Tt.leakyRelu(this,p)},b.prototype.prelu=function(p){return this.throwIfDisposed(),Tt.prelu(this,p)},b.prototype.sigmoid=function(){return this.throwIfDisposed(),Tt.sigmoid(this)},b.prototype.logSigmoid=function(){return this.throwIfDisposed(),Tt.logSigmoid(this)},b.prototype.softplus=function(){return this.throwIfDisposed(),Tt.softplus(this)},b.prototype.zerosLike=function(){return this.throwIfDisposed(),Tt.zerosLike(this)},b.prototype.onesLike=function(){return this.throwIfDisposed(),Tt.onesLike(this)},b.prototype.sin=function(){return this.throwIfDisposed(),Tt.sin(this)},b.prototype.cos=function(){return this.throwIfDisposed(),Tt.cos(this)},b.prototype.tan=function(){return this.throwIfDisposed(),Tt.tan(this)},b.prototype.asin=function(){return this.throwIfDisposed(),Tt.asin(this)},b.prototype.acos=function(){return this.throwIfDisposed(),Tt.acos(this)},b.prototype.atan=function(){return this.throwIfDisposed(),Tt.atan(this)},b.prototype.sinh=function(){return this.throwIfDisposed(),Tt.sinh(this)},b.prototype.cosh=function(){return this.throwIfDisposed(),Tt.cosh(this)},b.prototype.tanh=function(){return this.throwIfDisposed(),Tt.tanh(this)},b.prototype.asinh=function(){return this.throwIfDisposed(),Tt.asinh(this)},b.prototype.acosh=function(){return this.throwIfDisposed(),Tt.acosh(this)},b.prototype.atanh=function(){return this.throwIfDisposed(),Tt.atanh(this)},b.prototype.erf=function(){return this.throwIfDisposed(),Tt.erf(this)},b.prototype.round=function(){return this.throwIfDisposed(),Tt.round(this)},b.prototype.step=function(p){return p===void 0&&(p=0),this.throwIfDisposed(),Tt.step(this,p)},b.prototype.softmax=function(p){return p===void 0&&(p=-1),this.throwIfDisposed(),Tt.softmax(this,p)},b.prototype.logSoftmax=function(p){return p===void 0&&(p=-1),this.throwIfDisposed(),Tt.logSoftmax(this,p)},b.prototype.resizeBilinear=function(p,l){return l===void 0&&(l=!1),this.throwIfDisposed(),Tt.image.resizeBilinear(this,p,l)},b.prototype.resizeNearestNeighbor=function(p,l){return l===void 0&&(l=!1),this.throwIfDisposed(),Tt.image.resizeNearestNeighbor(this,p,l)},b.prototype.conv1d=function(p,l,m,w,P,K){return w===void 0&&(w="NWC"),P===void 0&&(P=1),this.throwIfDisposed(),Tt.conv1d(this,p,l,m,w,P,K)},b.prototype.conv2d=function(p,l,m,w,P,K){return w===void 0&&(w="NHWC"),P===void 0&&(P=[1,1]),this.throwIfDisposed(),Tt.conv2d(this,p,l,m,w,P,K)},b.prototype.conv2dTranspose=function(p,l,m,w,P){return this.throwIfDisposed(),Tt.conv2dTranspose(this,p,l,m,w,P)},b.prototype.depthwiseConv2D=function(p,l,m,w,P,K){return w===void 0&&(w="NHWC"),P===void 0&&(P=[1,1]),this.throwIfDisposed(),Tt.depthwiseConv2d(this,p,l,m,w,P,K)},b.prototype.separableConv2d=function(p,l,m,w,P,K){return P===void 0&&(P=[1,1]),K===void 0&&(K="NHWC"),this.throwIfDisposed(),Tt.separableConv2d(this,p,l,m,w,P,K)},b.prototype.avgPool=function(p,l,m,w){return this.throwIfDisposed(),Tt.avgPool(this,p,l,m,w)},b.prototype.maxPool=function(p,l,m,w){return this.throwIfDisposed(),Tt.maxPool(this,p,l,m,w)},b.prototype.localResponseNormalization=function(p,l,m,w){return p===void 0&&(p=5),l===void 0&&(l=1),m===void 0&&(m=1),w===void 0&&(w=.5),Tt.localResponseNormalization(this,p,l,m,w)},b.prototype.pool=function(p,l,m,w,P){return this.throwIfDisposed(),Tt.pool(this,p,l,m,w,P)},b.prototype.variable=function(p,l,m){return p===void 0&&(p=!0),this.throwIfDisposed(),Kr().makeVariable(this,p,l,m)},b.prototype.unsortedSegmentSum=function(p,l){return this.throwIfDisposed(),Tt.unsortedSegmentSum(this,p,l)},b.prototype.batchToSpaceND=function(p,l){return this.throwIfDisposed(),Tt.batchToSpaceND(this,p,l)},b.prototype.spaceToBatchND=function(p,l){return this.throwIfDisposed(),Tt.spaceToBatchND(this,p,l)},b.prototype.topk=function(p,l){return p===void 0&&(p=1),l===void 0&&(l=!0),this.throwIfDisposed(),Tt.topk(this,p,l)},b.prototype.stridedSlice=function(p,l,m,w,P,K,ee,le){return w===void 0&&(w=0),P===void 0&&(P=0),K===void 0&&(K=0),ee===void 0&&(ee=0),le===void 0&&(le=0),this.throwIfDisposed(),Tt.stridedSlice(this,p,l,m,w,P,K,ee,le)},b.prototype.depthToSpace=function(p,l){return this.throwIfDisposed(),Tt.depthToSpace(this,p,l)},b.prototype.fft=function(){return this.throwIfDisposed(),Tt.spectral.fft(this)},b.prototype.ifft=function(){return this.throwIfDisposed(),Tt.spectral.ifft(this)},b.prototype.rfft=function(){return this.throwIfDisposed(),Tt.spectral.rfft(this)},b.prototype.irfft=function(){return this.throwIfDisposed(),Tt.spectral.irfft(this)},b}();Object.defineProperty(Qt,Symbol.hasInstance,{value:function(b){return!!b&&b.dataId!=null&&b.shape!=null&&b.dtype!=null}});var Se,ve,ke,Me,rt,Ct=function(b){function p(l,m,w,P){var K=b.call(this,l.shape,l.dtype,l.dataId,P)||this;return K.trainable=m,K.name=w,K}return B(p,b),p.prototype.assign=function(l){if(l.dtype!==this.dtype)throw new Error("dtype of the new value ("+l.dtype+") and previous value ("+this.dtype+") must match");if(!Ut(l.shape,this.shape))throw new Error("shape of the new value ("+l.shape+") and previous value ("+this.shape+") must match");Kr().disposeTensor(this),this.dataId=l.dataId,Kr().incRef(this,null)},p.prototype.dispose=function(){Kr().disposeVariable(this),this.isDisposedInternal=!0},p}(Qt);Object.defineProperty(Ct,Symbol.hasInstance,{value:function(b){return b instanceof Qt&&b.assign!=null&&b.assign instanceof Function}}),function(b){b.R0="R0",b.R1="R1",b.R2="R2",b.R3="R3",b.R4="R4",b.R5="R5",b.R6="R6"}(Se||(Se={})),function(b){b.float32="float32",b.int32="int32",b.bool="int32",b.complex64="complex64"}(ve||(ve={})),function(b){b.float32="float32",b.int32="int32",b.bool="bool",b.complex64="complex64"}(ke||(ke={})),function(b){b.float32="float32",b.int32="float32",b.bool="float32",b.complex64="complex64"}(Me||(Me={})),function(b){b.float32="complex64",b.int32="complex64",b.bool="complex64",b.complex64="complex64"}(rt||(rt={}));var tn={float32:Me,int32:ve,bool:ke,complex64:rt};function Sn(b,p){if(b==="string"||p==="string"){if(b==="string"&&p==="string")return"string";throw new Error("Can not upcast "+b+" with "+p)}return tn[b][p]}function Rt(b){return Sn(b,"int32")}function Zt(b,p){if(b.dtype===p.dtype)return[b,p];var l=Sn(b.dtype,p.dtype);return[b.cast(l),p.cast(l)]}function mn(b,p){we(b.dtype===p.dtype,function(){return"The dtypes of the first("+b.dtype+") and second("+p.dtype+") input must match"})}function fn(b){var p=[];return function l(m,w,P){if(m!=null){if(m instanceof Qt)w.push(m);else if(K=m,Array.isArray(K)||typeof K=="object"){var K,ee=m;for(var le in ee){var de=ee[le];P.has(de)||(P.add(de),l(de,w,P))}}}}(b,p,new Set),p}var mt,Mt=Object.freeze({makeTypesMatch:Zt,assertTypesMatch:mn,isTensorInList:function(b,p){return p.some(function(l){return l.id===b.id})},getTensorsInContainer:fn}),hn=function(){function b(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return b.prototype.dispose=function(){for(var p in this.registeredVariables)this.registeredVariables[p].dispose()},b}(),nn=function(){function b(p){this.ENV=p,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new hn}return b.prototype.ready=function(){return D(this,void 0,void 0,function(){var p,l,m;return R(this,function(w){switch(w.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];p=this.getSortedBackends(),l=0,w.label=1;case 1:return l<p.length?(m=p[l],[4,this.initializeBackend(m).success]):[3,5];case 2:return w.sent()?[4,this.setBackend(m)]:[3,4];case 3:return w.sent(),[2];case 4:return l++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(b.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var p=this.initializeBackendsAndReturnBest(),l=p.name;if(p.asyncInit)throw new Error("The highest priority backend '"+l+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(l)}return this.backendInstance},enumerable:!0,configurable:!0}),b.prototype.backendNames=function(){return Object.keys(this.registryFactory)},b.prototype.findBackend=function(p){return!(p in this.registry)&&(!(p in this.registryFactory)||this.initializeBackend(p).asyncInit)?null:this.registry[p]},b.prototype.findBackendFactory=function(p){return p in this.registryFactory?this.registryFactory[p].factory:null},b.prototype.registerBackend=function(p,l,m){return m===void 0&&(m=1),p in this.registryFactory?(console.warn(p+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[p]={factory:l,priority:m},!0)},b.prototype.setBackend=function(p){return D(this,void 0,void 0,function(){var l,m,w;return R(this,function(P){switch(P.label){case 0:if(this.registryFactory[p]==null)throw new Error("Backend name '"+p+"' not found in registry");return this.backendName=p,this.registry[p]!=null?[3,4]:(this.backendInstance=null,l=this.initializeBackend(p),m=l.success,l.asyncInit?[4,m]:[3,2]);case 1:return w=P.sent(),[3,3];case 2:w=m,P.label=3;case 3:if(!w)return[2,!1];P.label=4;case 4:return this.backendInstance=this.registry[p],this.setupRegisteredKernels(),this.profiler=new kr(this.backendInstance),[2,!0]}})})},b.prototype.setupRegisteredKernels=function(){var p=this;ae(this.backendName).forEach(function(l){l.setupFunc!=null&&l.setupFunc(p.backendInstance)})},b.prototype.disposeRegisteredKernels=function(p){var l=this;ae(p).forEach(function(m){m.disposeFunc!=null&&m.disposeFunc(l.registry[p])})},b.prototype.initializeBackend=function(p){var l=this,m=this.registryFactory[p];if(m==null)throw new Error("Cannot initialize backend "+p+", no registration found.");try{var w=m.factory();if(Promise.resolve(w)===w){var P=++this.pendingBackendInitId,K=w.then(function(ee){return!(P<l.pendingBackendInitId||(l.registry[p]=ee,l.pendingBackendInit=null,0))}).catch(function(ee){return!(P<l.pendingBackendInitId||(l.pendingBackendInit=null,console.warn("Initialization of backend "+p+" failed"),console.warn(ee.stack||ee.message),1))});return this.pendingBackendInit=K,{success:K,asyncInit:!0}}return this.registry[p]=w,{success:!0,asyncInit:!1}}catch(ee){return console.warn("Initialization of backend "+p+" failed"),console.warn(ee.stack||ee.message),{success:!1,asyncInit:!1}}},b.prototype.removeBackend=function(p){if(!(p in this.registryFactory))throw new Error(p+" backend not found in registry");this.backendName===p&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,p in this.registry&&(this.disposeRegisteredKernels(p),this.registry[p].dispose(),delete this.registry[p]),delete this.registryFactory[p],this.backendName===p&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},b.prototype.getSortedBackends=function(){var p=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(l,m){return p.registryFactory[m].priority-p.registryFactory[l].priority})},b.prototype.initializeBackendsAndReturnBest=function(){for(var p=this.getSortedBackends(),l=0;l<p.length;l++){var m=p[l],w=this.initializeBackend(m),P=w.success,K=w.asyncInit;if(K||P)return{name:m,asyncInit:K}}throw new Error("Could not initialize any backends, all backend initializations failed.")},b.prototype.moveData=function(p,l){var m=this.state.tensorInfo.get(l),w=m.backend,P=this.readSync(l);w.disposeData(l),m.backend=p,p.move(l,P,m.shape,m.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},b.prototype.tidy=function(p,l){var m,w=this,P=null;if(l==null){if(typeof p!="function")throw new Error("Please provide a function to tidy()");l=p}else{if(typeof p!="string"&&!(p instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof l!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");P=p}return this.scopedRun(function(){return w.startScope(P)},function(){return w.endScope(m)},function(){return(m=l())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),m})},b.prototype.scopedRun=function(p,l,m){p();try{var w=m();return l(),w}catch(P){throw l(),P}},b.prototype.nextTensorId=function(){return b.nextTensorId++},b.prototype.nextVariableId=function(){return b.nextVariableId++},b.prototype.clone=function(p){var l=this.makeTensorFromDataId(p.dataId,p.shape,p.dtype),m={x:p};return this.addTapeNode(this.state.activeScope.name,m,[l],function(w){return{x:function(){return w.toFloat()}}},[],{}),l},b.prototype.runKernel=function(p,l,m,w,P){return this.runKernelFunc(null,l,null,p,m,w,P)},b.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},b.prototype.checkKernelForMemLeak=function(p,l,m){var w=this.backend.numDataIds(),P=0;m.forEach(function(le){P+=le.dtype==="complex64"?3:1});var K=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],ee=w-l-P-K;if(ee>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+ee+" data ids) after running '"+p+"'")},b.prototype.runKernelFunc=function(p,l,m,w,P,K,ee){var le,de=this,Ee=[],Te=this.isTapeOn();w==null&&(w=this.state.activeScope!=null?this.state.activeScope.name:"");var Ne,Fe=this.state.numBytes,qe=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var Je,Ke=Y(w,this.backendName);if(Ke!=null)Ne=function(){var gt=de.backend.numDataIds();Je=Ke.kernelFunc({inputs:l,attrs:P,backend:de.backend});var Et=Array.isArray(Je)?Je:[Je];de.shouldCheckForMemLeaks()&&de.checkKernelForMemLeak(w,gt,Et);var At=Et.map(function(pn){var ln=pn.dataId,dn=pn.shape,Nn=pn.dtype;return de.makeTensorFromDataId(ln,dn,Nn)});if(Te){var Wt=de.getTensorsForGradient(w,l,At);if(Wt==null){ee==null&&(ee=[]);var cn=At.filter(function(pn,ln){return ee[ln]});Wt=(K||[]).slice().concat(cn)}Ee=de.saveTensorsForBackwardMode(Wt)}return At};else{var it=function(gt){Te&&(Ee=gt.map(function(Et){return de.keep(de.clone(Et))}))};Ne=function(){var gt=de.backend.numDataIds();Je=de.tidy(function(){return p(de.backend,it)});var Et=Array.isArray(Je)?Je:[Je];return de.shouldCheckForMemLeaks()&&de.checkKernelForMemLeak(w,gt,Et),Et}}return this.scopedRun(function(){return de.state.kernelDepth++},function(){return de.state.kernelDepth--},function(){le=de.ENV.getBool("DEBUG")?de.profiler.profileKernel(w,l,function(){return Ne()}):Ne()}),Te&&this.addTapeNode(w,l,le,m,Ee,P),this.state.profiling&&this.state.activeProfile.kernels.push({name:w,bytesAdded:this.state.numBytes-Fe,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-qe,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(l).map(function(gt){return l[gt].shape}),outputShapes:le.map(function(gt){return gt.shape})}),Array.isArray(Je)?le:le[0]},b.prototype.saveTensorsForBackwardMode=function(p){var l=this;return p.map(function(m){return l.keep(l.clone(m))})},b.prototype.getTensorsForGradient=function(p,l,m){var w=q(p);if(w!=null){var P=w.inputsToSave||[],K=w.outputsToSave||[],ee=void 0;w.saveAllInputs?(we(Array.isArray(l),function(){return"saveAllInputs is true, expected inputs to be an array."}),ee=Object.keys(l).map(function(de){return l[de]})):ee=P.map(function(de){return l[de]});var le=m.filter(function(de,Ee){return K[Ee]});return ee.concat(le)}return null},b.prototype.makeTensor=function(p,l,m,w){if(p==null)throw new Error("Values passed to engine.makeTensor() are null");m=m||"float32",w=w||this.backend;var P=p;m==="string"&&Pn(p[0])&&(P=p.map(function(Ee){return Dt(Ee)}));var K=w.write(P,l,m),ee=new Qt(l,m,K,this.nextTensorId());if(this.incRef(ee,w),m==="string"){var le=this.state.tensorInfo.get(K),de=Jt(P);this.state.numBytes+=de-le.bytes,le.bytes=de}return ee},b.prototype.makeTensorFromDataId=function(p,l,m,w){var P=new Qt(l,m=m||"float32",p,this.nextTensorId());return this.incRef(P,w),P},b.prototype.makeVariable=function(p,l,m,w){l===void 0&&(l=!0),m=m||this.nextVariableId().toString(),w!=null&&w!==p.dtype&&(p=p.asType(w));var P=new Ct(p,l,m,this.nextTensorId());if(this.state.registeredVariables[P.name]!=null)throw new Error("Variable with name "+P.name+" was already registered");return this.state.registeredVariables[P.name]=P,this.incRef(P,this.backend),P},b.prototype.incRef=function(p,l){var m=this.state.tensorInfo.has(p.dataId)?this.state.tensorInfo.get(p.dataId).refCount:0;if(this.state.numTensors++,p.dtype==="string"&&this.state.numStringTensors++,m===0){this.state.numDataBuffers++;var w=0;p.dtype!=="complex64"&&p.dtype!=="string"&&(w=p.size*$t(p.dtype)),this.state.tensorInfo.set(p.dataId,{backend:l||this.backend,dtype:p.dtype,shape:p.shape,bytes:w,refCount:0}),this.state.numBytes+=w}this.state.tensorInfo.get(p.dataId).refCount++,p instanceof Ct||this.track(p)},b.prototype.disposeTensor=function(p){if(this.state.tensorInfo.has(p.dataId)){this.state.numTensors--,p.dtype==="string"&&this.state.numStringTensors--;var l=this.state.tensorInfo.get(p.dataId);l.refCount<=1?(p.dtype!=="complex64"&&(this.state.numBytes-=l.bytes),this.state.numDataBuffers--,l.backend.disposeData(p.dataId),this.state.tensorInfo.delete(p.dataId)):this.state.tensorInfo.get(p.dataId).refCount--}},b.prototype.disposeVariables=function(){for(var p in this.state.registeredVariables){var l=this.state.registeredVariables[p];this.disposeVariable(l)}},b.prototype.disposeVariable=function(p){this.disposeTensor(p),this.state.registeredVariables[p.name]!=null&&delete this.state.registeredVariables[p.name]},b.prototype.memory=function(){var p=this.backend.memory();return p.numTensors=this.state.numTensors,p.numDataBuffers=this.state.numDataBuffers,p.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(p.unreliable=!0,p.reasons==null&&(p.reasons=[]),p.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),p},b.prototype.profile=function(p){return D(this,void 0,void 0,function(){var l,m;return R(this,function(w){return this.state.profiling=!0,l=this.state.numBytes,m=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=p(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(P){return P.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-l,this.state.activeProfile.newTensors=this.state.numTensors-m,[2,this.state.activeProfile]})})},b.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},b.prototype.addTapeNode=function(p,l,m,w,P,K){var ee=this,le={id:this.state.nextTapeNodeId++,kernelName:p,inputs:l,outputs:m,saved:P},de=q(p);de!=null&&(w=de.gradFunc),w!=null&&(le.gradient=function(Ee){return Ee=Ee.map(function(Te,Ne){if(Te==null){var Fe=m[Ne],qe=Vt(Fe.size,Fe.dtype);return ee.makeTensor(qe,Fe.shape,Fe.dtype)}return Te}),w(Ee.length>1?Ee:Ee[0],P,K)}),this.state.activeTape.push(le)},b.prototype.keep=function(p){return p.kept=!0,p},b.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},b.prototype.endTape=function(){this.state.gradientDepth--},b.prototype.startScope=function(p){var l={track:[],name:"unnamed scope",id:this.state.nextScopeId++};p&&(l.name=p),this.state.scopeStack.push(l),this.state.activeScope=l},b.prototype.endScope=function(p){for(var l=this,m=fn(p),w=new Set(m.map(function(le){return le.id})),P=0;P<this.state.activeScope.track.length;P++){var K=this.state.activeScope.track[P];K.kept||w.has(K.id)||K.dispose()}var ee=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],m.forEach(function(le){le.kept||le.scopeId!==ee.id||l.track(le)})},b.prototype.gradients=function(p,l,m,w){var P=this;if(w===void 0&&(w=!1),we(l.length>0,function(){return"gradients() received an empty list of xs."}),m!=null&&m.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+m.dtype+"'");var K=this.scopedRun(function(){return P.startTape()},function(){return P.endTape()},function(){return P.tidy("forward",p)});we(K instanceof Qt,function(){return"The result y returned by f() must be a tensor."});var ee=function(le,de,Ee){for(var Te={},Ne={},Fe=0;Fe<de.length;Fe++)Te[de[Fe].id]=!0;for(Fe=0;Fe<le.length;Fe++){var qe=(cn=le[Fe]).inputs;for(var Je in qe){for(var Ke=qe[Je],it=!1,gt=0;gt<de.length;gt++)if(Te[Ke.id]){cn.outputs.forEach(function(Nn){return Te[Nn.id]=!0}),it=!0,Ne[cn.id]=!0;break}if(it)break}}var Et={};Et[Ee.id]=!0;var At={};for(Fe=le.length-1;Fe>=0;Fe--)for(qe=(cn=le[Fe]).inputs,gt=0;gt<cn.outputs.length;gt++)if(Et[cn.outputs[gt].id]){for(var Je in qe)Et[qe[Je].id]=!0,At[cn.id]=!0;break}var Wt=[];for(Fe=0;Fe<le.length;Fe++){var cn;if(Ne[(cn=le[Fe]).id]&&At[cn.id]){var pn={};for(var Je in cn.inputs){var ln=cn.inputs[Je];Te[ln.id]&&(pn[Je]=ln)}var dn=Object.assign({},cn);dn.inputs=pn,dn.outputs=cn.outputs,Wt.push(dn)}}return Wt}(this.state.activeTape,l,K);if(!w&&ee.length===0&&l.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var le,de,Ee={};Ee[K.id]=m??(de=Kt(ze(le=K.shape),"float32"),He.makeTensor(de,le,"float32")),function(Ne,Fe,qe){for(var Je=function(it){var gt=Fe[it],Et=[];if(gt.outputs.forEach(function(pn){var ln=Ne[pn.id];ln!=null?Et.push(ln):Et.push(null)}),gt.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+gt.kernelName+".");var At=gt.gradient(Et),Wt=function(pn){if(!(pn in At))throw new Error("Cannot backprop through input "+pn+". Available gradients found: "+Object.keys(At)+".");var ln=qe(function(){return At[pn]()});if(ln.dtype!=="float32")throw new Error("Error in gradient for op "+gt.kernelName+". The gradient of input "+pn+" must have 'float32' dtype, but has '"+ln.dtype+"'");var dn=gt.inputs[pn];if(!Ut(ln.shape,dn.shape))throw new Error("Error in gradient for op "+gt.kernelName+". The gradient of input '"+pn+"' has shape '"+ln.shape+"', which does not match the shape of the input '"+dn.shape+"'");if(Ne[dn.id]==null)Ne[dn.id]=ln;else{var Nn=Ne[dn.id];Ne[dn.id]=Nn.add(ln),Nn.dispose()}};for(var cn in gt.inputs)Wt(cn)},Ke=Fe.length-1;Ke>=0;Ke--)Je(Ke)}(Ee,ee,function(Ne){return P.tidy(Ne)});var Te=l.map(function(Ne){return Ee[Ne.id]});return P.state.gradientDepth===0&&(P.state.activeTape.forEach(function(Ne){for(var Fe=0,qe=Ne.saved;Fe<qe.length;Fe++)qe[Fe].dispose()}),P.state.activeTape=null),{value:K,grads:Te}})},b.prototype.customGrad=function(p){var l=this;return we(sr(p),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var m,w=[],P=0;P<arguments.length;P++)w[P]=arguments[P];we(w.every(function(ee){return ee instanceof Qt}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var K={};return w.forEach(function(ee,le){K[le]=ee}),l.runKernelFunc(function(ee,le){return we((m=p.apply(void 0,w.concat([le]))).value instanceof Qt,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),we(sr(m.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),m.value},K,function(ee,le){var de=m.gradFunc(ee,le),Ee=Array.isArray(de)?de:[de];we(Ee.length===w.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),we(Ee.every(function(Ne){return Ne instanceof Qt}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var Te={};return Ee.forEach(function(Ne,Fe){Te[Fe]=function(){return Ne}}),Te})}},b.prototype.readSync=function(p){return this.state.tensorInfo.get(p).backend.readSync(p)},b.prototype.read=function(p){return this.state.tensorInfo.get(p).backend.read(p)},b.prototype.time=function(p){return D(this,void 0,void 0,function(){var l,m;return R(this,function(w){switch(w.label){case 0:return l=en(),[4,this.backend.time(p)];case 1:return(m=w.sent()).wallMs=en()-l,[2,m]}})})},b.prototype.track=function(p){return this.state.activeScope!=null&&(p.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(p)),p},Object.defineProperty(b.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),b.prototype.reset=function(){for(var p in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new hn,this.registry)this.disposeRegisteredKernels(p),this.registry[p].dispose(),delete this.registry[p];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},b.nextTensorId=0,b.nextVariableId=0,b}(),He=function(){var b=function(){if(mt==null){var l=void 0;if(typeof window<"u")l=window;else if(c!==void 0)l=c;else if(S!==void 0)l=S;else{if(typeof self>"u")throw new Error("Could not find a global object");l=self}mt=l}return mt}();if(b._tfengine==null){var p=new W(b);b._tfengine=new nn(p)}return function(l){H=l}(b._tfengine.ENV),Kr=function(){return b._tfengine},b._tfengine}();function Bn(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Xn=j();Xn.registerFlag("DEBUG",function(){return!1},function(b){b&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Xn.registerFlag("IS_BROWSER",function(){return Bn()}),Xn.registerFlag("IS_NODE",function(){return S!==void 0&&S.versions!==void 0&&S.versions.node!==void 0}),Xn.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Xn.registerFlag("PROD",function(){return!1}),Xn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Xn.getBool("DEBUG")}),Xn.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Xn.registerFlag("IS_TEST",function(){return!1});var Zn,lr,jr,Cr={},xi={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Ai(b,p){Cr[b]=p}function ni(b){b in Cr||(Cr[b]=function(l){if(l!==1&&l!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var m=function(w){if(typeof OffscreenCanvas<"u"&&w===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(l);return m.addEventListener("webglcontextlost",function(w){w.preventDefault(),delete Cr[l]},!1),l===1?m.getContext("webgl",xi)||m.getContext("experimental-webgl",xi):m.getContext("webgl2",xi)}(b));var p=Cr[b];return p.isContextLost()?(delete Cr[b],ni(b)):(p.disable(p.DEPTH_TEST),p.disable(p.STENCIL_TEST),p.disable(p.BLEND),p.disable(p.DITHER),p.disable(p.POLYGON_OFFSET_FILL),p.disable(p.SAMPLE_COVERAGE),p.enable(p.SCISSOR_TEST),p.enable(p.CULL_FACE),p.cullFace(p.BACK),Cr[b])}function to(b,p){return[p,b]}function yi(b){var p=ze(b);return vt(Math.ceil(p/4))}function ri(b,p){return[Math.max(1,Math.ceil(p/2)),Math.max(1,Math.ceil(b/2))]}function Jr(b,p){var l,m,w,P,K,ee,le,de,Ee,Te=b;return j().getNumber("WEBGL_VERSION")===2?(l=Te.R32F,m=Te.R16F,w=Te.RGBA16F,P=Te.RGBA32F,K=Te.RED,ee=4,le=1,de=Te.HALF_FLOAT,Ee=Te.FLOAT):(l=b.RGBA,m=b.RGBA,w=b.RGBA,P=Te.RGBA,K=b.RGBA,ee=4,le=4,de=p!=null?p.HALF_FLOAT_OES:null,Ee=b.FLOAT),{internalFormatFloat:l,internalFormatHalfFloat:m,internalFormatPackedHalfFloat:w,internalFormatPackedFloat:P,textureFormatFloat:K,downloadTextureFormat:b.RGBA,downloadUnpackNumChannels:ee,defaultNumChannels:le,textureTypeHalfFloat:de,textureTypeFloat:Ee}}function Kn(b,p,l){var m=l();return p&&function(w){var P=w.getError();if(P!==w.NO_ERROR)throw new Error("WebGL Error: "+so(w,P))}(b),m}(function(b){b[b.DENSE=0]="DENSE",b[b.SHARED_BATCH=1]="SHARED_BATCH"})(Zn||(Zn={})),function(b){b[b.RENDER=0]="RENDER",b[b.UPLOAD=1]="UPLOAD",b[b.PIXELS=2]="PIXELS",b[b.DOWNLOAD=3]="DOWNLOAD"}(lr||(lr={})),function(b){b[b.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",b[b.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",b[b.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",b[b.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",b[b.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(jr||(jr={}));var pi=596e-10,Ci=65504;function Wr(b){return!!(j().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||b===0||pi<Math.abs(b)&&Math.abs(b)<Ci)}function so(b,p){switch(p){case b.NO_ERROR:return"NO_ERROR";case b.INVALID_ENUM:return"INVALID_ENUM";case b.INVALID_VALUE:return"INVALID_VALUE";case b.INVALID_OPERATION:return"INVALID_OPERATION";case b.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case b.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case b.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+p}}function Wi(b,p,l){return ba(b,p,function(){return b.getExtension(l)},'Extension "'+l+'" not supported on this browser.')}function no(b,p,l){var m=ba(b,p,function(){return b.createShader(b.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Kn(b,p,function(){return b.shaderSource(m,l)}),Kn(b,p,function(){return b.compileShader(m)}),b.getShaderParameter(m,b.COMPILE_STATUS)===!1)throw console.log(b.getShaderInfoLog(m)),new Error("Failed to compile vertex shader.");return m}function So(b,p,l){var m=ba(b,p,function(){return b.createShader(b.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Kn(b,p,function(){return b.shaderSource(m,l)}),Kn(b,p,function(){return b.compileShader(m)}),b.getShaderParameter(m,b.COMPILE_STATUS)===!1)throw function(w,P){var K=Ch.exec(P);if(K==null)return console.log("Couldn't parse line number in error: "+P),void console.log(w);for(var ee=+K[1],le=w.split(`
`),de=le.length.toString().length+2,Ee=le.map(function(Ke,it){return rn((it+1).toString(),de)+Ke}),Te=0,Ne=0;Ne<Ee.length;Ne++)Te=Math.max(Ee[Ne].length,Te);var Fe=Ee.slice(0,ee-1),qe=Ee.slice(ee-1,ee),Je=Ee.slice(ee);console.log(Fe.join(`
`)),console.log(P.split(`
`)[0]),console.log("%c "+rn(qe[0],Te),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(Je.join(`
`))}(l,b.getShaderInfoLog(m)),new Error("Failed to compile fragment shader.");return m}var _a,Ds,Ch=/ERROR: [0-9]+:([0-9]+):/g;function ro(b,p){return ba(b,p,function(){return b.createProgram()},"Unable to create WebGLProgram.")}function Mc(b,p,l){if(Kn(b,p,function(){return b.linkProgram(l)}),b.getProgramParameter(l,b.LINK_STATUS)===!1)throw console.log(b.getProgramInfoLog(l)),new Error("Failed to link vertex and fragment shaders.")}function Gu(b,p,l){if(Kn(b,p,function(){return b.validateProgram(l)}),b.getProgramParameter(l,b.VALIDATE_STATUS)===!1)throw console.log(b.getProgramInfoLog(l)),new Error("Shader program validation failed.")}function el(b,p,l){var m=ba(b,p,function(){return b.createBuffer()},"Unable to create WebGLBuffer");return Kn(b,p,function(){return b.bindBuffer(b.ARRAY_BUFFER,m)}),Kn(b,p,function(){return b.bufferData(b.ARRAY_BUFFER,l,b.STATIC_DRAW)}),m}function fc(b,p,l){var m=ba(b,p,function(){return b.createBuffer()},"Unable to create WebGLBuffer");return Kn(b,p,function(){return b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,m)}),Kn(b,p,function(){return b.bufferData(b.ELEMENT_ARRAY_BUFFER,l,b.STATIC_DRAW)}),m}function tl(b,p){return ba(b,p,function(){return b.createTexture()},"Unable to create WebGLTexture.")}function Up(b,p){var l=j().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(b<=0||p<=0){var m="["+b+"x"+p+"]";throw new Error("Requested texture size "+m+" is invalid.")}if(b>l||p>l)throw m="["+b+"x"+p+"]",new Error("Requested texture size "+m+" greater than WebGL maximum on this browser / GPU ["+l+"x"+l+"].")}function xs(b,p){return ba(b,p,function(){return b.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function dd(b,p,l,m,w,P,K,ee){var le=b.getAttribLocation(l,m);return le!==-1&&(Kn(b,p,function(){return b.bindBuffer(b.ARRAY_BUFFER,w)}),Kn(b,p,function(){return b.vertexAttribPointer(le,P,b.FLOAT,!1,K,ee)}),Kn(b,p,function(){return b.enableVertexAttribArray(le)}),!0)}function Wp(b,p,l,m){Dc(b,m),Kn(b,p,function(){return b.activeTexture(b.TEXTURE0+m)}),Kn(b,p,function(){return b.bindTexture(b.TEXTURE_2D,l)})}function dc(b,p,l,m){return ba(b,p,function(){return b.getUniformLocation(l,m)},'uniform "'+m+'" not present in program.')}function hd(b,p,l){return b.getUniformLocation(p,l)}function kh(b,p,l,m,w,P){Kn(b,p,function(){return Wp(b,p,m,P)}),Kn(b,p,function(){return b.uniform1i(w,P)})}function nl(b,p,l,m){Kn(b,p,function(){return b.bindFramebuffer(b.FRAMEBUFFER,m)}),Kn(b,p,function(){return b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,l,0)})}function hf(b,p,l){Kn(b,p,function(){return b.bindFramebuffer(b.FRAMEBUFFER,l)}),Kn(b,p,function(){return b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0)})}function Ha(b){var p=b.checkFramebufferStatus(b.FRAMEBUFFER);if(p!==b.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Tl(b,p))}function Tl(b,p){switch(p){case b.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case b.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case b.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case b.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+p}}function ba(b,p,l,m){var w=Kn(b,p,function(){return l()});if(w==null)throw new Error(m);return w}function Dc(b,p){var l=b.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,m=p+b.TEXTURE0;if(m<b.TEXTURE0||m>l)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+l+"].")}function ws(b,p){return p===void 0&&(p=2),ze(b.slice(0,b.length-p))}function La(b){if(b.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[b.length>1?b[b.length-2]:1,b[b.length-1]]}function Nc(b){var p=[1,1,1];return b.length===0||b.length===1&&b[0]===1||(p=[ws(b)].concat(La(b))),p}function pf(b,p){var l;p===void 0&&(p=!1);var m=j().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(p&&(m*=2,(b=b.map(function(de,Ee){return Ee>=b.length-2?It(b[Ee]):b[Ee]})).length===1&&(b=[2,b[0]])),b.length!==2){var w=sn(b);b=w.newShape}var P=ze(b);if(b.length<=1&&P<=m)return[1,P];if(b.length===2&&b[0]<=m&&b[1]<=m)return b;if(b.length===3&&b[0]*b[1]<=m&&b[2]<=m)return[b[0]*b[1],b[2]];if(b.length===3&&b[0]<=m&&b[1]*b[2]<=m)return[b[0],b[1]*b[2]];if(b.length===4&&b[0]*b[1]*b[2]<=m&&b[3]<=m)return[b[0]*b[1]*b[2],b[3]];if(b.length===4&&b[0]<=m&&b[1]*b[2]*b[3]<=m)return[b[0],b[1]*b[2]*b[3]];if(p){var K=ws(b),ee=2,le=2;return b.length&&(ee=(l=La(b))[0],le=l[1]),vt(P=K*(ee/2)*(le/2)).map(function(de){return 2*de})}return vt(P)}function Ic(b){return b%2==0}function Iu(b,p){if(Ut(b=b.slice(-2),p=p.slice(-2))||!b.length||!p.length||b[0]===0||b[1]===0||p[0]===0||p[1]===0)return!0;if(b.length!==p.length){var l=b.slice(-1)[0],m=p.slice(-1)[0];if(l===m||Ic(l)&&Ic(m)&&(b[0]===1||p[0]===1))return!0}return b[1]===p[1]&&Ic(b[0])&&Ic(p[0])}function Ah(b){if(_a==null){var p=ni(b);_a=p.getParameter(p.MAX_TEXTURE_SIZE)}return _a}function pd(b){if(Ds==null){var p=ni(b);Ds=p.getParameter(p.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Ds)}function md(b){if(b===0)return 0;var p=ni(b);return Ea(p,"EXT_disjoint_timer_query_webgl2")&&b===2?2:Ea(p,"EXT_disjoint_timer_query")?1:0}function Ea(b,p){return b.getExtension(p)!=null}function Oh(b){try{if(ni(b)!=null)return!0}catch{return!1}return!1}function Vp(b){if(b===0)return!1;var p=ni(b);if(b===1){if(!Ea(p,"OES_texture_float"))return!1}else if(!Ea(p,"EXT_color_buffer_float"))return!1;return vd(p)}function gd(b){if(b===0)return!1;var p=ni(b);return b!==1?Ea(p,"EXT_color_buffer_float")?vd(p):!!Ea(p,"EXT_color_buffer_half_float")&&function(l,m){var w=Jr(l,m),P=l.createTexture();l.bindTexture(l.TEXTURE_2D,P),l.texImage2D(l.TEXTURE_2D,0,w.internalFormatHalfFloat,1,1,0,w.textureFormatFloat,w.textureTypeHalfFloat,null);var K=l.createFramebuffer();l.bindFramebuffer(l.FRAMEBUFFER,K),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,P,0);var ee=l.checkFramebufferStatus(l.FRAMEBUFFER)===l.FRAMEBUFFER_COMPLETE;return l.bindTexture(l.TEXTURE_2D,null),l.bindFramebuffer(l.FRAMEBUFFER,null),l.deleteTexture(P),l.deleteFramebuffer(K),ee}(p,p.getExtension("EXT_color_buffer_half_float")):!!Ea(p,"OES_texture_float")&&!!Ea(p,"WEBGL_color_buffer_float")&&vd(p)}function vd(b){var p=Jr(b),l=b.createTexture();b.bindTexture(b.TEXTURE_2D,l),b.texImage2D(b.TEXTURE_2D,0,p.internalFormatFloat,1,1,0,p.textureFormatFloat,p.textureTypeFloat,null);var m=b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,m),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,l,0);var w=b.checkFramebufferStatus(b.FRAMEBUFFER)===b.FRAMEBUFFER_COMPLETE;return b.bindTexture(b.TEXTURE_2D,null),b.bindFramebuffer(b.FRAMEBUFFER,null),b.deleteTexture(l),b.deleteFramebuffer(m),w}function Ns(b){return b===2&&ni(b).fenceSync!=null}var yd=Object.freeze({callAndCheck:Kn,canBeRepresented:Wr,getWebGLErrorMessage:so,getExtensionOrThrow:Wi,createVertexShader:no,createFragmentShader:So,createProgram:ro,linkProgram:Mc,validateProgram:Gu,createStaticVertexBuffer:el,createStaticIndexBuffer:fc,getNumChannels:function(){return j().getNumber("WEBGL_VERSION")===2?1:4},createTexture:tl,validateTextureSize:Up,createFramebuffer:xs,bindVertexBufferToProgramAttribute:dd,bindTextureUnit:Wp,unbindTextureUnit:function(b,p,l){Dc(b,l),Kn(b,p,function(){return b.activeTexture(b.TEXTURE0+l)}),Kn(b,p,function(){return b.bindTexture(b.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:dc,getProgramUniformLocation:hd,bindTextureToProgramUniformSampler:kh,bindCanvasToFramebuffer:function(b,p){Kn(b,p,function(){return b.bindFramebuffer(b.FRAMEBUFFER,null)}),Kn(b,p,function(){return b.viewport(0,0,b.canvas.width,b.canvas.height)}),Kn(b,p,function(){return b.scissor(0,0,b.canvas.width,b.canvas.height)})},bindColorTextureToFramebuffer:nl,unbindColorTextureFromFramebuffer:hf,validateFramebuffer:Ha,getFramebufferErrorMessage:Tl,getBatchDim:ws,getRowsCols:La,getShapeAs3D:Nc,getTextureShapeFromLogicalShape:pf,isReshapeFree:Iu,getWebGLMaxTextureSize:Ah,resetMaxTextureSize:function(){_a=null},resetMaxTexturesInShader:function(){Ds=null},getMaxTexturesInShader:pd,getWebGLDisjointQueryTimerVersion:md,hasExtension:Ea,isWebGLVersionEnabled:Oh,isCapableOfRenderingToFloatTexture:Vp,isDownloadFloatTextureEnabled:gd,isWebGLFenceEnabled:Ns}),br=j();function qu(){j().set("PROD",!0)}function Qm(){j().set("DEBUG",!0)}function Zm(){j().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function bd(b){j().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(b+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function mf(){He.disposeVariables()}function Hp(){return He}function Th(){return He.memory()}function Mh(b){return He.profile(b)}function qi(b,p){return He.tidy(b,p)}function zo(b){fn(b).forEach(function(p){return p.dispose()})}function Dh(b){return He.keep(b)}function Yg(b){return He.time(b)}function xd(b){return He.setBackend(b)}function Gp(){return He.ready()}function Is(){return He.backendName}function Fc(b){He.removeBackend(b)}function qp(b){return He.findBackend(b)}function eg(b){return He.findBackendFactory(b)}function tg(b,p,l){return l===void 0&&(l=1),He.registerBackend(b,p,l)}function Jg(){return He.backend}function Qg(b,p){j().setPlatform(b,p)}function Ml(){for(var b=[],p=0;p<arguments.length;p++)b[p]=arguments[p];j().getBool("IS_TEST")||console.warn.apply(console,b)}function Qa(b,p){var l=b;if(ft(b))return p==="string"?[]:[b.length];if(!Array.isArray(b))return[];for(var m=[];Array.isArray(l)||ft(l)&&p!=="string";)m.push(l.length),l=l[0];return Array.isArray(b)&&j().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function w(P,K,ee){if(ee=ee||[],Array.isArray(P)||ft(P)){we(K.length>0,function(){return"Element arr["+ee.join("][")+"] should be a primitive, but is an array of "+P.length+" elements"}),we(P.length===K[0],function(){return"Element arr["+ee.join("][")+"] should have "+K[0]+" elements, but has "+P.length+" elements"});for(var le=K.slice(1),de=0;de<P.length;++de)w(P[de],le,ee.concat(de))}else we(K.length===0,function(){return"Element arr["+ee.join("][")+"] is a primitive, but should be an array/TypedArray of "+K[0]+" elements"})}(b,m,[]),m}function Nh(b,p,l,m){if(b!=null&&(b!=="numeric"&&b!==p||b==="numeric"&&p==="string"))throw new Error("Argument '"+l+"' passed to '"+m+"' must be "+b+" tensor, but got "+p+" tensor")}function Ze(b,p,l,m){if(m===void 0&&(m="numeric"),b instanceof Qt)return Nh(m,b.dtype,p,l),b;var w=Ce(b);if(w!=="string"&&["bool","int32","float32"].indexOf(m)>=0&&(w=m),Nh(m,w,p,l),b==null||!ft(b)&&!Array.isArray(b)&&typeof b!="number"&&typeof b!="boolean"&&typeof b!="string"){var P=b==null?"null":b.constructor.name;throw new Error("Argument '"+p+"' passed to '"+l+"' must be a Tensor or TensorLike, but got '"+P+"'")}var K=Qa(b,w);ft(b)||Array.isArray(b)||(b=[b]);var ee=w!=="string"?Gt(b,w,j().getBool("DEBUG")):Ot(b,[],!0);return He.makeTensor(ee,K,w)}function hc(b,p,l,m){if(m===void 0&&(m="numeric"),!Array.isArray(b))throw new Error("Argument "+p+" passed to "+l+" must be a `Tensor[]` or `TensorLike[]`");return b.map(function(w,P){return Ze(w,p+"["+P+"]",l)},m)}function wd(b,p){for(var l=0;l<b.length;++l)if(b[b.length-l-1]!==p-1-l)return!1;return!0}function $p(b,p,l){for(var m=b.length+p.length,w=[],P=0,K=0,ee=0;ee<m;ee++)l.indexOf(ee)===-1?w.push(b[P++]):w.push(p[K++]);return w}function Po(b,p){for(var l=[],m=b.length,w=0;w<m;w++)p.indexOf(w)===-1&&l.push(b[w]);return[l,p.map(function(P){return b[P]})]}function Lo(b,p){return $p(b,p.map(function(l){return 1}),p)}function ia(b,p,l){we(wd(p,l),function(){return b+" supports only inner-most axes for now. Got axes "+p+" and rank-"+l+" input."})}function Ba(b,p){if(wd(b,p))return null;for(var l=[],m=0;m<p;++m)b.indexOf(m)===-1&&l.push(m);return b.forEach(function(w){return l.push(w)}),l}function $u(b){return b.map(function(p,l){return[l,p]}).sort(function(p,l){return p[1]-l[1]}).map(function(p){return p[0]})}function ja(b,p){for(var l=[],m=p-b;m<p;++m)l.push(m);return l}function rl(b,p){var l=b[0].length;b.forEach(function(w,P){we(w.length===l,function(){return"Error in concat"+l+"D: rank of tensors["+P+"] must be the same as the rank of the rest ("+l+")"})}),we(p>=0&&p<l,function(){return"Error in concat"+l+"D: axis must be between 0 and "+(l-1)+"."});var m=b[0];b.forEach(function(w,P){for(var K=0;K<l;K++)we(K===p||w[K]===m[K],function(){return"Error in concat"+l+"D: Shape of tensors["+P+"] ("+w+") does not match the shape of the rest ("+m+") along the non-concatenated axis "+P+"."})})}function _u(b,p){for(var l=b[0].slice(),m=1;m<b.length;m++)l[p]+=b[m][p];return l}function Lt(b){var p=Object.keys(b);if(p.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+p.length+" keys.");var l=p[0],m=b[l];l.endsWith("_")&&(l=l.substring(0,l.length-1));var w=function(){for(var P=[],K=0;K<arguments.length;K++)P[K]=arguments[K];He.startScope(l);try{var ee=m.apply(void 0,P);return ee instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),He.endScope(ee),ee}catch(le){throw He.endScope(null),le}};return Object.defineProperty(w,"name",{value:l,configurable:!0}),w}br.registerFlag("HAS_WEBGL",function(){return br.getNumber("WEBGL_VERSION")>0}),br.registerFlag("WEBGL_VERSION",function(){return Oh(2)?2:Oh(1)?1:0}),br.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return br.get("WEBGL_VERSION")===2}),br.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),br.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),br.registerFlag("WEBGL_PACK",function(){return br.getBool("HAS_WEBGL")}),br.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return br.getBool("WEBGL_PACK")}),br.registerFlag("WEBGL_PACK_CLIP",function(){return br.getBool("WEBGL_PACK")}),br.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),br.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return br.getBool("WEBGL_PACK")}),br.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return br.getBool("WEBGL_PACK")}),br.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return br.getBool("WEBGL_PACK")}),br.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return br.getBool("WEBGL_PACK")}),br.registerFlag("WEBGL_PACK_REDUCE",function(){return br.getBool("WEBGL_PACK")}),br.registerFlag("WEBGL_LAZILY_UNPACK",function(){return br.getBool("WEBGL_PACK")}),br.registerFlag("WEBGL_CONV_IM2COL",function(){return br.getBool("WEBGL_PACK")}),br.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return Ah(br.getNumber("WEBGL_VERSION"))}),br.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return pd(br.getNumber("WEBGL_VERSION"))}),br.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var b=br.getNumber("WEBGL_VERSION");return b===0?0:md(b)}),br.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return br.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(b=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4))));var b}),br.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return Vp(br.getNumber("WEBGL_VERSION"))}),br.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!br.getBool("WEBGL_FORCE_F16_TEXTURES")&&br.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),br.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return gd(br.getNumber("WEBGL_VERSION"))}),br.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return Ns(br.getNumber("WEBGL_VERSION"))}),br.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return br.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),Rr=bd;var Co=Lt({complex_:function(b,p){var l=Ze(b,"real","complex"),m=Ze(p,"imag","complex");return yt(l.shape,m.shape,"real and imag shapes, "+l.shape+" and "+m.shape+", must match in call to tf.complex()."),He.runKernelFunc(function(w){return w.complex(l,m)},{$real:l,$imag:m})}}),xa=Lt({real_:function(b){var p=Ze(b,"input","real");return He.runKernelFunc(function(l){return l.real(p)},{$input:p})}}),Za=Lt({imag_:function(b){var p=Ze(b,"input","imag");return He.runKernelFunc(function(l){return l.imag(p)},{$input:p})}});function No(b,p,l){return Fs(b,p,Qa(b,l),l)}function Fs(b,p,l,m){if(m==null&&(m=Ce(b)),m==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!ft(b)&&!Array.isArray(b)&&typeof b!="number"&&typeof b!="boolean"&&typeof b!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(p!=null){Vn(p);var w=ze(p),P=ze(l);we(w===P,function(){return"Based on the provided shape, ["+p+"], the tensor should have "+w+" values but has "+P});for(var K=0;K<l.length;++K){var ee=l[K],le=K!==l.length-1||ee!==ze(p.slice(K));we(l[K]===p[K]||!le,function(){return"Error creating a new Tensor. Inferred shape ("+l+") does not match the provided shape ("+p+"). "})}}return ft(b)||Array.isArray(b)||(b=[b]),p=p||l,b=m!=="string"?Gt(b,m,j().getBool("DEBUG")):Ot(b,[],!0),He.makeTensor(b,p,m)}function Ar(b,p){if((ft(b)&&p!=="string"||Array.isArray(b))&&p!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(p==="string"&&ft(b)&&!(b instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Fs(b,[],[],p)}function au(b,p){Bt(b);var l=Qa(b,p);if(l.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Fs(b,null,l,p)}function Eu(b,p,l){if(Bt(b),p!=null&&p.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var m=Qa(b,l);if(m.length!==2&&m.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(m.length===1&&p==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Fs(b,p,m,l)}function Dl(b,p,l){if(Bt(b),p!=null&&p.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var m=Qa(b,l);if(m.length!==3&&m.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(m.length===1&&p==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Fs(b,p,m,l)}function su(b,p,l){if(Bt(b),p!=null&&p.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var m=Qa(b,l);if(m.length!==4&&m.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(m.length===1&&p==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Fs(b,p,m,l)}function Ih(b,p,l){if(Bt(b),p!=null&&p.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var m=Qa(b,l);if(m.length!==5&&m.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(m.length===1&&p==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Fs(b,p,m,l)}function Xp(b,p,l){if(Bt(b),p!=null&&p.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var m=Qa(b,l);if(m.length!==6&&m.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(m.length===1&&p==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Fs(b,p=p||m,m,l)}function Kp(b,p,l,m){return p===void 0&&(p=!0),He.makeVariable(b,p,l,m)}function Fu(b,p){if(p===void 0&&(p="float32"),p==="complex64"){var l=Fu(b,"float32"),m=uo(b,"float32");return Co(l,m)}var w=Kt(ze(b),p);return He.makeTensor(w,b,p)}function uo(b,p){if(p===void 0&&(p="float32"),p==="complex64"){var l=uo(b,"float32"),m=uo(b,"float32");return Co(l,m)}var w=Vt(ze(b),p);return He.makeTensor(w,b,p)}function Rs(b,p,l){return He.runKernelFunc(function(m){return m.fill(b,p,l)},{})}function Fh(b,p,l){if(l<=0)throw new Error("The number of values should be positive.");return He.runKernelFunc(function(m){return m.linspace(b,p,l)},{})}function Rc(b,p,l,m){if(l===void 0&&(l=1),m===void 0&&(m="float32"),l===0)throw new Error("Cannot have a step of zero");if(b===p||b<p&&l<0||p<b&&l>1)return uo([0],m);var w=Vt(Math.abs(Math.ceil((p-b)/l)),m);p<b&&l===1&&(l=-1),w[0]=b;for(var P=1;P<w.length;P++)w[P]=w[P-1]+l;return au(w,m)}var _s=Lt({onesLike_:function(b){var p=Ze(b,"x","onesLike");if(p.dtype==="complex64"){var l=_s(xa(p)),m=vi(Za(p));return Co(l,m)}return He.runKernelFunc(function(w){return w.onesLike(p)},{x:p},function(w,P){return{x:function(){return vi(w)}}},"OnesLike")}}),vi=Lt({zerosLike_:function(b){var p=Ze(b,"x","zerosLike");return He.runKernelFunc(function(l){return l.zerosLike(p)},{x:p},function(l,m){return{x:function(){return vi(l)}}},"ZerosLike")}}),$o=Lt({concat_:function(b,p){p===void 0&&(p=0),we(b.length>=1,function(){return"Pass at least one tensor to concat"});var l=hc(b,"tensors","concat");l[0].dtype==="complex64"&&l.forEach(function(ee){if(ee.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+ee.dtype+". ")}),p=Xt(p,l[0].shape)[0];var m=_u(l.map(function(ee){return ee.shape}),p);if(ze(m)===0)return No([],m);if((l=l.filter(function(ee){return ee.size>0})).length===1)return l[0];var w=l.map(function(ee){return ee.shape});rl(w,p);var P=l,K={axis:p};return He.runKernelFunc(function(ee){return ee.concat(l,p)},P,function(ee){var le=w.map(function(de){return de[p]});return $i(ee,le,p).map(function(de){return function(){return de}})},"Concat",K)}}),Rh=Lt({concat1d_:function(b){return $o(b,0)}}),Yp=Lt({concat2d_:function(b,p){return $o(b,p)}}),gf=Lt({concat3d_:function(b,p){return $o(b,p)}}),Ph=Lt({concat4d_:function(b,p){return $o(b,p)}}),$i=Lt({split_:function(b,p,l){l===void 0&&(l=0);var m,w=Ze(b,"x","split");return l=Xt(l,w.shape)[0],typeof p=="number"?(we(w.shape[l]%p==0,function(){return"Number of splits must evenly divide the axis."}),m=new Array(p).fill(w.shape[l]/p)):(we(w.shape[l]===p.reduce(function(P,K){return P+K}),function(){return"The sum of sizes must match the size of the axis dimension."}),m=p),He.runKernelFunc(function(P){return P.split(w,m,l)},{$x:w},function(P){return{$x:function(){return $o(P,l)}}})}});function Ii(b,p,l){return p===void 0&&(p="float32"),p=p||"float32",Vn(b),new qr(b,p,l)}function ma(b,p){p===void 0&&(p=!1),console.log(b.toString(p))}var Jp=Lt({batchToSpaceND_:function(b,p,l){var m=Ze(b,"x","batchToSpaceND"),w=p.reduce(function(P,K){return P*K});return we(m.rank>=1+p.length,function(){return"input rank is "+m.rank+" but should be > than blockShape.length "+p.length}),we(l.length===p.length,function(){return"crops.length is "+l.length+" but should be equal to blockShape.length  "+p.length}),we(m.shape[0]%w==0,function(){return"input tensor batch is "+m.shape[0]+" but is not divisible by the product of the elements of blockShape "+p.join(" * ")+" === "+w}),He.runKernelFunc(function(P){return P.batchToSpaceND(m,p,l)},{$x:m},function(P){return{$x:function(){return P.spaceToBatchND(p,l)}}})}}),Qp=Lt({cast_:function(b,p){var l=Ze(b,"x","cast");if(!Ye(p))throw new Error("Failed to cast to unknown dtype "+p);if(p==="string"&&l.dtype!=="string"||p!=="string"&&l.dtype==="string")throw new Error("Only strings can be casted to strings");var m={dtype:p};return He.runKernelFunc(function(w){return w.cast(l,p)},{x:l},function(w){return{x:function(){return w.clone()}}},"Cast",m)}}),Zp=Lt({cumsum_:function(b,p,l,m){p===void 0&&(p=0),l===void 0&&(l=!1),m===void 0&&(m=!1);var w=Ze(b,"x","cumsum"),P=Ba([p|=0],w.rank),K=w;P!=null&&(K=w.transpose(P));var ee=ja(1,w.rank)[0],le=He.runKernelFunc(function(de){return de.cumsum(K,ee,l,m)},{permutedX:K},function(de){return{permutedX:function(){return de.cumsum(p,l,!m)}}});return P!=null&&(le=le.transpose(P)),le}}),ng=Lt({depthToSpace_:function(b,p,l){l===void 0&&(l="NHWC");var m=Ze(b,"x","depthToSpace"),w=l==="NHWC"?m.shape[1]:m.shape[2],P=l==="NHWC"?m.shape[2]:m.shape[3],K=l==="NHWC"?m.shape[3]:m.shape[1];return we(w*p>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+w+" and "+p+`  for depthToSpace with input shape
      `+m.shape}),we(P*p>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+P+" and "+p+` for depthToSpace with input shape
          `+m.shape}),we(K%(p*p)==0,function(){return"Dimension size must be evenly divisible by "+p*p+" but is "+K+" for depthToSpace with input shape "+m.shape}),He.runKernelFunc(function(ee){return ee.depthToSpace(m,p,l)},{$x:m})}}),pc=Lt({expandDims_:function(b,p){p===void 0&&(p=0);var l=Ze(b,"x","expandDims",null);we(p<=l.rank,function(){return"Axis must be <= rank of the tensor"});var m=l.shape.slice();return p<0&&(we(-(l.rank+1)<=p,function(){return"Axis must be in the interval ["+-(l.rank+1)+", "+l.rank+"]"}),p=l.rank+p+1),m.splice(p,0,1),Ps(l,m)}}),Ps=Lt({reshape_:function(b,p){var l=Ze(b,"x","reshape",null);p=_t(p,l.size),we(l.size===ze(p),function(){return"new shape and old shape must have the same number of elements."});var m={shape:p};return He.runKernelFunc(function(w){return w.reshape(l,p)},{x:l},function(w){return{x:function(){return w.reshape(l.shape)}}},"Reshape",m)}}),Nl=Lt({spaceToBatchND_:function(b,p,l){var m=Ze(b,"x","spaceToBatchND");return we(m.rank>=1+p.length,function(){return"input rank "+m.rank+" should be > than [blockShape] "+p.length}),we(l.length===p.length,function(){return"paddings.shape[0] "+l.length+" must be equal to [blockShape] "+p.length}),we(m.shape.reduce(function(w,P,K){return K>0&&K<=p.length?w&&(P+l[K-1][0]+l[K-1][1])%p[K-1]==0:w},!0),function(){return"input spatial dimensions "+m.shape.slice(1)+" with paddings "+l.toString()+" must be divisible by blockShapes "+p.toString()}),He.runKernelFunc(function(w){return w.spaceToBatchND(m,p,l)},{$x:m},function(w){return{$x:function(){return w.batchToSpaceND(p,l)}}})}}),Ks=Lt({squeeze_:function(b,p){var l=Ze(b,"x","squeeze");return Ps(l,sn(l.shape,p).newShape)}}),Su=Lt({stack_:function(b,p){p===void 0&&(p=0);var l=hc(b,"tensors","stack");if(we(l.length>=1,function(){return"Pass at least one tensor to tf.stack"}),l.length===1)return l[0].expandDims(p);var m=l[0].rank,w=l[0].shape,P=l[0].dtype;we(p<=m,function(){return"Axis must be <= rank of the tensor"}),l.forEach(function(ee){yt(w,ee.shape,"All tensors passed to stack must have matching shapes")}),l.forEach(function(ee){we(P===ee.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var K=l.map(function(ee){return ee.expandDims(p)});return $o(K,p)}}),Lh=Lt({unstack_:function(b,p){p===void 0&&(p=0),p=p||0;var l=Ze(b,"x","unstack");we(p>=-l.shape.length&&p<l.shape.length,function(){return"Axis = "+p+" is not in [-"+l.shape.length+", "+l.shape.length+")"}),p<0&&(p+=l.shape.length);var m={axis:p};return He.runKernelFunc(function(w){return w.unstack(l,p)},{x:l},function(w){return{x:function(){return Su(w,p)}}},"Unpack",m)}}),Hi=function(b,p){return D(this,void 0,void 0,function(){var l,m,w,P,K,ee,le,de,Ee,Te;return R(this,function(Ne){switch(Ne.label){case 0:return l=Ze(b,"x","setdiff1d"),m=Ze(p,"y","setdiff1d"),we(l.dtype===m.dtype,function(){return"x and y should have the same dtype, but got x ("+l.dtype+") and y ("+m.dtype+")."}),we(l.rank===1,function(){return"x should be 1D tensor, but got x ("+l.shape+")."}),we(m.rank===1,function(){return"y should be 1D tensor, but got y ("+m.shape+")."}),[4,l.data()];case 1:return w=Ne.sent(),[4,m.data()];case 2:for(P=Ne.sent(),K=new Set(P),ee=0,Ee=0;Ee<w.length;Ee++)K.has(w[Ee])||ee++;for(le=new qr([ee],l.dtype),de=new qr([ee],"int32"),Ee=0,Te=0;Ee<w.length;Ee++)K.has(w[Ee])||(le.values[Te]=w[Ee],de.values[Te]=Ee,Te++);return[2,[le.toTensor(),de.toTensor()]]}})})};function _d(b,p,l,m){m===void 0&&(m=!0);var w=[];if(m)(w=w.concat(p.slice(0))).push(b[0]/l),w=w.concat(b.slice(1));else{w=w.concat(b[0]);for(var P=p.length,K=0;K<P;++K)w=w.concat([b[K+1]/p[K],p[K]]);w=w.concat(b.slice(P+1))}return w}function Il(b,p,l){l===void 0&&(l=!0);var m=[];if(l){m.push(p);for(var w=p+1;w<b;++w)w<=2*p?(m.push(w),m.push(w-(p+1))):m.push(w)}else{var P=[],K=[];for(w=1;w<b;++w)w>=2*p+1||w%2==1?K.push(w):P.push(w);m.push.apply(m,P),m.push(0),m.push.apply(m,K)}return m}function vf(b,p,l,m){m===void 0&&(m=!0);var w=[];m?w.push(b[0]/l):w.push(b[0]*l);for(var P=1;P<b.length;++P)P<=p.length?m?w.push(p[P-1]*b[P]):w.push(b[P]/p[P-1]):w.push(b[P]);return w}function em(b,p){for(var l=[0],m=0;m<p;++m)l.push(b[m][0]);return l}function rg(b,p,l){for(var m=b.slice(0,1),w=0;w<l;++w)m.push(b[w+1]-p[w][0]-p[w][1]);return m}var yf="Add",Bh="AddN",Xo="Div",jh="FusedBatchNorm",bf="SquaredDifference",zh="Square",xf="Transpose",Fl="NonMaxSuppressionV5",il="BroadcastTo",Uh="OneHot",Ed="Identity",wf="Tile",ol="PadV2",Zg="FromPixels",_f="MaxPoolWithArgmax",ha=Lt({add_:function(b,p){var l,m=Ze(b,"a","add"),w=Ze(p,"b","add");l=Zt(m,w),m=l[0],w=l[1];var P={a:m,b:w};return He.runKernelFunc(function(K,ee){var le=K.add(m,w);return ee([m,w]),le},P,null,yf)}});function za(b,p){for(var l=b.length,m=[],w=0;w<l;w++){var P=l-1-w,K=b[P]||1;(p[p.length-1-w]||1)>1&&K===1&&m.unshift(P)}return m}function Ga(b,p){for(var l=[],m=0;m<p.length;m++){var w=b[b.length-m-1],P=p.length-m-1,K=p[P];(w==null||w===1&&K>1)&&l.unshift(P)}return l}function Xi(b,p){for(var l=[],m=Math.max(b.length,p.length),w=0;w<m;w++){var P=b[b.length-w-1];P==null&&(P=1);var K=p[p.length-w-1];if(K==null&&(K=1),P===1)l.unshift(K);else if(K===1)l.unshift(P);else{if(P!==K)throw Error("Operands could not be broadcast together with shapes "+b+" and "+p+".");l.unshift(P)}}return l}var Ls=Lt({abs_:function(b){var p=Ze(b,"x","abs");return p.dtype==="complex64"?He.runKernelFunc(function(l){return l.complexAbs(p)},{$x:p}):He.runKernelFunc(function(l,m){var w=l.abs(p);return m([p]),w},{x:p},function(l,m){var w=m[0];return{x:function(){return l.mul(w.toFloat().step(-1))}}},"Abs")}}),al=Lt({acos_:function(b){var p=Ze(b,"x","acos");return He.runKernelFunc(function(l,m){var w=l.acos(p);return m([p]),w},{$x:p},function(l,m){var w=m[0];return{$x:function(){return l.divStrict(Ar(1).sub(w.toFloat().square()).sqrt()).neg()}}})}}),qa=Lt({acosh_:function(b){var p=Ze(b,"x","acosh");return He.runKernelFunc(function(l,m){var w=l.acosh(p);return m([p]),w},{$x:p},function(l,m){var w=m[0];return{$x:function(){return l.divStrict(w.toFloat().square().sub(1).sqrt())}}})}}),sl=Lt({asin_:function(b){var p=Ze(b,"x","asin");return He.runKernelFunc(function(l,m){var w=l.asin(p);return m([p]),w},{$x:p},function(l,m){var w=m[0];return{$x:function(){return l.divStrict(Ar(1).sub(w.toFloat().square()).sqrt())}}})}}),mc=Lt({asinh_:function(b){var p=Ze(b,"x","asinh");return He.runKernelFunc(function(l,m){var w=l.asinh(p);return m([p]),w},{$x:p},function(l,m){var w=m[0];return{$x:function(){return l.divStrict(Ar(1).add(w.toFloat().square()).sqrt())}}})}}),Sd=Lt({atan_:function(b){var p=Ze(b,"x","atan");return He.runKernelFunc(function(l,m){var w=l.atan(p);return m([p]),w},{$x:p},function(l,m){var w=m[0];return{$x:function(){return l.div(w.toFloat().square().add(1))}}})}}),Cd=Lt({atanh_:function(b){var p=Ze(b,"x","atanh");return He.runKernelFunc(function(l,m){var w=l.atanh(p);return m([p]),w},{$x:p},function(l,m){var w=m[0];return{$x:function(){return l.div(Ar(1).sub(w.toFloat().square()))}}})}}),Rl=Lt({ceil_:function(b){var p=Ze(b,"x","ceil");return He.runKernelFunc(function(l){return l.ceil(p)},{$x:p},function(l){return{$x:function(){return vi(l)}}})}}),tm=Lt({clipByValue_:function(b,p,l){var m=Ze(b,"x","clipByValue");we(p<=l,function(){return"Error in clip: min ("+p+") must be less than or equal to max ("+l+")."});var w=[m],P={min:p,max:l};return He.runKernelFunc(function(K,ee){var le=K.clip(m,p,l);return ee([m]),le},{x:m},function(K,ee){var le=ee[0];return{x:function(){return K.where(le.greaterEqual(p).logicalAnd(le.lessEqual(l)),vi(K))}}},"ClipByValue",P,w)}}),gc=Lt({cos_:function(b){var p=Ze(b,"x","cos"),l=[p];return He.runKernelFunc(function(m,w){var P=m.cos(p);return w([p]),P},{x:p},function(m,w){var P=w[0];return{x:function(){return P.toFloat().sin().neg().mul(m)}}},"Cos",{},l)}}),e0=Lt({cosh_:function(b){var p=Ze(b,"x","cosh");return He.runKernelFunc(function(l,m){var w=l.cosh(p);return m([p]),w},{$x:p},function(l,m){var w=m[0];return{$x:function(){return w.toFloat().sinh().mulStrict(l)}}})}}),nm=Lt({erf_:function(b){var p=Ze(b,"x","erf");return we(p.dtype==="int32"||p.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),p.dtype==="int32"&&(p=p.toFloat()),He.runKernelFunc(function(l,m){var w=l.erf(p);return m([p]),w},{$x:p},function(l,m){var w=m[0];return{$x:function(){return l.mul(w.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Ef=Lt({exp_:function(b){var p=Ze(b,"x","exp");return He.runKernelFunc(function(l,m){var w=l.exp(p);return m([w]),w},{x:p},function(l,m){return{x:function(){return l.mulStrict(m[0])}}},"Exp",{},[],[!0])}}),ig=Lt({expm1_:function(b){var p=Ze(b,"x","expm1");return He.runKernelFunc(function(l,m){var w=l.expm1(p);return m([p]),w},{$x:p},function(l,m){var w=m[0];return{$x:function(){return l.mul(w.exp())}}})}}),kd=Lt({floor_:function(b){var p=Ze(b,"x","floor");return He.runKernelFunc(function(l){return l.floor(p)},{$x:p},function(l){return{$x:function(){return vi(l)}}})}}),Pl=Lt({log_:function(b){var p=Ze(b,"x","log"),l=[p];return He.runKernelFunc(function(m,w){var P=m.log(p);return w([p]),P},{x:p},function(m,w){var P=w[0];return{x:function(){return m.div(P.toFloat())}}},"Log",{},l)}}),rm=Lt({log1p_:function(b){var p=Ze(b,"x","log1p");return He.runKernelFunc(function(l,m){var w=l.log1p(p);return m([p]),w},{$x:p},function(l,m){var w=m[0];return{$x:function(){return l.div(w.add(1))}}})}}),Wh=Lt({logSigmoid_:function(b){var p=Ze(b,"x","logSigmoid");return He.runKernelFunc(function(l,m){var w=l.softplus(p.neg()).neg();return m([p]),w},{$x:p},function(l,m){var w=m[0];return{$x:function(){return l.mul(w.neg().sigmoid())}}})}}),Da=Lt({neg_:function(b){var p=Ze(b,"x","neg"),l=[p];return He.runKernelFunc(function(m){return m.neg(p)},{x:p},function(m){return{x:function(){return m.neg()}}},"Neg",{},l)}}),Sf=Lt({reciprocal_:function(b){var p=Ze(b,"x","reciprocal");return He.runKernelFunc(function(l,m){var w=l.reciprocal(p);return m([p]),w},{$x:p},function(l,m){var w=m[0];return{$x:function(){return l.div(w.square().neg())}}})}}),Bs=Lt({round_:function(b){var p=Ze(b,"x","round");return He.runKernelFunc(function(l){return l.round(p)},{$x:p},function(l){return{$x:function(){return vi(l)}}})}}),Cf=Lt({rsqrt_:function(b){var p=Ze(b,"x","rsqrt"),l=[p];return He.runKernelFunc(function(m,w){var P=m.rsqrt(p);return w([p]),P},{x:p},function(m,w){var P=w[0];return{x:function(){return m.div(P.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},l)}}),Ad=Lt({sigmoid_:function(b){var p=Ze(b,"x","sigmoid");return He.runKernelFunc(function(l,m){var w=l.sigmoid(p);return m([w]),w},{x:p},function(l,m){var w=m[0];return{x:function(){return l.mul(w.mul(Ar(1).sub(w)))}}},"Sigmoid")}}),Vh=Lt({sign_:function(b){var p=Ze(b,"x","sign");return He.runKernelFunc(function(l){return l.sign(p)},{$x:p},function(l){return{$x:function(){return vi(l)}}})}}),im=Lt({isNaN_:function(b){var p=Ze(b,"x","isNaN");return He.runKernelFunc(function(l){return l.isNaN(p)},{$x:p},function(l){return{$x:function(){return vi(l)}}})}}),Od=Lt({isInf_:function(b){var p=Ze(b,"x","isInf");return He.runKernelFunc(function(l){return l.isInf(p)},{$x:p},function(l){return{$x:function(){return vi(l)}}})}}),kf=Lt({isFinite_:function(b){var p=Ze(b,"x","isFinite");return He.runKernelFunc(function(l){return l.isFinite(p)},{$x:p},function(l){return{$x:function(){return vi(l)}}})}}),om=Lt({sin_:function(b){var p=Ze(b,"x","sin"),l=[p];return He.runKernelFunc(function(m,w){var P=m.sin(p);return w([p]),P},{x:p},function(m,w){var P=w[0];return{x:function(){return P.toFloat().cos().mul(m)}}},"Sin",{},l)}}),am=Lt({sinh_:function(b){var p=Ze(b,"x","sinh");return He.runKernelFunc(function(l,m){var w=l.sinh(p);return m([p]),w},{$x:p},function(l,m){var w=m[0];return{$x:function(){return w.toFloat().cosh().mulStrict(l)}}})}}),bn=Lt({softplus_:function(b){var p=Ze(b,"x","softplus");return He.runKernelFunc(function(l,m){var w=l.softplus(p);return m([p]),w},{$x:p},function(l,m){var w=m[0];return{$x:function(){return l.mul(w.sigmoid())}}})}}),uu=Lt({sqrt_:function(b){var p=Ze(b,"x","sqrt");return He.runKernelFunc(function(l,m){var w=l.sqrt(p);return m([p]),w},{$x:p},function(l,m){var w=m[0];return{$x:function(){return l.div(w.toFloat().sqrt().mul(2))}}})}}),tr=Lt({step_:function(b,p){p===void 0&&(p=0);var l=Ze(b,"x","step");return He.runKernelFunc(function(m){return m.step(l,p)},{$x:l},function(m){return{$x:function(){return vi(m)}}})}}),js=Lt({tan_:function(b){var p=Ze(b,"x","tan");return He.runKernelFunc(function(l,m){var w=l.tan(p);return m([p]),w},{$x:p},function(l,m){var w=m[0];return{$x:function(){return l.div(w.cos().square())}}})}}),vo=Lt({tanh_:function(b){var p=Ze(b,"x","tanh");return He.runKernelFunc(function(l,m){var w=l.tanh(p);return m([w]),w},{x:p},function(l,m){var w=m[0];return{x:function(){return Ar(1).sub(w.square()).mulStrict(l)}}},"Tanh",{},null,[!0])}}),Af=Lt({addStrict_:function(b,p){var l=Ze(b,"a","addStrict"),m=Ze(p,"b","addStrict");return yt(l.shape,m.shape,"Error in addStrict: "),l.add(m)}}),Td=Lt({atan2_:function(b,p){var l,m=Ze(b,"a","atan2"),w=Ze(p,"b","atan2");l=Zt(m,w),m=l[0],w=l[1];var P=Xi(m.shape,w.shape);return He.runKernelFunc(function(K,ee){var le=K.atan2(m,w);return ee([m,w]),le},{$a:m,$b:w},function(K,ee){var le=ee[0],de=ee[1];return{$a:function(){var Ee=ha(le.square(),de.square()),Te=K.mul(de.div(Ee)),Ne=Ga(le.shape,P);return Ne.length>0&&(Te=Te.sum(Ne)),Te.reshape(le.shape)},$b:function(){var Ee=ha(le.square(),de.square()),Te=Da(K.mul(le.div(Ee))),Ne=Ga(de.shape,P);return Ne.length>0&&(Te=Te.sum(Ne)),Te.reshape(de.shape)}}})}}),mr=Lt({divStrict_:function(b,p){var l=Ze(b,"a","div"),m=Ze(p,"b","div");return yt(l.shape,m.shape,"Error in divideStrict: "),l.div(m)}}),is=Lt({floorDiv_:function(b,p){var l,m=Ze(b,"a","floorDiv"),w=Ze(p,"b","floorDiv");l=Zt(m,w),m=l[0],w=l[1];var P=Xi(m.shape,w.shape);return He.runKernelFunc(function(K,ee){var le=K.floorDiv(m,w);return ee([m,w]),le},{a:m,b:w},function(K,ee){var le=ee[0],de=ee[1];return{a:function(){var Ee=K.div(de.toFloat()),Te=Ga(le.shape,P);return Te.length>0?Ee.sum(Te).reshape(le.shape):Ee},b:function(){var Ee=K.mul(le.toFloat()),Te=Ga(de.shape,P);Te.length>0&&(Ee=Ee.sum(Te).reshape(de.shape));var Ne=de.square();return Ee.div(Ne.toFloat()).neg()}}},"FloorDiv")}}),Na=Lt({maximum_:function(b,p){var l,m=Ze(b,"a","maximum"),w=Ze(p,"b","maximum");return l=Zt(m,w),m=l[0],w=l[1],m.dtype==="bool"&&(m=m.toInt(),w=w.toInt()),Xi(m.shape,w.shape),He.runKernelFunc(function(P,K){var ee=P.maximum(m,w);return K([m,w]),ee},{a:m,b:w},function(P,K){var ee=K[0],le=K[1];return{a:function(){return P.mul(ee.greaterEqual(le).toFloat())},b:function(){return P.mul(ee.less(le).toFloat())}}},"Maximum")}}),io=Lt({maximumStrict_:function(b,p){var l=Ze(b,"a","maximumStrict"),m=Ze(p,"b","maximumStrict");return yt(l.shape,m.shape,"Error in maximumStrict: "),l.maximum(m)}}),Xu=Lt({minimum_:function(b,p){var l,m=Ze(b,"a","minimum"),w=Ze(p,"b","minimum");return l=Zt(m,w),m=l[0],w=l[1],m.dtype==="bool"&&(m=m.toInt(),w=w.toInt()),Xi(m.shape,w.shape),He.runKernelFunc(function(P,K){var ee=P.minimum(m,w);return K([m,w]),ee},{a:m,b:w},function(P,K){var ee=K[0],le=K[1];return{a:function(){return P.mul(ee.lessEqual(le).toFloat())},b:function(){return P.mul(ee.greater(le).toFloat())}}},"Minimum")}}),Pc=Lt({minimumStrict_:function(b,p){var l=Ze(b,"a","minimumStrict"),m=Ze(p,"b","minimumStrict");return yt(l.shape,m.shape,"Error in minimumStrict: "),l.minimum(m)}}),cu=Lt({mod_:function(b,p){var l,m=Ze(b,"a","mod"),w=Ze(p,"b","mod");l=Zt(m,w),m=l[0],w=l[1];var P=Xi(m.shape,w.shape);return He.runKernelFunc(function(K,ee){var le=K.mod(m,w);return ee([m,w]),le},{$a:m,$b:w},function(K,ee){var le=ee[0],de=ee[1];return{$a:function(){var Ee=Ga(le.shape,P);return Ee.length>0?K.sum(Ee).reshape(le.shape):K},$b:function(){var Ee=K.mul(le.div(de).floor().neg()),Te=Ga(de.shape,P);return Te.length>0?Ee.sum(Te).reshape(de.shape):Ee}}})}}),Lc=Lt({modStrict_:function(b,p){var l=Ze(b,"a","modStrict"),m=Ze(p,"b","modStrict");return yt(l.shape,m.shape,"Error in modStrict: "),l.mod(m)}}),oa=Lt({mul_:function(b,p){var l,m=Ze(b,"a","mul"),w=Ze(p,"b","mul");l=Zt(m,w),m=l[0],w=l[1];var P=Xi(m.shape,w.shape);return He.runKernelFunc(function(K,ee){var le=K.multiply(m,w);return ee([m,w]),le},{a:m,b:w},function(K,ee){var le=ee[0],de=ee[1];return{a:function(){var Ee=K.mul(de.toFloat()),Te=Ga(le.shape,P);return Te.length>0?Ee.sum(Te).reshape(le.shape):Ee},b:function(){var Ee=K.mul(le.toFloat()),Te=Ga(de.shape,P);return Te.length>0?Ee.sum(Te).reshape(de.shape):Ee}}},"Mul")}}),vc=Lt({mulStrict_:function(b,p){var l=Ze(b,"a","mul"),m=Ze(p,"b","mul");return yt(l.shape,m.shape,"Error in multiplyStrict: "),l.mul(m)}}),lu=Lt({pow_:function(b,p){var l,m=Ze(b,"base","pow"),w=Ze(p,"exp","pow");l=Zt(m,w),m=l[0],w=l[1];var P=Xi(m.shape,w.shape),K=[m,w];return He.runKernelFunc(function(ee,le){var de=ee.pow(m,w);return le([m,w,de]),de},{a:m,b:w},function(ee,le){var de=le[0],Ee=le[1],Te=le[2];return{a:function(){var Ne=Ee.toFloat(),Fe=ee.mul(Ne.mul(de.pow(Ne.sub(Ar(1))))),qe=Ga(de.shape,P);return qe.length>0&&(Fe=Fe.sum(qe)),Fe.reshape(de.shape)},b:function(){var Ne=de.greater(0),Fe=de.log().where(Ne,vi(de)),qe=ee.mul(Te.mul(Fe)),Je=Ga(Ee.shape,P);return Je.length>0&&(qe=qe.sum(Je)),qe.reshape(Ee.shape)}}},"Pow",{},K,[!0])}}),bo=Lt({powStrict_:function(b,p){return yt(b.shape,p.shape,"Error in powStrict: "),b.pow(p)}}),Es=Lt({squaredDifferenceStrict_:function(b,p){var l=Ze(b,"a","squaredDifferenceStrict"),m=Ze(p,"b","squaredDifferenceStrict");return yt(l.shape,m.shape,"Error in squaredDifferenceStrict: "),l.squaredDifference(m)}}),Ua=Lt({sub_:function(b,p){var l,m=Ze(b,"a","sub"),w=Ze(p,"b","sub");l=Zt(m,w),m=l[0],w=l[1];var P=Xi(m.shape,w.shape);return He.runKernelFunc(function(K){return K.subtract(m,w)},{a:m,b:w},function(K){return{a:function(){var ee=K,le=Ga(m.shape,P);return le.length>0&&(ee=ee.sum(le)),ee.reshape(m.shape)},b:function(){var ee=K,le=Ga(w.shape,P);return le.length>0&&(ee=ee.sum(le)),ee.neg().reshape(w.shape)}}},"Sub")}}),Ss=Lt({subStrict_:function(b,p){var l=Ze(b,"a","subStrict"),m=Ze(p,"b","subStrict");return yt(l.shape,m.shape,"Error in subStrict: "),l.sub(m)}}),aa=Lt({div_:function(b,p){var l,m=Ze(b,"a","div"),w=Ze(p,"b","div");if(l=Zt(m,w),m=l[0],w=l[1],m.dtype==="int32"&&w.dtype==="int32")return is(m,w);var P={a:m,b:w};return He.runKernelFunc(function(K,ee){var le=K.realDivide(m,w);return ee([m,w]),le},P,null,Xo,{})}});function fu(b,p){if(b.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+b.rank+".");if(p.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+p.rank+".");if(p.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+p.dtype+".");if(p.shape[p.rank-1]>b.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+p.shape[p.rank-1]+" vs. "+b.rank);if(b.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+b.shape+".");for(var l=p.shape,m=l[l.length-1],w=1,P=0;P<l.length-1;++P)w*=l[P];var K=b.shape,ee=l.slice();ee.pop();var le=1;for(P=m;P<b.rank;++P)le*=K[P],ee.push(K[P]);var de=on(b.shape).map(function(Ee){return Ee/le}).concat([1]).slice(0,m);return[ee,w,le,de]}var Ku=Object.freeze({prepareAndValidate:fu}),yc=30;function Bc(b){return b<=yc?b:Mr(b,Math.floor(Math.sqrt(b)))}function Yu(b,p,l){var m=p.rank>1?p.shape[p.rank-1]:1,w=p.rank>1?p.rank-1:1,P="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+l.shape+", indices.shape: "+p.shape+", shape: "+b+", sliceDim: "+m+", and batchDim: "+w+".";if(l.rank<w)throw new Error(P+" update.rank < "+w+". ");if(b.length<m+(l.rank-w))throw new Error(P+" Output shape length < "+(m+(l.rank-w)));if(l.rank!==w+b.length-m)throw new Error(P+" update.rank != "+(w+b.length-m));for(var K=0;K<w;++K)if(l.shape[K]!==p.shape[K])throw new Error(P+" updates.shape["+K+"] ("+l.shape[K]+") != indices.shape["+K+"] ("+p.shape[K]+").");for(K=0;K<l.rank-w;++K)if(l.shape[K+w]!==b[K+m])throw new Error(P+" updates.shape["+(K+w)+"] ("+l.shape[K+w]+") != shape["+(K+w)+"] ("+b[K+w]+")")}function Ll(b,p,l){if(p.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+p.rank+".");if(b.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+b.rank+".");if(p.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+p.dtype);if(l.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+l);if(l.length===0){if(p.size===0)throw new Error("Indices specified for empty output. indices shape: "+p.shape);if(b.size===0)throw new Error("Updates specified for empty output. updates shape: "+b.shape)}Yu(l,p,b)}function Bl(b,p,l){for(var m=p.shape.length,w=m>1?p.shape[m-1]:1,P=l.length,K=1,ee=w;ee<P;++ee)K*=l[ee];var le=w<1?1:w;return{sliceRank:w,numUpdates:ze(p.shape)/le,sliceSize:K,strides:on(l.slice(0,w)).concat([1]),outputSize:ze(l)}}var Hh=Object.freeze({validateUpdateShape:Yu,validateInput:Ll,calculateShapes:Bl});function jl(b,p,l){we(b.rank===p.length,function(){return"Error in slice"+b.rank+"D: Length of begin "+p+" must match the rank of the array ("+b.rank+")."}),we(b.rank===l.length,function(){return"Error in slice"+b.rank+"D: Length of size "+l+" must match the rank of the array ("+b.rank+")."});for(var m=function(P){we(p[P]+l[P]<=b.shape[P],function(){return"Error in slice"+b.rank+"D: begin["+P+"] + size["+P+"] ("+(p[P]+l[P])+") would overflow input.shape["+P+"] ("+b.shape[P]+")"})},w=0;w<b.rank;++w)m(w)}function du(b){for(var p=[],l=0;b>0;)1&b&&p.push(l),b/=2,l++;return p}function Ju(b,p,l){for(var m=[],w=0;w<b.length;w++)m[w]=Math.ceil((p[w]-b[w])/l[w]);return m}function Qu(b,p,l,m,w){var P=p[w],K=l[w]||1;(b&1<<w||P==null)&&(P=K>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var ee=m[w];return P<0&&(P+=ee),lt(0,P,ee-1)}function Cu(b,p,l,m,w){var P=p[w],K=l[w]||1;(b&1<<w||P==null)&&(P=K>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var ee=m[w];return P<0&&(P+=ee),K>0?lt(0,P,ee):lt(-1,P,ee-1)}function Gh(b,p,l){for(var m=l.length,w=0;w<l.length;w++)if(l[w]>1){m=w;break}for(w=m+1;w<l.length;w++)if(p[w]>0||l[w]!==b[w])return!1;return!0}function Md(b,p){for(var l=b.length>0?b[b.length-1]:1,m=0;m<b.length-1;m++)l+=b[m]*p[m];return l}var Dd=Object.freeze({assertParamsValid:jl,maskToAxes:du,computeOutShape:Ju,startForAxis:Qu,stopForAxis:Cu,isSliceContinous:Gh,computeFlatOffset:Md});function Of(b){return we(sr(b),function(){return"The f passed in grad(f) must be a function"}),function(p,l){var m=Ze(p,"x","tf.grad",null),w=l!=null?Ze(l,"dy","tf.grad"):null;return He.tidy(function(){var P=He.gradients(function(){return b(m)},[m],w),K=P.value,ee=P.grads;return w!=null&&yt(K.shape,w.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),ce(ee),ee[0]})}}function Nd(b){return we(sr(b),function(){return"The f passed in grads(f) must be a function"}),function(p,l){we(Array.isArray(p),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var m=hc(p,"args","tf.grads",null),w=l!=null?Ze(l,"dy","tf.grads"):null;return He.tidy(function(){var P=He.gradients(function(){return b.apply(void 0,m)},m,w),K=P.value,ee=P.grads;return w!=null&&yt(K.shape,w.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),ce(ee),ee})}}function se(b){return we(sr(b),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(p,l){we(p instanceof Qt,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),we(l==null||l instanceof Qt,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var m=He.gradients(function(){return b(p)},[p],l),w=m.grads,P=m.value;return ce(w),{grad:w[0],value:P}}}function ne(b){return we(sr(b),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(p,l){we(Array.isArray(p)&&p.every(function(w){return w instanceof Qt}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),we(l==null||l instanceof Qt,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var m=He.gradients(function(){return b.apply(void 0,p)},p,l);return l!=null&&yt(m.value.shape,l.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),ce(m.grads),m}}function N(b,p){we(sr(b),function(){return"The f passed in variableGrads(f) must be a function"}),we(p==null||Array.isArray(p)&&p.every(function(Ee){return Ee instanceof Ct}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var l=p!=null;if(!l)for(var m in p=[],He.registeredVariables)p.push(He.registeredVariables[m]);var w=l?p.filter(function(Ee){return!Ee.trainable}):null,P=p.length;we((p=p.filter(function(Ee){return Ee.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+P+" variables is trainable."});var K=He.gradients(b,p,null,!0),ee=K.value,le=K.grads;we(le.some(function(Ee){return Ee!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),we(ee.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+ee.rank+" tensor"});var de={};return p.forEach(function(Ee,Te){le[Te]!=null&&(de[Ee.name]=le[Te])}),w!=null&&w.forEach(function(Ee){return de[Ee.name]=null}),{value:ee,grads:de}}function G(b){return He.customGrad(b)}function ce(b){if(b.filter(function(p){return p==null}).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}var je=Lt({softmax_:function(b,p){p===void 0&&(p=-1);var l=Ze(b,"logits","softmax","float32");if(p===-1&&(p=l.rank-1),p!==l.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+l.rank+" and dim was "+p);return He.runKernelFunc(function(m,w){var P=m.softmax(l,p);return w([P]),P},{logits:l},function(m,w){var P=w[0],K=m.mul(P);return{logits:function(){return K.sub(K.sum([p],!0).mul(P))}}},"Softmax",{dim:p},[],[!0])}}),Qe=Lt({logSoftmax_:function(b,p){p===void 0&&(p=-1);var l=Ze(b,"logits","logSoftmax");if(p===-1&&(p=l.rank-1),p!==l.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+l.rank+" and axis was "+p);return G(function(m,w){var P=m.max(p,!0),K=m.sub(P),ee=K.toFloat().sub(K.exp().sum(p,!0).log());return w([ee]),{value:ee,gradFunc:function(le,de){var Ee=de[0].exp();return le.sub(le.sum(p,!0).mul(Ee))}}})(l)}}),bt=Lt({transpose_:function(b,p){var l=Ze(b,"x","transpose");if(p==null&&(p=l.shape.map(function(w,P){return P}).reverse()),we(l.rank===p.length,function(){return"Error in transpose: rank of input "+l.rank+" must match length of perm "+p+"."}),p.forEach(function(w){we(w>=0&&w<l.rank,function(){return"All entries in 'perm' must be between 0 and "+(l.rank-1)+" but got "+p})}),l.rank<=1)return l.clone();var m={perm:p};return He.runKernelFunc(function(w){return w.transpose(l,p)},{x:l},null,"Transpose",m)}}),qt=function(){function b(p,l){this.backend=p,this.dataMover=l,this.data=new WeakMap,this.dataIdsCount=0}return b.prototype.get=function(p){return this.data.has(p)||this.dataMover.moveData(this.backend,p),this.data.get(p)},b.prototype.set=function(p,l){this.dataIdsCount++,this.data.set(p,l)},b.prototype.has=function(p){return this.data.has(p)},b.prototype.delete=function(p){return this.dataIdsCount--,this.data.delete(p)},b.prototype.numDataIds=function(){return this.dataIdsCount},b}(),un=function(){function b(){}return b.prototype.time=function(p){return ht("time")},b.prototype.read=function(p){return ht("read")},b.prototype.readSync=function(p){return ht("readSync")},b.prototype.numDataIds=function(){return ht("numDataIds")},b.prototype.disposeData=function(p){return ht("disposeData")},b.prototype.write=function(p,l,m){return ht("write")},b.prototype.move=function(p,l,m,w){return ht("move")},b.prototype.memory=function(){return ht("memory")},b.prototype.floatPrecision=function(){return ht("floatPrecision")},b.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},b.prototype.batchMatMul=function(p,l,m,w){return ht("batchMatMul")},b.prototype.fusedBatchMatMul=function(p){return p.a,p.b,p.transposeA,p.transposeB,p.bias,p.activation,p.preluActivationWeights,ht("fusedBatchMatMul")},b.prototype.slice=function(p,l,m){return ht("slice")},b.prototype.stridedSlice=function(p,l,m,w){return ht("stridedSlice")},b.prototype.unstack=function(p,l){return ht("unstack")},b.prototype.reverse=function(p,l){return ht("reverse")},b.prototype.concat=function(p,l){return ht("concat")},b.prototype.neg=function(p){return ht("neg")},b.prototype.add=function(p,l){return ht("add")},b.prototype.addN=function(p){return ht("addN")},b.prototype.subtract=function(p,l){return ht("subtract")},b.prototype.multiply=function(p,l){return ht("multiply")},b.prototype.realDivide=function(p,l){return ht("realDivide")},b.prototype.floorDiv=function(p,l){return ht("floorDiv")},b.prototype.sum=function(p,l){return ht("sum")},b.prototype.prod=function(p,l){return ht("prod")},b.prototype.unsortedSegmentSum=function(p,l,m){return ht("unsortedSegmentSum")},b.prototype.argMin=function(p,l){return ht("argMin")},b.prototype.argMax=function(p,l){return ht("argMax")},b.prototype.equal=function(p,l){return ht("equal")},b.prototype.notEqual=function(p,l){return ht("notEqual")},b.prototype.less=function(p,l){return ht("less")},b.prototype.lessEqual=function(p,l){return ht("lessEqual")},b.prototype.greater=function(p,l){return ht("greater")},b.prototype.greaterEqual=function(p,l){return ht("greaterEqual")},b.prototype.logicalNot=function(p){return ht("logicalNot")},b.prototype.logicalAnd=function(p,l){return ht("logicalAnd")},b.prototype.logicalOr=function(p,l){return ht("logicalOr")},b.prototype.where=function(p){return ht("where")},b.prototype.select=function(p,l,m){return ht("select")},b.prototype.topk=function(p,l,m){return ht("topk")},b.prototype.min=function(p,l){return ht("min")},b.prototype.minimum=function(p,l){return ht("minimum")},b.prototype.mod=function(p,l){return ht("mod")},b.prototype.max=function(p,l){return ht("max")},b.prototype.maximum=function(p,l){return ht("maximum")},b.prototype.all=function(p,l){return ht("all")},b.prototype.any=function(p,l){return ht("any")},b.prototype.squaredDifference=function(p,l){return ht("squaredDifference")},b.prototype.ceil=function(p){return ht("ceil")},b.prototype.floor=function(p){return ht("floor")},b.prototype.round=function(p){return ht("round")},b.prototype.sign=function(p){return ht("sign")},b.prototype.isNaN=function(p){return ht("isNaN")},b.prototype.isInf=function(p){return ht("isInf")},b.prototype.isFinite=function(p){return ht("isFinite")},b.prototype.pow=function(p,l){return ht("pow")},b.prototype.exp=function(p){return ht("exp")},b.prototype.expm1=function(p){return ht("expm1")},b.prototype.softmax=function(p,l){return ht("softmax")},b.prototype.log=function(p){return ht("log")},b.prototype.log1p=function(p){return ht("log1p")},b.prototype.sqrt=function(p){return ht("sqrt")},b.prototype.rsqrt=function(p){return ht("rsqrt")},b.prototype.square=function(p){return ht("square")},b.prototype.reciprocal=function(p){return ht("reciprocal")},b.prototype.relu=function(p){return ht("relu")},b.prototype.relu6=function(p){return ht("relu6")},b.prototype.prelu=function(p,l){return ht("prelu")},b.prototype.elu=function(p){return ht("elu")},b.prototype.eluDer=function(p,l){return ht("eluDer")},b.prototype.selu=function(p){return ht("selu")},b.prototype.int=function(p){return ht("int")},b.prototype.clip=function(p,l,m){return ht("clip")},b.prototype.abs=function(p){return ht("abs")},b.prototype.complexAbs=function(p){return ht("complexAbs")},b.prototype.sigmoid=function(p){return ht("sigmoid")},b.prototype.softplus=function(p){return ht("softplus")},b.prototype.sin=function(p){return ht("sin")},b.prototype.cos=function(p){return ht("cos")},b.prototype.tan=function(p){return ht("tan")},b.prototype.asin=function(p){return ht("asin")},b.prototype.acos=function(p){return ht("acos")},b.prototype.atan=function(p){return ht("atan")},b.prototype.atan2=function(p,l){return ht("atan2")},b.prototype.sinh=function(p){return ht("sinh")},b.prototype.cosh=function(p){return ht("cosh")},b.prototype.tanh=function(p){return ht("tanh")},b.prototype.asinh=function(p){return ht("asinh")},b.prototype.acosh=function(p){return ht("acosh")},b.prototype.atanh=function(p){return ht("atanh")},b.prototype.erf=function(p){return ht("erf")},b.prototype.step=function(p,l){return ht("step")},b.prototype.fusedConv2d=function(p){return p.input,p.filter,p.convInfo,p.bias,p.activation,p.preluActivationWeights,ht("fusedConv2d")},b.prototype.conv2d=function(p,l,m){return ht("conv2d")},b.prototype.conv2dDerInput=function(p,l,m){return ht("conv2dDerInput")},b.prototype.conv2dDerFilter=function(p,l,m){return ht("conv2dDerFilter")},b.prototype.fusedDepthwiseConv2D=function(p){return p.input,p.filter,p.convInfo,p.bias,p.activation,p.preluActivationWeights,ht("fusedDepthwiseConv2D")},b.prototype.depthwiseConv2D=function(p,l,m){return ht("depthwiseConv2D")},b.prototype.depthwiseConv2DDerInput=function(p,l,m){return ht("depthwiseConv2DDerInput")},b.prototype.depthwiseConv2DDerFilter=function(p,l,m){return ht("depthwiseConv2DDerFilter")},b.prototype.conv3d=function(p,l,m){return ht("conv3d")},b.prototype.conv3dDerInput=function(p,l,m){return ht("conv3dDerInput")},b.prototype.conv3dDerFilter=function(p,l,m){return ht("conv3dDerFilter")},b.prototype.maxPool=function(p,l){return ht("maxPool")},b.prototype.maxPoolBackprop=function(p,l,m,w){return ht("maxPoolBackprop")},b.prototype.avgPool=function(p,l){return ht("avgPool")},b.prototype.avgPoolBackprop=function(p,l,m){return ht("avgPoolBackprop")},b.prototype.avgPool3d=function(p,l){return ht("avgPool3d")},b.prototype.avgPool3dBackprop=function(p,l,m){return ht("avgPool3dBackprop")},b.prototype.maxPool3d=function(p,l){return ht("maxPool3d")},b.prototype.maxPool3dBackprop=function(p,l,m,w){return ht("maxPool3dBackprop")},b.prototype.reshape=function(p,l){return ht("reshape")},b.prototype.cast=function(p,l){return ht("cast")},b.prototype.tile=function(p,l){return ht("tile")},b.prototype.pad=function(p,l,m){return ht("pad")},b.prototype.transpose=function(p,l){return ht("transpose")},b.prototype.gather=function(p,l,m){return ht("gather")},b.prototype.gatherND=function(p,l){return ht("gatherND")},b.prototype.scatterND=function(p,l,m){return ht("scatterND")},b.prototype.batchToSpaceND=function(p,l,m){return ht("batchToSpaceND")},b.prototype.spaceToBatchND=function(p,l,m){return ht("spaceToBatchND")},b.prototype.resizeBilinear=function(p,l,m,w){return ht("resizeBilinear")},b.prototype.resizeBilinearBackprop=function(p,l,m){return ht("resizeBilinearBackprop")},b.prototype.resizeNearestNeighbor=function(p,l,m,w){return ht("resizeNearestNeighbor")},b.prototype.resizeNearestNeighborBackprop=function(p,l,m){return ht("resizeNearestNeighborBackprop")},b.prototype.batchNormalization=function(p,l,m,w,P,K){return ht("batchNormalization")},b.prototype.localResponseNormalization4D=function(p,l,m,w,P){return ht("localResponseNormalization4D")},b.prototype.LRNGrad=function(p,l,m,w,P,K,ee){return ht("LRNGrad")},b.prototype.multinomial=function(p,l,m,w){return ht("multinomial")},b.prototype.oneHot=function(p,l,m,w){return ht("oneHot")},b.prototype.cumsum=function(p,l,m,w){return ht("cumsum")},b.prototype.nonMaxSuppression=function(p,l,m,w,P){return ht("nonMaxSuppression")},b.prototype.fft=function(p){return ht("fft")},b.prototype.ifft=function(p){return ht("ifft")},b.prototype.complex=function(p,l){return ht("complex")},b.prototype.real=function(p){return ht("real")},b.prototype.imag=function(p){return ht("imag")},b.prototype.cropAndResize=function(p,l,m,w,P,K){return ht("cropAndResize")},b.prototype.depthToSpace=function(p,l,m){return ht("depthToSpace")},b.prototype.split=function(p,l,m){return ht("split")},b.prototype.sparseToDense=function(p,l,m,w){return ht("sparseToDense")},b.prototype.diag=function(p){return ht("diag")},b.prototype.fill=function(p,l,m){return ht("fill")},b.prototype.onesLike=function(p){return ht("onesLike")},b.prototype.zerosLike=function(p){return ht("zerosLike")},b.prototype.linspace=function(p,l,m){return ht("linspace")},b.prototype.dispose=function(){return ht("dispose")},b}();function ht(b){throw new Error("'"+b+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function In(b,p,l,m,w,P,K){K===void 0&&(K="channelsLast");var ee,le=pr(p),de=le[0],Ee=le[1];if(K==="channelsLast")ee=[de,Ee,b[3],b[3]];else{if(K!=="channelsFirst")throw new Error("Unknown dataFormat "+K);ee=[de,Ee,b[1],b[1]]}return Gn(b,ee,l,m,w,P,!1,K)}function Un(b,p,l,m,w,P,K){K===void 0&&(K="NDHWC");var ee,le,de=gr(p),Ee=de[0],Te=de[1],Ne=de[2];if(K==="NDHWC")le="channelsLast",ee=[Ee,Te,Ne,b[4],b[4]];else{if(K!=="NCDHW")throw new Error("Unknown dataFormat "+K);le="channelsFirst",ee=[Ee,Te,Ne,b[1],b[1]]}return nr(b,ee,l,m,w,!1,le,P)}function Gn(b,p,l,m,w,P,K,ee){K===void 0&&(K=!1),ee===void 0&&(ee="channelsLast");var le=[-1,-1,-1,-1],de=le[0],Ee=le[1],Te=le[2],Ne=le[3];if(ee==="channelsLast")de=b[0],Ee=b[1],Te=b[2],Ne=b[3];else{if(ee!=="channelsFirst")throw new Error("Unknown dataFormat "+ee);de=b[0],Ne=b[1],Ee=b[2],Te=b[3]}var Fe,qe=p[0],Je=p[1],Ke=p[3],it=pr(l),gt=it[0],Et=it[1],At=pr(m),Wt=At[0],cn=At[1],pn=Tr(qe,Wt),ln=Tr(Je,cn),dn=function(hr,xr,Er,wr,vr,Lr,Pr,ei){var hi,Oi,wo;if(typeof hr=="number"){hi={top:hr,bottom:hr,left:hr,right:hr,type:hr===0?"VALID":"NUMBER"};var _o=function(co,Fo,Qo,Au,Qs){Au==null&&(Au=Yn(co,Fo,Qo));var Zs=co[1],pp=$r((co[0]-Fo+2*Au)/Qo+1,Qs);we(Ft(pp),function(){return"The output # of rows ("+pp+") must be an integer. Change the stride and/or zero pad parameters"});var mp=$r((Zs-Fo+2*Au)/Qo+1,Qs);return we(Ft(mp),function(){return"The output # of columns ("+mp+") must be an integer. Change the stride and/or zero pad parameters"}),[pp,mp]}([xr,Er],Lr,wr,hr,ei);Oi=_o[0],wo=_o[1]}else if(hr==="same"){Oi=Math.ceil(xr/wr),wo=Math.ceil(Er/vr);var Io=Math.max(0,(Oi-1)*wr+Lr-xr),Do=Math.max(0,(wo-1)*vr+Pr-Er),qo=Math.floor(Io/2),fa=Io-qo,Ya=Math.floor(Do/2);hi={top:qo,bottom:fa,left:Ya,right:Do-Ya,type:"SAME"}}else{if(hr!=="valid")throw Error("Unknown padding parameter: "+hr);hi={top:0,bottom:0,left:0,right:0,type:"VALID"},Oi=Math.ceil((xr-Lr+1)/wr),wo=Math.ceil((Er-Pr+1)/vr)}return{padInfo:hi,outHeight:Oi,outWidth:wo}}(w,Ee,Te,gt,Et,pn,ln,P),Nn=dn.padInfo,jn=dn.outHeight,Ln=dn.outWidth,ur=K?Ke*Ne:Ke;return ee==="channelsFirst"?Fe=[de,ur,jn,Ln]:ee==="channelsLast"&&(Fe=[de,jn,Ln,ur]),{batchSize:de,dataFormat:ee,inHeight:Ee,inWidth:Te,inChannels:Ne,outHeight:jn,outWidth:Ln,outChannels:ur,padInfo:Nn,strideHeight:gt,strideWidth:Et,filterHeight:qe,filterWidth:Je,effectiveFilterHeight:pn,effectiveFilterWidth:ln,dilationHeight:Wt,dilationWidth:cn,inShape:b,outShape:Fe,filterShape:p}}function nr(b,p,l,m,w,P,K,ee){P===void 0&&(P=!1),K===void 0&&(K="channelsLast");var le=[-1,-1,-1,-1,-1],de=le[0],Ee=le[1],Te=le[2],Ne=le[3],Fe=le[4];if(K==="channelsLast")de=b[0],Ee=b[1],Te=b[2],Ne=b[3],Fe=b[4];else{if(K!=="channelsFirst")throw new Error("Unknown dataFormat "+K);de=b[0],Fe=b[1],Ee=b[2],Te=b[3],Ne=b[4]}var qe,Je=p[0],Ke=p[1],it=p[2],gt=p[4],Et=gr(l),At=Et[0],Wt=Et[1],cn=Et[2],pn=gr(m),ln=pn[0],dn=pn[1],Nn=pn[2],jn=Tr(Je,ln),Ln=Tr(Ke,dn),ur=Tr(it,Nn),hr=function(Pr,ei,hi,Oi,wo,_o,Io,Do,qo,fa,Ya){var co,Fo,Qo,Au;if(typeof Pr=="number"){co={top:Pr,bottom:Pr,left:Pr,right:Pr,front:Pr,back:Pr,type:Pr===0?"VALID":"NUMBER"};var Qs=function(Jv,Rm,wC,K1,vp,Cw){vp==null&&(vp=Yn(Jv,Rm,K1));var _C=Jv[1],EC=Jv[2],kw=$r((Jv[0]-Rm+2*vp)/K1+1,Cw);we(Ft(kw),function(){return"The output # of depths ("+kw+") must be an integer. Change the stride and/or zero pad parameters"});var Aw=$r((_C-Rm+2*vp)/K1+1,Cw);we(Ft(Aw),function(){return"The output # of rows ("+Aw+") must be an integer. Change the stride and/or zero pad parameters"});var Ow=$r((EC-Rm+2*vp)/K1+1,Cw);return we(Ft(Ow),function(){return"The output # of columns ("+Ow+") must be an integer. Change the stride and/or zero pad parameters"}),[kw,Aw,Ow,1]}([ei,hi,Oi,1],Do,0,wo,Pr,Ya);Fo=Qs[0],Qo=Qs[1],Au=Qs[2]}else if(Pr==="same"){var Zs=((Fo=Math.ceil(ei/wo))-1)*wo+Do-ei,pp=((Qo=Math.ceil(hi/_o))-1)*_o+qo-hi,mp=((Au=Math.ceil(Oi/Io))-1)*Io+fa-Oi,Fm=Math.floor(Zs/2),ju=Zs-Fm,T0=Math.floor(pp/2),Yv=pp-T0,gp=Math.floor(mp/2);co={top:T0,bottom:Yv,left:gp,right:mp-gp,front:Fm,back:ju,type:"SAME"}}else{if(Pr!=="valid")throw Error("Unknown padding parameter: "+Pr);co={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Fo=Math.ceil((ei-Do+1)/wo),Qo=Math.ceil((hi-qo+1)/_o),Au=Math.ceil((Oi-fa+1)/Io)}return{padInfo:co,outDepth:Fo,outHeight:Qo,outWidth:Au}}(w,Ee,Te,Ne,At,Wt,cn,jn,Ln,ur,ee),xr=hr.padInfo,Er=hr.outDepth,wr=hr.outHeight,vr=hr.outWidth,Lr=P?gt*Fe:gt;return K==="channelsFirst"?qe=[de,Lr,Er,wr,vr]:K==="channelsLast"&&(qe=[de,Er,wr,vr,Lr]),{batchSize:de,dataFormat:K,inDepth:Ee,inHeight:Te,inWidth:Ne,inChannels:Fe,outDepth:Er,outHeight:wr,outWidth:vr,outChannels:Lr,padInfo:xr,strideDepth:At,strideHeight:Wt,strideWidth:cn,filterDepth:Je,filterHeight:Ke,filterWidth:it,effectiveFilterDepth:jn,effectiveFilterHeight:Ln,effectiveFilterWidth:ur,dilationDepth:ln,dilationHeight:dn,dilationWidth:Nn,inShape:b,outShape:qe,filterShape:p}}function Yn(b,p,l,m){m===void 0&&(m=1);var w=Tr(p,m);return Math.floor((b[0]*(l-1)-l+w)/2)}function pr(b){return typeof b=="number"?[b,b,b]:b.length===2?[b[0],b[1],1]:b}function gr(b){return typeof b=="number"?[b,b,b]:b}function Tr(b,p){return p<=1?b:b+(b-1)*(p-1)}function $r(b,p){if(!p)return b;switch(p){case"round":return Math.round(b);case"ceil":return Math.ceil(b);case"floor":return Math.floor(b);default:throw new Error("Unknown roundingMode "+p)}}function ai(b){var p=pr(b),l=p[0],m=p[1],w=p[2];return l===1&&m===1&&w===1}function Fr(b,p){return ai(b)||ai(p)}function ui(b){if(b==="NHWC")return"channelsLast";if(b==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+b)}function ii(b,p,l){if(p==="complex64"){if(b.dtype==="complex64")return b.clone();var m=uo(b.shape),w=b.toFloat(),P=l.complex(w,m);return m.dispose(),w.dispose(),P}if(!$e(b.dtype,p))return He.makeTensorFromDataId(b.dataId,b.shape,p);if(b.dtype==="complex64"){var K=l.real(b);return P=K.cast(p),K.dispose(),P}if(p==="int32")return l.int(b);if(p==="bool"){var ee=Ar(0,b.dtype);return P=l.notEqual(b,ee),ee.dispose(),P}throw new Error("Error in Cast: failed to cast "+b.dtype+" to "+p)}function wi(b,p){return He.makeTensorFromDataId(b.dataId,p,b.dtype)}function Si(b,p,l){var m=(p-b)/(l-1),w=Vt(l,"float32");w[0]=b;for(var P=1;P<w.length;P++)w[P]=w[P-1]+m;return au(w,"float32")}var si=Object.freeze({castTensor:ii,reshapeTensor:wi,linspaceImpl:Si,upcastType:Sn,axesAreInnerMostDims:wd,combineLocations:$p,computeOutAndReduceShapes:Po,expandShapeToKeepDim:Lo,assertAxesAreInnerMostDims:ia,getAxesPermutation:Ba,getUndoAxesPermutation:$u,getInnerMostAxes:ja,getBroadcastDims:za,getReductionAxes:Ga,assertAndGetBroadcastShape:Xi,assertParamsConsistent:rl,computeOutShape:_u,computePool2DInfo:In,computePool3DInfo:Un,computeConv2DInfo:Gn,computeConv3DInfo:nr,computeDefaultPad:Yn,tupleValuesAreOne:ai,eitherStridesOrDilationsAreOne:Fr,convertConv2DDataFormat:ui,PARALLELIZE_THRESHOLD:yc,computeOptimalWindowSize:Bc});function gi(b,p){if(b.length!==p.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+b.length+", imag: "+p.length+".");for(var l=new Float32Array(2*b.length),m=0;m<l.length;m+=2)l[m]=b[m/2],l[m+1]=p[m/2];return l}function po(b,p){return{real:b[2*p],imag:b[2*p+1]}}function ho(b,p,l,m){b[2*m]=p,b[2*m+1]=l}function Ko(b,p,l){var m=(l?2:-2)*Math.PI*(b/p);return{real:Math.cos(m),imag:Math.sin(m)}}function Ki(b,p,l){var m=function(P,K,ee){return function(le,de,Ee){for(var Te=0,Ne=le.length,Fe=0,qe=!1;Te<Ne;){var Je=Ee(de,le[Fe=Te+(Ne-Te>>>1)]);Je>0?Te=Fe+1:(Ne=Fe,qe=!Je)}return qe?Te:-Te-1}(P,K,ee||mo)}(b,p,l),w=m<0?-(m+1):m;b.splice(w,0,p)}function mo(b,p){return b>p?1:b<p?-1:0}function pa(b,p,l,m,w){return sa(b,p,l,m,w,0).selectedIndices}function Go(b,p,l,m,w,P){var K=sa(b,p,l,m,w,P);return K.numValidOutputs.dispose(),{selectedIndices:K.selectedIndices,selectedScores:K.selectedScores}}function sa(b,p,l,m,w,P,K,ee){ee===void 0&&(ee=!1);for(var le=Array.from(p).map(function(At,Wt){return{score:At,boxIndex:Wt,suppressBeginIndex:0}}).filter(function(At){return At.score>w}).sort(Ao),de=P>0?-.5/P:0,Ee=[],Te=[];Ee.length<l&&le.length>0;){var Ne=le.pop(),Fe=Ne.score,qe=Ne.boxIndex,Je=Ne.suppressBeginIndex;if(Fe<w)break;for(var Ke=!1,it=Ee.length-1;it>=Je;--it){var gt=Gi(b,qe,Ee[it]);if(gt>=m){Ke=!0;break}if(Ne.score=Ne.score*Vi(m,de,gt),Ne.score<=w)break}Ne.suppressBeginIndex=Ee.length,Ke||(Ne.score===Fe?(Ee.push(qe),Te.push(Ne.score)):Ne.score>w&&Ki(le,Ne,Ao))}var Et=Ee.length;return ee&&(Ee.fill(0,Et),Te.fill(0,Et)),{selectedIndices:au(Ee,"int32"),selectedScores:au(Te,"float32"),numValidOutputs:Ar(Et,"int32")}}function Gi(b,p,l){var m=b.subarray(4*p,4*p+4),w=b.subarray(4*l,4*l+4),P=Math.min(m[0],m[2]),K=Math.min(m[1],m[3]),ee=Math.max(m[0],m[2]),le=Math.max(m[1],m[3]),de=Math.min(w[0],w[2]),Ee=Math.min(w[1],w[3]),Te=Math.max(w[0],w[2]),Ne=Math.max(w[1],w[3]),Fe=(ee-P)*(le-K),qe=(Te-de)*(Ne-Ee);if(Fe<=0||qe<=0)return 0;var Je=Math.max(P,de),Ke=Math.max(K,Ee),it=Math.min(ee,Te),gt=Math.min(le,Ne),Et=Math.max(it-Je,0)*Math.max(gt-Ke,0);return Et/(Fe+qe-Et)}function Vi(b,p,l){var m=Math.exp(p*l*l);return l<=b?m:0}function Ao(b,p){return b.score-p.score||b.score===p.score&&p.boxIndex-b.boxIndex}function wa(b,p,l){var m=new Array(b.rank).fill(0),w=b.shape.slice();return p.map(function(P){w[l]=P;var K=b.slice(m,w);return m[l]+=P,K})}function Sa(b,p){for(var l=new Array(b.rank),m=0;m<l.length;m++)l[m]=b.shape[m]*p[m];var w=Ii(l,b.dtype);for(m=0;m<w.values.length;++m){for(var P=w.indexToLoc(m),K=new Array(b.rank),ee=0;ee<K.length;ee++)K[ee]=P[ee]%b.shape[ee];var le=b.locToIndex(K);w.values[m]=b.values[le]}return w.toTensor()}function ga(b,p,l,m,w){for(var P=p[p.length-1],K=[b.length/P,P],ee=K[0],le=K[1],de=kn(l,ee*m),Ee=kn("int32",ee*m),Te=0;Te<ee;Te++){for(var Ne=Te*le,Fe=b.subarray(Ne,Ne+le),qe=[],Je=0;Je<Fe.length;Je++)qe.push({value:Fe[Je],index:Je});qe.sort(function(At,Wt){return Wt.value-At.value});var Ke=Te*m,it=de.subarray(Ke,Ke+m),gt=Ee.subarray(Ke,Ke+m);for(Je=0;Je<m;Je++)it[Je]=qe[Je].value,gt[Je]=qe[Je].index}var Et=p.slice();return Et[Et.length-1]=m,[No(de,Et,l),No(Ee,Et,"int32")]}function ua(b,p){for(var l=[],m=0;m<p.length;m++)p[m]&&l.push(m);var w=Ii(b,"int32"),P=Ii([l.length,b.length],"int32");for(m=0;m<l.length;m++){var K=w.indexToLoc(l[m]),ee=m*b.length;P.values.set(K,ee)}return P.toTensor()}function ds(b,p){return["x","y","z","w","u","v"].slice(0,p).map(function(l){return b+"."+l})}function Ca(b,p){return p===1?[b]:ds(b,p)}function Oo(){var b,p,l,m,w,P,K,ee,le,de;return j().getNumber("WEBGL_VERSION")===2?(b="#version 300 es",p="in",l="out",m="in",w="texture",P="outputColor",K="out vec4 outputColor;",ee=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,le="",de=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(b="",p="attribute",l="varying",m="varying",w="texture2D",P="gl_FragColor",K="",ee=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,le=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,de=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:b,attribute:p,varyingVs:l,varyingFs:m,texture2D:w,output:P,defineOutput:K,defineSpecialNaN:ee,defineSpecialInf:le,defineRound:de}}function Ia(b,p,l){l===void 0&&(l="index");var m=on(p);return m.map(function(w,P){return"int "+b[P]+" = "+l+" / "+w+"; "+(P===m.length-1?"int "+b[P+1]+" = "+l+" - "+b[P]+" * "+w:"index -= "+b[P]+" * "+w)+";"}).join("")}function Zu(b){var p=on(b).map(function(l){return l.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+p[0]+" + coords.y * "+p[1]+` + coords.z;
  }
`}var Cs=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function $a(b,p,l,m){var w=[];b.forEach(function(Fe){var qe=ze(Fe.shapeInfo.logicalShape);Fe.shapeInfo.isUniform?w.push("uniform float "+Fe.name+(qe>1?"["+qe+"]":"")+";"):(w.push("uniform sampler2D "+Fe.name+";"),w.push("uniform int offset"+Fe.name+";"))});var P,K,ee=w.join(`
`),le=b.map(function(Fe){return function(qe,Je,Ke){Ke===void 0&&(Ke=!1);var it="";it+=Ke?function At(Wt){var cn,pn,ln;switch(Wt.shapeInfo.logicalShape.length){case 0:return cn=Wt.name,pn="get"+cn.charAt(0).toUpperCase()+cn.slice(1),ln=Oo(),`
    vec4 `+pn+`() {
      return `+ln.texture2D+"("+cn+`, halfCR);
    }
  `;case 1:return function(dn){var Nn=dn.name,jn="get"+Nn.charAt(0).toUpperCase()+Nn.slice(1),Ln=dn.shapeInfo.texShape,ur=[Math.ceil(Ln[0]/2),Math.ceil(Ln[1]/2)],hr=Oo();return`
    vec4 `+jn+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+ur[0]+", "+ur[1]+`, index);
      return `+hr.texture2D+"("+Nn+`, uv);
    }
  `}(Wt);case 2:return function(dn){var Nn=dn.shapeInfo.logicalShape,jn=dn.name,Ln="get"+jn.charAt(0).toUpperCase()+jn.slice(1),ur=dn.shapeInfo.texShape,hr=ur[0],xr=ur[1],Er=Oo();if(ur!=null&&Ut(Nn,ur))return`
      vec4 `+Ln+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+xr+".0, "+hr+`.0);

        return `+Er.texture2D+"("+jn+`, uv);
      }
    `;var wr=[Math.ceil(ur[0]/2),Math.ceil(ur[1]/2)],vr=Math.ceil(Nn[1]/2);return`
    vec4 `+Ln+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+vr+", "+wr[0]+", "+wr[1]+`, row, col);
      return `+Er.texture2D+"("+jn+`, uv);
    }
  `}(Wt);case 3:return function(dn){var Nn=dn.shapeInfo.logicalShape,jn=dn.name,Ln="get"+jn.charAt(0).toUpperCase()+jn.slice(1),ur=dn.shapeInfo.texShape,hr=[Math.ceil(ur[0]/2),Math.ceil(ur[1]/2)];if(Nn[0]===1){var xr=Nn.slice(1),Er=zs(dn,xr);return`
        `+At(Er)+`
        vec4 `+Ln+`(int b, int row, int col) {
          return `+Ln+"("+ks(["b","row","col"],[1,2])+`);
        }
      `}var wr=hr[0],vr=hr[1],Lr=Math.ceil(Nn[2]/2),Pr=Lr*Math.ceil(Nn[1]/2),ei=Oo();return`
    vec4 `+Ln+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+wr+", "+vr+", "+Pr+", "+Lr+`, b, row, col);
      return `+ei.texture2D+"("+jn+`, uv);
    }
  `}(Wt);default:return function(dn){for(var Nn=dn.shapeInfo.logicalShape,jn=Nn.length,Ln=dn.name,ur="get"+Ln.charAt(0).toUpperCase()+Ln.slice(1),hr=dn.shapeInfo.texShape,xr=[Math.ceil(hr[0]/2),Math.ceil(hr[1]/2)],Er=xr[0],wr=xr[1],vr=Math.ceil(Nn[jn-1]/2),Lr=vr*Math.ceil(Nn[jn-2]/2),Pr="int b, int row, int col",ei="b * "+Lr+" + (row / 2) * "+vr+" + (col / 2)",hi=2;hi<jn-1;hi++)Pr="int b"+hi+", "+Pr,Lr*=Nn[jn-hi-1],ei="b"+hi+" * "+Lr+" + "+ei;var Oi=Oo();return`
    vec4 `+ur+"("+Pr+`) {
      int index = `+ei+`;
      int texR = index / `+wr+`;
      int texC = index - texR * `+wr+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+wr+", "+Er+`);
      return `+Oi.texture2D+"("+Ln+`, uv);
    }
  `}(Wt)}}(qe):function At(Wt){var cn=Wt.shapeInfo.logicalShape;switch(cn.length){case 0:return function(pn){var ln=pn.name,dn="get"+ln.charAt(0).toUpperCase()+ln.slice(1);if(pn.shapeInfo.isUniform)return"float "+dn+"() {return "+ln+";}";var Nn=pn.shapeInfo.texShape,jn=Nn[0],Ln=Nn[1];if(jn===1&&Ln===1)return`
      float `+dn+`() {
        return sampleTexture(`+ln+`, halfCR);
      }
    `;var ur=pn.shapeInfo.texShape,hr=ur[0],xr=ur[1],Er=ca(ln);return`
    float `+dn+`() {
      vec2 uv = uvFromFlat(`+hr+", "+xr+", "+Er+`);
      return sampleTexture(`+ln+`, uv);
    }
  `}(Wt);case 1:return function(pn){var ln=pn.name,dn="get"+ln.charAt(0).toUpperCase()+ln.slice(1);if(pn.shapeInfo.isUniform)return`
      float `+dn+`(int index) {
        `+Js(pn)+`
      }
    `;var Nn=pn.shapeInfo.texShape,jn=Nn[0],Ln=Nn[1];if(Ln===1&&jn===1)return`
      float `+dn+`(int index) {
        return sampleTexture(`+ln+`, halfCR);
      }
    `;var ur=ca(ln);return Ln===1?`
      float `+dn+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+ur+") + 0.5) / "+jn+`.0);
        return sampleTexture(`+ln+`, uv);
      }
    `:jn===1?`
      float `+dn+`(int index) {
        vec2 uv = vec2((float(index + `+ur+") + 0.5) / "+Ln+`.0, 0.5);
        return sampleTexture(`+ln+`, uv);
      }
    `:`
    float `+dn+`(int index) {
      vec2 uv = uvFromFlat(`+jn+", "+Ln+", index + "+ur+`);
      return sampleTexture(`+ln+`, uv);
    }
  `}(Wt);case 2:return function(pn){var ln=pn.shapeInfo.logicalShape,dn=pn.name,Nn="get"+dn.charAt(0).toUpperCase()+dn.slice(1),jn=pn.shapeInfo.texShape;if(jn!=null&&Ut(ln,jn)){var Ln=jn[0],ur=jn[1];return`
    float `+Nn+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+ur+".0, "+Ln+`.0);
      return sampleTexture(`+dn+`, uv);
    }
  `}var hr=sn(ln),xr=hr.newShape,Er=hr.keptDims,wr=xr;if(wr.length<ln.length){var vr=zs(pn,wr);return`
      `+At(vr)+`
      float `+Nn+`(int row, int col) {
        return `+Nn+"("+ks(["row","col"],Er)+`);
      }
    `}if(pn.shapeInfo.isUniform)return`
      float `+Nn+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+ln[1]+`, 1)));
        `+Js(pn)+`
      }
    `;var Lr=jn[0],Pr=jn[1],ei=ca(dn);return Pr===1?`
    float `+Nn+`(int row, int col) {
      float index = dot(vec3(row, col, `+ei+"), vec3("+ln[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+Lr+`.0);
      return sampleTexture(`+dn+`, uv);
    }
  `:Lr===1?`
    float `+Nn+`(int row, int col) {
      float index = dot(vec3(row, col, `+ei+"), vec3("+ln[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+Pr+`.0, 0.5);
      return sampleTexture(`+dn+`, uv);
    }
  `:`
  float `+Nn+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+ln[1]+" + col + "+ei+`;
    vec2 uv = uvFromFlat(`+Lr+", "+Pr+`, index);
    return sampleTexture(`+dn+`, uv);
  }
`}(Wt);case 3:return function(pn){var ln=pn.shapeInfo.logicalShape,dn=pn.name,Nn="get"+dn.charAt(0).toUpperCase()+dn.slice(1),jn=ln[1]*ln[2],Ln=ln[2],ur=sn(ln),hr=ur.newShape,xr=ur.keptDims,Er=hr;if(Er.length<ln.length){var wr=zs(pn,Er);return`
        `+At(wr)+`
        float `+Nn+`(int row, int col, int depth) {
          return `+Nn+"("+ks(["row","col","depth"],xr)+`);
        }
      `}if(pn.shapeInfo.isUniform)return`
      float `+Nn+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+jn+", "+Ln+`, 1)));
        `+Js(pn)+`
      }
    `;var vr=pn.shapeInfo.texShape,Lr=vr[0],Pr=vr[1],ei=pn.shapeInfo.flatOffset;if(Pr===jn&&ei==null)return`
        float `+Nn+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+Ln+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+Pr+".0, "+Lr+`.0);
          return sampleTexture(`+dn+`, uv);
        }
      `;if(Pr===Ln&&ei==null)return`
    float `+Nn+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+ln[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+Pr+".0, "+Lr+`.0);
      return sampleTexture(`+dn+`, uv);
    }
  `;var hi=ca(dn);return`
      float `+Nn+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+jn+" + col * "+Ln+" + depth + "+hi+`;
        vec2 uv = uvFromFlat(`+Lr+", "+Pr+`, index);
        return sampleTexture(`+dn+`, uv);
      }
  `}(Wt);case 4:return function(pn){var ln=pn.shapeInfo.logicalShape,dn=pn.name,Nn="get"+dn.charAt(0).toUpperCase()+dn.slice(1),jn=ln[3],Ln=ln[2]*jn,ur=ln[1]*Ln,hr=sn(ln),xr=hr.newShape,Er=hr.keptDims;if(xr.length<ln.length){var wr=zs(pn,xr);return`
      `+At(wr)+`
      float `+Nn+`(int row, int col, int depth, int depth2) {
        return `+Nn+"("+ks(["row","col","depth","depth2"],Er)+`);
      }
    `}if(pn.shapeInfo.isUniform)return`
      float `+Nn+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+ur+", "+Ln+", "+jn+`, 1)));
        `+Js(pn)+`
      }
    `;var vr=pn.shapeInfo.flatOffset,Lr=pn.shapeInfo.texShape,Pr=Lr[0],ei=Lr[1];if(ei===ur&&vr==null)return`
      float `+Nn+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+Ln+", "+jn+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+ei+".0, "+Pr+`.0);
        return sampleTexture(`+dn+`, uv);
      }
    `;if(ei===jn&&vr==null)return`
      float `+Nn+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+ln[1]*ln[2]+", "+ln[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+ei+".0, "+Pr+`.0);
        return sampleTexture(`+dn+`, uv);
      }
    `;var hi=ca(dn);return`
    float `+Nn+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+ur+" + col * "+Ln+` +
          depth * `+jn+` + depth2;
      vec2 uv = uvFromFlat(`+Pr+", "+ei+", index + "+hi+`);
      return sampleTexture(`+dn+`, uv);
    }
  `}(Wt);case 5:return function(pn){var ln=pn.shapeInfo.logicalShape,dn=pn.name,Nn="get"+dn.charAt(0).toUpperCase()+dn.slice(1),jn=ln[4],Ln=ln[3]*jn,ur=ln[2]*Ln,hr=ln[1]*ur,xr=sn(ln),Er=xr.newShape,wr=xr.keptDims;if(Er.length<ln.length){var vr=zs(pn,Er);return`
      `+At(vr)+`
      float `+Nn+`(int row, int col, int depth, int depth2, int depth3) {
        return `+Nn+"("+ks(["row","col","depth","depth2","depth3"],wr)+`);
      }
    `}if(pn.shapeInfo.isUniform)return`
      float `+Nn+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+hr+", "+ur+", "+Ln+", "+jn+`)) +
          depth3;
        `+Js(pn)+`
      }
    `;var Lr=pn.shapeInfo.flatOffset,Pr=pn.shapeInfo.texShape,ei=Pr[0],hi=Pr[1];if(hi===hr&&Lr==null)return`
      float `+Nn+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+ur+", "+Ln+", "+jn+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+hi+".0, "+ei+`.0);
        return sampleTexture(`+dn+`, uv);
      }
    `;if(hi===jn&&Lr==null)return`
      float `+Nn+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+ln[1]*ln[2]*ln[3]+`,
               `+ln[2]*ln[3]+", "+ln[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+hi+".0, "+ei+`.0);
        return sampleTexture(`+dn+`, uv);
      }
    `;var Oi=ca(dn);return`
    float `+Nn+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+hr+" + col * "+ur+" + depth * "+Ln+` +
          depth2 * `+jn+" + depth3 + "+Oi+`;
      vec2 uv = uvFromFlat(`+ei+", "+hi+`, index);
      return sampleTexture(`+dn+`, uv);
    }
  `}(Wt);case 6:return function(pn){var ln=pn.shapeInfo.logicalShape,dn=pn.name,Nn="get"+dn.charAt(0).toUpperCase()+dn.slice(1),jn=sn(ln),Ln=jn.newShape,ur=jn.keptDims;if(Ln.length<ln.length){var hr=zs(pn,Ln);return`
      `+At(hr)+`
      float `+Nn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+Nn+"("+ks(["row","col","depth","depth2","depth3","depth4"],ur)+`);
      }
    `}var xr=ln[5],Er=ln[4]*xr,wr=ln[3]*Er,vr=ln[2]*wr,Lr=ln[1]*vr;if(pn.shapeInfo.isUniform)return`
      float `+Nn+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+Lr+", "+vr+", "+wr+", "+Er+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+xr+`, 1)));
        `+Js(pn)+`
      }
    `;var Pr=pn.shapeInfo.flatOffset,ei=pn.shapeInfo.texShape,hi=ei[0],Oi=ei[1];if(Oi===Lr&&Pr==null)return`
      float `+Nn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+vr+", "+wr+", "+Er+", "+xr+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+Oi+".0, "+hi+`.0);
        return sampleTexture(`+dn+`, uv);
      }
    `;if(Oi===xr&&Pr==null)return`
      float `+Nn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+ln[1]*ln[2]*ln[3]*ln[4]+`,
               `+ln[2]*ln[3]*ln[4]+`,
               `+ln[3]*ln[4]+`,
               `+ln[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+Oi+".0, "+hi+`.0);
        return sampleTexture(`+dn+`, uv);
      }
    `;var wo=ca(dn);return`
    float `+Nn+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+Lr+" + col * "+vr+" + depth * "+wr+` +
          depth2 * `+Er+" + depth3 * "+xr+" + depth4 + "+wo+`;
      vec2 uv = uvFromFlat(`+hi+", "+Oi+`, index);
      return sampleTexture(`+dn+`, uv);
    }
  `}(Wt);default:throw new Error(cn.length+"-D input sampling is not yet supported")}}(qe);var gt=qe.shapeInfo.logicalShape,Et=Je.logicalShape;return gt.length<=Et.length&&(it+=Ke?function(At,Wt){var cn,pn=At.name,ln=pn.charAt(0).toUpperCase()+pn.slice(1),dn="get"+ln+"AtOutCoords",Nn=At.shapeInfo.logicalShape.length,jn=Wt.logicalShape.length,Ln=za(At.shapeInfo.logicalShape,Wt.logicalShape),ur=Wo(jn),hr=jn-Nn,xr=["x","y","z","w","u","v"];cn=Nn===0?"":jn<2&&Ln.length>=1?"coords = 0;":Ln.map(function(hi){return"coords."+xr[hi+hr]+" = 0;"}).join(`
`);var Er;Er=jn<2&&Nn>0?"coords":At.shapeInfo.logicalShape.map(function(hi,Oi){return"coords."+xr[Oi+hr]}).join(", ");var wr="return outputValue;",vr=ze(At.shapeInfo.logicalShape)===1,Lr=ze(Wt.logicalShape)===1;if(Nn!==1||vr||Lr){if(vr&&!Lr)wr=jn===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(Ln.length){var Pr=Nn-2,ei=Nn-1;Ln.indexOf(Pr)>-1&&Ln.indexOf(ei)>-1?wr="return vec4(outputValue.x);":Ln.indexOf(Pr)>-1?wr="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":Ln.indexOf(ei)>-1&&(wr="return vec4(outputValue.xx, outputValue.zz);")}}else wr=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+dn+`() {
      `+ur+` coords = getOutputCoords();
      `+cn+`
      vec4 outputValue = get`+ln+"("+Er+`);
      `+wr+`
    }
  `}(qe,Je):function(At,Wt){var cn=At.name,pn=cn.charAt(0).toUpperCase()+cn.slice(1),ln="get"+pn+"AtOutCoords",dn=Wt.texShape,Nn=At.shapeInfo.texShape,jn=At.shapeInfo.logicalShape.length,Ln=Wt.logicalShape.length;if(!At.shapeInfo.isUniform&&jn===Ln&&At.shapeInfo.flatOffset==null&&Ut(Nn,dn))return`
      float `+ln+`() {
        return sampleTexture(`+cn+`, resultUV);
      }
    `;var ur=Wo(Ln),hr=za(At.shapeInfo.logicalShape,Wt.logicalShape),xr=Ln-jn,Er=["x","y","z","w","u","v"];return`
    float `+ln+`() {
      `+ur+` coords = getOutputCoords();
      `+(jn===0?"":Ln<2&&hr.length>=1?"coords = 0;":hr.map(function(wr){return"coords."+Er[wr+xr]+" = 0;"}).join(`
`))+`
      return get`+pn+"("+(Ln<2&&jn>0?"coords":At.shapeInfo.logicalShape.map(function(wr,vr){return"coords."+Er[vr+xr]}).join(", "))+`);
    }
  `}(qe,Je)),it}(Fe,p,m)}).join(`
`),de=p.texShape,Ee=Oo(),Te=`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+Ee.texture2D+`(textureSampler, uv).r;
    }
  `,Ne=function(Fe){return Fe.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+Fe.varyingFs+` vec2 resultUV;
    `+Fe.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+Fe.defineSpecialNaN+`
    `+Fe.defineSpecialInf+`
    `+Fe.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+Uo+`
    `+jc+`
    `+hu+`
  `}(Ee);return p.isPacked?(P=function(Fe,qe){switch(Fe.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(At,Wt){var cn=[Math.ceil(Wt[0]/2),Math.ceil(Wt[1]/2)];return cn[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+cn[1]+`.0);
      }
    `:cn[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+cn[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+cn[0]+", "+cn[1]+`));
      return 2 * (resTexRC.x * `+cn[1]+` + resTexRC.y);
    }
  `}(0,qe);case 2:return function(At,Wt){var cn=[Math.ceil(Wt[0]/2),Math.ceil(Wt[1]/2)];if(Ut(At,Wt))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+cn[0]+", "+cn[1]+`));
      }
    `;var pn=Math.ceil(At[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+cn[0]+", "+cn[1]+`));

      int index = resTexRC.x * `+cn[1]+` + resTexRC.y;
      int r = 2 * (index / `+pn+`);
      int c = imod(index, `+pn+`) * 2;

      return ivec2(r, c);
    }
  `}(Fe,qe);case 3:return Je=Fe,Ke=qe,it=[Math.ceil(Ke[0]/2),Math.ceil(Ke[1]/2)],Et=(gt=Math.ceil(Je[2]/2))*Math.ceil(Je[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+it[0]+", "+it[1]+`));
      int index = resTexRC.x * `+it[1]+` + resTexRC.y;

      int b = index / `+Et+`;
      index -= b * `+Et+`;

      int r = 2 * (index / `+gt+`);
      int c = imod(index, `+gt+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(At,Wt){for(var cn=[Math.ceil(Wt[0]/2),Math.ceil(Wt[1]/2)],pn=Math.ceil(At[At.length-1]/2),ln=pn*Math.ceil(At[At.length-2]/2),dn=ln,Nn="",jn="b, r, c",Ln=2;Ln<At.length-1;Ln++)Nn=`
      int b`+Ln+" = index / "+(dn*=At[At.length-Ln-1])+`;
      index -= b`+Ln+" * "+dn+`;
    `+Nn,jn="b"+Ln+", "+jn;return`
    ivec`+At.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+cn[0]+", "+cn[1]+`));
      int index = resTexRC.x * `+cn[1]+` + resTexRC.y;

      `+Nn+`

      int b = index / `+ln+`;
      index -= b * `+ln+`;

      int r = 2 * (index / `+pn+`);
      int c = imod(index, `+pn+`) * 2;

      return ivec`+At.length+"("+jn+`);
    }
  `}(Fe,qe)}var Je,Ke,it,gt,Et}(p.logicalShape,de),K=`
    void setOutput(vec4 val) {
      `+Ee.output+` = val;
    }
  `):(P=function(Fe,qe){switch(Fe.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(it,gt){return gt[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+gt[1]+`.0);
      }
    `:gt[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+gt[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+gt[0]+", "+gt[1]+`));
      return resTexRC.x * `+gt[1]+` + resTexRC.y;
    }
  `}(0,qe);case 2:return function(it,gt){return Ut(it,gt)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+gt[0]+", "+gt[1]+`));
      }
    `:it[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+gt[0]+", "+gt[1]+`));
        int index = resTexRC.x * `+gt[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:it[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+gt[0]+", "+gt[1]+`));
        int index = resTexRC.x * `+gt[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+gt[0]+", "+gt[1]+`));
      int index = resTexRC.x * `+gt[1]+` + resTexRC.y;
      int r = index / `+it[1]+`;
      int c = index - r * `+it[1]+`;
      return ivec2(r, c);
    }
  `}(Fe,qe);case 3:return Je=qe,Ke=Ia(["r","c","d"],Fe),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Je[0]+", "+Je[1]+`));
      int index = resTexRC.x * `+Je[1]+` + resTexRC.y;
      `+Ke+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(it,gt){var Et=Ia(["r","c","d","d2"],it);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+gt[0]+", "+gt[1]+`));
      int index = resTexRC.x * `+gt[1]+` + resTexRC.y;
      `+Et+`
      return ivec4(r, c, d, d2);
    }
  `}(Fe,qe);case 5:return function(it,gt){var Et=Ia(["r","c","d","d2","d3"],it);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+gt[0]+`,
                             `+gt[1]+`));

      int index = resTexRC.x * `+gt[1]+` + resTexRC.y;

      `+Et+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(Fe,qe);case 6:return function(it,gt){var Et=Ia(["r","c","d","d2","d3","d4"],it);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+gt[0]+", "+gt[1]+`));
      int index = resTexRC.x * `+gt[1]+` + resTexRC.y;

      `+Et+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(Fe,qe);default:throw new Error(Fe.length+"-D output sampling is not yet supported")}var Je,Ke}(p.logicalShape,de),K=`
    void setOutput(float val) {
      `+Ee.output+` = vec4(val, 0, 0, 0);
    }
  `),m&&(Ne+=Ys),[Ne,Te,K,ee,P,le,l].join(`
`)}var Uo=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,jc=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,hu=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Ys=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function ca(b){return"offset"+b}function Js(b){var p=b.name,l=ze(b.shapeInfo.logicalShape);return l<2?"return "+p+";":`
    for (int i = 0; i < `+l+`; i++) {
      if (i == index) {
        return `+p+`[i];
      }
    }
  `}function Wo(b){if(b<=1)return"int";if(b===2)return"ivec2";if(b===3)return"ivec3";if(b===4)return"ivec4";if(b===5)return"ivec5";if(b===6)return"ivec6";throw Error("GPU for rank "+b+" is not yet supported")}function zs(b,p){var l=JSON.parse(JSON.stringify(b));return l.shapeInfo.logicalShape=p,l}function ks(b,p){return p.map(function(l){return b[l]}).join(", ")}var yo=function(b,p,l){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Xi(p,l),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+b+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Us="return a + b;",os="return a - b;",pu="return a * b;",ul="return (a < 0.) ? b * a : a;",Yo=function(b,p,l){this.variableNames=["A","B"],this.outputShape=Xi(p,l),this.userCode=`
      float binaryOperation(float a, float b) {
        `+b+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},hs=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Xa=function(b,p,l,m){m===void 0&&(m=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Xi(p,l);var w=this.outputShape.length,P="";if(m)if(w===0||ze(this.outputShape)===1)P=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(P=`
          `+Wo(w)+` coords = getOutputCoords();
        `,w===1)P+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var K=Ca("coords",w);P+=`
            bool nextRowOutOfBounds =
              (`+K[w-2]+" + 1) >= "+this.outputShape[w-2]+`;
            bool nextColOutOfBounds =
              (`+K[w-1]+" + 1) >= "+this.outputShape[w-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+b+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+P+`

        setOutput(result);
      }
    `},zc=function(){function b(p){this.variableNames=["A"],this.outputShape=p,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return b.prototype.getCustomSetupFunc=function(p,l){var m=this;return function(w,P){m.minLoc==null&&(m.minLoc=w.getUniformLocationNoThrow(P,"minVal"),m.maxLoc=w.getUniformLocationNoThrow(P,"maxVal")),w.gl.uniform1f(m.minLoc,p),w.gl.uniform1f(m.maxLoc,l)}},b}(),zl=function(){function b(p){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=p,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return b.prototype.getCustomSetupFunc=function(p,l){var m=this;return function(w,P){m.minLoc==null&&(m.minLoc=w.getUniformLocationNoThrow(P,"minVal"),m.maxLoc=w.getUniformLocationNoThrow(P,"maxVal")),w.gl.uniform1f(m.minLoc,p),w.gl.uniform1f(m.maxLoc,l)}},b}();function Ei(b,p,l){var m=b.indexOf(p);return b.map(function(w,P){return P===m?w+" - "+l:w}).join()}var sm=function(b,p,l,m){p===void 0&&(p=!1),l===void 0&&(l=null),m===void 0&&(m=!1),this.variableNames=["x","W"],this.outputShape=b.outShape;var w=b.padInfo.top,P=b.padInfo.left,K=b.strideHeight,ee=b.strideWidth,le=b.dilationHeight,de=b.dilationWidth,Ee=b.filterHeight,Te=b.filterWidth,Ne=4*Math.floor(b.inChannels/4),Fe=b.inChannels%4,qe=b.dataFormat==="channelsLast",Je=qe?1:2,Ke=qe?2:3,it=qe?3:1,gt="",Et="";l&&(gt=m?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+l+`
        }`:`
          float activation(float x) {
            `+l+`
          }
        `,Et="result = activation(result);");var At=p?"result += getBiasAtOutCoords();":"";p&&this.variableNames.push("bias"),m&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+gt+`

      const ivec2 strides = ivec2(`+K+", "+ee+`);
      const ivec2 pads = ivec2(`+w+", "+P+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+it+`];

        ivec2 xRCCorner =
            ivec2(coords[`+Je+"], coords["+Ke+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+Ee+`; wR++) {
          int xR = xRCorner + wR * `+le+`;

          if (xR < 0 || xR >= `+b.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+Te+`; wC++) {
            int xC = xCCorner + wC * `+de+`;

            if (xC < 0 || xC >= `+b.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+Ne+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+qe+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(Fe===1)+`) {

              if (`+qe+`) {
                dotProd +=
                    getX(batch, xR, xC, `+Ne+`) *
                    getW(wR, wC, `+Ne+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+Ne+`, xR, xC) *
                    getW(wR, wC, `+Ne+`, d2);
              }

            } else if (`+(Fe===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+Ne+`, d2),
                getW(wR, wC, `+Ne+` + 1, d2)
              );

              if (`+qe+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+Ne+`),
                  getX(batch, xR, xC, `+Ne+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+Ne+`, xR, xC),
                  getX(batch, `+Ne+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(Fe===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+Ne+`, d2),
                getW(wR, wC, `+Ne+` + 1, d2),
                getW(wR, wC, `+Ne+` + 2, d2)
              );

              if (`+qe+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+Ne+`),
                  getX(batch, xR, xC, `+Ne+` + 1),
                  getX(batch, xR, xC, `+Ne+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+Ne+`, xR, xC),
                  getX(batch, `+Ne+` + 1, xR, xC),
                  getX(batch, `+Ne+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+At+`
        `+Et+`
        setOutput(result);
      }
    `},Ul=function(b,p,l,m){p===void 0&&(p=!1),l===void 0&&(l=null),m===void 0&&(m=!1),this.variableNames=["x","W"],this.outputShape=b.outShape;var w=b.inHeight,P=b.inWidth,K=b.padInfo.top,ee=b.padInfo.left,le=b.strideHeight,de=b.strideWidth,Ee=b.dilationHeight,Te=b.dilationWidth,Ne=b.filterHeight,Fe=b.filterWidth,qe=b.outChannels/b.inChannels,Je="",Ke="";l&&(Je=m?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+l+`
        }`:`
          float activation(float x) {
            `+l+`
          }
        `,Ke="result = activation(result);");var it=p?"result += getBiasAtOutCoords();":"";p&&this.variableNames.push("bias"),m&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+Je+`

      const ivec2 strides = ivec2(`+le+", "+de+`);
      const ivec2 pads = ivec2(`+K+", "+ee+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+qe+`;
        int q = d2 - d1 * `+qe+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+Ne+`; wR++) {
          int xR = xRCorner + wR * `+Ee+`;

          if (xR < 0 || xR >= `+w+`) {
            continue;
          }

          for (int wC = 0; wC < `+Fe+`; wC++) {
            int xC = xCCorner + wC * `+Te+`;

            if (xC < 0 || xC >= `+P+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+it+`
        `+Ke+`
        setOutput(result);
      }
    `},Tf=function(b,p,l,m){p===void 0&&(p=!1),l===void 0&&(l=null),m===void 0&&(m=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=b.outShape;for(var w=b.inHeight,P=b.inWidth,K=b.padInfo.top,ee=b.padInfo.left,le=b.strideHeight,de=b.strideWidth,Ee=b.dilationHeight,Te=b.dilationWidth,Ne=b.filterHeight,Fe=b.filterWidth,qe=Fe,Je="int xR; int xC; int xCOffset;",Ke=0;Ke<Ne;Ke++)for(var it=0;it<Fe;it++)Je+=`
          vec4 xTexelR`+Ke+"C"+2*it+` = vec4(0.);
          vec4 wR`+Ke+"C"+it+` = vec4(0.);
          vec4 xR`+Ke+"C"+it+" = vec4(0.);";for(Ke=0;Ke<Ne;Ke++)for(var gt=0;gt<qe;gt++){if(Je+=`
          xR = xRCorner + `+Ke*Ee+`;
          xC = xCCorner + `+(it=2*gt)*Te+`;
        `,de===1){if(it<Fe&&(Je+=ee%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+w+" && xCOffset >= 0 && xCOffset < "+P+`) {
                  xTexelR`+Ke+"C"+it+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+P+`) {
                    xTexelR`+Ke+"C"+it+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+Ke+"C"+it+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+w+" && xCOffset >= 0 && xCOffset < "+P+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+P+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+Ke+"C"+it+" = vec4(previous.zw, xTexelR"+Ke+"C"+it+`.xy);
                } else {
                  xR`+Ke+"C"+it+" = vec4(0, 0, xTexelR"+Ke+"C"+it+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+w+" && xC >= 0 && xC < "+P+`) {
                  xTexelR`+Ke+"C"+it+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+Ke+"C"+it+` = vec4(0.);
                }

                xR`+Ke+"C"+it+" = xTexelR"+Ke+"C"+it+`;
              `,it+1<Fe)){var Et=ee%2==0?It(Te):Te;Te%2==0&&ee%2==1||Te%2!=0&&ee%2!=1?(Je+=`
                  xCOffset = xC + `+ee%2+" + "+Et+`;

                  if(xR >= 0 && xR < `+w+` &&
                    xCOffset >= 0 && xCOffset < `+P+`) {
                    xTexelR`+Ke+"C"+(it+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,Te>1&&(Je+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+w+` &&
                      xCOffset >= 0 && xCOffset < `+P+`) {
                      xTexelR`+Ke+"C"+it+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+Ke+"C"+it+` = vec4(0.);
                    }
                  `),Je+=`
                  xR`+Ke+"C"+(it+1)+` = vec4(
                    xTexelR`+Ke+"C"+it+".zw, xTexelR"+Ke+"C"+(it+2)+`.xy);
                `):Je+=`
                  xCOffset = xC + `+Et+`;

                  if(xR >= 0 && xR < `+w+` &&
                    xCOffset >= 0 && xCOffset < `+P+`) {
                    xTexelR`+Ke+"C"+(it+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+Ke+"C"+(it+1)+" = xTexelR"+Ke+"C"+(it+2)+`;
                `}}else it<Fe&&(Je+=`
              if(xR >= 0 && xR < `+w+`) {
            `,ee%2==1?(Je+=`
                xCOffset = xC + 1 - `+de+`;
                if(xCOffset >= 0 && xCOffset < `+P+`) {
                  xTexelR`+Ke+"C"+it+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+Ke+"C"+it+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+P+`) {
                  xTexelR`+Ke+"C"+(it+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+Ke+"C"+(it+2)+` = vec4(0.);
                }

                xR`+Ke+"C"+it+` = vec4(
                  xTexelR`+Ke+"C"+it+".zw, xTexelR"+Ke+"C"+(it+2)+`.zw);
              `,it+1<Fe&&(Je+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+de+`;
                  if(xCOffset >= 0 && xCOffset < `+P+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+Ke+"C"+(it+1)+" = vec4(xTexelR"+Ke+"C"+(it+2)+`.xy, final.xy);
                `)):(Je+=`
                if(xC >= 0 && xC < `+P+`) {
                  xTexelR`+Ke+"C"+it+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+Ke+"C"+it+` = vec4(0.);
                }

                xCOffset = xC + `+de+`;
                if(xCOffset >= 0 && xCOffset < `+P+`) {
                  xTexelR`+Ke+"C"+(it+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+Ke+"C"+(it+2)+` = vec4(0.);
                }

                xR`+Ke+"C"+it+` = vec4(
                  xTexelR`+Ke+"C"+it+".xy, xTexelR"+Ke+"C"+(it+2)+`.xy);
              `,it+1<Fe&&(Je+=`
                  xR`+Ke+"C"+(it+1)+` = vec4(
                    xTexelR`+Ke+"C"+it+".zw, xTexelR"+Ke+"C"+(it+2)+`.zw);
                `)),Je+="}");it<Fe&&(Je+=`
            vec4 wTexelR`+Ke+"C"+it+" = getW("+Ke+", "+it+`, d1, q);
            wR`+Ke+"C"+it+" = vec4(wTexelR"+Ke+"C"+it+".xz, wTexelR"+Ke+"C"+it+`.xz);
          `,it+1<Fe&&(Je+=`
              vec4 wTexelR`+Ke+"C"+(it+1)+" = getW("+Ke+", "+(it+1)+`, d1, q);
              wR`+Ke+"C"+(it+1)+` =
                vec4(wTexelR`+Ke+"C"+(it+1)+".xz, wTexelR"+Ke+"C"+(it+1)+".xz);"))}for(Ke=0;Ke<Ne;Ke++)for(it=0;it<Fe;it++)Je+="dotProd += xR"+Ke+"C"+it+" * wR"+Ke+"C"+it+";";var At="",Wt="";l&&(At=m?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+l+`
        }`:`vec4 activation(vec4 x) {
          `+l+`
        }`,Wt="result = activation(result);");var cn=p?"result += getBiasAtOutCoords();":"";p&&this.variableNames.push("bias"),m&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+At+`

      const ivec2 strides = ivec2(`+le+", "+de+`);
      const ivec2 pads = ivec2(`+K+", "+ee+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+Je+`

        vec4 result = dotProd;
        `+cn+`
        `+Wt+`
        setOutput(result);
      }
    `};function uv(b,p){if(b===1)return""+p;if(b===2)return p+".y";if(b===3)return p+".z";if(b===4)return p+".w";throw Error("Cumulative sum for rank "+b+" is not yet supported")}var cv=function(){function b(p,l,m){this.variableNames=["x"],this.outputShape=[],this.outputShape=p,this.blockSize=l,this.dataFormat=m,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+l+`;
      int offset_h = imod(h, `+l+`);
      int in_w = w / `+l+`;
      int offset_w = imod(w, `+l+`);
      int offset_d = (offset_h * `+l+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return b.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},b.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},b.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},b.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},b.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},b}(),t0=function(b,p,l){this.variableNames=["real","imag"];var m=p[1];this.outputShape=p;var w=l?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,P=l?m+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+w+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+b+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+m+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+m+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+P+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},n0=function(){function b(p,l){this.outputShape=[],this.variableNames=["x"],this.outputShape=p,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return b.prototype.getCustomSetupFunc=function(p){var l=this;return function(m,w){l.valueLoc==null&&(l.valueLoc=m.getUniformLocationNoThrow(w,"value")),m.gl.uniform1f(l.valueLoc,p)}},b}();function lv(b,p){var l=Oo();return no(b,p,l.version+`
    precision highp float;
    `+l.attribute+` vec3 clipSpacePos;
    `+l.attribute+` vec2 uv;
    `+l.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function r0(b,p){return el(b,p,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function fv(b,p){return fc(b,p,new Uint16Array([0,1,2,2,1,3]))}function Id(b,p,l,m,w,P,K){Up(l,m);var ee=tl(b,p),le=b.TEXTURE_2D;return Kn(b,p,function(){return b.bindTexture(le,ee)}),Kn(b,p,function(){return b.texParameteri(le,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE)}),Kn(b,p,function(){return b.texParameteri(le,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE)}),Kn(b,p,function(){return b.texParameteri(le,b.TEXTURE_MIN_FILTER,b.NEAREST)}),Kn(b,p,function(){return b.texParameteri(le,b.TEXTURE_MAG_FILTER,b.NEAREST)}),Kn(b,p,function(){return b.texImage2D(le,0,w,l,m,0,P,K,null)}),Kn(b,p,function(){return b.bindTexture(b.TEXTURE_2D,null)}),ee}function um(b,p,l,m,w){var P=to(l,m);return Id(b,p,P[0],P[1],w.internalFormatFloat,w.textureFormatFloat,b.FLOAT)}function dv(b,p,l,m,w){var P=to(l,m);return Id(b,p,P[0],P[1],w.internalFormatHalfFloat,w.textureFormatFloat,w.textureTypeHalfFloat)}function hv(b,p,l,m,w){var P=to(l,m);return Id(b,p,P[0],P[1],b.RGBA,b.RGBA,b.UNSIGNED_BYTE)}function pv(b,p,l,m,w){var P=ri(l,m);return Id(b,p,P[0],P[1],w.internalFormatPackedFloat,b.RGBA,b.FLOAT)}function cl(b,p,l,m,w){var P=ri(l,m);return Id(b,p,P[0],P[1],w.internalFormatPackedHalfFloat,b.RGBA,w.textureTypeHalfFloat)}function Fd(b,p,l,m){return Kn(b,p,function(){return b.bindBuffer(b.ARRAY_BUFFER,m)}),dd(b,p,l,"clipSpacePos",m,3,20,0)&&dd(b,p,l,"uv",m,2,20,12)}function cm(b,p,l,m,w,P,K){var ee,le,de;Kn(b,p,function(){return b.bindTexture(b.TEXTURE_2D,l)}),P instanceof Uint8Array?(ee=new Uint8Array(m*w*4),le=b.UNSIGNED_BYTE,de=b.RGBA):(ee=new Float32Array(m*w*4),le=b.FLOAT,de=K.internalFormatPackedFloat),ee.set(P),Kn(b,p,function(){return b.texImage2D(b.TEXTURE_2D,0,de,m,w,0,b.RGBA,le,ee)}),Kn(b,p,function(){return b.bindTexture(b.TEXTURE_2D,null)})}function i0(b,p,l,m){Kn(b,p,function(){return b.bindTexture(b.TEXTURE_2D,l)}),m.data instanceof Uint8Array?Kn(b,p,function(){return b.texImage2D(b.TEXTURE_2D,0,b.RGBA,m.width,m.height,0,b.RGBA,b.UNSIGNED_BYTE,m.data)}):Kn(b,p,function(){return b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,m)}),Kn(b,p,function(){return b.bindTexture(b.TEXTURE_2D,null)})}function o0(b,p,l,m,w){var P=b.createBuffer();Kn(b,p,function(){return b.bindBuffer(b.PIXEL_PACK_BUFFER,P)});var K=16*l*m;return Kn(b,p,function(){return b.bufferData(b.PIXEL_PACK_BUFFER,K,b.STREAM_READ)}),Kn(b,p,function(){return b.readPixels(0,0,m,l,b.RGBA,b.FLOAT,0)}),Kn(b,p,function(){return b.bindBuffer(b.PIXEL_PACK_BUFFER,null)}),P}function Ny(b,p,l){var m=b,w=new Float32Array(l);return m.bindBuffer(m.PIXEL_PACK_BUFFER,p),m.getBufferSubData(m.PIXEL_PACK_BUFFER,0,w),m.bindBuffer(m.PIXEL_PACK_BUFFER,null),w}function a0(b,p,l,m,w){var P=to(l,m),K=P[0],ee=P[1],le=new Uint8Array(l*m*4);return Kn(b,p,function(){return b.readPixels(0,0,K,ee,w.downloadTextureFormat,b.UNSIGNED_BYTE,le)}),new Float32Array(le.buffer)}function qh(b,p,l,m,w,P,K,ee){var le=b,de=new Float32Array(function(Ee,Te){var Ne=ri(P,K);return Ne[0]*Ne[1]*4}());return le.bindBuffer(le.PIXEL_PACK_BUFFER,p),le.getBufferSubData(le.PIXEL_PACK_BUFFER,0,de),le.bindBuffer(le.PIXEL_PACK_BUFFER,null),de}function Rd(b,p,l,m){var w=new Float32Array(l*m*4);return Kn(b,p,function(){return b.readPixels(0,0,m,l,b.RGBA,b.FLOAT,w)}),w}var ll=Object.freeze({createVertexShader:lv,createVertexBuffer:r0,createIndexBuffer:fv,createFloat32MatrixTexture:um,createFloat16MatrixTexture:dv,createUnsignedBytesMatrixTexture:hv,createPackedMatrixTexture:pv,createFloat16PackedMatrixTexture:cl,bindVertexProgramAttributeStreams:Fd,uploadDenseMatrixToTexture:cm,uploadPixelDataToTexture:i0,createBufferFromOutputTexture:o0,downloadFloat32MatrixFromBuffer:Ny,downloadByteEncodedFloatMatrixFromOutputTexture:a0,downloadPackedMatrixFromBuffer:qh,downloadMatrixFromPackedOutputTexture:Rd}),s0=function(){function b(p){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var l=j().getNumber("WEBGL_VERSION");p!=null?(this.gl=p,Ai(l,p)):this.gl=ni(l);var m="WEBGL_color_buffer_float";if(j().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=Wi(this.gl,this.debug,"OES_texture_float"),Ea(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Wi(this.gl,this.debug,"OES_texture_half_float");else if(j().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(m),Ea(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Wi(this.gl,this.debug,"EXT_color_buffer_half_float");else if(j().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(m="EXT_color_buffer_float",Ea(this.gl,m))this.colorBufferFloatExtension=this.gl.getExtension(m);else{if(!Ea(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=r0(this.gl,this.debug),this.indexBuffer=fv(this.gl,this.debug),this.framebuffer=xs(this.gl,this.debug),this.textureConfig=Jr(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(b.prototype,"debug",{get:function(){return j().getBool("DEBUG")},enumerable:!0,configurable:!0}),b.prototype.dispose=function(){var p=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var l=this.gl;Kn(l,this.debug,function(){return l.finish()}),Kn(l,this.debug,function(){return l.bindFramebuffer(l.FRAMEBUFFER,null)}),Kn(l,this.debug,function(){return l.deleteFramebuffer(p.framebuffer)}),Kn(l,this.debug,function(){return l.bindBuffer(l.ARRAY_BUFFER,null)}),Kn(l,this.debug,function(){return l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,null)}),Kn(l,this.debug,function(){return l.deleteBuffer(p.indexBuffer)}),this.disposed=!0}},b.prototype.createFloat32MatrixTexture=function(p,l){return this.throwIfDisposed(),um(this.gl,this.debug,p,l,this.textureConfig)},b.prototype.createFloat16MatrixTexture=function(p,l){return this.throwIfDisposed(),dv(this.gl,this.debug,p,l,this.textureConfig)},b.prototype.createUnsignedBytesMatrixTexture=function(p,l){return this.throwIfDisposed(),hv(this.gl,this.debug,p,l,this.textureConfig)},b.prototype.uploadPixelDataToTexture=function(p,l){this.throwIfDisposed(),i0(this.gl,this.debug,p,l)},b.prototype.uploadDenseMatrixToTexture=function(p,l,m,w){this.throwIfDisposed(),cm(this.gl,this.debug,p,l,m,w,this.textureConfig)},b.prototype.createFloat16PackedMatrixTexture=function(p,l){return this.throwIfDisposed(),cl(this.gl,this.debug,p,l,this.textureConfig)},b.prototype.createPackedMatrixTexture=function(p,l){return this.throwIfDisposed(),pv(this.gl,this.debug,p,l,this.textureConfig)},b.prototype.deleteMatrixTexture=function(p){var l=this;this.throwIfDisposed(),this.outputTexture===p&&(hf(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Kn(this.gl,this.debug,function(){return l.gl.deleteTexture(p)})},b.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(p,l,m){var w=this;return this.downloadMatrixDriver(p,function(){return a0(w.gl,w.debug,l,m,w.textureConfig)})},b.prototype.downloadPackedMatrixFromBuffer=function(p,l,m,w,P,K){return qh(this.gl,p,0,0,0,P,K,this.textureConfig)},b.prototype.downloadFloat32MatrixFromBuffer=function(p,l){return Ny(this.gl,p,l)},b.prototype.createBufferFromTexture=function(p,l,m){this.bindTextureToFrameBuffer(p);var w=o0(this.gl,this.debug,l,m,this.textureConfig);return this.unbindTextureToFrameBuffer(),w},b.prototype.createAndWaitForFence=function(){var p=this.createFence(this.gl);return this.pollFence(p)},b.prototype.createFence=function(p){var l,m,w=this;if(j().getBool("WEBGL_FENCE_API_ENABLED")){var P=p,K=P.fenceSync(P.SYNC_GPU_COMMANDS_COMPLETE,0);p.flush(),m=function(){var ee=P.clientWaitSync(K,0,0);return ee===P.ALREADY_SIGNALED||ee===P.CONDITION_SATISFIED},l=K}else j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(l=this.beginQuery(),this.endQuery(),m=function(){return w.isQueryAvailable(l,j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):m=function(){return!0};return{query:l,isFencePassed:m}},b.prototype.downloadMatrixFromPackedTexture=function(p,l,m){var w=this;return this.downloadMatrixDriver(p,function(){return Rd(w.gl,w.debug,l,m)})},b.prototype.createProgram=function(p){this.throwIfDisposed();var l=this.gl,m=So(l,this.debug,p),w=lv(l,this.debug),P=ro(l,this.debug);return Kn(l,this.debug,function(){return l.attachShader(P,w)}),Kn(l,this.debug,function(){return l.attachShader(P,m)}),Mc(l,this.debug,P),this.debug&&Gu(l,this.debug,P),this.vertexAttrsAreBound||(this.setProgram(P),this.vertexAttrsAreBound=Fd(l,this.debug,this.program,this.vertexBuffer)),P},b.prototype.deleteProgram=function(p){var l=this;this.throwIfDisposed(),p===this.program&&(this.program=null),p!=null&&Kn(this.gl,this.debug,function(){return l.gl.deleteProgram(p)})},b.prototype.setProgram=function(p){var l=this;this.throwIfDisposed(),this.program=p,this.program!=null&&this.debug&&Gu(this.gl,this.debug,this.program),Kn(this.gl,this.debug,function(){return l.gl.useProgram(p)})},b.prototype.getUniformLocation=function(p,l,m){return m===void 0&&(m=!0),this.throwIfDisposed(),m?dc(this.gl,this.debug,p,l):hd(this.gl,p,l)},b.prototype.getAttributeLocation=function(p,l){var m=this;return this.throwIfDisposed(),Kn(this.gl,this.debug,function(){return m.gl.getAttribLocation(p,l)})},b.prototype.getUniformLocationNoThrow=function(p,l){return this.throwIfDisposed(),this.gl.getUniformLocation(p,l)},b.prototype.setInputMatrixTexture=function(p,l,m){this.throwIfDisposed(),this.throwIfNoProgram(),kh(this.gl,this.debug,this.program,p,l,m)},b.prototype.setOutputMatrixTexture=function(p,l,m){this.setOutputMatrixTextureDriver(p,m,l)},b.prototype.setOutputPackedMatrixTexture=function(p,l,m){this.throwIfDisposed();var w=ri(l,m),P=w[0],K=w[1];this.setOutputMatrixTextureDriver(p,P,K)},b.prototype.setOutputMatrixWriteRegion=function(p,l,m,w){this.setOutputMatrixWriteRegionDriver(m,p,w,l)},b.prototype.setOutputPackedMatrixWriteRegion=function(p,l,m,w){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},b.prototype.debugValidate=function(){this.program!=null&&Gu(this.gl,this.debug,this.program),Ha(this.gl)},b.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var p=this.gl;this.debug&&this.debugValidate(),Kn(p,this.debug,function(){return p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0)})},b.prototype.blockUntilAllProgramsCompleted=function(){var p=this;this.throwIfDisposed(),Kn(this.gl,this.debug,function(){return p.gl.finish()})},b.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Wi(this.gl,this.debug,j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},b.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},b.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},b.prototype.beginQuery=function(){if(j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var p=this.gl,l=this.getQueryTimerExtensionWebGL2(),m=p.createQuery();return p.beginQuery(l.TIME_ELAPSED_EXT,m),m}var w=this.getQueryTimerExtensionWebGL1(),P=w.createQueryEXT();return w.beginQueryEXT(w.TIME_ELAPSED_EXT,P),P},b.prototype.endQuery=function(){if(j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var p=this.getQueryTimerExtensionWebGL1();p.endQueryEXT(p.TIME_ELAPSED_EXT)}else{var l=this.gl,m=this.getQueryTimerExtensionWebGL2();l.endQuery(m.TIME_ELAPSED_EXT)}},b.prototype.waitForQueryAndGetTime=function(p){return D(this,void 0,void 0,function(){var l=this;return R(this,function(m){switch(m.label){case 0:return[4,xt(function(){return l.disposed||l.isQueryAvailable(p,j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return m.sent(),[2,this.getQueryTime(p,j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},b.prototype.getQueryTime=function(p,l){if(l===0)return null;if(l===2){var m=this.gl;return m.getQueryParameter(p,m.QUERY_RESULT)/1e6}var w=this.getQueryTimerExtensionWebGL1();return w.getQueryObjectEXT(p,w.QUERY_RESULT_EXT)/1e6},b.prototype.isQueryAvailable=function(p,l){if(l===0)return!0;if(l===2){var m=this.gl,w=this.getQueryTimerExtensionWebGL2(),P=m.getQueryParameter(p,m.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(w.GPU_DISJOINT_EXT)),P&&!this.disjoint}return P=(w=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(p,w.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(w.GPU_DISJOINT_EXT)),P&&!this.disjoint},b.prototype.pollFence=function(p){var l=this;return new Promise(function(m){l.addItemToPoll(function(){return p.isFencePassed()},function(){return m()})})},b.prototype.pollItems=function(){for(var p=function(m){for(var w=0;w<m.length&&m[w]();++w);return w-1}(this.itemsToPoll.map(function(m){return m.isDoneFn})),l=0;l<=p;++l)(0,this.itemsToPoll[l].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(p+1)},b.prototype.addItemToPoll=function(p,l){var m=this;this.itemsToPoll.push({isDoneFn:p,resolveFn:l}),this.itemsToPoll.length>1||xt(function(){return m.pollItems(),m.itemsToPoll.length===0})},b.prototype.bindTextureToFrameBuffer=function(p){this.throwIfDisposed(),nl(this.gl,this.debug,p,this.framebuffer),this.debug&&Ha(this.gl)},b.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(nl(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Ha(this.gl)):hf(this.gl,this.debug,this.framebuffer)},b.prototype.downloadMatrixDriver=function(p,l){this.bindTextureToFrameBuffer(p);var m=l();return this.unbindTextureToFrameBuffer(),m},b.prototype.setOutputMatrixTextureDriver=function(p,l,m){this.throwIfDisposed();var w=this.gl;nl(w,this.debug,p,this.framebuffer),this.debug&&Ha(w),this.outputTexture=p,Kn(w,this.debug,function(){return w.viewport(0,0,l,m)}),Kn(w,this.debug,function(){return w.scissor(0,0,l,m)})},b.prototype.setOutputMatrixWriteRegionDriver=function(p,l,m,w){var P=this;this.throwIfDisposed(),Kn(this.gl,this.debug,function(){return P.gl.scissor(p,l,m,w)})},b.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},b.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},b}();function u0(b,p){if(b.length!==p.length)throw Error("Binary was compiled with "+b.length+" inputs, but was executed with "+p.length+" inputs");b.forEach(function(l,m){var w=l.logicalShape,P=p[m],K=P.shape;if(!Ut(w,K))throw Error("Binary was compiled with different shapes than the current args. Shapes "+w+" and "+K+" must match");if(!l.isUniform||!P.isUniform){var ee=l.texShape,le=P.isUniform?null:P.texData.texShape;if(!Ut(ee,le))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+ee+" and "+le+" must match")}})}var ec=function(b,p,l,m,w,P,K){l===void 0&&(l=!1),m===void 0&&(m=!1),w===void 0&&(w=!1),P===void 0&&(P=null),K===void 0&&(K=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=p;var ee=l?b[1]:b[2],le=Math.ceil(ee/2),de=l?"i * 2, rc.y":"rc.y, i * 2",Ee=m?"rc.z, i * 2":"i * 2, rc.z",Te=l?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],Ne=m?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],Fe="",qe="";P&&(Fe=K?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+P+`
        }`:`vec4 activation(vec4 x) {
          `+P+`
        }`,qe="result = activation(result);");var Je=w?"result += getBiasAtOutCoords();":"";w&&this.variableNames.push("bias"),K&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+Fe+`

      const float sharedDimension = `+le+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+le+`; i++) {
          vec4 a = getMatrixA(rc.x, `+de+`);
          vec4 b = getMatrixB(rc.x, `+Ee+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+Te[0]+" * "+Ne[0]+`);
          result += (`+Te[1]+" * "+Ne[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+Je+`

        `+qe+`

        setOutput(result);
      }
    `},c0=function(){function b(p,l,m){this.variableNames=["probs"],this.outputShape=[p,m],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(l-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(l-1)+`));
      }
    `}return b.prototype.getCustomSetupFunc=function(p){var l=this;return function(m,w){l.seedLoc==null&&(l.seedLoc=m.getUniformLocation(w,"seed")),m.gl.uniform1f(l.seedLoc,p)}},b}(),$h=function(b,p,l,m,w){if(m===void 0&&(m=!1),w===void 0&&(w=!1),this.variableNames=["x"],p==="avg"&&l)throw new Error("Cannot compute positions for average pool.");var P=b.filterWidth,K=b.strideHeight,ee=b.strideWidth,le=b.dilationHeight,de=b.dilationWidth,Ee=b.effectiveFilterHeight,Te=b.effectiveFilterWidth,Ne=b.padInfo.top,Fe=b.padInfo.left;this.outputShape=b.outShape;var qe=p==="avg",Je="((batch  * "+b.inHeight+" + xR) * "+b.inWidth+" + xC) * "+b.inChannels+" + d",Ke="(xR * "+b.inWidth+" + xC) * "+b.inChannels+" + d",it="0.0";if(qe||(it="-1.0 / 1e-20"),l)this.userCode=`
        const ivec2 strides = ivec2(`+K+", "+ee+`);
        const ivec2 pads = ivec2(`+Ne+", "+Fe+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+Ee+`;
              wR += `+le+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+b.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+Te+`;
                wC += `+de+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+b.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = `+(m?w?Je:Ke:"wR * "+Te+" + wC")+`;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var gt=p+"("+p+"("+p+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";p==="avg"&&(gt="avgValue / count");var Et=4*Math.floor(P/4),At=P%4,Wt=`
      if (`+qe+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+K+", "+ee+`);
      const ivec2 pads = ivec2(`+Ne+", "+Fe+`);
      const float initializationValue = `+it+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+b.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+it+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+Ee+`;
            wR += `+le+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+b.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+Et+`; wC += 4) {
            int xC = xCCorner + wC * `+de+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+de+`, d),
              getValue(batch, xR, xC + 2 * `+de+`, d),
              getValue(batch, xR, xC + 3 * `+de+`, d)
            );

            `+Wt+`
          }

          int xC = xCCorner + `+Et+`;
          if (`+(At===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+Wt+`
          } else if (`+(At===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+de+`, d),
              initializationValue,
              initializationValue
            );

            `+Wt+`
          } else if (`+(At===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+de+`, d),
              getValue(batch, xR, xC + 2 * `+de+`, d),
              initializationValue
            );

            `+Wt+`
          }
        }
        setOutput(`+gt+`);
      }
    `}},lm=function(b,p,l,m,w){if(m===void 0&&(m=!1),w===void 0&&(w=!1),this.variableNames=["x"],p==="avg"&&l)throw new Error("Cannot compute positions for average pool.");var P=b.filterWidth,K=b.strideDepth,ee=b.strideHeight,le=b.strideWidth,de=b.dilationDepth,Ee=b.dilationHeight,Te=b.dilationWidth,Ne=b.effectiveFilterDepth,Fe=b.effectiveFilterHeight,qe=b.effectiveFilterWidth,Je=b.padInfo.front,Ke=b.padInfo.top,it=b.padInfo.left;this.outputShape=b.outShape;var gt=p==="avg",Et="0.0";if(gt||(Et="-1.0 / 1e-20"),l)this.userCode=`
        const ivec3 strides =
            ivec3(`+K+", "+ee+", "+le+`);
        const ivec3 pads = ivec3(`+Je+", "+Ke+", "+it+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+Ne+`;
              wD += `+de+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+b.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+Fe+`;
                wR += `+Ee+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+b.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+qe+`;
                  wC += `+Te+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+b.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = `+(m?w?"(((batch * "+b.inDepth+" + xD) * "+b.inHeight+" + xR) * "+b.inWidth+" + xC) * "+b.inChannels+" + ch":"((xD * "+b.inHeight+" + xR) * "+b.inWidth+" + xC) * "+b.inChannels+" + ch":"wD * "+Fe+" * "+qe+` +
                      wR * `+qe+" + wC")+`;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var At=p+"("+p+"("+p+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";p==="avg"&&(At="avgValue / count");var Wt=4*Math.floor(P/4),cn=P%4,pn=`
      if (`+gt+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+K+", "+ee+", "+le+`);
      const ivec3 pads = ivec3(`+Je+", "+Ke+", "+it+`);
      const float initializationValue = `+Et+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+b.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+Et+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+Ne+`;
            wD += `+de+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+b.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+Fe+`;
            wR += `+Ee+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+b.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+Wt+`; wC += 4) {
              int xC = xCCorner + wC * `+Te+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+Te+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+Te+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+Te+`, ch)
              );

              `+pn+`
            }

            int xC = xCCorner + `+Wt+`;
            if (`+(cn===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+pn+`
            } else if (`+(cn===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+Te+`, ch),
                initializationValue,
                initializationValue
              );

              `+pn+`
            } else if (`+(cn===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+Te+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+Te+`, ch),
                initializationValue
              );

              `+pn+`
            }
          }
          setOutput(`+At+`);
        }
      }
    `}},Iy=function(b,p,l,m,w,P,K){this.variableNames=["updates","indices","defaultValue"],this.outputShape=P;var ee=Wo(w.length),le=Wo(P.length),de="";l===1?de="i":l===2&&(de="i, j");var Ee="getIndices("+de+")",Te="";m===1?Te="i":m===2&&(Te="i, coords[1]");var Ne="getUpdates("+Te+")",Fe=p>1?"strides[j]":"strides";this.userCode=`
        `+ee+" strides = "+ee+"("+w+`);

        void main() {
          `+le+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+b+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+p+`; j++) {
              int index = round(`+Ee+`);
              flattenedIndex += index * `+Fe+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+Ne+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},fm=function(){function b(p){this.variableNames=["source"],this.outputShape=p,this.rank=p.length;var l,m=Wo(this.rank),w="uniform int start["+this.rank+"];",P=function(K){if(K===1)return"sourceLoc";if(K<=6)return fl.slice(0,K).map(function(ee){return"sourceLoc."+ee}).join(",");throw Error("Slicing for rank "+K+" is not yet supported")}(this.rank);l=`
        `+m+` sourceLoc;
        `+m+` coords = getOutputCoords();
        `+p.map(function(K,ee){return"sourceLoc."+fl[ee]+" = start["+ee+"] + coords."+fl[ee]+";"}).join(`
`)+`
      `,this.userCode=`
      `+w+`
      void main() {
        `+l+`
        setOutput(getSource(`+P+`));
      }
    `}return b.prototype.getCustomSetupFunc=function(p){var l=this;if(p.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+p.length+")");return function(m,w){l.startLoc==null&&(l.startLoc=m.getUniformLocationNoThrow(w,"start"),l.startLoc==null)||m.gl.uniform1iv(l.startLoc,p)}},b}(),fl=["x","y","z","w","u","v"],dm=function(){function b(p){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=p,this.rank=p.length;var l=Wo(this.rank),m=Ca("coords",this.rank),w=Ca("sourceLoc",this.rank),P=this.rank===1?"sourceLoc":"vec2("+w.slice(-2).join()+")",K="getChannel(getSource("+w.join()+"), "+P+")",ee=`
      result.x = `+K+`;
      if (++`+m[this.rank-1]+" < "+p[this.rank-1]+`) {
        ++`+w[this.rank-1]+`;
        result.y = `+K+`;
        --`+w[this.rank-1]+`;
      }
    `,le=this.rank===1?"":`
      --`+m[this.rank-1]+`;
      if (++`+m[this.rank-2]+" < "+p[this.rank-2]+`) {
        ++`+w[this.rank-2]+`;
        result.z = `+K+`;
        if (++`+m[this.rank-1]+" < "+p[this.rank-1]+`) {
          ++`+w[this.rank-1]+`;
          result.w = `+K+`;
        }
      }
    `,de=this.rank<=4?`sourceLoc = coords +
            `+l+"("+p.map(function(Ee,Te){return"start["+Te+"]"}).join()+");":p.map(function(Ee,Te){return w[Te]+" = "+m[Te]+" + start["+Te+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+l+` coords = getOutputCoords();
        `+l+` sourceLoc;
        `+de+`
        vec4 result = vec4(0.);
        `+ee+`
        `+le+`
        setOutput(result);
      }
    `}return b.prototype.getCustomSetupFunc=function(p){var l=this;if(p.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+p.length+")");return function(m,w){l.startLoc==null&&(l.startLoc=m.getUniformLocationNoThrow(w,"start"),l.startLoc==null)||m.gl.uniform1iv(l.startLoc,p)}},b}(),mv=function(){function b(p){this.gpgpu=p,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return b.prototype.acquireTexture=function(p,l,m){var w,P=gv(l,m),K=l0(p,P,m);if(K in this.freeTextures||(this.freeTextures[K]=[]),K in this.usedTextures||(this.usedTextures[K]=[]),this.freeTextures[K].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var ee=this.freeTextures[K].shift();return this.usedTextures[K].push(ee),ee}return this.numUsedTextures++,this.log(),P===jr.PACKED_2X2_FLOAT32?w=this.gpgpu.createPackedMatrixTexture(p[0],p[1]):P===jr.PACKED_2X2_FLOAT16?w=this.gpgpu.createFloat16PackedMatrixTexture(p[0],p[1]):P===jr.UNPACKED_FLOAT32?w=this.gpgpu.createFloat32MatrixTexture(p[0],p[1]):P===jr.UNPACKED_FLOAT16?w=this.gpgpu.createFloat16MatrixTexture(p[0],p[1]):P===jr.PACKED_4X1_UNSIGNED_BYTE&&(w=this.gpgpu.createUnsignedBytesMatrixTexture(p[0],p[1])),this.usedTextures[K].push(w),w},b.prototype.releaseTexture=function(p,l,m,w){if(this.freeTextures!=null){var P=l0(l,gv(m,w),w);P in this.freeTextures||(this.freeTextures[P]=[]),this.freeTextures[P].push(p),this.numFreeTextures++,this.numUsedTextures--;var K=this.usedTextures[P],ee=K.indexOf(p);if(ee<0)throw new Error("Cannot release a texture that was never provided by this texture manager");K.splice(ee,1),this.log()}},b.prototype.log=function(){if(this.logEnabled){var p=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+p+")")}},b.prototype.getNumUsedTextures=function(){return this.numUsedTextures},b.prototype.getNumFreeTextures=function(){return this.numFreeTextures},b.prototype.dispose=function(){var p=this;if(this.freeTextures!=null){for(var l in this.freeTextures)this.freeTextures[l].forEach(function(m){p.gpgpu.deleteMatrixTexture(m)});for(var l in this.usedTextures)this.usedTextures[l].forEach(function(w){p.gpgpu.deleteMatrixTexture(w)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},b}();function gv(b,p){if(b===lr.UPLOAD)return jr.PACKED_2X2_FLOAT32;if(b===lr.RENDER||b==null)return function(l){return j().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?l?jr.PACKED_2X2_FLOAT32:jr.UNPACKED_FLOAT32:l?jr.PACKED_2X2_FLOAT16:jr.UNPACKED_FLOAT16}(p);if(b===lr.DOWNLOAD||b===lr.PIXELS)return jr.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+b)}function l0(b,p,l){return b[0]+"_"+b[1]+"_"+p+"_"+l}var j1=1.7580993408473768,z1=1.0507009873554805,xo=function(b,p){this.variableNames=["A"],this.outputShape=b,this.userCode=`
      float unaryOperation(float x) {
        `+p+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},vv="if (isnan(x)) return x;",yv="return x;",og="return abs(x);",bv=vv+`
  return (x < 0.0) ? 0.0 : x;
`,hm=vv+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Wl="return (x >= 0.0) ? x : (exp(x) - 1.0);",Vl="return -x;",xv="return ceil(x);",wv="return floor(x);",Xh="return exp(x);",Pd="return exp(x) - 1.0;",Kh="return x;",U1="return x;",ag=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Hl=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,tc=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Mf=function(b,p){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=b,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+p+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},Df={};function Nf(b,p){if(p===void 0&&(p=!1),b==="linear")return p?U1:yv;if(b==="relu")return p?ag:bv;if(b==="elu")return p?tc:Wl;if(b==="relu6")return p?Hl:hm;if(b==="prelu")return p?hs:ul;throw new Error("Activation "+b+" has not been implemented for the WebGL backend.")}var _v=600,sg=function(b){function p(l){var m,w=b.call(this)||this;if(w.pendingRead=new WeakMap,w.pendingDisposal=new WeakSet,w.dataRefCount=new WeakMap,w.numBytesInGPU=0,w.uploadWaitMs=0,w.downloadWaitMs=0,w.warnedAboutMemory=!1,w.pendingDeletes=0,w.disposed=!1,!j().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(l==null){var P=ni(j().getNumber("WEBGL_VERSION"));w.binaryCache=((m=j().getNumber("WEBGL_VERSION"))in Df||(Df[m]={}),Df[m]),w.gpgpu=new s0(P),w.canvas=P.canvas,w.gpgpuCreatedLocally=!0}else w.gpgpu=l,w.binaryCache={},w.gpgpuCreatedLocally=!1,w.canvas=l.gl.canvas;return w.textureManager=new mv(w.gpgpu),w.numMBBeforeWarning=j().global.screen==null?1024:j().global.screen.height*j().global.screen.width*window.devicePixelRatio*_v/1024/1024,w.texData=new qt(w,He),w}return B(p,b),p.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},p.prototype.write=function(l,m,w){if(j().getBool("DEBUG")&&this.checkNumericalProblems(l),w==="complex64"&&l!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var P={};return this.texData.set(P,{shape:m,dtype:w,values:l,usage:lr.UPLOAD}),P},p.prototype.move=function(l,m,w,P){if(j().getBool("DEBUG")&&this.checkNumericalProblems(m),P==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(l,{shape:w,dtype:P,values:m,usage:lr.UPLOAD})},p.prototype.readSync=function(l){var m=this.texData.get(l),w=m.values,P=m.dtype,K=m.complexTensors,ee=m.slice,le=m.shape,de=m.isPacked;if(ee!=null){var Ee;Ee=de?new Mf(le,Kh):new xo(le,Kh);var Te=this.runWebGLProgram(Ee,[{dataId:l,shape:le,dtype:P}],P),Ne=this.readSync(Te.dataId);return this.disposeData(Te.dataId),Ne}if(w!=null)return this.convertAndCacheOnCPU(l);if(P==="string")return w;var Fe,qe,Je=this.activeTimers!=null;return Je&&(Fe=en()),qe=P==="complex64"?gi(K.real.dataSync(),K.imag.dataSync()):this.getValuesFromTexture(l),Je&&(this.downloadWaitMs+=en()-Fe),this.convertAndCacheOnCPU(l,qe)},p.prototype.read=function(l){return D(this,void 0,void 0,function(){var m,w,P,K,ee,le,de,Ee,Te,Ne,Fe,qe,Je,Ke,it,gt,Et,At,Wt,cn,pn,ln;return R(this,function(dn){switch(dn.label){case 0:if(this.pendingRead.has(l))return m=this.pendingRead.get(l),[2,new Promise(function(Nn){return m.push(Nn)})];if(w=this.texData.get(l),P=w.values,K=w.shape,ee=w.slice,le=w.dtype,de=w.complexTensors,Ee=w.isPacked,ee!=null)return Te=void 0,Te=Ee?new Mf(K,Kh):new xo(K,Kh),Ne=this.runWebGLProgram(Te,[{dataId:l,shape:K,dtype:le}],le),Fe=this.read(Ne.dataId),this.disposeData(Ne.dataId),[2,Fe];if(P!=null)return[2,this.convertAndCacheOnCPU(l)];if(!j().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&j().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return qe=null,le!=="complex64"&&j().get("WEBGL_BUFFER_SUPPORTED")&&(Je=this.decode(l),Ke=this.texData.get(Je.dataId),qe=(ln=this.gpgpu).createBufferFromTexture.apply(ln,[Ke.texture].concat(yi(K)))),this.pendingRead.set(l,[]),le==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:dn.sent(),dn.label=2;case 2:return le!=="complex64"?[3,4]:[4,Promise.all([de.real.data(),de.imag.data()])];case 3:return gt=dn.sent(),Et=gt[0],At=gt[1],it=gi(Et,At),[3,5];case 4:qe==null?it=this.getValuesFromTexture(l):(Wt=ze(K),it=this.gpgpu.downloadFloat32MatrixFromBuffer(qe,Wt)),dn.label=5;case 5:return Je!=null&&this.disposeData(Je.dataId),cn=this.convertAndCacheOnCPU(l,it),pn=this.pendingRead.get(l),this.pendingRead.delete(l),pn.forEach(function(Nn){return Nn(cn)}),this.pendingDisposal.has(l)&&(this.pendingDisposal.delete(l),this.disposeData(l),this.pendingDeletes--),[2,cn]}})})},p.prototype.checkNumericalProblems=function(l){if(l!=null)for(var m=0;m<l.length;m++){var w=l[m];if(!Wr(w))throw j().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+w+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+w+" cannot be represented on this device.")}},p.prototype.getValuesFromTexture=function(l){var m,w=this.texData.get(l),P=w.shape,K=w.dtype,ee=w.isPacked,le=ze(P);if(j().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var de=this.decode(l),Ee=this.texData.get(de.dataId),Te=(m=this.gpgpu).downloadMatrixFromPackedTexture.apply(m,[Ee.texture].concat(yi(P))).subarray(0,le);return this.disposeData(de.dataId),Te}var Ne=j().getBool("WEBGL_PACK")&&ee===!0,Fe=Ne?Nc(P):P,qe=Ne?new function(gt){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=lr.DOWNLOAD;var Et=Oo();this.outputShape=gt,this.userCode=`
      `+Cs+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+Et.output+` = encode_float(x);
      }
    `}(Fe):new function(gt){this.variableNames=["A"],this.outTexUsage=lr.DOWNLOAD;var Et=Oo();this.outputShape=gt,this.userCode=`
      `+Cs+`

      void main() {
        float x = getAAtOutCoords();
        `+Et.output+` = encode_float(x);
      }
    `}(Fe),Je=this.runWebGLProgram(qe,[{shape:Fe,dtype:K,dataId:l}],"float32"),Ke=this.texData.get(Je.dataId),it=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(Ke.texture,Ke.texShape[0],Ke.texShape[1]).subarray(0,le);return this.disposeData(Je.dataId),it},p.prototype.time=function(l){return D(this,void 0,void 0,function(){var m,w,P,K,ee,le,de;return R(this,function(Ee){switch(Ee.label){case 0:return m=this.activeTimers,w=[],P=!1,this.programTimersStack==null?(this.programTimersStack=w,P=!0):this.activeTimers.push(w),this.activeTimers=w,l(),K=Ot(this.activeTimers.map(function(Te){return Te.query})).filter(function(Te){return Te!=null}),ee=Ot(this.activeTimers.map(function(Te){return Te.name})).filter(function(Te){return Te!=null}),this.activeTimers=m,P&&(this.programTimersStack=null),le={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(K)]:[3,2];case 1:return de=Ee.sent(),le.kernelMs=wt(de),le.getExtraProfileInfo=function(){return de.map(function(Te,Ne){return{name:ee[Ne],ms:Te}}).map(function(Te){return Te.name+": "+Te.ms}).join(", ")},[3,3];case 2:le.kernelMs={error:"WebGL query timers are not supported in this environment."},Ee.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,le]}})})},p.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},p.prototype.startTimer=function(){return j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:en(),endMs:null}},p.prototype.endTimer=function(l){return j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),l):(l.endMs=en(),l)},p.prototype.getQueryTime=function(l){return D(this,void 0,void 0,function(){var m;return R(this,function(w){return j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(l)]:[2,(m=l).endMs-m.startMs]})})},p.prototype.disposeData=function(l){if(!this.pendingDisposal.has(l)){if(this.pendingRead.has(l))return this.pendingDisposal.add(l),void this.pendingDeletes++;if(this.texData.has(l)){this.releaseGPUData(l);var m=this.texData.get(l).complexTensors;m!=null&&(m.real.dispose(),m.imag.dispose()),this.texData.delete(l)}}},p.prototype.releaseGPUData=function(l){var m=this.texData.get(l),w=m.texture,P=m.dtype,K=m.texShape,ee=m.usage,le=m.isPacked,de=m.slice,Ee=de&&de.origDataId||l,Te=this.dataRefCount.get(Ee);Te>1?this.dataRefCount.set(Ee,Te-1):(this.dataRefCount.delete(Ee),w!=null&&(this.numBytesInGPU-=this.computeBytes(K,P),this.textureManager.releaseTexture(w,K,ee,le)));var Ne=this.texData.get(l);Ne.texture=null,Ne.texShape=null,Ne.isPacked=!1,Ne.slice=null},p.prototype.getTexture=function(l){return this.uploadToGPU(l),this.texData.get(l).texture},p.prototype.getDataInfo=function(l){return this.texData.get(l)},p.prototype.getCPUBackend=function(){return j().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=He.findBackend("cpu")),this.cpuBackend):null},p.prototype.shouldExecuteOnCPU=function(l,m){var w=this;return m===void 0&&(m=128),this.getCPUBackend()!=null&&l.every(function(P){return w.texData.get(P.dataId).texture==null&&ze(P.shape)<m})},p.prototype.getGPGPUContext=function(){return this.gpgpu},p.prototype.complex=function(l,m){var w=this.makeOutput(l.shape,"complex64");return this.texData.get(w.dataId).complexTensors={real:He.keep(l.clone()),imag:He.keep(m.clone())},w},p.prototype.real=function(l){return this.texData.get(l.dataId).complexTensors.real.clone()},p.prototype.imag=function(l){return this.texData.get(l.dataId).complexTensors.imag.clone()},p.prototype.slice=function(l,m,w){if(this.shouldExecuteOnCPU([l]))return this.cpuBackend.slice(l,m,w);if(ze(w)===0)return No([],w,l.dtype);var P=this.texData.get(l.dataId).isPacked,K=Gh(l.shape,m,w);if(P||!K){var ee=j().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new dm(w):new fm(w),le=ee.getCustomSetupFunc(m);return this.compileAndRun(ee,[l],null,le)}return this.uploadToGPU(l.dataId),this.shallowSlice(l,m,w)},p.prototype.shallowSlice=function(l,m,w){var P=this.texData.get(l.dataId),K=this.makeOutput(w,l.dtype),ee=this.texData.get(K.dataId);Object.assign(ee,P),ee.shape=w,ee.dtype=l.dtype;var le=Md(m,l.strides);P.slice&&(le+=P.slice.flatOffset),ee.slice={flatOffset:le,origDataId:P.slice&&P.slice.origDataId||l.dataId};var de=this.dataRefCount.get(ee.slice.origDataId)||1;return this.dataRefCount.set(ee.slice.origDataId,de+1),K},p.prototype.stridedSlice=function(l,m,w,P){if(this.shouldExecuteOnCPU([l]))return this.cpuBackend.stridedSlice(l,m,w,P);var K=Ju(m,w,P);if(K.some(function(le){return le===0}))return No([],K);var ee=new function(le,de,Ee){this.variableNames=["x"],this.outputShape=Ee;var Te=Ee.length,Ne=Wo(Ee.length),Fe=Wo(Ee.length),qe="";if(Te===1)qe="coords * strides + begin";else{var Je=0;qe=Ee.map(function(Ke,it){return Je++,Ee.length===1?"coords * strides["+it+"] + begin["+it+"]":"coords["+(Je-1)+"] * strides["+it+"] + begin["+it+"]"}).join(",")}this.userCode=`
      `+Ne+" begin = "+Ne+"("+le+`);
      `+Ne+" strides = "+Ne+"("+de+`);

      void main() {
        `+Fe+` coords = getOutputCoords();
        setOutput(getX(`+qe+`));
      }
    `}(m,P,K);return this.compileAndRun(ee,[l])},p.prototype.reverse=function(l,m){var w=j().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(P,K){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var ee=P.length;if(ee>4)throw new Error("WebGL backend: Reverse of rank-"+ee+" tensor is not yet supported");this.outputShape=P;var le=Ca("rc",ee),de=le[ee-1]+" + 1 < "+this.outputShape[ee-1],Ee=le[ee-2]+" + 1 < "+this.outputShape[ee-2],Te=Wo(ee);function Ne(Fe){var qe=P.map(function(Je,Ke){return function(it,gt){return K.indexOf(it)!==-1&&P[it]!==1?P[it]+" - "+gt[it]+" - 1":""+gt[it]}(Ke,Fe)});return"getChannel(getX("+qe.join(",")+"), vec2("+qe.slice(-2).join(",")+"))"}this.userCode=ee===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+P[0]+` - rc - 1),
            `+P[0]+` - rc - 1);
          if(`+de+`){
              result.g = getChannel(getX(`+P[0]+` - (rc  + 1) - 1),
                `+P[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+Te+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+Ne(le.slice())+`;
          if(`+de+`){
            result.g = `+function(Fe){return Fe[ee-1]="("+Fe[ee-1]+" + 1)",Ne(Fe)}(le.slice())+`;
          }
          if(`+Ee+`) {
            result.b = `+function(Fe){return Fe[ee-2]="("+Fe[ee-2]+" + 1)",Ne(Fe)}(le.slice())+`;
            if(`+de+`) {
              result.a = `+function(Fe){return Fe[ee-1]="("+Fe[ee-1]+" + 1)",Fe[ee-2]="("+Fe[ee-2]+" + 1)",Ne(Fe)}(le.slice())+`;
            }
          }
          setOutput(result);
        }
    `}(l.shape,m):new function(P,K){this.variableNames=["x"];var ee=P.length;if(ee>4)throw new Error("WebGL backend: Reverse of rank-"+ee+" tensor is not yet supported");if(this.outputShape=P,ee!==1){var le=P.map(function(Ee,Te){return function(Ne){return K.indexOf(Ne)!==-1&&P[Ne]!==1?P[Ne]+" - coords["+Ne+"] - 1":"coords["+Ne+"]"}(Te)}).join(","),de=Wo(ee);this.userCode=`
      void main() {
        `+de+` coords = getOutputCoords();
        setOutput(getX(`+le+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+P[0]+` - coord - 1));
        }
      `}(l.shape,m);return this.compileAndRun(w,[l])},p.prototype.concat=function(l,m){if(l[0].dtype==="complex64"){var w=l.map(function(Fe){return xa(Fe)}),P=l.map(function(Fe){return Za(Fe)});return Co(this.concat(w,m),this.concat(P,m))}if(this.shouldExecuteOnCPU(l))return this.cpuBackend.concat(l,m);if(l.length===1)return l[0];if(l.length>j().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var K=Math.floor(l.length/2),ee=this.concat(l.slice(0,K),m),le=this.concat(l.slice(K),m);return this.concat([ee,le],m)}if(j().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&l[0].rank>1){var de=new function(Fe,qe){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=_u(Fe,qe);var Je=this.outputShape,Ke=Je.length,it=Wo(Ke),gt=Ca("coords",Ke),Et=["x","y","z","w","u","v"].slice(0,Ke);this.variableNames=Fe.map(function(ur,hr){return"T"+hr});var At=new Array(Fe.length-1);At[0]=Fe[0][qe];for(var Wt=1;Wt<At.length;Wt++)At[Wt]=At[Wt-1]+Fe[Wt][qe];var cn=Et[qe],pn=Et.slice(-2),ln=Et.join(),dn="if ("+cn+" < "+At[0]+`) {
        return getChannel(
            getT0(`+ln+"), vec2("+pn.join()+`));
        }`;for(Wt=1;Wt<At.length;Wt++){var Nn=At[Wt-1];dn+=`
        if (`+cn+" < "+At[Wt]+"  && "+cn+" >= "+At[Wt-1]+`) {
          return getChannel(
            getT`+Wt+"("+Ei(Et,cn,Nn)+`),
            vec2(`+Ei(pn,cn,Nn)+`));
        }`}var jn=At.length,Ln=At[At.length-1];dn+=`
        return getChannel(
          getT`+jn+"("+Ei(Et,cn,Ln)+`),
          vec2(`+Ei(pn,cn,Ln)+"));",this.userCode=`
      float getValue(`+Et.map(function(ur){return"int "+ur})+`) {
        `+dn+`
      }

      void main() {
        `+it+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+gt+`), 0., 0., 0.);

        `+gt[Ke-1]+" = "+gt[Ke-1]+` + 1;
        if (`+gt[Ke-1]+" < "+Je[Ke-1]+`) {
          result.g = getValue(`+gt+`);
        }

        `+gt[Ke-2]+" = "+gt[Ke-2]+` + 1;
        if (`+gt[Ke-2]+" < "+Je[Ke-2]+`) {
          result.a = getValue(`+gt+`);
        }

        `+gt[Ke-1]+" = "+gt[Ke-1]+` - 1;
        if (`+gt[Ke-2]+" < "+Je[Ke-2]+` &&
            `+gt[Ke-1]+" < "+Je[Ke-1]+`) {
          result.b = getValue(`+gt+`);
        }
        setOutput(result);
      }
    `}(l.map(function(Fe){return Fe.shape}),m);return this.compileAndRun(de,l)}var Ee=_u(l.map(function(Fe){return Fe.shape}),m),Te=l.map(function(Fe){return Fe.as2D(-1,ze(Fe.shape.slice(m)))}),Ne=new function(Fe){this.outputShape=[],this.outputShape=_u(Fe,1),this.variableNames=Fe.map(function(At,Wt){return"T"+Wt});var qe=new Array(Fe.length-1);qe[0]=Fe[0][1];for(var Je=1;Je<qe.length;Je++)qe[Je]=qe[Je-1]+Fe[Je][1];var Ke=["if (yC < "+qe[0]+") setOutput(getT0(yR, yC));"];for(Je=1;Je<qe.length;Je++){var it=qe[Je-1];Ke.push("else if (yC < "+qe[Je]+") setOutput(getT"+Je+"(yR, yC-"+it+"));")}var gt=qe.length,Et=qe[qe.length-1];Ke.push("else setOutput(getT"+gt+"(yR, yC-"+Et+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+Ke.join(`
        `)+`
      }
    `}(Te.map(function(Fe){return Fe.shape}));return this.compileAndRun(Ne,Te).reshape(Ee)},p.prototype.neg=function(l){if(this.shouldExecuteOnCPU([l]))return this.cpuBackend.neg(l);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(l,Vl,l.dtype);var m=new xo(l.shape,Vl);return this.compileAndRun(m,[l])},p.prototype.batchMatMul=function(l,m,w,P){var K=w?l.shape[2]:l.shape[1],ee=P?m.shape[1]:m.shape[2],le=w?l.shape[1]:l.shape[2],de=l.shape[0];if((K===1||ee===1)&&le>1e3){w&&(l=bt(l,[0,2,1])),P&&(m=bt(m,[0,2,1]));var Ee=ee===1?l:l.as3D(de,le,1),Te=ee===1?2:1,Ne=ee===1?m.as3D(de,1,le):m;return this.multiply(Ee,Ne).sum(Te,!0)}var Fe=Sn(l.dtype,m.dtype),qe=new ec(l.shape,[de,K,ee],w,P);return this.compileAndRun(qe,[l,m],Fe)},p.prototype.fusedBatchMatMul=function(l){var m=l.a,w=l.b,P=l.transposeA,K=l.transposeB,ee=l.bias,le=l.activation,de=l.preluActivationWeights,Ee=P?m.shape[2]:m.shape[1],Te=K?w.shape[1]:w.shape[2],Ne=m.shape[0],Fe=Sn(m.dtype,w.dtype),qe=ee!=null,Je=de!=null,Ke=le?Nf(le,!0):null,it=new ec(m.shape,[Ne,Ee,Te],P,K,qe,Ke,Je),gt=[m,w];return ee&&gt.push(ee),de&&gt.push(de),this.compileAndRun(it,gt,Fe)},p.prototype.multiply=function(l,m){if(l.dtype==="complex64"){var w=this.texData.get(l.dataId),P=this.texData.get(m.dataId),K=new yo("return areal * breal - aimag * bimag;",l.shape,m.shape),ee=new yo("return areal * bimag + aimag * breal;",l.shape,m.shape),le=[this.makeComplexComponentTensorInfo(l,w.complexTensors.real),this.makeComplexComponentTensorInfo(l,w.complexTensors.imag),this.makeComplexComponentTensorInfo(m,P.complexTensors.real),this.makeComplexComponentTensorInfo(m,P.complexTensors.imag)],de=this.compileAndRun(K,le),Ee=this.compileAndRun(ee,le),Te=this.complex(de,Ee);return de.dispose(),Ee.dispose(),Te}if(this.shouldExecuteOnCPU([l,m]))return this.cpuBackend.multiply(l,m);if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(l,m,pu,l.dtype);var Ne=new Yo(pu,l.shape,m.shape);return this.compileAndRun(Ne,[l,m],l.dtype)},p.prototype.batchNormalization=function(l,m,w,P,K,ee){var le=[l,m,w],de=null;ee!=null&&(de=ee.shape,le.push(ee));var Ee=null;if(K!=null&&(Ee=K.shape,le.push(K)),j().getBool("WEBGL_PACK_NORMALIZATION")){var Te=new function(Fe,qe,Je,Ke,it,gt){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Xi(Fe,qe),Xi(Fe,Je);var Et="vec4(0.0)";Ke!=null&&(Xi(Fe,Ke),this.variableNames.push("offset"),Et="getOffsetAtOutCoords()");var At="vec4(1.0)";it!=null&&(Xi(Fe,it),this.variableNames.push("scale"),At="getScaleAtOutCoords()"),this.outputShape=Fe,this.userCode=`
      void main() {
        vec4 offset = `+Et+`;
        vec4 scale = `+At+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+gt+`));

        setOutput((x - mean) * inv + offset);
      }
    `}(l.shape,m.shape,w.shape,de,Ee,P);return this.compileAndRun(Te,le)}var Ne=new function(Fe,qe,Je,Ke,it,gt){this.outputShape=[],this.variableNames=["x","mean","variance"],Xi(Fe,qe),Xi(Fe,Je);var Et="0.0";Ke!=null&&(Xi(Fe,Ke),this.variableNames.push("offset"),Et="getOffsetAtOutCoords()");var At="1.0";it!=null&&(Xi(Fe,it),this.variableNames.push("scale"),At="getScaleAtOutCoords()"),this.outputShape=Fe,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+Et+`;
        float scale = `+At+`;
        float inv = scale * inversesqrt(variance + float(`+gt+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}(l.shape,m.shape,w.shape,de,Ee,P);return this.compileAndRun(Ne,le)},p.prototype.localResponseNormalization4D=function(l,m,w,P,K){var ee=j().getBool("WEBGL_PACK_NORMALIZATION")?new function(le,de,Ee,Te,Ne){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var Fe,qe=de,Je=le[3]-1;this.outputShape=le;var Ke="float("+Ee+") + float("+Te+") * sum";Fe=Ne===.5?"inversesqrt("+Ke+")":Ne===1?"1.0/("+Ke+")":"exp(log("+Ke+") * float(-"+Ne+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+qe+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+qe+"; j <= "+qe+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+Je+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+Fe+`;
        setOutput(result);
      }
    `}(l.shape,m,w,P,K):new function(le,de,Ee,Te,Ne){this.variableNames=["x"],this.outputShape=[];var Fe,qe=de,Je=le[3]-1;this.outputShape=le;var Ke="float("+Ee+") + float("+Te+") * sum";Fe=Ne===.5?"inversesqrt("+Ke+")":Ne===1?"1.0/("+Ke+")":"exp(log("+Ke+") * float(-"+Ne+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+qe+"; j <= "+qe+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+Je+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+Fe+`;
        setOutput(val);
      }
    `}(l.shape,m,w,P,K);return this.compileAndRun(ee,[l])},p.prototype.LRNGrad=function(l,m,w,P,K,ee,le){var de=new function(Ee,Te,Ne,Fe,qe){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=Ee,this.depth=Ee[3],this.depthRadius=Te,this.bias=Ne,this.alpha=Fe,this.beta=qe,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+Te+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+Te+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+Fe+") * norm + float("+Ne+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+Fe+`)
                * float(`+qe+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+qe+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}(m.shape,P,K,ee,le);return this.compileAndRun(de,[m,w,l])},p.prototype.tile=function(l,m){if(l.dtype==="string"){var w=this.readSync(l.dataId).map(function(K){return On(K)});return Sa(Ii(l.shape,l.dtype,w),m)}var P=new function(K,ee){this.variableNames=["A"];for(var le=new Array(K.length),de=0;de<le.length;de++)le[de]=K[de]*ee[de];this.outputShape=le,this.rank=le.length;var Ee=Wo(this.rank),Te=function(Ne){var Fe=Ne.length;if(Fe>5)throw Error("Tile for rank "+Fe+" is not yet supported");if(Fe===1)return"imod(resRC, "+Ne[0]+")";for(var qe=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],Je=[],Ke=0;Ke<Ne.length;Ke++)Je.push("imod("+qe[Ke]+", "+Ne[Ke]+")");return Je.join()}(K);this.userCode=`
      void main() {
        `+Ee+` resRC = getOutputCoords();
        setOutput(getA(`+Te+`));
      }
    `}(l.shape,m);return this.compileAndRun(P,[l])},p.prototype.pad=function(l,m,w){var P=j().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(K,ee,le){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ee.map(function(cn,pn){return cn[0]+K[pn]+cn[1]});for(var de=K.length,Ee=Wo(de),Te=ee.map(function(cn){return cn[0]}).join(","),Ne=ee.map(function(cn,pn){return cn[0]+K[pn]}).join(","),Fe=Ca("rc",de),qe=Ca("source",de),Je=Fe[de-1]+" < "+this.outputShape[de-1],Ke=de===1?"source":"vec2("+qe.slice(-2).join()+")",it=[Ee+" rc = outputLoc;",Fe[de-1]+` += 1;
       if(`+Je+`) {
      `,de===1?"":`}
       rc = outputLoc;
       `+Fe[de-2]+` += 1;
       if(`+Fe[de-2]+" < "+this.outputShape[de-2]+") {",de===1?"":"  "+Fe[de-1]+` += 1;
         if(`+Je+") {"],gt=de===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",Et="",At=0,Wt=de===1?2:4;At<Wt;At++)Et+=`
        `+it[At]+`
        if (`+gt+`) {
          result[`+At+"] = float("+le+`);
        } else {
          `+Ee+` source = rc - start;
          result[`+At+"] = getChannel(getX("+qe.join()+"), "+Ke+`);
        }
      `;Et+=de===1?"} ":"}}",this.userCode=`
      const `+Ee+" start = "+Ee+"("+Te+`);
      const `+Ee+" end = "+Ee+"("+Ne+`);

      void main() {
        `+Ee+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+Et+`
        setOutput(result);
      }
    `}(l.shape,m,w):new function(K,ee,le){this.variableNames=["x"],this.outputShape=ee.map(function(qe,Je){return qe[0]+K[Je]+qe[1]});var de=K.length,Ee=Wo(de),Te=ee.map(function(qe){return qe[0]}).join(","),Ne=ee.map(function(qe,Je){return qe[0]+K[Je]}).join(","),Fe=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,de);this.userCode=de!==1?`
      `+Ee+" start = "+Ee+"("+Te+`);
      `+Ee+" end = "+Ee+"("+Ne+`);

      void main() {
        `+Ee+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+le+`));
        } else {
          `+Ee+` coords = outC - start;
          setOutput(getX(`+Fe+`));
        }
      }
    `:`
        int start = `+Te+`;
        int end = `+Ne+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+le+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}(l.shape,m,w);return this.compileAndRun(P,[l])},p.prototype.gather=function(l,m,w){if(this.shouldExecuteOnCPU([l,m]))return this.cpuBackend.gather(l,m,w);var P=new function(K,ee,le){this.variableNames=["A","indices"];var de=K.slice();de[le]=ee,this.outputShape=de,this.rank=de.length;var Ee=Wo(this.rank),Te=function(Ne,Fe){var qe=Ne.length;if(qe>4)throw Error("Gather for rank "+qe+" is not yet supported");if(qe===1)return"int(getIndices(resRC))";for(var Je=["resRC.x","resRC.y","resRC.z","resRC.w"],Ke=[],it=0;it<Ne.length;it++)it===Fe?Ke.push("int(getIndices("+Je[it]+"))"):Ke.push(""+Je[it]);return Ke.join()}(K,le);this.userCode=`
      void main() {
        `+Ee+` resRC = getOutputCoords();
        setOutput(getA(`+Te+`));
      }
    `}(l.shape,m.size,w);return this.compileAndRun(P,[l,m])},p.prototype.batchToSpaceND=function(l,m,w){we(l.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var P=m.reduce(function(Te,Ne){return Te*Ne}),K=_d(l.shape,m,P),ee=Il(K.length,m.length),le=vf(l.shape,m,P),de=em(w,m.length),Ee=rg(le,w,m.length);return bt(l.reshape(K),ee).reshape(le).slice(de,Ee)},p.prototype.spaceToBatchND=function(l,m,w){we(l.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var P=m.reduce(function(Ne,Fe){return Ne*Fe}),K=[[0,0]];K.push.apply(K,w);for(var ee=1+m.length;ee<l.shape.length;++ee)K.push([0,0]);var le=l.pad(K),de=_d(le.shape,m,P,!1),Ee=Il(de.length,m.length,!1),Te=vf(le.shape,m,P,!1);return bt(le.reshape(de),Ee).reshape(Te)},p.prototype.reduce=function(l,m,w){var P=l.shape[0],K=l.shape[1],ee=new function(de,Ee){this.variableNames=["x"];var Te=de.windowSize,Ne=de.batchSize,Fe=de.inSize,qe=Math.ceil(Fe/Te);this.outputShape=[Ne,qe];var Je="0.0",Ke="";Ee==="prod"?Je="1.0":Ee==="min"?(Je="1.0 / 1e-20",Ke="min"):Ee==="max"&&(Je="-1.0 / 1e-20",Ke="max");var it=Ee+"("+Ee+"("+Ee+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";Ee==="sum"?it="sumValue":Ee==="prod"?it="prodValue":Ee==="all"?it="allValue":Ee==="any"&&(it="anyValue");var gt=4*Math.floor(Te/4),Et=Te%4,At=`
      if (`+(Ee==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(Ee==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+Ke+`(values, minMaxValue);
      }
    `,Wt="vec4";Ee==="all"?(Je="1.0",At=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,Wt="bvec4"):Ee==="any"&&(Je="0.0",At=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,Wt="bvec4");var cn="";Fe%Te>0&&(cn=`
        if (inIdx < 0 || inIdx >= `+Fe+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+Je+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+cn+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+Te+`;

        vec4 minMaxValue = vec4(`+Je+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+gt+`; i += 4) {
          int inIdx = inOffset + i;
          `+Wt+" values = "+Wt+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+At+`
        }

        int inIdx = inOffset + `+gt+`;
        if (`+(Et===1)+`) {
          `+Wt+" values = "+Wt+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+At+`
        } else if (`+(Et===2)+`) {
          `+Wt+" values = "+Wt+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+At+`
        } else if (`+(Et===3)+`) {
          `+Wt+" values = "+Wt+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+At+`
        }
        setOutput(`+it+`);
      }
    `}({windowSize:Bc(K),inSize:K,batchSize:P},m),le=this.compileAndRun(ee,[l],w);return le.shape[1]===1?le:this.reduce(le,m,w)},p.prototype.argReduce=function(l,m,w){w===void 0&&(w=null);var P=l.shape[0],K=l.shape[1];w!=null&&(P=w.shape[0],K=w.shape[1]);var ee=new function(Ee,Te,Ne){this.variableNames=["A"];var Fe=Ee.windowSize,qe=Ee.batchSize,Je=Ee.inSize,Ke=Math.ceil(Je/Fe);Ne||this.variableNames.push("bestIndicesA"),this.outputShape=[qe,Ke];var it=Te==="max"?">":"<",gt=Ne?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+Fe+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+Fe+`; i++) {
          int inIdx = `+gt+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+it+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}({windowSize:Bc(K),inSize:K,batchSize:P},m,w==null),le=[l];w!=null&&le.push(w);var de=this.compileAndRun(ee,le,"int32");return de.shape[1]===1?de:this.argReduce(l,m,de)},p.prototype.argReducePacked=function(l,m,w){w===void 0&&(w=null);var P=w!=null?w.shape:l.shape,K=new function(de,Ee,Te,Ne){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,we(de.length>2,function(){return"Packed arg"+(Te.charAt(0).toUpperCase()+Te.slice(1))+" supports only inputs with rank above 2."});var Fe=de[de.length-1],qe=Math.ceil(Fe/Ee);this.outputShape=de.slice(0,-1),qe>1&&this.outputShape.push(qe),Ne||this.variableNames.push("bestIndicesA");var Je,Ke,it=this.outputShape,gt=it.length,Et=Wo(gt),At=Ca("coords",gt);if(qe===1){var Wt=Wo(Ke=gt+1);Je=`
        `+Wt+" sourceLocR = "+Wt+"("+At.join()+`, 0);
        ++`+At[gt-1]+`;
        `+Wt+" sourceLocG = "+Wt+"("+At.join()+`, 0);
        ++`+At[gt-2]+`;
        `+Wt+" sourceLocA = "+Wt+"("+At.join()+`, 0);
        --`+At[gt-1]+`;
        `+Wt+" sourceLocB = "+Wt+"("+At.join()+`, 0);
        --`+At[gt-2]+";"}else Ke=gt,Je=`
        `+Et+` sourceLocR = coords;
        ++`+At[gt-1]+`;
        `+Et+` sourceLocG = coords;
        ++`+At[gt-2]+`;
        `+Et+` sourceLocA = coords;
        --`+At[gt-1]+`;
        `+Et+` sourceLocB = coords;
        --`+At[gt-2]+";";var cn=["x","y","z","w","u","v"].slice(0,Ke),pn="."+cn[Ke-1],ln=cn.map(function(wr){return"int "+wr}),dn=Ca("sourceLocR",Ke-1).concat("inIdx.r"),Nn=Ca("sourceLocG",Ke-1).concat("inIdx.g"),jn=Ca("sourceLocB",Ke-1).concat("inIdx.b"),Ln=Ca("sourceLocA",Ke-1).concat("inIdx.a"),ur=Te==="max"?"greaterThan":"lessThan",hr=Ne?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+dn.join()+`),
                             getBestIndicesAChannel(`+Nn.join()+`),
                             getBestIndicesAChannel(`+jn.join()+`),
                             getBestIndicesAChannel(`+Ln.join()+")));",xr=`vec4(
            getAChannel(`+dn.join()+`),
            hasNextCol ? getAChannel(`+Nn.join()+`) : 0.,
            hasNextRow ? getAChannel(`+jn.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+Ln.join()+") : 0.)",Er=Ne?"":`
      float getBestIndicesAChannel(`+ln.join()+`) {
        return getChannel(getBestIndicesA(`+cn.join()+`),
                                          vec2(`+cn.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+ln.join()+`) {
        return getChannel(getA(`+cn.join()+`),
                               vec2(`+cn.slice(-2).join()+`));
      }
      `+Er+`
      void main() {
        `+Et+` coords = getOutputCoords();
        bool hasNextCol = `+At[gt-1]+" < "+(it[gt-1]-1)+`;
        bool hasNextRow = `+At[gt-2]+" < "+(it[gt-2]-1)+`;
        `+Je+`
        ivec4 srcIdx = ivec4(sourceLocR`+pn+", sourceLocG"+pn+`,
          sourceLocB`+pn+", sourceLocA"+pn+") * "+Ee+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+xr+`;

        for (int i = 0; i < `+Ee+`; i++) {
          inIdx = srcIdx;
          `+hr+`
          vec4 candidate = `+xr+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+ur+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}(P,Bc(P[P.length-1]),m,w==null),ee=w==null?[l]:[l,w],le=this.compileAndRun(K,ee,"int32");return le.rank===l.rank?this.argReducePacked(l,m,le):le},p.prototype.sum=function(l,m){ia("sum",m,l.rank);var w=Po(l.shape,m),P=w[0],K=ze(w[1]),ee=l.as2D(-1,K),le=Rt(l.dtype);return this.reduce(ee,"sum",le).reshape(P)},p.prototype.prod=function(l,m){if(this.shouldExecuteOnCPU([l]))return this.cpuBackend.prod(l,m);var w=Po(l.shape,m),P=w[0],K=ze(w[1]),ee=l.as2D(-1,K),le=Rt(l.dtype);return this.reduce(ee,"prod",le).reshape(P)},p.prototype.unsortedSegmentSum=function(l,m,w){var P=0,K=Ba([P],l.rank),ee=l;K!=null&&(ee=bt(l,K),P=ja(1,l.rank)[0]);var le=function(Fe,qe,Je){for(var Ke=[],it=Fe.length,gt=0;gt<it;gt++)gt!==qe?Ke.push(Fe[gt]):Ke.push(Je);return Ke}(ee.shape,P,w),de=ze([ee.shape[P]]),Ee=ee.as2D(-1,de),Te=Rt(l.dtype),Ne=this.segOpCompute(Ee,"unsortedSegmentSum",m,Te,w).reshape(le);return K!=null&&(Ne=bt(Ne,$u(K))),Ne},p.prototype.segOpCompute=function(l,m,w,P,K){var ee=l.shape[0],le=l.shape[1],de=function(Ne,Fe){var qe,Je=!1;for(Ne<=yc?(qe=Ne,Je=!0):qe=Mr(Ne,Math.floor(Math.sqrt(Ne)));!Je;)qe>Fe||qe===Ne?Je=!0:qe=Mr(Ne,qe+1);return qe}(le,K),Ee=new function(Ne,Fe){this.variableNames=["x","segmentIds"];var qe=Ne.windowSize,Je=Ne.batchSize,Ke=Ne.inSize,it=Ne.numSegments,gt=it*Math.ceil(Ke/qe);this.outputShape=[Je,gt];var Et=4*Math.floor(qe/4),At=qe%4,Wt=`
        sumValue += dot(values, segFilter);
    `,cn="";Ke%qe>0&&(cn=`
        if (inIdx < 0 || inIdx >= `+Ke+`) {
          return initializationValue;
        }
      `);var pn="";Ke%qe>0&&(pn=`
        if (inIdx < 0 || inIdx >= `+Ke+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+cn+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+pn+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+it+")) * float("+qe+`));
        int currentSeg = int(mod(float(outIdx), float(`+it+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+Et+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+Wt+`
        }

        int inIdx = inOffset + `+Et+`;
        if (`+(At===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+Wt+`
        } else if (`+(At===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+Wt+`
        } else if (`+(At===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+Wt+`
        }
        setOutput(sumValue);
      }
    `}({windowSize:de,inSize:le,batchSize:ee,numSegments:K}),Te=this.compileAndRun(Ee,[l,w],P);return Te.shape[1]===K?Te:(w=Rc(0,K).tile([le/de]),this.segOpCompute(Te,m,w,P,K))},p.prototype.argMinMaxReduce=function(l,m,w){var P=[m];if(ia("arg"+w.charAt(0).toUpperCase()+w.slice(1),P,l.rank),!j().getBool("WEBGL_PACK_REDUCE")||l.rank<=2){var K=Po(l.shape,P),ee=K[0],le=ze(K[1]),de=l.as2D(-1,le);return this.argReduce(de,w).reshape(ee)}return this.argReducePacked(l,w)},p.prototype.argMin=function(l,m){return this.argMinMaxReduce(l,m,"min")},p.prototype.argMax=function(l,m){return this.argMinMaxReduce(l,m,"max")},p.prototype.cumsum=function(l,m,w,P){if(m!==l.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(l.rank-1)+" but got axis="+m);var K=new function(ee,le,de){this.variableNames=["x"],this.outputShape=ee;var Ee=ee.length,Te=ee[ee.length-1],Ne=de?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(de?"return "+Te+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Wo(Ee)+` coords = getOutputCoords();
        int end = `+uv(Ee,"coords")+`;
        float val = 0.0;
        for (int i = `+Te+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+Ne+` end) {
            continue;
          }
          if (idx == end && `+le+`) {
            continue;
          }
          `+uv(Ee,"coords")+` = idx;
          val += getX(`+function(Fe,qe){if(Fe===1)return""+qe;if(Fe===2)return qe+".x, "+qe+".y";if(Fe===3)return qe+".x, "+qe+".y, "+qe+".z";if(Fe===4)return qe+".x, "+qe+".y, "+qe+".z, "+qe+".w";throw Error("Cumulative sum for rank "+Fe+" is not yet supported")}(Ee,"coords")+`);
        }
        setOutput(val);
      }
    `}(l.shape,w,P);return this.compileAndRun(K,[l])},p.prototype.equal=function(l,m){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(l,m,`
  return vec4(equal(a, b));
`,"bool");var w=new Yo("return float(a == b);",l.shape,m.shape);return this.compileAndRun(w,[l,m],"bool")},p.prototype.notEqual=function(l,m){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(l,m,`
  return vec4(notEqual(a, b));
`,"bool");var w=new Yo("return float(a != b);",l.shape,m.shape);return this.compileAndRun(w,[l,m],"bool")},p.prototype.less=function(l,m){if(this.shouldExecuteOnCPU([l,m]))return this.cpuBackend.less(l,m);if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(l,m,`
  return vec4(lessThan(a, b));
`,"bool");var w=new Yo("return float(a < b);",l.shape,m.shape);return this.compileAndRun(w,[l,m],"bool")},p.prototype.lessEqual=function(l,m){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(l,m,`
  return vec4(lessThanEqual(a, b));
`,"bool");var w=new Yo("return float(a <= b);",l.shape,m.shape);return this.compileAndRun(w,[l,m],"bool")},p.prototype.greater=function(l,m){if(this.shouldExecuteOnCPU([l,m]))return this.cpuBackend.greater(l,m);if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(l,m,`
  return vec4(greaterThan(a, b));
`,"bool");var w=new Yo("return float(a > b);",l.shape,m.shape);return this.compileAndRun(w,[l,m],"bool")},p.prototype.greaterEqual=function(l,m){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(l,m,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var w=new Yo("return float(a >= b);",l.shape,m.shape);return this.compileAndRun(w,[l,m],"bool")},p.prototype.logicalNot=function(l){var m=new xo(l.shape,"return float(!(x >= 1.0));");return this.compileAndRun(m,[l])},p.prototype.logicalAnd=function(l,m){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(l,m,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var w=new Yo("return float(a >= 1.0 && b >= 1.0);",l.shape,m.shape);return this.compileAndRun(w,[l,m],"bool")},p.prototype.logicalOr=function(l,m){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(l,m,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var w=new Yo("return float(a >= 1.0 || b >= 1.0);",l.shape,m.shape);return this.compileAndRun(w,[l,m],"bool")},p.prototype.select=function(l,m,w){var P=new function(K,ee,le){var de,Ee;if(this.variableNames=["c","a","b"],this.outputShape=ee,le>4)throw Error("Where for rank "+le+" is not yet supported");if(le===1)Ee="resRC",de="resRC";else{for(var Te=["resRC.x","resRC.y","resRC.z","resRC.w"],Ne=[],Fe=[],qe=0;qe<ee.length;qe++)Fe.push(""+Te[qe]),qe<K&&Ne.push(""+Te[qe]);de=Ne.join(),Ee=Fe.join()}var Je=Wo(le);this.userCode=`
      void main() {
        `+Je+` resRC = getOutputCoords();
        float cVal = getC(`+de+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+Ee+`));
        } else {
          setOutput(getB(`+Ee+`));
        }
      }
    `}(l.rank,m.shape,m.rank);return this.compileAndRun(P,[l,m,w],Sn(m.dtype,w.dtype))},p.prototype.where=function(l){Ml("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var m=l.dataSync();return ua(l.shape,m)},p.prototype.topk=function(l,m,w){return ga(l.dataSync(),l.shape,l.dtype,m)},p.prototype.min=function(l,m){ia("min",m,l.rank);var w=Po(l.shape,m),P=w[0],K=ze(w[1]),ee=l.as2D(-1,K);return this.reduce(ee,"min",ee.dtype).reshape(P)},p.prototype.minimum=function(l,m){if(this.shouldExecuteOnCPU([l,m]))return this.cpuBackend.minimum(l,m);var w=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xa(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,l.shape,m.shape):new Yo(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,l.shape,m.shape);return this.compileAndRun(w,[l,m])},p.prototype.mod=function(l,m){var w=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xa(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,l.shape,m.shape):new Yo(`if (b == 0.0) return NAN;
  return mod(a, b);`,l.shape,m.shape);return this.compileAndRun(w,[l,m])},p.prototype.max=function(l,m){if(this.shouldExecuteOnCPU([l]))return this.cpuBackend.max(l,m);ia("max",m,l.rank);var w=Po(l.shape,m),P=w[0],K=ze(w[1]),ee=l.as2D(-1,K);return this.reduce(ee,"max",ee.dtype).reshape(P)},p.prototype.maximum=function(l,m){if(this.shouldExecuteOnCPU([l,m]))return this.cpuBackend.maximum(l,m);var w=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xa(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,l.shape,m.shape):new Yo(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,l.shape,m.shape);return this.compileAndRun(w,[l,m])},p.prototype.all=function(l,m){ia("all",m,l.rank);var w=Po(l.shape,m),P=w[0],K=ze(w[1]),ee=l.as2D(-1,K);return this.reduce(ee,"all",ee.dtype).reshape(P)},p.prototype.any=function(l,m){ia("any",m,l.rank);var w=Po(l.shape,m),P=w[0],K=ze(w[1]),ee=l.as2D(-1,K);return this.reduce(ee,"any",ee.dtype).reshape(P)},p.prototype.floorDiv=function(l,m){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(l,m,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var w=new Yo(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,l.shape,m.shape);return this.compileAndRun(w,[l,m],"int32")},p.prototype.add=function(l,m){if(l.dtype==="complex64"&&m.dtype==="complex64")return this.complexSeparableBinaryOp(l,m,Us);if(this.shouldExecuteOnCPU([l,m]))return this.cpuBackend.add(l,m);var w=Sn(l.dtype,m.dtype);if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(l,m,Us,w);var P=new Yo(Us,l.shape,m.shape);return this.compileAndRun(P,[l,m],w)},p.prototype.packedUnaryOp=function(l,m,w){var P=new Mf(l.shape,m);return this.compileAndRun(P,[l],w)},p.prototype.packedBinaryOp=function(l,m,w,P,K){K===void 0&&(K=!1);var ee=new Xa(w,l.shape,m.shape,K);return this.compileAndRun(ee,[l,m],P)},p.prototype.complexSeparableBinaryOp=function(l,m,w){var P=this,K=this.texData.get(l.dataId),ee=this.texData.get(m.dataId),le=[[K.complexTensors.real,ee.complexTensors.real],[K.complexTensors.imag,ee.complexTensors.imag]].map(function(Ne){var Fe=Ne[0],qe=Ne[1],Je=P.makeComplexComponentTensorInfo(l,Fe),Ke=P.makeComplexComponentTensorInfo(m,qe),it=new Yo(w,l.shape,m.shape);return P.compileAndRun(it,[Je,Ke],Sn(Fe.dtype,qe.dtype))}),de=le[0],Ee=le[1],Te=this.complex(de,Ee);return de.dispose(),Ee.dispose(),Te},p.prototype.makeComplexComponentTensorInfo=function(l,m){return{dataId:m.dataId,dtype:m.dtype,shape:l.shape}},p.prototype.addN=function(l){if(l.length===1)return l[0];if(l.length>j().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var m=Math.floor(l.length/2),w=this.addN(l.slice(0,m)),P=this.addN(l.slice(m));return this.addN([w,P])}var K=l.map(function(de){return de.dtype}).reduce(function(de,Ee){return Sn(de,Ee)}),ee=l.map(function(de){return de.shape}),le=j().getBool("WEBGL_PACK")?new function(de,Ee){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=de,this.variableNames=Ee.map(function(Fe,qe){return"T"+qe});var Te=[];this.variableNames.forEach(function(Fe){Te.push("vec4 v"+Fe+" = get"+Fe+"AtOutCoords();")});var Ne=this.variableNames.map(function(Fe){return"v"+Fe}).join(" + ");this.userCode=`
      void main() {
        `+Te.join(`
        `)+`

        vec4 result = `+Ne+`;
        setOutput(result);
      }
    `}(l[0].shape,ee):new function(de,Ee){this.outputShape=[],this.outputShape=de,this.variableNames=Ee.map(function(Fe,qe){return"T"+qe});var Te=[];this.variableNames.forEach(function(Fe){Te.push("float v"+Fe+" = get"+Fe+"AtOutCoords();")});var Ne=this.variableNames.map(function(Fe){return"v"+Fe}).join(" + ");this.userCode=`
      void main() {
        `+Te.join(`
        `)+`

        float result = `+Ne+`;
        setOutput(result);
      }
    `}(l[0].shape,ee);return this.compileAndRun(le,l,K)},p.prototype.subtract=function(l,m){if(l.dtype==="complex64"&&m.dtype==="complex64")return this.complexSeparableBinaryOp(l,m,os);if(this.shouldExecuteOnCPU([l,m]))return this.cpuBackend.subtract(l,m);var w=Sn(l.dtype,m.dtype);if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(l,m,os,l.dtype);var P=new Yo(os,l.shape,m.shape);return this.compileAndRun(P,[l,m],w)},p.prototype.pow=function(l,m){var w=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xa(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,l.shape,m.shape):new Yo(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,l.shape,m.shape),P=Sn(l.dtype,m.dtype);return this.compileAndRun(w,[l,m],P)},p.prototype.ceil=function(l){if(this.shouldExecuteOnCPU([l]))return this.cpuBackend.ceil(l);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(l,xv,l.dtype);var m=new xo(l.shape,xv);return this.compileAndRun(m,[l])},p.prototype.floor=function(l){if(this.shouldExecuteOnCPU([l]))return this.cpuBackend.floor(l);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(l,wv,l.dtype);var m=new xo(l.shape,wv);return this.compileAndRun(m,[l])},p.prototype.sign=function(l){var m=new xo(l.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(m,[l])},p.prototype.isNaN=function(l){var m=new xo(l.shape,"return float(isnan(x));");return this.compileAndRun(m,[l],"bool")},p.prototype.isInf=function(l){var m=new xo(l.shape,"return float(isinf(x));");return this.compileAndRun(m,[l],"bool")},p.prototype.isFinite=function(l){var m=new xo(l.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(m,[l],"bool")},p.prototype.round=function(l){var m=new xo(l.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(m,[l])},p.prototype.exp=function(l){if(this.shouldExecuteOnCPU([l]))return this.cpuBackend.exp(l);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(l,Xh,l.dtype);var m=new xo(l.shape,Xh);return this.compileAndRun(m,[l])},p.prototype.expm1=function(l){if(this.shouldExecuteOnCPU([l]))return this.cpuBackend.expm1(l);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(l,Pd,l.dtype);var m=new xo(l.shape,Pd);return this.compileAndRun(m,[l])},p.prototype.softmax=function(l,m){var w=Xt([m],l.shape),P=this.max(l,w),K=Lo(P.shape,w),ee=this.subtract(l,P.reshape(K)),le=this.exp(ee),de=this.sum(le,w).reshape(K);return aa(le,de)},p.prototype.log=function(l){if(this.shouldExecuteOnCPU([l]))return this.cpuBackend.log(l);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(l,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,l.dtype);var m=new xo(l.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(m,[l])},p.prototype.log1p=function(l){var m=new xo(l.shape,"return log(1.0 + x);");return this.compileAndRun(m,[l])},p.prototype.sqrt=function(l){var m=new xo(l.shape,"return sqrt(x);");return this.compileAndRun(m,[l])},p.prototype.rsqrt=function(l){if(this.shouldExecuteOnCPU([l]))return this.cpuBackend.rsqrt(l);var m=new xo(l.shape,"return inversesqrt(x);");return this.compileAndRun(m,[l])},p.prototype.reciprocal=function(l){var m=new xo(l.shape,"return 1.0 / x;");return this.compileAndRun(m,[l])},p.prototype.relu=function(l){var m;return m=j().getBool("WEBGL_PACK")?new Mf(l.shape,ag):new xo(l.shape,bv),this.compileAndRun(m,[l])},p.prototype.relu6=function(l){var m;return m=j().getBool("WEBGL_PACK")?new Mf(l.shape,Hl):new xo(l.shape,hm),this.compileAndRun(m,[l])},p.prototype.prelu=function(l,m){var w=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xa(hs,l.shape,m.shape):new Yo(ul,l.shape,m.shape);return this.compileAndRun(w,[l,m])},p.prototype.elu=function(l){if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(l,tc,l.dtype);var m=new xo(l.shape,Wl);return this.compileAndRun(m,[l])},p.prototype.eluDer=function(l,m){var w=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xa(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,l.shape,m.shape):new Yo("return (b >= 1.0) ? a : a * (b + 1.0);",l.shape,m.shape);return this.compileAndRun(w,[l,m])},p.prototype.selu=function(l){var m=new xo(l.shape,`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = 1.7580993408473768;
  float scale = 1.0507009873554805;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`);return this.compileAndRun(m,[l])},p.prototype.int=function(l){var m=new xo(l.shape,"return float(int(x));");return this.compileAndRun(m,[l],"int32")},p.prototype.clip=function(l,m,w){var P,K=(P=j().getBool("WEBGL_PACK_CLIP")?new zl(l.shape):new zc(l.shape)).getCustomSetupFunc(m,w);return this.compileAndRun(P,[l],null,K)},p.prototype.abs=function(l){if(this.shouldExecuteOnCPU([l]))return this.cpuBackend.abs(l);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(l,og,l.dtype);var m=new xo(l.shape,og);return this.compileAndRun(m,[l])},p.prototype.complexAbs=function(l){var m=this.texData.get(l.dataId),w=new function(K){this.variableNames=["real","imag"],this.outputShape=K,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}(l.shape),P=[this.makeComplexComponentTensorInfo(l,m.complexTensors.real),this.makeComplexComponentTensorInfo(l,m.complexTensors.imag)];return this.compileAndRun(w,P)},p.prototype.sigmoid=function(l){var m=new xo(l.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(m,[l])},p.prototype.softplus=function(l){var m=new xo(l.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(m,[l])},p.prototype.sin=function(l){var m=new xo(l.shape,`if (isnan(x)) return x;
  return sin(x);
`);return this.compileAndRun(m,[l])},p.prototype.cos=function(l){var m=new xo(l.shape,`if (isnan(x)) return x;
  return cos(x);
`);return this.compileAndRun(m,[l])},p.prototype.tan=function(l){var m=new xo(l.shape,"return tan(x);");return this.compileAndRun(m,[l])},p.prototype.asin=function(l){var m=new xo(l.shape,`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`);return this.compileAndRun(m,[l])},p.prototype.acos=function(l){var m=new xo(l.shape,`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`);return this.compileAndRun(m,[l])},p.prototype.atan=function(l){var m=new xo(l.shape,`if (isnan(x)) return x;
  return atan(x);
`);return this.compileAndRun(m,[l])},p.prototype.atan2=function(l,m){var w=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xa(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,l.shape,m.shape):new Yo(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,l.shape,m.shape);return this.compileAndRun(w,[l,m])},p.prototype.sinh=function(l){var m=new xo(l.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(m,[l])},p.prototype.cosh=function(l){var m=new xo(l.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(m,[l])},p.prototype.tanh=function(l){var m=new xo(l.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(m,[l])},p.prototype.asinh=function(l){var m=new xo(l.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(m,[l])},p.prototype.acosh=function(l){var m=new xo(l.shape,`if (isnan(x)) return x;
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`);return this.compileAndRun(m,[l])},p.prototype.atanh=function(l){var m=new xo(l.shape,`if (isnan(x)) return x;
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`);return this.compileAndRun(m,[l])},p.prototype.erf=function(l){var m=new xo(l.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(m,[l])},p.prototype.step=function(l,m){var w=new xo(l.shape,function(P){return P===void 0&&(P=0),vv+`
    return x > 0.0 ? 1.0 : float(`+P+`);
  `}(m));return this.compileAndRun(w,[l])},p.prototype.conv2dByMatMul=function(l,m,w,P,K,ee){var le=l.shape,de=this.texData.get(l.dataId),Ee=w.inChannels,Te=le[0]*le[1]*le[2],Ne=w.outChannels,Fe=w.dataFormat==="channelsLast",qe=(Te===1||Ne===1)&&Ee>1e3,Je=le[2]%2!=0&&!!de.isPacked;if(qe||!j().getBool("WEBGL_LAZILY_UNPACK")||!j().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!Je){var Ke=Fe?le[0]*le[1]*le[2]:le[0]*le[2]*le[3],it=this.reshape(l,[1,Ke,w.inChannels]),gt=this.reshape(m,[1,w.inChannels,w.outChannels]);return this.reshape(this.fusedBatchMatMul({a:it,b:gt,transposeA:!1,transposeB:!1,bias:P,activation:K,preluActivationWeights:ee}),w.outShape)}var Et=Fe?le[0]*le[1]*(le[2]+1):le[0]*le[2]*(le[3]+1),At={dataId:l.dataId,shape:[1,Et,w.inChannels],dtype:l.dtype},Wt=de.shape;de.shape=de.shape.slice(),de.shape[de.shape.length-2]++,we(Iu(de.shape,At.shape),function(){return"packed reshape "+de.shape+" to "+At.shape+" isn't free"});var cn=this.reshape(m,[1,w.inChannels,w.outChannels]),pn=this.fusedBatchMatMul({a:At,b:cn,transposeA:!1,transposeB:!1,bias:P,activation:K,preluActivationWeights:ee}),ln=this.texData.get(pn.dataId);return we(ln.isPacked,function(){return"batchMatMul result is expected to be packed"}),de.shape=Wt,ln.shape=w.outShape,He.makeTensorFromDataId(pn.dataId,w.outShape,pn.dtype)},p.prototype.conv2dWithIm2Row=function(l,m,w,P,K,ee){var le=w.filterWidth,de=w.filterHeight,Ee=w.inChannels,Te=w.outWidth,Ne=w.outHeight,Fe=w.dataFormat==="channelsLast",qe=le*de*Ee,Je=Ne*Te,Ke=[qe,Je],it=l.squeeze([0]),gt=m.reshape([1,qe,-1]),Et=new function(jn,Ln,ur){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=jn;for(var hr=ur.filterWidth,xr=ur.inChannels,Er=ur.strideWidth,wr=ur.strideHeight,vr=ur.padInfo,Lr=ur.outWidth,Pr=ur.dilationWidth,ei=ur.dilationHeight,hi=ur.dataFormat,Oi=vr.left,wo=vr.top,_o=xr*hr,Io=Oo(),Do=hi==="channelsLast",qo=Do?0:1,fa=Do?1:2,Ya="",co=0;co<=1;co++)for(var Fo=0;Fo<=1;Fo++)Ya+=`
          blockIndex = rc.y + `+Fo+`;
          pos = rc.x + `+co+`;

          if(blockIndex < `+jn[1]+" && pos < "+jn[0]+`) {
            offsetY = int(blockIndex / (`+Lr+")) * "+wr+" - "+wo+`;
            d0 = offsetY + `+ei+" * (pos / "+_o+`);

            if(d0 < `+Ln[qo]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+Lr+".) * "+Er+". - "+Oi+`.);
              d1 = offsetX + `+Pr+" * (int(mod(float(pos), "+_o+".) / "+xr+`.));

              if(d1 < `+Ln[fa]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+xr+`.));

                if (`+Do+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*co+Fo)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*co+Fo)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+Ya+`

        `+Io.output+` = result;
      }
    `}(Ke,it.shape,w),At=this.compileAndRun(Et,[it]).reshape([1,Ke[0],Ke[1]]),Wt=P!=null,cn=ee!=null,pn=K?Nf(K,!0):null,ln=new ec(At.shape,[1,Je,w.outChannels],!0,!1,Wt,pn,cn),dn=[At,gt];P&&dn.push(P),cn&&dn.push(ee);var Nn=this.compileAndRun(ln,dn);return Fe?Nn.reshape([1,Ne,Te,w.outChannels]):Nn.reshape([1,w.outChannels,Ne,Te])},p.prototype.fusedConv2d=function(l){var m=l.input,w=l.filter,P=l.convInfo,K=l.bias,ee=l.activation,le=l.preluActivationWeights;if(P.filterHeight===1&&P.filterWidth===1&&P.dilationHeight===1&&P.dilationWidth===1&&P.strideHeight===1&&P.strideWidth===1&&(P.padInfo.type==="SAME"||P.padInfo.type==="VALID"))return this.conv2dByMatMul(m,w,P,K,ee,le);if(j().getBool("WEBGL_CONV_IM2COL")&&m.shape[0]===1)return this.conv2dWithIm2Row(m,w,P,K,ee,le);var de=K!=null,Ee=le!=null,Te=ee?Nf(ee,!1):null,Ne=new sm(P,de,Te,Ee),Fe=[m,w];return K&&Fe.push(K),le&&Fe.push(le),this.compileAndRun(Ne,Fe)},p.prototype.conv2d=function(l,m,w){if(w.filterHeight===1&&w.filterWidth===1&&w.dilationHeight===1&&w.dilationWidth===1&&w.strideHeight===1&&w.strideWidth===1&&(w.padInfo.type==="SAME"||w.padInfo.type==="VALID"))return this.conv2dByMatMul(l,m,w);if(j().getBool("WEBGL_CONV_IM2COL")&&l.shape[0]===1)return this.conv2dWithIm2Row(l,m,w);var P=new sm(w);return this.compileAndRun(P,[l,m])},p.prototype.conv2dDerInput=function(l,m,w){var P=new function(K){this.variableNames=["dy","W"],this.outputShape=K.inShape;var ee=K.filterHeight,le=K.filterWidth,de=K.strideHeight,Ee=K.strideWidth,Te=K.dataFormat==="channelsLast",Ne=ee-1-K.padInfo.top,Fe=le-1-K.padInfo.left,qe=Te?1:2,Je=Te?2:3,Ke=Te?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+Ne+", "+Fe+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+Ke+`];

        ivec2 dyCorner = ivec2(coords[`+qe+"], coords["+Je+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+ee+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+de+`.0;

          if (dyR < 0.0 || dyR >= `+K.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+ee+` - 1 - wR;

          for (int wC = 0; wC < `+le+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+Ee+`.0;

            if (dyC < 0.0 || dyC >= `+K.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+le+` - 1 - wC;

            for (int d2 = 0; d2 < `+K.outChannels+`; d2++) {

              if (`+Te+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}(w);return this.compileAndRun(P,[l,m])},p.prototype.conv2dDerFilter=function(l,m,w){var P=new function(K){this.variableNames=["x","dy"],this.outputShape=K.filterShape;var ee=K.strideHeight,le=K.strideWidth,de=K.padInfo.top,Ee=K.padInfo.left,Te=K.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+K.batchSize+`; b++) {
          for (int yR = 0; yR < `+K.outHeight+`; yR++) {
            int xR = wR + yR * `+ee+" - "+de+`;

            if (xR < 0 || xR >= `+K.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+K.outWidth+`; yC++) {
              int xC = wC + yC * `+le+" - "+Ee+`;

              if (xC < 0 || xC >= `+K.inWidth+`) {
                continue;
              }

              if (`+Te+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}(w);return this.compileAndRun(P,[l,m])},p.prototype.fusedDepthwiseConv2D=function(l){var m,w=l.input,P=l.filter,K=l.convInfo,ee=l.bias,le=l.activation,de=l.preluActivationWeights,Ee=j().getBool("WEBGL_PACK_DEPTHWISECONV")&&K.strideWidth<=2&&K.outChannels/K.inChannels==1,Te=le?Nf(le,Ee):null,Ne=[w,P],Fe=ee!=null,qe=de!=null;return Fe&&Ne.push(ee),qe&&Ne.push(de),Ee?(m=new Tf(K,Fe,Te,qe),this.compileAndRun(m,Ne)):(m=new Ul(K,Fe,Te,qe),this.compileAndRun(m,Ne))},p.prototype.depthwiseConv2D=function(l,m,w){var P;return j().getBool("WEBGL_PACK_DEPTHWISECONV")&&w.strideWidth<=2&&w.outChannels/w.inChannels==1?(P=new Tf(w),this.compileAndRun(P,[l,m])):(P=new Ul(w),this.compileAndRun(P,[l,m]))},p.prototype.depthwiseConv2DDerInput=function(l,m,w){var P=new function(K){this.variableNames=["dy","W"],this.outputShape=K.inShape;var ee=K.filterHeight,le=K.filterWidth,de=K.strideHeight,Ee=K.strideWidth,Te=ee-1-K.padInfo.top,Ne=le-1-K.padInfo.left,Fe=K.outChannels/K.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+Te+", "+Ne+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+ee+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+de+`.0;

          if (dyR < 0.0 || dyR >= `+K.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+ee+` - 1 - wR;

          for (int wC = 0; wC < `+le+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+Ee+`.0;

            if (dyC < 0.0 || dyC >= `+K.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+le+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+Fe+`; dm++) {
              int d2 = d1 * `+Fe+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(w);return this.compileAndRun(P,[l,m])},p.prototype.depthwiseConv2DDerFilter=function(l,m,w){var P=new function(K){this.variableNames=["x","dy"],this.outputShape=K.filterShape;var ee=K.strideHeight,le=K.strideWidth,de=K.padInfo.top,Ee=K.padInfo.left,Te=K.outChannels/K.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+Te+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+K.batchSize+`; b++) {
          for (int yR = 0; yR < `+K.outHeight+`; yR++) {
            int xR = wR + yR * `+ee+" - "+de+`;

            if (xR < 0 || xR >= `+K.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+K.outWidth+`; yC++) {
              int xC = wC + yC * `+le+" - "+Ee+`;

              if (xC < 0 || xC >= `+K.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}(w);return this.compileAndRun(P,[l,m])},p.prototype.conv3d=function(l,m,w){var P=new function(K){this.variableNames=["x","W"],this.outputShape=K.outShape;var ee=K.padInfo.front,le=K.padInfo.top,de=K.padInfo.left,Ee=K.strideDepth,Te=K.strideHeight,Ne=K.strideWidth,Fe=K.dilationDepth,qe=K.dilationHeight,Je=K.dilationWidth,Ke=K.filterDepth,it=K.filterHeight,gt=K.filterWidth,Et=4*Math.floor(K.inChannels/4),At=K.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+Ee+", "+Te+", "+Ne+`);
      const ivec3 pads = ivec3(`+ee+", "+le+", "+de+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+Ke+`; wF++) {
          int xF = xFCorner + wF * `+Fe+`;

          if (xF < 0 || xF >= `+K.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+it+`; wR++) {
            int xR = xRCorner + wR * `+qe+`;

            if (xR < 0 || xR >= `+K.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+gt+`; wC++) {
              int xC = xCCorner + wC * `+Je+`;

              if (xC < 0 || xC >= `+K.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+Et+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(At===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+Et+`) *
                  getW(wF, wR, wC, `+Et+`, d2);
              } else if (`+(At===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+Et+`),
                  getX(batch, xF, xR, xC, `+Et+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+Et+`, d2),
                  getW(wF, wR, wC, `+Et+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(At===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+Et+`),
                  getX(batch, xF, xR, xC, `+Et+` + 1),
                  getX(batch, xF, xR, xC, `+Et+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+Et+`, d2),
                  getW(wF, wR, wC, `+Et+` + 1, d2),
                  getW(wF, wR, wC, `+Et+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(w);return this.compileAndRun(P,[l,m])},p.prototype.conv3dDerInput=function(l,m,w){var P=new function(K){this.variableNames=["dy","W"],this.outputShape=K.inShape;var ee=K.filterDepth,le=K.filterHeight,de=K.filterWidth,Ee=K.strideDepth,Te=K.strideHeight,Ne=K.strideWidth,Fe=ee-1-K.padInfo.front,qe=le-1-K.padInfo.top,Je=de-1-K.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+Fe+", "+qe+", "+Je+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+ee+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+Ee+`.0;

          if (dyF < 0.0 || dyF >= `+K.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+ee+` - 1 - wF;

          for (int wR = 0; wR < `+le+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+Te+`.0;

            if (dyR < 0.0 || dyR >= `+K.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+le+` - 1 - wR;

            for (int wC = 0; wC < `+de+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+Ne+`.0;

              if (dyC < 0.0 || dyC >= `+K.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+de+` - 1 - wC;

              for (int d2 = 0; d2 < `+K.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(w);return this.compileAndRun(P,[l,m])},p.prototype.conv3dDerFilter=function(l,m,w){var P=new function(K){this.variableNames=["x","dy"],this.outputShape=K.filterShape;var ee=K.strideDepth,le=K.strideHeight,de=K.strideWidth,Ee=K.padInfo.front,Te=K.padInfo.top,Ne=K.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+K.batchSize+`; b++) {
          for (int yF = 0; yF < `+K.outDepth+`; yF++) {
            int xF = wF + yF * `+ee+" - "+Ee+`;

            if (xF < 0 || xF >= `+K.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+K.outHeight+`; yR++) {
              int xR = wR + yR * `+le+" - "+Te+`;

              if (xR < 0 || xR >= `+K.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+K.outWidth+`; yC++) {
                int xC = wC + yC * `+de+" - "+Ne+`;

                if (xC < 0 || xC >= `+K.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(w);return this.compileAndRun(P,[l,m])},p.prototype.maxPool=function(l,m){var w=new $h(m,"max",!1);return this.compileAndRun(w,[l])},p.prototype.avgPool=function(l,m){var w=new $h(m,"avg",!1);return this.compileAndRun(w,[l],"float32")},p.prototype.maxPoolBackprop=function(l,m,w,P){var K=new $h(P,"max",!0),ee=this.compileAndRun(K,[m]),le=new function(Ee){this.variableNames=["dy","maxPos"],this.outputShape=Ee.inShape;var Te=Ee.strideHeight,Ne=Ee.strideWidth,Fe=Ee.dilationHeight,qe=Ee.effectiveFilterHeight,Je=Ee.effectiveFilterWidth,Ke=qe-1-Ee.padInfo.top,it=Je-1-Ee.padInfo.left,gt=qe*Je-1;this.userCode=`
      const ivec2 pads = ivec2(`+Ke+", "+it+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+qe+`;
          wR += `+Fe+`) {
          float dyR = float(dyRCorner + wR) / `+Te+`.0;

          if (dyR < 0.0 || dyR >= `+Ee.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+Je+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+Ne+`.0;

            if (dyC < 0.0 || dyC >= `+Ee.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+gt+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+Je+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}(P),de=this.compileAndRun(le,[l,ee],m.dtype);return ee.dispose(),de},p.prototype.avgPoolBackprop=function(l,m,w){var P=new function(K){this.variableNames=["dy"],this.outputShape=K.inShape;var ee=K.filterHeight,le=K.filterWidth,de=K.strideHeight,Ee=K.strideWidth,Te=K.dilationHeight,Ne=K.dilationWidth,Fe=K.effectiveFilterHeight,qe=K.effectiveFilterWidth,Je=Fe-1-K.padInfo.top,Ke=qe-1-K.padInfo.left,it=1/(ee*le);this.userCode=`
      const ivec2 pads = ivec2(`+Je+", "+Ke+`);
      const float avgMultiplier = float(`+it+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+Fe+`;
            wR += `+Te+`) {
          float dyR = float(dyRCorner + wR) / `+de+`.0;

          if (dyR < 0.0 || dyR >= `+K.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+qe+`;
            wC+= `+Ne+`) {
            float dyC = float(dyCCorner + wC) / `+Ee+`.0;

            if (dyC < 0.0 || dyC >= `+K.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}(w);return this.compileAndRun(P,[l],m.dtype)},p.prototype.cast=function(l,m){return ii(l,m,this)},p.prototype.unstack=function(l,m){for(var w=l.shape[m],P=new Array(l.rank-1),K=0,ee=0;ee<l.rank;ee++)ee!==m&&(P[K++]=l.shape[ee]);var le=new Array(l.rank).fill(0),de=l.shape.slice();de[m]=1;var Ee=new Array(w);for(ee=0;ee<Ee.length;ee++)le[m]=ee,Ee[ee]=this.slice(l,le,de).reshape(P);return Ee},p.prototype.avgPool3d=function(l,m){var w=new lm(m,"avg",!1);return this.compileAndRun(w,[l],"float32")},p.prototype.avgPool3dBackprop=function(l,m,w){var P=new function(K){this.variableNames=["dy"],this.outputShape=K.inShape;var ee=K.filterDepth,le=K.filterHeight,de=K.filterWidth,Ee=K.strideDepth,Te=K.strideHeight,Ne=K.strideWidth,Fe=K.dilationDepth,qe=K.dilationHeight,Je=K.dilationWidth,Ke=K.effectiveFilterDepth,it=K.effectiveFilterHeight,gt=K.effectiveFilterWidth,Et=Ke-1-K.padInfo.front,At=it-1-K.padInfo.top,Wt=gt-1-K.padInfo.left,cn=1/(ee*le*de);this.userCode=`
      const ivec3 pads = ivec3(`+Et+", "+At+", "+Wt+`);
      const float avgMultiplier = float(`+cn+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+Ke+`;
            wD += `+Fe+`) {
          float dyD = float(dyDCorner + wD) / `+Ee+`.0;

          if (dyD < 0.0 || dyD >= `+K.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+it+`;
              wR += `+qe+`) {
            float dyR = float(dyRCorner + wR) / `+Te+`.0;

            if (dyR < 0.0 || dyR >= `+K.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+gt+`;
                wC += `+Je+`) {
              float dyC = float(dyCCorner + wC) / `+Ne+`.0;

              if (dyC < 0.0 || dyC >= `+K.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(w);return this.compileAndRun(P,[l],m.dtype)},p.prototype.maxPool3d=function(l,m){var w=new lm(m,"max",!1);return this.compileAndRun(w,[l],"float32")},p.prototype.maxPool3dBackprop=function(l,m,w,P){var K=new lm(P,"max",!0),ee=this.compileAndRun(K,[m]),le=new function(Ee){this.variableNames=["dy","maxPos"],this.outputShape=Ee.inShape;var Te=Ee.strideDepth,Ne=Ee.strideHeight,Fe=Ee.strideWidth,qe=Ee.dilationDepth,Je=Ee.dilationHeight,Ke=Ee.dilationWidth,it=Ee.effectiveFilterDepth,gt=Ee.effectiveFilterHeight,Et=Ee.effectiveFilterWidth,At=it-1-Ee.padInfo.front,Wt=gt-1-Ee.padInfo.top,cn=Et-1-Ee.padInfo.left,pn=it*gt*Et-1;this.userCode=`
      const ivec3 pads = ivec3(`+At+", "+Wt+", "+cn+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+it+`;
           wD += `+qe+`) {
          float dyD = float(dyDCorner + wD) / `+Te+`.0;

          if (dyD < 0.0 || dyD >= `+Ee.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+gt+`;
              wR += `+Je+`) {
            float dyR = float(dyRCorner + wR) / `+Ne+`.0;

            if (dyR < 0.0 || dyR >= `+Ee.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+Et+`;
                wC += `+Ke+`) {
              float dyC = float(dyCCorner + wC) / `+Fe+`.0;

              if (dyC < 0.0 || dyC >= `+Ee.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+pn+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+gt+" * "+Et+` +
                  wR * `+Et+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(P),de=this.compileAndRun(le,[l,ee],m.dtype);return ee.dispose(),de},p.prototype.reshape=function(l,m){var w=this.texData.get(l.dataId);if(w.isPacked&&!Iu(l.shape,m)&&(w.texture===null||!Iu(w.shape,m))){var P=this.packedReshape(l,m);return He.makeTensorFromDataId(P.dataId,P.shape,P.dtype)}return wi(l,m)},p.prototype.resizeBilinear=function(l,m,w,P){var K=j().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new function(ee,le,de,Ee){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var Te=ee[0],Ne=ee[1],Fe=ee[2],qe=ee[3];this.outputShape=[Te,le,de,qe];var Je=[Ee&&le>1?Ne-1:Ne,Ee&&de>1?Fe-1:Fe],Ke=[Ee&&le>1?le-1:le,Ee&&de>1?de-1:de];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+Je[0]/Ke[0]+`,
          `+Je[1]/Ke[1]+`,
          `+Je[1]/Ke[1]+`);
      const vec3 inputShapeRC = vec3(`+Ne+".0, "+Fe+`.0,
                                     `+Fe+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(qe-1)+`;
        bool hasNextRow = coords.z < `+(de-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}(l.shape,m,w,P):new function(ee,le,de,Ee){this.variableNames=["A"],this.outputShape=[];var Te=ee[0],Ne=ee[1],Fe=ee[2],qe=ee[3];this.outputShape=[Te,le,de,qe];var Je=[Ee&&le>1?Ne-1:Ne,Ee&&de>1?Fe-1:Fe],Ke=[Ee&&le>1?le-1:le,Ee&&de>1?de-1:de];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+Je[0]/Ke[0]+`,
          `+Je[1]/Ke[1]+`);
      const vec2 inputShapeRC = vec2(`+Ne+".0, "+Fe+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}(l.shape,m,w,P);return this.compileAndRun(K,[l],"float32")},p.prototype.resizeBilinearBackprop=function(l,m,w){var P=new function(K,ee,le){this.variableNames=["dy"],this.outputShape=[],this.outputShape=ee.shape;var de=ee.shape,Ee=de[1],Te=de[2],Ne=K.shape,Fe=Ne[1],qe=Ne[2],Je=[le&&Fe>1?Ee-1:Ee,le&&qe>1?Te-1:Te],Ke=[le&&Fe>1?Fe-1:Fe,le&&qe>1?qe-1:qe],it=Je[0]/Ke[0],gt=Je[1]/Ke[1],Et=1/it,At=1/gt,Wt=2*Math.ceil(Et)+2,cn=2*Math.ceil(At)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+it+`);
        const float widthScale = float(`+gt+`);

        const float invHeightScale = float(`+Et+`);
        const float invWidthScale = float(`+At+`);

        const int winHeight = int(`+Wt+`);
        const int winWidth = int(`+cn+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+Fe+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+qe+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(Ee-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(Te-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}(l,m,w);return this.compileAndRun(P,[l])},p.prototype.resizeNearestNeighbor=function(l,m,w,P){var K=new function(ee,le,de,Ee){this.variableNames=["A"],this.outputShape=[];var Te=ee[0],Ne=ee[1],Fe=ee[2],qe=ee[3];this.outputShape=[Te,le,de,qe];var Je=[Ee&&le>1?Ne-1:Ne,Ee&&de>1?Fe-1:Fe],Ke=[Ee&&le>1?le-1:le,Ee&&de>1?de-1:de],it=Ee?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+Je[0]/Ke[0]+`,
          `+Je[1]/Ke[1]+`);
      const vec2 inputShapeRC = vec2(`+Ne+".0, "+Fe+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+it+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}(l.shape,m,w,P);return this.compileAndRun(K,[l])},p.prototype.resizeNearestNeighborBackprop=function(l,m,w){var P=new function(K,ee,le){this.variableNames=["dy"],this.outputShape=[],this.outputShape=ee.shape;var de=ee.shape,Ee=de[1],Te=de[2],Ne=K.shape,Fe=Ne[1],qe=Ne[2],Je=[le&&Fe>1?Ee-1:Ee,le&&qe>1?Te-1:Te],Ke=[le&&Fe>1?Fe-1:Fe,le&&qe>1?qe-1:qe],it=Je[0]/Ke[0],gt=Je[1]/Ke[1],Et=1/it,At=1/gt,Wt=2*Math.ceil(Et)+2,cn=2*Math.ceil(At)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+it+`);
        const float widthScale = float(`+gt+`);

        const float invHeightScale = float(`+Et+`);
        const float invWidthScale = float(`+At+`);

        const int winHeight = int(`+Wt+`);
        const int winWidth = int(`+cn+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+Fe+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+qe+`) {
              continue;
            }

            float sourceFracRow =
              float(`+Je[0]+`) *
                (float(dyR) / float(`+Ke[0]+`));

            float sourceFracCol =
                float(`+Je[1]+`) *
                  (float(dyC) / float(`+Ke[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+Ee+`) - 1),
                `+le+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+Te+`) - 1),
                `+le+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}(l,m,w);return this.compileAndRun(P,[l])},p.prototype.multinomial=function(l,m,w,P){var K=m?l:je(l),ee=K.shape[0],le=K.shape[1],de=new c0(ee,le,w),Ee=de.getCustomSetupFunc(P);return this.compileAndRun(de,[K],"int32",Ee)},p.prototype.oneHot=function(l,m,w,P){var K=new function(ee,le,de,Ee){this.variableNames=["indices"],this.outputShape=[ee,le],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+Ee+"), float("+de+`),
                      float(index == coords.y)));
      }
    `}(l.size,m,w,P);return this.compileAndRun(K,[l])},p.prototype.diag=function(l){var m=new function(w){this.variableNames=["X"],this.outputShape=[w,w],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}(l.size);return this.compileAndRun(m,[l])},p.prototype.nonMaxSuppression=function(l,m,w,P,K){return Ml("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),pa(l.dataSync(),m.dataSync(),w,P,K)},p.prototype.cropAndResize=function(l,m,w,P,K,ee){var le=new function(de,Ee,Te,Ne,Fe){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var qe=de[0],Je=de[1],Ke=de[2],it=de[3],gt=Ee[0],Et=Te[0],At=Te[1];this.outputShape=[gt,Et,At,it];var Wt=Ne==="bilinear"?1:0,cn=[Je-1+".0",Ke-1+".0"],pn=cn[0],ln=cn[1],dn=Et>1?[""+(Je-1)/(Et-1),"(y2-y1) * height_ratio","y1*"+pn+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+pn],Nn=dn[0],jn=dn[1],Ln=dn[2],ur=At>1?[""+(Ke-1)/(At-1),"(x2-x1) * width_ratio","x1*"+ln+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+ln],hr=ur[0],xr=ur[1],Er=ur[2];this.userCode=`
      const float height_ratio = float(`+Nn+`);
      const float width_ratio = float(`+hr+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+qe+`) {
          return;
        }

        float height_scale = `+jn+`;
        float width_scale = `+xr+`;

        float in_y = `+Ln+`;
        if( in_y < 0.0 || in_y > `+pn+` ) {
          setOutput(float(`+Fe+`));
          return;
        }
        float in_x = `+Er+`;
        if( in_x < 0.0 || in_x > `+ln+` ) {
          setOutput(float(`+Fe+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+Wt+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}(l.shape,m.shape,P,K,ee);return this.compileAndRun(le,[l,m,w],"float32")},p.prototype.depthToSpace=function(l,m,w){we(m>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+m});var P=l.shape[0],K=w==="NHWC"?l.shape[1]:l.shape[2],ee=w==="NHWC"?l.shape[2]:l.shape[3],le=w==="NHWC"?l.shape[3]:l.shape[1],de=K*m,Ee=ee*m,Te=le/(m*m),Ne=new cv(w==="NHWC"?[P,de,Ee,Te]:[P,Te,de,Ee],m,w);return this.compileAndRun(Ne,[l])},p.prototype.split=function(l,m,w){return wa(l,m,w)},p.prototype.scatterND=function(l,m,w){var P=Bl(0,l,w),K=P.sliceRank,ee=P.numUpdates,le=P.sliceSize,de=P.strides,Ee=P.outputSize,Te=[Ee/le,le],Ne=l.reshape([ee,K]),Fe=m.reshape([ee,le]);if(Ee===0)return wi(No([]),w);var qe=Ar(0),Je=new Iy(ee,K,Ne.rank,Fe.rank,de,Te);return this.compileAndRun(Je,[Fe,Ne,qe]).reshape(w)},p.prototype.sparseToDense=function(l,m,w,P){var K=Bl(0,l,w),ee=K.sliceRank,le=K.numUpdates,de=K.strides,Ee=K.outputSize,Te=new Iy(le,ee,l.rank,m.rank,de,[Ee,1]);return this.compileAndRun(Te,[m,l,P]).reshape(w)},p.prototype.fft=function(l){return this.fftImpl(l,!1)},p.prototype.ifft=function(l){return this.fftImpl(l,!0)},p.prototype.fftImpl=function(l,m){var w=this.texData.get(l.dataId),P=new t0("return real * expR - imag * expI;",l.shape,m),K=new t0("return real * expI + imag * expR;",l.shape,m),ee=[this.makeComplexComponentTensorInfo(l,w.complexTensors.real),this.makeComplexComponentTensorInfo(l,w.complexTensors.imag)],le=this.compileAndRun(P,ee),de=this.compileAndRun(K,ee),Ee=this.complex(le,de).as2D(l.shape[0],l.shape[1]);return le.dispose(),de.dispose(),Ee},p.prototype.gatherND=function(l,m){var w=m.shape,P=w[w.length-1],K=fu(l,m),ee=K[0],le=K[1],de=K[2],Ee=K[3],Te=m.reshape([le,P]),Ne=l.reshape([l.size/de,de]),Fe=new function(qe,Je,Ke){this.sliceDim=qe,this.strides=Je,this.variableNames=["x","indices"],this.outputShape=Ke;var it=Wo(Je.length),gt=Wo(Ke.length),Et=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+it+" strides = "+it+"("+this.strides+`);
         void main() {
          `+gt+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+Et+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}(P,Ee,[le,de]);return this.compileAndRun(Fe,[Ne,Te]).reshape(ee)},p.prototype.fill=function(l,m,w){if((w=w||Ce(m))==="string"){var P=an(w,ze(l));return P.fill(m),He.makeTensor(P,l,w,this)}var K=new n0(l,m),ee=K.getCustomSetupFunc(m);return this.compileAndRun(K,[],w,ee)},p.prototype.onesLike=function(l){if(l.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(l.shape,1,l.dtype)},p.prototype.zerosLike=function(l){return this.fill(l.shape,l.dtype==="string"?"":0,l.dtype)},p.prototype.linspace=function(l,m,w){return Si(l,m,w)},p.prototype.makeTensorInfo=function(l,m){var w=this.write(null,l,m);return this.texData.get(w).usage=null,{dataId:w,shape:l,dtype:m}},p.prototype.makeOutput=function(l,m){var w=this.makeTensorInfo(l,m).dataId;return He.makeTensorFromDataId(w,l,m,this)},p.prototype.unpackTensor=function(l){var m=new function(w){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=w;var P=w.length,K=Ca("rc",P),ee=Wo(P),le=function(Te,Ne){if(Te===1)return"rc";for(var Fe="",qe=0;qe<Te;qe++)Fe+=Ne[qe],qe<Te-1&&(Fe+=",");return Fe}(P,K),de=K.slice(-2),Ee=P<=1?"rc":"vec2("+de.join(",")+")";this.userCode=`
      void main() {
        `+ee+` rc = getOutputCoords();
        vec4 packedInput = getA(`+le+`);

        setOutput(getChannel(packedInput, `+Ee+`));
      }
    `}(l.shape);return this.runWebGLProgram(m,[l],l.dtype)},p.prototype.packTensor=function(l){var m=new function(w){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=w;var P=w.length;if(P===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var K=Ca("rc",P),ee=Wo(P),le=function(Te,Ne,Fe){if(Te===1)return"rc > "+Ne[0];for(var qe="",Je=Te-2;Je<Te;Je++)qe+=Fe[Je]+" >= "+Ne[Je],Je<Te-1&&(qe+="||");return qe}(P,w,K),de=function(Te,Ne,Fe,qe){if(Te===1)return"";var Je=qe.slice(-2);return`
    int r = `+Je[0]+`;
    int c = `+Je[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+Ne+`;
    bool rEdge = rp1 >= `+Fe+`;
  `}(P,w[w.length-1],w[w.length-2],K),Ee=function(Te,Ne){var Fe=Te.length,qe=function(Je,Ke){for(var it=[],gt=0;gt<=1;gt++)for(var Et=0;Et<=1;Et++){for(var At=(gt===0?"r":"rp1")+", "+(Et===0?"c":"cp1"),Wt=2;Wt<Je;Wt++)At=Ke[Ke.length-1-Wt]+","+At;it.push(At)}return it}(Fe,Ne);return Fe===1?`getA(rc),
            rc + 1 >= `+Te[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+qe[0]+`),
          cEdge ? 0. : getA(`+qe[1]+`),
          rEdge ? 0. : getA(`+qe[2]+`),
          rEdge || cEdge ? 0. : getA(`+qe[3]+")"}(w,K);this.userCode=`
        void main() {
          `+ee+` rc = getOutputCoords();

          if(`+le+`) {
            setOutput(vec4(0));
          } else {
            `+de+`

            setOutput(vec4(`+Ee+`));
          }
        }
      `}}(l.shape);return this.runWebGLProgram(m,[l],l.dtype,null,!0)},p.prototype.packedReshape=function(l,m){var w=[ws(l.shape)].concat(La(l.shape)),P={dtype:l.dtype,shape:w,dataId:l.dataId},K=new function(le,de){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=le;for(var Ee="",Te=0;Te<4;Te++){var Ne="thisRC = rc;";Te%2==1&&(Ne+="thisRC.z += 1;"),Te>1&&(Ne+="thisRC.y += 1;"),Ee+=`
        `+Ne+`
        `+(Te>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+Te+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(Te>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Ia(["r","c","d"],de)+`
      return ivec3(r, c, d);
    }
  
      `+Zu(le)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+le[1]+`;
        int cols = `+le[2]+`;

        `+Ee+`

        setOutput(result);
      }
    `}([ws(m)].concat(La(m)),w),ee=this.runWebGLProgram(K,[P],l.dtype,null,!0);return{dataId:ee.dataId,shape:m,dtype:ee.dtype}},p.prototype.decode=function(l){var m,w=this.texData.get(l),P=w.isPacked,K=w.shape,ee=w.dtype,le=Nc(K);return m=P?new function(de){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Zn.DENSE;var Ee=yi(de),Te=Oo();this.outputShape=de,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Ia(["r","c","d"],de)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+Ee[0]+", "+Ee[1]+`));
        int index = 4 * (resTexRC.x * `+Ee[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+Te.output+` = result;
      }
    `}(le):new function(de){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Zn.DENSE;var Ee=yi(de),Te=Oo();this.outputShape=de,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Ia(["r","c","d"],de)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+Ee[0]+", "+Ee[1]+`));
        int index = 4 * (resTexRC.x * `+Ee[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+Te.output+` = result;
      }
    `}(le),{dtype:ee,shape:K,dataId:this.runWebGLProgram(m,[{shape:le,dtype:ee,dataId:l}],ee,null,!0).dataId}},p.prototype.runWebGLProgram=function(l,m,w,P,K){var ee=this;K===void 0&&(K=!1);var le=this.makeTensorInfo(l.outputShape,w),de=this.texData.get(le.dataId);if(l.packedOutput&&(de.isPacked=!0),l.outPackingScheme===Zn.DENSE){var Ee=yi(l.outputShape);de.texShape=Ee.map(function(Et){return 2*Et})}if(l.outTexUsage!=null&&(de.usage=l.outTexUsage),ze(le.shape)===0)return de.values=kn(le.dtype,0),le;var Te=[],Ne=m.map(function(Et){if(Et.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var At=ee.texData.get(Et.dataId);if(At.texture==null){if(!l.packedInputs&&ze(Et.shape)<=j().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:Et.shape,texData:null,isUniform:!0,uniformValues:At.values};l.packedInputs&&(At.isPacked=!0,At.shape=Et.shape)}else if(!!At.isPacked!=!!l.packedInputs)Et=At.isPacked?ee.unpackTensor(Et):ee.packTensor(Et),Te.push(Et),At=ee.texData.get(Et.dataId);else if(At.isPacked&&!Iu(At.shape,Et.shape)){var Wt=Et,cn=Et.shape;Et.shape=At.shape,Et=ee.packedReshape(Et,cn),Te.push(Et),At=ee.texData.get(Et.dataId),Wt.shape=cn}return ee.uploadToGPU(Et.dataId),{shape:Et.shape,texData:At,isUniform:!1}});this.uploadToGPU(le.dataId);var Fe,qe={shape:le.shape,texData:de,isUniform:!1},Je=function(Et,At,Wt){var cn="";Ne.concat(Wt).forEach(function(ln){var dn=ln.texData!=null&&ln.texData.slice!=null&&ln.texData.slice.flatOffset>0,Nn=ln.isUniform?"uniform":ln.texData.texShape;cn+=ln.shape+"_"+Nn+"_"+dn});var pn=Et.userCode;return Et.constructor.name+"_"+cn+"_"+pn}(l,0,qe),Ke=this.getAndSaveBinary(Je,function(){return function(Et,At,Wt,cn){var pn=At.userCode,ln=Wt.map(function(vr,Lr){var Pr={logicalShape:vr.shape,texShape:vr.isUniform?null:vr.texData.texShape,isUniform:vr.isUniform,isPacked:!vr.isUniform&&vr.texData.isPacked,flatOffset:null};return vr.texData!=null&&vr.texData.slice!=null&&vr.texData.slice.flatOffset>0&&(Pr.flatOffset=vr.texData.slice.flatOffset),{name:At.variableNames[Lr],shapeInfo:Pr}}),dn=ln.map(function(vr){return vr.shapeInfo}),Nn={logicalShape:cn.shape,texShape:cn.texData.texShape,isUniform:!1,isPacked:cn.texData.isPacked,flatOffset:null},jn=$a(ln,Nn,pn,At.packedInputs),Ln=Et.createProgram(jn),ur=null,hr=Et.getUniformLocation(Ln,"NAN",!1);j().getNumber("WEBGL_VERSION")===1&&(ur=Et.getUniformLocation(Ln,"INFINITY",!1));for(var xr={},Er=0;Er<At.variableNames.length;Er++){var wr=At.variableNames[Er];xr[wr]=Et.getUniformLocation(Ln,wr,!1),xr["offset"+wr]=Et.getUniformLocation(Ln,"offset"+wr,!1)}return{program:At,source:jn,webGLProgram:Ln,uniformLocations:xr,inShapeInfos:dn,outShapeInfo:Nn,infLoc:ur,nanLoc:hr}}(ee.gpgpu,l,Ne,qe)}),it=this.activeTimers!=null;if(it&&(Fe=this.startTimer()),function(Et,At,Wt,cn,pn){u0(At.inShapeInfos,Wt),u0([At.outShapeInfo],[cn]);var ln=cn.texData.texture,dn=cn.texData.texShape;cn.texData.isPacked?Et.setOutputPackedMatrixTexture(ln,dn[0],dn[1]):Et.setOutputMatrixTexture(ln,dn[0],dn[1]),Et.setProgram(At.webGLProgram),j().getNumber("WEBGL_VERSION")===1&&At.infLoc!==null&&Et.gl.uniform1f(At.infLoc,1/0),At.nanLoc!==null&&Et.gl.uniform1f(At.nanLoc,NaN),Wt.forEach(function(Nn,jn){var Ln=At.program.variableNames[jn],ur=At.uniformLocations[Ln],hr=At.uniformLocations["offset"+Ln];if(ur!=null)if(Nn.isUniform)if(ze(Nn.shape)<2)Et.gl.uniform1f(ur,Nn.uniformValues[0]);else{var xr=Nn.uniformValues;xr instanceof Float32Array||(xr=new Float32Array(xr)),Et.gl.uniform1fv(ur,xr)}else Nn.texData.slice!=null&&hr!=null&&Et.gl.uniform1i(hr,Nn.texData.slice.flatOffset),Et.setInputMatrixTexture(Nn.texData.texture,ur,jn)}),pn!=null&&pn(Et,At.webGLProgram),Et.executeProgram()}(this.gpgpu,Ke,Ne,qe,P),Te.forEach(function(Et){return ee.disposeData(Et.dataId)}),it&&(Fe=this.endTimer(Fe),this.activeTimers.push({name:l.constructor.name,query:this.getQueryTime(Fe)})),!j().getBool("WEBGL_LAZILY_UNPACK")&&de.isPacked&&K===!1){var gt=this.unpackTensor(le);return this.disposeData(le.dataId),gt}return le},p.prototype.compileAndRun=function(l,m,w,P,K){K===void 0&&(K=!1),w=w||m[0].dtype;var ee=this.runWebGLProgram(l,m,w,P,K);return He.makeTensorFromDataId(ee.dataId,ee.shape,ee.dtype)},p.prototype.getAndSaveBinary=function(l,m){return l in this.binaryCache||(this.binaryCache[l]=m()),this.binaryCache[l]},p.prototype.getTextureManager=function(){return this.textureManager},p.prototype.dispose=function(){var l=this;this.disposed||(j().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(m){l.gpgpu.deleteProgram(l.binaryCache[m].webGLProgram),delete l.binaryCache[m]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},p.prototype.floatPrecision=function(){var l=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=qi(function(){if(!j().get("WEBGL_RENDER_FLOAT32_ENABLED")){var m=j().getBool("DEBUG");j().set("DEBUG",!1);var w=l.abs(Ar(1e-8)).dataSync()[0];if(j().set("DEBUG",m),w>0)return 32}return 16})),this.floatPrecisionValue},p.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},p.prototype.uploadToGPU=function(l){var m,w=this.texData.get(l),P=w.shape,K=w.dtype,ee=w.values,le=w.texture,de=w.usage,Ee=w.isPacked;if(le==null){var Te,Ne=this.activeTimers!=null;Ne&&(Te=en());var Fe=w.texShape;if(Fe==null&&(Fe=pf(P,Ee),w.texShape=Fe),ee!=null){var qe=Nc(P),Je=void 0,Ke=Fe[1],it=Fe[0],gt=ee instanceof Uint8Array;Ee?(Ke=(m=ri(Fe[0],Fe[1]))[0],Je=new function(pn,ln,dn){dn===void 0&&(dn=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var Nn=Oo(),jn=ln[0],Ln=ln[1];this.outputShape=pn;var ur="",hr="result";dn&&(hr="floor(result * 255. + 0.5)");for(var xr=0;xr<=1;xr++)for(var Er=0;Er<=1;Er++){var wr=2*xr+Er;ur+=`
          localCoords = coords;
          if(localCoords[2] + `+Er+" < "+pn[2]+`) {
            localCoords[2] += `+Er+`;
            if(localCoords[1] + `+xr+" < "+pn[1]+`) {
              localCoords[1] += `+xr+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+Ln+`;
              c = imod(flatIndex, `+Ln+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+Ln+".0, "+jn+`.0);
              values = `+Nn.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+wr+`] = values[0];
              } else if(offset == 1) {
                result[`+wr+`] = values[1];
              } else if(offset == 2) {
                result[`+wr+`] = values[2];
              } else {
                result[`+wr+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Zu(pn)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+ur+`

        `+Nn.output+" = "+hr+`;
      }
    `}(qe,[it=m[1],Ke],gt)):Je=new function(pn,ln,dn){dn===void 0&&(dn=!1),this.variableNames=["A"];var Nn=Oo(),jn=ln[0],Ln=ln[1];this.outputShape=pn;var ur="result";dn&&(ur="floor(result * 255. + 0.5)"),this.userCode=`
      `+Zu(pn)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+Ln+`;
        int c = imod(flatIndex, `+Ln+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+Ln+".0, "+jn+`.0);
        vec4 values = `+Nn.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+Nn.output+" = vec4("+ur+`, 0., 0., 0.);
      }
    `}(qe,[it,Ke],gt);var Et=this.makeTensorInfo([it,Ke],K);this.texData.get(Et.dataId).usage=gt?lr.PIXELS:lr.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(Et.dataId),Ke,it,ee);var At=this.runWebGLProgram(Je,[Et],K,null,!0),Wt=this.texData.get(At.dataId);w.texture=Wt.texture,w.texShape=Wt.texShape,w.isPacked=Wt.isPacked,w.usage=Wt.usage,this.disposeData(Et.dataId),this.texData.delete(At.dataId),w.values=null,Ne&&(this.uploadWaitMs+=en()-Te)}else{var cn=this.acquireTexture(Fe,de,K,Ee);w.texture=cn}}},p.prototype.convertAndCacheOnCPU=function(l,m){var w=this.texData.get(l),P=w.dtype;return this.releaseGPUData(l),m!=null&&(w.values=function(K,ee){if(ee==="float32"||ee==="complex64")return K;if(ee==="int32"||ee==="bool"){for(var le=ee==="int32"?new Int32Array(K.length):new Uint8Array(K.length),de=0;de<le.length;++de)le[de]=Math.round(K[de]);return le}throw new Error("Unknown dtype "+ee)}(m,P)),w.values},p.prototype.acquireTexture=function(l,m,w,P){if(this.numBytesInGPU+=this.computeBytes(l,w),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var K=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+K+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(l,m,P)},p.prototype.computeBytes=function(l,m){return l[0]*l[1]*$t(m)},p}(un);function nc(b,p){return b(p={exports:{}},p.exports),p.exports}Bn()&&He.registerBackend("webgl",function(){return new sg},2);var bc=nc(function(b){(function(p,l,m){function w(K,ee){return ee.c=K.c,ee.s0=K.s0,ee.s1=K.s1,ee.s2=K.s2,ee}function P(K,ee){var le=new function(Te){var Ne,Fe=this,qe=(Ne=4022871197,function(Je){Je=Je.toString();for(var Ke=0;Ke<Je.length;Ke++){var it=.02519603282416938*(Ne+=Je.charCodeAt(Ke));it-=Ne=it>>>0,Ne=(it*=Ne)>>>0,Ne+=4294967296*(it-=Ne)}return 23283064365386963e-26*(Ne>>>0)});Fe.next=function(){var Je=2091639*Fe.s0+23283064365386963e-26*Fe.c;return Fe.s0=Fe.s1,Fe.s1=Fe.s2,Fe.s2=Je-(Fe.c=0|Je)},Fe.c=1,Fe.s0=qe(" "),Fe.s1=qe(" "),Fe.s2=qe(" "),Fe.s0-=qe(Te),Fe.s0<0&&(Fe.s0+=1),Fe.s1-=qe(Te),Fe.s1<0&&(Fe.s1+=1),Fe.s2-=qe(Te),Fe.s2<0&&(Fe.s2+=1),qe=null}(K),de=ee&&ee.state,Ee=le.next;return Ee.int32=function(){return 4294967296*le.next()|0},Ee.double=function(){return Ee()+11102230246251565e-32*(2097152*Ee()|0)},Ee.quick=Ee,de&&(typeof de=="object"&&w(de,le),Ee.state=function(){return w(le,{})}),Ee}l&&l.exports?l.exports=P:this.alea=P})(0,b)}),Ev=nc(function(b){(function(p,l,m){function w(K,ee){return ee.x=K.x,ee.y=K.y,ee.z=K.z,ee.w=K.w,ee}function P(K,ee){var le=new function(Te){var Ne=this,Fe="";Ne.x=0,Ne.y=0,Ne.z=0,Ne.w=0,Ne.next=function(){var Je=Ne.x^Ne.x<<11;return Ne.x=Ne.y,Ne.y=Ne.z,Ne.z=Ne.w,Ne.w^=Ne.w>>>19^Je^Je>>>8},Te===(0|Te)?Ne.x=Te:Fe+=Te;for(var qe=0;qe<Fe.length+64;qe++)Ne.x^=0|Fe.charCodeAt(qe),Ne.next()}(K),de=ee&&ee.state,Ee=function(){return(le.next()>>>0)/4294967296};return Ee.double=function(){do var Te=((le.next()>>>11)+(le.next()>>>0)/4294967296)/2097152;while(Te===0);return Te},Ee.int32=le.next,Ee.quick=Ee,de&&(typeof de=="object"&&w(de,le),Ee.state=function(){return w(le,{})}),Ee}l&&l.exports?l.exports=P:this.xor128=P})(0,b)}),pm=nc(function(b){(function(p,l,m){function w(K,ee){return ee.x=K.x,ee.y=K.y,ee.z=K.z,ee.w=K.w,ee.v=K.v,ee.d=K.d,ee}function P(K,ee){var le=new function(Te){var Ne=this,Fe="";Ne.next=function(){var Je=Ne.x^Ne.x>>>2;return Ne.x=Ne.y,Ne.y=Ne.z,Ne.z=Ne.w,Ne.w=Ne.v,(Ne.d=Ne.d+362437|0)+(Ne.v=Ne.v^Ne.v<<4^Je^Je<<1)|0},Ne.x=0,Ne.y=0,Ne.z=0,Ne.w=0,Ne.v=0,Te===(0|Te)?Ne.x=Te:Fe+=Te;for(var qe=0;qe<Fe.length+64;qe++)Ne.x^=0|Fe.charCodeAt(qe),qe==Fe.length&&(Ne.d=Ne.x<<10^Ne.x>>>4),Ne.next()}(K),de=ee&&ee.state,Ee=function(){return(le.next()>>>0)/4294967296};return Ee.double=function(){do var Te=((le.next()>>>11)+(le.next()>>>0)/4294967296)/2097152;while(Te===0);return Te},Ee.int32=le.next,Ee.quick=Ee,de&&(typeof de=="object"&&w(de,le),Ee.state=function(){return w(le,{})}),Ee}l&&l.exports?l.exports=P:this.xorwow=P})(0,b)}),f0=nc(function(b){(function(p,l,m){function w(K,ee){return ee.x=K.x.slice(),ee.i=K.i,ee}function P(K,ee){K==null&&(K=+new Date);var le=new function(Te){var Ne=this;Ne.next=function(){var Fe,qe,Je=Ne.x,Ke=Ne.i;return Fe=Je[Ke],qe=(Fe^=Fe>>>7)^Fe<<24,qe^=(Fe=Je[Ke+1&7])^Fe>>>10,qe^=(Fe=Je[Ke+3&7])^Fe>>>3,qe^=(Fe=Je[Ke+4&7])^Fe<<7,Fe=Je[Ke+7&7],qe^=(Fe^=Fe<<13)^Fe<<9,Je[Ke]=qe,Ne.i=Ke+1&7,qe},function(Fe,qe){var Je,Ke=[];if(qe===(0|qe))Ke[0]=qe;else for(qe=""+qe,Je=0;Je<qe.length;++Je)Ke[7&Je]=Ke[7&Je]<<15^qe.charCodeAt(Je)+Ke[Je+1&7]<<13;for(;Ke.length<8;)Ke.push(0);for(Je=0;Je<8&&Ke[Je]===0;++Je);for(Je==8?Ke[7]=-1:Ke[Je],Fe.x=Ke,Fe.i=0,Je=256;Je>0;--Je)Fe.next()}(Ne,Te)}(K),de=ee&&ee.state,Ee=function(){return(le.next()>>>0)/4294967296};return Ee.double=function(){do var Te=((le.next()>>>11)+(le.next()>>>0)/4294967296)/2097152;while(Te===0);return Te},Ee.int32=le.next,Ee.quick=Ee,de&&(de.x&&w(de,le),Ee.state=function(){return w(le,{})}),Ee}l&&l.exports?l.exports=P:this.xorshift7=P})(0,b)}),W1=nc(function(b){(function(p,l,m){function w(K,ee){return ee.i=K.i,ee.w=K.w,ee.X=K.X.slice(),ee}function P(K,ee){K==null&&(K=+new Date);var le=new function(Te){var Ne=this;Ne.next=function(){var Fe,qe,Je=Ne.w,Ke=Ne.X,it=Ne.i;return Ne.w=Je=Je+1640531527|0,qe=Ke[it+34&127],Fe=Ke[it=it+1&127],qe^=qe<<13,Fe^=Fe<<17,qe^=qe>>>15,Fe^=Fe>>>12,qe=Ke[it]=qe^Fe,Ne.i=it,qe+(Je^Je>>>16)|0},function(Fe,qe){var Je,Ke,it,gt,Et,At=[],Wt=128;for(qe===(0|qe)?(Ke=qe,qe=null):(qe+="\0",Ke=0,Wt=Math.max(Wt,qe.length)),it=0,gt=-32;gt<Wt;++gt)qe&&(Ke^=qe.charCodeAt((gt+32)%qe.length)),gt===0&&(Et=Ke),Ke^=Ke<<10,Ke^=Ke>>>15,Ke^=Ke<<4,Ke^=Ke>>>13,gt>=0&&(Et=Et+1640531527|0,it=(Je=At[127&gt]^=Ke+Et)==0?it+1:0);for(it>=128&&(At[127&(qe&&qe.length||0)]=-1),it=127,gt=512;gt>0;--gt)Ke=At[it+34&127],Je=At[it=it+1&127],Ke^=Ke<<13,Je^=Je<<17,Ke^=Ke>>>15,Je^=Je>>>12,At[it]=Ke^Je;Fe.w=Et,Fe.X=At,Fe.i=it}(Ne,Te)}(K),de=ee&&ee.state,Ee=function(){return(le.next()>>>0)/4294967296};return Ee.double=function(){do var Te=((le.next()>>>11)+(le.next()>>>0)/4294967296)/2097152;while(Te===0);return Te},Ee.int32=le.next,Ee.quick=Ee,de&&(de.X&&w(de,le),Ee.state=function(){return w(le,{})}),Ee}l&&l.exports?l.exports=P:this.xor4096=P})(0,b)}),Fy=nc(function(b){(function(p,l,m){function w(K,ee){return ee.a=K.a,ee.b=K.b,ee.c=K.c,ee.d=K.d,ee}function P(K,ee){var le=new function(Te){var Ne=this,Fe="";Ne.next=function(){var Je=Ne.b,Ke=Ne.c,it=Ne.d,gt=Ne.a;return Je=Je<<25^Je>>>7^Ke,Ke=Ke-it|0,it=it<<24^it>>>8^gt,gt=gt-Je|0,Ne.b=Je=Je<<20^Je>>>12^Ke,Ne.c=Ke=Ke-it|0,Ne.d=it<<16^Ke>>>16^gt,Ne.a=gt-Je|0},Ne.a=0,Ne.b=0,Ne.c=-1640531527,Ne.d=1367130551,Te===Math.floor(Te)?(Ne.a=Te/4294967296|0,Ne.b=0|Te):Fe+=Te;for(var qe=0;qe<Fe.length+20;qe++)Ne.b^=0|Fe.charCodeAt(qe),Ne.next()}(K),de=ee&&ee.state,Ee=function(){return(le.next()>>>0)/4294967296};return Ee.double=function(){do var Te=((le.next()>>>11)+(le.next()>>>0)/4294967296)/2097152;while(Te===0);return Te},Ee.int32=le.next,Ee.quick=Ee,de&&(typeof de=="object"&&w(de,le),Ee.state=function(){return w(le,{})}),Ee}l&&l.exports?l.exports=P:this.tychei=P})(0,b)}),If=nc(function(b){(function(p,l){var m,w=this,P=256,K=6,ee="random",le=l.pow(P,K),de=l.pow(2,52),Ee=2*de,Te=P-1;function Ne(it,gt,Et){var At=[],Wt=Je(function ln(dn,Nn){var jn,Ln=[],ur=typeof dn;if(Nn&&ur=="object")for(jn in dn)try{Ln.push(ln(dn[jn],Nn-1))}catch{}return Ln.length?Ln:ur=="string"?dn:dn+"\0"}((gt=gt==1?{entropy:!0}:gt||{}).entropy?[it,Ke(p)]:it??function(){try{var ln;return m&&(ln=m.randomBytes)?ln=ln(P):(ln=new Uint8Array(P),(w.crypto||w.msCrypto).getRandomValues(ln)),Ke(ln)}catch{var dn=w.navigator,Nn=dn&&dn.plugins;return[+new Date,w,Nn,w.screen,Ke(p)]}}(),3),At),cn=new Fe(At),pn=function(){for(var ln=cn.g(K),dn=le,Nn=0;ln<de;)ln=(ln+Nn)*P,dn*=P,Nn=cn.g(1);for(;ln>=Ee;)ln/=2,dn/=2,Nn>>>=1;return(ln+Nn)/dn};return pn.int32=function(){return 0|cn.g(4)},pn.quick=function(){return cn.g(4)/4294967296},pn.double=pn,Je(Ke(cn.S),p),(gt.pass||Et||function(ln,dn,Nn,jn){return jn&&(jn.S&&qe(jn,cn),ln.state=function(){return qe(cn,{})}),Nn?(l[ee]=ln,dn):ln})(pn,Wt,"global"in gt?gt.global:this==l,gt.state)}function Fe(it){var gt,Et=it.length,At=this,Wt=0,cn=At.i=At.j=0,pn=At.S=[];for(Et||(it=[Et++]);Wt<P;)pn[Wt]=Wt++;for(Wt=0;Wt<P;Wt++)pn[Wt]=pn[cn=Te&cn+it[Wt%Et]+(gt=pn[Wt])],pn[cn]=gt;(At.g=function(ln){for(var dn,Nn=0,jn=At.i,Ln=At.j,ur=At.S;ln--;)dn=ur[jn=Te&jn+1],Nn=Nn*P+ur[Te&(ur[jn]=ur[Ln=Te&Ln+dn])+(ur[Ln]=dn)];return At.i=jn,At.j=Ln,Nn})(P)}function qe(it,gt){return gt.i=it.i,gt.j=it.j,gt.S=it.S.slice(),gt}function Je(it,gt){for(var Et,At=it+"",Wt=0;Wt<At.length;)gt[Te&Wt]=Te&(Et^=19*gt[Te&Wt])+At.charCodeAt(Wt++);return Ke(gt)}function Ke(it){return String.fromCharCode.apply(0,it)}if(l["seed"+ee]=Ne,Je(l.random(),p),b.exports){b.exports=Ne;try{m=r(390)}catch{}}})([],Math)});If.alea=bc,If.xor128=Ev,If.xorwow=pm,If.xorshift7=f0,If.xor4096=W1,If.tychei=Fy;var Yh=If.alea,Ld=Lt({addN_:function(b){we(Array.isArray(b),function(){return"The argument passed to tf.addN() must be a list of tensors"}),we(b.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+b.length});var p=b.map(function(w,P){return Ze(w,"tensors"+P,"addN")}),l=p[0];p.forEach(function(w){if(w.dtype!==l.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),p.forEach(function(w){if(!Ut(w.shape,l.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var m=p;return He.runKernelFunc(function(w,P){return w.addN(p)},m,null,"AddN")}});function Bd(){bd("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}function Sv(b){return b.rank===0||b.rank===1?b.as4D(1,1,1,b.size):b.rank===2?b.as4D(1,1,b.shape[0],b.shape[1]):b.rank===3?b.as4D(1,b.shape[0],b.shape[1],b.shape[2]):b}function d0(b,p,l,m,w,P){P==null&&(P=.001);var K,ee,le=Ze(b,"x","batchNorm"),de=Ze(p,"mean","batchNorm"),Ee=Ze(l,"variance","batchNorm");w!=null&&(K=Ze(w,"scale","batchNorm")),m!=null&&(ee=Ze(m,"offset","batchNorm")),we(de.rank===Ee.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),we(ee==null||de.rank===ee.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),we(K==null||de.rank===K.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var Te={x:le,scale:K,offset:ee,mean:de,variance:Ee},Ne={varianceEpsilon:P};return He.runKernelFunc(function(Fe,qe){var Je=Sv(le),Ke=Fe.batchNormalization(Je,jd(de),jd(Ee),P,jd(K),jd(ee));return qe([le,de,Ee,K]),Ke},Te,null,"FusedBatchNorm",Ne).reshape(le.shape)}function jd(b){return b==null?null:b.rank===0?b.as1D():b.rank===1?b:b.rank===2?b.as4D(1,1,b.shape[0],b.shape[1]):b.rank===3?b.as4D(1,b.shape[0],b.shape[1],b.shape[2]):b}var go=Lt({batchNormalization_:function(b,p,l,m,w,P){return m===void 0&&(m=.001),Bd(),d0(b,p,l,P,w,m)}}),Ff=Lt({batchNorm_:d0});function Jh(b,p,l,m,w,P){var K,ee,le=Ze(b,"x","batchNorm"),de=Ze(p,"mean","batchNorm"),Ee=Ze(l,"variance","batchNorm");return w!=null&&(K=Ze(w,"scale","batchNorm")),m!=null&&(ee=Ze(m,"offset","batchNorm")),we(le.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+le.rank+"."}),we(de.rank===2||de.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+de.rank+"."}),we(Ee.rank===2||Ee.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+Ee.rank+"."}),K!=null&&we(K.rank===2||K.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+K.rank+"."}),ee!=null&&we(ee.rank===2||ee.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+ee.rank+"."}),Ff(le,de,Ee,ee,K,P)}var Ry=Lt({batchNormalization2d_:function(b,p,l,m,w,P){return m===void 0&&(m=.001),Bd(),Jh(b,p,l,P,w,m)}}),Py=Lt({batchNorm2d_:Jh});function ug(b,p,l,m,w,P){var K,ee,le=Ze(b,"x","batchNorm"),de=Ze(p,"mean","batchNorm"),Ee=Ze(l,"variance","batchNorm");return w!=null&&(K=Ze(w,"scale","batchNorm")),m!=null&&(ee=Ze(m,"offset","batchNorm")),we(le.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+le.rank+"."}),we(de.rank===3||de.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+de.rank+"."}),we(Ee.rank===3||Ee.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+Ee.rank+"."}),K!=null&&we(K.rank===3||K.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+K.rank+"."}),ee!=null&&we(ee.rank===3||ee.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+ee.rank+"."}),Ff(le,de,Ee,ee,K,P)}var Rf=Lt({batchNormalization3d_:function(b,p,l,m,w,P){return m===void 0&&(m=.001),Bd(),ug(b,p,l,P,w,m)}}),Gl=Lt({batchNorm3d_:ug});function mm(b,p,l,m,w,P){var K,ee,le=Ze(b,"x","batchNorm"),de=Ze(p,"mean","batchNorm"),Ee=Ze(l,"variance","batchNorm");return w!=null&&(K=Ze(w,"scale","batchNorm")),m!=null&&(ee=Ze(m,"offset","batchNorm")),we(le.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+le.rank+"."}),we(de.rank===4||de.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+de.rank+"."}),we(Ee.rank===4||Ee.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+Ee.rank+"."}),K!=null&&we(K.rank===4||K.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+K.rank+"."}),ee!=null&&we(ee.rank===4||ee.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+ee.rank+"."}),Ff(le,de,Ee,ee,K,P)}var Qh=Lt({batchNormalization4d_:function(b,p,l,m,w,P){return m===void 0&&(m=.001),Bd(),mm(b,p,l,P,w,m)}}),zd=Lt({batchNorm4d_:mm}),Pf=Lt({broadcastTo_:function(b,p){var l=Ze(b,"broadcastTo","x"),m=l.shape;if(p.some(function(Te){return!(Te>0)||Te%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+p+"].");if(p.length<l.rank)throw new Error("broadcastTo(): shape.length="+p.length+" < input.rank="+l.rank+".");if(p.length>l.rank){for(var w=l.shape.slice();w.length<p.length;)w.unshift(1);l=l.reshape(w)}for(var P=l.shape,K=Array.from(p),ee=p.length-1;ee>=0;ee--)if(P[ee]===p[ee])K[ee]=1;else if(l.shape[ee]!==1)throw new Error("broadcastTo(): ["+m+"] cannot be broadcast to ["+p+"].");var le=K.map(function(Te,Ne){return Te>1?Ne:-1}).filter(function(Te){return Te>=0});if(le.length===0)return l.clone();var de={x:l},Ee={shape:p,inputShape:P};return He.runKernelFunc(function(Te){return Te.tile(l,K)},de,function(Te){return{x:function(){return Te.sum(le,!0)}}},il,Ee)}}),Lf=Lt({clone_:function(b){var p=Ze(b,"x","clone",null);return He.runKernelFunc(function(){return He.makeTensorFromDataId(p.dataId,p.shape,p.dtype)},{x:p},null,Ed)}}),rc=Lt({logicalAnd_:function(b,p){var l=Ze(b,"a","logicalAnd","bool"),m=Ze(p,"b","logicalAnd","bool");return Xi(l.shape,m.shape),He.runKernelFunc(function(w){return w.logicalAnd(l,m)},{a:l,b:m},null,"LogicalAnd")}}),Zh=Lt({logicalNot_:function(b){var p=Ze(b,"x","logicalNot","bool");return He.runKernelFunc(function(l){return l.logicalNot(p)},{$x:p})}}),Ud=Lt({logicalOr_:function(b,p){var l=Ze(b,"a","logicalOr","bool"),m=Ze(p,"b","logicalOr","bool");return Xi(l.shape,m.shape),He.runKernelFunc(function(w){return w.logicalOr(l,m)},{$a:l,$b:m})}}),ql=Lt({logicalXor_:function(b,p){var l=Ze(b,"a","logicalXor","bool"),m=Ze(p,"b","logicalXor","bool");return Xi(l.shape,m.shape),Ud(b,p).logicalAnd(rc(b,p).logicalNot())}}),dl=Lt({where_:function(b,p,l){var m=Ze(p,"a","where"),w=Ze(l,"b","where"),P=Ze(b,"condition","where","bool");return yt(m.shape,w.shape,"Error in where: "),P.rank===1?we(P.shape[0]===m.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):yt(P.shape,w.shape,"Error in where: "),He.runKernelFunc(function(K,ee){var le=K.select(P,m,w);return ee([P]),le},{$condition:P,$a:m,$b:w},function(K,ee){var le=ee[0];return{$condition:function(){return vi(le).toFloat()},$a:function(){return K.mul(le.cast(K.dtype))},$b:function(){return K.mul(le.logicalNot().cast(K.dtype))}}})}}),Wd=function(b){return D(this,void 0,void 0,function(){var p,l,m;return R(this,function(w){switch(w.label){case 0:return[4,(p=Ze(b,"condition","whereAsync","bool")).data()];case 1:return l=w.sent(),m=ua(p.shape,l),b!==p&&p.dispose(),[2,m]}})})},cg=Lt({divNoNan_:function(b,p){var l,m=Ze(b,"a","div"),w=Ze(p,"b","div");m=(l=Zt(m,w))[0],w=l[1];var P=aa(m,w),K=vi(P),ee=w.equal(K);return dl(ee,K,P)}}),Vd=Lt({tile_:function(b,p){var l=Ze(b,"x","tile",null);we(l.rank===p.length,function(){return"Error in transpose: rank of input "+l.rank+" must match length of reps "+p+"."});var m=[l],w={x:l},P={reps:p};return He.runKernelFunc(function(K,ee){var le=K.tile(l,p);return ee([l]),le},w,null,wf,P,m)}}),hl=Lt({eye_:function(b,p,l,m){m===void 0&&(m="float32"),p==null&&(p=b);for(var w=Ii([b,p],m),P=b<=p?b:p,K=0;K<P;++K)w.set(1,K,K);var ee=w.toTensor().as2D(b,p);if(l==null)return ee;if(l.length===1)return Vd(pc(ee,0),[l[0],1,1]);if(l.length===2)return Vd(pc(pc(ee,0),0),[l[0],l[1],1,1]);if(l.length===3)return Vd(pc(pc(pc(ee,0),0),0),[l[0],l[1],l[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+l.length+"D.")}}),ps=Lt({multinomial_:function(b,p,l,m){m===void 0&&(m=!1);var w=Ze(b,"logits","multinomial"),P=w.size,K=w.rank;if(P<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+P+".");if(K>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+K);l=l||Math.random();var ee=K===1?w.as2D(1,-1):w,le=He.runKernelFunc(function(de){return de.multinomial(ee,m,p,l)},{logits2D:ee});return K===1?le.as1D():le}}),Uc=Lt({oneHot_:function(b,p,l,m){if(l===void 0&&(l=1),m===void 0&&(m=0),p<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+p);var w=Ze(b,"indices","oneHot","int32"),P=w.shape.concat([p]),K={indices:w=w.flatten()},ee={depth:p,onValue:l,offValue:m};return He.runKernelFunc(function(le,de){return de([w]),le.oneHot(w,p,l,m)},K,null,Uh,ee).reshape(P)}}),ic=Lt({pad_:function(b,p,l){l===void 0&&(l=0);var m=Ze(b,"x","pad");if(m.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var w={paddings:p,constantValue:l},P={x:m};return He.runKernelFunc(function(K,ee){return ee([m]),K.pad(m,p,l)},P,null,ol,w)}}),Ru=Lt({pad1d_:function(b,p,l){return l===void 0&&(l=0),we(p.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),ic(b,[p],l)}}),ep=Lt({pad2d_:function(b,p,l){return l===void 0&&(l=0),we(p.length===2&&p[0].length===2&&p[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ic(b,p,l)}}),lg=Lt({pad3d_:function(b,p,l){return l===void 0&&(l=0),we(p.length===3&&p[0].length===2&&p[1].length===2&&p[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ic(b,p,l)}}),h0=Lt({pad4d_:function(b,p,l){return l===void 0&&(l=0),we(p.length===4&&p[0].length===2&&p[1].length===2&&p[2].length===2&&p[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ic(b,p,l)}}),p0=Lt({rand_:function(b,p,l){var m=ze(b),w=null;if(l==null||l==="float32")w=new Float32Array(m);else if(l==="int32")w=new Int32Array(m);else{if(l!=="bool")throw new Error("Unknown data type "+l);w=new Uint8Array(m)}for(var P=0;P<m;P++)w[P]=p();return He.makeTensor(w,b,l)}}),gm=.001,Vo=.1;function vm(){return He.backend.floatPrecision()===32?gm:Vo}function Wc(b,p,l){var m=!0;if((ft(b)||ft(p))&&(m=!1),ft(b)&&ft(p)&&(m=!0),m){var w=b.constructor.name,P=p.constructor.name;if(w!==P)throw new Error("Arrays are of different type. Actual: "+w+". Expected: "+P)}if(Array.isArray(b)&&Array.isArray(p)){var K=Qa(b),ee=Qa(p);if(!Ut(K,ee))throw new Error("Arrays have different shapes. Actual: ["+K+"]. Expected: ["+ee+"]")}var le=ft(b)?b:Ot(b),de=ft(p)?p:Ot(p);if(le.length!==de.length)throw new Error("Arrays have different lengths actual: "+le.length+" vs expected: "+de.length+`.
Actual:   `+le+`.
Expected: `+de+".");for(var Ee=0;Ee<de.length;++Ee){var Te=le[Ee],Ne=de[Ee];if(!l(Te,Ne))throw new Error("Arrays differ: actual["+Ee+"] = "+Te+", expected["+Ee+"] = "+Ne+`.
Actual:   `+le+`.
Expected: `+de+".")}}function Hd(b,p,l){return!isFinite(b)&&!isFinite(p)||!(isNaN(b)||isNaN(p)||Math.abs(b-p)>l)}var Gd=Object.freeze({TEST_EPSILON_FLOAT16:Vo,expectArraysClose:function(b,p,l){return l==null&&(l=vm()),Wc(b,p,function(m,w){return Hd(m,w,l)})},testEpsilon:vm,expectPromiseToFail:function(b,p){b().then(function(){return p.fail()},function(){return p()})},expectArraysEqual:function(b,p){var l=typeof p=="string"||typeof p=="number"||typeof p=="boolean"?[p]:p;return Pn(b)||Pn(b[0])||Pn(p)||Pn(p[0])?Wc(b,l,function(m,w){return m==w}):Wc(b,p,function(m,w){return Hd(m,w,0)})},expectNumbersClose:function(b,p,l){if(l==null&&(l=vm()),!Hd(b,p,l))throw new Error("Numbers differ: actual === "+b+", expected === "+p)},expectValuesInRange:function(b,p,l){for(var m=0;m<b.length;m++)if(b[m]<p||b[m]>l)throw new Error("Value out of range:"+b[m]+" low: "+p+", high: "+l)},expectArrayBuffersEqual:function(b,p){expect(new Float32Array(b)).toEqual(new Float32Array(p))}}),ym=function(){function b(p,l,m,w,P){this.mean=p,this.stdDev=l,this.dtype=m,this.nextVal=NaN,this.truncated=w,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var K=P||Math.random();this.random=Yh(K.toString())}return b.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var p=this.nextVal;return this.nextVal=NaN,p}for(var l,m,w=!1;!w;){var P=void 0,K=void 0,ee=void 0;do ee=(P=2*this.random()-1)*P+(K=2*this.random()-1)*K;while(ee>=1||ee===0);var le=Math.sqrt(-2*Math.log(ee)/ee);l=this.mean+this.stdDev*P*le,m=this.mean+this.stdDev*K*le,this.truncated&&!this.isValidTruncated(l)||(w=!0)}return this.truncated&&!this.isValidTruncated(m)||(this.nextVal=this.convertValue(m)),this.convertValue(l)},b.prototype.convertValue=function(p){return this.dtype==null||this.dtype==="float32"?p:Math.round(p)},b.prototype.isValidTruncated=function(p){return p<=this.upper&&p>=this.lower},b}(),fg=function(){function b(p,l,m,w){this.alpha=p,this.beta=1/l,this.dtype=m;var P=w||Math.random();this.randu=Yh(P.toString()),this.randn=new ym(0,1,m,!1,this.randu()),this.d=p<1?p+2/3:p-1/3,this.c=1/Math.sqrt(9*this.d)}return b.prototype.nextValue=function(){for(var p,l,m,w,P,K;;){do w=this.randn.nextValue(),K=1+this.c*w;while(K<=0);if(K*=K*K,l=1-.331*(p=w*w)*p,m=.5*p+this.d*(1-K+Math.log(K)),(P=this.randu())<l||Math.log(P)<m)break}return K=1/this.beta*this.d*K,this.alpha<1&&(K*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(K)},b.prototype.convertValue=function(p){return this.dtype==="float32"?p:Math.round(p)},b}(),dg=function(){function b(p,l,m,w){var P=this;if(p===void 0&&(p=0),l===void 0&&(l=1),this.canReturnFloat=function(){return P.dtype==null||P.dtype==="float32"},this.min=p,this.range=l-p,this.dtype=m,w==null&&(w=Math.random()),typeof w=="number"&&(w=w.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+p+" - "+l+" <= 1 and dtype is not float");this.random=Yh(w)}return b.prototype.convertValue=function(p){return this.canReturnFloat()?p:Math.round(p)},b.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},b}(),hg=Lt({randomGamma_:function(b,p,l,m,w){if(l===void 0&&(l=1),m===void 0&&(m="float32"),l==null&&(l=1),m==null&&(m="float32"),m!=="float32"&&m!=="int32")throw new Error("Unsupported data type "+m);for(var P=new fg(p,l,m,w),K=Ii(b,m),ee=0;ee<K.values.length;ee++)K.values[ee]=P.nextValue();return K.toTensor()}}),Cv=Lt({randomNormal_:function(b,p,l,m,w){if(p===void 0&&(p=0),l===void 0&&(l=1),m!=null&&m==="bool")throw new Error("Unsupported data type "+m);for(var P=new ym(p,l,m,!1,w),K=Ii(b,m),ee=0;ee<K.values.length;ee++)K.values[ee]=P.nextValue();return K.toTensor()}}),pg=Lt({randomUniform_:function(b,p,l,m,w){p===void 0&&(p=0),l===void 0&&(l=1),m===void 0&&(m="float32");for(var P=Ii(b,m),K=new dg(p,l,null,w),ee=0;ee<P.values.length;ee++)P.values[ee]=K.nextValue();return P.toTensor()}}),Bf=Lt({square_:function(b){var p=Ze(b,"x","square"),l=[p];return He.runKernelFunc(function(m,w){return w([p]),m.square(p)},{x:p},null,"Square",{},l,[])}}),mg=Lt({squaredDifference_:function(b,p){var l,m=Ze(b,"a","squaredDifference"),w=Ze(p,"b","squaredDifference");l=Zt(m,w),m=l[0],w=l[1],Xi(m.shape,w.shape);var P={a:m,b:w},K=[m,w];return He.runKernelFunc(function(ee,le){var de=ee.squaredDifference(m,w);return le([m,w]),de},P,function(ee,le){var de=le[0],Ee=le[1],Te=Ar(2);return{a:function(){return ee.mul(de.sub(Ee).mul(Te))},b:function(){return ee.mul(Ee.sub(de).mul(Te))}}},bf,{},K,[])}}),tp=Lt({truncatedNormal_:function(b,p,l,m,w){if(p===void 0&&(p=0),l===void 0&&(l=1),m!=null&&m==="bool")throw new Error("Unsupported data type $ { dtype }");for(var P=new ym(p,l,m,!0,w),K=Ii(b,m),ee=0;ee<K.values.length;ee++)K.values[ee]=P.nextValue();return K.toTensor()}}),gg=Lt({equal_:function(b,p){var l,m=Ze(b,"a","equal"),w=Ze(p,"b","equal");return l=Zt(m,w),m=l[0],w=l[1],Xi(m.shape,w.shape),He.runKernelFunc(function(P){return P.equal(m,w)},{$a:m,$b:w})}}),m0=Lt({equalStrict_:function(b,p){var l=Ze(b,"a","equalStrict"),m=Ze(p,"b","equalStrict");return yt(l.shape,m.shape,"Error in equalStrict: "),l.equal(m)}}),g0=Lt({greater_:function(b,p){var l,m=Ze(b,"a","greater"),w=Ze(p,"b","greater");return l=Zt(m,w),m=l[0],w=l[1],Xi(m.shape,w.shape),He.runKernelFunc(function(P){return P.greater(m,w)},{a:m,b:w},null,"Greater")}}),bm=Lt({greaterEqual_:function(b,p){var l,m=Ze(b,"a","greaterEqual"),w=Ze(p,"b","greaterEqual");return l=Zt(m,w),m=l[0],w=l[1],Xi(m.shape,w.shape),He.runKernelFunc(function(P,K){var ee=P.greaterEqual(m,w);return K([m,w]),ee},{a:m,b:w},function(P,K){var ee=K[0],le=K[1];return{a:function(){return vi(ee)},b:function(){return vi(le)}}},"GreaterEqual")}}),v0=Lt({greaterEqualStrict_:function(b,p){var l=Ze(b,"a","greaterEqualStrict"),m=Ze(p,"b","greaterEqualStrict");return yt(l.shape,m.shape,"Error in greaterEqualStrict: "),l.greaterEqual(m)}}),vg=Lt({greaterStrict_:function(b,p){var l=Ze(b,"a","greaterStrict"),m=Ze(p,"b","greaterStrict");return yt(l.shape,m.shape,"Error in greaterStrict: "),l.greater(m)}}),kv=Lt({less_:function(b,p){var l,m=Ze(b,"a","less"),w=Ze(p,"b","less");return l=Zt(m,w),m=l[0],w=l[1],Xi(m.shape,w.shape),He.runKernelFunc(function(P){return P.less(m,w)},{a:m,b:w},null,"Less")}}),$l=Lt({lessEqual_:function(b,p){var l,m=Ze(b,"a","lessEqual"),w=Ze(p,"b","lessEqual");return l=Zt(m,w),m=l[0],w=l[1],Xi(m.shape,w.shape),He.runKernelFunc(function(P,K){var ee=P.lessEqual(m,w);return K([m,w]),ee},{a:m,b:w},null,"LessEqual")}}),Ly=Lt({lessEqualStrict_:function(b,p){var l=Ze(b,"a","lessEqualStrict"),m=Ze(p,"b","lessEqualStrict");return yt(l.shape,m.shape,"Error in lessEqualStrict: "),l.lessEqual(m)}}),Av=Lt({lessStrict_:function(b,p){var l=Ze(b,"a","lessStrict"),m=Ze(p,"b","lessStrict");return yt(l.shape,m.shape,"Error in lessStrict: "),l.less(m)}}),xm=Lt({notEqual_:function(b,p){var l,m=Ze(b,"a","notEqual"),w=Ze(p,"b","notEqual");return l=Zt(m,w),m=l[0],w=l[1],Xi(m.shape,w.shape),He.runKernelFunc(function(P){return P.notEqual(m,w)},{a:m,b:w},null,"NotEqual")}}),Ov=Lt({notEqualStrict_:function(b,p){var l=Ze(b,"a","notEqualStrict"),m=Ze(p,"b","notEqualStrict");return yt(l.shape,m.shape,"Error in notEqualStrict: "),l.notEqual(m)}});function jf(b,p){for(var l=[],m=b;m<p;++m)l.push(m);return l}function Tv(b){for(var p=[],l=0;l<b.length;++l)for(var m=0;m<b[l].length;++m)p.push(b[l][m]);return p}var wm=Lt({gather_:function(b,p,l){l===void 0&&(l=0);var m=Ze(b,"x","gather"),w=Ze(p,"indices","gather","int32");l=Xt(l,m.shape)[0];var P=function(K,ee,le){for(var de=K.shape[le],Ee=[],Te=1,Ne=1,Fe=0;Fe<le;Fe++)Ee.push(K.shape[Fe]),Te*=K.shape[Fe];for(Fe=0;Fe<ee.rank;Fe++)Ee.push(ee.shape[Fe]);for(Fe=le+1;Fe<K.rank;Fe++)Ee.push(K.shape[Fe]),Ne*=K.shape[Fe];return{batchSize:Te,sliceSize:Ne,dimSize:de,outputShape:Ee}}(m,w,l);return He.runKernelFunc(function(K,ee){var le=K.gather(m,w.flatten(),l);return ee([w]),le},{x:m,indices:w},function(K,ee){var le=ee[0];return{x:function(){var de=m.shape,Ee=le.size,Te=de.slice(0,l),Ne=Te.length,Fe=de.slice(l,de.length).slice(1),qe=Fe.length,Je=jf(0,Ne),Ke=jf(Ne+1,Ne+1+qe),it=Tv([Te,[Ee],Fe]),gt=K.reshape(it),Et=le.reshape([Ee]),At=Tv([[Ne],Je,Ke]),Wt=gt.transpose(At),cn=yg(Wt,Et,m.shape[l]),pn=$u(At);return cn.transpose(pn)},indices:function(){return le}}},"Gather",{axis:l}).reshape(P.outputShape)}}),yg=Lt({unsortedSegmentSum_:function(b,p,l){var m=Ze(b,"x","unsortedSegmentSum"),w=Ze(p,"segmentIds","unsortedSegmentSum","int32");return we(Ft(l),function(){return"numSegments must be of dtype int"}),He.runKernelFunc(function(P,K){var ee=P.unsortedSegmentSum(m,w,l);return K([w]),ee},{$x:m},function(P,K){var ee=K[0];return{$x:function(){return function(le,de){for(var Ee=Na(de,vi(de)),Te=wm(le,Ee),Ne=bm(de,Ar(0,"int32")),Fe=Te.rank-Ne.rank,qe=0;qe<Fe;++qe)Ne=pc(Ne,qe+1);Ne=rc(Ne,Fu(Te.shape,"bool"));var Je=vi(Te);return dl(Ne,Te,Je)}(P,ee)}}})}}),Mv=function(b,p,l){return D(this,void 0,void 0,function(){var m,w,P,K,ee,le,de,Ee,Te,Ne,Fe,qe,Je;return R(this,function(Ke){switch(Ke.label){case 0:for(m=Ze(b,"tensor","boolMask"),w=Ze(p,"mask","boolMask","bool"),P=l??0,K=w.rank,ee=m.shape,we(K>0,function(){return"mask cannot be scalar"}),yt(ee.slice(P,P+K),w.shape,"mask's shape must match the first K dimensions of tensor's shape,"),le=1,de=P;de<P+K;de++)le*=ee[de];return Ee=ee.slice(0,P).concat([le],ee.slice(P+K)),Te=m.reshape(Ee),Ne=w.reshape([-1]),[4,Wd(Ne)];case 1:return Fe=Ke.sent(),qe=Fe.squeeze([1]),Je=wm(Te,qe,P),b!==m&&m.dispose(),p!==w&&w.dispose(),qe.dispose(),Te.dispose(),Ne.dispose(),Fe.dispose(),[2,Je]}})})};function Dv(b,p,l,m,w,P,K){P===void 0&&(P="NHWC"),we(b.length===p.rank,function(){return"Length of inShape ("+b.length+") and rank of dy ("+p.rank+") must match"});var ee=b,le=p,de=!1;p.rank===3&&(de=!0,le=p.as4D(1,p.shape[0],p.shape[1],p.shape[2]),ee=[1,b[0],b[1],b[2]]),we(ee.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+ee.length+"."}),we(le.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+le.rank}),we(l.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+l.rank});var Ee=P==="NHWC"?ee[3]:ee[1],Te=P==="NHWC"?le.shape[3]:le.shape[1];we(Ee===l.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+Ee+") must match input depth for filter "+l.shape[2]+"."}),we(Te===l.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+Te+") must match output depth for filter "+l.shape[3]+"."}),K!=null&&we(Ft(w),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+K+" but got pad "+w+"."});var Ne=ui(P),Fe=Gn(ee,l.shape,m,1,w,K,!1,Ne),qe=He.runKernelFunc(function(Je,Ke){var it=Je.conv2dDerInput(le,l,Fe);return Ke([l,le]),it},{dy4D:le,filter:l},function(Je,Ke){var it=Ke[0],gt=Ke[1];return{dy4D:function(){return qd(Je,it,m,w,P,1,K)},filter:function(){return Fv(Je,gt,it.shape,m,w,P,K)}}});return de?qe.as3D(qe.shape[1],qe.shape[2],qe.shape[3]):qe}function y0(b){var p=function(P){return typeof P=="number"?[P,P,P]:P.length===2?[P[0],P[1],1]:P}(b),l=p[0],m=p[1],w=p[2];return l===1&&m===1&&w===1}function Nv(b,p,l,m,w){we(b.length===p.rank,function(){return"Length of inShape ("+b.length+") and rank of dy ("+p.rank+") must match"});var P=b,K=p,ee=!1;p.rank===4&&(ee=!0,K=p.as5D(1,p.shape[0],p.shape[1],p.shape[2],p.shape[3]),P=[1,b[0],b[1],b[2],b[3]]);var le=P[4],de=K.shape[4];we(P.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+P.length+"."}),we(K.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+K.rank}),we(l.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+l.rank}),we(le===l.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+le+") must match input depth for filter "+l.shape[3]+"."}),we(de===l.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+de+") must match output depth for filter "+l.shape[4]+"."});var Ee=nr(P,l.shape,m,1,w),Te=He.runKernelFunc(function(Ne){return Ne.conv3dDerInput(K,l,Ee)},{dy5D:K});return ee?Te.as4D(Te.shape[1],Te.shape[2],Te.shape[3],Te.shape[4]):Te}var Iv=Lt({conv1d_:function(b,p,l,m,w,P,K){w===void 0&&(w="NWC"),P===void 0&&(P=1);var ee=Ze(b,"x","conv1d"),le=Ze(p,"filter","conv1d"),de=ee,Ee=!1;ee.rank===2&&(Ee=!0,de=ee.as3D(1,ee.shape[0],ee.shape[1])),we(de.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+de.rank+"."}),we(le.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+le.rank+"."}),K!=null&&we(Ft(m),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+K+" but got pad "+m+"."}),we(de.shape[2]===le.shape[1],function(){return"Error in conv1d: depth of input ("+de.shape[2]+") must match input depth for filter "+le.shape[1]+"."}),we(Fr(l,P),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+l+" and dilation '"+P+"'"}),we(w==="NWC",function(){return"Error in conv1d: got dataFormat of "+w+" but only NWC is currently supported."});var Te=le.as4D(1,le.shape[0],le.shape[1],le.shape[2]),Ne=de.as4D(de.shape[0],1,de.shape[1],de.shape[2]),Fe=qd(Ne,Te,[1,l],m,"NHWC",[1,P],K);return Ee?Fe.as2D(Fe.shape[2],Fe.shape[3]):Fe.as3D(Fe.shape[0],Fe.shape[2],Fe.shape[3])}}),qd=Lt({conv2d_:function(b,p,l,m,w,P,K){w===void 0&&(w="NHWC"),P===void 0&&(P=[1,1]);var ee=Ze(b,"x","conv2d"),le=Ze(p,"filter","conv2d"),de=ee,Ee=!1;ee.rank===3&&(Ee=!0,de=ee.as4D(1,ee.shape[0],ee.shape[1],ee.shape[2])),we(de.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+de.rank+"."}),we(le.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+le.rank+"."}),K!=null&&we(Ft(m),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+K+" but got pad "+m+"."});var Te=w==="NHWC"?de.shape[3]:de.shape[1];we(Te===le.shape[2],function(){return"Error in conv2d: depth of input ("+Te+") must match input depth for filter "+le.shape[2]+"."}),we(Fr(l,P),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+l+" and dilations '"+P+"'"});var Ne=ui(w),Fe=Gn(de.shape,le.shape,l,P,m,K,!1,Ne),qe=[le,de],Je=He.runKernelFunc(function(Ke,it){var gt=Ke.conv2d(de,le,Fe);return it([le,de]),gt},{x:de,filter:le},function(Ke,it){var gt=it,Et=gt[0],At=gt[1];return we(ai(P),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+P+"'"}),{x:function(){return Xl(At.shape,Ke,Et,l,m,w)},filter:function(){return Fv(At,Ke,Et.shape,l,m,w)}}},"Conv2D",Fe,qe);return Ee?Je.as3D(Je.shape[1],Je.shape[2],Je.shape[3]):Je}}),By=Lt({conv3d_:function(b,p,l,m,w,P){w===void 0&&(w="NDHWC"),P===void 0&&(P=[1,1,1]);var K=Ze(b,"x","conv3d"),ee=Ze(p,"filter","conv3d"),le=K,de=!1;K.rank===4&&(de=!0,le=K.as5D(1,K.shape[0],K.shape[1],K.shape[2],K.shape[3])),we(le.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+le.rank+"."}),we(ee.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+ee.rank+"."}),we(le.shape[4]===ee.shape[3],function(){return"Error in conv3d: depth of input ("+le.shape[4]+") must match input depth for filter "+ee.shape[3]+"."}),we(function(Ne,Fe){return y0(l)||y0(Fe)}(0,P),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+l+" and dilations '"+P+"'"}),we(w==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+w+" but only NDHWC is currently supported."});var Ee=nr(le.shape,ee.shape,l,P,m),Te=He.runKernelFunc(function(Ne,Fe){var qe=Ne.conv3d(le,ee,Ee);return Fe([le,ee]),qe},{x:le,$filter:ee},function(Ne,Fe){we(y0(P),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+P+"'"});var qe=Fe[0],Je=Fe[1];return{x:function(){return Nv(qe.shape,Ne,Je,l,m)},$filter:function(){return function(Ke,it,gt,Et,At){var Wt=Ke;Ke.rank===4&&(Wt=Ke.as5D(1,Ke.shape[0],Ke.shape[1],Ke.shape[2],Ke.shape[3]));var cn=it;cn.rank===4&&(cn=it.as5D(1,it.shape[0],it.shape[1],it.shape[2],it.shape[3])),we(Wt.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+Wt.shape+"."}),we(cn.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+cn.shape+"."}),we(gt.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+gt+"."}),we(Wt.shape[4]===gt[3],function(){return"Error in conv3dDerFilter: depth of input "+Wt.shape[4]+") must match input depth in filter ("+gt[3]+"."}),we(cn.shape[4]===gt[4],function(){return"Error in conv3dDerFilter: depth of dy ("+cn.shape[4]+") must match output depth for filter ("+gt[4]+")."});var pn=nr(Wt.shape,gt,Et,1,At);return He.runKernelFunc(function(ln){return ln.conv3dDerFilter(Wt,cn,pn)},{x5D:Wt,dy5D:cn})}(qe,Ne,Je.shape,l,m)}}});return de?Te.as4D(Te.shape[1],Te.shape[2],Te.shape[3],Te.shape[4]):Te}}),Fv=Lt({conv2dDerFilter_:function(b,p,l,m,w,P,K){P===void 0&&(P="NHWC");var ee=b;b.rank===3&&(ee=b.as4D(1,b.shape[0],b.shape[1],b.shape[2]));var le=p;le.rank===3&&(le=p.as4D(1,p.shape[0],p.shape[1],p.shape[2])),we(ee.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+ee.shape+"."}),we(le.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+le.shape+"."}),we(l.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+l+"."});var de=P==="NHWC"?ee.shape[3]:ee.shape[1],Ee=P==="NHWC"?le.shape[3]:le.shape[1];we(de===l[2],function(){return"Error in conv2dDerFilter: depth of input "+de+") must match input depth in filter ("+l[2]+"."}),we(Ee===l[3],function(){return"Error in conv2dDerFilter: depth of dy ("+Ee+") must match output depth for filter ("+l[3]+")."}),K!=null&&we(Ft(w),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+K+" but got pad "+w+"."});var Te=ui(P),Ne=Gn(ee.shape,l,m,1,w,K,!1,Te);return He.runKernelFunc(function(Fe){return Fe.conv2dDerFilter(ee,le,Ne)},{x4D:ee,dy4D:le})}}),Xl=Lt({conv2dDerInput_:Dv}),b0=Lt({depthwiseConv2d_:function(b,p,l,m,w,P,K){P===void 0&&(P=[1,1]);var ee=Ze(b,"x","depthwiseConv2d"),le=Ze(p,"filter","depthwiseConv2d"),de=ee,Ee=!1;ee.rank===3&&(Ee=!0,de=ee.as4D(1,ee.shape[0],ee.shape[1],ee.shape[2])),we(de.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+de.rank+"."}),we(le.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+le.rank+"."}),we(de.shape[3]===le.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+de.shape[3]+") must match the inChannels dimension in filter "+le.shape[2]+"."}),P==null&&(P=[1,1]),we(Fr(l,P),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+l+" and dilations '"+P+"'"}),K!=null&&we(Ft(m),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+K+" but got pad "+m+"."});var Te=Gn(de.shape,le.shape,l,P,m,K,!0),Ne=[de,le],Fe=He.runKernelFunc(function(qe,Je){var Ke=qe.depthwiseConv2D(de,le,Te);return Je([de,le]),Ke},{x:de,filter:le},function(qe,Je){we(ai(P),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+P+"'"});var Ke=Je[0],it=Je[1];return{x:function(){return Rv(Ke.shape,qe,it,Te)},filter:function(){return $d(Ke,qe,it.shape,Te)}}},"DepthwiseConv2dNative",Te,Ne);return Ee?Fe.as3D(Fe.shape[1],Fe.shape[2],Fe.shape[3]):Fe}}),Rv=Lt({depthwiseConv2dDerInput_:function(b,p,l,m){var w=p,P=!1;p.rank===3&&(P=!0,w=p.as4D(1,p.shape[0],p.shape[1],p.shape[2]));var K=He.runKernelFunc(function(ee){return ee.depthwiseConv2DDerInput(w,l,m)},{dy4D:w});return P?K.as3D(K.shape[1],K.shape[2],K.shape[3]):K}}),$d=Lt({depthwiseConv2dDerFilter_:function(b,p,l,m){var w=b;b.rank===3&&(w=b.as4D(1,b.shape[0],b.shape[1],b.shape[2]));var P=p;return P.rank===3&&(P=p.as4D(1,p.shape[0],p.shape[1],p.shape[2])),He.runKernelFunc(function(K){return K.depthwiseConv2DDerFilter(w,P,m)},{x4D:w,dy4D:P})}}),Kl=Lt({separableConv2d_:function(b,p,l,m,w,P,K){P===void 0&&(P=[1,1]),K===void 0&&(K="NHWC");var ee=Ze(b,"x","separableConv2d"),le=Ze(p,"depthwiseFilter","separableConv2d"),de=Ze(l,"pointwiseFilter","separableConv2d"),Ee=ee,Te=!1;if(ee.rank===3&&(Te=!0,Ee=ee.as4D(1,ee.shape[0],ee.shape[1],ee.shape[2])),K==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");we(Ee.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+Ee.rank+"."}),we(le.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+le.rank+"."}),we(de.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+le.rank+"."}),we(de.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+de.shape[0]+"."}),we(de.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+de.shape[1]+"."});var Ne=le.shape[2],Fe=le.shape[3];we(de.shape[2]===Ne*Fe,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+Ne*Fe+", but got "+de.shape[2]+"."});var qe=b0(Ee,le,m,w,K,P),Je=qd(qe,de,1,"valid",K);return Te?Je.as3D(Je.shape[1],Je.shape[2],Je.shape[3]):Je}}),bg=Lt({conv2dTranspose_:function(b,p,l,m,w,P){return Dv(l,Ze(b,"x","conv2dTranspose"),Ze(p,"filter","conv2dTranspose"),m,w,"NHWC",P)}}),x0=Lt({conv3dTranspose_:function(b,p,l,m,w){return Nv(l,Ze(b,"x","conv3dTranspose"),Ze(p,"filter","conv3dTranspose"),m,w)}}),Vc=Lt({matMul_:function(b,p,l,m){var w;l===void 0&&(l=!1),m===void 0&&(m=!1);var P=Ze(b,"a","matMul"),K=Ze(p,"b","matMul");w=Zt(P,K),P=w[0],K=w[1];var ee=l?P.shape[P.rank-2]:P.shape[P.rank-1],le=m?K.shape[K.rank-1]:K.shape[K.rank-2],de=l?P.shape[P.rank-1]:P.shape[P.rank-2],Ee=m?K.shape[K.rank-2]:K.shape[K.rank-1],Te=P.shape.slice(0,-2),Ne=K.shape.slice(0,-2),Fe=ze(Te),qe=ze(Ne);we(P.rank>=2&&K.rank>=2&&P.rank===K.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+P.rank+" and "+K.rank+"."}),we(Ut(Te,Ne),function(){return"Error in matMul: outer dimensions ("+Te+") and ("+Ne+") of Tensors with shapes "+P.shape+" and "+K.shape+" must match."}),we(ee===le,function(){return"Error in matMul: inner shapes ("+ee+") and ("+le+") of Tensors with shapes "+P.shape+" and "+K.shape+" and transposeA="+l+" and transposeB="+m+" must match."});var Je=P.shape.slice(0,-2).concat([de,Ee]),Ke=l?P.as3D(Fe,ee,de):P.as3D(Fe,de,ee),it=m?K.as3D(qe,Ee,le):K.as3D(qe,le,Ee),gt={transposeA:l,transposeB:m};return He.runKernelFunc(function(Et,At){var Wt=Et.batchMatMul(Ke,it,l,m);return At([Ke,it]),Wt},{a:Ke,b:it},function(Et,At){var Wt=At,cn=Wt[0],pn=Wt[1];return l||m?!l&&m?{a:function(){return Et.matMul(pn,!1,!1)},b:function(){return Et.matMul(cn,!0,!1)}}:l&&!m?{a:function(){return pn.matMul(Et,!1,!0)},b:function(){return cn.matMul(Et,!1,!1)}}:{a:function(){return pn.matMul(Et,!0,!0)},b:function(){return Et.matMul(cn,!0,!0)}}:{a:function(){return Et.matMul(pn,!1,!0)},b:function(){return cn.matMul(Et,!0,!1)}}},"BatchMatMul",gt).reshape(Je)}}),w0=Lt({dot_:function(b,p){var l=Ze(b,"t1","dot"),m=Ze(p,"t2","dot");we(!(l.rank!==1&&l.rank!==2||m.rank!==1&&m.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+l.rank+" and "+m.rank+"."});var w=l.rank===1?l.size:l.shape[1],P=m.rank===1?m.size:m.shape[0];return we(w===P,function(){return"Error in dot: inner dimensions of inputs must match, but got "+w+" and "+P+"."}),l.rank===1&&m.rank===1?l.as2D(1,-1).matMul(m.as2D(-1,1)).asScalar():l.rank===1&&m.rank===2?l.as2D(1,-1).matMul(m.as2D(m.shape[0],m.shape[1])).as1D():l.rank===2&&m.rank===1?l.matMul(m.as2D(-1,1)).as1D():l.matMul(m.as2D(m.shape[0],m.shape[1]))}}),Pv=Lt({outerProduct_:function(b,p){var l=Ze(b,"v1","outerProduct"),m=Ze(p,"v2","outerProduct");return we(l.rank===1&&m.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+l.rank+" and "+m.rank+"."}),l.as2D(-1,1).matMul(m.as2D(1,-1))}}),zf=Lt({reverse_:function(b,p){var l=Ze(b,"x","reverse");if(l.rank===0)return l.clone();var m=Xt(p,l.shape);return He.runKernelFunc(function(w){return w.reverse(l,m)},{$x:l},function(w){return{$x:function(){return w.reverse(m)}}}).reshapeAs(l)}}),jy=Lt({reverse1d_:function(b){var p=Ze(b,"x","reverse");return we(p.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+p.rank+"."}),zf(p,0)}}),np=Lt({reverse2d_:function(b,p){var l=Ze(b,"x","reverse");return we(l.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+l.rank+"."}),zf(l,p)}}),rp=Lt({reverse3d_:function(b,p){var l=Ze(b,"x","reverse");return we(l.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+l.rank+"."}),zf(l,p)}}),Uf=Lt({reverse4d_:function(b,p){var l=Ze(b,"x","reverse");return we(l.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+l.rank+"."}),zf(l,p)}});function Lv(b,p,l,m,w,P){var K=Ze(b,"x","maxPool"),ee=K,le=!1;K.rank===3&&(le=!0,ee=K.as4D(1,K.shape[0],K.shape[1],K.shape[2])),m==null&&(m=[1,1]),we(ee.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+ee.rank+"."}),we(Fr(l,m),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+l+" and dilations '"+m+"'"}),P!=null&&we(Ft(w),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+P+" but got pad "+w+"."});var de=In(ee.shape,p,l,m,w,P);if(de.filterWidth===1&&de.filterHeight===1&&Ut(de.inShape,de.outShape))return K.clone();var Ee=[ee],Te=He.runKernelFunc(function(Ne,Fe){var qe=Ne.maxPool(ee,de);return Fe([ee,qe]),qe},{x:ee},function(Ne,Fe){var qe=Fe[0],Je=Fe[1];return{x:function(){return function(Ke,it,gt,Et,At,Wt,cn,pn){var ln=Ze(Ke,"dy","maxPoolBackprop"),dn=Ze(it,"input","maxPoolBackprop"),Nn=Ze(gt,"output","maxPoolBackprop");we(dn.rank===ln.rank,function(){return"Rank of input ("+dn.rank+") does not match rank of dy ("+ln.rank+")"}),Wt==null&&(Wt=[1,1]),we(Fr(At,Wt),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+At+" and dilations '"+Wt+"'"}),we(ln.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+ln.rank+"."}),we(dn.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+dn.rank+"."});var jn=In(dn.shape,Et,At,Wt,cn,pn);return He.runKernelFunc(function(Ln){return Ln.maxPoolBackprop(ln,dn,Nn,jn)},{$dy:ln,$input:dn})}(Ne,qe,Je,p,l,m,w)}}},"MaxPool",de,Ee);return le?Te.as3D(Te.shape[1],Te.shape[2],Te.shape[3]):Te}function Xd(b,p,l,m,w,P){var K=Ze(b,"x","avgPool","float32");m==null&&(m=[1,1]),we(Fr(l,m),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+l+" and dilations '"+m+"'"});var ee=K,le=!1;K.rank===3&&(le=!0,ee=K.as4D(1,K.shape[0],K.shape[1],K.shape[2])),we(ee.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+ee.rank+"."}),P!=null&&we(Ft(w),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+P+" but got pad "+w+"."});var de=In(ee.shape,p,l,m,w,P);if(de.filterWidth===1&&de.filterHeight===1&&Ut(de.inShape,de.outShape))return K.clone();var Ee=He.runKernelFunc(function(Te){return Te.avgPool(ee,de)},{x:ee},function(Te){return{x:function(){return function(Ne,Fe,qe,Je,Ke,it){var gt=Ze(Ne,"dy","avgPoolBackprop"),Et=Ze(Fe,"input","avgPoolBackprop");we(Et.rank===gt.rank,function(){return"Rank of input ("+Et.rank+") does not match rank of dy ("+gt.rank+")"}),Ke==null&&(Ke=[1,1]),we(Fr(Je,Ke),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+Je+" and dilations '"+Ke+"'"});var At=Et,Wt=gt,cn=!1;Et.rank===3&&(cn=!0,At=Et.as4D(1,Et.shape[0],Et.shape[1],Et.shape[2]),Wt=gt.as4D(1,gt.shape[0],gt.shape[1],gt.shape[2])),we(Wt.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+Wt.rank+"."}),we(At.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+At.rank+"."});var pn=In(At.shape,qe,Je,Ke,it),ln=He.runKernelFunc(function(dn){return dn.avgPoolBackprop(Wt,At,pn)},{dy4D:Wt,input4D:At});return cn?ln.as3D(ln.shape[1],ln.shape[2],ln.shape[3]):ln}(Te,ee,p,l,m,w)}}},"AvgPool",de);return Ee=Ee.cast(K.dtype),le?Ee.as3D(Ee.shape[1],Ee.shape[2],Ee.shape[3]):Ee}var Hc=Lt({maxPool_:function(b,p,l,m,w){return Lv(b,p,l,1,m,w)}}),ip=Lt({avgPool_:function(b,p,l,m,w){return Xd(b,p,l,1,m,w)}}),_m=Lt({pool_:function(b,p,l,m,w,P){w==null&&(w=[1,1]),P==null&&(P=1),m===0&&(m="valid");var K=Ze(b,"x","maxPool"),ee=K,le=!1;K.rank===3&&(le=!0,ee=K.as4D(1,K.shape[0],K.shape[1],K.shape[2])),we(Fr(P,w),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+P+" and dilations '"+w+"'"});var de,Ee=In(ee.shape,p,P,w,m),Te=[Ee.dilationHeight,Ee.dilationWidth];de=m==="same"?function(At,Wt){var cn=At.map(function(dn,Nn){return dn+(dn-1)*(Wt[Nn]-1)}).map(function(dn){return dn-1}),pn=cn.map(function(dn){return Math.floor(dn/2)}),ln=cn.map(function(dn,Nn){return dn-pn[Nn]});return cn.map(function(dn,Nn){return[pn[Nn],ln[Nn]]})}([Ee.filterHeight,Ee.filterWidth],Te):[[0,0],[0,0]];var Ne=Te[0]===1&&Te[1]===1,Fe=function(At,Wt,cn){var pn=cn.map(function(Ln){return Ln[0]}),ln=cn.map(function(Ln){return Ln[1]}),dn=At.concat(pn,ln),Nn=Wt.map(function(Ln,ur){return(Ln-dn[ur]%Ln)%Ln}),jn=ln.map(function(Ln,ur){return Ln+Nn[ur]});return[Wt.map(function(Ln,ur){return[pn[ur],jn[ur]]}),Wt.map(function(Ln,ur){return[0,Nn[ur]]})]}([Ee.inHeight,Ee.inWidth],Te,de),qe=Fe[0],Je=Fe[1],Ke=Ne?m:"valid",it=Ne?ee:Nl(ee,Te,qe),gt=(l==="avg"?function(){return Xd(it,p,P,1,Ke)}:function(){return Lv(it,p,P,1,Ke)})(),Et=Ne?gt:Jp(gt,Te,Je);return le?Et.as3D(Et.shape[1],Et.shape[2],Et.shape[3]):Et}}),xg=Lt({maxPool3d_:function(b,p,l,m,w,P,K){P===void 0&&(P="NDHWC");var ee=Ze(b,"x","maxPool3d"),le=ee,de=!1;ee.rank===4&&(de=!0,le=ee.as5D(1,ee.shape[0],ee.shape[1],ee.shape[2],ee.shape[3])),K==null&&(K=[1,1,1]),we(le.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+le.rank+"."}),we(P==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+P}),we(Fr(l,K),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+l+" and dilations '"+K+"'"}),w!=null&&we(Ft(m),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+w+" but got pad "+m+"."});var Ee=Un(le.shape,p,l,K,m,w,P),Te=He.runKernelFunc(function(Ne,Fe){var qe=Ne.maxPool3d(le,Ee);return Fe([le,qe]),qe},{x:le},function(Ne,Fe){var qe=Fe[0],Je=Fe[1];return{x:function(){return function(Ke,it,gt,Et,At,Wt,cn,pn){var ln=Ze(Ke,"dy","maxPool3dBackprop"),dn=Ze(it,"input","maxPool3dBackprop"),Nn=Ze(gt,"output","maxPool3dBackprop"),jn=ln,Ln=dn,ur=Nn,hr=!1;dn.rank===4&&(hr=!0,jn=ln.as5D(1,ln.shape[0],ln.shape[1],ln.shape[2],ln.shape[3]),Ln=dn.as5D(1,dn.shape[0],dn.shape[1],dn.shape[2],dn.shape[3]),ur=Nn.as5D(1,Nn.shape[0],Nn.shape[1],Nn.shape[2],Nn.shape[3])),we(jn.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+jn.rank+"."}),we(Ln.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+Ln.rank+"."}),we(ur.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+ur.rank+"."}),Wt==null&&(Wt=[1,1,1]),we(Fr(At,Wt),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+At+" and dilations '"+Wt+"'"}),pn!=null&&we(Ft(cn),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+pn+" but got pad "+cn+"."});var xr=Un(Ln.shape,Et,At,Wt,cn,pn),Er=He.runKernelFunc(function(wr){return wr.maxPool3dBackprop(jn,Ln,ur,xr)},{dy5D:jn,input5D:Ln});return hr?Er.as4D(Er.shape[1],Er.shape[2],Er.shape[3],Er.shape[4]):Er}(Ne,qe,Je,p,l,K,m,w)}}});return de?Te.as4D(Te.shape[1],Te.shape[2],Te.shape[3],Te.shape[4]):Te}}),_0=Lt({avgPool3d_:function(b,p,l,m,w,P,K){P===void 0&&(P="NDHWC");var ee=Ze(b,"x","avgPool3d","float32"),le=ee,de=!1;ee.rank===4&&(de=!0,le=ee.as5D(1,ee.shape[0],ee.shape[1],ee.shape[2],ee.shape[3])),K==null&&(K=[1,1,1]),we(le.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+le.rank+"."}),we(P==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+P}),we(Fr(l,K),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+l+" and dilations '"+K+"'"}),w!=null&&we(Ft(m),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+w+" but got pad "+m+"."});var Ee=Un(le.shape,p,l,K,m,w,P),Te=He.runKernelFunc(function(Ne){return Ne.avgPool3d(le,Ee)},{x:le},function(Ne){return{x:function(){return function(Fe,qe,Je,Ke,it,gt,Et){var At=Ze(Fe,"dy","avgPool3dBackprop"),Wt=Ze(qe,"input","avgPool3dBackprop"),cn=At,pn=Wt,ln=!1;Wt.rank===4&&(ln=!0,cn=At.as5D(1,At.shape[0],At.shape[1],At.shape[2],At.shape[3]),pn=Wt.as5D(1,Wt.shape[0],Wt.shape[1],Wt.shape[2],Wt.shape[3])),we(cn.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+cn.rank+"."}),we(pn.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+pn.rank+"."}),it==null&&(it=[1,1,1]),we(Fr(Ke,it),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+Ke+" and dilations '"+it+"'"}),Et!=null&&we(Ft(gt),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+Et+" but got pad "+gt+"."});var dn=Un(pn.shape,Je,Ke,it,gt,Et),Nn=He.runKernelFunc(function(jn){return jn.avgPool3dBackprop(cn,pn,dn)},{dy5D:cn,input5D:pn});return ln?Nn.as4D(Nn.shape[1],Nn.shape[2],Nn.shape[3],Nn.shape[4]):Nn}(Ne,le,p,l,K,m,w)}}});return Te=Te.cast(le.dtype),de?Te.as4D(Te.shape[1],Te.shape[2],Te.shape[3],Te.shape[4]):Te}}),Bv=Lt({maxPoolWithArgmax_:function(b,p,l,m,w){w===void 0&&(w=!1);var P=Ze(b,"x","maxPoolWithArgmax"),K={filterSize:p,strides:l,pad:m,includeBatchInIndex:w},ee=He.runKernel("MaxPoolWithArgmax",{x:P},K);return{result:ee[0],indexes:ee[1]}}}),ms=Lt({slice_:function(b,p,l){var m,w,P=Ze(b,"x","slice");if(P.rank===0)throw new Error("Slicing scalar is not possible");(m=typeof p=="number"?[p].concat(new Array(P.rank-1).fill(0)):p.length<P.rank?p.concat(new Array(P.rank-p.length).fill(0)):p.slice()).forEach(function(le){we(le!==-1,function(){return"slice() does not support negative begin indexing."})}),w=(w=l==null?new Array(P.rank).fill(-1):typeof l=="number"?[l].concat(new Array(P.rank-1).fill(-1)):l.length<P.rank?l.concat(new Array(P.rank-l.length).fill(-1)):l).map(function(le,de){return le>=0?le:(we(le===-1,function(){return"Negative size values should be exactly -1 but got "+le+" for the slice() size at index "+de+"."}),P.shape[de]-m[de])}),jl(P,m,w);var K=P.shape,ee={begin:m,size:w};return He.runKernelFunc(function(le){return le.slice(P,m,w)},{x:P},function(le){for(var de=[],Ee=0;Ee<le.rank;Ee++)de.push([m[Ee],K[Ee]-m[Ee]-w[Ee]]);return{x:function(){return ic(le,de)}}},"Slice",ee)}}),jv=Lt({slice1d_:function(b,p,l){var m=Ze(b,"x","slice1d");return we(m.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+m.rank+" tensor"}),ms(m,[p],[l])}}),op=Lt({slice2d_:function(b,p,l){var m=Ze(b,"x","slice2d");return we(m.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+m.rank+" tensor"}),ms(m,p,l)}}),zv=Lt({slice3d_:function(b,p,l){var m=Ze(b,"x","slice3d");return we(m.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+m.rank+" tensor"}),ms(m,p,l)}}),wg=Lt({slice4d_:function(b,p,l){var m=Ze(b,"x","slice4d");return we(m.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+m.rank+" tensor"}),ms(m,p,l)}});function Wf(b,p,l,m,w){return p.rank<l.rank&&(p=p.reshape(Lo(p.shape,m))),b.rank<l.rank&&(b=b.reshape(Lo(b.shape,m))),{x:function(){var P=b.mul(l.equal(p).cast(b.dtype));return w==null?P:P.transpose(w)}}}var Em=Lt({all_:function(b,p,l){p===void 0&&(p=null),l===void 0&&(l=!1);var m=Ze(b,"x","all","bool"),w=Xt(p,m.shape),P=w,K=Ba(P,m.rank);K!=null&&(m=m.transpose(K),P=ja(P.length,m.rank));var ee=He.runKernelFunc(function(de){return de.all(m,P)},{$x:m});if(l){var le=Lo(ee.shape,w);return ee.reshape(le)}return ee}}),Yl=Lt({any_:function(b,p,l){p===void 0&&(p=null),l===void 0&&(l=!1);var m=Ze(b,"x","any","bool"),w=Xt(p,m.shape),P=w,K=Ba(P,m.rank);K!=null&&(m=m.transpose(K),P=ja(P.length,m.rank));var ee=He.runKernelFunc(function(de){return de.any(m,P)},{$x:m});if(l){var le=Lo(ee.shape,w);return ee.reshape(le)}return ee}}),Uv=Lt({argMax_:function(b,p){p===void 0&&(p=0);var l=Ze(b,"x","argMax");p==null&&(p=0);var m=Xt(p,l.shape),w=Ba(m,l.rank);w!=null&&(l=l.transpose(w),m=ja(m.length,l.rank));var P={axis:m[0]},K=[l];return He.runKernelFunc(function(ee,le){var de=ee.argMax(l,m[0]);return le([l]),de},{x:l},function(ee,le){var de=le[0];return{x:function(){return vi(de)}}},"ArgMax",P,K)}}),_g=Lt({argMin_:function(b,p){p===void 0&&(p=0);var l=Ze(b,"x","argMin");p==null&&(p=0);var m=Xt(p,l.shape),w=Ba(m,l.rank);return w!=null&&(l=l.transpose(w),m=ja(m.length,l.rank)),He.runKernelFunc(function(P,K){var ee=P.argMin(l,m[0]);return K([l]),ee},{$x:l},function(P,K){var ee=K[0];return{$x:function(){return vi(ee)}}})}}),Eg=Lt({logSumExp_:function(b,p,l){p===void 0&&(p=null),l===void 0&&(l=!1);var m=Ze(b,"x","logSumExp"),w=Xt(p,m.shape),P=m.max(w,!0),K=m.sub(P).exp().sum(w).log(),ee=P.reshape(K.shape).add(K);if(l){var le=Lo(ee.shape,w);return ee.reshape(le)}return ee}}),E0=Lt({max_:function(b,p,l){p===void 0&&(p=null),l===void 0&&(l=!1);var m=Ze(b,"x","max"),w=m,P=Xt(p,m.shape),K=P,ee=Ba(K,m.rank);ee!=null&&(m=m.transpose(ee),K=ja(K.length,m.rank));var le=[m],de=He.runKernelFunc(function(Te,Ne){var Fe=Te.max(m,K);return Ne([w,Fe]),Fe},{x:m},function(Te,Ne){return Wf(Te,Ne[1],Ne[0],P,ee)},"Max",{axes:K},le,[!0]);if(l){var Ee=Lo(de.shape,P);de=de.reshape(Ee)}return de}}),pl=Lt({mean_:function(b,p,l){p===void 0&&(p=null),l===void 0&&(l=!1);var m=Ze(b,"x","mean"),w=Xt(p,m.shape),P=ze(Po(m.shape,w)[1]);return G(function(K){var ee=Ar(P);return{value:(ee.dtype===K.dtype?K:K.cast(ee.dtype)).div(ee).sum(p,l),gradFunc:function(le){var de=K.shape.slice();return w.forEach(function(Ee){de[Ee]=1}),le.reshape(de).mul(Fu(K.shape,"float32")).div(P)}}})(m)}}),Sg=Lt({min_:function(b,p,l){p===void 0&&(p=null),l===void 0&&(l=!1);var m=Ze(b,"x","min"),w=m,P=Xt(p,m.shape),K=P,ee=Ba(K,m.rank);ee!=null&&(m=m.transpose(ee),K=ja(K.length,m.rank));var le=[m],de=He.runKernelFunc(function(Te,Ne){var Fe=Te.min(m,K);return Ne([w,Fe]),Fe},{x:m},function(Te,Ne){return Wf(Te,Ne[1],Ne[0],P,ee)},"Min",{axes:K},le,[!0]);if(l){var Ee=Lo(de.shape,P);de=de.reshape(Ee)}return de}}),Wv=Lt({moments_:function(b,p,l){p===void 0&&(p=null),l===void 0&&(l=!1);var m=Xt(p,(b=Ze(b,"x","moments")).shape),w=b.mean(m,l),P=w.shape;return l||(P=Lo(w.shape,m)),{mean:w,variance:b.toFloat().sub(w.reshape(P)).square().mean(m,l)}}}),Jl=Lt({sum_:function(b,p,l){p===void 0&&(p=null),l===void 0&&(l=!1);var m=Ze(b,"x","sum");m.dtype==="bool"&&(m=m.toInt());var w=Xt(p,m.shape);return G(function(P){var K=Ba(w,P.rank),ee=w,le=P;K!=null&&(le=P.transpose(K),ee=ja(ee.length,P.rank));var de=function(Fe){var qe=P.shape.slice();return w.forEach(function(Je){qe[Je]=1}),Fe.reshape(qe).mul(Fu(P.shape,"float32"))},Ee={axes:ee},Te=He.runKernelFunc(function(Fe){return Fe.sum(le,ee)},{x:le},function(Fe){return{x:function(){return de(Fe)}}},"Sum",Ee);if(l){var Ne=Lo(Te.shape,w);Te=Te.reshape(Ne)}return{value:Te,gradFunc:de}})(m)}}),Sm=Lt({prod_:function(b,p,l){p===void 0&&(p=null),l===void 0&&(l=!1);var m=Ze(b,"x","prod");m.dtype==="bool"&&(m=m.toInt());var w=Xt(p,m.shape),P=Ba(w,m.rank),K=w,ee=m;P!=null&&(ee=m.transpose(P),K=ja(K.length,m.rank));var le=He.runKernelFunc(function(Ee){return Ee.prod(ee,K)},{permutedX:ee});if(l){var de=Lo(le.shape,w);le=le.reshape(de)}return le}}),Kd=Lt({elu_:function(b){var p=Ze(b,"x","elu");return He.runKernelFunc(function(l,m){var w=l.elu(p);return m([w]),w},{$x:p},function(l,m){var w=m[0];return{$x:function(){return He.runKernelFunc(function(P){return P.eluDer(l,w)},{dy:l,y:w})}}})}}),Cm=Lt({leakyRelu_:function(b,p){p===void 0&&(p=.2);var l=Ze(b,"x","leakyRelu");return Na(Ar(p).mul(l),l)}}),gs=Lt({prelu_:function(b,p){var l=Ze(b,"x","prelu"),m=Ze(p,"alpha","prelu");return He.runKernelFunc(function(w,P){var K=w.prelu(l,m);return P([l,m]),K},{x:l,alpha:m},function(w,P){var K=P[0],ee=P[1],le=K.greater(0);return{x:function(){return dl(le,w,w.mul(ee))},alpha:function(){var de=dl(le,vi(w),w.mul(K)),Ee=Ga(ee.shape,w.shape);return Ee.length>0&&(de=de.sum(Ee)),de.reshape(ee.shape)}}},"Prelu")}}),Cg=Lt({relu_:function(b){var p=Ze(b,"x","relu");return p.dtype==="bool"?p.toInt():He.runKernelFunc(function(l,m){var w=l.relu(p);return m([p]),w},{x:p},function(l,m){var w=m[0];return{x:function(){return l.mulStrict(w.step().toFloat())}}},"Relu")}}),S0=Lt({relu6_:function(b){var p=Ze(b,"x","relu6");return p.dtype==="bool"?p.toInt():He.runKernelFunc(function(l,m){var w=l.relu6(p);return m([p]),w},{x:p},function(l,m){var w=m[0],P=w.lessEqual(6).mul(w.step());return{x:function(){return l.mulStrict(P.toFloat())}}},"Relu6")}}),km=Lt({selu_:function(b){var p=Ze(b,"x","selu");return He.runKernelFunc(function(l,m){var w=l.selu(p);return m([p]),w},{$x:p},function(l,m){var w=m[0];return{$x:function(){var P=w.greater(Ar(0)),K=Ar(j1),ee=Ar(z1),le=l.mul(ee),de=l.mul(K).mul(w.toFloat().exp());return dl(P,le,de)}}})}}),Am=Lt({localResponseNormalization_:function(b,p,l,m,w){p===void 0&&(p=5),l===void 0&&(l=1),m===void 0&&(m=1),w===void 0&&(w=.5);var P=Ze(b,"x","localResponseNormalization");we(P.rank===4||P.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+P.rank+"."}),we(Ft(p),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+p+"."});var K=P,ee=!1;P.rank===3&&(ee=!0,K=P.as4D(1,P.shape[0],P.shape[1],P.shape[2]));var le=He.runKernelFunc(function(de,Ee){var Te=de.localResponseNormalization4D(K,p,l,m,w);return Ee([K,Te]),Te},{x4D:K},function(de,Ee){var Te=Ee[0],Ne=Ee[1];return{x4D:function(){return He.runKernelFunc(function(Fe){return Fe.LRNGrad(de,Te,Ne,p,l,m,w)},{})}}});return ee?le.as3D(le.shape[1],le.shape[2],le.shape[3]):le}}),C0=Lt({norm_:function(b,p,l,m){p===void 0&&(p="euclidean"),l===void 0&&(l=null),m===void 0&&(m=!1);var w=function ee(le,de,Ee){if(Ee===void 0&&(Ee=null),le.rank===0)return le.abs();if(le.rank!==1&&Ee===null)return ee(le.reshape([-1]),de,Ee);if(le.rank===1||typeof Ee=="number"||Array.isArray(Ee)&&Ee.length===1){if(de===1)return le.abs().sum(Ee);if(de===1/0)return le.abs().max(Ee);if(de===-1/0)return le.abs().min(Ee);if(de==="euclidean"||de===2)return le.abs().pow(Ar(2,"int32")).sum(Ee).sqrt();throw new Error("Error in norm: invalid ord value: "+de)}if(Array.isArray(Ee)&&Ee.length===2){if(de===1)return le.abs().sum(Ee[0]).max(Ee[1]-1);if(de===1/0)return le.abs().sum(Ee[1]).max(Ee[0]);if(de===-1/0)return le.abs().sum(Ee[1]).min(Ee[0]);if(de==="fro"||de==="euclidean")return le.square().sum(Ee).sqrt();throw new Error("Error in norm: invalid ord value: "+de)}throw new Error("Error in norm: invalid axis: "+Ee)}(b=Ze(b,"x","norm"),p,l),P=w.shape;if(m){var K=Xt(l,b.shape);P=Lo(w.shape,K)}return w.reshape(P)}}),Vv=Lt({basicLSTMCell_:function(b,p,l,m,w,P){var K=Ze(b,"forgetBias","basicLSTMCell"),ee=Ze(p,"lstmKernel","basicLSTMCell"),le=Ze(l,"lstmBias","basicLSTMCell"),de=Ze(m,"data","basicLSTMCell"),Ee=Ze(w,"c","basicLSTMCell"),Te=Ze(P,"h","basicLSTMCell"),Ne=de.concat(Te,1).matMul(ee).add(le),Fe=Ne.shape[0],qe=Ne.shape[1]/4,Je=[Fe,qe],Ke=Ne.slice([0,0],Je),it=Ne.slice([0,qe],Je),gt=Ne.slice([0,2*qe],Je),Et=Ne.slice([0,3*qe],Je),At=Ke.sigmoid().mulStrict(it.tanh()).addStrict(Ee.mulStrict(K.add(gt).sigmoid()));return[At,At.tanh().mulStrict(Et.sigmoid())]}}),zy=Lt({multiRNNCell_:function(b,p,l,m){for(var w=Ze(p,"data","multiRNNCell"),P=hc(l,"c","multiRNNCell"),K=hc(m,"h","multiRNNCell"),ee=w,le=[],de=0;de<b.length;de++){var Ee=b[de](ee,P[de],K[de]);le.push(Ee[0]),le.push(Ee[1]),ee=Ee[1]}var Te=[],Ne=[];for(de=0;de<le.length;de+=2)Te.push(le[de]),Ne.push(le[de+1]);return[Te,Ne]}}),ml=Lt({movingAverage_:function(b,p,l,m,w){w===void 0&&(w=!0);var P=Ze(b,"v","movingAverage"),K=Ze(p,"x","movingAverage"),ee=Ze(l,"decay","movingAverage");mn(P,K),we(Ut(P.shape,K.shape),function(){return"Shape mismatch in v and x"});var le=Ar(1),de=le.sub(ee),Ee=K.sub(P).mul(de);if(w){we(m!=null,function(){return"When using zeroDebias: true, step is required."});var Te=Ze(m,"step","movingAverage");Ee=Ee.div(le.sub(lu(ee,Te)))}return P.add(Ee)}}),Yd=Lt({stridedSlice_:function(b,p,l,m,w,P,K,ee,le){if(w===void 0&&(w=0),P===void 0&&(P=0),K===void 0&&(K=0),ee===void 0&&(ee=0),le===void 0&&(le=0),m==null&&(m=new Array(p.length)),K!==0)throw new Error("ellipsis mask is not yet supported");var de=Ze(b,"x","stridedSlice"),Ee=du(ee),Te=de.shape.slice();Ee.forEach(function(Ke){p[Ke]=0,l[Ke]=1,Te.splice(Ke,0,1)}),de=de.reshape(Te);for(var Ne=0;Ne<de.rank;Ne++)p[Ne]=Qu(w,p,m,de.shape,Ne),l[Ne]=Cu(P,l,m,de.shape,Ne),m[Ne]=m[Ne]||1;var Fe=du(le);Fe.forEach(function(Ke){l[Ke]=p[Ke]+1,m[Ke]=1});var qe=Ju(p,l,m),Je=qe.filter(function(Ke,it){return Fe.indexOf(it)===-1});return m.every(function(Ke){return Ke===1})?ms(de,p,qe).reshape(Je):He.runKernelFunc(function(Ke){return Ke.stridedSlice(de,p,l,m)},{$x:de}).reshape(Je)}}),Uy=Lt({topk_:function(b,p,l){p===void 0&&(p=1),l===void 0&&(l=!0);var m=Ze(b,"x","topk");if(m.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var w=m.shape[m.shape.length-1];if(p>w)throw new Error("'k' passed to topk() must be <= the last dimension ("+w+") but got "+p);var P=He.runKernelFunc(function(K){return K.topk(m,p,l)},{$x:m});return{values:P[0],indices:P[1]}}}),Hv=Lt({scatterND_:function(b,p,l){var m=Ze(b,"indices","scatterND","int32"),w=Ze(p,"updates","scatterND");return Ll(w,m,l),He.runKernelFunc(function(P){return P.scatterND(m,w,l)},{indices:m,updates:w},null,"ScatterNd",{shape:l})}}),gl=Lt({fft_:function(b){we(b.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+b.dtype+"."});var p=b.shape[b.shape.length-1],l=b.size/p,m=b.as2D(l,p);return He.runKernelFunc(function(w){return w.fft(m)},{input:b}).reshape(b.shape)}}),as=Lt({ifft_:function(b){we(b.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+b.dtype+"."});var p=b.shape[b.shape.length-1],l=b.size/p,m=b.as2D(l,p);return He.runKernelFunc(function(w){return w.ifft(m)},{input:b}).reshape(b.shape)}}),ap=Lt({rfft_:function(b,p){we(b.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+b.dtype});var l,m=b.shape[b.shape.length-1],w=b.size/m;if(p!=null&&p<m){var P=b.shape.map(function(it){return 0}),K=b.shape.map(function(it){return it});K[b.shape.length-1]=p,l=b.slice(P,K),m=p}else if(p!=null&&p>m){var ee=b.shape.map(function(it){return it});ee[b.shape.length-1]=p-m,l=b.concat(uo(ee),b.shape.length-1),m=p}else l=b;var le=l.zerosLike(),de=Co(l,le).as2D(w,m),Ee=gl(de),Te=Math.floor(m/2)+1,Ne=xa(Ee),Fe=Za(Ee),qe=Ne.split([Te,m-Te],Ne.shape.length-1),Je=Fe.split([Te,m-Te],Fe.shape.length-1),Ke=l.shape.slice();return Ke[l.shape.length-1]=Te,Co(qe[0],Je[0]).reshape(Ke)}}),Om=Lt({irfft_:function(b){var p=b.shape[b.shape.length-1],l=b.size/p;if(p<=2){var m=b.as2D(l,p),w=as(m);return xa(w)}var P=[l,2*(p-1)],K=xa(b).as2D(l,p),ee=Za(b).as2D(l,p),le=K.slice([0,1],[l,p-2]).reverse(1),de=ee.slice([0,1],[l,p-2]).reverse(1).mul(Ar(-1)),Ee=K.concat(le,1),Te=ee.concat(de,1);return m=Co(Ee,Te).as2D(P[0],P[1]),w=as(m),xa(w)}}),kg=Object.freeze({fft:gl,ifft:as,rfft:ap,irfft:Om}),Gv=Lt({sparseToDense_:function(b,p,l,m){m===void 0&&(m=0);var w=Ze(b,"sparseIndices","sparseToDense","int32"),P=Ze(p,"sparseValues","sparseToDense"),K=Ze(m,"defaultValue","sparseToDense",P.dtype);return function(ee,le,de,Ee){if(ee.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+ee.dtype+".");if(ee.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+ee.shape+".");var Te=ee.rank>0?ee.shape[0]:1,Ne=ee.rank>1?ee.shape[1]:1;if(de.length!==Ne)throw new Error("outputShape has incorrect number of elements:, "+de.length+", should be: "+Ne+".");var Fe=le.size;if(le.rank!==0&&(le.rank!==1||Fe!==Te))throw new Error("sparseValues has incorrect shape "+le.shape+", should be [] or ["+Te+"]");if(le.dtype!==Ee.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(w,P,l,K),He.runKernelFunc(function(ee){return ee.sparseToDense(w,P,l,K)},{$sparseIndices:w,$sparseValues:P,$defaultValue:K})}}),Ag=Lt({gatherND_:function(b,p){var l=Ze(p,"indices","gatherND","int32"),m=Ze(b,"x","gatherND");return He.runKernelFunc(function(w){return w.gatherND(m,l)},{x:m,indices:l},null,"GatherNd")}}),Vf=Lt({diag_:function(b){var p=Ze(b,"x","diag").flatten(),l=b.shape.concat(b.shape);return He.runKernelFunc(function(m){return m.diag(p)},{$x:p}).reshape(l)}}),V1=Lt({dropout_:function(b,p,l,m){var w=Ze(b,"x","dropout");if(we(w.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+w.dtype+" tensor instead."}),we(p>=0&&p<1,function(){return"rate must be a float in the range [0, 1), but got "+p+"."}),p===0)return b instanceof Qt?w.clone():w;var P=function(le,de){if(de==null)return le.shape.slice();if(Ut(le.shape,de))return de;if(le.shape.length===de.length){for(var Ee=[],Te=0;Te<le.shape.length;Te++)de[Te]==null&&le.shape[Te]!=null?Ee.push(le.shape[Te]):Ee.push(de[Te]);return Ee}return de}(w,l),K=1-p,ee=pg(P,0,1,"float32",m).add(K).floor().div(K);return w.mul(ee)}});function Og(b,p,l){for(var m=1-b%2,w=new Float32Array(b),P=0;P<b;++P){var K=2*Math.PI*P/(b+m-1);w[P]=p-l*Math.cos(K)}return au(w,"float32")}var es,Tm=Lt({hannWindow_:function(b){return Og(b,.5,.5)}}),Jd=Lt({hammingWindow_:function(b){return Og(b,.54,.46)}}),Tg=Lt({frame_:function(b,p,l,m,w){m===void 0&&(m=!1),w===void 0&&(w=0);for(var P=0,K=[];P+p<=b.size;)K.push(ms(b,P,p)),P+=l;if(m)for(;P<b.size;){var ee=P+p-b.size,le=$o([ms(b,P,p-ee),Rs([ee],w)]);K.push(le),P+=l}return K.length===0?Eu([],[0,p]):$o(K).as2D(K.length,p)}}),Mm=Lt({stft_:function(b,p,l,m,w){var P;w===void 0&&(w=Tm),m==null&&(P=p,m=Math.floor(Math.pow(2,Math.ceil(Math.log(P)/Math.log(2)))));for(var K=Tg(b,p,l),ee=oa(K,w(p)),le=[],de=0;de<K.shape[0];de++)le.push(ap(ee.slice([de,0],[1,p]),m));return $o(le)}}),k0=Object.freeze({hannWindow:Tm,hammingWindow:Jd,frame:Tg,stft:Mm}),A0=function(b,p,l){return l===void 0&&(l=1),D(this,void 0,void 0,function(){var m,w,P,K,ee,le,de,Ee,Te,Ne,Fe,qe,Je,Ke;return R(this,function(it){switch(it.label){case 0:return m=Ze(b,"predictions","inTopK"),w=Ze(p,"targets","inTopK"),we(m.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+m.rank}),we(m.rank-1===w.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+m.rank+" and targets rank "+w.rank}),yt(m.shape.slice(0,m.shape.length-1),w.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),P=m.shape[m.shape.length-1],we(l>0&&l<=P,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+P+"), but got "+l}),[4,m.data()];case 1:return K=it.sent(),[4,w.data()];case 2:for(ee=it.sent(),le=[K.length/P,P],Ee=le[1],Te=kn("bool",de=le[0]),Ne=0;Ne<de;Ne++){for(Fe=Ne*Ee,qe=K.subarray(Fe,Fe+Ee),Je=[],Ke=0;Ke<qe.length;Ke++)Je.push({value:qe[Ke],index:Ke});for(Je.sort(function(gt,Et){return Et.value-gt.value}),Te[Ne]=0,Ke=0;Ke<l;Ke++)if(Je[Ke].index===ee[Ne]){Te[Ne]=1;break}}return b!==m&&m.dispose(),p!==w&&w.dispose(),[2,No(Te,w.shape,"bool")]}})})};(function(b){b[b.NONE=0]="NONE",b[b.MEAN=1]="MEAN",b[b.SUM=2]="SUM",b[b.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(es||(es={}));var Hf=Lt({absoluteDifference_:function(b,p,l,m){m===void 0&&(m=es.SUM_BY_NONZERO_WEIGHTS);var w=Ze(b,"labels","absoluteDifference"),P=Ze(p,"predictions","absoluteDifference"),K=null;l!=null&&(K=Ze(l,"weights","absoluteDifference")),yt(w.shape,P.shape,"Error in absoluteDifference: ");var ee=w.sub(P).abs();return xc(ee,K,m)}}),xc=Lt({computeWeightedLoss_:function(b,p,l){l===void 0&&(l=es.SUM_BY_NONZERO_WEIGHTS);var m=Ze(b,"losses","computeWeightedLoss"),w=null;p!=null&&(w=Ze(p,"weights","computeWeightedLoss"));var P=w==null?m:m.mul(w);if(l===es.NONE)return P;if(l===es.SUM)return P.sum();if(l===es.MEAN){if(w==null)return P.mean();var K=m.size/w.size,ee=P.sum().div(w.sum());return K>1?ee.div(Ar(K)):ee}if(l===es.SUM_BY_NONZERO_WEIGHTS){if(w==null)return P.sum().div(Ar(m.size));var le=w.mul(Fu(m.shape)).notEqual(Ar(0)).sum().toFloat();return P.sum().div(le)}throw Error("Unknown reduction: "+l)}}),qv=Lt({cosineDistance_:function(b,p,l,m,w){w===void 0&&(w=es.SUM_BY_NONZERO_WEIGHTS);var P=Ze(b,"labels","cosineDistance"),K=Ze(p,"predictions","cosineDistance"),ee=null;m!=null&&(ee=Ze(m,"weights","cosineDistance")),yt(P.shape,K.shape,"Error in cosineDistance: ");var le=Ar(1).sub(P.mul(K).sum(l,!0));return xc(le,ee,w)}}),$v=Lt({hingeLoss_:function(b,p,l,m){m===void 0&&(m=es.SUM_BY_NONZERO_WEIGHTS);var w=Ze(b,"labels","hingeLoss"),P=Ze(p,"predictions","hingeLoss"),K=null;l!=null&&(K=Ze(l,"weights","hingeLoss")),yt(w.shape,P.shape,"Error in hingeLoss: ");var ee=Ar(1);w=Ar(2).mul(w).sub(ee);var le=ee.sub(w.mul(P)).relu();return xc(le,K,m)}}),sp=Lt({huberLoss_:function(b,p,l,m,w){m===void 0&&(m=1),w===void 0&&(w=es.SUM_BY_NONZERO_WEIGHTS);var P=Ze(b,"labels","huberLoss"),K=Ze(p,"predictions","huberLoss"),ee=null;l!=null&&(ee=Ze(l,"weights","huberLoss")),yt(P.shape,K.shape,"Error in huberLoss: ");var le=Ar(m),de=K.sub(P).abs(),Ee=Xu(de,le),Te=de.sub(Ee),Ne=Ar(.5).mul(Ee.square()).add(le.mul(Te));return xc(Ne,ee,w)}}),Dm=Lt({logLoss_:function(b,p,l,m,w){m===void 0&&(m=1e-7),w===void 0&&(w=es.SUM_BY_NONZERO_WEIGHTS);var P=Ze(b,"labels","logLoss"),K=Ze(p,"predictions","logLoss"),ee=null;l!=null&&(ee=Ze(l,"weights","logLoss")),yt(P.shape,K.shape,"Error in logLoss: ");var le=Ar(1),de=Ar(m),Ee=P.mul(K.add(de).log()).neg().sub(le.sub(P).mul(le.sub(K).add(de).log()));return xc(Ee,ee,w)}}),Wy=Lt({meanSquaredError_:function(b,p,l,m){m===void 0&&(m=es.SUM_BY_NONZERO_WEIGHTS);var w=Ze(b,"labels","meanSquaredError"),P=Ze(p,"predictions","meanSquaredError"),K=null;l!=null&&(K=Ze(l,"weights","meanSquaredError")),yt(w.shape,P.shape,"Error in meanSquaredError: ");var ee=w.squaredDifference(P);return xc(ee,K,m)}}),O0=Lt({sigmoidCrossEntropy_:function(b,p,l,m,w){m===void 0&&(m=0),w===void 0&&(w=es.SUM_BY_NONZERO_WEIGHTS);var P=Ze(b,"multiClassLabels","sigmoidCrossEntropy"),K=Ze(p,"logits","sigmoidCrossEntropy"),ee=null;if(l!=null&&(ee=Ze(l,"weights","sigmoidCrossEntropy")),yt(P.shape,K.shape,"Error in sigmoidCrossEntropy: "),m>0){var le=Ar(m),de=Ar(1),Ee=Ar(.5);P=P.mul(de.sub(le)).add(Ee.mul(le))}var Te=function(Ne,Fe){var qe=Ze(Ne,"labels","sigmoidCrossEntropyWithLogits"),Je=Ze(Fe,"logits","sigmoidCrossEntropyWithLogits");yt(qe.shape,Je.shape,"Error in sigmoidCrossEntropyWithLogits: ");var Ke=Je.relu(),it=Je.mul(qe),gt=Je.abs().neg().exp().log1p();return Ke.sub(it).add(gt)}(P,K);return xc(Te,ee,w)}}),Mg=Lt({softmaxCrossEntropy_:function(b,p,l,m,w){m===void 0&&(m=0),w===void 0&&(w=es.SUM_BY_NONZERO_WEIGHTS);var P=Ze(b,"onehotLabels","softmaxCrossEntropy"),K=Ze(p,"logits","softmaxCrossEntropy"),ee=null;if(l!=null&&(ee=Ze(l,"weights","softmaxCrossEntropy")),yt(P.shape,K.shape,"Error in softmaxCrossEntropy: "),m>0){var le=Ar(m),de=Ar(1),Ee=Ar(P.shape[1]);P=P.mul(de.sub(le)).add(le.div(Ee))}var Te=function(Ne,Fe,qe){if(qe===void 0&&(qe=-1),qe===-1&&(qe=Fe.rank-1),qe!==Fe.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+Fe.rank+" and dim was "+qe);return G(function(Je,Ke,it){var gt=Ke.logSumExp([qe],!0),Et=Ke.toFloat().sub(gt);return it([Je,Et]),{value:Et.mul(Je).neg().sum([qe]),gradFunc:function(At,Wt){var cn=Wt[0],pn=Wt[1],ln=Lo(At.shape,[qe]);return[At.reshape(ln).mul(cn.toFloat().sub(pn.exp())),At.reshape(ln).mul(pn.exp().sub(cn.toFloat()))]}}})(Ne,Fe)}(P,K);return xc(Te,ee,w)}}),Yr=Object.freeze({get Reduction(){return es},absoluteDifference:Hf,computeWeightedLoss:xc,cosineDistance:qv,hingeLoss:$v,huberLoss:sp,logLoss:Dm,meanSquaredError:Wy,sigmoidCrossEntropy:O0,softmaxCrossEntropy:Mg});function $(b,p){return p===void 0&&(p=!1),He.tidy(function(){if(b.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+b.shape.length+"D Tensor.");for(var l=b.shape[0],m=b.shape[1],w=hl(l),P=b.clone(),K=Eu([[1]],[1,1]),ee=K.clone(),le=l>=m?m:l,de=function(Te){var Ne,Fe=P,qe=ee,Je=w;Ne=He.tidy(function(){var Ke=P.slice([Te,Te],[l-Te,1]),it=Ke.norm(),gt=P.slice([Te,Te],[1,1]),Et=Eu([[-1]]).where(gt.greater(0),Eu([[1]])),At=gt.sub(Et.mul(it)),Wt=Ke.div(At);ee=Wt.shape[0]===1?K.clone():K.concat(Wt.slice([1,0],[Wt.shape[0]-1,Wt.shape[1]]),0);var cn=Et.matMul(At).div(it).neg(),pn=P.slice([Te,0],[l-Te,m]),ln=cn.mul(ee),dn=ee.transpose();if(Te===0)P=pn.sub(ln.matMul(dn.matMul(pn)));else{var Nn=pn.sub(ln.matMul(dn.matMul(pn)));P=P.slice([0,0],[Te,m]).concat(Nn,0)}var jn=ln.transpose(),Ln=w.slice([0,Te],[l,w.shape[1]-Te]);if(Te===0)w=Ln.sub(Ln.matMul(ee).matMul(jn));else{var ur=Ln.sub(Ln.matMul(ee).matMul(jn));w=w.slice([0,0],[l,Te]).concat(ur,1)}return[ee,P,w]}),ee=Ne[0],P=Ne[1],w=Ne[2],zo([Fe,qe,Je])},Ee=0;Ee<le;++Ee)de(Ee);return!p&&l>m&&(w=w.slice([0,0],[l,m]),P=P.slice([0,0],[m,m])),[w,P]})}var M=Lt({bandPart_:function(b,p,l){if(p%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+p+".");if(l%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+l+".");var m=Ze(b,"a","bandPart");if(m.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+m.rank+".");var w=m.shape,P=m.shape.slice(-2),K=P[0],ee=P[1];if(!(p<=K))throw new Error("bandPart(): numLower ("+p+") must not be greater than the number of rows ("+K+").");if(!(l<=ee))throw new Error("bandPart(): numUpper ("+l+") must not be greater than the number of columns ("+ee+").");p<0&&(p=K),l<0&&(l=ee);var le=Rc(0,K,1,"int32").reshape([-1,1]),de=Rc(0,ee,1,"int32"),Ee=Ua(le,de),Te=rc(Ee.lessEqual(Ar(+p,"int32")),Ee.greaterEqual(Ar(-l,"int32"))),Ne=uo([K,ee],m.dtype);return Su(Lh(m.reshape([-1,K,ee])).map(function(Fe){return dl(Te,Fe,Ne)})).reshape(w)}}),T=Lt({gramSchmidt_:function(b){var p;if(Array.isArray(b)){p=!1,we(b!=null&&b.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var l=b[0].shape[0],m=function(le){we(b[le].shape[0]===l,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+b[le].shape[0]+" vs. "+l+")"})},w=1;w<b.length;++w)m(w)}else p=!0,b=$i(b,b.shape[0],0).map(function(le){return Ks(le,[0])});we(b.length<=b[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+b.length+") exceeds number of dimensions ("+b[0].shape[0]+")."});var P=[],K=b,ee=function(le){P.push(He.tidy(function(){var de=K[le];if(le>0)for(var Ee=0;Ee<le;++Ee){var Te=Jl(P[Ee].mulStrict(de)).mul(P[Ee]);de=de.sub(Te)}return de.div(C0(de,"euclidean"))}))};for(w=0;w<b.length;++w)ee(w);return p?Su(P,0):P}}),O=Lt({qr_:function(b,p){if(p===void 0&&(p=!1),b.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+b.rank);if(b.rank===2)return $(b,p);var l=b.shape.slice(0,b.shape.length-2).reduce(function(P,K){return P*K}),m=[],w=[];return Lh(b.reshape([l,b.shape[b.shape.length-2],b.shape[b.shape.length-1]]),0).forEach(function(P){var K=$(P,p),ee=K[0],le=K[1];m.push(ee),w.push(le)}),[Su(m,0).reshape(b.shape),Su(w,0).reshape(b.shape)]}}),L=Object.freeze({bandPart:M,gramSchmidt:T,qr:O});function J(b,p,l,m,w,P){m==null&&(m=.5),w==null&&(w=Number.NEGATIVE_INFINITY),P==null&&(P=0);var K=b.shape[0];return l=Math.min(l,K),we(0<=m&&m<=1,function(){return"iouThreshold must be in [0, 1], but was '"+m+"'"}),we(b.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+b.rank+"'"}),we(b.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+b.shape[1]}),we(p.rank===1,function(){return"scores must be a 1D tensor"}),we(p.shape[0]===K,function(){return"scores has incompatible shape with boxes. Expected "+K+", but was "+p.shape[0]}),we(0<=P&&P<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+P+"'"}),{maxOutputSize:l,iouThreshold:m,scoreThreshold:w,softNmsSigma:P}}var ie=Lt({resizeBilinear_:function(b,p,l){l===void 0&&(l=!1);var m=Ze(b,"images","resizeBilinear");we(m.rank===3||m.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+m.rank+"."}),we(p.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+p+"."});var w=m,P=!1;m.rank===3&&(P=!0,w=m.as4D(1,m.shape[0],m.shape[1],m.shape[2]));var K=p[0],ee=p[1],le=He.runKernelFunc(function(de,Ee){return Ee([w]),de.resizeBilinear(w,K,ee,l)},{x:w},function(de,Ee){return{x:function(){return He.runKernelFunc(function(Te){return Te.resizeBilinearBackprop(de,Ee[0],l)},{})}}},"ResizeBilinear",{alignCorners:l,newHeight:K,newWidth:ee});return P?le.as3D(le.shape[1],le.shape[2],le.shape[3]):le}}),ge=Lt({resizeNearestNeighbor_:function(b,p,l){l===void 0&&(l=!1);var m=Ze(b,"images","resizeNearestNeighbor");we(m.rank===3||m.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+m.rank+"."}),we(p.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+p+"."}),we(m.dtype==="float32"||m.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var w=m,P=!1;m.rank===3&&(P=!0,w=m.as4D(1,m.shape[0],m.shape[1],m.shape[2]));var K=p[0],ee=p[1],le=He.runKernelFunc(function(de,Ee){return Ee([w]),de.resizeNearestNeighbor(w,K,ee,l)},{batchImages:w},function(de,Ee){return{batchImages:function(){return He.runKernelFunc(function(Te){return Te.resizeNearestNeighborBackprop(de,Ee[0],l)},{})}}});return P?le.as3D(le.shape[1],le.shape[2],le.shape[3]):le}}),Ae=Lt({nonMaxSuppression_:function(b,p,l,m,w){m===void 0&&(m=.5),w===void 0&&(w=Number.NEGATIVE_INFINITY);var P=Ze(b,"boxes","nonMaxSuppression"),K=Ze(p,"scores","nonMaxSuppression"),ee=J(P,K,l,m,w);l=ee.maxOutputSize,m=ee.iouThreshold,w=ee.scoreThreshold;var le={maxOutputSize:l,iouThreshold:m,scoreThreshold:w};return He.runKernelFunc(function(de){return de.nonMaxSuppression(P,K,l,m,w)},{boxes:P,scores:K},null,"NonMaxSuppressionV3",le)}}),Ie=Lt({nonMaxSuppressionWithScore_:function(b,p,l,m,w,P){m===void 0&&(m=.5),w===void 0&&(w=Number.NEGATIVE_INFINITY),P===void 0&&(P=0);var K=Ze(b,"boxes","nonMaxSuppression"),ee=Ze(p,"scores","nonMaxSuppression"),le=J(K,ee,l,m,w,P),de={maxOutputSize:l=le.maxOutputSize,iouThreshold:m=le.iouThreshold,scoreThreshold:w=le.scoreThreshold,softNmsSigma:P=le.softNmsSigma},Ee=He.runKernel("NonMaxSuppressionV5",{boxes:K,scores:ee},de);return{selectedIndices:Ee[0],selectedScores:Ee[1]}}}),De=Lt({cropAndResize_:function(b,p,l,m,w,P){var K=Ze(b,"image","cropAndResize"),ee=Ze(p,"boxes","cropAndResize","float32"),le=Ze(l,"boxInd","cropAndResize","int32");w=w||"bilinear",P=P||0;var de=ee.shape[0];return we(K.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+K.rank+"."}),we(ee.rank===2&&ee.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+de+",4] but had shape "+ee.shape+"."}),we(le.rank===1&&le.shape[0]===de,function(){return"Error in cropAndResize: boxInd must be have size ["+de+"] but had shape "+ee.shape+"."}),we(m.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+m.length+"."}),we(m[0]>=1&&m[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+m}),we(w==="bilinear"||w==="nearest",function(){return"method must be bilinear or nearest, but was "+w}),He.runKernelFunc(function(Ee,Te){return Ee.cropAndResize(K,ee,le,m,w,P)},{images:K,boxes:ee,boxInd:le},null,"CropAndResize",{method:w,extrapolationValue:P,cropSize:m})}}),et=Object.freeze({resizeBilinear:ie,resizeNearestNeighbor:ge,nonMaxSuppression:Ae,nonMaxSuppressionAsync:function(b,p,l,m,w){return m===void 0&&(m=.5),w===void 0&&(w=Number.NEGATIVE_INFINITY),D(this,void 0,void 0,function(){var P,K,ee,le,de,Ee,Te;return R(this,function(Ne){switch(Ne.label){case 0:return P=Ze(b,"boxes","nonMaxSuppressionAsync"),K=Ze(p,"scores","nonMaxSuppressionAsync"),ee=J(P,K,l,m,w),l=ee.maxOutputSize,m=ee.iouThreshold,w=ee.scoreThreshold,[4,Promise.all([P.data(),K.data()])];case 1:return le=Ne.sent(),de=le[0],Ee=le[1],Te=pa(de,Ee,l,m,w),P!==b&&P.dispose(),K!==p&&K.dispose(),[2,Te]}})})},nonMaxSuppressionWithScore:Ie,nonMaxSuppressionWithScoreAsync:function(b,p,l,m,w,P){return m===void 0&&(m=.5),w===void 0&&(w=Number.NEGATIVE_INFINITY),P===void 0&&(P=0),D(this,void 0,void 0,function(){var K,ee,le,de,Ee,Te,Ne;return R(this,function(Fe){switch(Fe.label){case 0:return K=Ze(b,"boxes","nonMaxSuppressionAsync"),ee=Ze(p,"scores","nonMaxSuppressionAsync"),le=J(K,ee,l,m,w,P),l=le.maxOutputSize,m=le.iouThreshold,w=le.scoreThreshold,P=le.softNmsSigma,[4,Promise.all([K.data(),ee.data()])];case 1:return de=Fe.sent(),Ee=de[0],Te=de[1],Ne=Go(Ee,Te,l,m,w,P),K!==b&&K.dispose(),ee!==p&&ee.dispose(),[2,Ne]}})})},cropAndResize:De}),ot=function(b,p){return!(b>0)||p==="linear"},zt=function(b,p,l){if(l==null||l==="linear")return b;if(l==="relu")return b.mul(p.step());throw new Error("Gradient for activation "+l+" has not been implemented yet.")},Ht=function(b,p){var l=p,m=Ga(b.shape,p.shape);return m.length>0&&(l=l.sum(m)),l.reshape(b.shape)},xn=function(b,p,l){if(p==="linear")return b;if(p==="relu")return Cg(b);if(p==="elu")return Kd(b);if(p==="relu6")return S0(b);if(p==="prelu")return gs(b,l);throw new Error("Unknown fused activation "+p+".")},En=Lt({fusedMatMul_:function(b){var p,l=b.a,m=b.b,w=b.transposeA,P=w!==void 0&&w,K=b.transposeB,ee=K!==void 0&&K,le=b.bias,de=b.activation,Ee=de===void 0?"linear":de,Te=b.preluActivationWeights;if(ot(He.state.gradientDepth,Ee)===!1){var Ne=Vc(l,m,P,ee);return le!=null&&(Ne=ha(Ne,le)),xn(Ne,Ee,Te)}var Fe=Ze(l,"a","fused matMul"),qe=Ze(m,"b","fused matMul");p=Zt(Fe,qe),Fe=p[0],qe=p[1];var Je=P?Fe.shape[Fe.rank-2]:Fe.shape[Fe.rank-1],Ke=ee?qe.shape[qe.rank-1]:qe.shape[qe.rank-2],it=P?Fe.shape[Fe.rank-1]:Fe.shape[Fe.rank-2],gt=ee?qe.shape[qe.rank-2]:qe.shape[qe.rank-1],Et=Fe.shape.slice(0,-2),At=qe.shape.slice(0,-2),Wt=ze(Et),cn=ze(At);we(Fe.rank>=2&&qe.rank>=2&&Fe.rank===qe.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+Fe.rank+" and "+qe.rank+"."}),we(Ut(Et,At),function(){return"Error in fused matMul: outer dimensions ("+Et+") and ("+At+") of Tensors with shapes "+Fe.shape+" and "+qe.shape+" must match."}),we(Je===Ke,function(){return"Error in fused matMul: inner shapes ("+Je+") and ("+Ke+") of Tensors with shapes "+Fe.shape+" and "+qe.shape+" and transposeA="+P+" and transposeB="+ee+" must match."});var pn,ln,dn=Fe.shape.slice(0,-2).concat([it,gt]),Nn=P?Fe.as3D(Wt,Je,it):Fe.as3D(Wt,it,Je),jn=ee?qe.as3D(cn,gt,Ke):qe.as3D(cn,Ke,gt);le!=null&&Xi(dn,(pn=Zt(pn=Ze(le,"bias","fused matMul"),Fe)[0]).shape),Te!=null&&(ln=Ze(Te,"prelu weights","fused matMul"));var Ln={a:Nn,b:jn};le!=null&&(Ln.bias=pn),Te!=null&&(Ln.preluActivationWeights=ln);var ur=[Nn,jn];return He.runKernelFunc(function(hr,xr){var Er=hr.fusedBatchMatMul({a:Nn,b:jn,transposeA:P,transposeB:ee,bias:pn,activation:Ee,preluActivationWeights:ln});return xr([Nn,jn,Er]),Er},Ln,function(hr,xr){var Er=xr[0],wr=xr[1],vr=xr[2],Lr=zt(hr,vr,Ee),Pr={};return le!=null&&(Pr={bias:function(){return Ht(pn,Lr)}}),Object.assign(P||ee?!P&&ee?{a:function(){return Lr.matMul(wr,!1,!1)},b:function(){return Lr.matMul(Er,!0,!1)}}:P&&!ee?{a:function(){return wr.matMul(Lr,!1,!0)},b:function(){return Er.matMul(Lr,!1,!1)}}:{a:function(){return wr.matMul(Lr,!0,!0)},b:function(){return Lr.matMul(Er,!0,!0)}}:{a:function(){return Lr.matMul(wr,!1,!0)},b:function(){return Er.matMul(Lr,!0,!1)}},Pr)},"_FusedMatMul",{transposeA:P,transposeB:ee,activation:Ee},ur,[!0]).reshape(dn)}}),Fn=Lt({fusedConv2d_:function(b){var p=b.x,l=b.filter,m=b.strides,w=b.pad,P=b.dataFormat,K=P===void 0?"NHWC":P,ee=b.dilations,le=ee===void 0?[1,1]:ee,de=b.dimRoundingMode,Ee=b.bias,Te=b.activation,Ne=Te===void 0?"linear":Te,Fe=b.preluActivationWeights;if(Ne=Ne||"linear",ot(He.state.gradientDepth,Ne)===!1){var qe=qd(p,l,m,w,K,le,de);return Ee!=null&&(qe=ha(qe,Ee)),xn(qe,Ne,Fe)}var Je=Ze(p,"x","conv2d"),Ke=Ze(l,"filter","conv2d"),it=Je,gt=!1;Je.rank===3&&(gt=!0,it=Je.as4D(1,Je.shape[0],Je.shape[1],Je.shape[2])),we(it.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+it.rank+"."}),we(Ke.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+Ke.rank+"."}),de!=null&&we(Ft(w),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+de+" but got pad "+w+"."}),we(it.shape[3]===Ke.shape[2],function(){return"Error in conv2d: depth of input ("+it.shape[3]+") must match input depth for filter "+Ke.shape[2]+"."}),we(Fr(m,le),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+le+"'"}),we(K==="NHWC",function(){return"Error in conv2d: got dataFormat of "+K+" but only NHWC is currently supported."});var Et,At,Wt=Gn(it.shape,Ke.shape,m,le,w,de);Ee!=null&&(Et=Zt(Et=Ze(Ee,"bias","fused conv2d"),Je)[0],Xi(Wt.outShape,Et.shape)),Fe!=null&&(At=Ze(Fe,"prelu weights","fused conv2d"));var cn={x:it,filter:Ke};Ee!=null&&(cn.bias=Et),Fe!=null&&(cn.preluActivationWeights=At);var pn=[Ke,it],ln=He.runKernelFunc(function(dn,Nn){var jn=dn.fusedConv2d({input:it,filter:Ke,convInfo:Wt,bias:Et,activation:Ne,preluActivationWeights:At});return Nn([Ke,it,jn]),jn},cn,function(dn,Nn){var jn=Nn,Ln=jn[0],ur=jn[1],hr=jn[2],xr=zt(dn,hr,Ne);we(ai(le),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+le+"'"});var Er={};return Ee!=null&&(Er={bias:function(){return Ht(Et,xr)}}),Object.assign({x:function(){return Xl(ur.shape,xr,Ln,m,w)},filter:function(){return Fv(ur,xr,Ln.shape,m,w)}},Er)},"FusedConv2D",{convInfo:Wt,activation:Ne},pn,[!0]);return gt?ln.as3D(ln.shape[1],ln.shape[2],ln.shape[3]):ln}}),Rn=Lt({fusedDepthwiseConv2d_:function(b){var p=b.x,l=b.filter,m=b.strides,w=b.pad,P=b.dataFormat,K=P===void 0?"NHWC":P,ee=b.dilations,le=ee===void 0?[1,1]:ee,de=b.dimRoundingMode,Ee=b.bias,Te=b.activation,Ne=Te===void 0?"linear":Te,Fe=b.preluActivationWeights;if(ot(He.state.gradientDepth,Ne)===!1){var qe=b0(p,l,m,w,K,le,de);return Ee!=null&&(qe=ha(qe,Ee)),xn(qe,Ne,Fe)}var Je=Ze(p,"x","depthwiseConv2d"),Ke=Ze(l,"filter","depthwiseConv2d"),it=Je,gt=!1;Je.rank===3&&(gt=!0,it=Je.as4D(1,Je.shape[0],Je.shape[1],Je.shape[2])),we(it.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+it.rank+"."}),we(Ke.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+Ke.rank+"."}),we(it.shape[3]===Ke.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+it.shape[3]+") must match the inChannels dimension in filter "+Ke.shape[2]+"."}),le==null&&(le=[1,1]),we(Fr(m,le),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+le+"'"}),de!=null&&we(Ft(w),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+de+" but got pad "+w+"."});var Et,At,Wt=Gn(it.shape,Ke.shape,m,le,w,de,!0);Ee!=null&&(Et=Zt(Et=Ze(Ee,"bias","fused conv2d"),Je)[0],Xi(Wt.outShape,Et.shape)),Fe!=null&&(At=Ze(Fe,"prelu weights","fused depthwiseConv2d"));var cn={x:it,filter:Ke};Ee!=null&&(cn.bias=Et),Fe!=null&&(cn.preluActivationWeights=At);var pn=[Ke,it],ln=He.runKernelFunc(function(dn,Nn){var jn=dn.fusedDepthwiseConv2D({input:it,filter:Ke,convInfo:Wt,bias:Et,activation:Ne,preluActivationWeights:At});return Nn([Ke,it,jn]),jn},cn,function(dn,Nn){we(ai(le),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+le+"'"});var jn=Nn[0],Ln=Nn[1],ur=Nn[2],hr=zt(dn,ur,Ne),xr={};return Ee!=null&&(xr={bias:function(){return Ht(Et,hr)}}),Object.assign({x:function(){return Rv(Ln.shape,hr,jn,Wt)},filter:function(){return $d(Ln,hr,jn.shape,Wt)}},xr)},"FusedDepthwiseConv2D",{convInfo:Wt,activation:Ne},pn,[!0]);return gt?ln.as3D(ln.shape[1],ln.shape[2],ln.shape[3]):ln}}),Wn=Object.freeze({matMul:En,conv2d:Fn,depthwiseConv2d:Rn}),Jn=Object.freeze({image:et,linalg:L,losses:Yr,spectral:kg,fused:Wn,signal:k0,add:ha,addN:Ld,batchNorm:Ff,batchNormalization:go,batchNorm2d:Py,batchNormalization2d:Ry,batchNorm3d:Gl,batchNormalization3d:Rf,batchNorm4d:zd,batchNormalization4d:Qh,broadcastTo:Pf,clone:Lf,div:aa,divNoNan:cg,eye:hl,multinomial:ps,oneHot:Uc,pad:ic,pad1d:Ru,pad2d:ep,pad3d:lg,pad4d:h0,rand:p0,randomGamma:hg,randomNormal:Cv,randomUniform:pg,square:Bf,squaredDifference:mg,tile:Vd,truncatedNormal:tp,conv1d:Iv,conv2d:qd,conv3d:By,depthwiseConv2d:b0,separableConv2d:Kl,conv2dTranspose:bg,conv3dTranspose:x0,op:Lt,booleanMaskAsync:Mv,complex:Co,real:xa,imag:Za,concat:$o,concat1d:Rh,concat2d:Yp,concat3d:gf,concat4d:Ph,split:$i,matMul:Vc,dot:w0,outerProduct:Pv,reverse:zf,reverse1d:jy,reverse2d:np,reverse3d:rp,reverse4d:Uf,maxPool:Hc,avgPool:ip,pool:_m,maxPool3d:xg,avgPool3d:_0,maxPoolWithArgmax:Bv,slice:ms,slice1d:jv,slice2d:op,slice3d:zv,slice4d:wg,abs:Ls,acos:al,acosh:qa,asin:sl,asinh:mc,atan:Sd,atanh:Cd,ceil:Rl,clipByValue:tm,cos:gc,cosh:e0,erf:nm,exp:Ef,expm1:ig,floor:kd,log:Pl,log1p:rm,logSigmoid:Wh,neg:Da,reciprocal:Sf,round:Bs,rsqrt:Cf,sigmoid:Ad,sign:Vh,isNaN:im,isInf:Od,isFinite:kf,sin:om,sinh:am,softplus:bn,sqrt:uu,step:tr,tan:js,tanh:vo,all:Em,any:Yl,argMax:Uv,argMin:_g,logSumExp:Eg,max:E0,mean:pl,min:Sg,moments:Wv,sum:Jl,prod:Sm,equal:gg,equalStrict:m0,greater:g0,greaterEqual:bm,greaterEqualStrict:v0,greaterStrict:vg,less:kv,lessEqual:$l,lessEqualStrict:Ly,lessStrict:Av,notEqual:xm,notEqualStrict:Ov,addStrict:Af,atan2:Td,divStrict:mr,floorDiv:is,maximum:Na,maximumStrict:io,minimum:Xu,minimumStrict:Pc,mod:cu,modStrict:Lc,mul:oa,mulStrict:vc,pow:lu,powStrict:bo,squaredDifferenceStrict:Es,sub:Ua,subStrict:Ss,elu:Kd,leakyRelu:Cm,prelu:gs,relu:Cg,relu6:S0,selu:km,logicalAnd:rc,logicalNot:Zh,logicalOr:Ud,logicalXor:ql,where:dl,whereAsync:Wd,buffer:Ii,print:ma,batchToSpaceND:Jp,cast:Qp,cumsum:Zp,depthToSpace:ng,expandDims:pc,reshape:Ps,spaceToBatchND:Nl,squeeze:Ks,stack:Su,unstack:Lh,setdiff1dAsync:Hi,fill:Rs,linspace:Fh,ones:Fu,range:Rc,scalar:Ar,tensor:No,tensor1d:au,tensor2d:Eu,tensor3d:Dl,tensor4d:su,tensor5d:Ih,tensor6d:Xp,variable:Kp,zeros:uo,onesLike:_s,zerosLike:vi,transpose:bt,softmax:je,logSoftmax:Qe,localResponseNormalization:Am,norm:C0,gather:wm,unsortedSegmentSum:yg,basicLSTMCell:Vv,multiRNNCell:zy,movingAverage:ml,stridedSlice:Yd,topk:Uy,scatterND:Hv,fft:gl,ifft:as,rfft:ap,irfft:Om,sparseToDense:Gv,gatherND:Ag,diag:Vf,dropout:V1,hannWindow:Tm,hammingWindow:Jd,frame:Tg,stft:Mm,inTopKAsync:A0});function Tn(b,p){Array.isArray(b)||(b=[b]),b.forEach(function(l){l!=null&&we(l.dtype!=="complex64",function(){return p+" does not support complex64 tensors."})})}function _r(b,p,l,m,w,P){for(var K=w.strideHeight,ee=w.strideWidth,le=w.dilationHeight,de=w.dilationWidth,Ee=w.effectiveFilterHeight,Te=w.effectiveFilterWidth,Ne=w.padInfo.top,Fe=w.padInfo.left,qe=P==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,Je=Ii(w.outShape,l),Ke=Je.values,it=w.outShape[1]*w.outShape[2]*w.outShape[3],gt=w.outShape[2]*w.outShape[3],Et=w.outShape[3],At=0;At<w.batchSize;++At)for(var Wt=At*it,cn=At*m[0],pn=0;pn<w.inChannels;++pn)for(var ln=0;ln<w.outHeight;++ln)for(var dn=ln*K-Ne,Nn=Math.max(0,dn),jn=Math.min(w.inHeight,Ee+dn),Ln=Wt+ln*gt,ur=0;ur<w.outWidth;++ur){for(var hr=ur*ee-Fe,xr=Math.max(0,hr),Er=Math.min(w.inWidth,Te+hr),wr=qe,vr=0,Lr=0,Pr=Nn;Pr<jn;Pr+=le){for(var ei=cn+Pr*m[1],hi=xr;hi<Er;hi+=de){var Oi=b[ei+hi*m[2]+pn];P==="max"&&Oi>wr?wr=Oi:P==="avg"&&(vr+=Oi,Lr++)}if(isNaN(wr))break}Ke[Ln+ur*Et+pn]=P==="avg"?vr/Lr:wr}return Je}function Nr(b,p,l,m,w,P){w===void 0&&(w=!1),P===void 0&&(P=!1);for(var K=Ii(m.outShape,"int32"),ee=m.strideHeight,le=m.strideWidth,de=m.dilationHeight,Ee=m.dilationWidth,Te=m.effectiveFilterHeight,Ne=m.effectiveFilterWidth,Fe=m.padInfo.top,qe=m.padInfo.left,Je=Ii(p,l,b),Ke=0;Ke<m.batchSize;++Ke)for(var it=0;it<m.inChannels;++it)for(var gt=0;gt<m.outHeight;++gt){for(var Et=gt*ee-Fe,At=Et;At<0;)At+=de;for(var Wt=Math.min(m.inHeight,Te+Et),cn=0;cn<m.outWidth;++cn){for(var pn=cn*le-qe,ln=pn;ln<0;)ln+=Ee;for(var dn=Math.min(m.inWidth,Ne+pn),Nn=Number.NEGATIVE_INFINITY,jn=-1,Ln=At;Ln<Wt;Ln+=de)for(var ur=Ln-Et,hr=ln;hr<dn;hr+=Ee){var xr=hr-pn,Er=Je.get(Ke,Ln,hr,it);Er>Nn&&(Nn=Er,jn=w?P?((Ke*m.inHeight+Ln)*m.inWidth+hr)*m.inChannels+it:(Ln*m.inWidth+hr)*m.inChannels+it:ur*Ne+xr)}K.set(jn,Ke,gt,cn,it)}}return K}function Ir(b,p,l,m){if(l==="linear")return b.linear(p);if(l==="relu")return b.relu(p);if(l==="elu")return b.elu(p);if(l==="relu6")return b.relu6(p);if(l==="prelu")return b.prelu(p,m);throw new Error("Activation "+l+" has not been implemented for the CPU backend.")}var Qr=function(b){function p(){var l=b.call(this)||this;return l.blockSize=48,l.firstUse=!0,l.data=new qt(l,He),l}return B(p,b),p.prototype.write=function(l,m,w){this.firstUse&&(this.firstUse=!1,j().get("IS_NODE")&&Ml(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var P={};return this.data.set(P,{values:l,dtype:w}),P},p.prototype.move=function(l,m,w,P){this.data.set(l,{values:m,dtype:P})},p.prototype.numDataIds=function(){return this.data.numDataIds()},p.prototype.read=function(l){return D(this,void 0,void 0,function(){return R(this,function(m){return[2,this.readSync(l)]})})},p.prototype.readSync=function(l){var m=this.data.get(l),w=m.dtype,P=m.complexTensors;return w==="complex64"?gi(this.readSync(P.real.dataId),this.readSync(P.imag.dataId)):this.data.get(l).values},p.prototype.bufferSync=function(l){var m=this.readSync(l.dataId),w=m;if(l.dtype==="string")try{w=m.map(function(P){return On(P)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ii(l.shape,l.dtype,w)},p.prototype.makeOutput=function(l,m,w){var P=this.write(l,m,w);return He.makeTensorFromDataId(P,m,w,this)},p.prototype.disposeData=function(l){if(this.data.has(l)){var m=this.data.get(l).complexTensors;m!=null&&(m.real.dispose(),m.imag.dispose()),this.data.delete(l)}},p.prototype.time=function(l){return D(this,void 0,void 0,function(){var m;return R(this,function(w){return m=en(),l(),[2,{kernelMs:en()-m}]})})},p.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},p.prototype.complex=function(l,m){var w=this.makeOutput(null,l.shape,"complex64");return this.data.get(w.dataId).complexTensors={real:He.keep(l.clone()),imag:He.keep(m.clone())},w},p.prototype.real=function(l){return this.data.get(l.dataId).complexTensors.real.clone()},p.prototype.imag=function(l){return this.data.get(l.dataId).complexTensors.imag.clone()},p.prototype.slice=function(l,m,w){if(Tn(l,"slice"),Gh(l.shape,m,w)){var P=Md(m,l.strides),K=ze(w);return No(this.readSync(l.dataId).subarray(P,P+K),w,l.dtype)}for(var ee=Ii(w,l.dtype),le=this.bufferSync(l),de=0;de<ee.size;++de){var Ee=ee.indexToLoc(de).map(function(Te,Ne){return Te+m[Ne]});ee.values[de]=le.get.apply(le,Ee)}return ee.toTensor()},p.prototype.stridedSlice=function(l,m,w,P){Tn(l,"stridedSlice");var K=Ju(m,w,P);if(K.some(function(Fe){return Fe===0}))return No([],K);for(var ee=Ii(K,l.dtype),le=this.bufferSync(l),de=0;de<ee.size;de++){for(var Ee=ee.indexToLoc(de),Te=new Array(Ee.length),Ne=0;Ne<Te.length;Ne++)Te[Ne]=Ee[Ne]*P[Ne]+m[Ne];ee.set.apply(ee,[le.get.apply(le,Te)].concat(Ee))}return ee.toTensor()},p.prototype.diag=function(l){for(var m=this.readSync(l.dataId),w=Ii([l.size,l.size],l.dtype),P=w.values,K=0;K<m.length;K++)P[K*l.size+K]=m[K];return w.toTensor()},p.prototype.unstack=function(l,m){for(var w=l.shape[m],P=new Array(l.rank-1),K=0,ee=0;ee<l.rank;ee++)ee!==m&&(P[K++]=l.shape[ee]);var le=new Array(l.rank).fill(0),de=l.shape.slice();de[m]=1;var Ee=new Array(w);for(ee=0;ee<Ee.length;ee++)le[m]=ee,Ee[ee]=this.slice(l,le,de).reshape(P);return Ee},p.prototype.reverse=function(l,m){Tn(l,"reverse");for(var w=Ii(l.shape,l.dtype),P=this.bufferSync(l),K=function(le){var de=w.indexToLoc(le),Ee=de.slice();m.forEach(function(Te){return Ee[Te]=l.shape[Te]-1-Ee[Te]}),w.set.apply(w,[P.get.apply(P,Ee)].concat(de))},ee=0;ee<w.size;ee++)K(ee);return w.toTensor()},p.prototype.concat=function(l,m){var w=this;if(l[0].dtype==="complex64"){var P=l.map(function(Fe){return xa(Fe)}),K=l.map(function(Fe){return Za(Fe)});return Co(this.concat(P,m),this.concat(K,m))}var ee=l.map(function(Fe){var qe=ze(Fe.shape.slice(m));return Fe.as2D(-1,qe)}),le=_u(ee.map(function(Fe){return Fe.shape}),1),de=Ii(le,l[0].dtype).values;if(ee[0].shape[0]===1){var Ee=0;ee.forEach(function(Fe){de.set(w.readSync(Fe.dataId),Ee),Ee+=Fe.size})}else{var Te=0;ee.forEach(function(Fe){for(var qe=w.readSync(Fe.dataId),Je=0,Ke=0;Ke<Fe.shape[0];++Ke)for(var it=Ke*le[1]+Te,gt=0;gt<Fe.shape[1];++gt)de[it+gt]=qe[Je++];Te+=Fe.shape[1]})}var Ne=_u(l.map(function(Fe){return Fe.shape}),m);return No(de,Ne,l[0].dtype)},p.prototype.neg=function(l){return Tn(l,"neg"),this.multiply(Ar(-1),l)},p.prototype.add=function(l,m){return l.dtype==="complex64"||m.dtype==="complex64"?this.broadcastedBinaryComplexOp(l.cast("complex64"),m.cast("complex64"),function(w,P,K,ee){return{real:w+K,imag:P+ee}}):this.broadcastedBinaryOp(l,m,Sn(l.dtype,m.dtype),function(w,P){return w+P})},p.prototype.addN=function(l){var m=this;Tn(l,"addN");for(var w=l.map(function(Ee){return m.readSync(Ee.dataId)}),P=Ii(l[0].shape,l[0].dtype),K=P.values,ee=0;ee<l.length;ee++)for(var le=w[ee],de=0;de<K.length;de++)K[de]+=le[de];return P.toTensor()},p.prototype.softmax=function(l,m){var w=Xt([m],l.shape),P=this.max(l,w),K=Lo(P.shape,w),ee=this.subtract(l,P.reshape(K)),le=this.exp(ee),de=this.sum(le,w).reshape(K);return aa(le,de)},p.prototype.subtract=function(l,m){return l.dtype==="complex64"||m.dtype==="complex64"?this.broadcastedBinaryComplexOp(l.cast("complex64"),m.cast("complex64"),function(w,P,K,ee){return{real:w-K,imag:P-ee}}):this.broadcastedBinaryOp(l,m,Sn(l.dtype,m.dtype),function(w,P){return w-P})},p.prototype.pow=function(l,m){return Tn([l,m],"pow"),this.broadcastedBinaryOp(l,m,l.dtype,function(w,P){return Math.pow(w,P)})},p.prototype.batchMatMul=function(l,m,w,P){Tn([l,m],"matMul");for(var K=w?l.shape[1]:l.shape[2],ee=w?l.shape[2]:l.shape[1],le=P?m.shape[1]:m.shape[2],de=l.shape[0],Ee=this.readSync(l.dataId),Te=this.readSync(m.dataId),Ne=w?[l.strides[0],1,l.strides[1]]:[l.strides[0],l.strides[1],1],Fe=Ne[0],qe=Ne[1],Je=Ne[2],Ke=P?[1,m.strides[1],m.strides[0]]:[m.strides[1],1,m.strides[0]],it=Ke[0],gt=Ke[1],Et=Ke[2],At=ee*le,Wt=Ii([de,ee,le],l.dtype),cn=Wt.values,pn=this.blockSize,ln=0;ln<de;ln++)for(var dn=0;dn<ee;dn+=pn)for(var Nn=0;Nn<le;Nn+=pn)for(var jn=0;jn<K;jn+=pn)for(var Ln=Math.min(dn+pn,ee),ur=Math.min(Nn+pn,le),hr=Math.min(jn+pn,K),xr=dn;xr<Ln;xr++)for(var Er=Nn;Er<ur;Er++){for(var wr=0,vr=jn;vr<hr;vr++)wr+=Ee[ln*Fe+xr*qe+vr*Je]*Te[vr*it+Er*gt+ln*Et];cn[ln*At+(xr*le+Er)]+=wr}return Wt.toTensor()},p.prototype.fusedBatchMatMul=function(l){var m=l.a,w=l.b,P=l.transposeA,K=l.transposeB,ee=l.bias,le=l.activation,de=l.preluActivationWeights,Ee=this.batchMatMul(m,w,P,K);return ee&&(Ee=this.add(Ee,ee)),le&&(Ee=Ir(this,Ee,le,de)),Ee},p.prototype.multiply=function(l,m){return l.dtype==="complex64"||m.dtype==="complex64"?this.broadcastedBinaryComplexOp(l.cast("complex64"),m.cast("complex64"),function(w,P,K,ee){return{real:w*K-P*ee,imag:w*ee+P*K}}):this.broadcastedBinaryOp(l,m,Sn(l.dtype,m.dtype),function(w,P){return w*P})},p.prototype.floorDiv=function(l,m){return Tn([l,m],"floorDiv"),this.broadcastedBinaryOp(l,m,"int32",function(w,P){return Math.floor(w/P)})},p.prototype.sum=function(l,m){Tn(l,"sum"),ia("sum",m,l.rank);for(var w=Po(l.shape,m),P=w[0],K=w[1],ee=uo(P,Sn(l.dtype,"int32")),le=ze(K),de=this.readSync(ee.dataId),Ee=this.readSync(l.dataId),Te=0;Te<de.length;++Te){for(var Ne=Te*le,Fe=0,qe=0;qe<le;++qe)Fe+=Ee[Ne+qe];de[Te]=Fe}return ee},p.prototype.prod=function(l,m){Tn(l,"sum");for(var w=Po(l.shape,m),P=w[0],K=w[1],ee=uo(P,Sn(l.dtype,"int32")),le=ze(K),de=this.readSync(ee.dataId),Ee=this.readSync(l.dataId),Te=0;Te<de.length;++Te){for(var Ne=Te*le,Fe=1,qe=0;qe<le;++qe)Fe*=Ee[Ne+qe];de[Te]=Fe}return ee},p.prototype.unsortedSegmentSum=function(l,m,w){Tn(l,"unsortedSegmentSum");for(var P=[],K=l.rank-m.rank,ee=0;ee<K;++ee)m=m.expandDims(ee+1);for(ee=0;ee<w;++ee){var le=Ar(ee,"int32"),de=gg(le,m).asType("float32").mul(l).sum(0);P.push(de)}return Su(P)},p.prototype.argMin=function(l,m){Tn(l,"argMin");var w=[m];ia("argMin",w,l.rank);for(var P=Po(l.shape,w),K=P[0],ee=P[1],le=uo(K,"int32"),de=ze(ee),Ee=this.readSync(le.dataId),Te=this.readSync(l.dataId),Ne=0;Ne<Ee.length;++Ne){for(var Fe=Ne*de,qe=Te[Fe],Je=0,Ke=0;Ke<de;++Ke){var it=Te[Fe+Ke];it<qe&&(qe=it,Je=Ke)}Ee[Ne]=Je}return le},p.prototype.argMax=function(l,m){Tn(l,"argMax");var w=[m];ia("argMax",w,l.rank);for(var P=Po(l.shape,w),K=P[0],ee=P[1],le=uo(K,"int32"),de=ze(ee),Ee=this.readSync(le.dataId),Te=this.readSync(l.dataId),Ne=0;Ne<Ee.length;++Ne){for(var Fe=Ne*de,qe=Te[Fe],Je=0,Ke=0;Ke<de;++Ke){var it=Te[Fe+Ke];it>qe&&(qe=it,Je=Ke)}Ee[Ne]=Je}return le},p.prototype.cumsum=function(l,m,w,P){if(Tn(l,"cumsum"),m!==l.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(l.rank-1)+" but got axis="+m);for(var K=Sn(l.dtype,"int32"),ee=uo(l.shape,K),le=this.readSync(ee.dataId),de=this.readSync(l.dataId),Ee=l.shape[l.rank-1],Te=P?function(Ke,it){return Ke+Ee-it-1}:function(Ke,it){return Ke+it},Ne=0;Ne<de.length;Ne+=Ee)for(var Fe=0;Fe<Ee;Fe++){var qe=Te(Ne,Fe);if(Fe===0)le[qe]=w?0:de[qe];else{var Je=Te(Ne,Fe-1);le[qe]=w?de[Je]+le[Je]:de[qe]+le[Je]}}return ee},p.prototype.equal=function(l,m){return Tn([l,m],"equal"),this.broadcastedBinaryOp(l,m,"bool",function(w,P){return w===P?1:0})},p.prototype.notEqual=function(l,m){return Tn([l,m],"notEqual"),this.broadcastedBinaryOp(l,m,"bool",function(w,P){return w!==P?1:0})},p.prototype.less=function(l,m){return Tn([l,m],"less"),this.broadcastedBinaryOp(l,m,"bool",function(w,P){return w<P?1:0})},p.prototype.lessEqual=function(l,m){return Tn([l,m],"lessEqual"),this.broadcastedBinaryOp(l,m,"bool",function(w,P){return w<=P?1:0})},p.prototype.greater=function(l,m){return Tn([l,m],"greater"),this.broadcastedBinaryOp(l,m,"bool",function(w,P){return w>P?1:0})},p.prototype.greaterEqual=function(l,m){return Tn([l,m],"greaterEqual"),this.broadcastedBinaryOp(l,m,"bool",function(w,P){return w>=P?1:0})},p.prototype.logicalNot=function(l){Tn(l,"logicalNot");for(var m=this.readSync(l.dataId),w=new Uint8Array(m.length),P=0;P<m.length;++P)w[P]=m[P]?0:1;return this.makeOutput(w,l.shape,"bool")},p.prototype.logicalAnd=function(l,m){return Tn([l,m],"logicalAnd"),this.broadcastedBinaryOp(l,m,"bool",function(w,P){return w&&P})},p.prototype.logicalOr=function(l,m){return Tn([l,m],"logicalOr"),this.broadcastedBinaryOp(l,m,"bool",function(w,P){return w||P})},p.prototype.select=function(l,m,w){Tn([l,m,w],"select");for(var P=this.readSync(l.dataId),K=this.readSync(m.dataId),ee=this.readSync(w.dataId),le=uo(m.shape,Sn(m.dtype,w.dtype)),de=this.readSync(le.dataId),Ee=0,Te=l.rank===0||l.rank>1||m.rank===1?1:ze(m.shape.slice(1)),Ne=0;Ne<P.length;Ne++)for(var Fe=0;Fe<Te;Fe++)P[Ne]===1?de[Ee++]=K[Ne]:de[Ee++]=ee[Ne];return le},p.prototype.where=function(l){Tn([l],"where");var m=this.readSync(l.dataId);return ua(l.shape,m)},p.prototype.topk=function(l,m,w){return Tn(l,"topk"),ga(this.readSync(l.dataId),l.shape,l.dtype,m)},p.prototype.min=function(l,m){Tn(l,"min"),ia("min",m,l.rank);for(var w=Po(l.shape,m),P=w[0],K=w[1],ee=uo(P,l.dtype),le=ze(K),de=this.readSync(ee.dataId),Ee=this.readSync(l.dataId),Te=0;Te<de.length;++Te){for(var Ne=Te*le,Fe=Ee[Ne],qe=0;qe<le;++qe){var Je=Ee[Ne+qe];Je<Fe&&(Fe=Je)}de[Te]=Fe}return ee},p.prototype.minimum=function(l,m){return Tn([l,m],"minimum"),this.broadcastedBinaryOp(l,m,l.dtype,function(w,P){return Math.min(w,P)})},p.prototype.mod=function(l,m){return Tn([l,m],"mod"),this.broadcastedBinaryOp(l,m,l.dtype,function(w,P){var K=w%P;return w<0&&P<0||w>=0&&P>=0?K:(K+P)%P})},p.prototype.max=function(l,m){Tn(l,"max"),ia("max",m,l.rank);for(var w=Po(l.shape,m),P=w[0],K=w[1],ee=uo(P,l.dtype),le=ze(K),de=this.readSync(ee.dataId),Ee=this.readSync(l.dataId),Te=0;Te<de.length;++Te){for(var Ne=Te*le,Fe=Ee[Ne],qe=0;qe<le;++qe){var Je=Ee[Ne+qe];Je>Fe&&(Fe=Je)}de[Te]=Fe}return ee},p.prototype.maximum=function(l,m){return Tn([l,m],"maximum"),this.broadcastedBinaryOp(l,m,l.dtype,function(w,P){return Math.max(w,P)})},p.prototype.all=function(l,m){Tn(l,"all"),ia("all",m,l.rank);for(var w=Po(l.shape,m),P=w[0],K=w[1],ee=uo(P,l.dtype),le=ze(K),de=this.readSync(ee.dataId),Ee=this.readSync(l.dataId),Te=0;Te<de.length;++Te){for(var Ne=Te*le,Fe=Ee[Ne],qe=0;qe<le;++qe){var Je=Ee[Ne+qe];Fe=Fe&&Je}de[Te]=Fe}return ee},p.prototype.any=function(l,m){Tn(l,"any"),ia("any",m,l.rank);for(var w=Po(l.shape,m),P=w[0],K=w[1],ee=uo(P,l.dtype),le=ze(K),de=this.readSync(ee.dataId),Ee=this.readSync(l.dataId),Te=0;Te<de.length;++Te){for(var Ne=Te*le,Fe=Ee[Ne],qe=0;qe<le;++qe){var Je=Ee[Ne+qe];Fe=Fe||Je}de[Te]=Fe}return ee},p.prototype.squaredDifference=function(l,m){return Tn([l,m],"squaredDifference"),this.broadcastedBinaryOp(l,m,l.dtype,function(w,P){var K=w-P;return K*K})},p.prototype.ceil=function(l){Tn(l,"ceil");for(var m=this.readSync(l.dataId),w=new Float32Array(m.length),P=0;P<m.length;++P)w[P]=Math.ceil(m[P]);return this.makeOutput(w,l.shape,"float32")},p.prototype.floor=function(l){Tn(l,"floor");for(var m=this.readSync(l.dataId),w=new Float32Array(m.length),P=0;P<m.length;++P)w[P]=Math.floor(m[P]);return this.makeOutput(w,l.shape,"float32")},p.prototype.sign=function(l){Tn(l,"x");for(var m=this.readSync(l.dataId),w=new Float32Array(m.length),P=0;P<m.length;++P)m[P]<0?w[P]=-1:m[P]>0?w[P]=1:w[P]=0;return this.makeOutput(w,l.shape,"float32")},p.prototype.isNaN=function(l){Tn(l,"x");for(var m=this.readSync(l.dataId),w=new Uint8Array(m.length),P=0;P<m.length;++P)Number.isNaN(m[P])&&(w[P]=1);return this.makeOutput(w,l.shape,"bool")},p.prototype.isInf=function(l){Tn(l,"x");for(var m=this.readSync(l.dataId),w=new Uint8Array(m.length),P=0;P<m.length;++P)Math.abs(m[P])===1/0&&(w[P]=1);return this.makeOutput(w,l.shape,"bool")},p.prototype.isFinite=function(l){Tn(l,"x");for(var m=this.readSync(l.dataId),w=new Uint8Array(m.length),P=0;P<m.length;++P)Number.isFinite(m[P])&&(w[P]=1);return this.makeOutput(w,l.shape,"bool")},p.prototype.round=function(l){Tn(l,"round");for(var m=this.readSync(l.dataId),w=new Float32Array(m.length),P=0;P<m.length;++P){var K=Math.floor(m[P]);m[P]-K<.5?w[P]=Math.floor(m[P]):m[P]-K>.5?w[P]=Math.ceil(m[P]):w[P]=K%2==0?K:K+1}return this.makeOutput(w,l.shape,"float32")},p.prototype.exp=function(l){Tn(l,"exp");for(var m=this.readSync(l.dataId),w=new Float32Array(m.length),P=0;P<m.length;++P)w[P]=Math.exp(m[P]);return this.makeOutput(w,l.shape,"float32")},p.prototype.expm1=function(l){Tn(l,"expm1");for(var m=this.readSync(l.dataId),w=new Float32Array(m.length),P=0;P<m.length;++P)w[P]=Math.expm1(m[P]);return this.makeOutput(w,l.shape,"float32")},p.prototype.log=function(l){Tn(l,"log");for(var m=this.readSync(l.dataId),w=new Float32Array(m.length),P=0;P<m.length;++P){var K=m[P];w[P]=Math.log(K)}return this.makeOutput(w,l.shape,"float32")},p.prototype.log1p=function(l){Tn(l,"log1p");for(var m=this.readSync(l.dataId),w=new Float32Array(m.length),P=0;P<m.length;++P){var K=m[P];w[P]=Math.log1p(K)}return this.makeOutput(w,l.shape,"float32")},p.prototype.sqrt=function(l){Tn(l,"sqrt");for(var m=this.readSync(l.dataId),w=new Float32Array(m.length),P=0;P<m.length;++P){var K=m[P];w[P]=Math.sqrt(K)}return this.makeOutput(w,l.shape,"float32")},p.prototype.rsqrt=function(l){Tn(l,"rsqrt");for(var m=this.readSync(l.dataId),w=new Float32Array(m.length),P=0;P<m.length;++P){var K=m[P];w[P]=1/Math.sqrt(K)}return this.makeOutput(w,l.shape,"float32")},p.prototype.reciprocal=function(l){Tn(l,"reciprocal");for(var m=this.readSync(l.dataId),w=new Float32Array(m.length),P=0;P<m.length;++P)w[P]=1/m[P];return this.makeOutput(w,l.shape,"float32")},p.prototype.linear=function(l){return l},p.prototype.relu=function(l){Tn(l,"relu");for(var m=uo(l.shape,l.dtype),w=this.readSync(m.dataId),P=this.readSync(l.dataId),K=0;K<P.length;++K)w[K]=Math.max(0,P[K]);return m},p.prototype.relu6=function(l){Tn(l,"relu");for(var m=uo(l.shape,l.dtype),w=this.readSync(m.dataId),P=this.readSync(l.dataId),K=0;K<P.length;++K)w[K]=Math.min(Math.max(0,P[K]),6);return m},p.prototype.prelu=function(l,m){return Tn([l,m],"prelu"),this.broadcastedBinaryOp(l,m,l.dtype,function(w,P){return w<0?P*w:w})},p.prototype.elu=function(l){Tn(l,"elu");for(var m=new Float32Array(l.size),w=this.readSync(l.dataId),P=0;P<w.length;++P){var K=w[P];m[P]=K>=0?K:Math.exp(K)-1}return this.makeOutput(m,l.shape,"float32")},p.prototype.eluDer=function(l,m){Tn([l,m],"eluDer");for(var w=new Float32Array(m.size),P=this.readSync(m.dataId),K=this.readSync(l.dataId),ee=0;ee<P.length;++ee){var le=P[ee];w[ee]=le>=1?K[ee]:K[ee]*(le+1)}return this.makeOutput(w,m.shape,"float32")},p.prototype.selu=function(l){Tn(l,"selu");for(var m=new Float32Array(l.size),w=this.readSync(l.dataId),P=0;P<w.length;++P){var K=w[P];m[P]=K>=0?1.0507009873554805*K:1.7580993408473768*(Math.exp(K)-1)}return this.makeOutput(m,l.shape,"float32")},p.prototype.clip=function(l,m,w){Tn(l,"clip");for(var P=new Float32Array(l.size),K=this.readSync(l.dataId),ee=0;ee<K.length;++ee){var le=K[ee];P[ee]=le>w?w:le<m?m:le}return this.makeOutput(P,l.shape,"float32")},p.prototype.abs=function(l){for(var m=new Float32Array(l.size),w=this.readSync(l.dataId),P=0;P<w.length;++P)m[P]=Math.abs(w[P]);return this.makeOutput(m,l.shape,"float32")},p.prototype.complexAbs=function(l){for(var m=new Float32Array(l.size),w=this.readSync(l.dataId),P=0;P<l.size;++P){var K=w[2*P],ee=w[2*P+1];m[P]=Math.hypot(K,ee)}return this.makeOutput(m,l.shape,"float32")},p.prototype.int=function(l){Tn(l,"int");for(var m=new Int32Array(l.size),w=this.readSync(l.dataId),P=0;P<w.length;++P)m[P]=w[P];return this.makeOutput(m,l.shape,"int32")},p.prototype.sigmoid=function(l){Tn(l,"sigmoid");for(var m=new Float32Array(l.size),w=this.readSync(l.dataId),P=0;P<w.length;++P)m[P]=1/(1+Math.exp(-w[P]));return this.makeOutput(m,l.shape,"float32")},p.prototype.softplus=function(l){Tn(l,"softplus");for(var m=Math.log(11920928955078125e-23)+2,w=new Float32Array(l.size),P=this.readSync(l.dataId),K=0;K<P.length;++K){var ee,le=P[K]>-m,de=P[K]<m,Ee=Math.exp(P[K]);ee=de?Ee:le?P[K]:Math.log(1+Ee),w[K]=ee}return this.makeOutput(w,l.shape,"float32")},p.prototype.sin=function(l){Tn(l,"sin");for(var m=new Float32Array(l.size),w=this.readSync(l.dataId),P=0;P<w.length;++P)m[P]=Math.sin(w[P]);return this.makeOutput(m,l.shape,"float32")},p.prototype.cos=function(l){Tn(l,"cos");for(var m=new Float32Array(l.size),w=this.readSync(l.dataId),P=0;P<w.length;++P)m[P]=Math.cos(w[P]);return this.makeOutput(m,l.shape,"float32")},p.prototype.tan=function(l){Tn(l,"tan");for(var m=new Float32Array(l.size),w=this.readSync(l.dataId),P=0;P<w.length;++P)m[P]=Math.tan(w[P]);return this.makeOutput(m,l.shape,"float32")},p.prototype.asin=function(l){Tn(l,"asin");for(var m=new Float32Array(l.size),w=this.readSync(l.dataId),P=0;P<w.length;++P)m[P]=Math.asin(w[P]);return this.makeOutput(m,l.shape,"float32")},p.prototype.acos=function(l){Tn(l,"acos");for(var m=new Float32Array(l.size),w=this.readSync(l.dataId),P=0;P<w.length;++P)m[P]=Math.acos(w[P]);return this.makeOutput(m,l.shape,"float32")},p.prototype.atan=function(l){Tn(l,"atan");for(var m=new Float32Array(l.size),w=this.readSync(l.dataId),P=0;P<w.length;++P)m[P]=Math.atan(w[P]);return this.makeOutput(m,l.shape,"float32")},p.prototype.atan2=function(l,m){return Tn([l,m],"atan2"),this.broadcastedBinaryOp(l,m,l.dtype,function(w,P){return Math.atan2(w,P)})},p.prototype.sinh=function(l){Tn(l,"sinh");for(var m=new Float32Array(l.size),w=this.readSync(l.dataId),P=0;P<w.length;++P)m[P]=Math.sinh(w[P]);return this.makeOutput(m,l.shape,"float32")},p.prototype.cosh=function(l){Tn(l,"cosh");for(var m=new Float32Array(l.size),w=this.readSync(l.dataId),P=0;P<w.length;++P)m[P]=Math.cosh(w[P]);return this.makeOutput(m,l.shape,"float32")},p.prototype.tanh=function(l){Tn(l,"tanh");for(var m=new Float32Array(l.size),w=this.readSync(l.dataId),P=0;P<w.length;++P)m[P]=pt(w[P]);return this.makeOutput(m,l.shape,"float32")},p.prototype.asinh=function(l){Tn(l,"asinh");for(var m=new Float32Array(l.size),w=this.readSync(l.dataId),P=0;P<w.length;++P)m[P]=Math.asinh(w[P]);return this.makeOutput(m,l.shape,"float32")},p.prototype.acosh=function(l){Tn(l,"acosh");for(var m=new Float32Array(l.size),w=this.readSync(l.dataId),P=0;P<w.length;++P)m[P]=Math.acosh(w[P]);return this.makeOutput(m,l.shape,"float32")},p.prototype.atanh=function(l){Tn(l,"atanh");for(var m=new Float32Array(l.size),w=this.readSync(l.dataId),P=0;P<w.length;++P)m[P]=Math.atanh(w[P]);return this.makeOutput(m,l.shape,"float32")},p.prototype.erf=function(l){Tn(l,"erf");for(var m=new Float32Array(l.size),w=this.readSync(l.dataId),P=0;P<w.length;++P){var K=Math.sign(w[P]),ee=Math.abs(w[P]),le=1/(1+.3275911*ee);m[P]=K*(1-((((1.061405429*le-1.453152027)*le+1.421413741)*le-.284496736)*le+.254829592)*le*Math.exp(-ee*ee))}return this.makeOutput(m,l.shape,"float32")},p.prototype.step=function(l,m){m===void 0&&(m=0),Tn(l,"step");for(var w=new Float32Array(l.size),P=this.readSync(l.dataId),K=0;K<P.length;++K){var ee=P[K];isNaN(ee)?w[K]=NaN:w[K]=ee>0?1:m}return this.makeOutput(w,l.shape,"float32")},p.prototype.fusedConv2d=function(l){var m=l.input,w=l.filter,P=l.convInfo,K=l.bias,ee=l.activation,le=l.preluActivationWeights,de=this.conv2d(m,w,P);return K&&(de=this.add(de,K)),ee&&(de=Ir(this,de,ee,le)),de},p.prototype.conv2d=function(l,m,w){Tn([l,m],"conv2d");for(var P=w.filterHeight,K=w.filterWidth,ee=w.dilationHeight,le=w.dilationWidth,de=w.padInfo.left,Ee=w.padInfo.top,Te=w.dataFormat==="channelsLast",Ne=Ii(w.outShape,l.dtype),Fe=l.strides[0],qe=Te?l.strides[1]:l.strides[2],Je=Te?l.strides[2]:1,Ke=Te?1:l.strides[1],it=Ne.strides[0],gt=Te?Ne.strides[1]:Ne.strides[2],Et=Te?Ne.strides[2]:1,At=Te?1:Ne.strides[1],Wt=this.readSync(l.dataId),cn=this.readSync(m.dataId),pn=Ne.values,ln=0;ln<w.batchSize;++ln)for(var dn=ln*Fe,Nn=ln*it,jn=0;jn<w.outHeight;++jn)for(var Ln=Nn+jn*gt,ur=jn*w.strideHeight-Ee,hr=0;hr<P;hr++){var xr=ur+hr*ee;if(!(xr<0||xr>=w.inHeight))for(var Er=hr*m.strides[0],wr=dn+xr*qe,vr=0;vr<w.outWidth;++vr)for(var Lr=Ln+vr*Et,Pr=vr*w.strideWidth-de,ei=0;ei<K;ei++){var hi=Pr+ei*le;if(!(hi<0||hi>=w.inWidth))for(var Oi=wr+hi*Je,wo=Er+ei*m.strides[1],_o=0;_o<w.inChannels;++_o){for(var Io=Wt[Oi+_o*Ke],Do=0;Do<w.outChannels;++Do)pn[Lr+Do*At]+=Io*cn[wo+Do];wo+=w.outChannels}}}return Ne.toTensor()},p.prototype.conv3d=function(l,m,w){for(var P=w.filterDepth,K=w.filterHeight,ee=w.filterWidth,le=w.dilationDepth,de=w.dilationHeight,Ee=w.dilationWidth,Te=w.padInfo.front,Ne=w.padInfo.left,Fe=w.padInfo.top,qe=Ii(w.outShape,l.dtype),Je=this.readSync(l.dataId),Ke=this.readSync(m.dataId),it=qe.values,gt=0;gt<w.batchSize;++gt)for(var Et=gt*l.strides[0],At=gt*qe.strides[0],Wt=0;Wt<w.outDepth;++Wt)for(var cn=At+Wt*qe.strides[1],pn=Wt*w.strideDepth-Te,ln=0;ln<P;ln++){var dn=pn+ln*le;if(!(dn<0||dn>=w.inDepth))for(var Nn=ln*m.strides[0],jn=Et+dn*l.strides[1],Ln=0;Ln<w.outHeight;++Ln)for(var ur=cn+Ln*qe.strides[2],hr=Ln*w.strideHeight-Fe,xr=0;xr<K;xr++){var Er=hr+xr*de;if(!(Er<0||Er>=w.inHeight))for(var wr=Nn+xr*m.strides[1],vr=jn+Er*l.strides[2],Lr=0;Lr<w.outWidth;++Lr)for(var Pr=ur+Lr*w.outChannels,ei=Lr*w.strideWidth-Ne,hi=0;hi<ee;hi++){var Oi=ei+hi*Ee;if(!(Oi<0||Oi>=w.inWidth))for(var wo=wr+hi*m.strides[2],_o=vr+Oi*w.inChannels,Io=wo,Do=0;Do<w.inChannels;++Do){for(var qo=Je[_o+Do],fa=0;fa<w.outChannels;++fa)it[Pr+fa]+=qo*Ke[Io+fa];Io+=w.outChannels}}}}return qe.toTensor()},p.prototype.conv2dDerInput=function(l,m,w){Tn([l,m],"conv2dDerInput");for(var P=Ii(w.inShape,"float32"),K=P.values,ee=this.readSync(l.dataId),le=this.readSync(m.dataId),de=m.strides,Ee=de[0],Te=de[1],Ne=de[2],Fe=w.batchSize,qe=w.filterHeight,Je=w.filterWidth,Ke=w.inChannels,it=w.inHeight,gt=w.inWidth,Et=w.outChannels,At=w.outHeight,Wt=w.outWidth,cn=w.strideHeight,pn=w.strideWidth,ln=w.dataFormat,dn=qe-1-w.padInfo.top,Nn=Je-1-w.padInfo.left,jn=ln==="channelsLast",Ln=P.strides[0],ur=jn?P.strides[1]:P.strides[2],hr=jn?P.strides[2]:1,xr=jn?1:P.strides[1],Er=l.strides[0],wr=jn?l.strides[1]:l.strides[2],vr=jn?l.strides[2]:1,Lr=jn?1:l.strides[1],Pr=0;Pr<Fe;++Pr)for(var ei=0;ei<Ke;++ei)for(var hi=0;hi<it;++hi)for(var Oi=hi-dn,wo=Math.max(0,Math.ceil(Oi/cn)),_o=Math.min(At,(qe+Oi)/cn),Io=0;Io<gt;++Io){for(var Do=Io-Nn,qo=Math.max(0,Math.ceil(Do/pn)),fa=Math.min(Wt,(Je+Do)/pn),Ya=0,co=wo;co<_o;++co)for(var Fo=co*cn-Oi,Qo=qo;Qo<fa;++Qo)for(var Au=Er*Pr+wr*co+vr*Qo,Qs=Ee*(qe-1-Fo)+Te*(Je-1-(Qo*pn-Do))+Ne*ei,Zs=0;Zs<Et;++Zs)Ya+=ee[Au+Lr*Zs]*le[Qs+Zs];K[Ln*Pr+ur*hi+hr*Io+xr*ei]=Ya}return P.toTensor()},p.prototype.conv3dDerInput=function(l,m,w){for(var P=Ii(w.inShape,"float32"),K=P.values,ee=P.strides,le=ee[0],de=ee[1],Ee=ee[2],Te=ee[3],Ne=this.readSync(l.dataId),Fe=l.strides,qe=Fe[0],Je=Fe[1],Ke=Fe[2],it=Fe[3],gt=this.readSync(m.dataId),Et=m.strides,At=Et[0],Wt=Et[1],cn=Et[2],pn=Et[3],ln=w.batchSize,dn=w.filterDepth,Nn=w.filterHeight,jn=w.filterWidth,Ln=w.inChannels,ur=w.inDepth,hr=w.inHeight,xr=w.inWidth,Er=w.outChannels,wr=w.outDepth,vr=w.outHeight,Lr=w.outWidth,Pr=w.strideDepth,ei=w.strideHeight,hi=w.strideWidth,Oi=dn-1-w.padInfo.front,wo=Nn-1-w.padInfo.top,_o=jn-1-w.padInfo.left,Io=0;Io<ln;++Io)for(var Do=0;Do<Ln;++Do)for(var qo=0;qo<ur;++qo)for(var fa=qo-Oi,Ya=Math.max(0,Math.ceil(fa/Pr)),co=Math.min(wr,(dn+fa)/Pr),Fo=0;Fo<hr;++Fo)for(var Qo=Fo-wo,Au=Math.max(0,Math.ceil(Qo/ei)),Qs=Math.min(vr,(Nn+Qo)/ei),Zs=0;Zs<xr;++Zs){for(var pp=Zs-_o,mp=Math.max(0,Math.ceil(pp/hi)),Fm=Math.min(Lr,(jn+pp)/hi),ju=0,T0=Ya;T0<co;++T0)for(var Yv=T0*Pr-fa,gp=Au;gp<Qs;++gp)for(var Jv=gp*ei-Qo,Rm=mp;Rm<Fm;++Rm)for(var wC=qe*Io+Je*T0+Ke*gp+it*Rm,K1=At*(dn-1-Yv)+Wt*(Nn-1-Jv)+cn*(jn-1-(Rm*hi-pp))+pn*Do,vp=0;vp<Er;++vp)ju+=Ne[wC+vp]*gt[K1+vp];K[le*Io+de*qo+Ee*Fo+Te*Zs+Do]=ju}return P.toTensor()},p.prototype.conv2dDerFilter=function(l,m,w){Tn([l,m],"conv2dDerFilter");for(var P=w.strideHeight,K=w.strideWidth,ee=w.filterHeight,le=w.filterWidth,de=w.dataFormat==="channelsLast",Ee=Ii(w.filterShape,"float32"),Te=w.padInfo.left,Ne=w.padInfo.top,Fe=this.bufferSync(l),qe=this.bufferSync(m),Je=0;Je<ee;++Je)for(var Ke=Math.max(0,Math.ceil((Ne-Je)/P)),it=Math.min(w.outHeight,(w.inHeight+Ne-Je)/P),gt=0;gt<le;++gt)for(var Et=Math.max(0,Math.ceil((Te-gt)/K)),At=Math.min(w.outWidth,(w.inWidth+Te-gt)/K),Wt=0;Wt<w.inChannels;++Wt)for(var cn=0;cn<w.outChannels;++cn){for(var pn=0,ln=0;ln<w.batchSize;++ln)for(var dn=Ke;dn<it;++dn)for(var Nn=Je+dn*P-Ne,jn=Et;jn<At;++jn){var Ln=gt+jn*K-Te;pn+=de?Fe.get(ln,Nn,Ln,Wt)*qe.get(ln,dn,jn,cn):Fe.get(ln,Wt,Nn,Ln)*qe.get(ln,cn,dn,jn)}Ee.set(pn,Je,gt,Wt,cn)}return Ee.toTensor()},p.prototype.conv3dDerFilter=function(l,m,w){for(var P=w.strideDepth,K=w.strideHeight,ee=w.strideWidth,le=w.filterDepth,de=w.filterHeight,Ee=w.filterWidth,Te=Ii(w.filterShape,"float32"),Ne=Te.values,Fe=Te.strides,qe=Fe[0],Je=Fe[1],Ke=Fe[2],it=Fe[3],gt=this.readSync(m.dataId),Et=m.strides,At=Et[0],Wt=Et[1],cn=Et[2],pn=Et[3],ln=this.readSync(l.dataId),dn=l.strides,Nn=dn[0],jn=dn[1],Ln=dn[2],ur=dn[3],hr=w.padInfo.front,xr=w.padInfo.left,Er=w.padInfo.top,wr=0;wr<le;++wr)for(var vr=Math.max(0,Math.ceil((hr-wr)/P)),Lr=Math.min(w.outDepth,(w.inDepth+hr-wr)/P),Pr=wr*qe,ei=0;ei<de;++ei)for(var hi=Math.max(0,Math.ceil((Er-ei)/K)),Oi=Math.min(w.outHeight,(w.inHeight+Er-ei)/K),wo=ei*Je+Pr,_o=0;_o<Ee;++_o)for(var Io=Math.max(0,Math.ceil((xr-_o)/ee)),Do=Math.min(w.outWidth,(w.inWidth+xr-_o)/ee),qo=_o*Ke+wo,fa=0;fa<w.inChannels;++fa)for(var Ya=fa*it+qo,co=0;co<w.outChannels;++co){for(var Fo=0,Qo=0;Qo<w.batchSize;++Qo)for(var Au=Qo*Nn,Qs=Qo*At,Zs=vr;Zs<Lr;++Zs)for(var pp=(wr+Zs*P-hr)*jn+Au,mp=Zs*Wt+Qs,Fm=hi;Fm<Oi;++Fm)for(var ju=(ei+Fm*K-Er)*Ln+pp,T0=Fm*cn+mp,Yv=Io;Yv<Do;++Yv){var gp=Yv*pn+T0;Fo+=ln[(_o+Yv*ee-xr)*ur+ju+fa]*gt[gp+co]}Ne[Ya+co]=Fo}return Te.toTensor()},p.prototype.fusedDepthwiseConv2D=function(l){var m=l.input,w=l.filter,P=l.convInfo,K=l.bias,ee=l.activation,le=l.preluActivationWeights,de=this.depthwiseConv2D(m,w,P);return K&&(de=this.add(de,K)),ee&&(de=Ir(this,de,ee,le)),de},p.prototype.depthwiseConv2D=function(l,m,w){Tn([l,m],"depthwiseConv2D");for(var P=w.filterHeight,K=w.filterWidth,ee=w.dilationHeight,le=w.dilationWidth,de=w.padInfo.left,Ee=w.padInfo.top,Te=w.outChannels/w.inChannels,Ne=Ii(w.outShape,l.dtype),Fe=this.readSync(l.dataId),qe=this.readSync(m.dataId),Je=Ne.values,Ke=0;Ke<w.batchSize;++Ke)for(var it=Ke*l.strides[0],gt=Ke*Ne.strides[0],Et=0;Et<w.outHeight;++Et)for(var At=gt+Et*Ne.strides[1],Wt=Et*w.strideHeight-de,cn=0;cn<P;++cn){var pn=Wt+cn*ee;if(!(pn<0||pn>=w.inHeight))for(var ln=cn*m.strides[0],dn=it+pn*l.strides[1],Nn=0;Nn<w.outWidth;++Nn)for(var jn=At+Nn*Ne.strides[2],Ln=Nn*w.strideWidth-Ee,ur=0;ur<K;++ur){var hr=Ln+ur*le;if(!(hr<0||hr>=w.inWidth))for(var xr=ln+ur*m.strides[1],Er=dn+hr*w.inChannels,wr=jn,vr=xr,Lr=0;Lr<w.inChannels;++Lr){for(var Pr=Fe[Er+Lr],ei=0;ei<Te;++ei)Je[wr+ei]+=Pr*qe[vr+ei];wr+=Te,vr+=Te}}}return Ne.toTensor()},p.prototype.depthwiseConv2DDerInput=function(l,m,w){Tn([l,m],"depthwiseConv2DDerInput");for(var P=Ii(w.inShape,"float32"),K=P.values,ee=P.strides,le=ee[0],de=ee[1],Ee=ee[2],Te=this.readSync(l.dataId),Ne=l.strides,Fe=Ne[0],qe=Ne[1],Je=Ne[2],Ke=this.readSync(m.dataId),it=m.strides,gt=it[0],Et=it[1],At=it[2],Wt=w.batchSize,cn=w.filterHeight,pn=w.filterWidth,ln=w.inChannels,dn=w.inHeight,Nn=w.inWidth,jn=w.outChannels,Ln=w.outHeight,ur=w.outWidth,hr=w.strideHeight,xr=w.strideWidth,Er=cn-1-w.padInfo.top,wr=pn-1-w.padInfo.left,vr=jn/ln,Lr=0;Lr<Wt;++Lr)for(var Pr=0;Pr<ln;++Pr)for(var ei=0;ei<dn;++ei)for(var hi=ei-Er,Oi=Math.max(0,Math.ceil(hi/hr)),wo=Math.min(Ln,(cn+hi)/hr),_o=0;_o<Nn;++_o){for(var Io=_o-wr,Do=Math.max(0,Math.ceil(Io/xr)),qo=Math.min(ur,(pn+Io)/xr),fa=0,Ya=Oi;Ya<wo;++Ya)for(var co=Ya*hr-hi,Fo=Do;Fo<qo;++Fo)for(var Qo=Fe*Lr+qe*Ya+Je*Fo,Au=gt*(cn-1-co)+Et*(pn-1-(Fo*xr-Io))+At*Pr,Qs=0;Qs<vr;++Qs)fa+=Te[Qo+(Pr*vr+Qs)]*Ke[Au+Qs];K[le*Lr+de*ei+Ee*_o+Pr]=fa}return P.toTensor()},p.prototype.depthwiseConv2DDerFilter=function(l,m,w){Tn([l,m],"depthwiseConv2DDerFilter");for(var P=w.strideHeight,K=w.strideWidth,ee=w.filterHeight,le=w.filterWidth,de=Ii(w.filterShape,"float32"),Ee=w.padInfo.left,Te=w.padInfo.top,Ne=w.outChannels/w.inChannels,Fe=this.bufferSync(l),qe=this.bufferSync(m),Je=0;Je<ee;++Je)for(var Ke=Math.max(0,Math.ceil((Te-Je)/P)),it=Math.min(w.outHeight,(w.inHeight+Te-Je)/P),gt=0;gt<le;++gt)for(var Et=Math.max(0,Math.ceil((Ee-gt)/K)),At=Math.min(w.outWidth,(w.inWidth+Ee-gt)/K),Wt=0;Wt<w.outChannels;++Wt){for(var cn=Math.trunc(Wt/Ne),pn=Wt%Ne,ln=0,dn=0;dn<w.batchSize;++dn)for(var Nn=Ke;Nn<it;++Nn)for(var jn=Je+Nn*P-Te,Ln=Et;Ln<At;++Ln){var ur=gt+Ln*K-Ee;ln+=Fe.get(dn,jn,ur,cn)*qe.get(dn,Nn,Ln,Wt)}de.set(ln,Je,gt,cn,pn)}return de.toTensor()},p.prototype.tile=function(l,m){return Tn(l,"tile"),Sa(this.bufferSync(l),m)},p.prototype.pad=function(l,m,w){Tn(l,"pad");var P=m.map(function(Ne,Fe){return Ne[0]+l.shape[Fe]+Ne[1]}),K=m.map(function(Ne){return Ne[0]}),ee=this.bufferSync(l),le=Ii(P,l.dtype);w!==0&&le.values.fill(w);for(var de=0;de<l.size;de++){var Ee=ee.indexToLoc(de),Te=Ee.map(function(Ne,Fe){return Ne+K[Fe]});le.set.apply(le,[ee.get.apply(ee,Ee)].concat(Te))}return le.toTensor()},p.prototype.gather=function(l,m,w){Tn([l,m],"gather");var P=l.shape.slice(),K=this.readSync(m.dataId);P[w]=K.length;for(var ee=Ii(P,l.dtype),le=this.bufferSync(l),de=0;de<ee.size;++de){var Ee=ee.indexToLoc(de),Te=Ee.slice();Te[w]=K[Ee[w]];var Ne=le.locToIndex(Te);ee.values[de]=le.values[Ne]}return ee.toTensor()},p.prototype.batchToSpaceND=function(l,m,w){Tn([l],"batchToSpaceND");var P=m.reduce(function(Te,Ne){return Te*Ne}),K=_d(l.shape,m,P),ee=Il(K.length,m.length),le=vf(l.shape,m,P),de=em(w,m.length),Ee=rg(le,w,m.length);return bt(l.reshape(K),ee).reshape(le).slice(de,Ee)},p.prototype.spaceToBatchND=function(l,m,w){Tn([l],"spaceToBatchND");var P=m.reduce(function(Ne,Fe){return Ne*Fe}),K=[[0,0]];K.push.apply(K,w);for(var ee=1+m.length;ee<l.shape.length;++ee)K.push([0,0]);var le=l.pad(K),de=_d(le.shape,m,P,!1),Ee=Il(de.length,m.length,!1),Te=vf(le.shape,m,P,!1);return bt(le.reshape(de),Ee).reshape(Te)},p.prototype.maxPool=function(l,m){return Tn(l,"maxPool"),_r(this.readSync(l.dataId),l.shape,l.dtype,l.strides,m,"max").toTensor()},p.prototype.maxPoolBackprop=function(l,m,w,P){Tn([m,w],"maxPoolBackprop");for(var K=this.readSync(m.dataId),ee=Ii(P.outShape,m.dtype,Nr(K,m.shape,m.dtype,P).values),le=P.strideHeight,de=P.strideWidth,Ee=P.dilationHeight,Te=P.dilationWidth,Ne=P.effectiveFilterHeight,Fe=P.effectiveFilterWidth,qe=Fe-1-P.padInfo.left,Je=Ne-1-P.padInfo.top,Ke=Ii(m.shape,"float32"),it=this.bufferSync(l),gt=0;gt<P.batchSize;++gt)for(var Et=0;Et<P.inChannels;++Et)for(var At=0;At<P.inHeight;++At)for(var Wt=0;Wt<P.inWidth;++Wt){for(var cn=At-Je,pn=Wt-qe,ln=0,dn=0;dn<Ne;dn+=Ee){var Nn=(cn+dn)/le;if(!(Nn<0||Nn>=P.outHeight||Math.floor(Nn)!==Nn))for(var jn=0;jn<Fe;jn+=Te){var Ln=(pn+jn)/de;if(!(Ln<0||Ln>=P.outWidth||Math.floor(Ln)!==Ln)){var ur=Ne*Fe-1-ee.get(gt,Nn,Ln,Et)===dn*Fe+jn?1:0;ur!==0&&(ln+=it.get(gt,Nn,Ln,Et)*ur)}}}Ke.set(ln,gt,At,Wt,Et)}return Ke.toTensor()},p.prototype.avgPoolBackprop=function(l,m,w){Tn([l,m],"avgPoolBackprop");for(var P=w.strideHeight,K=w.strideWidth,ee=w.filterHeight,le=w.filterWidth,de=w.dilationHeight,Ee=w.dilationWidth,Te=w.effectiveFilterHeight,Ne=w.effectiveFilterWidth,Fe=Ne-1-w.padInfo.left,qe=Te-1-w.padInfo.top,Je=Ii(m.shape,"float32"),Ke=1/(ee*le),it=this.bufferSync(l),gt=0;gt<w.batchSize;++gt)for(var Et=0;Et<w.inChannels;++Et)for(var At=0;At<w.inHeight;++At)for(var Wt=0;Wt<w.inWidth;++Wt){for(var cn=At-qe,pn=Wt-Fe,ln=0,dn=0;dn<Te;dn+=de){var Nn=(cn+dn)/P;if(!(Nn<0||Nn>=w.outHeight||Math.floor(Nn)!==Nn))for(var jn=0;jn<Ne;jn+=Ee){var Ln=(pn+jn)/K;Ln<0||Ln>=w.outWidth||Math.floor(Ln)!==Ln||(ln+=it.get(gt,Nn,Ln,Et))}}Je.set(ln*Ke,gt,At,Wt,Et)}return Je.toTensor()},p.prototype.pool3d=function(l,m,w){Tn(l,"pool3d");for(var P=m.strideDepth,K=m.strideHeight,ee=m.strideWidth,le=m.dilationDepth,de=m.dilationHeight,Ee=m.dilationWidth,Te=m.effectiveFilterDepth,Ne=m.effectiveFilterHeight,Fe=m.effectiveFilterWidth,qe=m.padInfo.front,Je=m.padInfo.top,Ke=m.padInfo.left,it=w==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,gt=this.readSync(l.dataId),Et=Ii(m.outShape,l.dtype),At=Et.values,Wt=m.outShape[1]*m.outShape[2]*m.outShape[3]*m.outShape[4],cn=m.outShape[2]*m.outShape[3]*m.outShape[4],pn=m.outShape[3]*m.outShape[4],ln=m.outShape[4],dn=0;dn<m.batchSize;++dn)for(var Nn=dn*Wt,jn=dn*l.strides[0],Ln=0;Ln<m.inChannels;++Ln)for(var ur=0;ur<m.outDepth;++ur){for(var hr=ur*P-qe,xr=hr;xr<0;)xr+=le;for(var Er=Math.min(m.inDepth,Te+hr),wr=Nn+ur*cn,vr=0;vr<m.outHeight;++vr){for(var Lr=vr*K-Je,Pr=Lr;Pr<0;)Pr+=de;for(var ei=Math.min(m.inHeight,Ne+Lr),hi=wr+vr*pn,Oi=0;Oi<m.outWidth;++Oi){for(var wo=Oi*ee-Ke,_o=wo;_o<0;)_o+=Ee;for(var Io=Math.min(m.inWidth,Fe+wo),Do=hi+Oi*ln,qo=it,fa=0,Ya=0,co=xr;co<Er;co+=le){for(var Fo=jn+co*l.strides[1],Qo=Pr;Qo<ei;Qo+=de){for(var Au=Fo+Qo*l.strides[2],Qs=_o;Qs<Io;Qs+=Ee){var Zs=gt[Au+Qs*l.strides[3]+Ln];if(w==="max"&&Zs>qo?qo=Zs:w==="avg"&&(fa+=Zs,Ya++),isNaN(qo))break}if(isNaN(qo))break}if(isNaN(qo))break}At[Do+Ln]=w==="avg"?fa/Ya:qo}}}return Et.toTensor()},p.prototype.avgPool3d=function(l,m){return Tn(l,"avgPool3d"),this.pool3d(l,m,"avg").toFloat()},p.prototype.avgPool3dBackprop=function(l,m,w){Tn([l,m],"avgPool3dBackprop");for(var P=w.strideDepth,K=w.strideHeight,ee=w.strideWidth,le=w.filterDepth,de=w.filterHeight,Ee=w.filterWidth,Te=w.dilationDepth,Ne=w.dilationHeight,Fe=w.dilationWidth,qe=w.effectiveFilterDepth,Je=w.effectiveFilterHeight,Ke=w.effectiveFilterWidth,it=qe-1-w.padInfo.front,gt=Ke-1-w.padInfo.left,Et=Je-1-w.padInfo.top,At=Ii(m.shape,"float32"),Wt=1/(le*de*Ee),cn=this.bufferSync(l),pn=0;pn<w.batchSize;++pn)for(var ln=0;ln<w.inChannels;++ln)for(var dn=0;dn<w.inDepth;++dn)for(var Nn=0;Nn<w.inHeight;++Nn)for(var jn=0;jn<w.inWidth;++jn){for(var Ln=dn-it,ur=Nn-Et,hr=jn-gt,xr=0,Er=0;Er<qe;Er+=Te){var wr=(Ln+Er)/P;if(!(wr<0||wr>=w.outDepth||Math.floor(wr)!==wr))for(var vr=0;vr<Je;vr+=Ne){var Lr=(ur+vr)/K;if(!(Lr<0||Lr>=w.outHeight||Math.floor(Lr)!==Lr))for(var Pr=0;Pr<Ke;Pr+=Fe){var ei=(hr+Pr)/ee;ei<0||ei>=w.outWidth||Math.floor(ei)!==ei||(xr+=cn.get(pn,wr,Lr,ei,ln))}}}At.set(xr*Wt,pn,dn,Nn,jn,ln)}return At.toTensor()},p.prototype.maxPool3d=function(l,m){return Tn(l,"maxPool3d"),this.pool3d(l,m,"max").toFloat()},p.prototype.maxPool3dPositions=function(l,m){for(var w=Ii(m.outShape,"int32"),P=m.strideDepth,K=m.strideHeight,ee=m.strideWidth,le=m.dilationDepth,de=m.dilationHeight,Ee=m.dilationWidth,Te=m.effectiveFilterDepth,Ne=m.effectiveFilterHeight,Fe=m.effectiveFilterWidth,qe=m.padInfo.front,Je=m.padInfo.top,Ke=m.padInfo.left,it=this.bufferSync(l),gt=0;gt<m.batchSize;++gt)for(var Et=0;Et<m.inChannels;++Et)for(var At=0;At<m.outDepth;++At){for(var Wt=At*P-qe,cn=Wt;cn<0;)cn+=le;for(var pn=Math.min(m.inDepth,Te+Wt),ln=0;ln<m.outHeight;++ln){for(var dn=ln*K-Je,Nn=dn;Nn<0;)Nn+=de;for(var jn=Math.min(m.inHeight,Ne+dn),Ln=0;Ln<m.outWidth;++Ln){for(var ur=Ln*ee-Ke,hr=ur;hr<0;)hr+=Ee;for(var xr=Math.min(m.inWidth,Fe+ur),Er=Number.NEGATIVE_INFINITY,wr=-1,vr=cn;vr<pn;vr+=le)for(var Lr=vr-Wt,Pr=Nn;Pr<jn;Pr+=de)for(var ei=Pr-dn,hi=hr;hi<xr;hi+=Ee){var Oi=hi-ur,wo=it.get(gt,vr,Pr,hi,Et);wo>=Er&&(Er=wo,wr=Lr*Ne*Fe+ei*Ne+Oi)}w.set(wr,gt,At,ln,Ln,Et)}}}return w.toTensor()},p.prototype.maxPool3dBackprop=function(l,m,w,P){Tn([m,w],"maxPool3dBackprop");for(var K=this.maxPool3dPositions(m,P),ee=P.strideDepth,le=P.strideHeight,de=P.strideWidth,Ee=P.dilationDepth,Te=P.dilationHeight,Ne=P.dilationWidth,Fe=P.effectiveFilterDepth,qe=P.effectiveFilterHeight,Je=P.effectiveFilterWidth,Ke=Fe-1-P.padInfo.front,it=Je-1-P.padInfo.left,gt=qe-1-P.padInfo.top,Et=Ii(m.shape,"float32"),At=this.bufferSync(K),Wt=this.bufferSync(l),cn=0;cn<P.batchSize;++cn)for(var pn=0;pn<P.inChannels;++pn)for(var ln=0;ln<P.inDepth;++ln)for(var dn=0;dn<P.inHeight;++dn)for(var Nn=0;Nn<P.inWidth;++Nn){for(var jn=ln-Ke,Ln=dn-gt,ur=Nn-it,hr=0,xr=0;xr<Fe;xr+=Ee){var Er=(jn+xr)/ee;if(!(Er<0||Er>=P.outDepth||Math.floor(Er)!==Er))for(var wr=0;wr<qe;wr+=Te){var vr=(Ln+wr)/le;if(!(vr<0||vr>=P.outHeight||Math.floor(vr)!==vr))for(var Lr=0;Lr<Je;Lr+=Ne){var Pr=(ur+Lr)/de;if(!(Pr<0||Pr>=P.outWidth||Math.floor(Pr)!==Pr)){var ei=Fe*qe*Je-1-At.get(cn,Er,vr,Pr,pn)===xr*qe*Je+wr*Je+Lr?1:0;ei!==0&&(hr+=Wt.get(cn,Er,vr,Pr,pn)*ei)}}}}Et.set(hr,cn,ln,dn,Nn,pn)}return Et.toTensor()},p.prototype.cast=function(l,m){return ii(l,m,this)},p.prototype.reshape=function(l,m){return wi(l,m)},p.prototype.avgPool=function(l,m){return Tn(l,"avgPool"),Tn(l,"maxPool"),_r(this.readSync(l.dataId),l.shape,l.dtype,l.strides,m,"avg").toTensor().toFloat()},p.prototype.resizeBilinear=function(l,m,w,P){Tn(l,"resizeBilinear");for(var K=l.shape,ee=K[0],le=K[1],de=K[2],Ee=K[3],Te=this.readSync(l.dataId),Ne=new Float32Array(ze([ee,m,w,Ee])),Fe=[P&&m>1?le-1:le,P&&w>1?de-1:de],qe=[P&&m>1?m-1:m,P&&w>1?w-1:w],Je=0,Ke=Fe[0]/qe[0],it=Fe[1]/qe[1],gt=0;gt<ee;gt++)for(var Et=0;Et<m;Et++)for(var At=Ke*Et,Wt=Math.floor(At),cn=At-Wt,pn=Math.min(le-1,Math.ceil(At)),ln=gt*l.strides[0]+Wt*l.strides[1],dn=gt*l.strides[0]+pn*l.strides[1],Nn=0;Nn<w;Nn++)for(var jn=it*Nn,Ln=Math.floor(jn),ur=jn-Ln,hr=Math.min(de-1,Math.ceil(jn)),xr=ln+Ln*l.strides[2],Er=dn+Ln*l.strides[2],wr=ln+hr*l.strides[2],vr=dn+hr*l.strides[2],Lr=0;Lr<Ee;Lr++){var Pr=Te[xr+Lr],ei=Te[Er+Lr],hi=Pr+(Te[wr+Lr]-Pr)*ur,Oi=hi+(ei+(Te[vr+Lr]-ei)*ur-hi)*cn;Ne[Je++]=Oi}return No(Ne,[ee,m,w,Ee])},p.prototype.resizeBilinearBackprop=function(l,m,w){Tn([l,m],"resizeBilinearBackprop");for(var P=m.shape,K=P[0],ee=P[1],le=P[2],de=P[3],Ee=l.shape,Te=Ee[1],Ne=Ee[2],Fe=new Float32Array(K*ee*le*de),qe=[w&&Te>1?ee-1:ee,w&&Ne>1?le-1:le],Je=[w&&Te>1?Te-1:Te,w&&Ne>1?Ne-1:Ne],Ke=qe[0]/Je[0],it=qe[1]/Je[1],gt=this.readSync(l.dataId),Et=0,At=0;At<K;At++)for(var Wt=At*m.strides[0],cn=0;cn<Te;cn++)for(var pn=cn*Ke,ln=Math.floor(pn),dn=Math.min(Math.ceil(pn),ee-1),Nn=Wt+ln*m.strides[1],jn=Wt+dn*m.strides[1],Ln=pn-ln,ur=1-Ln,hr=0;hr<Ne;hr++)for(var xr=hr*it,Er=Math.floor(xr),wr=Math.min(Math.ceil(xr),le-1),vr=xr-Er,Lr=1-vr,Pr=Nn+Er*m.strides[2],ei=Nn+wr*m.strides[2],hi=jn+Er*m.strides[2],Oi=jn+wr*m.strides[2],wo=ur*Lr,_o=ur*vr,Io=Ln*Lr,Do=Ln*vr,qo=0;qo<de;qo++){var fa=gt[Et++];Fe[Pr+qo]+=fa*wo,Fe[ei+qo]+=fa*_o,Fe[hi+qo]+=fa*Io,Fe[Oi+qo]+=fa*Do}return su(Fe,[K,le,ee,de],m.dtype)},p.prototype.resizeNearestNeighbor=function(l,m,w,P){Tn(l,"resizeNearestNeighbor");for(var K=l.shape,ee=K[0],le=K[1],de=K[2],Ee=K[3],Te=this.readSync(l.dataId),Ne=new Float32Array(ee*m*w*Ee),Fe=[P&&m>1?le-1:le,P&&w>1?de-1:de],qe=[P&&m>1?m-1:m,P&&w>1?w-1:w],Je=Fe[0]/qe[0],Ke=Fe[1]/qe[1],it=0,gt=0;gt<ee;gt++)for(var Et=gt*l.strides[0],At=0;At<m;At++)for(var Wt=Je*At,cn=Et+Math.min(le-1,P?Math.round(Wt):Math.floor(Wt))*l.strides[1],pn=0;pn<w;pn++)for(var ln=Ke*pn,dn=cn+Math.min(de-1,P?Math.round(ln):Math.floor(ln))*l.strides[2],Nn=0;Nn<Ee;Nn++){var jn=Te[dn+Nn];Ne[it++]=jn}return No(Ne,[ee,m,w,Ee],l.dtype)},p.prototype.resizeNearestNeighborBackprop=function(l,m,w){Tn([l,m],"resizeNearestNeighborBackprop");for(var P=m.shape,K=P[0],ee=P[1],le=P[2],de=P[3],Ee=l.shape,Te=Ee[1],Ne=Ee[2],Fe=new Float32Array(K*ee*le*de),qe=this.readSync(l.dataId),Je=[w&&Te>1?ee-1:ee,w&&Ne>1?le-1:le],Ke=[w&&Te>1?Te-1:Te,w&&Ne>1?Ne-1:Ne],it=Je[0]/Ke[0],gt=Je[1]/Ke[1],Et=1/it,At=1/gt,Wt=2*Math.ceil(Et)+2,cn=2*Math.ceil(At)+2,pn=0;pn<K;pn++)for(var ln=pn*m.strides[0],dn=0;dn<ee;dn++)for(var Nn=ln+dn*m.strides[1],jn=Math.floor(dn*Et),Ln=Math.floor(jn-Wt/2),ur=0;ur<le;ur++)for(var hr=Nn+ur*m.strides[2],xr=Math.floor(ur*At),Er=Math.floor(xr-cn/2),wr=0;wr<de;wr++){for(var vr=0,Lr=0;Lr<Wt;Lr++){var Pr=Lr+Ln;if(!(Pr<0||Pr>=Te)){var ei=ln+Pr*l.strides[1],hi=Pr*it;if(dn===Math.min(ee-1,w?Math.round(hi):Math.floor(hi)))for(var Oi=0;Oi<cn;Oi++){var wo=Oi+Er;if(!(wo<0||wo>=Ne)){var _o=ei+wo*l.strides[2],Io=wo*gt;ur===Math.min(le-1,w?Math.round(Io):Math.floor(Io))&&(vr+=qe[_o+wr])}}}}Fe[hr+wr]=vr}return su(Fe,m.shape,m.dtype)},p.prototype.batchNormalization=function(l,m,w,P,K,ee){Tn([l,m,w,K,ee],"batchNorm");for(var le=this.readSync(l.dataId),de=this.readSync(m.dataId),Ee=this.readSync(w.dataId),Te=K?this.readSync(K.dataId):new Float32Array([1]),Ne=ee?this.readSync(ee.dataId):new Float32Array([0]),Fe=new Float32Array(le.length),qe=Ne.length,Je=Te.length,Ke=Ee.length,it=de.length,gt=0,Et=0,At=0,Wt=0,cn=0;cn<le.length;++cn)Fe[cn]=Ne[gt++]+(le[cn]-de[Et++])*Te[At++]/Math.sqrt(Ee[Wt++]+P),gt>=qe&&(gt=0),Et>=it&&(Et=0),At>=Je&&(At=0),Wt>=Ke&&(Wt=0);return su(Fe,l.shape)},p.prototype.localResponseNormalization4D=function(l,m,w,P,K){Tn(l,"localResponseNormalization4D");var ee=l.shape[3],le=ee-1,de=this.readSync(l.dataId),Ee=l.size,Te=new Float32Array(Ee);function Ne(Ke){for(var it=Ke%ee,gt=Ke-it+Math.max(0,it-m),Et=Ke-it+Math.min(it+m,le),At=0;gt<=Et;gt++){var Wt=de[gt];At+=Wt*Wt}return At}for(var Fe=0;Fe<Ee;Fe++){var qe=Ne(Fe),Je=de[Fe]*Math.pow(w+P*qe,-K);Te[Fe]=Je}return su(Te,l.shape)},p.prototype.LRNGrad=function(l,m,w,P,K,ee,le){Tn(l,"LRNGrad");for(var de=l.shape[3],Ee=this.readSync(l.dataId),Te=this.readSync(m.dataId),Ne=this.readSync(w.dataId),Fe=new Float32Array(l.size),qe=l.size,Je=0;Je<qe;Je++){for(var Ke=Je%de,it=Je-Ke+Math.max(0,Ke-P),gt=Je-Ke+Math.min(de,Ke+P+1),Et=0,At=it;At<gt;At++)Et+=Math.pow(Te[At],2);for(Et=ee*Et+K,At=it;At<gt;At++){var Wt=-2*ee*le*Te[At]*Ne[Je]/Et;Je===At&&(Wt+=Math.pow(Et,-le)),Wt*=Ee[Je],Fe[At]+=Wt}}return su(Fe,l.shape)},p.prototype.multinomial=function(l,m,w,P){Tn(l,"multinomial");for(var K=m?l:je(l),ee=K.shape[0],le=K.shape[1],de=uo([ee,w],"int32"),Ee=this.readSync(de.dataId),Te=this.readSync(K.dataId),Ne=0;Ne<ee;++Ne){var Fe=Ne*le,qe=new Float32Array(le-1);qe[0]=Te[Fe];for(var Je=1;Je<qe.length;++Je)qe[Je]=qe[Je-1]+Te[Fe+Je];for(var Ke=Yh(P.toString()),it=Ne*w,gt=0;gt<w;++gt){var Et=Ke();Ee[it+gt]=qe.length;for(var At=0;At<qe.length;At++)if(Et<qe[At]){Ee[it+gt]=At;break}}}return de},p.prototype.oneHot=function(l,m,w,P){Tn(l,"oneHot");var K=new Float32Array(l.size*m);K.fill(P);for(var ee=this.readSync(l.dataId),le=0;le<l.size;++le)ee[le]>=0&&ee[le]<m&&(K[le*m+ee[le]]=w);return Eu(K,[l.size,m],"int32")},p.prototype.nonMaxSuppression=function(l,m,w,P,K){return Tn(l,"nonMaxSuppression"),pa(this.readSync(l.dataId),this.readSync(m.dataId),w,P,K)},p.prototype.fft=function(l){return this.fftBatch(l,!1)},p.prototype.ifft=function(l){return this.fftBatch(l,!0)},p.prototype.fftBatch=function(l,m){for(var w=l.shape[0],P=l.shape[1],K=Ii(l.shape,"float32"),ee=Ii(l.shape,"float32"),le=xa(l).as2D(w,P),de=Za(l).as2D(w,P),Ee=0;Ee<w;Ee++)for(var Te=le.slice([Ee,0],[1,P]),Ne=de.slice([Ee,0],[1,P]),Fe=Co(Te,Ne),qe=this.readSync(this.fftImpl(Fe,m).dataId),Je=0;Je<P;Je++){var Ke=po(qe,Je);K.values[Ee*P+Je]=Ke.real,ee.values[Ee*P+Je]=Ke.imag}return Co(K.toTensor(),ee.toTensor()).as2D(w,P)},p.prototype.fftImpl=function(l,m){var w=l.as1D(),P=w.size;if(this.isExponentOf2(P)){var K=this.fftRadix2(w,P,m).as2D(l.shape[0],l.shape[1]);return m&&(K=Co(xa(K).div(Ar(P)),Za(K).div(Ar(P)))),K}var ee=this.readSync(l.dataId),le=function(de){for(var Ee=new Float32Array(de.length/2),Te=new Float32Array(de.length/2),Ne=0;Ne<de.length;Ne+=2)Ee[Ne/2]=de[Ne],Te[Ne/2]=de[Ne+1];return{real:Ee,imag:Te}}(this.fourierTransformByMatmul(ee,P,m));return Co(le.real,le.imag).as2D(l.shape[0],l.shape[1])},p.prototype.isExponentOf2=function(l){return(l&l-1)==0},p.prototype.fftRadix2=function(l,m,w){if(m===1)return l;var P=this.readSync(l.dataId),K=m/2,ee=function(it){for(var gt=Math.ceil(it.length/4),Et=new Float32Array(gt),At=new Float32Array(gt),Wt=0;Wt<it.length;Wt+=4)Et[Math.floor(Wt/4)]=it[Wt],At[Math.floor(Wt/4)]=it[Wt+1];return{real:Et,imag:At}}(P),le=Co(ee.real,ee.imag).as1D(),de=function(it){for(var gt=Math.floor(it.length/4),Et=new Float32Array(gt),At=new Float32Array(gt),Wt=2;Wt<it.length;Wt+=4)Et[Math.floor(Wt/4)]=it[Wt],At[Math.floor(Wt/4)]=it[Wt+1];return{real:Et,imag:At}}(P),Ee=Co(de.real,de.imag).as1D();le=this.fftRadix2(le,K,w),Ee=this.fftRadix2(Ee,K,w);var Te=function(it,gt){for(var Et=new Float32Array(it/2),At=new Float32Array(it/2),Wt=0;Wt<Math.ceil(it/2);Wt++){var cn=(gt?2:-2)*Math.PI*(Wt/it);Et[Wt]=Math.cos(cn),At[Wt]=Math.sin(cn)}return{real:Et,imag:At}}(m,w),Ne=Co(Te.real,Te.imag).mul(Ee),Fe=le.add(Ne),qe=le.sub(Ne),Je=xa(Fe).concat(xa(qe)),Ke=Za(Fe).concat(Za(qe));return Co(Je,Ke).as1D()},p.prototype.fourierTransformByMatmul=function(l,m,w){for(var P=new Float32Array(2*m),K=0;K<m;K++){for(var ee=0,le=0,de=0;de<m;de++){var Ee=Ko(K*de,m,w),Te=po(l,de);ee+=Te.real*Ee.real-Te.imag*Ee.imag,le+=Te.real*Ee.imag+Te.imag*Ee.real}w&&(ee/=m,le/=m),ho(P,ee,le,K)}return P},p.prototype.depthToSpace=function(l,m,w){we(w==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+w}),we(m>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+m});for(var P=l.shape[0],K=l.shape[1],ee=l.shape[2],le=l.shape[3],de=K*m,Ee=ee*m,Te=le/(m*m),Ne=this.readSync(l.dataId),Fe=new Float32Array(P*de*Ee*Te),qe=0,Je=0;Je<P;++Je)for(var Ke=0;Ke<de;++Ke)for(var it=Math.floor(Ke/m),gt=Ke%m,Et=0;Et<Ee;++Et)for(var At=Math.floor(Et/m),Wt=(gt*m+Et%m)*Te,cn=0;cn<Te;++cn){var pn=cn+Wt+le*(At+ee*(it+K*Je));Fe[qe++]=Ne[pn]}return su(Fe,[P,de,Ee,Te])},p.prototype.broadcastedBinaryOp=function(l,m,w,P){var K=Xi(l.shape,m.shape),ee=Ii(K,w),le=this.readSync(l.dataId),de=this.readSync(m.dataId),Ee=za(l.shape,K),Te=za(m.shape,K),Ne=ee.values;if(Ee.length+Te.length===0)for(var Fe=0;Fe<Ne.length;++Fe)Ne[Fe]=P(le[Fe%le.length],de[Fe%de.length]);else{var qe=this.bufferSync(l),Je=this.bufferSync(m),Ke=function(it){var gt=ee.indexToLoc(it),Et=gt.slice(-l.rank);Ee.forEach(function(pn){return Et[pn]=0});var At=qe.locToIndex(Et),Wt=gt.slice(-m.rank);Te.forEach(function(pn){return Wt[pn]=0});var cn=Je.locToIndex(Wt);Ne[it]=P(le[At],de[cn])};for(Fe=0;Fe<Ne.length;++Fe)Ke(Fe)}return ee.toTensor()},p.prototype.broadcastedBinaryComplexOp=function(l,m,w){var P=Xi(l.shape,m.shape),K=Ii(P,"float32"),ee=Ii(P,"float32"),le=this.readSync(l.dataId),de=this.readSync(m.dataId),Ee=za(l.shape,P),Te=za(m.shape,P),Ne=K.values,Fe=ee.values;if(Ee.length+Te.length===0)for(var qe=0;qe<Ne.length;qe++){var Je=qe%le.length,Ke=qe%de.length,it=w(le[2*Je],le[2*Je+1],de[2*Ke],de[2*Ke+1]);Ne[qe]=it.real,Fe[qe]=it.imag}else{var gt=this.bufferSync(this.data.get(l.dataId).complexTensors.real),Et=this.bufferSync(this.data.get(m.dataId).complexTensors.real),At=function(Wt){var cn=K.indexToLoc(Wt),pn=cn.slice(-l.rank);Ee.forEach(function(Ln){return pn[Ln]=0});var ln=gt.locToIndex(pn),dn=cn.slice(-m.rank);Te.forEach(function(Ln){return dn[Ln]=0});var Nn=Et.locToIndex(dn),jn=w(le[2*ln],le[2*ln+1],de[2*Nn],de[2*Nn+1]);Ne[Wt]=jn.real,Fe[Wt]=jn.imag};for(qe=0;qe<Ne.length;qe++)At(qe)}return this.complex(K.toTensor(),ee.toTensor())},p.prototype.split=function(l,m,w){return wa(l,m,w)},p.prototype.dispose=function(){},p.prototype.floatPrecision=function(){return 32},p.prototype.epsilon=function(){return 1e-7},p.prototype.cropAndResize=function(l,m,w,P,K,ee){for(var le=l.shape,de=le[0],Ee=le[1],Te=le[2],Ne=le[3],Fe=m.shape[0],qe=P[0],Je=P[1],Ke=Ii([Fe,qe,Je,Ne],"float32"),it=this.readSync(m.dataId),gt=this.readSync(w.dataId),Et=this.readSync(l.dataId),At=l.strides,Wt=Ke.strides,cn=0;cn<Fe;cn++){var pn=4*cn,ln=it[pn],dn=it[pn+1],Nn=it[pn+2],jn=it[pn+3],Ln=gt[cn];if(!(Ln>=de))for(var ur=qe>1?(Nn-ln)*(Ee-1)/(qe-1):0,hr=Je>1?(jn-dn)*(Te-1)/(Je-1):0,xr=0;xr<qe;xr++){var Er=qe>1?ln*(Ee-1)+xr*ur:.5*(ln+Nn)*(Ee-1);if(Er<0||Er>Ee-1)for(var wr=0;wr<Je;wr++)for(var vr=0;vr<Ne;vr++){var Lr=vr+wr*Wt[2]+xr*Wt[1]+cn*Wt[0];Ke.values[Lr]=ee}else if(K==="bilinear"){var Pr=Math.floor(Er),ei=Math.ceil(Er),hi=Er-Pr;for(wr=0;wr<Je;wr++)if((co=Je>1?dn*(Te-1)+wr*hr:.5*(dn+jn)*(Te-1))<0||co>Te-1)for(vr=0;vr<Ne;vr++)Lr=vr+wr*Wt[2]+xr*Wt[1]+cn*Wt[0],Ke.values[Lr]=ee;else{var Oi=Math.floor(co),wo=Math.ceil(co),_o=co-Oi;for(vr=0;vr<Ne;vr++){var Io=Et[Lr=vr+Oi*At[2]+Pr*At[1]+Ln*At[0]],Do=Et[Lr=vr+wo*At[2]+Pr*At[1]+Ln*At[0]],qo=Et[Lr=vr+Oi*At[2]+ei*At[1]+Ln*At[0]],fa=Io+(Do-Io)*_o,Ya=qo+(Et[Lr=vr+wo*At[2]+ei*At[1]+Ln*At[0]]-qo)*_o;Lr=vr+wr*Wt[2]+xr*Wt[1]+cn*Wt[0],Ke.values[Lr]=fa+(Ya-fa)*hi}}}else for(wr=0;wr<Je;++wr){var co;if((co=Je>1?dn*(Te-1)+wr*hr:.5*(dn+jn)*(Te-1))<0||co>Te-1)for(vr=0;vr<Ne;vr++)Lr=vr+wr*Wt[2]+xr*Wt[1]+cn*Wt[0],Ke.values[Lr]=ee;else{var Fo=Math.round(co),Qo=Math.round(Er);for(vr=0;vr<Ne;vr++){var Au=vr+Fo*At[2]+Qo*At[1]+Ln*At[0],Qs=vr+wr*Wt[2]+xr*Wt[1]+cn*Wt[0];Ke.values[Qs]=Et[Au]}}}}}return Ke.toTensor()},p.prototype.sparseToDense=function(l,m,w,P){var K=Bl(0,l,w),ee=K.sliceRank,le=K.numUpdates,de=K.sliceSize,Ee=K.strides,Te=K.outputSize;return this.scatter(l,m,w,Te,de,le,ee,Ee,P,!1)},p.prototype.gatherND=function(l,m){var w=m.shape,P=w[w.length-1],K=fu(l,m),ee=K[0],le=K[1],de=K[2],Ee=K[3];if(le===0)return No([],ee,l.dtype);for(var Te=new qr([le,de],l.dtype),Ne=this.readSync(m.dataId),Fe=this.readSync(l.dataId),qe=0;qe<le;qe++){for(var Je=[],Ke=0,it=0;it<P;it++){var gt=Ne[qe*P+it];Ke+=gt*Ee[it],Je.push(gt)}if(Ke<0||Ke>=l.size/de)throw new Error("Invalid indices: "+Je+" does not index into "+l.shape);for(var Et=0;Et<de;Et++)Te.values[qe*de+Et]=Fe[Ke*de+Et]}return Te.toTensor().reshape(ee)},p.prototype.scatterND=function(l,m,w){var P=Bl(0,l,w),K=P.sliceRank,ee=P.numUpdates,le=P.sliceSize,de=P.strides,Ee=P.outputSize,Te=Ar(0);return this.scatter(l,m,w,Ee,le,ee,K,de,Te,!0)},p.prototype.fill=function(l,m,w){var P=an(w=w||Ce(m),ze(l));return P.fill(m),He.makeTensor(P,l,w,this)},p.prototype.onesLike=function(l){if(l.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(l.shape,1,l.dtype)},p.prototype.zerosLike=function(l){var m=an(l.dtype,ze(l.shape));return this.makeOutput(m,l.shape,l.dtype)},p.prototype.linspace=function(l,m,w){return Si(l,m,w)},p.prototype.scatter=function(l,m,w,P,K,ee,le,de,Ee,Te){var Ne=[P/K,K],Fe=this.readSync(l.dataId),qe=this.readSync(m.dataId);if(P===0)return No([],w,m.dtype);var Je=new qr(Ne,m.dtype);Je.values.fill(this.readSync(Ee.dataId)[0]);for(var Ke=0;Ke<ee;Ke++){for(var it=[],gt=0,Et=0;Et<le;Et++){var At=Fe[Ke*le+Et];it.push(At),gt+=At*de[Et]}if(gt<0||gt>=P/K)throw new Error("Invalid indices: "+it+" does not index into "+w);for(var Wt=0;Wt<K;Wt++)Te?Je.values[gt*K+Wt]+=qe[Ke*K+Wt]:Je.values[gt*K+Wt]=m.rank===0?qe[0]:qe[Ke*K+Wt]}return Je.toTensor().reshape(w)},p}(un);function zr(b,p){return{kernelName:b,backendName:"cpu",kernelFunc:function(l){var m=l.inputs,w=l.backend,P=m,K=P.a,ee=P.b,le=w;Tn([K,ee],b);var de=le.data.get(K.dataId).values,Ee=le.data.get(ee.dataId).values,Te=p(K.shape,ee.shape,de,Ee,K.dtype),Ne=Te[0],Fe=Te[1];return{dataId:le.write(Ne,Fe,K.dtype),shape:Fe,dtype:K.dtype}}}}function ki(b){return function(p,l,m,w,P){var K=Xi(p,l),ee=K.length,le=on(K),de=kn(P,ze(K)),Ee=p.length,Te=l.length,Ne=on(p),Fe=on(l),qe=za(p,K),Je=za(l,K);if(qe.length+Je.length===0)for(var Ke=0;Ke<de.length;++Ke)de[Ke]=b(m[Ke%m.length],w[Ke%w.length]);else{var it=function(gt){var Et=ar(gt,ee,le),At=Et.slice(-Ee);qe.forEach(function(ln){return At[ln]=0});var Wt=or(At,Ee,Ne),cn=Et.slice(-Te);Je.forEach(function(ln){return cn[ln]=0});var pn=or(cn,Te,Fe);de[gt]=b(m[Wt],w[pn])};for(Ke=0;Ke<de.length;++Ke)it(Ke)}return[de,K]}}He.registerBackend("cpu",function(){return new Qr},1);var Pi=ki(function(b,p){return b/p}),Fi=zr(Xo,Pi),Mo={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(b){var p=b.inputs,l=b.attrs,m=b.backend,w=p.x,P=l,K=P.filterSize,ee=P.strides,le=P.pad,de=P.includeBatchInIndex,Ee=m;Tn(w,"MaxPoolWithArgmax");var Te=Ee.data.get(w.dataId).values,Ne=In(w.shape,K,ee,[1,1],le),Fe=function(gt,Et,At,Wt,cn){var pn=_r(gt,0,At,on(Et),cn,"max"),ln=Nr(gt,Et,At,cn,!0,Wt);return[pn.values,ln.values]}(Te,w.shape,w.dtype,de,Ne),qe=Fe[0],Je=Fe[1],Ke=Ee.write(qe,Ne.outShape,w.dtype),it=Ee.write(Je,Ne.outShape,w.dtype);return[{dataId:Ke,shape:Ne.outShape,dtype:w.dtype},{dataId:it,shape:Ne.outShape,dtype:"int32"}]}},Jo={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(b){var p=b.inputs,l=b.backend,m=b.attrs,w=p,P=w.boxes,K=w.scores,ee=m,le=ee.maxOutputSize,de=ee.iouThreshold,Ee=ee.scoreThreshold,Te=ee.softNmsSigma,Ne=l;Tn(P,"NonMaxSuppressionWithScore");var Fe=Go(Ne.data.get(P.dataId).values,Ne.data.get(K.dataId).values,le,de,Ee,Te);return[Fe.selectedIndices,Fe.selectedScores]}},jo={kernelName:"Square",backendName:"cpu",kernelFunc:function(b){var p=b.inputs,l=b.backend,m=p.x,w=l;Tn(m,"square");for(var P=w.data.get(m.dataId).values,K=new Float32Array(P.length),ee=0;ee<P.length;++ee){var le=P[ee];K[ee]=le*le}return{dataId:w.write(K,m.shape,m.dtype),shape:m.shape,dtype:m.dtype}}},Bo=ki(function(b,p){var l=b-p;return l*l});function Ho(b,p,l,m,w){for(var P=ze(p),K=p.length,ee=on(p),le=on(w),de=kn(l,ze(w)),Ee=0;Ee<P;++Ee){for(var Te=ar(Ee,K,ee),Ne=new Array(Te.length),Fe=0;Fe<Ne.length;Fe++)Ne[Fe]=Te[m[Fe]];de[or(Ne,K,le)]=b[Ee]}return de}for(var la=0,va=[Jo,jo,zr(bf,Bo),Fi,{kernelName:"Transpose",backendName:"cpu",kernelFunc:function(b){var p=b.inputs,l=b.attrs,m=b.backend,w=p.x,P=l.perm,K=m;Tn(w,"transpose");for(var ee=w.shape.length,le=new Array(ee),de=0;de<le.length;de++)le[de]=w.shape[P[de]];var Ee=Ho(K.data.get(w.dataId).values,w.shape,w.dtype,P,le);return{dataId:K.write(Ee,le,w.dtype),shape:le,dtype:w.dtype}}},Mo];la<va.length;la++)oe(va[la]);for(var Fa,mu=0,Li=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(b){var p=b.inputs,l=b.backend,m=b.attrs,w=p.pixels,P=m.numChannels,K=typeof HTMLVideoElement<"u"&&w instanceof HTMLVideoElement,ee=typeof HTMLImageElement<"u"&&w instanceof HTMLImageElement,le=K?[w.videoWidth,w.videoHeight]:[w.width,w.height],de=le[0],Ee=le[1],Te=[Ee,de],Ne=[Ee,de,P];(ee||K)&&(Fa==null&&(Fa=document.createElement("canvas").getContext("2d")),Fa.canvas.width=de,Fa.canvas.height=Ee,Fa.drawImage(w,0,0,de,Ee),w=Fa.canvas);var Fe=l.makeTensorInfo(Te,"int32");l.texData.get(Fe.dataId).usage=lr.PIXELS,l.gpgpu.uploadPixelDataToTexture(l.getTexture(Fe.dataId),w);var qe=j().getBool("WEBGL_PACK")?new function(Ke){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var it=Oo(),gt=Ke[0],Et=Ke[1];this.outputShape=Ke,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+Et+".0, "+gt+`.0);
            vec4 values = `+it.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+it.output+` = result;
      }
    `}(Ne):new function(Ke){this.variableNames=["A"];var it=Oo(),gt=Ke[0],Et=Ke[1];this.outputShape=Ke,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+Et+".0, "+gt+`.0);

        vec4 values = `+it.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}(Ne),Je=l.runWebGLProgram(qe,[Fe],"int32");return l.disposeData(Fe.dataId),Je}},{kernelName:Xo,backendName:"webgl",kernelFunc:function(b){var p=b.inputs,l=b.backend,m=p;return function(w,P,K){var ee=new Yo(`
if (a == b) {
  return 1.0;
};
return a / b;`,w.shape,P.shape);return j().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(ee=new Xa(`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,w.shape,P.shape,!0)),K.runWebGLProgram(ee,[w,P],"float32")}(m.a,m.b,l)}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(b){var p=b.inputs,l=b.backend,m=b.attrs;Ml("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var w=p,P=w.boxes,K=w.scores,ee=m,le=ee.maxOutputSize,de=ee.iouThreshold,Ee=ee.scoreThreshold,Te=ee.softNmsSigma,Ne=l,Fe=Go(Ne.readSync(P.dataId),Ne.readSync(K.dataId),le,de,Ee,Te);return[Fe.selectedIndices,Fe.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(b){var p=b.inputs,l=b.backend,m=p.x,w=l,P=new xo(m.shape,"return x * x;");return w.runWebGLProgram(P,[m],m.dtype)}},{kernelName:bf,backendName:"webgl",kernelFunc:function(b){var p=b.inputs,l=b.backend,m=p,w=m.a,P=m.b,K=l,ee=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xa("return (a - b) * (a - b);",w.shape,P.shape):new Yo("return (a - b) * (a - b);",w.shape,P.shape);return K.compileAndRun(ee,[w,P])}},{kernelName:"Transpose",backendName:"webgl",kernelFunc:function(b){for(var p,l=b.inputs,m=b.attrs,w=b.backend,P=l.x,K=m.perm,ee=w,le=P.shape.length,de=new Array(le),Ee=0;Ee<de.length;Ee++)de[Ee]=P.shape[K[Ee]];if(ee.shouldExecuteOnCPU([P])){var Te=Ho(ee.texData.get(P.dataId).values,P.shape,P.dtype,K,de);p=ee.makeTensorInfo(de,P.dtype),ee.texData.get(p.dataId).values=Te}else p=function(Ne,Fe,qe){var Je=j().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(Ke,it){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var gt=new Array(Ke.length),Et=0;Et<gt.length;Et++)gt[Et]=Ke[it[Et]];if(this.outputShape=gt,this.rank=gt.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var At=Wo(this.rank),Wt=ds("rc",this.rank),cn=new Array(this.rank);for(Et=0;Et<it.length;Et++)cn[it[Et]]=Wt[Et];var pn="vec2("+cn.slice(-2).join()+")",ln="++"+Wt[this.rank-1]+" < "+gt[this.rank-1],dn="getChannel(getA("+cn.join()+"), "+pn+")";this.userCode=`
    void main() {
      `+At+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+dn+`;
      if(`+ln+`) {
        result[1] = `+dn+`;
      }
      --`+Wt[this.rank-1]+`;
      if(++`+Wt[this.rank-2]+" < "+gt[this.rank-2]+`) {
        result[2] = `+dn+`;
        if(`+ln+`) {
          result[3] = `+dn+`;
        }
      }
      setOutput(result);
    }
    `}(Ne.shape,Fe):new function(Ke,it){this.variableNames=["A"];for(var gt=new Array(Ke.length),Et=0;Et<gt.length;Et++)gt[Et]=Ke[it[Et]];this.outputShape=gt,this.rank=gt.length;var At=Wo(this.rank),Wt=function(cn){var pn=cn.length;if(pn>6)throw Error("Transpose for rank "+pn+" is not yet supported");for(var ln=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],dn=new Array(pn),Nn=0;Nn<cn.length;Nn++)dn[cn[Nn]]=ln[Nn];return dn.join()}(it);this.userCode=`
    void main() {
      `+At+` resRC = getOutputCoords();
      setOutput(getA(`+Wt+`));
    }
    `}(Ne.shape,Fe);return qe.runWebGLProgram(Je,[Ne],Ne.dtype)}(P,K,ee);return p}},{kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(b){var p=b.inputs,l=b.attrs,m=b.backend,w=p.x,P=l,K=P.filterSize,ee=P.strides,le=P.pad,de=P.includeBatchInIndex,Ee=m;we(w.shape.length===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+w.shape.length+"."});var Te=[1,1];we(Fr(ee,Te),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+ee+" and dilations '"+Te+"'"});var Ne=In(w.shape,K,ee,Te,le),Fe=function(qe,Je,Ke,it){var gt=new $h(Ke,"max",!1),Et=it.runWebGLProgram(gt,[qe],"float32");return gt=new $h(Ke,"max",!0,!0,Je),[Et,it.runWebGLProgram(gt,[qe],"float32")]}(w,de,Ne,Ee);return[Fe[0],Fe[1]]}}];mu<Li.length;mu++)oe(Li[mu]);for(var ts=0,ss=[{kernelName:yf,inputsToSave:["a","b"],gradFunc:function(b,p){var l=p[0],m=p[1],w=Xi(l.shape,m.shape);return{a:function(){var P=b,K=Ga(l.shape,w);return K.length>0&&(P=P.sum(K)),P.reshape(l.shape)},b:function(){var P=b,K=Ga(m.shape,w);return K.length>0&&(P=P.sum(K)),P.reshape(m.shape)}}}},{kernelName:"AddN",saveAllInputs:!0,gradFunc:function(b,p){var l={};return p.forEach(function(m,w){l[w]=function(){return b.clone()}}),l}},{kernelName:il,gradFunc:function(b,p,l){for(var m=l,w=m.inputShape,P=m.shape,K=Array.from(P),ee=w.length-1;ee>=0;ee--)if(w[ee]===P[ee])K[ee]=1;else if(w[ee]!==1)throw new Error("broadcastTo(): ["+w+"] cannot be broadcast to ["+P+"].");var le=[];for(ee=0;ee<K.length;ee++)K[ee]>1&&le.push(ee);return{x:function(){return b.sum(le,!0)}}}},{kernelName:Xo,inputsToSave:["a","b"],gradFunc:function(b,p){var l=p[0],m=p[1],w=Xi(l.shape,m.shape);return{a:function(){var P=aa(b,m.toFloat()),K=Ga(l.shape,w);return K.length>0?Jl(P,K).reshape(l.shape):P},b:function(){var P=b.mul(l.toFloat()),K=Ga(m.shape,w);K.length>0&&(P=Jl(P,K).reshape(m.shape));var ee=Bf(m);return Da(aa(P,ee.toFloat()))}}}},{kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(b,p,l){var m=l.varianceEpsilon,w=p[0],P=p[1],K=p[2],ee=p[3],le=Sv(w),de=ee??Ar(1),Ee=Ga(P.shape,le.shape),Te=[];if(P.rank===1){for(var Ne=0;Ne<le.shape.length-1;++Ne)Te.push(le.shape[Ne]);Te.push(1)}var Fe=Ua(w,P),qe=oa(b,de),Je=Cf(ha(K,Ar(m))),Ke=oa(oa(oa(Je,Je),Je),Ar(-.5));return{x:function(){return P.rank===1?Ps(oa(oa(b,Vd(Je.as4D(1,1,1,P.shape[0]),Te)),de),w.shape):Ps(oa(oa(b,Je),de),w.shape)},mean:function(){var it=oa(oa(Je,Ar(-1)),qe);return P.rank===1&&(it=Jl(it,Ee)),Ps(it,P.shape)},variance:function(){var it=oa(oa(Ke,Fe),qe);return P.rank===1&&(it=Jl(it,Ee)),Ps(it,P.shape)},scale:function(){var it=oa(Fe,Je),gt=oa(b,it);return P.rank===1&&(gt=Jl(gt,Ee)),Ps(gt,P.shape)},offset:function(){var it=b;return P.rank===1&&(it=Jl(it,Ee)),Ps(it,P.shape)}}}},{kernelName:Ed,gradFunc:function(b){return{x:function(){return b.toFloat()}}}},{kernelName:Uh,inputsToSave:["indices"],gradFunc:function(b,p){var l=p[0];return{indices:function(){return uo(l.shape,"float32")}}}},{kernelName:ol,inputsToSave:["x"],gradFunc:function(b,p,l){var m=p[0],w=l.paddings.map(function(P){return P[0]});return{x:function(){return b.slice(w,m.shape)}}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:function(b,p){var l=p[0];return{x:function(){return b.mul(l.toFloat().mul(2))}}}},{kernelName:bf,inputsToSave:["a","b"],gradFunc:function(b,p){var l=p[0],m=p[1],w=Ar(2);return{a:function(){return oa(b,oa(w,Ua(l,m)))},b:function(){return oa(b,oa(w,Ua(m,l)))}}}},{kernelName:wf,inputsToSave:["x"],gradFunc:function(b,p,l){var m=p[0],w=l.reps;return{x:function(){var P=vi(m);if(m.rank===1)for(var K=0;K<w[0];++K)P=P.add(b.slice([K*m.shape[0]],[m.shape[0]]));else if(m.rank===2)for(K=0;K<w[0];++K)for(var ee=0;ee<w[1];++ee)P=P.add(b.slice([K*m.shape[0],ee*m.shape[1]],[m.shape[0],m.shape[1]]));else if(m.rank===3)for(K=0;K<w[0];++K)for(ee=0;ee<w[1];++ee)for(var le=0;le<w[2];++le)P=P.add(b.slice([K*m.shape[0],ee*m.shape[1],le*m.shape[2]],[m.shape[0],m.shape[1],m.shape[2]]));else{if(m.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+m.rank+" tensors yet.");for(K=0;K<w[0];++K)for(ee=0;ee<w[1];++ee)for(le=0;le<w[2];++le)for(var de=0;de<w[3];++de)P=P.add(b.slice([K*m.shape[0],ee*m.shape[1],le*m.shape[2],de*m.shape[3]],[m.shape[0],m.shape[1],m.shape[2],m.shape[3]]))}return P}}}},{kernelName:"Transpose",gradFunc:function(b,p,l){var m=$u(l.perm);return{x:function(){return bt(b,m)}}}}];ts<ss.length;ts++)ye(ss[ts]);var gu=function(){function b(){}return b.prototype.fetch=function(p,l){return fetch(p,l)},b.prototype.now=function(){return performance.now()},b.prototype.encode=function(p,l){if(l!=="utf-8"&&l!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+l);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(p)},b.prototype.decode=function(p,l){return new TextDecoder(l).decode(p)},b}();j().get("IS_BROWSER")&&j().setPlatform("browser",new gu);var Ws,Pu=function(){function b(){this.util=r(388),this.textEncoder=new this.util.TextEncoder}return b.prototype.fetch=function(p,l){return j().global.fetch!=null?j().global.fetch(p,l):(Ws==null&&(Ws=r(389)),Ws(p,l))},b.prototype.now=function(){var p=S.hrtime();return 1e3*p[0]+p[1]/1e6},b.prototype.encode=function(p,l){if(l!=="utf-8"&&l!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+l);return this.textEncoder.encode(p)},b.prototype.decode=function(p,l){return p.length===0?"":new this.util.TextDecoder(l).decode(p)},b}();j().get("IS_NODE")&&j().setPlatform("node",new Pu);var Lu={float32:4,int32:4,uint16:2,uint8:1,bool:1},Bu=4;function up(b,p){for(var l={},m=0,w=function(ee){var le=ee.name,de=ee.dtype,Ee=ee.shape,Te=ze(Ee),Ne=void 0;if("quantization"in ee){var Fe=ee.quantization;if(Fe.dtype!=="uint8"&&Fe.dtype!=="uint16")throw new Error("Weight "+ee.name+" has unknown quantization dtype "+Fe.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var qe=Lu[Fe.dtype],Je=b.slice(m,m+Te*qe),Ke=Fe.dtype==="uint8"?new Uint8Array(Je):new Uint16Array(Je);if(de==="float32")Ne=Float32Array.from(Ke,function(cn){return cn*Fe.scale+Fe.min});else{if(de!=="int32")throw new Error("Unsupported dtype in weight '"+le+"': "+de);Ne=Int32Array.from(Ke,function(cn){return Math.round(cn*Fe.scale+Fe.min)})}m+=Te*qe}else if(de==="string"){var it=ze(ee.shape);Ne=[];for(var gt=0;gt<it;gt++){var Et=new Uint32Array(b.slice(m,m+Bu))[0];m+=Bu;var At=new Uint8Array(b.slice(m,m+Et));Ne.push(At),m+=Et}}else{var Wt=Lu[de];if(Je=b.slice(m,m+Te*Wt),de==="float32")Ne=new Float32Array(Je);else if(de==="int32")Ne=new Int32Array(Je);else{if(de!=="bool")throw new Error("Unsupported dtype in weight '"+le+"': "+de);Ne=new Uint8Array(Je)}m+=Te*Wt}l[le]=No(Ne,Ee,de)},P=0,K=p;P<K.length;P++)w(K[P]);return l}var Qd=E!==void 0&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function Ql(b){return Qd?E.byteLength(b):new Blob([b]).size}function Gf(b){var p=0;b.forEach(function(w){p+=w.byteLength});var l=new Uint8Array(p),m=0;return b.forEach(function(w){l.set(new Uint8Array(w),m),m+=w.byteLength}),l.buffer}function Zl(b){for(b=b.trim();b.endsWith("/");)b=b.slice(0,b.length-1);var p=b.split("/");return p[p.length-1]}function wc(b){if(b.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:b.modelTopology==null?0:Ql(JSON.stringify(b.modelTopology)),weightSpecsBytes:b.weightSpecs==null?0:Ql(JSON.stringify(b.weightSpecs)),weightDataBytes:b.weightData==null?0:b.weightData.byteLength}}var Ka=function(){function b(){this.saveRouters=[],this.loadRouters=[]}return b.getInstance=function(){return b.instance==null&&(b.instance=new b),b.instance},b.registerSaveRouter=function(p){b.getInstance().saveRouters.push(p)},b.registerLoadRouter=function(p){b.getInstance().loadRouters.push(p)},b.getSaveHandlers=function(p){return b.getHandlers(p,"save")},b.getLoadHandlers=function(p,l){return b.getHandlers(p,"load",l)},b.getHandlers=function(p,l,m){var w=[];return(l==="load"?b.getInstance().loadRouters:b.getInstance().saveRouters).forEach(function(P){var K=P(p,m);K!==null&&w.push(K)}),w},b}(),qf="://",Zd=function(){function b(){this.managers={}}return b.getInstance=function(){return b.instance==null&&(b.instance=new b),b.instance},b.registerManager=function(p,l){we(p!=null,function(){return"scheme must not be undefined or null."}),p.endsWith(qf)&&(p=p.slice(0,p.indexOf(qf))),we(p.length>0,function(){return"scheme must not be an empty string."});var m=b.getInstance();we(m.managers[p]==null,function(){return"A model store manager is already registered for scheme '"+p+"'."}),m.managers[p]=l},b.getManager=function(p){var l=this.getInstance().managers[p];if(l==null)throw new Error("Cannot find model manager for scheme '"+p+"'");return l},b.getSchemes=function(){return Object.keys(this.getInstance().managers)},b}();function cp(b){if(b.indexOf(qf)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Zd.getSchemes().join(","));return{scheme:b.split(qf)[0],path:b.split(qf)[1]}}function $f(b,p,l){return l===void 0&&(l=!1),D(this,void 0,void 0,function(){var m,w,P,K,ee,le,de,Ee,Te;return R(this,function(Ne){switch(Ne.label){case 0:return we(b!==p,function(){return"Old path and new path are the same: '"+b+"'"}),we((m=Ka.getLoadHandlers(b)).length>0,function(){return"Copying failed because no load handler is found for source URL "+b+"."}),we(m.length<2,function(){return"Copying failed because more than one ("+m.length+") load handlers for source URL "+b+"."}),w=m[0],we((P=Ka.getSaveHandlers(p)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+p+"."}),we(P.length<2,function(){return"Copying failed because more than one ("+m.length+") save handlers for destination URL "+p+"."}),K=P[0],ee=cp(b).scheme,le=cp(b).path,de=ee===cp(b).scheme,[4,w.load()];case 1:return Ee=Ne.sent(),l&&de?[4,Zd.getManager(ee).removeModel(le)]:[3,3];case 2:Ne.sent(),Ne.label=3;case 3:return[4,K.save(Ee)];case 4:return Te=Ne.sent(),!l||de?[3,6]:[4,Zd.getManager(ee).removeModel(le)];case 5:Ne.sent(),Ne.label=6;case 6:return[2,Te.modelArtifactsInfo]}})})}var As="models_store",eh="model_info_store";function lp(){if(!j().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var b=window||self,p=b.indexedDB||b.mozIndexedDB||b.webkitIndexedDB||b.msIndexedDB||b.shimIndexedDB;if(p==null)throw new Error("The current browser does not appear to support IndexedDB.");return p}function fp(b){var p=b.result;p.createObjectStore(As,{keyPath:"modelPath"}),p.createObjectStore(eh,{keyPath:"modelPath"})}var vl=function(){function b(p){if(this.indexedDB=lp(),p==null||!p)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=p}return b.prototype.save=function(p){return D(this,void 0,void 0,function(){return R(this,function(l){if(p.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,p)]})})},b.prototype.load=function(){return D(this,void 0,void 0,function(){return R(this,function(p){return[2,this.databaseAction(this.modelPath)]})})},b.prototype.databaseAction=function(p,l){var m=this;return new Promise(function(w,P){var K=m.indexedDB.open("tensorflowjs",1);K.onupgradeneeded=function(){return fp(K)},K.onsuccess=function(){var ee=K.result;if(l==null){var le=ee.transaction(As,"readonly"),de=le.objectStore(As).get(m.modelPath);de.onsuccess=function(){if(de.result==null)return ee.close(),P(new Error("Cannot find model with path '"+m.modelPath+"' in IndexedDB."));w(de.result.modelArtifacts)},de.onerror=function(Je){return ee.close(),P(de.error)},le.oncomplete=function(){return ee.close()}}else{var Ee,Te=wc(l),Ne=ee.transaction(eh,"readwrite"),Fe=Ne.objectStore(eh),qe=Fe.put({modelPath:m.modelPath,modelArtifactsInfo:Te});qe.onsuccess=function(){var Je=(Ee=ee.transaction(As,"readwrite")).objectStore(As).put({modelPath:m.modelPath,modelArtifacts:l,modelArtifactsInfo:Te});Je.onsuccess=function(){return w({modelArtifactsInfo:Te})},Je.onerror=function(Ke){var it=(Fe=Ne.objectStore(eh)).delete(m.modelPath);it.onsuccess=function(){return ee.close(),P(Je.error)},it.onerror=function(gt){return ee.close(),P(Je.error)}}},qe.onerror=function(Je){return ee.close(),P(qe.error)},Ne.oncomplete=function(){Ee==null?ee.close():Ee.oncomplete=function(){return ee.close()}}}},K.onerror=function(ee){return P(K.error)}})},b.URL_SCHEME="indexeddb://",b}(),Nm=function(b){return j().getBool("IS_BROWSER")&&!Array.isArray(b)&&b.startsWith(vl.URL_SCHEME)?(p=b.slice(vl.URL_SCHEME.length),new vl(p)):null;var p};Ka.registerSaveRouter(Nm),Ka.registerLoadRouter(Nm);var _c=function(){function b(){this.indexedDB=lp()}return b.prototype.listModels=function(){return D(this,void 0,void 0,function(){var p=this;return R(this,function(l){return[2,new Promise(function(m,w){var P=p.indexedDB.open("tensorflowjs",1);P.onupgradeneeded=function(){return fp(P)},P.onsuccess=function(){var K=P.result,ee=K.transaction(eh,"readonly"),le=ee.objectStore(eh).getAll();le.onsuccess=function(){for(var de={},Ee=0,Te=le.result;Ee<Te.length;Ee++){var Ne=Te[Ee];de[Ne.modelPath]=Ne.modelArtifactsInfo}m(de)},le.onerror=function(de){return K.close(),w(le.error)},ee.oncomplete=function(){return K.close()}},P.onerror=function(K){return w(P.error)}})]})})},b.prototype.removeModel=function(p){return D(this,void 0,void 0,function(){var l=this;return R(this,function(m){var w;return p=(w=p).startsWith(vl.URL_SCHEME)?w.slice(vl.URL_SCHEME.length):w,[2,new Promise(function(P,K){var ee=l.indexedDB.open("tensorflowjs",1);ee.onupgradeneeded=function(){return fp(ee)},ee.onsuccess=function(){var le,de=ee.result,Ee=de.transaction(eh,"readwrite"),Te=Ee.objectStore(eh),Ne=Te.get(p);Ne.onsuccess=function(){if(Ne.result==null)return de.close(),K(new Error("Cannot find model with path '"+p+"' in IndexedDB."));var Fe=Te.delete(p),qe=function(){var Je=(le=de.transaction(As,"readwrite")).objectStore(As).delete(p);Je.onsuccess=function(){return P(Ne.result.modelArtifactsInfo)},Je.onerror=function(Ke){return K(Ne.error)}};Fe.onsuccess=qe,Fe.onerror=function(Je){return qe(),de.close(),K(Ne.error)}},Ne.onerror=function(Fe){return de.close(),K(Ne.error)},Ee.oncomplete=function(){le==null?de.close():le.oncomplete=function(){return de.close()}}},ee.onerror=function(le){return K(ee.error)}})]})})},b}();if(j().getBool("IS_BROWSER"))try{Zd.registerManager(vl.URL_SCHEME,new _c)}catch{}var Vs="/",oc="tensorflowjs_models",Os="info",ef="model_topology",th="weight_specs",dp="weight_data",nh="model_metadata";function Im(b){return{info:[oc,b,Os].join(Vs),topology:[oc,b,ef].join(Vs),weightSpecs:[oc,b,th].join(Vs),weightData:[oc,b,dp].join(Vs),modelMetadata:[oc,b,nh].join(Vs)}}function tf(b){var p=b.split(Vs);if(p.length<3)throw new Error("Invalid key format: "+b);return p.slice(1,p.length-1).join(Vs)}var ku=function(){function b(p){if(!j().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,p==null||!p)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=p,this.keys=Im(this.modelPath)}return b.prototype.save=function(p){return D(this,void 0,void 0,function(){var l,m,w;return R(this,function(P){if(p.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");l=JSON.stringify(p.modelTopology),m=JSON.stringify(p.weightSpecs),w=wc(p);try{return this.LS.setItem(this.keys.info,JSON.stringify(w)),this.LS.setItem(this.keys.topology,l),this.LS.setItem(this.keys.weightSpecs,m),this.LS.setItem(this.keys.weightData,function(K){if(Qd)return E.from(K).toString("base64");for(var ee=new Uint8Array(K),le="",de=0,Ee=ee.length;de<Ee;de++)le+=String.fromCharCode(ee[de]);return btoa(le)}(p.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:p.format,generatedBy:p.generatedBy,convertedBy:p.convertedBy,userDefinedMetadata:p.userDefinedMetadata})),[2,{modelArtifactsInfo:w}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+w.modelTopologyBytes+", weightSpecsBytes="+w.weightSpecsBytes+", weightDataBytes="+w.weightDataBytes+".")}return[2]})})},b.prototype.load=function(){return D(this,void 0,void 0,function(){var p,l,m,w,P,K,ee;return R(this,function(le){if((p=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(p.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(l={},(m=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(l.modelTopology=m,(w=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(l.weightSpecs=w,(P=this.LS.getItem(this.keys.modelMetadata))!=null&&(K=JSON.parse(P),l.format=K.format,l.generatedBy=K.generatedBy,l.convertedBy=K.convertedBy,l.userDefinedMetadata=K.userDefinedMetadata),(ee=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return l.weightData=function(de){if(Qd){var Ee=E.from(de,"base64");return Ee.buffer.slice(Ee.byteOffset,Ee.byteOffset+Ee.byteLength)}for(var Te=atob(de),Ne=new Uint8Array(Te.length),Fe=0;Fe<Te.length;++Fe)Ne.set([Te.charCodeAt(Fe)],Fe);return Ne.buffer}(ee),[2,l]})})},b.URL_SCHEME="localstorage://",b}(),H1=function(b){return j().getBool("IS_BROWSER")&&!Array.isArray(b)&&b.startsWith(ku.URL_SCHEME)?(p=b.slice(ku.URL_SCHEME.length),new ku(p)):null;var p};Ka.registerSaveRouter(H1),Ka.registerLoadRouter(H1);var nf=function(){function b(){we(j().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),we(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return b.prototype.listModels=function(){return D(this,void 0,void 0,function(){var p,l,m,w,P,K;return R(this,function(ee){for(p={},l=oc+Vs,m=Vs+Os,w=0;w<this.LS.length;++w)(P=this.LS.key(w)).startsWith(l)&&P.endsWith(m)&&(K=tf(P),p[K]=JSON.parse(this.LS.getItem(P)));return[2,p]})})},b.prototype.removeModel=function(p){return D(this,void 0,void 0,function(){var l,m;return R(this,function(w){var P;if(p=(P=p).startsWith(ku.URL_SCHEME)?P.slice(ku.URL_SCHEME.length):P,l=Im(p),this.LS.getItem(l.info)==null)throw new Error("Cannot find model at path '"+p+"'");return m=JSON.parse(this.LS.getItem(l.info)),this.LS.removeItem(l.info),this.LS.removeItem(l.topology),this.LS.removeItem(l.weightSpecs),this.LS.removeItem(l.weightData),[2,m]})})},b}();if(j().getBool("IS_BROWSER"))try{Zd.registerManager(ku.URL_SCHEME,new nf)}catch{}var hp="model",G1=".json",q1=".weights.bin";function $1(b){return new Promise(function(p){return setTimeout(p)}).then(b)}var Xv=function(){function b(p){if(!j().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");p.startsWith(b.URL_SCHEME)&&(p=p.slice(b.URL_SCHEME.length)),p!=null&&p.length!==0||(p=hp),this.modelTopologyFileName=p+G1,this.weightDataFileName=p+q1}return b.prototype.save=function(p){return D(this,void 0,void 0,function(){var l,m,w,P,K,ee;return R(this,function(le){switch(le.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(l=window.URL.createObjectURL(new Blob([p.weightData],{type:"application/octet-stream"})),!(p.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return m=[{paths:["./"+this.weightDataFileName],weights:p.weightSpecs}],w={modelTopology:p.modelTopology,format:p.format,generatedBy:p.generatedBy,convertedBy:p.convertedBy,weightsManifest:m},P=window.URL.createObjectURL(new Blob([JSON.stringify(w)],{type:"application/json"})),(K=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,K.href=P,[4,$1(function(){return K.dispatchEvent(new MouseEvent("click"))})];case 2:return le.sent(),p.weightData==null?[3,4]:((ee=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,ee.href=l,[4,$1(function(){return ee.dispatchEvent(new MouseEvent("click"))})]);case 3:le.sent(),le.label=4;case 4:return[2,{modelArtifactsInfo:wc(p)}]}})})},b.URL_SCHEME="downloads://",b}(),Vy=function(){function b(p){if(p==null||p.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+p);this.files=p}return b.prototype.load=function(){return D(this,void 0,void 0,function(){var p,l,m=this;return R(this,function(w){return p=this.files[0],l=this.files.slice(1),[2,new Promise(function(P,K){var ee=new FileReader;ee.onload=function(le){var de=JSON.parse(le.target.result),Ee=de.modelTopology;if(Ee!=null){l.length===0&&P({modelTopology:Ee});var Te=de.weightsManifest;if(Te!=null){var Ne;try{Ne=m.checkManifestAndWeightFiles(Te,l)}catch(Ke){return void K(Ke)}var Fe=[],qe=[],Je=[];Te.forEach(function(Ke){Ke.paths.forEach(function(it){qe.push(it),Je.push(null)}),Fe.push.apply(Fe,Ke.weights)}),Te.forEach(function(Ke){Ke.paths.forEach(function(it){var gt=new FileReader;gt.onload=function(Et){var At=Et.target.result,Wt=qe.indexOf(it);Je[Wt]=At,Je.indexOf(null)===-1&&P({modelTopology:Ee,weightSpecs:Fe,weightData:Gf(Je),format:de.format,generatedBy:de.generatedBy,convertedBy:de.convertedBy,userDefinedMetadata:de.userDefinedMetadata})},gt.onerror=function(Et){return K("Failed to weights data from file of path '"+it+"'.")},gt.readAsArrayBuffer(Ne[it])})})}else K(new Error("weightManifest field is missing from file "+p.name))}else K(new Error("modelTopology field is missing from file "+p.name))},ee.onerror=function(le){return K("Failed to read model topology and weights manifest JSON from file '"+p.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},ee.readAsText(p)})]})})},b.prototype.checkManifestAndWeightFiles=function(p,l){for(var m=[],w=l.map(function(le){return Zl(le.name)}),P={},K=0,ee=p;K<ee.length;K++)ee[K].paths.forEach(function(le){var de=Zl(le);if(m.indexOf(de)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+de+"'");if(m.push(de),w.indexOf(de)===-1)throw new Error("Weight file with basename '"+de+"' is not provided.");P[le]=l[w.indexOf(de)]});if(m.length!==l.length)throw new Error("Mismatch in the number of files in weights manifest ("+m.length+") and the number of weight files provided ("+l.length+").");return P},b}();function Kv(b,p,l,m){(function(P){we(P!=null&&Array.isArray(P)&&P.length>0,function(){return"promises must be a none empty array"})})(b),function(P,K){we(P>=0&&P<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+P}),we(K>=0&&K<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+K}),we(K>=P,function(){return"startFraction must be no more than endFraction, but got startFraction "+P+" and endFraction "+K})}(l=l??0,m=m??1);var w=0;return Promise.all(b.map(function(P){return P.then(function(K){var ee=l+ ++w/b.length*(m-l);return p(ee),K}),P}))}function Hy(b,p){return D(this,void 0,void 0,function(){var l,m,w,P,K,ee,le,de,Ee;return R(this,function(Te){switch(Te.label){case 0:return p==null&&(p={}),l=p.fetchFunc==null?j().platform.fetch:p.fetchFunc,m=b.map(function(Ne){return l(Ne,p.requestInit,{isBinary:!0})}),w=0,P=.5,p.onProgress!=null?[3,2]:[4,Promise.all(m)];case 1:return K=Te.sent(),[3,4];case 2:return[4,Kv(m,p.onProgress,w,P)];case 3:K=Te.sent(),Te.label=4;case 4:return ee=K.map(function(Ne){return Ne.arrayBuffer()}),le=.5,de=1,p.onProgress!=null?[3,6]:[4,Promise.all(ee)];case 5:return Ee=Te.sent(),[3,8];case 6:return[4,Kv(ee,p.onProgress,le,de)];case 7:Ee=Te.sent(),Te.label=8;case 8:return[2,Ee]}})})}function Gc(b){var p=this;return function(l,m,w){return m===void 0&&(m=""),D(p,void 0,void 0,function(){var P,K,ee,le,de,Ee,Te,Ne,Fe,qe;return R(this,function(Je){switch(Je.label){case 0:if(P=l.map(function(){return!1}),K={},ee=w!=null?w.map(function(){return!1}):[],le=[],l.forEach(function(Ke,it){var gt=0;Ke.weights.forEach(function(Et){var At="quantization"in Et?Et.quantization.dtype:Et.dtype,Wt=Lu[At]*ze(Et.shape),cn=function(){P[it]=!0,K[it]==null&&(K[it]=[]),K[it].push({manifestEntry:Et,groupOffset:gt,sizeBytes:Wt})};w!=null?w.forEach(function(pn,ln){pn===Et.name&&(cn(),ee[ln]=!0)}):cn(),le.push(Et.name),gt+=Wt})}),!ee.every(function(Ke){return Ke}))throw de=w.filter(function(Ke,it){return!ee[it]}),new Error("Could not find weights in manifest with names: "+de.join(", ")+`. 
Manifest JSON has weights with names: `+le.join(", ")+".");return Ee=P.reduce(function(Ke,it,gt){return it&&Ke.push(gt),Ke},[]),Te=[],Ee.forEach(function(Ke){l[Ke].paths.forEach(function(it){var gt=m+(m.endsWith("/")?"":"/")+it;Te.push(gt)})}),[4,b(Te)];case 1:return Ne=Je.sent(),Fe={},qe=0,Ee.forEach(function(Ke){for(var it=l[Ke].paths.length,gt=0,Et=0;Et<it;Et++)gt+=Ne[qe+Et].byteLength;for(var At=new ArrayBuffer(gt),Wt=new Uint8Array(At),cn=0,pn=0;pn<it;pn++){var ln=new Uint8Array(Ne[qe+pn]);Wt.set(ln,cn),cn+=ln.byteLength}K[Ke].forEach(function(dn){var Nn=up(At.slice(dn.groupOffset,dn.groupOffset+dn.sizeBytes),[dn.manifestEntry]);for(var jn in Nn)Fe[jn]=Nn[jn]}),qe+=it}),[2,Fe]}})})}}Ka.registerSaveRouter(function(b){return j().getBool("IS_BROWSER")&&!Array.isArray(b)&&b.startsWith(Xv.URL_SCHEME)?function(p){return p===void 0&&(p="model"),new Xv(p)}(b.slice(Xv.URL_SCHEME.length)):null});var X1=function(){function b(p,l){if(this.DEFAULT_METHOD="POST",l==null&&(l={}),this.weightPathPrefix=l.weightPathPrefix,this.onProgress=l.onProgress,l.fetchFunc!=null?(we(typeof l.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=l.fetchFunc):this.fetch=j().platform.fetch,we(p!=null&&p.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(p)&&we(p.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+p.length+")."}),this.path=p,l.requestInit!=null&&l.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=l.requestInit||{}}return b.prototype.save=function(p){return D(this,void 0,void 0,function(){var l,m,w,P;return R(this,function(K){switch(K.label){case 0:if(p.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(l=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,m=[{paths:["./model.weights.bin"],weights:p.weightSpecs}],w={modelTopology:p.modelTopology,format:p.format,generatedBy:p.generatedBy,convertedBy:p.convertedBy,userDefinedMetadata:p.userDefinedMetadata,weightsManifest:m},l.body.append("model.json",new Blob([JSON.stringify(w)],{type:"application/json"}),"model.json"),p.weightData!=null&&l.body.append("model.weights.bin",new Blob([p.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,l)];case 1:if((P=K.sent()).ok)return[2,{modelArtifactsInfo:wc(p),responses:[P]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+P.status+".")}})})},b.prototype.load=function(){return D(this,void 0,void 0,function(){var p,l,m,w,P,K,ee,le,de,Ee,Te,Ne;return R(this,function(Fe){switch(Fe.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(p=Fe.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+p.status+". Please verify this URL points to the model JSON of the model to load.");Fe.label=2;case 2:return Fe.trys.push([2,4,,5]),[4,p.json()];case 3:return l=Fe.sent(),[3,5];case 4:throw Fe.sent(),m="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?m+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":m+=" Please make sure the server is serving valid JSON for this request.",new Error(m);case 5:if(w=l.modelTopology,P=l.weightsManifest,K=l.generatedBy,ee=l.convertedBy,le=l.format,de=l.userDefinedMetadata,w==null&&P==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return P==null?[3,7]:[4,this.loadWeights(P)];case 6:Ne=Fe.sent(),Ee=Ne[0],Te=Ne[1],Fe.label=7;case 7:return[2,{modelTopology:w,weightSpecs:Ee,weightData:Te,userDefinedMetadata:de,generatedBy:K,convertedBy:ee,format:le}]}})})},b.prototype.loadWeights=function(p){return D(this,void 0,void 0,function(){var l,m,w,P,K,ee,le,de,Ee,Te,Ne;return R(this,function(Fe){switch(Fe.label){case 0:for(l=Array.isArray(this.path)?this.path[1]:this.path,m=function(qe){var Je=qe.lastIndexOf("/"),Ke=qe.lastIndexOf("?");return[qe.substring(0,Je)+"/",Ke>Je?qe.substring(Ke):""]}(l),w=m[0],P=m[1],K=this.weightPathPrefix||w,ee=[],le=0,de=p;le<de.length;le++)Ee=de[le],ee.push.apply(ee,Ee.weights);return Te=[],p.forEach(function(qe){qe.paths.forEach(function(Je){Te.push(K+Je+P)})}),[4,Hy(Te,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return Ne=Fe.sent(),[2,[ee,Gf(Ne)]]}})})},b.URL_SCHEME_REGEX=/^https?:\/\//,b}();function Ec(b){return b.match(X1.URL_SCHEME_REGEX)!=null}var Xf=function(b,p){return typeof fetch>"u"?null:(Array.isArray(b)?b.every(function(l){return Ec(l)}):Ec(b))?_(b,{onProgress:p}):null};function _(b,p){return new X1(b,p)}Ka.registerSaveRouter(Xf),Ka.registerLoadRouter(Xf);var v,d=function(){function b(p){this.modelArtifacts=p}return b.prototype.load=function(){return D(this,void 0,void 0,function(){return R(this,function(p){return[2,this.modelArtifacts]})})},b}(),y=function(){function b(p){this.saveHandler=p}return b.prototype.save=function(p){return D(this,void 0,void 0,function(){return R(this,function(l){return[2,this.saveHandler(p)]})})},b}(),C=Object.freeze({browserFiles:function(b){return new Vy(b)},browserHTTPRequest:function(b,p){return _(b,p)},concatenateArrayBuffers:Gf,decodeWeights:up,encodeWeights:function(b,p){return D(this,void 0,void 0,function(){var l,m,w,P,K,ee=this;return R(this,function(le){switch(le.label){case 0:for(l=[],m=[],w=Array.isArray(b)?b.map(function(de){return de.name}):Object.keys(b),P=function(de){var Ee=w[de],Te=Array.isArray(b)?b[de].tensor:b[Ee];if(Te.dtype!=="float32"&&Te.dtype!=="int32"&&Te.dtype!=="bool"&&Te.dtype!=="string")throw new Error("Unsupported dtype in weight '"+Ee+"': "+Te.dtype);var Ne={name:Ee,shape:Te.shape,dtype:Te.dtype};if(Te.dtype==="string"){var Fe=new Promise(function(qe){return D(ee,void 0,void 0,function(){var Je,Ke,it,gt,Et,At,Wt;return R(this,function(cn){switch(cn.label){case 0:return[4,Te.bytes()];case 1:for(Je=cn.sent(),Ke=Je.reduce(function(pn,ln){return pn+ln.length},0)+Bu*Je.length,it=new Uint8Array(Ke),gt=0,Et=0;Et<Je.length;Et++)At=Je[Et],Wt=new Uint8Array(new Uint32Array([At.length]).buffer),it.set(Wt,gt),gt+=Bu,it.set(At,gt),gt+=At.length;return qe(it),[2]}})})});m.push(Fe)}else m.push(Te.data());p!=null&&(Ne.group=p),l.push(Ne)},K=0;K<w.length;++K)P(K);return[4,Promise.all(m)];case 1:return[2,{data:function(de){if(de===null)throw new Error("Invalid input value: "+JSON.stringify(de));var Ee=0,Te=[];de.forEach(function(qe){if(Ee+=qe.byteLength,Te.push(qe.byteLength===qe.buffer.byteLength?qe:new qe.constructor(qe)),!(qe instanceof Float32Array||qe instanceof Int32Array||qe instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+qe.constructor.name)});var Ne=new Uint8Array(Ee),Fe=0;return Te.forEach(function(qe){Ne.set(new Uint8Array(qe.buffer),Fe),Fe+=qe.byteLength}),Ne.buffer}(le.sent()),specs:l}]}})})},fromMemory:function(b,p,l,m){return arguments.length===1?b.modelTopology!=null||b.weightSpecs!=null?new d(b):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new d({modelTopology:b})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new d({modelTopology:b,weightSpecs:p,weightData:l,trainingConfig:m}))},getLoadHandlers:function(b,p){return Ka.getLoadHandlers(b,p)},getModelArtifactsInfoForJSON:wc,getSaveHandlers:function(b){return Ka.getSaveHandlers(b)},http:_,isHTTPScheme:Ec,loadWeights:function(b,p,l,m){return p===void 0&&(p=""),D(this,void 0,void 0,function(){return R(this,function(w){return[2,Gc(function(P){return Hy(P,{requestInit:m})})(b,p,l)]})})},registerLoadRouter:function(b){return Ka.registerLoadRouter(b)},registerSaveRouter:function(b){return Ka.registerSaveRouter(b)},weightsLoaderFactory:Gc,withSaveHandler:function(b){return new y(b)},copyModel:function(b,p){return D(this,void 0,void 0,function(){return R(this,function(l){return[2,$f(b,p,!1)]})})},listModels:function(){return D(this,void 0,void 0,function(){var b,p,l,m,w,P,K;return R(this,function(ee){switch(ee.label){case 0:b=Zd.getSchemes(),p={},l=0,m=b,ee.label=1;case 1:return l<m.length?(w=m[l],[4,Zd.getManager(w).listModels()]):[3,4];case 2:for(K in P=ee.sent())p[w+qf+K]=P[K];ee.label=3;case 3:return l++,[3,1];case 4:return[2,p]}})})},moveModel:function(b,p){return D(this,void 0,void 0,function(){return R(this,function(l){return[2,$f(b,p,!0)]})})},removeModel:function(b){return D(this,void 0,void 0,function(){var p;return R(this,function(l){return p=cp(b),[2,Zd.getManager(p.scheme).removeModel(p.path)]})})}}),z=Lt({confusionMatrix_:function(b,p,l){var m=Ze(b,"labels","confusionMatrix"),w=Ze(p,"predictions","confusionMatrix");we(l==null||l>0&&Number.isInteger(l),function(){return"If provided, numClasses must be a positive integer, but got "+l}),we(m.rank===1,function(){return"Expected the rank of labels to be 1, but got "+m.rank}),we(w.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+w.rank}),we(m.shape[0]===w.shape[0],function(){return"Mismatch in the number of examples: "+m.shape[0]+" vs. "+w.shape[0]+". Labels and predictions should have the same number of elements."}),we(l>0&&Number.isInteger(l),function(){return"numClasses is required to be a positive integer, but got "+l});var P=Uc(m.asType("int32"),l),K=Uc(w.asType("int32"),l);return P.transpose().matMul(K).asType("int32")}}),Z=Object.freeze({confusionMatrix:z}),re=Lt({fromPixels_:function(b,p){if(p===void 0&&(p=3),p>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(b==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var l=!1,m=!1,w=!1,P=!1,K=!1;if(b.data instanceof Uint8Array)l=!0;else if(typeof ImageData<"u"&&b instanceof ImageData)m=!0;else if(typeof HTMLVideoElement<"u"&&b instanceof HTMLVideoElement)w=!0;else if(typeof HTMLImageElement<"u"&&b instanceof HTMLImageElement)P=!0;else{if(b.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+b.constructor.name);K=!0}if(w&&w&&b.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(Y("FromPixels",He.backendName)!=null)return He.runKernel("FromPixels",{pixels:b},{numChannels:p});var ee,le,de=w?[b.videoWidth,b.videoHeight]:[b.width,b.height],Ee=de[0],Te=de[1];if(K?ee=b.getContext("2d").getImageData(0,0,Ee,Te).data:m||l?ee=b.data:(P||w)&&(v==null&&(v=document.createElement("canvas").getContext("2d")),v.canvas.width=Ee,v.canvas.height=Te,v.drawImage(b,0,0,Ee,Te),ee=v.getImageData(0,0,Ee,Te).data),p===4)le=new Int32Array(ee);else{var Ne=Ee*Te;le=new Int32Array(Ne*p);for(var Fe=0;Fe<Ne;Fe++)for(var qe=0;qe<p;++qe)le[Fe*p+qe]=ee[4*Fe+qe]}return Dl(le,[Te,Ee,p],"int32")}}),fe=Object.freeze({toPixels:function(b,p){return D(this,void 0,void 0,function(){var l,m,w,P,K,ee,le,de,Ee,Te,Ne,Fe,qe,Je,Ke,it,gt,Et,At,Wt,cn,pn,ln;return R(this,function(dn){switch(dn.label){case 0:if(l=Ze(b,"img","toPixels"),b instanceof Qt||(l=l.toInt()),l.rank!==2&&l.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+l.rank+".");if(m=l.shape.slice(0,2),w=m[0],P=m[1],(K=l.rank===2?1:l.shape[2])>4||K===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+K);return[4,l.data()];case 1:return ee=dn.sent(),le=l.min(),de=l.max(),[4,Promise.all([le.data(),de.data()])];case 2:if(Ee=dn.sent(),Te=Ee[0],Ne=Ee[1],Fe=Te[0],qe=Ne[0],le.dispose(),de.dispose(),l.dtype==="float32"){if(Fe<0||qe>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+Fe+" - "+qe+"].")}else{if(l.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+l.dtype+". Please use float32 or int32 tensors.");if(Fe<0||qe>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+Fe+" - "+qe+"].")}for(Je=l.dtype==="float32"?255:1,Ke=new Uint8ClampedArray(P*w*4),it=0;it<w*P;++it)gt=void 0,Et=void 0,At=void 0,Wt=void 0,K===1?(gt=ee[it]*Je,Et=ee[it]*Je,At=ee[it]*Je,Wt=255):K===3?(gt=ee[3*it]*Je,Et=ee[3*it+1]*Je,At=ee[3*it+2]*Je,Wt=255):K===4&&(gt=ee[4*it]*Je,Et=ee[4*it+1]*Je,At=ee[4*it+2]*Je,Wt=ee[4*it+3]*Je),Ke[0+(cn=4*it)]=Math.round(gt),Ke[cn+1]=Math.round(Et),Ke[cn+2]=Math.round(At),Ke[cn+3]=Math.round(Wt);return p!=null&&(p.width=P,p.height=w,pn=p.getContext("2d"),ln=new ImageData(Ke,P,w),pn.putImageData(ln,0,0)),l!==b&&l.dispose(),[2,Ke]}})})},fromPixels:re}),xe=function(){function b(){}return b.prototype.getClassName=function(){return this.constructor.className},b.fromConfig=function(p,l){return new p(l)},b}(),Oe=function(){function b(){this.classNameMap={}}return b.getMap=function(){return b.instance==null&&(b.instance=new b),b.instance},b.register=function(p){b.getMap().classNameMap[p.className]=[p,p.fromConfig]},b}();function Re(b){we(b.className!=null,function(){return"Class being registered does not have the static className property defined."}),we(typeof b.className=="string",function(){return"className is required to be a string, but got type "+typeof b.className}),we(b.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),Oe.register(b)}var Le=Object.freeze({Serializable:xe,SerializationMap:Oe,registerClass:Re}),Be="1.7.4",Xe=Object.freeze({gpgpu_util:ll,webgl_util:yd,forceHalfFloat:function(){j().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:sg,setWebGLContext:Ai,GPGPUContext:s0}),nt=function(b){function p(){return b!==null&&b.apply(this,arguments)||this}return B(p,b),p.prototype.minimize=function(l,m,w){m===void 0&&(m=!1);var P=this.computeGradients(l,w),K=P.value,ee=P.grads;if(w!=null){var le=w.map(function(de){return{name:de.name,tensor:ee[de.name]}});this.applyGradients(le)}else this.applyGradients(ee);return zo(ee),m?K:(K.dispose(),null)},Object.defineProperty(p.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),p.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},p.prototype.computeGradients=function(l,m){return N(l,m)},p.prototype.dispose=function(){this.iterations_!=null&&zo(this.iterations_)},p.prototype.saveIterations=function(){return D(this,void 0,void 0,function(){return R(this,function(l){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Ar(this.iterations_,"int32")}]})})},p.prototype.getWeights=function(){return D(this,void 0,void 0,function(){return R(this,function(l){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},p.prototype.setWeights=function(l){return D(this,void 0,void 0,function(){return R(this,function(m){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},p.prototype.extractIterations=function(l){return D(this,void 0,void 0,function(){var m;return R(this,function(w){switch(w.label){case 0:return m=this,[4,l[0].tensor.data()];case 1:return m.iterations_=w.sent()[0],[2,l.slice(1)]}})})},p}(xe);Object.defineProperty(nt,Symbol.hasInstance,{value:function(b){return b.minimize!=null&&b.computeGradients!=null&&b.applyGradients!=null}});var tt=function(b){function p(l,m,w){w===void 0&&(w=null);var P=b.call(this)||this;return P.learningRate=l,P.rho=m,P.epsilon=w,P.accumulatedGrads=[],P.accumulatedUpdates=[],w==null&&(P.epsilon=He.backend.epsilon()),P}return B(p,b),p.prototype.applyGradients=function(l){var m=this;(Array.isArray(l)?l.map(function(w){return w.name}):Object.keys(l)).forEach(function(w,P){var K=He.registeredVariables[w];m.accumulatedGrads[P]==null&&(m.accumulatedGrads[P]={originalName:w+"/accum_grad",variable:qi(function(){return vi(K).variable(!1)})}),m.accumulatedUpdates[P]==null&&(m.accumulatedUpdates[P]={originalName:w+"/accum_var",variable:qi(function(){return vi(K).variable(!1)})});var ee=Array.isArray(l)?l[P].tensor:l[w];if(ee!=null){var le=m.accumulatedGrads[P].variable,de=m.accumulatedUpdates[P].variable;qi(function(){var Ee=le.mul(m.rho).add(ee.square().mul(1-m.rho)),Te=de.add(m.epsilon).sqrt().div(le.add(m.epsilon).sqrt()).mul(ee),Ne=de.mul(m.rho).add(Te.square().mul(1-m.rho));le.assign(Ee),de.assign(Ne);var Fe=Te.mul(-m.learningRate).add(K);K.assign(Fe)})}}),this.incrementIterations()},p.prototype.dispose=function(){this.accumulatedUpdates!=null&&(zo(this.accumulatedGrads.map(function(l){return l.variable})),zo(this.accumulatedUpdates.map(function(l){return l.variable})))},p.prototype.getWeights=function(){return D(this,void 0,void 0,function(){var l;return R(this,function(m){switch(m.label){case 0:return l=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[m.sent()].concat(l.map(function(w){return{name:w.originalName,tensor:w.variable}}))]}})})},p.prototype.setWeights=function(l){return D(this,void 0,void 0,function(){var m;return R(this,function(w){switch(w.label){case 0:return[4,this.extractIterations(l)];case 1:return l=w.sent(),m=l.length/2,this.accumulatedGrads=l.slice(0,m).map(function(P){return{originalName:P.name,variable:P.tensor.variable(!1)}}),this.accumulatedUpdates=l.slice(m,2*m).map(function(P){return{originalName:P.name,variable:P.tensor.variable(!1)}}),[2]}})})},p.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},p.fromConfig=function(l,m){return new l(m.learningRate,m.rho,m.epsilon)},p.className="Adadelta",p}(nt);Re(tt);var ut=function(b){function p(l,m){m===void 0&&(m=.1);var w=b.call(this)||this;return w.learningRate=l,w.initialAccumulatorValue=m,w.accumulatedGrads=[],w}return B(p,b),p.prototype.applyGradients=function(l){var m=this;(Array.isArray(l)?l.map(function(w){return w.name}):Object.keys(l)).forEach(function(w,P){var K=He.registeredVariables[w];m.accumulatedGrads[P]==null&&(m.accumulatedGrads[P]={originalName:w+"/accumulator",variable:qi(function(){return Rs(K.shape,m.initialAccumulatorValue).variable(!1)})});var ee=Array.isArray(l)?l[P].tensor:l[w];if(ee!=null){var le=m.accumulatedGrads[P].variable;qi(function(){var de=le.add(ee.square());le.assign(de);var Ee=ee.div(de.add(He.backend.epsilon()).sqrt()).mul(-m.learningRate).add(K);K.assign(Ee)})}}),this.incrementIterations()},p.prototype.dispose=function(){this.accumulatedGrads!=null&&zo(this.accumulatedGrads.map(function(l){return l.variable}))},p.prototype.getWeights=function(){return D(this,void 0,void 0,function(){return R(this,function(l){switch(l.label){case 0:return[4,this.saveIterations()];case 1:return[2,[l.sent()].concat(this.accumulatedGrads.map(function(m){return{name:m.originalName,tensor:m.variable}}))]}})})},p.prototype.setWeights=function(l){return D(this,void 0,void 0,function(){return R(this,function(m){switch(m.label){case 0:return[4,this.extractIterations(l)];case 1:return l=m.sent(),this.accumulatedGrads=l.map(function(w){return{originalName:w.name,variable:w.tensor.variable(!1)}}),[2]}})})},p.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},p.fromConfig=function(l,m){return new l(m.learningRate,m.initialAccumulatorValue)},p.className="Adagrad",p}(nt);Re(ut);var Nt=function(b){function p(l,m,w,P){P===void 0&&(P=null);var K=b.call(this)||this;return K.learningRate=l,K.beta1=m,K.beta2=w,K.epsilon=P,K.accumulatedFirstMoment=[],K.accumulatedSecondMoment=[],qi(function(){K.accBeta1=Ar(m).variable(),K.accBeta2=Ar(w).variable()}),P==null&&(K.epsilon=He.backend.epsilon()),K}return B(p,b),p.prototype.applyGradients=function(l){var m=this,w=Array.isArray(l)?l.map(function(P){return P.name}):Object.keys(l);qi(function(){var P=Ua(1,m.accBeta1),K=Ua(1,m.accBeta2);w.forEach(function(ee,le){var de=He.registeredVariables[ee];m.accumulatedFirstMoment[le]==null&&(m.accumulatedFirstMoment[le]={originalName:ee+"/m",variable:qi(function(){return vi(de).variable(!1)})}),m.accumulatedSecondMoment[le]==null&&(m.accumulatedSecondMoment[le]={originalName:ee+"/v",variable:qi(function(){return vi(de).variable(!1)})});var Ee=Array.isArray(l)?l[le].tensor:l[ee];if(Ee!=null){var Te=m.accumulatedFirstMoment[le].variable,Ne=m.accumulatedSecondMoment[le].variable,Fe=Te.mul(m.beta1).add(Ee.mul(1-m.beta1)),qe=Ne.mul(m.beta2).add(Ee.square().mul(1-m.beta2)),Je=Fe.div(P),Ke=qe.div(K);Te.assign(Fe),Ne.assign(qe);var it=Je.div(Ke.sqrt().add(m.epsilon)).mul(-m.learningRate).add(de);de.assign(it)}}),m.accBeta1.assign(m.accBeta1.mul(m.beta1)),m.accBeta2.assign(m.accBeta2.mul(m.beta2))}),this.incrementIterations()},p.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&zo(this.accumulatedFirstMoment.map(function(l){return l.variable})),this.accumulatedSecondMoment!=null&&zo(this.accumulatedSecondMoment.map(function(l){return l.variable}))},p.prototype.getWeights=function(){return D(this,void 0,void 0,function(){var l;return R(this,function(m){switch(m.label){case 0:return l=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[m.sent()].concat(l.map(function(w){return{name:w.originalName,tensor:w.variable}}))]}})})},p.prototype.setWeights=function(l){return D(this,void 0,void 0,function(){var m,w=this;return R(this,function(P){switch(P.label){case 0:return[4,this.extractIterations(l)];case 1:return l=P.sent(),qi(function(){w.accBeta1.assign(lu(w.beta1,w.iterations_+1)),w.accBeta2.assign(lu(w.beta2,w.iterations_+1))}),m=l.length/2,this.accumulatedFirstMoment=l.slice(0,m).map(function(K){return{originalName:K.name,variable:K.tensor.variable(!1)}}),this.accumulatedSecondMoment=l.slice(m,2*m).map(function(K){return{originalName:K.name,variable:K.tensor.variable(!1)}}),[2]}})})},p.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},p.fromConfig=function(l,m){return new l(m.learningRate,m.beta1,m.beta2,m.epsilon)},p.className="Adam",p}(nt);Re(Nt);var Pt=function(b){function p(l,m,w,P,K){P===void 0&&(P=null),K===void 0&&(K=0);var ee=b.call(this)||this;return ee.learningRate=l,ee.beta1=m,ee.beta2=w,ee.epsilon=P,ee.decay=K,ee.accumulatedFirstMoment=[],ee.accumulatedWeightedInfNorm=[],qi(function(){ee.iteration=Ar(0).variable(),ee.accBeta1=Ar(m).variable()}),P==null&&(ee.epsilon=He.backend.epsilon()),ee}return B(p,b),p.prototype.applyGradients=function(l){var m=this,w=Array.isArray(l)?l.map(function(P){return P.name}):Object.keys(l);qi(function(){var P=Ua(1,m.accBeta1),K=aa(-m.learningRate,m.iteration.mul(m.decay).add(1));w.forEach(function(ee,le){var de=He.registeredVariables[ee];m.accumulatedFirstMoment[le]==null&&(m.accumulatedFirstMoment[le]={originalName:ee+"/m",variable:vi(de).variable(!1)}),m.accumulatedWeightedInfNorm[le]==null&&(m.accumulatedWeightedInfNorm[le]={originalName:ee+"/v",variable:vi(de).variable(!1)});var Ee=Array.isArray(l)?l[le].tensor:l[ee];if(Ee!=null){var Te=m.accumulatedFirstMoment[le].variable,Ne=m.accumulatedWeightedInfNorm[le].variable,Fe=Te.mul(m.beta1).add(Ee.mul(1-m.beta1)),qe=Ne.mul(m.beta2),Je=Ee.abs(),Ke=qe.maximum(Je);Te.assign(Fe),Ne.assign(Ke);var it=K.div(P).mul(Fe.div(Ke.add(m.epsilon))).add(de);de.assign(it)}}),m.iteration.assign(m.iteration.add(1)),m.accBeta1.assign(m.accBeta1.mul(m.beta1))}),this.incrementIterations()},p.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&zo(this.accumulatedFirstMoment.map(function(l){return l.variable})),this.accumulatedWeightedInfNorm!=null&&zo(this.accumulatedWeightedInfNorm.map(function(l){return l.variable}))},p.prototype.getWeights=function(){return D(this,void 0,void 0,function(){return R(this,function(l){throw new Error("getWeights() is not implemented for Adamax yet.")})})},p.prototype.setWeights=function(l){return D(this,void 0,void 0,function(){return R(this,function(m){throw new Error("setWeights() is not implemented for Adamax yet.")})})},p.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},p.fromConfig=function(l,m){return new l(m.learningRate,m.beta1,m.beta2,m.epsilon,m.decay)},p.className="Adamax",p}(nt);Re(Pt);var jt=function(b){function p(l){var m=b.call(this)||this;return m.learningRate=l,m.setLearningRate(l),m}return B(p,b),p.prototype.applyGradients=function(l){var m=this;(Array.isArray(l)?l.map(function(w){return w.name}):Object.keys(l)).forEach(function(w,P){var K=Array.isArray(l)?l[P].tensor:l[w];if(K!=null){var ee=He.registeredVariables[w];qi(function(){var le=m.c.mul(K).add(ee);ee.assign(le)})}}),this.incrementIterations()},p.prototype.setLearningRate=function(l){this.learningRate=l,this.c!=null&&this.c.dispose(),this.c=Dh(Ar(-l))},p.prototype.dispose=function(){this.c.dispose()},p.prototype.getWeights=function(){return D(this,void 0,void 0,function(){return R(this,function(l){switch(l.label){case 0:return[4,this.saveIterations()];case 1:return[2,[l.sent()]]}})})},p.prototype.setWeights=function(l){return D(this,void 0,void 0,function(){return R(this,function(m){switch(m.label){case 0:return[4,this.extractIterations(l)];case 1:if((l=m.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},p.prototype.getConfig=function(){return{learningRate:this.learningRate}},p.fromConfig=function(l,m){return new l(m.learningRate)},p.className="SGD",p}(nt);Re(jt);var Yt=function(b){function p(l,m,w){w===void 0&&(w=!1);var P=b.call(this,l)||this;return P.learningRate=l,P.momentum=m,P.useNesterov=w,P.accumulations=[],P.m=Ar(P.momentum),P}return B(p,b),p.prototype.applyGradients=function(l){var m=this;(Array.isArray(l)?l.map(function(w){return w.name}):Object.keys(l)).forEach(function(w,P){var K=He.registeredVariables[w];m.accumulations[P]==null&&(m.accumulations[P]={originalName:w+"/momentum",variable:qi(function(){return vi(K).variable(!1)})});var ee=m.accumulations[P].variable,le=Array.isArray(l)?l[P].tensor:l[w];le!=null&&qi(function(){var de,Ee=m.m.mul(ee).add(le);de=m.useNesterov?m.c.mul(le.add(Ee.mul(m.m))).add(K):m.c.mul(Ee).add(K),ee.assign(Ee),K.assign(de)})}),this.incrementIterations()},p.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&zo(this.accumulations.map(function(l){return l.variable}))},p.prototype.setMomentum=function(l){this.momentum=l},p.prototype.getWeights=function(){return D(this,void 0,void 0,function(){return R(this,function(l){switch(l.label){case 0:return[4,this.saveIterations()];case 1:return[2,[l.sent()].concat(this.accumulations.map(function(m){return{name:m.originalName,tensor:m.variable}}))]}})})},p.prototype.setWeights=function(l){return D(this,void 0,void 0,function(){return R(this,function(m){switch(m.label){case 0:return[4,this.extractIterations(l)];case 1:return l=m.sent(),this.accumulations=l.map(function(w){return{originalName:w.name,variable:w.tensor.variable(!1)}}),[2]}})})},p.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},p.fromConfig=function(l,m){return new l(m.learningRate,m.momentum,m.useNesterov)},p.className="Momentum",p}(jt);Re(Yt);var gn=function(b){function p(l,m,w,P,K){m===void 0&&(m=.9),w===void 0&&(w=0),P===void 0&&(P=null),K===void 0&&(K=!1);var ee=b.call(this)||this;if(ee.learningRate=l,ee.decay=m,ee.momentum=w,ee.epsilon=P,ee.accumulatedMeanSquares=[],ee.accumulatedMoments=[],ee.accumulatedMeanGrads=[],ee.centered=K,P==null&&(ee.epsilon=He.backend.epsilon()),l==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return ee}return B(p,b),p.prototype.applyGradients=function(l){var m=this;(Array.isArray(l)?l.map(function(w){return w.name}):Object.keys(l)).forEach(function(w,P){var K=He.registeredVariables[w];m.accumulatedMeanSquares[P]==null&&(m.accumulatedMeanSquares[P]={originalName:w+"/rms",variable:qi(function(){return vi(K).variable(!1)})}),m.accumulatedMoments[P]==null&&(m.accumulatedMoments[P]={originalName:w+"/momentum",variable:qi(function(){return vi(K).variable(!1)})}),m.accumulatedMeanGrads[P]==null&&m.centered&&(m.accumulatedMeanGrads[P]={originalName:w+"/mg",variable:qi(function(){return vi(K).variable(!1)})});var ee=Array.isArray(l)?l[P].tensor:l[w];if(ee!=null){var le=m.accumulatedMeanSquares[P].variable,de=m.accumulatedMoments[P].variable;qi(function(){var Ee=le.mul(m.decay).add(ee.square().mul(1-m.decay));if(m.centered){var Te=m.accumulatedMeanGrads[P].variable,Ne=Te.mul(m.decay).add(ee.mul(1-m.decay)),Fe=de.mul(m.momentum).add(ee.mul(m.learningRate).div(Ee.sub(Ne.square().add(m.epsilon)).sqrt()));le.assign(Ee),Te.assign(Ne),de.assign(Fe);var qe=K.sub(Fe);K.assign(qe)}else{var Je=le.mul(m.decay).add(ee.square().mul(1-m.decay));Fe=de.mul(m.momentum).add(ee.mul(m.learningRate).div(Je.add(m.epsilon).sqrt())),le.assign(Je),de.assign(Fe),qe=K.sub(Fe),K.assign(qe)}})}}),this.incrementIterations()},p.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&zo(this.accumulatedMeanSquares.map(function(l){return l.variable})),this.accumulatedMeanGrads!=null&&this.centered&&zo(this.accumulatedMeanGrads.map(function(l){return l.variable})),this.accumulatedMoments!=null&&zo(this.accumulatedMoments.map(function(l){return l.variable}))},p.prototype.getWeights=function(){return D(this,void 0,void 0,function(){var l;return R(this,function(m){switch(m.label){case 0:return l=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&l.push.apply(l,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[m.sent()].concat(l.map(function(w){return{name:w.originalName,tensor:w.variable}}))]}})})},p.prototype.setWeights=function(l){return D(this,void 0,void 0,function(){var m;return R(this,function(w){switch(w.label){case 0:return[4,this.extractIterations(l)];case 1:return l=w.sent(),m=this.centered?l.length/3:l.length/2,this.accumulatedMeanSquares=l.slice(0,m).map(function(P){return{originalName:P.name,variable:P.tensor.variable(!1)}}),this.accumulatedMoments=l.slice(m,2*m).map(function(P){return{originalName:P.name,variable:P.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=l.slice(2*m,3*m).map(function(P){return{originalName:P.name,variable:P.tensor.variable(!1)}})),[2]}})})},p.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},p.fromConfig=function(l,m){return new l(m.learningRate,m.decay,m.momentum,m.epsilon,m.centered)},p.className="RMSProp",p}(nt);Re(gn);var wn=function(){function b(){}return b.sgd=function(p){return new jt(p)},b.momentum=function(p,l,m){return m===void 0&&(m=!1),new Yt(p,l,m)},b.rmsprop=function(p,l,m,w,P){return l===void 0&&(l=.9),m===void 0&&(m=0),w===void 0&&(w=null),P===void 0&&(P=!1),new gn(p,l,m,w,P)},b.adam=function(p,l,m,w){return p===void 0&&(p=.001),l===void 0&&(l=.9),m===void 0&&(m=.999),w===void 0&&(w=null),new Nt(p,l,m,w)},b.adadelta=function(p,l,m){return p===void 0&&(p=.001),l===void 0&&(l=.95),m===void 0&&(m=null),new tt(p,l,m)},b.adamax=function(p,l,m,w,P){return p===void 0&&(p=.002),l===void 0&&(l=.9),m===void 0&&(m=.999),w===void 0&&(w=null),P===void 0&&(P=0),new Pt(p,l,m,w,P)},b.adagrad=function(p,l){return l===void 0&&(l=.1),new ut(p,l)},b}(),vn={sgd:wn.sgd,momentum:wn.momentum,adadelta:wn.adadelta,adagrad:wn.adagrad,rmsprop:wn.rmsprop,adamax:wn.adamax,adam:wn.adam},Cn=typeof requestAnimationFrame<"u"?requestAnimationFrame:A!==void 0?A:function(b){return b()};function Dn(){return new Promise(function(b){return Cn(function(){return b()})})}Qt.prototype.add=function(b){return ha(this,b)},Qt.prototype.broadcastTo=function(b){return Pf(this,b)},Qt.prototype.div=function(b){return aa(this,b)},Qt.prototype.divNoNan=function(b){return cg(this,b)},Qt.prototype.squaredDifference=function(b){return mg(this,b)},Qt.prototype.tile=function(b){return Vd(this,b)},Qt.prototype.oneHot=function(b,p,l){return p===void 0&&(p=1),l===void 0&&(l=0),Uc(this,b,p,l)},Qt.prototype.transpose=function(b){return bt(this,b)},Qt.prototype.pad=function(b,p){return ic(this,b,p)},Qt.prototype.batchNorm=function(b,p,l,m,w){return Ff(this,b,p,l,m,w)},Tt=Jn}.call(this,r(59),r(75),r(92).Buffer,r(207).setImmediate)},function(s,a,r){function c(mt,Mt,hn){return mt.fields=Mt||[],mt.fname=hn,mt}function S(mt){return mt==null?null:mt.fname}function E(mt){return mt==null?null:mt.fields}function A(mt){return mt.length===1?U(mt[0]):B(mt)}r.d(a,"a",function(){return me}),r.d(a,"b",function(){return ye}),r.d(a,"c",function(){return pe}),r.d(a,"d",function(){return oe}),r.d(a,"e",function(){return _e}),r.d(a,"f",function(){return c}),r.d(a,"g",function(){return E}),r.d(a,"h",function(){return S}),r.d(a,"i",function(){return Pn}),r.d(a,"j",function(){return Mr}),r.d(a,"k",function(){return An}),r.d(a,"l",function(){return sr}),r.d(a,"m",function(){return Kt}),r.d(a,"n",function(){return Vt}),r.d(a,"o",function(){return D}),r.d(a,"p",function(){return en}),r.d(a,"q",function(){return Vn}),r.d(a,"r",function(){return Dt}),r.d(a,"s",function(){return q}),r.d(a,"t",function(){return yr}),r.d(a,"u",function(){return W}),r.d(a,"v",function(){return kr}),r.d(a,"w",function(){return or}),r.d(a,"x",function(){return j}),r.d(a,"y",function(){return H}),r.d(a,"z",function(){return dr}),r.d(a,"A",function(){return oi}),r.d(a,"B",function(){return lt}),r.d(a,"C",function(){return Ur}),r.d(a,"D",function(){return Xr}),r.d(a,"E",function(){return Qn}),r.d(a,"F",function(){return zn}),r.d(a,"G",function(){return ir}),r.d(a,"H",function(){return It}),r.d(a,"I",function(){return Or}),r.d(a,"J",function(){return qr}),r.d(a,"K",function(){return Kr}),r.d(a,"L",function(){return Tt}),r.d(a,"M",function(){return Ge}),r.d(a,"N",function(){return Qt}),r.d(a,"O",function(){return Se}),r.d(a,"P",function(){return we}),r.d(a,"Q",function(){return Q}),r.d(a,"R",function(){return ke}),r.d(a,"S",function(){return _t}),r.d(a,"T",function(){return Xt}),r.d(a,"U",function(){return sn}),r.d(a,"V",function(){return kn}),r.d(a,"W",function(){return Ot}),r.d(a,"X",function(){return $t}),r.d(a,"Y",function(){return ve}),r.d(a,"Z",function(){return Me}),r.d(a,"Aa",function(){return R}),r.d(a,"Ba",function(){return rt}),r.d(a,"Ca",function(){return Ct}),r.d(a,"Da",function(){return Sn}),r.d(a,"Ea",function(){return ze}),r.d(a,"Fa",function(){return Zt}),r.d(a,"Ga",function(){return Rt}),r.d(a,"Ha",function(){return mn}),r.d(a,"Ia",function(){return Y}),r.d(a,"Ja",function(){return Jt}),r.d(a,"Ka",function(){return fn}),r.d(a,"La",function(){return yt}),r.d(a,"Ma",function(){return I}),r.d(a,"Na",function(){return Ve}),r.d(a,"Oa",function(){return Ye}),r.d(a,"Pa",function(){return $e}),r.d(a,"Qa",function(){return ft});const U=mt=>function(Mt){return Mt[mt]},B=mt=>{const Mt=mt.length;return function(hn){for(let nn=0;nn<Mt;++nn)hn=hn[mt[nn]];return hn}};function D(mt){throw Error(mt)}function R(mt){const Mt=[],hn=mt.length;let nn,He,Bn,Xn=null,Zn=0,lr="";function jr(){Mt.push(lr+mt.substring(nn,He)),lr="",nn=He+1}for(mt+="",nn=He=0;He<hn;++He)if((Bn=mt[He])==="\\")lr+=mt.substring(nn,He),lr+=mt.substring(++He,++He),nn=He;else if(Bn===Xn)jr(),Xn=null,Zn=-1;else{if(Xn)continue;nn===Zn&&Bn==='"'||nn===Zn&&Bn==="'"?(nn=He+1,Xn=Bn):Bn!=="."||Zn?Bn==="["?(He>nn&&jr(),Zn=nn=He+1):Bn==="]"&&(Zn||D("Access path missing open bracket: "+mt),Zn>0&&jr(),Zn=0,nn=He+1):He>nn?jr():nn=He+1}return Zn&&D("Access path missing closing bracket: "+mt),Xn&&D("Access path missing closing quote: "+mt),He>nn&&(He++,jr()),Mt}function W(mt,Mt,hn){const nn=R(mt);return mt=nn.length===1?nn[0]:mt,c((hn&&hn.get||A)(nn),[mt],Mt||mt)}const j=W("id"),H=c(mt=>mt,[],"identity"),I=c(()=>0,[],"zero"),Q=c(()=>1,[],"one"),Y=c(()=>!0,[],"true"),q=c(()=>!1,[],"false");function ae(mt,Mt,hn){const nn=[Mt].concat([].slice.call(hn));console[mt].apply(console,nn)}const oe=0,ye=1,_e=2,pe=3,me=4;function Ge(mt,Mt){let hn=mt||oe;return{level(nn){return arguments.length?(hn=+nn,this):hn},error(){return hn>=ye&&ae(Mt||"error","ERROR",arguments),this},warn(){return hn>=_e&&ae(Mt||"warn","WARN",arguments),this},info(){return hn>=pe&&ae(Mt||"log","INFO",arguments),this},debug(){return hn>=me&&ae(Mt||"log","DEBUG",arguments),this}}}var lt=Array.isArray;function It(mt){return mt===Object(mt)}const wt=mt=>mt!=="__proto__";function we(...mt){return mt.reduce((Mt,hn)=>{for(const nn in hn)if(nn==="signals")Mt.signals=Bt(Mt.signals,hn.signals);else{const He=nn==="legend"?{layout:1}:nn==="style"||null;yt(Mt,nn,hn[nn],He)}return Mt},{})}function yt(mt,Mt,hn,nn){if(!wt(Mt))return;let He,Bn;if(It(hn)&&!lt(hn))for(He in Bn=It(mt[Mt])?mt[Mt]:mt[Mt]={},hn)nn&&(nn===!0||nn[He])?yt(Bn,He,hn[He]):wt(He)&&(Bn[He]=hn[He]);else mt[Mt]=hn}function Bt(mt,Mt){if(mt==null)return Mt;const hn={},nn=[];function He(Bn){hn[Bn.name]||(hn[Bn.name]=1,nn.push(Bn))}return Mt.forEach(He),mt.forEach(He),nn}function Ot(mt){return mt[mt.length-1]}function ze(mt){return mt==null||mt===""?null:+mt}const Ut=mt=>Mt=>mt*Math.exp(Mt),Ft=mt=>Mt=>Math.log(mt*Mt),pt=mt=>Mt=>Math.sign(Mt)*Math.log1p(Math.abs(Mt/mt)),vt=mt=>Mt=>Math.sign(Mt)*Math.expm1(Math.abs(Mt))*mt,rn=mt=>Mt=>Mt<0?-Math.pow(-Mt,mt):Math.pow(Mt,mt);function xt(mt,Mt,hn,nn){const He=hn(mt[0]),Bn=hn(Ot(mt)),Xn=(Bn-He)*Mt;return[nn(He-Xn),nn(Bn-Xn)]}function _t(mt,Mt){return xt(mt,Mt,ze,H)}function Xt(mt,Mt){var hn=Math.sign(mt[0]);return xt(mt,Mt,Ft(hn),Ut(hn))}function sn(mt,Mt,hn){return xt(mt,Mt,rn(hn),rn(1/hn))}function kn(mt,Mt,hn){return xt(mt,Mt,pt(hn),vt(hn))}function an(mt,Mt,hn,nn,He){const Bn=nn(mt[0]),Xn=nn(Ot(mt)),Zn=Mt!=null?nn(Mt):(Bn+Xn)/2;return[He(Zn+(Bn-Zn)*hn),He(Zn+(Xn-Zn)*hn)]}function Ve(mt,Mt,hn){return an(mt,Mt,hn,ze,H)}function Ye(mt,Mt,hn){const nn=Math.sign(mt[0]);return an(mt,Mt,hn,Ft(nn),Ut(nn))}function $e(mt,Mt,hn,nn){return an(mt,Mt,hn,rn(nn),rn(1/nn))}function ft(mt,Mt,hn,nn){return an(mt,Mt,hn,pt(nn),vt(nn))}function $t(mt){return 1+~~(new Date(mt).getMonth()/3)}function Jt(mt){return 1+~~(new Date(mt).getUTCMonth()/3)}function Pn(mt){return mt!=null?lt(mt)?mt:[mt]:[]}function An(mt,Mt,hn){let nn,He=mt[0],Bn=mt[1];return Bn<He&&(nn=Bn,Bn=He,He=nn),(nn=Bn-He)>=hn-Mt?[Mt,hn]:[He=Math.min(Math.max(He,Mt),hn-nn),He+nn]}function Qn(mt){return typeof mt=="function"}const Ce="descending";function sr(mt,Mt,hn){hn=hn||{},Mt=Pn(Mt)||[];const nn=[],He=[],Bn={},Xn=hn.comparator||on;return Pn(mt).forEach((Zn,lr)=>{Zn!=null&&(nn.push(Mt[lr]===Ce?-1:1),He.push(Zn=Qn(Zn)?Zn:W(Zn,null,hn)),(E(Zn)||[]).forEach(jr=>Bn[jr]=1))}),He.length===0?null:c(Xn(He,nn),Object.keys(Bn))}const Mr=(mt,Mt)=>(mt<Mt||mt==null)&&Mt!=null?-1:(mt>Mt||Mt==null)&&mt!=null?1:(Mt=Mt instanceof Date?+Mt:Mt,(mt=mt instanceof Date?+mt:mt)!==mt&&Mt==Mt?-1:Mt!=Mt&&mt==mt?1:0),on=(mt,Mt)=>mt.length===1?Gt(mt[0],Mt[0]):Hn(mt,Mt,mt.length),Gt=(mt,Mt)=>function(hn,nn){return Mr(mt(hn),mt(nn))*Mt},Hn=(mt,Mt,hn)=>(Mt.push(0),function(nn,He){let Bn,Xn=0,Zn=-1;for(;Xn===0&&++Zn<hn;)Bn=mt[Zn],Xn=Mr(Bn(nn),Bn(He));return Xn*Mt[Zn]});function Kt(mt){return Qn(mt)?mt:()=>mt}function Vt(mt,Mt){let hn;return nn=>{hn&&clearTimeout(hn),hn=setTimeout(()=>(Mt(nn),hn=null),mt)}}function en(mt){for(let Mt,hn,nn=1,He=arguments.length;nn<He;++nn)for(hn in Mt=arguments[nn])mt[hn]=Mt[hn];return mt}function Vn(mt,Mt){let hn,nn,He,Bn,Xn=0;if(mt&&(hn=mt.length))if(Mt==null){for(nn=mt[Xn];Xn<hn&&(nn==null||nn!=nn);nn=mt[++Xn]);for(He=Bn=nn;Xn<hn;++Xn)(nn=mt[Xn])!=null&&(nn<He&&(He=nn),nn>Bn&&(Bn=nn))}else{for(nn=Mt(mt[Xn]);Xn<hn&&(nn==null||nn!=nn);nn=Mt(mt[++Xn]));for(He=Bn=nn;Xn<hn;++Xn)(nn=Mt(mt[Xn]))!=null&&(nn<He&&(He=nn),nn>Bn&&(Bn=nn))}return[He,Bn]}function Dt(mt,Mt){const hn=mt.length;let nn,He,Bn,Xn,Zn,lr=-1;if(Mt==null){for(;++lr<hn;)if((He=mt[lr])!=null&&He>=He){nn=Bn=He;break}if(lr===hn)return[-1,-1];for(Xn=Zn=lr;++lr<hn;)(He=mt[lr])!=null&&(nn>He&&(nn=He,Xn=lr),Bn<He&&(Bn=He,Zn=lr))}else{for(;++lr<hn;)if((He=Mt(mt[lr],lr,mt))!=null&&He>=He){nn=Bn=He;break}if(lr===hn)return[-1,-1];for(Xn=Zn=lr;++lr<hn;)(He=Mt(mt[lr],lr,mt))!=null&&(nn>He&&(nn=He,Xn=lr),Bn<He&&(Bn=He,Zn=lr))}return[Xn,Zn]}const On=Object.prototype.hasOwnProperty;function or(mt,Mt){return On.call(mt,Mt)}const ar={};function yr(mt){let Mt,hn={};function nn(Bn){return or(hn,Bn)&&hn[Bn]!==ar}const He={size:0,empty:0,object:hn,has:nn,get:Bn=>nn(Bn)?hn[Bn]:void 0,set(Bn,Xn){return nn(Bn)||(++He.size,hn[Bn]===ar&&--He.empty),hn[Bn]=Xn,this},delete(Bn){return nn(Bn)&&(--He.size,++He.empty,hn[Bn]=ar),this},clear(){He.size=He.empty=0,He.object=hn={}},test(Bn){return arguments.length?(Mt=Bn,He):Mt},clean(){const Bn={};let Xn=0;for(const Zn in hn){const lr=hn[Zn];lr===ar||Mt&&Mt(lr)||(Bn[Zn]=lr,++Xn)}He.size=Xn,He.empty=0,He.object=hn=Bn}};return mt&&Object.keys(mt).forEach(Bn=>{He.set(Bn,mt[Bn])}),He}function kr(mt,Mt,hn,nn,He,Bn){if(!hn&&hn!==0)return Bn;const Xn=+hn;let Zn,lr=mt[0],jr=Ot(mt);jr<lr&&(Zn=lr,lr=jr,jr=Zn),Zn=Math.abs(Mt-lr);const Cr=Math.abs(jr-Mt);return Zn<Cr&&Zn<=Xn?nn:Cr<=Xn?He:Bn}function dr(mt,Mt,hn){const nn=mt.prototype=Object.create(Mt.prototype);return Object.defineProperty(nn,"constructor",{value:mt,writable:!0,enumerable:!0,configurable:!0}),en(nn,hn)}function oi(mt,Mt,hn,nn){let He,Bn=Mt[0],Xn=Mt[Mt.length-1];return Bn>Xn&&(He=Bn,Bn=Xn,Xn=He),hn=hn===void 0||hn,nn=nn===void 0||nn,(hn?Bn<=mt:Bn<mt)&&(nn?mt<=Xn:mt<Xn)}function Ur(mt){return typeof mt=="boolean"}function Xr(mt){return Object.prototype.toString.call(mt)==="[object Date]"}function zn(mt){return mt&&Qn(mt[Symbol.iterator])}function ir(mt){return typeof mt=="number"}function Or(mt){return Object.prototype.toString.call(mt)==="[object RegExp]"}function qr(mt){return typeof mt=="string"}function Kr(mt,Mt,hn){mt&&(mt=Mt?Pn(mt).map(Zn=>Zn.replace(/\\(.)/g,"$1")):Pn(mt));const nn=mt&&mt.length,He=hn&&hn.get||A,Bn=Zn=>He(Mt?[Zn]:R(Zn));let Xn;if(nn)if(nn===1){const Zn=Bn(mt[0]);Xn=function(lr){return""+Zn(lr)}}else{const Zn=mt.map(Bn);Xn=function(lr){let jr=""+Zn[0](lr),Cr=0;for(;++Cr<nn;)jr+="|"+Zn[Cr](lr);return jr}}else Xn=function(){return""};return c(Xn,mt,"key")}function Tt(mt,Mt){const hn=mt[0],nn=Ot(mt),He=+Mt;return He?He===1?nn:hn+He*(nn-hn):hn}const Rr=1e4;function Qt(mt){let Mt,hn,nn;mt=+mt||Rr;const He=()=>{Mt={},hn={},nn=0},Bn=(Xn,Zn)=>(++nn>mt&&(hn=Mt,Mt={},nn=1),Mt[Xn]=Zn);return He(),{clear:He,has:Xn=>or(Mt,Xn)||or(hn,Xn),get:Xn=>or(Mt,Xn)?Mt[Xn]:or(hn,Xn)?Bn(Xn,hn[Xn]):void 0,set:(Xn,Zn)=>or(Mt,Xn)?Mt[Xn]=Zn:Bn(Xn,Zn)}}function Se(mt,Mt,hn,nn){const He=Mt.length,Bn=hn.length;if(!Bn)return Mt;if(!He)return hn;const Xn=nn||new Mt.constructor(He+Bn);let Zn=0,lr=0,jr=0;for(;Zn<He&&lr<Bn;++jr)Xn[jr]=mt(Mt[Zn],hn[lr])>0?hn[lr++]:Mt[Zn++];for(;Zn<He;++Zn,++jr)Xn[jr]=Mt[Zn];for(;lr<Bn;++lr,++jr)Xn[jr]=hn[lr];return Xn}function ve(mt,Mt){let hn="";for(;--Mt>=0;)hn+=mt;return hn}function ke(mt,Mt,hn,nn){const He=hn||" ",Bn=mt+"",Xn=Mt-Bn.length;return Xn<=0?Bn:nn==="left"?ve(He,Xn)+Bn:nn==="center"?ve(He,~~(Xn/2))+Bn+ve(He,Math.ceil(Xn/2)):Bn+ve(He,Xn)}function Me(mt){return mt&&Ot(mt)-mt[0]||0}function rt(mt){return lt(mt)?"["+mt.map(rt)+"]":It(mt)||qr(mt)?JSON.stringify(mt).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):mt}function Ct(mt){return mt==null||mt===""?null:!(!mt||mt==="false"||mt==="0")&&!!mt}const tn=mt=>ir(mt)||Xr(mt)?mt:Date.parse(mt);function Sn(mt,Mt){return Mt=Mt||tn,mt==null||mt===""?null:Mt(mt)}function Rt(mt){return mt==null||mt===""?null:mt+""}function Zt(mt){const Mt={},hn=mt.length;for(let nn=0;nn<hn;++nn)Mt[mt[nn]]=!0;return Mt}function mn(mt,Mt,hn,nn){const He=nn??"",Bn=mt+"",Xn=Bn.length,Zn=Math.max(0,Mt-He.length);return Xn<=Mt?Bn:hn==="left"?He+Bn.slice(Xn-Zn):hn==="center"?Bn.slice(0,Math.ceil(Zn/2))+He+Bn.slice(Xn-~~(Zn/2)):Bn.slice(0,Zn)+He}function fn(mt,Mt,hn){if(mt)if(Mt){const nn=mt.length;for(let He=0;He<nn;++He){const Bn=Mt(mt[He]);Bn&&hn(Bn,He,mt)}}else mt.forEach(hn)}},function(s,a,r){r.r(a);var c=r(0),S=function(se,ne){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,G){N.__proto__=G}||function(N,G){for(var ce in G)G.hasOwnProperty(ce)&&(N[ce]=G[ce])})(se,ne)};function E(se,ne){function N(){this.constructor=se}S(se,ne),se.prototype=ne===null?Object.create(ne):(N.prototype=ne.prototype,new N)}var A,U=function(){return(U=Object.assign||function(se){for(var ne,N=1,G=arguments.length;N<G;N++)for(var ce in ne=arguments[N])Object.prototype.hasOwnProperty.call(ne,ce)&&(se[ce]=ne[ce]);return se}).apply(this,arguments)};function B(se,ne,N,G){return new(N||(N=Promise))(function(ce,je){function Qe(un){try{qt(G.next(un))}catch(ht){je(ht)}}function bt(un){try{qt(G.throw(un))}catch(ht){je(ht)}}function qt(un){un.done?ce(un.value):new N(function(ht){ht(un.value)}).then(Qe,bt)}qt((G=G.apply(se,ne||[])).next())})}function D(se,ne){var N,G,ce,je,Qe={label:0,sent:function(){if(1&ce[0])throw ce[1];return ce[1]},trys:[],ops:[]};return je={next:bt(0),throw:bt(1),return:bt(2)},typeof Symbol=="function"&&(je[Symbol.iterator]=function(){return this}),je;function bt(qt){return function(un){return function(ht){if(N)throw new TypeError("Generator is already executing.");for(;Qe;)try{if(N=1,G&&(ce=2&ht[0]?G.return:ht[0]?G.throw||((ce=G.return)&&ce.call(G),0):G.next)&&!(ce=ce.call(G,ht[1])).done)return ce;switch(G=0,ce&&(ht=[2&ht[0],ce.value]),ht[0]){case 0:case 1:ce=ht;break;case 4:return Qe.label++,{value:ht[1],done:!1};case 5:Qe.label++,G=ht[1],ht=[0];continue;case 7:ht=Qe.ops.pop(),Qe.trys.pop();continue;default:if(!(ce=(ce=Qe.trys).length>0&&ce[ce.length-1])&&(ht[0]===6||ht[0]===2)){Qe=0;continue}if(ht[0]===3&&(!ce||ht[1]>ce[0]&&ht[1]<ce[3])){Qe.label=ht[1];break}if(ht[0]===6&&Qe.label<ce[1]){Qe.label=ce[1],ce=ht;break}if(ce&&Qe.label<ce[2]){Qe.label=ce[2],Qe.ops.push(ht);break}ce[2]&&Qe.ops.pop(),Qe.trys.pop();continue}ht=ne.call(se,Qe)}catch(In){ht=[6,In],G=0}finally{N=ce=0}if(5&ht[0])throw ht[1];return{value:ht[0]?ht[1]:void 0,done:!0}}([qt,un])}}}function R(){return A==null&&(A=Object(c.backend)().epsilon()),A}var W=function(se){function ne(N){var G=se.call(this,N)||this;return Object.setPrototypeOf(G,ne.prototype),G}return E(ne,se),ne}(Error),j=function(se){function ne(N){var G=se.call(this,N)||this;return Object.setPrototypeOf(G,ne.prototype),G}return E(ne,se),ne}(Error),H=function(se){function ne(N){var G=se.call(this,N)||this;return Object.setPrototypeOf(G,ne.prototype),G}return E(ne,se),ne}(Error),I=function(se){function ne(N){var G=se.call(this,N)||this;return Object.setPrototypeOf(G,ne.prototype),G}return E(ne,se),ne}(Error),Q=function(se){function ne(N){var G=se.call(this,N)||this;return Object.setPrototypeOf(G,ne.prototype),G}return E(ne,se),ne}(Error);(function(se){function ne(N){var G=se.call(this,N)||this;return Object.setPrototypeOf(G,ne.prototype),G}E(ne,se)})(Error);function Y(se,ne){if(Array.isArray(se)){for(var N=[],G=0;G<ne;G++)N=N.concat(se);return N}return(N=new Array(ne)).fill(se),N}function q(se,ne){if(!se)throw new Q(ne)}function ae(se,ne){for(var N=0,G=0,ce=se;G<ce.length;G++)ce[G]===ne&&N++;return N}function oe(se){return se.length===1?se[0]:se}function ye(se){return Array.isArray(se)?se:[se]}function _e(se){var ne=se.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return ne[0]!=="_"?ne:"private"+ne}function pe(se){return se.length<=1||se.indexOf("_")===-1?se:se.replace(/[_]+(\w|$)/g,function(ne,N){return N.toUpperCase()})}var me={};function Ge(se){if(se==null)return null;var ne={};return ne.className=se.getClassName(),ne.config=se.getConfig(),ne}function lt(se,ne,N,G,ce){var je,Qe,bt;if(ne===void 0&&(ne={}),N===void 0&&(N={}),G===void 0&&(G="object"),ce===void 0&&(ce=!1),typeof se=="string"){var qt=se,un=void 0;if(qt in N)un=N[qt];else if(qt in me)un=me[qt];else if((un=ne[qt])==null)throw new H("Unknown "+G+": "+se+`. This may be due to one of the following reasons:
1. The `+G+` is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom `+G+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");return un}var ht=se;if(ht.className==null||ht.config==null)throw new H(G+": Improper config format: "+JSON.stringify(ht)+`.
'className' and 'config' must set.`);var In=ht.className,Un=void 0,Gn=void 0;if(In in N?(Un=(je=N[In])[0],Gn=je[1]):In in me?(Un=(Qe=me.className)[0],Gn=Qe[1]):In in ne&&(Un=(bt=ne[In])[0],Gn=bt[1]),Un==null)throw new H("Unknown "+G+": "+In+`. This may be due to one of the following reasons:
1. The `+G+` is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom `+G+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");if(Gn!=null){for(var nr={},Yn=0,pr=Object.keys(me);Yn<pr.length;Yn++)nr[ui=pr[Yn]]=me[ui];for(var gr=0,Tr=Object.keys(N);gr<Tr.length;gr++)nr[ui=Tr[gr]]=N[ui];ht.config.customObjects=nr;for(var $r=U({},me),ai=0,Fr=Object.keys(N);ai<Fr.length;ai++){var ui=Fr[ai];me[ui]=N[ui]}(function si(gi){if(gi!=null&&typeof gi=="object")if(Array.isArray(gi))gi.forEach(function(mo){return si(mo)});else for(var po=0,ho=Object.keys(gi);po<ho.length;po++){var Ko=ho[po],Ki=gi[Ko];Ki!=null&&typeof Ki=="object"&&(Array.isArray(Ki)||Ki.type!=="ndarray"||typeof Ki.value!="number"?si(Ki):gi[Ko]=Ki.value)}})(ht.config);var ii=Gn(Un,ht.config,N,ce);return me=U({},$r),ii}$r=U({},me);for(var wi=0,Si=Object.keys(N);wi<Si.length;wi++)ui=Si[wi],me[ui]=N[ui];return ii=new Un(ht.config),me=U({},$r),ii}function It(se,ne){return-1*function(N,G){return N<G?-1:N>G?1:0}(se,ne)}function wt(se){if(se==null)return se;for(var ne=[],N=0,G=se;N<G.length;N++){var ce=G[N];ne.indexOf(ce)===-1&&ne.push(ce)}return ne}function we(se){if(se==null)throw new H("Invalid value in obj: "+JSON.stringify(se));for(var ne in se)if(se.hasOwnProperty(ne))return!1;return!0}function yt(se,ne,N){if(N!=null&&se.indexOf(N)<0)throw new H(N+" is not a valid "+ne+".  Valid values are "+se+" or null/undefined.")}function Bt(se,ne,N,G){return N===void 0&&(N=0),G===void 0&&(G=1/0),q(N>=0),q(G>=N),Array.isArray(se)&&se.length>=N&&se.length<=G&&se.every(function(ce){return typeof ce===ne})}function Ot(se,ne){Array.isArray(se)?(c.util.assert(se.length>0,function(){return ne+" is unexpectedly an empty array."}),se.forEach(function(N,G){return Ot(N,"element "+(G+1)+" of "+ne)})):c.util.assert(Number.isInteger(se)&&se>0,function(){return"Expected "+ne+" to be a positive integer, but got "+function N(G){return G===null?"null":Array.isArray(G)?"["+G.map(function(ce){return N(ce)}).join(",")+"]":typeof G=="string"?'"'+G+'"':""+G}(se)+"."})}function ze(se){return se==="relu"?"relu":se==="linear"?"linear":se==="elu"?"elu":null}function Ut(se,ne){return Object(c.tidy)(function(){return Object(c.sqrt)(Object(c.sum)(Object(c.mulStrict)(se,se),ne,!0))})}var Ft=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne.prototype.getConfig=function(){return{}},ne}(c.serialization.Serializable),pt=function(se){function ne(N){var G=se.call(this)||this;return G.defaultMaxValue=2,G.defaultAxis=0,G.maxValue=N.maxValue!=null?N.maxValue:G.defaultMaxValue,G.axis=N.axis!=null?N.axis:G.defaultAxis,G}return E(ne,se),ne.prototype.apply=function(N){var G=this;return Object(c.tidy)(function(){var ce=Ut(N,G.axis),je=Object(c.clipByValue)(ce,0,G.maxValue);return Object(c.mul)(N,Object(c.div)(je,Object(c.add)(R(),ce)))})},ne.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},ne.className="MaxNorm",ne}(Ft);c.serialization.registerClass(pt);var vt=function(se){function ne(N){var G=se.call(this)||this;return G.defaultAxis=0,G.axis=N.axis!=null?N.axis:G.defaultAxis,G}return E(ne,se),ne.prototype.apply=function(N){var G=this;return Object(c.tidy)(function(){return Object(c.div)(N,Object(c.add)(R(),Ut(N,G.axis)))})},ne.prototype.getConfig=function(){return{axis:this.axis}},ne.className="UnitNorm",ne}(Ft);c.serialization.registerClass(vt);var rn=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne.prototype.apply=function(N){return Object(c.relu)(N)},ne.className="NonNeg",ne}(Ft);c.serialization.registerClass(rn);var xt=function(se){function ne(N){var G=se.call(this)||this;return G.defaultMinValue=0,G.defaultMaxValue=1,G.defaultRate=1,G.defaultAxis=0,G.minValue=N.minValue!=null?N.minValue:G.defaultMinValue,G.maxValue=N.maxValue!=null?N.maxValue:G.defaultMaxValue,G.rate=N.rate!=null?N.rate:G.defaultRate,G.axis=N.axis!=null?N.axis:G.defaultAxis,G}return E(ne,se),ne.prototype.apply=function(N){var G=this;return Object(c.tidy)(function(){var ce=Ut(N,G.axis),je=Object(c.add)(Object(c.mul)(G.rate,Object(c.clipByValue)(ce,G.minValue,G.maxValue)),Object(c.mul)(1-G.rate,ce));return Object(c.mul)(N,Object(c.div)(je,Object(c.add)(R(),ce)))})},ne.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},ne.className="MinMaxNorm",ne}(Ft);c.serialization.registerClass(xt);var _t={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Xt(se){return Ge(se)}function sn(se,ne){return ne===void 0&&(ne={}),lt(se,c.serialization.SerializationMap.getMap().classNameMap,ne,"constraint")}function kn(se){return se==null?null:typeof se=="string"?sn({className:se in _t?_t[se]:se,config:{}}):se instanceof Ft?se:sn(se)}var an=Object.freeze({maxNorm:function(se){return new pt(se)},unitNorm:function(se){return new vt(se)},nonNeg:function(){return new rn},minMaxNorm:function(se){return new xt(se)}}),Ve=["channelsFirst","channelsLast"],Ye=["valid","same","causal"],$e=["max","avg"],ft=["sum","mul","concat","ave"],$t=new Map;function Jt(se){yt(Ve,"DataFormat",se)}function Pn(se){yt(Ye,"PaddingMode",se)}function An(se){yt($e,"PoolMode",se)}var Qn=[],Ce="/";function sr(se,ne){Qn.push(se);try{var N=ne();return Qn.pop(),N}catch(G){throw Qn.pop(),G}}function Mr(se){if(!Hn(se))throw new Error("Not a valid tensor name: '"+se+"'");return(Qn.length===0?"":Qn.join(Ce)+Ce)+se}function on(se){if(!Hn(se))throw new Error("Not a valid tensor name: '"+se+"'");$t.has(se)||$t.set(se,0);var ne=$t.get(se);if($t.set(se,$t.get(se)+1),ne>0){var N=se+"_"+ne;return $t.set(N,1),N}return se}var Gt=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function Hn(se){return!!se.match(Gt)}function Kt(se){return se===parseInt(se.toString(),10)}function Vt(se,ne,N){ne==null&&(ne=0),N==null&&(N=se.length);for(var G=1,ce=ne;ce<N;++ce)G*=se[ce];return G}function en(se){return se=Array.isArray(se)?new Float32Array(se):se,Object(c.tensor1d)(se)}function Vn(se){return Object(c.min)(en(se)).dataSync()[0]}function Dt(se){return Object(c.max)(en(se)).dataSync()[0]}function On(se,ne){if(ne<se)throw new H("end ("+ne+") < begin ("+se+") is forbidden.");for(var N=[],G=se;G<ne;++G)N.push(G);return N}function or(se,ne){return se.asType(ne)}function ar(se,ne){ne===void 0&&(ne=-1);var N=se.shape.slice();return ne<0&&(ne=N.length+ne+1),N.splice(ne,0,1),se.reshape(N)}function yr(se,ne,N){return Object(c.tidy)(function(){switch(se.rank){case 1:return Object(c.slice1d)(se,ne,N);case 2:return Object(c.slice2d)(se,[ne,0],[N,se.shape[1]]);case 3:return Object(c.slice3d)(se,[ne,0,0],[N,se.shape[1],se.shape[2]]);case 4:return Object(c.slice4d)(se,[ne,0,0,0],[N,se.shape[1],se.shape[2],se.shape[3]]);case 5:return Object(c.slice)(se,[ne,0,0,0,0],[N,se.shape[1],se.shape[2],se.shape[3],se.shape[4]]);case 6:return Object(c.slice)(se,[ne,0,0,0,0,0],[N,se.shape[1],se.shape[2],se.shape[3],se.shape[4],se.shape[5]]);default:throw new H("sliceAlongFirstAxis() received an unsupported tensor rank: "+se.rank)}})}function kr(se,ne,N){return Object(c.tidy)(function(){switch(se.rank){case 1:return Object(c.slice1d)(se,ne,N);case 2:return Object(c.slice2d)(se,[0,ne],[se.shape[0],N]);case 3:return Object(c.slice3d)(se,[0,0,ne],[se.shape[0],se.shape[1],N]);case 4:return Object(c.slice4d)(se,[0,0,0,ne],[se.shape[0],se.shape[1],se.shape[2],N]);default:throw new H("sliceAlongLastAxis() received an unsupported tensor rank: "+se.rank)}})}function dr(se,ne,N,G){return Object(c.tidy)(function(){switch(se.rank){case 1:return Object(c.slice1d)(se,ne,N);case 2:switch(G){case 1:return yr(se,ne,N);case 2:return kr(se,ne,N);default:throw new H("The axis is not within the rank of the tensor "+G)}case 3:switch(G){case 1:return yr(se,ne,N);case 2:return Object(c.slice3d)(se,[0,ne,0],[se.shape[0],N,se.shape[2]]);case 3:return kr(se,ne,N);default:throw new H("The axis is not within the rank of the tensor "+G)}case 4:switch(G){case 1:return yr(se,ne,N);case 2:return Object(c.slice4d)(se,[0,ne,0,0],[se.shape[0],N,se.shape[2],se.shape[3]]);case 3:return Object(c.slice4d)(se,[0,0,ne,0],[se.shape[0],se.shape[1],N,se.shape[3]]);case 4:return kr(se,ne,N);default:throw new H("The axis is not within the rank of the tensor "+G)}default:throw new H("sliceAlongLastAxis() received an unsupported tensor rank: "+se.rank)}})}function oi(se,ne){var N;return ne===void 0&&(ne=-1),ne<0&&(ne=(N=se[0].rank)!==0?N:0),ne===se[0].rank&&(ne=-1),Object(c.concat)(se,ne)}function Ur(se,ne){switch(se.rank){case 1:return Object(c.concat1d)([se,ne]);case 2:return Object(c.concat2d)([se,ne],0);case 3:return Object(c.concat3d)([se,ne],0);case 4:return Object(c.concat4d)([se,ne],0);default:throw new H("concatAlongFirstAxis() received an unsupported tensor rank: "+se.rank)}}function Xr(se,ne){if(Array.isArray(ne)||(ne=[ne]),se.rank!==ne.length)throw new H("The length of input n ("+ne.length+") does not match the number of dimensions in input x ("+se.rank+")");return Object(c.tile)(se,ne)}function zn(se,ne,N,G,ce){return ne===void 0&&(ne=0),N===void 0&&(N=1),Object(c.randomNormal)(se,ne,N,G,ce)}function ir(se,ne,N,G){if(se.rank<2||ne.rank<2)throw new I("dot requires both inputs to be rank >= 2 but got x shape = "+se.shape+" and y shape = "+ne.shape);if(ne.rank>=3&&se.shape.slice(-1)[0]!==(ht=ne.shape.slice(-2)[0]))throw new I("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = "+se.shape+" and  y shape = "+ne.shape);if(se.rank===2&&ne.rank===2){var ce=!1,je=!1;return c.fused.matMul({a:se,b:ne,transposeA:ce,transposeB:je,bias:G?Kr(se.rank,G,"channelsLast"):null,activation:N})}var Qe=se.shape.slice(),bt=Qe.pop();se=se.reshape([-1,bt]);var qt=ne.shape.slice(),un=qt.pop(),ht=qt.pop(),In=qt.concat([un]),Un=Array.from({length:ne.rank},function(nr,Yn){return Yn===0?ne.rank-2:Yn<=ne.rank-2?Yn-1:Yn});ne=ne.transpose(Un).reshape([ht,-1]);var Gn=Qe.concat(In);return ce=!1,je=!1,c.fused.matMul({a:se,b:ne,transposeA:ce,transposeB:je,bias:G?Kr(se.rank,G,"channelsLast"):null,activation:N}).reshape(Gn)}function Or(se,ne,N){return Object(c.tidy)(function(){return ne=Array.isArray(ne)?Object(c.tensor1d)(ne,"int32"):ne.toInt(),Object(c.gather)(se,ne,N)})}function qr(se){return Object(c.mulStrict)(se,se)}function Kr(se,ne,N){var G=ne.shape;if(ne.rank!==1&&ne.rank!==se)throw new H("Unexpected bias dimensions: "+ne.rank+"; expected it to be 1 or "+se);if(se===5){if(N==="channelsFirst")return G.length===1?ne.reshape([1,G[0],1,1,1]):ne.reshape([1,G[3],G[0],G[1],G[2]]);if(N==="channelsLast")return G.length===1?ne.reshape([1,1,1,1,G[0]]):ne.reshape([1].concat(G))}else if(se===4){if(N==="channelsFirst")return G.length===1?ne.reshape([1,G[0],1,1]):ne.reshape([1,G[2],G[0],G[1]]);if(N==="channelsLast")return G.length===1?ne.reshape([1,1,1,G[0]]):ne.reshape([1].concat(G))}else if(se===3){if(N==="channelsFirst")return G.length===1?ne.reshape([1,G[0],1]):ne.reshape([1,G[1],G[0]]);if(N==="channelsLast")return G.length===1?ne.reshape([1,1,G[0]]):ne.reshape([1].concat(G))}else if(se<3)return ne;throw new H("Unsupported input rank by biasAdd: "+ne.rank)}function Tt(se,ne,N){return Object(c.tidy)(function(){return N==null&&(N="channelsLast"),Jt(N),se.add(Kr(se.rank,ne,N))})}function Rr(se,ne,N,G){return Object(c.tidy)(function(){return Object(c.dropout)(se,ne,N,G)})}function Qt(se,ne,N){return N===void 0&&(N=!1),N?se():ne()}var Se=["fanIn","fanOut","fanAvg"],ve=["normal","uniform","truncatedNormal"],ke=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne.prototype.fromConfigUsesCustomObjects=function(){return!1},ne.prototype.getConfig=function(){return{}},ne}(c.serialization.Serializable),Me=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne.prototype.apply=function(N,G){return Object(c.zeros)(N,G)},ne.className="Zeros",ne}(ke);c.serialization.registerClass(Me);var rt=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne.prototype.apply=function(N,G){return Object(c.ones)(N,G)},ne.className="Ones",ne}(ke);c.serialization.registerClass(rt);var Ct=function(se){function ne(N){var G=se.call(this)||this;if(typeof N!="object")throw new H("Expected argument of type ConstantConfig but got "+N);if(N.value===void 0)throw new H("config must have value set but got "+N);return G.value=N.value,G}return E(ne,se),ne.prototype.apply=function(N,G){var ce=this;return Object(c.tidy)(function(){return Object(c.mul)(Object(c.scalar)(ce.value),Object(c.ones)(N,G))})},ne.prototype.getConfig=function(){return{value:this.value}},ne.className="Constant",ne}(ke);c.serialization.registerClass(Ct);var tn=function(se){function ne(N){var G=se.call(this)||this;return G.DEFAULT_MINVAL=-.05,G.DEFAULT_MAXVAL=.05,G.minval=N.minval||G.DEFAULT_MINVAL,G.maxval=N.maxval||G.DEFAULT_MAXVAL,G.seed=N.seed,G}return E(ne,se),ne.prototype.apply=function(N,G){return Object(c.randomUniform)(N,this.minval,this.maxval,G)},ne.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},ne.className="RandomUniform",ne}(ke);c.serialization.registerClass(tn);var Sn=function(se){function ne(N){var G=se.call(this)||this;return G.DEFAULT_MEAN=0,G.DEFAULT_STDDEV=.05,G.mean=N.mean||G.DEFAULT_MEAN,G.stddev=N.stddev||G.DEFAULT_STDDEV,G.seed=N.seed,G}return E(ne,se),ne.prototype.apply=function(N,G){if((G=G||"float32")!=="float32"&&G!=="int32")throw new I("randomNormal does not support dType "+G+".");return zn(N,this.mean,this.stddev,G,this.seed)},ne.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},ne.className="RandomNormal",ne}(ke);c.serialization.registerClass(Sn);var Rt=function(se){function ne(N){var G=se.call(this)||this;return G.DEFAULT_MEAN=0,G.DEFAULT_STDDEV=.05,G.mean=N.mean||G.DEFAULT_MEAN,G.stddev=N.stddev||G.DEFAULT_STDDEV,G.seed=N.seed,G}return E(ne,se),ne.prototype.apply=function(N,G){if((G=G||"float32")!=="float32"&&G!=="int32")throw new I("truncatedNormal does not support dType "+G+".");return Object(c.truncatedNormal)(N,this.mean,this.stddev,G,this.seed)},ne.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},ne.className="TruncatedNormal",ne}(ke);c.serialization.registerClass(Rt);var Zt=function(se){function ne(N){var G=se.call(this)||this;return G.gain=N.gain!=null?N.gain:1,G}return E(ne,se),ne.prototype.apply=function(N,G){var ce=this;return Object(c.tidy)(function(){if(N.length!==2||N[0]!==N[1])throw new H("Identity matrix initializer can only be used for 2D square matrices.");return Object(c.mul)(ce.gain,Object(c.eye)(N[0]))})},ne.prototype.getConfig=function(){return{gain:this.gain}},ne.className="Identity",ne}(ke);c.serialization.registerClass(Zt);var mn=function(se){function ne(N){var G=se.call(this)||this;if(N.scale<0)throw new H("scale must be a positive float. Got: "+N.scale);return G.scale=N.scale==null?1:N.scale,G.mode=N.mode==null?"fanIn":N.mode,function(ce){yt(Se,"FanMode",ce)}(G.mode),G.distribution=N.distribution==null?"normal":N.distribution,function(ce){yt(ve,"Distribution",ce)}(G.distribution),G.seed=N.seed,G}return E(ne,se),ne.prototype.apply=function(N,G){var ce=function(ht,In){var Un,Gn;if(In===void 0&&(In="channelsLast"),Jt(In),ht.length===2)Un=ht[0],Gn=ht[1];else if([3,4,5].indexOf(ht.length)!==-1)if(In==="channelsFirst"){var nr=Vt(ht,2);Un=ht[1]*nr,Gn=ht[0]*nr}else In==="channelsLast"&&(nr=Vt(ht,0,ht.length-2),Un=ht[ht.length-2]*nr,Gn=ht[ht.length-1]*nr);else{var Yn=Vt(ht);Un=Math.sqrt(Yn),Gn=Math.sqrt(Yn)}return[Un,Gn]}(N),je=ce[0],Qe=ce[1],bt=this.scale;if(this.mode==="fanIn"?bt/=Math.max(1,je):this.mode==="fanOut"?bt/=Math.max(1,Qe):bt/=Math.max(1,(je+Qe)/2),this.distribution==="normal"){var qt=Math.sqrt(bt);if((G=G||"float32")!=="float32"&&G!=="int32")throw new I(this.getClassName()+" does not support dType "+G+".");return Object(c.truncatedNormal)(N,0,qt,G,this.seed)}var un=Math.sqrt(3*bt);return Object(c.randomUniform)(N,-un,un,G)},ne.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},ne.className="VarianceScaling",ne}(ke);c.serialization.registerClass(mn);var fn=function(se){function ne(N){return se.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:N==null?null:N.seed})||this}return E(ne,se),ne.prototype.getClassName=function(){return mn.className},ne.className="GlorotUniform",ne}(mn);c.serialization.registerClass(fn);var mt=function(se){function ne(N){return se.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:N==null?null:N.seed})||this}return E(ne,se),ne.prototype.getClassName=function(){return mn.className},ne.className="GlorotNormal",ne}(mn);c.serialization.registerClass(mt);var Mt=function(se){function ne(N){return se.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:N==null?null:N.seed})||this}return E(ne,se),ne.prototype.getClassName=function(){return mn.className},ne.className="HeNormal",ne}(mn);c.serialization.registerClass(Mt);var hn=function(se){function ne(N){return se.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:N==null?null:N.seed})||this}return E(ne,se),ne.prototype.getClassName=function(){return mn.className},ne.className="HeUniform",ne}(mn);c.serialization.registerClass(hn);var nn=function(se){function ne(N){return se.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:N==null?null:N.seed})||this}return E(ne,se),ne.prototype.getClassName=function(){return mn.className},ne.className="LeCunNormal",ne}(mn);c.serialization.registerClass(nn);var He=function(se){function ne(N){return se.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:N==null?null:N.seed})||this}return E(ne,se),ne.prototype.getClassName=function(){return mn.className},ne.className="LeCunNormal",ne}(mn);c.serialization.registerClass(He);var Bn=function(se){function ne(N){var G=se.call(this)||this;if(G.DEFAULT_GAIN=1,G.gain=N.gain==null?G.DEFAULT_GAIN:N.gain,G.seed=N.seed,G.seed!=null)throw new I("Random seed is not implemented for Orthogonal Initializer yet.");return G}return E(ne,se),ne.prototype.apply=function(N,G){var ce=this;return Object(c.tidy)(function(){if(N.length!==2)throw new I("The Orthogonal Initializer does not support non-2D shapes yet.");N[0]*N[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 ("+N[0]*N[1]+") elements: Slowness may result.");var je=zn(N[0]>N[1]?[N[1],N[0]]:N,0,1,"float32"),Qe=c.linalg.gramSchmidt(je);return N[0]>N[1]&&(Qe=Qe.transpose()),Object(c.mul)(ce.gain,Qe)})},ne.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},ne.className="Orthogonal",ne}(ke);c.serialization.registerClass(Bn);var Xn={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Zn(se,ne){return ne===void 0&&(ne={}),lt(se,c.serialization.SerializationMap.getMap().classNameMap,ne,"initializer")}function lr(se){return Ge(se)}function jr(se){if(typeof se=="string"){var ne=se in Xn?Xn[se]:se;if(ne==="GlorotNormal")return new mt;if(ne==="GlorotUniform")return new fn;if(ne==="HeNormal")return new Mt;if(ne==="HeUniform")return new hn;if(ne==="LeCunNormal")return new nn;if(ne==="LeCunUniform")return new He;var N={};return N.className=ne,N.config={},Zn(N)}return se instanceof ke?se:Zn(se)}var Cr=Object.freeze({zeros:function(){return new Me},ones:function(){return new rt},constant:function(se){return new Ct(se)},randomUniform:function(se){return new tn(se)},randomNormal:function(se){return new Sn(se)},truncatedNormal:function(se){return new Rt(se)},identity:function(se){return new Zt(se)},varianceScaling:function(se){return new mn(se)},glorotUniform:function(se){return new fn(se)},glorotNormal:function(se){return new mt(se)},heNormal:function(se){return new Mt(se)},heUniform:function(se){return new hn(se)},leCunNormal:function(se){return new nn(se)},leCunUniform:function(se){return new He(se)},orthogonal:function(se){return new Bn(se)}}),xi=0;function Ai(){return xi++}var ni={};function to(se){return se===void 0&&(se=""),se in ni||(ni[se]=0),ni[se]+=1,se+ni[se].toString()}function yi(se){return Array.isArray(se)&&Array.isArray(se[0])}function ri(se){return se.length===0?[]:Array.isArray(se[0])?se:[se]}function Jr(se){var ne;if(Array.isArray(se)){if(se.length!==1)throw new H("Expected Tensor length to be 1; got "+se.length);ne=se[0]}else ne=se;return ne}function Kn(se){if(Array.isArray(se)&&Array.isArray(se[0])){if(se.length===1)return(se=se)[0];throw new H("Expected exactly 1 Shape; got "+se.length)}return se}function pi(se){for(var ne=0,N=0,G=se;N<G.length;N++){var ce=G[N];ce.shape.length===0?ne+=1:ne+=ce.shape.reduce(function(je,Qe){return je*Qe})}return ne}var Ci="Variable",Wr=function(){function se(ne,N,G,ce,je){N===void 0&&(N="float32"),G===void 0&&(G=Ci),ce===void 0&&(ce=!0),je===void 0&&(je=null),this.dtype=N??"float32",this.shape=ne.shape,this.id=Ai(),G=G??Ci,this.originalName=Mr(G),this.name=on(this.originalName),this.trainable_=ce,this.constraint=je,this.val=Object(c.variable)(ne,this.trainable_,this.name,this.dtype)}return se.prototype.read=function(){return this.assertNotDisposed(),this.val},se.prototype.write=function(ne){return this.assertNotDisposed(),function(N,G){if(N.shape.toString()!==G.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(N.shape)+" vs. "+JSON.stringify(G.shape))}(this.val,ne),this.val.id!==ne.id&&(this.val.assign(ne),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this},se.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},se.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable "+this.name+" is already disposed.")},Object.defineProperty(se.prototype,"trainable",{get:function(){return this.trainable_},set:function(ne){this.trainable_=ne,this.val.trainable=ne},enumerable:!0,configurable:!0}),se}();function so(se){return se.map(function(ne){return ne.read()})}function Wi(se){se.forEach(function(ne){ne[0].write(ne[1])})}var no=function(se){this.dtype=se.dtype,this.shape=se.shape,se.shape!=null?this.ndim=se.shape.length:this.ndim=se.ndim,this.maxNDim=se.maxNDim,this.minNDim=se.minNDim,this.axes=se.axes||{}},So=function(se,ne,N,G,ce,je,Qe){this.dtype=se,this.shape=ne,this.sourceLayer=N,this.inputs=G,this.callArgs=ce,this.outputTensorIndex=Qe,this.id=Ai(),je!=null&&(this.originalName=Mr(je),this.name=on(this.originalName)),this.rank=ne.length},_a=0,Ds=function(){function se(ne,N){this.callArgs=N,this.id=_a++,this.outboundLayer=ne.outboundLayer,this.inboundLayers=ne.inboundLayers,this.nodeIndices=ne.nodeIndices,this.tensorIndices=ne.tensorIndices,this.inputTensors=ne.inputTensors,this.outputTensors=ne.outputTensors,this.inputMasks=ne.inputMasks,this.outputMasks=ne.outputMasks,this.inputShapes=ne.inputShapes,this.outputShapes=ne.outputShapes;for(var G=0,ce=ne.inboundLayers;G<ce.length;G++){var je=ce[G];je!=null&&je.outboundNodes.push(this)}ne.outboundLayer.inboundNodes.push(this)}return se.prototype.getConfig=function(){for(var ne=[],N=0,G=this.inboundLayers;N<G.length;N++){var ce=G[N];ce!=null?ne.push(ce.name):ne.push(null)}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:ne,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},se}(),Ch=0,ro=function(se){function ne(N){var G=se.call(this)||this;G._callHook=null,G._addedWeightNames=[],G._stateful=!1,G.id=Ch++,G.activityRegularizer=null,G.inputSpec=null,G.supportsMasking=!1,G._trainableWeights=[],G._nonTrainableWeights=[],G._losses=[],G._updates=[],G._built=!1,G.inboundNodes=[],G.outboundNodes=[];var ce=N.name;if(!ce){var je=G.getClassName();ce=_e(je)+"_"+to(je)}if(G.name=ce,G.trainable_=N.trainable==null||N.trainable,N.inputShape!=null||N.batchInputShape!=null){var Qe=void 0;if(N.batchInputShape!=null)Qe=N.batchInputShape;else if(N.inputShape!=null){var bt=null;N.batchSize!=null&&(bt=N.batchSize),Qe=[bt].concat(N.inputShape)}G.batchInputShape=Qe;var qt=N.dtype;qt==null&&(qt=N.inputDType),qt==null&&(qt="float32"),G.dtype=qt}return N.weights!=null?G.initialWeights=N.weights:G.initialWeights=null,G._refCount=null,G.fastWeightInitDuringBuild=!1,G}return E(ne,se),ne.nodeKey=function(N,G){return N.name+"_ib-"+G.toString()},ne.prototype.getNodeAtIndex=function(N,G){if(this.inboundNodes.length===0)throw new j("The layer has never been called and thus has no defined "+G+".");if(this.inboundNodes.length<=N)throw new H("Asked to get "+G+" at node "+N+", but the layer has only "+this.inboundNodes.length+" inbound nodes.");return this.inboundNodes[N]},ne.prototype.getInputAt=function(N){return oe(this.getNodeAtIndex(N,"input").inputTensors)},ne.prototype.getOutputAt=function(N){return oe(this.getNodeAtIndex(N,"output").outputTensors)},Object.defineProperty(ne.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new W("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(this.inboundNodes.length===0)throw new W("Layer "+this.name+" is not connected, no input to return.");return oe(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"output",{get:function(){if(this.inboundNodes.length===0)throw new W("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new W("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return oe(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),ne.prototype.calculateLosses=function(){return this.losses.map(function(N){return N()})},Object.defineProperty(ne.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"built",{get:function(){return this._built},set:function(N){this._built=N},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"trainable",{get:function(){return this.trainable_},set:function(N){this._trainableWeights.forEach(function(G){return G.trainable=N}),this.trainable_=N},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter(function(N){return N.trainable}):[]},set:function(N){this._trainableWeights=N},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter(function(N){return!N.trainable}).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(N){this._nonTrainableWeights=N},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),ne.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},ne.prototype.assertInputCompatibility=function(N){if(N=ye(N),this.inputSpec!=null&&this.inputSpec.length!==0){var G=ye(this.inputSpec);if(N.length!==G.length)throw new H("Layer "+this.name+" expects "+G.length+" inputs, but it received "+N.length+" input tensors. Input received: "+N);for(var ce=0;ce<N.length;ce++){var je=N[ce],Qe=G[ce];if(Qe!=null){var bt=je.rank;if(Qe.ndim!=null&&bt!==Qe.ndim)throw new H("Input "+ce+" is incompatible with layer "+this.name+": expected ndim="+Qe.ndim+", found ndim="+bt);if(Qe.maxNDim!=null&&bt>Qe.maxNDim)throw new H("Input "+ce+" is incompatible with layer "+this.name+": expected max_ndim="+Qe.maxNDim+", found ndim="+bt);if(Qe.minNDim!=null&&bt<Qe.minNDim)throw new H("Input "+ce+" is incompatible with layer "+this.name+": expected min_ndim="+Qe.minNDim+", found ndim="+bt+".");if(Qe.dtype!=null&&je.dtype!==Qe.dtype)throw new H("Input "+ce+" is incompatible with layer "+this.name+" : expected dtype="+Qe.dtype+", found dtype="+je.dtype+".");if(Qe.axes){var qt=je.shape;for(var un in Qe.axes){var ht=Number(un),In=Qe.axes[un],Un=ht>=0?qt[ht]:qt[qt.length+ht];if(In!=null&&[In,null].indexOf(Un)===-1)throw new H("Input "+ce+" is incompatible with layer "+this.name+": expected axis "+ht+" of input shape to have value "+In+" but got shape "+qt+".")}}if(Qe.shape!=null)for(var Gn=0;Gn<Qe.shape.length;++Gn){var nr=Qe.shape[Gn],Yn=je.shape[Gn];if(nr!=null&&Yn!=null&&nr!==Yn)throw new H("Input "+ce+" is incompatible with layer "+this.name+": expected shape="+Qe.shape+", found shape="+je.shape+".")}}}}},ne.prototype.call=function(N,G){return N},ne.prototype.invokeCallHook=function(N,G){this._callHook!=null&&this._callHook(N,G)},ne.prototype.setCallHook=function(N){this._callHook=N},ne.prototype.clearCallHook=function(){this._callHook=null},ne.prototype.apply=function(N,G){var ce=this;G=G||{},this.assertNotDisposed();for(var je=ye(N),Qe=!0,bt=0,qt=je;bt<qt.length;bt++)if(!(qt[bt]instanceof So)){Qe=!1;break}for(var un=!0,ht=0,In=je;ht<In.length;ht++)if(In[ht]instanceof So){un=!1;break}if(Qe===un)throw new H("Arguments to apply() must be all SymbolicTensors or all Tensors");return sr(this.name,function(){if(!ce.built){ce.assertInputCompatibility(N);for(var Un=[],Gn=0,nr=ye(N);Gn<nr.length;Gn++){var Yn=nr[Gn];Un.push(Yn.shape)}ce.build(oe(Un)),ce.built=!0,ce.initialWeights&&ce.setWeights(ce.initialWeights),ce._refCount===null&&un&&(ce._refCount=1)}if(ce.assertInputCompatibility(N),un){for(var pr=[],gr=0,Tr=ye(ui=ce.call(N,G));gr<Tr.length;gr++){var $r=Tr[gr];je.indexOf($r)!==-1&&($r=$r.clone()),pr.push($r)}if(ui=oe(pr),ce.activityRegularizer!=null)throw new I("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return ui}var ai=function(wi){for(var Si=[],si=0,gi=wi=ye(wi);si<gi.length;si++){var po=gi[si];Si.push(po.shape)}return oe(Si)}(N),Fr=ce.computeOutputShape(ai),ui=void 0,ii="float32";if(ce.warnOnIncompatibleInputShape(Array.isArray(N)?ai[0]:ai),ui=Fr!=null&&Fr.length>0&&Array.isArray(Fr[0])?Fr.map(function(wi,Si){return new So(ii,wi,ce,ye(N),G,ce.name,Si)}):new So(ii,Fr,ce,ye(N),G,ce.name),ce.addInboundNode(N,ui,null,null,ai,Fr,G),ce._refCount++,ce.activityRegularizer!=null)throw new I("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return ui})},ne.prototype.warnOnIncompatibleInputShape=function(N){if(this.batchInputShape!=null)if(N.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(N)+") does not match that of the batchInputShape ("+JSON.stringify(this.batchInputShape)+") of the layer "+this.name);else{var G=!1;this.batchInputShape.forEach(function(ce,je){ce!=null&&N[je]!=null&&N[je]!==ce&&(G=!0)}),G&&console.warn("The shape of the input tensor ("+JSON.stringify(N)+") does not match the expectation of layer "+this.name+": "+JSON.stringify(this.batchInputShape))}},Object.defineProperty(ne.prototype,"outputShape",{get:function(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new W("The layer "+this.name+" has never been called and thus has no defined output shape.");for(var N=[],G=0,ce=this.inboundNodes;G<ce.length;G++){var je=ce[G],Qe=JSON.stringify(je.outputShapes);N.indexOf(Qe)===-1&&N.push(Qe)}if(N.length===1){var bt=this.inboundNodes[0].outputShapes;return Array.isArray(bt)&&Array.isArray(bt[0])&&bt.length===1?bt[0]:bt}throw new W("The layer "+this.name+' has multiple inbound nodes with different output shapes. Hence the notion of "outut shape" is ill-defined for the layer.')},enumerable:!0,configurable:!0}),ne.prototype.countParams=function(){if(!this.built)throw new j("You tried to call countParams() on "+this.name+", but the layer is not built yet. Build it first by calling build(batchInputShape).");return pi(this.weights)},ne.prototype.build=function(N){this.built=!0},ne.prototype.getWeights=function(N){return N===void 0&&(N=!1),so(N?this.trainableWeights:this.weights)},ne.prototype.setWeights=function(N){var G=this;Object(c.tidy)(function(){var ce=G.weights;if(ce.length!==N.length)throw new H('You called setWeights(weights) on layer "'+G.name+'" with a weight list of length '+N.length+", but the layer was expecting "+ce.length+" weights. Provided weights: "+N+"...");if(ce.length!==0){for(var je=[],Qe=so(ce),bt=0;bt<Qe.length;++bt){var qt=Qe[bt],un=ce[bt],ht=N[bt];if(!c.util.arraysEqual(qt.shape,ht.shape))throw new H("Layer weight shape "+qt.shape+" not compatible with provided weight shape "+ht.shape);je.push([un,ht])}Wi(je)}})},ne.prototype.addWeight=function(N,G,ce,je,Qe,bt,qt){if(this._addedWeightNames.indexOf(N)!==-1)throw new H("Duplicate weight name "+N+" for layer "+this.name);this._addedWeightNames.push(N),ce==null&&(ce="float32"),this.fastWeightInitDuringBuild&&(je=jr("zeros"));var un=je.apply(G,ce),ht=new Wr(un,ce,N,bt,qt);return un.dispose(),Qe!=null&&this.addLoss(function(){return Qe.apply(ht.read())}),bt==null&&(bt=!0),bt?this._trainableWeights.push(ht):this._nonTrainableWeights.push(ht),ht},ne.prototype.setFastWeightInitDuringBuild=function(N){this.fastWeightInitDuringBuild=N},ne.prototype.addLoss=function(N){var G;N==null||Array.isArray(N)&&N.length===0||(N=ye(N),this._losses!==void 0&&this._losses!==null&&(G=this.losses).push.apply(G,N))},ne.prototype.computeOutputShape=function(N){return N},ne.prototype.computeMask=function(N,G){var ce=this;if(!this.supportsMasking){if(G!=null){if(!Array.isArray(G))throw new TypeError("Layer "+this.name+" does not support masking, but was passed an inputMask.");G.forEach(function(je){if(je!=null)throw new TypeError("Layer "+ce.name+" does not support masking, but was passed an inputMask.")})}return null}return G},ne.prototype.addInboundNode=function(N,G,ce,je,Qe,bt,qt){qt===void 0&&(qt=null);var un=ye(N);G=ye(G),ce=ye(ce),je=ye(je),Qe=ri(Qe),bt=ri(bt);for(var ht=[],In=[],Un=[],Gn=0,nr=un;Gn<nr.length;Gn++){var Yn=nr[Gn];ht.push(Yn.sourceLayer),In.push(Yn.nodeIndex),Un.push(Yn.tensorIndex)}new Ds({outboundLayer:this,inboundLayers:ht,nodeIndices:In,tensorIndices:Un,inputTensors:un,outputTensors:G,inputMasks:ce,outputMasks:je,inputShapes:Qe,outputShapes:bt},qt);for(var pr=0;pr<G.length;pr++)G[pr].sourceLayer=this,G[pr].nodeIndex=this.inboundNodes.length-1,G[pr].tensorIndex=pr},ne.prototype.getConfig=function(){var N={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(N.batchInputShape=this.batchInputShape),this.dtype!=null&&(N.dtype=this.dtype),N},ne.prototype.disposeWeights=function(){return this.weights.forEach(function(N){return N.dispose()}),this.weights.length},ne.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Layer '"+this.name+"' is already disposed.")},ne.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer "+this.name+" because it has not been built yet.");if(this._refCount===null)throw new Error("Cannot dispose Layer "+this.name+" because it has not been used yet.");this.assertNotDisposed();var N=0;return--this._refCount==0&&(N=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:N}},ne}(c.serialization.Serializable),Mc,Gu=function(se){function ne(N){var G=se.call(this,{dtype:N.dtype,name:N.name!=null?N.name:to("input").toString()})||this;if(N.batchSize==null&&(N.batchSize=null),N.sparse==null&&(N.sparse=!1),G.trainable=!1,G.built=!0,G.sparse=N.sparse,N.inputShape!=null&&N.batchInputShape!=null)throw new H("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var ce=N.batchInputShape;if(ce==null){if(N.inputShape==null)throw new H("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");ce=[N.batchSize].concat(N.inputShape)}else if(N.batchSize!=null)throw new H("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var je=N.dtype||"float32";G.batchInputShape=ce,G.dtype=je,G.inputSpec=[{shape:ce}];var Qe=new So(G.dtype,G.batchInputShape,G,[],{},G.name);return Qe.nodeIndex=0,Qe.tensorIndex=0,new Ds({outboundLayer:G,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[Qe],outputTensors:[Qe],inputMasks:[null],outputMasks:[null],inputShapes:[ce],outputShapes:[ce]}),G}return E(ne,se),ne.prototype.apply=function(N,G){throw new H("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)},ne.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},ne.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},ne.className="InputLayer",ne}(ro);function el(se){if(se.batchShape==null&&se.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(se.batchShape!=null&&se.shape!=null)throw new H("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var ne=se.batchShape;se.shape!=null&&ne==null&&(ne=[null].concat(se.shape));var N=se.dtype;return N==null&&(N="float32"),new Gu({batchInputShape:ne,name:se.name,dtype:N,sparse:se.sparse}).inboundNodes[0].outputTensors[0]}function fc(se){return B(this,void 0,void 0,function(){var ne,N,G,ce,je,Qe,bt,qt;return D(this,function(un){switch(un.label){case 0:if(se==null)return[2];for(ce in ne=[],N=[],G=[],se)typeof(je=se[ce])!="number"&&(Qe=je,ne.push(Qe.data()),N.push(ce),G.push(Qe));return ne.length>0?[4,Promise.all(ne)]:[3,2];case 1:for(bt=un.sent(),qt=0;qt<bt.length;++qt)se[N[qt]]=bt[qt][0];Object(c.dispose)(G),un.label=2;case 2:return[2]}})})}function tl(se){if(se!=null)for(var ne in se){var N=se[ne];typeof N!="number"&&N.dispose()}}c.serialization.registerClass(Gu),function(se){se[se.SILENT=0]="SILENT",se[se.VERBOSE=1]="VERBOSE"}(Mc||(Mc={}));var Up=125,xs=function(){function se(){this.validationData=null}return se.prototype.setParams=function(ne){this.params=ne},se.prototype.onEpochBegin=function(ne,N){return B(this,void 0,void 0,function(){return D(this,function(G){return[2]})})},se.prototype.onEpochEnd=function(ne,N){return B(this,void 0,void 0,function(){return D(this,function(G){return[2]})})},se.prototype.onBatchBegin=function(ne,N){return B(this,void 0,void 0,function(){return D(this,function(G){return[2]})})},se.prototype.onBatchEnd=function(ne,N){return B(this,void 0,void 0,function(){return D(this,function(G){return[2]})})},se.prototype.onTrainBegin=function(ne){return B(this,void 0,void 0,function(){return D(this,function(N){return[2]})})},se.prototype.onTrainEnd=function(ne){return B(this,void 0,void 0,function(){return D(this,function(N){return[2]})})},se.prototype.setModel=function(ne){},se}(),dd=function(){function se(ne,N){N===void 0&&(N=10),ne==null&&(ne=[]),this.callbacks=ne,this.queueLength=N}return se.prototype.append=function(ne){this.callbacks.push(ne)},se.prototype.setParams=function(ne){for(var N=0,G=this.callbacks;N<G.length;N++)G[N].setParams(ne)},se.prototype.setModel=function(ne){for(var N=0,G=this.callbacks;N<G.length;N++)G[N].setModel(ne)},se.prototype.onEpochBegin=function(ne,N){return B(this,void 0,void 0,function(){var G,ce;return D(this,function(je){switch(je.label){case 0:N==null&&(N={}),G=0,ce=this.callbacks,je.label=1;case 1:return G<ce.length?[4,ce[G].onEpochBegin(ne,N)]:[3,4];case 2:je.sent(),je.label=3;case 3:return G++,[3,1];case 4:return[2]}})})},se.prototype.onEpochEnd=function(ne,N){return B(this,void 0,void 0,function(){var G,ce;return D(this,function(je){switch(je.label){case 0:N==null&&(N={}),G=0,ce=this.callbacks,je.label=1;case 1:return G<ce.length?[4,ce[G].onEpochEnd(ne,N)]:[3,4];case 2:je.sent(),je.label=3;case 3:return G++,[3,1];case 4:return[2]}})})},se.prototype.onBatchBegin=function(ne,N){return B(this,void 0,void 0,function(){var G,ce;return D(this,function(je){switch(je.label){case 0:N==null&&(N={}),G=0,ce=this.callbacks,je.label=1;case 1:return G<ce.length?[4,ce[G].onBatchBegin(ne,N)]:[3,4];case 2:je.sent(),je.label=3;case 3:return G++,[3,1];case 4:return[2]}})})},se.prototype.onBatchEnd=function(ne,N){return B(this,void 0,void 0,function(){var G,ce;return D(this,function(je){switch(je.label){case 0:N==null&&(N={}),G=0,ce=this.callbacks,je.label=1;case 1:return G<ce.length?[4,ce[G].onBatchEnd(ne,N)]:[3,4];case 2:je.sent(),je.label=3;case 3:return G++,[3,1];case 4:return[2]}})})},se.prototype.onTrainBegin=function(ne){return B(this,void 0,void 0,function(){var N,G;return D(this,function(ce){switch(ce.label){case 0:ne==null&&(ne={}),N=0,G=this.callbacks,ce.label=1;case 1:return N<G.length?[4,G[N].onTrainBegin(ne)]:[3,4];case 2:ce.sent(),ce.label=3;case 3:return N++,[3,1];case 4:return[2]}})})},se.prototype.onTrainEnd=function(ne){return B(this,void 0,void 0,function(){var N,G;return D(this,function(ce){switch(ce.label){case 0:ne==null&&(ne={}),N=0,G=this.callbacks,ce.label=1;case 1:return N<G.length?[4,G[N].onTrainEnd(ne)]:[3,4];case 2:ce.sent(),ce.label=3;case 3:return N++,[3,1];case 4:return[2]}})})},se}(),Wp=function(se){function ne(){return se.call(this)||this}return E(ne,se),ne.prototype.onEpochBegin=function(N){return B(this,void 0,void 0,function(){return D(this,function(G){return this.seen=0,this.totals={},[2]})})},ne.prototype.onBatchEnd=function(N,G){return B(this,void 0,void 0,function(){var ce,je,Qe,bt,qt=this;return D(this,function(un){for(bt in G==null&&(G={}),ce=G.size==null?0:G.size,this.seen+=ce,je=function(ht){var In=G[ht];if(typeof In=="number")Qe.totals.hasOwnProperty(ht)||(Qe.totals[ht]=0),Qe.totals[ht]=Qe.totals[ht]+In*ce;else{var Un=void 0;ht in Qe.totals?Un=Qe.totals[ht]:Qe.totals[ht]=0;var Gn=Object(c.tidy)(function(){return Object(c.add)(qt.totals[ht],Object(c.mul)(In,ce))});Qe.totals[ht]=Gn,Un!=null&&Un.dispose()}},Qe=this,G)je(bt);return[2]})})},ne.prototype.onEpochEnd=function(N,G){return B(this,void 0,void 0,function(){var ce,je,Qe,bt,qt,un=this;return D(this,function(ht){if(G!=null)for(ce=function(In){if(je.totals[In]==null)return"continue";typeof je.totals[In]=="number"?G[In]=je.totals[In]/je.seen:Object(c.tidy)(function(){var Un=Object(c.mul)(Object(c.div)(1,un.seen),un.totals[In]);G[In]=Un,un.totals[In].dispose(),Object(c.keep)(G[In])})},je=this,Qe=0,bt=this.params.metrics;Qe<bt.length;Qe++)qt=bt[Qe],ce(qt);return[2]})})},ne}(xs),dc=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne.prototype.onTrainBegin=function(N){return B(this,void 0,void 0,function(){return D(this,function(G){return this.epoch=[],this.history={},[2]})})},ne.prototype.onEpochEnd=function(N,G){return B(this,void 0,void 0,function(){var ce;return D(this,function(je){for(ce in G==null&&(G={}),this.epoch.push(N),G)this.history[ce]==null&&(this.history[ce]=[]),this.history[ce].push(G[ce]);return[2]})})},ne.prototype.syncData=function(){return B(this,void 0,void 0,function(){var N,G,ce,je,Qe,bt,qt,un,ht;return D(this,function(In){switch(In.label){case 0:for(je in N=[],G=[],ce=[],this.history)for(Qe=this.history[je],bt=0;bt<Qe.length;++bt)typeof Qe[bt]!="number"&&(qt=Qe[bt],N.push(qt.data()),G.push(je),ce.push(bt));return[4,Promise.all(N)];case 1:for(un=In.sent(),ht=0;ht<un.length;++ht)this.history[G[ht]][ce[ht]].dispose(),this.history[G[ht]][ce[ht]]=un[ht][0];return[2]}})})},ne}(xs),hd=function(se){function ne(N,G){var ce=se.call(this)||this;if(ce.currentEpoch=0,ce.yieldEvery=G||"auto",ce.yieldEvery==="auto"&&(ce.yieldEvery=Up),ce.yieldEvery==="never"&&N.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return c.util.isNumber(ce.yieldEvery)&&(ce.maybeWait=function(je,Qe){var bt,qt=c.util.now();return function(){for(var un=[],ht=0;ht<arguments.length;ht++)un[ht]=arguments[ht];var In=c.util.now();return In-qt<Qe?bt:(qt=In,bt=je.apply(void 0,un))}}(ce.maybeWait.bind(ce),ce.yieldEvery)),ce.trainBegin=N.onTrainBegin,ce.trainEnd=N.onTrainEnd,ce.epochBegin=N.onEpochBegin,ce.epochEnd=N.onEpochEnd,ce.batchBegin=N.onBatchBegin,ce.batchEnd=N.onBatchEnd,ce.yield=N.onYield,ce}return E(ne,se),ne.prototype.maybeWait=function(N,G,ce){return B(this,void 0,void 0,function(){var je;return D(this,function(Qe){switch(Qe.label){case 0:return je=[],this.yield==null?[3,2]:[4,fc(ce)];case 1:Qe.sent(),je.push(this.yield(N,G,ce)),Qe.label=2;case 2:return je.push(Object(c.nextFrame)()),[4,Promise.all(je)];case 3:return Qe.sent(),[2]}})})},ne.prototype.onEpochBegin=function(N,G){return B(this,void 0,void 0,function(){return D(this,function(ce){switch(ce.label){case 0:return this.currentEpoch=N,this.epochBegin==null?[3,3]:[4,fc(G)];case 1:return ce.sent(),[4,this.epochBegin(N,G)];case 2:ce.sent(),ce.label=3;case 3:return[2]}})})},ne.prototype.onEpochEnd=function(N,G){return B(this,void 0,void 0,function(){var ce;return D(this,function(je){switch(je.label){case 0:return ce=[],this.epochEnd==null?[3,2]:[4,fc(G)];case 1:je.sent(),ce.push(this.epochEnd(N,G)),je.label=2;case 2:return this.yieldEvery==="epoch"&&ce.push(Object(c.nextFrame)()),[4,Promise.all(ce)];case 3:return je.sent(),[2]}})})},ne.prototype.onBatchBegin=function(N,G){return B(this,void 0,void 0,function(){return D(this,function(ce){switch(ce.label){case 0:return this.batchBegin==null?[3,3]:[4,fc(G)];case 1:return ce.sent(),[4,this.batchBegin(N,G)];case 2:ce.sent(),ce.label=3;case 3:return[2]}})})},ne.prototype.onBatchEnd=function(N,G){return B(this,void 0,void 0,function(){var ce;return D(this,function(je){switch(je.label){case 0:return ce=[],this.batchEnd==null?[3,2]:[4,fc(G)];case 1:je.sent(),ce.push(this.batchEnd(N,G)),je.label=2;case 2:return this.yieldEvery==="batch"?ce.push(Object(c.nextFrame)()):c.util.isNumber(this.yieldEvery)&&ce.push(this.maybeWait(this.currentEpoch,N,G)),[4,Promise.all(ce)];case 3:return je.sent(),[2]}})})},ne.prototype.onTrainBegin=function(N){return B(this,void 0,void 0,function(){return D(this,function(G){switch(G.label){case 0:return this.trainBegin==null?[3,3]:[4,fc(N)];case 1:return G.sent(),[4,this.trainBegin(N)];case 2:G.sent(),G.label=3;case 3:return[2]}})})},ne.prototype.onTrainEnd=function(N){return B(this,void 0,void 0,function(){return D(this,function(G){switch(G.label){case 0:return this.trainEnd==null?[3,3]:[4,fc(N)];case 1:return G.sent(),[4,this.trainEnd(N)];case 2:G.sent(),G.label=3;case 3:return[2]}})})},ne}(xs);function kh(se,ne){return se==null&&(se={}),se instanceof xs?[se]:Array.isArray(se)&&se[0]instanceof xs?se:ye(se).map(function(N){return new hd(N,ne)})}var nl=function(){function se(){}return se.registerCallbackConstructor=function(ne,N){c.util.assert(ne>=0&&Number.isInteger(ne),function(){return"Verbosity level is expected to be an integer >= 0, but got "+ne}),se.checkForDuplicate(N),se.constructors[ne]==null&&(se.constructors[ne]=[]),se.constructors[ne].push(N)},se.checkForDuplicate=function(ne){for(var N in se.constructors)se.constructors[+N].forEach(function(G){if(G===ne)throw new H("Duplicate callback constructor.")})},se.clear=function(){se.constructors={}},se.createCallbacks=function(ne){var N=[];for(var G in se.constructors){var ce=+G;ne>=ce&&N.push.apply(N,se.constructors[ce])}return N.map(function(je){return new je})},se.constructors={},se}();function hf(se,ne,N,G,ce,je,Qe,bt,qt){var un=new dc,ht=[new Wp].concat(nl.createCallbacks(ne));se!=null&&ht.push.apply(ht,se),ht.push(un);var In=new dd(ht);return In.setParams({epochs:N,initialEpoch:G,samples:ce,steps:je,batchSize:Qe,verbose:ne,doValidation:bt,metrics:qt}),{callbackList:In,history:un}}function Ha(se,ne,N){return ne===void 0&&(ne={}),N===void 0&&(N=!1),lt(se,c.serialization.SerializationMap.getMap().classNameMap,ne,"layer",N)}function Tl(se,ne){return Object(c.tidy)(function(){se.dtype!=="float32"&&(se=se.asType("float32"));var N=Object(c.sum)(qr(se),ne,!0),G=Object(c.fill)(N.shape,R()),ce=Object(c.sqrt)(Object(c.maximum)(N,G));return Object(c.div)(se,ce)})}function ba(se,ne){return Object(c.tidy)(function(){return Object(c.mean)(qr(Object(c.sub)(ne,se)),-1)})}function Dc(se,ne){return Object(c.tidy)(function(){return Object(c.mean)(Object(c.abs)(Object(c.sub)(ne,se)),-1)})}function ws(se,ne){return Object(c.tidy)(function(){var N=Object(c.sub)(se,ne),G=Object(c.clipByValue)(Object(c.abs)(se),R(),Number.MAX_VALUE),ce=Object(c.abs)(Object(c.div)(N,G));return Object(c.mul)(100,Object(c.mean)(ce,-1))})}function La(se,ne,N){return N===void 0&&(N=!1),Object(c.tidy)(function(){if(N)ne=Object(c.softmax)(ne);else{var G=Object(c.sum)(ne,ne.shape.length-1,!0);ne=Object(c.div)(ne,G)}return ne=Object(c.clipByValue)(ne,R(),1-R()),Object(c.neg)(Object(c.sum)(Object(c.mul)(se.toFloat(),Object(c.log)(ne)),ne.shape.length-1))})}function Nc(se,ne){return Object(c.tidy)(function(){var N=Object(c.floor)(function(ce){var je=[Vt(ce.shape)];return ce.reshape(je)}(se)).toInt(),G=(ne=Object(c.clipByValue)(ne,R(),1-R())).shape;return La(Object(c.oneHot)(N,G[G.length-1]).reshape(G),ne,!1)})}function pf(se,ne){return Object(c.tidy)(function(){var N;return N=Object(c.clipByValue)(ne,R(),1-R()),N=Object(c.log)(Object(c.div)(N,Object(c.sub)(1,N))),Object(c.mean)(function(G,ce){if(!c.util.arraysEqual(G.shape,ce.shape))throw new H("logits and labels must have the same shape, but got shapes "+JSON.stringify(G.shape)+" and "+JSON.stringify(ce.shape));return Object(c.tidy)(function(){var je=ce.relu(),Qe=ce.abs().neg();return je.sub(ce.mul(G)).add(Qe.exp().log1p())})}(se,N),-1)})}function Ic(se,ne){return Object(c.tidy)(function(){var N=Tl(se,-1),G=Tl(ne,-1),ce=Object(c.mul)(N,G);return Object(c.neg)(Object(c.sum)(ce,-1))})}var Iu={meanSquaredError:ba,meanAbsoluteError:Dc,meanAbsolutePercentageError:ws,meanSquaredLogarithmicError:function(se,ne){return Object(c.tidy)(function(){var N=Object(c.clipByValue)(ne,R(),Number.MAX_VALUE),G=Object(c.log)(Object(c.add)(1,N)),ce=Object(c.clipByValue)(se,R(),Number.MAX_VALUE),je=Object(c.log)(Object(c.add)(1,ce));return Object(c.mean)(qr(Object(c.sub)(G,je)),-1)})},squaredHinge:function(se,ne){return Object(c.tidy)(function(){var N=Object(c.maximum)(0,Object(c.sub)(1,Object(c.mul)(se,ne)));return Object(c.mean)(qr(N),-1)})},hinge:function(se,ne){return Object(c.tidy)(function(){var N=Object(c.maximum)(0,Object(c.sub)(1,Object(c.mul)(se,ne)));return Object(c.mean)(N,-1)})},categoricalHinge:function(se,ne){return Object(c.tidy)(function(){var N=Object(c.sum)(Object(c.mul)(se,ne),-1),G=Object(c.max)(Object(c.mul)(Object(c.sub)(1,se),ne),-1);return Object(c.maximum)(0,Object(c.add)(1,Object(c.sub)(G,N)))})},logcosh:function(se,ne){return Object(c.tidy)(function(){var N=Math.log(2),G=Object(c.sub)(ne,se),ce=Object(c.sub)(Object(c.add)(G,Object(c.softplus)(Object(c.mul)(-2,G))),N);return Object(c.mean)(ce,-1)})},categoricalCrossentropy:La,sparseCategoricalCrossentropy:Nc,binaryCrossentropy:pf,kullbackLeiblerDivergence:function(se,ne){return Object(c.tidy)(function(){var N=Object(c.clipByValue)(se,R(),1),G=Object(c.clipByValue)(ne,R(),1);return Object(c.sum)(Object(c.mul)(se,Object(c.log)(Object(c.div)(N,G))),-1)})},poisson:function(se,ne){return Object(c.tidy)(function(){var N=Object(c.log)(Object(c.add)(R(),ne));return Object(c.mean)(Object(c.sub)(ne,Object(c.mul)(se,N)),-1)})},cosineProximity:Ic};function Ah(se){if(typeof se=="string"){if(se in Iu)return Iu[se];var ne="Unknown loss "+se;throw se.toLowerCase().includes("softmaxcrossentropy")&&(ne="Unknown loss "+se+'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new H(ne)}return se}function pd(se,ne){return Object(c.tidy)(function(){var N=Object(c.mul)(.5,Object(c.onesLike)(ne)),G=or(Object(c.greater)(ne,N),se.dtype);return Object(c.mean)(Object(c.equal)(se,G),-1)})}function md(se,ne){return Object(c.tidy)(function(){return or(Object(c.equal)(Object(c.argMax)(se,-1),Object(c.argMax)(ne,-1)),"float32")})}function Ea(se,ne){return Object(c.tidy)(function(){return Object(c.logicalAnd)(se.equal(1),ne.equal(1)).sum().cast("float32")})}function Oh(se,ne){return Object(c.tidy)(function(){var N=Ea(se,ne),G=function(je,Qe){return Object(c.tidy)(function(){return Object(c.logicalAnd)(je.equal(0),Qe.equal(1)).sum().cast("float32")})}(se,ne),ce=N.add(G);return Object(c.where)(Object(c.greater)(ce,0),N.div(ce),0).cast("float32")})}function Vp(se,ne){return Object(c.tidy)(function(){var N=Ea(se,ne),G=function(je,Qe){return Object(c.tidy)(function(){return Object(c.logicalAnd)(je.equal(1),Qe.equal(0)).sum().cast("float32")})}(se,ne),ce=N.add(G);return Object(c.where)(Object(c.greater)(ce,0),N.div(ce),0).cast("float32")})}function gd(se,ne){return pf(se,ne)}function vd(se,ne){return se.rank===ne.rank&&(se=se.squeeze([se.rank-1])),(ne=ne.argMax(-1)).dtype!==se.dtype&&(ne=ne.asType(se.dtype)),Object(c.equal)(se,ne).asType("float32")}var Ns=La,yd=Nc,br={binaryAccuracy:pd,categoricalAccuracy:md,precision:Oh,categoricalCrossentropy:Ns,sparseCategoricalCrossentropy:yd,mse:ba,MSE:ba,mae:Dc,MAE:Dc,mape:ws,MAPE:ws,cosine:Ic};function qu(se){if(q(se!==null,"Unknown LossOrMetricFn "+se),typeof se=="string")return se;for(var ne=void 0,N=0,G=Object.keys(Iu);N<G.length;N++){var ce=G[N];if(Iu[ce]===se){ne=ce;break}}if(ne!==void 0)return ne;for(var je=0,Qe=Object.keys(br);je<Qe.length;je++)if(ce=Qe[je],br[ce]===se){ne=ce;break}return ne!==void 0?ne:se.name}var Qm=1048576;function Zm(se,ne,N){if(N===void 0&&(N=!1),se==null||typeof se!="object"||Object.getPrototypeOf(se)!==Object.prototype||!function ce(je){if(je===null)return!0;if(typeof je=="object"){if(Object.getPrototypeOf(je)===Object.prototype){for(var Qe=0,bt=Object.keys(je);Qe<bt.length;Qe++){var qt=bt[Qe];if(typeof qt!="string"||!ce(je[qt]))return!1}return!0}if(Array.isArray(je)){for(var un=0,ht=je;un<ht.length;un++)if(!ce(ht[un]))return!1;return!0}return!1}var In=typeof je;return In==="string"||In==="number"||In==="boolean"}(se))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(N){var G=JSON.stringify(se);G.length>Qm&&console.warn('User-defined metadata of model "'+ne+'" is too large in size (length='+G.length+" when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+Qm+".")}}function bd(se,ne,N,G){G===void 0&&(G=console.log);var ce,je=function(Un){var Gn=!0,nr=[],Yn=[];for(var pr in Un.nodesByDepth)nr.push(Un.nodesByDepth[pr]);for(var gr=0,Tr=nr;gr<Tr.length;gr++){var $r=Tr[gr];if($r.length>1||$r.length===1&&$r[0].inboundLayers.length>1){Gn=!1;break}Yn.push.apply(Yn,$r)}if(Gn)for(var ai=0,Fr=Un.layers;ai<Fr.length;ai++){for(var ui=!1,ii=0,wi=Fr[ai].inboundNodes;ii<wi.length;ii++){var Si=wi[ii];if(Yn.indexOf(Si)!==-1){if(ui){Gn=!1;break}ui=!0}}if(!Gn)break}return Gn}(se),Qe=["Layer (type)","Output shape","Param #"];if(je?(ne=ne||65,N=N||[.45,.85,1]):(ne=ne||98,N=N||[.33,.55,.67,1]),N[N.length-1]<=1&&(N=N.map(function(Un){return Math.floor(ne*Un)})),!je)for(var bt in Qe.push("Receives inputs"),ce=[],se.nodesByDepth)ce.push.apply(ce,se.nodesByDepth[bt]);G("_".repeat(ne)),mf(Qe,N,G),G("=".repeat(ne));for(var qt=se.layers,un=0;un<qt.length;++un)je?Hp(qt[un],N,G):Th(qt[un],N,ce,G),G((un===qt.length-1?"=":"_").repeat(ne));se.checkTrainableWeightsConsistency();var ht=function(Un){return Un.collectedTrainableWeights!=null?pi(Un.collectedTrainableWeights):pi(Un.trainableWeights)}(se),In=pi(se.nonTrainableWeights);G("Total params: "+(ht+In)),G("Trainable params: "+ht),G("Non-trainable params: "+In),G("_".repeat(ne))}function mf(se,ne,N){N===void 0&&(N=console.log);for(var G="",ce=0;ce<se.length;++ce)ce>0&&(G=G.slice(0,G.length-1)+" "),G=(G+=se[ce]).slice(0,ne[ce]),G+=" ".repeat(ne[ce]-G.length);N(G)}function Hp(se,ne,N){var G;try{G=JSON.stringify(se.outputShape)}catch{G="multiple"}mf([se.name+" ("+se.getClassName()+")",G,se.countParams().toString()],ne,N)}function Th(se,ne,N,G){var ce;try{ce=JSON.stringify(se.outputShape)}catch{ce="multiple"}for(var je=[],Qe=0,bt=se.inboundNodes;Qe<bt.length;Qe++){var qt=bt[Qe];if(!(N!=null&&N.length>0&&N.indexOf(qt)===-1))for(var un=0;un<qt.inboundLayers.length;++un){var ht=qt.inboundLayers[un].name,In=qt.nodeIndices[un],Un=qt.tensorIndices[un];je.push(ht+"["+In+"]["+Un+"]")}}var Gn=se.name,nr=se.getClassName(),Yn=je.length===0?"":je[0];for(mf([Gn+" ("+nr+")",ce,se.countParams().toString(),Yn],ne,G),un=1;un<je.length;++un)mf(["","","",je[un]],ne,G)}function Mh(se,ne,N){return(se==="inboundNodes"||se==="outputLayers"||se==="inputLayers")&&ne===0&&typeof N=="string"}function qi(se,ne){if(se===null)return null;if(typeof se=="string")return pe(se);if(typeof se=="number"||typeof se=="boolean")return se;if(se instanceof Array){for(var N=[],G=se.length,ce=0;ce<G;++ce){var je=se[ce];Mh(ne,ce,je)?N.push(je):N.push(qi(je,ne))}return N}for(var Qe={},bt=0,qt=Object.keys(se);bt<qt.length;bt++){var un=qt[bt],ht=se[un];if(un==="name"&&typeof ht=="string")Qe[un]=ht;else{var In=pe(un);Qe[In]=qi(ht,In)}}return Qe}var zo=function(){function se(ne){if(this.id2Value={},this.id2Mask={},this.name2Id={},ne instanceof se)for(var N in ne.id2Value)this.id2Value[N]=ne.id2Value[N],N in ne.id2Mask&&(this.id2Mask[N]=ne.id2Mask[N]);else{if(ne==null)return;for(var G=0,ce=ne;G<ce.length;G++){var je=ce[G];this.add(je.key,je.value)}}}return se.prototype.add=function(ne,N,G){if(this.id2Value[ne.id]!=null)throw new H("Duplicate key: name="+ne.name+", id="+ne.id);return this.id2Value[ne.id]=function(ce,je){if(ce.dtype==null||ce.dtype===je.dtype)return je;try{return Object(c.cast)(je,ce.dtype)}catch{throw new H("The dtype of the feed ("+je.dtype+") can not be cast to the dtype of the key '"+ce.name+"' ("+ce.dtype+").")}}(ne,N),this.name2Id[ne.name]=ne.id,G!=null&&(this.id2Mask[ne.id]=G),this},se.prototype.addFeed=function(ne){this.add(ne.key,ne.value)},se.prototype.hasKey=function(ne){return this.id2Value[ne.id]!=null},se.prototype.names=function(){return Object.keys(this.name2Id)},se.prototype.getValue=function(ne){if(ne instanceof So){if(this.id2Value[ne.id]==null)throw new H("Nonexistent key: "+ne.name);return this.id2Value[ne.id]}var N=this.name2Id[ne];if(N==null)throw new H("Feed dict has no SymbolicTensor name: "+ne);return this.id2Value[N]},se.prototype.getMask=function(ne){if(ne instanceof So){if(this.id2Value[ne.id]==null)throw new H("Nonexistent key: "+ne.name);return this.id2Mask[ne.id]}var N=this.name2Id[ne];if(N==null)throw new H("Feed dict has no SymbolicTensor name: "+ne);return this.id2Mask[N]},se.prototype.disposeMasks=function(){this.id2Mask!=null&&Object(c.dispose)(this.id2Mask)},se}(),Dh={},Yg={};function xd(se,ne,N,G){for(var ce=N!=null&&N.training,je=Array.isArray(se),Qe=je?se:[se],bt=Qe.map(function(Vi){return Vi.name}),qt=[],un=ne.names(),ht=0,In=bt;ht<In.length;ht++){var Un=In[ht];un.indexOf(Un)!==-1?qt.push(ne.getValue(Un)):qt.push(null)}G!=null&&(G.maxNumTensors=-1/0,G.minNumTensors=1/0);var Gn,nr,Yn=bt.join(",")+"|"+ne.names().join(",");if(Dh[Yn]==null){var pr=function(Vi,Ao){c.util.assert(Vi!=null&&Vi.length>0,function(){return"Expected at least one fetch, got none"});var wa=[],Sa={};if(Vi.length===1){var ga=Gp(Vi[0],Ao);wa=ga.sorted,Sa=ga.recipientMap}else for(var ua=new Set,ds=0,Ca=Vi;ds<Ca.length;ds++){for(var Oo=Gp(Ca[ds],Ao),Ia=Oo.sorted,Zu=Oo.recipientMap,Cs=0,$a=Ia;Cs<$a.length;Cs++){var Uo=$a[Cs];ua.has(Uo.name)||(wa.push(Uo),ua.add(Uo.name))}var jc=function(Ys){Sa[Ys]==null&&(Sa[Ys]=new Set),Zu[Ys].forEach(function(ca){return Sa[Ys].add(ca)})};for(var hu in Zu)jc(hu)}return{sorted:wa,recipientCounts:function(Ys){var ca={};for(var Js in Ys)ca[Js]=Ys[Js].size;return ca}(Sa)}}(Qe,ne);Gn=pr.sorted,nr=pr.recipientCounts,Dh[Yn]=Gn,Yg[Yn]=nr}Gn=Dh[Yn],nr={},ce||Object.assign(nr,Yg[Yn]);for(var gr=new zo(ne),Tr=0;Tr<Gn.length;++Tr){if(G!=null){var $r=Object(c.memory)().numTensors;$r>G.maxNumTensors&&(G.maxNumTensors=$r),$r<G.minNumTensors&&(G.minNumTensors=$r)}var ai=Gn[Tr],Fr=ai.sourceLayer;if(!(Fr instanceof Gu)){for(var ui=[],ii=[],wi=[],Si=!1,si=0,gi=ai.inputs;si<gi.length;si++){var po=gi[si],ho=gr.getValue(po),Ko=gr.getMask(po);ui.push(ho),ii.push(Ko),Ko!=null&&(Si=!0),ce||(nr[po.name]--,nr[po.name]!==0||ne.hasKey(po)||bt.indexOf(po.name)!==-1||ho.isDisposed||po.sourceLayer.stateful===!0||wi.push(ho))}Si&&((N=N||{}).mask=ii[0]);var Ki=ye(Fr.apply(ui,N)),mo=null;Fr.supportsMasking&&(mo=Fr.computeMask(ui,ii));for(var pa=Is(ai),Go=Array.isArray(pa)?pa:[pa],sa=0;sa<Go.length;++sa){gr.hasKey(Go[sa])||gr.add(Go[sa],Ki[sa],Array.isArray(mo)?mo[0]:mo);var Gi=bt.indexOf(Go[sa].name);Gi!==-1&&(qt[Gi]=Ki[sa])}ce||Object(c.dispose)(wi)}}return gr.disposeMasks(),je?qt:qt[0]}function Gp(se,ne){for(var N=new Set,G=[],ce={},je=0,Qe=ne.names();je<Qe.length;je++){var bt=Qe[je];N.add(bt)}var qt=[],un=[];for(qt.push(se);qt.length>0;){var ht=qt[qt.length-1];if(N.has(ht.name))qt.pop();else{var In=un[un.length-1]===qt.length-1;if(ht.inputs.length===0||In)qt.pop(),G.push(ht),N.add(ht.name),In&&un.pop();else{un.push(qt.length-1);for(var Un=0,Gn=ht.inputs;Un<Gn.length;Un++){var nr=Gn[Un];ce[nr.name]==null&&(ce[nr.name]=new Set),ce[nr.name].add(ht.name),N.has(nr.name)||qt.push(nr)}}}}return{sorted:G,recipientMap:ce}}function Is(se){var ne;if(se.sourceLayer.inboundNodes.length===1)ne=se.sourceLayer.output;else{for(var N=null,G=0;G<se.sourceLayer.inboundNodes.length;++G)for(var ce=0,je=se.sourceLayer.inboundNodes[G].outputTensors;ce<je.length;ce++)if(je[ce].id===se.id){N=G;break}ne=se.sourceLayer.getOutputAt(N)}return ne}function Fc(se,ne){return function(N,G,ce){var je=G.length;if(N==null||Array.isArray(N)&&N.length===0)return G.map(function(bt){return null});if(je===1)return Array.isArray(N)&&N.length===1?N:typeof N=="object"&&G[0]in N?[N[G[0]]]:[N];if(Array.isArray(N)){if(N.length!==je)throw new Error("Provided "+ce+" is an array of "+N.length+" element(s), but the model has "+je+" outputs. Make sure a set of weights is provided for each model output.");return N}if(typeof N=="object"&&Object.keys(N).length>0&&typeof N[Object.keys(N)[0]]=="object"){var Qe=[];return G.forEach(function(bt){bt in N?Qe.push(N[bt]):Qe.push(null)}),Qe}throw new Error("The model has multiple ("+je+") outputs, so "+ce+" must be either an array with "+je+" elements or an object with "+G+" keys. Provided "+ce+" not understood: "+JSON.stringify(N))}(se,ne,"classWeight")}function qp(se,ne,N,G){return B(this,void 0,void 0,function(){var ce,je,Qe,bt,qt;return D(this,function(un){switch(un.label){case 0:if(ne!=null||G!=null)throw new Error("Support sampleWeight is not implemented yet");return N==null?[3,2]:(ce=Object(c.tidy)(function(){if(se.shape.length===1)return se.clone();if(se.shape.length===2){if(se.shape[1]>1)return se.argMax(1);if(se.shape[1]===1)return se.reshape([se.shape[0]]);throw new Error("Encountered unexpected last-dimension size ("+se.shape[1]+") during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor ("+se.rank+") during handling of class weights. The rank is expected to be 1 or 2.")}),bt=(Qe=Array).from,[4,ce.data()]);case 1:return je=bt.apply(Qe,[un.sent()]),Object(c.dispose)(ce),qt=[],je.forEach(function(ht){if(N[ht]==null)throw new Error("classWeight must contain all classes in the training data. The class "+ht+" exists in the data but not in classWeight");qt.push(N[ht])}),[2,Object(c.tensor1d)(qt,"float32")];case 2:return[2,null]}})})}function eg(se,ne){return Object(c.mul)(se,ne)}var tg=32;function Jg(se,ne){var N,G,ce=ne;N=ce.xs,G=ce.ys,c.util.assert(N!=null&&G!=null,function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+ne});var je=Qg("input",se.inputNames,N),Qe=Qg("output",se.outputNames,G),bt=je[0].shape[0];c.util.assert(je.length===se.inputs.length,function(){return"LayersModel has "+se.inputs.length+" inputs, but the dataset provides "+je.length+" inputs.  (Expected input keys: "+JSON.stringify(se.inputNames)+")"}),c.util.assert(Qe.length===se.outputs.length,function(){return"LayersModel has "+se.outputs.length+" outputs, but the dataset provides "+Qe.length+" outputs.  (Expected output keys: "+JSON.stringify(se.outputNames)+")"});for(var qt=function(Un){c.util.assert(je[Un].shape[0]===bt,function(){return"Batch size mismatch: input "+se.inputNames[Un]+" has "+je[Un].shape[0]+"; expected  "+bt+" based on input "+se.inputNames[0]+"."})},un=0;un<je.length;un++)qt(un);for(var ht=function(Un){c.util.assert(Qe[Un].shape[0]===bt,function(){return"Batch size mismatch: output "+se.outputNames[Un]+" has "+Qe[Un].shape[0]+"; expected  "+bt+" based on input "+se.inputNames[0]+"."})},In=0;In<Qe.length;In++)ht(In);return{xs:je,ys:Qe}}function Qg(se,ne,N){if(N instanceof c.Tensor)return[N];if(Array.isArray(N))return c.util.assert(N.length===ne.length,function(){return"Received an array of "+N.length+" Tensors, but expected "+ne.length+" to match the "+se+" keys "+ne+"."}),N;for(var G=[],ce=0,je=ne;ce<je.length;ce++){var Qe=je[ce];if(N[Qe]==null)throw new H("The feature data generated by the dataset lacks the required "+se+" key '"+Qe+"'.");G.push(N[Qe])}return G}function Ml(se,ne,N){return B(this,void 0,void 0,function(){var G,ce,je,Qe,bt,qt,un,ht,In,Un,Gn,nr,Yn,pr,gr,Tr,$r,ai,Fr,ui,ii,wi,Si,si,gi,po,ho,Ko,Ki,mo,pa,Go,sa,Gi;return D(this,function(Vi){switch(Vi.label){case 0:if(G=N.batchesPerEpoch!=null,c.util.assert(se.optimizer!=null,function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."}),c.util.assert(N!=null,function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."}),c.util.assert(N.epochs!=null&&N.epochs>0&&Number.isInteger(N.epochs),function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got "+N.epochs}),c.util.assert(!G||N.batchesPerEpoch>0&&Number.isInteger(N.batchesPerEpoch),function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got "+N.batchesPerEpoch}),c.util.assert(N.validationSplit==null,function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."}),se.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");se.isTraining=!0,Vi.label=1;case 1:return Vi.trys.push([1,,26,27]),ce=N.validationData!=null,je=void 0,Qe=void 0,ce&&(Qa(N.validationData)?c.util.assert(N.validationBatches==null||N.validationBatches>0&&Number.isInteger(N.validationBatches),function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got "+N.validationBatches}):(bt=function(Ao){if(Ao.length===3)throw new I("Validation with sample weights is not implemented yet.");return{xs:Ao[0],ys:Ao[1]}}(N.validationData),je=bt.xs,Qe=bt.ys)),qt=se.makeTrainFunction(),un=se.getDedupedMetricsNames(),ht=void 0,ht=ce?un.slice().concat(un.map(function(Ao){return"val_"+Ao})):un.slice(),In=kh(N.callbacks,N.yieldEvery),Un=N.verbose==null?1:N.verbose,Gn=hf(In,Un,N.epochs,null,null,function(Ao,wa){var Sa=null;return wa.batchesPerEpoch!=null?Sa=wa.batchesPerEpoch:Number.isFinite(Ao.size)&&(Sa=Ao.size),Sa}(ne,N),null,ce,ht),nr=Gn.callbackList,Yn=Gn.history,nr.setModel(se),se.history=Yn,[4,nr.onTrainBegin()];case 2:return Vi.sent(),se.stopTraining_=!1,pr=N.initialEpoch==null?0:N.initialEpoch,[4,ne.iterator()];case 3:gr=Vi.sent(),Vi.label=4;case 4:return pr<N.epochs?(Tr={},[4,nr.onEpochBegin(pr)]):[3,23];case 5:return Vi.sent(),$r=0,ai=0,G?[3,7]:[4,ne.iterator()];case 6:gr=Vi.sent(),Vi.label=7;case 7:return!G||$r<N.batchesPerEpoch?[4,gr.next()]:[3,21];case 8:return Fr=Vi.sent(),G&&Fr.done?(console.warn("You provided `batchesPerEpoch` as "+N.batchesPerEpoch+", but your dataset iterator ran out of data after "+$r+" batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+N.batchesPerEpoch*N.epochs+" batches). You may need to use the repeat() function when building your dataset."),[3,21]):Fr.value==null?[3,15]:(ui=Jg(se,Fr.value),ii=ui.xs,wi=ui.ys,(Si={}).batch=ai,Si.size=ii[0].shape[0],[4,nr.onBatchBegin(ai,Si)]);case 9:if(Vi.sent(),si=[],N.classWeight==null)return[3,13];gi=Fc(N.classWeight,se.outputNames),Gi=0,Vi.label=10;case 10:return Gi<gi.length?(ho=(po=si).push,[4,qp(wi[Gi],null,gi[Gi])]):[3,13];case 11:ho.apply(po,[Vi.sent()]),Vi.label=12;case 12:return++Gi,[3,10];case 13:for(Ko=ii.concat(wi).concat(si),Ki=qt(Ko),Object(c.dispose)(Ko),Gi=0;Gi<un.length;++Gi)mo=un[Gi],pa=Ki[Gi],Si[mo]=pa,Object(c.keep)(pa);return[4,nr.onBatchEnd(ai,Si)];case 14:Vi.sent(),tl(Si),ai++,$r++,Vi.label=15;case 15:return(G?$r>=N.batchesPerEpoch:Fr.done)?ce?(Go=void 0,Qa(N.validationData)?(sa=ye,[4,se.evaluateDataset(N.validationData,{batches:N.validationBatches})]):[3,17]):[3,19]:[3,20];case 16:return Go=sa.apply(void 0,[Vi.sent()]),[3,18];case 17:Go=ye(se.evaluate(je,Qe,{batchSize:N.validationBatchSize==null?tg:N.validationBatchSize,verbose:0})),Vi.label=18;case 18:for(Gi=0;Gi<se.metricsNames.length;++Gi)Tr["val_"+se.metricsNames[Gi]]=Go[Gi];Vi.label=19;case 19:return[3,21];case 20:return se.stopTraining_?[3,21]:[3,7];case 21:return[4,nr.onEpochEnd(pr,Tr)];case 22:return Vi.sent(),pr++,se.stopTraining_?[3,23]:[3,4];case 23:return[4,nr.onTrainEnd()];case 24:return Vi.sent(),[4,se.history.syncData()];case 25:return Vi.sent(),[2,se.history];case 26:return se.isTraining=!1,[7];case 27:return[2]}})})}function Qa(se){return typeof se.iterator=="function"}function Nh(se){c.util.assert(se>0&&Number.isInteger(se),function(){return"batchSize is required to be a positive integer, but got "+se})}function Ze(se,ne,N){return se==null?[null]:Array.isArray(se)?se.map(function(G){return yr(G,ne,N-ne)}):yr(se,ne,N-ne)}function hc(se,ne){return Object(c.tidy)(function(){return se==null?null:Array.isArray(se)?se.map(function(N){return hc(N,ne)}):Or(se,ne.dtype==="int32"?ne:ne.toInt())})}function wd(se,ne){for(var N=[],G=0,ce=null;G<se;)(ce=G+ne)>=se&&(ce=se),N.push([G,ce]),G=ce;return N}function $p(se,ne,N,G){return G===void 0&&(G={}),B(this,void 0,void 0,function(){var ce,je,Qe,bt,qt,un,ht,In,Un,Gn,nr,Yn,pr,gr,Tr,$r,ai,Fr,ui,ii,wi,Si;return D(this,function(si){switch(si.label){case 0:if(se.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");se.isTraining=!0,si.label=1;case 1:return si.trys.push([1,,7,8]),Nh(In=G.batchSize==null?32:G.batchSize),Un=!1,[4,se.standardizeUserData(ne,N,G.sampleWeight,G.classWeight,Un,In)];case 2:if(Gn=si.sent(),ce=Gn[0],je=Gn[1],ht=Gn[2],nr=!1,Yn=void 0,!(G.validationData!=null&&G.validationData.length>0))return[3,4];if(nr=!0,G.validationData.length!==2)throw G.validationData.length===3?new I("validationData including sample weights is not supported yet."):new H("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+G.validationData+" is invalid.");return Qe=G.validationData[0],bt=G.validationData[1],pr=!0,[4,se.standardizeUserData(Qe,bt,null,null,pr,In)];case 3:return gr=si.sent(),qt=gr[0],un=gr[1],Yn=qt.concat(un),[3,5];case 4:G.validationSplit!=null&&G.validationSplit>0&&G.validationSplit<1?(nr=!0,Tr=Math.floor(ce[0].shape[0]*(1-G.validationSplit)),$r=ce[0].shape[0],qt=Ze(ce,Tr,$r),ce=Ze(ce,0,Tr),un=Ze(je,Tr,$r),je=Ze(je,0,Tr),Yn=qt.concat(un)):G.validationSteps!=null&&(nr=!0),si.label=5;case 5:return ai=ce.concat(je).concat(ht),se.checkTrainableWeightsConsistency(),Fr=se.makeTrainFunction(),ui=se.getDedupedMetricsNames(),ii=void 0,wi=void 0,nr?(se.makeTestFunction(),ii=se.testFunction,wi=ui.slice().concat(ui.map(function(gi){return"val_"+gi}))):(ii=null,Yn=[],wi=ui.slice()),Si=kh(G.callbacks,G.yieldEvery),[4,function(gi,po,ho,Ko,Ki,mo,pa,Go,sa,Gi,Vi,Ao,wa,Sa,ga){return B(this,void 0,void 0,function(){var ua,ds,Ca,Oo,Ia,Zu,Cs,$a;return D(this,function(Uo){switch(Uo.label){case 0:if(Ki==null&&(Ki=32),mo==null&&(mo=1),Vi==null&&(Vi=!0),wa==null&&(wa=0),ua=!1,sa!=null&&Gi!=null&&(ua=!0),ga!=null&&(ua=!0,Sa==null))throw new H("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");return(ds=gi.checkNumSamples(ho,Ki,Sa,"steps_per_epoch"))!=null&&(Ca=On(0,ds)),pa==null&&(pa=1),Oo=hf(Go,pa,mo,wa,ds,Sa,Ki,ua,Ao),Ia=Oo.callbackList,Zu=Oo.history,Ia.setModel(gi),gi.history=Zu,[4,Ia.onTrainBegin()];case 1:Uo.sent(),gi.stopTraining_=!1,Cs=function(jc){var hu,Ys,ca,Js,Wo;return D(this,function(zs){switch(zs.label){case 0:return[4,Ia.onEpochBegin(jc)];case 1:if(zs.sent(),hu={},Sa==null)return[3,2];throw new I("stepsPerEpoch mode is not implemented yet.");case 2:if(Vi==="batch")throw new I("batch shuffling is not implemneted yet");Vi&&c.util.shuffle(Ca),Ys=Object(c.tensor1d)(Ca),ca=wd(ds,Ki),Js=function(ks){var yo;return D(this,function(Us){switch(Us.label){case 0:return yo={},[4,Ia.onBatchBegin(ks,yo)];case 1:return Us.sent(),Object(c.tidy)(function(){var os=ca[ks][0],pu=ca[ks][1],ul=yr(Ys,os,pu-os);yo.batch=ks,yo.size=pu-os;for(var Yo=hc(ho,ul),hs=po(Yo),Xa=0;Xa<Ko.length;++Xa){var zc=Ko[Xa],zl=hs[Xa];yo[zc]=zl,Object(c.keep)(zl)}if(ks===ca.length-1&&ua){var Ei=gi.testLoop(sa,Gi,Ki);for(Xa=0;Xa<Ko.length;++Xa)zc=Ko[Xa],zl=Ei[Xa],Object(c.keep)(zl),hu["val_"+zc]=zl}}),[4,Ia.onBatchEnd(ks,yo)];case 2:return Us.sent(),tl(yo),gi.stopTraining_?[2,"break"]:[2]}})},Wo=0,zs.label=3;case 3:return Wo<ca.length?[5,Js(Wo)]:[3,6];case 4:if(zs.sent()==="break")return[3,6];zs.label=5;case 5:return++Wo,[3,3];case 6:Ys.dispose(),zs.label=7;case 7:return[4,Ia.onEpochEnd(jc,hu)];case 8:return zs.sent(),gi.stopTraining_?[2,"break"]:[2]}})},$a=wa,Uo.label=2;case 2:return $a<mo?[5,Cs($a)]:[3,5];case 3:if(Uo.sent()==="break")return[3,5];Uo.label=4;case 4:return++$a,[3,2];case 5:return[4,Ia.onTrainEnd()];case 6:return Uo.sent(),[4,gi.history.syncData()];case 7:return Uo.sent(),[2,gi.history]}})})}(se,Fr,ai,ui,In,G.epochs,G.verbose,Si,ii,Yn,G.shuffle,wi,G.initialEpoch,null,null)];case 6:return[2,si.sent()];case 7:return se.isTraining=!1,Lo(ce,ne),Lo(je,N),Lo(qt,Qe),Lo(un,bt),ht!=null&&Object(c.dispose)(ht),[7];case 8:return[2]}})})}function Po(se){var ne=[];se instanceof c.Tensor&&(se=[se]);for(var N=0;N<se.length;++N){var G=se[N];if(G.rank===1)ne.push(ar(G,1));else{if(G.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");ne.push(G)}}return ne}function Lo(se,ne){if(se!=null){var N=[];if(ne instanceof c.Tensor)N.push(ne.id);else if(Array.isArray(ne))ne.forEach(function(qt){return N.push(qt.id)});else if(ne!=null)for(var G in ne){var ce=ne[G];N.push(ce.id)}var je=[];if(se instanceof c.Tensor)N.indexOf(se.id)===-1&&je.push(se);else if(Array.isArray(se))se.forEach(function(qt){N.indexOf(qt.id)===-1&&je.push(qt)});else if(se!=null)for(var Qe in se){var bt=se[Qe];N.indexOf(bt.id)===-1&&je.push(bt)}je.forEach(function(qt){qt.isDisposed||qt.dispose()})}}function ia(se){return Array.isArray(se)}function Ba(se){return!function(ne){return ne instanceof c.Tensor}(se)&&!ia(se)}function $u(se,ne,N,G,ce){if(G===void 0&&(G=!0),ce===void 0&&(ce=""),ne==null||ne.length===0){if(se!=null){var je=!1;if(ia(se)&&se.length>0)je=!0;else if(Ba(se)){for(var Qe in se)if(se.hasOwnProperty(Qe)){je=!0;break}}else je=!0;if(je)throw new H("Error when checking model "+ce+" expected no data, but got "+se)}return[]}if(se==null)return ne.map(function(pr){return null});var bt;if(Ba(se)){se=se,bt=[];for(var qt=0,un=ne;qt<un.length;qt++){var ht=un[qt];if(se[ht]==null)throw new H('No data provided for "'+ht+'". Need data for each key in: '+ne);bt.push(se[ht])}}else if(ia(se)){if((se=se).length!==ne.length)throw new H("Error when checking model "+ce+": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see "+ne.length+" Tensor(s), but instead got the following list of Tensor(s): "+se);bt=se}else{if(se=se,ne.length>1)throw new H("The model "+ce+" expects "+ne.length+" Tensor(s), but only received one Tensor. Found: Tensor with shape "+se.shape);bt=[se]}if(bt=Po(bt),N!=null){for(var In=0;In<ne.length;++In)if(N[In]!=null){var Un=bt[In];if(Un.shape.length!==N[In].length)throw new H("Error when checking "+ce+": expected "+ne[In]+" to have "+N[In].length+" dimension(s). but got array with shape "+Un.shape);for(var Gn=0;Gn<N[In].length;++Gn)if(Gn!==0||G){var nr=Un.shape[Gn],Yn=N[In][Gn];if(Yn!=null&&Yn>=0&&nr!==Yn)throw new H("Error when checking "+ce+": expected "+ne[In]+" to have shape ["+N[In]+"], but got array with shape ["+Un.shape+"].")}}}return bt}function ja(se,ne,N,G,ce){var je;if(G===void 0&&(G=!0),ce===void 0&&(ce=""),Array.isArray(se)){if(se.length!==ne.length)throw new H("Error when checking model "+ce+": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see "+ne.length+" Tensor(s), but instead got "+se.length+" Tensors(s).");je=se}else{if(ne.length>1)throw new H("The model expects "+ne.length+" "+ce+" Tensors, but only received one Tensor. Found: array with shape "+JSON.stringify(se.shape)+".");je=[se]}if(N!=null){for(var Qe=0;Qe<ne.length;++Qe)if(N[Qe]!=null){var bt=je[Qe];if(bt.shape.length!==N[Qe].length)throw new H("Error when checking "+ce+": expected "+ne[Qe]+" to have "+N[Qe].length+" dimension(s), but got array with shape "+JSON.stringify(bt.shape));for(var qt=0;qt<N[Qe].length;++qt)if(qt!==0||G){var un=bt.shape[qt],ht=N[Qe][qt];if(ht!=null&&ht!==un)throw new H("Error when checking "+ce+": expected "+ne[Qe]+" to have shape "+JSON.stringify(N[Qe])+" but got array with shape "+JSON.stringify(bt.shape)+".")}}}}var rl=function(se){function ne(N){var G=se.call(this,N)||this;return G.isTraining=!1,G}return E(ne,se),ne.prototype.summary=function(N,G,ce){if(ce===void 0&&(ce=console.log),!this.built)throw new H("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");bd(this,N,G,ce)},ne.prototype.compile=function(N){var G=this;if(N.loss==null&&(N.loss=[]),this.loss=N.loss,typeof N.optimizer=="string")this.optimizer_=function(pr){var gr={Adagrad:function(){return c.train.adagrad(.01)},Adadelta:function(){return c.train.adadelta(1,.95,R())},Adam:function(){return c.train.adam(.001,.9,.999,R())},Adamax:function(){return c.train.adamax(.002,.9,.999,R(),0)},RMSProp:function(){return c.train.rmsprop(.001,.9,0,R())},SGD:function(){return c.train.sgd(.01)}};if(gr.adagrad=gr.Adagrad,gr.adadelta=gr.Adadelta,gr.adam=gr.Adam,gr.adamax=gr.Adamax,gr.rmsprop=gr.RMSProp,gr.sgd=gr.SGD,pr in gr)return gr[pr]();throw new H("Unknown Optimizer "+pr)}(N.optimizer),this.isOptimizerOwned=!0;else{if(!(N.optimizer instanceof c.Optimizer))throw new H("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=N.optimizer,this.isOptimizerOwned=!1}var ce=[];if(Array.isArray(N.loss)||typeof N.loss=="string"||typeof N.loss=="function")if(Array.isArray(N.loss)){if(N.loss.length!==this.outputs.length)throw new H("When passing an Array as loss, it should have one entry per model output. The model has "+this.outputs.length+" output(s), but you passed loss="+N.loss+".");var je=N.loss;ce=je.map(function(pr){return Ah(pr)})}else{var Qe=Ah(N.loss);this.outputs.forEach(function(pr){ce.push(Qe)})}else{for(var bt in N.loss=N.loss,N.loss)if(this.outputNames.indexOf(bt)===-1)throw new H('Unknown entry in loss dictionary: "'+bt+'". Only expected the following keys: '+this.outputNames);for(var qt=0,un=this.outputNames;qt<un.length;qt++){var ht=un[qt];N.loss[ht]==null&&console.warn('Output "'+ht+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to '+ht+" during training"),ce.push(Ah(N.loss[ht]))}}this.lossFunctions=ce,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var In=0;In<this.outputs.length;++In){var Un=this.internalOutputShapes[In],Gn=this.outputNames[In];this.feedOutputNames.push(Gn),this.feedOutputShapes.push(Un),this.feedLossFns.push(this.lossFunctions[In])}var nr=[];this.metrics=N.metrics,this.metricsNames=["loss"],this.metricsTensors=[],sr("loss",function(){for(var pr=0;pr<G.outputs.length;++pr)if(nr.indexOf(pr)===-1){var gr=G.lossFunctions[pr];G.outputs.length>1&&(G.metricsTensors.push([gr,pr]),G.metricsNames.push(G.outputNames[pr]+"_loss"))}});var Yn=function(pr,gr){if(pr==null||Array.isArray(pr)&&pr.length===0)return gr.map(function(wi){return[]});var Tr;if(typeof pr=="string"||typeof pr=="function")Tr=[pr];else{if(!Array.isArray(pr)&&typeof pr!="object")throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: "+pr);Tr=pr}if(Array.isArray(Tr))return gr.map(function(wi){return Tr});for(var $r=[],ai=0,Fr=gr;ai<Fr.length;ai++){var ui=Fr[ai],ii=Tr.hasOwnProperty(ui)?Tr[ui]:[];Array.isArray(ii)||(ii=[ii]),$r.push(ii)}return $r}(N.metrics,this.outputNames);sr("metric",function(){for(var pr=function(Tr){if(nr.indexOf(Tr)!==-1)return"continue";(function($r){for(var ai,Fr,ui,ii=function(si){if(typeof si=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(si)!==-1){var gi=G.internalOutputShapes[Tr];gi[gi.length-1]===1||G.lossFunctions[Tr]===pf?["accuracy","acc"].indexOf(si)!==-1?Fr=pd:["crossentropy","ce"].indexOf(si)!==-1&&(Fr=gd):G.lossFunctions[Tr]===Nc?["accuracy","acc"].indexOf(si)!==-1?Fr=vd:["crossentropy","ce"].indexOf(si)!==-1&&(Fr=yd):["accuracy","acc"].indexOf(si)!==-1?Fr=md:["crossentropy","ce"].indexOf(si)!==-1&&(Fr=Ns);var po=void 0;["accuracy","acc"].indexOf(si)!==-1?po="acc":["crossentropy","ce"].indexOf(si)!==-1&&(po="ce"),ui=Fr,ai=""+po}else{var ho=function(Ki){if(typeof Ki=="string"&&Ki in br)return br[Ki];if(typeof Ki!="string"&&Ki!=null)return Ki;throw new H("Unknown metric "+Ki)}(si);ui=ho,ai=""+qu(si)}var Ko;sr(ai,function(){Ko=ui}),function(Ki,mo,pa){G.outputNames.length>1&&(mo=G.outputNames[Ki]+"_"+mo),G.metricsNames.push(mo),G.metricsTensors.push([pa,Ki])}(Tr,ai,Ko)},wi=0,Si=Yn[Tr];wi<Si.length;wi++)ii(Si[wi])})()},gr=0;gr<G.outputs.length;++gr)pr(gr)}),this.collectedTrainableWeights=this.trainableWeights},ne.prototype.checkTrainableWeightsConsistency=function(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},ne.prototype.evaluate=function(N,G,ce){ce===void 0&&(ce={});var je=ce.batchSize==null?32:ce.batchSize;Nh(je);var Qe=this.standardizeUserDataXY(N,G,!0,je);try{var bt=Qe[0].concat(Qe[1]);this.makeTestFunction();var qt=this.testFunction;return oe(this.testLoop(qt,bt,je,ce.verbose,ce.steps))}finally{Lo(Qe[0],N),Lo(Qe[1],G)}},ne.prototype.evaluateDataset=function(N,G){return B(this,void 0,void 0,function(){return D(this,function(ce){return this.makeTestFunction(),[2,function(je,Qe,bt){return B(this,void 0,void 0,function(){var qt,un,ht,In,Un,Gn,nr,Yn,pr,gr;return D(this,function(Tr){switch(Tr.label){case 0:if(qt=(bt=bt||{}).batches!=null,un=je.testFunction,ht=[],bt.verbose>0)throw new I("Verbose mode is not implemented yet.");return c.util.assert(!qt||bt.batches>0&&Number.isInteger(bt.batches),function(){return"Test loop expects `batches` to be a positive integer, but received "+JSON.stringify(bt.batches)}),function($r){return typeof $r.next=="function"}(Qe)?(Un=Qe,[3,3]):[3,1];case 1:return[4,Qe.iterator()];case 2:Un=Tr.sent(),Tr.label=3;case 3:In=Un,Gn=0,nr=0,Yn=function(){var $r;return D(this,function(ai){switch(ai.label){case 0:return[4,In.next()];case 1:return $r=ai.sent(),ht=Object(c.tidy)(function(){if($r.value){var Fr=Jg(je,$r.value),ui=Fr.xs,ii=Fr.ys,wi=ui.concat(ii),Si=Object(c.tidy)(function(){return un(wi)});if(Object(c.dispose)(wi),nr===0)for(var si=0;si<Si.length;++si)ht.push(Object(c.scalar)(0));var gi=wi[0].shape[0],po=function(ho){var Ko=Si[ho],Ki=ht[ho];ht[ho]=Object(c.tidy)(function(){return Object(c.add)(ht[ho],Object(c.mul)(gi,Ko))}),nr>0&&Object(c.dispose)(Ki)};for(si=0;si<Si.length;++si)po(si);Object(c.dispose)(Si),Gn+=gi,++nr}return ht}),$r.done?(qt&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, "+bt.batches+" batches). You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}})},Tr.label=4;case 4:return!qt||nr<bt.batches?[5,Yn()]:[3,6];case 5:return Tr.sent()==="break"?[3,6]:[3,4];case 6:for(pr=0;pr<ht.length;++pr)gr=ht[pr],ht[pr]=Object(c.div)(ht[pr],Gn),Object(c.dispose)(gr);return[2,oe(ht)]}})})}(this,N,G)]})})},ne.prototype.checkNumSamples=function(N,G,ce,je){var Qe;if(je===void 0&&(je="steps"),ce!=null){if(Qe=null,G!=null)throw new H("If "+je+" is set, batchSize must be null or undefined.Got batchSize = "+G)}else{if(N==null)throw new H("Either the input data should have a defined shape, or "+je+" shoud be specified.");Qe=Array.isArray(N)?N[0].shape[0]:N.shape[0]}return Qe},ne.prototype.execute=function(N,G){if(Array.isArray(G)&&G.length===0)throw new H("`outputs` is an empty Array, which is not allowed.");var ce=Array.isArray(G),je=ce?G:[G],Qe=this.retrieveSymbolicTensors(je),bt=new zo;if(N instanceof c.Tensor&&(N=[N]),Array.isArray(N)){if(N.length!==this.inputs.length)throw new H("The number of inputs provided ("+N.length+") does not match the number of inputs of this model ("+this.inputs.length+").");for(var qt=0;qt<this.inputs.length;++qt)bt.add(this.inputs[qt],N[qt])}else for(var un=0,ht=this.inputs;un<ht.length;un++){var In=ht[un],Un=N[In.name];if(Un==null)throw new H("No value is provided for the model's input "+In.name);bt.add(In,Un)}var Gn=xd(Qe,bt);return ce?Gn:Gn[0]},ne.prototype.retrieveSymbolicTensors=function(N){for(var G=Y(null,N.length),ce=N.length,je=0,Qe=this.layers;je<Qe.length;je++){for(var bt=Qe[je],qt=Array.isArray(bt.output)?bt.output:[bt.output],un=qt.map(function(Gn){return Gn.name}),ht=0;ht<N.length;++ht){var In=un.indexOf(N[ht]);if(In!==-1&&(G[ht]=qt[In],ce--),ce===0)break}if(ce===0)break}if(ce>0){var Un=[];throw G.forEach(function(Gn,nr){Gn==null&&Un.push(N[nr])}),new H("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(Un))}return G},ne.prototype.predictLoop=function(N,G,ce){var je=this;return G===void 0&&(G=32),ce===void 0&&(ce=!1),Object(c.tidy)(function(){var Qe=je.checkNumSamples(N);if(ce)throw new I("Verbose predictLoop() is not implemented yet.");for(var bt=wd(Qe,G),qt=je.outputs.map(function(In){return[]}),un=function(In){Object(c.tidy)(function(){var Un=bt[In][0],Gn=bt[In][1],nr=Ze(N,Un,Gn),Yn=[];if(Array.isArray(nr))for(var pr=0;pr<nr.length;++pr)Yn.push({key:je.inputs[pr],value:nr[pr]});else Yn.push({key:je.inputs[0],value:nr});var gr=new zo(Yn);return xd(je.outputs,gr)}).forEach(function(Un,Gn){return qt[Gn].push(Un)})},ht=0;ht<bt.length;++ht)un(ht);return oe(qt.map(function(In){return Object(c.concat)(In,0)}))})},ne.prototype.predict=function(N,G){G===void 0&&(G={});var ce=Po(N);ja(ce,this.inputNames,this.feedInputShapes,!1);try{var je=G.batchSize==null?32:G.batchSize;return Nh(je),this.predictLoop(ce,je)}finally{Lo(ce,N)}},ne.prototype.predictOnBatch=function(N){ja(N,this.inputNames,this.feedInputShapes,!0);var G=(Array.isArray(N)?N[0]:N).shape[0];return this.predictLoop(N,G)},ne.prototype.standardizeUserDataXY=function(N,G,ce,je){if(this.optimizer_==null)throw new j("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var Qe=[],bt=0;bt<this.feedOutputShapes.length;++bt){var qt=this.feedOutputShapes[bt];this.feedLossFns[bt]===Nc?Qe.push(qt.slice(0,qt.length-1).concat([1])):Qe.push(qt)}if(function(un,ht,In){var Un=wt(un.map(function(nr){return nr.shape[0]}));Un.sort();var Gn=wt(ht.map(function(nr){return nr.shape[0]}));if(Gn.sort(),Un.length>1)throw new H("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(un.map(function(nr){return nr.shape})));if(Gn.length>1)throw new H("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(ht.map(function(nr){return nr.shape})));if(Un.length>0&&Gn.length>0&&!c.util.arraysEqual(Un,Gn))throw new H("Input Tensors should have the same number of samples as target Tensors. Found "+Un[0]+" input sample(s) and "+Gn[0]+" target sample(s).")}(N=$u(N,this.feedInputNames,this.feedInputShapes,!1,"input"),G=$u(G,this.feedOutputNames,Qe,!1,"target")),function(un,ht,In){for(var Un=[ba,pf,La],Gn=0;Gn<un.length;++Gn){var nr=un[Gn],Yn=ht[Gn],pr=In[Gn];if(Yn!=null){if(Yn===La&&nr.shape[nr.shape.length-1]===1)throw new H("You are passing a target array of shape "+nr.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(Un.indexOf(Yn)!==-1)for(var gr=nr.shape.slice(1),Tr=pr.slice(1),$r=0;$r<gr.length;++$r){var ai=gr[$r],Fr=Tr[$r];if(Fr!=null&&ai!==Fr)throw new H("A target Tensor with shape "+nr.shape+" was passed for an output of shape "+pr+", while using a loss function that expects targets to have the same shape as the output.")}}}}(G,this.feedLossFns,this.feedOutputShapes),this.stateful&&je!=null&&je>0&&N[0].shape[0]%je!=0)throw new H("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+je+". Found: "+N[0].shape[0]+" sample(s).");return[N,G]},ne.prototype.standardizeUserData=function(N,G,ce,je,Qe,bt){return Qe===void 0&&(Qe=!0),B(this,void 0,void 0,function(){var qt,un,ht,In,Un,Gn,nr,Yn;return D(this,function(pr){switch(pr.label){case 0:if(qt=this.standardizeUserDataXY(N,G,Qe,bt),un=qt[0],ht=qt[1],ce!=null)throw new Error("sample weight is not supported yet.");if(In=null,je==null)return[3,4];Un=Fc(je,this.outputNames),In=[],Gn=0,pr.label=1;case 1:return Gn<Un.length?(Yn=(nr=In).push,[4,qp(ht[Gn],null,Un[Gn])]):[3,4];case 2:Yn.apply(nr,[pr.sent()]),pr.label=3;case 3:return++Gn,[3,1];case 4:return[2,[un,ht,In]]}})})},ne.prototype.testLoop=function(N,G,ce,je,Qe){var bt=this;return je===void 0&&(je=0),Object(c.tidy)(function(){var qt=bt.checkNumSamples(G,ce,Qe,"steps"),un=[];if(je>0)throw new I("Verbose mode is not implemented yet.");if(Qe!=null)throw new I("steps mode in testLoop() is not implemented yet");for(var ht=wd(qt,ce),In=Object(c.tensor1d)(On(0,qt)),Un=0;Un<ht.length;++Un){var Gn=ht[Un][0],nr=ht[Un][1],Yn=yr(In,Gn,nr-Gn),pr=hc(G,Yn),gr=N(pr);if(Un===0)for(var Tr=0;Tr<gr.length;++Tr)un.push(Object(c.scalar)(0));for(Tr=0;Tr<gr.length;++Tr){var $r=gr[Tr];un[Tr]=Object(c.add)(un[Tr],Object(c.mul)(nr-Gn,$r))}}for(Tr=0;Tr<un.length;++Tr)un[Tr]=Object(c.div)(un[Tr],qt);return un})},ne.prototype.getDedupedMetricsNames=function(){for(var N=this.metricsNames,G=[],ce=0;ce<N.length;++ce){var je=N[ce],Qe=je;ae(N,je)>1&&(Qe+="_"+ae(N.slice(0,ce),je)),G.push(Qe)}return G},ne.prototype.makeTrainFunction=function(){var N=this;return function(G){var ce=[],je=G.slice(0,N.inputs.length),Qe=G.slice(N.inputs.length,N.inputs.length+N.outputs.length),bt=G.slice(N.inputs.length+N.outputs.length,N.inputs.length+2*N.outputs.length),qt=[],un=N.collectedTrainableWeights.map(function(ht){return ht.read()});return[N.optimizer_.minimize(function(){for(var ht=[],In=0;In<N.inputs.length;++In)ht.push({key:N.inputs[In],value:je[In]});var Un,Gn=new zo(ht),nr=xd(N.outputs,Gn,{training:!0});for(In=0;In<N.lossFunctions.length;++In){var Yn=(0,N.lossFunctions[In])(Qe[In],nr[In]);bt[In]!=null&&(Yn=eg(Yn,bt[In]));var pr=Object(c.mean)(Yn);ce.push(pr),Un=In===0?Yn:Object(c.add)(Un,Yn)}for(In=0;In<N.metricsTensors.length;++In){var gr=void 0;if(N.outputs.length>1&&In<N.outputs.length)gr=ce[In];else{var Tr=N.metricsTensors[In][0],$r=N.metricsTensors[In][1];gr=Object(c.mean)(Tr(Qe[$r],nr[$r]))}Object(c.keep)(gr),qt.push(gr)}return Un=Object(c.mean)(Un),N.calculateLosses().forEach(function(ai){Un=Object(c.add)(Un,ai)}),Un},!0,un)].concat(qt)}},ne.prototype.makeTestFunction=function(){var N=this;this.testFunction=function(G){return Object(c.tidy)(function(){for(var ce,je=[],Qe=G.slice(0,N.inputs.length),bt=G.slice(N.inputs.length,N.inputs.length+N.outputs.length),qt=[],un=0;un<N.inputs.length;++un)qt.push({key:N.inputs[un],value:Qe[un]});var ht=new zo(qt),In=xd(N.outputs,ht);for(un=0;un<N.lossFunctions.length;++un){var Un=N.lossFunctions[un],Gn=Object(c.mean)(Un(bt[un],In[un]));ce=un===0?Gn:Object(c.add)(ce,Gn),je.push(ce)}for(un=0;un<N.metricsTensors.length;++un){var nr=N.metricsTensors[un][0],Yn=N.metricsTensors[un][1],pr=Object(c.mean)(nr(bt[Yn],In[Yn]));je.push(pr)}return je})}},ne.prototype.fit=function(N,G,ce){return ce===void 0&&(ce={}),B(this,void 0,void 0,function(){return D(this,function(je){return[2,$p(this,N,G,ce)]})})},ne.prototype.fitDataset=function(N,G){return B(this,void 0,void 0,function(){return D(this,function(ce){return[2,Ml(this,N,G)]})})},ne.prototype.trainOnBatch=function(N,G){return B(this,void 0,void 0,function(){var ce,je,Qe,bt,qt,un,ht,In,Un;return D(this,function(Gn){switch(Gn.label){case 0:return[4,this.standardizeUserData(N,G)];case 1:ce=Gn.sent(),je=ce[0],Qe=ce[1],bt=this.makeTrainFunction(),qt=bt(je.concat(Qe)),un=[],ht=0,In=qt,Gn.label=2;case 2:return ht<In.length?[4,In[ht].data()]:[3,5];case 3:Un=Gn.sent(),un.push(Un[0]),Gn.label=4;case 4:return ht++,[3,2];case 5:return Object(c.dispose)(qt),[2,oe(un)]}})})},ne.prototype.getNamedWeights=function(N){for(var G=[],ce=N!=null&&N.trainableOnly,je=ce?this.trainableWeights:this.weights,Qe=this.getWeights(ce),bt=0;bt<je.length;++bt)ce&&!je[bt].trainable||G.push({name:je[bt].originalName,tensor:Qe[bt]});return G},Object.defineProperty(ne.prototype,"stopTraining",{get:function(){return this.stopTraining_},set:function(N){this.stopTraining_=N},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"optimizer",{get:function(){return this.optimizer_},set:function(N){this.optimizer_!==N&&(this.optimizer_=N,this.isOptimizerOwned=!1)},enumerable:!0,configurable:!0}),ne.prototype.dispose=function(){var N=se.prototype.dispose.call(this);if(N.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){var G=Object(c.memory)().numTensors;this.optimizer_.dispose(),N.numDisposedVariables+=G-Object(c.memory)().numTensors}return N},ne.prototype.getLossIdentifiers=function(){var N;if(typeof this.loss=="string")N=_e(this.loss);else if(Array.isArray(this.loss)){for(var G=0,ce=this.loss;G<ce.length;G++)if(typeof ce[G]!="string")throw new Error("Serialization of non-string loss is not supported.");N=this.loss.map(function(ht){return _e(ht)})}else{var je=Object.keys(this.loss);N={};for(var Qe=this.loss,bt=0,qt=je;bt<qt.length;bt++){var un=qt[bt];if(typeof Qe[un]!="string")throw new Error("Serialization of non-string loss is not supported.");N[un]=_e(Qe[un])}}return N},ne.prototype.getMetricIdentifiers=function(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[_e(qu(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(function(ce){return _e(qu(ce))});var N={};for(var G in this.metrics)N[G]=_e(qu(this.metrics[G]));return N},ne.prototype.getTrainingConfig=function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}},ne.prototype.loadTrainingConfig=function(N){if(N.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(N.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(N.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");var G,ce,je=Ha(qi(N.optimizer_config));if(typeof N.loss=="string")G=pe(N.loss);else if(Array.isArray(N.loss))G=N.loss.map(function(bt){return pe(bt)});else if(N.loss!=null)for(var Qe in G={},N.loss)G[Qe]=pe(N.loss[Qe]);if(Array.isArray(N.metrics))ce=N.metrics.map(function(bt){return pe(bt)});else if(N.metrics!=null)for(var Qe in ce={},N.metrics)ce[Qe]=pe(N.metrics[Qe]);this.compile({loss:G,metrics:ce,optimizer:je})},ne.prototype.save=function(N,G){return B(this,void 0,void 0,function(){var ce,je,Qe,bt,qt,un,ht,In,Un,Gn,nr,Yn,pr,gr;return D(this,function(Tr){switch(Tr.label){case 0:if(typeof N=="string"){if((ce=c.io.getSaveHandlers(N)).length===0)throw new H("Cannot find any save handlers for URL '"+N+"'");if(ce.length>1)throw new H("Found more than one ("+ce.length+") save handlers for URL '"+N+"'");N=ce[0]}if(N.save==null)throw new H("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,c.io.encodeWeights(this.getNamedWeights(G))];case 1:return je=Tr.sent(),Qe=!1,bt=null,qt=this.toJSON(bt,Qe),un={modelTopology:qt,format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v1.7.4",convertedBy:null},G!=null&&G.includeOptimizer&&this.optimizer!=null?(un.trainingConfig=this.getTrainingConfig(),ht="optimizer",Yn=(nr=c.io).encodeWeights,[4,this.optimizer.getWeights()]):[3,4];case 2:return[4,Yn.apply(nr,[Tr.sent(),ht])];case 3:In=Tr.sent(),Un=In.data,Gn=In.specs,(gr=je.specs).push.apply(gr,Gn),je.data=c.io.concatenateArrayBuffers([je.data,Un]),Tr.label=4;case 4:return this.userDefinedMetadata!=null&&(pr=!0,Zm(this.userDefinedMetadata,this.name,pr),un.userDefinedMetadata=this.userDefinedMetadata),un.weightData=je.data,un.weightSpecs=je.specs,[2,N.save(un)]}})})},ne.prototype.setUserDefinedMetadata=function(N){Zm(N,this.name),this.userDefinedMetadata=N},ne.prototype.getUserDefinedMetadata=function(){return this.userDefinedMetadata},ne.className="Model",ne}(function(se){function ne(N){var G=se.call(this,{})||this;if(G.containerNodes=new Set,G.name=N.name,G.name==null){var ce=G.getClassName().toLowerCase();G.name=to(ce)}if(G.supportsMasking=!1,G.trainable_=!0,Array.isArray(N.inputs)?G.inputs=N.inputs.slice():G.inputs=[N.inputs],Array.isArray(N.outputs)?G.outputs=N.outputs.slice():G.outputs=[N.outputs],wt(G.inputs).length!==G.inputs.length)throw new H("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+G.inputs.map(function(yo){return yo.name}));wt(G.outputs).length!==G.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+G.outputs.map(function(yo){return yo.name})),G.inputLayers=[],G.inputLayersNodeIndices=[],G.inputLayersTensorIndices=[],G.outputLayers=[],G.outputLayersNodeIndices=[],G.outputLayersTensorIndices=[],G.layers=[],G.internalContainerRefs=[];for(var je=0,Qe=G.outputs;je<Qe.length;je++){var bt=(si=Qe[je]).sourceLayer,qt=si.nodeIndex,un=si.tensorIndex;G.outputLayers.push(bt),G.outputLayersNodeIndices.push(qt),G.outputLayersTensorIndices.push(un)}for(var ht=0,In=G.inputs;ht<In.length;ht++)bt=(si=In[ht]).sourceLayer,qt=si.nodeIndex,un=si.tensorIndex,q(qt===0,"input layer has >1 nodes"),q(un===0,"input layer has >1 tensors"),G.inputLayers.push(bt),G.inputLayersNodeIndices.push(qt),G.inputLayersTensorIndices.push(un);G.inputNames=[],G.outputNames=[],G.feedInputShapes=[],G.feedInputNames=[],G.feedOutputNames=[];for(var Un=0;Un<G.inputLayers.length;Un++){if(!((bt=G.inputLayers[Un])instanceof Gu))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: "+N.inputs+". Input "+Un+" (0-based) originates from layer type "+bt.getClassName()+".");G.inputNames.push(bt.name),G.feedInputShapes.push(bt.batchInputShape),G.feedInputNames.push(bt.name)}for(var Gn=0,nr=G.outputLayers;Gn<nr.length;Gn++)bt=nr[Gn],G.outputNames.push(bt.name);G.internalInputShapes=G.inputs.map(function(yo){return yo.shape}),G.internalOutputShapes=G.outputs.map(function(yo){return yo.shape});for(var Yn={},pr={},gr={},Tr={},$r={},ai=[],Fr=function(yo,Us,os,pu,ul,Yo){pu!=null&&ul!=null&&Yo!=null||(pu=yo.sourceLayer,ul=yo.nodeIndex,Yo=yo.tensorIndex);var hs=pu.inboundNodes[ul];if(os.indexOf(hs)!==-1)throw new j("The tensor "+yo.name+' at layer "'+pu.name+'" is part of a cycle.');if(Us.indexOf(hs)===-1){G.containerNodes.add(ne.nodeKey(pu,ul)),pu.id in $r||($r[pu.id]=Object.keys($r).length),os.indexOf(hs)===-1&&os.push(hs);for(var Xa=hs.inboundLayers.length,zc=0;zc<Xa;zc++){var zl=hs.inputTensors[zc],Ei=hs.inboundLayers[zc],sm=hs.nodeIndices[zc],Ul=hs.tensorIndices[zc];Fr(zl,Us,os,Ei,sm,Ul)}for(Us.push(hs);os.indexOf(hs)>=0;)os.splice(os.indexOf(hs),1);ai.push(hs)}},ui=[],ii=[],wi=0,Si=G.outputs;wi<Si.length;wi++){var si=Si[wi];Fr(si,ui,ii)}for(var gi=0,po=ai.slice().reverse();gi<po.length;gi++){pr[(Uo=po[gi]).id]=Uo,Uo.id in Yn||(Yn[Uo.id]=0);var ho=Yn[Uo.id],Ko=gr[Uo.outboundLayer.id]==null?0:gr[Uo.outboundLayer.id];for(ho=Math.max(ho,Ko),gr[Uo.outboundLayer.id]=ho,Tr[Uo.outboundLayer.id]=Uo.outboundLayer,Yn[Uo.id]=ho,Un=0;Un<Uo.inboundLayers.length;Un++){var Ki=Uo.inboundLayers[Un],mo=(qt=Uo.nodeIndices[Un],Ki.inboundNodes[qt]),pa=Yn[mo.id]==null?0:Yn[mo.id];Yn[mo.id]=Math.max(ho+1,pa),pr[mo.id]=mo}}var Go={};for(var sa in Yn)(ho=Yn[sa])in Go||(Go[ho]=[]),Go[ho].push(pr[sa]);var Gi={};for(var Vi in gr)(ho=gr[Vi])in Gi||(Gi[ho]=[]),Gi[ho].push(Tr[Vi]);var Ao=Object.keys(Gi).map(function(yo){return parseInt(yo,10)}).sort(It);G.layers=[];for(var wa=0,Sa=Ao;wa<Sa.length;wa++){var ga=Gi[ho=Sa[wa]];ga.sort(function(yo,Us){var os=$r[yo.id],pu=$r[Us.id];return os<pu?-1:os>pu?1:0});for(var ua=0,ds=ga;ua<ds.length;ua++)(bt=ds[ua])instanceof ne&&G.internalContainerRefs.push(bt),G.layers.push(bt)}G.layersByDepth=Gi,Ao=Object.keys(Go).map(function(yo){return parseInt(yo,10)}).sort(It);for(var Ca=G.inputs.slice(),Oo=[],Ia=0,Zu=Ao;Ia<Zu.length;Ia++)for(var Cs=0,$a=Go[ho=Zu[Ia]];Cs<$a.length;Cs++){var Uo;if((bt=(Uo=$a[Cs]).outboundLayer)!=null){for(var jc=0,hu=Uo.inputTensors;jc<hu.length;jc++)if(si=hu[jc],Ca.indexOf(si)===-1)throw new j("Graph disconnected: cannot obtain value for tensor "+si+' at layer "'+bt.name+'". The following previous layers were accessed without issue: '+Oo);for(var Ys=0,ca=Uo.outputTensors;Ys<ca.length;Ys++)si=ca[Ys],Ca.push(si);Oo.push(bt.name)}}G.nodesByDepth=Go;for(var Js=G.layers.map(function(yo){return yo.name}),Wo=function(yo){var Us=Js.filter(function(os){return os===yo}).length;if(Us!==1)throw new j('The name "'+yo+'" is used '+Us+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(Js))},zs=0,ks=Js;zs<ks.length;zs++)Wo(ks[zs]);return G.outboundNodes=[],G.inboundNodes=[],new Ds({outboundLayer:G,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:G.inputs,outputTensors:G.outputs,inputMasks:G.inputs.map(function(yo){return null}),outputMasks:G.outputs.map(function(yo){return null}),inputShapes:G.inputs.map(function(yo){return yo.shape}),outputShapes:G.outputs.map(function(yo){return yo.shape})}),G.built=!0,G._refCount=1,G}return E(ne,se),ne.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Container '"+this.name+"' is already disposed.")},ne.prototype.dispose=function(){this.assertNotDisposed();var N={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount==0){for(var G=0,ce=this.layers;G<ce.length;G++){var je=ce[G];N.numDisposedVariables+=je.dispose().numDisposedVariables}for(var Qe=0,bt=this.internalContainerRefs;Qe<bt.length;Qe++){var qt=bt[Qe];N.numDisposedVariables+=qt.dispose().numDisposedVariables}}return N.refCountAfterDispose=this._refCount,N},Object.defineProperty(ne.prototype,"trainable",{get:function(){return this.trainable_},set:function(N){this.layers.forEach(function(G){G._trainableWeights.forEach(function(ce){return ce.trainable=N})}),this.trainable_=N},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"trainableWeights",{get:function(){if(this._trainableWeights.length>0)throw new H("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];for(var N=[],G=0,ce=this.layers;G<ce.length;G++){var je=ce[G];N=N.concat(je.trainableWeights)}return N},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"nonTrainableWeights",{get:function(){for(var N=[],G=0,ce=this.layers;G<ce.length;G++){var je=ce[G];N.push.apply(N,je.nonTrainableWeights)}if(!this.trainable){for(var Qe=[],bt=0,qt=this.layers;bt<qt.length;bt++)je=qt[bt],Qe.push.apply(Qe,je.trainableWeights);return Qe.concat(N)}return N},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),ne.prototype.loadWeights=function(N,G){G===void 0&&(G=!0);for(var ce={},je=0,Qe=0,bt=this.layers;Qe<bt.length;Qe++)for(var qt=0,un=bt[Qe].weights;qt<un.length;qt++){var ht=un[qt];if(ce[ht.originalName]!=null)throw new H("Duplicate weight name: "+ht.originalName);ce[ht.originalName]=ht,je++}var In=[];for(var Un in N){if(ce[Un]!=null)In.push([ce[Un],N[Un]]);else if(G)throw new H("Provided weight data has no target variable: "+Un);delete ce[Un]}if(G){var Gn=[];for(var nr in ce)Gn.push(nr);if(Gn.length>0)throw new H(Gn.length+" of "+je+" weights are not set: "+Gn)}Wi(In)},ne.prototype.updatedConfig=function(){var N=this.getConfig(),G={};return G.className=this.getClassName(),G.config=N,G.kerasVersion="tfjs-layers 1.7.4",G.backend="TensorFlow.js",G},ne.prototype.toJSON=function(N,G){G===void 0&&(G=!0);var ce=function je(Qe,bt){if(Qe==null)return null;if(typeof Qe=="string")return _e(Qe);if(typeof Qe=="number"||typeof Qe=="boolean")return Qe;if(Qe instanceof Array){for(var qt=[],un=Qe.length,ht=0;ht<un;++ht){var In=Qe[ht];Mh(bt,ht,In)?qt.push(In):qt.push(je(In,bt))}return qt}for(var Un={},Gn=0,nr=Object.keys(Qe);Gn<nr.length;Gn++){var Yn=nr[Gn],pr=Qe[Yn];Un[_e(Yn)]=Yn!=="name"&&Yn!=="className"||typeof pr!="string"?je(pr,Yn):pr}return Un}(this.updatedConfig());return G?JSON.stringify(ce):ce},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){N=ye(N);for(var je=new zo,Qe=0;Qe<ce.inputs.length;++Qe)je.add(ce.inputs[Qe],N[Qe]);return xd(ce.outputs,je,G)})},ne.prototype.computeMask=function(N,G){var ce=this;return Object(c.tidy)(function(){var je;return N=ye(N),je=G==null?Y(null,N.length):ye(G),ce.runInternalGraph(N,je)[1]})},ne.prototype.computeOutputShape=function(N){var G=ri(N);if(G.length!==this.inputLayers.length)throw new H("Invalid inputShape argument "+N+": model has "+this.inputLayers.length+" tensor inputs.");for(var ce={},je=0;je<G.length;je++){var Qe=this.inputLayers[je],bt=G[je];ce[Si=Qe.name+"_0_0"]=bt}var qt=Object.keys(this.nodesByDepth).map(function(gi){return parseInt(gi,10)}).sort(It);if(qt.length>1)for(var un=0,ht=qt;un<ht.length;un++)for(var In=ht[un],Un=0,Gn=this.nodesByDepth[In];Un<Gn.length;Un++){var nr=Gn[Un];if(Qe=nr.outboundLayer,this.inputLayers.map(function(gi){return gi.id}).indexOf(Qe.id)===-1){for(var Yn=[],pr=0;pr<nr.inboundLayers.length;pr++){var gr=nr.inboundLayers[pr],Tr=nr.nodeIndices[pr],$r=nr.tensorIndices[pr],ai=ce[Si=gr.name+"_"+Tr+"_"+$r];Yn.push(ai)}var Fr=ri(Qe.computeOutputShape(oe(Yn))),ui=Qe.inboundNodes.indexOf(nr);for(pr=0;pr<Fr.length;pr++)ce[Si=Qe.name+"_"+ui+"_"+pr]=Fr[pr]}}var ii=[],wi=[];for(je=0;je<this.outputLayers.length;je++){Qe=this.outputLayers[je],ui=this.outputLayersNodeIndices[je],$r=this.outputLayersTensorIndices[je];var Si=Qe.name+"_"+ui+"_"+$r;wi.push(Si)}for(je=0;je<wi.length;je++){var si=wi[je];q(si in ce),ii.push(ce[si])}return oe(ii)},ne.prototype.runInternalGraph=function(N,G){G==null&&(G=Y(null,N.length));for(var ce={},je=0;je<this.inputs.length;++je){var Qe=this.inputs[je],bt=N[je],qt=G[je];ce[Qe.id]=[bt,qt]}for(var un=0,ht=Object.keys(this.nodesByDepth).map(function(Gi){return parseInt(Gi,10)}).sort(It);un<ht.length;un++)for(var In=ht[un],Un=0,Gn=this.nodesByDepth[In];Un<Gn.length;Un++){for(var nr=Gn[Un],Yn=nr.outboundLayer,pr=nr.inputTensors,gr=nr.outputTensors,Tr=new Array,$r=0,ai=pr;$r<ai.length;$r++)(Qe=ai[$r]).id in ce&&Tr.push(ce[Qe.id]);if(Tr.length===pr.length){var Fr={},ui=void 0,ii=void 0,wi=void 0,Si=void 0;if(nr.callArgs!=null&&(Fr=nr.callArgs),Tr.length===1){var si=Tr[0],gi=si[0],po=si[1];Fr.mask==null&&(Fr.mask=po),wi=ye(Yn.call(gi,Fr)),Si=ye(Yn.computeMask(gi,po)),ui=[gi],ii=[po]}else ui=Tr.map(function(Gi){return Gi[0]}),ii=Tr.map(function(Gi){return Gi[1]}),Fr.mask==null&&(Fr.mask=ii),wi=ye(Yn.call(ui,Fr)),Si=ye(Yn.computeMask(ui,ii));if(Yn.activityRegularizer)throw new I("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(je=0;je<gr.length;++je)Qe=gr[je],bt=wi[je],qt=Si[je],ce[Qe.id]=[bt,qt]}}for(var ho=[],Ko=[],Ki=[],mo=0,pa=this.outputs;mo<pa.length;mo++){q((Qe=pa[mo]).id in ce,"Could not compute output "+Qe.name+" : "+Qe.id);var Go=ce[Qe.id],sa=Go[0];qt=Go[1],Ki.push(sa.shape),ho.push(sa),Ko.push(qt)}return[ho,Ko,Ki]},ne.prototype.buildNodeConversionMap=function(N){for(var G,ce={},je=0,Qe=this.layers;je<Qe.length;je++){var bt=Qe[je];G=bt instanceof ne?1:0;for(var qt=0;qt<bt.inboundNodes.length;qt++){var un=ne.nodeKey(bt,qt);this.containerNodes.has(un)&&(ce[un]=G,G+=1)}}return ce},ne.prototype.getLayer=function(N,G){if(G!=null){if(this.layers.length<=G)throw new H("Was asked to retrieve layer at index "+G+", but model only has "+this.layers.length+" layer(s).");return this.layers[G]}if(N==null)throw new H("Provide either a layer name or layer index");for(var ce=0,je=this.layers;ce<je.length;ce++){var Qe=je[ce];if(Qe.name===N)return Qe}throw new H("No such layer: "+N)},ne.prototype.calculateLosses=function(){var N=this;return Object(c.tidy)(function(){for(var G=[],ce=0,je=N.layers;ce<je.length;ce++)for(var Qe=je[ce],bt=0;bt<Qe.inboundNodes.length;++bt){var qt=ne.nodeKey(Qe,bt);N.containerNodes.has(qt)&&G.push.apply(G,Qe.calculateLosses())}return G})},ne.prototype.getConfig=function(){for(var N={name:this.name},G=this.buildNodeConversionMap(this.layers),ce=[],je=0,Qe=this.layers;je<Qe.length;je++){for(var bt=(Fr=Qe[je]).getClassName(),qt=Fr.getConfig(),un=[],ht=0;ht<Fr.inboundNodes.length;ht++){var In=Fr.inboundNodes[ht],Un=ne.nodeKey(Fr,ht),Gn={};if(this.containerNodes.has(Un)){if(In.callArgs)try{JSON.stringify(In.callArgs),Gn=In.callArgs}catch{console.warn("Layer "+Fr.name+" was passed non-serializable keyword arguments: "+In.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),Gn={}}if(In.inboundLayers.length>0){for(var nr=[],Yn=0;Yn<In.inboundLayers.length;Yn++){var pr=In.inboundLayers[Yn],gr=In.nodeIndices[Yn],Tr=In.tensorIndices[Yn];(ii=G[ne.nodeKey(pr,gr)])==null&&(ii=0),nr.push([pr.name,ii,Tr,Gn])}un.push(nr)}}}var $r={};$r.name=Fr.name,$r.className=bt,$r.config=qt,$r.inboundNodes=un,ce.push($r)}N.layers=ce;var ai=[];for(Yn=0;Yn<this.inputLayers.length;Yn++){var Fr=this.inputLayers[Yn];gr=this.inputLayersNodeIndices[Yn],Un=ne.nodeKey(Fr,gr),this.containerNodes.has(Un)&&((ii=G[Un])!==null&&ii!==void 0||(ii=0),Tr=this.inputLayersTensorIndices[Yn],ai.push([Fr.name,ii,Tr]))}N.inputLayers=ai;var ui=[];for(Yn=0;Yn<this.outputLayers.length;Yn++){var ii;Fr=this.outputLayers[Yn],gr=this.outputLayersNodeIndices[Yn],Un=ne.nodeKey(Fr,gr),this.containerNodes.has(Un)&&((ii=G[Un])!==null&&ii!==void 0||(ii=0),Tr=this.outputLayersTensorIndices[Yn],ui.push([Fr.name,ii,Tr]))}return N.outputLayers=ui,N},ne.fromConfig=function(N,G,ce,je){je===void 0&&(je=!1);var Qe={},bt={};function qt(mo,pa){mo.name in bt?bt[mo.name].push(pa):bt[mo.name]=[pa]}function un(mo,pa){for(var Go,sa=[],Gi=0,Vi=pa;Gi<Vi.length;Gi++){var Ao=Vi[Gi],wa=Ao[0],Sa=Ao[1],ga=Ao[2];if(Go=Ao[3]==null?{}:Ao[3],!(wa in Qe))return void qt(mo,pa);var ua=Qe[wa];if(ua.inboundNodes.length<=Sa)return void qt(mo,pa);var ds=ua.inboundNodes[Sa];sa.push(ds.outputTensors[ga])}sa.length>0&&mo.apply(oe(sa),Go)}function ht(mo){var pa=mo.name,Go=Ha(mo,G.customObjects!=null?G.customObjects:{});Go.setFastWeightInitDuringBuild(je),Qe[pa]=Go,mo.inboundNodes.forEach(function(sa){if(!(sa instanceof Array))throw new H("Corrupted configuration, expected array for nodeData: "+sa);qt(Go,sa)})}for(var In=G.name,Un=G.layers,Gn=0,nr=Un;Gn<nr.length;Gn++)ht(gr=nr[Gn]);for(;!we(bt);)for(var Yn=0,pr=Un;Yn<pr.length;Yn++){var gr=pr[Yn];if((Ki=Qe[gr.name]).name in bt){var Tr=bt[Ki.name];delete bt[Ki.name];for(var $r=0,ai=Tr;$r<ai.length;$r++)un(Ki,ai[$r])}}for(var Fr=[],ui=[],ii=0,wi=G.inputLayers;ii<wi.length;ii++){var Si=(gr=wi[ii])[0],si=gr[1],gi=gr[2];q(Si in Qe);var po=(Ki=Qe[Si]).inboundNodes[si].outputTensors;Fr.push(po[gi])}for(var ho=0,Ko=G.outputLayers;ho<Ko.length;ho++){var Ki;Si=(gr=Ko[ho])[0],si=gr[1],gi=gr[2],q(Si in Qe),po=(Ki=Qe[Si]).inboundNodes[si].outputTensors,ui.push(po[gi])}return new N({inputs:Fr,outputs:ui,name:In})},Object.defineProperty(ne.prototype,"stateful",{get:function(){if(this._stateful)throw new H("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(var N=0,G=this.layers;N<G.length;N++)if(G[N].stateful)return!0;return!1},enumerable:!0,configurable:!0}),ne.prototype.resetStates=function(){var N=this;Object(c.tidy)(function(){N.layers.forEach(function(G){G.stateful&&G.resetStates()})})},ne}(ro));function _u(se,ne){return B(this,void 0,void 0,function(){var N;return D(this,function(G){if(ne==null&&(ne={}),typeof se=="string"){if((N=c.io.getLoadHandlers(se,ne.onProgress)).length===0)N.push(c.io.browserHTTPRequest(se,ne));else if(N.length>1)throw new H("Found more than one ("+N.length+") load handlers for URL '"+se+"'");se=N[0]}return[2,function(ce,je,Qe){return B(this,void 0,void 0,function(){var bt,qt,un,ht,In,Un,Gn,nr,Yn;return D(this,function(pr){switch(pr.label){case 0:if(Qe==null&&(Qe={}),ce.load==null)throw new H("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,ce.load()];case 1:if(bt=pr.sent(),(qt=bt.modelTopology).model_config!=null&&(qt=qt.model_config),un=Qe.strict==null||Qe.strict,ht=bt.weightData!=null&&bt.weightSpecs!=null&&un,In=Ha(qi(qt),je,ht),(Un=bt.trainingConfig)!=null&&In.loadTrainingConfig(Un),bt.userDefinedMetadata!=null&&In.setUserDefinedMetadata(bt.userDefinedMetadata),bt.weightData==null)return[3,4];if(bt.weightSpecs==null)throw new H("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");return Gn=function(gr,Tr){var $r=c.io.decodeWeights(gr,Tr),ai={},Fr=[];return Tr.forEach(function(ui){ui.group==="optimizer"?Fr.push({name:ui.name,tensor:$r[ui.name]}):ai[ui.name]=$r[ui.name]}),{modelWeights:ai,optimizerWeights:Fr}}(bt.weightData,bt.weightSpecs),nr=Gn.modelWeights,Yn=Gn.optimizerWeights,In.loadWeights(nr,un),In.optimizer!=null&&Yn.length>0?[4,In.optimizer.setWeights(Yn)]:[3,3];case 2:pr.sent(),pr.label=3;case 3:Object(c.dispose)(nr),Object(c.dispose)(Yn.map(function(gr){return gr.tensor})),pr.label=4;case 4:return[2,In]}})})}(se,void 0,ne)]})})}c.serialization.registerClass(rl);var Lt=function(se){function ne(N){var G=se.call(this,{inputs:[],outputs:[]})||this;if(N=N||{},G.trainable=!0,G.built=!1,G.name=N.name!=null?N.name:to("sequential_"),N.layers!=null)for(var ce=0,je=N.layers;ce<je.length;ce++){var Qe=je[ce];G.add(Qe)}return G}return E(ne,se),ne.prototype.checkShape=function(N){if(N.inboundNodes[0].outputTensors[0].shape.some(function(G){return G<0}))throw new H("Negative dimension size caused by adding layer "+N.name+" with input shape ["+N.inboundNodes[0].inputTensors[0].shape+"]")},ne.prototype.add=function(N){var G,ce=N instanceof ne||N instanceof rl;if(ce){if((G=N).outputs.length!==1)throw new H("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(G.inputs.length!==1)throw new H("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(N.inboundNodes.length===0){if(N.batchInputShape==null)throw new H("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var je=el({batchShape:N.batchInputShape,dtype:N.dtype,name:N.name+"_input"});N.apply(je)}if(ce)this.outputs=G.outputs,this.inputs=G.inputs;else{if(N.inboundNodes.length!==1)throw new H("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer "+N.name+" which has "+N.inboundNodes.length+" pre-existing inbound connections.");if(N.inboundNodes[0].outputTensors.length!==1)throw new H("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(N),this.outputs=[N.inboundNodes[0].outputTensors[0]],this.inputs=function bt(qt,un,ht){if((un==null||ht!=null&&ht>0)&&(un=qt.sourceLayer,ht=qt.nodeIndex),un.inboundNodes.length===0)return[qt];var In=un.inboundNodes[ht];if(In.inboundLayers.length===0)return In.inputTensors;for(var Un=[],Gn=0;Gn<In.inboundLayers.length;Gn++)for(var nr=0,Yn=bt(In.inputTensors[Gn],In.inboundLayers[Gn],In.nodeIndices[Gn]);nr<Yn.length;nr++){var pr=Yn[nr];Un.indexOf(pr)===-1&&Un.push(pr)}return Un}(this.outputs[0])}this.inboundNodes=[],new Ds({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Y(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(bt){return bt.shape}),outputShapes:this.outputs[0].shape})}else{var Qe=N.apply(this.outputs[0]);if(Array.isArray(Qe))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(N),this.outputs=[Qe],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(N),this.built=!1},ne.prototype.pop=function(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var N=this.layers.length-1;this.layers[N].outboundNodes=[],this.outputs=[this.layers[N].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},ne.prototype.call=function(N,G){return this.model==null&&this.build(),this.model.call(N,G)},ne.prototype.build=function(N){if(Kn(N),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new rl({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},ne.prototype.countParams=function(){return this.built||this.build(),se.prototype.countParams.call(this)},ne.prototype.summary=function(N,G,ce){ce===void 0&&(ce=console.log),this.built||this.build(),se.prototype.summary.call(this,N,G,ce)},ne.prototype.setWeights=function(N){this.model==null&&this.build(),this.model.setWeights(N)},ne.prototype.evaluate=function(N,G,ce){if(ce===void 0&&(ce={}),!this.built)throw new j("The model needs to be compiled before being used.");return this.model.evaluate(N,G,ce)},ne.prototype.evaluateDataset=function(N,G){return B(this,void 0,void 0,function(){return D(this,function(ce){if(!this.built)throw new j("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(N,G)]})})},ne.prototype.predict=function(N,G){return G===void 0&&(G={}),this.model==null&&this.build(),this.model.predict(N,G)},ne.prototype.predictOnBatch=function(N){return this.model==null&&this.build(),this.model.predictOnBatch(N)},ne.prototype.compile=function(N){this.build(),this.model.compile(N),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Object.defineProperty(ne.prototype,"optimizer",{get:function(){return this.model==null?void 0:this.model.optimizer},set:function(N){this.model.optimizer=N},enumerable:!0,configurable:!0}),ne.prototype.fit=function(N,G,ce){return ce===void 0&&(ce={}),B(this,void 0,void 0,function(){return D(this,function(je){if(!this.built)throw new j("The model needs to be compiled before being used.");return[2,this.model.fit(N,G,ce)]})})},ne.prototype.fitDataset=function(N,G){return B(this,void 0,void 0,function(){return D(this,function(ce){if(!this.built)throw new j("The model needs to be compiled before being used.");return[2,this.model.fitDataset(N,G)]})})},ne.prototype.trainOnBatch=function(N,G){return B(this,void 0,void 0,function(){return D(this,function(ce){return[2,this.model.trainOnBatch(N,G)]})})},ne.fromConfig=function(N,G,ce,je){var Qe;je===void 0&&(je=!1);var bt={};if(G instanceof Array){if(G[0].className==null||G[0].className==="Merge")throw new H("Legacy serialization format not supported yet.");Qe=G}else c.util.assert(G.layers!=null,function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."}),Qe=G.layers,delete G.layers,bt=G;var qt=new N(bt);if(!(qt instanceof ne))throw new I("Sequential.fromConfig called on non-Sequential input: "+qt);for(var un=0,ht=Qe;un<ht.length;un++){var In=Ha(ht[un],void 0,je);je&&In.setFastWeightInitDuringBuild(!0),qt.add(In)}return qt},Object.defineProperty(ne.prototype,"stopTraining",{get:function(){if(this.model==null)throw new H("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(N){if(this.model==null)throw new H("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=N},enumerable:!0,configurable:!0}),ne.prototype.getConfig=function(){for(var N=[],G=0,ce=this.layers;G<ce.length;G++){var je=ce[G],Qe={};Qe.className=je.getClassName(),Qe.config=je.getConfig(),N.push(Qe)}return{name:this.name,layers:N}},ne.className="Sequential",ne}(rl);function Co(se){return new rl(se)}function xa(se){return new Lt(se)}function Za(se,ne){return ne==null&&(ne={}),_u(se,ne)}function No(se){return el(se)}function Fs(se,ne){nl.registerCallbackConstructor(se,ne)}c.serialization.registerClass(Lt);var Ar=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne.prototype.getConfig=function(){return{}},ne}(c.serialization.Serializable),au=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne.prototype.apply=function(N,G){return G===void 0&&(G=1),function(ce,je){if(je===void 0&&(je=1),je!==1)throw new I("Support for alpha values other than 1 ("+je+") is not implemented yet.");return Object(c.elu)(ce)}(N,G)},ne.className="elu",ne}(Ar);c.serialization.registerClass(au);var Eu=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne.prototype.apply=function(N){return Object(c.selu)(N)},ne.className="selu",ne}(Ar);c.serialization.registerClass(Eu);var Dl=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne.prototype.apply=function(N){return Object(c.relu)(N)},ne.className="relu",ne}(Ar);c.serialization.registerClass(Dl);var su=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne.prototype.apply=function(N){return Object(c.tidy)(function(){return Object(c.minimum)(6,Object(c.relu)(N))})},ne.className="relu6",ne}(Ar);c.serialization.registerClass(su);var Ih=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne.prototype.apply=function(N){return N},ne.className="linear",ne}(Ar);c.serialization.registerClass(Ih);var Xp=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne.prototype.apply=function(N){return Object(c.sigmoid)(N)},ne.className="sigmoid",ne}(Ar);c.serialization.registerClass(Xp);var Kp=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne.prototype.apply=function(N){return function(G){return Object(c.tidy)(function(){var ce=Object(c.add)(.5,Object(c.mul)(.2,G));return Object(c.clipByValue)(ce,0,1)})}(N)},ne.className="hardSigmoid",ne}(Ar);c.serialization.registerClass(Kp);var Fu=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne.prototype.apply=function(N){return Object(c.softplus)(N)},ne.className="softplus",ne}(Ar);c.serialization.registerClass(Fu);var uo=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne.prototype.apply=function(N){return function(G){return Object(c.tidy)(function(){return Object(c.div)(G,Object(c.abs)(G).add(1))})}(N)},ne.className="softsign",ne}(Ar);c.serialization.registerClass(uo);var Rs=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne.prototype.apply=function(N){return Object(c.tanh)(N)},ne.className="tanh",ne}(Ar);c.serialization.registerClass(Rs);var Fh=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne.prototype.apply=function(N,G){return G===void 0&&(G=-1),Object(c.softmax)(N,G)},ne.className="softmax",ne}(Ar);c.serialization.registerClass(Fh);var Rc=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne.prototype.apply=function(N,G){return G===void 0&&(G=-1),Object(c.logSoftmax)(N,G)},ne.className="logSoftmax",ne}(Ar);function _s(se){return se.getClassName()}function vi(se,ne){return ne===void 0&&(ne={}),lt(se,c.serialization.SerializationMap.getMap().classNameMap,ne,"activation")}function $o(se){var ne;return se==null?vi(ne={className:"linear",config:{}}):typeof se=="string"?((ne={}).className=se,ne.config={},vi(ne)):se instanceof Ar?se:vi(se)}function Rh(se){if(se!=null&&typeof se!="object")throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: "+se)}c.serialization.registerClass(Rc);var Yp=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne}(c.serialization.Serializable),gf=function(se){function ne(N){var G=se.call(this)||this;return Rh(N),G.l1=N==null||N.l1==null?.01:N.l1,G.l2=N==null||N.l2==null?.01:N.l2,G.hasL1=G.l1!==0,G.hasL2=G.l2!==0,G}return E(ne,se),ne.prototype.apply=function(N){var G=this;return Object(c.tidy)(function(){var ce=Object(c.zeros)([1]);return G.hasL1&&(ce=Object(c.add)(ce,Object(c.sum)(Object(c.mul)(G.l1,Object(c.abs)(N))))),G.hasL2&&(ce=Object(c.add)(ce,Object(c.sum)(Object(c.mul)(G.l2,qr(N))))),ce.asScalar()})},ne.prototype.getConfig=function(){return{l1:this.l1,l2:this.l2}},ne.fromConfig=function(N,G){return new N({l1:G.l1,l2:G.l2})},ne.className="L1L2",ne}(Yp);c.serialization.registerClass(gf);var Ph={l1l2:"L1L2"};function $i(se){return Ge(se)}function Ii(se,ne){return ne===void 0&&(ne={}),lt(se,c.serialization.SerializationMap.getMap().classNameMap,ne,"regularizer")}function ma(se){return se==null?null:typeof se=="string"?Ii({className:se in Ph?Ph[se]:se,config:{}}):se instanceof Yp?se:Ii(se)}var Jp=function(se){function ne(N){var G=se.call(this,N??{})||this;return G.supportsMasking=!0,N!=null&&(G.maxValue=N.maxValue),G}return E(ne,se),ne.prototype.call=function(N,G){N=Jr(N);var ce=Object(c.relu)(N);return this.maxValue!=null&&(ce=Object(c.clipByValue)(ce,0,this.maxValue)),ce},ne.prototype.computeOutputShape=function(N){return N},ne.prototype.getConfig=function(){var N={maxValue:this.maxValue},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="ReLU",ne}(ro);c.serialization.registerClass(Jp);var Qp=function(se){function ne(N){var G=se.call(this,N??{})||this;return G.DEFAULT_ALPHA=.3,N==null&&(N={}),G.alpha=N.alpha==null?G.DEFAULT_ALPHA:N.alpha,G}return E(ne,se),ne.prototype.call=function(N,G){var ce=Jr(N);return Object(c.leakyRelu)(ce,this.alpha)},ne.prototype.computeOutputShape=function(N){return N},ne.prototype.getConfig=function(){var N={alpha:this.alpha},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="LeakyReLU",ne}(ro);c.serialization.registerClass(Qp);var Zp=function(se){function ne(N){var G=se.call(this,N??{})||this;if(G.DEFAULT_ALPHA_INITIALIZER="zeros",N==null&&(N={}),G.supportsMasking=!0,G.alphaInitializer=jr(N.alphaInitializer||G.DEFAULT_ALPHA_INITIALIZER),G.alphaRegularizer=ma(N.alphaRegularizer),G.alphaConstraint=kn(N.alphaConstraint),N.sharedAxes==null)G.sharedAxes=null;else if(Array.isArray(N.sharedAxes))G.sharedAxes=N.sharedAxes;else{if(typeof N.sharedAxes!="number")throw new H("Expected sharedAxes to be a number or an array of numbers, but got "+N.sharedAxes);G.sharedAxes=[N.sharedAxes]}return G}return E(ne,se),ne.prototype.build=function(N){var G=(N=Kn(N)).slice(1);if(this.sharedAxes!=null)for(var ce=0,je=this.sharedAxes;ce<je.length;ce++)G[(bt=je[ce])-1]=1;this.alpha=this.addWeight("alpha",G,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var Qe={};if(this.sharedAxes!=null)for(var bt=1;bt<N.length;++bt)Qe[bt]=N[bt];this.inputSpec=[new no({ndim:N.length,axes:Qe})],this.built=!0},ne.prototype.call=function(N,G){return N=Jr(N),Object(c.prelu)(N,this.alpha.read())},ne.prototype.getConfig=function(){var N={alphaInitializer:lr(this.alphaInitializer),alphaRegularizer:$i(this.alphaRegularizer),alphaConstraint:Xt(this.alphaConstraint),sharedAxes:this.sharedAxes},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="PReLU",ne}(ro);c.serialization.registerClass(Zp);var ng=function(se){function ne(N){var G=se.call(this,N??{})||this;if(G.DEFAULT_ALPHA=1,N==null&&(N={}),N.alpha!=null&&N.alpha!==G.DEFAULT_ALPHA)throw new I("Non-default alpha value ("+N.alpha+") is not supported by the ELU layer yet.");return G.alpha=N.alpha==null?G.DEFAULT_ALPHA:N.alpha,G}return E(ne,se),ne.prototype.call=function(N,G){var ce=Jr(N);return Object(c.elu)(ce)},ne.prototype.computeOutputShape=function(N){return N},ne.prototype.getConfig=function(){var N={alpha:this.alpha},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="ELU",ne}(ro);c.serialization.registerClass(ng);var pc=function(se){function ne(N){var G=se.call(this,N??{})||this;return G.DEFAULT_THETA=1,N==null&&(N={}),G.theta=N.theta==null?G.DEFAULT_THETA:N.theta,G}return E(ne,se),ne.prototype.call=function(N,G){var ce=Jr(N);return ce.mul(or(ce.greater(this.theta),"float32"))},ne.prototype.computeOutputShape=function(N){return N},ne.prototype.getConfig=function(){var N={theta:this.theta},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="ThresholdedReLU",ne}(ro);c.serialization.registerClass(pc);var Ps=function(se){function ne(N){var G=se.call(this,N??{})||this;return G.DEFAULT_AXIS=1,N==null&&(N={}),G.softmax=new Fh().apply,G.axis=N.axis==null?G.DEFAULT_AXIS:N.axis,G}return E(ne,se),ne.prototype.call=function(N,G){var ce=Jr(N);return this.softmax(ce,this.axis)},ne.prototype.computeOutputShape=function(N){return N},ne.prototype.getConfig=function(){var N={axis:this.axis},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="Softmax",ne}(ro);function Nl(se,ne,N){if(typeof se=="number")return Y(se,ne);if(se.length!==ne)throw new H("The "+N+" argument must be an integer or tuple of "+ne+" integers. Received: "+se.length+" elements.");for(var G=0;G<ne;++G){var ce=se[G];if(!Kt(ce))throw new H("The "+N+" argument must be an integer or tuple of "+ne+" integers. Received: "+JSON.stringify(se)+" including a non-integer number "+ce)}return se}function Ks(se,ne,N,G,ce){return ce===void 0&&(ce=1),se==null?se:(je=N==="same"?se:se-(ne+(ne-1)*(ce-1))+1,Math.floor((je+G-1)/G));var je}function Su(se,ne,N,G){if(se==null)return null;if(G==="valid")se=se*ne+Dt([N-ne,0]);else{if(G!=="same")throw new H("Unsupport padding mode: "+G+".");se*=ne}return se}function Lh(se,ne){return Object(c.tidy)(function(){return Jt(ne),ne==="channelsFirst"?Object(c.transpose)(se,[0,2,3,1]):se})}function Hi(se,ne){return Object(c.tidy)(function(){return Jt(ne),ne==="channelsFirst"?Object(c.transpose)(se,[0,2,3,4,1]):se})}function _d(se,ne,N,G,ce,je,Qe,bt){return G===void 0&&(G=[1,1]),ce===void 0&&(ce="valid"),bt===void 0&&(bt=null),Object(c.tidy)(function(){if(je==null&&(je="channelsLast"),Jt(je),se.rank!==3&&se.rank!==4)throw new H("conv2dWithBiasActivation expects input to be of rank 3 or 4, but received "+se.rank+".");if(ne.rank!==3&&ne.rank!==4)throw new H("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received "+se.rank+".");var qt=Lh(se,je);if(ce==="causal")throw new I("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return qt=c.fused.conv2d({x:qt,filter:ne,strides:G,pad:ce==="same"?"same":"valid",dilations:Qe,dataFormat:"NHWC",bias:N,activation:bt}),je==="channelsFirst"&&(qt=Object(c.transpose)(qt,[0,3,1,2])),qt})}c.serialization.registerClass(Ps);var Il=function(se){function ne(N,G){var ce=se.call(this,G)||this;if(ce.bias=null,ce.DEFAULT_KERNEL_INITIALIZER="glorotNormal",ce.DEFAULT_BIAS_INITIALIZER="zeros",ne.verifyArgs(G),ce.rank=N,Ot(ce.rank,"rank"),ce.rank!==1&&ce.rank!==2&&ce.rank!==3)throw new I("Convolution layer for rank other than 1, 2, or 3 ("+ce.rank+") is not implemented yet.");if(ce.kernelSize=Nl(G.kernelSize,N,"kernelSize"),ce.strides=Nl(G.strides==null?1:G.strides,N,"strides"),ce.padding=G.padding==null?"valid":G.padding,Pn(ce.padding),ce.dataFormat=G.dataFormat==null?"channelsLast":G.dataFormat,Jt(ce.dataFormat),ce.activation=$o(G.activation),ce.useBias=G.useBias==null||G.useBias,ce.biasInitializer=jr(G.biasInitializer||ce.DEFAULT_BIAS_INITIALIZER),ce.biasConstraint=kn(G.biasConstraint),ce.biasRegularizer=ma(G.biasRegularizer),ce.activityRegularizer=ma(G.activityRegularizer),ce.dilationRate=Nl(G.dilationRate==null?1:G.dilationRate,N,"dilationRate"),ce.rank===1&&Array.isArray(ce.dilationRate)&&ce.dilationRate.length!==1)throw new H("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(ce.dilationRate));if(ce.rank===2){if(typeof ce.dilationRate=="number")ce.dilationRate=[ce.dilationRate,ce.dilationRate];else if(ce.dilationRate.length!==2)throw new H("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(ce.dilationRate))}else if(ce.rank===3){if(typeof ce.dilationRate=="number")ce.dilationRate=[ce.dilationRate,ce.dilationRate,ce.dilationRate];else if(ce.dilationRate.length!==3)throw new H("dilationRate must be a number or array of three numbers for 3D convolution, but received "+JSON.stringify(ce.dilationRate))}return ce}return E(ne,se),ne.verifyArgs=function(N){if(q("kernelSize"in N,"required key 'kernelSize' not in config"),typeof N.kernelSize!="number"&&!Bt(N.kernelSize,"number",1,3))throw new H("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received "+JSON.stringify(N.kernelSize)+".")},ne.prototype.getConfig=function(){var N={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:_s(this.activation),useBias:this.useBias,biasInitializer:lr(this.biasInitializer),biasRegularizer:$i(this.biasRegularizer),activityRegularizer:$i(this.activityRegularizer),biasConstraint:Xt(this.biasConstraint)},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne}(ro),vf=function(se){function ne(N,G){var ce=se.call(this,N,G)||this;return ce.kernel=null,ne.verifyArgs(G),ce.filters=G.filters,Ot(ce.filters,"filters"),ce.kernelInitializer=jr(G.kernelInitializer||ce.DEFAULT_KERNEL_INITIALIZER),ce.kernelConstraint=kn(G.kernelConstraint),ce.kernelRegularizer=ma(G.kernelRegularizer),ce}return E(ne,se),ne.prototype.build=function(N){var G;N=Kn(N);var ce=this.dataFormat==="channelsFirst"?1:N.length-1;if(N[ce]==null)throw new H("The channel dimension of the input should be defined. Found "+N[ce]);var je=N[ce],Qe=this.kernelSize.concat([je,this.filters]);this.kernel=this.addWeight("kernel",Qe,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(G={},G[ce]=je,G)}],this.built=!0},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){var je;N=Jr(N);var Qe=ce.bias==null?null:ce.bias.read(),bt=ze(ce.activation.getClassName());if(bt!=null&&ce.rank===2)je=_d(N,ce.kernel.read(),Qe,ce.strides,ce.padding,ce.dataFormat,ce.dilationRate,bt);else{if(ce.rank===1)je=function(qt,un,ht,In,Un,Gn,nr){return In===void 0&&(In=1),Un===void 0&&(Un="valid"),nr===void 0&&(nr=1),Object(c.tidy)(function(){if(Gn==null&&(Gn="channelsLast"),Jt(Gn),qt.shape.length!==3)throw new H("The input of a conv1dWithBias operation should be 3, but is "+qt.shape.length+" instead.");if(un.shape.length!==3)throw new H("The kernel for a conv1dWithBias operation should be 3, but is "+un.shape.length+" instead");if(ht!=null&&ht.shape.length!==1)throw new H("The bias for a conv1dWithBias operation should be 1, but is "+un.shape.length+" instead");if(Gn==="channelsFirst"&&(qt=Object(c.transpose)(qt,[0,2,1])),Un==="causal")throw new I("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var Yn=Object(c.conv1d)(qt,un,In,Un==="same"?"same":"valid","NWC",nr);return ht!=null&&(Yn=Tt(Yn,ht)),Yn})}(N,ce.kernel.read(),Qe,ce.strides[0],ce.padding,ce.dataFormat,ce.dilationRate[0]);else if(ce.rank===2)je=_d(N,ce.kernel.read(),Qe,ce.strides,ce.padding,ce.dataFormat,ce.dilationRate);else{if(ce.rank!==3)throw new I("convolutions greater than 3D are not implemented yet.");je=function(qt,un,ht,In,Un,Gn,nr){return In===void 0&&(In=[1,1,1]),Un===void 0&&(Un="valid"),Object(c.tidy)(function(){if(Gn==null&&(Gn="channelsLast"),Jt(Gn),qt.rank!==4&&qt.rank!==5)throw new H("conv3dWithBias expects input to be of rank 4 or 5, but received "+qt.rank+".");if(un.rank!==4&&un.rank!==5)throw new H("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+qt.rank+".");var Yn=Hi(qt,Gn);if(Un==="causal")throw new I("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return Yn=Object(c.conv3d)(Yn,un,In,Un==="same"?"same":"valid","NDHWC",nr),ht!=null&&(Yn=Tt(Yn,ht)),Gn==="channelsFirst"&&(Yn=Object(c.transpose)(Yn,[0,4,1,2,3])),Yn})}(N,ce.kernel.read(),Qe,ce.strides,ce.padding,ce.dataFormat,ce.dilationRate)}ce.activation!=null&&(je=ce.activation.apply(je))}return je})},ne.prototype.computeOutputShape=function(N){N=Kn(N);for(var G=[],ce=this.dataFormat==="channelsLast"?N.slice(1,N.length-1):N.slice(2),je=0;je<ce.length;++je){var Qe=Ks(ce[je],this.kernelSize[je],this.padding,this.strides[je],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[je]);G.push(Qe)}var bt=[N[0]];return this.dataFormat==="channelsLast"?(bt=bt.concat(G)).push(this.filters):(bt.push(this.filters),bt=bt.concat(G)),bt},ne.prototype.getConfig=function(){var N={filters:this.filters,kernelInitializer:lr(this.kernelInitializer),kernelRegularizer:$i(this.kernelRegularizer),kernelConstraint:Xt(this.kernelConstraint)},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.verifyArgs=function(N){if(!("filters"in N)||typeof N.filters!="number"||N.filters<1)throw new H("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(N.filters))},ne}(Il),em=function(se){function ne(N){var G=se.call(this,2,N)||this;return ne.verifyArgs(N),G}return E(ne,se),ne.prototype.getConfig=function(){var N=se.prototype.getConfig.call(this);return delete N.rank,N},ne.verifyArgs=function(N){if(typeof N.kernelSize!="number"&&!Bt(N.kernelSize,"number",1,2))throw new H("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(N.kernelSize)+".")},ne.className="Conv2D",ne}(vf);c.serialization.registerClass(em);var rg=function(se){function ne(N){var G=se.call(this,3,N)||this;return ne.verifyArgs(N),G}return E(ne,se),ne.prototype.getConfig=function(){var N=se.prototype.getConfig.call(this);return delete N.rank,N},ne.verifyArgs=function(N){if(typeof N.kernelSize!="number"&&(!Array.isArray(N.kernelSize)||N.kernelSize.length!==1&&N.kernelSize.length!==3))throw new H("Conv3D expects config.kernelSize to be number or [number, number, number], but received "+JSON.stringify(N.kernelSize)+".")},ne.className="Conv3D",ne}(vf);c.serialization.registerClass(rg);var yf=function(se){function ne(N){var G=se.call(this,N)||this;if(G.inputSpec=[new no({ndim:4})],G.padding!=="same"&&G.padding!=="valid")throw new H("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+G.padding);return G}return E(ne,se),ne.prototype.build=function(N){var G;if((N=Kn(N)).length!==4)throw new H("Input should have rank 4; Received input shape: "+JSON.stringify(N));var ce=this.dataFormat==="channelsFirst"?1:N.length-1;if(N[ce]==null)throw new H("The channel dimension of the inputs should be defined. Found `None`.");var je=N[ce],Qe=this.kernelSize.concat([this.filters,je]);this.kernel=this.addWeight("kernel",Qe,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new no({ndim:4,axes:(G={},G[ce]=je,G)})],this.built=!0},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){var je=Jr(N);if(je.shape.length!==4)throw new H("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+je.shape.length);var Qe,bt,qt=je.shape,un=qt[0];ce.dataFormat==="channelsFirst"?(Qe=2,bt=3):(Qe=1,bt=2);var ht=qt[Qe],In=qt[bt],Un=ce.kernelSize[0],Gn=ce.kernelSize[1],nr=ce.strides[0],Yn=ce.strides[1],pr=[un,Su(ht,nr,Un,ce.padding),Su(In,Yn,Gn,ce.padding),ce.filters];ce.dataFormat!=="channelsLast"&&(je=Object(c.transpose)(je,[0,2,3,1]));var gr=Object(c.conv2dTranspose)(je,ce.kernel.read(),pr,ce.strides,ce.padding);return ce.dataFormat!=="channelsLast"&&(gr=Object(c.transpose)(gr,[0,3,1,2])),ce.bias!=null&&(gr=Tt(gr,ce.bias.read(),ce.dataFormat)),ce.activation!=null&&(gr=ce.activation.apply(gr)),gr})},ne.prototype.computeOutputShape=function(N){var G,ce,je,Qe=(N=Kn(N)).slice();this.dataFormat==="channelsFirst"?(G=1,ce=2,je=3):(G=3,ce=1,je=2);var bt=this.kernelSize[0],qt=this.kernelSize[1],un=this.strides[0],ht=this.strides[1];return Qe[G]=this.filters,Qe[ce]=Su(Qe[ce],un,bt,this.padding),Qe[je]=Su(Qe[je],ht,qt,this.padding),Qe},ne.prototype.getConfig=function(){var N=se.prototype.getConfig.call(this);return delete N.dilationRate,N},ne.className="Conv2DTranspose",ne}(em);c.serialization.registerClass(yf);var Bh=function(se){function ne(N){return se.call(this,2,N)||this}return E(ne,se),ne.className="SeparableConv2D",ne}(function(se){function ne(N,G){var ce=se.call(this,N,G)||this;if(ce.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",ce.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",ce.depthwiseKernel=null,ce.pointwiseKernel=null,G.filters==null)throw new H("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(G.kernelInitializer!=null||G.kernelRegularizer!=null||G.kernelConstraint!=null)throw new H("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(G.padding!=null&&G.padding!=="same"&&G.padding!=="valid")throw new H("SeparableConv"+ce.rank+"D supports only padding modes: 'same' and 'valid', but received "+JSON.stringify(G.padding));return ce.depthMultiplier=G.depthMultiplier==null?1:G.depthMultiplier,ce.depthwiseInitializer=jr(G.depthwiseInitializer||ce.DEFAULT_DEPTHWISE_INITIALIZER),ce.depthwiseRegularizer=ma(G.depthwiseRegularizer),ce.depthwiseConstraint=kn(G.depthwiseConstraint),ce.pointwiseInitializer=jr(G.depthwiseInitializer||ce.DEFAULT_POINTWISE_INITIALIZER),ce.pointwiseRegularizer=ma(G.pointwiseRegularizer),ce.pointwiseConstraint=kn(G.pointwiseConstraint),ce}return E(ne,se),ne.prototype.build=function(N){var G;if((N=Kn(N)).length<this.rank+2)throw new H("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2)+", but received input shape: "+JSON.stringify(N));var ce=this.dataFormat==="channelsFirst"?1:N.length-1;if(N[ce]==null||N[ce]<0)throw new H("The channel dimension of the inputs should be defined, but found "+JSON.stringify(N[ce]));for(var je=N[ce],Qe=this.kernelSize.concat([je,this.depthMultiplier]),bt=[],qt=0;qt<this.rank;++qt)bt.push(1);bt.push(je*this.depthMultiplier,this.filters),this.depthwiseKernel=this.addWeight("depthwise_kernel",Qe,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",bt,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.inputSpec=[new no({ndim:this.rank+2,axes:(G={},G[ce]=je,G)})],this.built=!0},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){var je;if(N=Jr(N),ce.rank===1)throw new I("1D separable convolution is not implemented yet.");return ce.rank===2&&(ce.dataFormat==="channelsFirst"&&(N=Object(c.transpose)(N,[0,2,3,1])),je=Object(c.separableConv2d)(N,ce.depthwiseKernel.read(),ce.pointwiseKernel.read(),ce.strides,ce.padding,ce.dilationRate,"NHWC")),ce.useBias&&(je=Tt(je,ce.bias.read(),ce.dataFormat)),ce.activation!=null&&(je=ce.activation.apply(je)),ce.dataFormat==="channelsFirst"&&(je=Object(c.transpose)(je,[0,3,1,2])),je})},ne.prototype.getConfig=function(){var N=se.prototype.getConfig.call(this);return delete N.rank,delete N.kernelInitializer,delete N.kernelRegularizer,delete N.kernelConstraint,N.depthwiseInitializer=lr(this.depthwiseInitializer),N.pointwiseInitializer=lr(this.pointwiseInitializer),N.depthwiseRegularizer=$i(this.depthwiseRegularizer),N.pointwiseRegularizer=$i(this.pointwiseRegularizer),N.depthwiseConstraint=Xt(this.depthwiseConstraint),N.pointwiseConstraint=Xt(this.pointwiseConstraint),N},ne.className="SeparableConv",ne}(vf));c.serialization.registerClass(Bh);var Xo=function(se){function ne(N){var G=se.call(this,1,N)||this;return ne.verifyArgs(N),G.inputSpec=[{ndim:3}],G}return E(ne,se),ne.prototype.getConfig=function(){var N=se.prototype.getConfig.call(this);return delete N.rank,delete N.dataFormat,N},ne.verifyArgs=function(N){if(typeof N.kernelSize!="number"&&!Bt(N.kernelSize,"number",1,1))throw new H("Conv1D expects config.kernelSize to be number or number[] with length 1, but received "+JSON.stringify(N.kernelSize)+".")},ne.className="Conv1D",ne}(vf);c.serialization.registerClass(Xo);var jh=function(se){function ne(N){var G=se.call(this,N)||this;return typeof N.cropping=="number"?G.cropping=[[N.cropping,N.cropping],[N.cropping,N.cropping]]:typeof N.cropping[0]=="number"?G.cropping=[[N.cropping[0],N.cropping[0]],[N.cropping[1],N.cropping[1]]]:G.cropping=N.cropping,G.dataFormat=N.dataFormat===void 0?"channelsLast":N.dataFormat,G.inputSpec=[{ndim:4}],G}return E(ne,se),ne.prototype.computeOutputShape=function(N){return this.dataFormat==="channelsFirst"?[N[0],N[1],N[2]-this.cropping[0][0]-this.cropping[0][1],N[3]-this.cropping[1][0]-this.cropping[1][1]]:[N[0],N[1]-this.cropping[0][0]-this.cropping[0][1],N[2]-this.cropping[1][0]-this.cropping[1][1],N[3]]},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){return N=Jr(N),ce.dataFormat==="channelsLast"?dr(dr(N,ce.cropping[0][0],N.shape[1]-ce.cropping[0][0]-ce.cropping[0][1],2),ce.cropping[1][0],N.shape[2]-ce.cropping[1][1]-ce.cropping[1][0],3):dr(dr(N,ce.cropping[0][0],N.shape[2]-ce.cropping[0][0]-ce.cropping[0][1],3),ce.cropping[1][0],N.shape[3]-ce.cropping[1][1]-ce.cropping[1][0],4)})},ne.prototype.getConfig=function(){var N={cropping:this.cropping,dataFormat:this.dataFormat},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="Cropping2D",ne}(ro);c.serialization.registerClass(jh);var bf=function(se){function ne(N){var G=se.call(this,N)||this;return G.DEFAULT_SIZE=[2,2],G.inputSpec=[{ndim:4}],G.size=N.size==null?G.DEFAULT_SIZE:N.size,G.dataFormat=N.dataFormat==null?"channelsLast":N.dataFormat,G}return E(ne,se),ne.prototype.computeOutputShape=function(N){if(this.dataFormat==="channelsFirst"){var G=N[2]==null?null:this.size[0]*N[2],ce=N[3]==null?null:this.size[1]*N[3];return[N[0],N[1],G,ce]}return G=N[1]==null?null:this.size[0]*N[1],ce=N[2]==null?null:this.size[1]*N[2],[N[0],G,ce,N[3]]},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){var je=Jr(N),Qe=je.shape;if(ce.dataFormat==="channelsFirst"){je=Object(c.transpose)(je,[0,2,3,1]);var bt=ce.size[0]*Qe[2],qt=ce.size[1]*Qe[3],un=je.resizeNearestNeighbor([bt,qt]);return Object(c.transpose)(un,[0,3,1,2])}return bt=ce.size[0]*Qe[1],qt=ce.size[1]*Qe[2],je.resizeNearestNeighbor([bt,qt])})},ne.prototype.getConfig=function(){var N={size:this.size,dataFormat:this.dataFormat},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="UpSampling2D",ne}(ro);c.serialization.registerClass(bf);var zh=function(se){function ne(N){var G=se.call(this,2,N)||this;return G.depthwiseKernel=null,G.depthMultiplier=N.depthMultiplier==null?1:N.depthMultiplier,G.depthwiseInitializer=jr(N.depthwiseInitializer||G.DEFAULT_KERNEL_INITIALIZER),G.depthwiseConstraint=kn(N.depthwiseConstraint),G.depthwiseRegularizer=ma(N.depthwiseRegularizer),G}return E(ne,se),ne.prototype.build=function(N){if((N=Kn(N)).length<4)throw new H("Inputs to DepthwiseConv2D should have rank 4. Received input shape: "+JSON.stringify(N)+".");var G=this.dataFormat==="channelsFirst"?1:3;if(N[G]==null||N[G]<0)throw new H("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not ("+N[G]+").");var ce=N[G],je=[this.kernelSize[0],this.kernelSize[1],ce,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",je,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[ce*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){var je=function(Qe,bt,qt,un,ht,In){return qt===void 0&&(qt=[1,1]),un===void 0&&(un="valid"),Object(c.tidy)(function(){ht==null&&(ht="channelsLast"),Jt(ht);var Un=Lh(Qe,ht);if(Qe.rank!==4)throw new H("Input for depthwiseConv2d is required to be 4-D, but is instead "+Qe.rank+"-D");if(bt.rank!==4)throw new H("depthwiseKernel is required to be 4-D, but is instead "+bt.rank+"-D");return Un=Object(c.depthwiseConv2d)(Un,bt,qt,un==="same"?"same":"valid","NHWC",In),ht==="channelsFirst"&&(Un=Object(c.transpose)(Un,[0,3,1,2])),Un})}(N=Jr(N),ce.depthwiseKernel.read(),ce.strides,ce.padding,ce.dataFormat,null);return ce.useBias&&(je=Tt(je,ce.bias.read(),ce.dataFormat)),ce.activation!=null&&(je=ce.activation.apply(je)),je})},ne.prototype.computeOutputShape=function(N){N=Kn(N);var G=this.dataFormat==="channelsFirst"?N[2]:N[1],ce=this.dataFormat==="channelsFirst"?N[3]:N[2],je=this.dataFormat==="channelsFirst"?N[1]*this.depthMultiplier:N[3]*this.depthMultiplier,Qe=Ks(G,this.kernelSize[0],this.padding,this.strides[0]),bt=Ks(ce,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[N[0],je,Qe,bt]:[N[0],Qe,bt,je]},ne.prototype.getConfig=function(){var N=se.prototype.getConfig.call(this);return N.depthMultiplier=this.depthMultiplier,N.depthwiseInitializer=lr(this.depthwiseInitializer),N.depthwiseRegularizer=$i(this.depthwiseRegularizer),N.depthwiseConstraint=Xt(this.depthwiseRegularizer),N},ne.className="DepthwiseConv2D",ne}(Il);c.serialization.registerClass(zh);var xf=function(se){function ne(N){var G=se.call(this,N)||this;return G.rate=Math.max(Math.min(N.rate,1),0),G.noiseShape=N.noiseShape,G.seed=N.seed,G.supportsMasking=!0,G}return E(ne,se),ne.prototype.getNoiseShape=function(N){if(this.noiseShape==null)return this.noiseShape;for(var G=N.shape,ce=[],je=0;je<this.noiseShape.length;++je)ce.push(this.noiseShape[je]==null?G[je]:this.noiseShape[je]);return ce},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){ce.invokeCallHook(N,G);var je=Jr(N);if(0<ce.rate&&ce.rate<1){var Qe=G.training!=null&&G.training,bt=ce.getNoiseShape(je);return Qt(function(){return Rr(je,ce.rate,bt,ce.seed)},function(){return je},Qe)}return N})},ne.prototype.getConfig=function(){var N={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.prototype.dispose=function(){return se.prototype.dispose.call(this)},ne.className="Dropout",ne}(ro);c.serialization.registerClass(xf);var Fl=function(se){function ne(N){var G=se.call(this,N)||this;return G.inputSpec=[{ndim:3}],G}return E(ne,se),ne.prototype.getNoiseShape=function(N){var G=N.shape;return[G[0],1,G[2]]},ne.className="SpatialDropout1D",ne}(xf);c.serialization.registerClass(Fl);var il=function(se){function ne(N){var G=se.call(this,N)||this;if(G.activation=null,G.useBias=!0,G.kernel=null,G.bias=null,G.DEFAULT_KERNEL_INITIALIZER="glorotNormal",G.DEFAULT_BIAS_INITIALIZER="zeros",N.batchInputShape==null&&N.inputShape==null&&N.inputDim!=null){var ce=null;N.batchSize!=null&&(ce=N.batchSize),G.batchInputShape=[ce,N.inputDim]}return G.units=N.units,Ot(G.units,"units"),G.activation=$o(N.activation),N.useBias!=null&&(G.useBias=N.useBias),G.kernelInitializer=jr(N.kernelInitializer||G.DEFAULT_KERNEL_INITIALIZER),G.biasInitializer=jr(N.biasInitializer||G.DEFAULT_BIAS_INITIALIZER),G.kernelConstraint=kn(N.kernelConstraint),G.biasConstraint=kn(N.biasConstraint),G.kernelRegularizer=ma(N.kernelRegularizer),G.biasRegularizer=ma(N.biasRegularizer),G.activityRegularizer=ma(N.activityRegularizer),G.supportsMasking=!0,G.inputSpec=[{minNDim:2}],G}return E(ne,se),ne.prototype.build=function(N){var G,ce=(N=Kn(N))[N.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[ce,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(G={},G[-1]=ce,G)}],this.built=!0},ne.prototype.computeOutputShape=function(N){var G=(N=Kn(N)).slice();return G[G.length-1]=this.units,G},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){ce.invokeCallHook(N,G);var je,Qe=Jr(N),bt=ze(ce.activation.getClassName());return bt!=null?je=ir(Qe,ce.kernel.read(),bt,ce.bias?ce.bias.read():null):(je=ir(Qe,ce.kernel.read()),ce.bias!=null&&(je=Tt(je,ce.bias.read())),ce.activation!=null&&(je=ce.activation.apply(je))),je})},ne.prototype.getConfig=function(){var N={units:this.units,activation:_s(this.activation),useBias:this.useBias,kernelInitializer:lr(this.kernelInitializer),biasInitializer:lr(this.biasInitializer),kernelRegularizer:$i(this.kernelRegularizer),biasRegularizer:$i(this.biasRegularizer),activityRegularizer:$i(this.activityRegularizer),kernelConstraint:Xt(this.kernelConstraint),biasConstraint:Xt(this.biasConstraint)},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="Dense",ne}(ro);c.serialization.registerClass(il);var Uh=function(se){function ne(N){var G=this;return N=N||{},(G=se.call(this,N)||this).inputSpec=[{minNDim:3}],G.dataFormat=N.dataFormat,G}return E(ne,se),ne.prototype.computeOutputShape=function(N){for(var G=0,ce=(N=Kn(N)).slice(1);G<ce.length;G++)if(ce[G]==null)throw new H('The shape of the input to "Flatten" is not fully defined (got '+N.slice(1)+'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.');return[N[0],Vt(N,1)]},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){ce.invokeCallHook(N,G);var je=Jr(N);if(ce.dataFormat==="channelsFirst"&&je.rank>1){for(var Qe=[0],bt=2;bt<je.rank;++bt)Qe.push(bt);Qe.push(1),je=je.transpose(Qe)}return function(qt){if(qt.rank<=1)throw new H("batchFlatten requires a minimum rank of 2. Got rank: "+qt.rank+".");var un=[qt.shape[0],Vt(qt.shape,1)];return qt.reshape(un)}(je)})},ne.prototype.getConfig=function(){var N={};this.dataFormat!=null&&(N.dataFormat=this.dataFormat);var G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="Flatten",ne}(ro);c.serialization.registerClass(Uh);var Ed=function(se){function ne(N){var G=se.call(this,N)||this;return G.supportsMasking=!0,G.activation=$o(N.activation),G}return E(ne,se),ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){ce.invokeCallHook(N,G);var je=Jr(N);return ce.activation.apply(je)})},ne.prototype.getConfig=function(){var N={activation:_s(this.activation)},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="Activation",ne}(ro);c.serialization.registerClass(Ed);var wf=function(se){function ne(N){var G=se.call(this,N)||this;return G.n=N.n,G.inputSpec=[{ndim:2}],G}return E(ne,se),ne.prototype.computeOutputShape=function(N){return[N[0],this.n,N[1]]},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){return function(je,Qe){return Object(c.tidy)(function(){if(je.shape.length!==2)throw new H("repeat() expects a rank-2 tensor, but received a rank-"+je.shape.length+" tensor.");return Xr(ar(je,1),[1,Qe,1])})}(N=Jr(N),ce.n)})},ne.prototype.getConfig=function(){var N={n:this.n},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="RepeatVector",ne}(ro);c.serialization.registerClass(wf);var ol=function(se){function ne(N){var G=se.call(this,N)||this;G.targetShape=N.targetShape;for(var ce=0;ce<G.targetShape.length;++ce)G.isUnknown(G.targetShape[ce])&&(G.targetShape[ce]=null);return G}return E(ne,se),ne.prototype.isUnknown=function(N){return N<0||N==null},ne.prototype.fixUnknownDimension=function(N,G){for(var ce="Total size of new array must be unchanged.",je=G.slice(),Qe=1,bt=null,qt=0;qt<je.length;++qt){var un=je[qt];if(this.isUnknown(un)){if(bt!==null)throw new H("Can only specifiy one unknown dimension.");bt=qt}else Qe*=un}var ht=Vt(N);if(bt!==null){if(Qe===0||ht%Qe!=0)throw new H(ce);je[bt]=ht/Qe}else if(ht!==Qe)throw new H(ce);return je},ne.prototype.computeOutputShape=function(N){for(var G=!1,ce=0;ce<N.length;++ce)if(this.isUnknown(N[ce])){G=!0;break}return G?N.slice(0,1).concat(this.targetShape):N.slice(0,1).concat(this.fixUnknownDimension(N.slice(1),this.targetShape))},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){ce.invokeCallHook(N,G);var je=Jr(N),Qe=je.shape,bt=Qe.slice(0,1).concat(ce.fixUnknownDimension(Qe.slice(1),ce.targetShape));return je.reshape(bt)})},ne.prototype.getConfig=function(){var N={targetShape:this.targetShape},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="Reshape",ne}(ro);c.serialization.registerClass(ol);var Zg=function(se){function ne(N){var G=se.call(this,N)||this;if(N.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(N.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+N.dims+" instead.");var ce=On(1,N.dims.length+1);if(!c.util.arraysEqual(N.dims.slice().sort(),ce))throw new Error("Invalid permutation `dims`: "+JSON.stringify(N.dims)+" `dims` must contain consecutive integers starting from 1.");return G.dims=N.dims,G.dimsIncludingBatch=[0].concat(G.dims),G.inputSpec=[new no({ndim:G.dims.length+1})],G}return E(ne,se),ne.prototype.computeOutputShape=function(N){var G=(N=Kn(N)).slice();return this.dims.forEach(function(ce,je){G[je+1]=N[ce]}),G},ne.prototype.call=function(N,G){return Object(c.transpose)(Jr(N),this.dimsIncludingBatch)},ne.prototype.getConfig=function(){var N={dims:this.dims},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="Permute",ne}(ro);c.serialization.registerClass(Zg);var _f=function(se){function ne(N){var G=se.call(this,N??{})||this;return G.supportsMasking=!0,G.maskValue=N!=null?N.maskValue==null?0:N.maskValue:0,G}return E(ne,se),ne.prototype.computeOutputShape=function(N){return N},ne.prototype.getConfig=function(){var N=se.prototype.getConfig.call(this),G={maskValue:this.maskValue};return Object.assign(G,N),G},ne.prototype.computeMask=function(N,G){var ce=Jr(N);return Object(c.any)(Object(c.notEqual)(ce,this.maskValue),-1)},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){ce.invokeCallHook(N,G);var je=Jr(N),Qe=Object(c.any)(Object(c.notEqual)(je,ce.maskValue),-1,!0);return je.mul(Qe.asType(je.dtype))})},ne.className="Masking",ne}(ro);c.serialization.registerClass(_f);var ha=function(se){function ne(N){var G=se.call(this,N)||this;if(G.embeddings=null,G.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",N.batchInputShape==null&&N.inputShape==null){var ce=null;N.batchSize!=null&&(ce=N.batchSize),N.inputLength==null?G.batchInputShape=[ce,null]:G.batchInputShape=[ce].concat(ye(N.inputLength))}return G.inputDim=N.inputDim,Ot(G.inputDim,"inputDim"),G.outputDim=N.outputDim,Ot(G.outputDim,"outputDim"),G.embeddingsInitializer=jr(N.embeddingsInitializer||G.DEFAULT_EMBEDDINGS_INITIALIZER),G.embeddingsRegularizer=ma(N.embeddingsRegularizer),G.activityRegularizer=ma(N.activityRegularizer),G.embeddingsConstraint=kn(N.embeddingsConstraint),G.maskZero=N.maskZero,G.supportsMasking=N.maskZero,G.inputLength=N.inputLength,G}return E(ne,se),ne.prototype.build=function(N){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},ne.prototype.warnOnIncompatibleInputShape=function(N){},ne.prototype.computeMask=function(N,G){var ce=this;return Object(c.tidy)(function(){return ce.maskZero?(N=Jr(N),Object(c.notEqual)(N,Object(c.zerosLike)(N))):null})},ne.prototype.computeOutputShape=function(N){if(N=Kn(N),this.inputLength==null)return N.concat([this.outputDim]);var G=ye(this.inputLength);if(G.length!==N.length-1)throw new H('"inputLength" is '+this.inputLength+", but received input shape has shape "+N);for(var ce=0,je=0;je<G.length;++je){var Qe=G[je],bt=N[je+1];if(Qe!=null&&bt!=null&&Qe!==bt)throw new H('"inputLength" is '+this.inputLength+", but received input shape has shape "+N);Qe==null&&(G[ce]=bt),ce++}return[N[0]].concat(G,[this.outputDim])},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){ce.invokeCallHook(N,G);var je=Jr(N);return je.dtype!=="int32"&&(je=or(je,"int32")),Or(ce.embeddings.read(),je.as1D()).reshape(Kn(ce.computeOutputShape(je.shape)))})},ne.prototype.getConfig=function(){var N={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:lr(this.embeddingsInitializer),embeddingsRegularizer:$i(this.embeddingsRegularizer),activityRegularizer:$i(this.activityRegularizer),embeddingsConstraint:Xt(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="Embedding",ne}(ro);c.serialization.registerClass(ha);var za=function(se){function ne(N){var G=se.call(this,N||{})||this;return G.supportsMasking=!0,G}return E(ne,se),ne.prototype.mergeFunction=function(N){throw new I},ne.prototype.computeElementwiseOpOutputShape=function(N,G){if(N==null||G==null)return null;if(N.length<G.length)return this.computeElementwiseOpOutputShape(G,N);if(G.length===0)return N;for(var ce=N.slice(0,N.length-G.length),je=0;je<G.length;++je){var Qe=N[N.length-G.length+je],bt=G[je];if(Qe==null||bt==null||Qe<0||bt<0)ce.push(null);else if(Qe===1)ce.push(bt);else if(bt===1)ce.push(Qe);else{if(Qe!==bt)throw new H("Operands could not be broadcast together with shapes "+JSON.stringify(N)+" "+JSON.stringify(G));ce.push(Qe)}}return ce},ne.prototype.build=function(N){if(Array.isArray(N)&&!Array.isArray(N[0])&&(N=[Kn(N)]),(N=N).length<2)throw new H("A merge layer should be called on an Array of at least 2 inputs. Got "+N.length+" input(s).");for(var G=[],ce=0,je=N;ce<je.length;ce++)(qt=je[ce])!=null&&qt[0]!==null&&G.push(qt[0]);if((G=wt(G)).length>1)throw new H("Can not merge tensors with different batch sizes. Got tensors with shapes: "+JSON.stringify(N)+".");for(var Qe=N[0]==null?null:N[0].slice(1),bt=1;bt<N.length;++bt){var qt=N[bt]==null?null:N[bt].slice(1);Qe=this.computeElementwiseOpOutputShape(Qe,qt)}var un=N.map(function(ht){return ht.length});N.indexOf(null)===-1&&wt(un).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){if(N=N,ce.reshapeRequired){var je=[],Qe=N.map(function(wi){return wi.rank});if(Qe.indexOf(null)===-1){for(var bt=Dt(Qe),qt=0,un=N;qt<un.length;qt++){for(var ht=(Yn=un[qt]).rank,In=0;In<bt-ht;++In)Yn=ar(Yn,1);je.push(Yn)}return ce.mergeFunction(je)}for(var Un=!1,Gn=0,nr=N;Gn<nr.length;Gn++){var Yn;if((ht=(Yn=nr[Gn]).rank)==null){var pr=Yn.shape,gr=pr[0],Tr=pr.slice(1).concat([gr]),$r=Yn.reshape([gr].concat(Vt(pr.slice(1))));$r=($r=Object(c.transpose)($r,[1,0])).reshape(Tr),je.push($r),Un=!0}else if(ht>1){var ai=On(1,ht).concat([0]);je.push(Object(c.transpose)(Yn,ai)),Un=!0}else je.push(Yn)}var Fr=ce.mergeFunction(je),ui=Fr.rank;if(Un)if(ui==null){var ii=Fr.shape;Tr=[gr=ii[ii.length-1]].concat(ii.slice(0,ii.length-1)),Fr=Object(c.transpose)(Fr.reshape([-1,gr]),[1,0]).reshape(Tr)}else ui>1&&(ai=[ui-1].concat(On(0,ui-1)),Fr=Object(c.transpose)(Fr,ai));return Fr}return ce.mergeFunction(N)})},ne.prototype.computeOutputShape=function(N){var G;G=(N=N)[0]==null?null:N[0].slice(1);for(var ce=1;ce<N.length;++ce){var je=N[ce]==null?null:N[ce].slice(1);G=this.computeElementwiseOpOutputShape(G,je)}for(var Qe=[],bt=0,qt=N;bt<qt.length;bt++)(je=qt[bt])!=null&&je[0]!==null&&Qe.push(je[0]);return(Qe=wt(Qe)).length===1?Qe.concat(G):[null].concat(G)},ne.prototype.computeMask=function(N,G){return Object(c.tidy)(function(){if(G==null)return null;if(!Array.isArray(G))throw new H("`mask` should be an Array");if(!Array.isArray(N))throw new H("`inputs` should be an Array");if(G.length!==N.length)throw new H("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths ("+N.length+" vs "+G.length+")");if(G.every(function(Qe){return Qe==null}))return null;for(var ce=(G=G.map(function(Qe){return Qe==null?Qe:Object(c.expandDims)(Qe,0)}))[0],je=1;je<G.length-1;++je)ce=Object(c.logicalAnd)(ce,G[je]);return ce})},ne}(ro),Ga=function(se){function ne(N){return se.call(this,N)||this}return E(ne,se),ne.prototype.mergeFunction=function(N){return Object(c.tidy)(function(){for(var G=N[0].clone(),ce=1;ce<N.length;++ce)G=Object(c.add)(G,N[ce]);return G})},ne.className="Add",ne}(za);c.serialization.registerClass(Ga);var Xi=function(se){function ne(N){return se.call(this,N)||this}return E(ne,se),ne.prototype.mergeFunction=function(N){return Object(c.tidy)(function(){for(var G=N[0].clone(),ce=1;ce<N.length;++ce)G=Object(c.mul)(G,N[ce]);return G})},ne.className="Multiply",ne}(za);c.serialization.registerClass(Xi);var Ls=function(se){function ne(N){return se.call(this,N)||this}return E(ne,se),ne.prototype.mergeFunction=function(N){return Object(c.tidy)(function(){for(var G=N[0].clone(),ce=1;ce<N.length;++ce)G=Object(c.add)(G,N[ce]);return Object(c.mul)(1/N.length,G)})},ne.className="Average",ne}(za);c.serialization.registerClass(Ls);var al=function(se){function ne(N){return se.call(this,N)||this}return E(ne,se),ne.prototype.mergeFunction=function(N){return Object(c.tidy)(function(){for(var G=N[0],ce=1;ce<N.length;++ce)G=Object(c.maximum)(G,N[ce]);return G})},ne.className="Maximum",ne}(za);c.serialization.registerClass(al);var qa=function(se){function ne(N){return se.call(this,N)||this}return E(ne,se),ne.prototype.mergeFunction=function(N){return Object(c.tidy)(function(){for(var G=N[0],ce=1;ce<N.length;++ce)G=Object(c.minimum)(G,N[ce]);return G})},ne.className="Minimum",ne}(za);c.serialization.registerClass(qa);var sl=function(se){function ne(N){var G=se.call(this,N)||this;return G.DEFAULT_AXIS=-1,N==null&&(N={}),G.axis=N.axis==null?G.DEFAULT_AXIS:N.axis,G.supportsMasking=!0,G.reshapeRequired=!1,G}return E(ne,se),ne.prototype.build=function(N){if(!Array.isArray(N)||!Array.isArray(N[0])||N.length===1)throw new H("A `Concatenate` layer should be called on a list of at least 2 inputs");for(var G=!0,ce=0,je=N=N;ce<je.length;ce++)if((Un=je[ce])!=null){G=!1;break}if(!G){for(var Qe=[],bt=0;bt<N.length;++bt){var qt=N[bt].slice();qt.splice(this.axis,1);for(var un=!1,ht=0,In=Qe;ht<In.length;ht++){var Un=In[ht];if(c.util.arraysEqual(Un,qt)){un=!0;break}}un||Qe.push(qt)}if(Qe.length>1)throw new H("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(N))}},ne.prototype.mergeFunction=function(N){var G=this;return Object(c.tidy)(function(){return oi(N,G.axis)})},ne.prototype.computeOutputShape=function(N){if(!Array.isArray(N)||!Array.isArray(N[0]))throw new H("A `Concatenate` layer should be called on a list of inputs.");for(var G=N,ce=G[0].slice(),je=this.axis<0?ce.length+this.axis:this.axis,Qe=0,bt=G.slice(1);Qe<bt.length;Qe++){var qt=bt[Qe];if(ce[je]==null||qt[je]==null){ce[je]=null;break}ce[je]+=qt[je]}return ce},ne.prototype.computeMask=function(N,G){var ce=this;if(G==null)return null;if(!Array.isArray(G))throw new H("`mask` should be an array for Concatenate");if(!Array.isArray(N))throw new H("`inputs` should be an array for Concatenate");if(G.length!==N.length)throw new H("Mismatch in the length of mask ("+G.length+") and the legnth of inputs ("+N.length+")");return Object(c.tidy)(function(){var je=!0;if(G.forEach(function(un){un==null||(je=!1)}),je)return null;for(var Qe=[],bt=0;bt<N.length;++bt)G[bt]==null?Qe.push(Object(c.onesLike)(N[bt]).asType("bool")):G[bt].rank<N[bt].rank?Qe.push(Object(c.expandDims)(G[bt],-1)):Qe.push(G[bt]);var qt=Object(c.concat)(Qe,ce.axis);return Object(c.all)(qt,-1,!1)})},ne.prototype.getConfig=function(){var N={axis:this.axis},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="Concatenate",ne}(za);function mc(se,ne){for(;se<0;)se+=ne;return se}c.serialization.registerClass(sl);var Sd=function(se){function ne(N){var G=se.call(this,N)||this;return G.axes=N.axes,G.normalize=N.normalize!=null&&N.normalize,G.supportsMasking=!0,G.reshapeRequired=!1,G}return E(ne,se),ne.prototype.build=function(N){c.util.assert(Array.isArray(N)&&N.length===2&&Array.isArray(N[0])&&Array.isArray(N[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var G=N[0],ce=N[1];if(G.length>3||ce.length>3)throw new I("Dot layer does not support tensors of 4D or higher rank yet.");var je=this.interpretAxes(G,ce);if(G[je[0]]!==ce[je[1]])throw new H("Dimension incompatibility: "+G[je[0]]+" !== "+ce[je[1]])},ne.prototype.mergeFunction=function(N){if(N.length!==2)throw new H("A `Dot` layer must be called on exactly 2 inputs, but received "+N.length+" input(s).");var G,ce=N[0],je=N[1];return G=Array.isArray(this.axes)?this.axes.map(function(Qe,bt){return mc(Qe,N[bt].shape.length)}):[mc(this.axes,ce.shape.length),mc(this.axes,je.shape.length)],this.normalize&&(ce=Tl(ce,G[0]),je=Tl(je,G[1])),function(Qe,bt,qt){if(Qe.shape.length>3||bt.shape.length>3)throw new I("batchDot is not implemented for tensors of 4D or higher rank yet");if(c.util.assert(Qe.shape.length>=2,function(){return"batchDot requires the rank of x to be >= 2, but got "+Qe.shape.length}),c.util.assert(Qe.shape.length>=2,function(){return"batchDot requires the rank of y to be >= 2, but got "+bt.shape.length}),typeof qt=="number"&&(qt=[qt,qt]),Qe.dtype==="complex64"||bt.dtype==="complex64")throw new I("batchDot is not implemented for complex64-type Tensors yet.");var un=Qe.shape.length,ht=bt.shape.length;qt==null&&(qt=[un-1,ht-2]);var In=qt;return Object(c.tidy)(function(){var Un,Gn;if(un>ht){Un=un-ht;for(var nr=[],Yn=0;Yn<Un;++Yn)nr.push(1);bt=bt.reshape(bt.shape.concat(nr))}else if(ht>un){for(Un=ht-un,nr=[],Yn=0;Yn<Un;++Yn)nr.push(1);Qe=Qe.reshape(Qe.shape.concat(nr))}else Un=0;if(Qe.shape.length===2&&bt.shape.length===2)Gn=In[0]===In[1]?Qe.mulStrict(bt).sum(In[0]):Qe.transpose([1,0]).mulStrict(bt).sum(In[1]);else{var pr=In[0]!==Qe.shape.length-1,gr=In[1]===bt.shape.length-1;Gn=Qe.matMul(bt,pr,gr)}if(Un>0){var Tr,$r=[];for(Yn=Tr=un>ht?un+ht-3:un-1;Yn<Tr+Un;++Yn)$r.push(Yn);Gn=Gn.squeeze($r)}return Gn.shape.length===1&&(Gn=Gn.expandDims(1)),Gn})}(ce,je,G)},ne.prototype.interpretAxes=function(N,G){return Array.isArray(this.axes)?this.axes:[mc(this.axes,N.length),mc(this.axes,G.length)]},ne.prototype.computeOutputShape=function(N){c.util.assert(Array.isArray(N)&&N.length===2&&Array.isArray(N[0])&&Array.isArray(N[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var G=N[0].slice(),ce=N[1].slice();if(G.length>3||ce.length>3)throw new I("Dot layer does not support tensors of 4D or higher rank yet.");var je=this.interpretAxes(G,ce);G.splice(je[0],1),ce.splice(je[1],1),ce.splice(0,1);var Qe=G.concat(ce);return Qe.length===1&&Qe.push(1),Qe},ne.prototype.computeMask=function(N,G){return null},ne.prototype.getConfig=function(){var N={axes:this.axes,normalize:this.normalize},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="Dot",ne}(za);c.serialization.registerClass(Sd);var Cd=function(se){function ne(N){var G=se.call(this,N)||this;return G.supportsMasking=!0,G.stddev=N.stddev,G}return E(ne,se),ne.prototype.computeOutputShape=function(N){return N},ne.prototype.getConfig=function(){var N=se.prototype.getConfig.call(this),G={stddev:this.stddev};return Object.assign(G,N),G},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){ce.invokeCallHook(N,G);var je=Jr(N);return Qt(function(){return zn(je.shape,0,ce.stddev).add(je)},function(){return je},G.training||!1)})},ne.className="GaussianNoise",ne}(ro);c.serialization.registerClass(Cd);var Rl=function(se){function ne(N){var G=se.call(this,N)||this;return G.supportsMasking=!0,G.rate=N.rate,G}return E(ne,se),ne.prototype.computeOutputShape=function(N){return N},ne.prototype.getConfig=function(){var N=se.prototype.getConfig.call(this),G={rate:this.rate};return Object.assign(G,N),G},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){ce.invokeCallHook(N,G);var je=Jr(N);return ce.rate>0&&ce.rate<1?Qt(function(){var Qe=Math.sqrt(ce.rate/(1-ce.rate));return je.mul(zn(je.shape,1,Qe))},function(){return je},G.training||!1):je})},ne.className="GaussianDropout",ne}(ro);c.serialization.registerClass(Rl);var tm=function(se){function ne(N){var G=se.call(this,N)||this;return G.supportsMasking=!0,G.rate=N.rate,G.noiseShape=N.noiseShape,G}return E(ne,se),ne.prototype._getNoiseShape=function(N){return this.noiseShape||Jr(N).shape},ne.prototype.computeOutputShape=function(N){return N},ne.prototype.getConfig=function(){var N=se.prototype.getConfig.call(this),G={rate:this.rate};return Object.assign(G,N),G},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){if(ce.rate<1&&ce.rate>0){var je=ce._getNoiseShape(N);return Qt(function(){var Qe=Jr(N),bt=-1.7580993408473766,qt=Object(c.greaterEqual)(Object(c.randomUniform)(je),ce.rate);qt=or(qt,"float32");var un=Math.pow((1-ce.rate)*(1+ce.rate*Math.pow(bt,2)),-.5),ht=-un*bt*ce.rate;return Qe.mul(qt).add(qt.add(-1).mul(bt)).mul(un).add(ht)},function(){return Jr(N)},G.training||!1)}return N})},ne.className="AlphaDropout",ne}(ro);function gc(se,ne,N,G,ce,je){var Qe;if(je===void 0&&(je=.001),se.rank===2)Qe=Object(c.batchNorm2d)(se,ne,N,G,ce,je);else if(se.rank===3)Qe=Object(c.batchNorm3d)(se,ne,N,G,ce,je);else{if(se.rank!==4)throw new I("batchNormalization is not implemented for array of rank "+se.rank+" yet");Qe=Object(c.batchNorm4d)(se,ne,N,G,ce,je)}return Qe}function e0(se,ne,N,G,ce){return ce===void 0&&(ce=.001),c.util.arraysEqual(G.slice().sort(),On(0,se.rank-1))?function(je,Qe,bt,qt,un){return un===void 0&&(un=.001),Object(c.tidy)(function(){var ht=Object(c.moments)(je,qt),In=ht.mean,Un=ht.variance;return[gc(je,In,Un,bt,Qe,un),In,Un]})}(se,ne,N,G,ce):function(je,Qe,bt,qt,un){return un===void 0&&(un=.001),Object(c.tidy)(function(){for(var ht=Object(c.moments)(je,qt),In=ht.mean,Un=ht.variance,Gn=[],nr=0,Yn=On(0,je.rank);nr<Yn.length;nr++){var pr=Yn[nr];qt.indexOf(pr)!==-1?Gn.push(1):Gn.push(je.shape[pr])}var gr=In.reshape(Gn),Tr=Un.reshape(Gn),$r=Qe==null?null:Qe.reshape(Gn),ai=bt==null?null:bt.reshape(Gn);return[gc(je,gr,Tr,ai,$r,un),In,Un]})}(se,ne,N,G,ce)}c.serialization.registerClass(tm);var nm=function(se){function ne(N){var G=this;return N==null&&(N={}),(G=se.call(this,N)||this).supportsMasking=!0,G.axis=N.axis==null?-1:N.axis,G.momentum=N.momentum==null?.99:N.momentum,G.epsilon=N.epsilon==null?.001:N.epsilon,G.center=N.center==null||N.center,G.scale=N.scale==null||N.scale,G.betaInitializer=jr(N.betaInitializer||"zeros"),G.gammaInitializer=jr(N.gammaInitializer||"ones"),G.movingMeanInitializer=jr(N.movingMeanInitializer||"zeros"),G.movingVarianceInitializer=jr(N.movingVarianceInitializer||"ones"),G.betaConstraint=kn(N.betaConstraint),G.gammaConstraint=kn(N.gammaConstraint),G.betaRegularizer=ma(N.betaRegularizer),G.gammaRegularizer=ma(N.gammaRegularizer),G}return E(ne,se),ne.prototype.build=function(N){var G;N=Kn(N);var ce=this.axis>=0?this.axis:this.axis+N.length,je=N[ce];if(je==null)throw new H("Axis "+ce+" of input tensor should have a defined dimension but the layer received an input with shape "+JSON.stringify(N)+".");this.inputSpec=[new no({ndim:N.length,axes:(G={},G[ce]=je,G)})];var Qe=[je];this.scale&&(this.gamma=this.addWeight("gamma",Qe,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",Qe,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",Qe,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",Qe,null,this.movingVarianceInitializer,null,!1),this.built=!0},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){var je=G.training!=null&&G.training,Qe=Jr(N),bt=Qe.shape,qt=bt.length,un=On(0,qt),ht=ce.axis>=0?ce.axis:ce.axis+qt;un.splice(ht,1);var In=Y(1,qt);In[ht]=bt[ht];var Un=un.slice();Un.sort();var Gn=!c.util.arraysEqual(Un,On(0,qt).slice(0,qt-1));if(!je)return function(){if(Gn){var $r=ce.movingMean.read().reshape(In),ai=ce.movingVariance.read().reshape(In),Fr=ce.center?ce.beta.read().reshape(In):null,ui=ce.scale?ce.gamma.read().reshape(In):null;return gc(Qe,$r,ai,Fr,ui,ce.epsilon)}return gc(Qe,ce.movingMean.read(),ce.movingVariance.read(),ce.beta==null?null:ce.beta.read(),ce.gamma==null?null:ce.gamma.read(),ce.epsilon)}();var nr=e0(Qe,ce.gamma.read(),ce.beta.read(),un,ce.epsilon),Yn=nr[0],pr=nr[1],gr=nr[2],Tr=function($r,ai,Fr){Object(c.tidy)(function(){var ui=1-Fr,ii=$r.read(),wi=ii.sub(ai).mul(ui);$r.write(ii.sub(wi))})};return Tr(ce.movingMean,pr,ce.momentum),Tr(ce.movingVariance,gr,ce.momentum),Yn})},ne.prototype.getConfig=function(){var N={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:lr(this.betaInitializer),gammaInitializer:lr(this.gammaInitializer),movingMeanInitializer:lr(this.movingMeanInitializer),movingVarianceInitializer:lr(this.movingVarianceInitializer),betaRegularizer:$i(this.betaRegularizer),gammaRegularizer:$i(this.gammaRegularizer),betaConstraint:Xt(this.betaConstraint),gammaConstraint:Xt(this.gammaConstraint)},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="BatchNormalization",ne}(ro);c.serialization.registerClass(nm);var Ef=function(se){function ne(N){var G=this;if(N==null&&(N={}),(G=se.call(this,N)||this).axis=N.axis==null?-1:N.axis,typeof G.axis=="number"){if(!Number.isInteger(G.axis))throw new Error("Expected axis to be an integer, but received "+G.axis)}else{if(!Array.isArray(G.axis))throw new Error("Expected axis to be an integer or an array of integers, but received "+JSON.stringify(G.axis));for(var ce=0,je=G.axis;ce<je.length;ce++){var Qe=je[ce];if(!Number.isInteger(Qe))throw new Error("Expected axis to be an array of integers, but received "+JSON.stringify(G.axis))}}return G.epsilon=N.epsilon==null?.001:N.epsilon,G.center=N.center==null||N.center,G.scale=N.scale==null||N.scale,G.betaInitializer=jr(N.betaInitializer||"zeros"),G.gammaInitializer=jr(N.gammaInitializer||"ones"),G.betaRegularizer=ma(N.betaRegularizer),G.gammaRegularizer=ma(N.gammaRegularizer),G.supportsMasking=!0,G}return E(ne,se),ne.prototype.build=function(N){var G=(N=Kn(N)).length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(var ce=0;ce<this.axis.length;++ce)this.axis[ce]<0&&(this.axis[ce]+=G);for(var je=0,Qe=this.axis;je<Qe.length;je++){var bt=Qe[je];if(bt<0||bt>=G)throw new Error("Invalid axis: "+bt)}if(this.axis.length!==wt(this.axis).length)throw new Error("Found duplicate axes in: "+this.axis);var qt=this.axis.map(function(un){return N[un]});this.scale?this.gamma=this.addWeight("gamma",qt,"float32",this.gammaInitializer,this.gammaRegularizer,!0):this.gamma=null,this.center?this.beta=this.addWeight("beta",qt,"float32",this.betaInitializer,this.betaRegularizer,!0):this.beta=null,this.built=!0},ne.prototype.call=function(N,G){var ce=this,je=Jr(N),Qe=je.shape,bt=Qe.length;return Object(c.tidy)(function(){for(var qt=Object(c.moments)(je,ce.axis,!0),un=qt.mean,ht=qt.variance,In=Y(1,bt),Un=0,Gn=ce.axis;Un<Gn.length;Un++){var nr=Gn[Un];In[nr]=Qe[nr]}for(var Yn=function(Fr){return Fr!=null&&Fr.shape.length!==bt&&ce.axis!==[bt-1]?Fr.reshape(In):Fr},pr=Yn(ce.gamma.read()),gr=Yn(ce.beta.read()),Tr=[],$r=[],ai=0;ai<bt;++ai)ce.axis.indexOf(ai)!==-1?(Tr.push(Qe[ai]),$r.push(1)):(Tr.push(1),$r.push(Qe[ai]));return un=un.tile(Tr),ht=ht.tile(Tr),pr=pr.tile($r),gr=gr.tile($r),gc(je,un,ht,gr,pr,ce.epsilon)})},ne.prototype.getConfig=function(){var N={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:lr(this.betaInitializer),gammaInitializer:lr(this.gammaInitializer),betaRegularizer:$i(this.betaRegularizer),gammaRegularizer:$i(this.gammaRegularizer)},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="LayerNormalization",ne}(ro);c.serialization.registerClass(Ef);var ig=function(se){function ne(N){var G=this;if(N==null&&(N={}),(G=se.call(this,N)||this).dataFormat=N.dataFormat==null?"channelsLast":N.dataFormat,N.padding==null)G.padding=[[1,1],[1,1]];else if(typeof N.padding=="number")G.padding=[[N.padding,N.padding],[N.padding,N.padding]];else{if(N.padding=N.padding,N.padding.length!==2)throw new H("ZeroPadding2D expects padding to be a length-2 array, but received a length-"+N.padding.length+" array.");var ce=void 0,je=void 0;if(typeof N.padding[0]=="number")ce=[N.padding[0],N.padding[0]],je=[N.padding[1],N.padding[1]];else{if(N.padding=N.padding,N.padding[0].length!==2)throw new H("ZeroPadding2D expects height padding to be a length-2 array, but received a length-"+N.padding[0].length+" array.");if(ce=N.padding[0],N.padding[1].length!==2)throw new H("ZeroPadding2D expects width padding to be a length-2 array, but received a length-"+N.padding[1].length+" array.");je=N.padding[1]}G.padding=[ce,je]}return G.inputSpec=[new no({ndim:4})],G}return E(ne,se),ne.prototype.computeOutputShape=function(N){var G,ce;return N=Kn(N),this.dataFormat==="channelsFirst"?(G=N[2]!=null&&N[2]>=0?N[2]+this.padding[0][0]+this.padding[0][1]:null,ce=N[3]!=null&&N[3]>=0?N[3]+this.padding[1][0]+this.padding[1][1]:null,[N[0],N[1],G,ce]):(G=N[1]!=null&&N[1]>=0?N[1]+this.padding[0][0]+this.padding[0][1]:null,ce=N[2]!=null&&N[2]>=0?N[2]+this.padding[1][0]+this.padding[1][1]:null,[N[0],G,ce,N[3]])},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){return function(je,Qe,bt){return Object(c.tidy)(function(){if(je.rank!==4)throw new H("temporalPadding expects input tensor to be 4-D, but received a "+je.rank+"-D tensor.");if(Qe==null&&(Qe=[[1,1],[1,1]]),Qe.length!==2||Qe[0].length!==2||Qe[1].length!==2)throw new H("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(bt==null&&(bt="channelsLast"),bt!=="channelsLast"&&bt!=="channelsFirst")throw new H("Unknown data format: "+bt+". Supported data formats are 'channelsLast' and 'channelsFirst.");var qt;return qt=bt==="channelsFirst"?[[0,0],[0,0],Qe[0],Qe[1]]:[[0,0],Qe[0],Qe[1],[0,0]],Object(c.pad)(je,qt)})}(Jr(N),ce.padding,ce.dataFormat)})},ne.prototype.getConfig=function(){var N={padding:this.padding,dataFormat:this.dataFormat},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="ZeroPadding2D",ne}(ro);function kd(se,ne,N,G,ce,je){return Object(c.tidy)(function(){var Qe;Jt(ce),An(je),Pn(G),N==null&&(N=[1,1]),G==null&&(G="valid"),ce==null&&(ce="channelsLast"),je==null&&(je="max"),se=Lh(se,ce);var bt=G==="same"?"same":"valid";return Qe=je==="max"?Object(c.maxPool)(se,ne,N,bt):Object(c.avgPool)(se,ne,N,bt),ce==="channelsFirst"&&(Qe=Object(c.transpose)(Qe,[0,3,1,2])),Qe})}function Pl(se,ne,N,G,ce,je){return Object(c.tidy)(function(){var Qe;Jt(ce),An(je),Pn(G),N==null&&(N=[1,1,1]),G==null&&(G="valid"),ce==null&&(ce="channelsLast"),je==null&&(je="max"),se=Hi(se,ce);var bt=G==="same"?"same":"valid";return Qe=je==="max"?Object(c.maxPool3d)(se,ne,N,bt):Object(c.avgPool3d)(se,ne,N,bt),ce==="channelsFirst"&&(Qe=Object(c.transpose)(Qe,[0,4,1,2,3])),Qe})}c.serialization.registerClass(ig);var rm=function(se){function ne(N){var G=this;if(N.poolSize==null&&(N.poolSize=2),G=se.call(this,N)||this,typeof N.poolSize=="number")G.poolSize=[N.poolSize];else{if(!Array.isArray(N.poolSize)||N.poolSize.length!==1||typeof N.poolSize[0]!="number")throw new H("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(N.poolSize));G.poolSize=N.poolSize}if(Ot(G.poolSize,"poolSize"),N.strides==null)G.strides=G.poolSize;else if(typeof N.strides=="number")G.strides=[N.strides];else{if(!Array.isArray(N.strides)||N.strides.length!==1||typeof N.strides[0]!="number")throw new H("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(N.strides));G.strides=N.strides}return Ot(G.strides,"strides"),G.padding=N.padding==null?"valid":N.padding,Pn(G.padding),G.inputSpec=[new no({ndim:3})],G}return E(ne,se),ne.prototype.computeOutputShape=function(N){var G=Ks((N=Kn(N))[1],this.poolSize[0],this.padding,this.strides[0]);return[N[0],G,N[2]]},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){ce.invokeCallHook(N,G),N=ar(Jr(N),2);var je=ce.poolingFunction(Jr(N),[ce.poolSize[0],1],[ce.strides[0],1],ce.padding,"channelsLast");return Object(c.squeeze)(je,[2])})},ne.prototype.getConfig=function(){var N={poolSize:this.poolSize,padding:this.padding,strides:this.strides},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne}(ro),Wh=function(se){function ne(N){return se.call(this,N)||this}return E(ne,se),ne.prototype.poolingFunction=function(N,G,ce,je,Qe){return Jt(Qe),Pn(je),kd(N,G,ce,je,Qe,"max")},ne.className="MaxPooling1D",ne}(rm);c.serialization.registerClass(Wh);var Da=function(se){function ne(N){return se.call(this,N)||this}return E(ne,se),ne.prototype.poolingFunction=function(N,G,ce,je,Qe){return Jt(Qe),Pn(je),kd(N,G,ce,je,Qe,"avg")},ne.className="AveragePooling1D",ne}(rm);c.serialization.registerClass(Da);var Sf=function(se){function ne(N){var G=this;if(N.poolSize==null&&(N.poolSize=[2,2]),(G=se.call(this,N)||this).poolSize=Array.isArray(N.poolSize)?N.poolSize:[N.poolSize,N.poolSize],N.strides==null)G.strides=G.poolSize;else if(Array.isArray(N.strides)){if(N.strides.length!==2)throw new H("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+N.strides.length+".");G.strides=N.strides}else G.strides=[N.strides,N.strides];return Ot(G.poolSize,"poolSize"),Ot(G.strides,"strides"),G.padding=N.padding==null?"valid":N.padding,G.dataFormat=N.dataFormat==null?"channelsLast":N.dataFormat,Jt(G.dataFormat),Pn(G.padding),G.inputSpec=[new no({ndim:4})],G}return E(ne,se),ne.prototype.computeOutputShape=function(N){N=Kn(N);var G=this.dataFormat==="channelsFirst"?N[2]:N[1],ce=this.dataFormat==="channelsFirst"?N[3]:N[2];return G=Ks(G,this.poolSize[0],this.padding,this.strides[0]),ce=Ks(ce,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[N[0],N[1],G,ce]:[N[0],G,ce,N[3]]},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){return ce.invokeCallHook(N,G),ce.poolingFunction(Jr(N),ce.poolSize,ce.strides,ce.padding,ce.dataFormat)})},ne.prototype.getConfig=function(){var N={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne}(ro),Bs=function(se){function ne(N){return se.call(this,N)||this}return E(ne,se),ne.prototype.poolingFunction=function(N,G,ce,je,Qe){return Jt(Qe),Pn(je),kd(N,G,ce,je,Qe,"max")},ne.className="MaxPooling2D",ne}(Sf);c.serialization.registerClass(Bs);var Cf=function(se){function ne(N){return se.call(this,N)||this}return E(ne,se),ne.prototype.poolingFunction=function(N,G,ce,je,Qe){return Jt(Qe),Pn(je),kd(N,G,ce,je,Qe,"avg")},ne.className="AveragePooling2D",ne}(Sf);c.serialization.registerClass(Cf);var Ad=function(se){function ne(N){var G=this;if(N.poolSize==null&&(N.poolSize=[2,2,2]),(G=se.call(this,N)||this).poolSize=Array.isArray(N.poolSize)?N.poolSize:[N.poolSize,N.poolSize,N.poolSize],N.strides==null)G.strides=G.poolSize;else if(Array.isArray(N.strides)){if(N.strides.length!==3)throw new H("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+N.strides.length+".");G.strides=N.strides}else G.strides=[N.strides,N.strides,N.strides];return Ot(G.poolSize,"poolSize"),Ot(G.strides,"strides"),G.padding=N.padding==null?"valid":N.padding,G.dataFormat=N.dataFormat==null?"channelsLast":N.dataFormat,Jt(G.dataFormat),Pn(G.padding),G.inputSpec=[new no({ndim:5})],G}return E(ne,se),ne.prototype.computeOutputShape=function(N){N=Kn(N);var G=this.dataFormat==="channelsFirst"?N[2]:N[1],ce=this.dataFormat==="channelsFirst"?N[3]:N[2],je=this.dataFormat==="channelsFirst"?N[4]:N[3];return G=Ks(G,this.poolSize[0],this.padding,this.strides[0]),ce=Ks(ce,this.poolSize[1],this.padding,this.strides[1]),je=Ks(je,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[N[0],N[1],G,ce,je]:[N[0],G,ce,je,N[4]]},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){return ce.invokeCallHook(N,G),ce.poolingFunction(Jr(N),ce.poolSize,ce.strides,ce.padding,ce.dataFormat)})},ne.prototype.getConfig=function(){var N={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne}(ro),Vh=function(se){function ne(N){return se.call(this,N)||this}return E(ne,se),ne.prototype.poolingFunction=function(N,G,ce,je,Qe){return Jt(Qe),Pn(je),Pl(N,G,ce,je,Qe,"max")},ne.className="MaxPooling3D",ne}(Ad);c.serialization.registerClass(Vh);var im=function(se){function ne(N){return se.call(this,N)||this}return E(ne,se),ne.prototype.poolingFunction=function(N,G,ce,je,Qe){return Jt(Qe),Pn(je),Pl(N,G,ce,je,Qe,"avg")},ne.className="AveragePooling3D",ne}(Ad);c.serialization.registerClass(im);var Od=function(se){function ne(N){var G=se.call(this,N)||this;return G.inputSpec=[new no({ndim:3})],G}return E(ne,se),ne.prototype.computeOutputShape=function(N){return[N[0],N[2]]},ne.prototype.call=function(N,G){throw new I},ne}(ro),kf=function(se){function ne(N){return se.call(this,N||{})||this}return E(ne,se),ne.prototype.call=function(N,G){return Object(c.tidy)(function(){var ce=Jr(N);return Object(c.mean)(ce,1)})},ne.className="GlobalAveragePooling1D",ne}(Od);c.serialization.registerClass(kf);var om=function(se){function ne(N){return se.call(this,N||{})||this}return E(ne,se),ne.prototype.call=function(N,G){return Object(c.tidy)(function(){var ce=Jr(N);return Object(c.max)(ce,1)})},ne.className="GlobalMaxPooling1D",ne}(Od);c.serialization.registerClass(om);var am=function(se){function ne(N){var G=se.call(this,N)||this;return G.dataFormat=N.dataFormat==null?"channelsLast":N.dataFormat,Jt(G.dataFormat),G.inputSpec=[new no({ndim:4})],G}return E(ne,se),ne.prototype.computeOutputShape=function(N){return N=N,this.dataFormat==="channelsLast"?[N[0],N[3]]:[N[0],N[1]]},ne.prototype.call=function(N,G){throw new I},ne.prototype.getConfig=function(){var N={dataFormat:this.dataFormat},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne}(ro),bn=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){var je=Jr(N);return ce.dataFormat==="channelsLast"?Object(c.mean)(je,[1,2]):Object(c.mean)(je,[2,3])})},ne.className="GlobalAveragePooling2D",ne}(am);c.serialization.registerClass(bn);var uu=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){var je=Jr(N);return ce.dataFormat==="channelsLast"?Object(c.max)(je,[1,2]):Object(c.max)(je,[2,3])})},ne.className="GlobalMaxPooling2D",ne}(am);function tr(se,ne,N,G){if(Array.isArray(se)){if(ne!=null||N!=null)throw new H("When inputs is an array, neither initialState or constants should be provided");G!=null&&(N=se.slice(se.length-G,se.length),se=se.slice(0,se.length-G)),se.length>1&&(ne=se.slice(1,se.length)),se=se[0]}function ce(je){return je==null||Array.isArray(je)?je:[je]}return{inputs:se,initialState:ne=ce(ne),constants:N=ce(N)}}function js(se,ne,N,G,ce,je,Qe,bt){return G===void 0&&(G=!1),Qe===void 0&&(Qe=!1),bt===void 0&&(bt=!1),Object(c.tidy)(function(){var qt=ne.shape.length;if(qt<3)throw new H("Input should be at least 3D, but is "+qt+"D.");var un=[1,0].concat(On(2,qt));if(ne=Object(c.transpose)(ne,un),je!=null)throw new I("The rnn() functoin of the deeplearn.js backend does not support constants yet.");Qe&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),ce!=null&&((ce=ce.asType("bool").asType("float32")).rank===qt-1&&(ce=Object(c.expandDims)(ce,-1)),ce=Object(c.transpose)(ce,un)),G&&(ne=Object(c.reverse)(ne,0),ce!=null&&(ce=Object(c.reverse)(ce,0)));var ht,In,Un=[],Gn=N,nr=ne.shape[0],Yn=Object(c.unstack)(ne);ce!=null&&(In=Object(c.unstack)(ce));for(var pr,gr=function($r){var ai=Yn[$r],Fr=Object(c.tidy)(function(){return se(ai,Gn)});if(ce==null)ht=Fr[0],Gn=Fr[1];else{var ui=Object(c.tidy)(function(){var ii=In[$r],wi=Object(c.onesLike)(ii).sub(ii);return{output:Fr[0].mul(ii).addStrict(Gn[0].mul(wi)),newStates:Gn.map(function(Si,si){return Fr[1][si].mul(ii).addStrict(Si.mul(wi))})}});ht=ui.output,Gn=ui.newStates}bt&&Un.push(ht)},Tr=0;Tr<nr;++Tr)gr(Tr);return bt&&(pr=Object(c.stack)(Un,1)),[ht,pr,Gn]})}c.serialization.registerClass(uu);var vo=function(se){function ne(N){var G,ce=se.call(this,N)||this;if(N.cell==null)throw new H("cell property is missing for the constructor of RNN.");if((G=Array.isArray(N.cell)?new Pc({cells:N.cell}):N.cell).stateSize==null)throw new H("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return ce.cell=G,ce.returnSequences=N.returnSequences!=null&&N.returnSequences,ce.returnState=N.returnState!=null&&N.returnState,ce.goBackwards=N.goBackwards!=null&&N.goBackwards,ce._stateful=N.stateful!=null&&N.stateful,ce.unroll=N.unroll!=null&&N.unroll,ce.supportsMasking=!0,ce.inputSpec=[new no({ndim:3})],ce.stateSpec=null,ce.states_=null,ce.numConstants=null,ce.keptStates=[],ce}return E(ne,se),ne.prototype.getStates=function(){return this.states_==null?On(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(function(N){return null}):this.states_},ne.prototype.setStates=function(N){this.states_=N},ne.prototype.computeOutputShape=function(N){yi(N)&&(N=N[0]),N=N;var G=this.cell.stateSize;Array.isArray(G)||(G=[G]);var ce,je=G[0];if(ce=this.returnSequences?[N[0],N[1],je]:[N[0],je],this.returnState){for(var Qe=[],bt=0,qt=G;bt<qt.length;bt++){var un=qt[bt];Qe.push([N[0],un])}return[ce].concat(Qe)}return ce},ne.prototype.computeMask=function(N,G){var ce=this;return Object(c.tidy)(function(){Array.isArray(G)&&(G=G[0]);var je=ce.returnSequences?G:null;if(ce.returnState){var Qe=ce.states.map(function(bt){return null});return[je].concat(Qe)}return je})},Object.defineProperty(ne.prototype,"states",{get:function(){if(this.states_==null){for(var N=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,G=[],ce=0;ce<N;++ce)G.push(null);return G}return this.states_},set:function(N){this.states_=N},enumerable:!0,configurable:!0}),ne.prototype.build=function(N){if(this.numConstants!=null)throw new I("Constants support is not implemented in RNN yet.");yi(N)&&(N=N[0]),N=N;var G=this.stateful?N[0]:null,ce=N[N.length-1];this.inputSpec[0]=new no({shape:[G,null,ce]});var je,Qe=[N[0]].concat(N.slice(2));if(this.cell.build(Qe),je=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],this.stateSpec!=null){if(!c.util.arraysEqual(this.stateSpec.map(function(bt){return bt.shape[bt.shape.length-1]}),je))throw new H("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec="+this.stateSpec+"; However cell.stateSize is "+this.cell.stateSize)}else this.stateSpec=je.map(function(bt){return new no({shape:[null,bt]})});this.stateful&&this.resetStates()},ne.prototype.resetStates=function(N,G){var ce=this;G===void 0&&(G=!1),Object(c.tidy)(function(){if(!ce.stateful)throw new W("Cannot call resetStates() on an RNN Layer that is not stateful.");var je=ce.inputSpec[0].shape[0];if(je==null)throw new H("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(ce.states_==null)Array.isArray(ce.cell.stateSize)?ce.states_=ce.cell.stateSize.map(function(ht){return Object(c.zeros)([je,ht])}):ce.states_=[Object(c.zeros)([je,ce.cell.stateSize])];else if(N==null)Object(c.dispose)(ce.states_),ce.keptStates!=null&&(Object(c.dispose)(ce.keptStates),ce.keptStates=[]),Array.isArray(ce.cell.stateSize)?ce.states_=ce.cell.stateSize.map(function(ht){return Object(c.zeros)([je,ht])}):ce.states_[0]=Object(c.zeros)([je,ce.cell.stateSize]);else{if(Array.isArray(N)||(N=[N]),N.length!==ce.states_.length)throw new H("Layer "+ce.name+" expects "+ce.states_.length+" state(s), but it received "+N.length+" state value(s). Input received: "+N);G===!0?ce.keptStates.push(ce.states_.slice()):Object(c.dispose)(ce.states_);for(var Qe=0;Qe<ce.states_.length;++Qe){var bt=N[Qe],qt=Array.isArray(ce.cell.stateSize)?ce.cell.stateSize[Qe]:ce.cell.stateSize,un=[je,qt];if(!c.util.arraysEqual(bt.shape,un))throw new H("State "+Qe+" is incompatible with layer "+ce.name+": expected shape="+un+", received shape="+bt.shape);ce.states_[Qe]=bt}}ce.states_=ce.states_.map(function(ht){return Object(c.keep)(ht.clone())})})},ne.prototype.apply=function(N,G){var ce=G==null?null:G.initialState,je=G==null?null:G.constants;G==null&&(G={});var Qe=tr(N,ce,je,this.numConstants);N=Qe.inputs,ce=Qe.initialState,je=Qe.constants;var bt=[],qt=[];if(ce!=null){G.initialState=ce,bt=bt.concat(ce),this.stateSpec=[];for(var un=0,ht=ce;un<ht.length;un++){var In=ht[un];this.stateSpec.push(new no({shape:In.shape}))}qt=qt.concat(this.stateSpec)}if(je!=null&&(G.constants=je,bt=bt.concat(je),this.numConstants=je.length),bt[0]instanceof So){var Un=[N].concat(bt),Gn=this.inputSpec.concat(qt),nr=this.inputSpec;this.inputSpec=Gn;var Yn=se.prototype.apply.call(this,Un,G);return this.inputSpec=nr,Yn}return se.prototype.apply.call(this,N,G)},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){var je=G==null?null:G.mask,Qe=G==null?null:G.training,bt=G==null?null:G.initialState;N=Jr(N),bt==null&&(bt=ce.stateful?ce.states_:ce.getInitialState(N));var qt=Array.isArray(ce.cell.stateSize)?ce.cell.stateSize.length:1;if(bt.length!==qt)throw new H("RNN Layer has "+qt+" state(s) but was passed "+bt.length+" initial state(s).");ce.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var un={training:Qe},ht=js(function(Yn,pr){var gr=ce.cell.call([Yn].concat(pr),un);return[gr[0],gr.slice(1)]},N,bt,ce.goBackwards,je,null,ce.unroll,ce.returnSequences),In=ht[0],Un=ht[1],Gn=ht[2];ce.stateful&&ce.resetStates(Gn,Qe);var nr=ce.returnSequences?Un:In;return ce.returnState?[nr].concat(Gn):nr})},ne.prototype.getInitialState=function(N){var G=this;return Object(c.tidy)(function(){var ce=Object(c.zeros)(N.shape);return ce=ar(ce=Object(c.sum)(ce,[1,2])),Array.isArray(G.cell.stateSize)?G.cell.stateSize.map(function(je){return je>1?Xr(ce,[1,je]):ce}):G.cell.stateSize>1?[Xr(ce,[1,G.cell.stateSize])]:[ce]})},Object.defineProperty(ne.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),ne.prototype.setFastWeightInitDuringBuild=function(N){se.prototype.setFastWeightInitDuringBuild.call(this,N),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(N)},ne.prototype.getConfig=function(){var N={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(N.numConstants=this.numConstants);var G=this.cell.getConfig();N.cell={className:this.cell.getClassName(),config:G};var ce=se.prototype.getConfig.call(this);return Object.assign(N,ce),N},ne.fromConfig=function(N,G,ce){ce===void 0&&(ce={});var je=Ha(G.cell,ce);return new N(Object.assign(G,{cell:je}))},ne.className="RNN",ne}(ro);c.serialization.registerClass(vo);var Af=function(se){function ne(){return se!==null&&se.apply(this,arguments)||this}return E(ne,se),ne}(ro),Td=function(se){function ne(N){var G=se.call(this,N)||this;return G.DEFAULT_ACTIVATION="tanh",G.DEFAULT_KERNEL_INITIALIZER="glorotNormal",G.DEFAULT_RECURRENT_INITIALIZER="orthogonal",G.DEFAULT_BIAS_INITIALIZER="zeros",G.units=N.units,Ot(G.units,"units"),G.activation=$o(N.activation==null?G.DEFAULT_ACTIVATION:N.activation),G.useBias=N.useBias==null||N.useBias,G.kernelInitializer=jr(N.kernelInitializer||G.DEFAULT_KERNEL_INITIALIZER),G.recurrentInitializer=jr(N.recurrentInitializer||G.DEFAULT_RECURRENT_INITIALIZER),G.biasInitializer=jr(N.biasInitializer||G.DEFAULT_BIAS_INITIALIZER),G.kernelRegularizer=ma(N.kernelRegularizer),G.recurrentRegularizer=ma(N.recurrentRegularizer),G.biasRegularizer=ma(N.biasRegularizer),G.kernelConstraint=kn(N.kernelConstraint),G.recurrentConstraint=kn(N.recurrentConstraint),G.biasConstraint=kn(N.biasConstraint),G.dropout=Vn([1,Dt([0,N.dropout==null?0:N.dropout])]),G.recurrentDropout=Vn([1,Dt([0,N.recurrentDropout==null?0:N.recurrentDropout])]),G.stateSize=G.units,G.dropoutMask=null,G.recurrentDropoutMask=null,G}return E(ne,se),ne.prototype.build=function(N){N=Kn(N),this.kernel=this.addWeight("kernel",[N[N.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){if((N=N).length!==2)throw new H("SimpleRNNCell expects 2 input Tensors, got "+N.length+".");var je=N[1];N=N[0];var Qe,bt=G.training!=null&&G.training;0<ce.dropout&&ce.dropout<1&&ce.dropoutMask==null&&(ce.dropoutMask=cu(function(){return Object(c.onesLike)(N)},ce.dropout,bt)),0<ce.recurrentDropout&&ce.recurrentDropout<1&&ce.recurrentDropoutMask==null&&(ce.recurrentDropoutMask=cu(function(){return Object(c.onesLike)(je)},ce.recurrentDropout,bt));var qt=ce.dropoutMask,un=ce.recurrentDropoutMask;Qe=ir(qt!=null?Object(c.mul)(N,qt):N,ce.kernel.read()),ce.bias!=null&&(Qe=Tt(Qe,ce.bias.read())),un!=null&&(je=Object(c.mul)(je,un));var ht=Object(c.add)(Qe,ir(je,ce.recurrentKernel.read()));return ce.activation!=null&&(ht=ce.activation.apply(ht)),[ht,ht]})},ne.prototype.getConfig=function(){var N={units:this.units,activation:_s(this.activation),useBias:this.useBias,kernelInitializer:lr(this.kernelInitializer),recurrentInitializer:lr(this.recurrentInitializer),biasInitializer:lr(this.biasInitializer),kernelRegularizer:$i(this.kernelRegularizer),recurrentRegularizer:$i(this.recurrentRegularizer),biasRegularizer:$i(this.biasRegularizer),activityRegularizer:$i(this.activityRegularizer),kernelConstraint:Xt(this.kernelConstraint),recurrentConstraint:Xt(this.recurrentConstraint),biasConstraint:Xt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="SimpleRNNCell",ne}(Af);c.serialization.registerClass(Td);var mr=function(se){function ne(N){return N.cell=new Td(N),se.call(this,N)||this}return E(ne,se),ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){ce.cell.dropoutMask!=null&&(Object(c.dispose)(ce.cell.dropoutMask),ce.cell.dropoutMask=null),ce.cell.recurrentDropoutMask!=null&&(Object(c.dispose)(ce.cell.recurrentDropoutMask),ce.cell.recurrentDropoutMask=null);var je=G==null?null:G.mask,Qe=G==null?null:G.training,bt=G==null?null:G.initialState;return se.prototype.call.call(ce,N,{mask:je,training:Qe,initialState:bt})})},Object.defineProperty(ne.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),ne.prototype.getConfig=function(){var N={units:this.units,activation:_s(this.activation),useBias:this.useBias,kernelInitializer:lr(this.kernelInitializer),recurrentInitializer:lr(this.recurrentInitializer),biasInitializer:lr(this.biasInitializer),kernelRegularizer:$i(this.kernelRegularizer),recurrentRegularizer:$i(this.recurrentRegularizer),biasRegularizer:$i(this.biasRegularizer),activityRegularizer:$i(this.activityRegularizer),kernelConstraint:Xt(this.kernelConstraint),recurrentConstraint:Xt(this.recurrentConstraint),biasConstraint:Xt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},G=se.prototype.getConfig.call(this);return delete G.cell,Object.assign(N,G),N},ne.fromConfig=function(N,G){return new N(G)},ne.className="SimpleRNN",ne}(vo);c.serialization.registerClass(mr);var is=function(se){function ne(N){var G=se.call(this,N)||this;return G.DEFAULT_ACTIVATION="tanh",G.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",G.DEFAULT_KERNEL_INITIALIZER="glorotNormal",G.DEFAULT_RECURRENT_INITIALIZER="orthogonal",G.DEFAULT_BIAS_INITIALIZER="zeros",G.units=N.units,Ot(G.units,"units"),G.activation=$o(N.activation===void 0?G.DEFAULT_ACTIVATION:N.activation),G.recurrentActivation=$o(N.recurrentActivation===void 0?G.DEFAULT_RECURRENT_ACTIVATION:N.recurrentActivation),G.useBias=N.useBias==null||N.useBias,G.kernelInitializer=jr(N.kernelInitializer||G.DEFAULT_KERNEL_INITIALIZER),G.recurrentInitializer=jr(N.recurrentInitializer||G.DEFAULT_RECURRENT_INITIALIZER),G.biasInitializer=jr(N.biasInitializer||G.DEFAULT_BIAS_INITIALIZER),G.kernelRegularizer=ma(N.kernelRegularizer),G.recurrentRegularizer=ma(N.recurrentRegularizer),G.biasRegularizer=ma(N.biasRegularizer),G.kernelConstraint=kn(N.kernelConstraint),G.recurrentConstraint=kn(N.recurrentConstraint),G.biasConstraint=kn(N.biasConstraint),G.dropout=Vn([1,Dt([0,N.dropout==null?0:N.dropout])]),G.recurrentDropout=Vn([1,Dt([0,N.recurrentDropout==null?0:N.recurrentDropout])]),G.implementation=N.implementation,G.stateSize=G.units,G.dropoutMask=null,G.recurrentDropoutMask=null,G}return E(ne,se),ne.prototype.build=function(N){var G=(N=Kn(N))[N.length-1];this.kernel=this.addWeight("kernel",[G,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){if((N=N).length!==2)throw new H("GRUCell expects 2 input Tensors (inputs, h, c), got "+N.length+".");var je=G.training!=null&&G.training,Qe=N[1];N=N[0],0<ce.dropout&&ce.dropout<1&&ce.dropoutMask==null&&(ce.dropoutMask=cu(function(){return Object(c.onesLike)(N)},ce.dropout,je,3)),0<ce.recurrentDropout&&ce.recurrentDropout<1&&ce.recurrentDropoutMask==null&&(ce.recurrentDropoutMask=cu(function(){return Object(c.onesLike)(Qe)},ce.recurrentDropout,je,3));var bt,qt,un,ht=ce.dropoutMask,In=ce.recurrentDropoutMask;0<ce.dropout&&ce.dropout<1&&(N=Object(c.mul)(N,ht[0]));var Un=ir(N,ce.kernel.read());ce.useBias&&(Un=Tt(Un,ce.bias.read())),0<ce.recurrentDropout&&ce.recurrentDropout<1&&(Qe=Object(c.mul)(Qe,In[0]));var Gn=ce.recurrentKernel.read(),nr=Object(c.split)(Gn,[2*ce.units,ce.units],Gn.rank-1),Yn=nr[0],pr=nr[1],gr=ir(Qe,Yn),Tr=Object(c.split)(Un,3,Un.rank-1),$r=Tr[0],ai=Tr[1],Fr=Tr[2],ui=Object(c.split)(gr,2,gr.rank-1),ii=ui[0],wi=ui[1];bt=ce.recurrentActivation.apply(Object(c.add)($r,ii)),qt=ce.recurrentActivation.apply(Object(c.add)(ai,wi));var Si=ir(Object(c.mul)(qt,Qe),pr);un=ce.activation.apply(Object(c.add)(Fr,Si));var si=Object(c.add)(Object(c.mul)(bt,Qe),Object(c.mul)(Object(c.add)(1,Object(c.neg)(bt)),un));return[si,si]})},ne.prototype.getConfig=function(){var N={units:this.units,activation:_s(this.activation),recurrentActivation:_s(this.recurrentActivation),useBias:this.useBias,kernelInitializer:lr(this.kernelInitializer),recurrentInitializer:lr(this.recurrentInitializer),biasInitializer:lr(this.biasInitializer),kernelRegularizer:$i(this.kernelRegularizer),recurrentRegularizer:$i(this.recurrentRegularizer),biasRegularizer:$i(this.biasRegularizer),activityRegularizer:$i(this.activityRegularizer),kernelConstraint:Xt(this.kernelConstraint),recurrentConstraint:Xt(this.recurrentConstraint),biasConstraint:Xt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="GRUCell",ne}(Af);c.serialization.registerClass(is);var Na=function(se){function ne(N){return N.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),N.cell=new is(N),se.call(this,N)||this}return E(ne,se),ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){ce.cell.dropoutMask!=null&&(Object(c.dispose)(ce.cell.dropoutMask),ce.cell.dropoutMask=null),ce.cell.recurrentDropoutMask!=null&&(Object(c.dispose)(ce.cell.recurrentDropoutMask),ce.cell.recurrentDropoutMask=null);var je=G==null?null:G.mask,Qe=G==null?null:G.training,bt=G==null?null:G.initialState;return se.prototype.call.call(ce,N,{mask:je,training:Qe,initialState:bt})})},Object.defineProperty(ne.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),ne.prototype.getConfig=function(){var N={units:this.units,activation:_s(this.activation),recurrentActivation:_s(this.recurrentActivation),useBias:this.useBias,kernelInitializer:lr(this.kernelInitializer),recurrentInitializer:lr(this.recurrentInitializer),biasInitializer:lr(this.biasInitializer),kernelRegularizer:$i(this.kernelRegularizer),recurrentRegularizer:$i(this.recurrentRegularizer),biasRegularizer:$i(this.biasRegularizer),activityRegularizer:$i(this.activityRegularizer),kernelConstraint:Xt(this.kernelConstraint),recurrentConstraint:Xt(this.recurrentConstraint),biasConstraint:Xt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},G=se.prototype.getConfig.call(this);return delete G.cell,Object.assign(N,G),N},ne.fromConfig=function(N,G){return G.implmentation===0&&(G.implementation=1),new N(G)},ne.className="GRU",ne}(vo);c.serialization.registerClass(Na);var io=function(se){function ne(N){var G=se.call(this,N)||this;return G.DEFAULT_ACTIVATION="tanh",G.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",G.DEFAULT_KERNEL_INITIALIZER="glorotNormal",G.DEFAULT_RECURRENT_INITIALIZER="orthogonal",G.DEFAULT_BIAS_INITIALIZER="zeros",G.units=N.units,Ot(G.units,"units"),G.activation=$o(N.activation===void 0?G.DEFAULT_ACTIVATION:N.activation),G.recurrentActivation=$o(N.recurrentActivation===void 0?G.DEFAULT_RECURRENT_ACTIVATION:N.recurrentActivation),G.useBias=N.useBias==null||N.useBias,G.kernelInitializer=jr(N.kernelInitializer||G.DEFAULT_KERNEL_INITIALIZER),G.recurrentInitializer=jr(N.recurrentInitializer||G.DEFAULT_RECURRENT_INITIALIZER),G.biasInitializer=jr(N.biasInitializer||G.DEFAULT_BIAS_INITIALIZER),G.unitForgetBias=N.unitForgetBias,G.kernelRegularizer=ma(N.kernelRegularizer),G.recurrentRegularizer=ma(N.recurrentRegularizer),G.biasRegularizer=ma(N.biasRegularizer),G.kernelConstraint=kn(N.kernelConstraint),G.recurrentConstraint=kn(N.recurrentConstraint),G.biasConstraint=kn(N.biasConstraint),G.dropout=Vn([1,Dt([0,N.dropout==null?0:N.dropout])]),G.recurrentDropout=Vn([1,Dt([0,N.recurrentDropout==null?0:N.recurrentDropout])]),G.implementation=N.implementation,G.stateSize=[G.units,G.units],G.dropoutMask=null,G.recurrentDropoutMask=null,G}return E(ne,se),ne.prototype.build=function(N){var G,ce,je=(N=Kn(N))[N.length-1];if(this.kernel=this.addWeight("kernel",[je,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var Qe=this.biasInitializer,bt=this.units;ce=new((G=function(qt){function un(){return qt!==null&&qt.apply(this,arguments)||this}return E(un,qt),un.prototype.apply=function(ht,In){var Un=Qe.apply([bt]),Gn=new rt().apply([bt]),nr=Qe.apply([2*bt]);return Ur(Ur(Un,Gn),nr)},un}(ke)).className="CustomInit",G)}else ce=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,ce,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){var je=G.training!=null&&G.training;if((N=N).length!==3)throw new H("LSTMCell expects 3 input Tensors (inputs, h, c), got "+N.length+".");var Qe=N[1],bt=N[2];N=N[0],0<ce.dropout&&ce.dropout<1&&ce.dropoutMask==null&&(ce.dropoutMask=cu(function(){return Object(c.onesLike)(N)},ce.dropout,je,4)),0<ce.recurrentDropout&&ce.recurrentDropout<1&&ce.recurrentDropoutMask==null&&(ce.recurrentDropoutMask=cu(function(){return Object(c.onesLike)(Qe)},ce.recurrentDropout,je,4));var qt,un,ht,In,Un=ce.dropoutMask,Gn=ce.recurrentDropoutMask;0<ce.dropout&&ce.dropout<1&&(N=Object(c.mul)(N,Un[0]));var nr=ir(N,ce.kernel.read());0<ce.recurrentDropout&&ce.recurrentDropout<1&&(Qe=Object(c.mul)(Qe,Gn[0])),nr=Object(c.add)(nr,ir(Qe,ce.recurrentKernel.read())),ce.useBias&&(nr=Tt(nr,ce.bias.read()));var Yn=Object(c.split)(nr,4,nr.rank-1),pr=Yn[0],gr=Yn[1],Tr=Yn[2],$r=Yn[3];qt=ce.recurrentActivation.apply(pr),un=ce.recurrentActivation.apply(gr),ht=Object(c.add)(Object(c.mul)(un,bt),Object(c.mul)(qt,ce.activation.apply(Tr))),In=ce.recurrentActivation.apply($r);var ai=Object(c.mul)(In,ce.activation.apply(ht));return[ai,ai,ht]})},ne.prototype.getConfig=function(){var N={units:this.units,activation:_s(this.activation),recurrentActivation:_s(this.recurrentActivation),useBias:this.useBias,kernelInitializer:lr(this.kernelInitializer),recurrentInitializer:lr(this.recurrentInitializer),biasInitializer:lr(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:$i(this.kernelRegularizer),recurrentRegularizer:$i(this.recurrentRegularizer),biasRegularizer:$i(this.biasRegularizer),activityRegularizer:$i(this.activityRegularizer),kernelConstraint:Xt(this.kernelConstraint),recurrentConstraint:Xt(this.recurrentConstraint),biasConstraint:Xt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.className="LSTMCell",ne}(Af);c.serialization.registerClass(io);var Xu=function(se){function ne(N){return N.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),N.cell=new io(N),se.call(this,N)||this}return E(ne,se),ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){ce.cell.dropoutMask!=null&&(Object(c.dispose)(ce.cell.dropoutMask),ce.cell.dropoutMask=null),ce.cell.recurrentDropoutMask!=null&&(Object(c.dispose)(ce.cell.recurrentDropoutMask),ce.cell.recurrentDropoutMask=null);var je=G==null?null:G.mask,Qe=G==null?null:G.training,bt=G==null?null:G.initialState;return se.prototype.call.call(ce,N,{mask:je,training:Qe,initialState:bt})})},Object.defineProperty(ne.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"unitForgetBias",{get:function(){return this.cell.unitForgetBias},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),ne.prototype.getConfig=function(){var N={units:this.units,activation:_s(this.activation),recurrentActivation:_s(this.recurrentActivation),useBias:this.useBias,kernelInitializer:lr(this.kernelInitializer),recurrentInitializer:lr(this.recurrentInitializer),biasInitializer:lr(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:$i(this.kernelRegularizer),recurrentRegularizer:$i(this.recurrentRegularizer),biasRegularizer:$i(this.biasRegularizer),activityRegularizer:$i(this.activityRegularizer),kernelConstraint:Xt(this.kernelConstraint),recurrentConstraint:Xt(this.recurrentConstraint),biasConstraint:Xt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},G=se.prototype.getConfig.call(this);return delete G.cell,Object.assign(N,G),N},ne.fromConfig=function(N,G){return G.implmentation===0&&(G.implementation=1),new N(G)},ne.className="LSTM",ne}(vo);c.serialization.registerClass(Xu);var Pc=function(se){function ne(N){var G=se.call(this,N)||this;return G.cells=N.cells,G}return E(ne,se),Object.defineProperty(ne.prototype,"stateSize",{get:function(){for(var N=[],G=0,ce=this.cells.slice().reverse();G<ce.length;G++){var je=ce[G];Array.isArray(je.stateSize)?N.push.apply(N,je.stateSize):N.push(je.stateSize)}return N},enumerable:!0,configurable:!0}),ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){for(var je=(N=N).slice(1),Qe=[],bt=0,qt=ce.cells.slice().reverse();bt<qt.length;bt++){var un=qt[bt];Array.isArray(un.stateSize)?Qe.push(je.splice(0,un.stateSize.length)):Qe.push(je.splice(0,1))}Qe.reverse();for(var ht,In=[],Un=0;Un<ce.cells.length;++Un)un=ce.cells[Un],je=Qe[Un],ht=Un===0?[N[0]].concat(je):[ht[0]].concat(je),ht=un.call(ht,G),In.push(ht.slice(1));je=[];for(var Gn=0,nr=In.slice().reverse();Gn<nr.length;Gn++){var Yn=nr[Gn];je.push.apply(je,Yn)}return[ht[0]].concat(je)})},ne.prototype.build=function(N){var G;yi(N)&&(N=N[0]),N=N,this.cells.forEach(function(ce,je){sr("RNNCell_"+je,function(){ce.build(N),G=Array.isArray(ce.stateSize)?ce.stateSize[0]:ce.stateSize,N=[N[0],G]})}),this.built=!0},ne.prototype.getConfig=function(){for(var N=[],G=0,ce=this.cells;G<ce.length;G++){var je=ce[G];N.push({className:je.getClassName(),config:je.getConfig()})}var Qe={cells:N},bt=se.prototype.getConfig.call(this);return Object.assign(Qe,bt),Qe},ne.fromConfig=function(N,G,ce){ce===void 0&&(ce={});for(var je=[],Qe=0,bt=G.cells;Qe<bt.length;Qe++){var qt=bt[Qe];je.push(Ha(qt,ce))}return new N({cells:je})},Object.defineProperty(ne.prototype,"trainableWeights",{get:function(){if(!this.trainable)return[];for(var N=[],G=0,ce=this.cells;G<ce.length;G++){var je=ce[G];N.push.apply(N,je.trainableWeights)}return N},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"nonTrainableWeights",{get:function(){for(var N=[],G=0,ce=this.cells;G<ce.length;G++){var je=ce[G];N.push.apply(N,je.nonTrainableWeights)}if(!this.trainable){for(var Qe=[],bt=0,qt=this.cells;bt<qt.length;bt++)je=qt[bt],Qe.push.apply(Qe,je.trainableWeights);return Qe.concat(N)}return N},enumerable:!0,configurable:!0}),ne.prototype.getWeights=function(){for(var N=[],G=0,ce=this.cells;G<ce.length;G++){var je=ce[G];N.push.apply(N,je.weights)}return so(N)},ne.prototype.setWeights=function(N){for(var G=[],ce=0,je=this.cells;ce<je.length;ce++)for(var Qe=je[ce],bt=Qe.weights.length,qt=N.splice(bt),un=0;un<Qe.weights.length;++un)G.push([Qe.weights[un],qt[un]]);Wi(G)},ne.className="StackedRNNCells",ne}(Af);function cu(se,ne,N,G){function ce(){return Rr(se(),ne)}if(N===void 0&&(N=null),G===void 0&&(G=1),G>1){for(var je=[],Qe=0;Qe<G;Qe++)je.push(Qt(ce,se,N));return je.map(function(bt){return Object(c.keep)(bt.clone())})}return Object(c.keep)(Qt(ce,se,N).clone())}c.serialization.registerClass(Pc);var Lc=function(se){function ne(N){var G=se.call(this,N)||this;return G.layer=N.layer,G}return E(ne,se),ne.prototype.build=function(N){this.built=!0},Object.defineProperty(ne.prototype,"trainable",{get:function(){return this.layer!=null&&this.layer.trainable},set:function(N){this.layer!=null&&(this.layer.trainable=N)},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),ne.prototype.getWeights=function(){return this.layer.getWeights()},ne.prototype.setWeights=function(N){this.layer.setWeights(N)},ne.prototype.getConfig=function(){var N={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.prototype.setFastWeightInitDuringBuild=function(N){se.prototype.setFastWeightInitDuringBuild.call(this,N),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(N)},ne.fromConfig=function(N,G,ce){ce===void 0&&(ce={});var je=Ha(G.layer,ce);delete G.layer;var Qe={layer:je};return Object.assign(Qe,G),new N(Qe)},ne}(ro),oa=function(se){function ne(N){var G=se.call(this,N)||this;return G.supportsMasking=!0,G}return E(ne,se),ne.prototype.build=function(N){if((N=Kn(N)).length<3)throw new H("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(N));this.inputSpec=[{shape:N}];var G=[N[0]].concat(N.slice(2));this.layer.built||(this.layer.build(G),this.layer.built=!0),se.prototype.build.call(this,N)},ne.prototype.computeOutputShape=function(N){var G=[(N=Kn(N))[0]].concat(N.slice(2)),ce=this.layer.computeOutputShape(G),je=N[1];return[ce[0],je].concat(ce.slice(1))},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){return js(function(je,Qe){return[Jr(ce.layer.call(je,G)),[]]},N=Jr(N),[],!1,null,null,!1,!0)[1]})},ne.className="TimeDistributed",ne}(Lc);c.serialization.registerClass(oa);var vc="concat",lu=function(se){function ne(N){var G=se.call(this,N)||this,ce=N.layer.getConfig(),je={};je.className=N.layer.getClassName(),je.config=ce,G.forwardLayer=Ha(je),ce.goBackwards=ce.goBackwards!==!0;var Qe={};if(Qe.className=N.layer.getClassName(),Qe.config=ce,G.backwardLayer=Ha(Qe),G.forwardLayer.name="forward_"+G.forwardLayer.name,G.backwardLayer.name="backward_"+G.backwardLayer.name,G.mergeMode=N.mergeMode===void 0?vc:N.mergeMode,function(bt){yt(ft,"BidirectionalMergeMode",bt)}(G.mergeMode),N.weights)throw new I("weights support is not implemented for Bidirectional layer yet.");return G._stateful=N.layer.stateful,G.returnSequences=N.layer.returnSequences,G.returnState=N.layer.returnState,G.supportsMasking=!0,G._trainable=!0,G.inputSpec=N.layer.inputSpec,G.numConstants=null,G}return E(ne,se),Object.defineProperty(ne.prototype,"trainable",{get:function(){return this._trainable},set:function(N){this._trainable=N,this.forwardLayer!=null&&(this.forwardLayer.trainable=N),this.backwardLayer!=null&&(this.backwardLayer.trainable=N)},enumerable:!0,configurable:!0}),ne.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},ne.prototype.setWeights=function(N){var G=N.length,ce=Math.floor(G/2);this.forwardLayer.setWeights(N.slice(0,ce)),this.backwardLayer.setWeights(N.slice(ce))},ne.prototype.computeOutputShape=function(N){var G,ce,je,Qe=this.forwardLayer.computeOutputShape(N);return Array.isArray(Qe)&&Array.isArray(Qe[0])||(Qe=[Qe]),Qe=Qe,this.returnState&&(je=Qe.slice(1)),G=Qe[0],G=G,this.mergeMode==="concat"?(G[G.length-1]*=2,ce=[G]):ce=this.mergeMode==null?[G,G.slice()]:[G],this.returnState?this.mergeMode==null?ce.concat(je).concat(je.slice()):[G].concat(je).concat(je.slice()):oe(ce)},ne.prototype.apply=function(N,G){var ce=G==null?null:G.initialState,je=G==null?null:G.constants;G==null&&(G={});var Qe=tr(N,ce,je,this.numConstants);if(N=Qe.inputs,ce=Qe.initialState,je=Qe.constants,Array.isArray(N)&&(ce=N.slice(1),N=N[0]),(ce==null||ce.length===0)&&je==null)return se.prototype.apply.call(this,N,G);var bt=[],qt=[];if(ce!=null){var un=ce.length;if(un%2>0)throw new H("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");G.initialState=ce,bt.push.apply(bt,ce);var ht=ce.map(function(Tr){return new no({shape:Tr.shape})});this.forwardLayer.stateSpec=ht.slice(0,un/2),this.backwardLayer.stateSpec=ht.slice(un/2),qt.push.apply(qt,ht)}if(je!=null)throw new I("Support for constants in Bidirectional layers is not implemented yet.");for(var In=bt[0]instanceof So,Un=0,Gn=bt;Un<Gn.length;Un++)if(Gn[Un]instanceof So!==In)throw new H("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(In){var nr=[N].concat(bt),Yn=this.inputSpec.concat(qt),pr=this.inputSpec;this.inputSpec=Yn;var gr=se.prototype.apply.call(this,nr,G);return this.inputSpec=pr,gr}return se.prototype.apply.call(this,N,G)},ne.prototype.call=function(N,G){var ce=this;return Object(c.tidy)(function(){var je,Qe,bt,qt,un=G.initialState;if(un==null)je=ce.forwardLayer.call(N,G),Qe=ce.backwardLayer.call(N,G);else{var ht=un.slice(0,un.length/2),In=un.slice(un.length/2);je=ce.forwardLayer.call(N,Object.assign(G,{initialState:ht})),Qe=ce.backwardLayer.call(N,Object.assign(G,{initialState:In}))}return ce.returnState&&(Array.isArray(je)&&(bt=je.slice(1).concat(Qe.slice(1))),je=je[0],Qe=Qe[0]),ce.returnSequences&&(Qe=Object(c.reverse)(Qe,1)),ce.mergeMode==="concat"?qt=oi([je,Qe]):ce.mergeMode==="sum"?qt=Object(c.add)(je,Qe):ce.mergeMode==="ave"?qt=Object(c.mul)(.5,Object(c.add)(je,Qe)):ce.mergeMode==="mul"?qt=Object(c.mul)(je,Qe):ce.mergeMode==null&&(qt=[je,Qe]),ce.returnState?ce.mergeMode==null?qt.concat(bt):[qt].concat(bt):qt})},ne.prototype.resetStates=function(N){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},ne.prototype.build=function(N){var G=this;sr(this.forwardLayer.name,function(){G.forwardLayer.build(N)}),sr(this.backwardLayer.name,function(){G.backwardLayer.build(N)}),this.built=!0},ne.prototype.computeMask=function(N,G){var ce;if(Array.isArray(G)&&(G=G[0]),ce=this.returnSequences?this.mergeMode==null?[G,G]:G:this.mergeMode==null?[null,null]:null,this.returnState){var je=this.forwardLayer.states.map(function(Qe){return null});return Array.isArray(ce)?ce.concat(je).concat(je):[ce].concat(je).concat(je)}return ce},Object.defineProperty(ne.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),ne.prototype.setFastWeightInitDuringBuild=function(N){se.prototype.setFastWeightInitDuringBuild.call(this,N),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(N),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(N)},ne.prototype.getConfig=function(){var N={mergeMode:this.mergeMode},G=se.prototype.getConfig.call(this);return Object.assign(N,G),N},ne.fromConfig=function(N,G){var ce=Ha(G.layer);if(delete G.layer,G.numConstants!=null)throw new I("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var je=G;return je.layer=ce,new N(je)},ne.className="Bidirectional",ne}(Lc);function bo(se){return new Da(se)}function Es(se){return new Cf(se)}function Ua(se){return new im(se)}function Ss(se){return new om(se)}function aa(se){return new uu(se)}function fu(se){return new Wh(se)}function Ku(se){return new Bs(se)}c.serialization.registerClass(lu);var yc=Ss,Bc=aa,Yu=fu,Ll=Ku,Bl=Object.freeze({inputLayer:function(se){return new Gu(se)},elu:function(se){return new ng(se)},reLU:function(se){return new Jp(se)},leakyReLU:function(se){return new Qp(se)},prelu:function(se){return new Zp(se)},softmax:function(se){return new Ps(se)},thresholdedReLU:function(se){return new pc(se)},conv1d:function(se){return new Xo(se)},conv2d:function(se){return new em(se)},conv2dTranspose:function(se){return new yf(se)},conv3d:function(se){return new rg(se)},separableConv2d:function(se){return new Bh(se)},cropping2D:function(se){return new jh(se)},upSampling2d:function(se){return new bf(se)},depthwiseConv2d:function(se){return new zh(se)},activation:function(se){return new Ed(se)},dense:function(se){return new il(se)},dropout:function(se){return new xf(se)},spatialDropout1d:function(se){return new Fl(se)},flatten:function(se){return new Uh(se)},repeatVector:function(se){return new wf(se)},reshape:function(se){return new ol(se)},permute:function(se){return new Zg(se)},embedding:function(se){return new ha(se)},add:function(se){return new Ga(se)},average:function(se){return new Ls(se)},concatenate:function(se){return new sl(se)},maximum:function(se){return new al(se)},minimum:function(se){return new qa(se)},multiply:function(se){return new Xi(se)},dot:function(se){return new Sd(se)},batchNormalization:function(se){return new nm(se)},layerNormalization:function(se){return new Ef(se)},zeroPadding2d:function(se){return new ig(se)},averagePooling1d:bo,avgPool1d:function(se){return bo(se)},avgPooling1d:function(se){return bo(se)},averagePooling2d:Es,avgPool2d:function(se){return Es(se)},avgPooling2d:function(se){return Es(se)},averagePooling3d:Ua,avgPool3d:function(se){return Ua(se)},avgPooling3d:function(se){return Ua(se)},globalAveragePooling1d:function(se){return new kf(se)},globalAveragePooling2d:function(se){return new bn(se)},globalMaxPooling1d:Ss,globalMaxPooling2d:aa,maxPooling1d:fu,maxPooling2d:Ku,maxPooling3d:function(se){return new Vh(se)},gru:function(se){return new Na(se)},gruCell:function(se){return new is(se)},lstm:function(se){return new Xu(se)},lstmCell:function(se){return new io(se)},simpleRNN:function(se){return new mr(se)},simpleRNNCell:function(se){return new Td(se)},rnn:function(se){return new vo(se)},stackedRNNCells:function(se){return new Pc(se)},bidirectional:function(se){return new lu(se)},timeDistributed:function(se){return new oa(se)},globalMaxPool1d:yc,globalMaxPool2d:Bc,maxPool1d:Yu,maxPool2d:Ll,Layer:ro,RNN:vo,RNNCell:Af,input:No,gaussianNoise:function(se){return new Cd(se)},gaussianDropout:function(se){return new Rl(se)},alphaDropout:function(se){return new tm(se)},masking:function(se){return new _f(se)}}),Hh=Object.freeze({binaryAccuracy:function(se,ne){return pd(se,ne)},binaryCrossentropy:function(se,ne){return gd(se,ne)},sparseCategoricalAccuracy:function(se,ne){return vd(se,ne)},categoricalAccuracy:function(se,ne){return md(se,ne)},categoricalCrossentropy:function(se,ne){return Ns(se,ne)},precision:function(se,ne){return Oh(se,ne)},recall:function(se,ne){return Vp(se,ne)},cosineProximity:function(se,ne){return Ic(se,ne)},meanAbsoluteError:function(se,ne){return Dc(se,ne)},meanAbsolutePercentageError:function(se,ne){return ws(se,ne)},MAPE:function(se,ne){return ws(se,ne)},mape:function(se,ne){return ws(se,ne)},meanSquaredError:function(se,ne){return ba(se,ne)},MSE:function(se,ne){return ba(se,ne)},mse:function(se,ne){return ba(se,ne)}}),jl=Object.freeze({modelFromJSON:function(se,ne){return B(this,void 0,void 0,function(){var N,G,ce,je,Qe,bt,qt,un;return D(this,function(ht){switch(ht.label){case 0:return"modelTopology"in se||(se={modelTopology:se}),(N=(se=se).modelTopology).model_config!=null&&(N=N.model_config),G=qi(N),ce=Ha(G,ne),se.weightsManifest==null?[3,2]:[4,c.io.loadWeights(se.weightsManifest,se.pathPrefix,ce.weights.map(function(In){return In.originalName}))];case 1:for(je=ht.sent(),Qe={},bt=0,qt=ce.weights;bt<qt.length;bt++)un=qt[bt],Qe[un.originalName]=je[un.originalName];ce.loadWeights(Qe),Object(c.dispose)(je),ht.label=2;case 2:return[2,ce]}})})}}),du=Object.freeze({l1l2:function(se){return new gf(se)},l1:function(se){return function(ne){return Rh(ne),new gf({l1:ne!=null?ne.l1:null,l2:0})}(se)},l2:function(se){return function(ne){return Rh(ne),new gf({l2:ne!=null?ne.l2:null,l1:0})}(se)}}),Ju=function(se){function ne(){var N=se!==null&&se.apply(this,arguments)||this;return N.model=null,N}return E(ne,se),ne.prototype.setModel=function(N){if(!(N instanceof rl))throw new Error("model must be a LayersModel, not some other Container");this.model=N},ne}(xs);function Qu(se,ne){return se<ne}function Cu(se,ne){return se>ne}var Gh=function(se){function ne(N){var G=se.call(this)||this;if(N==null&&(N={}),N.restoreBestWeights)throw new I("restoreBestWeights = True is not implemented in EarlyStopping yet.");return G.monitor=N.monitor||"val_loss",G.minDelta=Math.abs(N.minDelta||0),G.patience=N.patience||0,G.verbose=N.verbose||0,G.mode=N.mode||"auto",G.baseline=N.baseline,["auto","min","max"].indexOf(G.mode)===-1&&(console.warn("EarlyStopping mode '"+G.mode+"' is invalid. Falling back to mode 'auto'."),G.mode="auto"),G.mode==="min"?G.monitorFunc=Qu:G.mode==="max"||G.monitor.indexOf("acc")!==-1?G.monitorFunc=Cu:G.monitorFunc=Qu,G.monitorFunc===Qu&&(G.minDelta*=-1),G}return E(ne,se),ne.prototype.onTrainBegin=function(N){return B(this,void 0,void 0,function(){return D(this,function(G){return this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===Qu?1/0:-1/0,[2]})})},ne.prototype.onEpochEnd=function(N,G){return B(this,void 0,void 0,function(){var ce;return D(this,function(je){switch(je.label){case 0:return[4,fc(G)];case 1:return je.sent(),(ce=this.getMonitorValue(G))==null?[2]:(this.monitorFunc(ce-this.minDelta,this.best)?(this.best=ce,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=N,this.model.stopTraining=!0)),[2])}})})},ne.prototype.onTrainEnd=function(N){return B(this,void 0,void 0,function(){return D(this,function(G){return this.stoppedEpoch>0&&this.verbose&&console.log("Epoch "+this.stoppedEpoch+": early stopping."),[2]})})},ne.prototype.getMonitorValue=function(N){N==null&&(N={});var G=N[this.monitor];return G==null&&console.warn("Metric for EarlyStopping "+this.monitor+" is not available. Available metrics are: "+Object.keys(N)),G},ne}(Ju),Md={earlyStopping:function(se){return new Gh(se)}},Dd=r(20),Of=r(130);r.d(a,"version",function(){return Nd}),r.d(a,"AdadeltaOptimizer",function(){return c.AdadeltaOptimizer}),r.d(a,"AdagradOptimizer",function(){return c.AdagradOptimizer}),r.d(a,"AdamOptimizer",function(){return c.AdamOptimizer}),r.d(a,"AdamaxOptimizer",function(){return c.AdamaxOptimizer}),r.d(a,"Add",function(){return c.Add}),r.d(a,"AddN",function(){return c.AddN}),r.d(a,"BroadcastTo",function(){return c.BroadcastTo}),r.d(a,"DataStorage",function(){return c.DataStorage}),r.d(a,"Div",function(){return c.Div}),r.d(a,"ENV",function(){return c.ENV}),r.d(a,"Environment",function(){return c.Environment}),r.d(a,"FromPixels",function(){return c.FromPixels}),r.d(a,"FusedBatchNorm",function(){return c.FusedBatchNorm}),r.d(a,"Identity",function(){return c.Identity}),r.d(a,"KernelBackend",function(){return c.KernelBackend}),r.d(a,"MaxPoolWithArgmax",function(){return c.MaxPoolWithArgmax}),r.d(a,"MomentumOptimizer",function(){return c.MomentumOptimizer}),r.d(a,"NonMaxSuppressionV5",function(){return c.NonMaxSuppressionV5}),r.d(a,"OneHot",function(){return c.OneHot}),r.d(a,"Optimizer",function(){return c.Optimizer}),r.d(a,"PadV2",function(){return c.PadV2}),r.d(a,"RMSPropOptimizer",function(){return c.RMSPropOptimizer}),r.d(a,"Rank",function(){return c.Rank}),r.d(a,"Reduction",function(){return c.Reduction}),r.d(a,"SGDOptimizer",function(){return c.SGDOptimizer}),r.d(a,"Square",function(){return c.Square}),r.d(a,"SquaredDifference",function(){return c.SquaredDifference}),r.d(a,"Tensor",function(){return c.Tensor}),r.d(a,"TensorBuffer",function(){return c.TensorBuffer}),r.d(a,"Tile",function(){return c.Tile}),r.d(a,"Transpose",function(){return c.Transpose}),r.d(a,"Variable",function(){return c.Variable}),r.d(a,"abs",function(){return c.abs}),r.d(a,"acos",function(){return c.acos}),r.d(a,"acosh",function(){return c.acosh}),r.d(a,"add",function(){return c.add}),r.d(a,"addN",function(){return c.addN}),r.d(a,"addStrict",function(){return c.addStrict}),r.d(a,"all",function(){return c.all}),r.d(a,"any",function(){return c.any}),r.d(a,"argMax",function(){return c.argMax}),r.d(a,"argMin",function(){return c.argMin}),r.d(a,"asin",function(){return c.asin}),r.d(a,"asinh",function(){return c.asinh}),r.d(a,"atan",function(){return c.atan}),r.d(a,"atan2",function(){return c.atan2}),r.d(a,"atanh",function(){return c.atanh}),r.d(a,"avgPool",function(){return c.avgPool}),r.d(a,"avgPool3d",function(){return c.avgPool3d}),r.d(a,"backend",function(){return c.backend}),r.d(a,"backend_util",function(){return c.backend_util}),r.d(a,"basicLSTMCell",function(){return c.basicLSTMCell}),r.d(a,"batchNorm",function(){return c.batchNorm}),r.d(a,"batchNorm2d",function(){return c.batchNorm2d}),r.d(a,"batchNorm3d",function(){return c.batchNorm3d}),r.d(a,"batchNorm4d",function(){return c.batchNorm4d}),r.d(a,"batchNormalization",function(){return c.batchNormalization}),r.d(a,"batchNormalization2d",function(){return c.batchNormalization2d}),r.d(a,"batchNormalization3d",function(){return c.batchNormalization3d}),r.d(a,"batchNormalization4d",function(){return c.batchNormalization4d}),r.d(a,"batchToSpaceND",function(){return c.batchToSpaceND}),r.d(a,"booleanMaskAsync",function(){return c.booleanMaskAsync}),r.d(a,"broadcastTo",function(){return c.broadcastTo}),r.d(a,"browser",function(){return c.browser}),r.d(a,"buffer",function(){return c.buffer}),r.d(a,"cast",function(){return c.cast}),r.d(a,"ceil",function(){return c.ceil}),r.d(a,"clipByValue",function(){return c.clipByValue}),r.d(a,"clone",function(){return c.clone}),r.d(a,"complex",function(){return c.complex}),r.d(a,"concat",function(){return c.concat}),r.d(a,"concat1d",function(){return c.concat1d}),r.d(a,"concat2d",function(){return c.concat2d}),r.d(a,"concat3d",function(){return c.concat3d}),r.d(a,"concat4d",function(){return c.concat4d}),r.d(a,"conv1d",function(){return c.conv1d}),r.d(a,"conv2d",function(){return c.conv2d}),r.d(a,"conv2dTranspose",function(){return c.conv2dTranspose}),r.d(a,"conv3d",function(){return c.conv3d}),r.d(a,"conv3dTranspose",function(){return c.conv3dTranspose}),r.d(a,"cos",function(){return c.cos}),r.d(a,"cosh",function(){return c.cosh}),r.d(a,"cumsum",function(){return c.cumsum}),r.d(a,"customGrad",function(){return c.customGrad}),r.d(a,"deprecationWarn",function(){return c.deprecationWarn}),r.d(a,"depthToSpace",function(){return c.depthToSpace}),r.d(a,"depthwiseConv2d",function(){return c.depthwiseConv2d}),r.d(a,"diag",function(){return c.diag}),r.d(a,"disableDeprecationWarnings",function(){return c.disableDeprecationWarnings}),r.d(a,"dispose",function(){return c.dispose}),r.d(a,"disposeVariables",function(){return c.disposeVariables}),r.d(a,"div",function(){return c.div}),r.d(a,"divNoNan",function(){return c.divNoNan}),r.d(a,"divStrict",function(){return c.divStrict}),r.d(a,"dot",function(){return c.dot}),r.d(a,"dropout",function(){return c.dropout}),r.d(a,"elu",function(){return c.elu}),r.d(a,"enableDebugMode",function(){return c.enableDebugMode}),r.d(a,"enableProdMode",function(){return c.enableProdMode}),r.d(a,"engine",function(){return c.engine}),r.d(a,"env",function(){return c.env}),r.d(a,"equal",function(){return c.equal}),r.d(a,"equalStrict",function(){return c.equalStrict}),r.d(a,"erf",function(){return c.erf}),r.d(a,"exp",function(){return c.exp}),r.d(a,"expandDims",function(){return c.expandDims}),r.d(a,"expm1",function(){return c.expm1}),r.d(a,"eye",function(){return c.eye}),r.d(a,"fft",function(){return c.fft}),r.d(a,"fill",function(){return c.fill}),r.d(a,"findBackend",function(){return c.findBackend}),r.d(a,"findBackendFactory",function(){return c.findBackendFactory}),r.d(a,"floor",function(){return c.floor}),r.d(a,"floorDiv",function(){return c.floorDiv}),r.d(a,"frame",function(){return c.frame}),r.d(a,"fused",function(){return c.fused}),r.d(a,"gather",function(){return c.gather}),r.d(a,"gatherND",function(){return c.gatherND}),r.d(a,"gather_util",function(){return c.gather_util}),r.d(a,"getBackend",function(){return c.getBackend}),r.d(a,"getGradient",function(){return c.getGradient}),r.d(a,"getKernel",function(){return c.getKernel}),r.d(a,"getKernelsForBackend",function(){return c.getKernelsForBackend}),r.d(a,"grad",function(){return c.grad}),r.d(a,"grads",function(){return c.grads}),r.d(a,"greater",function(){return c.greater}),r.d(a,"greaterEqual",function(){return c.greaterEqual}),r.d(a,"greaterEqualStrict",function(){return c.greaterEqualStrict}),r.d(a,"greaterStrict",function(){return c.greaterStrict}),r.d(a,"hammingWindow",function(){return c.hammingWindow}),r.d(a,"hannWindow",function(){return c.hannWindow}),r.d(a,"ifft",function(){return c.ifft}),r.d(a,"imag",function(){return c.imag}),r.d(a,"image",function(){return c.image}),r.d(a,"inTopKAsync",function(){return c.inTopKAsync}),r.d(a,"io",function(){return c.io}),r.d(a,"irfft",function(){return c.irfft}),r.d(a,"isFinite",function(){return c.isFinite}),r.d(a,"isInf",function(){return c.isInf}),r.d(a,"isNaN",function(){return c.isNaN}),r.d(a,"keep",function(){return c.keep}),r.d(a,"leakyRelu",function(){return c.leakyRelu}),r.d(a,"less",function(){return c.less}),r.d(a,"lessEqual",function(){return c.lessEqual}),r.d(a,"lessEqualStrict",function(){return c.lessEqualStrict}),r.d(a,"lessStrict",function(){return c.lessStrict}),r.d(a,"linalg",function(){return c.linalg}),r.d(a,"linspace",function(){return c.linspace}),r.d(a,"localResponseNormalization",function(){return c.localResponseNormalization}),r.d(a,"log",function(){return c.log}),r.d(a,"log1p",function(){return c.log1p}),r.d(a,"logSigmoid",function(){return c.logSigmoid}),r.d(a,"logSoftmax",function(){return c.logSoftmax}),r.d(a,"logSumExp",function(){return c.logSumExp}),r.d(a,"logicalAnd",function(){return c.logicalAnd}),r.d(a,"logicalNot",function(){return c.logicalNot}),r.d(a,"logicalOr",function(){return c.logicalOr}),r.d(a,"logicalXor",function(){return c.logicalXor}),r.d(a,"losses",function(){return c.losses}),r.d(a,"matMul",function(){return c.matMul}),r.d(a,"math",function(){return c.math}),r.d(a,"max",function(){return c.max}),r.d(a,"maxPool",function(){return c.maxPool}),r.d(a,"maxPool3d",function(){return c.maxPool3d}),r.d(a,"maxPoolWithArgmax",function(){return c.maxPoolWithArgmax}),r.d(a,"maximum",function(){return c.maximum}),r.d(a,"maximumStrict",function(){return c.maximumStrict}),r.d(a,"mean",function(){return c.mean}),r.d(a,"memory",function(){return c.memory}),r.d(a,"min",function(){return c.min}),r.d(a,"minimum",function(){return c.minimum}),r.d(a,"minimumStrict",function(){return c.minimumStrict}),r.d(a,"mod",function(){return c.mod}),r.d(a,"modStrict",function(){return c.modStrict}),r.d(a,"moments",function(){return c.moments}),r.d(a,"movingAverage",function(){return c.movingAverage}),r.d(a,"mul",function(){return c.mul}),r.d(a,"mulStrict",function(){return c.mulStrict}),r.d(a,"multiRNNCell",function(){return c.multiRNNCell}),r.d(a,"multinomial",function(){return c.multinomial}),r.d(a,"neg",function(){return c.neg}),r.d(a,"nextFrame",function(){return c.nextFrame}),r.d(a,"norm",function(){return c.norm}),r.d(a,"notEqual",function(){return c.notEqual}),r.d(a,"notEqualStrict",function(){return c.notEqualStrict}),r.d(a,"oneHot",function(){return c.oneHot}),r.d(a,"ones",function(){return c.ones}),r.d(a,"onesLike",function(){return c.onesLike}),r.d(a,"op",function(){return c.op}),r.d(a,"outerProduct",function(){return c.outerProduct}),r.d(a,"pad",function(){return c.pad}),r.d(a,"pad1d",function(){return c.pad1d}),r.d(a,"pad2d",function(){return c.pad2d}),r.d(a,"pad3d",function(){return c.pad3d}),r.d(a,"pad4d",function(){return c.pad4d}),r.d(a,"pool",function(){return c.pool}),r.d(a,"pow",function(){return c.pow}),r.d(a,"powStrict",function(){return c.powStrict}),r.d(a,"prelu",function(){return c.prelu}),r.d(a,"print",function(){return c.print}),r.d(a,"prod",function(){return c.prod}),r.d(a,"profile",function(){return c.profile}),r.d(a,"rand",function(){return c.rand}),r.d(a,"randomGamma",function(){return c.randomGamma}),r.d(a,"randomNormal",function(){return c.randomNormal}),r.d(a,"randomUniform",function(){return c.randomUniform}),r.d(a,"range",function(){return c.range}),r.d(a,"ready",function(){return c.ready}),r.d(a,"real",function(){return c.real}),r.d(a,"reciprocal",function(){return c.reciprocal}),r.d(a,"registerBackend",function(){return c.registerBackend}),r.d(a,"registerGradient",function(){return c.registerGradient}),r.d(a,"registerKernel",function(){return c.registerKernel}),r.d(a,"relu",function(){return c.relu}),r.d(a,"relu6",function(){return c.relu6}),r.d(a,"removeBackend",function(){return c.removeBackend}),r.d(a,"reshape",function(){return c.reshape}),r.d(a,"reverse",function(){return c.reverse}),r.d(a,"reverse1d",function(){return c.reverse1d}),r.d(a,"reverse2d",function(){return c.reverse2d}),r.d(a,"reverse3d",function(){return c.reverse3d}),r.d(a,"reverse4d",function(){return c.reverse4d}),r.d(a,"rfft",function(){return c.rfft}),r.d(a,"round",function(){return c.round}),r.d(a,"rsqrt",function(){return c.rsqrt}),r.d(a,"scalar",function(){return c.scalar}),r.d(a,"scatterND",function(){return c.scatterND}),r.d(a,"scatter_util",function(){return c.scatter_util}),r.d(a,"selu",function(){return c.selu}),r.d(a,"separableConv2d",function(){return c.separableConv2d}),r.d(a,"serialization",function(){return c.serialization}),r.d(a,"setBackend",function(){return c.setBackend}),r.d(a,"setPlatform",function(){return c.setPlatform}),r.d(a,"setdiff1dAsync",function(){return c.setdiff1dAsync}),r.d(a,"sigmoid",function(){return c.sigmoid}),r.d(a,"sign",function(){return c.sign}),r.d(a,"signal",function(){return c.signal}),r.d(a,"sin",function(){return c.sin}),r.d(a,"sinh",function(){return c.sinh}),r.d(a,"slice",function(){return c.slice}),r.d(a,"slice1d",function(){return c.slice1d}),r.d(a,"slice2d",function(){return c.slice2d}),r.d(a,"slice3d",function(){return c.slice3d}),r.d(a,"slice4d",function(){return c.slice4d}),r.d(a,"slice_util",function(){return c.slice_util}),r.d(a,"softmax",function(){return c.softmax}),r.d(a,"softplus",function(){return c.softplus}),r.d(a,"spaceToBatchND",function(){return c.spaceToBatchND}),r.d(a,"sparseToDense",function(){return c.sparseToDense}),r.d(a,"spectral",function(){return c.spectral}),r.d(a,"split",function(){return c.split}),r.d(a,"sqrt",function(){return c.sqrt}),r.d(a,"square",function(){return c.square}),r.d(a,"squaredDifference",function(){return c.squaredDifference}),r.d(a,"squaredDifferenceStrict",function(){return c.squaredDifferenceStrict}),r.d(a,"squeeze",function(){return c.squeeze}),r.d(a,"stack",function(){return c.stack}),r.d(a,"step",function(){return c.step}),r.d(a,"stft",function(){return c.stft}),r.d(a,"stridedSlice",function(){return c.stridedSlice}),r.d(a,"sub",function(){return c.sub}),r.d(a,"subStrict",function(){return c.subStrict}),r.d(a,"sum",function(){return c.sum}),r.d(a,"sumOutType",function(){return c.sumOutType}),r.d(a,"tan",function(){return c.tan}),r.d(a,"tanh",function(){return c.tanh}),r.d(a,"tensor",function(){return c.tensor}),r.d(a,"tensor1d",function(){return c.tensor1d}),r.d(a,"tensor2d",function(){return c.tensor2d}),r.d(a,"tensor3d",function(){return c.tensor3d}),r.d(a,"tensor4d",function(){return c.tensor4d}),r.d(a,"tensor5d",function(){return c.tensor5d}),r.d(a,"tensor6d",function(){return c.tensor6d}),r.d(a,"tensor_util",function(){return c.tensor_util}),r.d(a,"test_util",function(){return c.test_util}),r.d(a,"tidy",function(){return c.tidy}),r.d(a,"tile",function(){return c.tile}),r.d(a,"time",function(){return c.time}),r.d(a,"topk",function(){return c.topk}),r.d(a,"train",function(){return c.train}),r.d(a,"transpose",function(){return c.transpose}),r.d(a,"truncatedNormal",function(){return c.truncatedNormal}),r.d(a,"unregisterGradient",function(){return c.unregisterGradient}),r.d(a,"unregisterKernel",function(){return c.unregisterKernel}),r.d(a,"unsortedSegmentSum",function(){return c.unsortedSegmentSum}),r.d(a,"unstack",function(){return c.unstack}),r.d(a,"util",function(){return c.util}),r.d(a,"valueAndGrad",function(){return c.valueAndGrad}),r.d(a,"valueAndGrads",function(){return c.valueAndGrads}),r.d(a,"variable",function(){return c.variable}),r.d(a,"variableGrads",function(){return c.variableGrads}),r.d(a,"version_core",function(){return c.version_core}),r.d(a,"webgl",function(){return c.webgl}),r.d(a,"where",function(){return c.where}),r.d(a,"whereAsync",function(){return c.whereAsync}),r.d(a,"zeros",function(){return c.zeros}),r.d(a,"zerosLike",function(){return c.zerosLike}),r.d(a,"constraints",function(){return an}),r.d(a,"initializers",function(){return Cr}),r.d(a,"layers",function(){return Bl}),r.d(a,"metrics",function(){return Hh}),r.d(a,"models",function(){return jl}),r.d(a,"regularizers",function(){return du}),r.d(a,"CallbackList",function(){return dd}),r.d(a,"CustomCallback",function(){return hd}),r.d(a,"History",function(){return dc}),r.d(a,"Callback",function(){return Ju}),r.d(a,"callbacks",function(){return Md}),r.d(a,"EarlyStopping",function(){return Gh}),r.d(a,"InputSpec",function(){return no}),r.d(a,"SymbolicTensor",function(){return So}),r.d(a,"LayersModel",function(){return rl}),r.d(a,"input",function(){return No}),r.d(a,"loadLayersModel",function(){return Za}),r.d(a,"model",function(){return Co}),r.d(a,"registerCallbackConstructor",function(){return Fs}),r.d(a,"sequential",function(){return xa}),r.d(a,"RNN",function(){return vo}),r.d(a,"Sequential",function(){return Lt}),r.d(a,"LayerVariable",function(){return Wr}),r.d(a,"version_layers",function(){return"1.7.4"}),r.d(a,"GraphModel",function(){return Dd.GraphModel}),r.d(a,"loadGraphModel",function(){return Dd.loadGraphModel}),r.d(a,"deregisterOp",function(){return Dd.deregisterOp}),r.d(a,"registerOp",function(){return Dd.registerOp}),r.d(a,"version_converter",function(){return Dd.version_converter}),r.d(a,"data",function(){return Of});var Nd={"tfjs-core":c.version_core,"tfjs-data":Of.version_data,"tfjs-layers":"1.7.4","tfjs-converter":Dd.version_converter,tfjs:"1.7.4"}},function(s,a,r){r.r(a),function(c,S,E,A){r.d(a,"AdadeltaOptimizer",function(){return G1}),r.d(a,"AdagradOptimizer",function(){return q1}),r.d(a,"AdamOptimizer",function(){return $1}),r.d(a,"AdamaxOptimizer",function(){return Xv}),r.d(a,"DataStorage",function(){return Af}),r.d(a,"ENV",function(){return H}),r.d(a,"Environment",function(){return W}),r.d(a,"KernelBackend",function(){return Td}),r.d(a,"MomentumOptimizer",function(){return Kv}),r.d(a,"Optimizer",function(){return hp}),r.d(a,"RMSPropOptimizer",function(){return Hy}),r.d(a,"Rank",function(){return Se}),r.d(a,"Reduction",function(){return gs}),r.d(a,"SGDOptimizer",function(){return Vy}),r.d(a,"Tensor",function(){return Qt}),r.d(a,"TensorBuffer",function(){return qr}),r.d(a,"Variable",function(){return Ct}),r.d(a,"abs",function(){return ll}),r.d(a,"acos",function(){return s0}),r.d(a,"acosh",function(){return u0}),r.d(a,"add",function(){return Jh}),r.d(a,"addN",function(){return Ry}),r.d(a,"addStrict",function(){return Py}),r.d(a,"all",function(){return x0}),r.d(a,"any",function(){return Vc}),r.d(a,"argMax",function(){return w0}),r.d(a,"argMin",function(){return Pv}),r.d(a,"asin",function(){return ec}),r.d(a,"asinh",function(){return c0}),r.d(a,"atan",function(){return $h}),r.d(a,"atan2",function(){return ug}),r.d(a,"atanh",function(){return lm}),r.d(a,"avgPool",function(){return Iv}),r.d(a,"avgPool3d",function(){return Fv}),r.d(a,"backend",function(){return Jg}),r.d(a,"backend_util",function(){return Bc}),r.d(a,"basicLSTMCell",function(){return zv}),r.d(a,"batchNorm",function(){return Fy}),r.d(a,"batchNorm2d",function(){return If}),r.d(a,"batchNorm3d",function(){return Yh}),r.d(a,"batchNorm4d",function(){return Ld}),r.d(a,"batchNormalization",function(){return W1}),r.d(a,"batchNormalization2d",function(){return Ev}),r.d(a,"batchNormalization3d",function(){return pm}),r.d(a,"batchNormalization4d",function(){return f0}),r.d(a,"batchToSpaceND",function(){return Il}),r.d(a,"booleanMaskAsync",function(){return hg}),r.d(a,"broadcastTo",function(){return vf}),r.d(a,"browser",function(){return _c}),r.d(a,"buffer",function(){return Hi}),r.d(a,"cast",function(){return em}),r.d(a,"ceil",function(){return Iy}),r.d(a,"clipByValue",function(){return fm}),r.d(a,"clone",function(){return rg}),r.d(a,"complex",function(){return Co}),r.d(a,"concat",function(){return $o}),r.d(a,"concat1d",function(){return Rh}),r.d(a,"concat2d",function(){return Yp}),r.d(a,"concat3d",function(){return gf}),r.d(a,"concat4d",function(){return Ph}),r.d(a,"conv1d",function(){return mg}),r.d(a,"conv2d",function(){return tp}),r.d(a,"conv2dTranspose",function(){return $l}),r.d(a,"conv3d",function(){return gg}),r.d(a,"conv3dTranspose",function(){return Ly}),r.d(a,"cos",function(){return fl}),r.d(a,"cosh",function(){return dm}),r.d(a,"cumsum",function(){return yf}),r.d(a,"customGrad",function(){return uu}),r.d(a,"deprecationWarn",function(){return bd}),r.d(a,"depthToSpace",function(){return Bh}),r.d(a,"depthwiseConv2d",function(){return bm}),r.d(a,"diag",function(){return Sm}),r.d(a,"disableDeprecationWarnings",function(){return Zm}),r.d(a,"dispose",function(){return zo}),r.d(a,"disposeVariables",function(){return mf}),r.d(a,"div",function(){return Rf}),r.d(a,"divNoNan",function(){return Gl}),r.d(a,"divStrict",function(){return mm}),r.d(a,"dot",function(){return xm}),r.d(a,"dropout",function(){return Kd}),r.d(a,"elu",function(){return Hc}),r.d(a,"enableDebugMode",function(){return Qm}),r.d(a,"enableProdMode",function(){return qu}),r.d(a,"engine",function(){return Hp}),r.d(a,"env",function(){return j}),r.d(a,"equal",function(){return Uc}),r.d(a,"equalStrict",function(){return ic}),r.d(a,"erf",function(){return mv}),r.d(a,"exp",function(){return gv}),r.d(a,"expandDims",function(){return Xo}),r.d(a,"expm1",function(){return l0}),r.d(a,"eye",function(){return jh}),r.d(a,"fft",function(){return _g}),r.d(a,"fill",function(){return Rs}),r.d(a,"findBackend",function(){return qp}),r.d(a,"findBackendFactory",function(){return eg}),r.d(a,"floor",function(){return j1}),r.d(a,"floorDiv",function(){return Qh}),r.d(a,"frame",function(){return km}),r.d(a,"fused",function(){return O0}),r.d(a,"gather",function(){return fg}),r.d(a,"gatherND",function(){return Jl}),r.d(a,"gather_util",function(){return e0}),r.d(a,"getBackend",function(){return Is}),r.d(a,"getGradient",function(){return q}),r.d(a,"getKernel",function(){return Y}),r.d(a,"getKernelsForBackend",function(){return ae}),r.d(a,"grad",function(){return Od}),r.d(a,"grads",function(){return kf}),r.d(a,"greater",function(){return Ru}),r.d(a,"greaterEqual",function(){return ep}),r.d(a,"greaterEqualStrict",function(){return lg}),r.d(a,"greaterStrict",function(){return h0}),r.d(a,"hammingWindow",function(){return S0}),r.d(a,"hannWindow",function(){return Cg}),r.d(a,"ifft",function(){return Eg}),r.d(a,"imag",function(){return Za}),r.d(a,"image",function(){return A0}),r.d(a,"inTopKAsync",function(){return Vv}),r.d(a,"io",function(){return lp}),r.d(a,"irfft",function(){return pl}),r.d(a,"isFinite",function(){return Xh}),r.d(a,"isInf",function(){return wv}),r.d(a,"isNaN",function(){return xv}),r.d(a,"keep",function(){return Dh}),r.d(a,"leakyRelu",function(){return ip}),r.d(a,"less",function(){return p0}),r.d(a,"lessEqual",function(){return gm}),r.d(a,"lessEqualStrict",function(){return Vo}),r.d(a,"lessStrict",function(){return vm}),r.d(a,"linalg",function(){return Og}),r.d(a,"linspace",function(){return Fh}),r.d(a,"localResponseNormalization",function(){return jv}),r.d(a,"log",function(){return z1}),r.d(a,"log1p",function(){return xo}),r.d(a,"logSigmoid",function(){return vv}),r.d(a,"logSoftmax",function(){return vo}),r.d(a,"logSumExp",function(){return zf}),r.d(a,"logicalAnd",function(){return Bd}),r.d(a,"logicalNot",function(){return Sv}),r.d(a,"logicalOr",function(){return d0}),r.d(a,"logicalXor",function(){return jd}),r.d(a,"losses",function(){return kg}),r.d(a,"matMul",function(){return Av}),r.d(a,"math",function(){return vl}),r.d(a,"max",function(){return jy}),r.d(a,"maxPool",function(){return Nv}),r.d(a,"maxPool3d",function(){return By}),r.d(a,"maximum",function(){return zd}),r.d(a,"maximumStrict",function(){return Pf}),r.d(a,"mean",function(){return np}),r.d(a,"memory",function(){return Th}),r.d(a,"min",function(){return rp}),r.d(a,"minimum",function(){return Lf}),r.d(a,"minimumStrict",function(){return rc}),r.d(a,"mod",function(){return Zh}),r.d(a,"modStrict",function(){return Ud}),r.d(a,"moments",function(){return Uf}),r.d(a,"movingAverage",function(){return Wf}),r.d(a,"mul",function(){return ql}),r.d(a,"mulStrict",function(){return dl}),r.d(a,"multiRNNCell",function(){return wg}),r.d(a,"multinomial",function(){return bf}),r.d(a,"neg",function(){return yv}),r.d(a,"nextFrame",function(){return Xf}),r.d(a,"norm",function(){return op}),r.d(a,"notEqual",function(){return Wc}),r.d(a,"notEqualStrict",function(){return Hd}),r.d(a,"oneHot",function(){return zh}),r.d(a,"ones",function(){return Fu}),r.d(a,"onesLike",function(){return _s}),r.d(a,"op",function(){return Lt}),r.d(a,"outerProduct",function(){return Ov}),r.d(a,"pad",function(){return xf}),r.d(a,"pad1d",function(){return Fl}),r.d(a,"pad2d",function(){return il}),r.d(a,"pad3d",function(){return Uh}),r.d(a,"pad4d",function(){return Ed}),r.d(a,"pool",function(){return qd}),r.d(a,"pow",function(){return Wd}),r.d(a,"powStrict",function(){return cg}),r.d(a,"prelu",function(){return _m}),r.d(a,"print",function(){return _d}),r.d(a,"prod",function(){return Xd}),r.d(a,"profile",function(){return Mh}),r.d(a,"rand",function(){return wf}),r.d(a,"randomGamma",function(){return Zg}),r.d(a,"randomNormal",function(){return ol}),r.d(a,"randomUniform",function(){return _f}),r.d(a,"range",function(){return Rc}),r.d(a,"ready",function(){return Gp}),r.d(a,"real",function(){return xa}),r.d(a,"reciprocal",function(){return og}),r.d(a,"registerBackend",function(){return tg}),r.d(a,"registerGradient",function(){return ye}),r.d(a,"registerKernel",function(){return oe}),r.d(a,"relu",function(){return xg}),r.d(a,"relu6",function(){return _0}),r.d(a,"removeBackend",function(){return Fc}),r.d(a,"reshape",function(){return ha}),r.d(a,"reverse",function(){return jf}),r.d(a,"reverse1d",function(){return Tv}),r.d(a,"reverse2d",function(){return wm}),r.d(a,"reverse3d",function(){return yg}),r.d(a,"reverse4d",function(){return Mv}),r.d(a,"rfft",function(){return E0}),r.d(a,"round",function(){return bv}),r.d(a,"rsqrt",function(){return hm}),r.d(a,"scalar",function(){return Ar}),r.d(a,"scatterND",function(){return Uv}),r.d(a,"scatter_util",function(){return rm}),r.d(a,"selu",function(){return Bv}),r.d(a,"separableConv2d",function(){return kv}),r.d(a,"serialization",function(){return ef}),r.d(a,"setBackend",function(){return xd}),r.d(a,"setPlatform",function(){return Qg}),r.d(a,"setdiff1dAsync",function(){return sl}),r.d(a,"sigmoid",function(){return Wl}),r.d(a,"sign",function(){return Vl}),r.d(a,"signal",function(){return C0}),r.d(a,"sin",function(){return Pd}),r.d(a,"sinh",function(){return Kh}),r.d(a,"slice",function(){return Xl}),r.d(a,"slice1d",function(){return b0}),r.d(a,"slice2d",function(){return Rv}),r.d(a,"slice3d",function(){return $d}),r.d(a,"slice4d",function(){return Kl}),r.d(a,"slice_util",function(){return im}),r.d(a,"softmax",function(){return js}),r.d(a,"softplus",function(){return U1}),r.d(a,"spaceToBatchND",function(){return za}),r.d(a,"sparseToDense",function(){return Wv}),r.d(a,"spectral",function(){return Sg}),r.d(a,"split",function(){return $i}),r.d(a,"sqrt",function(){return ag}),r.d(a,"square",function(){return a0}),r.d(a,"squaredDifference",function(){return Rd}),r.d(a,"squaredDifferenceStrict",function(){return Vd}),r.d(a,"squeeze",function(){return Ga}),r.d(a,"stack",function(){return Xi}),r.d(a,"step",function(){return Hl}),r.d(a,"stft",function(){return Am}),r.d(a,"stridedSlice",function(){return Em}),r.d(a,"sub",function(){return hl}),r.d(a,"subStrict",function(){return ps}),r.d(a,"sum",function(){return Lv}),r.d(a,"sumOutType",function(){return Rt}),r.d(a,"tan",function(){return tc}),r.d(a,"tanh",function(){return Mf}),r.d(a,"tensor",function(){return No}),r.d(a,"tensor1d",function(){return au}),r.d(a,"tensor2d",function(){return Eu}),r.d(a,"tensor3d",function(){return Dl}),r.d(a,"tensor4d",function(){return su}),r.d(a,"tensor5d",function(){return Ih}),r.d(a,"tensor6d",function(){return Xp}),r.d(a,"tensor_util",function(){return Mt}),r.d(a,"test_util",function(){return ku}),r.d(a,"tidy",function(){return qi}),r.d(a,"tile",function(){return Ls}),r.d(a,"time",function(){return Yg}),r.d(a,"topk",function(){return Yl}),r.d(a,"train",function(){return X1}),r.d(a,"transpose",function(){return ms}),r.d(a,"truncatedNormal",function(){return al}),r.d(a,"unregisterGradient",function(){return pe}),r.d(a,"unregisterKernel",function(){return _e}),r.d(a,"unsortedSegmentSum",function(){return dg}),r.d(a,"unstack",function(){return qa}),r.d(a,"util",function(){return yr}),r.d(a,"valueAndGrad",function(){return om}),r.d(a,"valueAndGrads",function(){return am}),r.d(a,"variable",function(){return Kp}),r.d(a,"variableGrads",function(){return bn}),r.d(a,"version_core",function(){return H1}),r.d(a,"webgl",function(){return nf}),r.d(a,"where",function(){return go}),r.d(a,"whereAsync",function(){return Ff}),r.d(a,"zeros",function(){return uo}),r.d(a,"zerosLike",function(){return vi});var U=function(_,v){return(U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,y){d.__proto__=y}||function(d,y){for(var C in y)y.hasOwnProperty(C)&&(d[C]=y[C])})(_,v)};function B(_,v){function d(){this.constructor=_}U(_,v),_.prototype=v===null?Object.create(v):(d.prototype=v.prototype,new d)}function D(_,v,d,y){return new(d||(d=Promise))(function(C,z){function Z(xe){try{fe(y.next(xe))}catch(Oe){z(Oe)}}function re(xe){try{fe(y.throw(xe))}catch(Oe){z(Oe)}}function fe(xe){xe.done?C(xe.value):new d(function(Oe){Oe(xe.value)}).then(Z,re)}fe((y=y.apply(_,v||[])).next())})}function R(_,v){var d,y,C,z,Z={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return z={next:re(0),throw:re(1),return:re(2)},typeof Symbol=="function"&&(z[Symbol.iterator]=function(){return this}),z;function re(fe){return function(xe){return function(Oe){if(d)throw new TypeError("Generator is already executing.");for(;Z;)try{if(d=1,y&&(C=2&Oe[0]?y.return:Oe[0]?y.throw||((C=y.return)&&C.call(y),0):y.next)&&!(C=C.call(y,Oe[1])).done)return C;switch(y=0,C&&(Oe=[2&Oe[0],C.value]),Oe[0]){case 0:case 1:C=Oe;break;case 4:return Z.label++,{value:Oe[1],done:!1};case 5:Z.label++,y=Oe[1],Oe=[0];continue;case 7:Oe=Z.ops.pop(),Z.trys.pop();continue;default:if(!(C=(C=Z.trys).length>0&&C[C.length-1])&&(Oe[0]===6||Oe[0]===2)){Z=0;continue}if(Oe[0]===3&&(!C||Oe[1]>C[0]&&Oe[1]<C[3])){Z.label=Oe[1];break}if(Oe[0]===6&&Z.label<C[1]){Z.label=C[1],C=Oe;break}if(C&&Z.label<C[2]){Z.label=C[2],Z.ops.push(Oe);break}C[2]&&Z.ops.pop(),Z.trys.pop();continue}Oe=v.call(_,Z)}catch(Re){Oe=[6,Re],y=0}finally{d=C=0}if(5&Oe[0])throw Oe[1];return{value:Oe[0]?Oe[1]:void 0,done:!0}}([fe,xe])}}}var W=function(){function _(v){this.global=v,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return _.prototype.setPlatform=function(v,d){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+d+"."),this.platformName=v,this.platform=d},_.prototype.registerFlag=function(v,d,y){if(this.flagRegistry[v]={evaluationFn:d,setHook:y},this.urlFlags[v]!=null){var C=this.urlFlags[v];console.warn("Setting feature override from URL "+v+": "+C+"."),this.set(v,C)}},_.prototype.get=function(v){return v in this.flags?this.flags[v]:(this.flags[v]=this.evaluateFlag(v),this.flags[v])},_.prototype.getNumber=function(v){return this.get(v)},_.prototype.getBool=function(v){return this.get(v)},_.prototype.getFlags=function(){return this.flags},Object.defineProperty(_.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),_.prototype.set=function(v,d){if(this.flagRegistry[v]==null)throw new Error("Cannot set flag "+v+" as it has not been registered.");this.flags[v]=d,this.flagRegistry[v].setHook!=null&&this.flagRegistry[v].setHook(d)},_.prototype.evaluateFlag=function(v){if(this.flagRegistry[v]==null)throw new Error("Cannot evaluate flag '"+v+"': no evaluation function found.");return this.flagRegistry[v].evaluationFn()},_.prototype.setFlags=function(v){this.flags=Object.assign({},v)},_.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},_.prototype.populateURLFlags=function(){var v=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var d,y,C=(d=this.global.location.search,y={},d.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(z){for(var Z=[],re=1;re<arguments.length;re++)Z[re-1]=arguments[re];return function(fe,xe,Oe){fe[decodeURIComponent(xe)]=decodeURIComponent(Oe||"")}(y,Z[0],Z[1]),Z.join("=")}),y);"tfjsflags"in C&&C.tfjsflags.split(",").forEach(function(z){var Z=z.split(":"),re=Z[0],fe=Z[1];v.urlFlags[re]=function(xe,Oe){if((Oe=Oe.toLowerCase())==="true"||Oe==="false")return Oe==="true";if(""+ +Oe===Oe)return+Oe;throw new Error("Could not parse value flag value "+Oe+" for flag "+xe+".")}(re,fe)})}},_}();function j(){return H}var H=null,I=new Map,Q=new Map;function Y(_,v){var d=me(_,v);return I.get(d)}function q(_){return Q.get(_)}function ae(_){for(var v=I.entries(),d=[];;){var y=v.next(),C=y.done,z=y.value;if(C)break;var Z=z[0],re=z[1];Z.split("_")[0]===_&&d.push(re)}return d}function oe(_){var v=_.kernelName,d=_.backendName,y=me(v,d);if(I.has(y))throw new Error("The kernel '"+v+"' for backend '"+d+"' is already registered");I.set(y,_)}function ye(_){var v=_.kernelName;Q.has(v)&&console.warn("Overriding the gradient for '"+v+"'"),Q.set(v,_)}function _e(_,v){var d=me(_,v);if(!I.has(d))throw new Error("The kernel '"+_+"' for backend '"+v+"' is not registered");I.delete(d)}function pe(_){if(!Q.has(_))throw new Error("The gradient '"+_+"' for backend is not registered");Q.delete(_)}function me(_,v){return v+"_"+_}function Ge(_){for(var v=_.length,d=0,y=0;v>0;)y=Math.random()*v|0,d=_[--v],_[v]=_[y],_[y]=d}function lt(_,v,d){return Math.max(_,Math.min(v,d))}function It(_){return _%2==0?_:_+1}function wt(_){for(var v=0,d=0;d<_.length;d++)v+=_[d];return v}function we(_,v){if(!_)throw new Error(typeof v=="string"?v:v())}function yt(_,v,d){d===void 0&&(d=""),we(Ut(_,v),function(){return d+" Shapes "+_+" and "+v+" must match"})}function Bt(_){we(_!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Ot(_,v,d){if(v===void 0&&(v=[]),d===void 0&&(d=!1),v==null&&(v=[]),Array.isArray(_)||ft(_)&&!d)for(var y=0;y<_.length;++y)Ot(_[y],v,d);else v.push(_);return v}function ze(_){if(_.length===0)return 1;for(var v=_[0],d=1;d<_.length;d++)v*=_[d];return v}function Ut(_,v){if(_===v)return!0;if(_==null||v==null||_.length!==v.length)return!1;for(var d=0;d<_.length;d++)if(_[d]!==v[d])return!1;return!0}function Ft(_){return _%1==0}function pt(_){if(Math.tanh!=null)return Math.tanh(_);if(_===1/0)return 1;if(_===-1/0)return-1;var v=Math.exp(2*_);return(v-1)/(v+1)}function vt(_){var v=Math.ceil(Math.sqrt(_));return[v,Math.ceil(_/v)]}function rn(_,v){return v<=_.length?_:_+" ".repeat(v-_.length)}function xt(_,v,d){return v===void 0&&(v=function(y){return 0}),new Promise(function(y,C){var z=0,Z=function(){if(_())y();else{var re=v(++z);d!=null&&z>=d?C():setTimeout(Z,re)}};Z()})}function _t(_,v){for(var d=1,y=-1,C=0;C<_.length;++C)if(_[C]>=0)d*=_[C];else if(_[C]===-1){if(y!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+y+" and dim "+C);y=C}else if(_[C]<0)throw Error("Shapes can not be < 0. Found "+_[C]+" at dim "+C);if(y===-1){if(v>0&&v!==d)throw Error("Size("+v+") must match the product of shape "+_);return _}if(d===0)throw Error("Cannot infer the missing size in ["+_+"] when there are 0 elements");if(v%d!=0)throw Error("The implicit shape can't be a fractional number. Got "+v+" / "+d);var z=_.slice();return z[y]=v/d,z}function Xt(_,v){var d=v.length;return we((_=_==null?v.map(function(y,C){return C}):[].concat(_)).every(function(y){return y>=-d&&y<d}),function(){return"All values in axis param must be in range [-"+d+", "+d+") but got axis "+_}),we(_.every(function(y){return Ft(y)}),function(){return"All values in axis param must be integers but got axis "+_}),_.map(function(y){return y<0?d+y:y})}function sn(_,v){for(var d=[],y=[],C=v!=null&&Array.isArray(v)&&v.length===0,z=v==null||C?null:Xt(v,_).sort(),Z=0,re=0;re<_.length;++re){if(z!=null){if(z[Z]===re&&_[re]!==1)throw new Error("Can't squeeze axis "+re+" since its dim '"+_[re]+"' is not 1");(z[Z]==null||z[Z]>re)&&_[re]===1&&(d.push(_[re]),y.push(re)),z[Z]<=re&&Z++}_[re]!==1&&(d.push(_[re]),y.push(re))}return{newShape:d,keptDims:y}}function kn(_,v){var d=null;if(_==null||_==="float32")d=new Float32Array(v);else if(_==="int32")d=new Int32Array(v);else{if(_!=="bool")throw new Error("Unknown data type "+_);d=new Uint8Array(v)}return d}function an(_,v){var d=null;if(_==null||_==="float32")d=new Float32Array(v);else if(_==="int32")d=new Int32Array(v);else if(_==="bool")d=new Uint8Array(v);else{if(_!=="string")throw new Error("Unknown data type "+_);d=new Array(v)}return d}function Ve(_,v){for(var d=0;d<_.length;d++){var y=_[d];if(isNaN(y)||!isFinite(y))throw Error("A tensor of type "+v+" being uploaded contains "+y+".")}}function Ye(_){return _==="bool"||_==="complex64"||_==="float32"||_==="int32"||_==="string"}function $e(_,v){return!(v==="complex64"||v==="float32"&&_!=="complex64"||v==="int32"&&_!=="float32"&&_!=="complex64"||v==="bool"&&_==="bool")}function ft(_){return _ instanceof Float32Array||_ instanceof Int32Array||_ instanceof Uint8Array}function $t(_){if(_==="float32"||_==="int32")return 4;if(_==="complex64")return 8;if(_==="bool")return 1;throw new Error("Unknown dtype "+_)}function Jt(_){if(_==null)return 0;var v=0;return _.forEach(function(d){return v+=d.length}),v}function Pn(_){return typeof _=="string"||_ instanceof String}function An(_){return typeof _=="boolean"}function Qn(_){return typeof _=="number"}function Ce(_){return Array.isArray(_)?Ce(_[0]):_ instanceof Float32Array?"float32":_ instanceof Int32Array||_ instanceof Uint8Array?"int32":Qn(_)?"float32":Pn(_)?"string":An(_)?"bool":"float32"}function sr(_){return!!(_&&_.constructor&&_.call&&_.apply)}function Mr(_,v){for(var d=v;d<_;++d)if(_%d==0)return d;return _}function on(_){var v=_.length;if(v<2)return[];var d=new Array(v-1);d[v-2]=_[v-1];for(var y=v-3;y>=0;--y)d[y]=d[y+1]*_[y+1];return d}function Gt(_,v,d){if(v==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(_)&&(_=Ot(_)),d&&Ve(_,v),function(z,Z){return z instanceof Float32Array&&Z==="float32"||z instanceof Int32Array&&Z==="int32"||z instanceof Uint8Array&&Z==="bool"}(_,v))return _;if(v==null||v==="float32"||v==="complex64")return new Float32Array(_);if(v==="int32")return new Int32Array(_);if(v==="bool"){for(var y=new Uint8Array(_.length),C=0;C<y.length;++C)Math.round(_[C])!==0&&(y[C]=1);return y}throw new Error("Unknown data type "+v)}function Hn(_,v){if(_.length===0)return v[0];var d=_.reduce(function(y,C){return y*C});if(d===0)return[];if(d!==v.length)throw new Error("["+_+"] does not match the input size.");return function y(C,z,Z){var re=new Array;if(z.length===1)for(var fe=z[0],xe=0;xe<fe;xe++)re[xe]=Z[C+xe];else{fe=z[0];var Oe=z.slice(1),Re=Oe.reduce(function(Le,Be){return Le*Be});for(xe=0;xe<fe;xe++)re[xe]=y(C+xe*Re,Oe,Z)}return re}(0,_,v)}function Kt(_,v){for(var d=Vt(_,v),y=0;y<d.length;y++)d[y]=1;return d}function Vt(_,v){if(v==null||v==="float32"||v==="complex64")return new Float32Array(_);if(v==="int32")return new Int32Array(_);if(v==="bool")return new Uint8Array(_);throw new Error("Unknown data type "+v)}function en(){return j().platform.now()}function Vn(_){_.forEach(function(v){we(Number.isInteger(v)&&v>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+_+"]."})})}function Dt(_,v){return v===void 0&&(v="utf-8"),v=v||"utf-8",j().platform.encode(_,v)}function On(_,v){return v===void 0&&(v="utf-8"),v=v||"utf-8",j().platform.decode(_,v)}function or(_,v,d){if(v===0)return 0;if(v===1)return _[0];for(var y=_[_.length-1],C=0;C<_.length-1;++C)y+=d[C]*_[C];return y}function ar(_,v,d){if(v===0)return[];if(v===1)return[_];for(var y=new Array(v),C=0;C<y.length-1;++C)y[C]=Math.floor(_/d[C]),_-=y[C]*d[C];return y[y.length-1]=_,y}var yr=Object.freeze({shuffle:Ge,clamp:lt,nearestLargerEven:It,sum:wt,randUniform:function(_,v){var d=Math.random();return v*d+(1-d)*_},distSquared:function(_,v){for(var d=0,y=0;y<_.length;y++){var C=Number(_[y])-Number(v[y]);d+=C*C}return d},assert:we,assertShapesMatch:yt,assertNonNull:Bt,flatten:Ot,sizeFromShape:ze,isScalarShape:function(_){return _.length===0},arraysEqual:Ut,isInt:Ft,tanh:pt,sizeToSquarishShape:vt,createShuffledIndices:function(_){for(var v=new Uint32Array(_),d=0;d<_;++d)v[d]=d;return Ge(v),v},rightPad:rn,repeatedTry:xt,inferFromImplicitShape:_t,parseAxisParam:Xt,squeezeShape:sn,getTypedArrayFromDType:kn,getArrayFromDType:an,checkConversionForErrors:Ve,isValidDtype:Ye,hasEncodingLoss:$e,isTypedArray:ft,bytesPerElement:$t,bytesFromStringArray:Jt,isString:Pn,isBoolean:An,isNumber:Qn,inferDtype:Ce,isFunction:sr,nearestDivisor:Mr,computeStrides:on,toTypedArray:Gt,toNestedArray:Hn,makeOnesTypedArray:Kt,makeZerosTypedArray:Vt,now:en,assertNonNegativeIntegerDimensions:Vn,fetch:function(_,v){return j().platform.fetch(_,v)},encodeString:Dt,decodeString:On,locToIndex:or,indexToLoc:ar}),kr=function(){function _(v,d){this.backendTimer=v,this.logger=d,d==null&&(this.logger=new dr)}return _.prototype.profileKernel=function(v,d,y){var C,z=this,Z=this.backendTimer.time(function(){C=y()});return C.forEach(function(re){re.data().then(function(fe){(function(xe,Oe,Re){if(Oe!=="float32")return!1;for(var Le=0;Le<xe.length;Le++){var Be=xe[Le];if(isNaN(Be)||!isFinite(Be))return console.warn("Found "+Be+" in the result of '"+Re+"'"),!0}})(fe,re.dtype,v),Z.then(function(xe){var Oe="";xe.getExtraProfileInfo!=null&&(Oe=xe.getExtraProfileInfo()),z.logger.logKernelProfile(v,re,fe,xe.kernelMs,d,Oe)})})}),C},_}(),dr=function(){function _(){}return _.prototype.logKernelProfile=function(v,d,y,C,z,Z){var re=typeof C=="number"?rn(C+"ms",9):C.error,fe=rn(v,25),xe=d.rank,Oe=d.size,Re=rn(d.shape.toString(),14),Le="";for(var Be in z){var Xe=z[Be].shape||d.shape,nt=Xe.length;Le+=Be+": "+nt+"D "+(nt>0?Xe:"")+" "}console.log("%c"+fe+"	%c"+re+"	%c"+xe+"D "+Re+"	%c"+Oe+"	%c"+Le+"	%c"+Z,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},_}(),oi=20,Ur=3,Xr=7;function zn(_,v,d){return rn(Array.isArray(_)?parseFloat(_[0].toFixed(Xr))+" + "+parseFloat(_[1].toFixed(Xr))+"j":Pn(_)?"'"+_+"'":d==="bool"?ir(_):parseFloat(_.toFixed(Xr)).toString(),v)}function ir(_){return _===0?"false":"true"}function Or(_){for(var v=[],d=0;d<_.length;d+=2)v.push([_[d],_[d+1]]);return v}var qr=function(){function _(v,d,y){var C=this;if(this.dtype=d,this.shape=v.slice(),this.size=ze(v),y!=null){var z=y.length;we(z===this.size,function(){return"Length of values '"+z+"' does not match the size inferred by the shape '"+C.size+"'."})}if(d==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=y||an(d,this.size),this.strides=on(v)}return _.prototype.set=function(v){for(var d=this,y=[],C=1;C<arguments.length;C++)y[C-1]=arguments[C];y.length===0&&(y=[0]),we(y.length===this.rank,function(){return"The number of provided coordinates ("+y.length+") must match the rank ("+d.rank+")"});var z=this.locToIndex(y);this.values[z]=v},_.prototype.get=function(){for(var v=[],d=0;d<arguments.length;d++)v[d]=arguments[d];v.length===0&&(v=[0]);for(var y=0,C=0,z=v;C<z.length;C++){var Z=z[C];if(Z<0||Z>=this.shape[y]){var re="Requested out of range element at "+v+".   Buffer shape="+this.shape;throw new Error(re)}y++}for(var fe=v[v.length-1],xe=0;xe<v.length-1;++xe)fe+=this.strides[xe]*v[xe];return this.values[fe]},_.prototype.locToIndex=function(v){if(this.rank===0)return 0;if(this.rank===1)return v[0];for(var d=v[v.length-1],y=0;y<v.length-1;++y)d+=this.strides[y]*v[y];return d},_.prototype.indexToLoc=function(v){if(this.rank===0)return[];if(this.rank===1)return[v];for(var d=new Array(this.shape.length),y=0;y<d.length-1;++y)d[y]=Math.floor(v/this.strides[y]),v-=d[y]*this.strides[y];return d[d.length-1]=v,d},Object.defineProperty(_.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),_.prototype.toTensor=function(){return Kr().makeTensor(this.values,this.shape,this.dtype)},_}(),Kr=null,Tt=null,Rr=null,Qt=function(){function _(v,d,y,C){this.kept=!1,this.isDisposedInternal=!1,this.shape=v.slice(),this.dtype=d||"float32",this.size=ze(v),this.strides=on(v),this.dataId=y,this.id=C,this.rankType=this.rank<5?this.rank.toString():"higher"}return _.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},_.prototype.asScalar=function(){return this.throwIfDisposed(),we(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},_.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},_.prototype.as2D=function(v,d){return this.throwIfDisposed(),this.reshape([v,d])},_.prototype.as3D=function(v,d,y){return this.throwIfDisposed(),this.reshape([v,d,y])},_.prototype.as4D=function(v,d,y,C){return this.throwIfDisposed(),this.reshape([v,d,y,C])},_.prototype.as5D=function(v,d,y,C,z){return this.throwIfDisposed(),this.reshape([v,d,y,C,z])},_.prototype.asType=function(v){return this.throwIfDisposed(),Tt.cast(this,v)},Object.defineProperty(_.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),_.prototype.buffer=function(){return D(this,void 0,void 0,function(){var v;return R(this,function(d){switch(d.label){case 0:return[4,this.data()];case 1:return v=d.sent(),[2,Tt.buffer(this.shape,this.dtype,v)]}})})},_.prototype.bufferSync=function(){return Tt.buffer(this.shape,this.dtype,this.dataSync())},_.prototype.array=function(){return D(this,void 0,void 0,function(){var v;return R(this,function(d){switch(d.label){case 0:return[4,this.data()];case 1:return v=d.sent(),[2,Hn(this.shape,v)]}})})},_.prototype.arraySync=function(){return Hn(this.shape,this.dataSync())},_.prototype.data=function(){return D(this,void 0,void 0,function(){var v,d;return R(this,function(y){switch(y.label){case 0:return this.throwIfDisposed(),v=Kr().read(this.dataId),this.dtype!=="string"?[3,2]:[4,v];case 1:d=y.sent();try{return[2,d.map(function(C){return On(C)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}y.label=2;case 2:return[2,v]}})})},_.prototype.dataSync=function(){this.throwIfDisposed();var v=Kr().readSync(this.dataId);if(this.dtype==="string")try{return v.map(function(d){return On(d)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return v},_.prototype.bytes=function(){return D(this,void 0,void 0,function(){var v;return R(this,function(d){switch(d.label){case 0:return this.throwIfDisposed(),[4,Kr().read(this.dataId)];case 1:return v=d.sent(),this.dtype==="string"?[2,v]:[2,new Uint8Array(v.buffer)]}})})},_.prototype.dispose=function(){this.isDisposed||(Kr().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(_.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),_.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},_.prototype.toFloat=function(){return this.asType("float32")},_.prototype.toInt=function(){return this.asType("int32")},_.prototype.toBool=function(){return this.asType("bool")},_.prototype.print=function(v){return v===void 0&&(v=!1),Tt.print(this,v)},_.prototype.reshape=function(v){return this.throwIfDisposed(),Tt.reshape(this,v)},_.prototype.reshapeAs=function(v){return this.throwIfDisposed(),this.reshape(v.shape)},_.prototype.expandDims=function(v){return v===void 0&&(v=0),Tt.expandDims(this,v)},_.prototype.cumsum=function(v,d,y){return v===void 0&&(v=0),d===void 0&&(d=!1),y===void 0&&(y=!1),Tt.cumsum(this,v,d,y)},_.prototype.squeeze=function(v){return this.throwIfDisposed(),Tt.squeeze(this,v)},_.prototype.clone=function(){return this.throwIfDisposed(),Tt.clone(this)},_.prototype.oneHot=function(v,d,y){return this.throwIfDisposed(),Tt.oneHot(this,v,d,y)},_.prototype.toString=function(v){return v===void 0&&(v=!1),function(d,y,C,z){var Z=on(y),re=function(Re,Le,Be,Xe){var nt=ze(Le),tt=Xe[Xe.length-1],ut=new Array(tt).fill(0),Nt=Le.length,Pt=Be==="complex64"?Or(Re):Re;if(Nt>1)for(var jt=0;jt<nt/tt;jt++)for(var Yt=jt*tt,gn=0;gn<tt;gn++)ut[gn]=Math.max(ut[gn],zn(Pt[Yt+gn],0,Be).length);return ut}(d,y,C,Z),fe=y.length,xe=function Re(Le,Be,Xe,nt,tt,ut){ut===void 0&&(ut=!0);var Nt=Xe==="complex64"?2:1,Pt=Be[0],jt=Be.length;if(jt===0)return Xe==="complex64"?[zn(Or(Le)[0],0,Xe)]:Xe==="bool"?[ir(Le[0])]:[Le[0].toString()];if(jt===1){if(Pt>oi){var Yt=Ur*Nt,gn=Array.from(Le.slice(0,Yt)),wn=Array.from(Le.slice((Pt-Ur)*Nt,Pt*Nt));return Xe==="complex64"&&(gn=Or(gn),wn=Or(wn)),["["+gn.map(function(K,ee){return zn(K,tt[ee],Xe)}).join(", ")+", ..., "+wn.map(function(K,ee){return zn(K,tt[Pt-Ur+ee],Xe)}).join(", ")+"]"]}return["["+(Xe==="complex64"?Or(Le):Array.from(Le)).map(function(K,ee){return zn(K,tt[ee],Xe)}).join(", ")+"]"]}var vn=Be.slice(1),Cn=nt.slice(1),Dn=nt[0]*Nt,b=[];if(Pt>oi){for(var p=0;p<Ur;p++){var l=(m=p*Dn)+Dn;b.push.apply(b,Re(Le.slice(m,l),vn,Xe,Cn,tt,!1))}for(b.push("..."),p=Pt-Ur;p<Pt;p++)l=(m=p*Dn)+Dn,b.push.apply(b,Re(Le.slice(m,l),vn,Xe,Cn,tt,p===Pt-1))}else for(p=0;p<Pt;p++){var m;l=(m=p*Dn)+Dn,b.push.apply(b,Re(Le.slice(m,l),vn,Xe,Cn,tt,p===Pt-1))}var w=jt===2?",":"";for(b[0]="["+b[0]+w,p=1;p<b.length-1;p++)b[p]=" "+b[p]+w;var P=`,
`;for(p=2;p<jt;p++)P+=`
`;return b[b.length-1]=" "+b[b.length-1]+"]"+(ut?"":P),b}(d,y,C,Z,re),Oe=["Tensor"];return z&&(Oe.push("  dtype: "+C),Oe.push("  rank: "+fe),Oe.push("  shape: ["+y+"]"),Oe.push("  values:")),Oe.push(xe.map(function(Re){return"    "+Re}).join(`
`)),Oe.join(`
`)}(this.dataSync(),this.shape,this.dtype,v)},_.prototype.tile=function(v){return this.throwIfDisposed(),Tt.tile(this,v)},_.prototype.gather=function(v,d){return d===void 0&&(d=0),this.throwIfDisposed(),Tt.gather(this,v,d)},_.prototype.matMul=function(v,d,y){return d===void 0&&(d=!1),y===void 0&&(y=!1),this.throwIfDisposed(),Tt.matMul(this,v,d,y)},_.prototype.dot=function(v){return this.throwIfDisposed(),Tt.dot(this,v)},_.prototype.norm=function(v,d,y){return v===void 0&&(v="euclidean"),d===void 0&&(d=null),y===void 0&&(y=!1),this.throwIfDisposed(),Tt.norm(this,v,d,y)},_.prototype.slice=function(v,d){return this.throwIfDisposed(),Tt.slice(this,v,d)},_.prototype.reverse=function(v){return this.throwIfDisposed(),Tt.reverse(this,v)},_.prototype.concat=function(v,d){return d===void 0&&(d=0),this.throwIfDisposed(),v instanceof _&&(v=[v]),Tt.concat([this].concat(v),d)},_.prototype.split=function(v,d){return d===void 0&&(d=0),this.throwIfDisposed(),Tt.split(this,v,d)},_.prototype.stack=function(v,d){return d===void 0&&(d=0),Tt.stack([this,v],d)},_.prototype.unstack=function(v){return v===void 0&&(v=0),Tt.unstack(this,v)},_.prototype.pad=function(v,d){return d===void 0&&(d=0),Tt.pad(this,v,d)},_.prototype.batchNormalization=function(v,d,y,C,z){return y===void 0&&(y=.001),Rr("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(v,d,z,C,y)},_.prototype.batchNorm=function(v,d,y,C,z){return z===void 0&&(z=.001),this.throwIfDisposed(),Tt.batchNorm(this,v,d,y,C,z)},_.prototype.all=function(v,d){return v===void 0&&(v=null),d===void 0&&(d=!1),this.throwIfDisposed(),Tt.all(this,v,d)},_.prototype.any=function(v,d){return v===void 0&&(v=null),d===void 0&&(d=!1),this.throwIfDisposed(),Tt.any(this,v,d)},_.prototype.logSumExp=function(v,d){return v===void 0&&(v=null),d===void 0&&(d=!1),this.throwIfDisposed(),Tt.logSumExp(this,v,d)},_.prototype.sum=function(v,d){return v===void 0&&(v=null),d===void 0&&(d=!1),this.throwIfDisposed(),Tt.sum(this,v,d)},_.prototype.prod=function(v,d){return v===void 0&&(v=null),d===void 0&&(d=!1),this.throwIfDisposed(),Tt.prod(this,v,d)},_.prototype.mean=function(v,d){return v===void 0&&(v=null),d===void 0&&(d=!1),this.throwIfDisposed(),Tt.mean(this,v,d)},_.prototype.min=function(v,d){return v===void 0&&(v=null),d===void 0&&(d=!1),this.throwIfDisposed(),Tt.min(this,v,d)},_.prototype.max=function(v,d){return v===void 0&&(v=null),d===void 0&&(d=!1),this.throwIfDisposed(),Tt.max(this,v,d)},_.prototype.argMin=function(v){return v===void 0&&(v=null),this.throwIfDisposed(),Tt.argMin(this,v)},_.prototype.argMax=function(v){return v===void 0&&(v=null),this.throwIfDisposed(),Tt.argMax(this,v)},_.prototype.cast=function(v){return this.throwIfDisposed(),Tt.cast(this,v)},_.prototype.add=function(v){return this.throwIfDisposed(),Tt.add(this,v)},_.prototype.addStrict=function(v){return this.throwIfDisposed(),Tt.addStrict(this,v)},_.prototype.atan2=function(v){return this.throwIfDisposed(),Tt.atan2(this,v)},_.prototype.sub=function(v){return this.throwIfDisposed(),Tt.sub(this,v)},_.prototype.subStrict=function(v){return this.throwIfDisposed(),Tt.subStrict(this,v)},_.prototype.pow=function(v){return this.throwIfDisposed(),Tt.pow(this,v)},_.prototype.powStrict=function(v){return this.throwIfDisposed(),Tt.powStrict(this,v)},_.prototype.mul=function(v){return this.throwIfDisposed(),Tt.mul(this,v)},_.prototype.mulStrict=function(v){return this.throwIfDisposed(),Tt.mulStrict(this,v)},_.prototype.div=function(v){return this.throwIfDisposed(),Tt.div(this,v)},_.prototype.divNoNan=function(v){return this.throwIfDisposed(),Tt.divNoNan(this,v)},_.prototype.floorDiv=function(v){return this.throwIfDisposed(),Tt.floorDiv(this,v)},_.prototype.divStrict=function(v){return this.throwIfDisposed(),Tt.divStrict(this,v)},_.prototype.minimum=function(v){return this.throwIfDisposed(),Tt.minimum(this,v)},_.prototype.minimumStrict=function(v){return this.throwIfDisposed(),Tt.minimumStrict(this,v)},_.prototype.maximum=function(v){return this.throwIfDisposed(),Tt.maximum(this,v)},_.prototype.maximumStrict=function(v){return this.throwIfDisposed(),Tt.maximumStrict(this,v)},_.prototype.mod=function(v){return this.throwIfDisposed(),Tt.mod(this,v)},_.prototype.modStrict=function(v){return this.throwIfDisposed(),Tt.modStrict(this,v)},_.prototype.squaredDifferenceStrict=function(v){return this.throwIfDisposed(),Tt.squaredDifferenceStrict(this,v)},_.prototype.transpose=function(v){return this.throwIfDisposed(),Tt.transpose(this,v)},_.prototype.notEqual=function(v){return this.throwIfDisposed(),Tt.notEqual(this,v)},_.prototype.notEqualStrict=function(v){return this.throwIfDisposed(),Tt.notEqualStrict(this,v)},_.prototype.less=function(v){return this.throwIfDisposed(),Tt.less(this,v)},_.prototype.lessStrict=function(v){return this.throwIfDisposed(),Tt.lessStrict(this,v)},_.prototype.equal=function(v){return this.throwIfDisposed(),Tt.equal(this,v)},_.prototype.equalStrict=function(v){return this.throwIfDisposed(),Tt.equalStrict(this,v)},_.prototype.lessEqual=function(v){return this.throwIfDisposed(),Tt.lessEqual(this,v)},_.prototype.lessEqualStrict=function(v){return this.throwIfDisposed(),Tt.lessEqualStrict(this,v)},_.prototype.greater=function(v){return this.throwIfDisposed(),Tt.greater(this,v)},_.prototype.greaterStrict=function(v){return this.throwIfDisposed(),Tt.greaterStrict(this,v)},_.prototype.greaterEqual=function(v){return this.throwIfDisposed(),Tt.greaterEqual(this,v)},_.prototype.greaterEqualStrict=function(v){return this.throwIfDisposed(),Tt.greaterEqualStrict(this,v)},_.prototype.logicalAnd=function(v){return this.throwIfDisposed(),Tt.logicalAnd(this,v)},_.prototype.logicalOr=function(v){return this.throwIfDisposed(),Tt.logicalOr(this,v)},_.prototype.logicalNot=function(){return this.throwIfDisposed(),Tt.logicalNot(this)},_.prototype.logicalXor=function(v){return this.throwIfDisposed(),Tt.logicalXor(this,v)},_.prototype.where=function(v,d){return this.throwIfDisposed(),Tt.where(v,this,d)},_.prototype.neg=function(){return this.throwIfDisposed(),Tt.neg(this)},_.prototype.ceil=function(){return this.throwIfDisposed(),Tt.ceil(this)},_.prototype.floor=function(){return this.throwIfDisposed(),Tt.floor(this)},_.prototype.sign=function(){return this.throwIfDisposed(),Tt.sign(this)},_.prototype.isNaN=function(){return this.throwIfDisposed(),Tt.isNaN(this)},_.prototype.isInf=function(){return this.throwIfDisposed(),Tt.isInf(this)},_.prototype.isFinite=function(){return this.throwIfDisposed(),Tt.isFinite(this)},_.prototype.exp=function(){return this.throwIfDisposed(),Tt.exp(this)},_.prototype.expm1=function(){return this.throwIfDisposed(),Tt.expm1(this)},_.prototype.log=function(){return this.throwIfDisposed(),Tt.log(this)},_.prototype.log1p=function(){return this.throwIfDisposed(),Tt.log1p(this)},_.prototype.sqrt=function(){return this.throwIfDisposed(),Tt.sqrt(this)},_.prototype.rsqrt=function(){return this.throwIfDisposed(),Tt.rsqrt(this)},_.prototype.square=function(){return this.throwIfDisposed(),Tt.square(this)},_.prototype.reciprocal=function(){return this.throwIfDisposed(),Tt.reciprocal(this)},_.prototype.abs=function(){return this.throwIfDisposed(),Tt.abs(this)},_.prototype.clipByValue=function(v,d){return this.throwIfDisposed(),Tt.clipByValue(this,v,d)},_.prototype.relu=function(){return this.throwIfDisposed(),Tt.relu(this)},_.prototype.relu6=function(){return this.throwIfDisposed(),Tt.relu6(this)},_.prototype.elu=function(){return this.throwIfDisposed(),Tt.elu(this)},_.prototype.selu=function(){return this.throwIfDisposed(),Tt.selu(this)},_.prototype.leakyRelu=function(v){return v===void 0&&(v=.2),this.throwIfDisposed(),Tt.leakyRelu(this,v)},_.prototype.prelu=function(v){return this.throwIfDisposed(),Tt.prelu(this,v)},_.prototype.sigmoid=function(){return this.throwIfDisposed(),Tt.sigmoid(this)},_.prototype.logSigmoid=function(){return this.throwIfDisposed(),Tt.logSigmoid(this)},_.prototype.softplus=function(){return this.throwIfDisposed(),Tt.softplus(this)},_.prototype.zerosLike=function(){return this.throwIfDisposed(),Tt.zerosLike(this)},_.prototype.onesLike=function(){return this.throwIfDisposed(),Tt.onesLike(this)},_.prototype.sin=function(){return this.throwIfDisposed(),Tt.sin(this)},_.prototype.cos=function(){return this.throwIfDisposed(),Tt.cos(this)},_.prototype.tan=function(){return this.throwIfDisposed(),Tt.tan(this)},_.prototype.asin=function(){return this.throwIfDisposed(),Tt.asin(this)},_.prototype.acos=function(){return this.throwIfDisposed(),Tt.acos(this)},_.prototype.atan=function(){return this.throwIfDisposed(),Tt.atan(this)},_.prototype.sinh=function(){return this.throwIfDisposed(),Tt.sinh(this)},_.prototype.cosh=function(){return this.throwIfDisposed(),Tt.cosh(this)},_.prototype.tanh=function(){return this.throwIfDisposed(),Tt.tanh(this)},_.prototype.asinh=function(){return this.throwIfDisposed(),Tt.asinh(this)},_.prototype.acosh=function(){return this.throwIfDisposed(),Tt.acosh(this)},_.prototype.atanh=function(){return this.throwIfDisposed(),Tt.atanh(this)},_.prototype.erf=function(){return this.throwIfDisposed(),Tt.erf(this)},_.prototype.round=function(){return this.throwIfDisposed(),Tt.round(this)},_.prototype.step=function(v){return v===void 0&&(v=0),this.throwIfDisposed(),Tt.step(this,v)},_.prototype.softmax=function(v){return v===void 0&&(v=-1),this.throwIfDisposed(),Tt.softmax(this,v)},_.prototype.logSoftmax=function(v){return v===void 0&&(v=-1),this.throwIfDisposed(),Tt.logSoftmax(this,v)},_.prototype.resizeBilinear=function(v,d){return d===void 0&&(d=!1),this.throwIfDisposed(),Tt.image.resizeBilinear(this,v,d)},_.prototype.resizeNearestNeighbor=function(v,d){return d===void 0&&(d=!1),this.throwIfDisposed(),Tt.image.resizeNearestNeighbor(this,v,d)},_.prototype.conv1d=function(v,d,y,C,z,Z){return C===void 0&&(C="NWC"),z===void 0&&(z=1),this.throwIfDisposed(),Tt.conv1d(this,v,d,y,C,z,Z)},_.prototype.conv2d=function(v,d,y,C,z,Z){return C===void 0&&(C="NHWC"),z===void 0&&(z=[1,1]),this.throwIfDisposed(),Tt.conv2d(this,v,d,y,C,z,Z)},_.prototype.conv2dTranspose=function(v,d,y,C,z){return this.throwIfDisposed(),Tt.conv2dTranspose(this,v,d,y,C,z)},_.prototype.depthwiseConv2D=function(v,d,y,C,z,Z){return C===void 0&&(C="NHWC"),z===void 0&&(z=[1,1]),this.throwIfDisposed(),Tt.depthwiseConv2d(this,v,d,y,C,z,Z)},_.prototype.separableConv2d=function(v,d,y,C,z,Z){return z===void 0&&(z=[1,1]),Z===void 0&&(Z="NHWC"),this.throwIfDisposed(),Tt.separableConv2d(this,v,d,y,C,z,Z)},_.prototype.avgPool=function(v,d,y,C){return this.throwIfDisposed(),Tt.avgPool(this,v,d,y,C)},_.prototype.maxPool=function(v,d,y,C){return this.throwIfDisposed(),Tt.maxPool(this,v,d,y,C)},_.prototype.localResponseNormalization=function(v,d,y,C){return v===void 0&&(v=5),d===void 0&&(d=1),y===void 0&&(y=1),C===void 0&&(C=.5),Tt.localResponseNormalization(this,v,d,y,C)},_.prototype.pool=function(v,d,y,C,z){return this.throwIfDisposed(),Tt.pool(this,v,d,y,C,z)},_.prototype.variable=function(v,d,y){return v===void 0&&(v=!0),this.throwIfDisposed(),Kr().makeVariable(this,v,d,y)},_.prototype.unsortedSegmentSum=function(v,d){return this.throwIfDisposed(),Tt.unsortedSegmentSum(this,v,d)},_.prototype.batchToSpaceND=function(v,d){return this.throwIfDisposed(),Tt.batchToSpaceND(this,v,d)},_.prototype.spaceToBatchND=function(v,d){return this.throwIfDisposed(),Tt.spaceToBatchND(this,v,d)},_.prototype.topk=function(v,d){return v===void 0&&(v=1),d===void 0&&(d=!0),this.throwIfDisposed(),Tt.topk(this,v,d)},_.prototype.stridedSlice=function(v,d,y,C,z,Z,re,fe){return C===void 0&&(C=0),z===void 0&&(z=0),Z===void 0&&(Z=0),re===void 0&&(re=0),fe===void 0&&(fe=0),this.throwIfDisposed(),Tt.stridedSlice(this,v,d,y,C,z,Z,re,fe)},_.prototype.depthToSpace=function(v,d){return this.throwIfDisposed(),Tt.depthToSpace(this,v,d)},_.prototype.fft=function(){return this.throwIfDisposed(),Tt.spectral.fft(this)},_.prototype.ifft=function(){return this.throwIfDisposed(),Tt.spectral.ifft(this)},_.prototype.rfft=function(){return this.throwIfDisposed(),Tt.spectral.rfft(this)},_.prototype.irfft=function(){return this.throwIfDisposed(),Tt.spectral.irfft(this)},_}();Object.defineProperty(Qt,Symbol.hasInstance,{value:function(_){return!!_&&_.dataId!=null&&_.shape!=null&&_.dtype!=null}});var Se,ve,ke,Me,rt,Ct=function(_){function v(d,y,C,z){var Z=_.call(this,d.shape,d.dtype,d.dataId,z)||this;return Z.trainable=y,Z.name=C,Z}return B(v,_),v.prototype.assign=function(d){if(d.dtype!==this.dtype)throw new Error("dtype of the new value ("+d.dtype+") and previous value ("+this.dtype+") must match");if(!Ut(d.shape,this.shape))throw new Error("shape of the new value ("+d.shape+") and previous value ("+this.shape+") must match");Kr().disposeTensor(this),this.dataId=d.dataId,Kr().incRef(this,null)},v.prototype.dispose=function(){Kr().disposeVariable(this),this.isDisposedInternal=!0},v}(Qt);Object.defineProperty(Ct,Symbol.hasInstance,{value:function(_){return _ instanceof Qt&&_.assign!=null&&_.assign instanceof Function}}),function(_){_.R0="R0",_.R1="R1",_.R2="R2",_.R3="R3",_.R4="R4",_.R5="R5",_.R6="R6"}(Se||(Se={})),function(_){_.float32="float32",_.int32="int32",_.bool="int32",_.complex64="complex64"}(ve||(ve={})),function(_){_.float32="float32",_.int32="int32",_.bool="bool",_.complex64="complex64"}(ke||(ke={})),function(_){_.float32="float32",_.int32="float32",_.bool="float32",_.complex64="complex64"}(Me||(Me={})),function(_){_.float32="complex64",_.int32="complex64",_.bool="complex64",_.complex64="complex64"}(rt||(rt={}));var tn={float32:Me,int32:ve,bool:ke,complex64:rt};function Sn(_,v){if(_==="string"||v==="string"){if(_==="string"&&v==="string")return"string";throw new Error("Can not upcast "+_+" with "+v)}return tn[_][v]}function Rt(_){return Sn(_,"int32")}function Zt(_,v){if(_.dtype===v.dtype)return[_,v];var d=Sn(_.dtype,v.dtype);return[_.cast(d),v.cast(d)]}function mn(_,v){we(_.dtype===v.dtype,function(){return"The dtypes of the first("+_.dtype+") and second("+v.dtype+") input must match"})}function fn(_){var v=[];return function d(y,C,z){if(y!=null){if(y instanceof Qt)C.push(y);else if(Z=y,Array.isArray(Z)||typeof Z=="object"){var Z,re=y;for(var fe in re){var xe=re[fe];z.has(xe)||(z.add(xe),d(xe,C,z))}}}}(_,v,new Set),v}var mt,Mt=Object.freeze({makeTypesMatch:Zt,assertTypesMatch:mn,isTensorInList:function(_,v){return v.some(function(d){return d.id===_.id})},getTensorsInContainer:fn}),hn=function(){function _(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return _.prototype.dispose=function(){for(var v in this.registeredVariables)this.registeredVariables[v].dispose()},_}(),nn=function(){function _(v){this.ENV=v,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new hn}return _.prototype.ready=function(){return D(this,void 0,void 0,function(){var v,d,y;return R(this,function(C){switch(C.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];v=this.getSortedBackends(),d=0,C.label=1;case 1:return d<v.length?(y=v[d],[4,this.initializeBackend(y).success]):[3,5];case 2:return C.sent()?[4,this.setBackend(y)]:[3,4];case 3:return C.sent(),[2];case 4:return d++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(_.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var v=this.initializeBackendsAndReturnBest(),d=v.name;if(v.asyncInit)throw new Error("The highest priority backend '"+d+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(d)}return this.backendInstance},enumerable:!0,configurable:!0}),_.prototype.backendNames=function(){return Object.keys(this.registryFactory)},_.prototype.findBackend=function(v){return!(v in this.registry)&&(!(v in this.registryFactory)||this.initializeBackend(v).asyncInit)?null:this.registry[v]},_.prototype.findBackendFactory=function(v){return v in this.registryFactory?this.registryFactory[v].factory:null},_.prototype.registerBackend=function(v,d,y){return y===void 0&&(y=1),v in this.registryFactory?(console.warn(v+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[v]={factory:d,priority:y},!0)},_.prototype.setBackend=function(v){return D(this,void 0,void 0,function(){var d,y,C;return R(this,function(z){switch(z.label){case 0:if(this.registryFactory[v]==null)throw new Error("Backend name '"+v+"' not found in registry");return this.backendName=v,this.registry[v]!=null?[3,4]:(this.backendInstance=null,d=this.initializeBackend(v),y=d.success,d.asyncInit?[4,y]:[3,2]);case 1:return C=z.sent(),[3,3];case 2:C=y,z.label=3;case 3:if(!C)return[2,!1];z.label=4;case 4:return this.backendInstance=this.registry[v],this.setupRegisteredKernels(),this.profiler=new kr(this.backendInstance),[2,!0]}})})},_.prototype.setupRegisteredKernels=function(){var v=this;ae(this.backendName).forEach(function(d){d.setupFunc!=null&&d.setupFunc(v.backendInstance)})},_.prototype.disposeRegisteredKernels=function(v){var d=this;ae(v).forEach(function(y){y.disposeFunc!=null&&y.disposeFunc(d.registry[v])})},_.prototype.initializeBackend=function(v){var d=this,y=this.registryFactory[v];if(y==null)throw new Error("Cannot initialize backend "+v+", no registration found.");try{var C=y.factory();if(Promise.resolve(C)===C){var z=++this.pendingBackendInitId,Z=C.then(function(re){return!(z<d.pendingBackendInitId||(d.registry[v]=re,d.pendingBackendInit=null,0))}).catch(function(re){return!(z<d.pendingBackendInitId||(d.pendingBackendInit=null,console.warn("Initialization of backend "+v+" failed"),console.warn(re.stack||re.message),1))});return this.pendingBackendInit=Z,{success:Z,asyncInit:!0}}return this.registry[v]=C,{success:!0,asyncInit:!1}}catch(re){return console.warn("Initialization of backend "+v+" failed"),console.warn(re.stack||re.message),{success:!1,asyncInit:!1}}},_.prototype.removeBackend=function(v){if(!(v in this.registryFactory))throw new Error(v+" backend not found in registry");this.backendName===v&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,v in this.registry&&(this.disposeRegisteredKernels(v),this.registry[v].dispose(),delete this.registry[v]),delete this.registryFactory[v],this.backendName===v&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},_.prototype.getSortedBackends=function(){var v=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(d,y){return v.registryFactory[y].priority-v.registryFactory[d].priority})},_.prototype.initializeBackendsAndReturnBest=function(){for(var v=this.getSortedBackends(),d=0;d<v.length;d++){var y=v[d],C=this.initializeBackend(y),z=C.success,Z=C.asyncInit;if(Z||z)return{name:y,asyncInit:Z}}throw new Error("Could not initialize any backends, all backend initializations failed.")},_.prototype.moveData=function(v,d){var y=this.state.tensorInfo.get(d),C=y.backend,z=this.readSync(d);C.disposeData(d),y.backend=v,v.move(d,z,y.shape,y.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},_.prototype.tidy=function(v,d){var y,C=this,z=null;if(d==null){if(typeof v!="function")throw new Error("Please provide a function to tidy()");d=v}else{if(typeof v!="string"&&!(v instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof d!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");z=v}return this.scopedRun(function(){return C.startScope(z)},function(){return C.endScope(y)},function(){return(y=d())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),y})},_.prototype.scopedRun=function(v,d,y){v();try{var C=y();return d(),C}catch(z){throw d(),z}},_.prototype.nextTensorId=function(){return _.nextTensorId++},_.prototype.nextVariableId=function(){return _.nextVariableId++},_.prototype.clone=function(v){var d=this.makeTensorFromDataId(v.dataId,v.shape,v.dtype),y={x:v};return this.addTapeNode(this.state.activeScope.name,y,[d],function(C){return{x:function(){return C.toFloat()}}},[]),d},_.prototype.runKernel=function(v,d,y,C,z){return this.runKernelFunc(null,d,null,v,y,C,z)},_.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},_.prototype.checkKernelForMemLeak=function(v,d,y){var C=this.backend.numDataIds(),z=0;y.forEach(function(fe){z+=fe.dtype==="complex64"?3:1});var Z=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],re=C-d-z-Z;if(re>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+re+" data ids) after running '"+v+"'")},_.prototype.runKernelFunc=function(v,d,y,C,z,Z,re){var fe,xe=this;Z===void 0&&(Z=[]),re===void 0&&(re=[]);var Oe=[],Re=this.isTapeOn();C==null&&(C=this.state.activeScope!=null?this.state.activeScope.name:"");var Le,Be=function(Nt){Re&&(Oe=Nt.map(function(Pt){return xe.keep(xe.clone(Pt))}))},Xe=this.state.numBytes,nt=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var tt,ut=Y(C,this.backendName);return Le=ut!=null?function(){var Nt=xe.backend.numDataIds();tt=ut.kernelFunc({inputs:d,attrs:z,backend:xe.backend});var Pt=Array.isArray(tt)?tt:[tt];xe.shouldCheckForMemLeaks()&&xe.checkKernelForMemLeak(C,Nt,Pt);var jt=Pt.map(function(gn){var wn=gn.dataId,vn=gn.shape,Cn=gn.dtype;return xe.makeTensorFromDataId(wn,vn,Cn)}),Yt=jt.filter(function(gn,wn){return re[wn]});return Be((Z||[]).slice().concat(Yt)),jt}:function(){var Nt=xe.backend.numDataIds();tt=xe.tidy(function(){return v(xe.backend,Be)});var Pt=Array.isArray(tt)?tt:[tt];return xe.shouldCheckForMemLeaks()&&xe.checkKernelForMemLeak(C,Nt,Pt),Pt},this.scopedRun(function(){return xe.state.kernelDepth++},function(){return xe.state.kernelDepth--},function(){fe=xe.ENV.getBool("DEBUG")?xe.profiler.profileKernel(C,d,function(){return Le()}):Le()}),Re&&this.addTapeNode(C,d,fe,y,Oe),this.state.profiling&&this.state.activeProfile.kernels.push({name:C,bytesAdded:this.state.numBytes-Xe,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-nt,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(function(Nt){return d[Nt].shape}),outputShapes:fe.map(function(Nt){return Nt.shape})}),Array.isArray(tt)?fe:fe[0]},_.prototype.makeTensor=function(v,d,y,C){if(v==null)throw new Error("Values passed to engine.makeTensor() are null");y=y||"float32",C=C||this.backend;var z=v;y==="string"&&Pn(v[0])&&(z=v.map(function(Oe){return Dt(Oe)}));var Z=C.write(z,d,y),re=new Qt(d,y,Z,this.nextTensorId());if(this.incRef(re,C),y==="string"){var fe=this.state.tensorInfo.get(Z),xe=Jt(z);this.state.numBytes+=xe-fe.bytes,fe.bytes=xe}return re},_.prototype.makeTensorFromDataId=function(v,d,y,C){var z=new Qt(d,y=y||"float32",v,this.nextTensorId());return this.incRef(z,C),z},_.prototype.makeVariable=function(v,d,y,C){d===void 0&&(d=!0),y=y||this.nextVariableId().toString(),C!=null&&C!==v.dtype&&(v=v.asType(C));var z=new Ct(v,d,y,this.nextTensorId());if(this.state.registeredVariables[z.name]!=null)throw new Error("Variable with name "+z.name+" was already registered");return this.state.registeredVariables[z.name]=z,this.incRef(z,this.backend),z},_.prototype.incRef=function(v,d){var y=this.state.tensorInfo.has(v.dataId)?this.state.tensorInfo.get(v.dataId).refCount:0;if(this.state.numTensors++,v.dtype==="string"&&this.state.numStringTensors++,y===0){this.state.numDataBuffers++;var C=0;v.dtype!=="complex64"&&v.dtype!=="string"&&(C=v.size*$t(v.dtype)),this.state.tensorInfo.set(v.dataId,{backend:d||this.backend,dtype:v.dtype,shape:v.shape,bytes:C,refCount:0}),this.state.numBytes+=C}this.state.tensorInfo.get(v.dataId).refCount++,v instanceof Ct||this.track(v)},_.prototype.disposeTensor=function(v){if(this.state.tensorInfo.has(v.dataId)){this.state.numTensors--,v.dtype==="string"&&this.state.numStringTensors--;var d=this.state.tensorInfo.get(v.dataId);d.refCount<=1?(v.dtype!=="complex64"&&(this.state.numBytes-=d.bytes),this.state.numDataBuffers--,d.backend.disposeData(v.dataId),this.state.tensorInfo.delete(v.dataId)):this.state.tensorInfo.get(v.dataId).refCount--}},_.prototype.disposeVariables=function(){for(var v in this.state.registeredVariables){var d=this.state.registeredVariables[v];this.disposeVariable(d)}},_.prototype.disposeVariable=function(v){this.disposeTensor(v),this.state.registeredVariables[v.name]!=null&&delete this.state.registeredVariables[v.name]},_.prototype.memory=function(){var v=this.backend.memory();return v.numTensors=this.state.numTensors,v.numDataBuffers=this.state.numDataBuffers,v.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(v.unreliable=!0,v.reasons==null&&(v.reasons=[]),v.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),v},_.prototype.profile=function(v){return D(this,void 0,void 0,function(){var d,y;return R(this,function(C){return this.state.profiling=!0,d=this.state.numBytes,y=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=v(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(z){return z.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-d,this.state.activeProfile.newTensors=this.state.numTensors-y,[2,this.state.activeProfile]})})},_.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},_.prototype.addTapeNode=function(v,d,y,C,z){var Z=this,re={id:this.state.nextTapeNodeId++,kernelName:v,inputs:d,outputs:y,saved:z},fe=q(v);fe!=null&&(C=fe.gradFunc),C!=null&&(re.gradient=function(xe){return xe=xe.map(function(Oe,Re){if(Oe==null){var Le=y[Re],Be=Vt(Le.size,Le.dtype);return Z.makeTensor(Be,Le.shape,Le.dtype)}return Oe}),C(xe.length>1?xe:xe[0],z)}),this.state.activeTape.push(re)},_.prototype.keep=function(v){return v.kept=!0,v},_.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},_.prototype.endTape=function(){this.state.gradientDepth--},_.prototype.startScope=function(v){var d={track:[],name:"unnamed scope",id:this.state.nextScopeId++};v&&(d.name=v),this.state.scopeStack.push(d),this.state.activeScope=d},_.prototype.endScope=function(v){for(var d=this,y=fn(v),C=new Set(y.map(function(fe){return fe.id})),z=0;z<this.state.activeScope.track.length;z++){var Z=this.state.activeScope.track[z];Z.kept||C.has(Z.id)||Z.dispose()}var re=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],y.forEach(function(fe){fe.kept||fe.scopeId!==re.id||d.track(fe)})},_.prototype.gradients=function(v,d,y,C){var z=this;if(C===void 0&&(C=!1),we(d.length>0,function(){return"gradients() received an empty list of xs."}),y!=null&&y.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+y.dtype+"'");var Z=this.scopedRun(function(){return z.startTape()},function(){return z.endTape()},function(){return z.tidy("forward",v)});we(Z instanceof Qt,function(){return"The result y returned by f() must be a tensor."});var re=function(fe,xe,Oe){for(var Re={},Le={},Be=0;Be<xe.length;Be++)Re[xe[Be].id]=!0;for(Be=0;Be<fe.length;Be++){var Xe=(gn=fe[Be]).inputs;for(var nt in Xe){for(var tt=Xe[nt],ut=!1,Nt=0;Nt<xe.length;Nt++)if(Re[tt.id]){gn.outputs.forEach(function(Dn){return Re[Dn.id]=!0}),ut=!0,Le[gn.id]=!0;break}if(ut)break}}var Pt={};Pt[Oe.id]=!0;var jt={};for(Be=fe.length-1;Be>=0;Be--)for(Xe=(gn=fe[Be]).inputs,Nt=0;Nt<gn.outputs.length;Nt++)if(Pt[gn.outputs[Nt].id]){for(var nt in Xe)Pt[Xe[nt].id]=!0,jt[gn.id]=!0;break}var Yt=[];for(Be=0;Be<fe.length;Be++){var gn;if(Le[(gn=fe[Be]).id]&&jt[gn.id]){var wn={};for(var nt in gn.inputs){var vn=gn.inputs[nt];Re[vn.id]&&(wn[nt]=vn)}var Cn=Object.assign({},gn);Cn.inputs=wn,Cn.outputs=gn.outputs,Yt.push(Cn)}}return Yt}(this.state.activeTape,d,Z);if(!C&&re.length===0&&d.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var fe,xe,Oe={};Oe[Z.id]=y??(xe=Kt(ze(fe=Z.shape),"float32"),He.makeTensor(xe,fe,"float32")),function(Le,Be,Xe){for(var nt=function(ut){var Nt=Be[ut],Pt=[];if(Nt.outputs.forEach(function(wn){var vn=Le[wn.id];vn!=null?Pt.push(vn):Pt.push(null)}),Nt.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+Nt.kernelName+".");var jt=Nt.gradient(Pt),Yt=function(wn){if(!(wn in jt))throw new Error("Cannot backprop through input "+wn+". Available gradients found: "+Object.keys(jt)+".");var vn=Xe(function(){return jt[wn]()});if(vn.dtype!=="float32")throw new Error("Error in gradient for op "+Nt.kernelName+". The gradient of input "+wn+" must have 'float32' dtype, but has '"+vn.dtype+"'");var Cn=Nt.inputs[wn];if(!Ut(vn.shape,Cn.shape))throw new Error("Error in gradient for op "+Nt.kernelName+". The gradient of input '"+wn+"' has shape '"+vn.shape+"', which does not match the shape of the input '"+Cn.shape+"'");if(Le[Cn.id]==null)Le[Cn.id]=vn;else{var Dn=Le[Cn.id];Le[Cn.id]=Dn.add(vn),Dn.dispose()}};for(var gn in Nt.inputs)Yt(gn)},tt=Be.length-1;tt>=0;tt--)nt(tt)}(Oe,re,function(Le){return z.tidy(Le)});var Re=d.map(function(Le){return Oe[Le.id]});return z.state.gradientDepth===0&&(z.state.activeTape.forEach(function(Le){for(var Be=0,Xe=Le.saved;Be<Xe.length;Be++)Xe[Be].dispose()}),z.state.activeTape=null),{value:Z,grads:Re}})},_.prototype.customGrad=function(v){var d=this;return we(sr(v),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var y,C=[],z=0;z<arguments.length;z++)C[z]=arguments[z];we(C.every(function(re){return re instanceof Qt}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var Z={};return C.forEach(function(re,fe){Z[fe]=re}),d.runKernelFunc(function(re,fe){return we((y=v.apply(void 0,C.concat([fe]))).value instanceof Qt,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),we(sr(y.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),y.value},Z,function(re,fe){var xe=y.gradFunc(re,fe),Oe=Array.isArray(xe)?xe:[xe];we(Oe.length===C.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),we(Oe.every(function(Le){return Le instanceof Qt}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var Re={};return Oe.forEach(function(Le,Be){Re[Be]=function(){return Le}}),Re})}},_.prototype.readSync=function(v){return this.state.tensorInfo.get(v).backend.readSync(v)},_.prototype.read=function(v){return this.state.tensorInfo.get(v).backend.read(v)},_.prototype.time=function(v){return D(this,void 0,void 0,function(){var d,y;return R(this,function(C){switch(C.label){case 0:return d=en(),[4,this.backend.time(v)];case 1:return(y=C.sent()).wallMs=en()-d,[2,y]}})})},_.prototype.track=function(v){return this.state.activeScope!=null&&(v.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(v)),v},Object.defineProperty(_.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),_.prototype.reset=function(){for(var v in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new hn,this.registry)this.disposeRegisteredKernels(v),this.registry[v].dispose(),delete this.registry[v];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},_.nextTensorId=0,_.nextVariableId=0,_}(),He=function(){var _=function(){if(mt==null){var d=void 0;if(typeof window<"u")d=window;else if(c!==void 0)d=c;else if(S!==void 0)d=S;else{if(typeof self>"u")throw new Error("Could not find a global object");d=self}mt=d}return mt}();if(_._tfengine==null){var v=new W(_);_._tfengine=new nn(v)}return function(d){H=d}(_._tfengine.ENV),Kr=function(){return _._tfengine},_._tfengine}();function Bn(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Xn=j();Xn.registerFlag("DEBUG",function(){return!1},function(_){_&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Xn.registerFlag("IS_BROWSER",function(){return Bn()}),Xn.registerFlag("IS_NODE",function(){return S!==void 0&&S.versions!==void 0&&S.versions.node!==void 0}),Xn.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Xn.registerFlag("PROD",function(){return!1}),Xn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Xn.getBool("DEBUG")}),Xn.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Xn.registerFlag("IS_TEST",function(){return!1});var Zn,lr,jr,Cr={},xi={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Ai(_,v){Cr[_]=v}function ni(_){_ in Cr||(Cr[_]=function(d){if(d!==1&&d!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var y=function(C){if(typeof OffscreenCanvas<"u"&&C===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(d);return y.addEventListener("webglcontextlost",function(C){C.preventDefault(),delete Cr[d]},!1),d===1?y.getContext("webgl",xi)||y.getContext("experimental-webgl",xi):y.getContext("webgl2",xi)}(_));var v=Cr[_];return v.isContextLost()?(delete Cr[_],ni(_)):(v.disable(v.DEPTH_TEST),v.disable(v.STENCIL_TEST),v.disable(v.BLEND),v.disable(v.DITHER),v.disable(v.POLYGON_OFFSET_FILL),v.disable(v.SAMPLE_COVERAGE),v.enable(v.SCISSOR_TEST),v.enable(v.CULL_FACE),v.cullFace(v.BACK),Cr[_])}function to(_,v){return[v,_]}function yi(_){var v=ze(_);return vt(Math.ceil(v/4))}function ri(_,v){return[Math.max(1,Math.ceil(v/2)),Math.max(1,Math.ceil(_/2))]}function Jr(_,v){var d,y,C,z,Z,re,fe,xe,Oe,Re=_;return j().getNumber("WEBGL_VERSION")===2?(d=Re.R32F,y=Re.R16F,C=Re.RGBA16F,z=Re.RGBA32F,Z=Re.RED,re=4,fe=1,xe=Re.HALF_FLOAT,Oe=Re.FLOAT):(d=_.RGBA,y=_.RGBA,C=_.RGBA,z=Re.RGBA,Z=_.RGBA,re=4,fe=4,xe=v!=null?v.HALF_FLOAT_OES:null,Oe=_.FLOAT),{internalFormatFloat:d,internalFormatHalfFloat:y,internalFormatPackedHalfFloat:C,internalFormatPackedFloat:z,textureFormatFloat:Z,downloadTextureFormat:_.RGBA,downloadUnpackNumChannels:re,defaultNumChannels:fe,textureTypeHalfFloat:xe,textureTypeFloat:Oe}}function Kn(_,v,d){var y=d();return v&&function(C){var z=C.getError();if(z!==C.NO_ERROR)throw new Error("WebGL Error: "+so(C,z))}(_),y}(function(_){_[_.DENSE=0]="DENSE",_[_.SHARED_BATCH=1]="SHARED_BATCH"})(Zn||(Zn={})),function(_){_[_.RENDER=0]="RENDER",_[_.UPLOAD=1]="UPLOAD",_[_.PIXELS=2]="PIXELS",_[_.DOWNLOAD=3]="DOWNLOAD"}(lr||(lr={})),function(_){_[_.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",_[_.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",_[_.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",_[_.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",_[_.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(jr||(jr={}));var pi=596e-10,Ci=65504;function Wr(_){return!!(j().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||_===0||pi<Math.abs(_)&&Math.abs(_)<Ci)}function so(_,v){switch(v){case _.NO_ERROR:return"NO_ERROR";case _.INVALID_ENUM:return"INVALID_ENUM";case _.INVALID_VALUE:return"INVALID_VALUE";case _.INVALID_OPERATION:return"INVALID_OPERATION";case _.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case _.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case _.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+v}}function Wi(_,v,d){return ba(_,v,function(){return _.getExtension(d)},'Extension "'+d+'" not supported on this browser.')}function no(_,v,d){var y=ba(_,v,function(){return _.createShader(_.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Kn(_,v,function(){return _.shaderSource(y,d)}),Kn(_,v,function(){return _.compileShader(y)}),_.getShaderParameter(y,_.COMPILE_STATUS)===!1)throw console.log(_.getShaderInfoLog(y)),new Error("Failed to compile vertex shader.");return y}function So(_,v,d){var y=ba(_,v,function(){return _.createShader(_.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Kn(_,v,function(){return _.shaderSource(y,d)}),Kn(_,v,function(){return _.compileShader(y)}),_.getShaderParameter(y,_.COMPILE_STATUS)===!1)throw function(C,z){var Z=Ch.exec(z);if(Z==null)return console.log("Couldn't parse line number in error: "+z),void console.log(C);for(var re=+Z[1],fe=C.split(`
`),xe=fe.length.toString().length+2,Oe=fe.map(function(tt,ut){return rn((ut+1).toString(),xe)+tt}),Re=0,Le=0;Le<Oe.length;Le++)Re=Math.max(Oe[Le].length,Re);var Be=Oe.slice(0,re-1),Xe=Oe.slice(re-1,re),nt=Oe.slice(re);console.log(Be.join(`
`)),console.log(z.split(`
`)[0]),console.log("%c "+rn(Xe[0],Re),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(nt.join(`
`))}(d,_.getShaderInfoLog(y)),new Error("Failed to compile fragment shader.");return y}var _a,Ds,Ch=/ERROR: [0-9]+:([0-9]+):/g;function ro(_,v){return ba(_,v,function(){return _.createProgram()},"Unable to create WebGLProgram.")}function Mc(_,v,d){if(Kn(_,v,function(){return _.linkProgram(d)}),_.getProgramParameter(d,_.LINK_STATUS)===!1)throw console.log(_.getProgramInfoLog(d)),new Error("Failed to link vertex and fragment shaders.")}function Gu(_,v,d){if(Kn(_,v,function(){return _.validateProgram(d)}),_.getProgramParameter(d,_.VALIDATE_STATUS)===!1)throw console.log(_.getProgramInfoLog(d)),new Error("Shader program validation failed.")}function el(_,v,d){var y=ba(_,v,function(){return _.createBuffer()},"Unable to create WebGLBuffer");return Kn(_,v,function(){return _.bindBuffer(_.ARRAY_BUFFER,y)}),Kn(_,v,function(){return _.bufferData(_.ARRAY_BUFFER,d,_.STATIC_DRAW)}),y}function fc(_,v,d){var y=ba(_,v,function(){return _.createBuffer()},"Unable to create WebGLBuffer");return Kn(_,v,function(){return _.bindBuffer(_.ELEMENT_ARRAY_BUFFER,y)}),Kn(_,v,function(){return _.bufferData(_.ELEMENT_ARRAY_BUFFER,d,_.STATIC_DRAW)}),y}function tl(_,v){return ba(_,v,function(){return _.createTexture()},"Unable to create WebGLTexture.")}function Up(_,v){var d=j().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(_<=0||v<=0){var y="["+_+"x"+v+"]";throw new Error("Requested texture size "+y+" is invalid.")}if(_>d||v>d)throw y="["+_+"x"+v+"]",new Error("Requested texture size "+y+" greater than WebGL maximum on this browser / GPU ["+d+"x"+d+"].")}function xs(_,v){return ba(_,v,function(){return _.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function dd(_,v,d,y,C,z,Z,re){var fe=_.getAttribLocation(d,y);return fe!==-1&&(Kn(_,v,function(){return _.bindBuffer(_.ARRAY_BUFFER,C)}),Kn(_,v,function(){return _.vertexAttribPointer(fe,z,_.FLOAT,!1,Z,re)}),Kn(_,v,function(){return _.enableVertexAttribArray(fe)}),!0)}function Wp(_,v,d,y){Dc(_,y),Kn(_,v,function(){return _.activeTexture(_.TEXTURE0+y)}),Kn(_,v,function(){return _.bindTexture(_.TEXTURE_2D,d)})}function dc(_,v,d,y){return ba(_,v,function(){return _.getUniformLocation(d,y)},'uniform "'+y+'" not present in program.')}function hd(_,v,d){return _.getUniformLocation(v,d)}function kh(_,v,d,y,C,z){Kn(_,v,function(){return Wp(_,v,y,z)}),Kn(_,v,function(){return _.uniform1i(C,z)})}function nl(_,v,d,y){Kn(_,v,function(){return _.bindFramebuffer(_.FRAMEBUFFER,y)}),Kn(_,v,function(){return _.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,d,0)})}function hf(_,v,d){Kn(_,v,function(){return _.bindFramebuffer(_.FRAMEBUFFER,d)}),Kn(_,v,function(){return _.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,null,0)})}function Ha(_){var v=_.checkFramebufferStatus(_.FRAMEBUFFER);if(v!==_.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Tl(_,v))}function Tl(_,v){switch(v){case _.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case _.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case _.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case _.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+v}}function ba(_,v,d,y){var C=Kn(_,v,function(){return d()});if(C==null)throw new Error(y);return C}function Dc(_,v){var d=_.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,y=v+_.TEXTURE0;if(y<_.TEXTURE0||y>d)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+d+"].")}function ws(_,v){return v===void 0&&(v=2),ze(_.slice(0,_.length-v))}function La(_){if(_.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[_.length>1?_[_.length-2]:1,_[_.length-1]]}function Nc(_){var v=[1,1,1];return _.length===0||_.length===1&&_[0]===1||(v=[ws(_)].concat(La(_))),v}function pf(_,v){var d;v===void 0&&(v=!1);var y=j().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(v&&(y*=2,(_=_.map(function(xe,Oe){return Oe>=_.length-2?It(_[Oe]):_[Oe]})).length===1&&(_=[2,_[0]])),_.length!==2){var C=sn(_);_=C.newShape}var z=ze(_);if(_.length<=1&&z<=y)return[1,z];if(_.length===2&&_[0]<=y&&_[1]<=y)return _;if(_.length===3&&_[0]*_[1]<=y&&_[2]<=y)return[_[0]*_[1],_[2]];if(_.length===3&&_[0]<=y&&_[1]*_[2]<=y)return[_[0],_[1]*_[2]];if(_.length===4&&_[0]*_[1]*_[2]<=y&&_[3]<=y)return[_[0]*_[1]*_[2],_[3]];if(_.length===4&&_[0]<=y&&_[1]*_[2]*_[3]<=y)return[_[0],_[1]*_[2]*_[3]];if(v){var Z=ws(_),re=2,fe=2;return _.length&&(re=(d=La(_))[0],fe=d[1]),vt(z=Z*(re/2)*(fe/2)).map(function(xe){return 2*xe})}return vt(z)}function Ic(_){return _%2==0}function Iu(_,v){if(Ut(_=_.slice(-2),v=v.slice(-2))||!_.length||!v.length||_[0]===0||_[1]===0||v[0]===0||v[1]===0)return!0;if(_.length!==v.length){var d=_.slice(-1)[0],y=v.slice(-1)[0];if(d===y||Ic(d)&&Ic(y)&&(_[0]===1||v[0]===1))return!0}return _[1]===v[1]&&Ic(_[0])&&Ic(v[0])}function Ah(_){if(_a==null){var v=ni(_);_a=v.getParameter(v.MAX_TEXTURE_SIZE)}return _a}function pd(_){if(Ds==null){var v=ni(_);Ds=v.getParameter(v.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Ds)}function md(_){if(_===0)return 0;var v=ni(_);return Ea(v,"EXT_disjoint_timer_query_webgl2")&&_===2?2:Ea(v,"EXT_disjoint_timer_query")?1:0}function Ea(_,v){return _.getExtension(v)!=null}function Oh(_){try{if(ni(_)!=null)return!0}catch{return!1}return!1}function Vp(_){if(_===0)return!1;var v=ni(_);if(_===1){if(!Ea(v,"OES_texture_float"))return!1}else if(!Ea(v,"EXT_color_buffer_float"))return!1;return vd(v)}function gd(_){if(_===0)return!1;var v=ni(_);return _!==1?Ea(v,"EXT_color_buffer_float")?vd(v):!!Ea(v,"EXT_color_buffer_half_float")&&function(d,y){var C=Jr(d,y),z=d.createTexture();d.bindTexture(d.TEXTURE_2D,z),d.texImage2D(d.TEXTURE_2D,0,C.internalFormatHalfFloat,1,1,0,C.textureFormatFloat,C.textureTypeHalfFloat,null);var Z=d.createFramebuffer();d.bindFramebuffer(d.FRAMEBUFFER,Z),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,z,0);var re=d.checkFramebufferStatus(d.FRAMEBUFFER)===d.FRAMEBUFFER_COMPLETE;return d.bindTexture(d.TEXTURE_2D,null),d.bindFramebuffer(d.FRAMEBUFFER,null),d.deleteTexture(z),d.deleteFramebuffer(Z),re}(v,v.getExtension("EXT_color_buffer_half_float")):!!Ea(v,"OES_texture_float")&&!!Ea(v,"WEBGL_color_buffer_float")&&vd(v)}function vd(_){var v=Jr(_),d=_.createTexture();_.bindTexture(_.TEXTURE_2D,d),_.texImage2D(_.TEXTURE_2D,0,v.internalFormatFloat,1,1,0,v.textureFormatFloat,v.textureTypeFloat,null);var y=_.createFramebuffer();_.bindFramebuffer(_.FRAMEBUFFER,y),_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,d,0);var C=_.checkFramebufferStatus(_.FRAMEBUFFER)===_.FRAMEBUFFER_COMPLETE;return _.bindTexture(_.TEXTURE_2D,null),_.bindFramebuffer(_.FRAMEBUFFER,null),_.deleteTexture(d),_.deleteFramebuffer(y),C}function Ns(_){return _===2&&ni(_).fenceSync!=null}var yd=Object.freeze({callAndCheck:Kn,canBeRepresented:Wr,getWebGLErrorMessage:so,getExtensionOrThrow:Wi,createVertexShader:no,createFragmentShader:So,createProgram:ro,linkProgram:Mc,validateProgram:Gu,createStaticVertexBuffer:el,createStaticIndexBuffer:fc,getNumChannels:function(){return j().getNumber("WEBGL_VERSION")===2?1:4},createTexture:tl,validateTextureSize:Up,createFramebuffer:xs,bindVertexBufferToProgramAttribute:dd,bindTextureUnit:Wp,unbindTextureUnit:function(_,v,d){Dc(_,d),Kn(_,v,function(){return _.activeTexture(_.TEXTURE0+d)}),Kn(_,v,function(){return _.bindTexture(_.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:dc,getProgramUniformLocation:hd,bindTextureToProgramUniformSampler:kh,bindCanvasToFramebuffer:function(_,v){Kn(_,v,function(){return _.bindFramebuffer(_.FRAMEBUFFER,null)}),Kn(_,v,function(){return _.viewport(0,0,_.canvas.width,_.canvas.height)}),Kn(_,v,function(){return _.scissor(0,0,_.canvas.width,_.canvas.height)})},bindColorTextureToFramebuffer:nl,unbindColorTextureFromFramebuffer:hf,validateFramebuffer:Ha,getFramebufferErrorMessage:Tl,getBatchDim:ws,getRowsCols:La,getShapeAs3D:Nc,getTextureShapeFromLogicalShape:pf,isReshapeFree:Iu,getWebGLMaxTextureSize:Ah,resetMaxTextureSize:function(){_a=null},resetMaxTexturesInShader:function(){Ds=null},getMaxTexturesInShader:pd,getWebGLDisjointQueryTimerVersion:md,hasExtension:Ea,isWebGLVersionEnabled:Oh,isCapableOfRenderingToFloatTexture:Vp,isDownloadFloatTextureEnabled:gd,isWebGLFenceEnabled:Ns}),br=j();function qu(){j().set("PROD",!0)}function Qm(){j().set("DEBUG",!0)}function Zm(){j().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function bd(_){j().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(_+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function mf(){He.disposeVariables()}function Hp(){return He}function Th(){return He.memory()}function Mh(_){return He.profile(_)}function qi(_,v){return He.tidy(_,v)}function zo(_){fn(_).forEach(function(v){return v.dispose()})}function Dh(_){return He.keep(_)}function Yg(_){return He.time(_)}function xd(_){return He.setBackend(_)}function Gp(){return He.ready()}function Is(){return He.backendName}function Fc(_){He.removeBackend(_)}function qp(_){return He.findBackend(_)}function eg(_){return He.findBackendFactory(_)}function tg(_,v,d){return d===void 0&&(d=1),He.registerBackend(_,v,d)}function Jg(){return He.backend}function Qg(_,v){j().setPlatform(_,v)}function Ml(){for(var _=[],v=0;v<arguments.length;v++)_[v]=arguments[v];j().getBool("IS_TEST")||console.warn.apply(console,_)}function Qa(_,v){var d=_;if(ft(_))return v==="string"?[]:[_.length];if(!Array.isArray(_))return[];for(var y=[];Array.isArray(d)||ft(d)&&v!=="string";)y.push(d.length),d=d[0];return Array.isArray(_)&&j().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function C(z,Z,re){if(re=re||[],Array.isArray(z)||ft(z)){we(Z.length>0,function(){return"Element arr["+re.join("][")+"] should be a primitive, but is an array of "+z.length+" elements"}),we(z.length===Z[0],function(){return"Element arr["+re.join("][")+"] should have "+Z[0]+" elements, but has "+z.length+" elements"});for(var fe=Z.slice(1),xe=0;xe<z.length;++xe)C(z[xe],fe,re.concat(xe))}else we(Z.length===0,function(){return"Element arr["+re.join("][")+"] is a primitive, but should be an array/TypedArray of "+Z[0]+" elements"})}(_,y,[]),y}function Nh(_,v,d,y){if(_!=null&&(_!=="numeric"&&_!==v||_==="numeric"&&v==="string"))throw new Error("Argument '"+d+"' passed to '"+y+"' must be "+_+" tensor, but got "+v+" tensor")}function Ze(_,v,d,y){if(y===void 0&&(y="numeric"),_ instanceof Qt)return Nh(y,_.dtype,v,d),_;var C=Ce(_);if(C!=="string"&&["bool","int32","float32"].indexOf(y)>=0&&(C=y),Nh(y,C,v,d),_==null||!ft(_)&&!Array.isArray(_)&&typeof _!="number"&&typeof _!="boolean"&&typeof _!="string"){var z=_==null?"null":_.constructor.name;throw new Error("Argument '"+v+"' passed to '"+d+"' must be a Tensor or TensorLike, but got '"+z+"'")}var Z=Qa(_,C);ft(_)||Array.isArray(_)||(_=[_]);var re=C!=="string"?Gt(_,C,j().getBool("DEBUG")):Ot(_,[],!0);return He.makeTensor(re,Z,C)}function hc(_,v,d,y){if(y===void 0&&(y="numeric"),!Array.isArray(_))throw new Error("Argument "+v+" passed to "+d+" must be a `Tensor[]` or `TensorLike[]`");return _.map(function(C,z){return Ze(C,v+"["+z+"]",d)},y)}function wd(_,v){for(var d=0;d<_.length;++d)if(_[_.length-d-1]!==v-1-d)return!1;return!0}function $p(_,v,d){for(var y=_.length+v.length,C=[],z=0,Z=0,re=0;re<y;re++)d.indexOf(re)===-1?C.push(_[z++]):C.push(v[Z++]);return C}function Po(_,v){for(var d=[],y=_.length,C=0;C<y;C++)v.indexOf(C)===-1&&d.push(_[C]);return[d,v.map(function(z){return _[z]})]}function Lo(_,v){return $p(_,v.map(function(d){return 1}),v)}function ia(_,v,d){we(wd(v,d),function(){return _+" supports only inner-most axes for now. Got axes "+v+" and rank-"+d+" input."})}function Ba(_,v){if(wd(_,v))return null;for(var d=[],y=0;y<v;++y)_.indexOf(y)===-1&&d.push(y);return _.forEach(function(C){return d.push(C)}),d}function $u(_){return _.map(function(v,d){return[d,v]}).sort(function(v,d){return v[1]-d[1]}).map(function(v){return v[0]})}function ja(_,v){for(var d=[],y=v-_;y<v;++y)d.push(y);return d}function rl(_,v){var d=_[0].length;_.forEach(function(C,z){we(C.length===d,function(){return"Error in concat"+d+"D: rank of tensors["+z+"] must be the same as the rank of the rest ("+d+")"})}),we(v>=0&&v<d,function(){return"Error in concat"+d+"D: axis must be between 0 and "+(d-1)+"."});var y=_[0];_.forEach(function(C,z){for(var Z=0;Z<d;Z++)we(Z===v||C[Z]===y[Z],function(){return"Error in concat"+d+"D: Shape of tensors["+z+"] ("+C+") does not match the shape of the rest ("+y+") along the non-concatenated axis "+z+"."})})}function _u(_,v){for(var d=_[0].slice(),y=1;y<_.length;y++)d[v]+=_[y][v];return d}function Lt(_){var v=Object.keys(_);if(v.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+v.length+" keys.");var d=v[0],y=_[d];d.endsWith("_")&&(d=d.substring(0,d.length-1));var C=function(){for(var z=[],Z=0;Z<arguments.length;Z++)z[Z]=arguments[Z];He.startScope(d);try{var re=y.apply(void 0,z);return re instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),He.endScope(re),re}catch(fe){throw He.endScope(null),fe}};return Object.defineProperty(C,"name",{value:d,configurable:!0}),C}br.registerFlag("HAS_WEBGL",function(){return br.getNumber("WEBGL_VERSION")>0}),br.registerFlag("WEBGL_VERSION",function(){return Oh(2)?2:Oh(1)?1:0}),br.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return br.get("WEBGL_VERSION")===2}),br.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),br.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),br.registerFlag("WEBGL_PACK",function(){return br.getBool("HAS_WEBGL")}),br.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return br.getBool("WEBGL_PACK")}),br.registerFlag("WEBGL_PACK_CLIP",function(){return br.getBool("WEBGL_PACK")}),br.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),br.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return br.getBool("WEBGL_PACK")}),br.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return br.getBool("WEBGL_PACK")}),br.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return br.getBool("WEBGL_PACK")}),br.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return br.getBool("WEBGL_PACK")}),br.registerFlag("WEBGL_PACK_REDUCE",function(){return br.getBool("WEBGL_PACK")}),br.registerFlag("WEBGL_LAZILY_UNPACK",function(){return br.getBool("WEBGL_PACK")}),br.registerFlag("WEBGL_CONV_IM2COL",function(){return br.getBool("WEBGL_PACK")}),br.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return Ah(br.getNumber("WEBGL_VERSION"))}),br.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return pd(br.getNumber("WEBGL_VERSION"))}),br.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var _=br.getNumber("WEBGL_VERSION");return _===0?0:md(_)}),br.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return br.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(_=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(_)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(_.substr(0,4))));var _}),br.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return Vp(br.getNumber("WEBGL_VERSION"))}),br.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!br.getBool("WEBGL_FORCE_F16_TEXTURES")&&br.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),br.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return gd(br.getNumber("WEBGL_VERSION"))}),br.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return Ns(br.getNumber("WEBGL_VERSION"))}),br.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return br.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),Rr=bd;var Co=Lt({complex_:function(_,v){var d=Ze(_,"real","complex"),y=Ze(v,"imag","complex");return yt(d.shape,y.shape,"real and imag shapes, "+d.shape+" and "+y.shape+", must match in call to tf.complex()."),He.runKernelFunc(function(C){return C.complex(d,y)},{$real:d,$imag:y})}}),xa=Lt({real_:function(_){var v=Ze(_,"input","real");return He.runKernelFunc(function(d){return d.real(v)},{$input:v})}}),Za=Lt({imag_:function(_){var v=Ze(_,"input","imag");return He.runKernelFunc(function(d){return d.imag(v)},{$input:v})}});function No(_,v,d){return Fs(_,v,Qa(_,d),d)}function Fs(_,v,d,y){if(y==null&&(y=Ce(_)),y==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!ft(_)&&!Array.isArray(_)&&typeof _!="number"&&typeof _!="boolean"&&typeof _!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(v!=null){Vn(v);var C=ze(v),z=ze(d);we(C===z,function(){return"Based on the provided shape, ["+v+"], the tensor should have "+C+" values but has "+z});for(var Z=0;Z<d.length;++Z){var re=d[Z],fe=Z!==d.length-1||re!==ze(v.slice(Z));we(d[Z]===v[Z]||!fe,function(){return"Error creating a new Tensor. Inferred shape ("+d+") does not match the provided shape ("+v+"). "})}}return ft(_)||Array.isArray(_)||(_=[_]),v=v||d,_=y!=="string"?Gt(_,y,j().getBool("DEBUG")):Ot(_,[],!0),He.makeTensor(_,v,y)}function Ar(_,v){if((ft(_)&&v!=="string"||Array.isArray(_))&&v!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(v==="string"&&ft(_)&&!(_ instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Fs(_,[],[],v)}function au(_,v){Bt(_);var d=Qa(_,v);if(d.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Fs(_,null,d,v)}function Eu(_,v,d){if(Bt(_),v!=null&&v.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var y=Qa(_,d);if(y.length!==2&&y.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(y.length===1&&v==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Fs(_,v,y,d)}function Dl(_,v,d){if(Bt(_),v!=null&&v.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var y=Qa(_,d);if(y.length!==3&&y.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(y.length===1&&v==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Fs(_,v,y,d)}function su(_,v,d){if(Bt(_),v!=null&&v.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var y=Qa(_,d);if(y.length!==4&&y.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(y.length===1&&v==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Fs(_,v,y,d)}function Ih(_,v,d){if(Bt(_),v!=null&&v.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var y=Qa(_,d);if(y.length!==5&&y.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(y.length===1&&v==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Fs(_,v,y,d)}function Xp(_,v,d){if(Bt(_),v!=null&&v.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var y=Qa(_,d);if(y.length!==6&&y.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(y.length===1&&v==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Fs(_,v=v||y,y,d)}function Kp(_,v,d,y){return v===void 0&&(v=!0),He.makeVariable(_,v,d,y)}function Fu(_,v){if(v===void 0&&(v="float32"),v==="complex64"){var d=Fu(_,"float32"),y=uo(_,"float32");return Co(d,y)}var C=Kt(ze(_),v);return He.makeTensor(C,_,v)}function uo(_,v){if(v===void 0&&(v="float32"),v==="complex64"){var d=uo(_,"float32"),y=uo(_,"float32");return Co(d,y)}var C=Vt(ze(_),v);return He.makeTensor(C,_,v)}function Rs(_,v,d){return He.runKernelFunc(function(y){return y.fill(_,v,d)},{})}function Fh(_,v,d){if(d<=0)throw new Error("The number of values should be positive.");return He.runKernelFunc(function(y){return y.linspace(_,v,d)},{})}function Rc(_,v,d,y){if(d===void 0&&(d=1),y===void 0&&(y="float32"),d===0)throw new Error("Cannot have a step of zero");if(_===v||_<v&&d<0||v<_&&d>1)return uo([0],y);var C=Vt(Math.abs(Math.ceil((v-_)/d)),y);v<_&&d===1&&(d=-1),C[0]=_;for(var z=1;z<C.length;z++)C[z]=C[z-1]+d;return au(C,y)}var _s=Lt({onesLike_:function(_){var v=Ze(_,"x","onesLike");if(v.dtype==="complex64"){var d=_s(xa(v)),y=vi(Za(v));return Co(d,y)}return He.runKernelFunc(function(C){return C.onesLike(v)},{$x:v},function(C,z){return{$x:function(){return vi(C)}}})}}),vi=Lt({zerosLike_:function(_){var v=Ze(_,"x","zerosLike");return He.runKernelFunc(function(d){return d.zerosLike(v)},{$x:v},function(d,y){return{$x:function(){return vi(d)}}})}}),$o=Lt({concat_:function(_,v){v===void 0&&(v=0),we(_.length>=1,function(){return"Pass at least one tensor to concat"});var d=hc(_,"tensors","concat");d[0].dtype==="complex64"&&d.forEach(function(re){if(re.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+re.dtype+". ")}),v=Xt(v,d[0].shape)[0];var y=_u(d.map(function(re){return re.shape}),v);if(ze(y)===0)return No([],y);if((d=d.filter(function(re){return re.size>0})).length===1)return d[0];var C=d.map(function(re){return re.shape});rl(C,v);var z=d,Z={axis:v};return He.runKernelFunc(function(re){return re.concat(d,v)},z,function(re){var fe=C.map(function(xe){return xe[v]});return $i(re,fe,v).map(function(xe){return function(){return xe}})},"Concat",Z)}}),Rh=Lt({concat1d_:function(_){return $o(_,0)}}),Yp=Lt({concat2d_:function(_,v){return $o(_,v)}}),gf=Lt({concat3d_:function(_,v){return $o(_,v)}}),Ph=Lt({concat4d_:function(_,v){return $o(_,v)}}),$i=Lt({split_:function(_,v,d){d===void 0&&(d=0);var y,C=Ze(_,"x","split");return d=Xt(d,C.shape)[0],typeof v=="number"?(we(C.shape[d]%v==0,function(){return"Number of splits must evenly divide the axis."}),y=new Array(v).fill(C.shape[d]/v)):(we(C.shape[d]===v.reduce(function(z,Z){return z+Z}),function(){return"The sum of sizes must match the size of the axis dimension."}),y=v),He.runKernelFunc(function(z){return z.split(C,y,d)},{$x:C},function(z){return{$x:function(){return $o(z,d)}}})}});function Ii(_,v){return _(v={exports:{}},v.exports),v.exports}var ma=Ii(function(_){(function(v,d,y){function C(Z,re){return re.c=Z.c,re.s0=Z.s0,re.s1=Z.s1,re.s2=Z.s2,re}function z(Z,re){var fe=new function(Re){var Le,Be=this,Xe=(Le=4022871197,function(nt){nt=nt.toString();for(var tt=0;tt<nt.length;tt++){var ut=.02519603282416938*(Le+=nt.charCodeAt(tt));ut-=Le=ut>>>0,Le=(ut*=Le)>>>0,Le+=4294967296*(ut-=Le)}return 23283064365386963e-26*(Le>>>0)});Be.next=function(){var nt=2091639*Be.s0+23283064365386963e-26*Be.c;return Be.s0=Be.s1,Be.s1=Be.s2,Be.s2=nt-(Be.c=0|nt)},Be.c=1,Be.s0=Xe(" "),Be.s1=Xe(" "),Be.s2=Xe(" "),Be.s0-=Xe(Re),Be.s0<0&&(Be.s0+=1),Be.s1-=Xe(Re),Be.s1<0&&(Be.s1+=1),Be.s2-=Xe(Re),Be.s2<0&&(Be.s2+=1),Xe=null}(Z),xe=re&&re.state,Oe=fe.next;return Oe.int32=function(){return 4294967296*fe.next()|0},Oe.double=function(){return Oe()+11102230246251565e-32*(2097152*Oe()|0)},Oe.quick=Oe,xe&&(typeof xe=="object"&&C(xe,fe),Oe.state=function(){return C(fe,{})}),Oe}d&&d.exports?d.exports=z:this.alea=z})(0,_)}),Jp=Ii(function(_){(function(v,d,y){function C(Z,re){return re.x=Z.x,re.y=Z.y,re.z=Z.z,re.w=Z.w,re}function z(Z,re){var fe=new function(Re){var Le=this,Be="";Le.x=0,Le.y=0,Le.z=0,Le.w=0,Le.next=function(){var nt=Le.x^Le.x<<11;return Le.x=Le.y,Le.y=Le.z,Le.z=Le.w,Le.w^=Le.w>>>19^nt^nt>>>8},Re===(0|Re)?Le.x=Re:Be+=Re;for(var Xe=0;Xe<Be.length+64;Xe++)Le.x^=0|Be.charCodeAt(Xe),Le.next()}(Z),xe=re&&re.state,Oe=function(){return(fe.next()>>>0)/4294967296};return Oe.double=function(){do var Re=((fe.next()>>>11)+(fe.next()>>>0)/4294967296)/2097152;while(Re===0);return Re},Oe.int32=fe.next,Oe.quick=Oe,xe&&(typeof xe=="object"&&C(xe,fe),Oe.state=function(){return C(fe,{})}),Oe}d&&d.exports?d.exports=z:this.xor128=z})(0,_)}),Qp=Ii(function(_){(function(v,d,y){function C(Z,re){return re.x=Z.x,re.y=Z.y,re.z=Z.z,re.w=Z.w,re.v=Z.v,re.d=Z.d,re}function z(Z,re){var fe=new function(Re){var Le=this,Be="";Le.next=function(){var nt=Le.x^Le.x>>>2;return Le.x=Le.y,Le.y=Le.z,Le.z=Le.w,Le.w=Le.v,(Le.d=Le.d+362437|0)+(Le.v=Le.v^Le.v<<4^nt^nt<<1)|0},Le.x=0,Le.y=0,Le.z=0,Le.w=0,Le.v=0,Re===(0|Re)?Le.x=Re:Be+=Re;for(var Xe=0;Xe<Be.length+64;Xe++)Le.x^=0|Be.charCodeAt(Xe),Xe==Be.length&&(Le.d=Le.x<<10^Le.x>>>4),Le.next()}(Z),xe=re&&re.state,Oe=function(){return(fe.next()>>>0)/4294967296};return Oe.double=function(){do var Re=((fe.next()>>>11)+(fe.next()>>>0)/4294967296)/2097152;while(Re===0);return Re},Oe.int32=fe.next,Oe.quick=Oe,xe&&(typeof xe=="object"&&C(xe,fe),Oe.state=function(){return C(fe,{})}),Oe}d&&d.exports?d.exports=z:this.xorwow=z})(0,_)}),Zp=Ii(function(_){(function(v,d,y){function C(Z,re){return re.x=Z.x.slice(),re.i=Z.i,re}function z(Z,re){Z==null&&(Z=+new Date);var fe=new function(Re){var Le=this;Le.next=function(){var Be,Xe,nt=Le.x,tt=Le.i;return Be=nt[tt],Xe=(Be^=Be>>>7)^Be<<24,Xe^=(Be=nt[tt+1&7])^Be>>>10,Xe^=(Be=nt[tt+3&7])^Be>>>3,Xe^=(Be=nt[tt+4&7])^Be<<7,Be=nt[tt+7&7],Xe^=(Be^=Be<<13)^Be<<9,nt[tt]=Xe,Le.i=tt+1&7,Xe},function(Be,Xe){var nt,tt=[];if(Xe===(0|Xe))tt[0]=Xe;else for(Xe=""+Xe,nt=0;nt<Xe.length;++nt)tt[7&nt]=tt[7&nt]<<15^Xe.charCodeAt(nt)+tt[nt+1&7]<<13;for(;tt.length<8;)tt.push(0);for(nt=0;nt<8&&tt[nt]===0;++nt);for(nt==8?tt[7]=-1:tt[nt],Be.x=tt,Be.i=0,nt=256;nt>0;--nt)Be.next()}(Le,Re)}(Z),xe=re&&re.state,Oe=function(){return(fe.next()>>>0)/4294967296};return Oe.double=function(){do var Re=((fe.next()>>>11)+(fe.next()>>>0)/4294967296)/2097152;while(Re===0);return Re},Oe.int32=fe.next,Oe.quick=Oe,xe&&(xe.x&&C(xe,fe),Oe.state=function(){return C(fe,{})}),Oe}d&&d.exports?d.exports=z:this.xorshift7=z})(0,_)}),ng=Ii(function(_){(function(v,d,y){function C(Z,re){return re.i=Z.i,re.w=Z.w,re.X=Z.X.slice(),re}function z(Z,re){Z==null&&(Z=+new Date);var fe=new function(Re){var Le=this;Le.next=function(){var Be,Xe,nt=Le.w,tt=Le.X,ut=Le.i;return Le.w=nt=nt+1640531527|0,Xe=tt[ut+34&127],Be=tt[ut=ut+1&127],Xe^=Xe<<13,Be^=Be<<17,Xe^=Xe>>>15,Be^=Be>>>12,Xe=tt[ut]=Xe^Be,Le.i=ut,Xe+(nt^nt>>>16)|0},function(Be,Xe){var nt,tt,ut,Nt,Pt,jt=[],Yt=128;for(Xe===(0|Xe)?(tt=Xe,Xe=null):(Xe+="\0",tt=0,Yt=Math.max(Yt,Xe.length)),ut=0,Nt=-32;Nt<Yt;++Nt)Xe&&(tt^=Xe.charCodeAt((Nt+32)%Xe.length)),Nt===0&&(Pt=tt),tt^=tt<<10,tt^=tt>>>15,tt^=tt<<4,tt^=tt>>>13,Nt>=0&&(Pt=Pt+1640531527|0,ut=(nt=jt[127&Nt]^=tt+Pt)==0?ut+1:0);for(ut>=128&&(jt[127&(Xe&&Xe.length||0)]=-1),ut=127,Nt=512;Nt>0;--Nt)tt=jt[ut+34&127],nt=jt[ut=ut+1&127],tt^=tt<<13,nt^=nt<<17,tt^=tt>>>15,nt^=nt>>>12,jt[ut]=tt^nt;Be.w=Pt,Be.X=jt,Be.i=ut}(Le,Re)}(Z),xe=re&&re.state,Oe=function(){return(fe.next()>>>0)/4294967296};return Oe.double=function(){do var Re=((fe.next()>>>11)+(fe.next()>>>0)/4294967296)/2097152;while(Re===0);return Re},Oe.int32=fe.next,Oe.quick=Oe,xe&&(xe.X&&C(xe,fe),Oe.state=function(){return C(fe,{})}),Oe}d&&d.exports?d.exports=z:this.xor4096=z})(0,_)}),pc=Ii(function(_){(function(v,d,y){function C(Z,re){return re.a=Z.a,re.b=Z.b,re.c=Z.c,re.d=Z.d,re}function z(Z,re){var fe=new function(Re){var Le=this,Be="";Le.next=function(){var nt=Le.b,tt=Le.c,ut=Le.d,Nt=Le.a;return nt=nt<<25^nt>>>7^tt,tt=tt-ut|0,ut=ut<<24^ut>>>8^Nt,Nt=Nt-nt|0,Le.b=nt=nt<<20^nt>>>12^tt,Le.c=tt=tt-ut|0,Le.d=ut<<16^tt>>>16^Nt,Le.a=Nt-nt|0},Le.a=0,Le.b=0,Le.c=-1640531527,Le.d=1367130551,Re===Math.floor(Re)?(Le.a=Re/4294967296|0,Le.b=0|Re):Be+=Re;for(var Xe=0;Xe<Be.length+20;Xe++)Le.b^=0|Be.charCodeAt(Xe),Le.next()}(Z),xe=re&&re.state,Oe=function(){return(fe.next()>>>0)/4294967296};return Oe.double=function(){do var Re=((fe.next()>>>11)+(fe.next()>>>0)/4294967296)/2097152;while(Re===0);return Re},Oe.int32=fe.next,Oe.quick=Oe,xe&&(typeof xe=="object"&&C(xe,fe),Oe.state=function(){return C(fe,{})}),Oe}d&&d.exports?d.exports=z:this.tychei=z})(0,_)}),Ps=Ii(function(_){(function(v,d){var y,C=this,z=256,Z=6,re="random",fe=d.pow(z,Z),xe=d.pow(2,52),Oe=2*xe,Re=z-1;function Le(ut,Nt,Pt){var jt=[],Yt=nt(function vn(Cn,Dn){var b,p=[],l=typeof Cn;if(Dn&&l=="object")for(b in Cn)try{p.push(vn(Cn[b],Dn-1))}catch{}return p.length?p:l=="string"?Cn:Cn+"\0"}((Nt=Nt==1?{entropy:!0}:Nt||{}).entropy?[ut,tt(v)]:ut??function(){try{var vn;return y&&(vn=y.randomBytes)?vn=vn(z):(vn=new Uint8Array(z),(C.crypto||C.msCrypto).getRandomValues(vn)),tt(vn)}catch{var Cn=C.navigator,Dn=Cn&&Cn.plugins;return[+new Date,C,Dn,C.screen,tt(v)]}}(),3),jt),gn=new Be(jt),wn=function(){for(var vn=gn.g(Z),Cn=fe,Dn=0;vn<xe;)vn=(vn+Dn)*z,Cn*=z,Dn=gn.g(1);for(;vn>=Oe;)vn/=2,Cn/=2,Dn>>>=1;return(vn+Dn)/Cn};return wn.int32=function(){return 0|gn.g(4)},wn.quick=function(){return gn.g(4)/4294967296},wn.double=wn,nt(tt(gn.S),v),(Nt.pass||Pt||function(vn,Cn,Dn,b){return b&&(b.S&&Xe(b,gn),vn.state=function(){return Xe(gn,{})}),Dn?(d[re]=vn,Cn):vn})(wn,Yt,"global"in Nt?Nt.global:this==d,Nt.state)}function Be(ut){var Nt,Pt=ut.length,jt=this,Yt=0,gn=jt.i=jt.j=0,wn=jt.S=[];for(Pt||(ut=[Pt++]);Yt<z;)wn[Yt]=Yt++;for(Yt=0;Yt<z;Yt++)wn[Yt]=wn[gn=Re&gn+ut[Yt%Pt]+(Nt=wn[Yt])],wn[gn]=Nt;(jt.g=function(vn){for(var Cn,Dn=0,b=jt.i,p=jt.j,l=jt.S;vn--;)Cn=l[b=Re&b+1],Dn=Dn*z+l[Re&(l[b]=l[p=Re&p+Cn])+(l[p]=Cn)];return jt.i=b,jt.j=p,Dn})(z)}function Xe(ut,Nt){return Nt.i=ut.i,Nt.j=ut.j,Nt.S=ut.S.slice(),Nt}function nt(ut,Nt){for(var Pt,jt=ut+"",Yt=0;Yt<jt.length;)Nt[Re&Yt]=Re&(Pt^=19*Nt[Re&Yt])+jt.charCodeAt(Yt++);return tt(Nt)}function tt(ut){return String.fromCharCode.apply(0,ut)}if(d["seed"+re]=Le,nt(d.random(),v),_.exports){_.exports=Le;try{y=r(251)}catch{}}})([],Math)});Ps.alea=ma,Ps.xor128=Jp,Ps.xorwow=Qp,Ps.xorshift7=Zp,Ps.xor4096=ng,Ps.tychei=pc;var Nl=Ps.alea,Ks=function(){function _(v,d,y,C,z){this.mean=v,this.stdDev=d,this.dtype=y,this.nextVal=NaN,this.truncated=C,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var Z=z||Math.random();this.random=Nl(Z.toString())}return _.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var v=this.nextVal;return this.nextVal=NaN,v}for(var d,y,C=!1;!C;){var z=void 0,Z=void 0,re=void 0;do re=(z=2*this.random()-1)*z+(Z=2*this.random()-1)*Z;while(re>=1||re===0);var fe=Math.sqrt(-2*Math.log(re)/re);d=this.mean+this.stdDev*z*fe,y=this.mean+this.stdDev*Z*fe,this.truncated&&!this.isValidTruncated(d)||(C=!0)}return this.truncated&&!this.isValidTruncated(y)||(this.nextVal=this.convertValue(y)),this.convertValue(d)},_.prototype.convertValue=function(v){return this.dtype==null||this.dtype==="float32"?v:Math.round(v)},_.prototype.isValidTruncated=function(v){return v<=this.upper&&v>=this.lower},_}(),Su=function(){function _(v,d,y,C){this.alpha=v,this.beta=1/d,this.dtype=y;var z=C||Math.random();this.randu=Nl(z.toString()),this.randn=new Ks(0,1,y,!1,this.randu()),this.d=v<1?v+2/3:v-1/3,this.c=1/Math.sqrt(9*this.d)}return _.prototype.nextValue=function(){for(var v,d,y,C,z,Z;;){do C=this.randn.nextValue(),Z=1+this.c*C;while(Z<=0);if(Z*=Z*Z,d=1-.331*(v=C*C)*v,y=.5*v+this.d*(1-Z+Math.log(Z)),(z=this.randu())<d||Math.log(z)<y)break}return Z=1/this.beta*this.d*Z,this.alpha<1&&(Z*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(Z)},_.prototype.convertValue=function(v){return this.dtype==="float32"?v:Math.round(v)},_}(),Lh=function(){function _(v,d,y,C){var z=this;if(v===void 0&&(v=0),d===void 0&&(d=1),this.canReturnFloat=function(){return z.dtype==null||z.dtype==="float32"},this.min=v,this.range=d-v,this.dtype=y,C==null&&(C=Math.random()),typeof C=="number"&&(C=C.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+v+" - "+d+" <= 1 and dtype is not float");this.random=Nl(C)}return _.prototype.convertValue=function(v){return this.canReturnFloat()?v:Math.round(v)},_.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},_}();function Hi(_,v,d){return v===void 0&&(v="float32"),v=v||"float32",Vn(_),new qr(_,v,d)}function _d(_,v){v===void 0&&(v=!1),console.log(_.toString(v))}var Il=Lt({batchToSpaceND_:function(_,v,d){var y=Ze(_,"x","batchToSpaceND"),C=v.reduce(function(z,Z){return z*Z});return we(y.rank>=1+v.length,function(){return"input rank is "+y.rank+" but should be > than blockShape.length "+v.length}),we(d.length===v.length,function(){return"crops.length is "+d.length+" but should be equal to blockShape.length  "+v.length}),we(y.shape[0]%C==0,function(){return"input tensor batch is "+y.shape[0]+" but is not divisible by the product of the elements of blockShape "+v.join(" * ")+" === "+C}),He.runKernelFunc(function(z){return z.batchToSpaceND(y,v,d)},{$x:y},function(z){return{$x:function(){return z.spaceToBatchND(v,d)}}})}}),vf=Lt({broadcastTo_:function(_,v){var d=Ze(_,"broadcastTo","x"),y=d.shape;if(v.some(function(fe){return!(fe>0)||fe%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+v+"].");if(v.length<d.rank)throw new Error("broadcastTo(): shape.length="+v.length+" < input.rank="+d.rank+".");if(v.length>d.rank){for(var C=d.shape.slice();C.length<v.length;)C.unshift(1);d=d.reshape(C)}for(var z=Array.from(v),Z=v.length-1;Z>=0;Z--)if(d.shape[Z]===v[Z])z[Z]=1;else if(d.shape[Z]!==1)throw new Error("broadcastTo(): ["+y+"] cannot be broadcast to ["+v+"].");var re=z.map(function(fe,xe){return fe>1?xe:-1}).filter(function(fe){return fe>=0});return re.length===0?d.clone():He.runKernelFunc(function(fe){return fe.tile(d,z)},{input:d},function(fe){return{input:function(){return fe.sum(re,!0)}}})}}),em=Lt({cast_:function(_,v){var d=Ze(_,"x","cast");if(!Ye(v))throw new Error("Failed to cast to unknown dtype "+v);if(v==="string"&&d.dtype!=="string"||v!=="string"&&d.dtype==="string")throw new Error("Only strings can be casted to strings");var y={dtype:v};return He.runKernelFunc(function(C){return C.cast(d,v)},{x:d},function(C){return{x:function(){return C.clone()}}},"Cast",y)}}),rg=Lt({clone_:function(_){var v=Ze(_,"x","clone",null);return He.runKernelFunc(function(){return He.makeTensorFromDataId(v.dataId,v.shape,v.dtype)},{$x:v},function(d){return{$x:function(){return d.toFloat()}}})}}),yf=Lt({cumsum_:function(_,v,d,y){v===void 0&&(v=0),d===void 0&&(d=!1),y===void 0&&(y=!1);var C=Ze(_,"x","cumsum"),z=Ba([v|=0],C.rank),Z=C;z!=null&&(Z=C.transpose(z));var re=ja(1,C.rank)[0],fe=He.runKernelFunc(function(xe){return xe.cumsum(Z,re,d,y)},{permutedX:Z},function(xe){return{permutedX:function(){return xe.cumsum(v,d,!y)}}});return z!=null&&(fe=fe.transpose(z)),fe}}),Bh=Lt({depthToSpace_:function(_,v,d){d===void 0&&(d="NHWC");var y=Ze(_,"x","depthToSpace"),C=d==="NHWC"?y.shape[1]:y.shape[2],z=d==="NHWC"?y.shape[2]:y.shape[3],Z=d==="NHWC"?y.shape[3]:y.shape[1];return we(C*v>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+C+" and "+v+`  for depthToSpace with input shape
      `+y.shape}),we(z*v>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+z+" and "+v+` for depthToSpace with input shape
          `+y.shape}),we(Z%(v*v)==0,function(){return"Dimension size must be evenly divisible by "+v*v+" but is "+Z+" for depthToSpace with input shape "+y.shape}),He.runKernelFunc(function(re){return re.depthToSpace(y,v,d)},{$x:y})}}),Xo=Lt({expandDims_:function(_,v){v===void 0&&(v=0);var d=Ze(_,"x","expandDims",null);we(v<=d.rank,function(){return"Axis must be <= rank of the tensor"});var y=d.shape.slice();return v<0&&(we(-(d.rank+1)<=v,function(){return"Axis must be in the interval ["+-(d.rank+1)+", "+d.rank+"]"}),v=d.rank+v+1),y.splice(v,0,1),ha(d,y)}}),jh=Lt({eye_:function(_,v,d,y){y===void 0&&(y="float32"),v==null&&(v=_);for(var C=Hi([_,v],y),z=_<=v?_:v,Z=0;Z<z;++Z)C.set(1,Z,Z);var re=C.toTensor().as2D(_,v);if(d==null)return re;if(d.length===1)return Ls(Xo(re,0),[d[0],1,1]);if(d.length===2)return Ls(Xo(Xo(re,0),0),[d[0],d[1],1,1]);if(d.length===3)return Ls(Xo(Xo(Xo(re,0),0),0),[d[0],d[1],d[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+d.length+"D.")}}),bf=Lt({multinomial_:function(_,v,d,y){y===void 0&&(y=!1);var C=Ze(_,"logits","multinomial"),z=C.size,Z=C.rank;if(z<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+z+".");if(Z>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+Z);d=d||Math.random();var re=Z===1?C.as2D(1,-1):C,fe=He.runKernelFunc(function(xe){return xe.multinomial(re,y,v,d)},{logits2D:re});return Z===1?fe.as1D():fe}}),zh=Lt({oneHot_:function(_,v,d,y){if(d===void 0&&(d=1),y===void 0&&(y=0),v<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+v);var C=Ze(_,"indices","oneHot","int32"),z=C.shape.concat([v]);return C=C.flatten(),He.runKernelFunc(function(Z){return Z.oneHot(C,v,d,y)},{$indices:C},function(Z){return{$indices:function(){return uo(C.shape,"float32")}}}).reshape(z)}}),xf=Lt({pad_:function(_,v,d){d===void 0&&(d=0);var y=Ze(_,"x","pad");if(y.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var C={paddings:v,constantValue:d};return He.runKernelFunc(function(z){return z.pad(y,v,d)},{x:y},function(z){var Z=v.map(function(re){return re[0]});return{x:function(){return z.slice(Z,y.shape)}}},"PadV2",C)}}),Fl=Lt({pad1d_:function(_,v,d){return d===void 0&&(d=0),we(v.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),xf(_,[v],d)}}),il=Lt({pad2d_:function(_,v,d){return d===void 0&&(d=0),we(v.length===2&&v[0].length===2&&v[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),xf(_,v,d)}}),Uh=Lt({pad3d_:function(_,v,d){return d===void 0&&(d=0),we(v.length===3&&v[0].length===2&&v[1].length===2&&v[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),xf(_,v,d)}}),Ed=Lt({pad4d_:function(_,v,d){return d===void 0&&(d=0),we(v.length===4&&v[0].length===2&&v[1].length===2&&v[2].length===2&&v[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),xf(_,v,d)}}),wf=Lt({rand_:function(_,v,d){var y=ze(_),C=null;if(d==null||d==="float32")C=new Float32Array(y);else if(d==="int32")C=new Int32Array(y);else{if(d!=="bool")throw new Error("Unknown data type "+d);C=new Uint8Array(y)}for(var z=0;z<y;z++)C[z]=v();return He.makeTensor(C,_,d)}}),ol=Lt({randomNormal_:function(_,v,d,y,C){if(v===void 0&&(v=0),d===void 0&&(d=1),y!=null&&y==="bool")throw new Error("Unsupported data type "+y);for(var z=new Ks(v,d,y,!1,C),Z=Hi(_,y),re=0;re<Z.values.length;re++)Z.values[re]=z.nextValue();return Z.toTensor()}}),Zg=Lt({randomGamma_:function(_,v,d,y,C){if(d===void 0&&(d=1),y===void 0&&(y="float32"),d==null&&(d=1),y==null&&(y="float32"),y!=="float32"&&y!=="int32")throw new Error("Unsupported data type "+y);for(var z=new Su(v,d,y,C),Z=Hi(_,y),re=0;re<Z.values.length;re++)Z.values[re]=z.nextValue();return Z.toTensor()}}),_f=Lt({randomUniform_:function(_,v,d,y,C){v===void 0&&(v=0),d===void 0&&(d=1),y===void 0&&(y="float32");for(var z=Hi(_,y),Z=new Lh(v,d,null,C),re=0;re<z.values.length;re++)z.values[re]=Z.nextValue();return z.toTensor()}}),ha=Lt({reshape_:function(_,v){var d=Ze(_,"x","reshape",null);v=_t(v,d.size),we(d.size===ze(v),function(){return"new shape and old shape must have the same number of elements."});var y={shape:v};return He.runKernelFunc(function(C){return C.reshape(d,v)},{x:d},function(C){return{x:function(){return C.reshape(d.shape)}}},"Reshape",y)}}),za=Lt({spaceToBatchND_:function(_,v,d){var y=Ze(_,"x","spaceToBatchND");return we(y.rank>=1+v.length,function(){return"input rank "+y.rank+" should be > than [blockShape] "+v.length}),we(d.length===v.length,function(){return"paddings.shape[0] "+d.length+" must be equal to [blockShape] "+v.length}),we(y.shape.reduce(function(C,z,Z){return Z>0&&Z<=v.length?C&&(z+d[Z-1][0]+d[Z-1][1])%v[Z-1]==0:C},!0),function(){return"input spatial dimensions "+y.shape.slice(1)+" with paddings "+d.toString()+" must be divisible by blockShapes "+v.toString()}),He.runKernelFunc(function(C){return C.spaceToBatchND(y,v,d)},{$x:y},function(C){return{$x:function(){return C.batchToSpaceND(v,d)}}})}}),Ga=Lt({squeeze_:function(_,v){var d=Ze(_,"x","squeeze");return ha(d,sn(d.shape,v).newShape)}}),Xi=Lt({stack_:function(_,v){v===void 0&&(v=0);var d=hc(_,"tensors","stack");if(we(d.length>=1,function(){return"Pass at least one tensor to tf.stack"}),d.length===1)return d[0].expandDims(v);var y=d[0].rank,C=d[0].shape,z=d[0].dtype;we(v<=y,function(){return"Axis must be <= rank of the tensor"}),d.forEach(function(re){yt(C,re.shape,"All tensors passed to stack must have matching shapes")}),d.forEach(function(re){we(z===re.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var Z=d.map(function(re){return re.expandDims(v)});return $o(Z,v)}}),Ls=Lt({tile_:function(_,v){var d=Ze(_,"x","tile",null);we(d.rank===v.length,function(){return"Error in transpose: rank of input "+d.rank+" must match length of reps "+v+"."});var y=[d],C={reps:v};return He.runKernelFunc(function(z,Z){var re=z.tile(d,v);return Z([d]),re},{x:d},function(z,Z){var re=Z[0];return{x:function(){var fe=vi(re);if(re.rank===1)for(var xe=0;xe<v[0];++xe)fe=fe.add(z.slice([xe*re.shape[0]],[re.shape[0]]));else if(re.rank===2)for(xe=0;xe<v[0];++xe)for(var Oe=0;Oe<v[1];++Oe)fe=fe.add(z.slice([xe*re.shape[0],Oe*re.shape[1]],[re.shape[0],re.shape[1]]));else if(re.rank===3)for(xe=0;xe<v[0];++xe)for(Oe=0;Oe<v[1];++Oe)for(var Re=0;Re<v[2];++Re)fe=fe.add(z.slice([xe*re.shape[0],Oe*re.shape[1],Re*re.shape[2]],[re.shape[0],re.shape[1],re.shape[2]]));else{if(re.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+re.rank+" tensors yet.");for(xe=0;xe<v[0];++xe)for(Oe=0;Oe<v[1];++Oe)for(Re=0;Re<v[2];++Re)for(var Le=0;Le<v[3];++Le)fe=fe.add(z.slice([xe*re.shape[0],Oe*re.shape[1],Re*re.shape[2],Le*re.shape[3]],[re.shape[0],re.shape[1],re.shape[2],re.shape[3]]))}return fe}}},"Tile",C,y)}}),al=Lt({truncatedNormal_:function(_,v,d,y,C){if(v===void 0&&(v=0),d===void 0&&(d=1),y!=null&&y==="bool")throw new Error("Unsupported data type "+y);for(var z=new Ks(v,d,y,!0,C),Z=Hi(_,y),re=0;re<Z.values.length;re++)Z.values[re]=z.nextValue();return Z.toTensor()}}),qa=Lt({unstack_:function(_,v){v===void 0&&(v=0),v=v||0;var d=Ze(_,"x","unstack");we(v>=-d.shape.length&&v<d.shape.length,function(){return"Axis = "+v+" is not in [-"+d.shape.length+", "+d.shape.length+")"}),v<0&&(v+=d.shape.length);var y={axis:v};return He.runKernelFunc(function(C){return C.unstack(d,v)},{x:d},function(C){return{x:function(){return Xi(C,v)}}},"Unpack",y)}}),sl=function(_,v){return D(this,void 0,void 0,function(){var d,y,C,z,Z,re,fe,xe,Oe,Re;return R(this,function(Le){switch(Le.label){case 0:return d=Ze(_,"x","setdiff1d"),y=Ze(v,"y","setdiff1d"),we(d.dtype===y.dtype,function(){return"x and y should have the same dtype, but got x ("+d.dtype+") and y ("+y.dtype+")."}),we(d.rank===1,function(){return"x should be 1D tensor, but got x ("+d.shape+")."}),we(y.rank===1,function(){return"y should be 1D tensor, but got y ("+y.shape+")."}),[4,d.data()];case 1:return C=Le.sent(),[4,y.data()];case 2:for(z=Le.sent(),Z=new Set(z),re=0,Oe=0;Oe<C.length;Oe++)Z.has(C[Oe])||re++;for(fe=new qr([re],d.dtype),xe=new qr([re],"int32"),Oe=0,Re=0;Oe<C.length;Oe++)Z.has(C[Oe])||(fe.values[Re]=C[Oe],xe.values[Re]=Oe,Re++);return[2,[fe.toTensor(),xe.toTensor()]]}})})};function mc(_,v,d,y){y===void 0&&(y=!0);var C=[];if(y)(C=C.concat(v.slice(0))).push(_[0]/d),C=C.concat(_.slice(1));else{C=C.concat(_[0]);for(var z=v.length,Z=0;Z<z;++Z)C=C.concat([_[Z+1]/v[Z],v[Z]]);C=C.concat(_.slice(z+1))}return C}function Sd(_,v,d){d===void 0&&(d=!0);var y=[];if(d){y.push(v);for(var C=v+1;C<_;++C)C<=2*v?(y.push(C),y.push(C-(v+1))):y.push(C)}else{var z=[],Z=[];for(C=1;C<_;++C)C>=2*v+1||C%2==1?Z.push(C):z.push(C);y.push.apply(y,z),y.push(0),y.push.apply(y,Z)}return y}function Cd(_,v,d,y){y===void 0&&(y=!0);var C=[];y?C.push(_[0]/d):C.push(_[0]*d);for(var z=1;z<_.length;++z)z<=v.length?y?C.push(v[z-1]*_[z]):C.push(_[z]/v[z-1]):C.push(_[z]);return C}function Rl(_,v){for(var d=[0],y=0;y<v;++y)d.push(_[y][0]);return d}function tm(_,v,d){for(var y=_.slice(0,1),C=0;C<d;++C)y.push(_[C+1]-v[C][0]-v[C][1]);return y}function gc(_,v){if(_.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+_.rank+".");if(v.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+v.rank+".");if(v.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+v.dtype+".");if(v.shape[v.rank-1]>_.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+v.shape[v.rank-1]+" vs. "+_.rank);if(_.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+_.shape+".");for(var d=v.shape,y=d[d.length-1],C=1,z=0;z<d.length-1;++z)C*=d[z];var Z=_.shape,re=d.slice();re.pop();var fe=1;for(z=y;z<_.rank;++z)fe*=Z[z],re.push(Z[z]);var xe=on(_.shape).map(function(Oe){return Oe/fe}).concat([1]).slice(0,y);return[re,C,fe,xe]}var e0=Object.freeze({prepareAndValidate:gc}),nm=30;function Ef(_){return _<=nm?_:Mr(_,Math.floor(Math.sqrt(_)))}function ig(_,v,d){var y=v.rank>1?v.shape[v.rank-1]:1,C=v.rank>1?v.rank-1:1,z="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+d.shape+", indices.shape: "+v.shape+", shape: "+_+", sliceDim: "+y+", and batchDim: "+C+".";if(d.rank<C)throw new Error(z+" update.rank < "+C+". ");if(_.length<y+(d.rank-C))throw new Error(z+" Output shape length < "+(y+(d.rank-C)));if(d.rank!==C+_.length-y)throw new Error(z+" update.rank != "+(C+_.length-y));for(var Z=0;Z<C;++Z)if(d.shape[Z]!==v.shape[Z])throw new Error(z+" updates.shape["+Z+"] ("+d.shape[Z]+") != indices.shape["+Z+"] ("+v.shape[Z]+").");for(Z=0;Z<d.rank-C;++Z)if(d.shape[Z+C]!==_[Z+y])throw new Error(z+" updates.shape["+(Z+C)+"] ("+d.shape[Z+C]+") != shape["+(Z+C)+"] ("+_[Z+C]+")")}function kd(_,v,d){if(v.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+v.rank+".");if(_.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+_.rank+".");if(v.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+v.dtype);if(d.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+d);if(d.length===0){if(v.size===0)throw new Error("Indices specified for empty output. indices shape: "+v.shape);if(_.size===0)throw new Error("Updates specified for empty output. updates shape: "+_.shape)}ig(d,v,_)}function Pl(_,v,d){for(var y=v.shape.length,C=y>1?v.shape[y-1]:1,z=d.length,Z=1,re=C;re<z;++re)Z*=d[re];var fe=C<1?1:C;return{sliceRank:C,numUpdates:ze(v.shape)/fe,sliceSize:Z,strides:on(d.slice(0,C)).concat([1]),outputSize:ze(d)}}var rm=Object.freeze({validateUpdateShape:ig,validateInput:kd,calculateShapes:Pl});function Wh(_,v,d){we(_.rank===v.length,function(){return"Error in slice"+_.rank+"D: Length of begin "+v+" must match the rank of the array ("+_.rank+")."}),we(_.rank===d.length,function(){return"Error in slice"+_.rank+"D: Length of size "+d+" must match the rank of the array ("+_.rank+")."});for(var y=function(z){we(v[z]+d[z]<=_.shape[z],function(){return"Error in slice"+_.rank+"D: begin["+z+"] + size["+z+"] ("+(v[z]+d[z])+") would overflow input.shape["+z+"] ("+_.shape[z]+")"})},C=0;C<_.rank;++C)y(C)}function Da(_){for(var v=[],d=0;_>0;)1&_&&v.push(d),_/=2,d++;return v}function Sf(_,v,d){for(var y=[],C=0;C<_.length;C++)y[C]=Math.ceil((v[C]-_[C])/d[C]);return y}function Bs(_,v,d,y,C){var z=v[C],Z=d[C]||1;(_&1<<C||z==null)&&(z=Z>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var re=y[C];return z<0&&(z+=re),lt(0,z,re-1)}function Cf(_,v,d,y,C){var z=v[C],Z=d[C]||1;(_&1<<C||z==null)&&(z=Z>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var re=y[C];return z<0&&(z+=re),Z>0?lt(0,z,re):lt(-1,z,re-1)}function Ad(_,v,d){for(var y=d.length,C=0;C<d.length;C++)if(d[C]>1){y=C;break}for(C=y+1;C<d.length;C++)if(v[C]>0||d[C]!==_[C])return!1;return!0}function Vh(_,v){for(var d=_.length>0?_[_.length-1]:1,y=0;y<_.length-1;y++)d+=_[y]*v[y];return d}var im=Object.freeze({assertParamsValid:Wh,maskToAxes:Da,computeOutShape:Sf,startForAxis:Bs,stopForAxis:Cf,isSliceContinous:Ad,computeFlatOffset:Vh});function Od(_){return we(sr(_),function(){return"The f passed in grad(f) must be a function"}),function(v,d){var y=Ze(v,"x","tf.grad",null),C=d!=null?Ze(d,"dy","tf.grad"):null;return He.tidy(function(){var z=He.gradients(function(){return _(y)},[y],C),Z=z.value,re=z.grads;return C!=null&&yt(Z.shape,C.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),tr(re),re[0]})}}function kf(_){return we(sr(_),function(){return"The f passed in grads(f) must be a function"}),function(v,d){we(Array.isArray(v),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var y=hc(v,"args","tf.grads",null),C=d!=null?Ze(d,"dy","tf.grads"):null;return He.tidy(function(){var z=He.gradients(function(){return _.apply(void 0,y)},y,C),Z=z.value,re=z.grads;return C!=null&&yt(Z.shape,C.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),tr(re),re})}}function om(_){return we(sr(_),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(v,d){we(v instanceof Qt,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),we(d==null||d instanceof Qt,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var y=He.gradients(function(){return _(v)},[v],d),C=y.grads,z=y.value;return tr(C),{grad:C[0],value:z}}}function am(_){return we(sr(_),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(v,d){we(Array.isArray(v)&&v.every(function(C){return C instanceof Qt}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),we(d==null||d instanceof Qt,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var y=He.gradients(function(){return _.apply(void 0,v)},v,d);return d!=null&&yt(y.value.shape,d.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),tr(y.grads),y}}function bn(_,v){we(sr(_),function(){return"The f passed in variableGrads(f) must be a function"}),we(v==null||Array.isArray(v)&&v.every(function(Oe){return Oe instanceof Ct}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var d=v!=null;if(!d)for(var y in v=[],He.registeredVariables)v.push(He.registeredVariables[y]);var C=d?v.filter(function(Oe){return!Oe.trainable}):null,z=v.length;we((v=v.filter(function(Oe){return Oe.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+z+" variables is trainable."});var Z=He.gradients(_,v,null,!0),re=Z.value,fe=Z.grads;we(fe.some(function(Oe){return Oe!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),we(re.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+re.rank+" tensor"});var xe={};return v.forEach(function(Oe,Re){fe[Re]!=null&&(xe[Oe.name]=fe[Re])}),C!=null&&C.forEach(function(Oe){return xe[Oe.name]=null}),{value:re,grads:xe}}function uu(_){return He.customGrad(_)}function tr(_){if(_.filter(function(v){return v==null}).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}var js=Lt({softmax_:function(_,v){v===void 0&&(v=-1);var d=Ze(_,"logits","softmax","float32");if(v===-1&&(v=d.rank-1),v!==d.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+d.rank+" and dim was "+v);return He.runKernelFunc(function(y,C){var z=y.softmax(d,v);return C([z]),z},{logits:d},function(y,C){var z=C[0],Z=y.mul(z);return{logits:function(){return Z.sub(Z.sum([v],!0).mul(z))}}},"Softmax",{dim:v},[],[!0])}}),vo=Lt({logSoftmax_:function(_,v){v===void 0&&(v=-1);var d=Ze(_,"logits","logSoftmax");if(v===-1&&(v=d.rank-1),v!==d.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+d.rank+" and axis was "+v);return uu(function(y,C){var z=y.max(v,!0),Z=y.sub(z),re=Z.toFloat().sub(Z.exp().sum(v,!0).log());return C([re]),{value:re,gradFunc:function(fe,xe){var Oe=xe[0].exp();return fe.sub(fe.sum(v,!0).mul(Oe))}}})(d)}}),Af=function(){function _(v,d){this.backend=v,this.dataMover=d,this.data=new WeakMap,this.dataIdsCount=0}return _.prototype.get=function(v){return this.data.has(v)||this.dataMover.moveData(this.backend,v),this.data.get(v)},_.prototype.set=function(v,d){this.dataIdsCount++,this.data.set(v,d)},_.prototype.has=function(v){return this.data.has(v)},_.prototype.delete=function(v){return this.dataIdsCount--,this.data.delete(v)},_.prototype.numDataIds=function(){return this.dataIdsCount},_}(),Td=function(){function _(){}return _.prototype.time=function(v){return mr("time")},_.prototype.read=function(v){return mr("read")},_.prototype.readSync=function(v){return mr("readSync")},_.prototype.numDataIds=function(){return mr("numDataIds")},_.prototype.disposeData=function(v){return mr("disposeData")},_.prototype.write=function(v,d,y){return mr("write")},_.prototype.move=function(v,d,y,C){return mr("move")},_.prototype.memory=function(){return mr("memory")},_.prototype.floatPrecision=function(){return mr("floatPrecision")},_.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},_.prototype.batchMatMul=function(v,d,y,C){return mr("batchMatMul")},_.prototype.fusedBatchMatMul=function(v){return v.a,v.b,v.transposeA,v.transposeB,v.bias,v.activation,v.preluActivationWeights,mr("fusedBatchMatMul")},_.prototype.slice=function(v,d,y){return mr("slice")},_.prototype.stridedSlice=function(v,d,y,C){return mr("stridedSlice")},_.prototype.unstack=function(v,d){return mr("unstack")},_.prototype.reverse=function(v,d){return mr("reverse")},_.prototype.concat=function(v,d){return mr("concat")},_.prototype.neg=function(v){return mr("neg")},_.prototype.add=function(v,d){return mr("add")},_.prototype.addN=function(v){return mr("addN")},_.prototype.subtract=function(v,d){return mr("subtract")},_.prototype.multiply=function(v,d){return mr("multiply")},_.prototype.realDivide=function(v,d){return mr("realDivide")},_.prototype.floorDiv=function(v,d){return mr("floorDiv")},_.prototype.sum=function(v,d){return mr("sum")},_.prototype.prod=function(v,d){return mr("prod")},_.prototype.unsortedSegmentSum=function(v,d,y){return mr("unsortedSegmentSum")},_.prototype.argMin=function(v,d){return mr("argMin")},_.prototype.argMax=function(v,d){return mr("argMax")},_.prototype.equal=function(v,d){return mr("equal")},_.prototype.notEqual=function(v,d){return mr("notEqual")},_.prototype.less=function(v,d){return mr("less")},_.prototype.lessEqual=function(v,d){return mr("lessEqual")},_.prototype.greater=function(v,d){return mr("greater")},_.prototype.greaterEqual=function(v,d){return mr("greaterEqual")},_.prototype.logicalNot=function(v){return mr("logicalNot")},_.prototype.logicalAnd=function(v,d){return mr("logicalAnd")},_.prototype.logicalOr=function(v,d){return mr("logicalOr")},_.prototype.where=function(v){return mr("where")},_.prototype.select=function(v,d,y){return mr("select")},_.prototype.topk=function(v,d,y){return mr("topk")},_.prototype.min=function(v,d){return mr("min")},_.prototype.minimum=function(v,d){return mr("minimum")},_.prototype.mod=function(v,d){return mr("mod")},_.prototype.max=function(v,d){return mr("max")},_.prototype.maximum=function(v,d){return mr("maximum")},_.prototype.all=function(v,d){return mr("all")},_.prototype.any=function(v,d){return mr("any")},_.prototype.squaredDifference=function(v,d){return mr("squaredDifference")},_.prototype.ceil=function(v){return mr("ceil")},_.prototype.floor=function(v){return mr("floor")},_.prototype.round=function(v){return mr("round")},_.prototype.sign=function(v){return mr("sign")},_.prototype.isNaN=function(v){return mr("isNaN")},_.prototype.isInf=function(v){return mr("isInf")},_.prototype.isFinite=function(v){return mr("isFinite")},_.prototype.pow=function(v,d){return mr("pow")},_.prototype.exp=function(v){return mr("exp")},_.prototype.expm1=function(v){return mr("expm1")},_.prototype.softmax=function(v,d){return mr("softmax")},_.prototype.log=function(v){return mr("log")},_.prototype.log1p=function(v){return mr("log1p")},_.prototype.sqrt=function(v){return mr("sqrt")},_.prototype.rsqrt=function(v){return mr("rsqrt")},_.prototype.square=function(v){return mr("square")},_.prototype.reciprocal=function(v){return mr("reciprocal")},_.prototype.relu=function(v){return mr("relu")},_.prototype.relu6=function(v){return mr("relu6")},_.prototype.prelu=function(v,d){return mr("prelu")},_.prototype.elu=function(v){return mr("elu")},_.prototype.eluDer=function(v,d){return mr("eluDer")},_.prototype.selu=function(v){return mr("selu")},_.prototype.int=function(v){return mr("int")},_.prototype.clip=function(v,d,y){return mr("clip")},_.prototype.abs=function(v){return mr("abs")},_.prototype.complexAbs=function(v){return mr("complexAbs")},_.prototype.sigmoid=function(v){return mr("sigmoid")},_.prototype.softplus=function(v){return mr("softplus")},_.prototype.sin=function(v){return mr("sin")},_.prototype.cos=function(v){return mr("cos")},_.prototype.tan=function(v){return mr("tan")},_.prototype.asin=function(v){return mr("asin")},_.prototype.acos=function(v){return mr("acos")},_.prototype.atan=function(v){return mr("atan")},_.prototype.atan2=function(v,d){return mr("atan2")},_.prototype.sinh=function(v){return mr("sinh")},_.prototype.cosh=function(v){return mr("cosh")},_.prototype.tanh=function(v){return mr("tanh")},_.prototype.asinh=function(v){return mr("asinh")},_.prototype.acosh=function(v){return mr("acosh")},_.prototype.atanh=function(v){return mr("atanh")},_.prototype.erf=function(v){return mr("erf")},_.prototype.step=function(v,d){return mr("step")},_.prototype.fusedConv2d=function(v){return v.input,v.filter,v.convInfo,v.bias,v.activation,v.preluActivationWeights,mr("fusedConv2d")},_.prototype.conv2d=function(v,d,y){return mr("conv2d")},_.prototype.conv2dDerInput=function(v,d,y){return mr("conv2dDerInput")},_.prototype.conv2dDerFilter=function(v,d,y){return mr("conv2dDerFilter")},_.prototype.fusedDepthwiseConv2D=function(v){return v.input,v.filter,v.convInfo,v.bias,v.activation,v.preluActivationWeights,mr("fusedDepthwiseConv2D")},_.prototype.depthwiseConv2D=function(v,d,y){return mr("depthwiseConv2D")},_.prototype.depthwiseConv2DDerInput=function(v,d,y){return mr("depthwiseConv2DDerInput")},_.prototype.depthwiseConv2DDerFilter=function(v,d,y){return mr("depthwiseConv2DDerFilter")},_.prototype.conv3d=function(v,d,y){return mr("conv3d")},_.prototype.conv3dDerInput=function(v,d,y){return mr("conv3dDerInput")},_.prototype.conv3dDerFilter=function(v,d,y){return mr("conv3dDerFilter")},_.prototype.maxPool=function(v,d){return mr("maxPool")},_.prototype.maxPoolBackprop=function(v,d,y,C){return mr("maxPoolBackprop")},_.prototype.avgPool=function(v,d){return mr("avgPool")},_.prototype.avgPoolBackprop=function(v,d,y){return mr("avgPoolBackprop")},_.prototype.avgPool3d=function(v,d){return mr("avgPool3d")},_.prototype.avgPool3dBackprop=function(v,d,y){return mr("avgPool3dBackprop")},_.prototype.maxPool3d=function(v,d){return mr("maxPool3d")},_.prototype.maxPool3dBackprop=function(v,d,y,C){return mr("maxPool3dBackprop")},_.prototype.reshape=function(v,d){return mr("reshape")},_.prototype.cast=function(v,d){return mr("cast")},_.prototype.tile=function(v,d){return mr("tile")},_.prototype.pad=function(v,d,y){return mr("pad")},_.prototype.transpose=function(v,d){return mr("transpose")},_.prototype.gather=function(v,d,y){return mr("gather")},_.prototype.gatherND=function(v,d){return mr("gatherND")},_.prototype.scatterND=function(v,d,y){return mr("scatterND")},_.prototype.batchToSpaceND=function(v,d,y){return mr("batchToSpaceND")},_.prototype.spaceToBatchND=function(v,d,y){return mr("spaceToBatchND")},_.prototype.resizeBilinear=function(v,d,y,C){return mr("resizeBilinear")},_.prototype.resizeBilinearBackprop=function(v,d,y){return mr("resizeBilinearBackprop")},_.prototype.resizeNearestNeighbor=function(v,d,y,C){return mr("resizeNearestNeighbor")},_.prototype.resizeNearestNeighborBackprop=function(v,d,y){return mr("resizeNearestNeighborBackprop")},_.prototype.batchNormalization=function(v,d,y,C,z,Z){return mr("batchNormalization")},_.prototype.localResponseNormalization4D=function(v,d,y,C,z){return mr("localResponseNormalization4D")},_.prototype.LRNGrad=function(v,d,y,C,z,Z,re){return mr("LRNGrad")},_.prototype.multinomial=function(v,d,y,C){return mr("multinomial")},_.prototype.oneHot=function(v,d,y,C){return mr("oneHot")},_.prototype.cumsum=function(v,d,y,C){return mr("cumsum")},_.prototype.nonMaxSuppression=function(v,d,y,C,z){return mr("nonMaxSuppression")},_.prototype.fft=function(v){return mr("fft")},_.prototype.ifft=function(v){return mr("ifft")},_.prototype.complex=function(v,d){return mr("complex")},_.prototype.real=function(v){return mr("real")},_.prototype.imag=function(v){return mr("imag")},_.prototype.cropAndResize=function(v,d,y,C,z,Z){return mr("cropAndResize")},_.prototype.depthToSpace=function(v,d,y){return mr("depthToSpace")},_.prototype.split=function(v,d,y){return mr("split")},_.prototype.sparseToDense=function(v,d,y,C){return mr("sparseToDense")},_.prototype.diag=function(v){return mr("diag")},_.prototype.fill=function(v,d,y){return mr("fill")},_.prototype.onesLike=function(v){return mr("onesLike")},_.prototype.zerosLike=function(v){return mr("zerosLike")},_.prototype.linspace=function(v,d,y){return mr("linspace")},_.prototype.dispose=function(){return mr("dispose")},_}();function mr(_){throw new Error("'"+_+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function is(_,v){for(var d=_.length,y=[],C=0;C<d;C++){var z=d-1-C,Z=_[z]||1;(v[v.length-1-C]||1)>1&&Z===1&&y.unshift(z)}return y}function Na(_,v){for(var d=[],y=0;y<v.length;y++){var C=_[_.length-y-1],z=v.length-y-1,Z=v[z];(C==null||C===1&&Z>1)&&d.unshift(z)}return d}function io(_,v){for(var d=[],y=Math.max(_.length,v.length),C=0;C<y;C++){var z=_[_.length-C-1];z==null&&(z=1);var Z=v[v.length-C-1];if(Z==null&&(Z=1),z===1)d.unshift(Z);else if(Z===1)d.unshift(z);else{if(z!==Z)throw Error("Operands could not be broadcast together with shapes "+_+" and "+v+".");d.unshift(z)}}return d}function Xu(_,v,d,y,C,z,Z){Z===void 0&&(Z="channelsLast");var re,fe=vc(v),xe=fe[0],Oe=fe[1];if(Z==="channelsLast")re=[xe,Oe,_[3],_[3]];else{if(Z!=="channelsFirst")throw new Error("Unknown dataFormat "+Z);re=[xe,Oe,_[1],_[1]]}return cu(_,re,d,y,C,z,!1,Z)}function Pc(_,v,d,y,C,z,Z){Z===void 0&&(Z="NDHWC");var re,fe,xe=lu(v),Oe=xe[0],Re=xe[1],Le=xe[2];if(Z==="NDHWC")fe="channelsLast",re=[Oe,Re,Le,_[4],_[4]];else{if(Z!=="NCDHW")throw new Error("Unknown dataFormat "+Z);fe="channelsFirst",re=[Oe,Re,Le,_[1],_[1]]}return Lc(_,re,d,y,C,!1,fe,z)}function cu(_,v,d,y,C,z,Z,re){Z===void 0&&(Z=!1),re===void 0&&(re="channelsLast");var fe=[-1,-1,-1,-1],xe=fe[0],Oe=fe[1],Re=fe[2],Le=fe[3];if(re==="channelsLast")xe=_[0],Oe=_[1],Re=_[2],Le=_[3];else{if(re!=="channelsFirst")throw new Error("Unknown dataFormat "+re);xe=_[0],Le=_[1],Oe=_[2],Re=_[3]}var Be,Xe=v[0],nt=v[1],tt=v[3],ut=vc(d),Nt=ut[0],Pt=ut[1],jt=vc(y),Yt=jt[0],gn=jt[1],wn=bo(Xe,Yt),vn=bo(nt,gn),Cn=function(m,w,P,K,ee,le,de,Ee){var Te,Ne,Fe;if(typeof m=="number"){Te={top:m,bottom:m,left:m,right:m,type:m===0?"VALID":"NUMBER"};var qe=function(At,Wt,cn,pn,ln){pn==null&&(pn=oa(At,Wt,cn));var dn=At[1],Nn=Es((At[0]-Wt+2*pn)/cn+1,ln);we(Ft(Nn),function(){return"The output # of rows ("+Nn+") must be an integer. Change the stride and/or zero pad parameters"});var jn=Es((dn-Wt+2*pn)/cn+1,ln);return we(Ft(jn),function(){return"The output # of columns ("+jn+") must be an integer. Change the stride and/or zero pad parameters"}),[Nn,jn]}([w,P],le,K,m,Ee);Ne=qe[0],Fe=qe[1]}else if(m==="same"){Ne=Math.ceil(w/K),Fe=Math.ceil(P/ee);var Je=Math.max(0,(Ne-1)*K+le-w),Ke=Math.max(0,(Fe-1)*ee+de-P),it=Math.floor(Je/2),gt=Je-it,Et=Math.floor(Ke/2);Te={top:it,bottom:gt,left:Et,right:Ke-Et,type:"SAME"}}else{if(m!=="valid")throw Error("Unknown padding parameter: "+m);Te={top:0,bottom:0,left:0,right:0,type:"VALID"},Ne=Math.ceil((w-le+1)/K),Fe=Math.ceil((P-de+1)/ee)}return{padInfo:Te,outHeight:Ne,outWidth:Fe}}(C,Oe,Re,Nt,Pt,wn,vn,z),Dn=Cn.padInfo,b=Cn.outHeight,p=Cn.outWidth,l=Z?tt*Le:tt;return re==="channelsFirst"?Be=[xe,l,b,p]:re==="channelsLast"&&(Be=[xe,b,p,l]),{batchSize:xe,dataFormat:re,inHeight:Oe,inWidth:Re,inChannels:Le,outHeight:b,outWidth:p,outChannels:l,padInfo:Dn,strideHeight:Nt,strideWidth:Pt,filterHeight:Xe,filterWidth:nt,effectiveFilterHeight:wn,effectiveFilterWidth:vn,dilationHeight:Yt,dilationWidth:gn,inShape:_,outShape:Be,filterShape:v}}function Lc(_,v,d,y,C,z,Z,re){z===void 0&&(z=!1),Z===void 0&&(Z="channelsLast");var fe=[-1,-1,-1,-1,-1],xe=fe[0],Oe=fe[1],Re=fe[2],Le=fe[3],Be=fe[4];if(Z==="channelsLast")xe=_[0],Oe=_[1],Re=_[2],Le=_[3],Be=_[4];else{if(Z!=="channelsFirst")throw new Error("Unknown dataFormat "+Z);xe=_[0],Be=_[1],Oe=_[2],Re=_[3],Le=_[4]}var Xe,nt=v[0],tt=v[1],ut=v[2],Nt=v[4],Pt=lu(d),jt=Pt[0],Yt=Pt[1],gn=Pt[2],wn=lu(y),vn=wn[0],Cn=wn[1],Dn=wn[2],b=bo(nt,vn),p=bo(tt,Cn),l=bo(ut,Dn),m=function(de,Ee,Te,Ne,Fe,qe,Je,Ke,it,gt,Et){var At,Wt,cn,pn;if(typeof de=="number"){At={top:de,bottom:de,left:de,right:de,front:de,back:de,type:de===0?"VALID":"NUMBER"};var ln=function(wr,vr,Lr,Pr,ei,hi){ei==null&&(ei=oa(wr,vr,Pr));var Oi=wr[1],wo=wr[2],_o=Es((wr[0]-vr+2*ei)/Pr+1,hi);we(Ft(_o),function(){return"The output # of depths ("+_o+") must be an integer. Change the stride and/or zero pad parameters"});var Io=Es((Oi-vr+2*ei)/Pr+1,hi);we(Ft(Io),function(){return"The output # of rows ("+Io+") must be an integer. Change the stride and/or zero pad parameters"});var Do=Es((wo-vr+2*ei)/Pr+1,hi);return we(Ft(Do),function(){return"The output # of columns ("+Do+") must be an integer. Change the stride and/or zero pad parameters"}),[_o,Io,Do,1]}([Ee,Te,Ne,1],Ke,0,Fe,de,Et);Wt=ln[0],cn=ln[1],pn=ln[2]}else if(de==="same"){var dn=((Wt=Math.ceil(Ee/Fe))-1)*Fe+Ke-Ee,Nn=((cn=Math.ceil(Te/qe))-1)*qe+it-Te,jn=((pn=Math.ceil(Ne/Je))-1)*Je+gt-Ne,Ln=Math.floor(dn/2),ur=dn-Ln,hr=Math.floor(Nn/2),xr=Nn-hr,Er=Math.floor(jn/2);At={top:hr,bottom:xr,left:Er,right:jn-Er,front:Ln,back:ur,type:"SAME"}}else{if(de!=="valid")throw Error("Unknown padding parameter: "+de);At={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Wt=Math.ceil((Ee-Ke+1)/Fe),cn=Math.ceil((Te-it+1)/qe),pn=Math.ceil((Ne-gt+1)/Je)}return{padInfo:At,outDepth:Wt,outHeight:cn,outWidth:pn}}(C,Oe,Re,Le,jt,Yt,gn,b,p,l,re),w=m.padInfo,P=m.outDepth,K=m.outHeight,ee=m.outWidth,le=z?Nt*Be:Nt;return Z==="channelsFirst"?Xe=[xe,le,P,K,ee]:Z==="channelsLast"&&(Xe=[xe,P,K,ee,le]),{batchSize:xe,dataFormat:Z,inDepth:Oe,inHeight:Re,inWidth:Le,inChannels:Be,outDepth:P,outHeight:K,outWidth:ee,outChannels:le,padInfo:w,strideDepth:jt,strideHeight:Yt,strideWidth:gn,filterDepth:nt,filterHeight:tt,filterWidth:ut,effectiveFilterDepth:b,effectiveFilterHeight:p,effectiveFilterWidth:l,dilationDepth:vn,dilationHeight:Cn,dilationWidth:Dn,inShape:_,outShape:Xe,filterShape:v}}function oa(_,v,d,y){y===void 0&&(y=1);var C=bo(v,y);return Math.floor((_[0]*(d-1)-d+C)/2)}function vc(_){return typeof _=="number"?[_,_,_]:_.length===2?[_[0],_[1],1]:_}function lu(_){return typeof _=="number"?[_,_,_]:_}function bo(_,v){return v<=1?_:_+(_-1)*(v-1)}function Es(_,v){if(!v)return _;switch(v){case"round":return Math.round(_);case"ceil":return Math.ceil(_);case"floor":return Math.floor(_);default:throw new Error("Unknown roundingMode "+v)}}function Ua(_){var v=vc(_),d=v[0],y=v[1],C=v[2];return d===1&&y===1&&C===1}function Ss(_,v){return Ua(_)||Ua(v)}function aa(_){if(_==="NHWC")return"channelsLast";if(_==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+_)}function fu(_,v,d){if(v==="complex64"){if(_.dtype==="complex64")return _.clone();var y=uo(_.shape),C=_.toFloat(),z=d.complex(C,y);return y.dispose(),C.dispose(),z}if(!$e(_.dtype,v))return He.makeTensorFromDataId(_.dataId,_.shape,v);if(_.dtype==="complex64"){var Z=d.real(_);return z=Z.cast(v),Z.dispose(),z}if(v==="int32")return d.int(_);if(v==="bool"){var re=Ar(0,_.dtype);return z=d.notEqual(_,re),re.dispose(),z}throw new Error("Error in Cast: failed to cast "+_.dtype+" to "+v)}function Ku(_,v){return He.makeTensorFromDataId(_.dataId,v,_.dtype)}function yc(_,v,d){var y=(v-_)/(d-1),C=Vt(d,"float32");C[0]=_;for(var z=1;z<C.length;z++)C[z]=C[z-1]+y;return au(C,"float32")}var Bc=Object.freeze({castTensor:fu,reshapeTensor:Ku,linspaceImpl:yc,upcastType:Sn,axesAreInnerMostDims:wd,combineLocations:$p,computeOutAndReduceShapes:Po,expandShapeToKeepDim:Lo,assertAxesAreInnerMostDims:ia,getAxesPermutation:Ba,getUndoAxesPermutation:$u,getInnerMostAxes:ja,getBroadcastDims:is,getReductionAxes:Na,assertAndGetBroadcastShape:io,assertParamsConsistent:rl,computeOutShape:_u,computePool2DInfo:Xu,computePool3DInfo:Pc,computeConv2DInfo:cu,computeConv3DInfo:Lc,computeDefaultPad:oa,tupleValuesAreOne:Ua,eitherStridesOrDilationsAreOne:Ss,convertConv2DDataFormat:aa,PARALLELIZE_THRESHOLD:nm,computeOptimalWindowSize:Ef});function Yu(_,v){if(_.length!==v.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+_.length+", imag: "+v.length+".");for(var d=new Float32Array(2*_.length),y=0;y<d.length;y+=2)d[y]=_[y/2],d[y+1]=v[y/2];return d}function Ll(_,v){return{real:_[2*v],imag:_[2*v+1]}}function Bl(_,v,d,y){_[2*y]=v,_[2*y+1]=d}function Hh(_,v,d){var y=(d?2:-2)*Math.PI*(_/v);return{real:Math.cos(y),imag:Math.sin(y)}}function jl(_,v,d){var y=function(z,Z,re){return function(fe,xe,Oe){for(var Re=0,Le=fe.length,Be=0,Xe=!1;Re<Le;){var nt=Oe(xe,fe[Be=Re+(Le-Re>>>1)]);nt>0?Re=Be+1:(Le=Be,Xe=!nt)}return Xe?Re:-Re-1}(z,Z,re||du)}(_,v,d),C=y<0?-(y+1):y;_.splice(C,0,v)}function du(_,v){return _>v?1:_<v?-1:0}function Ju(_,v,d,y,C){return Cu(_,v,d,y,C,0).selectedIndices}function Qu(_,v,d,y,C,z){var Z=Cu(_,v,d,y,C,z);return Z.numValidOutputs.dispose(),{selectedIndices:Z.selectedIndices,selectedScores:Z.selectedScores}}function Cu(_,v,d,y,C,z,Z,re){re===void 0&&(re=!1);for(var fe=Array.from(v).map(function(jt,Yt){return{score:jt,boxIndex:Yt,suppressBeginIndex:0}}).filter(function(jt){return jt.score>C}).sort(Dd),xe=z>0?-.5/z:0,Oe=[],Re=[];Oe.length<d&&fe.length>0;){var Le=fe.pop(),Be=Le.score,Xe=Le.boxIndex,nt=Le.suppressBeginIndex;if(Be<C)break;for(var tt=!1,ut=Oe.length-1;ut>=nt;--ut){var Nt=Gh(_,Xe,Oe[ut]);if(Nt>=y){tt=!0;break}if(Le.score=Le.score*Md(y,xe,Nt),Le.score<=C)break}Le.suppressBeginIndex=Oe.length,tt||(Le.score===Be?(Oe.push(Xe),Re.push(Le.score)):Le.score>C&&jl(fe,Le,Dd))}var Pt=Oe.length;return re&&(Oe.fill(0,Pt),Re.fill(0,Pt)),{selectedIndices:au(Oe,"int32"),selectedScores:au(Re,"float32"),numValidOutputs:Ar(Pt,"int32")}}function Gh(_,v,d){var y=_.subarray(4*v,4*v+4),C=_.subarray(4*d,4*d+4),z=Math.min(y[0],y[2]),Z=Math.min(y[1],y[3]),re=Math.max(y[0],y[2]),fe=Math.max(y[1],y[3]),xe=Math.min(C[0],C[2]),Oe=Math.min(C[1],C[3]),Re=Math.max(C[0],C[2]),Le=Math.max(C[1],C[3]),Be=(re-z)*(fe-Z),Xe=(Re-xe)*(Le-Oe);if(Be<=0||Xe<=0)return 0;var nt=Math.max(z,xe),tt=Math.max(Z,Oe),ut=Math.min(re,Re),Nt=Math.min(fe,Le),Pt=Math.max(ut-nt,0)*Math.max(Nt-tt,0);return Pt/(Be+Xe-Pt)}function Md(_,v,d){var y=Math.exp(v*d*d);return d<=_?y:0}function Dd(_,v){return _.score-v.score||_.score===v.score&&v.boxIndex-_.boxIndex}function Of(_,v,d){var y=new Array(_.rank).fill(0),C=_.shape.slice();return v.map(function(z){C[d]=z;var Z=_.slice(y,C);return y[d]+=z,Z})}function Nd(_,v){for(var d=new Array(_.rank),y=0;y<d.length;y++)d[y]=_.shape[y]*v[y];var C=Hi(d,_.dtype);for(y=0;y<C.values.length;++y){for(var z=C.indexToLoc(y),Z=new Array(_.rank),re=0;re<Z.length;re++)Z[re]=z[re]%_.shape[re];var fe=_.locToIndex(Z);C.values[y]=_.values[fe]}return C.toTensor()}function se(_,v,d,y,C){for(var z=v[v.length-1],Z=[_.length/z,z],re=Z[0],fe=Z[1],xe=kn(d,re*y),Oe=kn("int32",re*y),Re=0;Re<re;Re++){for(var Le=Re*fe,Be=_.subarray(Le,Le+fe),Xe=[],nt=0;nt<Be.length;nt++)Xe.push({value:Be[nt],index:nt});Xe.sort(function(jt,Yt){return Yt.value-jt.value});var tt=Re*y,ut=xe.subarray(tt,tt+y),Nt=Oe.subarray(tt,tt+y);for(nt=0;nt<y;nt++)ut[nt]=Xe[nt].value,Nt[nt]=Xe[nt].index}var Pt=v.slice();return Pt[Pt.length-1]=y,[No(xe,Pt,d),No(Oe,Pt,"int32")]}function ne(_,v){for(var d=[],y=0;y<v.length;y++)v[y]&&d.push(y);var C=Hi(_,"int32"),z=Hi([d.length,_.length],"int32");for(y=0;y<d.length;y++){var Z=C.indexToLoc(d[y]),re=y*_.length;z.values.set(Z,re)}return z.toTensor()}function N(_,v){return["x","y","z","w","u","v"].slice(0,v).map(function(d){return _+"."+d})}function G(_,v){return v===1?[_]:N(_,v)}function ce(){var _,v,d,y,C,z,Z,re,fe,xe;return j().getNumber("WEBGL_VERSION")===2?(_="#version 300 es",v="in",d="out",y="in",C="texture",z="outputColor",Z="out vec4 outputColor;",re=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,fe="",xe=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(_="",v="attribute",d="varying",y="varying",C="texture2D",z="gl_FragColor",Z="",re=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,fe=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,xe=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:_,attribute:v,varyingVs:d,varyingFs:y,texture2D:C,output:z,defineOutput:Z,defineSpecialNaN:re,defineSpecialInf:fe,defineRound:xe}}function je(_,v,d){d===void 0&&(d="index");var y=on(v);return y.map(function(C,z){return"int "+_[z]+" = "+d+" / "+C+"; "+(z===y.length-1?"int "+_[z+1]+" = "+d+" - "+_[z]+" * "+C:"index -= "+_[z]+" * "+C)+";"}).join("")}function Qe(_){var v=on(_).map(function(d){return d.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+v[0]+" + coords.y * "+v[1]+` + coords.z;
  }
`}var bt=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function qt(_,v,d,y){var C=[];_.forEach(function(Be){var Xe=ze(Be.shapeInfo.logicalShape);Be.shapeInfo.isUniform?C.push("uniform float "+Be.name+(Xe>1?"["+Xe+"]":"")+";"):(C.push("uniform sampler2D "+Be.name+";"),C.push("uniform int offset"+Be.name+";"))});var z,Z,re=C.join(`
`),fe=_.map(function(Be){return function(Xe,nt,tt){tt===void 0&&(tt=!1);var ut="";ut+=tt?function jt(Yt){var gn,wn,vn;switch(Yt.shapeInfo.logicalShape.length){case 0:return gn=Yt.name,wn="get"+gn.charAt(0).toUpperCase()+gn.slice(1),vn=ce(),`
    vec4 `+wn+`() {
      return `+vn.texture2D+"("+gn+`, halfCR);
    }
  `;case 1:return function(Cn){var Dn=Cn.name,b="get"+Dn.charAt(0).toUpperCase()+Dn.slice(1),p=Cn.shapeInfo.texShape,l=[Math.ceil(p[0]/2),Math.ceil(p[1]/2)],m=ce();return`
    vec4 `+b+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+l[0]+", "+l[1]+`, index);
      return `+m.texture2D+"("+Dn+`, uv);
    }
  `}(Yt);case 2:return function(Cn){var Dn=Cn.shapeInfo.logicalShape,b=Cn.name,p="get"+b.charAt(0).toUpperCase()+b.slice(1),l=Cn.shapeInfo.texShape,m=l[0],w=l[1],P=ce();if(l!=null&&Ut(Dn,l))return`
      vec4 `+p+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+w+".0, "+m+`.0);

        return `+P.texture2D+"("+b+`, uv);
      }
    `;var K=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],ee=Math.ceil(Dn[1]/2);return`
    vec4 `+p+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+ee+", "+K[0]+", "+K[1]+`, row, col);
      return `+P.texture2D+"("+b+`, uv);
    }
  `}(Yt);case 3:return function(Cn){var Dn=Cn.shapeInfo.logicalShape,b=Cn.name,p="get"+b.charAt(0).toUpperCase()+b.slice(1),l=Cn.shapeInfo.texShape,m=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];if(Dn[0]===1){var w=Dn.slice(1),P=pr(Cn,w);return`
        `+jt(P)+`
        vec4 `+p+`(int b, int row, int col) {
          return `+p+"("+gr(["b","row","col"],[1,2])+`);
        }
      `}var K=m[0],ee=m[1],le=Math.ceil(Dn[2]/2),de=le*Math.ceil(Dn[1]/2),Ee=ce();return`
    vec4 `+p+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+K+", "+ee+", "+de+", "+le+`, b, row, col);
      return `+Ee.texture2D+"("+b+`, uv);
    }
  `}(Yt);default:return function(Cn){for(var Dn=Cn.shapeInfo.logicalShape,b=Dn.length,p=Cn.name,l="get"+p.charAt(0).toUpperCase()+p.slice(1),m=Cn.shapeInfo.texShape,w=[Math.ceil(m[0]/2),Math.ceil(m[1]/2)],P=w[0],K=w[1],ee=Math.ceil(Dn[b-1]/2),le=ee*Math.ceil(Dn[b-2]/2),de="int b, int row, int col",Ee="b * "+le+" + (row / 2) * "+ee+" + (col / 2)",Te=2;Te<b-1;Te++)de="int b"+Te+", "+de,le*=Dn[b-Te-1],Ee="b"+Te+" * "+le+" + "+Ee;var Ne=ce();return`
    vec4 `+l+"("+de+`) {
      int index = `+Ee+`;
      int texR = index / `+K+`;
      int texC = index - texR * `+K+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+K+", "+P+`);
      return `+Ne.texture2D+"("+p+`, uv);
    }
  `}(Yt)}}(Xe):function jt(Yt){var gn=Yt.shapeInfo.logicalShape;switch(gn.length){case 0:return function(wn){var vn=wn.name,Cn="get"+vn.charAt(0).toUpperCase()+vn.slice(1);if(wn.shapeInfo.isUniform)return"float "+Cn+"() {return "+vn+";}";var Dn=wn.shapeInfo.texShape,b=Dn[0],p=Dn[1];if(b===1&&p===1)return`
      float `+Cn+`() {
        return sampleTexture(`+vn+`, halfCR);
      }
    `;var l=wn.shapeInfo.texShape,m=l[0],w=l[1],P=Gn(vn);return`
    float `+Cn+`() {
      vec2 uv = uvFromFlat(`+m+", "+w+", "+P+`);
      return sampleTexture(`+vn+`, uv);
    }
  `}(Yt);case 1:return function(wn){var vn=wn.name,Cn="get"+vn.charAt(0).toUpperCase()+vn.slice(1);if(wn.shapeInfo.isUniform)return`
      float `+Cn+`(int index) {
        `+nr(wn)+`
      }
    `;var Dn=wn.shapeInfo.texShape,b=Dn[0],p=Dn[1];if(p===1&&b===1)return`
      float `+Cn+`(int index) {
        return sampleTexture(`+vn+`, halfCR);
      }
    `;var l=Gn(vn);return p===1?`
      float `+Cn+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+l+") + 0.5) / "+b+`.0);
        return sampleTexture(`+vn+`, uv);
      }
    `:b===1?`
      float `+Cn+`(int index) {
        vec2 uv = vec2((float(index + `+l+") + 0.5) / "+p+`.0, 0.5);
        return sampleTexture(`+vn+`, uv);
      }
    `:`
    float `+Cn+`(int index) {
      vec2 uv = uvFromFlat(`+b+", "+p+", index + "+l+`);
      return sampleTexture(`+vn+`, uv);
    }
  `}(Yt);case 2:return function(wn){var vn=wn.shapeInfo.logicalShape,Cn=wn.name,Dn="get"+Cn.charAt(0).toUpperCase()+Cn.slice(1),b=wn.shapeInfo.texShape;if(b!=null&&Ut(vn,b)){var p=b[0],l=b[1];return`
    float `+Dn+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+l+".0, "+p+`.0);
      return sampleTexture(`+Cn+`, uv);
    }
  `}var m=sn(vn),w=m.newShape,P=m.keptDims,K=w;if(K.length<vn.length){var ee=pr(wn,K);return`
      `+jt(ee)+`
      float `+Dn+`(int row, int col) {
        return `+Dn+"("+gr(["row","col"],P)+`);
      }
    `}if(wn.shapeInfo.isUniform)return`
      float `+Dn+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+vn[1]+`, 1)));
        `+nr(wn)+`
      }
    `;var le=b[0],de=b[1],Ee=Gn(Cn);return de===1?`
    float `+Dn+`(int row, int col) {
      float index = dot(vec3(row, col, `+Ee+"), vec3("+vn[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+le+`.0);
      return sampleTexture(`+Cn+`, uv);
    }
  `:le===1?`
    float `+Dn+`(int row, int col) {
      float index = dot(vec3(row, col, `+Ee+"), vec3("+vn[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+de+`.0, 0.5);
      return sampleTexture(`+Cn+`, uv);
    }
  `:`
  float `+Dn+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+vn[1]+" + col + "+Ee+`;
    vec2 uv = uvFromFlat(`+le+", "+de+`, index);
    return sampleTexture(`+Cn+`, uv);
  }
`}(Yt);case 3:return function(wn){var vn=wn.shapeInfo.logicalShape,Cn=wn.name,Dn="get"+Cn.charAt(0).toUpperCase()+Cn.slice(1),b=vn[1]*vn[2],p=vn[2],l=sn(vn),m=l.newShape,w=l.keptDims,P=m;if(P.length<vn.length){var K=pr(wn,P);return`
        `+jt(K)+`
        float `+Dn+`(int row, int col, int depth) {
          return `+Dn+"("+gr(["row","col","depth"],w)+`);
        }
      `}if(wn.shapeInfo.isUniform)return`
      float `+Dn+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+b+", "+p+`, 1)));
        `+nr(wn)+`
      }
    `;var ee=wn.shapeInfo.texShape,le=ee[0],de=ee[1],Ee=wn.shapeInfo.flatOffset;if(de===b&&Ee==null)return`
        float `+Dn+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+p+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+de+".0, "+le+`.0);
          return sampleTexture(`+Cn+`, uv);
        }
      `;if(de===p&&Ee==null)return`
    float `+Dn+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+vn[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+de+".0, "+le+`.0);
      return sampleTexture(`+Cn+`, uv);
    }
  `;var Te=Gn(Cn);return`
      float `+Dn+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+b+" + col * "+p+" + depth + "+Te+`;
        vec2 uv = uvFromFlat(`+le+", "+de+`, index);
        return sampleTexture(`+Cn+`, uv);
      }
  `}(Yt);case 4:return function(wn){var vn=wn.shapeInfo.logicalShape,Cn=wn.name,Dn="get"+Cn.charAt(0).toUpperCase()+Cn.slice(1),b=vn[3],p=vn[2]*b,l=vn[1]*p,m=sn(vn),w=m.newShape,P=m.keptDims;if(w.length<vn.length){var K=pr(wn,w);return`
      `+jt(K)+`
      float `+Dn+`(int row, int col, int depth, int depth2) {
        return `+Dn+"("+gr(["row","col","depth","depth2"],P)+`);
      }
    `}if(wn.shapeInfo.isUniform)return`
      float `+Dn+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+l+", "+p+", "+b+`, 1)));
        `+nr(wn)+`
      }
    `;var ee=wn.shapeInfo.flatOffset,le=wn.shapeInfo.texShape,de=le[0],Ee=le[1];if(Ee===l&&ee==null)return`
      float `+Dn+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+p+", "+b+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+Ee+".0, "+de+`.0);
        return sampleTexture(`+Cn+`, uv);
      }
    `;if(Ee===b&&ee==null)return`
      float `+Dn+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+vn[1]*vn[2]+", "+vn[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+Ee+".0, "+de+`.0);
        return sampleTexture(`+Cn+`, uv);
      }
    `;var Te=Gn(Cn);return`
    float `+Dn+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+p+` +
          depth * `+b+` + depth2;
      vec2 uv = uvFromFlat(`+de+", "+Ee+", index + "+Te+`);
      return sampleTexture(`+Cn+`, uv);
    }
  `}(Yt);case 5:return function(wn){var vn=wn.shapeInfo.logicalShape,Cn=wn.name,Dn="get"+Cn.charAt(0).toUpperCase()+Cn.slice(1),b=vn[4],p=vn[3]*b,l=vn[2]*p,m=vn[1]*l,w=sn(vn),P=w.newShape,K=w.keptDims;if(P.length<vn.length){var ee=pr(wn,P);return`
      `+jt(ee)+`
      float `+Dn+`(int row, int col, int depth, int depth2, int depth3) {
        return `+Dn+"("+gr(["row","col","depth","depth2","depth3"],K)+`);
      }
    `}if(wn.shapeInfo.isUniform)return`
      float `+Dn+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+m+", "+l+", "+p+", "+b+`)) +
          depth3;
        `+nr(wn)+`
      }
    `;var le=wn.shapeInfo.flatOffset,de=wn.shapeInfo.texShape,Ee=de[0],Te=de[1];if(Te===m&&le==null)return`
      float `+Dn+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+l+", "+p+", "+b+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+Te+".0, "+Ee+`.0);
        return sampleTexture(`+Cn+`, uv);
      }
    `;if(Te===b&&le==null)return`
      float `+Dn+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+vn[1]*vn[2]*vn[3]+`,
               `+vn[2]*vn[3]+", "+vn[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+Te+".0, "+Ee+`.0);
        return sampleTexture(`+Cn+`, uv);
      }
    `;var Ne=Gn(Cn);return`
    float `+Dn+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+m+" + col * "+l+" + depth * "+p+` +
          depth2 * `+b+" + depth3 + "+Ne+`;
      vec2 uv = uvFromFlat(`+Ee+", "+Te+`, index);
      return sampleTexture(`+Cn+`, uv);
    }
  `}(Yt);case 6:return function(wn){var vn=wn.shapeInfo.logicalShape,Cn=wn.name,Dn="get"+Cn.charAt(0).toUpperCase()+Cn.slice(1),b=sn(vn),p=b.newShape,l=b.keptDims;if(p.length<vn.length){var m=pr(wn,p);return`
      `+jt(m)+`
      float `+Dn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+Dn+"("+gr(["row","col","depth","depth2","depth3","depth4"],l)+`);
      }
    `}var w=vn[5],P=vn[4]*w,K=vn[3]*P,ee=vn[2]*K,le=vn[1]*ee;if(wn.shapeInfo.isUniform)return`
      float `+Dn+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+le+", "+ee+", "+K+", "+P+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+w+`, 1)));
        `+nr(wn)+`
      }
    `;var de=wn.shapeInfo.flatOffset,Ee=wn.shapeInfo.texShape,Te=Ee[0],Ne=Ee[1];if(Ne===le&&de==null)return`
      float `+Dn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+ee+", "+K+", "+P+", "+w+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+Ne+".0, "+Te+`.0);
        return sampleTexture(`+Cn+`, uv);
      }
    `;if(Ne===w&&de==null)return`
      float `+Dn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+vn[1]*vn[2]*vn[3]*vn[4]+`,
               `+vn[2]*vn[3]*vn[4]+`,
               `+vn[3]*vn[4]+`,
               `+vn[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+Ne+".0, "+Te+`.0);
        return sampleTexture(`+Cn+`, uv);
      }
    `;var Fe=Gn(Cn);return`
    float `+Dn+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+le+" + col * "+ee+" + depth * "+K+` +
          depth2 * `+P+" + depth3 * "+w+" + depth4 + "+Fe+`;
      vec2 uv = uvFromFlat(`+Te+", "+Ne+`, index);
      return sampleTexture(`+Cn+`, uv);
    }
  `}(Yt);default:throw new Error(gn.length+"-D input sampling is not yet supported")}}(Xe);var Nt=Xe.shapeInfo.logicalShape,Pt=nt.logicalShape;return Nt.length<=Pt.length&&(ut+=tt?function(jt,Yt){var gn,wn=jt.name,vn=wn.charAt(0).toUpperCase()+wn.slice(1),Cn="get"+vn+"AtOutCoords",Dn=jt.shapeInfo.logicalShape.length,b=Yt.logicalShape.length,p=is(jt.shapeInfo.logicalShape,Yt.logicalShape),l=Yn(b),m=b-Dn,w=["x","y","z","w","u","v"];gn=Dn===0?"":b<2&&p.length>=1?"coords = 0;":p.map(function(Te){return"coords."+w[Te+m]+" = 0;"}).join(`
`);var P;P=b<2&&Dn>0?"coords":jt.shapeInfo.logicalShape.map(function(Te,Ne){return"coords."+w[Ne+m]}).join(", ");var K="return outputValue;",ee=ze(jt.shapeInfo.logicalShape)===1,le=ze(Yt.logicalShape)===1;if(Dn!==1||ee||le){if(ee&&!le)K=b===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(p.length){var de=Dn-2,Ee=Dn-1;p.indexOf(de)>-1&&p.indexOf(Ee)>-1?K="return vec4(outputValue.x);":p.indexOf(de)>-1?K="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":p.indexOf(Ee)>-1&&(K="return vec4(outputValue.xx, outputValue.zz);")}}else K=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+Cn+`() {
      `+l+` coords = getOutputCoords();
      `+gn+`
      vec4 outputValue = get`+vn+"("+P+`);
      `+K+`
    }
  `}(Xe,nt):function(jt,Yt){var gn=jt.name,wn=gn.charAt(0).toUpperCase()+gn.slice(1),vn="get"+wn+"AtOutCoords",Cn=Yt.texShape,Dn=jt.shapeInfo.texShape,b=jt.shapeInfo.logicalShape.length,p=Yt.logicalShape.length;if(!jt.shapeInfo.isUniform&&b===p&&jt.shapeInfo.flatOffset==null&&Ut(Dn,Cn))return`
      float `+vn+`() {
        return sampleTexture(`+gn+`, resultUV);
      }
    `;var l=Yn(p),m=is(jt.shapeInfo.logicalShape,Yt.logicalShape),w=p-b,P=["x","y","z","w","u","v"];return`
    float `+vn+`() {
      `+l+` coords = getOutputCoords();
      `+(b===0?"":p<2&&m.length>=1?"coords = 0;":m.map(function(K){return"coords."+P[K+w]+" = 0;"}).join(`
`))+`
      return get`+wn+"("+(p<2&&b>0?"coords":jt.shapeInfo.logicalShape.map(function(K,ee){return"coords."+P[ee+w]}).join(", "))+`);
    }
  `}(Xe,nt)),ut}(Be,v,y)}).join(`
`),xe=v.texShape,Oe=ce(),Re=`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+Oe.texture2D+`(textureSampler, uv).r;
    }
  `,Le=function(Be){return Be.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+Be.varyingFs+` vec2 resultUV;
    `+Be.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+Be.defineSpecialNaN+`
    `+Be.defineSpecialInf+`
    `+Be.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+un+`
    `+ht+`
    `+In+`
  `}(Oe);return v.isPacked?(z=function(Be,Xe){switch(Be.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(jt,Yt){var gn=[Math.ceil(Yt[0]/2),Math.ceil(Yt[1]/2)];return gn[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+gn[1]+`.0);
      }
    `:gn[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+gn[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+gn[0]+", "+gn[1]+`));
      return 2 * (resTexRC.x * `+gn[1]+` + resTexRC.y);
    }
  `}(0,Xe);case 2:return function(jt,Yt){var gn=[Math.ceil(Yt[0]/2),Math.ceil(Yt[1]/2)];if(Ut(jt,Yt))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+gn[0]+", "+gn[1]+`));
      }
    `;var wn=Math.ceil(jt[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+gn[0]+", "+gn[1]+`));

      int index = resTexRC.x * `+gn[1]+` + resTexRC.y;
      int r = 2 * (index / `+wn+`);
      int c = imod(index, `+wn+`) * 2;

      return ivec2(r, c);
    }
  `}(Be,Xe);case 3:return nt=Be,tt=Xe,ut=[Math.ceil(tt[0]/2),Math.ceil(tt[1]/2)],Pt=(Nt=Math.ceil(nt[2]/2))*Math.ceil(nt[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+ut[0]+", "+ut[1]+`));
      int index = resTexRC.x * `+ut[1]+` + resTexRC.y;

      int b = index / `+Pt+`;
      index -= b * `+Pt+`;

      int r = 2 * (index / `+Nt+`);
      int c = imod(index, `+Nt+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(jt,Yt){for(var gn=[Math.ceil(Yt[0]/2),Math.ceil(Yt[1]/2)],wn=Math.ceil(jt[jt.length-1]/2),vn=wn*Math.ceil(jt[jt.length-2]/2),Cn=vn,Dn="",b="b, r, c",p=2;p<jt.length-1;p++)Dn=`
      int b`+p+" = index / "+(Cn*=jt[jt.length-p-1])+`;
      index -= b`+p+" * "+Cn+`;
    `+Dn,b="b"+p+", "+b;return`
    ivec`+jt.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+gn[0]+", "+gn[1]+`));
      int index = resTexRC.x * `+gn[1]+` + resTexRC.y;

      `+Dn+`

      int b = index / `+vn+`;
      index -= b * `+vn+`;

      int r = 2 * (index / `+wn+`);
      int c = imod(index, `+wn+`) * 2;

      return ivec`+jt.length+"("+b+`);
    }
  `}(Be,Xe)}var nt,tt,ut,Nt,Pt}(v.logicalShape,xe),Z=`
    void setOutput(vec4 val) {
      `+Oe.output+` = val;
    }
  `):(z=function(Be,Xe){switch(Be.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(ut,Nt){return Nt[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+Nt[1]+`.0);
      }
    `:Nt[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+Nt[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Nt[0]+", "+Nt[1]+`));
      return resTexRC.x * `+Nt[1]+` + resTexRC.y;
    }
  `}(0,Xe);case 2:return function(ut,Nt){return Ut(ut,Nt)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+Nt[0]+", "+Nt[1]+`));
      }
    `:ut[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+Nt[0]+", "+Nt[1]+`));
        int index = resTexRC.x * `+Nt[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:ut[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+Nt[0]+", "+Nt[1]+`));
        int index = resTexRC.x * `+Nt[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Nt[0]+", "+Nt[1]+`));
      int index = resTexRC.x * `+Nt[1]+` + resTexRC.y;
      int r = index / `+ut[1]+`;
      int c = index - r * `+ut[1]+`;
      return ivec2(r, c);
    }
  `}(Be,Xe);case 3:return nt=Xe,tt=je(["r","c","d"],Be),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+nt[0]+", "+nt[1]+`));
      int index = resTexRC.x * `+nt[1]+` + resTexRC.y;
      `+tt+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(ut,Nt){var Pt=je(["r","c","d","d2"],ut);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+Nt[0]+", "+Nt[1]+`));
      int index = resTexRC.x * `+Nt[1]+` + resTexRC.y;
      `+Pt+`
      return ivec4(r, c, d, d2);
    }
  `}(Be,Xe);case 5:return function(ut,Nt){var Pt=je(["r","c","d","d2","d3"],ut);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+Nt[0]+`,
                             `+Nt[1]+`));

      int index = resTexRC.x * `+Nt[1]+` + resTexRC.y;

      `+Pt+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(Be,Xe);case 6:return function(ut,Nt){var Pt=je(["r","c","d","d2","d3","d4"],ut);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+Nt[0]+", "+Nt[1]+`));
      int index = resTexRC.x * `+Nt[1]+` + resTexRC.y;

      `+Pt+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(Be,Xe);default:throw new Error(Be.length+"-D output sampling is not yet supported")}var nt,tt}(v.logicalShape,xe),Z=`
    void setOutput(float val) {
      `+Oe.output+` = vec4(val, 0, 0, 0);
    }
  `),y&&(Le+=Un),[Le,Re,Z,re,z,fe,d].join(`
`)}var un=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,ht=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,In=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Un=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Gn(_){return"offset"+_}function nr(_){var v=_.name,d=ze(_.shapeInfo.logicalShape);return d<2?"return "+v+";":`
    for (int i = 0; i < `+d+`; i++) {
      if (i == index) {
        return `+v+`[i];
      }
    }
  `}function Yn(_){if(_<=1)return"int";if(_===2)return"ivec2";if(_===3)return"ivec3";if(_===4)return"ivec4";if(_===5)return"ivec5";if(_===6)return"ivec6";throw Error("GPU for rank "+_+" is not yet supported")}function pr(_,v){var d=JSON.parse(JSON.stringify(_));return d.shapeInfo.logicalShape=v,d}function gr(_,v){return v.map(function(d){return _[d]}).join(", ")}var Tr=function(_,v,d){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=io(v,d),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+_+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},$r="return a + b;",ai="return a - b;",Fr="return a * b;",ui="return (a < 0.) ? b * a : a;",ii=function(_,v,d){this.variableNames=["A","B"],this.outputShape=io(v,d),this.userCode=`
      float binaryOperation(float a, float b) {
        `+_+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},wi=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Si=function(_,v,d,y){y===void 0&&(y=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=io(v,d);var C=this.outputShape.length,z="";if(y)if(C===0||ze(this.outputShape)===1)z=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(z=`
          `+Yn(C)+` coords = getOutputCoords();
        `,C===1)z+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var Z=G("coords",C);z+=`
            bool nextRowOutOfBounds =
              (`+Z[C-2]+" + 1) >= "+this.outputShape[C-2]+`;
            bool nextColOutOfBounds =
              (`+Z[C-1]+" + 1) >= "+this.outputShape[C-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+_+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+z+`

        setOutput(result);
      }
    `},si=function(){function _(v){this.variableNames=["A"],this.outputShape=v,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return _.prototype.getCustomSetupFunc=function(v,d){var y=this;return function(C,z){y.minLoc==null&&(y.minLoc=C.getUniformLocationNoThrow(z,"minVal"),y.maxLoc=C.getUniformLocationNoThrow(z,"maxVal")),C.gl.uniform1f(y.minLoc,v),C.gl.uniform1f(y.maxLoc,d)}},_}(),gi=function(){function _(v){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=v,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return _.prototype.getCustomSetupFunc=function(v,d){var y=this;return function(C,z){y.minLoc==null&&(y.minLoc=C.getUniformLocationNoThrow(z,"minVal"),y.maxLoc=C.getUniformLocationNoThrow(z,"maxVal")),C.gl.uniform1f(y.minLoc,v),C.gl.uniform1f(y.maxLoc,d)}},_}();function po(_,v,d){var y=_.indexOf(v);return _.map(function(C,z){return z===y?C+" - "+d:C}).join()}var ho=function(_,v,d,y){v===void 0&&(v=!1),d===void 0&&(d=null),y===void 0&&(y=!1),this.variableNames=["x","W"],this.outputShape=_.outShape;var C=_.padInfo.top,z=_.padInfo.left,Z=_.strideHeight,re=_.strideWidth,fe=_.dilationHeight,xe=_.dilationWidth,Oe=_.filterHeight,Re=_.filterWidth,Le=4*Math.floor(_.inChannels/4),Be=_.inChannels%4,Xe=_.dataFormat==="channelsLast",nt=Xe?1:2,tt=Xe?2:3,ut=Xe?3:1,Nt="",Pt="";d&&(Nt=y?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+d+`
        }`:`
          float activation(float x) {
            `+d+`
          }
        `,Pt="result = activation(result);");var jt=v?"result += getBiasAtOutCoords();":"";v&&this.variableNames.push("bias"),y&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+Nt+`

      const ivec2 strides = ivec2(`+Z+", "+re+`);
      const ivec2 pads = ivec2(`+C+", "+z+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+ut+`];

        ivec2 xRCCorner =
            ivec2(coords[`+nt+"], coords["+tt+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+Oe+`; wR++) {
          int xR = xRCorner + wR * `+fe+`;

          if (xR < 0 || xR >= `+_.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+Re+`; wC++) {
            int xC = xCCorner + wC * `+xe+`;

            if (xC < 0 || xC >= `+_.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+Le+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+Xe+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(Be===1)+`) {

              if (`+Xe+`) {
                dotProd +=
                    getX(batch, xR, xC, `+Le+`) *
                    getW(wR, wC, `+Le+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+Le+`, xR, xC) *
                    getW(wR, wC, `+Le+`, d2);
              }

            } else if (`+(Be===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+Le+`, d2),
                getW(wR, wC, `+Le+` + 1, d2)
              );

              if (`+Xe+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+Le+`),
                  getX(batch, xR, xC, `+Le+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+Le+`, xR, xC),
                  getX(batch, `+Le+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(Be===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+Le+`, d2),
                getW(wR, wC, `+Le+` + 1, d2),
                getW(wR, wC, `+Le+` + 2, d2)
              );

              if (`+Xe+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+Le+`),
                  getX(batch, xR, xC, `+Le+` + 1),
                  getX(batch, xR, xC, `+Le+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+Le+`, xR, xC),
                  getX(batch, `+Le+` + 1, xR, xC),
                  getX(batch, `+Le+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+jt+`
        `+Pt+`
        setOutput(result);
      }
    `},Ko=function(_,v,d,y){v===void 0&&(v=!1),d===void 0&&(d=null),y===void 0&&(y=!1),this.variableNames=["x","W"],this.outputShape=_.outShape;var C=_.inHeight,z=_.inWidth,Z=_.padInfo.top,re=_.padInfo.left,fe=_.strideHeight,xe=_.strideWidth,Oe=_.dilationHeight,Re=_.dilationWidth,Le=_.filterHeight,Be=_.filterWidth,Xe=_.outChannels/_.inChannels,nt="",tt="";d&&(nt=y?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+d+`
        }`:`
          float activation(float x) {
            `+d+`
          }
        `,tt="result = activation(result);");var ut=v?"result += getBiasAtOutCoords();":"";v&&this.variableNames.push("bias"),y&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+nt+`

      const ivec2 strides = ivec2(`+fe+", "+xe+`);
      const ivec2 pads = ivec2(`+Z+", "+re+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+Xe+`;
        int q = d2 - d1 * `+Xe+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+Le+`; wR++) {
          int xR = xRCorner + wR * `+Oe+`;

          if (xR < 0 || xR >= `+C+`) {
            continue;
          }

          for (int wC = 0; wC < `+Be+`; wC++) {
            int xC = xCCorner + wC * `+Re+`;

            if (xC < 0 || xC >= `+z+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+ut+`
        `+tt+`
        setOutput(result);
      }
    `},Ki=function(_,v,d,y){v===void 0&&(v=!1),d===void 0&&(d=null),y===void 0&&(y=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=_.outShape;for(var C=_.inHeight,z=_.inWidth,Z=_.padInfo.top,re=_.padInfo.left,fe=_.strideHeight,xe=_.strideWidth,Oe=_.dilationHeight,Re=_.dilationWidth,Le=_.filterHeight,Be=_.filterWidth,Xe=Be,nt="int xR; int xC; int xCOffset;",tt=0;tt<Le;tt++)for(var ut=0;ut<Be;ut++)nt+=`
          vec4 xTexelR`+tt+"C"+2*ut+` = vec4(0.);
          vec4 wR`+tt+"C"+ut+` = vec4(0.);
          vec4 xR`+tt+"C"+ut+" = vec4(0.);";for(tt=0;tt<Le;tt++)for(var Nt=0;Nt<Xe;Nt++){if(nt+=`
          xR = xRCorner + `+tt*Oe+`;
          xC = xCCorner + `+(ut=2*Nt)*Re+`;
        `,xe===1){if(ut<Be&&(nt+=re%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+C+" && xCOffset >= 0 && xCOffset < "+z+`) {
                  xTexelR`+tt+"C"+ut+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+z+`) {
                    xTexelR`+tt+"C"+ut+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+tt+"C"+ut+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+C+" && xCOffset >= 0 && xCOffset < "+z+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+z+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+tt+"C"+ut+" = vec4(previous.zw, xTexelR"+tt+"C"+ut+`.xy);
                } else {
                  xR`+tt+"C"+ut+" = vec4(0, 0, xTexelR"+tt+"C"+ut+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+C+" && xC >= 0 && xC < "+z+`) {
                  xTexelR`+tt+"C"+ut+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+tt+"C"+ut+` = vec4(0.);
                }

                xR`+tt+"C"+ut+" = xTexelR"+tt+"C"+ut+`;
              `,ut+1<Be)){var Pt=re%2==0?It(Re):Re;Re%2==0&&re%2==1||Re%2!=0&&re%2!=1?(nt+=`
                  xCOffset = xC + `+re%2+" + "+Pt+`;

                  if(xR >= 0 && xR < `+C+` &&
                    xCOffset >= 0 && xCOffset < `+z+`) {
                    xTexelR`+tt+"C"+(ut+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,Re>1&&(nt+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+C+` &&
                      xCOffset >= 0 && xCOffset < `+z+`) {
                      xTexelR`+tt+"C"+ut+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+tt+"C"+ut+` = vec4(0.);
                    }
                  `),nt+=`
                  xR`+tt+"C"+(ut+1)+` = vec4(
                    xTexelR`+tt+"C"+ut+".zw, xTexelR"+tt+"C"+(ut+2)+`.xy);
                `):nt+=`
                  xCOffset = xC + `+Pt+`;

                  if(xR >= 0 && xR < `+C+` &&
                    xCOffset >= 0 && xCOffset < `+z+`) {
                    xTexelR`+tt+"C"+(ut+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+tt+"C"+(ut+1)+" = xTexelR"+tt+"C"+(ut+2)+`;
                `}}else ut<Be&&(nt+=`
              if(xR >= 0 && xR < `+C+`) {
            `,re%2==1?(nt+=`
                xCOffset = xC + 1 - `+xe+`;
                if(xCOffset >= 0 && xCOffset < `+z+`) {
                  xTexelR`+tt+"C"+ut+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+tt+"C"+ut+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+z+`) {
                  xTexelR`+tt+"C"+(ut+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+tt+"C"+(ut+2)+` = vec4(0.);
                }

                xR`+tt+"C"+ut+` = vec4(
                  xTexelR`+tt+"C"+ut+".zw, xTexelR"+tt+"C"+(ut+2)+`.zw);
              `,ut+1<Be&&(nt+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+xe+`;
                  if(xCOffset >= 0 && xCOffset < `+z+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+tt+"C"+(ut+1)+" = vec4(xTexelR"+tt+"C"+(ut+2)+`.xy, final.xy);
                `)):(nt+=`
                if(xC >= 0 && xC < `+z+`) {
                  xTexelR`+tt+"C"+ut+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+tt+"C"+ut+` = vec4(0.);
                }

                xCOffset = xC + `+xe+`;
                if(xCOffset >= 0 && xCOffset < `+z+`) {
                  xTexelR`+tt+"C"+(ut+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+tt+"C"+(ut+2)+` = vec4(0.);
                }

                xR`+tt+"C"+ut+` = vec4(
                  xTexelR`+tt+"C"+ut+".xy, xTexelR"+tt+"C"+(ut+2)+`.xy);
              `,ut+1<Be&&(nt+=`
                  xR`+tt+"C"+(ut+1)+` = vec4(
                    xTexelR`+tt+"C"+ut+".zw, xTexelR"+tt+"C"+(ut+2)+`.zw);
                `)),nt+="}");ut<Be&&(nt+=`
            vec4 wTexelR`+tt+"C"+ut+" = getW("+tt+", "+ut+`, d1, q);
            wR`+tt+"C"+ut+" = vec4(wTexelR"+tt+"C"+ut+".xz, wTexelR"+tt+"C"+ut+`.xz);
          `,ut+1<Be&&(nt+=`
              vec4 wTexelR`+tt+"C"+(ut+1)+" = getW("+tt+", "+(ut+1)+`, d1, q);
              wR`+tt+"C"+(ut+1)+` =
                vec4(wTexelR`+tt+"C"+(ut+1)+".xz, wTexelR"+tt+"C"+(ut+1)+".xz);"))}for(tt=0;tt<Le;tt++)for(ut=0;ut<Be;ut++)nt+="dotProd += xR"+tt+"C"+ut+" * wR"+tt+"C"+ut+";";var jt="",Yt="";d&&(jt=y?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+d+`
        }`:`vec4 activation(vec4 x) {
          `+d+`
        }`,Yt="result = activation(result);");var gn=v?"result += getBiasAtOutCoords();":"";v&&this.variableNames.push("bias"),y&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+jt+`

      const ivec2 strides = ivec2(`+fe+", "+xe+`);
      const ivec2 pads = ivec2(`+Z+", "+re+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+nt+`

        vec4 result = dotProd;
        `+gn+`
        `+Yt+`
        setOutput(result);
      }
    `};function mo(_,v){if(_===1)return""+v;if(_===2)return v+".y";if(_===3)return v+".z";if(_===4)return v+".w";throw Error("Cumulative sum for rank "+_+" is not yet supported")}var pa=function(){function _(v,d,y){this.variableNames=["x"],this.outputShape=[],this.outputShape=v,this.blockSize=d,this.dataFormat=y,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+d+`;
      int offset_h = imod(h, `+d+`);
      int in_w = w / `+d+`;
      int offset_w = imod(w, `+d+`);
      int offset_d = (offset_h * `+d+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return _.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},_.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},_.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},_.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},_.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},_}(),Go=function(_,v,d){this.variableNames=["real","imag"];var y=v[1];this.outputShape=v;var C=d?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,z=d?y+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+C+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+_+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+y+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+y+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+z+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},sa=function(){function _(v,d){this.outputShape=[],this.variableNames=["x"],this.outputShape=v,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return _.prototype.getCustomSetupFunc=function(v){var d=this;return function(y,C){d.valueLoc==null&&(d.valueLoc=y.getUniformLocationNoThrow(C,"value")),y.gl.uniform1f(d.valueLoc,v)}},_}();function Gi(_,v){var d=ce();return no(_,v,d.version+`
    precision highp float;
    `+d.attribute+` vec3 clipSpacePos;
    `+d.attribute+` vec2 uv;
    `+d.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function Vi(_,v){return el(_,v,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Ao(_,v){return fc(_,v,new Uint16Array([0,1,2,2,1,3]))}function wa(_,v,d,y,C,z,Z){Up(d,y);var re=tl(_,v),fe=_.TEXTURE_2D;return Kn(_,v,function(){return _.bindTexture(fe,re)}),Kn(_,v,function(){return _.texParameteri(fe,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE)}),Kn(_,v,function(){return _.texParameteri(fe,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE)}),Kn(_,v,function(){return _.texParameteri(fe,_.TEXTURE_MIN_FILTER,_.NEAREST)}),Kn(_,v,function(){return _.texParameteri(fe,_.TEXTURE_MAG_FILTER,_.NEAREST)}),Kn(_,v,function(){return _.texImage2D(fe,0,C,d,y,0,z,Z,null)}),Kn(_,v,function(){return _.bindTexture(_.TEXTURE_2D,null)}),re}function Sa(_,v,d,y,C){var z=to(d,y);return wa(_,v,z[0],z[1],C.internalFormatFloat,C.textureFormatFloat,_.FLOAT)}function ga(_,v,d,y,C){var z=to(d,y);return wa(_,v,z[0],z[1],C.internalFormatHalfFloat,C.textureFormatFloat,C.textureTypeHalfFloat)}function ua(_,v,d,y,C){var z=to(d,y);return wa(_,v,z[0],z[1],_.RGBA,_.RGBA,_.UNSIGNED_BYTE)}function ds(_,v,d,y,C){var z=ri(d,y);return wa(_,v,z[0],z[1],C.internalFormatPackedFloat,_.RGBA,_.FLOAT)}function Ca(_,v,d,y,C){var z=ri(d,y);return wa(_,v,z[0],z[1],C.internalFormatPackedHalfFloat,_.RGBA,C.textureTypeHalfFloat)}function Oo(_,v,d,y){return Kn(_,v,function(){return _.bindBuffer(_.ARRAY_BUFFER,y)}),dd(_,v,d,"clipSpacePos",y,3,20,0)&&dd(_,v,d,"uv",y,2,20,12)}function Ia(_,v,d,y,C,z,Z){var re,fe,xe;Kn(_,v,function(){return _.bindTexture(_.TEXTURE_2D,d)}),z instanceof Uint8Array?(re=new Uint8Array(y*C*4),fe=_.UNSIGNED_BYTE,xe=_.RGBA):(re=new Float32Array(y*C*4),fe=_.FLOAT,xe=Z.internalFormatPackedFloat),re.set(z),Kn(_,v,function(){return _.texImage2D(_.TEXTURE_2D,0,xe,y,C,0,_.RGBA,fe,re)}),Kn(_,v,function(){return _.bindTexture(_.TEXTURE_2D,null)})}function Zu(_,v,d,y){Kn(_,v,function(){return _.bindTexture(_.TEXTURE_2D,d)}),y.data instanceof Uint8Array?Kn(_,v,function(){return _.texImage2D(_.TEXTURE_2D,0,_.RGBA,y.width,y.height,0,_.RGBA,_.UNSIGNED_BYTE,y.data)}):Kn(_,v,function(){return _.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,y)}),Kn(_,v,function(){return _.bindTexture(_.TEXTURE_2D,null)})}function Cs(_,v,d,y,C){var z=_.createBuffer();Kn(_,v,function(){return _.bindBuffer(_.PIXEL_PACK_BUFFER,z)});var Z=16*d*y;return Kn(_,v,function(){return _.bufferData(_.PIXEL_PACK_BUFFER,Z,_.STREAM_READ)}),Kn(_,v,function(){return _.readPixels(0,0,y,d,_.RGBA,_.FLOAT,0)}),Kn(_,v,function(){return _.bindBuffer(_.PIXEL_PACK_BUFFER,null)}),z}function $a(_,v,d){var y=_,C=new Float32Array(d);return y.bindBuffer(y.PIXEL_PACK_BUFFER,v),y.getBufferSubData(y.PIXEL_PACK_BUFFER,0,C),y.bindBuffer(y.PIXEL_PACK_BUFFER,null),C}function Uo(_,v,d,y,C){var z=to(d,y),Z=z[0],re=z[1],fe=new Uint8Array(d*y*4);return Kn(_,v,function(){return _.readPixels(0,0,Z,re,C.downloadTextureFormat,_.UNSIGNED_BYTE,fe)}),new Float32Array(fe.buffer)}function jc(_,v,d,y,C,z,Z,re){var fe=_,xe=new Float32Array(function(Oe,Re){var Le=ri(z,Z);return Le[0]*Le[1]*4}());return fe.bindBuffer(fe.PIXEL_PACK_BUFFER,v),fe.getBufferSubData(fe.PIXEL_PACK_BUFFER,0,xe),fe.bindBuffer(fe.PIXEL_PACK_BUFFER,null),xe}function hu(_,v,d,y){var C=new Float32Array(d*y*4);return Kn(_,v,function(){return _.readPixels(0,0,y,d,_.RGBA,_.FLOAT,C)}),C}var Ys=Object.freeze({createVertexShader:Gi,createVertexBuffer:Vi,createIndexBuffer:Ao,createFloat32MatrixTexture:Sa,createFloat16MatrixTexture:ga,createUnsignedBytesMatrixTexture:ua,createPackedMatrixTexture:ds,createFloat16PackedMatrixTexture:Ca,bindVertexProgramAttributeStreams:Oo,uploadDenseMatrixToTexture:Ia,uploadPixelDataToTexture:Zu,createBufferFromOutputTexture:Cs,downloadFloat32MatrixFromBuffer:$a,downloadByteEncodedFloatMatrixFromOutputTexture:Uo,downloadPackedMatrixFromBuffer:jc,downloadMatrixFromPackedOutputTexture:hu}),ca=function(){function _(v){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var d=j().getNumber("WEBGL_VERSION");v!=null?(this.gl=v,Ai(d,v)):this.gl=ni(d);var y="WEBGL_color_buffer_float";if(j().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=Wi(this.gl,this.debug,"OES_texture_float"),Ea(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Wi(this.gl,this.debug,"OES_texture_half_float");else if(j().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(y),Ea(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Wi(this.gl,this.debug,"EXT_color_buffer_half_float");else if(j().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(y="EXT_color_buffer_float",Ea(this.gl,y))this.colorBufferFloatExtension=this.gl.getExtension(y);else{if(!Ea(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Vi(this.gl,this.debug),this.indexBuffer=Ao(this.gl,this.debug),this.framebuffer=xs(this.gl,this.debug),this.textureConfig=Jr(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(_.prototype,"debug",{get:function(){return j().getBool("DEBUG")},enumerable:!0,configurable:!0}),_.prototype.dispose=function(){var v=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var d=this.gl;Kn(d,this.debug,function(){return d.finish()}),Kn(d,this.debug,function(){return d.bindFramebuffer(d.FRAMEBUFFER,null)}),Kn(d,this.debug,function(){return d.deleteFramebuffer(v.framebuffer)}),Kn(d,this.debug,function(){return d.bindBuffer(d.ARRAY_BUFFER,null)}),Kn(d,this.debug,function(){return d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null)}),Kn(d,this.debug,function(){return d.deleteBuffer(v.indexBuffer)}),this.disposed=!0}},_.prototype.createFloat32MatrixTexture=function(v,d){return this.throwIfDisposed(),Sa(this.gl,this.debug,v,d,this.textureConfig)},_.prototype.createFloat16MatrixTexture=function(v,d){return this.throwIfDisposed(),ga(this.gl,this.debug,v,d,this.textureConfig)},_.prototype.createUnsignedBytesMatrixTexture=function(v,d){return this.throwIfDisposed(),ua(this.gl,this.debug,v,d,this.textureConfig)},_.prototype.uploadPixelDataToTexture=function(v,d){this.throwIfDisposed(),Zu(this.gl,this.debug,v,d)},_.prototype.uploadDenseMatrixToTexture=function(v,d,y,C){this.throwIfDisposed(),Ia(this.gl,this.debug,v,d,y,C,this.textureConfig)},_.prototype.createFloat16PackedMatrixTexture=function(v,d){return this.throwIfDisposed(),Ca(this.gl,this.debug,v,d,this.textureConfig)},_.prototype.createPackedMatrixTexture=function(v,d){return this.throwIfDisposed(),ds(this.gl,this.debug,v,d,this.textureConfig)},_.prototype.deleteMatrixTexture=function(v){var d=this;this.throwIfDisposed(),this.outputTexture===v&&(hf(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Kn(this.gl,this.debug,function(){return d.gl.deleteTexture(v)})},_.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(v,d,y){var C=this;return this.downloadMatrixDriver(v,function(){return Uo(C.gl,C.debug,d,y,C.textureConfig)})},_.prototype.downloadPackedMatrixFromBuffer=function(v,d,y,C,z,Z){return jc(this.gl,v,0,0,0,z,Z,this.textureConfig)},_.prototype.downloadFloat32MatrixFromBuffer=function(v,d){return $a(this.gl,v,d)},_.prototype.createBufferFromTexture=function(v,d,y){this.bindTextureToFrameBuffer(v);var C=Cs(this.gl,this.debug,d,y,this.textureConfig);return this.unbindTextureToFrameBuffer(),C},_.prototype.createAndWaitForFence=function(){var v=this.createFence(this.gl);return this.pollFence(v)},_.prototype.createFence=function(v){var d,y,C=this;if(j().getBool("WEBGL_FENCE_API_ENABLED")){var z=v,Z=z.fenceSync(z.SYNC_GPU_COMMANDS_COMPLETE,0);v.flush(),y=function(){var re=z.clientWaitSync(Z,0,0);return re===z.ALREADY_SIGNALED||re===z.CONDITION_SATISFIED},d=Z}else j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(d=this.beginQuery(),this.endQuery(),y=function(){return C.isQueryAvailable(d,j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):y=function(){return!0};return{query:d,isFencePassed:y}},_.prototype.downloadMatrixFromPackedTexture=function(v,d,y){var C=this;return this.downloadMatrixDriver(v,function(){return hu(C.gl,C.debug,d,y)})},_.prototype.createProgram=function(v){this.throwIfDisposed();var d=this.gl,y=So(d,this.debug,v),C=Gi(d,this.debug),z=ro(d,this.debug);return Kn(d,this.debug,function(){return d.attachShader(z,C)}),Kn(d,this.debug,function(){return d.attachShader(z,y)}),Mc(d,this.debug,z),this.debug&&Gu(d,this.debug,z),this.vertexAttrsAreBound||(this.setProgram(z),this.vertexAttrsAreBound=Oo(d,this.debug,this.program,this.vertexBuffer)),z},_.prototype.deleteProgram=function(v){var d=this;this.throwIfDisposed(),v===this.program&&(this.program=null),v!=null&&Kn(this.gl,this.debug,function(){return d.gl.deleteProgram(v)})},_.prototype.setProgram=function(v){var d=this;this.throwIfDisposed(),this.program=v,this.program!=null&&this.debug&&Gu(this.gl,this.debug,this.program),Kn(this.gl,this.debug,function(){return d.gl.useProgram(v)})},_.prototype.getUniformLocation=function(v,d,y){return y===void 0&&(y=!0),this.throwIfDisposed(),y?dc(this.gl,this.debug,v,d):hd(this.gl,v,d)},_.prototype.getAttributeLocation=function(v,d){var y=this;return this.throwIfDisposed(),Kn(this.gl,this.debug,function(){return y.gl.getAttribLocation(v,d)})},_.prototype.getUniformLocationNoThrow=function(v,d){return this.throwIfDisposed(),this.gl.getUniformLocation(v,d)},_.prototype.setInputMatrixTexture=function(v,d,y){this.throwIfDisposed(),this.throwIfNoProgram(),kh(this.gl,this.debug,this.program,v,d,y)},_.prototype.setOutputMatrixTexture=function(v,d,y){this.setOutputMatrixTextureDriver(v,y,d)},_.prototype.setOutputPackedMatrixTexture=function(v,d,y){this.throwIfDisposed();var C=ri(d,y),z=C[0],Z=C[1];this.setOutputMatrixTextureDriver(v,z,Z)},_.prototype.setOutputMatrixWriteRegion=function(v,d,y,C){this.setOutputMatrixWriteRegionDriver(y,v,C,d)},_.prototype.setOutputPackedMatrixWriteRegion=function(v,d,y,C){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},_.prototype.debugValidate=function(){this.program!=null&&Gu(this.gl,this.debug,this.program),Ha(this.gl)},_.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var v=this.gl;this.debug&&this.debugValidate(),Kn(v,this.debug,function(){return v.drawElements(v.TRIANGLES,6,v.UNSIGNED_SHORT,0)})},_.prototype.blockUntilAllProgramsCompleted=function(){var v=this;this.throwIfDisposed(),Kn(this.gl,this.debug,function(){return v.gl.finish()})},_.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Wi(this.gl,this.debug,j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},_.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},_.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},_.prototype.beginQuery=function(){if(j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var v=this.gl,d=this.getQueryTimerExtensionWebGL2(),y=v.createQuery();return v.beginQuery(d.TIME_ELAPSED_EXT,y),y}var C=this.getQueryTimerExtensionWebGL1(),z=C.createQueryEXT();return C.beginQueryEXT(C.TIME_ELAPSED_EXT,z),z},_.prototype.endQuery=function(){if(j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var v=this.getQueryTimerExtensionWebGL1();v.endQueryEXT(v.TIME_ELAPSED_EXT)}else{var d=this.gl,y=this.getQueryTimerExtensionWebGL2();d.endQuery(y.TIME_ELAPSED_EXT)}},_.prototype.waitForQueryAndGetTime=function(v){return D(this,void 0,void 0,function(){var d=this;return R(this,function(y){switch(y.label){case 0:return[4,xt(function(){return d.disposed||d.isQueryAvailable(v,j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return y.sent(),[2,this.getQueryTime(v,j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},_.prototype.getQueryTime=function(v,d){if(d===0)return null;if(d===2){var y=this.gl;return y.getQueryParameter(v,y.QUERY_RESULT)/1e6}var C=this.getQueryTimerExtensionWebGL1();return C.getQueryObjectEXT(v,C.QUERY_RESULT_EXT)/1e6},_.prototype.isQueryAvailable=function(v,d){if(d===0)return!0;if(d===2){var y=this.gl,C=this.getQueryTimerExtensionWebGL2(),z=y.getQueryParameter(v,y.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(C.GPU_DISJOINT_EXT)),z&&!this.disjoint}return z=(C=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(v,C.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(C.GPU_DISJOINT_EXT)),z&&!this.disjoint},_.prototype.pollFence=function(v){var d=this;return new Promise(function(y){d.addItemToPoll(function(){return v.isFencePassed()},function(){return y()})})},_.prototype.pollItems=function(){for(var v=function(y){for(var C=0;C<y.length&&y[C]();++C);return C-1}(this.itemsToPoll.map(function(y){return y.isDoneFn})),d=0;d<=v;++d)(0,this.itemsToPoll[d].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(v+1)},_.prototype.addItemToPoll=function(v,d){var y=this;this.itemsToPoll.push({isDoneFn:v,resolveFn:d}),this.itemsToPoll.length>1||xt(function(){return y.pollItems(),y.itemsToPoll.length===0})},_.prototype.bindTextureToFrameBuffer=function(v){this.throwIfDisposed(),nl(this.gl,this.debug,v,this.framebuffer),this.debug&&Ha(this.gl)},_.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(nl(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Ha(this.gl)):hf(this.gl,this.debug,this.framebuffer)},_.prototype.downloadMatrixDriver=function(v,d){this.bindTextureToFrameBuffer(v);var y=d();return this.unbindTextureToFrameBuffer(),y},_.prototype.setOutputMatrixTextureDriver=function(v,d,y){this.throwIfDisposed();var C=this.gl;nl(C,this.debug,v,this.framebuffer),this.debug&&Ha(C),this.outputTexture=v,Kn(C,this.debug,function(){return C.viewport(0,0,d,y)}),Kn(C,this.debug,function(){return C.scissor(0,0,d,y)})},_.prototype.setOutputMatrixWriteRegionDriver=function(v,d,y,C){var z=this;this.throwIfDisposed(),Kn(this.gl,this.debug,function(){return z.gl.scissor(v,d,y,C)})},_.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},_.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},_}();function Js(_,v){if(_.length!==v.length)throw Error("Binary was compiled with "+_.length+" inputs, but was executed with "+v.length+" inputs");_.forEach(function(d,y){var C=d.logicalShape,z=v[y],Z=z.shape;if(!Ut(C,Z))throw Error("Binary was compiled with different shapes than the current args. Shapes "+C+" and "+Z+" must match");if(!d.isUniform||!z.isUniform){var re=d.texShape,fe=z.isUniform?null:z.texData.texShape;if(!Ut(re,fe))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+re+" and "+fe+" must match")}})}var Wo=function(_,v,d,y,C,z,Z){d===void 0&&(d=!1),y===void 0&&(y=!1),C===void 0&&(C=!1),z===void 0&&(z=null),Z===void 0&&(Z=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=v;var re=d?_[1]:_[2],fe=Math.ceil(re/2),xe=d?"i * 2, rc.y":"rc.y, i * 2",Oe=y?"rc.z, i * 2":"i * 2, rc.z",Re=d?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],Le=y?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],Be="",Xe="";z&&(Be=Z?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+z+`
        }`:`vec4 activation(vec4 x) {
          `+z+`
        }`,Xe="result = activation(result);");var nt=C?"result += getBiasAtOutCoords();":"";C&&this.variableNames.push("bias"),Z&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+Be+`

      const float sharedDimension = `+fe+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+fe+`; i++) {
          vec4 a = getMatrixA(rc.x, `+xe+`);
          vec4 b = getMatrixB(rc.x, `+Oe+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+Re[0]+" * "+Le[0]+`);
          result += (`+Re[1]+" * "+Le[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+nt+`

        `+Xe+`

        setOutput(result);
      }
    `},zs=function(){function _(v,d,y){this.variableNames=["probs"],this.outputShape=[v,y],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(d-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(d-1)+`));
      }
    `}return _.prototype.getCustomSetupFunc=function(v){var d=this;return function(y,C){d.seedLoc==null&&(d.seedLoc=y.getUniformLocation(C,"seed")),y.gl.uniform1f(d.seedLoc,v)}},_}(),ks=function(_,v,d){if(this.variableNames=["x"],v==="avg"&&d)throw new Error("Cannot compute positions for average pool.");var y=_.filterWidth,C=_.strideHeight,z=_.strideWidth,Z=_.dilationHeight,re=_.dilationWidth,fe=_.effectiveFilterHeight,xe=_.effectiveFilterWidth,Oe=_.padInfo.top,Re=_.padInfo.left;this.outputShape=_.outShape;var Le=v==="avg",Be="0.0";if(Le||(Be="-1.0 / 1e-20"),d)this.userCode=`
        const ivec2 strides = ivec2(`+C+", "+z+`);
        const ivec2 pads = ivec2(`+Oe+", "+Re+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+fe+`;
              wR += `+Z+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+_.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+xe+`;
                wC += `+re+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+_.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+xe+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var Xe=v+"("+v+"("+v+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";v==="avg"&&(Xe="avgValue / count");var nt=4*Math.floor(y/4),tt=y%4,ut=`
      if (`+Le+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+C+", "+z+`);
      const ivec2 pads = ivec2(`+Oe+", "+Re+`);
      const float initializationValue = `+Be+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+_.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+Be+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+fe+`;
            wR += `+Z+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+_.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+nt+`; wC += 4) {
            int xC = xCCorner + wC * `+re+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+re+`, d),
              getValue(batch, xR, xC + 2 * `+re+`, d),
              getValue(batch, xR, xC + 3 * `+re+`, d)
            );

            `+ut+`
          }

          int xC = xCCorner + `+nt+`;
          if (`+(tt===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+ut+`
          } else if (`+(tt===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+re+`, d),
              initializationValue,
              initializationValue
            );

            `+ut+`
          } else if (`+(tt===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+re+`, d),
              getValue(batch, xR, xC + 2 * `+re+`, d),
              initializationValue
            );

            `+ut+`
          }
        }
        setOutput(`+Xe+`);
      }
    `}},yo=function(_,v,d){if(this.variableNames=["x"],v==="avg"&&d)throw new Error("Cannot compute positions for average pool.");var y=_.filterWidth,C=_.strideDepth,z=_.strideHeight,Z=_.strideWidth,re=_.dilationDepth,fe=_.dilationHeight,xe=_.dilationWidth,Oe=_.effectiveFilterDepth,Re=_.effectiveFilterHeight,Le=_.effectiveFilterWidth,Be=_.padInfo.front,Xe=_.padInfo.top,nt=_.padInfo.left;this.outputShape=_.outShape;var tt=v==="avg",ut="0.0";if(tt||(ut="-1.0 / 1e-20"),d)this.userCode=`
        const ivec3 strides =
            ivec3(`+C+", "+z+", "+Z+`);
        const ivec3 pads = ivec3(`+Be+", "+Xe+", "+nt+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+Oe+`;
              wD += `+re+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+_.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+Re+`;
                wR += `+fe+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+_.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+Le+`;
                  wC += `+xe+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+_.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+Re+" * "+Le+` +
                      wR * `+Le+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var Nt=v+"("+v+"("+v+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";v==="avg"&&(Nt="avgValue / count");var Pt=4*Math.floor(y/4),jt=y%4,Yt=`
      if (`+tt+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+C+", "+z+", "+Z+`);
      const ivec3 pads = ivec3(`+Be+", "+Xe+", "+nt+`);
      const float initializationValue = `+ut+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+_.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+ut+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+Oe+`;
            wD += `+re+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+_.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+Re+`;
            wR += `+fe+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+_.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+Pt+`; wC += 4) {
              int xC = xCCorner + wC * `+xe+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+xe+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+xe+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+xe+`, ch)
              );

              `+Yt+`
            }

            int xC = xCCorner + `+Pt+`;
            if (`+(jt===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+Yt+`
            } else if (`+(jt===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+xe+`, ch),
                initializationValue,
                initializationValue
              );

              `+Yt+`
            } else if (`+(jt===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+xe+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+xe+`, ch),
                initializationValue
              );

              `+Yt+`
            }
          }
          setOutput(`+Nt+`);
        }
      }
    `}},Us=function(_,v,d,y,C,z,Z){this.variableNames=["updates","indices","defaultValue"],this.outputShape=z;var re=Yn(C.length),fe=Yn(z.length),xe="";d===1?xe="i":d===2&&(xe="i, j");var Oe="getIndices("+xe+")",Re="";y===1?Re="i":y===2&&(Re="i, coords[1]");var Le="getUpdates("+Re+")",Be=v>1?"strides[j]":"strides";this.userCode=`
        `+re+" strides = "+re+"("+C+`);

        void main() {
          `+fe+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+_+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+v+`; j++) {
              int index = round(`+Oe+`);
              flattenedIndex += index * `+Be+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+Le+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},os=function(){function _(v){this.variableNames=["source"],this.outputShape=v,this.rank=v.length;var d,y=Yn(this.rank),C="uniform int start["+this.rank+"];",z=function(Z){if(Z===1)return"sourceLoc";if(Z<=6)return pu.slice(0,Z).map(function(re){return"sourceLoc."+re}).join(",");throw Error("Slicing for rank "+Z+" is not yet supported")}(this.rank);d=`
        `+y+` sourceLoc;
        `+y+` coords = getOutputCoords();
        `+v.map(function(Z,re){return"sourceLoc."+pu[re]+" = start["+re+"] + coords."+pu[re]+";"}).join(`
`)+`
      `,this.userCode=`
      `+C+`
      void main() {
        `+d+`
        setOutput(getSource(`+z+`));
      }
    `}return _.prototype.getCustomSetupFunc=function(v){var d=this;if(v.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+v.length+")");return function(y,C){d.startLoc==null&&(d.startLoc=y.getUniformLocationNoThrow(C,"start"),d.startLoc==null)||y.gl.uniform1iv(d.startLoc,v)}},_}(),pu=["x","y","z","w","u","v"],ul=function(){function _(v){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=v,this.rank=v.length;var d=Yn(this.rank),y=G("coords",this.rank),C=G("sourceLoc",this.rank),z=this.rank===1?"sourceLoc":"vec2("+C.slice(-2).join()+")",Z="getChannel(getSource("+C.join()+"), "+z+")",re=`
      result.x = `+Z+`;
      if (++`+y[this.rank-1]+" < "+v[this.rank-1]+`) {
        ++`+C[this.rank-1]+`;
        result.y = `+Z+`;
        --`+C[this.rank-1]+`;
      }
    `,fe=this.rank===1?"":`
      --`+y[this.rank-1]+`;
      if (++`+y[this.rank-2]+" < "+v[this.rank-2]+`) {
        ++`+C[this.rank-2]+`;
        result.z = `+Z+`;
        if (++`+y[this.rank-1]+" < "+v[this.rank-1]+`) {
          ++`+C[this.rank-1]+`;
          result.w = `+Z+`;
        }
      }
    `,xe=this.rank<=4?`sourceLoc = coords +
            `+d+"("+v.map(function(Oe,Re){return"start["+Re+"]"}).join()+");":v.map(function(Oe,Re){return C[Re]+" = "+y[Re]+" + start["+Re+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+d+` coords = getOutputCoords();
        `+d+` sourceLoc;
        `+xe+`
        vec4 result = vec4(0.);
        `+re+`
        `+fe+`
        setOutput(result);
      }
    `}return _.prototype.getCustomSetupFunc=function(v){var d=this;if(v.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+v.length+")");return function(y,C){d.startLoc==null&&(d.startLoc=y.getUniformLocationNoThrow(C,"start"),d.startLoc==null)||y.gl.uniform1iv(d.startLoc,v)}},_}(),Yo=function(){function _(v){this.gpgpu=v,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return _.prototype.acquireTexture=function(v,d,y){var C,z=hs(d,y),Z=Xa(v,z,y);if(Z in this.freeTextures||(this.freeTextures[Z]=[]),Z in this.usedTextures||(this.usedTextures[Z]=[]),this.freeTextures[Z].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var re=this.freeTextures[Z].shift();return this.usedTextures[Z].push(re),re}return this.numUsedTextures++,this.log(),z===jr.PACKED_2X2_FLOAT32?C=this.gpgpu.createPackedMatrixTexture(v[0],v[1]):z===jr.PACKED_2X2_FLOAT16?C=this.gpgpu.createFloat16PackedMatrixTexture(v[0],v[1]):z===jr.UNPACKED_FLOAT32?C=this.gpgpu.createFloat32MatrixTexture(v[0],v[1]):z===jr.UNPACKED_FLOAT16?C=this.gpgpu.createFloat16MatrixTexture(v[0],v[1]):z===jr.PACKED_4X1_UNSIGNED_BYTE&&(C=this.gpgpu.createUnsignedBytesMatrixTexture(v[0],v[1])),this.usedTextures[Z].push(C),C},_.prototype.releaseTexture=function(v,d,y,C){if(this.freeTextures!=null){var z=Xa(d,hs(y,C),C);z in this.freeTextures||(this.freeTextures[z]=[]),this.freeTextures[z].push(v),this.numFreeTextures++,this.numUsedTextures--;var Z=this.usedTextures[z],re=Z.indexOf(v);if(re<0)throw new Error("Cannot release a texture that was never provided by this texture manager");Z.splice(re,1),this.log()}},_.prototype.log=function(){if(this.logEnabled){var v=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+v+")")}},_.prototype.getNumUsedTextures=function(){return this.numUsedTextures},_.prototype.getNumFreeTextures=function(){return this.numFreeTextures},_.prototype.dispose=function(){var v=this;if(this.freeTextures!=null){for(var d in this.freeTextures)this.freeTextures[d].forEach(function(y){v.gpgpu.deleteMatrixTexture(y)});for(var d in this.usedTextures)this.usedTextures[d].forEach(function(C){v.gpgpu.deleteMatrixTexture(C)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},_}();function hs(_,v){if(_===lr.UPLOAD)return jr.PACKED_2X2_FLOAT32;if(_===lr.RENDER||_==null)return function(d){return j().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?d?jr.PACKED_2X2_FLOAT32:jr.UNPACKED_FLOAT32:d?jr.PACKED_2X2_FLOAT16:jr.UNPACKED_FLOAT16}(v);if(_===lr.DOWNLOAD||_===lr.PIXELS)return jr.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+_)}function Xa(_,v,d){return _[0]+"_"+_[1]+"_"+v+"_"+d}var zc=1.7580993408473768,zl=1.0507009873554805,Ei=function(_,v){this.variableNames=["A"],this.outputShape=_,this.userCode=`
      float unaryOperation(float x) {
        `+v+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},sm="if (isnan(x)) return x;",Ul="return x;",Tf="return abs(x);",uv=sm+`
  return (x < 0.0) ? 0.0 : x;
`,cv=sm+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,t0="return (x >= 0.0) ? x : (exp(x) - 1.0);",n0="return -x;",lv="return ceil(x);",r0="return floor(x);",fv="return exp(x);",Id="return exp(x) - 1.0;",um="return x;",dv="return x;",hv=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,pv=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cl=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Fd=function(_,v){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=_,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+v+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},cm={};function i0(_,v){if(v===void 0&&(v=!1),_==="linear")return v?dv:Ul;if(_==="relu")return v?hv:uv;if(_==="elu")return v?cl:t0;if(_==="relu6")return v?pv:cv;if(_==="prelu")return v?wi:ui;throw new Error("Activation "+_+" has not been implemented for the WebGL backend.")}var o0=600,Ny=function(_){function v(d){var y,C=_.call(this)||this;if(C.pendingRead=new WeakMap,C.pendingDisposal=new WeakSet,C.dataRefCount=new WeakMap,C.numBytesInGPU=0,C.uploadWaitMs=0,C.downloadWaitMs=0,C.warnedAboutMemory=!1,C.pendingDeletes=0,C.disposed=!1,!j().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(d==null){var z=ni(j().getNumber("WEBGL_VERSION"));C.binaryCache=((y=j().getNumber("WEBGL_VERSION"))in cm||(cm[y]={}),cm[y]),C.gpgpu=new ca(z),C.canvas=z.canvas,C.gpgpuCreatedLocally=!0}else C.gpgpu=d,C.binaryCache={},C.gpgpuCreatedLocally=!1,C.canvas=d.gl.canvas;return C.textureManager=new Yo(C.gpgpu),C.numMBBeforeWarning=j().global.screen==null?1024:j().global.screen.height*j().global.screen.width*window.devicePixelRatio*o0/1024/1024,C.texData=new Af(C,He),C}return B(v,_),v.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},v.prototype.write=function(d,y,C){if(j().getBool("DEBUG")&&this.checkNumericalProblems(d),C==="complex64"&&d!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var z={};return this.texData.set(z,{shape:y,dtype:C,values:d,usage:lr.UPLOAD}),z},v.prototype.move=function(d,y,C,z){if(j().getBool("DEBUG")&&this.checkNumericalProblems(y),z==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(d,{shape:C,dtype:z,values:y,usage:lr.UPLOAD})},v.prototype.readSync=function(d){var y=this.texData.get(d),C=y.values,z=y.dtype,Z=y.complexTensors,re=y.slice,fe=y.shape,xe=y.isPacked;if(re!=null){var Oe;Oe=xe?new Fd(fe,um):new Ei(fe,um);var Re=this.runWebGLProgram(Oe,[{dataId:d,shape:fe,dtype:z}],z),Le=this.readSync(Re.dataId);return this.disposeData(Re.dataId),Le}if(C!=null)return this.convertAndCacheOnCPU(d);if(z==="string")return C;var Be,Xe,nt=this.activeTimers!=null;return nt&&(Be=en()),Xe=z==="complex64"?Yu(Z.real.dataSync(),Z.imag.dataSync()):this.getValuesFromTexture(d),nt&&(this.downloadWaitMs+=en()-Be),this.convertAndCacheOnCPU(d,Xe)},v.prototype.read=function(d){return D(this,void 0,void 0,function(){var y,C,z,Z,re,fe,xe,Oe,Re,Le,Be,Xe,nt,tt,ut,Nt,Pt,jt,Yt,gn,wn,vn;return R(this,function(Cn){switch(Cn.label){case 0:if(this.pendingRead.has(d))return y=this.pendingRead.get(d),[2,new Promise(function(Dn){return y.push(Dn)})];if(C=this.texData.get(d),z=C.values,Z=C.shape,re=C.slice,fe=C.dtype,xe=C.complexTensors,Oe=C.isPacked,re!=null)return Re=void 0,Re=Oe?new Fd(Z,um):new Ei(Z,um),Le=this.runWebGLProgram(Re,[{dataId:d,shape:Z,dtype:fe}],fe),Be=this.read(Le.dataId),this.disposeData(Le.dataId),[2,Be];if(z!=null)return[2,this.convertAndCacheOnCPU(d)];if(!j().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&j().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return Xe=null,fe!=="complex64"&&j().get("WEBGL_BUFFER_SUPPORTED")&&(nt=this.decode(d),tt=this.texData.get(nt.dataId),Xe=(vn=this.gpgpu).createBufferFromTexture.apply(vn,[tt.texture].concat(yi(Z)))),this.pendingRead.set(d,[]),fe==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:Cn.sent(),Cn.label=2;case 2:return fe!=="complex64"?[3,4]:[4,Promise.all([xe.real.data(),xe.imag.data()])];case 3:return Nt=Cn.sent(),Pt=Nt[0],jt=Nt[1],ut=Yu(Pt,jt),[3,5];case 4:Xe==null?ut=this.getValuesFromTexture(d):(Yt=ze(Z),ut=this.gpgpu.downloadFloat32MatrixFromBuffer(Xe,Yt)),Cn.label=5;case 5:return nt!=null&&this.disposeData(nt.dataId),gn=this.convertAndCacheOnCPU(d,ut),wn=this.pendingRead.get(d),this.pendingRead.delete(d),wn.forEach(function(Dn){return Dn(gn)}),this.pendingDisposal.has(d)&&(this.pendingDisposal.delete(d),this.disposeData(d),this.pendingDeletes--),[2,gn]}})})},v.prototype.checkNumericalProblems=function(d){if(d!=null)for(var y=0;y<d.length;y++){var C=d[y];if(!Wr(C))throw j().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+C+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+C+" cannot be represented on this device.")}},v.prototype.getValuesFromTexture=function(d){var y,C=this.texData.get(d),z=C.shape,Z=C.dtype,re=C.isPacked,fe=ze(z);if(j().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var xe=this.decode(d),Oe=this.texData.get(xe.dataId),Re=(y=this.gpgpu).downloadMatrixFromPackedTexture.apply(y,[Oe.texture].concat(yi(z))).subarray(0,fe);return this.disposeData(xe.dataId),Re}var Le=j().getBool("WEBGL_PACK")&&re===!0,Be=Le?Nc(z):z,Xe=Le?new function(Nt){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=lr.DOWNLOAD;var Pt=ce();this.outputShape=Nt,this.userCode=`
      `+bt+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+Pt.output+` = encode_float(x);
      }
    `}(Be):new function(Nt){this.variableNames=["A"],this.outTexUsage=lr.DOWNLOAD;var Pt=ce();this.outputShape=Nt,this.userCode=`
      `+bt+`

      void main() {
        float x = getAAtOutCoords();
        `+Pt.output+` = encode_float(x);
      }
    `}(Be),nt=this.runWebGLProgram(Xe,[{shape:Be,dtype:Z,dataId:d}],"float32"),tt=this.texData.get(nt.dataId),ut=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(tt.texture,tt.texShape[0],tt.texShape[1]).subarray(0,fe);return this.disposeData(nt.dataId),ut},v.prototype.time=function(d){return D(this,void 0,void 0,function(){var y,C,z,Z,re,fe,xe;return R(this,function(Oe){switch(Oe.label){case 0:return y=this.activeTimers,C=[],z=!1,this.programTimersStack==null?(this.programTimersStack=C,z=!0):this.activeTimers.push(C),this.activeTimers=C,d(),Z=Ot(this.activeTimers.map(function(Re){return Re.query})).filter(function(Re){return Re!=null}),re=Ot(this.activeTimers.map(function(Re){return Re.name})).filter(function(Re){return Re!=null}),this.activeTimers=y,z&&(this.programTimersStack=null),fe={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(Z)]:[3,2];case 1:return xe=Oe.sent(),fe.kernelMs=wt(xe),fe.getExtraProfileInfo=function(){return xe.map(function(Re,Le){return{name:re[Le],ms:Re}}).map(function(Re){return Re.name+": "+Re.ms}).join(", ")},[3,3];case 2:fe.kernelMs={error:"WebGL query timers are not supported in this environment."},Oe.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,fe]}})})},v.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},v.prototype.startTimer=function(){return j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:en(),endMs:null}},v.prototype.endTimer=function(d){return j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),d):(d.endMs=en(),d)},v.prototype.getQueryTime=function(d){return D(this,void 0,void 0,function(){var y;return R(this,function(C){return j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(d)]:[2,(y=d).endMs-y.startMs]})})},v.prototype.disposeData=function(d){if(!this.pendingDisposal.has(d)){if(this.pendingRead.has(d))return this.pendingDisposal.add(d),void this.pendingDeletes++;if(this.texData.has(d)){this.releaseGPUData(d);var y=this.texData.get(d).complexTensors;y!=null&&(y.real.dispose(),y.imag.dispose()),this.texData.delete(d)}}},v.prototype.releaseGPUData=function(d){var y=this.texData.get(d),C=y.texture,z=y.dtype,Z=y.texShape,re=y.usage,fe=y.isPacked,xe=y.slice,Oe=xe&&xe.origDataId||d,Re=this.dataRefCount.get(Oe);Re>1?this.dataRefCount.set(Oe,Re-1):(this.dataRefCount.delete(Oe),C!=null&&(this.numBytesInGPU-=this.computeBytes(Z,z),this.textureManager.releaseTexture(C,Z,re,fe)));var Le=this.texData.get(d);Le.texture=null,Le.texShape=null,Le.isPacked=!1,Le.slice=null},v.prototype.getTexture=function(d){return this.uploadToGPU(d),this.texData.get(d).texture},v.prototype.getDataInfo=function(d){return this.texData.get(d)},v.prototype.getCPUBackend=function(){return j().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=He.findBackend("cpu")),this.cpuBackend):null},v.prototype.shouldExecuteOnCPU=function(d,y){var C=this;return y===void 0&&(y=128),this.getCPUBackend()!=null&&d.every(function(z){return C.texData.get(z.dataId).texture==null&&z.size<y})},v.prototype.getGPGPUContext=function(){return this.gpgpu},v.prototype.complex=function(d,y){var C=this.makeOutput(d.shape,"complex64");return this.texData.get(C.dataId).complexTensors={real:He.keep(d.clone()),imag:He.keep(y.clone())},C},v.prototype.real=function(d){return this.texData.get(d.dataId).complexTensors.real.clone()},v.prototype.imag=function(d){return this.texData.get(d.dataId).complexTensors.imag.clone()},v.prototype.slice=function(d,y,C){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.slice(d,y,C);if(ze(C)===0)return No([],C,d.dtype);var z=this.texData.get(d.dataId).isPacked,Z=Ad(d.shape,y,C);if(z||!Z){var re=j().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ul(C):new os(C),fe=re.getCustomSetupFunc(y);return this.compileAndRun(re,[d],null,fe)}return this.uploadToGPU(d.dataId),this.shallowSlice(d,y,C)},v.prototype.shallowSlice=function(d,y,C){var z=this.texData.get(d.dataId),Z=this.makeOutput(C,d.dtype),re=this.texData.get(Z.dataId);Object.assign(re,z),re.shape=C,re.dtype=d.dtype;var fe=Vh(y,d.strides);z.slice&&(fe+=z.slice.flatOffset),re.slice={flatOffset:fe,origDataId:z.slice&&z.slice.origDataId||d.dataId};var xe=this.dataRefCount.get(re.slice.origDataId)||1;return this.dataRefCount.set(re.slice.origDataId,xe+1),Z},v.prototype.stridedSlice=function(d,y,C,z){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.stridedSlice(d,y,C,z);var Z=Sf(y,C,z);if(Z.some(function(fe){return fe===0}))return No([],Z);var re=new function(fe,xe,Oe){this.variableNames=["x"],this.outputShape=Oe;var Re=Oe.length,Le=Yn(Oe.length),Be=Yn(Oe.length),Xe="";if(Re===1)Xe="coords * strides + begin";else{var nt=0;Xe=Oe.map(function(tt,ut){return nt++,Oe.length===1?"coords * strides["+ut+"] + begin["+ut+"]":"coords["+(nt-1)+"] * strides["+ut+"] + begin["+ut+"]"}).join(",")}this.userCode=`
      `+Le+" begin = "+Le+"("+fe+`);
      `+Le+" strides = "+Le+"("+xe+`);

      void main() {
        `+Be+` coords = getOutputCoords();
        setOutput(getX(`+Xe+`));
      }
    `}(y,z,Z);return this.compileAndRun(re,[d])},v.prototype.reverse=function(d,y){var C=j().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(z,Z){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var re=z.length;if(re>4)throw new Error("WebGL backend: Reverse of rank-"+re+" tensor is not yet supported");this.outputShape=z;var fe=G("rc",re),xe=fe[re-1]+" + 1 < "+this.outputShape[re-1],Oe=fe[re-2]+" + 1 < "+this.outputShape[re-2],Re=Yn(re);function Le(Be){var Xe=z.map(function(nt,tt){return function(ut,Nt){return Z.indexOf(ut)!==-1&&z[ut]!==1?z[ut]+" - "+Nt[ut]+" - 1":""+Nt[ut]}(tt,Be)});return"getChannel(getX("+Xe.join(",")+"), vec2("+Xe.slice(-2).join(",")+"))"}this.userCode=re===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+z[0]+` - rc - 1),
            `+z[0]+` - rc - 1);
          if(`+xe+`){
              result.g = getChannel(getX(`+z[0]+` - (rc  + 1) - 1),
                `+z[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+Re+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+Le(fe.slice())+`;
          if(`+xe+`){
            result.g = `+function(Be){return Be[re-1]="("+Be[re-1]+" + 1)",Le(Be)}(fe.slice())+`;
          }
          if(`+Oe+`) {
            result.b = `+function(Be){return Be[re-2]="("+Be[re-2]+" + 1)",Le(Be)}(fe.slice())+`;
            if(`+xe+`) {
              result.a = `+function(Be){return Be[re-1]="("+Be[re-1]+" + 1)",Be[re-2]="("+Be[re-2]+" + 1)",Le(Be)}(fe.slice())+`;
            }
          }
          setOutput(result);
        }
    `}(d.shape,y):new function(z,Z){this.variableNames=["x"];var re=z.length;if(re>4)throw new Error("WebGL backend: Reverse of rank-"+re+" tensor is not yet supported");if(this.outputShape=z,re!==1){var fe=z.map(function(Oe,Re){return function(Le){return Z.indexOf(Le)!==-1&&z[Le]!==1?z[Le]+" - coords["+Le+"] - 1":"coords["+Le+"]"}(Re)}).join(","),xe=Yn(re);this.userCode=`
      void main() {
        `+xe+` coords = getOutputCoords();
        setOutput(getX(`+fe+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+z[0]+` - coord - 1));
        }
      `}(d.shape,y);return this.compileAndRun(C,[d])},v.prototype.concat=function(d,y){if(d[0].dtype==="complex64"){var C=d.map(function(Be){return xa(Be)}),z=d.map(function(Be){return Za(Be)});return Co(this.concat(C,y),this.concat(z,y))}if(this.shouldExecuteOnCPU(d))return this.cpuBackend.concat(d,y);if(d.length===1)return d[0];if(d.length>j().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var Z=Math.floor(d.length/2),re=this.concat(d.slice(0,Z),y),fe=this.concat(d.slice(Z),y);return this.concat([re,fe],y)}if(j().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&d[0].rank>1){var xe=new function(Be,Xe){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=_u(Be,Xe);var nt=this.outputShape,tt=nt.length,ut=Yn(tt),Nt=G("coords",tt),Pt=["x","y","z","w","u","v"].slice(0,tt);this.variableNames=Be.map(function(l,m){return"T"+m});var jt=new Array(Be.length-1);jt[0]=Be[0][Xe];for(var Yt=1;Yt<jt.length;Yt++)jt[Yt]=jt[Yt-1]+Be[Yt][Xe];var gn=Pt[Xe],wn=Pt.slice(-2),vn=Pt.join(),Cn="if ("+gn+" < "+jt[0]+`) {
        return getChannel(
            getT0(`+vn+"), vec2("+wn.join()+`));
        }`;for(Yt=1;Yt<jt.length;Yt++){var Dn=jt[Yt-1];Cn+=`
        if (`+gn+" < "+jt[Yt]+"  && "+gn+" >= "+jt[Yt-1]+`) {
          return getChannel(
            getT`+Yt+"("+po(Pt,gn,Dn)+`),
            vec2(`+po(wn,gn,Dn)+`));
        }`}var b=jt.length,p=jt[jt.length-1];Cn+=`
        return getChannel(
          getT`+b+"("+po(Pt,gn,p)+`),
          vec2(`+po(wn,gn,p)+"));",this.userCode=`
      float getValue(`+Pt.map(function(l){return"int "+l})+`) {
        `+Cn+`
      }

      void main() {
        `+ut+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+Nt+`), 0., 0., 0.);

        `+Nt[tt-1]+" = "+Nt[tt-1]+` + 1;
        if (`+Nt[tt-1]+" < "+nt[tt-1]+`) {
          result.g = getValue(`+Nt+`);
        }

        `+Nt[tt-2]+" = "+Nt[tt-2]+` + 1;
        if (`+Nt[tt-2]+" < "+nt[tt-2]+`) {
          result.a = getValue(`+Nt+`);
        }

        `+Nt[tt-1]+" = "+Nt[tt-1]+` - 1;
        if (`+Nt[tt-2]+" < "+nt[tt-2]+` &&
            `+Nt[tt-1]+" < "+nt[tt-1]+`) {
          result.b = getValue(`+Nt+`);
        }
        setOutput(result);
      }
    `}(d.map(function(Be){return Be.shape}),y);return this.compileAndRun(xe,d)}var Oe=_u(d.map(function(Be){return Be.shape}),y),Re=d.map(function(Be){return Be.as2D(-1,ze(Be.shape.slice(y)))}),Le=new function(Be){this.outputShape=[],this.outputShape=_u(Be,1),this.variableNames=Be.map(function(jt,Yt){return"T"+Yt});var Xe=new Array(Be.length-1);Xe[0]=Be[0][1];for(var nt=1;nt<Xe.length;nt++)Xe[nt]=Xe[nt-1]+Be[nt][1];var tt=["if (yC < "+Xe[0]+") setOutput(getT0(yR, yC));"];for(nt=1;nt<Xe.length;nt++){var ut=Xe[nt-1];tt.push("else if (yC < "+Xe[nt]+") setOutput(getT"+nt+"(yR, yC-"+ut+"));")}var Nt=Xe.length,Pt=Xe[Xe.length-1];tt.push("else setOutput(getT"+Nt+"(yR, yC-"+Pt+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+tt.join(`
        `)+`
      }
    `}(Re.map(function(Be){return Be.shape}));return this.compileAndRun(Le,Re).reshape(Oe)},v.prototype.neg=function(d){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.neg(d);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(d,n0,d.dtype);var y=new Ei(d.shape,n0);return this.compileAndRun(y,[d])},v.prototype.batchMatMul=function(d,y,C,z){var Z=C?d.shape[2]:d.shape[1],re=z?y.shape[1]:y.shape[2],fe=C?d.shape[1]:d.shape[2],xe=d.shape[0];if((Z===1||re===1)&&fe>1e3){C&&(d=d.transpose([0,2,1])),z&&(y=y.transpose([0,2,1]));var Oe=re===1?d:d.as3D(xe,fe,1),Re=re===1?2:1,Le=re===1?y.as3D(xe,1,fe):y;return this.multiply(Oe,Le).sum(Re,!0)}var Be=Sn(d.dtype,y.dtype),Xe=new Wo(d.shape,[xe,Z,re],C,z);return this.compileAndRun(Xe,[d,y],Be)},v.prototype.fusedBatchMatMul=function(d){var y=d.a,C=d.b,z=d.transposeA,Z=d.transposeB,re=d.bias,fe=d.activation,xe=d.preluActivationWeights,Oe=z?y.shape[2]:y.shape[1],Re=Z?C.shape[1]:C.shape[2],Le=y.shape[0],Be=Sn(y.dtype,C.dtype),Xe=re!=null,nt=xe!=null,tt=fe?i0(fe,!0):null,ut=new Wo(y.shape,[Le,Oe,Re],z,Z,Xe,tt,nt),Nt=[y,C];return re&&Nt.push(re),xe&&Nt.push(xe),this.compileAndRun(ut,Nt,Be)},v.prototype.multiply=function(d,y){if(d.dtype==="complex64"){var C=this.texData.get(d.dataId),z=this.texData.get(y.dataId),Z=new Tr("return areal * breal - aimag * bimag;",d.shape,y.shape),re=new Tr("return areal * bimag + aimag * breal;",d.shape,y.shape),fe=[this.makeComplexComponentTensorInfo(d,C.complexTensors.real),this.makeComplexComponentTensorInfo(d,C.complexTensors.imag),this.makeComplexComponentTensorInfo(y,z.complexTensors.real),this.makeComplexComponentTensorInfo(y,z.complexTensors.imag)],xe=this.compileAndRun(Z,fe),Oe=this.compileAndRun(re,fe),Re=this.complex(xe,Oe);return xe.dispose(),Oe.dispose(),Re}if(this.shouldExecuteOnCPU([d,y]))return this.cpuBackend.multiply(d,y);if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,Fr,d.dtype);var Le=new ii(Fr,d.shape,y.shape);return this.compileAndRun(Le,[d,y],d.dtype)},v.prototype.batchNormalization=function(d,y,C,z,Z,re){var fe=[d,y,C],xe=null;re!=null&&(xe=re.shape,fe.push(re));var Oe=null;if(Z!=null&&(Oe=Z.shape,fe.push(Z)),j().getBool("WEBGL_PACK_NORMALIZATION")){var Re=new function(Be,Xe,nt,tt,ut,Nt){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],io(Be,Xe),io(Be,nt);var Pt="vec4(0.0)";tt!=null&&(io(Be,tt),this.variableNames.push("offset"),Pt="getOffsetAtOutCoords()");var jt="vec4(1.0)";ut!=null&&(io(Be,ut),this.variableNames.push("scale"),jt="getScaleAtOutCoords()"),this.outputShape=Be,this.userCode=`
      void main() {
        vec4 offset = `+Pt+`;
        vec4 scale = `+jt+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+Nt+`));

        setOutput((x - mean) * inv + offset);
      }
    `}(d.shape,y.shape,C.shape,xe,Oe,z);return this.compileAndRun(Re,fe)}var Le=new function(Be,Xe,nt,tt,ut,Nt){this.outputShape=[],this.variableNames=["x","mean","variance"],io(Be,Xe),io(Be,nt);var Pt="0.0";tt!=null&&(io(Be,tt),this.variableNames.push("offset"),Pt="getOffsetAtOutCoords()");var jt="1.0";ut!=null&&(io(Be,ut),this.variableNames.push("scale"),jt="getScaleAtOutCoords()"),this.outputShape=Be,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+Pt+`;
        float scale = `+jt+`;
        float inv = scale * inversesqrt(variance + float(`+Nt+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}(d.shape,y.shape,C.shape,xe,Oe,z);return this.compileAndRun(Le,fe)},v.prototype.localResponseNormalization4D=function(d,y,C,z,Z){var re=j().getBool("WEBGL_PACK_NORMALIZATION")?new function(fe,xe,Oe,Re,Le){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var Be,Xe=xe,nt=fe[3]-1;this.outputShape=fe;var tt="float("+Oe+") + float("+Re+") * sum";Be=Le===.5?"inversesqrt("+tt+")":Le===1?"1.0/("+tt+")":"exp(log("+tt+") * float(-"+Le+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+Xe+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+Xe+"; j <= "+Xe+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+nt+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+Be+`;
        setOutput(result);
      }
    `}(d.shape,y,C,z,Z):new function(fe,xe,Oe,Re,Le){this.variableNames=["x"],this.outputShape=[];var Be,Xe=xe,nt=fe[3]-1;this.outputShape=fe;var tt="float("+Oe+") + float("+Re+") * sum";Be=Le===.5?"inversesqrt("+tt+")":Le===1?"1.0/("+tt+")":"exp(log("+tt+") * float(-"+Le+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+Xe+"; j <= "+Xe+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+nt+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+Be+`;
        setOutput(val);
      }
    `}(d.shape,y,C,z,Z);return this.compileAndRun(re,[d])},v.prototype.LRNGrad=function(d,y,C,z,Z,re,fe){var xe=new function(Oe,Re,Le,Be,Xe){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=Oe,this.depth=Oe[3],this.depthRadius=Re,this.bias=Le,this.alpha=Be,this.beta=Xe,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+Re+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+Re+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+Be+") * norm + float("+Le+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+Be+`)
                * float(`+Xe+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+Xe+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}(y.shape,z,Z,re,fe);return this.compileAndRun(xe,[y,C,d])},v.prototype.tile=function(d,y){if(d.dtype==="string"){var C=this.readSync(d.dataId).map(function(Z){return On(Z)});return Nd(Hi(d.shape,d.dtype,C),y)}var z=new function(Z,re){this.variableNames=["A"];for(var fe=new Array(Z.length),xe=0;xe<fe.length;xe++)fe[xe]=Z[xe]*re[xe];this.outputShape=fe,this.rank=fe.length;var Oe=Yn(this.rank),Re=function(Le){var Be=Le.length;if(Be>5)throw Error("Tile for rank "+Be+" is not yet supported");if(Be===1)return"imod(resRC, "+Le[0]+")";for(var Xe=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],nt=[],tt=0;tt<Le.length;tt++)nt.push("imod("+Xe[tt]+", "+Le[tt]+")");return nt.join()}(Z);this.userCode=`
      void main() {
        `+Oe+` resRC = getOutputCoords();
        setOutput(getA(`+Re+`));
      }
    `}(d.shape,y);return this.compileAndRun(z,[d])},v.prototype.pad=function(d,y,C){var z=j().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(Z,re,fe){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=re.map(function(gn,wn){return gn[0]+Z[wn]+gn[1]});for(var xe=Z.length,Oe=Yn(xe),Re=re.map(function(gn){return gn[0]}).join(","),Le=re.map(function(gn,wn){return gn[0]+Z[wn]}).join(","),Be=G("rc",xe),Xe=G("source",xe),nt=Be[xe-1]+" < "+this.outputShape[xe-1],tt=xe===1?"source":"vec2("+Xe.slice(-2).join()+")",ut=[Oe+" rc = outputLoc;",Be[xe-1]+` += 1;
       if(`+nt+`) {
      `,xe===1?"":`}
       rc = outputLoc;
       `+Be[xe-2]+` += 1;
       if(`+Be[xe-2]+" < "+this.outputShape[xe-2]+") {",xe===1?"":"  "+Be[xe-1]+` += 1;
         if(`+nt+") {"],Nt=xe===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",Pt="",jt=0,Yt=xe===1?2:4;jt<Yt;jt++)Pt+=`
        `+ut[jt]+`
        if (`+Nt+`) {
          result[`+jt+"] = float("+fe+`);
        } else {
          `+Oe+` source = rc - start;
          result[`+jt+"] = getChannel(getX("+Xe.join()+"), "+tt+`);
        }
      `;Pt+=xe===1?"} ":"}}",this.userCode=`
      const `+Oe+" start = "+Oe+"("+Re+`);
      const `+Oe+" end = "+Oe+"("+Le+`);

      void main() {
        `+Oe+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+Pt+`
        setOutput(result);
      }
    `}(d.shape,y,C):new function(Z,re,fe){this.variableNames=["x"],this.outputShape=re.map(function(Xe,nt){return Xe[0]+Z[nt]+Xe[1]});var xe=Z.length,Oe=Yn(xe),Re=re.map(function(Xe){return Xe[0]}).join(","),Le=re.map(function(Xe,nt){return Xe[0]+Z[nt]}).join(","),Be=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,xe);this.userCode=xe!==1?`
      `+Oe+" start = "+Oe+"("+Re+`);
      `+Oe+" end = "+Oe+"("+Le+`);

      void main() {
        `+Oe+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+fe+`));
        } else {
          `+Oe+` coords = outC - start;
          setOutput(getX(`+Be+`));
        }
      }
    `:`
        int start = `+Re+`;
        int end = `+Le+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+fe+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}(d.shape,y,C);return this.compileAndRun(z,[d])},v.prototype.transpose=function(d,y){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.transpose(d,y);var C=j().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(z,Z){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var re=new Array(z.length),fe=0;fe<re.length;fe++)re[fe]=z[Z[fe]];if(this.outputShape=re,this.rank=re.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var xe=Yn(this.rank),Oe=N("rc",this.rank),Re=new Array(this.rank);for(fe=0;fe<Z.length;fe++)Re[Z[fe]]=Oe[fe];var Le="vec2("+Re.slice(-2).join()+")",Be="++"+Oe[this.rank-1]+" < "+re[this.rank-1],Xe="getChannel(getA("+Re.join()+"), "+Le+")";this.userCode=`
    void main() {
      `+xe+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+Xe+`;
      if(`+Be+`) {
        result[1] = `+Xe+`;
      }
      --`+Oe[this.rank-1]+`;
      if(++`+Oe[this.rank-2]+" < "+re[this.rank-2]+`) {
        result[2] = `+Xe+`;
        if(`+Be+`) {
          result[3] = `+Xe+`;
        }
      }
      setOutput(result);
    }
    `}(d.shape,y):new function(z,Z){this.variableNames=["A"];for(var re=new Array(z.length),fe=0;fe<re.length;fe++)re[fe]=z[Z[fe]];this.outputShape=re,this.rank=re.length;var xe=Yn(this.rank),Oe=function(Re){var Le=Re.length;if(Le>6)throw Error("Transpose for rank "+Le+" is not yet supported");for(var Be=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],Xe=new Array(Le),nt=0;nt<Re.length;nt++)Xe[Re[nt]]=Be[nt];return Xe.join()}(Z);this.userCode=`
    void main() {
      `+xe+` resRC = getOutputCoords();
      setOutput(getA(`+Oe+`));
    }
    `}(d.shape,y);return this.compileAndRun(C,[d])},v.prototype.gather=function(d,y,C){if(this.shouldExecuteOnCPU([d,y]))return this.cpuBackend.gather(d,y,C);var z=new function(Z,re,fe){this.variableNames=["A","indices"];var xe=Z.slice();xe[fe]=re,this.outputShape=xe,this.rank=xe.length;var Oe=Yn(this.rank),Re=function(Le,Be){var Xe=Le.length;if(Xe>4)throw Error("Gather for rank "+Xe+" is not yet supported");if(Xe===1)return"int(getIndices(resRC))";for(var nt=["resRC.x","resRC.y","resRC.z","resRC.w"],tt=[],ut=0;ut<Le.length;ut++)ut===Be?tt.push("int(getIndices("+nt[ut]+"))"):tt.push(""+nt[ut]);return tt.join()}(Z,fe);this.userCode=`
      void main() {
        `+Oe+` resRC = getOutputCoords();
        setOutput(getA(`+Re+`));
      }
    `}(d.shape,y.size,C);return this.compileAndRun(z,[d,y])},v.prototype.batchToSpaceND=function(d,y,C){we(d.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var z=y.reduce(function(Re,Le){return Re*Le}),Z=mc(d.shape,y,z),re=Sd(Z.length,y.length),fe=Cd(d.shape,y,z),xe=Rl(C,y.length),Oe=tm(fe,C,y.length);return d.reshape(Z).transpose(re).reshape(fe).slice(xe,Oe)},v.prototype.spaceToBatchND=function(d,y,C){we(d.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var z=y.reduce(function(Le,Be){return Le*Be}),Z=[[0,0]];Z.push.apply(Z,C);for(var re=1+y.length;re<d.shape.length;++re)Z.push([0,0]);var fe=d.pad(Z),xe=mc(fe.shape,y,z,!1),Oe=Sd(xe.length,y.length,!1),Re=Cd(fe.shape,y,z,!1);return fe.reshape(xe).transpose(Oe).reshape(Re)},v.prototype.reduce=function(d,y,C){var z=d.shape[0],Z=d.shape[1],re=new function(xe,Oe){this.variableNames=["x"];var Re=xe.windowSize,Le=xe.batchSize,Be=xe.inSize,Xe=Math.ceil(Be/Re);this.outputShape=[Le,Xe];var nt="0.0",tt="";Oe==="prod"?nt="1.0":Oe==="min"?(nt="1.0 / 1e-20",tt="min"):Oe==="max"&&(nt="-1.0 / 1e-20",tt="max");var ut=Oe+"("+Oe+"("+Oe+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";Oe==="sum"?ut="sumValue":Oe==="prod"?ut="prodValue":Oe==="all"?ut="allValue":Oe==="any"&&(ut="anyValue");var Nt=4*Math.floor(Re/4),Pt=Re%4,jt=`
      if (`+(Oe==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(Oe==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+tt+`(values, minMaxValue);
      }
    `,Yt="vec4";Oe==="all"?(nt="1.0",jt=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,Yt="bvec4"):Oe==="any"&&(nt="0.0",jt=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,Yt="bvec4");var gn="";Be%Re>0&&(gn=`
        if (inIdx < 0 || inIdx >= `+Be+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+nt+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+gn+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+Re+`;

        vec4 minMaxValue = vec4(`+nt+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+Nt+`; i += 4) {
          int inIdx = inOffset + i;
          `+Yt+" values = "+Yt+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+jt+`
        }

        int inIdx = inOffset + `+Nt+`;
        if (`+(Pt===1)+`) {
          `+Yt+" values = "+Yt+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+jt+`
        } else if (`+(Pt===2)+`) {
          `+Yt+" values = "+Yt+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+jt+`
        } else if (`+(Pt===3)+`) {
          `+Yt+" values = "+Yt+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+jt+`
        }
        setOutput(`+ut+`);
      }
    `}({windowSize:Ef(Z),inSize:Z,batchSize:z},y),fe=this.compileAndRun(re,[d],C);return fe.shape[1]===1?fe:this.reduce(fe,y,C)},v.prototype.argReduce=function(d,y,C){C===void 0&&(C=null);var z=d.shape[0],Z=d.shape[1];C!=null&&(z=C.shape[0],Z=C.shape[1]);var re=new function(Oe,Re,Le){this.variableNames=["A"];var Be=Oe.windowSize,Xe=Oe.batchSize,nt=Oe.inSize,tt=Math.ceil(nt/Be);Le||this.variableNames.push("bestIndicesA"),this.outputShape=[Xe,tt];var ut=Re==="max"?">":"<",Nt=Le?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+Be+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+Be+`; i++) {
          int inIdx = `+Nt+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+ut+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}({windowSize:Ef(Z),inSize:Z,batchSize:z},y,C==null),fe=[d];C!=null&&fe.push(C);var xe=this.compileAndRun(re,fe,"int32");return xe.shape[1]===1?xe:this.argReduce(d,y,xe)},v.prototype.argReducePacked=function(d,y,C){C===void 0&&(C=null);var z=C!=null?C.shape:d.shape,Z=new function(xe,Oe,Re,Le){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,we(xe.length>2,function(){return"Packed arg"+(Re.charAt(0).toUpperCase()+Re.slice(1))+" supports only inputs with rank above 2."});var Be=xe[xe.length-1],Xe=Math.ceil(Be/Oe);this.outputShape=xe.slice(0,-1),Xe>1&&this.outputShape.push(Xe),Le||this.variableNames.push("bestIndicesA");var nt,tt,ut=this.outputShape,Nt=ut.length,Pt=Yn(Nt),jt=G("coords",Nt);if(Xe===1){var Yt=Yn(tt=Nt+1);nt=`
        `+Yt+" sourceLocR = "+Yt+"("+jt.join()+`, 0);
        ++`+jt[Nt-1]+`;
        `+Yt+" sourceLocG = "+Yt+"("+jt.join()+`, 0);
        ++`+jt[Nt-2]+`;
        `+Yt+" sourceLocA = "+Yt+"("+jt.join()+`, 0);
        --`+jt[Nt-1]+`;
        `+Yt+" sourceLocB = "+Yt+"("+jt.join()+`, 0);
        --`+jt[Nt-2]+";"}else tt=Nt,nt=`
        `+Pt+` sourceLocR = coords;
        ++`+jt[Nt-1]+`;
        `+Pt+` sourceLocG = coords;
        ++`+jt[Nt-2]+`;
        `+Pt+` sourceLocA = coords;
        --`+jt[Nt-1]+`;
        `+Pt+` sourceLocB = coords;
        --`+jt[Nt-2]+";";var gn=["x","y","z","w","u","v"].slice(0,tt),wn="."+gn[tt-1],vn=gn.map(function(K){return"int "+K}),Cn=G("sourceLocR",tt-1).concat("inIdx.r"),Dn=G("sourceLocG",tt-1).concat("inIdx.g"),b=G("sourceLocB",tt-1).concat("inIdx.b"),p=G("sourceLocA",tt-1).concat("inIdx.a"),l=Re==="max"?"greaterThan":"lessThan",m=Le?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+Cn.join()+`),
                             getBestIndicesAChannel(`+Dn.join()+`),
                             getBestIndicesAChannel(`+b.join()+`),
                             getBestIndicesAChannel(`+p.join()+")));",w=`vec4(
            getAChannel(`+Cn.join()+`),
            hasNextCol ? getAChannel(`+Dn.join()+`) : 0.,
            hasNextRow ? getAChannel(`+b.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+p.join()+") : 0.)",P=Le?"":`
      float getBestIndicesAChannel(`+vn.join()+`) {
        return getChannel(getBestIndicesA(`+gn.join()+`),
                                          vec2(`+gn.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+vn.join()+`) {
        return getChannel(getA(`+gn.join()+`),
                               vec2(`+gn.slice(-2).join()+`));
      }
      `+P+`
      void main() {
        `+Pt+` coords = getOutputCoords();
        bool hasNextCol = `+jt[Nt-1]+" < "+(ut[Nt-1]-1)+`;
        bool hasNextRow = `+jt[Nt-2]+" < "+(ut[Nt-2]-1)+`;
        `+nt+`
        ivec4 srcIdx = ivec4(sourceLocR`+wn+", sourceLocG"+wn+`,
          sourceLocB`+wn+", sourceLocA"+wn+") * "+Oe+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+w+`;

        for (int i = 0; i < `+Oe+`; i++) {
          inIdx = srcIdx;
          `+m+`
          vec4 candidate = `+w+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+l+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}(z,Ef(z[z.length-1]),y,C==null),re=C==null?[d]:[d,C],fe=this.compileAndRun(Z,re,"int32");return fe.rank===d.rank?this.argReducePacked(d,y,fe):fe},v.prototype.sum=function(d,y){ia("sum",y,d.rank);var C=Po(d.shape,y),z=C[0],Z=ze(C[1]),re=d.as2D(-1,Z),fe=Rt(d.dtype);return this.reduce(re,"sum",fe).reshape(z)},v.prototype.prod=function(d,y){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.prod(d,y);var C=Po(d.shape,y),z=C[0],Z=ze(C[1]),re=d.as2D(-1,Z),fe=Rt(d.dtype);return this.reduce(re,"prod",fe).reshape(z)},v.prototype.unsortedSegmentSum=function(d,y,C){var z=0,Z=Ba([z],d.rank),re=d;Z!=null&&(re=d.transpose(Z),z=ja(1,d.rank)[0]);var fe=function(Be,Xe,nt){for(var tt=[],ut=Be.length,Nt=0;Nt<ut;Nt++)Nt!==Xe?tt.push(Be[Nt]):tt.push(nt);return tt}(re.shape,z,C),xe=ze([re.shape[z]]),Oe=re.as2D(-1,xe),Re=Rt(d.dtype),Le=this.segOpCompute(Oe,"unsortedSegmentSum",y,Re,C).reshape(fe);return Z!=null&&(Le=Le.transpose($u(Z))),Le},v.prototype.segOpCompute=function(d,y,C,z,Z){var re=d.shape[0],fe=d.shape[1],xe=function(Le,Be){var Xe,nt=!1;for(Le<=nm?(Xe=Le,nt=!0):Xe=Mr(Le,Math.floor(Math.sqrt(Le)));!nt;)Xe>Be||Xe===Le?nt=!0:Xe=Mr(Le,Xe+1);return Xe}(fe,Z),Oe=new function(Le,Be){this.variableNames=["x","segmentIds"];var Xe=Le.windowSize,nt=Le.batchSize,tt=Le.inSize,ut=Le.numSegments,Nt=ut*Math.ceil(tt/Xe);this.outputShape=[nt,Nt];var Pt=4*Math.floor(Xe/4),jt=Xe%4,Yt=`
        sumValue += dot(values, segFilter);
    `,gn="";tt%Xe>0&&(gn=`
        if (inIdx < 0 || inIdx >= `+tt+`) {
          return initializationValue;
        }
      `);var wn="";tt%Xe>0&&(wn=`
        if (inIdx < 0 || inIdx >= `+tt+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+gn+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+wn+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+ut+")) * float("+Xe+`));
        int currentSeg = int(mod(float(outIdx), float(`+ut+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+Pt+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+Yt+`
        }

        int inIdx = inOffset + `+Pt+`;
        if (`+(jt===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+Yt+`
        } else if (`+(jt===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+Yt+`
        } else if (`+(jt===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+Yt+`
        }
        setOutput(sumValue);
      }
    `}({windowSize:xe,inSize:fe,batchSize:re,numSegments:Z}),Re=this.compileAndRun(Oe,[d,C],z);return Re.shape[1]===Z?Re:(C=Rc(0,Z).tile([fe/xe]),this.segOpCompute(Re,y,C,z,Z))},v.prototype.argMinMaxReduce=function(d,y,C){var z=[y];if(ia("arg"+C.charAt(0).toUpperCase()+C.slice(1),z,d.rank),!j().getBool("WEBGL_PACK_REDUCE")||d.rank<=2){var Z=Po(d.shape,z),re=Z[0],fe=ze(Z[1]),xe=d.as2D(-1,fe);return this.argReduce(xe,C).reshape(re)}return this.argReducePacked(d,C)},v.prototype.argMin=function(d,y){return this.argMinMaxReduce(d,y,"min")},v.prototype.argMax=function(d,y){return this.argMinMaxReduce(d,y,"max")},v.prototype.cumsum=function(d,y,C,z){if(y!==d.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(d.rank-1)+" but got axis="+y);var Z=new function(re,fe,xe){this.variableNames=["x"],this.outputShape=re;var Oe=re.length,Re=re[re.length-1],Le=xe?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(xe?"return "+Re+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Yn(Oe)+` coords = getOutputCoords();
        int end = `+mo(Oe,"coords")+`;
        float val = 0.0;
        for (int i = `+Re+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+Le+` end) {
            continue;
          }
          if (idx == end && `+fe+`) {
            continue;
          }
          `+mo(Oe,"coords")+` = idx;
          val += getX(`+function(Be,Xe){if(Be===1)return""+Xe;if(Be===2)return Xe+".x, "+Xe+".y";if(Be===3)return Xe+".x, "+Xe+".y, "+Xe+".z";if(Be===4)return Xe+".x, "+Xe+".y, "+Xe+".z, "+Xe+".w";throw Error("Cumulative sum for rank "+Be+" is not yet supported")}(Oe,"coords")+`);
        }
        setOutput(val);
      }
    `}(d.shape,C,z);return this.compileAndRun(Z,[d])},v.prototype.equal=function(d,y){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,`
  return vec4(equal(a, b));
`,"bool");var C=new ii("return float(a == b);",d.shape,y.shape);return this.compileAndRun(C,[d,y],"bool")},v.prototype.notEqual=function(d,y){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,`
  return vec4(notEqual(a, b));
`,"bool");var C=new ii("return float(a != b);",d.shape,y.shape);return this.compileAndRun(C,[d,y],"bool")},v.prototype.less=function(d,y){if(this.shouldExecuteOnCPU([d,y]))return this.cpuBackend.less(d,y);if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,`
  return vec4(lessThan(a, b));
`,"bool");var C=new ii("return float(a < b);",d.shape,y.shape);return this.compileAndRun(C,[d,y],"bool")},v.prototype.lessEqual=function(d,y){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,`
  return vec4(lessThanEqual(a, b));
`,"bool");var C=new ii("return float(a <= b);",d.shape,y.shape);return this.compileAndRun(C,[d,y],"bool")},v.prototype.greater=function(d,y){if(this.shouldExecuteOnCPU([d,y]))return this.cpuBackend.greater(d,y);if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,`
  return vec4(greaterThan(a, b));
`,"bool");var C=new ii("return float(a > b);",d.shape,y.shape);return this.compileAndRun(C,[d,y],"bool")},v.prototype.greaterEqual=function(d,y){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var C=new ii("return float(a >= b);",d.shape,y.shape);return this.compileAndRun(C,[d,y],"bool")},v.prototype.logicalNot=function(d){var y=new Ei(d.shape,"return float(!(x >= 1.0));");return this.compileAndRun(y,[d])},v.prototype.logicalAnd=function(d,y){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var C=new ii("return float(a >= 1.0 && b >= 1.0);",d.shape,y.shape);return this.compileAndRun(C,[d,y],"bool")},v.prototype.logicalOr=function(d,y){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var C=new ii("return float(a >= 1.0 || b >= 1.0);",d.shape,y.shape);return this.compileAndRun(C,[d,y],"bool")},v.prototype.select=function(d,y,C){var z=new function(Z,re,fe){var xe,Oe;if(this.variableNames=["c","a","b"],this.outputShape=re,fe>4)throw Error("Where for rank "+fe+" is not yet supported");if(fe===1)Oe="resRC",xe="resRC";else{for(var Re=["resRC.x","resRC.y","resRC.z","resRC.w"],Le=[],Be=[],Xe=0;Xe<re.length;Xe++)Be.push(""+Re[Xe]),Xe<Z&&Le.push(""+Re[Xe]);xe=Le.join(),Oe=Be.join()}var nt=Yn(fe);this.userCode=`
      void main() {
        `+nt+` resRC = getOutputCoords();
        float cVal = getC(`+xe+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+Oe+`));
        } else {
          setOutput(getB(`+Oe+`));
        }
      }
    `}(d.rank,y.shape,y.rank);return this.compileAndRun(z,[d,y,C],Sn(y.dtype,C.dtype))},v.prototype.where=function(d){Ml("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var y=d.dataSync();return ne(d.shape,y)},v.prototype.topk=function(d,y,C){return se(d.dataSync(),d.shape,d.dtype,y)},v.prototype.min=function(d,y){ia("min",y,d.rank);var C=Po(d.shape,y),z=C[0],Z=ze(C[1]),re=d.as2D(-1,Z);return this.reduce(re,"min",re.dtype).reshape(z)},v.prototype.minimum=function(d,y){if(this.shouldExecuteOnCPU([d,y]))return this.cpuBackend.minimum(d,y);var C=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Si(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,d.shape,y.shape):new ii(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,d.shape,y.shape);return this.compileAndRun(C,[d,y])},v.prototype.mod=function(d,y){var C=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Si(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,d.shape,y.shape):new ii(`if (b == 0.0) return NAN;
  return mod(a, b);`,d.shape,y.shape);return this.compileAndRun(C,[d,y])},v.prototype.max=function(d,y){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.max(d,y);ia("max",y,d.rank);var C=Po(d.shape,y),z=C[0],Z=ze(C[1]),re=d.as2D(-1,Z);return this.reduce(re,"max",re.dtype).reshape(z)},v.prototype.maximum=function(d,y){if(this.shouldExecuteOnCPU([d,y]))return this.cpuBackend.maximum(d,y);var C=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Si(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,d.shape,y.shape):new ii(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,d.shape,y.shape);return this.compileAndRun(C,[d,y])},v.prototype.all=function(d,y){ia("all",y,d.rank);var C=Po(d.shape,y),z=C[0],Z=ze(C[1]),re=d.as2D(-1,Z);return this.reduce(re,"all",re.dtype).reshape(z)},v.prototype.any=function(d,y){ia("any",y,d.rank);var C=Po(d.shape,y),z=C[0],Z=ze(C[1]),re=d.as2D(-1,Z);return this.reduce(re,"any",re.dtype).reshape(z)},v.prototype.realDivide=function(d,y){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var C=new ii(`
if (a == b) {
  return 1.0;
};
return a / b;`,d.shape,y.shape);return this.compileAndRun(C,[d,y],"float32")},v.prototype.floorDiv=function(d,y){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var C=new ii(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,d.shape,y.shape);return this.compileAndRun(C,[d,y],"int32")},v.prototype.add=function(d,y){if(d.dtype==="complex64"&&y.dtype==="complex64")return this.complexSeparableBinaryOp(d,y,$r);if(this.shouldExecuteOnCPU([d,y]))return this.cpuBackend.add(d,y);var C=Sn(d.dtype,y.dtype);if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,$r,C);var z=new ii($r,d.shape,y.shape);return this.compileAndRun(z,[d,y],C)},v.prototype.packedUnaryOp=function(d,y,C){var z=new Fd(d.shape,y);return this.compileAndRun(z,[d],C)},v.prototype.packedBinaryOp=function(d,y,C,z,Z){Z===void 0&&(Z=!1);var re=new Si(C,d.shape,y.shape,Z);return this.compileAndRun(re,[d,y],z)},v.prototype.complexSeparableBinaryOp=function(d,y,C){var z=this,Z=this.texData.get(d.dataId),re=this.texData.get(y.dataId),fe=[[Z.complexTensors.real,re.complexTensors.real],[Z.complexTensors.imag,re.complexTensors.imag]].map(function(Le){var Be=Le[0],Xe=Le[1],nt=z.makeComplexComponentTensorInfo(d,Be),tt=z.makeComplexComponentTensorInfo(y,Xe),ut=new ii(C,d.shape,y.shape);return z.compileAndRun(ut,[nt,tt],Sn(Be.dtype,Xe.dtype))}),xe=fe[0],Oe=fe[1],Re=this.complex(xe,Oe);return xe.dispose(),Oe.dispose(),Re},v.prototype.makeComplexComponentTensorInfo=function(d,y){return{dataId:y.dataId,dtype:y.dtype,shape:d.shape}},v.prototype.addN=function(d){if(d.length===1)return d[0];if(d.length>j().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var y=Math.floor(d.length/2),C=this.addN(d.slice(0,y)),z=this.addN(d.slice(y));return this.addN([C,z])}var Z=d.map(function(xe){return xe.dtype}).reduce(function(xe,Oe){return Sn(xe,Oe)}),re=d.map(function(xe){return xe.shape}),fe=j().getBool("WEBGL_PACK")?new function(xe,Oe){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=xe,this.variableNames=Oe.map(function(Be,Xe){return"T"+Xe});var Re=[];this.variableNames.forEach(function(Be){Re.push("vec4 v"+Be+" = get"+Be+"AtOutCoords();")});var Le=this.variableNames.map(function(Be){return"v"+Be}).join(" + ");this.userCode=`
      void main() {
        `+Re.join(`
        `)+`

        vec4 result = `+Le+`;
        setOutput(result);
      }
    `}(d[0].shape,re):new function(xe,Oe){this.outputShape=[],this.outputShape=xe,this.variableNames=Oe.map(function(Be,Xe){return"T"+Xe});var Re=[];this.variableNames.forEach(function(Be){Re.push("float v"+Be+" = get"+Be+"AtOutCoords();")});var Le=this.variableNames.map(function(Be){return"v"+Be}).join(" + ");this.userCode=`
      void main() {
        `+Re.join(`
        `)+`

        float result = `+Le+`;
        setOutput(result);
      }
    `}(d[0].shape,re);return this.compileAndRun(fe,d,Z)},v.prototype.subtract=function(d,y){if(d.dtype==="complex64"&&y.dtype==="complex64")return this.complexSeparableBinaryOp(d,y,ai);if(this.shouldExecuteOnCPU([d,y]))return this.cpuBackend.subtract(d,y);var C=Sn(d.dtype,y.dtype);if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,ai,d.dtype);var z=new ii(ai,d.shape,y.shape);return this.compileAndRun(z,[d,y],C)},v.prototype.pow=function(d,y){var C=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Si(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,d.shape,y.shape):new ii(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,d.shape,y.shape),z=Sn(d.dtype,y.dtype);return this.compileAndRun(C,[d,y],z)},v.prototype.ceil=function(d){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.ceil(d);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(d,lv,d.dtype);var y=new Ei(d.shape,lv);return this.compileAndRun(y,[d])},v.prototype.floor=function(d){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.floor(d);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(d,r0,d.dtype);var y=new Ei(d.shape,r0);return this.compileAndRun(y,[d])},v.prototype.sign=function(d){var y=new Ei(d.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(y,[d])},v.prototype.isNaN=function(d){var y=new Ei(d.shape,"return float(isnan(x));");return this.compileAndRun(y,[d],"bool")},v.prototype.isInf=function(d){var y=new Ei(d.shape,"return float(isinf(x));");return this.compileAndRun(y,[d],"bool")},v.prototype.isFinite=function(d){var y=new Ei(d.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(y,[d],"bool")},v.prototype.round=function(d){var y=new Ei(d.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(y,[d])},v.prototype.exp=function(d){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.exp(d);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(d,fv,d.dtype);var y=new Ei(d.shape,fv);return this.compileAndRun(y,[d])},v.prototype.expm1=function(d){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.expm1(d);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(d,Id,d.dtype);var y=new Ei(d.shape,Id);return this.compileAndRun(y,[d])},v.prototype.softmax=function(d,y){var C=Xt([y],d.shape),z=this.max(d,C),Z=Lo(z.shape,C),re=this.subtract(d,z.reshape(Z)),fe=this.exp(re),xe=this.sum(fe,C).reshape(Z);return this.realDivide(fe,xe)},v.prototype.log=function(d){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.log(d);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(d,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,d.dtype);var y=new Ei(d.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(y,[d])},v.prototype.log1p=function(d){var y=new Ei(d.shape,"return log(1.0 + x);");return this.compileAndRun(y,[d])},v.prototype.sqrt=function(d){var y=new Ei(d.shape,"return sqrt(x);");return this.compileAndRun(y,[d])},v.prototype.rsqrt=function(d){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.rsqrt(d);var y=new Ei(d.shape,"return inversesqrt(x);");return this.compileAndRun(y,[d])},v.prototype.reciprocal=function(d){var y=new Ei(d.shape,"return 1.0 / x;");return this.compileAndRun(y,[d])},v.prototype.relu=function(d){var y;return y=j().getBool("WEBGL_PACK")?new Fd(d.shape,hv):new Ei(d.shape,uv),this.compileAndRun(y,[d])},v.prototype.relu6=function(d){var y;return y=j().getBool("WEBGL_PACK")?new Fd(d.shape,pv):new Ei(d.shape,cv),this.compileAndRun(y,[d])},v.prototype.prelu=function(d,y){var C=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Si(wi,d.shape,y.shape):new ii(ui,d.shape,y.shape);return this.compileAndRun(C,[d,y])},v.prototype.elu=function(d){if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(d,cl,d.dtype);var y=new Ei(d.shape,t0);return this.compileAndRun(y,[d])},v.prototype.eluDer=function(d,y){var C=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Si(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,d.shape,y.shape):new ii("return (b >= 1.0) ? a : a * (b + 1.0);",d.shape,y.shape);return this.compileAndRun(C,[d,y])},v.prototype.selu=function(d){var y=new Ei(d.shape,`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = 1.7580993408473768;
  float scale = 1.0507009873554805;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`);return this.compileAndRun(y,[d])},v.prototype.int=function(d){var y=new Ei(d.shape,"return float(int(x));");return this.compileAndRun(y,[d],"int32")},v.prototype.clip=function(d,y,C){var z,Z=(z=j().getBool("WEBGL_PACK_CLIP")?new gi(d.shape):new si(d.shape)).getCustomSetupFunc(y,C);return this.compileAndRun(z,[d],null,Z)},v.prototype.abs=function(d){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.abs(d);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(d,Tf,d.dtype);var y=new Ei(d.shape,Tf);return this.compileAndRun(y,[d])},v.prototype.complexAbs=function(d){var y=this.texData.get(d.dataId),C=new function(Z){this.variableNames=["real","imag"],this.outputShape=Z,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}(d.shape),z=[this.makeComplexComponentTensorInfo(d,y.complexTensors.real),this.makeComplexComponentTensorInfo(d,y.complexTensors.imag)];return this.compileAndRun(C,z)},v.prototype.sigmoid=function(d){var y=new Ei(d.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(y,[d])},v.prototype.softplus=function(d){var y=new Ei(d.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(y,[d])},v.prototype.sin=function(d){var y=new Ei(d.shape,`if (isnan(x)) return x;
  return sin(x);
`);return this.compileAndRun(y,[d])},v.prototype.cos=function(d){var y=new Ei(d.shape,`if (isnan(x)) return x;
  return cos(x);
`);return this.compileAndRun(y,[d])},v.prototype.tan=function(d){var y=new Ei(d.shape,"return tan(x);");return this.compileAndRun(y,[d])},v.prototype.asin=function(d){var y=new Ei(d.shape,`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`);return this.compileAndRun(y,[d])},v.prototype.acos=function(d){var y=new Ei(d.shape,`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`);return this.compileAndRun(y,[d])},v.prototype.atan=function(d){var y=new Ei(d.shape,`if (isnan(x)) return x;
  return atan(x);
`);return this.compileAndRun(y,[d])},v.prototype.atan2=function(d,y){var C=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Si(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,d.shape,y.shape):new ii(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,d.shape,y.shape);return this.compileAndRun(C,[d,y])},v.prototype.sinh=function(d){var y=new Ei(d.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(y,[d])},v.prototype.cosh=function(d){var y=new Ei(d.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(y,[d])},v.prototype.tanh=function(d){var y=new Ei(d.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(y,[d])},v.prototype.asinh=function(d){var y=new Ei(d.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(y,[d])},v.prototype.acosh=function(d){var y=new Ei(d.shape,`if (isnan(x)) return x;
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`);return this.compileAndRun(y,[d])},v.prototype.atanh=function(d){var y=new Ei(d.shape,`if (isnan(x)) return x;
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`);return this.compileAndRun(y,[d])},v.prototype.erf=function(d){var y=new Ei(d.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(y,[d])},v.prototype.step=function(d,y){var C=new Ei(d.shape,function(z){return z===void 0&&(z=0),sm+`
    return x > 0.0 ? 1.0 : float(`+z+`);
  `}(y));return this.compileAndRun(C,[d])},v.prototype.conv2dByMatMul=function(d,y,C,z,Z,re){var fe=d.shape,xe=this.texData.get(d.dataId),Oe=C.inChannels,Re=fe[0]*fe[1]*fe[2],Le=C.outChannels,Be=C.dataFormat==="channelsLast",Xe=(Re===1||Le===1)&&Oe>1e3,nt=fe[2]%2!=0&&!!xe.isPacked;if(Xe||!j().getBool("WEBGL_LAZILY_UNPACK")||!j().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!nt){var tt=Be?fe[0]*fe[1]*fe[2]:fe[0]*fe[2]*fe[3],ut=this.reshape(d,[1,tt,C.inChannels]),Nt=this.reshape(y,[1,C.inChannels,C.outChannels]);return this.reshape(this.fusedBatchMatMul({a:ut,b:Nt,transposeA:!1,transposeB:!1,bias:z,activation:Z,preluActivationWeights:re}),C.outShape)}var Pt=Be?fe[0]*fe[1]*(fe[2]+1):fe[0]*fe[2]*(fe[3]+1),jt={dataId:d.dataId,shape:[1,Pt,C.inChannels],dtype:d.dtype},Yt=xe.shape;xe.shape=xe.shape.slice(),xe.shape[xe.shape.length-2]++,we(Iu(xe.shape,jt.shape),function(){return"packed reshape "+xe.shape+" to "+jt.shape+" isn't free"});var gn=this.reshape(y,[1,C.inChannels,C.outChannels]),wn=this.fusedBatchMatMul({a:jt,b:gn,transposeA:!1,transposeB:!1,bias:z,activation:Z,preluActivationWeights:re}),vn=this.texData.get(wn.dataId);return we(vn.isPacked,function(){return"batchMatMul result is expected to be packed"}),xe.shape=Yt,vn.shape=C.outShape,He.makeTensorFromDataId(wn.dataId,C.outShape,wn.dtype)},v.prototype.conv2dWithIm2Row=function(d,y,C,z,Z,re){var fe=C.filterWidth,xe=C.filterHeight,Oe=C.inChannels,Re=C.outWidth,Le=C.outHeight,Be=C.dataFormat==="channelsLast",Xe=fe*xe*Oe,nt=Le*Re,tt=[Xe,nt],ut=d.squeeze([0]),Nt=y.reshape([1,Xe,-1]),Pt=new function(b,p,l){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=b;for(var m=l.filterWidth,w=l.inChannels,P=l.strideWidth,K=l.strideHeight,ee=l.padInfo,le=l.outWidth,de=l.dilationWidth,Ee=l.dilationHeight,Te=l.dataFormat,Ne=ee.left,Fe=ee.top,qe=w*m,Je=ce(),Ke=Te==="channelsLast",it=Ke?0:1,gt=Ke?1:2,Et="",At=0;At<=1;At++)for(var Wt=0;Wt<=1;Wt++)Et+=`
          blockIndex = rc.y + `+Wt+`;
          pos = rc.x + `+At+`;

          if(blockIndex < `+b[1]+" && pos < "+b[0]+`) {
            offsetY = int(blockIndex / (`+le+")) * "+K+" - "+Fe+`;
            d0 = offsetY + `+Ee+" * (pos / "+qe+`);

            if(d0 < `+p[it]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+le+".) * "+P+". - "+Ne+`.);
              d1 = offsetX + `+de+" * (int(mod(float(pos), "+qe+".) / "+w+`.));

              if(d1 < `+p[gt]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+w+`.));

                if (`+Ke+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*At+Wt)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*At+Wt)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+Et+`

        `+Je.output+` = result;
      }
    `}(tt,ut.shape,C),jt=this.compileAndRun(Pt,[ut]).reshape([1,tt[0],tt[1]]),Yt=z!=null,gn=re!=null,wn=Z?i0(Z,!0):null,vn=new Wo(jt.shape,[1,nt,C.outChannels],!0,!1,Yt,wn,gn),Cn=[jt,Nt];z&&Cn.push(z),gn&&Cn.push(re);var Dn=this.compileAndRun(vn,Cn);return Be?Dn.reshape([1,Le,Re,C.outChannels]):Dn.reshape([1,C.outChannels,Le,Re])},v.prototype.fusedConv2d=function(d){var y=d.input,C=d.filter,z=d.convInfo,Z=d.bias,re=d.activation,fe=d.preluActivationWeights;if(z.filterHeight===1&&z.filterWidth===1&&z.dilationHeight===1&&z.dilationWidth===1&&z.strideHeight===1&&z.strideWidth===1&&(z.padInfo.type==="SAME"||z.padInfo.type==="VALID"))return this.conv2dByMatMul(y,C,z,Z,re,fe);if(j().getBool("WEBGL_CONV_IM2COL")&&y.shape[0]===1)return this.conv2dWithIm2Row(y,C,z,Z,re,fe);var xe=Z!=null,Oe=fe!=null,Re=re?i0(re,!1):null,Le=new ho(z,xe,Re,Oe),Be=[y,C];return Z&&Be.push(Z),fe&&Be.push(fe),this.compileAndRun(Le,Be)},v.prototype.conv2d=function(d,y,C){if(C.filterHeight===1&&C.filterWidth===1&&C.dilationHeight===1&&C.dilationWidth===1&&C.strideHeight===1&&C.strideWidth===1&&(C.padInfo.type==="SAME"||C.padInfo.type==="VALID"))return this.conv2dByMatMul(d,y,C);if(j().getBool("WEBGL_CONV_IM2COL")&&d.shape[0]===1)return this.conv2dWithIm2Row(d,y,C);var z=new ho(C);return this.compileAndRun(z,[d,y])},v.prototype.conv2dDerInput=function(d,y,C){var z=new function(Z){this.variableNames=["dy","W"],this.outputShape=Z.inShape;var re=Z.filterHeight,fe=Z.filterWidth,xe=Z.strideHeight,Oe=Z.strideWidth,Re=Z.dataFormat==="channelsLast",Le=re-1-Z.padInfo.top,Be=fe-1-Z.padInfo.left,Xe=Re?1:2,nt=Re?2:3,tt=Re?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+Le+", "+Be+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+tt+`];

        ivec2 dyCorner = ivec2(coords[`+Xe+"], coords["+nt+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+re+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+xe+`.0;

          if (dyR < 0.0 || dyR >= `+Z.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+re+` - 1 - wR;

          for (int wC = 0; wC < `+fe+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+Oe+`.0;

            if (dyC < 0.0 || dyC >= `+Z.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+fe+` - 1 - wC;

            for (int d2 = 0; d2 < `+Z.outChannels+`; d2++) {

              if (`+Re+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}(C);return this.compileAndRun(z,[d,y])},v.prototype.conv2dDerFilter=function(d,y,C){var z=new function(Z){this.variableNames=["x","dy"],this.outputShape=Z.filterShape;var re=Z.strideHeight,fe=Z.strideWidth,xe=Z.padInfo.top,Oe=Z.padInfo.left,Re=Z.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+Z.batchSize+`; b++) {
          for (int yR = 0; yR < `+Z.outHeight+`; yR++) {
            int xR = wR + yR * `+re+" - "+xe+`;

            if (xR < 0 || xR >= `+Z.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+Z.outWidth+`; yC++) {
              int xC = wC + yC * `+fe+" - "+Oe+`;

              if (xC < 0 || xC >= `+Z.inWidth+`) {
                continue;
              }

              if (`+Re+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}(C);return this.compileAndRun(z,[d,y])},v.prototype.fusedDepthwiseConv2D=function(d){var y,C=d.input,z=d.filter,Z=d.convInfo,re=d.bias,fe=d.activation,xe=d.preluActivationWeights,Oe=j().getBool("WEBGL_PACK_DEPTHWISECONV")&&Z.strideWidth<=2&&Z.outChannels/Z.inChannels==1,Re=fe?i0(fe,Oe):null,Le=[C,z],Be=re!=null,Xe=xe!=null;return Be&&Le.push(re),Xe&&Le.push(xe),Oe?(y=new Ki(Z,Be,Re,Xe),this.compileAndRun(y,Le)):(y=new Ko(Z,Be,Re,Xe),this.compileAndRun(y,Le))},v.prototype.depthwiseConv2D=function(d,y,C){var z;return j().getBool("WEBGL_PACK_DEPTHWISECONV")&&C.strideWidth<=2&&C.outChannels/C.inChannels==1?(z=new Ki(C),this.compileAndRun(z,[d,y])):(z=new Ko(C),this.compileAndRun(z,[d,y]))},v.prototype.depthwiseConv2DDerInput=function(d,y,C){var z=new function(Z){this.variableNames=["dy","W"],this.outputShape=Z.inShape;var re=Z.filterHeight,fe=Z.filterWidth,xe=Z.strideHeight,Oe=Z.strideWidth,Re=re-1-Z.padInfo.top,Le=fe-1-Z.padInfo.left,Be=Z.outChannels/Z.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+Re+", "+Le+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+re+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+xe+`.0;

          if (dyR < 0.0 || dyR >= `+Z.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+re+` - 1 - wR;

          for (int wC = 0; wC < `+fe+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+Oe+`.0;

            if (dyC < 0.0 || dyC >= `+Z.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+fe+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+Be+`; dm++) {
              int d2 = d1 * `+Be+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(C);return this.compileAndRun(z,[d,y])},v.prototype.depthwiseConv2DDerFilter=function(d,y,C){var z=new function(Z){this.variableNames=["x","dy"],this.outputShape=Z.filterShape;var re=Z.strideHeight,fe=Z.strideWidth,xe=Z.padInfo.top,Oe=Z.padInfo.left,Re=Z.outChannels/Z.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+Re+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+Z.batchSize+`; b++) {
          for (int yR = 0; yR < `+Z.outHeight+`; yR++) {
            int xR = wR + yR * `+re+" - "+xe+`;

            if (xR < 0 || xR >= `+Z.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+Z.outWidth+`; yC++) {
              int xC = wC + yC * `+fe+" - "+Oe+`;

              if (xC < 0 || xC >= `+Z.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}(C);return this.compileAndRun(z,[d,y])},v.prototype.conv3d=function(d,y,C){var z=new function(Z){this.variableNames=["x","W"],this.outputShape=Z.outShape;var re=Z.padInfo.front,fe=Z.padInfo.top,xe=Z.padInfo.left,Oe=Z.strideDepth,Re=Z.strideHeight,Le=Z.strideWidth,Be=Z.dilationDepth,Xe=Z.dilationHeight,nt=Z.dilationWidth,tt=Z.filterDepth,ut=Z.filterHeight,Nt=Z.filterWidth,Pt=4*Math.floor(Z.inChannels/4),jt=Z.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+Oe+", "+Re+", "+Le+`);
      const ivec3 pads = ivec3(`+re+", "+fe+", "+xe+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+tt+`; wF++) {
          int xF = xFCorner + wF * `+Be+`;

          if (xF < 0 || xF >= `+Z.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+ut+`; wR++) {
            int xR = xRCorner + wR * `+Xe+`;

            if (xR < 0 || xR >= `+Z.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+Nt+`; wC++) {
              int xC = xCCorner + wC * `+nt+`;

              if (xC < 0 || xC >= `+Z.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+Pt+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(jt===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+Pt+`) *
                  getW(wF, wR, wC, `+Pt+`, d2);
              } else if (`+(jt===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+Pt+`),
                  getX(batch, xF, xR, xC, `+Pt+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+Pt+`, d2),
                  getW(wF, wR, wC, `+Pt+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(jt===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+Pt+`),
                  getX(batch, xF, xR, xC, `+Pt+` + 1),
                  getX(batch, xF, xR, xC, `+Pt+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+Pt+`, d2),
                  getW(wF, wR, wC, `+Pt+` + 1, d2),
                  getW(wF, wR, wC, `+Pt+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(C);return this.compileAndRun(z,[d,y])},v.prototype.conv3dDerInput=function(d,y,C){var z=new function(Z){this.variableNames=["dy","W"],this.outputShape=Z.inShape;var re=Z.filterDepth,fe=Z.filterHeight,xe=Z.filterWidth,Oe=Z.strideDepth,Re=Z.strideHeight,Le=Z.strideWidth,Be=re-1-Z.padInfo.front,Xe=fe-1-Z.padInfo.top,nt=xe-1-Z.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+Be+", "+Xe+", "+nt+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+re+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+Oe+`.0;

          if (dyF < 0.0 || dyF >= `+Z.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+re+` - 1 - wF;

          for (int wR = 0; wR < `+fe+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+Re+`.0;

            if (dyR < 0.0 || dyR >= `+Z.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+fe+` - 1 - wR;

            for (int wC = 0; wC < `+xe+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+Le+`.0;

              if (dyC < 0.0 || dyC >= `+Z.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+xe+` - 1 - wC;

              for (int d2 = 0; d2 < `+Z.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(C);return this.compileAndRun(z,[d,y])},v.prototype.conv3dDerFilter=function(d,y,C){var z=new function(Z){this.variableNames=["x","dy"],this.outputShape=Z.filterShape;var re=Z.strideDepth,fe=Z.strideHeight,xe=Z.strideWidth,Oe=Z.padInfo.front,Re=Z.padInfo.top,Le=Z.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+Z.batchSize+`; b++) {
          for (int yF = 0; yF < `+Z.outDepth+`; yF++) {
            int xF = wF + yF * `+re+" - "+Oe+`;

            if (xF < 0 || xF >= `+Z.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+Z.outHeight+`; yR++) {
              int xR = wR + yR * `+fe+" - "+Re+`;

              if (xR < 0 || xR >= `+Z.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+Z.outWidth+`; yC++) {
                int xC = wC + yC * `+xe+" - "+Le+`;

                if (xC < 0 || xC >= `+Z.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(C);return this.compileAndRun(z,[d,y])},v.prototype.maxPool=function(d,y){var C=new ks(y,"max",!1);return this.compileAndRun(C,[d])},v.prototype.avgPool=function(d,y){var C=new ks(y,"avg",!1);return this.compileAndRun(C,[d],"float32")},v.prototype.maxPoolBackprop=function(d,y,C,z){var Z=new ks(z,"max",!0),re=this.compileAndRun(Z,[y]),fe=new function(Oe){this.variableNames=["dy","maxPos"],this.outputShape=Oe.inShape;var Re=Oe.strideHeight,Le=Oe.strideWidth,Be=Oe.dilationHeight,Xe=Oe.effectiveFilterHeight,nt=Oe.effectiveFilterWidth,tt=Xe-1-Oe.padInfo.top,ut=nt-1-Oe.padInfo.left,Nt=Xe*nt-1;this.userCode=`
      const ivec2 pads = ivec2(`+tt+", "+ut+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+Xe+`;
          wR += `+Be+`) {
          float dyR = float(dyRCorner + wR) / `+Re+`.0;

          if (dyR < 0.0 || dyR >= `+Oe.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+nt+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+Le+`.0;

            if (dyC < 0.0 || dyC >= `+Oe.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+Nt+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+nt+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}(z),xe=this.compileAndRun(fe,[d,re],y.dtype);return re.dispose(),xe},v.prototype.avgPoolBackprop=function(d,y,C){var z=new function(Z){this.variableNames=["dy"],this.outputShape=Z.inShape;var re=Z.filterHeight,fe=Z.filterWidth,xe=Z.strideHeight,Oe=Z.strideWidth,Re=Z.dilationHeight,Le=Z.dilationWidth,Be=Z.effectiveFilterHeight,Xe=Z.effectiveFilterWidth,nt=Be-1-Z.padInfo.top,tt=Xe-1-Z.padInfo.left,ut=1/(re*fe);this.userCode=`
      const ivec2 pads = ivec2(`+nt+", "+tt+`);
      const float avgMultiplier = float(`+ut+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+Be+`;
            wR += `+Re+`) {
          float dyR = float(dyRCorner + wR) / `+xe+`.0;

          if (dyR < 0.0 || dyR >= `+Z.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+Xe+`;
            wC+= `+Le+`) {
            float dyC = float(dyCCorner + wC) / `+Oe+`.0;

            if (dyC < 0.0 || dyC >= `+Z.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}(C);return this.compileAndRun(z,[d],y.dtype)},v.prototype.cast=function(d,y){return fu(d,y,this)},v.prototype.unstack=function(d,y){for(var C=d.shape[y],z=new Array(d.rank-1),Z=0,re=0;re<d.rank;re++)re!==y&&(z[Z++]=d.shape[re]);var fe=new Array(d.rank).fill(0),xe=d.shape.slice();xe[y]=1;var Oe=new Array(C);for(re=0;re<Oe.length;re++)fe[y]=re,Oe[re]=this.slice(d,fe,xe).reshape(z);return Oe},v.prototype.avgPool3d=function(d,y){var C=new yo(y,"avg",!1);return this.compileAndRun(C,[d],"float32")},v.prototype.avgPool3dBackprop=function(d,y,C){var z=new function(Z){this.variableNames=["dy"],this.outputShape=Z.inShape;var re=Z.filterDepth,fe=Z.filterHeight,xe=Z.filterWidth,Oe=Z.strideDepth,Re=Z.strideHeight,Le=Z.strideWidth,Be=Z.dilationDepth,Xe=Z.dilationHeight,nt=Z.dilationWidth,tt=Z.effectiveFilterDepth,ut=Z.effectiveFilterHeight,Nt=Z.effectiveFilterWidth,Pt=tt-1-Z.padInfo.front,jt=ut-1-Z.padInfo.top,Yt=Nt-1-Z.padInfo.left,gn=1/(re*fe*xe);this.userCode=`
      const ivec3 pads = ivec3(`+Pt+", "+jt+", "+Yt+`);
      const float avgMultiplier = float(`+gn+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+tt+`;
            wD += `+Be+`) {
          float dyD = float(dyDCorner + wD) / `+Oe+`.0;

          if (dyD < 0.0 || dyD >= `+Z.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+ut+`;
              wR += `+Xe+`) {
            float dyR = float(dyRCorner + wR) / `+Re+`.0;

            if (dyR < 0.0 || dyR >= `+Z.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+Nt+`;
                wC += `+nt+`) {
              float dyC = float(dyCCorner + wC) / `+Le+`.0;

              if (dyC < 0.0 || dyC >= `+Z.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(C);return this.compileAndRun(z,[d],y.dtype)},v.prototype.maxPool3d=function(d,y){var C=new yo(y,"max",!1);return this.compileAndRun(C,[d],"float32")},v.prototype.maxPool3dBackprop=function(d,y,C,z){var Z=new yo(z,"max",!0),re=this.compileAndRun(Z,[y]),fe=new function(Oe){this.variableNames=["dy","maxPos"],this.outputShape=Oe.inShape;var Re=Oe.strideDepth,Le=Oe.strideHeight,Be=Oe.strideWidth,Xe=Oe.dilationDepth,nt=Oe.dilationHeight,tt=Oe.dilationWidth,ut=Oe.effectiveFilterDepth,Nt=Oe.effectiveFilterHeight,Pt=Oe.effectiveFilterWidth,jt=ut-1-Oe.padInfo.front,Yt=Nt-1-Oe.padInfo.top,gn=Pt-1-Oe.padInfo.left,wn=ut*Nt*Pt-1;this.userCode=`
      const ivec3 pads = ivec3(`+jt+", "+Yt+", "+gn+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+ut+`;
           wD += `+Xe+`) {
          float dyD = float(dyDCorner + wD) / `+Re+`.0;

          if (dyD < 0.0 || dyD >= `+Oe.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+Nt+`;
              wR += `+nt+`) {
            float dyR = float(dyRCorner + wR) / `+Le+`.0;

            if (dyR < 0.0 || dyR >= `+Oe.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+Pt+`;
                wC += `+tt+`) {
              float dyC = float(dyCCorner + wC) / `+Be+`.0;

              if (dyC < 0.0 || dyC >= `+Oe.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+wn+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+Nt+" * "+Pt+` +
                  wR * `+Pt+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(z),xe=this.compileAndRun(fe,[d,re],y.dtype);return re.dispose(),xe},v.prototype.reshape=function(d,y){var C=this.texData.get(d.dataId);if(C.isPacked&&!Iu(d.shape,y)&&(C.texture===null||!Iu(C.shape,y))){var z=this.packedReshape(d,y);return He.makeTensorFromDataId(z.dataId,z.shape,z.dtype)}return Ku(d,y)},v.prototype.resizeBilinear=function(d,y,C,z){var Z=j().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new function(re,fe,xe,Oe){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var Re=re[0],Le=re[1],Be=re[2],Xe=re[3];this.outputShape=[Re,fe,xe,Xe];var nt=[Oe&&fe>1?Le-1:Le,Oe&&xe>1?Be-1:Be],tt=[Oe&&fe>1?fe-1:fe,Oe&&xe>1?xe-1:xe];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+nt[0]/tt[0]+`,
          `+nt[1]/tt[1]+`,
          `+nt[1]/tt[1]+`);
      const vec3 inputShapeRC = vec3(`+Le+".0, "+Be+`.0,
                                     `+Be+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(Xe-1)+`;
        bool hasNextRow = coords.z < `+(xe-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}(d.shape,y,C,z):new function(re,fe,xe,Oe){this.variableNames=["A"],this.outputShape=[];var Re=re[0],Le=re[1],Be=re[2],Xe=re[3];this.outputShape=[Re,fe,xe,Xe];var nt=[Oe&&fe>1?Le-1:Le,Oe&&xe>1?Be-1:Be],tt=[Oe&&fe>1?fe-1:fe,Oe&&xe>1?xe-1:xe];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+nt[0]/tt[0]+`,
          `+nt[1]/tt[1]+`);
      const vec2 inputShapeRC = vec2(`+Le+".0, "+Be+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}(d.shape,y,C,z);return this.compileAndRun(Z,[d],"float32")},v.prototype.resizeBilinearBackprop=function(d,y,C){var z=new function(Z,re,fe){this.variableNames=["dy"],this.outputShape=[],this.outputShape=re.shape;var xe=re.shape,Oe=xe[1],Re=xe[2],Le=Z.shape,Be=Le[1],Xe=Le[2],nt=[fe&&Be>1?Oe-1:Oe,fe&&Xe>1?Re-1:Re],tt=[fe&&Be>1?Be-1:Be,fe&&Xe>1?Xe-1:Xe],ut=nt[0]/tt[0],Nt=nt[1]/tt[1],Pt=1/ut,jt=1/Nt,Yt=2*Math.ceil(Pt)+2,gn=2*Math.ceil(jt)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+ut+`);
        const float widthScale = float(`+Nt+`);

        const float invHeightScale = float(`+Pt+`);
        const float invWidthScale = float(`+jt+`);

        const int winHeight = int(`+Yt+`);
        const int winWidth = int(`+gn+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+Be+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+Xe+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(Oe-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(Re-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}(d,y,C);return this.compileAndRun(z,[d])},v.prototype.resizeNearestNeighbor=function(d,y,C,z){var Z=new function(re,fe,xe,Oe){this.variableNames=["A"],this.outputShape=[];var Re=re[0],Le=re[1],Be=re[2],Xe=re[3];this.outputShape=[Re,fe,xe,Xe];var nt=[Oe&&fe>1?Le-1:Le,Oe&&xe>1?Be-1:Be],tt=[Oe&&fe>1?fe-1:fe,Oe&&xe>1?xe-1:xe],ut=Oe?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+nt[0]/tt[0]+`,
          `+nt[1]/tt[1]+`);
      const vec2 inputShapeRC = vec2(`+Le+".0, "+Be+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+ut+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}(d.shape,y,C,z);return this.compileAndRun(Z,[d])},v.prototype.resizeNearestNeighborBackprop=function(d,y,C){var z=new function(Z,re,fe){this.variableNames=["dy"],this.outputShape=[],this.outputShape=re.shape;var xe=re.shape,Oe=xe[1],Re=xe[2],Le=Z.shape,Be=Le[1],Xe=Le[2],nt=[fe&&Be>1?Oe-1:Oe,fe&&Xe>1?Re-1:Re],tt=[fe&&Be>1?Be-1:Be,fe&&Xe>1?Xe-1:Xe],ut=nt[0]/tt[0],Nt=nt[1]/tt[1],Pt=1/ut,jt=1/Nt,Yt=2*Math.ceil(Pt)+2,gn=2*Math.ceil(jt)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+ut+`);
        const float widthScale = float(`+Nt+`);

        const float invHeightScale = float(`+Pt+`);
        const float invWidthScale = float(`+jt+`);

        const int winHeight = int(`+Yt+`);
        const int winWidth = int(`+gn+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+Be+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+Xe+`) {
              continue;
            }

            float sourceFracRow =
              float(`+nt[0]+`) *
                (float(dyR) / float(`+tt[0]+`));

            float sourceFracCol =
                float(`+nt[1]+`) *
                  (float(dyC) / float(`+tt[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+Oe+`) - 1),
                `+fe+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+Re+`) - 1),
                `+fe+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}(d,y,C);return this.compileAndRun(z,[d])},v.prototype.multinomial=function(d,y,C,z){var Z=y?d:js(d),re=Z.shape[0],fe=Z.shape[1],xe=new zs(re,fe,C),Oe=xe.getCustomSetupFunc(z);return this.compileAndRun(xe,[Z],"int32",Oe)},v.prototype.oneHot=function(d,y,C,z){var Z=new function(re,fe,xe,Oe){this.variableNames=["indices"],this.outputShape=[re,fe],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+Oe+"), float("+xe+`),
                      float(index == coords.y)));
      }
    `}(d.size,y,C,z);return this.compileAndRun(Z,[d])},v.prototype.diag=function(d){var y=new function(C){this.variableNames=["X"],this.outputShape=[C,C],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}(d.size);return this.compileAndRun(y,[d])},v.prototype.nonMaxSuppression=function(d,y,C,z,Z){return Ml("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Ju(d.dataSync(),y.dataSync(),C,z,Z)},v.prototype.cropAndResize=function(d,y,C,z,Z,re){var fe=new function(xe,Oe,Re,Le,Be){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var Xe=xe[0],nt=xe[1],tt=xe[2],ut=xe[3],Nt=Oe[0],Pt=Re[0],jt=Re[1];this.outputShape=[Nt,Pt,jt,ut];var Yt=Le==="bilinear"?1:0,gn=[nt-1+".0",tt-1+".0"],wn=gn[0],vn=gn[1],Cn=Pt>1?[""+(nt-1)/(Pt-1),"(y2-y1) * height_ratio","y1*"+wn+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+wn],Dn=Cn[0],b=Cn[1],p=Cn[2],l=jt>1?[""+(tt-1)/(jt-1),"(x2-x1) * width_ratio","x1*"+vn+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+vn],m=l[0],w=l[1],P=l[2];this.userCode=`
      const float height_ratio = float(`+Dn+`);
      const float width_ratio = float(`+m+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+Xe+`) {
          return;
        }

        float height_scale = `+b+`;
        float width_scale = `+w+`;

        float in_y = `+p+`;
        if( in_y < 0.0 || in_y > `+wn+` ) {
          setOutput(float(`+Be+`));
          return;
        }
        float in_x = `+P+`;
        if( in_x < 0.0 || in_x > `+vn+` ) {
          setOutput(float(`+Be+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+Yt+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}(d.shape,y.shape,z,Z,re);return this.compileAndRun(fe,[d,y,C],"float32")},v.prototype.depthToSpace=function(d,y,C){we(y>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+y});var z=d.shape[0],Z=C==="NHWC"?d.shape[1]:d.shape[2],re=C==="NHWC"?d.shape[2]:d.shape[3],fe=C==="NHWC"?d.shape[3]:d.shape[1],xe=Z*y,Oe=re*y,Re=fe/(y*y),Le=new pa(C==="NHWC"?[z,xe,Oe,Re]:[z,Re,xe,Oe],y,C);return this.compileAndRun(Le,[d])},v.prototype.split=function(d,y,C){return Of(d,y,C)},v.prototype.scatterND=function(d,y,C){var z=Pl(0,d,C),Z=z.sliceRank,re=z.numUpdates,fe=z.sliceSize,xe=z.strides,Oe=z.outputSize,Re=[Oe/fe,fe],Le=d.reshape([re,Z]),Be=y.reshape([re,fe]);if(Oe===0)return Ku(No([]),C);var Xe=Ar(0),nt=new Us(re,Z,Le.rank,Be.rank,xe,Re);return this.compileAndRun(nt,[Be,Le,Xe]).reshape(C)},v.prototype.sparseToDense=function(d,y,C,z){var Z=Pl(0,d,C),re=Z.sliceRank,fe=Z.numUpdates,xe=Z.strides,Oe=Z.outputSize,Re=new Us(fe,re,d.rank,y.rank,xe,[Oe,1]);return this.compileAndRun(Re,[y,d,z]).reshape(C)},v.prototype.fft=function(d){return this.fftImpl(d,!1)},v.prototype.ifft=function(d){return this.fftImpl(d,!0)},v.prototype.fftImpl=function(d,y){var C=this.texData.get(d.dataId),z=new Go("return real * expR - imag * expI;",d.shape,y),Z=new Go("return real * expI + imag * expR;",d.shape,y),re=[this.makeComplexComponentTensorInfo(d,C.complexTensors.real),this.makeComplexComponentTensorInfo(d,C.complexTensors.imag)],fe=this.compileAndRun(z,re),xe=this.compileAndRun(Z,re),Oe=this.complex(fe,xe).as2D(d.shape[0],d.shape[1]);return fe.dispose(),xe.dispose(),Oe},v.prototype.gatherND=function(d,y){var C=y.shape,z=C[C.length-1],Z=gc(d,y),re=Z[0],fe=Z[1],xe=Z[2],Oe=Z[3],Re=y.reshape([fe,z]),Le=d.reshape([d.size/xe,xe]),Be=new function(Xe,nt,tt){this.sliceDim=Xe,this.strides=nt,this.variableNames=["x","indices"],this.outputShape=tt;var ut=Yn(nt.length),Nt=Yn(tt.length),Pt=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+ut+" strides = "+ut+"("+this.strides+`);
         void main() {
          `+Nt+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+Pt+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}(z,Oe,[fe,xe]);return this.compileAndRun(Be,[Le,Re]).reshape(re)},v.prototype.fill=function(d,y,C){if((C=C||Ce(y))==="string"){var z=an(C,ze(d));return z.fill(y),He.makeTensor(z,d,C,this)}var Z=new sa(d,y),re=Z.getCustomSetupFunc(y);return this.compileAndRun(Z,[],C,re)},v.prototype.onesLike=function(d){if(d.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(d.shape,1,d.dtype)},v.prototype.zerosLike=function(d){return this.fill(d.shape,d.dtype==="string"?"":0,d.dtype)},v.prototype.linspace=function(d,y,C){return yc(d,y,C)},v.prototype.makeTensorInfo=function(d,y){var C=this.write(null,d,y);return this.texData.get(C).usage=null,{dataId:C,shape:d,dtype:y}},v.prototype.makeOutput=function(d,y){var C=this.makeTensorInfo(d,y).dataId;return He.makeTensorFromDataId(C,d,y,this)},v.prototype.unpackTensor=function(d){var y=new function(C){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=C;var z=C.length,Z=G("rc",z),re=Yn(z),fe=function(Re,Le){if(Re===1)return"rc";for(var Be="",Xe=0;Xe<Re;Xe++)Be+=Le[Xe],Xe<Re-1&&(Be+=",");return Be}(z,Z),xe=Z.slice(-2),Oe=z<=1?"rc":"vec2("+xe.join(",")+")";this.userCode=`
      void main() {
        `+re+` rc = getOutputCoords();
        vec4 packedInput = getA(`+fe+`);

        setOutput(getChannel(packedInput, `+Oe+`));
      }
    `}(d.shape);return this.runWebGLProgram(y,[d],d.dtype)},v.prototype.packTensor=function(d){var y=new function(C){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=C;var z=C.length;if(z===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var Z=G("rc",z),re=Yn(z),fe=function(Re,Le,Be){if(Re===1)return"rc > "+Le[0];for(var Xe="",nt=Re-2;nt<Re;nt++)Xe+=Be[nt]+" >= "+Le[nt],nt<Re-1&&(Xe+="||");return Xe}(z,C,Z),xe=function(Re,Le,Be,Xe){if(Re===1)return"";var nt=Xe.slice(-2);return`
    int r = `+nt[0]+`;
    int c = `+nt[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+Le+`;
    bool rEdge = rp1 >= `+Be+`;
  `}(z,C[C.length-1],C[C.length-2],Z),Oe=function(Re,Le){var Be=Re.length,Xe=function(nt,tt){for(var ut=[],Nt=0;Nt<=1;Nt++)for(var Pt=0;Pt<=1;Pt++){for(var jt=(Nt===0?"r":"rp1")+", "+(Pt===0?"c":"cp1"),Yt=2;Yt<nt;Yt++)jt=tt[tt.length-1-Yt]+","+jt;ut.push(jt)}return ut}(Be,Le);return Be===1?`getA(rc),
            rc + 1 >= `+Re[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+Xe[0]+`),
          cEdge ? 0. : getA(`+Xe[1]+`),
          rEdge ? 0. : getA(`+Xe[2]+`),
          rEdge || cEdge ? 0. : getA(`+Xe[3]+")"}(C,Z);this.userCode=`
        void main() {
          `+re+` rc = getOutputCoords();

          if(`+fe+`) {
            setOutput(vec4(0));
          } else {
            `+xe+`

            setOutput(vec4(`+Oe+`));
          }
        }
      `}}(d.shape);return this.runWebGLProgram(y,[d],d.dtype,null,!0)},v.prototype.packedReshape=function(d,y){var C=[ws(d.shape)].concat(La(d.shape)),z={dtype:d.dtype,shape:C,dataId:d.dataId},Z=new function(fe,xe){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=fe;for(var Oe="",Re=0;Re<4;Re++){var Le="thisRC = rc;";Re%2==1&&(Le+="thisRC.z += 1;"),Re>1&&(Le+="thisRC.y += 1;"),Oe+=`
        `+Le+`
        `+(Re>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+Re+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(Re>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+je(["r","c","d"],xe)+`
      return ivec3(r, c, d);
    }
  
      `+Qe(fe)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+fe[1]+`;
        int cols = `+fe[2]+`;

        `+Oe+`

        setOutput(result);
      }
    `}([ws(y)].concat(La(y)),C),re=this.runWebGLProgram(Z,[z],d.dtype,null,!0);return{dataId:re.dataId,shape:y,dtype:re.dtype}},v.prototype.decode=function(d){var y,C=this.texData.get(d),z=C.isPacked,Z=C.shape,re=C.dtype,fe=Nc(Z);return y=z?new function(xe){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Zn.DENSE;var Oe=yi(xe),Re=ce();this.outputShape=xe,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+je(["r","c","d"],xe)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+Oe[0]+", "+Oe[1]+`));
        int index = 4 * (resTexRC.x * `+Oe[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+Re.output+` = result;
      }
    `}(fe):new function(xe){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Zn.DENSE;var Oe=yi(xe),Re=ce();this.outputShape=xe,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+je(["r","c","d"],xe)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+Oe[0]+", "+Oe[1]+`));
        int index = 4 * (resTexRC.x * `+Oe[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+Re.output+` = result;
      }
    `}(fe),{dtype:re,shape:Z,dataId:this.runWebGLProgram(y,[{shape:fe,dtype:re,dataId:d}],re,null,!0).dataId}},v.prototype.runWebGLProgram=function(d,y,C,z,Z){var re=this;Z===void 0&&(Z=!1);var fe=this.makeTensorInfo(d.outputShape,C),xe=this.texData.get(fe.dataId);if(d.packedOutput&&(xe.isPacked=!0),d.outPackingScheme===Zn.DENSE){var Oe=yi(d.outputShape);xe.texShape=Oe.map(function(Pt){return 2*Pt})}if(d.outTexUsage!=null&&(xe.usage=d.outTexUsage),ze(fe.shape)===0)return xe.values=kn(fe.dtype,0),fe;var Re=[],Le=y.map(function(Pt){if(Pt.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var jt=re.texData.get(Pt.dataId);if(jt.texture==null){if(!d.packedInputs&&ze(Pt.shape)<=j().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:Pt.shape,texData:null,isUniform:!0,uniformValues:jt.values};d.packedInputs&&(jt.isPacked=!0,jt.shape=Pt.shape)}else if(!!jt.isPacked!=!!d.packedInputs)Pt=jt.isPacked?re.unpackTensor(Pt):re.packTensor(Pt),Re.push(Pt),jt=re.texData.get(Pt.dataId);else if(jt.isPacked&&!Iu(jt.shape,Pt.shape)){var Yt=Pt,gn=Pt.shape;Pt.shape=jt.shape,Pt=re.packedReshape(Pt,gn),Re.push(Pt),jt=re.texData.get(Pt.dataId),Yt.shape=gn}return re.uploadToGPU(Pt.dataId),{shape:Pt.shape,texData:jt,isUniform:!1}});this.uploadToGPU(fe.dataId);var Be,Xe={shape:fe.shape,texData:xe,isUniform:!1},nt=function(Pt,jt,Yt){var gn="";Le.concat(Yt).forEach(function(vn){var Cn=vn.texData!=null&&vn.texData.slice!=null&&vn.texData.slice.flatOffset>0,Dn=vn.isUniform?"uniform":vn.texData.texShape;gn+=vn.shape+"_"+Dn+"_"+Cn});var wn=Pt.userCode;return Pt.constructor.name+"_"+gn+"_"+wn}(d,0,Xe),tt=this.getAndSaveBinary(nt,function(){return function(Pt,jt,Yt,gn){var wn=jt.userCode,vn=Yt.map(function(ee,le){var de={logicalShape:ee.shape,texShape:ee.isUniform?null:ee.texData.texShape,isUniform:ee.isUniform,isPacked:!ee.isUniform&&ee.texData.isPacked,flatOffset:null};return ee.texData!=null&&ee.texData.slice!=null&&ee.texData.slice.flatOffset>0&&(de.flatOffset=ee.texData.slice.flatOffset),{name:jt.variableNames[le],shapeInfo:de}}),Cn=vn.map(function(ee){return ee.shapeInfo}),Dn={logicalShape:gn.shape,texShape:gn.texData.texShape,isUniform:!1,isPacked:gn.texData.isPacked,flatOffset:null},b=qt(vn,Dn,wn,jt.packedInputs),p=Pt.createProgram(b),l=null,m=Pt.getUniformLocation(p,"NAN",!1);j().getNumber("WEBGL_VERSION")===1&&(l=Pt.getUniformLocation(p,"INFINITY",!1));for(var w={},P=0;P<jt.variableNames.length;P++){var K=jt.variableNames[P];w[K]=Pt.getUniformLocation(p,K,!1),w["offset"+K]=Pt.getUniformLocation(p,"offset"+K,!1)}return{program:jt,source:b,webGLProgram:p,uniformLocations:w,inShapeInfos:Cn,outShapeInfo:Dn,infLoc:l,nanLoc:m}}(re.gpgpu,d,Le,Xe)}),ut=this.activeTimers!=null;if(ut&&(Be=this.startTimer()),function(Pt,jt,Yt,gn,wn){Js(jt.inShapeInfos,Yt),Js([jt.outShapeInfo],[gn]);var vn=gn.texData.texture,Cn=gn.texData.texShape;gn.texData.isPacked?Pt.setOutputPackedMatrixTexture(vn,Cn[0],Cn[1]):Pt.setOutputMatrixTexture(vn,Cn[0],Cn[1]),Pt.setProgram(jt.webGLProgram),j().getNumber("WEBGL_VERSION")===1&&jt.infLoc!==null&&Pt.gl.uniform1f(jt.infLoc,1/0),jt.nanLoc!==null&&Pt.gl.uniform1f(jt.nanLoc,NaN),Yt.forEach(function(Dn,b){var p=jt.program.variableNames[b],l=jt.uniformLocations[p],m=jt.uniformLocations["offset"+p];if(l!=null)if(Dn.isUniform)if(ze(Dn.shape)<2)Pt.gl.uniform1f(l,Dn.uniformValues[0]);else{var w=Dn.uniformValues;w instanceof Float32Array||(w=new Float32Array(w)),Pt.gl.uniform1fv(l,w)}else Dn.texData.slice!=null&&m!=null&&Pt.gl.uniform1i(m,Dn.texData.slice.flatOffset),Pt.setInputMatrixTexture(Dn.texData.texture,l,b)}),wn!=null&&wn(Pt,jt.webGLProgram),Pt.executeProgram()}(this.gpgpu,tt,Le,Xe,z),Re.forEach(function(Pt){return re.disposeData(Pt.dataId)}),ut&&(Be=this.endTimer(Be),this.activeTimers.push({name:d.constructor.name,query:this.getQueryTime(Be)})),!j().getBool("WEBGL_LAZILY_UNPACK")&&xe.isPacked&&Z===!1){var Nt=this.unpackTensor(fe);return this.disposeData(fe.dataId),Nt}return fe},v.prototype.compileAndRun=function(d,y,C,z,Z){Z===void 0&&(Z=!1),C=C||y[0].dtype;var re=this.runWebGLProgram(d,y,C,z,Z);return He.makeTensorFromDataId(re.dataId,re.shape,re.dtype)},v.prototype.getAndSaveBinary=function(d,y){return d in this.binaryCache||(this.binaryCache[d]=y()),this.binaryCache[d]},v.prototype.getTextureManager=function(){return this.textureManager},v.prototype.dispose=function(){var d=this;this.disposed||(j().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(y){d.gpgpu.deleteProgram(d.binaryCache[y].webGLProgram),delete d.binaryCache[y]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},v.prototype.floatPrecision=function(){var d=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=qi(function(){if(!j().get("WEBGL_RENDER_FLOAT32_ENABLED")){var y=j().getBool("DEBUG");j().set("DEBUG",!1);var C=d.abs(Ar(1e-8)).dataSync()[0];if(j().set("DEBUG",y),C>0)return 32}return 16})),this.floatPrecisionValue},v.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},v.prototype.uploadToGPU=function(d){var y,C=this.texData.get(d),z=C.shape,Z=C.dtype,re=C.values,fe=C.texture,xe=C.usage,Oe=C.isPacked;if(fe==null){var Re,Le=this.activeTimers!=null;Le&&(Re=en());var Be=C.texShape;if(Be==null&&(Be=pf(z,Oe),C.texShape=Be),re!=null){var Xe=Nc(z),nt=void 0,tt=Be[1],ut=Be[0],Nt=re instanceof Uint8Array;Oe?(tt=(y=ri(Be[0],Be[1]))[0],nt=new function(wn,vn,Cn){Cn===void 0&&(Cn=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var Dn=ce(),b=vn[0],p=vn[1];this.outputShape=wn;var l="",m="result";Cn&&(m="floor(result * 255. + 0.5)");for(var w=0;w<=1;w++)for(var P=0;P<=1;P++){var K=2*w+P;l+=`
          localCoords = coords;
          if(localCoords[2] + `+P+" < "+wn[2]+`) {
            localCoords[2] += `+P+`;
            if(localCoords[1] + `+w+" < "+wn[1]+`) {
              localCoords[1] += `+w+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+p+`;
              c = imod(flatIndex, `+p+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+p+".0, "+b+`.0);
              values = `+Dn.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+K+`] = values[0];
              } else if(offset == 1) {
                result[`+K+`] = values[1];
              } else if(offset == 2) {
                result[`+K+`] = values[2];
              } else {
                result[`+K+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Qe(wn)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+l+`

        `+Dn.output+" = "+m+`;
      }
    `}(Xe,[ut=y[1],tt],Nt)):nt=new function(wn,vn,Cn){Cn===void 0&&(Cn=!1),this.variableNames=["A"];var Dn=ce(),b=vn[0],p=vn[1];this.outputShape=wn;var l="result";Cn&&(l="floor(result * 255. + 0.5)"),this.userCode=`
      `+Qe(wn)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+p+`;
        int c = imod(flatIndex, `+p+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+p+".0, "+b+`.0);
        vec4 values = `+Dn.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+Dn.output+" = vec4("+l+`, 0., 0., 0.);
      }
    `}(Xe,[ut,tt],Nt);var Pt=this.makeTensorInfo([ut,tt],Z);this.texData.get(Pt.dataId).usage=Nt?lr.PIXELS:lr.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(Pt.dataId),tt,ut,re);var jt=this.runWebGLProgram(nt,[Pt],Z,null,!0),Yt=this.texData.get(jt.dataId);C.texture=Yt.texture,C.texShape=Yt.texShape,C.isPacked=Yt.isPacked,C.usage=Yt.usage,this.disposeData(Pt.dataId),this.texData.delete(jt.dataId),C.values=null,Le&&(this.uploadWaitMs+=en()-Re)}else{var gn=this.acquireTexture(Be,xe,Z,Oe);C.texture=gn}}},v.prototype.convertAndCacheOnCPU=function(d,y){var C=this.texData.get(d),z=C.dtype;return this.releaseGPUData(d),y!=null&&(C.values=function(Z,re){if(re==="float32"||re==="complex64")return Z;if(re==="int32"||re==="bool"){for(var fe=re==="int32"?new Int32Array(Z.length):new Uint8Array(Z.length),xe=0;xe<fe.length;++xe)fe[xe]=Math.round(Z[xe]);return fe}throw new Error("Unknown dtype "+re)}(y,z)),C.values},v.prototype.acquireTexture=function(d,y,C,z){if(this.numBytesInGPU+=this.computeBytes(d,C),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var Z=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+Z+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(d,y,z)},v.prototype.computeBytes=function(d,y){return d[0]*d[1]*$t(y)},v}(Td);Bn()&&He.registerBackend("webgl",function(){return new Ny},2);var a0=Lt({square_:function(_){var v=Ze(_,"x","square"),d=[v];return He.runKernelFunc(function(y,C){return C([v]),y.square(v)},{x:v},null,"Square",{},d,[])}}),qh="SquaredDifference",Rd=Lt({squaredDifference_:function(_,v){var d,y=Ze(_,"a","squaredDifference"),C=Ze(v,"b","squaredDifference");d=Zt(y,C),y=d[0],C=d[1],io(y.shape,C.shape);var z={a:y,b:C},Z=[y,C];return He.runKernelFunc(function(re,fe){var xe=re.squaredDifference(y,C);return fe([y,C]),xe},z,function(re,fe){var xe=fe[0],Oe=fe[1],Re=Ar(2);return{a:function(){return re.mul(xe.sub(Oe).mul(Re))},b:function(){return re.mul(Oe.sub(xe).mul(Re))}}},qh,{},Z,[])}}),ll=Lt({abs_:function(_){var v=Ze(_,"x","abs");return v.dtype==="complex64"?He.runKernelFunc(function(d){return d.complexAbs(v)},{$x:v}):He.runKernelFunc(function(d,y){var C=d.abs(v);return y([v]),C},{x:v},function(d,y){var C=y[0];return{x:function(){return d.mul(C.toFloat().step(-1))}}},"Abs")}}),s0=Lt({acos_:function(_){var v=Ze(_,"x","acos");return He.runKernelFunc(function(d,y){var C=d.acos(v);return y([v]),C},{$x:v},function(d,y){var C=y[0];return{$x:function(){return d.divStrict(Ar(1).sub(C.toFloat().square()).sqrt()).neg()}}})}}),u0=Lt({acosh_:function(_){var v=Ze(_,"x","acosh");return He.runKernelFunc(function(d,y){var C=d.acosh(v);return y([v]),C},{$x:v},function(d,y){var C=y[0];return{$x:function(){return d.divStrict(C.toFloat().square().sub(1).sqrt())}}})}}),ec=Lt({asin_:function(_){var v=Ze(_,"x","asin");return He.runKernelFunc(function(d,y){var C=d.asin(v);return y([v]),C},{$x:v},function(d,y){var C=y[0];return{$x:function(){return d.divStrict(Ar(1).sub(C.toFloat().square()).sqrt())}}})}}),c0=Lt({asinh_:function(_){var v=Ze(_,"x","asinh");return He.runKernelFunc(function(d,y){var C=d.asinh(v);return y([v]),C},{$x:v},function(d,y){var C=y[0];return{$x:function(){return d.divStrict(Ar(1).add(C.toFloat().square()).sqrt())}}})}}),$h=Lt({atan_:function(_){var v=Ze(_,"x","atan");return He.runKernelFunc(function(d,y){var C=d.atan(v);return y([v]),C},{$x:v},function(d,y){var C=y[0];return{$x:function(){return d.div(C.toFloat().square().add(1))}}})}}),lm=Lt({atanh_:function(_){var v=Ze(_,"x","atanh");return He.runKernelFunc(function(d,y){var C=d.atanh(v);return y([v]),C},{$x:v},function(d,y){var C=y[0];return{$x:function(){return d.div(Ar(1).sub(C.toFloat().square()))}}})}}),Iy=Lt({ceil_:function(_){var v=Ze(_,"x","ceil");return He.runKernelFunc(function(d){return d.ceil(v)},{$x:v},function(d){return{$x:function(){return vi(d)}}})}}),fm=Lt({clipByValue_:function(_,v,d){var y=Ze(_,"x","clipByValue");we(v<=d,function(){return"Error in clip: min ("+v+") must be less than or equal to max ("+d+")."});var C=[y],z={min:v,max:d};return He.runKernelFunc(function(Z,re){var fe=Z.clip(y,v,d);return re([y]),fe},{x:y},function(Z,re){var fe=re[0];return{x:function(){return Z.where(fe.greaterEqual(v).logicalAnd(fe.lessEqual(d)),vi(Z))}}},"ClipByValue",z,C)}}),fl=Lt({cos_:function(_){var v=Ze(_,"x","cos"),d=[v];return He.runKernelFunc(function(y,C){var z=y.cos(v);return C([v]),z},{x:v},function(y,C){var z=C[0];return{x:function(){return z.toFloat().sin().neg().mul(y)}}},"Cos",{},d)}}),dm=Lt({cosh_:function(_){var v=Ze(_,"x","cosh");return He.runKernelFunc(function(d,y){var C=d.cosh(v);return y([v]),C},{$x:v},function(d,y){var C=y[0];return{$x:function(){return C.toFloat().sinh().mulStrict(d)}}})}}),mv=Lt({erf_:function(_){var v=Ze(_,"x","erf");return we(v.dtype==="int32"||v.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),v.dtype==="int32"&&(v=v.toFloat()),He.runKernelFunc(function(d,y){var C=d.erf(v);return y([v]),C},{$x:v},function(d,y){var C=y[0];return{$x:function(){return d.mul(C.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),gv=Lt({exp_:function(_){var v=Ze(_,"x","exp");return He.runKernelFunc(function(d,y){var C=d.exp(v);return y([C]),C},{x:v},function(d,y){return{x:function(){return d.mulStrict(y[0])}}},"Exp",{},[],[!0])}}),l0=Lt({expm1_:function(_){var v=Ze(_,"x","expm1");return He.runKernelFunc(function(d,y){var C=d.expm1(v);return y([v]),C},{$x:v},function(d,y){var C=y[0];return{$x:function(){return d.mul(C.exp())}}})}}),j1=Lt({floor_:function(_){var v=Ze(_,"x","floor");return He.runKernelFunc(function(d){return d.floor(v)},{$x:v},function(d){return{$x:function(){return vi(d)}}})}}),z1=Lt({log_:function(_){var v=Ze(_,"x","log"),d=[v];return He.runKernelFunc(function(y,C){var z=y.log(v);return C([v]),z},{x:v},function(y,C){var z=C[0];return{x:function(){return y.div(z.toFloat())}}},"Log",{},d)}}),xo=Lt({log1p_:function(_){var v=Ze(_,"x","log1p");return He.runKernelFunc(function(d,y){var C=d.log1p(v);return y([v]),C},{$x:v},function(d,y){var C=y[0];return{$x:function(){return d.div(C.add(1))}}})}}),vv=Lt({logSigmoid_:function(_){var v=Ze(_,"x","logSigmoid");return He.runKernelFunc(function(d,y){var C=d.softplus(v.neg()).neg();return y([v]),C},{$x:v},function(d,y){var C=y[0];return{$x:function(){return d.mul(C.neg().sigmoid())}}})}}),yv=Lt({neg_:function(_){var v=Ze(_,"x","neg"),d=[v];return He.runKernelFunc(function(y){return y.neg(v)},{x:v},function(y){return{x:function(){return y.neg()}}},"Neg",{},d)}}),og=Lt({reciprocal_:function(_){var v=Ze(_,"x","reciprocal");return He.runKernelFunc(function(d,y){var C=d.reciprocal(v);return y([v]),C},{$x:v},function(d,y){var C=y[0];return{$x:function(){return d.div(C.square().neg())}}})}}),bv=Lt({round_:function(_){var v=Ze(_,"x","round");return He.runKernelFunc(function(d){return d.round(v)},{$x:v},function(d){return{$x:function(){return vi(d)}}})}}),hm=Lt({rsqrt_:function(_){var v=Ze(_,"x","rsqrt"),d=[v];return He.runKernelFunc(function(y,C){var z=y.rsqrt(v);return C([v]),z},{x:v},function(y,C){var z=C[0];return{x:function(){return y.div(z.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},d)}}),Wl=Lt({sigmoid_:function(_){var v=Ze(_,"x","sigmoid");return He.runKernelFunc(function(d,y){var C=d.sigmoid(v);return y([C]),C},{x:v},function(d,y){var C=y[0];return{x:function(){return d.mul(C.mul(Ar(1).sub(C)))}}},"Sigmoid")}}),Vl=Lt({sign_:function(_){var v=Ze(_,"x","sign");return He.runKernelFunc(function(d){return d.sign(v)},{$x:v},function(d){return{$x:function(){return vi(d)}}})}}),xv=Lt({isNaN_:function(_){var v=Ze(_,"x","isNaN");return He.runKernelFunc(function(d){return d.isNaN(v)},{$x:v},function(d){return{$x:function(){return vi(d)}}})}}),wv=Lt({isInf_:function(_){var v=Ze(_,"x","isInf");return He.runKernelFunc(function(d){return d.isInf(v)},{$x:v},function(d){return{$x:function(){return vi(d)}}})}}),Xh=Lt({isFinite_:function(_){var v=Ze(_,"x","isFinite");return He.runKernelFunc(function(d){return d.isFinite(v)},{$x:v},function(d){return{$x:function(){return vi(d)}}})}}),Pd=Lt({sin_:function(_){var v=Ze(_,"x","sin"),d=[v];return He.runKernelFunc(function(y,C){var z=y.sin(v);return C([v]),z},{x:v},function(y,C){var z=C[0];return{x:function(){return z.toFloat().cos().mul(y)}}},"Sin",{},d)}}),Kh=Lt({sinh_:function(_){var v=Ze(_,"x","sinh");return He.runKernelFunc(function(d,y){var C=d.sinh(v);return y([v]),C},{$x:v},function(d,y){var C=y[0];return{$x:function(){return C.toFloat().cosh().mulStrict(d)}}})}}),U1=Lt({softplus_:function(_){var v=Ze(_,"x","softplus");return He.runKernelFunc(function(d,y){var C=d.softplus(v);return y([v]),C},{$x:v},function(d,y){var C=y[0];return{$x:function(){return d.mul(C.sigmoid())}}})}}),ag=Lt({sqrt_:function(_){var v=Ze(_,"x","sqrt");return He.runKernelFunc(function(d,y){var C=d.sqrt(v);return y([v]),C},{$x:v},function(d,y){var C=y[0];return{$x:function(){return d.div(C.toFloat().sqrt().mul(2))}}})}}),Hl=Lt({step_:function(_,v){v===void 0&&(v=0);var d=Ze(_,"x","step");return He.runKernelFunc(function(y){return y.step(d,v)},{$x:d},function(y){return{$x:function(){return vi(y)}}})}}),tc=Lt({tan_:function(_){var v=Ze(_,"x","tan");return He.runKernelFunc(function(d,y){var C=d.tan(v);return y([v]),C},{$x:v},function(d,y){var C=y[0];return{$x:function(){return d.div(C.cos().square())}}})}}),Mf=Lt({tanh_:function(_){var v=Ze(_,"x","tanh");return He.runKernelFunc(function(d,y){var C=d.tanh(v);return y([C]),C},{x:v},function(d,y){var C=y[0];return{x:function(){return Ar(1).sub(C.square()).mulStrict(d)}}},"Tanh",{},null,[!0])}});function Df(_,v,d,y,C,z){var Z,re,fe=Ze(_,"x","batchNorm"),xe=Ze(v,"mean","batchNorm"),Oe=Ze(d,"variance","batchNorm");return C!=null&&(Z=Ze(C,"scale","batchNorm")),y!=null&&(re=Ze(y,"offset","batchNorm")),we(fe.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+fe.rank+"."}),we(xe.rank===2||xe.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+xe.rank+"."}),we(Oe.rank===2||Oe.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+Oe.rank+"."}),Z!=null&&we(Z.rank===2||Z.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+Z.rank+"."}),re!=null&&we(re.rank===2||re.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+re.rank+"."}),sg(fe,xe,Oe,re,Z,z)}function Nf(_,v,d,y,C,z){var Z,re,fe=Ze(_,"x","batchNorm"),xe=Ze(v,"mean","batchNorm"),Oe=Ze(d,"variance","batchNorm");return C!=null&&(Z=Ze(C,"scale","batchNorm")),y!=null&&(re=Ze(y,"offset","batchNorm")),we(fe.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+fe.rank+"."}),we(xe.rank===3||xe.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+xe.rank+"."}),we(Oe.rank===3||Oe.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+Oe.rank+"."}),Z!=null&&we(Z.rank===3||Z.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+Z.rank+"."}),re!=null&&we(re.rank===3||re.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+re.rank+"."}),sg(fe,xe,Oe,re,Z,z)}function _v(_,v,d,y,C,z){var Z,re,fe=Ze(_,"x","batchNorm"),xe=Ze(v,"mean","batchNorm"),Oe=Ze(d,"variance","batchNorm");return C!=null&&(Z=Ze(C,"scale","batchNorm")),y!=null&&(re=Ze(y,"offset","batchNorm")),we(fe.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+fe.rank+"."}),we(xe.rank===4||xe.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+xe.rank+"."}),we(Oe.rank===4||Oe.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+Oe.rank+"."}),Z!=null&&we(Z.rank===4||Z.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+Z.rank+"."}),re!=null&&we(re.rank===4||re.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+re.rank+"."}),sg(fe,xe,Oe,re,Z,z)}function sg(_,v,d,y,C,z){z==null&&(z=.001);var Z,re,fe,xe=Ze(_,"x","batchNorm"),Oe=Ze(v,"mean","batchNorm"),Re=Ze(d,"variance","batchNorm");C!=null&&(Z=Ze(C,"scale","batchNorm")),y!=null&&(re=Ze(y,"offset","batchNorm")),we(Oe.rank===Re.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),we(re==null||Oe.rank===re.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),we(Z==null||Oe.rank===Z.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),fe=xe.rank===0||xe.rank===1?xe.as4D(1,1,1,xe.size):xe.rank===2?xe.as4D(1,1,xe.shape[0],xe.shape[1]):xe.rank===3?xe.as4D(1,xe.shape[0],xe.shape[1],xe.shape[2]):xe;var Le=[xe,Oe,Re,Z];return He.runKernelFunc(function(Be,Xe){var nt=Be.batchNormalization(fe,nc(Oe),nc(Re),z,nc(Z),nc(re));return Xe([xe,Oe,Re,Z]),nt},{x:xe,mean:Oe,variance:Re,scale:Z,offset:re},function(Be,Xe){var nt=Xe,tt=nt[0],ut=nt[1],Nt=nt[2],Pt=nt[3],jt=Pt??Ar(1),Yt=Na(ut.shape,fe.shape),gn=[];if(ut.rank===1){for(var wn=0;wn<fe.shape.length-1;++wn)gn.push(fe.shape[wn]);gn.push(1)}var vn=tt.sub(ut),Cn=Be.mul(jt),Dn=hm(Nt.add(Ar(z))),b=Dn.mul(Dn).mul(Dn).mul(Ar(-.5));return{x:function(){return ut.rank===1?Be.mul(Ls(Dn.as4D(1,1,1,ut.shape[0]),gn)).mul(jt).reshape(tt.shape):Be.mul(Dn).mul(jt).reshape(tt.shape)},mean:function(){var p=Dn.mul(Ar(-1)).mul(Cn);return ut.rank===1&&(p=p.sum(Yt)),p.reshape(ut.shape)},variance:function(){var p=b.mul(vn).mul(Cn);return ut.rank===1&&(p=p.sum(Yt)),p.reshape(ut.shape)},scale:function(){var p=vn.mul(Dn),l=Be.mul(p);return ut.rank===1&&(l=l.sum(Yt)),l.reshape(ut.shape)},offset:function(){var p=Be;return ut.rank===1&&(p=p.sum(Yt)),p.reshape(ut.shape)}}},"BatchNormalization",{varianceEpsilon:z},Le).reshape(xe.shape)}function nc(_){return _==null?null:_.rank===0?_.as1D():_.rank===1?_:_.rank===2?_.as4D(1,1,_.shape[0],_.shape[1]):_.rank===3?_.as4D(1,_.shape[0],_.shape[1],_.shape[2]):_}function bc(){bd("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var Ev=Lt({batchNormalization2d_:function(_,v,d,y,C,z){return y===void 0&&(y=.001),bc(),Df(_,v,d,z,C,y)}}),pm=Lt({batchNormalization3d_:function(_,v,d,y,C,z){return y===void 0&&(y=.001),bc(),Nf(_,v,d,z,C,y)}}),f0=Lt({batchNormalization4d_:function(_,v,d,y,C,z){return y===void 0&&(y=.001),bc(),_v(_,v,d,z,C,y)}}),W1=Lt({batchNormalization_:function(_,v,d,y,C,z){return y===void 0&&(y=.001),bc(),sg(_,v,d,z,C,y)}}),Fy=Lt({batchNorm_:sg}),If=Lt({batchNorm2d_:Df}),Yh=Lt({batchNorm3d_:Nf}),Ld=Lt({batchNorm4d_:_v}),Bd=Lt({logicalAnd_:function(_,v){var d=Ze(_,"a","logicalAnd","bool"),y=Ze(v,"b","logicalAnd","bool");return io(d.shape,y.shape),He.runKernelFunc(function(C){return C.logicalAnd(d,y)},{a:d,b:y},null,"LogicalAnd")}}),Sv=Lt({logicalNot_:function(_){var v=Ze(_,"x","logicalNot","bool");return He.runKernelFunc(function(d){return d.logicalNot(v)},{$x:v})}}),d0=Lt({logicalOr_:function(_,v){var d=Ze(_,"a","logicalOr","bool"),y=Ze(v,"b","logicalOr","bool");return io(d.shape,y.shape),He.runKernelFunc(function(C){return C.logicalOr(d,y)},{$a:d,$b:y})}}),jd=Lt({logicalXor_:function(_,v){var d=Ze(_,"a","logicalXor","bool"),y=Ze(v,"b","logicalXor","bool");return io(d.shape,y.shape),d0(_,v).logicalAnd(Bd(_,v).logicalNot())}}),go=Lt({where_:function(_,v,d){var y=Ze(v,"a","where"),C=Ze(d,"b","where"),z=Ze(_,"condition","where","bool");return yt(y.shape,C.shape,"Error in where: "),z.rank===1?we(z.shape[0]===y.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):yt(z.shape,C.shape,"Error in where: "),He.runKernelFunc(function(Z,re){var fe=Z.select(z,y,C);return re([z]),fe},{$condition:z,$a:y,$b:C},function(Z,re){var fe=re[0];return{$condition:function(){return vi(fe).toFloat()},$a:function(){return Z.mul(fe.cast(Z.dtype))},$b:function(){return Z.mul(fe.logicalNot().cast(Z.dtype))}}})}}),Ff=function(_){return D(this,void 0,void 0,function(){var v,d,y;return R(this,function(C){switch(C.label){case 0:return[4,(v=Ze(_,"condition","whereAsync","bool")).data()];case 1:return d=C.sent(),y=ne(v.shape,d),_!==v&&v.dispose(),[2,y]}})})},Jh=Lt({add_:function(_,v){var d,y=Ze(_,"a","add"),C=Ze(v,"b","add");d=Zt(y,C),y=d[0],C=d[1];var z=io(y.shape,C.shape);return He.runKernelFunc(function(Z){return Z.add(y,C)},{a:y,b:C},function(Z){return{a:function(){var re=Z,fe=Na(y.shape,z);return fe.length>0&&(re=re.sum(fe)),re.reshape(y.shape)},b:function(){var re=Z,fe=Na(C.shape,z);return fe.length>0&&(re=re.sum(fe)),re.reshape(C.shape)}}},"Add")}}),Ry=Lt({addN_:function(_){we(Array.isArray(_),function(){return"The argument passed to tf.addN() must be a list of tensors"}),we(_.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+_.length});var v=_.map(function(C,z){return Ze(C,"tensors"+z,"addN")}),d=v[0];v.forEach(function(C){if(C.dtype!==d.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),v.forEach(function(C){if(!Ut(C.shape,d.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var y=v;return He.runKernelFunc(function(C){return C.addN(v)},y,function(C){var z={};return v.forEach(function(Z,re){z[re]=function(){return C.clone()}}),z},"AddN")}}),Py=Lt({addStrict_:function(_,v){var d=Ze(_,"a","addStrict"),y=Ze(v,"b","addStrict");return yt(d.shape,y.shape,"Error in addStrict: "),d.add(y)}}),ug=Lt({atan2_:function(_,v){var d,y=Ze(_,"a","atan2"),C=Ze(v,"b","atan2");d=Zt(y,C),y=d[0],C=d[1];var z=io(y.shape,C.shape);return He.runKernelFunc(function(Z,re){var fe=Z.atan2(y,C);return re([y,C]),fe},{$a:y,$b:C},function(Z,re){var fe=re[0],xe=re[1];return{$a:function(){var Oe=Jh(fe.square(),xe.square()),Re=Z.mul(xe.div(Oe)),Le=Na(fe.shape,z);return Le.length>0&&(Re=Re.sum(Le)),Re.reshape(fe.shape)},$b:function(){var Oe=Jh(fe.square(),xe.square()),Re=yv(Z.mul(fe.div(Oe))),Le=Na(xe.shape,z);return Le.length>0&&(Re=Re.sum(Le)),Re.reshape(xe.shape)}}})}}),Rf=Lt({div_:function(_,v){var d,y=Ze(_,"a","div"),C=Ze(v,"b","div");if(d=Zt(y,C),y=d[0],C=d[1],y.dtype==="int32"&&C.dtype==="int32")return Qh(y,C);var z=io(y.shape,C.shape);return He.runKernelFunc(function(Z,re){var fe=Z.realDivide(y,C);return re([y,C]),fe},{a:y,b:C},function(Z,re){var fe=re[0],xe=re[1];return{a:function(){var Oe=Z.div(xe.toFloat()),Re=Na(fe.shape,z);return Re.length>0?Oe.sum(Re).reshape(fe.shape):Oe},b:function(){var Oe=Z.mul(fe.toFloat()),Re=Na(xe.shape,z);Re.length>0&&(Oe=Oe.sum(Re).reshape(xe.shape));var Le=xe.square();return Oe.div(Le.toFloat()).neg()}}},"Div")}}),Gl=Lt({divNoNan_:function(_,v){var d,y=Ze(_,"a","div"),C=Ze(v,"b","div");y=(d=Zt(y,C))[0],C=d[1];var z=Rf(y,C),Z=vi(z),re=C.equal(Z);return go(re,Z,z)}}),mm=Lt({divStrict_:function(_,v){var d=Ze(_,"a","div"),y=Ze(v,"b","div");return yt(d.shape,y.shape,"Error in divideStrict: "),d.div(y)}}),Qh=Lt({floorDiv_:function(_,v){var d,y=Ze(_,"a","floorDiv"),C=Ze(v,"b","floorDiv");d=Zt(y,C),y=d[0],C=d[1];var z=io(y.shape,C.shape);return He.runKernelFunc(function(Z,re){var fe=Z.floorDiv(y,C);return re([y,C]),fe},{a:y,b:C},function(Z,re){var fe=re[0],xe=re[1];return{a:function(){var Oe=Z.div(xe.toFloat()),Re=Na(fe.shape,z);return Re.length>0?Oe.sum(Re).reshape(fe.shape):Oe},b:function(){var Oe=Z.mul(fe.toFloat()),Re=Na(xe.shape,z);Re.length>0&&(Oe=Oe.sum(Re).reshape(xe.shape));var Le=xe.square();return Oe.div(Le.toFloat()).neg()}}},"FloorDiv")}}),zd=Lt({maximum_:function(_,v){var d,y=Ze(_,"a","maximum"),C=Ze(v,"b","maximum");return d=Zt(y,C),y=d[0],C=d[1],y.dtype==="bool"&&(y=y.toInt(),C=C.toInt()),io(y.shape,C.shape),He.runKernelFunc(function(z,Z){var re=z.maximum(y,C);return Z([y,C]),re},{a:y,b:C},function(z,Z){var re=Z[0],fe=Z[1];return{a:function(){return z.mul(re.greaterEqual(fe).toFloat())},b:function(){return z.mul(re.less(fe).toFloat())}}},"Maximum")}}),Pf=Lt({maximumStrict_:function(_,v){var d=Ze(_,"a","maximumStrict"),y=Ze(v,"b","maximumStrict");return yt(d.shape,y.shape,"Error in maximumStrict: "),d.maximum(y)}}),Lf=Lt({minimum_:function(_,v){var d,y=Ze(_,"a","minimum"),C=Ze(v,"b","minimum");return d=Zt(y,C),y=d[0],C=d[1],y.dtype==="bool"&&(y=y.toInt(),C=C.toInt()),io(y.shape,C.shape),He.runKernelFunc(function(z,Z){var re=z.minimum(y,C);return Z([y,C]),re},{a:y,b:C},function(z,Z){var re=Z[0],fe=Z[1];return{a:function(){return z.mul(re.lessEqual(fe).toFloat())},b:function(){return z.mul(re.greater(fe).toFloat())}}},"Minimum")}}),rc=Lt({minimumStrict_:function(_,v){var d=Ze(_,"a","minimumStrict"),y=Ze(v,"b","minimumStrict");return yt(d.shape,y.shape,"Error in minimumStrict: "),d.minimum(y)}}),Zh=Lt({mod_:function(_,v){var d,y=Ze(_,"a","mod"),C=Ze(v,"b","mod");d=Zt(y,C),y=d[0],C=d[1];var z=io(y.shape,C.shape);return He.runKernelFunc(function(Z,re){var fe=Z.mod(y,C);return re([y,C]),fe},{$a:y,$b:C},function(Z,re){var fe=re[0],xe=re[1];return{$a:function(){var Oe=Na(fe.shape,z);return Oe.length>0?Z.sum(Oe).reshape(fe.shape):Z},$b:function(){var Oe=Z.mul(fe.div(xe).floor().neg()),Re=Na(xe.shape,z);return Re.length>0?Oe.sum(Re).reshape(xe.shape):Oe}}})}}),Ud=Lt({modStrict_:function(_,v){var d=Ze(_,"a","modStrict"),y=Ze(v,"b","modStrict");return yt(d.shape,y.shape,"Error in modStrict: "),d.mod(y)}}),ql=Lt({mul_:function(_,v){var d,y=Ze(_,"a","mul"),C=Ze(v,"b","mul");d=Zt(y,C),y=d[0],C=d[1];var z=io(y.shape,C.shape);return He.runKernelFunc(function(Z,re){var fe=Z.multiply(y,C);return re([y,C]),fe},{a:y,b:C},function(Z,re){var fe=re[0],xe=re[1];return{a:function(){var Oe=Z.mul(xe.toFloat()),Re=Na(fe.shape,z);return Re.length>0?Oe.sum(Re).reshape(fe.shape):Oe},b:function(){var Oe=Z.mul(fe.toFloat()),Re=Na(xe.shape,z);return Re.length>0?Oe.sum(Re).reshape(xe.shape):Oe}}},"Mul")}}),dl=Lt({mulStrict_:function(_,v){var d=Ze(_,"a","mul"),y=Ze(v,"b","mul");return yt(d.shape,y.shape,"Error in multiplyStrict: "),d.mul(y)}}),Wd=Lt({pow_:function(_,v){var d,y=Ze(_,"base","pow"),C=Ze(v,"exp","pow");d=Zt(y,C),y=d[0],C=d[1];var z=io(y.shape,C.shape),Z=[y,C];return He.runKernelFunc(function(re,fe){var xe=re.pow(y,C);return fe([y,C,xe]),xe},{a:y,b:C},function(re,fe){var xe=fe[0],Oe=fe[1],Re=fe[2];return{a:function(){var Le=Oe.toFloat(),Be=re.mul(Le.mul(xe.pow(Le.sub(Ar(1))))),Xe=Na(xe.shape,z);return Xe.length>0&&(Be=Be.sum(Xe)),Be.reshape(xe.shape)},b:function(){var Le=xe.greater(0),Be=xe.log().where(Le,vi(xe)),Xe=re.mul(Re.mul(Be)),nt=Na(Oe.shape,z);return nt.length>0&&(Xe=Xe.sum(nt)),Xe.reshape(Oe.shape)}}},"Pow",{},Z,[!0])}}),cg=Lt({powStrict_:function(_,v){return yt(_.shape,v.shape,"Error in powStrict: "),_.pow(v)}}),Vd=Lt({squaredDifferenceStrict_:function(_,v){var d=Ze(_,"a","squaredDifferenceStrict"),y=Ze(v,"b","squaredDifferenceStrict");return yt(d.shape,y.shape,"Error in squaredDifferenceStrict: "),d.squaredDifference(y)}}),hl=Lt({sub_:function(_,v){var d,y=Ze(_,"a","sub"),C=Ze(v,"b","sub");d=Zt(y,C),y=d[0],C=d[1];var z=io(y.shape,C.shape);return He.runKernelFunc(function(Z){return Z.subtract(y,C)},{a:y,b:C},function(Z){return{a:function(){var re=Z,fe=Na(y.shape,z);return fe.length>0&&(re=re.sum(fe)),re.reshape(y.shape)},b:function(){var re=Z,fe=Na(C.shape,z);return fe.length>0&&(re=re.sum(fe)),re.neg().reshape(C.shape)}}},"Sub")}}),ps=Lt({subStrict_:function(_,v){var d=Ze(_,"a","subStrict"),y=Ze(v,"b","subStrict");return yt(d.shape,y.shape,"Error in subStrict: "),d.sub(y)}}),Uc=Lt({equal_:function(_,v){var d,y=Ze(_,"a","equal"),C=Ze(v,"b","equal");return d=Zt(y,C),y=d[0],C=d[1],io(y.shape,C.shape),He.runKernelFunc(function(z){return z.equal(y,C)},{$a:y,$b:C})}}),ic=Lt({equalStrict_:function(_,v){var d=Ze(_,"a","equalStrict"),y=Ze(v,"b","equalStrict");return yt(d.shape,y.shape,"Error in equalStrict: "),d.equal(y)}}),Ru=Lt({greater_:function(_,v){var d,y=Ze(_,"a","greater"),C=Ze(v,"b","greater");return d=Zt(y,C),y=d[0],C=d[1],io(y.shape,C.shape),He.runKernelFunc(function(z){return z.greater(y,C)},{a:y,b:C},null,"Greater")}}),ep=Lt({greaterEqual_:function(_,v){var d,y=Ze(_,"a","greaterEqual"),C=Ze(v,"b","greaterEqual");return d=Zt(y,C),y=d[0],C=d[1],io(y.shape,C.shape),He.runKernelFunc(function(z,Z){var re=z.greaterEqual(y,C);return Z([y,C]),re},{a:y,b:C},function(z,Z){var re=Z[0],fe=Z[1];return{a:function(){return vi(re)},b:function(){return vi(fe)}}},"GreaterEqual")}}),lg=Lt({greaterEqualStrict_:function(_,v){var d=Ze(_,"a","greaterEqualStrict"),y=Ze(v,"b","greaterEqualStrict");return yt(d.shape,y.shape,"Error in greaterEqualStrict: "),d.greaterEqual(y)}}),h0=Lt({greaterStrict_:function(_,v){var d=Ze(_,"a","greaterStrict"),y=Ze(v,"b","greaterStrict");return yt(d.shape,y.shape,"Error in greaterStrict: "),d.greater(y)}}),p0=Lt({less_:function(_,v){var d,y=Ze(_,"a","less"),C=Ze(v,"b","less");return d=Zt(y,C),y=d[0],C=d[1],io(y.shape,C.shape),He.runKernelFunc(function(z){return z.less(y,C)},{a:y,b:C},null,"Less")}}),gm=Lt({lessEqual_:function(_,v){var d,y=Ze(_,"a","lessEqual"),C=Ze(v,"b","lessEqual");return d=Zt(y,C),y=d[0],C=d[1],io(y.shape,C.shape),He.runKernelFunc(function(z,Z){var re=z.lessEqual(y,C);return Z([y,C]),re},{a:y,b:C},null,"LessEqual")}}),Vo=Lt({lessEqualStrict_:function(_,v){var d=Ze(_,"a","lessEqualStrict"),y=Ze(v,"b","lessEqualStrict");return yt(d.shape,y.shape,"Error in lessEqualStrict: "),d.lessEqual(y)}}),vm=Lt({lessStrict_:function(_,v){var d=Ze(_,"a","lessStrict"),y=Ze(v,"b","lessStrict");return yt(d.shape,y.shape,"Error in lessStrict: "),d.less(y)}}),Wc=Lt({notEqual_:function(_,v){var d,y=Ze(_,"a","notEqual"),C=Ze(v,"b","notEqual");return d=Zt(y,C),y=d[0],C=d[1],io(y.shape,C.shape),He.runKernelFunc(function(z){return z.notEqual(y,C)},{a:y,b:C},null,"NotEqual")}}),Hd=Lt({notEqualStrict_:function(_,v){var d=Ze(_,"a","notEqualStrict"),y=Ze(v,"b","notEqualStrict");return yt(d.shape,y.shape,"Error in notEqualStrict: "),d.notEqual(y)}});function Gd(_,v){for(var d=[],y=_;y<v;++y)d.push(y);return d}function ym(_){for(var v=[],d=0;d<_.length;++d)for(var y=0;y<_[d].length;++y)v.push(_[d][y]);return v}var fg=Lt({gather_:function(_,v,d){d===void 0&&(d=0);var y=Ze(_,"x","gather"),C=Ze(v,"indices","gather","int32");d=Xt(d,y.shape)[0];var z=function(Z,re,fe){for(var xe=Z.shape[fe],Oe=[],Re=1,Le=1,Be=0;Be<fe;Be++)Oe.push(Z.shape[Be]),Re*=Z.shape[Be];for(Be=0;Be<re.rank;Be++)Oe.push(re.shape[Be]);for(Be=fe+1;Be<Z.rank;Be++)Oe.push(Z.shape[Be]),Le*=Z.shape[Be];return{batchSize:Re,sliceSize:Le,dimSize:xe,outputShape:Oe}}(y,C,d);return He.runKernelFunc(function(Z,re){var fe=Z.gather(y,C.flatten(),d);return re([C]),fe},{x:y,indices:C},function(Z,re){var fe=re[0];return{x:function(){var xe=y.shape,Oe=fe.size,Re=xe.slice(0,d),Le=Re.length,Be=xe.slice(d,xe.length).slice(1),Xe=Be.length,nt=Gd(0,Le),tt=Gd(Le+1,Le+1+Xe),ut=ym([Re,[Oe],Be]),Nt=Z.reshape(ut),Pt=fe.reshape([Oe]),jt=ym([[Le],nt,tt]),Yt=Nt.transpose(jt),gn=dg(Yt,Pt,y.shape[d]),wn=$u(jt);return gn.transpose(wn)},indices:function(){return fe}}},"Gather",{axis:d}).reshape(z.outputShape)}}),dg=Lt({unsortedSegmentSum_:function(_,v,d){var y=Ze(_,"x","unsortedSegmentSum"),C=Ze(v,"segmentIds","unsortedSegmentSum","int32");return we(Ft(d),function(){return"numSegments must be of dtype int"}),He.runKernelFunc(function(z,Z){var re=z.unsortedSegmentSum(y,C,d);return Z([C]),re},{$x:y},function(z,Z){var re=Z[0];return{$x:function(){return function(fe,xe){for(var Oe=zd(xe,vi(xe)),Re=fg(fe,Oe),Le=ep(xe,Ar(0,"int32")),Be=Re.rank-Le.rank,Xe=0;Xe<Be;++Xe)Le=Xo(Le,Xe+1);Le=Bd(Le,Fu(Re.shape,"bool"));var nt=vi(Re);return go(Le,Re,nt)}(z,re)}}})}}),hg=function(_,v,d){return D(this,void 0,void 0,function(){var y,C,z,Z,re,fe,xe,Oe,Re,Le,Be,Xe,nt;return R(this,function(tt){switch(tt.label){case 0:for(y=Ze(_,"tensor","boolMask"),C=Ze(v,"mask","boolMask","bool"),z=d??0,Z=C.rank,re=y.shape,we(Z>0,function(){return"mask cannot be scalar"}),yt(re.slice(z,z+Z),C.shape,"mask's shape must match the first K dimensions of tensor's shape,"),fe=1,xe=z;xe<z+Z;xe++)fe*=re[xe];return Oe=re.slice(0,z).concat([fe],re.slice(z+Z)),Re=y.reshape(Oe),Le=C.reshape([-1]),[4,Ff(Le)];case 1:return Be=tt.sent(),Xe=Be.squeeze([1]),nt=fg(Re,Xe,z),_!==y&&y.dispose(),v!==C&&C.dispose(),Xe.dispose(),Re.dispose(),Le.dispose(),Be.dispose(),[2,nt]}})})};function Cv(_,v,d,y,C,z,Z){z===void 0&&(z="NHWC"),we(_.length===v.rank,function(){return"Length of inShape ("+_.length+") and rank of dy ("+v.rank+") must match"});var re=_,fe=v,xe=!1;v.rank===3&&(xe=!0,fe=v.as4D(1,v.shape[0],v.shape[1],v.shape[2]),re=[1,_[0],_[1],_[2]]),we(re.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+re.length+"."}),we(fe.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+fe.rank}),we(d.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+d.rank});var Oe=z==="NHWC"?re[3]:re[1],Re=z==="NHWC"?fe.shape[3]:fe.shape[1];we(Oe===d.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+Oe+") must match input depth for filter "+d.shape[2]+"."}),we(Re===d.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+Re+") must match output depth for filter "+d.shape[3]+"."}),Z!=null&&we(Ft(C),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+Z+" but got pad "+C+"."});var Le=aa(z),Be=cu(re,d.shape,y,1,C,Z,!1,Le),Xe=He.runKernelFunc(function(nt,tt){var ut=nt.conv2dDerInput(fe,d,Be);return tt([d,fe]),ut},{dy4D:fe,filter:d},function(nt,tt){var ut=tt[0],Nt=tt[1];return{dy4D:function(){return tp(nt,ut,y,C,z,1,Z)},filter:function(){return m0(nt,Nt,ut.shape,y,C,z,Z)}}});return xe?Xe.as3D(Xe.shape[1],Xe.shape[2],Xe.shape[3]):Xe}function pg(_){var v=function(z){return typeof z=="number"?[z,z,z]:z.length===2?[z[0],z[1],1]:z}(_),d=v[0],y=v[1],C=v[2];return d===1&&y===1&&C===1}function Bf(_,v,d,y,C){we(_.length===v.rank,function(){return"Length of inShape ("+_.length+") and rank of dy ("+v.rank+") must match"});var z=_,Z=v,re=!1;v.rank===4&&(re=!0,Z=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3]),z=[1,_[0],_[1],_[2],_[3]]);var fe=z[4],xe=Z.shape[4];we(z.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+z.length+"."}),we(Z.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+Z.rank}),we(d.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+d.rank}),we(fe===d.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+fe+") must match input depth for filter "+d.shape[3]+"."}),we(xe===d.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+xe+") must match output depth for filter "+d.shape[4]+"."});var Oe=Lc(z,d.shape,y,1,C),Re=He.runKernelFunc(function(Le){return Le.conv3dDerInput(Z,d,Oe)},{dy5D:Z});return re?Re.as4D(Re.shape[1],Re.shape[2],Re.shape[3],Re.shape[4]):Re}var mg=Lt({conv1d_:function(_,v,d,y,C,z,Z){C===void 0&&(C="NWC"),z===void 0&&(z=1);var re=Ze(_,"x","conv1d"),fe=Ze(v,"filter","conv1d"),xe=re,Oe=!1;re.rank===2&&(Oe=!0,xe=re.as3D(1,re.shape[0],re.shape[1])),we(xe.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+xe.rank+"."}),we(fe.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+fe.rank+"."}),Z!=null&&we(Ft(y),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+Z+" but got pad "+y+"."}),we(xe.shape[2]===fe.shape[1],function(){return"Error in conv1d: depth of input ("+xe.shape[2]+") must match input depth for filter "+fe.shape[1]+"."}),we(Ss(d,z),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+d+" and dilation '"+z+"'"}),we(C==="NWC",function(){return"Error in conv1d: got dataFormat of "+C+" but only NWC is currently supported."});var Re=fe.as4D(1,fe.shape[0],fe.shape[1],fe.shape[2]),Le=xe.as4D(xe.shape[0],1,xe.shape[1],xe.shape[2]),Be=tp(Le,Re,[1,d],y,"NHWC",[1,z],Z);return Oe?Be.as2D(Be.shape[2],Be.shape[3]):Be.as3D(Be.shape[0],Be.shape[2],Be.shape[3])}}),tp=Lt({conv2d_:function(_,v,d,y,C,z,Z){C===void 0&&(C="NHWC"),z===void 0&&(z=[1,1]);var re=Ze(_,"x","conv2d"),fe=Ze(v,"filter","conv2d"),xe=re,Oe=!1;re.rank===3&&(Oe=!0,xe=re.as4D(1,re.shape[0],re.shape[1],re.shape[2])),we(xe.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+xe.rank+"."}),we(fe.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+fe.rank+"."}),Z!=null&&we(Ft(y),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+Z+" but got pad "+y+"."});var Re=C==="NHWC"?xe.shape[3]:xe.shape[1];we(Re===fe.shape[2],function(){return"Error in conv2d: depth of input ("+Re+") must match input depth for filter "+fe.shape[2]+"."}),we(Ss(d,z),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+d+" and dilations '"+z+"'"});var Le=aa(C),Be=cu(xe.shape,fe.shape,d,z,y,Z,!1,Le),Xe=[fe,xe],nt=He.runKernelFunc(function(tt,ut){var Nt=tt.conv2d(xe,fe,Be);return ut([fe,xe]),Nt},{x:xe,filter:fe},function(tt,ut){var Nt=ut,Pt=Nt[0],jt=Nt[1];return we(Ua(z),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+z+"'"}),{x:function(){return g0(jt.shape,tt,Pt,d,y,C)},filter:function(){return m0(jt,tt,Pt.shape,d,y,C)}}},"Conv2D",Be,Xe);return Oe?nt.as3D(nt.shape[1],nt.shape[2],nt.shape[3]):nt}}),gg=Lt({conv3d_:function(_,v,d,y,C,z){C===void 0&&(C="NDHWC"),z===void 0&&(z=[1,1,1]);var Z=Ze(_,"x","conv3d"),re=Ze(v,"filter","conv3d"),fe=Z,xe=!1;Z.rank===4&&(xe=!0,fe=Z.as5D(1,Z.shape[0],Z.shape[1],Z.shape[2],Z.shape[3])),we(fe.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+fe.rank+"."}),we(re.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+re.rank+"."}),we(fe.shape[4]===re.shape[3],function(){return"Error in conv3d: depth of input ("+fe.shape[4]+") must match input depth for filter "+re.shape[3]+"."}),we(function(Le,Be){return pg(d)||pg(Be)}(0,z),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+d+" and dilations '"+z+"'"}),we(C==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+C+" but only NDHWC is currently supported."});var Oe=Lc(fe.shape,re.shape,d,z,y),Re=He.runKernelFunc(function(Le,Be){var Xe=Le.conv3d(fe,re,Oe);return Be([fe,re]),Xe},{x:fe,$filter:re},function(Le,Be){we(pg(z),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+z+"'"});var Xe=Be[0],nt=Be[1];return{x:function(){return Bf(Xe.shape,Le,nt,d,y)},$filter:function(){return function(tt,ut,Nt,Pt,jt){var Yt=tt;tt.rank===4&&(Yt=tt.as5D(1,tt.shape[0],tt.shape[1],tt.shape[2],tt.shape[3]));var gn=ut;gn.rank===4&&(gn=ut.as5D(1,ut.shape[0],ut.shape[1],ut.shape[2],ut.shape[3])),we(Yt.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+Yt.shape+"."}),we(gn.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+gn.shape+"."}),we(Nt.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+Nt+"."}),we(Yt.shape[4]===Nt[3],function(){return"Error in conv3dDerFilter: depth of input "+Yt.shape[4]+") must match input depth in filter ("+Nt[3]+"."}),we(gn.shape[4]===Nt[4],function(){return"Error in conv3dDerFilter: depth of dy ("+gn.shape[4]+") must match output depth for filter ("+Nt[4]+")."});var wn=Lc(Yt.shape,Nt,Pt,1,jt);return He.runKernelFunc(function(vn){return vn.conv3dDerFilter(Yt,gn,wn)},{x5D:Yt,dy5D:gn})}(Xe,Le,nt.shape,d,y)}}});return xe?Re.as4D(Re.shape[1],Re.shape[2],Re.shape[3],Re.shape[4]):Re}}),m0=Lt({conv2dDerFilter_:function(_,v,d,y,C,z,Z){z===void 0&&(z="NHWC");var re=_;_.rank===3&&(re=_.as4D(1,_.shape[0],_.shape[1],_.shape[2]));var fe=v;fe.rank===3&&(fe=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),we(re.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+re.shape+"."}),we(fe.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+fe.shape+"."}),we(d.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+d+"."});var xe=z==="NHWC"?re.shape[3]:re.shape[1],Oe=z==="NHWC"?fe.shape[3]:fe.shape[1];we(xe===d[2],function(){return"Error in conv2dDerFilter: depth of input "+xe+") must match input depth in filter ("+d[2]+"."}),we(Oe===d[3],function(){return"Error in conv2dDerFilter: depth of dy ("+Oe+") must match output depth for filter ("+d[3]+")."}),Z!=null&&we(Ft(C),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+Z+" but got pad "+C+"."});var Re=aa(z),Le=cu(re.shape,d,y,1,C,Z,!1,Re);return He.runKernelFunc(function(Be){return Be.conv2dDerFilter(re,fe,Le)},{x4D:re,dy4D:fe})}}),g0=Lt({conv2dDerInput_:Cv}),bm=Lt({depthwiseConv2d_:function(_,v,d,y,C,z,Z){z===void 0&&(z=[1,1]);var re=Ze(_,"x","depthwiseConv2d"),fe=Ze(v,"filter","depthwiseConv2d"),xe=re,Oe=!1;re.rank===3&&(Oe=!0,xe=re.as4D(1,re.shape[0],re.shape[1],re.shape[2])),we(xe.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+xe.rank+"."}),we(fe.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+fe.rank+"."}),we(xe.shape[3]===fe.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+xe.shape[3]+") must match the inChannels dimension in filter "+fe.shape[2]+"."}),z==null&&(z=[1,1]),we(Ss(d,z),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+d+" and dilations '"+z+"'"}),Z!=null&&we(Ft(y),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+Z+" but got pad "+y+"."});var Re=cu(xe.shape,fe.shape,d,z,y,Z,!0),Le=[xe,fe],Be=He.runKernelFunc(function(Xe,nt){var tt=Xe.depthwiseConv2D(xe,fe,Re);return nt([xe,fe]),tt},{x:xe,filter:fe},function(Xe,nt){we(Ua(z),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+z+"'"});var tt=nt[0],ut=nt[1];return{x:function(){return v0(tt.shape,Xe,ut,Re)},filter:function(){return vg(tt,Xe,ut.shape,Re)}}},"DepthwiseConv2dNative",Re,Le);return Oe?Be.as3D(Be.shape[1],Be.shape[2],Be.shape[3]):Be}}),v0=Lt({depthwiseConv2dDerInput_:function(_,v,d,y){var C=v,z=!1;v.rank===3&&(z=!0,C=v.as4D(1,v.shape[0],v.shape[1],v.shape[2]));var Z=He.runKernelFunc(function(re){return re.depthwiseConv2DDerInput(C,d,y)},{dy4D:C});return z?Z.as3D(Z.shape[1],Z.shape[2],Z.shape[3]):Z}}),vg=Lt({depthwiseConv2dDerFilter_:function(_,v,d,y){var C=_;_.rank===3&&(C=_.as4D(1,_.shape[0],_.shape[1],_.shape[2]));var z=v;return z.rank===3&&(z=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),He.runKernelFunc(function(Z){return Z.depthwiseConv2DDerFilter(C,z,y)},{x4D:C,dy4D:z})}}),kv=Lt({separableConv2d_:function(_,v,d,y,C,z,Z){z===void 0&&(z=[1,1]),Z===void 0&&(Z="NHWC");var re=Ze(_,"x","separableConv2d"),fe=Ze(v,"depthwiseFilter","separableConv2d"),xe=Ze(d,"pointwiseFilter","separableConv2d"),Oe=re,Re=!1;if(re.rank===3&&(Re=!0,Oe=re.as4D(1,re.shape[0],re.shape[1],re.shape[2])),Z==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");we(Oe.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+Oe.rank+"."}),we(fe.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+fe.rank+"."}),we(xe.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+fe.rank+"."}),we(xe.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+xe.shape[0]+"."}),we(xe.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+xe.shape[1]+"."});var Le=fe.shape[2],Be=fe.shape[3];we(xe.shape[2]===Le*Be,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+Le*Be+", but got "+xe.shape[2]+"."});var Xe=bm(Oe,fe,y,C,Z,z),nt=tp(Xe,xe,1,"valid",Z);return Re?nt.as3D(nt.shape[1],nt.shape[2],nt.shape[3]):nt}}),$l=Lt({conv2dTranspose_:function(_,v,d,y,C,z){return Cv(d,Ze(_,"x","conv2dTranspose"),Ze(v,"filter","conv2dTranspose"),y,C,"NHWC",z)}}),Ly=Lt({conv3dTranspose_:function(_,v,d,y,C){return Bf(d,Ze(_,"x","conv3dTranspose"),Ze(v,"filter","conv3dTranspose"),y,C)}}),Av=Lt({matMul_:function(_,v,d,y){var C;d===void 0&&(d=!1),y===void 0&&(y=!1);var z=Ze(_,"a","matMul"),Z=Ze(v,"b","matMul");C=Zt(z,Z),z=C[0],Z=C[1];var re=d?z.shape[z.rank-2]:z.shape[z.rank-1],fe=y?Z.shape[Z.rank-1]:Z.shape[Z.rank-2],xe=d?z.shape[z.rank-1]:z.shape[z.rank-2],Oe=y?Z.shape[Z.rank-2]:Z.shape[Z.rank-1],Re=z.shape.slice(0,-2),Le=Z.shape.slice(0,-2),Be=ze(Re),Xe=ze(Le);we(z.rank>=2&&Z.rank>=2&&z.rank===Z.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+z.rank+" and "+Z.rank+"."}),we(Ut(Re,Le),function(){return"Error in matMul: outer dimensions ("+Re+") and ("+Le+") of Tensors with shapes "+z.shape+" and "+Z.shape+" must match."}),we(re===fe,function(){return"Error in matMul: inner shapes ("+re+") and ("+fe+") of Tensors with shapes "+z.shape+" and "+Z.shape+" and transposeA="+d+" and transposeB="+y+" must match."});var nt=z.shape.slice(0,-2).concat([xe,Oe]),tt=d?z.as3D(Be,re,xe):z.as3D(Be,xe,re),ut=y?Z.as3D(Xe,Oe,fe):Z.as3D(Xe,fe,Oe),Nt={transposeA:d,transposeB:y};return He.runKernelFunc(function(Pt,jt){var Yt=Pt.batchMatMul(tt,ut,d,y);return jt([tt,ut]),Yt},{a:tt,b:ut},function(Pt,jt){var Yt=jt,gn=Yt[0],wn=Yt[1];return d||y?!d&&y?{a:function(){return Pt.matMul(wn,!1,!1)},b:function(){return Pt.matMul(gn,!0,!1)}}:d&&!y?{a:function(){return wn.matMul(Pt,!1,!0)},b:function(){return gn.matMul(Pt,!1,!1)}}:{a:function(){return wn.matMul(Pt,!0,!0)},b:function(){return Pt.matMul(gn,!0,!0)}}:{a:function(){return Pt.matMul(wn,!1,!0)},b:function(){return gn.matMul(Pt,!0,!1)}}},"BatchMatMul",Nt).reshape(nt)}}),xm=Lt({dot_:function(_,v){var d=Ze(_,"t1","dot"),y=Ze(v,"t2","dot");we(!(d.rank!==1&&d.rank!==2||y.rank!==1&&y.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+d.rank+" and "+y.rank+"."});var C=d.rank===1?d.size:d.shape[1],z=y.rank===1?y.size:y.shape[0];return we(C===z,function(){return"Error in dot: inner dimensions of inputs must match, but got "+C+" and "+z+"."}),d.rank===1&&y.rank===1?d.as2D(1,-1).matMul(y.as2D(-1,1)).asScalar():d.rank===1&&y.rank===2?d.as2D(1,-1).matMul(y.as2D(y.shape[0],y.shape[1])).as1D():d.rank===2&&y.rank===1?d.matMul(y.as2D(-1,1)).as1D():d.matMul(y.as2D(y.shape[0],y.shape[1]))}}),Ov=Lt({outerProduct_:function(_,v){var d=Ze(_,"v1","outerProduct"),y=Ze(v,"v2","outerProduct");return we(d.rank===1&&y.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+d.rank+" and "+y.rank+"."}),d.as2D(-1,1).matMul(y.as2D(1,-1))}}),jf=Lt({reverse_:function(_,v){var d=Ze(_,"x","reverse");if(d.rank===0)return d.clone();var y=Xt(v,d.shape);return He.runKernelFunc(function(C){return C.reverse(d,y)},{$x:d},function(C){return{$x:function(){return C.reverse(y)}}}).reshapeAs(d)}}),Tv=Lt({reverse1d_:function(_){var v=Ze(_,"x","reverse");return we(v.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+v.rank+"."}),jf(v,0)}}),wm=Lt({reverse2d_:function(_,v){var d=Ze(_,"x","reverse");return we(d.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+d.rank+"."}),jf(d,v)}}),yg=Lt({reverse3d_:function(_,v){var d=Ze(_,"x","reverse");return we(d.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+d.rank+"."}),jf(d,v)}}),Mv=Lt({reverse4d_:function(_,v){var d=Ze(_,"x","reverse");return we(d.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+d.rank+"."}),jf(d,v)}});function Dv(_,v,d,y,C,z){var Z=Ze(_,"x","maxPool"),re=Z,fe=!1;Z.rank===3&&(fe=!0,re=Z.as4D(1,Z.shape[0],Z.shape[1],Z.shape[2])),y==null&&(y=[1,1]),we(re.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+re.rank+"."}),we(Ss(d,y),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+d+" and dilations '"+y+"'"}),z!=null&&we(Ft(C),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+z+" but got pad "+C+"."});var xe=Xu(re.shape,v,d,y,C,z);if(xe.filterWidth===1&&xe.filterHeight===1&&Ut(xe.inShape,xe.outShape))return Z.clone();var Oe=[re],Re=He.runKernelFunc(function(Le,Be){var Xe=Le.maxPool(re,xe);return Be([re,Xe]),Xe},{x:re},function(Le,Be){var Xe=Be[0],nt=Be[1];return{x:function(){return function(tt,ut,Nt,Pt,jt,Yt,gn,wn){var vn=Ze(tt,"dy","maxPoolBackprop"),Cn=Ze(ut,"input","maxPoolBackprop"),Dn=Ze(Nt,"output","maxPoolBackprop");we(Cn.rank===vn.rank,function(){return"Rank of input ("+Cn.rank+") does not match rank of dy ("+vn.rank+")"}),Yt==null&&(Yt=[1,1]),we(Ss(jt,Yt),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+jt+" and dilations '"+Yt+"'"}),we(vn.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+vn.rank+"."}),we(Cn.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+Cn.rank+"."});var b=Xu(Cn.shape,Pt,jt,Yt,gn,wn);return He.runKernelFunc(function(p){return p.maxPoolBackprop(vn,Cn,Dn,b)},{$dy:vn,$input:Cn})}(Le,Xe,nt,v,d,y,C)}}},"MaxPool",xe,Oe);return fe?Re.as3D(Re.shape[1],Re.shape[2],Re.shape[3]):Re}function y0(_,v,d,y,C,z){var Z=Ze(_,"x","avgPool","float32");y==null&&(y=[1,1]),we(Ss(d,y),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+d+" and dilations '"+y+"'"});var re=Z,fe=!1;Z.rank===3&&(fe=!0,re=Z.as4D(1,Z.shape[0],Z.shape[1],Z.shape[2])),we(re.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+re.rank+"."}),z!=null&&we(Ft(C),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+z+" but got pad "+C+"."});var xe=Xu(re.shape,v,d,y,C,z);if(xe.filterWidth===1&&xe.filterHeight===1&&Ut(xe.inShape,xe.outShape))return Z.clone();var Oe=He.runKernelFunc(function(Re){return Re.avgPool(re,xe)},{x:re},function(Re){return{x:function(){return function(Le,Be,Xe,nt,tt,ut){var Nt=Ze(Le,"dy","avgPoolBackprop"),Pt=Ze(Be,"input","avgPoolBackprop");we(Pt.rank===Nt.rank,function(){return"Rank of input ("+Pt.rank+") does not match rank of dy ("+Nt.rank+")"}),tt==null&&(tt=[1,1]),we(Ss(nt,tt),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+nt+" and dilations '"+tt+"'"});var jt=Pt,Yt=Nt,gn=!1;Pt.rank===3&&(gn=!0,jt=Pt.as4D(1,Pt.shape[0],Pt.shape[1],Pt.shape[2]),Yt=Nt.as4D(1,Nt.shape[0],Nt.shape[1],Nt.shape[2])),we(Yt.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+Yt.rank+"."}),we(jt.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+jt.rank+"."});var wn=Xu(jt.shape,Xe,nt,tt,ut),vn=He.runKernelFunc(function(Cn){return Cn.avgPoolBackprop(Yt,jt,wn)},{dy4D:Yt,input4D:jt});return gn?vn.as3D(vn.shape[1],vn.shape[2],vn.shape[3]):vn}(Re,re,v,d,y,C)}}},"AvgPool",xe);return Oe=Oe.cast(Z.dtype),fe?Oe.as3D(Oe.shape[1],Oe.shape[2],Oe.shape[3]):Oe}var Nv=Lt({maxPool_:function(_,v,d,y,C){return Dv(_,v,d,1,y,C)}}),Iv=Lt({avgPool_:function(_,v,d,y,C){return y0(_,v,d,1,y,C)}}),qd=Lt({pool_:function(_,v,d,y,C,z){C==null&&(C=[1,1]),z==null&&(z=1),y===0&&(y="valid");var Z=Ze(_,"x","maxPool"),re=Z,fe=!1;Z.rank===3&&(fe=!0,re=Z.as4D(1,Z.shape[0],Z.shape[1],Z.shape[2])),we(Ss(z,C),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+z+" and dilations '"+C+"'"});var xe,Oe=Xu(re.shape,v,z,C,y),Re=[Oe.dilationHeight,Oe.dilationWidth];xe=y==="same"?function(jt,Yt){var gn=jt.map(function(Cn,Dn){return Cn+(Cn-1)*(Yt[Dn]-1)}).map(function(Cn){return Cn-1}),wn=gn.map(function(Cn){return Math.floor(Cn/2)}),vn=gn.map(function(Cn,Dn){return Cn-wn[Dn]});return gn.map(function(Cn,Dn){return[wn[Dn],vn[Dn]]})}([Oe.filterHeight,Oe.filterWidth],Re):[[0,0],[0,0]];var Le=Re[0]===1&&Re[1]===1,Be=function(jt,Yt,gn){var wn=gn.map(function(p){return p[0]}),vn=gn.map(function(p){return p[1]}),Cn=jt.concat(wn,vn),Dn=Yt.map(function(p,l){return(p-Cn[l]%p)%p}),b=vn.map(function(p,l){return p+Dn[l]});return[Yt.map(function(p,l){return[wn[l],b[l]]}),Yt.map(function(p,l){return[0,Dn[l]]})]}([Oe.inHeight,Oe.inWidth],Re,xe),Xe=Be[0],nt=Be[1],tt=Le?y:"valid",ut=Le?re:za(re,Re,Xe),Nt=(d==="avg"?function(){return y0(ut,v,z,1,tt)}:function(){return Dv(ut,v,z,1,tt)})(),Pt=Le?Nt:Il(Nt,Re,nt);return fe?Pt.as3D(Pt.shape[1],Pt.shape[2],Pt.shape[3]):Pt}}),By=Lt({maxPool3d_:function(_,v,d,y,C,z,Z){z===void 0&&(z="NDHWC");var re=Ze(_,"x","maxPool3d"),fe=re,xe=!1;re.rank===4&&(xe=!0,fe=re.as5D(1,re.shape[0],re.shape[1],re.shape[2],re.shape[3])),Z==null&&(Z=[1,1,1]),we(fe.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+fe.rank+"."}),we(z==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+z}),we(Ss(d,Z),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+d+" and dilations '"+Z+"'"}),C!=null&&we(Ft(y),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+C+" but got pad "+y+"."});var Oe=Pc(fe.shape,v,d,Z,y,C,z),Re=He.runKernelFunc(function(Le,Be){var Xe=Le.maxPool3d(fe,Oe);return Be([fe,Xe]),Xe},{x:fe},function(Le,Be){var Xe=Be[0],nt=Be[1];return{x:function(){return function(tt,ut,Nt,Pt,jt,Yt,gn,wn){var vn=Ze(tt,"dy","maxPool3dBackprop"),Cn=Ze(ut,"input","maxPool3dBackprop"),Dn=Ze(Nt,"output","maxPool3dBackprop"),b=vn,p=Cn,l=Dn,m=!1;Cn.rank===4&&(m=!0,b=vn.as5D(1,vn.shape[0],vn.shape[1],vn.shape[2],vn.shape[3]),p=Cn.as5D(1,Cn.shape[0],Cn.shape[1],Cn.shape[2],Cn.shape[3]),l=Dn.as5D(1,Dn.shape[0],Dn.shape[1],Dn.shape[2],Dn.shape[3])),we(b.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+b.rank+"."}),we(p.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+p.rank+"."}),we(l.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+l.rank+"."}),Yt==null&&(Yt=[1,1,1]),we(Ss(jt,Yt),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+jt+" and dilations '"+Yt+"'"}),wn!=null&&we(Ft(gn),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+wn+" but got pad "+gn+"."});var w=Pc(p.shape,Pt,jt,Yt,gn,wn),P=He.runKernelFunc(function(K){return K.maxPool3dBackprop(b,p,l,w)},{dy5D:b,input5D:p});return m?P.as4D(P.shape[1],P.shape[2],P.shape[3],P.shape[4]):P}(Le,Xe,nt,v,d,Z,y,C)}}});return xe?Re.as4D(Re.shape[1],Re.shape[2],Re.shape[3],Re.shape[4]):Re}}),Fv=Lt({avgPool3d_:function(_,v,d,y,C,z,Z){z===void 0&&(z="NDHWC");var re=Ze(_,"x","avgPool3d","float32"),fe=re,xe=!1;re.rank===4&&(xe=!0,fe=re.as5D(1,re.shape[0],re.shape[1],re.shape[2],re.shape[3])),Z==null&&(Z=[1,1,1]),we(fe.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+fe.rank+"."}),we(z==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+z}),we(Ss(d,Z),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+d+" and dilations '"+Z+"'"}),C!=null&&we(Ft(y),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+C+" but got pad "+y+"."});var Oe=Pc(fe.shape,v,d,Z,y,C,z),Re=He.runKernelFunc(function(Le){return Le.avgPool3d(fe,Oe)},{x:fe},function(Le){return{x:function(){return function(Be,Xe,nt,tt,ut,Nt,Pt){var jt=Ze(Be,"dy","avgPool3dBackprop"),Yt=Ze(Xe,"input","avgPool3dBackprop"),gn=jt,wn=Yt,vn=!1;Yt.rank===4&&(vn=!0,gn=jt.as5D(1,jt.shape[0],jt.shape[1],jt.shape[2],jt.shape[3]),wn=Yt.as5D(1,Yt.shape[0],Yt.shape[1],Yt.shape[2],Yt.shape[3])),we(gn.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+gn.rank+"."}),we(wn.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+wn.rank+"."}),ut==null&&(ut=[1,1,1]),we(Ss(tt,ut),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+tt+" and dilations '"+ut+"'"}),Pt!=null&&we(Ft(Nt),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+Pt+" but got pad "+Nt+"."});var Cn=Pc(wn.shape,nt,tt,ut,Nt,Pt),Dn=He.runKernelFunc(function(b){return b.avgPool3dBackprop(gn,wn,Cn)},{dy5D:gn,input5D:wn});return vn?Dn.as4D(Dn.shape[1],Dn.shape[2],Dn.shape[3],Dn.shape[4]):Dn}(Le,fe,v,d,Z,y,C)}}});return Re=Re.cast(fe.dtype),xe?Re.as4D(Re.shape[1],Re.shape[2],Re.shape[3],Re.shape[4]):Re}}),Xl=Lt({slice_:function(_,v,d){var y,C,z=Ze(_,"x","slice");if(z.rank===0)throw new Error("Slicing scalar is not possible");(y=typeof v=="number"?[v].concat(new Array(z.rank-1).fill(0)):v.length<z.rank?v.concat(new Array(z.rank-v.length).fill(0)):v.slice()).forEach(function(fe){we(fe!==-1,function(){return"slice() does not support negative begin indexing."})}),C=(C=d==null?new Array(z.rank).fill(-1):typeof d=="number"?[d].concat(new Array(z.rank-1).fill(-1)):d.length<z.rank?d.concat(new Array(z.rank-d.length).fill(-1)):d).map(function(fe,xe){return fe>=0?fe:(we(fe===-1,function(){return"Negative size values should be exactly -1 but got "+fe+" for the slice() size at index "+xe+"."}),z.shape[xe]-y[xe])}),Wh(z,y,C);var Z=z.shape,re={begin:y,size:C};return He.runKernelFunc(function(fe){return fe.slice(z,y,C)},{x:z},function(fe){for(var xe=[],Oe=0;Oe<fe.rank;Oe++)xe.push([y[Oe],Z[Oe]-y[Oe]-C[Oe]]);return{x:function(){return fe.pad(xe)}}},"Slice",re)}}),b0=Lt({slice1d_:function(_,v,d){var y=Ze(_,"x","slice1d");return we(y.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+y.rank+" tensor"}),Xl(y,[v],[d])}}),Rv=Lt({slice2d_:function(_,v,d){var y=Ze(_,"x","slice2d");return we(y.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+y.rank+" tensor"}),Xl(y,v,d)}}),$d=Lt({slice3d_:function(_,v,d){var y=Ze(_,"x","slice3d");return we(y.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+y.rank+" tensor"}),Xl(y,v,d)}}),Kl=Lt({slice4d_:function(_,v,d){var y=Ze(_,"x","slice4d");return we(y.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+y.rank+" tensor"}),Xl(y,v,d)}});function bg(_,v,d,y,C){return v.rank<d.rank&&(v=v.reshape(Lo(v.shape,y))),_.rank<d.rank&&(_=_.reshape(Lo(_.shape,y))),{x:function(){var z=_.mul(d.equal(v).cast(_.dtype));return C==null?z:z.transpose(C)}}}var x0=Lt({all_:function(_,v,d){v===void 0&&(v=null),d===void 0&&(d=!1);var y=Ze(_,"x","all","bool"),C=Xt(v,y.shape),z=C,Z=Ba(z,y.rank);Z!=null&&(y=y.transpose(Z),z=ja(z.length,y.rank));var re=He.runKernelFunc(function(xe){return xe.all(y,z)},{$x:y});if(d){var fe=Lo(re.shape,C);return re.reshape(fe)}return re}}),Vc=Lt({any_:function(_,v,d){v===void 0&&(v=null),d===void 0&&(d=!1);var y=Ze(_,"x","any","bool"),C=Xt(v,y.shape),z=C,Z=Ba(z,y.rank);Z!=null&&(y=y.transpose(Z),z=ja(z.length,y.rank));var re=He.runKernelFunc(function(xe){return xe.any(y,z)},{$x:y});if(d){var fe=Lo(re.shape,C);return re.reshape(fe)}return re}}),w0=Lt({argMax_:function(_,v){v===void 0&&(v=0);var d=Ze(_,"x","argMax");v==null&&(v=0);var y=Xt(v,d.shape),C=Ba(y,d.rank);C!=null&&(d=d.transpose(C),y=ja(y.length,d.rank));var z={axis:y[0]},Z=[d];return He.runKernelFunc(function(re,fe){var xe=re.argMax(d,y[0]);return fe([d]),xe},{x:d},function(re,fe){var xe=fe[0];return{x:function(){return vi(xe)}}},"ArgMax",z,Z)}}),Pv=Lt({argMin_:function(_,v){v===void 0&&(v=0);var d=Ze(_,"x","argMin");v==null&&(v=0);var y=Xt(v,d.shape),C=Ba(y,d.rank);return C!=null&&(d=d.transpose(C),y=ja(y.length,d.rank)),He.runKernelFunc(function(z,Z){var re=z.argMin(d,y[0]);return Z([d]),re},{$x:d},function(z,Z){var re=Z[0];return{$x:function(){return vi(re)}}})}}),zf=Lt({logSumExp_:function(_,v,d){v===void 0&&(v=null),d===void 0&&(d=!1);var y=Ze(_,"x","logSumExp"),C=Xt(v,y.shape),z=y.max(C,!0),Z=y.sub(z).exp().sum(C).log(),re=z.reshape(Z.shape).add(Z);if(d){var fe=Lo(re.shape,C);return re.reshape(fe)}return re}}),jy=Lt({max_:function(_,v,d){v===void 0&&(v=null),d===void 0&&(d=!1);var y=Ze(_,"x","max"),C=y,z=Xt(v,y.shape),Z=z,re=Ba(Z,y.rank);re!=null&&(y=y.transpose(re),Z=ja(Z.length,y.rank));var fe=[y],xe=He.runKernelFunc(function(Re,Le){var Be=Re.max(y,Z);return Le([C,Be]),Be},{x:y},function(Re,Le){return bg(Re,Le[1],Le[0],z,re)},"Max",{axes:Z},fe,[!0]);if(d){var Oe=Lo(xe.shape,z);xe=xe.reshape(Oe)}return xe}}),np=Lt({mean_:function(_,v,d){v===void 0&&(v=null),d===void 0&&(d=!1);var y=Ze(_,"x","mean"),C=Xt(v,y.shape),z=ze(Po(y.shape,C)[1]);return uu(function(Z){var re=Ar(z);return{value:(re.dtype===Z.dtype?Z:Z.cast(re.dtype)).div(re).sum(v,d),gradFunc:function(fe){var xe=Z.shape.slice();return C.forEach(function(Oe){xe[Oe]=1}),fe.reshape(xe).mul(Fu(Z.shape,"float32")).div(z)}}})(y)}}),rp=Lt({min_:function(_,v,d){v===void 0&&(v=null),d===void 0&&(d=!1);var y=Ze(_,"x","min"),C=y,z=Xt(v,y.shape),Z=z,re=Ba(Z,y.rank);re!=null&&(y=y.transpose(re),Z=ja(Z.length,y.rank));var fe=[y],xe=He.runKernelFunc(function(Re,Le){var Be=Re.min(y,Z);return Le([C,Be]),Be},{x:y},function(Re,Le){return bg(Re,Le[1],Le[0],z,re)},"Min",{axes:Z},fe,[!0]);if(d){var Oe=Lo(xe.shape,z);xe=xe.reshape(Oe)}return xe}}),Uf=Lt({moments_:function(_,v,d){v===void 0&&(v=null),d===void 0&&(d=!1);var y=Xt(v,(_=Ze(_,"x","moments")).shape),C=_.mean(y,d),z=C.shape;return d||(z=Lo(C.shape,y)),{mean:C,variance:_.toFloat().sub(C.reshape(z)).square().mean(y,d)}}}),Lv=Lt({sum_:function(_,v,d){v===void 0&&(v=null),d===void 0&&(d=!1);var y=Ze(_,"x","sum");y.dtype==="bool"&&(y=y.toInt());var C=Xt(v,y.shape);return uu(function(z){var Z=Ba(C,z.rank),re=C,fe=z;Z!=null&&(fe=z.transpose(Z),re=ja(re.length,z.rank));var xe=function(Be){var Xe=z.shape.slice();return C.forEach(function(nt){Xe[nt]=1}),Be.reshape(Xe).mul(Fu(z.shape,"float32"))},Oe={axes:re},Re=He.runKernelFunc(function(Be){return Be.sum(fe,re)},{x:fe},function(Be){return{x:function(){return xe(Be)}}},"Sum",Oe);if(d){var Le=Lo(Re.shape,C);Re=Re.reshape(Le)}return{value:Re,gradFunc:xe}})(y)}}),Xd=Lt({prod_:function(_,v,d){v===void 0&&(v=null),d===void 0&&(d=!1);var y=Ze(_,"x","prod");y.dtype==="bool"&&(y=y.toInt());var C=Xt(v,y.shape),z=Ba(C,y.rank),Z=C,re=y;z!=null&&(re=y.transpose(z),Z=ja(Z.length,y.rank));var fe=He.runKernelFunc(function(Oe){return Oe.prod(re,Z)},{permutedX:re});if(d){var xe=Lo(fe.shape,C);fe=fe.reshape(xe)}return fe}}),Hc=Lt({elu_:function(_){var v=Ze(_,"x","elu");return He.runKernelFunc(function(d,y){var C=d.elu(v);return y([C]),C},{$x:v},function(d,y){var C=y[0];return{$x:function(){return He.runKernelFunc(function(z){return z.eluDer(d,C)},{dy:d,y:C})}}})}}),ip=Lt({leakyRelu_:function(_,v){v===void 0&&(v=.2);var d=Ze(_,"x","leakyRelu");return zd(Ar(v).mul(d),d)}}),_m=Lt({prelu_:function(_,v){var d=Ze(_,"x","prelu"),y=Ze(v,"alpha","prelu");return He.runKernelFunc(function(C,z){var Z=C.prelu(d,y);return z([d,y]),Z},{x:d,alpha:y},function(C,z){var Z=z[0],re=z[1],fe=Z.greater(0);return{x:function(){return go(fe,C,C.mul(re))},alpha:function(){var xe=go(fe,vi(C),C.mul(Z)),Oe=Na(re.shape,C.shape);return Oe.length>0&&(xe=xe.sum(Oe)),xe.reshape(re.shape)}}},"Prelu")}}),xg=Lt({relu_:function(_){var v=Ze(_,"x","relu");return v.dtype==="bool"?v.toInt():He.runKernelFunc(function(d,y){var C=d.relu(v);return y([v]),C},{x:v},function(d,y){var C=y[0];return{x:function(){return d.mulStrict(C.step().toFloat())}}},"Relu")}}),_0=Lt({relu6_:function(_){var v=Ze(_,"x","relu6");return v.dtype==="bool"?v.toInt():He.runKernelFunc(function(d,y){var C=d.relu6(v);return y([v]),C},{x:v},function(d,y){var C=y[0],z=C.lessEqual(6).mul(C.step());return{x:function(){return d.mulStrict(z.toFloat())}}},"Relu6")}}),Bv=Lt({selu_:function(_){var v=Ze(_,"x","selu");return He.runKernelFunc(function(d,y){var C=d.selu(v);return y([v]),C},{$x:v},function(d,y){var C=y[0];return{$x:function(){var z=C.greater(Ar(0)),Z=Ar(zc),re=Ar(zl),fe=d.mul(re),xe=d.mul(Z).mul(C.toFloat().exp());return go(z,fe,xe)}}})}}),ms=Lt({transpose_:function(_,v){var d=Ze(_,"x","transpose");if(v==null&&(v=d.shape.map(function(C,z){return z}).reverse()),we(d.rank===v.length,function(){return"Error in transpose: rank of input "+d.rank+" must match length of perm "+v+"."}),v.forEach(function(C){we(C>=0&&C<d.rank,function(){return"All entries in 'perm' must be between 0 and "+(d.rank-1)+" but got "+v})}),d.rank<=1)return d.clone();var y={perm:v};return He.runKernelFunc(function(C){return C.transpose(d,v)},{x:d},function(C){var z=$u(v);return{x:function(){return C.transpose(z)}}},"Transpose",y)}}),jv=Lt({localResponseNormalization_:function(_,v,d,y,C){v===void 0&&(v=5),d===void 0&&(d=1),y===void 0&&(y=1),C===void 0&&(C=.5);var z=Ze(_,"x","localResponseNormalization");we(z.rank===4||z.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+z.rank+"."}),we(Ft(v),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+v+"."});var Z=z,re=!1;z.rank===3&&(re=!0,Z=z.as4D(1,z.shape[0],z.shape[1],z.shape[2]));var fe=He.runKernelFunc(function(xe,Oe){var Re=xe.localResponseNormalization4D(Z,v,d,y,C);return Oe([Z,Re]),Re},{x4D:Z},function(xe,Oe){var Re=Oe[0],Le=Oe[1];return{x4D:function(){return He.runKernelFunc(function(Be){return Be.LRNGrad(xe,Re,Le,v,d,y,C)},{})}}});return re?fe.as3D(fe.shape[1],fe.shape[2],fe.shape[3]):fe}}),op=Lt({norm_:function(_,v,d,y){v===void 0&&(v="euclidean"),d===void 0&&(d=null),y===void 0&&(y=!1);var C=function re(fe,xe,Oe){if(Oe===void 0&&(Oe=null),fe.rank===0)return fe.abs();if(fe.rank!==1&&Oe===null)return re(fe.reshape([-1]),xe,Oe);if(fe.rank===1||typeof Oe=="number"||Array.isArray(Oe)&&Oe.length===1){if(xe===1)return fe.abs().sum(Oe);if(xe===1/0)return fe.abs().max(Oe);if(xe===-1/0)return fe.abs().min(Oe);if(xe==="euclidean"||xe===2)return fe.abs().pow(Ar(2,"int32")).sum(Oe).sqrt();throw new Error("Error in norm: invalid ord value: "+xe)}if(Array.isArray(Oe)&&Oe.length===2){if(xe===1)return fe.abs().sum(Oe[0]).max(Oe[1]-1);if(xe===1/0)return fe.abs().sum(Oe[1]).max(Oe[0]);if(xe===-1/0)return fe.abs().sum(Oe[1]).min(Oe[0]);if(xe==="fro"||xe==="euclidean")return fe.square().sum(Oe).sqrt();throw new Error("Error in norm: invalid ord value: "+xe)}throw new Error("Error in norm: invalid axis: "+Oe)}(_=Ze(_,"x","norm"),v,d),z=C.shape;if(y){var Z=Xt(d,_.shape);z=Lo(C.shape,Z)}return C.reshape(z)}}),zv=Lt({basicLSTMCell_:function(_,v,d,y,C,z){var Z=Ze(_,"forgetBias","basicLSTMCell"),re=Ze(v,"lstmKernel","basicLSTMCell"),fe=Ze(d,"lstmBias","basicLSTMCell"),xe=Ze(y,"data","basicLSTMCell"),Oe=Ze(C,"c","basicLSTMCell"),Re=Ze(z,"h","basicLSTMCell"),Le=xe.concat(Re,1).matMul(re).add(fe),Be=Le.shape[0],Xe=Le.shape[1]/4,nt=[Be,Xe],tt=Le.slice([0,0],nt),ut=Le.slice([0,Xe],nt),Nt=Le.slice([0,2*Xe],nt),Pt=Le.slice([0,3*Xe],nt),jt=tt.sigmoid().mulStrict(ut.tanh()).addStrict(Oe.mulStrict(Z.add(Nt).sigmoid()));return[jt,jt.tanh().mulStrict(Pt.sigmoid())]}}),wg=Lt({multiRNNCell_:function(_,v,d,y){for(var C=Ze(v,"data","multiRNNCell"),z=hc(d,"c","multiRNNCell"),Z=hc(y,"h","multiRNNCell"),re=C,fe=[],xe=0;xe<_.length;xe++){var Oe=_[xe](re,z[xe],Z[xe]);fe.push(Oe[0]),fe.push(Oe[1]),re=Oe[1]}var Re=[],Le=[];for(xe=0;xe<fe.length;xe+=2)Re.push(fe[xe]),Le.push(fe[xe+1]);return[Re,Le]}}),Wf=Lt({movingAverage_:function(_,v,d,y,C){C===void 0&&(C=!0);var z=Ze(_,"v","movingAverage"),Z=Ze(v,"x","movingAverage"),re=Ze(d,"decay","movingAverage");mn(z,Z),we(Ut(z.shape,Z.shape),function(){return"Shape mismatch in v and x"});var fe=Ar(1),xe=fe.sub(re),Oe=Z.sub(z).mul(xe);if(C){we(y!=null,function(){return"When using zeroDebias: true, step is required."});var Re=Ze(y,"step","movingAverage");Oe=Oe.div(fe.sub(Wd(re,Re)))}return z.add(Oe)}}),Em=Lt({stridedSlice_:function(_,v,d,y,C,z,Z,re,fe){if(C===void 0&&(C=0),z===void 0&&(z=0),Z===void 0&&(Z=0),re===void 0&&(re=0),fe===void 0&&(fe=0),y==null&&(y=new Array(v.length)),Z!==0)throw new Error("ellipsis mask is not yet supported");var xe=Ze(_,"x","stridedSlice"),Oe=Da(re),Re=xe.shape.slice();Oe.forEach(function(tt){v[tt]=0,d[tt]=1,Re.splice(tt,0,1)}),xe=xe.reshape(Re);for(var Le=0;Le<xe.rank;Le++)v[Le]=Bs(C,v,y,xe.shape,Le),d[Le]=Cf(z,d,y,xe.shape,Le),y[Le]=y[Le]||1;var Be=Da(fe);Be.forEach(function(tt){d[tt]=v[tt]+1,y[tt]=1});var Xe=Sf(v,d,y),nt=Xe.filter(function(tt,ut){return Be.indexOf(ut)===-1});return y.every(function(tt){return tt===1})?Xl(xe,v,Xe).reshape(nt):He.runKernelFunc(function(tt){return tt.stridedSlice(xe,v,d,y)},{$x:xe}).reshape(nt)}}),Yl=Lt({topk_:function(_,v,d){v===void 0&&(v=1),d===void 0&&(d=!0);var y=Ze(_,"x","topk");if(y.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var C=y.shape[y.shape.length-1];if(v>C)throw new Error("'k' passed to topk() must be <= the last dimension ("+C+") but got "+v);var z=He.runKernelFunc(function(Z){return Z.topk(y,v,d)},{$x:y});return{values:z[0],indices:z[1]}}}),Uv=Lt({scatterND_:function(_,v,d){var y=Ze(_,"indices","scatterND","int32"),C=Ze(v,"updates","scatterND");return kd(C,y,d),He.runKernelFunc(function(z){return z.scatterND(y,C,d)},{indices:y,updates:C},null,"ScatterNd",{shape:d})}}),_g=Lt({fft_:function(_){we(_.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+_.dtype+"."});var v=_.shape[_.shape.length-1],d=_.size/v,y=_.as2D(d,v);return He.runKernelFunc(function(C){return C.fft(y)},{input:_}).reshape(_.shape)}}),Eg=Lt({ifft_:function(_){we(_.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+_.dtype+"."});var v=_.shape[_.shape.length-1],d=_.size/v,y=_.as2D(d,v);return He.runKernelFunc(function(C){return C.ifft(y)},{input:_}).reshape(_.shape)}}),E0=Lt({rfft_:function(_,v){we(_.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+_.dtype});var d,y=_.shape[_.shape.length-1],C=_.size/y;if(v!=null&&v<y){var z=_.shape.map(function(ut){return 0}),Z=_.shape.map(function(ut){return ut});Z[_.shape.length-1]=v,d=_.slice(z,Z),y=v}else if(v!=null&&v>y){var re=_.shape.map(function(ut){return ut});re[_.shape.length-1]=v-y,d=_.concat(uo(re),_.shape.length-1),y=v}else d=_;var fe=d.zerosLike(),xe=Co(d,fe).as2D(C,y),Oe=_g(xe),Re=Math.floor(y/2)+1,Le=xa(Oe),Be=Za(Oe),Xe=Le.split([Re,y-Re],Le.shape.length-1),nt=Be.split([Re,y-Re],Be.shape.length-1),tt=d.shape.slice();return tt[d.shape.length-1]=Re,Co(Xe[0],nt[0]).reshape(tt)}}),pl=Lt({irfft_:function(_){var v=_.shape[_.shape.length-1],d=_.size/v;if(v<=2){var y=_.as2D(d,v),C=Eg(y);return xa(C)}var z=[d,2*(v-1)],Z=xa(_).as2D(d,v),re=Za(_).as2D(d,v),fe=Z.slice([0,1],[d,v-2]).reverse(1),xe=re.slice([0,1],[d,v-2]).reverse(1).mul(Ar(-1)),Oe=Z.concat(fe,1),Re=re.concat(xe,1);return y=Co(Oe,Re).as2D(z[0],z[1]),C=Eg(y),xa(C)}}),Sg=Object.freeze({fft:_g,ifft:Eg,rfft:E0,irfft:pl}),Wv=Lt({sparseToDense_:function(_,v,d,y){y===void 0&&(y=0);var C=Ze(_,"sparseIndices","sparseToDense","int32"),z=Ze(v,"sparseValues","sparseToDense"),Z=Ze(y,"defaultValue","sparseToDense",z.dtype);return function(re,fe,xe,Oe){if(re.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+re.dtype+".");if(re.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+re.shape+".");var Re=re.rank>0?re.shape[0]:1,Le=re.rank>1?re.shape[1]:1;if(xe.length!==Le)throw new Error("outputShape has incorrect number of elements:, "+xe.length+", should be: "+Le+".");var Be=fe.size;if(fe.rank!==0&&(fe.rank!==1||Be!==Re))throw new Error("sparseValues has incorrect shape "+fe.shape+", should be [] or ["+Re+"]");if(fe.dtype!==Oe.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(C,z,d,Z),He.runKernelFunc(function(re){return re.sparseToDense(C,z,d,Z)},{$sparseIndices:C,$sparseValues:z,$defaultValue:Z})}}),Jl=Lt({gatherND_:function(_,v){var d=Ze(v,"indices","gatherND","int32"),y=Ze(_,"x","gatherND");return He.runKernelFunc(function(C){return C.gatherND(y,d)},{x:y,indices:d},null,"GatherNd")}}),Sm=Lt({diag_:function(_){var v=Ze(_,"x","diag").flatten(),d=_.shape.concat(_.shape);return He.runKernelFunc(function(y){return y.diag(v)},{$x:v}).reshape(d)}}),Kd=Lt({dropout_:function(_,v,d,y){var C=Ze(_,"x","dropout");if(we(C.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+C.dtype+" tensor instead."}),we(v>=0&&v<1,function(){return"rate must be a float in the range [0, 1), but got "+v+"."}),v===0)return _ instanceof Qt?C.clone():C;var z=function(fe,xe){if(xe==null)return fe.shape.slice();if(Ut(fe.shape,xe))return xe;if(fe.shape.length===xe.length){for(var Oe=[],Re=0;Re<fe.shape.length;Re++)xe[Re]==null&&fe.shape[Re]!=null?Oe.push(fe.shape[Re]):Oe.push(xe[Re]);return Oe}return xe}(C,d),Z=1-v,re=_f(z,0,1,"float32",y).add(Z).floor().div(Z);return C.mul(re)}});function Cm(_,v,d){for(var y=1-_%2,C=new Float32Array(_),z=0;z<_;++z){var Z=2*Math.PI*z/(_+y-1);C[z]=v-d*Math.cos(Z)}return au(C,"float32")}var gs,Cg=Lt({hannWindow_:function(_){return Cm(_,.5,.5)}}),S0=Lt({hammingWindow_:function(_){return Cm(_,.54,.46)}}),km=Lt({frame_:function(_,v,d,y,C){y===void 0&&(y=!1),C===void 0&&(C=0);for(var z=0,Z=[];z+v<=_.size;)Z.push(Xl(_,z,v)),z+=d;if(y)for(;z<_.size;){var re=z+v-_.size,fe=$o([Xl(_,z,v-re),Rs([re],C)]);Z.push(fe),z+=d}return Z.length===0?Eu([],[0,v]):$o(Z).as2D(Z.length,v)}}),Am=Lt({stft_:function(_,v,d,y,C){var z;C===void 0&&(C=Cg),y==null&&(z=v,y=Math.floor(Math.pow(2,Math.ceil(Math.log(z)/Math.log(2)))));for(var Z=km(_,v,d),re=ql(Z,C(v)),fe=[],xe=0;xe<Z.shape[0];xe++)fe.push(E0(re.slice([xe,0],[1,v]),y));return $o(fe)}}),C0=Object.freeze({hannWindow:Cg,hammingWindow:S0,frame:km,stft:Am}),Vv=function(_,v,d){return d===void 0&&(d=1),D(this,void 0,void 0,function(){var y,C,z,Z,re,fe,xe,Oe,Re,Le,Be,Xe,nt,tt;return R(this,function(ut){switch(ut.label){case 0:return y=Ze(_,"predictions","inTopK"),C=Ze(v,"targets","inTopK"),we(y.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+y.rank}),we(y.rank-1===C.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+y.rank+" and targets rank "+C.rank}),yt(y.shape.slice(0,y.shape.length-1),C.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),z=y.shape[y.shape.length-1],we(d>0&&d<=z,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+z+"), but got "+d}),[4,y.data()];case 1:return Z=ut.sent(),[4,C.data()];case 2:for(re=ut.sent(),fe=[Z.length/z,z],Oe=fe[1],Re=kn("bool",xe=fe[0]),Le=0;Le<xe;Le++){for(Be=Le*Oe,Xe=Z.subarray(Be,Be+Oe),nt=[],tt=0;tt<Xe.length;tt++)nt.push({value:Xe[tt],index:tt});for(nt.sort(function(Nt,Pt){return Pt.value-Nt.value}),Re[Le]=0,tt=0;tt<d;tt++)if(nt[tt].index===re[Le]){Re[Le]=1;break}}return _!==y&&y.dispose(),v!==C&&C.dispose(),[2,No(Re,C.shape,"bool")]}})})};(function(_){_[_.NONE=0]="NONE",_[_.MEAN=1]="MEAN",_[_.SUM=2]="SUM",_[_.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(gs||(gs={}));var zy=Lt({absoluteDifference_:function(_,v,d,y){y===void 0&&(y=gs.SUM_BY_NONZERO_WEIGHTS);var C=Ze(_,"labels","absoluteDifference"),z=Ze(v,"predictions","absoluteDifference"),Z=null;d!=null&&(Z=Ze(d,"weights","absoluteDifference")),yt(C.shape,z.shape,"Error in absoluteDifference: ");var re=C.sub(z).abs();return ml(re,Z,y)}}),ml=Lt({computeWeightedLoss_:function(_,v,d){d===void 0&&(d=gs.SUM_BY_NONZERO_WEIGHTS);var y=Ze(_,"losses","computeWeightedLoss"),C=null;v!=null&&(C=Ze(v,"weights","computeWeightedLoss"));var z=C==null?y:y.mul(C);if(d===gs.NONE)return z;if(d===gs.SUM)return z.sum();if(d===gs.MEAN){if(C==null)return z.mean();var Z=y.size/C.size,re=z.sum().div(C.sum());return Z>1?re.div(Ar(Z)):re}if(d===gs.SUM_BY_NONZERO_WEIGHTS){if(C==null)return z.sum().div(Ar(y.size));var fe=C.mul(Fu(y.shape)).notEqual(Ar(0)).sum().toFloat();return z.sum().div(fe)}throw Error("Unknown reduction: "+d)}}),Yd=Lt({cosineDistance_:function(_,v,d,y,C){C===void 0&&(C=gs.SUM_BY_NONZERO_WEIGHTS);var z=Ze(_,"labels","cosineDistance"),Z=Ze(v,"predictions","cosineDistance"),re=null;y!=null&&(re=Ze(y,"weights","cosineDistance")),yt(z.shape,Z.shape,"Error in cosineDistance: ");var fe=Ar(1).sub(z.mul(Z).sum(d,!0));return ml(fe,re,C)}}),Uy=Lt({hingeLoss_:function(_,v,d,y){y===void 0&&(y=gs.SUM_BY_NONZERO_WEIGHTS);var C=Ze(_,"labels","hingeLoss"),z=Ze(v,"predictions","hingeLoss"),Z=null;d!=null&&(Z=Ze(d,"weights","hingeLoss")),yt(C.shape,z.shape,"Error in hingeLoss: ");var re=Ar(1);C=Ar(2).mul(C).sub(re);var fe=re.sub(C.mul(z)).relu();return ml(fe,Z,y)}}),Hv=Lt({huberLoss_:function(_,v,d,y,C){y===void 0&&(y=1),C===void 0&&(C=gs.SUM_BY_NONZERO_WEIGHTS);var z=Ze(_,"labels","huberLoss"),Z=Ze(v,"predictions","huberLoss"),re=null;d!=null&&(re=Ze(d,"weights","huberLoss")),yt(z.shape,Z.shape,"Error in huberLoss: ");var fe=Ar(y),xe=Z.sub(z).abs(),Oe=Lf(xe,fe),Re=xe.sub(Oe),Le=Ar(.5).mul(Oe.square()).add(fe.mul(Re));return ml(Le,re,C)}}),gl=Lt({logLoss_:function(_,v,d,y,C){y===void 0&&(y=1e-7),C===void 0&&(C=gs.SUM_BY_NONZERO_WEIGHTS);var z=Ze(_,"labels","logLoss"),Z=Ze(v,"predictions","logLoss"),re=null;d!=null&&(re=Ze(d,"weights","logLoss")),yt(z.shape,Z.shape,"Error in logLoss: ");var fe=Ar(1),xe=Ar(y),Oe=z.mul(Z.add(xe).log()).neg().sub(fe.sub(z).mul(fe.sub(Z).add(xe).log()));return ml(Oe,re,C)}}),as=Lt({meanSquaredError_:function(_,v,d,y){y===void 0&&(y=gs.SUM_BY_NONZERO_WEIGHTS);var C=Ze(_,"labels","meanSquaredError"),z=Ze(v,"predictions","meanSquaredError"),Z=null;d!=null&&(Z=Ze(d,"weights","meanSquaredError")),yt(C.shape,z.shape,"Error in meanSquaredError: ");var re=C.squaredDifference(z);return ml(re,Z,y)}}),ap=Lt({sigmoidCrossEntropy_:function(_,v,d,y,C){y===void 0&&(y=0),C===void 0&&(C=gs.SUM_BY_NONZERO_WEIGHTS);var z=Ze(_,"multiClassLabels","sigmoidCrossEntropy"),Z=Ze(v,"logits","sigmoidCrossEntropy"),re=null;if(d!=null&&(re=Ze(d,"weights","sigmoidCrossEntropy")),yt(z.shape,Z.shape,"Error in sigmoidCrossEntropy: "),y>0){var fe=Ar(y),xe=Ar(1),Oe=Ar(.5);z=z.mul(xe.sub(fe)).add(Oe.mul(fe))}var Re=function(Le,Be){var Xe=Ze(Le,"labels","sigmoidCrossEntropyWithLogits"),nt=Ze(Be,"logits","sigmoidCrossEntropyWithLogits");yt(Xe.shape,nt.shape,"Error in sigmoidCrossEntropyWithLogits: ");var tt=nt.relu(),ut=nt.mul(Xe),Nt=nt.abs().neg().exp().log1p();return tt.sub(ut).add(Nt)}(z,Z);return ml(Re,re,C)}}),Om=Lt({softmaxCrossEntropy_:function(_,v,d,y,C){y===void 0&&(y=0),C===void 0&&(C=gs.SUM_BY_NONZERO_WEIGHTS);var z=Ze(_,"onehotLabels","softmaxCrossEntropy"),Z=Ze(v,"logits","softmaxCrossEntropy"),re=null;if(d!=null&&(re=Ze(d,"weights","softmaxCrossEntropy")),yt(z.shape,Z.shape,"Error in softmaxCrossEntropy: "),y>0){var fe=Ar(y),xe=Ar(1),Oe=Ar(z.shape[1]);z=z.mul(xe.sub(fe)).add(fe.div(Oe))}var Re=function(Le,Be,Xe){if(Xe===void 0&&(Xe=-1),Xe===-1&&(Xe=Be.rank-1),Xe!==Be.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+Be.rank+" and dim was "+Xe);return uu(function(nt,tt,ut){var Nt=tt.logSumExp([Xe],!0),Pt=tt.toFloat().sub(Nt);return ut([nt,Pt]),{value:Pt.mul(nt).neg().sum([Xe]),gradFunc:function(jt,Yt){var gn=Yt[0],wn=Yt[1],vn=Lo(jt.shape,[Xe]);return[jt.reshape(vn).mul(gn.toFloat().sub(wn.exp())),jt.reshape(vn).mul(wn.exp().sub(gn.toFloat()))]}}})(Le,Be)}(z,Z);return ml(Re,re,C)}}),kg=Object.freeze({get Reduction(){return gs},absoluteDifference:zy,computeWeightedLoss:ml,cosineDistance:Yd,hingeLoss:Uy,huberLoss:Hv,logLoss:gl,meanSquaredError:as,sigmoidCrossEntropy:ap,softmaxCrossEntropy:Om});function Gv(_,v){return v===void 0&&(v=!1),He.tidy(function(){if(_.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+_.shape.length+"D Tensor.");for(var d=_.shape[0],y=_.shape[1],C=jh(d),z=_.clone(),Z=Eu([[1]],[1,1]),re=Z.clone(),fe=d>=y?y:d,xe=function(Re){var Le,Be=z,Xe=re,nt=C;Le=He.tidy(function(){var tt=z.slice([Re,Re],[d-Re,1]),ut=tt.norm(),Nt=z.slice([Re,Re],[1,1]),Pt=Eu([[-1]]).where(Nt.greater(0),Eu([[1]])),jt=Nt.sub(Pt.mul(ut)),Yt=tt.div(jt);re=Yt.shape[0]===1?Z.clone():Z.concat(Yt.slice([1,0],[Yt.shape[0]-1,Yt.shape[1]]),0);var gn=Pt.matMul(jt).div(ut).neg(),wn=z.slice([Re,0],[d-Re,y]),vn=gn.mul(re);if(Re===0)z=wn.sub(vn.matMul(re.transpose().matMul(wn)));else{var Cn=wn.sub(vn.matMul(re.transpose().matMul(wn)));z=z.slice([0,0],[Re,y]).concat(Cn,0)}var Dn=C.slice([0,Re],[d,C.shape[1]-Re]);if(Re===0)C=Dn.sub(Dn.matMul(re).matMul(vn.transpose()));else{var b=Dn.sub(Dn.matMul(re).matMul(vn.transpose()));C=C.slice([0,0],[d,Re]).concat(b,1)}return[re,z,C]}),re=Le[0],z=Le[1],C=Le[2],zo([Be,Xe,nt])},Oe=0;Oe<fe;++Oe)xe(Oe);return!v&&d>y&&(C=C.slice([0,0],[d,y]),z=z.slice([0,0],[y,y])),[C,z]})}var Ag=Lt({bandPart_:function(_,v,d){if(v%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+v+".");if(d%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+d+".");var y=Ze(_,"a","bandPart");if(y.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+y.rank+".");var C=y.shape,z=y.shape.slice(-2),Z=z[0],re=z[1];if(!(v<=Z))throw new Error("bandPart(): numLower ("+v+") must not be greater than the number of rows ("+Z+").");if(!(d<=re))throw new Error("bandPart(): numUpper ("+d+") must not be greater than the number of columns ("+re+").");v<0&&(v=Z),d<0&&(d=re);var fe=Rc(0,Z,1,"int32").reshape([-1,1]),xe=Rc(0,re,1,"int32"),Oe=hl(fe,xe),Re=Bd(Oe.lessEqual(Ar(+v,"int32")),Oe.greaterEqual(Ar(-d,"int32"))),Le=uo([Z,re],y.dtype);return Xi(qa(y.reshape([-1,Z,re])).map(function(Be){return go(Re,Be,Le)})).reshape(C)}}),Vf=Lt({gramSchmidt_:function(_){var v;if(Array.isArray(_)){v=!1,we(_!=null&&_.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var d=_[0].shape[0],y=function(fe){we(_[fe].shape[0]===d,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+_[fe].shape[0]+" vs. "+d+")"})},C=1;C<_.length;++C)y(C)}else v=!0,_=$i(_,_.shape[0],0).map(function(fe){return Ga(fe,[0])});we(_.length<=_[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+_.length+") exceeds number of dimensions ("+_[0].shape[0]+")."});var z=[],Z=_,re=function(fe){z.push(He.tidy(function(){var xe=Z[fe];if(fe>0)for(var Oe=0;Oe<fe;++Oe){var Re=Lv(z[Oe].mulStrict(xe)).mul(z[Oe]);xe=xe.sub(Re)}return xe.div(op(xe,"euclidean"))}))};for(C=0;C<_.length;++C)re(C);return v?Xi(z,0):z}}),V1=Lt({qr_:function(_,v){if(v===void 0&&(v=!1),_.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+_.rank);if(_.rank===2)return Gv(_,v);var d=_.shape.slice(0,_.shape.length-2).reduce(function(z,Z){return z*Z}),y=[],C=[];return qa(_.reshape([d,_.shape[_.shape.length-2],_.shape[_.shape.length-1]]),0).forEach(function(z){var Z=Gv(z,v),re=Z[0],fe=Z[1];y.push(re),C.push(fe)}),[Xi(y,0).reshape(_.shape),Xi(C,0).reshape(_.shape)]}}),Og=Object.freeze({bandPart:Ag,gramSchmidt:Vf,qr:V1});function es(_,v,d,y,C,z){y==null&&(y=.5),C==null&&(C=Number.NEGATIVE_INFINITY),z==null&&(z=0);var Z=_.shape[0];return d=Math.min(d,Z),we(0<=y&&y<=1,function(){return"iouThreshold must be in [0, 1], but was '"+y+"'"}),we(_.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+_.rank+"'"}),we(_.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+_.shape[1]}),we(v.rank===1,function(){return"scores must be a 1D tensor"}),we(v.shape[0]===Z,function(){return"scores has incompatible shape with boxes. Expected "+Z+", but was "+v.shape[0]}),we(0<=z&&z<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+z+"'"}),{maxOutputSize:d,iouThreshold:y,scoreThreshold:C,softNmsSigma:z}}var Tm=Lt({resizeBilinear_:function(_,v,d){d===void 0&&(d=!1);var y=Ze(_,"images","resizeBilinear");we(y.rank===3||y.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+y.rank+"."}),we(v.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+v+"."});var C=y,z=!1;y.rank===3&&(z=!0,C=y.as4D(1,y.shape[0],y.shape[1],y.shape[2]));var Z=v[0],re=v[1],fe=He.runKernelFunc(function(xe,Oe){return Oe([C]),xe.resizeBilinear(C,Z,re,d)},{x:C},function(xe,Oe){return{x:function(){return He.runKernelFunc(function(Re){return Re.resizeBilinearBackprop(xe,Oe[0],d)},{})}}},"ResizeBilinear",{alignCorners:d,newHeight:Z,newWidth:re});return z?fe.as3D(fe.shape[1],fe.shape[2],fe.shape[3]):fe}}),Jd=Lt({resizeNearestNeighbor_:function(_,v,d){d===void 0&&(d=!1);var y=Ze(_,"images","resizeNearestNeighbor");we(y.rank===3||y.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+y.rank+"."}),we(v.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+v+"."}),we(y.dtype==="float32"||y.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var C=y,z=!1;y.rank===3&&(z=!0,C=y.as4D(1,y.shape[0],y.shape[1],y.shape[2]));var Z=v[0],re=v[1],fe=He.runKernelFunc(function(xe,Oe){return Oe([C]),xe.resizeNearestNeighbor(C,Z,re,d)},{batchImages:C},function(xe,Oe){return{batchImages:function(){return He.runKernelFunc(function(Re){return Re.resizeNearestNeighborBackprop(xe,Oe[0],d)},{})}}});return z?fe.as3D(fe.shape[1],fe.shape[2],fe.shape[3]):fe}}),Tg=Lt({nonMaxSuppression_:function(_,v,d,y,C){y===void 0&&(y=.5),C===void 0&&(C=Number.NEGATIVE_INFINITY);var z=Ze(_,"boxes","nonMaxSuppression"),Z=Ze(v,"scores","nonMaxSuppression"),re=es(z,Z,d,y,C);d=re.maxOutputSize,y=re.iouThreshold,C=re.scoreThreshold;var fe={maxOutputSize:d,iouThreshold:y,scoreThreshold:C};return He.runKernelFunc(function(xe){return xe.nonMaxSuppression(z,Z,d,y,C)},{boxes:z,scores:Z},null,"NonMaxSuppressionV3",fe)}}),Mm=Lt({nonMaxSuppressionWithScore_:function(_,v,d,y,C,z){y===void 0&&(y=.5),C===void 0&&(C=Number.NEGATIVE_INFINITY),z===void 0&&(z=0);var Z=Ze(_,"boxes","nonMaxSuppression"),re=Ze(v,"scores","nonMaxSuppression"),fe=es(Z,re,d,y,C,z),xe={maxOutputSize:d=fe.maxOutputSize,iouThreshold:y=fe.iouThreshold,scoreThreshold:C=fe.scoreThreshold,softNmsSigma:z=fe.softNmsSigma},Oe=He.runKernel("NonMaxSuppressionV5",{boxes:Z,scores:re},xe);return{selectedIndices:Oe[0],selectedScores:Oe[1]}}}),k0=Lt({cropAndResize_:function(_,v,d,y,C,z){var Z=Ze(_,"image","cropAndResize"),re=Ze(v,"boxes","cropAndResize","float32"),fe=Ze(d,"boxInd","cropAndResize","int32");C=C||"bilinear",z=z||0;var xe=re.shape[0];return we(Z.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+Z.rank+"."}),we(re.rank===2&&re.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+xe+",4] but had shape "+re.shape+"."}),we(fe.rank===1&&fe.shape[0]===xe,function(){return"Error in cropAndResize: boxInd must be have size ["+xe+"] but had shape "+re.shape+"."}),we(y.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+y.length+"."}),we(y[0]>=1&&y[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+y}),we(C==="bilinear"||C==="nearest",function(){return"method must be bilinear or nearest, but was "+C}),He.runKernelFunc(function(Oe,Re){return Oe.cropAndResize(Z,re,fe,y,C,z)},{images:Z,boxes:re,boxInd:fe},null,"CropAndResize",{method:C,extrapolationValue:z,cropSize:y})}}),A0=Object.freeze({resizeBilinear:Tm,resizeNearestNeighbor:Jd,nonMaxSuppression:Tg,nonMaxSuppressionAsync:function(_,v,d,y,C){return y===void 0&&(y=.5),C===void 0&&(C=Number.NEGATIVE_INFINITY),D(this,void 0,void 0,function(){var z,Z,re,fe,xe,Oe,Re;return R(this,function(Le){switch(Le.label){case 0:return z=Ze(_,"boxes","nonMaxSuppressionAsync"),Z=Ze(v,"scores","nonMaxSuppressionAsync"),re=es(z,Z,d,y,C),d=re.maxOutputSize,y=re.iouThreshold,C=re.scoreThreshold,[4,Promise.all([z.data(),Z.data()])];case 1:return fe=Le.sent(),xe=fe[0],Oe=fe[1],Re=Ju(xe,Oe,d,y,C),z!==_&&z.dispose(),Z!==v&&Z.dispose(),[2,Re]}})})},nonMaxSuppressionWithScore:Mm,nonMaxSuppressionWithScoreAsync:function(_,v,d,y,C,z){return y===void 0&&(y=.5),C===void 0&&(C=Number.NEGATIVE_INFINITY),z===void 0&&(z=0),D(this,void 0,void 0,function(){var Z,re,fe,xe,Oe,Re,Le;return R(this,function(Be){switch(Be.label){case 0:return Z=Ze(_,"boxes","nonMaxSuppressionAsync"),re=Ze(v,"scores","nonMaxSuppressionAsync"),fe=es(Z,re,d,y,C,z),d=fe.maxOutputSize,y=fe.iouThreshold,C=fe.scoreThreshold,z=fe.softNmsSigma,[4,Promise.all([Z.data(),re.data()])];case 1:return xe=Be.sent(),Oe=xe[0],Re=xe[1],Le=Qu(Oe,Re,d,y,C,z),Z!==_&&Z.dispose(),re!==v&&re.dispose(),[2,Le]}})})},cropAndResize:k0}),Hf=function(_,v){return!(_>0)||v==="linear"},xc=function(_,v,d){if(d==null||d==="linear")return _;if(d==="relu")return _.mul(v.step());throw new Error("Gradient for activation "+d+" has not been implemented yet.")},qv=function(_,v){var d=v,y=Na(_.shape,v.shape);return y.length>0&&(d=d.sum(y)),d.reshape(_.shape)},$v=function(_,v,d){if(v==="linear")return _;if(v==="relu")return xg(_);if(v==="elu")return Hc(_);if(v==="relu6")return _0(_);if(v==="prelu")return _m(_,d);throw new Error("Unknown fused activation "+v+".")},sp=Lt({fusedMatMul_:function(_){var v,d=_.a,y=_.b,C=_.transposeA,z=C!==void 0&&C,Z=_.transposeB,re=Z!==void 0&&Z,fe=_.bias,xe=_.activation,Oe=xe===void 0?"linear":xe,Re=_.preluActivationWeights;if(Hf(He.state.gradientDepth,Oe)===!1){var Le=Av(d,y,z,re);return fe!=null&&(Le=Jh(Le,fe)),$v(Le,Oe,Re)}var Be=Ze(d,"a","fused matMul"),Xe=Ze(y,"b","fused matMul");v=Zt(Be,Xe),Be=v[0],Xe=v[1];var nt=z?Be.shape[Be.rank-2]:Be.shape[Be.rank-1],tt=re?Xe.shape[Xe.rank-1]:Xe.shape[Xe.rank-2],ut=z?Be.shape[Be.rank-1]:Be.shape[Be.rank-2],Nt=re?Xe.shape[Xe.rank-2]:Xe.shape[Xe.rank-1],Pt=Be.shape.slice(0,-2),jt=Xe.shape.slice(0,-2),Yt=ze(Pt),gn=ze(jt);we(Be.rank>=2&&Xe.rank>=2&&Be.rank===Xe.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+Be.rank+" and "+Xe.rank+"."}),we(Ut(Pt,jt),function(){return"Error in fused matMul: outer dimensions ("+Pt+") and ("+jt+") of Tensors with shapes "+Be.shape+" and "+Xe.shape+" must match."}),we(nt===tt,function(){return"Error in fused matMul: inner shapes ("+nt+") and ("+tt+") of Tensors with shapes "+Be.shape+" and "+Xe.shape+" and transposeA="+z+" and transposeB="+re+" must match."});var wn,vn,Cn=Be.shape.slice(0,-2).concat([ut,Nt]),Dn=z?Be.as3D(Yt,nt,ut):Be.as3D(Yt,ut,nt),b=re?Xe.as3D(gn,Nt,tt):Xe.as3D(gn,tt,Nt);fe!=null&&io(Cn,(wn=Zt(wn=Ze(fe,"bias","fused matMul"),Be)[0]).shape),Re!=null&&(vn=Ze(Re,"prelu weights","fused matMul"));var p={a:Dn,b};fe!=null&&(p.bias=wn),Re!=null&&(p.preluActivationWeights=vn);var l=[Dn,b];return He.runKernelFunc(function(m,w){var P=m.fusedBatchMatMul({a:Dn,b,transposeA:z,transposeB:re,bias:wn,activation:Oe,preluActivationWeights:vn});return w([Dn,b,P]),P},p,function(m,w){var P=w[0],K=w[1],ee=w[2],le=xc(m,ee,Oe),de={};return fe!=null&&(de={bias:function(){return qv(wn,le)}}),Object.assign(z||re?!z&&re?{a:function(){return le.matMul(K,!1,!1)},b:function(){return le.matMul(P,!0,!1)}}:z&&!re?{a:function(){return K.matMul(le,!1,!0)},b:function(){return P.matMul(le,!1,!1)}}:{a:function(){return K.matMul(le,!0,!0)},b:function(){return le.matMul(P,!0,!0)}}:{a:function(){return le.matMul(K,!1,!0)},b:function(){return P.matMul(le,!0,!1)}},de)},"_FusedMatMul",{transposeA:z,transposeB:re,activation:Oe},l,[!0]).reshape(Cn)}}),Dm=Lt({fusedConv2d_:function(_){var v=_.x,d=_.filter,y=_.strides,C=_.pad,z=_.dataFormat,Z=z===void 0?"NHWC":z,re=_.dilations,fe=re===void 0?[1,1]:re,xe=_.dimRoundingMode,Oe=_.bias,Re=_.activation,Le=Re===void 0?"linear":Re,Be=_.preluActivationWeights;if(Le=Le||"linear",Hf(He.state.gradientDepth,Le)===!1){var Xe=tp(v,d,y,C,Z,fe,xe);return Oe!=null&&(Xe=Jh(Xe,Oe)),$v(Xe,Le,Be)}var nt=Ze(v,"x","conv2d"),tt=Ze(d,"filter","conv2d"),ut=nt,Nt=!1;nt.rank===3&&(Nt=!0,ut=nt.as4D(1,nt.shape[0],nt.shape[1],nt.shape[2])),we(ut.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+ut.rank+"."}),we(tt.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+tt.rank+"."}),xe!=null&&we(Ft(C),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+xe+" but got pad "+C+"."}),we(ut.shape[3]===tt.shape[2],function(){return"Error in conv2d: depth of input ("+ut.shape[3]+") must match input depth for filter "+tt.shape[2]+"."}),we(Ss(y,fe),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+fe+"'"}),we(Z==="NHWC",function(){return"Error in conv2d: got dataFormat of "+Z+" but only NHWC is currently supported."});var Pt,jt,Yt=cu(ut.shape,tt.shape,y,fe,C,xe);Oe!=null&&(Pt=Zt(Pt=Ze(Oe,"bias","fused conv2d"),nt)[0],io(Yt.outShape,Pt.shape)),Be!=null&&(jt=Ze(Be,"prelu weights","fused conv2d"));var gn={x:ut,filter:tt};Oe!=null&&(gn.bias=Pt),Be!=null&&(gn.preluActivationWeights=jt);var wn=[tt,ut],vn=He.runKernelFunc(function(Cn,Dn){var b=Cn.fusedConv2d({input:ut,filter:tt,convInfo:Yt,bias:Pt,activation:Le,preluActivationWeights:jt});return Dn([tt,ut,b]),b},gn,function(Cn,Dn){var b=Dn,p=b[0],l=b[1],m=b[2],w=xc(Cn,m,Le);we(Ua(fe),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+fe+"'"});var P={};return Oe!=null&&(P={bias:function(){return qv(Pt,w)}}),Object.assign({x:function(){return g0(l.shape,w,p,y,C)},filter:function(){return m0(l,w,p.shape,y,C)}},P)},"FusedConv2D",{convInfo:Yt,activation:Le},wn,[!0]);return Nt?vn.as3D(vn.shape[1],vn.shape[2],vn.shape[3]):vn}}),Wy=Lt({fusedDepthwiseConv2d_:function(_){var v=_.x,d=_.filter,y=_.strides,C=_.pad,z=_.dataFormat,Z=z===void 0?"NHWC":z,re=_.dilations,fe=re===void 0?[1,1]:re,xe=_.dimRoundingMode,Oe=_.bias,Re=_.activation,Le=Re===void 0?"linear":Re,Be=_.preluActivationWeights;if(Hf(He.state.gradientDepth,Le)===!1){var Xe=bm(v,d,y,C,Z,fe,xe);return Oe!=null&&(Xe=Jh(Xe,Oe)),$v(Xe,Le,Be)}var nt=Ze(v,"x","depthwiseConv2d"),tt=Ze(d,"filter","depthwiseConv2d"),ut=nt,Nt=!1;nt.rank===3&&(Nt=!0,ut=nt.as4D(1,nt.shape[0],nt.shape[1],nt.shape[2])),we(ut.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+ut.rank+"."}),we(tt.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+tt.rank+"."}),we(ut.shape[3]===tt.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+ut.shape[3]+") must match the inChannels dimension in filter "+tt.shape[2]+"."}),fe==null&&(fe=[1,1]),we(Ss(y,fe),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+fe+"'"}),xe!=null&&we(Ft(C),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+xe+" but got pad "+C+"."});var Pt,jt,Yt=cu(ut.shape,tt.shape,y,fe,C,xe,!0);Oe!=null&&(Pt=Zt(Pt=Ze(Oe,"bias","fused conv2d"),nt)[0],io(Yt.outShape,Pt.shape)),Be!=null&&(jt=Ze(Be,"prelu weights","fused depthwiseConv2d"));var gn={x:ut,filter:tt};Oe!=null&&(gn.bias=Pt),Be!=null&&(gn.preluActivationWeights=jt);var wn=[tt,ut],vn=He.runKernelFunc(function(Cn,Dn){var b=Cn.fusedDepthwiseConv2D({input:ut,filter:tt,convInfo:Yt,bias:Pt,activation:Le,preluActivationWeights:jt});return Dn([tt,ut,b]),b},gn,function(Cn,Dn){we(Ua(fe),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+fe+"'"});var b=Dn[0],p=Dn[1],l=Dn[2],m=xc(Cn,l,Le),w={};return Oe!=null&&(w={bias:function(){return qv(Pt,m)}}),Object.assign({x:function(){return v0(p.shape,m,b,Yt)},filter:function(){return vg(p,m,b.shape,Yt)}},w)},"FusedDepthwiseConv2D",{convInfo:Yt,activation:Le},wn,[!0]);return Nt?vn.as3D(vn.shape[1],vn.shape[2],vn.shape[3]):vn}}),O0=Object.freeze({matMul:sp,conv2d:Dm,depthwiseConv2d:Wy}),Mg=Object.freeze({image:A0,linalg:Og,losses:kg,spectral:Sg,fused:O0,signal:C0,square:a0,squaredDifference:Rd,conv1d:mg,conv2d:tp,conv3d:gg,depthwiseConv2d:bm,separableConv2d:kv,conv2dTranspose:$l,conv3dTranspose:Ly,op:Lt,batchNormalization2d:Ev,batchNormalization3d:pm,batchNormalization4d:f0,batchNormalization:W1,batchNorm:Fy,batchNorm2d:If,batchNorm3d:Yh,batchNorm4d:Ld,booleanMaskAsync:hg,complex:Co,real:xa,imag:Za,concat:$o,concat1d:Rh,concat2d:Yp,concat3d:gf,concat4d:Ph,split:$i,matMul:Av,dot:xm,outerProduct:Ov,reverse:jf,reverse1d:Tv,reverse2d:wm,reverse3d:yg,reverse4d:Mv,maxPool:Nv,avgPool:Iv,pool:qd,maxPool3d:By,avgPool3d:Fv,slice:Xl,slice1d:b0,slice2d:Rv,slice3d:$d,slice4d:Kl,abs:ll,acos:s0,acosh:u0,asin:ec,asinh:c0,atan:$h,atanh:lm,ceil:Iy,clipByValue:fm,cos:fl,cosh:dm,erf:mv,exp:gv,expm1:l0,floor:j1,log:z1,log1p:xo,logSigmoid:vv,neg:yv,reciprocal:og,round:bv,rsqrt:hm,sigmoid:Wl,sign:Vl,isNaN:xv,isInf:wv,isFinite:Xh,sin:Pd,sinh:Kh,softplus:U1,sqrt:ag,step:Hl,tan:tc,tanh:Mf,all:x0,any:Vc,argMax:w0,argMin:Pv,logSumExp:zf,max:jy,mean:np,min:rp,moments:Uf,sum:Lv,prod:Xd,equal:Uc,equalStrict:ic,greater:Ru,greaterEqual:ep,greaterEqualStrict:lg,greaterStrict:h0,less:p0,lessEqual:gm,lessEqualStrict:Vo,lessStrict:vm,notEqual:Wc,notEqualStrict:Hd,add:Jh,addN:Ry,addStrict:Py,atan2:ug,div:Rf,divNoNan:Gl,divStrict:mm,floorDiv:Qh,maximum:zd,maximumStrict:Pf,minimum:Lf,minimumStrict:rc,mod:Zh,modStrict:Ud,mul:ql,mulStrict:dl,pow:Wd,powStrict:cg,squaredDifferenceStrict:Vd,sub:hl,subStrict:ps,elu:Hc,leakyRelu:ip,prelu:_m,relu:xg,relu6:_0,selu:Bv,logicalAnd:Bd,logicalNot:Sv,logicalOr:d0,logicalXor:jd,where:go,whereAsync:Ff,buffer:Hi,print:_d,batchToSpaceND:Il,broadcastTo:vf,cast:em,clone:rg,cumsum:yf,depthToSpace:Bh,expandDims:Xo,eye:jh,multinomial:bf,oneHot:zh,pad:xf,pad1d:Fl,pad2d:il,pad3d:Uh,pad4d:Ed,rand:wf,randomNormal:ol,randomGamma:Zg,randomUniform:_f,reshape:ha,spaceToBatchND:za,squeeze:Ga,stack:Xi,tile:Ls,truncatedNormal:al,unstack:qa,setdiff1dAsync:sl,fill:Rs,linspace:Fh,ones:Fu,range:Rc,scalar:Ar,tensor:No,tensor1d:au,tensor2d:Eu,tensor3d:Dl,tensor4d:su,tensor5d:Ih,tensor6d:Xp,variable:Kp,zeros:uo,onesLike:_s,zerosLike:vi,transpose:ms,softmax:js,logSoftmax:vo,localResponseNormalization:jv,norm:op,gather:fg,unsortedSegmentSum:dg,basicLSTMCell:zv,multiRNNCell:wg,movingAverage:Wf,stridedSlice:Em,topk:Yl,scatterND:Uv,fft:_g,ifft:Eg,rfft:E0,irfft:pl,sparseToDense:Wv,gatherND:Jl,diag:Sm,dropout:Kd,hannWindow:Cg,hammingWindow:S0,frame:km,stft:Am,inTopKAsync:Vv});function Yr(_,v){Array.isArray(_)||(_=[_]),_.forEach(function(d){d!=null&&we(d.dtype!=="complex64",function(){return v+" does not support complex64 tensors."})})}function $(_,v,d,y){if(d==="linear")return _.linear(v);if(d==="relu")return _.relu(v);if(d==="elu")return _.elu(v);if(d==="relu6")return _.relu6(v);if(d==="prelu")return _.prelu(v,y);throw new Error("Activation "+d+" has not been implemented for the CPU backend.")}var M=function(_){function v(){var d=_.call(this)||this;return d.blockSize=48,d.firstUse=!0,d.data=new Af(d,He),d}return B(v,_),v.prototype.write=function(d,y,C){this.firstUse&&(this.firstUse=!1,j().get("IS_NODE")&&Ml(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var z={};return this.data.set(z,{values:d,dtype:C}),z},v.prototype.move=function(d,y,C,z){this.data.set(d,{values:y,dtype:z})},v.prototype.numDataIds=function(){return this.data.numDataIds()},v.prototype.read=function(d){return D(this,void 0,void 0,function(){return R(this,function(y){return[2,this.readSync(d)]})})},v.prototype.readSync=function(d){var y=this.data.get(d),C=y.dtype,z=y.complexTensors;return C==="complex64"?Yu(this.readSync(z.real.dataId),this.readSync(z.imag.dataId)):this.data.get(d).values},v.prototype.bufferSync=function(d){var y=this.readSync(d.dataId),C=y;if(d.dtype==="string")try{C=y.map(function(z){return On(z)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Hi(d.shape,d.dtype,C)},v.prototype.makeOutput=function(d,y,C){var z=this.write(d,y,C);return He.makeTensorFromDataId(z,y,C,this)},v.prototype.disposeData=function(d){if(this.data.has(d)){var y=this.data.get(d).complexTensors;y!=null&&(y.real.dispose(),y.imag.dispose()),this.data.delete(d)}},v.prototype.time=function(d){return D(this,void 0,void 0,function(){var y;return R(this,function(C){return y=en(),d(),[2,{kernelMs:en()-y}]})})},v.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},v.prototype.complex=function(d,y){var C=this.makeOutput(null,d.shape,"complex64");return this.data.get(C.dataId).complexTensors={real:He.keep(d.clone()),imag:He.keep(y.clone())},C},v.prototype.real=function(d){return this.data.get(d.dataId).complexTensors.real.clone()},v.prototype.imag=function(d){return this.data.get(d.dataId).complexTensors.imag.clone()},v.prototype.slice=function(d,y,C){if(Yr(d,"slice"),Ad(d.shape,y,C)){var z=Vh(y,d.strides),Z=ze(C);return No(this.readSync(d.dataId).subarray(z,z+Z),C,d.dtype)}for(var re=Hi(C,d.dtype),fe=this.bufferSync(d),xe=0;xe<re.size;++xe){var Oe=re.indexToLoc(xe).map(function(Re,Le){return Re+y[Le]});re.values[xe]=fe.get.apply(fe,Oe)}return re.toTensor()},v.prototype.stridedSlice=function(d,y,C,z){Yr(d,"stridedSlice");var Z=Sf(y,C,z);if(Z.some(function(Be){return Be===0}))return No([],Z);for(var re=Hi(Z,d.dtype),fe=this.bufferSync(d),xe=0;xe<re.size;xe++){for(var Oe=re.indexToLoc(xe),Re=new Array(Oe.length),Le=0;Le<Re.length;Le++)Re[Le]=Oe[Le]*z[Le]+y[Le];re.set.apply(re,[fe.get.apply(fe,Re)].concat(Oe))}return re.toTensor()},v.prototype.diag=function(d){for(var y=this.readSync(d.dataId),C=Hi([d.size,d.size],d.dtype),z=C.values,Z=0;Z<y.length;Z++)z[Z*d.size+Z]=y[Z];return C.toTensor()},v.prototype.unstack=function(d,y){for(var C=d.shape[y],z=new Array(d.rank-1),Z=0,re=0;re<d.rank;re++)re!==y&&(z[Z++]=d.shape[re]);var fe=new Array(d.rank).fill(0),xe=d.shape.slice();xe[y]=1;var Oe=new Array(C);for(re=0;re<Oe.length;re++)fe[y]=re,Oe[re]=this.slice(d,fe,xe).reshape(z);return Oe},v.prototype.reverse=function(d,y){Yr(d,"reverse");for(var C=Hi(d.shape,d.dtype),z=this.bufferSync(d),Z=function(fe){var xe=C.indexToLoc(fe),Oe=xe.slice();y.forEach(function(Re){return Oe[Re]=d.shape[Re]-1-Oe[Re]}),C.set.apply(C,[z.get.apply(z,Oe)].concat(xe))},re=0;re<C.size;re++)Z(re);return C.toTensor()},v.prototype.concat=function(d,y){var C=this;if(d[0].dtype==="complex64"){var z=d.map(function(Be){return xa(Be)}),Z=d.map(function(Be){return Za(Be)});return Co(this.concat(z,y),this.concat(Z,y))}var re=d.map(function(Be){var Xe=ze(Be.shape.slice(y));return Be.as2D(-1,Xe)}),fe=_u(re.map(function(Be){return Be.shape}),1),xe=Hi(fe,d[0].dtype).values;if(re[0].shape[0]===1){var Oe=0;re.forEach(function(Be){xe.set(C.readSync(Be.dataId),Oe),Oe+=Be.size})}else{var Re=0;re.forEach(function(Be){for(var Xe=C.readSync(Be.dataId),nt=0,tt=0;tt<Be.shape[0];++tt)for(var ut=tt*fe[1]+Re,Nt=0;Nt<Be.shape[1];++Nt)xe[ut+Nt]=Xe[nt++];Re+=Be.shape[1]})}var Le=_u(d.map(function(Be){return Be.shape}),y);return No(xe,Le,d[0].dtype)},v.prototype.neg=function(d){return Yr(d,"neg"),this.multiply(Ar(-1),d)},v.prototype.add=function(d,y){return d.dtype==="complex64"||y.dtype==="complex64"?this.broadcastedBinaryComplexOp(d.cast("complex64"),y.cast("complex64"),function(C,z,Z,re){return{real:C+Z,imag:z+re}}):this.broadcastedBinaryOp(d,y,Sn(d.dtype,y.dtype),function(C,z){return C+z})},v.prototype.addN=function(d){var y=this;Yr(d,"addN");for(var C=d.map(function(Oe){return y.readSync(Oe.dataId)}),z=Hi(d[0].shape,d[0].dtype),Z=z.values,re=0;re<d.length;re++)for(var fe=C[re],xe=0;xe<Z.length;xe++)Z[xe]+=fe[xe];return z.toTensor()},v.prototype.softmax=function(d,y){var C=Xt([y],d.shape),z=this.max(d,C),Z=Lo(z.shape,C),re=this.subtract(d,z.reshape(Z)),fe=this.exp(re),xe=this.sum(fe,C).reshape(Z);return this.realDivide(fe,xe)},v.prototype.subtract=function(d,y){return d.dtype==="complex64"||y.dtype==="complex64"?this.broadcastedBinaryComplexOp(d.cast("complex64"),y.cast("complex64"),function(C,z,Z,re){return{real:C-Z,imag:z-re}}):this.broadcastedBinaryOp(d,y,Sn(d.dtype,y.dtype),function(C,z){return C-z})},v.prototype.pow=function(d,y){return Yr([d,y],"pow"),this.broadcastedBinaryOp(d,y,d.dtype,function(C,z){return Math.pow(C,z)})},v.prototype.batchMatMul=function(d,y,C,z){Yr([d,y],"matMul");for(var Z=C?d.shape[1]:d.shape[2],re=C?d.shape[2]:d.shape[1],fe=z?y.shape[1]:y.shape[2],xe=d.shape[0],Oe=this.readSync(d.dataId),Re=this.readSync(y.dataId),Le=C?[d.strides[0],1,d.strides[1]]:[d.strides[0],d.strides[1],1],Be=Le[0],Xe=Le[1],nt=Le[2],tt=z?[1,y.strides[1],y.strides[0]]:[y.strides[1],1,y.strides[0]],ut=tt[0],Nt=tt[1],Pt=tt[2],jt=re*fe,Yt=Hi([xe,re,fe],d.dtype),gn=Yt.values,wn=this.blockSize,vn=0;vn<xe;vn++)for(var Cn=0;Cn<re;Cn+=wn)for(var Dn=0;Dn<fe;Dn+=wn)for(var b=0;b<Z;b+=wn)for(var p=Math.min(Cn+wn,re),l=Math.min(Dn+wn,fe),m=Math.min(b+wn,Z),w=Cn;w<p;w++)for(var P=Dn;P<l;P++){for(var K=0,ee=b;ee<m;ee++)K+=Oe[vn*Be+w*Xe+ee*nt]*Re[ee*ut+P*Nt+vn*Pt];gn[vn*jt+(w*fe+P)]+=K}return Yt.toTensor()},v.prototype.fusedBatchMatMul=function(d){var y=d.a,C=d.b,z=d.transposeA,Z=d.transposeB,re=d.bias,fe=d.activation,xe=d.preluActivationWeights,Oe=this.batchMatMul(y,C,z,Z);return re&&(Oe=this.add(Oe,re)),fe&&(Oe=$(this,Oe,fe,xe)),Oe},v.prototype.multiply=function(d,y){return d.dtype==="complex64"||y.dtype==="complex64"?this.broadcastedBinaryComplexOp(d.cast("complex64"),y.cast("complex64"),function(C,z,Z,re){return{real:C*Z-z*re,imag:C*re+z*Z}}):this.broadcastedBinaryOp(d,y,Sn(d.dtype,y.dtype),function(C,z){return C*z})},v.prototype.realDivide=function(d,y){return Yr([d,y],"realDivide"),this.broadcastedBinaryOp(d,y,"float32",function(C,z){return C/z})},v.prototype.floorDiv=function(d,y){return Yr([d,y],"floorDiv"),this.broadcastedBinaryOp(d,y,"int32",function(C,z){return Math.floor(C/z)})},v.prototype.sum=function(d,y){Yr(d,"sum"),ia("sum",y,d.rank);for(var C=Po(d.shape,y),z=C[0],Z=C[1],re=uo(z,Sn(d.dtype,"int32")),fe=ze(Z),xe=this.readSync(re.dataId),Oe=this.readSync(d.dataId),Re=0;Re<xe.length;++Re){for(var Le=Re*fe,Be=0,Xe=0;Xe<fe;++Xe)Be+=Oe[Le+Xe];xe[Re]=Be}return re},v.prototype.prod=function(d,y){Yr(d,"sum");for(var C=Po(d.shape,y),z=C[0],Z=C[1],re=uo(z,Sn(d.dtype,"int32")),fe=ze(Z),xe=this.readSync(re.dataId),Oe=this.readSync(d.dataId),Re=0;Re<xe.length;++Re){for(var Le=Re*fe,Be=1,Xe=0;Xe<fe;++Xe)Be*=Oe[Le+Xe];xe[Re]=Be}return re},v.prototype.unsortedSegmentSum=function(d,y,C){Yr(d,"unsortedSegmentSum");for(var z=[],Z=d.rank-y.rank,re=0;re<Z;++re)y=y.expandDims(re+1);for(re=0;re<C;++re){var fe=Ar(re,"int32"),xe=Uc(fe,y).asType("float32").mul(d).sum(0);z.push(xe)}return Xi(z)},v.prototype.argMin=function(d,y){Yr(d,"argMin");var C=[y];ia("argMin",C,d.rank);for(var z=Po(d.shape,C),Z=z[0],re=z[1],fe=uo(Z,"int32"),xe=ze(re),Oe=this.readSync(fe.dataId),Re=this.readSync(d.dataId),Le=0;Le<Oe.length;++Le){for(var Be=Le*xe,Xe=Re[Be],nt=0,tt=0;tt<xe;++tt){var ut=Re[Be+tt];ut<Xe&&(Xe=ut,nt=tt)}Oe[Le]=nt}return fe},v.prototype.argMax=function(d,y){Yr(d,"argMax");var C=[y];ia("argMax",C,d.rank);for(var z=Po(d.shape,C),Z=z[0],re=z[1],fe=uo(Z,"int32"),xe=ze(re),Oe=this.readSync(fe.dataId),Re=this.readSync(d.dataId),Le=0;Le<Oe.length;++Le){for(var Be=Le*xe,Xe=Re[Be],nt=0,tt=0;tt<xe;++tt){var ut=Re[Be+tt];ut>Xe&&(Xe=ut,nt=tt)}Oe[Le]=nt}return fe},v.prototype.cumsum=function(d,y,C,z){if(Yr(d,"cumsum"),y!==d.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(d.rank-1)+" but got axis="+y);for(var Z=Sn(d.dtype,"int32"),re=uo(d.shape,Z),fe=this.readSync(re.dataId),xe=this.readSync(d.dataId),Oe=d.shape[d.rank-1],Re=z?function(tt,ut){return tt+Oe-ut-1}:function(tt,ut){return tt+ut},Le=0;Le<xe.length;Le+=Oe)for(var Be=0;Be<Oe;Be++){var Xe=Re(Le,Be);if(Be===0)fe[Xe]=C?0:xe[Xe];else{var nt=Re(Le,Be-1);fe[Xe]=C?xe[nt]+fe[nt]:xe[Xe]+fe[nt]}}return re},v.prototype.equal=function(d,y){return Yr([d,y],"equal"),this.broadcastedBinaryOp(d,y,"bool",function(C,z){return C===z?1:0})},v.prototype.notEqual=function(d,y){return Yr([d,y],"notEqual"),this.broadcastedBinaryOp(d,y,"bool",function(C,z){return C!==z?1:0})},v.prototype.less=function(d,y){return Yr([d,y],"less"),this.broadcastedBinaryOp(d,y,"bool",function(C,z){return C<z?1:0})},v.prototype.lessEqual=function(d,y){return Yr([d,y],"lessEqual"),this.broadcastedBinaryOp(d,y,"bool",function(C,z){return C<=z?1:0})},v.prototype.greater=function(d,y){return Yr([d,y],"greater"),this.broadcastedBinaryOp(d,y,"bool",function(C,z){return C>z?1:0})},v.prototype.greaterEqual=function(d,y){return Yr([d,y],"greaterEqual"),this.broadcastedBinaryOp(d,y,"bool",function(C,z){return C>=z?1:0})},v.prototype.logicalNot=function(d){Yr(d,"logicalNot");for(var y=this.readSync(d.dataId),C=new Uint8Array(y.length),z=0;z<y.length;++z)C[z]=y[z]?0:1;return this.makeOutput(C,d.shape,"bool")},v.prototype.logicalAnd=function(d,y){return Yr([d,y],"logicalAnd"),this.broadcastedBinaryOp(d,y,"bool",function(C,z){return C&&z})},v.prototype.logicalOr=function(d,y){return Yr([d,y],"logicalOr"),this.broadcastedBinaryOp(d,y,"bool",function(C,z){return C||z})},v.prototype.select=function(d,y,C){Yr([d,y,C],"select");for(var z=this.readSync(d.dataId),Z=this.readSync(y.dataId),re=this.readSync(C.dataId),fe=uo(y.shape,Sn(y.dtype,C.dtype)),xe=this.readSync(fe.dataId),Oe=0,Re=d.rank===0||d.rank>1||y.rank===1?1:ze(y.shape.slice(1)),Le=0;Le<z.length;Le++)for(var Be=0;Be<Re;Be++)z[Le]===1?xe[Oe++]=Z[Le]:xe[Oe++]=re[Le];return fe},v.prototype.where=function(d){Yr([d],"where");var y=this.readSync(d.dataId);return ne(d.shape,y)},v.prototype.topk=function(d,y,C){return Yr(d,"topk"),se(this.readSync(d.dataId),d.shape,d.dtype,y)},v.prototype.min=function(d,y){Yr(d,"min"),ia("min",y,d.rank);for(var C=Po(d.shape,y),z=C[0],Z=C[1],re=uo(z,d.dtype),fe=ze(Z),xe=this.readSync(re.dataId),Oe=this.readSync(d.dataId),Re=0;Re<xe.length;++Re){for(var Le=Re*fe,Be=Oe[Le],Xe=0;Xe<fe;++Xe){var nt=Oe[Le+Xe];nt<Be&&(Be=nt)}xe[Re]=Be}return re},v.prototype.minimum=function(d,y){return Yr([d,y],"minimum"),this.broadcastedBinaryOp(d,y,d.dtype,function(C,z){return Math.min(C,z)})},v.prototype.mod=function(d,y){return Yr([d,y],"mod"),this.broadcastedBinaryOp(d,y,d.dtype,function(C,z){var Z=C%z;return C<0&&z<0||C>=0&&z>=0?Z:(Z+z)%z})},v.prototype.max=function(d,y){Yr(d,"max"),ia("max",y,d.rank);for(var C=Po(d.shape,y),z=C[0],Z=C[1],re=uo(z,d.dtype),fe=ze(Z),xe=this.readSync(re.dataId),Oe=this.readSync(d.dataId),Re=0;Re<xe.length;++Re){for(var Le=Re*fe,Be=Oe[Le],Xe=0;Xe<fe;++Xe){var nt=Oe[Le+Xe];nt>Be&&(Be=nt)}xe[Re]=Be}return re},v.prototype.maximum=function(d,y){return Yr([d,y],"maximum"),this.broadcastedBinaryOp(d,y,d.dtype,function(C,z){return Math.max(C,z)})},v.prototype.all=function(d,y){Yr(d,"all"),ia("all",y,d.rank);for(var C=Po(d.shape,y),z=C[0],Z=C[1],re=uo(z,d.dtype),fe=ze(Z),xe=this.readSync(re.dataId),Oe=this.readSync(d.dataId),Re=0;Re<xe.length;++Re){for(var Le=Re*fe,Be=Oe[Le],Xe=0;Xe<fe;++Xe){var nt=Oe[Le+Xe];Be=Be&&nt}xe[Re]=Be}return re},v.prototype.any=function(d,y){Yr(d,"any"),ia("any",y,d.rank);for(var C=Po(d.shape,y),z=C[0],Z=C[1],re=uo(z,d.dtype),fe=ze(Z),xe=this.readSync(re.dataId),Oe=this.readSync(d.dataId),Re=0;Re<xe.length;++Re){for(var Le=Re*fe,Be=Oe[Le],Xe=0;Xe<fe;++Xe){var nt=Oe[Le+Xe];Be=Be||nt}xe[Re]=Be}return re},v.prototype.squaredDifference=function(d,y){return Yr([d,y],"squaredDifference"),this.broadcastedBinaryOp(d,y,d.dtype,function(C,z){var Z=C-z;return Z*Z})},v.prototype.ceil=function(d){Yr(d,"ceil");for(var y=this.readSync(d.dataId),C=new Float32Array(y.length),z=0;z<y.length;++z)C[z]=Math.ceil(y[z]);return this.makeOutput(C,d.shape,"float32")},v.prototype.floor=function(d){Yr(d,"floor");for(var y=this.readSync(d.dataId),C=new Float32Array(y.length),z=0;z<y.length;++z)C[z]=Math.floor(y[z]);return this.makeOutput(C,d.shape,"float32")},v.prototype.sign=function(d){Yr(d,"x");for(var y=this.readSync(d.dataId),C=new Float32Array(y.length),z=0;z<y.length;++z)y[z]<0?C[z]=-1:y[z]>0?C[z]=1:C[z]=0;return this.makeOutput(C,d.shape,"float32")},v.prototype.isNaN=function(d){Yr(d,"x");for(var y=this.readSync(d.dataId),C=new Uint8Array(y.length),z=0;z<y.length;++z)Number.isNaN(y[z])&&(C[z]=1);return this.makeOutput(C,d.shape,"bool")},v.prototype.isInf=function(d){Yr(d,"x");for(var y=this.readSync(d.dataId),C=new Uint8Array(y.length),z=0;z<y.length;++z)Math.abs(y[z])===1/0&&(C[z]=1);return this.makeOutput(C,d.shape,"bool")},v.prototype.isFinite=function(d){Yr(d,"x");for(var y=this.readSync(d.dataId),C=new Uint8Array(y.length),z=0;z<y.length;++z)Number.isFinite(y[z])&&(C[z]=1);return this.makeOutput(C,d.shape,"bool")},v.prototype.round=function(d){Yr(d,"round");for(var y=this.readSync(d.dataId),C=new Float32Array(y.length),z=0;z<y.length;++z){var Z=Math.floor(y[z]);y[z]-Z<.5?C[z]=Math.floor(y[z]):y[z]-Z>.5?C[z]=Math.ceil(y[z]):C[z]=Z%2==0?Z:Z+1}return this.makeOutput(C,d.shape,"float32")},v.prototype.exp=function(d){Yr(d,"exp");for(var y=this.readSync(d.dataId),C=new Float32Array(y.length),z=0;z<y.length;++z)C[z]=Math.exp(y[z]);return this.makeOutput(C,d.shape,"float32")},v.prototype.expm1=function(d){Yr(d,"expm1");for(var y=this.readSync(d.dataId),C=new Float32Array(y.length),z=0;z<y.length;++z)C[z]=Math.expm1(y[z]);return this.makeOutput(C,d.shape,"float32")},v.prototype.log=function(d){Yr(d,"log");for(var y=this.readSync(d.dataId),C=new Float32Array(y.length),z=0;z<y.length;++z){var Z=y[z];C[z]=Math.log(Z)}return this.makeOutput(C,d.shape,"float32")},v.prototype.log1p=function(d){Yr(d,"log1p");for(var y=this.readSync(d.dataId),C=new Float32Array(y.length),z=0;z<y.length;++z){var Z=y[z];C[z]=Math.log1p(Z)}return this.makeOutput(C,d.shape,"float32")},v.prototype.sqrt=function(d){Yr(d,"sqrt");for(var y=this.readSync(d.dataId),C=new Float32Array(y.length),z=0;z<y.length;++z){var Z=y[z];C[z]=Math.sqrt(Z)}return this.makeOutput(C,d.shape,"float32")},v.prototype.rsqrt=function(d){Yr(d,"rsqrt");for(var y=this.readSync(d.dataId),C=new Float32Array(y.length),z=0;z<y.length;++z){var Z=y[z];C[z]=1/Math.sqrt(Z)}return this.makeOutput(C,d.shape,"float32")},v.prototype.reciprocal=function(d){Yr(d,"reciprocal");for(var y=this.readSync(d.dataId),C=new Float32Array(y.length),z=0;z<y.length;++z)C[z]=1/y[z];return this.makeOutput(C,d.shape,"float32")},v.prototype.linear=function(d){return d},v.prototype.relu=function(d){Yr(d,"relu");for(var y=uo(d.shape,d.dtype),C=this.readSync(y.dataId),z=this.readSync(d.dataId),Z=0;Z<z.length;++Z)C[Z]=Math.max(0,z[Z]);return y},v.prototype.relu6=function(d){Yr(d,"relu");for(var y=uo(d.shape,d.dtype),C=this.readSync(y.dataId),z=this.readSync(d.dataId),Z=0;Z<z.length;++Z)C[Z]=Math.min(Math.max(0,z[Z]),6);return y},v.prototype.prelu=function(d,y){return Yr([d,y],"prelu"),this.broadcastedBinaryOp(d,y,d.dtype,function(C,z){return C<0?z*C:C})},v.prototype.elu=function(d){Yr(d,"elu");for(var y=new Float32Array(d.size),C=this.readSync(d.dataId),z=0;z<C.length;++z){var Z=C[z];y[z]=Z>=0?Z:Math.exp(Z)-1}return this.makeOutput(y,d.shape,"float32")},v.prototype.eluDer=function(d,y){Yr([d,y],"eluDer");for(var C=new Float32Array(y.size),z=this.readSync(y.dataId),Z=this.readSync(d.dataId),re=0;re<z.length;++re){var fe=z[re];C[re]=fe>=1?Z[re]:Z[re]*(fe+1)}return this.makeOutput(C,y.shape,"float32")},v.prototype.selu=function(d){Yr(d,"selu");for(var y=new Float32Array(d.size),C=this.readSync(d.dataId),z=0;z<C.length;++z){var Z=C[z];y[z]=Z>=0?1.0507009873554805*Z:1.7580993408473768*(Math.exp(Z)-1)}return this.makeOutput(y,d.shape,"float32")},v.prototype.clip=function(d,y,C){Yr(d,"clip");for(var z=new Float32Array(d.size),Z=this.readSync(d.dataId),re=0;re<Z.length;++re){var fe=Z[re];z[re]=fe>C?C:fe<y?y:fe}return this.makeOutput(z,d.shape,"float32")},v.prototype.abs=function(d){for(var y=new Float32Array(d.size),C=this.readSync(d.dataId),z=0;z<C.length;++z)y[z]=Math.abs(C[z]);return this.makeOutput(y,d.shape,"float32")},v.prototype.complexAbs=function(d){for(var y=new Float32Array(d.size),C=this.readSync(d.dataId),z=0;z<d.size;++z){var Z=C[2*z],re=C[2*z+1];y[z]=Math.hypot(Z,re)}return this.makeOutput(y,d.shape,"float32")},v.prototype.int=function(d){Yr(d,"int");for(var y=new Int32Array(d.size),C=this.readSync(d.dataId),z=0;z<C.length;++z)y[z]=C[z];return this.makeOutput(y,d.shape,"int32")},v.prototype.sigmoid=function(d){Yr(d,"sigmoid");for(var y=new Float32Array(d.size),C=this.readSync(d.dataId),z=0;z<C.length;++z)y[z]=1/(1+Math.exp(-C[z]));return this.makeOutput(y,d.shape,"float32")},v.prototype.softplus=function(d){Yr(d,"softplus");for(var y=Math.log(11920928955078125e-23)+2,C=new Float32Array(d.size),z=this.readSync(d.dataId),Z=0;Z<z.length;++Z){var re,fe=z[Z]>-y,xe=z[Z]<y,Oe=Math.exp(z[Z]);re=xe?Oe:fe?z[Z]:Math.log(1+Oe),C[Z]=re}return this.makeOutput(C,d.shape,"float32")},v.prototype.sin=function(d){Yr(d,"sin");for(var y=new Float32Array(d.size),C=this.readSync(d.dataId),z=0;z<C.length;++z)y[z]=Math.sin(C[z]);return this.makeOutput(y,d.shape,"float32")},v.prototype.cos=function(d){Yr(d,"cos");for(var y=new Float32Array(d.size),C=this.readSync(d.dataId),z=0;z<C.length;++z)y[z]=Math.cos(C[z]);return this.makeOutput(y,d.shape,"float32")},v.prototype.tan=function(d){Yr(d,"tan");for(var y=new Float32Array(d.size),C=this.readSync(d.dataId),z=0;z<C.length;++z)y[z]=Math.tan(C[z]);return this.makeOutput(y,d.shape,"float32")},v.prototype.asin=function(d){Yr(d,"asin");for(var y=new Float32Array(d.size),C=this.readSync(d.dataId),z=0;z<C.length;++z)y[z]=Math.asin(C[z]);return this.makeOutput(y,d.shape,"float32")},v.prototype.acos=function(d){Yr(d,"acos");for(var y=new Float32Array(d.size),C=this.readSync(d.dataId),z=0;z<C.length;++z)y[z]=Math.acos(C[z]);return this.makeOutput(y,d.shape,"float32")},v.prototype.atan=function(d){Yr(d,"atan");for(var y=new Float32Array(d.size),C=this.readSync(d.dataId),z=0;z<C.length;++z)y[z]=Math.atan(C[z]);return this.makeOutput(y,d.shape,"float32")},v.prototype.atan2=function(d,y){return Yr([d,y],"atan2"),this.broadcastedBinaryOp(d,y,d.dtype,function(C,z){return Math.atan2(C,z)})},v.prototype.sinh=function(d){Yr(d,"sinh");for(var y=new Float32Array(d.size),C=this.readSync(d.dataId),z=0;z<C.length;++z)y[z]=Math.sinh(C[z]);return this.makeOutput(y,d.shape,"float32")},v.prototype.cosh=function(d){Yr(d,"cosh");for(var y=new Float32Array(d.size),C=this.readSync(d.dataId),z=0;z<C.length;++z)y[z]=Math.cosh(C[z]);return this.makeOutput(y,d.shape,"float32")},v.prototype.tanh=function(d){Yr(d,"tanh");for(var y=new Float32Array(d.size),C=this.readSync(d.dataId),z=0;z<C.length;++z)y[z]=pt(C[z]);return this.makeOutput(y,d.shape,"float32")},v.prototype.asinh=function(d){Yr(d,"asinh");for(var y=new Float32Array(d.size),C=this.readSync(d.dataId),z=0;z<C.length;++z)y[z]=Math.asinh(C[z]);return this.makeOutput(y,d.shape,"float32")},v.prototype.acosh=function(d){Yr(d,"acosh");for(var y=new Float32Array(d.size),C=this.readSync(d.dataId),z=0;z<C.length;++z)y[z]=Math.acosh(C[z]);return this.makeOutput(y,d.shape,"float32")},v.prototype.atanh=function(d){Yr(d,"atanh");for(var y=new Float32Array(d.size),C=this.readSync(d.dataId),z=0;z<C.length;++z)y[z]=Math.atanh(C[z]);return this.makeOutput(y,d.shape,"float32")},v.prototype.erf=function(d){Yr(d,"erf");for(var y=new Float32Array(d.size),C=this.readSync(d.dataId),z=0;z<C.length;++z){var Z=Math.sign(C[z]),re=Math.abs(C[z]),fe=1/(1+.3275911*re);y[z]=Z*(1-((((1.061405429*fe-1.453152027)*fe+1.421413741)*fe-.284496736)*fe+.254829592)*fe*Math.exp(-re*re))}return this.makeOutput(y,d.shape,"float32")},v.prototype.step=function(d,y){y===void 0&&(y=0),Yr(d,"step");for(var C=new Float32Array(d.size),z=this.readSync(d.dataId),Z=0;Z<z.length;++Z){var re=z[Z];isNaN(re)?C[Z]=NaN:C[Z]=re>0?1:y}return this.makeOutput(C,d.shape,"float32")},v.prototype.fusedConv2d=function(d){var y=d.input,C=d.filter,z=d.convInfo,Z=d.bias,re=d.activation,fe=d.preluActivationWeights,xe=this.conv2d(y,C,z);return Z&&(xe=this.add(xe,Z)),re&&(xe=$(this,xe,re,fe)),xe},v.prototype.conv2d=function(d,y,C){Yr([d,y],"conv2d");for(var z=C.filterHeight,Z=C.filterWidth,re=C.dilationHeight,fe=C.dilationWidth,xe=C.padInfo.left,Oe=C.padInfo.top,Re=C.dataFormat==="channelsLast",Le=Hi(C.outShape,d.dtype),Be=d.strides[0],Xe=Re?d.strides[1]:d.strides[2],nt=Re?d.strides[2]:1,tt=Re?1:d.strides[1],ut=Le.strides[0],Nt=Re?Le.strides[1]:Le.strides[2],Pt=Re?Le.strides[2]:1,jt=Re?1:Le.strides[1],Yt=this.readSync(d.dataId),gn=this.readSync(y.dataId),wn=Le.values,vn=0;vn<C.batchSize;++vn)for(var Cn=vn*Be,Dn=vn*ut,b=0;b<C.outHeight;++b)for(var p=Dn+b*Nt,l=b*C.strideHeight-Oe,m=0;m<z;m++){var w=l+m*re;if(!(w<0||w>=C.inHeight))for(var P=m*y.strides[0],K=Cn+w*Xe,ee=0;ee<C.outWidth;++ee)for(var le=p+ee*Pt,de=ee*C.strideWidth-xe,Ee=0;Ee<Z;Ee++){var Te=de+Ee*fe;if(!(Te<0||Te>=C.inWidth))for(var Ne=K+Te*nt,Fe=P+Ee*y.strides[1],qe=0;qe<C.inChannels;++qe){for(var Je=Yt[Ne+qe*tt],Ke=0;Ke<C.outChannels;++Ke)wn[le+Ke*jt]+=Je*gn[Fe+Ke];Fe+=C.outChannels}}}return Le.toTensor()},v.prototype.conv3d=function(d,y,C){for(var z=C.filterDepth,Z=C.filterHeight,re=C.filterWidth,fe=C.dilationDepth,xe=C.dilationHeight,Oe=C.dilationWidth,Re=C.padInfo.front,Le=C.padInfo.left,Be=C.padInfo.top,Xe=Hi(C.outShape,d.dtype),nt=this.readSync(d.dataId),tt=this.readSync(y.dataId),ut=Xe.values,Nt=0;Nt<C.batchSize;++Nt)for(var Pt=Nt*d.strides[0],jt=Nt*Xe.strides[0],Yt=0;Yt<C.outDepth;++Yt)for(var gn=jt+Yt*Xe.strides[1],wn=Yt*C.strideDepth-Re,vn=0;vn<z;vn++){var Cn=wn+vn*fe;if(!(Cn<0||Cn>=C.inDepth))for(var Dn=vn*y.strides[0],b=Pt+Cn*d.strides[1],p=0;p<C.outHeight;++p)for(var l=gn+p*Xe.strides[2],m=p*C.strideHeight-Be,w=0;w<Z;w++){var P=m+w*xe;if(!(P<0||P>=C.inHeight))for(var K=Dn+w*y.strides[1],ee=b+P*d.strides[2],le=0;le<C.outWidth;++le)for(var de=l+le*C.outChannels,Ee=le*C.strideWidth-Le,Te=0;Te<re;Te++){var Ne=Ee+Te*Oe;if(!(Ne<0||Ne>=C.inWidth))for(var Fe=K+Te*y.strides[2],qe=ee+Ne*C.inChannels,Je=Fe,Ke=0;Ke<C.inChannels;++Ke){for(var it=nt[qe+Ke],gt=0;gt<C.outChannels;++gt)ut[de+gt]+=it*tt[Je+gt];Je+=C.outChannels}}}}return Xe.toTensor()},v.prototype.conv2dDerInput=function(d,y,C){Yr([d,y],"conv2dDerInput");for(var z=Hi(C.inShape,"float32"),Z=z.values,re=this.readSync(d.dataId),fe=this.readSync(y.dataId),xe=y.strides,Oe=xe[0],Re=xe[1],Le=xe[2],Be=C.batchSize,Xe=C.filterHeight,nt=C.filterWidth,tt=C.inChannels,ut=C.inHeight,Nt=C.inWidth,Pt=C.outChannels,jt=C.outHeight,Yt=C.outWidth,gn=C.strideHeight,wn=C.strideWidth,vn=C.dataFormat,Cn=Xe-1-C.padInfo.top,Dn=nt-1-C.padInfo.left,b=vn==="channelsLast",p=z.strides[0],l=b?z.strides[1]:z.strides[2],m=b?z.strides[2]:1,w=b?1:z.strides[1],P=d.strides[0],K=b?d.strides[1]:d.strides[2],ee=b?d.strides[2]:1,le=b?1:d.strides[1],de=0;de<Be;++de)for(var Ee=0;Ee<tt;++Ee)for(var Te=0;Te<ut;++Te)for(var Ne=Te-Cn,Fe=Math.max(0,Math.ceil(Ne/gn)),qe=Math.min(jt,(Xe+Ne)/gn),Je=0;Je<Nt;++Je){for(var Ke=Je-Dn,it=Math.max(0,Math.ceil(Ke/wn)),gt=Math.min(Yt,(nt+Ke)/wn),Et=0,At=Fe;At<qe;++At)for(var Wt=At*gn-Ne,cn=it;cn<gt;++cn)for(var pn=P*de+K*At+ee*cn,ln=Oe*(Xe-1-Wt)+Re*(nt-1-(cn*wn-Ke))+Le*Ee,dn=0;dn<Pt;++dn)Et+=re[pn+le*dn]*fe[ln+dn];Z[p*de+l*Te+m*Je+w*Ee]=Et}return z.toTensor()},v.prototype.conv3dDerInput=function(d,y,C){for(var z=Hi(C.inShape,"float32"),Z=z.values,re=z.strides,fe=re[0],xe=re[1],Oe=re[2],Re=re[3],Le=this.readSync(d.dataId),Be=d.strides,Xe=Be[0],nt=Be[1],tt=Be[2],ut=Be[3],Nt=this.readSync(y.dataId),Pt=y.strides,jt=Pt[0],Yt=Pt[1],gn=Pt[2],wn=Pt[3],vn=C.batchSize,Cn=C.filterDepth,Dn=C.filterHeight,b=C.filterWidth,p=C.inChannels,l=C.inDepth,m=C.inHeight,w=C.inWidth,P=C.outChannels,K=C.outDepth,ee=C.outHeight,le=C.outWidth,de=C.strideDepth,Ee=C.strideHeight,Te=C.strideWidth,Ne=Cn-1-C.padInfo.front,Fe=Dn-1-C.padInfo.top,qe=b-1-C.padInfo.left,Je=0;Je<vn;++Je)for(var Ke=0;Ke<p;++Ke)for(var it=0;it<l;++it)for(var gt=it-Ne,Et=Math.max(0,Math.ceil(gt/de)),At=Math.min(K,(Cn+gt)/de),Wt=0;Wt<m;++Wt)for(var cn=Wt-Fe,pn=Math.max(0,Math.ceil(cn/Ee)),ln=Math.min(ee,(Dn+cn)/Ee),dn=0;dn<w;++dn){for(var Nn=dn-qe,jn=Math.max(0,Math.ceil(Nn/Te)),Ln=Math.min(le,(b+Nn)/Te),ur=0,hr=Et;hr<At;++hr)for(var xr=hr*de-gt,Er=pn;Er<ln;++Er)for(var wr=Er*Ee-cn,vr=jn;vr<Ln;++vr)for(var Lr=Xe*Je+nt*hr+tt*Er+ut*vr,Pr=jt*(Cn-1-xr)+Yt*(Dn-1-wr)+gn*(b-1-(vr*Te-Nn))+wn*Ke,ei=0;ei<P;++ei)ur+=Le[Lr+ei]*Nt[Pr+ei];Z[fe*Je+xe*it+Oe*Wt+Re*dn+Ke]=ur}return z.toTensor()},v.prototype.conv2dDerFilter=function(d,y,C){Yr([d,y],"conv2dDerFilter");for(var z=C.strideHeight,Z=C.strideWidth,re=C.filterHeight,fe=C.filterWidth,xe=C.dataFormat==="channelsLast",Oe=Hi(C.filterShape,"float32"),Re=C.padInfo.left,Le=C.padInfo.top,Be=this.bufferSync(d),Xe=this.bufferSync(y),nt=0;nt<re;++nt)for(var tt=Math.max(0,Math.ceil((Le-nt)/z)),ut=Math.min(C.outHeight,(C.inHeight+Le-nt)/z),Nt=0;Nt<fe;++Nt)for(var Pt=Math.max(0,Math.ceil((Re-Nt)/Z)),jt=Math.min(C.outWidth,(C.inWidth+Re-Nt)/Z),Yt=0;Yt<C.inChannels;++Yt)for(var gn=0;gn<C.outChannels;++gn){for(var wn=0,vn=0;vn<C.batchSize;++vn)for(var Cn=tt;Cn<ut;++Cn)for(var Dn=nt+Cn*z-Le,b=Pt;b<jt;++b){var p=Nt+b*Z-Re;wn+=xe?Be.get(vn,Dn,p,Yt)*Xe.get(vn,Cn,b,gn):Be.get(vn,Yt,Dn,p)*Xe.get(vn,gn,Cn,b)}Oe.set(wn,nt,Nt,Yt,gn)}return Oe.toTensor()},v.prototype.conv3dDerFilter=function(d,y,C){for(var z=C.strideDepth,Z=C.strideHeight,re=C.strideWidth,fe=C.filterDepth,xe=C.filterHeight,Oe=C.filterWidth,Re=Hi(C.filterShape,"float32"),Le=Re.values,Be=Re.strides,Xe=Be[0],nt=Be[1],tt=Be[2],ut=Be[3],Nt=this.readSync(y.dataId),Pt=y.strides,jt=Pt[0],Yt=Pt[1],gn=Pt[2],wn=Pt[3],vn=this.readSync(d.dataId),Cn=d.strides,Dn=Cn[0],b=Cn[1],p=Cn[2],l=Cn[3],m=C.padInfo.front,w=C.padInfo.left,P=C.padInfo.top,K=0;K<fe;++K)for(var ee=Math.max(0,Math.ceil((m-K)/z)),le=Math.min(C.outDepth,(C.inDepth+m-K)/z),de=K*Xe,Ee=0;Ee<xe;++Ee)for(var Te=Math.max(0,Math.ceil((P-Ee)/Z)),Ne=Math.min(C.outHeight,(C.inHeight+P-Ee)/Z),Fe=Ee*nt+de,qe=0;qe<Oe;++qe)for(var Je=Math.max(0,Math.ceil((w-qe)/re)),Ke=Math.min(C.outWidth,(C.inWidth+w-qe)/re),it=qe*tt+Fe,gt=0;gt<C.inChannels;++gt)for(var Et=gt*ut+it,At=0;At<C.outChannels;++At){for(var Wt=0,cn=0;cn<C.batchSize;++cn)for(var pn=cn*Dn,ln=cn*jt,dn=ee;dn<le;++dn)for(var Nn=(K+dn*z-m)*b+pn,jn=dn*Yt+ln,Ln=Te;Ln<Ne;++Ln)for(var ur=(Ee+Ln*Z-P)*p+Nn,hr=Ln*gn+jn,xr=Je;xr<Ke;++xr){var Er=xr*wn+hr;Wt+=vn[(qe+xr*re-w)*l+ur+gt]*Nt[Er+At]}Le[Et+At]=Wt}return Re.toTensor()},v.prototype.fusedDepthwiseConv2D=function(d){var y=d.input,C=d.filter,z=d.convInfo,Z=d.bias,re=d.activation,fe=d.preluActivationWeights,xe=this.depthwiseConv2D(y,C,z);return Z&&(xe=this.add(xe,Z)),re&&(xe=$(this,xe,re,fe)),xe},v.prototype.depthwiseConv2D=function(d,y,C){Yr([d,y],"depthwiseConv2D");for(var z=C.filterHeight,Z=C.filterWidth,re=C.dilationHeight,fe=C.dilationWidth,xe=C.padInfo.left,Oe=C.padInfo.top,Re=C.outChannels/C.inChannels,Le=Hi(C.outShape,d.dtype),Be=this.readSync(d.dataId),Xe=this.readSync(y.dataId),nt=Le.values,tt=0;tt<C.batchSize;++tt)for(var ut=tt*d.strides[0],Nt=tt*Le.strides[0],Pt=0;Pt<C.outHeight;++Pt)for(var jt=Nt+Pt*Le.strides[1],Yt=Pt*C.strideHeight-xe,gn=0;gn<z;++gn){var wn=Yt+gn*re;if(!(wn<0||wn>=C.inHeight))for(var vn=gn*y.strides[0],Cn=ut+wn*d.strides[1],Dn=0;Dn<C.outWidth;++Dn)for(var b=jt+Dn*Le.strides[2],p=Dn*C.strideWidth-Oe,l=0;l<Z;++l){var m=p+l*fe;if(!(m<0||m>=C.inWidth))for(var w=vn+l*y.strides[1],P=Cn+m*C.inChannels,K=b,ee=w,le=0;le<C.inChannels;++le){for(var de=Be[P+le],Ee=0;Ee<Re;++Ee)nt[K+Ee]+=de*Xe[ee+Ee];K+=Re,ee+=Re}}}return Le.toTensor()},v.prototype.depthwiseConv2DDerInput=function(d,y,C){Yr([d,y],"depthwiseConv2DDerInput");for(var z=Hi(C.inShape,"float32"),Z=z.values,re=z.strides,fe=re[0],xe=re[1],Oe=re[2],Re=this.readSync(d.dataId),Le=d.strides,Be=Le[0],Xe=Le[1],nt=Le[2],tt=this.readSync(y.dataId),ut=y.strides,Nt=ut[0],Pt=ut[1],jt=ut[2],Yt=C.batchSize,gn=C.filterHeight,wn=C.filterWidth,vn=C.inChannels,Cn=C.inHeight,Dn=C.inWidth,b=C.outChannels,p=C.outHeight,l=C.outWidth,m=C.strideHeight,w=C.strideWidth,P=gn-1-C.padInfo.top,K=wn-1-C.padInfo.left,ee=b/vn,le=0;le<Yt;++le)for(var de=0;de<vn;++de)for(var Ee=0;Ee<Cn;++Ee)for(var Te=Ee-P,Ne=Math.max(0,Math.ceil(Te/m)),Fe=Math.min(p,(gn+Te)/m),qe=0;qe<Dn;++qe){for(var Je=qe-K,Ke=Math.max(0,Math.ceil(Je/w)),it=Math.min(l,(wn+Je)/w),gt=0,Et=Ne;Et<Fe;++Et)for(var At=Et*m-Te,Wt=Ke;Wt<it;++Wt)for(var cn=Be*le+Xe*Et+nt*Wt,pn=Nt*(gn-1-At)+Pt*(wn-1-(Wt*w-Je))+jt*de,ln=0;ln<ee;++ln)gt+=Re[cn+(de*ee+ln)]*tt[pn+ln];Z[fe*le+xe*Ee+Oe*qe+de]=gt}return z.toTensor()},v.prototype.depthwiseConv2DDerFilter=function(d,y,C){Yr([d,y],"depthwiseConv2DDerFilter");for(var z=C.strideHeight,Z=C.strideWidth,re=C.filterHeight,fe=C.filterWidth,xe=Hi(C.filterShape,"float32"),Oe=C.padInfo.left,Re=C.padInfo.top,Le=C.outChannels/C.inChannels,Be=this.bufferSync(d),Xe=this.bufferSync(y),nt=0;nt<re;++nt)for(var tt=Math.max(0,Math.ceil((Re-nt)/z)),ut=Math.min(C.outHeight,(C.inHeight+Re-nt)/z),Nt=0;Nt<fe;++Nt)for(var Pt=Math.max(0,Math.ceil((Oe-Nt)/Z)),jt=Math.min(C.outWidth,(C.inWidth+Oe-Nt)/Z),Yt=0;Yt<C.outChannels;++Yt){for(var gn=Math.trunc(Yt/Le),wn=Yt%Le,vn=0,Cn=0;Cn<C.batchSize;++Cn)for(var Dn=tt;Dn<ut;++Dn)for(var b=nt+Dn*z-Re,p=Pt;p<jt;++p){var l=Nt+p*Z-Oe;vn+=Be.get(Cn,b,l,gn)*Xe.get(Cn,Dn,p,Yt)}xe.set(vn,nt,Nt,gn,wn)}return xe.toTensor()},v.prototype.tile=function(d,y){return Yr(d,"tile"),Nd(this.bufferSync(d),y)},v.prototype.pad=function(d,y,C){Yr(d,"pad");var z=y.map(function(Le,Be){return Le[0]+d.shape[Be]+Le[1]}),Z=y.map(function(Le){return Le[0]}),re=this.bufferSync(d),fe=Hi(z,d.dtype);C!==0&&fe.values.fill(C);for(var xe=0;xe<d.size;xe++){var Oe=re.indexToLoc(xe),Re=Oe.map(function(Le,Be){return Le+Z[Be]});fe.set.apply(fe,[re.get.apply(re,Oe)].concat(Re))}return fe.toTensor()},v.prototype.transpose=function(d,y){Yr(d,"transpose");for(var C=new Array(d.rank),z=0;z<C.length;z++)C[z]=d.shape[y[z]];var Z=this.readSync(d.dataId),re=Hi(C,d.dtype),fe=this.bufferSync(d);for(z=0;z<d.size;++z){for(var xe=fe.indexToLoc(z),Oe=new Array(xe.length),Re=0;Re<Oe.length;Re++)Oe[Re]=xe[y[Re]];var Le=re.locToIndex(Oe);re.values[Le]=Z[z]}return re.toTensor()},v.prototype.gather=function(d,y,C){Yr([d,y],"gather");var z=d.shape.slice(),Z=this.readSync(y.dataId);z[C]=Z.length;for(var re=Hi(z,d.dtype),fe=this.bufferSync(d),xe=0;xe<re.size;++xe){var Oe=re.indexToLoc(xe),Re=Oe.slice();Re[C]=Z[Oe[C]];var Le=fe.locToIndex(Re);re.values[xe]=fe.values[Le]}return re.toTensor()},v.prototype.batchToSpaceND=function(d,y,C){Yr([d],"batchToSpaceND");var z=y.reduce(function(Re,Le){return Re*Le}),Z=mc(d.shape,y,z),re=Sd(Z.length,y.length),fe=Cd(d.shape,y,z),xe=Rl(C,y.length),Oe=tm(fe,C,y.length);return d.reshape(Z).transpose(re).reshape(fe).slice(xe,Oe)},v.prototype.spaceToBatchND=function(d,y,C){Yr([d],"spaceToBatchND");var z=y.reduce(function(Le,Be){return Le*Be}),Z=[[0,0]];Z.push.apply(Z,C);for(var re=1+y.length;re<d.shape.length;++re)Z.push([0,0]);var fe=d.pad(Z),xe=mc(fe.shape,y,z,!1),Oe=Sd(xe.length,y.length,!1),Re=Cd(fe.shape,y,z,!1);return fe.reshape(xe).transpose(Oe).reshape(Re)},v.prototype.pool=function(d,y,C){Yr(d,"pool");for(var z=y.strideHeight,Z=y.strideWidth,re=y.dilationHeight,fe=y.dilationWidth,xe=y.effectiveFilterHeight,Oe=y.effectiveFilterWidth,Re=y.padInfo.top,Le=y.padInfo.left,Be=C==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,Xe=this.readSync(d.dataId),nt=Hi(y.outShape,d.dtype),tt=nt.values,ut=y.outShape[1]*y.outShape[2]*y.outShape[3],Nt=y.outShape[2]*y.outShape[3],Pt=y.outShape[3],jt=0;jt<y.batchSize;++jt)for(var Yt=jt*ut,gn=jt*d.strides[0],wn=0;wn<y.inChannels;++wn)for(var vn=0;vn<y.outHeight;++vn)for(var Cn=vn*z-Re,Dn=Math.max(0,Cn),b=Math.min(y.inHeight,xe+Cn),p=Yt+vn*Nt,l=0;l<y.outWidth;++l){for(var m=l*Z-Le,w=Math.max(0,m),P=Math.min(y.inWidth,Oe+m),K=Be,ee=0,le=0,de=Dn;de<b;de+=re){for(var Ee=gn+de*d.strides[1],Te=w;Te<P;Te+=fe){var Ne=Xe[Ee+Te*d.strides[2]+wn];C==="max"&&Ne>K?K=Ne:C==="avg"&&(ee+=Ne,le++)}if(isNaN(K))break}tt[p+l*Pt+wn]=C==="avg"?ee/le:K}return nt.toTensor()},v.prototype.maxPool=function(d,y){return this.pool(d,y,"max")},v.prototype.maxPoolPositions=function(d,y){for(var C=Hi(y.outShape,"int32"),z=y.strideHeight,Z=y.strideWidth,re=y.dilationHeight,fe=y.dilationWidth,xe=y.effectiveFilterHeight,Oe=y.effectiveFilterWidth,Re=y.padInfo.top,Le=y.padInfo.left,Be=this.bufferSync(d),Xe=0;Xe<y.batchSize;++Xe)for(var nt=0;nt<y.inChannels;++nt)for(var tt=0;tt<y.outHeight;++tt){for(var ut=tt*z-Re,Nt=ut;Nt<0;)Nt+=re;for(var Pt=Math.min(y.inHeight,xe+ut),jt=0;jt<y.outWidth;++jt){for(var Yt=jt*Z-Le,gn=Yt;gn<0;)gn+=fe;for(var wn=Math.min(y.inWidth,Oe+Yt),vn=Number.NEGATIVE_INFINITY,Cn=-1,Dn=Nt;Dn<Pt;Dn+=re)for(var b=Dn-ut,p=gn;p<wn;p+=fe){var l=p-Yt,m=Be.get(Xe,Dn,p,nt);m>vn&&(vn=m,Cn=b*Oe+l)}C.set(Cn,Xe,tt,jt,nt)}}return C.toTensor()},v.prototype.maxPoolBackprop=function(d,y,C,z){Yr([y,C],"maxPoolBackprop");for(var Z=this.maxPoolPositions(y,z),re=z.strideHeight,fe=z.strideWidth,xe=z.dilationHeight,Oe=z.dilationWidth,Re=z.effectiveFilterHeight,Le=z.effectiveFilterWidth,Be=Le-1-z.padInfo.left,Xe=Re-1-z.padInfo.top,nt=Hi(y.shape,"float32"),tt=this.bufferSync(Z),ut=this.bufferSync(d),Nt=0;Nt<z.batchSize;++Nt)for(var Pt=0;Pt<z.inChannels;++Pt)for(var jt=0;jt<z.inHeight;++jt)for(var Yt=0;Yt<z.inWidth;++Yt){for(var gn=jt-Xe,wn=Yt-Be,vn=0,Cn=0;Cn<Re;Cn+=xe){var Dn=(gn+Cn)/re;if(!(Dn<0||Dn>=z.outHeight||Math.floor(Dn)!==Dn))for(var b=0;b<Le;b+=Oe){var p=(wn+b)/fe;if(!(p<0||p>=z.outWidth||Math.floor(p)!==p)){var l=Re*Le-1-tt.get(Nt,Dn,p,Pt)===Cn*Le+b?1:0;l!==0&&(vn+=ut.get(Nt,Dn,p,Pt)*l)}}}nt.set(vn,Nt,jt,Yt,Pt)}return nt.toTensor()},v.prototype.avgPoolBackprop=function(d,y,C){Yr([d,y],"avgPoolBackprop");for(var z=C.strideHeight,Z=C.strideWidth,re=C.filterHeight,fe=C.filterWidth,xe=C.dilationHeight,Oe=C.dilationWidth,Re=C.effectiveFilterHeight,Le=C.effectiveFilterWidth,Be=Le-1-C.padInfo.left,Xe=Re-1-C.padInfo.top,nt=Hi(y.shape,"float32"),tt=1/(re*fe),ut=this.bufferSync(d),Nt=0;Nt<C.batchSize;++Nt)for(var Pt=0;Pt<C.inChannels;++Pt)for(var jt=0;jt<C.inHeight;++jt)for(var Yt=0;Yt<C.inWidth;++Yt){for(var gn=jt-Xe,wn=Yt-Be,vn=0,Cn=0;Cn<Re;Cn+=xe){var Dn=(gn+Cn)/z;if(!(Dn<0||Dn>=C.outHeight||Math.floor(Dn)!==Dn))for(var b=0;b<Le;b+=Oe){var p=(wn+b)/Z;p<0||p>=C.outWidth||Math.floor(p)!==p||(vn+=ut.get(Nt,Dn,p,Pt))}}nt.set(vn*tt,Nt,jt,Yt,Pt)}return nt.toTensor()},v.prototype.pool3d=function(d,y,C){Yr(d,"pool3d");for(var z=y.strideDepth,Z=y.strideHeight,re=y.strideWidth,fe=y.dilationDepth,xe=y.dilationHeight,Oe=y.dilationWidth,Re=y.effectiveFilterDepth,Le=y.effectiveFilterHeight,Be=y.effectiveFilterWidth,Xe=y.padInfo.front,nt=y.padInfo.top,tt=y.padInfo.left,ut=C==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,Nt=this.readSync(d.dataId),Pt=Hi(y.outShape,d.dtype),jt=Pt.values,Yt=y.outShape[1]*y.outShape[2]*y.outShape[3]*y.outShape[4],gn=y.outShape[2]*y.outShape[3]*y.outShape[4],wn=y.outShape[3]*y.outShape[4],vn=y.outShape[4],Cn=0;Cn<y.batchSize;++Cn)for(var Dn=Cn*Yt,b=Cn*d.strides[0],p=0;p<y.inChannels;++p)for(var l=0;l<y.outDepth;++l){for(var m=l*z-Xe,w=m;w<0;)w+=fe;for(var P=Math.min(y.inDepth,Re+m),K=Dn+l*gn,ee=0;ee<y.outHeight;++ee){for(var le=ee*Z-nt,de=le;de<0;)de+=xe;for(var Ee=Math.min(y.inHeight,Le+le),Te=K+ee*wn,Ne=0;Ne<y.outWidth;++Ne){for(var Fe=Ne*re-tt,qe=Fe;qe<0;)qe+=Oe;for(var Je=Math.min(y.inWidth,Be+Fe),Ke=Te+Ne*vn,it=ut,gt=0,Et=0,At=w;At<P;At+=fe){for(var Wt=b+At*d.strides[1],cn=de;cn<Ee;cn+=xe){for(var pn=Wt+cn*d.strides[2],ln=qe;ln<Je;ln+=Oe){var dn=Nt[pn+ln*d.strides[3]+p];if(C==="max"&&dn>it?it=dn:C==="avg"&&(gt+=dn,Et++),isNaN(it))break}if(isNaN(it))break}if(isNaN(it))break}jt[Ke+p]=C==="avg"?gt/Et:it}}}return Pt.toTensor()},v.prototype.avgPool3d=function(d,y){return Yr(d,"avgPool3d"),this.pool3d(d,y,"avg").toFloat()},v.prototype.avgPool3dBackprop=function(d,y,C){Yr([d,y],"avgPool3dBackprop");for(var z=C.strideDepth,Z=C.strideHeight,re=C.strideWidth,fe=C.filterDepth,xe=C.filterHeight,Oe=C.filterWidth,Re=C.dilationDepth,Le=C.dilationHeight,Be=C.dilationWidth,Xe=C.effectiveFilterDepth,nt=C.effectiveFilterHeight,tt=C.effectiveFilterWidth,ut=Xe-1-C.padInfo.front,Nt=tt-1-C.padInfo.left,Pt=nt-1-C.padInfo.top,jt=Hi(y.shape,"float32"),Yt=1/(fe*xe*Oe),gn=this.bufferSync(d),wn=0;wn<C.batchSize;++wn)for(var vn=0;vn<C.inChannels;++vn)for(var Cn=0;Cn<C.inDepth;++Cn)for(var Dn=0;Dn<C.inHeight;++Dn)for(var b=0;b<C.inWidth;++b){for(var p=Cn-ut,l=Dn-Pt,m=b-Nt,w=0,P=0;P<Xe;P+=Re){var K=(p+P)/z;if(!(K<0||K>=C.outDepth||Math.floor(K)!==K))for(var ee=0;ee<nt;ee+=Le){var le=(l+ee)/Z;if(!(le<0||le>=C.outHeight||Math.floor(le)!==le))for(var de=0;de<tt;de+=Be){var Ee=(m+de)/re;Ee<0||Ee>=C.outWidth||Math.floor(Ee)!==Ee||(w+=gn.get(wn,K,le,Ee,vn))}}}jt.set(w*Yt,wn,Cn,Dn,b,vn)}return jt.toTensor()},v.prototype.maxPool3d=function(d,y){return Yr(d,"maxPool3d"),this.pool3d(d,y,"max").toFloat()},v.prototype.maxPool3dPositions=function(d,y){for(var C=Hi(y.outShape,"int32"),z=y.strideDepth,Z=y.strideHeight,re=y.strideWidth,fe=y.dilationDepth,xe=y.dilationHeight,Oe=y.dilationWidth,Re=y.effectiveFilterDepth,Le=y.effectiveFilterHeight,Be=y.effectiveFilterWidth,Xe=y.padInfo.front,nt=y.padInfo.top,tt=y.padInfo.left,ut=this.bufferSync(d),Nt=0;Nt<y.batchSize;++Nt)for(var Pt=0;Pt<y.inChannels;++Pt)for(var jt=0;jt<y.outDepth;++jt){for(var Yt=jt*z-Xe,gn=Yt;gn<0;)gn+=fe;for(var wn=Math.min(y.inDepth,Re+Yt),vn=0;vn<y.outHeight;++vn){for(var Cn=vn*Z-nt,Dn=Cn;Dn<0;)Dn+=xe;for(var b=Math.min(y.inHeight,Le+Cn),p=0;p<y.outWidth;++p){for(var l=p*re-tt,m=l;m<0;)m+=Oe;for(var w=Math.min(y.inWidth,Be+l),P=Number.NEGATIVE_INFINITY,K=-1,ee=gn;ee<wn;ee+=fe)for(var le=ee-Yt,de=Dn;de<b;de+=xe)for(var Ee=de-Cn,Te=m;Te<w;Te+=Oe){var Ne=Te-l,Fe=ut.get(Nt,ee,de,Te,Pt);Fe>=P&&(P=Fe,K=le*Le*Be+Ee*Le+Ne)}C.set(K,Nt,jt,vn,p,Pt)}}}return C.toTensor()},v.prototype.maxPool3dBackprop=function(d,y,C,z){Yr([y,C],"maxPool3dBackprop");for(var Z=this.maxPool3dPositions(y,z),re=z.strideDepth,fe=z.strideHeight,xe=z.strideWidth,Oe=z.dilationDepth,Re=z.dilationHeight,Le=z.dilationWidth,Be=z.effectiveFilterDepth,Xe=z.effectiveFilterHeight,nt=z.effectiveFilterWidth,tt=Be-1-z.padInfo.front,ut=nt-1-z.padInfo.left,Nt=Xe-1-z.padInfo.top,Pt=Hi(y.shape,"float32"),jt=this.bufferSync(Z),Yt=this.bufferSync(d),gn=0;gn<z.batchSize;++gn)for(var wn=0;wn<z.inChannels;++wn)for(var vn=0;vn<z.inDepth;++vn)for(var Cn=0;Cn<z.inHeight;++Cn)for(var Dn=0;Dn<z.inWidth;++Dn){for(var b=vn-tt,p=Cn-Nt,l=Dn-ut,m=0,w=0;w<Be;w+=Oe){var P=(b+w)/re;if(!(P<0||P>=z.outDepth||Math.floor(P)!==P))for(var K=0;K<Xe;K+=Re){var ee=(p+K)/fe;if(!(ee<0||ee>=z.outHeight||Math.floor(ee)!==ee))for(var le=0;le<nt;le+=Le){var de=(l+le)/xe;if(!(de<0||de>=z.outWidth||Math.floor(de)!==de)){var Ee=Be*Xe*nt-1-jt.get(gn,P,ee,de,wn)===w*Xe*nt+K*nt+le?1:0;Ee!==0&&(m+=Yt.get(gn,P,ee,de,wn)*Ee)}}}}Pt.set(m,gn,vn,Cn,Dn,wn)}return Pt.toTensor()},v.prototype.cast=function(d,y){return fu(d,y,this)},v.prototype.reshape=function(d,y){return Ku(d,y)},v.prototype.avgPool=function(d,y){return Yr(d,"avgPool"),this.pool(d,y,"avg").toFloat()},v.prototype.resizeBilinear=function(d,y,C,z){Yr(d,"resizeBilinear");for(var Z=d.shape,re=Z[0],fe=Z[1],xe=Z[2],Oe=Z[3],Re=this.readSync(d.dataId),Le=new Float32Array(ze([re,y,C,Oe])),Be=[z&&y>1?fe-1:fe,z&&C>1?xe-1:xe],Xe=[z&&y>1?y-1:y,z&&C>1?C-1:C],nt=0,tt=Be[0]/Xe[0],ut=Be[1]/Xe[1],Nt=0;Nt<re;Nt++)for(var Pt=0;Pt<y;Pt++)for(var jt=tt*Pt,Yt=Math.floor(jt),gn=jt-Yt,wn=Math.min(fe-1,Math.ceil(jt)),vn=Nt*d.strides[0]+Yt*d.strides[1],Cn=Nt*d.strides[0]+wn*d.strides[1],Dn=0;Dn<C;Dn++)for(var b=ut*Dn,p=Math.floor(b),l=b-p,m=Math.min(xe-1,Math.ceil(b)),w=vn+p*d.strides[2],P=Cn+p*d.strides[2],K=vn+m*d.strides[2],ee=Cn+m*d.strides[2],le=0;le<Oe;le++){var de=Re[w+le],Ee=Re[P+le],Te=de+(Re[K+le]-de)*l,Ne=Te+(Ee+(Re[ee+le]-Ee)*l-Te)*gn;Le[nt++]=Ne}return No(Le,[re,y,C,Oe])},v.prototype.resizeBilinearBackprop=function(d,y,C){Yr([d,y],"resizeBilinearBackprop");for(var z=y.shape,Z=z[0],re=z[1],fe=z[2],xe=z[3],Oe=d.shape,Re=Oe[1],Le=Oe[2],Be=new Float32Array(Z*re*fe*xe),Xe=[C&&Re>1?re-1:re,C&&Le>1?fe-1:fe],nt=[C&&Re>1?Re-1:Re,C&&Le>1?Le-1:Le],tt=Xe[0]/nt[0],ut=Xe[1]/nt[1],Nt=this.readSync(d.dataId),Pt=0,jt=0;jt<Z;jt++)for(var Yt=jt*y.strides[0],gn=0;gn<Re;gn++)for(var wn=gn*tt,vn=Math.floor(wn),Cn=Math.min(Math.ceil(wn),re-1),Dn=Yt+vn*y.strides[1],b=Yt+Cn*y.strides[1],p=wn-vn,l=1-p,m=0;m<Le;m++)for(var w=m*ut,P=Math.floor(w),K=Math.min(Math.ceil(w),fe-1),ee=w-P,le=1-ee,de=Dn+P*y.strides[2],Ee=Dn+K*y.strides[2],Te=b+P*y.strides[2],Ne=b+K*y.strides[2],Fe=l*le,qe=l*ee,Je=p*le,Ke=p*ee,it=0;it<xe;it++){var gt=Nt[Pt++];Be[de+it]+=gt*Fe,Be[Ee+it]+=gt*qe,Be[Te+it]+=gt*Je,Be[Ne+it]+=gt*Ke}return su(Be,[Z,fe,re,xe],y.dtype)},v.prototype.resizeNearestNeighbor=function(d,y,C,z){Yr(d,"resizeNearestNeighbor");for(var Z=d.shape,re=Z[0],fe=Z[1],xe=Z[2],Oe=Z[3],Re=this.readSync(d.dataId),Le=new Float32Array(re*y*C*Oe),Be=[z&&y>1?fe-1:fe,z&&C>1?xe-1:xe],Xe=[z&&y>1?y-1:y,z&&C>1?C-1:C],nt=Be[0]/Xe[0],tt=Be[1]/Xe[1],ut=0,Nt=0;Nt<re;Nt++)for(var Pt=Nt*d.strides[0],jt=0;jt<y;jt++)for(var Yt=nt*jt,gn=Pt+Math.min(fe-1,z?Math.round(Yt):Math.floor(Yt))*d.strides[1],wn=0;wn<C;wn++)for(var vn=tt*wn,Cn=gn+Math.min(xe-1,z?Math.round(vn):Math.floor(vn))*d.strides[2],Dn=0;Dn<Oe;Dn++){var b=Re[Cn+Dn];Le[ut++]=b}return No(Le,[re,y,C,Oe],d.dtype)},v.prototype.resizeNearestNeighborBackprop=function(d,y,C){Yr([d,y],"resizeNearestNeighborBackprop");for(var z=y.shape,Z=z[0],re=z[1],fe=z[2],xe=z[3],Oe=d.shape,Re=Oe[1],Le=Oe[2],Be=new Float32Array(Z*re*fe*xe),Xe=this.readSync(d.dataId),nt=[C&&Re>1?re-1:re,C&&Le>1?fe-1:fe],tt=[C&&Re>1?Re-1:Re,C&&Le>1?Le-1:Le],ut=nt[0]/tt[0],Nt=nt[1]/tt[1],Pt=1/ut,jt=1/Nt,Yt=2*Math.ceil(Pt)+2,gn=2*Math.ceil(jt)+2,wn=0;wn<Z;wn++)for(var vn=wn*y.strides[0],Cn=0;Cn<re;Cn++)for(var Dn=vn+Cn*y.strides[1],b=Math.floor(Cn*Pt),p=Math.floor(b-Yt/2),l=0;l<fe;l++)for(var m=Dn+l*y.strides[2],w=Math.floor(l*jt),P=Math.floor(w-gn/2),K=0;K<xe;K++){for(var ee=0,le=0;le<Yt;le++){var de=le+p;if(!(de<0||de>=Re)){var Ee=vn+de*d.strides[1],Te=de*ut;if(Cn===Math.min(re-1,C?Math.round(Te):Math.floor(Te)))for(var Ne=0;Ne<gn;Ne++){var Fe=Ne+P;if(!(Fe<0||Fe>=Le)){var qe=Ee+Fe*d.strides[2],Je=Fe*Nt;l===Math.min(fe-1,C?Math.round(Je):Math.floor(Je))&&(ee+=Xe[qe+K])}}}}Be[m+K]=ee}return su(Be,y.shape,y.dtype)},v.prototype.batchNormalization=function(d,y,C,z,Z,re){Yr([d,y,C,Z,re],"batchNorm");for(var fe=this.readSync(d.dataId),xe=this.readSync(y.dataId),Oe=this.readSync(C.dataId),Re=Z?this.readSync(Z.dataId):new Float32Array([1]),Le=re?this.readSync(re.dataId):new Float32Array([0]),Be=new Float32Array(fe.length),Xe=Le.length,nt=Re.length,tt=Oe.length,ut=xe.length,Nt=0,Pt=0,jt=0,Yt=0,gn=0;gn<fe.length;++gn)Be[gn]=Le[Nt++]+(fe[gn]-xe[Pt++])*Re[jt++]/Math.sqrt(Oe[Yt++]+z),Nt>=Xe&&(Nt=0),Pt>=ut&&(Pt=0),jt>=nt&&(jt=0),Yt>=tt&&(Yt=0);return su(Be,d.shape)},v.prototype.localResponseNormalization4D=function(d,y,C,z,Z){Yr(d,"localResponseNormalization4D");var re=d.shape[3],fe=re-1,xe=this.readSync(d.dataId),Oe=d.size,Re=new Float32Array(Oe);function Le(tt){for(var ut=tt%re,Nt=tt-ut+Math.max(0,ut-y),Pt=tt-ut+Math.min(ut+y,fe),jt=0;Nt<=Pt;Nt++){var Yt=xe[Nt];jt+=Yt*Yt}return jt}for(var Be=0;Be<Oe;Be++){var Xe=Le(Be),nt=xe[Be]*Math.pow(C+z*Xe,-Z);Re[Be]=nt}return su(Re,d.shape)},v.prototype.LRNGrad=function(d,y,C,z,Z,re,fe){Yr(d,"LRNGrad");for(var xe=d.shape[3],Oe=this.readSync(d.dataId),Re=this.readSync(y.dataId),Le=this.readSync(C.dataId),Be=new Float32Array(d.size),Xe=d.size,nt=0;nt<Xe;nt++){for(var tt=nt%xe,ut=nt-tt+Math.max(0,tt-z),Nt=nt-tt+Math.min(xe,tt+z+1),Pt=0,jt=ut;jt<Nt;jt++)Pt+=Math.pow(Re[jt],2);for(Pt=re*Pt+Z,jt=ut;jt<Nt;jt++){var Yt=-2*re*fe*Re[jt]*Le[nt]/Pt;nt===jt&&(Yt+=Math.pow(Pt,-fe)),Yt*=Oe[nt],Be[jt]+=Yt}}return su(Be,d.shape)},v.prototype.multinomial=function(d,y,C,z){Yr(d,"multinomial");for(var Z=y?d:js(d),re=Z.shape[0],fe=Z.shape[1],xe=uo([re,C],"int32"),Oe=this.readSync(xe.dataId),Re=this.readSync(Z.dataId),Le=0;Le<re;++Le){var Be=Le*fe,Xe=new Float32Array(fe-1);Xe[0]=Re[Be];for(var nt=1;nt<Xe.length;++nt)Xe[nt]=Xe[nt-1]+Re[Be+nt];for(var tt=Nl(z.toString()),ut=Le*C,Nt=0;Nt<C;++Nt){var Pt=tt();Oe[ut+Nt]=Xe.length;for(var jt=0;jt<Xe.length;jt++)if(Pt<Xe[jt]){Oe[ut+Nt]=jt;break}}}return xe},v.prototype.oneHot=function(d,y,C,z){Yr(d,"oneHot");var Z=new Float32Array(d.size*y);Z.fill(z);for(var re=this.readSync(d.dataId),fe=0;fe<d.size;++fe)re[fe]>=0&&re[fe]<y&&(Z[fe*y+re[fe]]=C);return Eu(Z,[d.size,y],"int32")},v.prototype.nonMaxSuppression=function(d,y,C,z,Z){return Yr(d,"nonMaxSuppression"),Ju(this.readSync(d.dataId),this.readSync(y.dataId),C,z,Z)},v.prototype.fft=function(d){return this.fftBatch(d,!1)},v.prototype.ifft=function(d){return this.fftBatch(d,!0)},v.prototype.fftBatch=function(d,y){for(var C=d.shape[0],z=d.shape[1],Z=Hi(d.shape,"float32"),re=Hi(d.shape,"float32"),fe=xa(d).as2D(C,z),xe=Za(d).as2D(C,z),Oe=0;Oe<C;Oe++)for(var Re=fe.slice([Oe,0],[1,z]),Le=xe.slice([Oe,0],[1,z]),Be=Co(Re,Le),Xe=this.readSync(this.fftImpl(Be,y).dataId),nt=0;nt<z;nt++){var tt=Ll(Xe,nt);Z.values[Oe*z+nt]=tt.real,re.values[Oe*z+nt]=tt.imag}return Co(Z.toTensor(),re.toTensor()).as2D(C,z)},v.prototype.fftImpl=function(d,y){var C=d.as1D(),z=C.size;if(this.isExponentOf2(z)){var Z=this.fftRadix2(C,z,y).as2D(d.shape[0],d.shape[1]);return y&&(Z=Co(xa(Z).div(Ar(z)),Za(Z).div(Ar(z)))),Z}var re=this.readSync(d.dataId),fe=function(xe){for(var Oe=new Float32Array(xe.length/2),Re=new Float32Array(xe.length/2),Le=0;Le<xe.length;Le+=2)Oe[Le/2]=xe[Le],Re[Le/2]=xe[Le+1];return{real:Oe,imag:Re}}(this.fourierTransformByMatmul(re,z,y));return Co(fe.real,fe.imag).as2D(d.shape[0],d.shape[1])},v.prototype.isExponentOf2=function(d){return(d&d-1)==0},v.prototype.fftRadix2=function(d,y,C){if(y===1)return d;var z=this.readSync(d.dataId),Z=y/2,re=function(ut){for(var Nt=Math.ceil(ut.length/4),Pt=new Float32Array(Nt),jt=new Float32Array(Nt),Yt=0;Yt<ut.length;Yt+=4)Pt[Math.floor(Yt/4)]=ut[Yt],jt[Math.floor(Yt/4)]=ut[Yt+1];return{real:Pt,imag:jt}}(z),fe=Co(re.real,re.imag).as1D(),xe=function(ut){for(var Nt=Math.floor(ut.length/4),Pt=new Float32Array(Nt),jt=new Float32Array(Nt),Yt=2;Yt<ut.length;Yt+=4)Pt[Math.floor(Yt/4)]=ut[Yt],jt[Math.floor(Yt/4)]=ut[Yt+1];return{real:Pt,imag:jt}}(z),Oe=Co(xe.real,xe.imag).as1D();fe=this.fftRadix2(fe,Z,C),Oe=this.fftRadix2(Oe,Z,C);var Re=function(ut,Nt){for(var Pt=new Float32Array(ut/2),jt=new Float32Array(ut/2),Yt=0;Yt<Math.ceil(ut/2);Yt++){var gn=(Nt?2:-2)*Math.PI*(Yt/ut);Pt[Yt]=Math.cos(gn),jt[Yt]=Math.sin(gn)}return{real:Pt,imag:jt}}(y,C),Le=Co(Re.real,Re.imag).mul(Oe),Be=fe.add(Le),Xe=fe.sub(Le),nt=xa(Be).concat(xa(Xe)),tt=Za(Be).concat(Za(Xe));return Co(nt,tt).as1D()},v.prototype.fourierTransformByMatmul=function(d,y,C){for(var z=new Float32Array(2*y),Z=0;Z<y;Z++){for(var re=0,fe=0,xe=0;xe<y;xe++){var Oe=Hh(Z*xe,y,C),Re=Ll(d,xe);re+=Re.real*Oe.real-Re.imag*Oe.imag,fe+=Re.real*Oe.imag+Re.imag*Oe.real}C&&(re/=y,fe/=y),Bl(z,re,fe,Z)}return z},v.prototype.depthToSpace=function(d,y,C){we(C==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+C}),we(y>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+y});for(var z=d.shape[0],Z=d.shape[1],re=d.shape[2],fe=d.shape[3],xe=Z*y,Oe=re*y,Re=fe/(y*y),Le=this.readSync(d.dataId),Be=new Float32Array(z*xe*Oe*Re),Xe=0,nt=0;nt<z;++nt)for(var tt=0;tt<xe;++tt)for(var ut=Math.floor(tt/y),Nt=tt%y,Pt=0;Pt<Oe;++Pt)for(var jt=Math.floor(Pt/y),Yt=(Nt*y+Pt%y)*Re,gn=0;gn<Re;++gn){var wn=gn+Yt+fe*(jt+re*(ut+Z*nt));Be[Xe++]=Le[wn]}return su(Be,[z,xe,Oe,Re])},v.prototype.broadcastedBinaryOp=function(d,y,C,z){var Z=io(d.shape,y.shape),re=Hi(Z,C),fe=this.readSync(d.dataId),xe=this.readSync(y.dataId),Oe=is(d.shape,Z),Re=is(y.shape,Z),Le=re.values;if(Oe.length+Re.length===0)for(var Be=0;Be<Le.length;++Be)Le[Be]=z(fe[Be%fe.length],xe[Be%xe.length]);else{var Xe=this.bufferSync(d),nt=this.bufferSync(y),tt=function(ut){var Nt=re.indexToLoc(ut),Pt=Nt.slice(-d.rank);Oe.forEach(function(wn){return Pt[wn]=0});var jt=Xe.locToIndex(Pt),Yt=Nt.slice(-y.rank);Re.forEach(function(wn){return Yt[wn]=0});var gn=nt.locToIndex(Yt);Le[ut]=z(fe[jt],xe[gn])};for(Be=0;Be<Le.length;++Be)tt(Be)}return re.toTensor()},v.prototype.broadcastedBinaryComplexOp=function(d,y,C){var z=io(d.shape,y.shape),Z=Hi(z,"float32"),re=Hi(z,"float32"),fe=this.readSync(d.dataId),xe=this.readSync(y.dataId),Oe=is(d.shape,z),Re=is(y.shape,z),Le=Z.values,Be=re.values;if(Oe.length+Re.length===0)for(var Xe=0;Xe<Le.length;Xe++){var nt=Xe%fe.length,tt=Xe%xe.length,ut=C(fe[2*nt],fe[2*nt+1],xe[2*tt],xe[2*tt+1]);Le[Xe]=ut.real,Be[Xe]=ut.imag}else{var Nt=this.bufferSync(this.data.get(d.dataId).complexTensors.real),Pt=this.bufferSync(this.data.get(y.dataId).complexTensors.real),jt=function(Yt){var gn=Z.indexToLoc(Yt),wn=gn.slice(-d.rank);Oe.forEach(function(p){return wn[p]=0});var vn=Nt.locToIndex(wn),Cn=gn.slice(-y.rank);Re.forEach(function(p){return Cn[p]=0});var Dn=Pt.locToIndex(Cn),b=C(fe[2*vn],fe[2*vn+1],xe[2*Dn],xe[2*Dn+1]);Le[Yt]=b.real,Be[Yt]=b.imag};for(Xe=0;Xe<Le.length;Xe++)jt(Xe)}return this.complex(Z.toTensor(),re.toTensor())},v.prototype.split=function(d,y,C){return Of(d,y,C)},v.prototype.dispose=function(){},v.prototype.floatPrecision=function(){return 32},v.prototype.epsilon=function(){return 1e-7},v.prototype.cropAndResize=function(d,y,C,z,Z,re){for(var fe=d.shape,xe=fe[0],Oe=fe[1],Re=fe[2],Le=fe[3],Be=y.shape[0],Xe=z[0],nt=z[1],tt=Hi([Be,Xe,nt,Le],"float32"),ut=this.readSync(y.dataId),Nt=this.readSync(C.dataId),Pt=this.readSync(d.dataId),jt=d.strides,Yt=tt.strides,gn=0;gn<Be;gn++){var wn=4*gn,vn=ut[wn],Cn=ut[wn+1],Dn=ut[wn+2],b=ut[wn+3],p=Nt[gn];if(!(p>=xe))for(var l=Xe>1?(Dn-vn)*(Oe-1)/(Xe-1):0,m=nt>1?(b-Cn)*(Re-1)/(nt-1):0,w=0;w<Xe;w++){var P=Xe>1?vn*(Oe-1)+w*l:.5*(vn+Dn)*(Oe-1);if(P<0||P>Oe-1)for(var K=0;K<nt;K++)for(var ee=0;ee<Le;ee++){var le=ee+K*Yt[2]+w*Yt[1]+gn*Yt[0];tt.values[le]=re}else if(Z==="bilinear"){var de=Math.floor(P),Ee=Math.ceil(P),Te=P-de;for(K=0;K<nt;K++)if((At=nt>1?Cn*(Re-1)+K*m:.5*(Cn+b)*(Re-1))<0||At>Re-1)for(ee=0;ee<Le;ee++)le=ee+K*Yt[2]+w*Yt[1]+gn*Yt[0],tt.values[le]=re;else{var Ne=Math.floor(At),Fe=Math.ceil(At),qe=At-Ne;for(ee=0;ee<Le;ee++){var Je=Pt[le=ee+Ne*jt[2]+de*jt[1]+p*jt[0]],Ke=Pt[le=ee+Fe*jt[2]+de*jt[1]+p*jt[0]],it=Pt[le=ee+Ne*jt[2]+Ee*jt[1]+p*jt[0]],gt=Je+(Ke-Je)*qe,Et=it+(Pt[le=ee+Fe*jt[2]+Ee*jt[1]+p*jt[0]]-it)*qe;le=ee+K*Yt[2]+w*Yt[1]+gn*Yt[0],tt.values[le]=gt+(Et-gt)*Te}}}else for(K=0;K<nt;++K){var At;if((At=nt>1?Cn*(Re-1)+K*m:.5*(Cn+b)*(Re-1))<0||At>Re-1)for(ee=0;ee<Le;ee++)le=ee+K*Yt[2]+w*Yt[1]+gn*Yt[0],tt.values[le]=re;else{var Wt=Math.round(At),cn=Math.round(P);for(ee=0;ee<Le;ee++){var pn=ee+Wt*jt[2]+cn*jt[1]+p*jt[0],ln=ee+K*Yt[2]+w*Yt[1]+gn*Yt[0];tt.values[ln]=Pt[pn]}}}}}return tt.toTensor()},v.prototype.sparseToDense=function(d,y,C,z){var Z=Pl(0,d,C),re=Z.sliceRank,fe=Z.numUpdates,xe=Z.sliceSize,Oe=Z.strides,Re=Z.outputSize;return this.scatter(d,y,C,Re,xe,fe,re,Oe,z,!1)},v.prototype.gatherND=function(d,y){var C=y.shape,z=C[C.length-1],Z=gc(d,y),re=Z[0],fe=Z[1],xe=Z[2],Oe=Z[3];if(fe===0)return No([],re,d.dtype);for(var Re=new qr([fe,xe],d.dtype),Le=this.readSync(y.dataId),Be=this.readSync(d.dataId),Xe=0;Xe<fe;Xe++){for(var nt=[],tt=0,ut=0;ut<z;ut++){var Nt=Le[Xe*z+ut];tt+=Nt*Oe[ut],nt.push(Nt)}if(tt<0||tt>=d.size/xe)throw new Error("Invalid indices: "+nt+" does not index into "+d.shape);for(var Pt=0;Pt<xe;Pt++)Re.values[Xe*xe+Pt]=Be[tt*xe+Pt]}return Re.toTensor().reshape(re)},v.prototype.scatterND=function(d,y,C){var z=Pl(0,d,C),Z=z.sliceRank,re=z.numUpdates,fe=z.sliceSize,xe=z.strides,Oe=z.outputSize,Re=Ar(0);return this.scatter(d,y,C,Oe,fe,re,Z,xe,Re,!0)},v.prototype.fill=function(d,y,C){var z=an(C=C||Ce(y),ze(d));return z.fill(y),He.makeTensor(z,d,C,this)},v.prototype.onesLike=function(d){if(d.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(d.shape,1,d.dtype)},v.prototype.zerosLike=function(d){var y=an(d.dtype,ze(d.shape));return this.makeOutput(y,d.shape,d.dtype)},v.prototype.linspace=function(d,y,C){return yc(d,y,C)},v.prototype.scatter=function(d,y,C,z,Z,re,fe,xe,Oe,Re){var Le=[z/Z,Z],Be=this.readSync(d.dataId),Xe=this.readSync(y.dataId);if(z===0)return No([],C,y.dtype);var nt=new qr(Le,y.dtype);nt.values.fill(this.readSync(Oe.dataId)[0]);for(var tt=0;tt<re;tt++){for(var ut=[],Nt=0,Pt=0;Pt<fe;Pt++){var jt=Be[tt*fe+Pt];ut.push(jt),Nt+=jt*xe[Pt]}if(Nt<0||Nt>=z/Z)throw new Error("Invalid indices: "+ut+" does not index into "+C);for(var Yt=0;Yt<Z;Yt++)Re?nt.values[Nt*Z+Yt]+=Xe[tt*Z+Yt]:nt.values[Nt*Z+Yt]=y.rank===0?Xe[0]:Xe[tt*Z+Yt]}return nt.toTensor().reshape(C)},v}(Td);He.registerBackend("cpu",function(){return new M},1);for(var T=0,O=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(_){var v=_.inputs,d=_.backend,y=_.attrs,C=v,z=C.boxes,Z=C.scores,re=y,fe=re.maxOutputSize,xe=re.iouThreshold,Oe=re.scoreThreshold,Re=re.softNmsSigma,Le=d;Yr(z,"NonMaxSuppressionWithScore");var Be=Qu(Le.data.get(z.dataId).values,Le.data.get(Z.dataId).values,fe,xe,Oe,Re);return[Be.selectedIndices,Be.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(_){var v=_.inputs,d=_.backend,y=v.x,C=d;Yr(y,"square");for(var z=C.data.get(y.dataId).values,Z=new Float32Array(z.length),re=0;re<z.length;++re){var fe=z[re];Z[re]=fe*fe}return{dataId:C.write(Z,y.shape,y.dtype),shape:y.shape,dtype:y.dtype}}},{kernelName:qh,backendName:"cpu",kernelFunc:function(_){var v=_.inputs,d=_.backend,y=v,C=y.a,z=y.b,Z=d;Yr([C,z],qh);var re=Z.data.get(C.dataId).values,fe=Z.data.get(z.dataId).values,xe=function(Le,Be,Xe,nt,tt,ut){var Nt=io(Le,Be),Pt=Nt.length,jt=on(Nt),Yt=kn(tt,ze(Nt)),gn=Le.length,wn=Be.length,vn=on(Le),Cn=on(Be),Dn=is(Le,Nt),b=is(Be,Nt);if(Dn.length+b.length===0)for(var p=0;p<Yt.length;++p)Yt[p]=ut(Xe[p%Xe.length],nt[p%nt.length]);else{var l=function(m){var w=ar(m,Pt,jt),P=w.slice(-gn);Dn.forEach(function(de){return P[de]=0});var K=or(P,gn,vn),ee=w.slice(-wn);b.forEach(function(de){return ee[de]=0});var le=or(ee,wn,Cn);Yt[m]=ut(Xe[K],nt[le])};for(p=0;p<Yt.length;++p)l(p)}return[Yt,Nt]}(C.shape,z.shape,re,fe,C.dtype,function(Le,Be){var Xe=Le-Be;return Xe*Xe}),Oe=xe[0],Re=xe[1];return{dataId:Z.write(Oe,Re,C.dtype),shape:Re,dtype:C.dtype}}}];T<O.length;T++)oe(O[T]);for(var L,J=0,ie=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(_){var v=_.inputs,d=_.backend,y=_.attrs,C=v.pixels,z=y.numChannels,Z=typeof HTMLVideoElement<"u"&&C instanceof HTMLVideoElement,re=typeof HTMLImageElement<"u"&&C instanceof HTMLImageElement,fe=Z?[C.videoWidth,C.videoHeight]:[C.width,C.height],xe=fe[0],Oe=fe[1],Re=[Oe,xe],Le=[Oe,xe,z];(re||Z)&&(L==null&&(L=document.createElement("canvas").getContext("2d")),L.canvas.width=xe,L.canvas.height=Oe,L.drawImage(C,0,0,xe,Oe),C=L.canvas);var Be=d.makeTensorInfo(Re,"int32");d.texData.get(Be.dataId).usage=lr.PIXELS,d.gpgpu.uploadPixelDataToTexture(d.getTexture(Be.dataId),C);var Xe=j().getBool("WEBGL_PACK")?new function(tt){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var ut=ce(),Nt=tt[0],Pt=tt[1];this.outputShape=tt,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+Pt+".0, "+Nt+`.0);
            vec4 values = `+ut.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+ut.output+` = result;
      }
    `}(Le):new function(tt){this.variableNames=["A"];var ut=ce(),Nt=tt[0],Pt=tt[1];this.outputShape=tt,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+Pt+".0, "+Nt+`.0);

        vec4 values = `+ut.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}(Le),nt=d.runWebGLProgram(Xe,[Be],"int32");return d.disposeData(Be.dataId),nt}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(_){var v=_.inputs,d=_.backend,y=_.attrs;Ml("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var C=v,z=C.boxes,Z=C.scores,re=y,fe=re.maxOutputSize,xe=re.iouThreshold,Oe=re.scoreThreshold,Re=re.softNmsSigma,Le=d,Be=Qu(Le.readSync(z.dataId),Le.readSync(Z.dataId),fe,xe,Oe,Re);return[Be.selectedIndices,Be.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(_){var v=_.inputs,d=_.backend,y=v.x,C=d,z=new Ei(y.shape,"return x * x;");return C.runWebGLProgram(z,[y],y.dtype)}},{kernelName:qh,backendName:"webgl",kernelFunc:function(_){var v=_.inputs,d=_.backend,y=v,C=y.a,z=y.b,Z=d,re=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Si("return (a - b) * (a - b);",C.shape,z.shape):new ii("return (a - b) * (a - b);",C.shape,z.shape);return Z.compileAndRun(re,[C,z])}}];J<ie.length;J++)oe(ie[J]);for(var ge=0,Ae=[{kernelName:"Square",gradFunc:function(_,v){var d=v[0];return{x:function(){return _.mul(d.toFloat().mul(2))}}}},{kernelName:qh,gradFunc:function(_,v){var d=v[0],y=v[1],C=Ar(2);return{a:function(){return ql(_,ql(C,hl(d,y)))},b:function(){return ql(_,ql(C,hl(y,d)))}}}}];ge<Ae.length;ge++)ye(Ae[ge]);var Ie=function(){function _(){}return _.prototype.fetch=function(v,d){return fetch(v,d)},_.prototype.now=function(){return performance.now()},_.prototype.encode=function(v,d){if(d!=="utf-8"&&d!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+d);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(v)},_.prototype.decode=function(v,d){return new TextDecoder(d).decode(v)},_}();j().get("IS_BROWSER")&&j().setPlatform("browser",new Ie);var De,et=function(){function _(){this.util=r(249),this.textEncoder=new this.util.TextEncoder}return _.prototype.fetch=function(v,d){return j().global.fetch!=null?j().global.fetch(v,d):(De==null&&(De=r(250)),De(v,d))},_.prototype.now=function(){var v=S.hrtime();return 1e3*v[0]+v[1]/1e6},_.prototype.encode=function(v,d){if(d!=="utf-8"&&d!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+d);return this.textEncoder.encode(v)},_.prototype.decode=function(v,d){return v.length===0?"":new this.util.TextDecoder(d).decode(v)},_}();j().get("IS_NODE")&&j().setPlatform("node",new et);var ot={float32:4,int32:4,uint16:2,uint8:1,bool:1},zt=4;function Ht(_,v){for(var d={},y=0,C=function(re){var fe=re.name,xe=re.dtype,Oe=re.shape,Re=ze(Oe),Le=void 0;if("quantization"in re){var Be=re.quantization;if(Be.dtype!=="uint8"&&Be.dtype!=="uint16")throw new Error("Weight "+re.name+" has unknown quantization dtype "+Be.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var Xe=ot[Be.dtype],nt=_.slice(y,y+Re*Xe),tt=Be.dtype==="uint8"?new Uint8Array(nt):new Uint16Array(nt);if(xe==="float32")Le=Float32Array.from(tt,function(gn){return gn*Be.scale+Be.min});else{if(xe!=="int32")throw new Error("Unsupported dtype in weight '"+fe+"': "+xe);Le=Int32Array.from(tt,function(gn){return Math.round(gn*Be.scale+Be.min)})}y+=Re*Xe}else if(xe==="string"){var ut=ze(re.shape);Le=[];for(var Nt=0;Nt<ut;Nt++){var Pt=new Uint32Array(_.slice(y,y+zt))[0];y+=zt;var jt=new Uint8Array(_.slice(y,y+Pt));Le.push(jt),y+=Pt}}else{var Yt=ot[xe];if(nt=_.slice(y,y+Re*Yt),xe==="float32")Le=new Float32Array(nt);else if(xe==="int32")Le=new Int32Array(nt);else{if(xe!=="bool")throw new Error("Unsupported dtype in weight '"+fe+"': "+xe);Le=new Uint8Array(nt)}y+=Re*Yt}d[fe]=No(Le,Oe,xe)},z=0,Z=v;z<Z.length;z++)C(Z[z]);return d}var xn=E!==void 0&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function En(_){return xn?E.byteLength(_):new Blob([_]).size}function Fn(_){var v=0;_.forEach(function(C){v+=C.byteLength});var d=new Uint8Array(v),y=0;return _.forEach(function(C){d.set(new Uint8Array(C),y),y+=C.byteLength}),d.buffer}function Rn(_){for(_=_.trim();_.endsWith("/");)_=_.slice(0,_.length-1);var v=_.split("/");return v[v.length-1]}function Wn(_){if(_.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:_.modelTopology==null?0:En(JSON.stringify(_.modelTopology)),weightSpecsBytes:_.weightSpecs==null?0:En(JSON.stringify(_.weightSpecs)),weightDataBytes:_.weightData==null?0:_.weightData.byteLength}}var Jn=function(){function _(){this.saveRouters=[],this.loadRouters=[]}return _.getInstance=function(){return _.instance==null&&(_.instance=new _),_.instance},_.registerSaveRouter=function(v){_.getInstance().saveRouters.push(v)},_.registerLoadRouter=function(v){_.getInstance().loadRouters.push(v)},_.getSaveHandlers=function(v){return _.getHandlers(v,"save")},_.getLoadHandlers=function(v,d){return _.getHandlers(v,"load",d)},_.getHandlers=function(v,d,y){var C=[];return(d==="load"?_.getInstance().loadRouters:_.getInstance().saveRouters).forEach(function(z){var Z=z(v,y);Z!==null&&C.push(Z)}),C},_}(),Tn="://",_r=function(){function _(){this.managers={}}return _.getInstance=function(){return _.instance==null&&(_.instance=new _),_.instance},_.registerManager=function(v,d){we(v!=null,function(){return"scheme must not be undefined or null."}),v.endsWith(Tn)&&(v=v.slice(0,v.indexOf(Tn))),we(v.length>0,function(){return"scheme must not be an empty string."});var y=_.getInstance();we(y.managers[v]==null,function(){return"A model store manager is already registered for scheme '"+v+"'."}),y.managers[v]=d},_.getManager=function(v){var d=this.getInstance().managers[v];if(d==null)throw new Error("Cannot find model manager for scheme '"+v+"'");return d},_.getSchemes=function(){return Object.keys(this.getInstance().managers)},_}();function Nr(_){if(_.indexOf(Tn)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+_r.getSchemes().join(","));return{scheme:_.split(Tn)[0],path:_.split(Tn)[1]}}function Ir(_,v,d){return d===void 0&&(d=!1),D(this,void 0,void 0,function(){var y,C,z,Z,re,fe,xe,Oe,Re;return R(this,function(Le){switch(Le.label){case 0:return we(_!==v,function(){return"Old path and new path are the same: '"+_+"'"}),we((y=Jn.getLoadHandlers(_)).length>0,function(){return"Copying failed because no load handler is found for source URL "+_+"."}),we(y.length<2,function(){return"Copying failed because more than one ("+y.length+") load handlers for source URL "+_+"."}),C=y[0],we((z=Jn.getSaveHandlers(v)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+v+"."}),we(z.length<2,function(){return"Copying failed because more than one ("+y.length+") save handlers for destination URL "+v+"."}),Z=z[0],re=Nr(_).scheme,fe=Nr(_).path,xe=re===Nr(_).scheme,[4,C.load()];case 1:return Oe=Le.sent(),d&&xe?[4,_r.getManager(re).removeModel(fe)]:[3,3];case 2:Le.sent(),Le.label=3;case 3:return[4,Z.save(Oe)];case 4:return Re=Le.sent(),!d||xe?[3,6]:[4,_r.getManager(re).removeModel(fe)];case 5:Le.sent(),Le.label=6;case 6:return[2,Re.modelArtifactsInfo]}})})}var Qr="models_store",zr="model_info_store";function ki(){if(!j().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var _=window||self,v=_.indexedDB||_.mozIndexedDB||_.webkitIndexedDB||_.msIndexedDB||_.shimIndexedDB;if(v==null)throw new Error("The current browser does not appear to support IndexedDB.");return v}function Pi(_){var v=_.result;v.createObjectStore(Qr,{keyPath:"modelPath"}),v.createObjectStore(zr,{keyPath:"modelPath"})}var Fi=function(){function _(v){if(this.indexedDB=ki(),v==null||!v)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=v}return _.prototype.save=function(v){return D(this,void 0,void 0,function(){return R(this,function(d){if(v.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,v)]})})},_.prototype.load=function(){return D(this,void 0,void 0,function(){return R(this,function(v){return[2,this.databaseAction(this.modelPath)]})})},_.prototype.databaseAction=function(v,d){var y=this;return new Promise(function(C,z){var Z=y.indexedDB.open("tensorflowjs",1);Z.onupgradeneeded=function(){return Pi(Z)},Z.onsuccess=function(){var re=Z.result;if(d==null){var fe=re.transaction(Qr,"readonly"),xe=fe.objectStore(Qr).get(y.modelPath);xe.onsuccess=function(){if(xe.result==null)return re.close(),z(new Error("Cannot find model with path '"+y.modelPath+"' in IndexedDB."));C(xe.result.modelArtifacts)},xe.onerror=function(nt){return re.close(),z(xe.error)},fe.oncomplete=function(){return re.close()}}else{var Oe,Re=Wn(d),Le=re.transaction(zr,"readwrite"),Be=Le.objectStore(zr),Xe=Be.put({modelPath:y.modelPath,modelArtifactsInfo:Re});Xe.onsuccess=function(){var nt=(Oe=re.transaction(Qr,"readwrite")).objectStore(Qr).put({modelPath:y.modelPath,modelArtifacts:d,modelArtifactsInfo:Re});nt.onsuccess=function(){return C({modelArtifactsInfo:Re})},nt.onerror=function(tt){var ut=(Be=Le.objectStore(zr)).delete(y.modelPath);ut.onsuccess=function(){return re.close(),z(nt.error)},ut.onerror=function(Nt){return re.close(),z(nt.error)}}},Xe.onerror=function(nt){return re.close(),z(Xe.error)},Le.oncomplete=function(){Oe==null?re.close():Oe.oncomplete=function(){return re.close()}}}},Z.onerror=function(re){return z(Z.error)}})},_.URL_SCHEME="indexeddb://",_}(),Mo=function(_){return j().getBool("IS_BROWSER")&&!Array.isArray(_)&&_.startsWith(Fi.URL_SCHEME)?(v=_.slice(Fi.URL_SCHEME.length),new Fi(v)):null;var v};Jn.registerSaveRouter(Mo),Jn.registerLoadRouter(Mo);var Jo=function(){function _(){this.indexedDB=ki()}return _.prototype.listModels=function(){return D(this,void 0,void 0,function(){var v=this;return R(this,function(d){return[2,new Promise(function(y,C){var z=v.indexedDB.open("tensorflowjs",1);z.onupgradeneeded=function(){return Pi(z)},z.onsuccess=function(){var Z=z.result,re=Z.transaction(zr,"readonly"),fe=re.objectStore(zr).getAll();fe.onsuccess=function(){for(var xe={},Oe=0,Re=fe.result;Oe<Re.length;Oe++){var Le=Re[Oe];xe[Le.modelPath]=Le.modelArtifactsInfo}y(xe)},fe.onerror=function(xe){return Z.close(),C(fe.error)},re.oncomplete=function(){return Z.close()}},z.onerror=function(Z){return C(z.error)}})]})})},_.prototype.removeModel=function(v){return D(this,void 0,void 0,function(){var d=this;return R(this,function(y){var C;return v=(C=v).startsWith(Fi.URL_SCHEME)?C.slice(Fi.URL_SCHEME.length):C,[2,new Promise(function(z,Z){var re=d.indexedDB.open("tensorflowjs",1);re.onupgradeneeded=function(){return Pi(re)},re.onsuccess=function(){var fe,xe=re.result,Oe=xe.transaction(zr,"readwrite"),Re=Oe.objectStore(zr),Le=Re.get(v);Le.onsuccess=function(){if(Le.result==null)return xe.close(),Z(new Error("Cannot find model with path '"+v+"' in IndexedDB."));var Be=Re.delete(v),Xe=function(){var nt=(fe=xe.transaction(Qr,"readwrite")).objectStore(Qr).delete(v);nt.onsuccess=function(){return z(Le.result.modelArtifactsInfo)},nt.onerror=function(tt){return Z(Le.error)}};Be.onsuccess=Xe,Be.onerror=function(nt){return Xe(),xe.close(),Z(Le.error)}},Le.onerror=function(Be){return xe.close(),Z(Le.error)},Oe.oncomplete=function(){fe==null?xe.close():fe.oncomplete=function(){return xe.close()}}},re.onerror=function(fe){return Z(re.error)}})]})})},_}();if(j().getBool("IS_BROWSER"))try{_r.registerManager(Fi.URL_SCHEME,new Jo)}catch{}var jo="/",Bo="tensorflowjs_models",Ho="info",la="model_topology",va="weight_specs",Fa="weight_data",mu="model_metadata";function Li(_){return{info:[Bo,_,Ho].join(jo),topology:[Bo,_,la].join(jo),weightSpecs:[Bo,_,va].join(jo),weightData:[Bo,_,Fa].join(jo),modelMetadata:[Bo,_,mu].join(jo)}}function ts(_){var v=_.split(jo);if(v.length<3)throw new Error("Invalid key format: "+_);return v.slice(1,v.length-1).join(jo)}var ss=function(){function _(v){if(!j().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,v==null||!v)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=v,this.keys=Li(this.modelPath)}return _.prototype.save=function(v){return D(this,void 0,void 0,function(){var d,y,C;return R(this,function(z){if(v.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");d=JSON.stringify(v.modelTopology),y=JSON.stringify(v.weightSpecs),C=Wn(v);try{return this.LS.setItem(this.keys.info,JSON.stringify(C)),this.LS.setItem(this.keys.topology,d),this.LS.setItem(this.keys.weightSpecs,y),this.LS.setItem(this.keys.weightData,function(Z){if(xn)return E.from(Z).toString("base64");for(var re=new Uint8Array(Z),fe="",xe=0,Oe=re.length;xe<Oe;xe++)fe+=String.fromCharCode(re[xe]);return btoa(fe)}(v.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:v.format,generatedBy:v.generatedBy,convertedBy:v.convertedBy,userDefinedMetadata:v.userDefinedMetadata})),[2,{modelArtifactsInfo:C}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+C.modelTopologyBytes+", weightSpecsBytes="+C.weightSpecsBytes+", weightDataBytes="+C.weightDataBytes+".")}return[2]})})},_.prototype.load=function(){return D(this,void 0,void 0,function(){var v,d,y,C,z,Z,re;return R(this,function(fe){if((v=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(v.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(d={},(y=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(d.modelTopology=y,(C=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(d.weightSpecs=C,(z=this.LS.getItem(this.keys.modelMetadata))!=null&&(Z=JSON.parse(z),d.format=Z.format,d.generatedBy=Z.generatedBy,d.convertedBy=Z.convertedBy,d.userDefinedMetadata=Z.userDefinedMetadata),(re=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return d.weightData=function(xe){if(xn){var Oe=E.from(xe,"base64");return Oe.buffer.slice(Oe.byteOffset,Oe.byteOffset+Oe.byteLength)}for(var Re=atob(xe),Le=new Uint8Array(Re.length),Be=0;Be<Re.length;++Be)Le.set([Re.charCodeAt(Be)],Be);return Le.buffer}(re),[2,d]})})},_.URL_SCHEME="localstorage://",_}(),gu=function(_){return j().getBool("IS_BROWSER")&&!Array.isArray(_)&&_.startsWith(ss.URL_SCHEME)?(v=_.slice(ss.URL_SCHEME.length),new ss(v)):null;var v};Jn.registerSaveRouter(gu),Jn.registerLoadRouter(gu);var Ws=function(){function _(){we(j().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),we(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return _.prototype.listModels=function(){return D(this,void 0,void 0,function(){var v,d,y,C,z,Z;return R(this,function(re){for(v={},d=Bo+jo,y=jo+Ho,C=0;C<this.LS.length;++C)(z=this.LS.key(C)).startsWith(d)&&z.endsWith(y)&&(Z=ts(z),v[Z]=JSON.parse(this.LS.getItem(z)));return[2,v]})})},_.prototype.removeModel=function(v){return D(this,void 0,void 0,function(){var d,y;return R(this,function(C){var z;if(v=(z=v).startsWith(ss.URL_SCHEME)?z.slice(ss.URL_SCHEME.length):z,d=Li(v),this.LS.getItem(d.info)==null)throw new Error("Cannot find model at path '"+v+"'");return y=JSON.parse(this.LS.getItem(d.info)),this.LS.removeItem(d.info),this.LS.removeItem(d.topology),this.LS.removeItem(d.weightSpecs),this.LS.removeItem(d.weightData),[2,y]})})},_}();if(j().getBool("IS_BROWSER"))try{_r.registerManager(ss.URL_SCHEME,new Ws)}catch{}var Pu="model",Lu=".json",Bu=".weights.bin";function up(_){return new Promise(function(v){return setTimeout(v)}).then(_)}var Qd=function(){function _(v){if(!j().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");v.startsWith(_.URL_SCHEME)&&(v=v.slice(_.URL_SCHEME.length)),v!=null&&v.length!==0||(v=Pu),this.modelTopologyFileName=v+Lu,this.weightDataFileName=v+Bu}return _.prototype.save=function(v){return D(this,void 0,void 0,function(){var d,y,C,z,Z,re;return R(this,function(fe){switch(fe.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(d=window.URL.createObjectURL(new Blob([v.weightData],{type:"application/octet-stream"})),!(v.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return y=[{paths:["./"+this.weightDataFileName],weights:v.weightSpecs}],C={modelTopology:v.modelTopology,format:v.format,generatedBy:v.generatedBy,convertedBy:v.convertedBy,weightsManifest:y},z=window.URL.createObjectURL(new Blob([JSON.stringify(C)],{type:"application/json"})),(Z=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,Z.href=z,[4,up(function(){return Z.dispatchEvent(new MouseEvent("click"))})];case 2:return fe.sent(),v.weightData==null?[3,4]:((re=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,re.href=d,[4,up(function(){return re.dispatchEvent(new MouseEvent("click"))})]);case 3:fe.sent(),fe.label=4;case 4:return[2,{modelArtifactsInfo:Wn(v)}]}})})},_.URL_SCHEME="downloads://",_}(),Ql=function(){function _(v){if(v==null||v.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+v);this.files=v}return _.prototype.load=function(){return D(this,void 0,void 0,function(){var v,d,y=this;return R(this,function(C){return v=this.files[0],d=this.files.slice(1),[2,new Promise(function(z,Z){var re=new FileReader;re.onload=function(fe){var xe=JSON.parse(fe.target.result),Oe=xe.modelTopology;if(Oe!=null){d.length===0&&z({modelTopology:Oe});var Re=xe.weightsManifest;if(Re!=null){var Le;try{Le=y.checkManifestAndWeightFiles(Re,d)}catch(tt){return void Z(tt)}var Be=[],Xe=[],nt=[];Re.forEach(function(tt){tt.paths.forEach(function(ut){Xe.push(ut),nt.push(null)}),Be.push.apply(Be,tt.weights)}),Re.forEach(function(tt){tt.paths.forEach(function(ut){var Nt=new FileReader;Nt.onload=function(Pt){var jt=Pt.target.result,Yt=Xe.indexOf(ut);nt[Yt]=jt,nt.indexOf(null)===-1&&z({modelTopology:Oe,weightSpecs:Be,weightData:Fn(nt),format:xe.format,generatedBy:xe.generatedBy,convertedBy:xe.convertedBy,userDefinedMetadata:xe.userDefinedMetadata})},Nt.onerror=function(Pt){return Z("Failed to weights data from file of path '"+ut+"'.")},Nt.readAsArrayBuffer(Le[ut])})})}else Z(new Error("weightManifest field is missing from file "+v.name))}else Z(new Error("modelTopology field is missing from file "+v.name))},re.onerror=function(fe){return Z("Failed to read model topology and weights manifest JSON from file '"+v.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},re.readAsText(v)})]})})},_.prototype.checkManifestAndWeightFiles=function(v,d){for(var y=[],C=d.map(function(fe){return Rn(fe.name)}),z={},Z=0,re=v;Z<re.length;Z++)re[Z].paths.forEach(function(fe){var xe=Rn(fe);if(y.indexOf(xe)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+xe+"'");if(y.push(xe),C.indexOf(xe)===-1)throw new Error("Weight file with basename '"+xe+"' is not provided.");z[fe]=d[C.indexOf(xe)]});if(y.length!==d.length)throw new Error("Mismatch in the number of files in weights manifest ("+y.length+") and the number of weight files provided ("+d.length+").");return z},_}();function Gf(_,v,d,y){(function(z){we(z!=null&&Array.isArray(z)&&z.length>0,function(){return"promises must be a none empty array"})})(_),function(z,Z){we(z>=0&&z<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+z}),we(Z>=0&&Z<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+Z}),we(Z>=z,function(){return"startFraction must be no more than endFraction, but got startFraction "+z+" and endFraction "+Z})}(d=d??0,y=y??1);var C=0;return Promise.all(_.map(function(z){return z.then(function(Z){var re=d+ ++C/_.length*(y-d);return v(re),Z}),z}))}function Zl(_,v){return D(this,void 0,void 0,function(){var d,y,C,z,Z,re,fe,xe,Oe;return R(this,function(Re){switch(Re.label){case 0:return v==null&&(v={}),d=v.fetchFunc==null?j().platform.fetch:v.fetchFunc,y=_.map(function(Le){return d(Le,v.requestInit,{isBinary:!0})}),C=0,z=.5,v.onProgress!=null?[3,2]:[4,Promise.all(y)];case 1:return Z=Re.sent(),[3,4];case 2:return[4,Gf(y,v.onProgress,C,z)];case 3:Z=Re.sent(),Re.label=4;case 4:return re=Z.map(function(Le){return Le.arrayBuffer()}),fe=.5,xe=1,v.onProgress!=null?[3,6]:[4,Promise.all(re)];case 5:return Oe=Re.sent(),[3,8];case 6:return[4,Gf(re,v.onProgress,fe,xe)];case 7:Oe=Re.sent(),Re.label=8;case 8:return[2,Oe]}})})}function wc(_){var v=this;return function(d,y,C){return y===void 0&&(y=""),D(v,void 0,void 0,function(){var z,Z,re,fe,xe,Oe,Re,Le,Be,Xe;return R(this,function(nt){switch(nt.label){case 0:if(z=d.map(function(){return!1}),Z={},re=C!=null?C.map(function(){return!1}):[],fe=[],d.forEach(function(tt,ut){var Nt=0;tt.weights.forEach(function(Pt){var jt="quantization"in Pt?Pt.quantization.dtype:Pt.dtype,Yt=ot[jt]*ze(Pt.shape),gn=function(){z[ut]=!0,Z[ut]==null&&(Z[ut]=[]),Z[ut].push({manifestEntry:Pt,groupOffset:Nt,sizeBytes:Yt})};C!=null?C.forEach(function(wn,vn){wn===Pt.name&&(gn(),re[vn]=!0)}):gn(),fe.push(Pt.name),Nt+=Yt})}),!re.every(function(tt){return tt}))throw xe=C.filter(function(tt,ut){return!re[ut]}),new Error("Could not find weights in manifest with names: "+xe.join(", ")+`. 
Manifest JSON has weights with names: `+fe.join(", ")+".");return Oe=z.reduce(function(tt,ut,Nt){return ut&&tt.push(Nt),tt},[]),Re=[],Oe.forEach(function(tt){d[tt].paths.forEach(function(ut){var Nt=y+(y.endsWith("/")?"":"/")+ut;Re.push(Nt)})}),[4,_(Re)];case 1:return Le=nt.sent(),Be={},Xe=0,Oe.forEach(function(tt){for(var ut=d[tt].paths.length,Nt=0,Pt=0;Pt<ut;Pt++)Nt+=Le[Xe+Pt].byteLength;for(var jt=new ArrayBuffer(Nt),Yt=new Uint8Array(jt),gn=0,wn=0;wn<ut;wn++){var vn=new Uint8Array(Le[Xe+wn]);Yt.set(vn,gn),gn+=vn.byteLength}Z[tt].forEach(function(Cn){var Dn=Ht(jt.slice(Cn.groupOffset,Cn.groupOffset+Cn.sizeBytes),[Cn.manifestEntry]);for(var b in Dn)Be[b]=Dn[b]}),Xe+=ut}),[2,Be]}})})}}Jn.registerSaveRouter(function(_){return j().getBool("IS_BROWSER")&&!Array.isArray(_)&&_.startsWith(Qd.URL_SCHEME)?function(v){return v===void 0&&(v="model"),new Qd(v)}(_.slice(Qd.URL_SCHEME.length)):null});var Ka=function(){function _(v,d){if(this.DEFAULT_METHOD="POST",d==null&&(d={}),this.weightPathPrefix=d.weightPathPrefix,this.onProgress=d.onProgress,d.fetchFunc!=null?(we(typeof d.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=d.fetchFunc):this.fetch=j().platform.fetch,we(v!=null&&v.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(v)&&we(v.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+v.length+")."}),this.path=v,d.requestInit!=null&&d.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=d.requestInit||{}}return _.prototype.save=function(v){return D(this,void 0,void 0,function(){var d,y,C,z;return R(this,function(Z){switch(Z.label){case 0:if(v.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(d=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,y=[{paths:["./model.weights.bin"],weights:v.weightSpecs}],C={modelTopology:v.modelTopology,format:v.format,generatedBy:v.generatedBy,convertedBy:v.convertedBy,userDefinedMetadata:v.userDefinedMetadata,weightsManifest:y},d.body.append("model.json",new Blob([JSON.stringify(C)],{type:"application/json"}),"model.json"),v.weightData!=null&&d.body.append("model.weights.bin",new Blob([v.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,d)];case 1:if((z=Z.sent()).ok)return[2,{modelArtifactsInfo:Wn(v),responses:[z]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+z.status+".")}})})},_.prototype.load=function(){return D(this,void 0,void 0,function(){var v,d,y,C,z,Z,re,fe,xe,Oe,Re,Le;return R(this,function(Be){switch(Be.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(v=Be.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+v.status+". Please verify this URL points to the model JSON of the model to load.");Be.label=2;case 2:return Be.trys.push([2,4,,5]),[4,v.json()];case 3:return d=Be.sent(),[3,5];case 4:throw Be.sent(),y="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?y+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":y+=" Please make sure the server is serving valid JSON for this request.",new Error(y);case 5:if(C=d.modelTopology,z=d.weightsManifest,Z=d.generatedBy,re=d.convertedBy,fe=d.format,xe=d.userDefinedMetadata,C==null&&z==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return z==null?[3,7]:[4,this.loadWeights(z)];case 6:Le=Be.sent(),Oe=Le[0],Re=Le[1],Be.label=7;case 7:return[2,{modelTopology:C,weightSpecs:Oe,weightData:Re,userDefinedMetadata:xe,generatedBy:Z,convertedBy:re,format:fe}]}})})},_.prototype.loadWeights=function(v){return D(this,void 0,void 0,function(){var d,y,C,z,Z,re,fe,xe,Oe,Re,Le;return R(this,function(Be){switch(Be.label){case 0:for(d=Array.isArray(this.path)?this.path[1]:this.path,y=function(Xe){var nt=Xe.lastIndexOf("/"),tt=Xe.lastIndexOf("?");return[Xe.substring(0,nt)+"/",tt>nt?Xe.substring(tt):""]}(d),C=y[0],z=y[1],Z=this.weightPathPrefix||C,re=[],fe=0,xe=v;fe<xe.length;fe++)Oe=xe[fe],re.push.apply(re,Oe.weights);return Re=[],v.forEach(function(Xe){Xe.paths.forEach(function(nt){Re.push(Z+nt+z)})}),[4,Zl(Re,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return Le=Be.sent(),[2,[re,Fn(Le)]]}})})},_.URL_SCHEME_REGEX=/^https?:\/\//,_}();function qf(_){return _.match(Ka.URL_SCHEME_REGEX)!=null}var Zd=function(_,v){return typeof fetch>"u"?null:(Array.isArray(_)?_.every(function(d){return qf(d)}):qf(_))?cp(_,{onProgress:v}):null};function cp(_,v){return new Ka(_,v)}Jn.registerSaveRouter(Zd),Jn.registerLoadRouter(Zd);var $f,As=function(){function _(v){this.modelArtifacts=v}return _.prototype.load=function(){return D(this,void 0,void 0,function(){return R(this,function(v){return[2,this.modelArtifacts]})})},_}(),eh=function(){function _(v){this.saveHandler=v}return _.prototype.save=function(v){return D(this,void 0,void 0,function(){return R(this,function(d){return[2,this.saveHandler(v)]})})},_}(),lp=Object.freeze({browserFiles:function(_){return new Ql(_)},browserHTTPRequest:function(_,v){return cp(_,v)},concatenateArrayBuffers:Fn,decodeWeights:Ht,encodeWeights:function(_,v){return D(this,void 0,void 0,function(){var d,y,C,z,Z,re=this;return R(this,function(fe){switch(fe.label){case 0:for(d=[],y=[],C=Array.isArray(_)?_.map(function(xe){return xe.name}):Object.keys(_),z=function(xe){var Oe=C[xe],Re=Array.isArray(_)?_[xe].tensor:_[Oe];if(Re.dtype!=="float32"&&Re.dtype!=="int32"&&Re.dtype!=="bool"&&Re.dtype!=="string")throw new Error("Unsupported dtype in weight '"+Oe+"': "+Re.dtype);var Le={name:Oe,shape:Re.shape,dtype:Re.dtype};if(Re.dtype==="string"){var Be=new Promise(function(Xe){return D(re,void 0,void 0,function(){var nt,tt,ut,Nt,Pt,jt,Yt;return R(this,function(gn){switch(gn.label){case 0:return[4,Re.bytes()];case 1:for(nt=gn.sent(),tt=nt.reduce(function(wn,vn){return wn+vn.length},0)+zt*nt.length,ut=new Uint8Array(tt),Nt=0,Pt=0;Pt<nt.length;Pt++)jt=nt[Pt],Yt=new Uint8Array(new Uint32Array([jt.length]).buffer),ut.set(Yt,Nt),Nt+=zt,ut.set(jt,Nt),Nt+=jt.length;return Xe(ut),[2]}})})});y.push(Be)}else y.push(Re.data());v!=null&&(Le.group=v),d.push(Le)},Z=0;Z<C.length;++Z)z(Z);return[4,Promise.all(y)];case 1:return[2,{data:function(xe){if(xe===null)throw new Error("Invalid input value: "+JSON.stringify(xe));var Oe=0,Re=[];xe.forEach(function(Xe){if(Oe+=Xe.byteLength,Re.push(Xe.byteLength===Xe.buffer.byteLength?Xe:new Xe.constructor(Xe)),!(Xe instanceof Float32Array||Xe instanceof Int32Array||Xe instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+Xe.constructor.name)});var Le=new Uint8Array(Oe),Be=0;return Re.forEach(function(Xe){Le.set(new Uint8Array(Xe.buffer),Be),Be+=Xe.byteLength}),Le.buffer}(fe.sent()),specs:d}]}})})},fromMemory:function(_,v,d,y){return arguments.length===1?_.modelTopology!=null||_.weightSpecs!=null?new As(_):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new As({modelTopology:_})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new As({modelTopology:_,weightSpecs:v,weightData:d,trainingConfig:y}))},getLoadHandlers:function(_,v){return Jn.getLoadHandlers(_,v)},getModelArtifactsInfoForJSON:Wn,getSaveHandlers:function(_){return Jn.getSaveHandlers(_)},http:cp,isHTTPScheme:qf,loadWeights:function(_,v,d,y){return v===void 0&&(v=""),D(this,void 0,void 0,function(){return R(this,function(C){return[2,wc(function(z){return Zl(z,{requestInit:y})})(_,v,d)]})})},registerLoadRouter:function(_){return Jn.registerLoadRouter(_)},registerSaveRouter:function(_){return Jn.registerSaveRouter(_)},weightsLoaderFactory:wc,withSaveHandler:function(_){return new eh(_)},copyModel:function(_,v){return D(this,void 0,void 0,function(){return R(this,function(d){return[2,Ir(_,v,!1)]})})},listModels:function(){return D(this,void 0,void 0,function(){var _,v,d,y,C,z,Z;return R(this,function(re){switch(re.label){case 0:_=_r.getSchemes(),v={},d=0,y=_,re.label=1;case 1:return d<y.length?(C=y[d],[4,_r.getManager(C).listModels()]):[3,4];case 2:for(Z in z=re.sent())v[C+Tn+Z]=z[Z];re.label=3;case 3:return d++,[3,1];case 4:return[2,v]}})})},moveModel:function(_,v){return D(this,void 0,void 0,function(){return R(this,function(d){return[2,Ir(_,v,!0)]})})},removeModel:function(_){return D(this,void 0,void 0,function(){var v;return R(this,function(d){return v=Nr(_),[2,_r.getManager(v.scheme).removeModel(v.path)]})})}}),fp=Lt({confusionMatrix_:function(_,v,d){var y=Ze(_,"labels","confusionMatrix"),C=Ze(v,"predictions","confusionMatrix");we(d==null||d>0&&Number.isInteger(d),function(){return"If provided, numClasses must be a positive integer, but got "+d}),we(y.rank===1,function(){return"Expected the rank of labels to be 1, but got "+y.rank}),we(C.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+C.rank}),we(y.shape[0]===C.shape[0],function(){return"Mismatch in the number of examples: "+y.shape[0]+" vs. "+C.shape[0]+". Labels and predictions should have the same number of elements."}),we(d>0&&Number.isInteger(d),function(){return"numClasses is required to be a positive integer, but got "+d});var z=zh(y.asType("int32"),d),Z=zh(C.asType("int32"),d);return z.transpose().matMul(Z).asType("int32")}}),vl=Object.freeze({confusionMatrix:fp}),Nm=Lt({fromPixels_:function(_,v){if(v===void 0&&(v=3),v>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(_==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var d=!1,y=!1,C=!1,z=!1,Z=!1;if(_.data instanceof Uint8Array)d=!0;else if(typeof ImageData<"u"&&_ instanceof ImageData)y=!0;else if(typeof HTMLVideoElement<"u"&&_ instanceof HTMLVideoElement)C=!0;else if(typeof HTMLImageElement<"u"&&_ instanceof HTMLImageElement)z=!0;else{if(_.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+_.constructor.name);Z=!0}if(C&&C&&_.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(Y("FromPixels",He.backendName)!=null)return He.runKernel("FromPixels",{pixels:_},{numChannels:v});var re,fe,xe=C?[_.videoWidth,_.videoHeight]:[_.width,_.height],Oe=xe[0],Re=xe[1];if(Z?re=_.getContext("2d").getImageData(0,0,Oe,Re).data:y||d?re=_.data:(z||C)&&($f==null&&($f=document.createElement("canvas").getContext("2d")),$f.canvas.width=Oe,$f.canvas.height=Re,$f.drawImage(_,0,0,Oe,Re),re=$f.getImageData(0,0,Oe,Re).data),v===4)fe=new Int32Array(re);else{var Le=Oe*Re;fe=new Int32Array(Le*v);for(var Be=0;Be<Le;Be++)for(var Xe=0;Xe<v;++Xe)fe[Be*v+Xe]=re[4*Be+Xe]}return Dl(fe,[Re,Oe,v],"int32")}}),_c=Object.freeze({toPixels:function(_,v){return D(this,void 0,void 0,function(){var d,y,C,z,Z,re,fe,xe,Oe,Re,Le,Be,Xe,nt,tt,ut,Nt,Pt,jt,Yt,gn,wn,vn;return R(this,function(Cn){switch(Cn.label){case 0:if(d=Ze(_,"img","toPixels"),_ instanceof Qt||(d=d.toInt()),d.rank!==2&&d.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+d.rank+".");if(y=d.shape.slice(0,2),C=y[0],z=y[1],(Z=d.rank===2?1:d.shape[2])>4||Z===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+Z);return[4,d.data()];case 1:return re=Cn.sent(),fe=d.min(),xe=d.max(),[4,Promise.all([fe.data(),xe.data()])];case 2:if(Oe=Cn.sent(),Re=Oe[0],Le=Oe[1],Be=Re[0],Xe=Le[0],fe.dispose(),xe.dispose(),d.dtype==="float32"){if(Be<0||Xe>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+Be+" - "+Xe+"].")}else{if(d.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+d.dtype+". Please use float32 or int32 tensors.");if(Be<0||Xe>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+Be+" - "+Xe+"].")}for(nt=d.dtype==="float32"?255:1,tt=new Uint8ClampedArray(z*C*4),ut=0;ut<C*z;++ut)Nt=void 0,Pt=void 0,jt=void 0,Yt=void 0,Z===1?(Nt=re[ut]*nt,Pt=re[ut]*nt,jt=re[ut]*nt,Yt=255):Z===3?(Nt=re[3*ut]*nt,Pt=re[3*ut+1]*nt,jt=re[3*ut+2]*nt,Yt=255):Z===4&&(Nt=re[4*ut]*nt,Pt=re[4*ut+1]*nt,jt=re[4*ut+2]*nt,Yt=re[4*ut+3]*nt),tt[0+(gn=4*ut)]=Math.round(Nt),tt[gn+1]=Math.round(Pt),tt[gn+2]=Math.round(jt),tt[gn+3]=Math.round(Yt);return v!=null&&(v.width=z,v.height=C,wn=v.getContext("2d"),vn=new ImageData(tt,z,C),wn.putImageData(vn,0,0)),d!==_&&d.dispose(),[2,tt]}})})},fromPixels:Nm}),Vs=function(){function _(){}return _.prototype.getClassName=function(){return this.constructor.className},_.fromConfig=function(v,d){return new v(d)},_}(),oc=function(){function _(){this.classNameMap={}}return _.getMap=function(){return _.instance==null&&(_.instance=new _),_.instance},_.register=function(v){_.getMap().classNameMap[v.className]=[v,v.fromConfig]},_}();function Os(_){we(_.className!=null,function(){return"Class being registered does not have the static className property defined."}),we(typeof _.className=="string",function(){return"className is required to be a string, but got type "+typeof _.className}),we(_.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),oc.register(_)}var ef=Object.freeze({Serializable:Vs,SerializationMap:oc,registerClass:Os}),th=.001,dp=.1;function nh(){return He.backend.floatPrecision()===32?th:dp}function Im(_,v,d){var y=!0;if((ft(_)||ft(v))&&(y=!1),ft(_)&&ft(v)&&(y=!0),y){var C=_.constructor.name,z=v.constructor.name;if(C!==z)throw new Error("Arrays are of different type. Actual: "+C+". Expected: "+z)}if(Array.isArray(_)&&Array.isArray(v)){var Z=Qa(_),re=Qa(v);if(!Ut(Z,re))throw new Error("Arrays have different shapes. Actual: ["+Z+"]. Expected: ["+re+"]")}var fe=ft(_)?_:Ot(_),xe=ft(v)?v:Ot(v);if(fe.length!==xe.length)throw new Error("Arrays have different lengths actual: "+fe.length+" vs expected: "+xe.length+`.
Actual:   `+fe+`.
Expected: `+xe+".");for(var Oe=0;Oe<xe.length;++Oe){var Re=fe[Oe],Le=xe[Oe];if(!d(Re,Le))throw new Error("Arrays differ: actual["+Oe+"] = "+Re+", expected["+Oe+"] = "+Le+`.
Actual:   `+fe+`.
Expected: `+xe+".")}}function tf(_,v,d){return!isFinite(_)&&!isFinite(v)||!(isNaN(_)||isNaN(v)||Math.abs(_-v)>d)}var ku=Object.freeze({TEST_EPSILON_FLOAT16:dp,expectArraysClose:function(_,v,d){return d==null&&(d=nh()),Im(_,v,function(y,C){return tf(y,C,d)})},testEpsilon:nh,expectPromiseToFail:function(_,v){_().then(function(){return v.fail()},function(){return v()})},expectArraysEqual:function(_,v){var d=typeof v=="string"||typeof v=="number"||typeof v=="boolean"?[v]:v;return Pn(_)||Pn(_[0])||Pn(v)||Pn(v[0])?Im(_,d,function(y,C){return y==C}):Im(_,v,function(y,C){return tf(y,C,0)})},expectNumbersClose:function(_,v,d){if(d==null&&(d=nh()),!tf(_,v,d))throw new Error("Numbers differ: actual === "+_+", expected === "+v)},expectValuesInRange:function(_,v,d){for(var y=0;y<_.length;y++)if(_[y]<v||_[y]>d)throw new Error("Value out of range:"+_[y]+" low: "+v+", high: "+d)},expectArrayBuffersEqual:function(_,v){expect(new Float32Array(_)).toEqual(new Float32Array(v))}}),H1="1.7.0",nf=Object.freeze({gpgpu_util:Ys,webgl_util:yd,forceHalfFloat:function(){j().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:Ny,setWebGLContext:Ai,GPGPUContext:ca}),hp=function(_){function v(){return _!==null&&_.apply(this,arguments)||this}return B(v,_),v.prototype.minimize=function(d,y,C){y===void 0&&(y=!1);var z=this.computeGradients(d,C),Z=z.value,re=z.grads;if(C!=null){var fe=C.map(function(xe){return{name:xe.name,tensor:re[xe.name]}});this.applyGradients(fe)}else this.applyGradients(re);return zo(re),y?Z:(Z.dispose(),null)},Object.defineProperty(v.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),v.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},v.prototype.computeGradients=function(d,y){return bn(d,y)},v.prototype.dispose=function(){this.iterations_!=null&&zo(this.iterations_)},v.prototype.saveIterations=function(){return D(this,void 0,void 0,function(){return R(this,function(d){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Ar(this.iterations_,"int32")}]})})},v.prototype.getWeights=function(){return D(this,void 0,void 0,function(){return R(this,function(d){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},v.prototype.setWeights=function(d){return D(this,void 0,void 0,function(){return R(this,function(y){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},v.prototype.extractIterations=function(d){return D(this,void 0,void 0,function(){var y;return R(this,function(C){switch(C.label){case 0:return y=this,[4,d[0].tensor.data()];case 1:return y.iterations_=C.sent()[0],[2,d.slice(1)]}})})},v}(Vs);Object.defineProperty(hp,Symbol.hasInstance,{value:function(_){return _.minimize!=null&&_.computeGradients!=null&&_.applyGradients!=null}});var G1=function(_){function v(d,y,C){C===void 0&&(C=null);var z=_.call(this)||this;return z.learningRate=d,z.rho=y,z.epsilon=C,z.accumulatedGrads=[],z.accumulatedUpdates=[],C==null&&(z.epsilon=He.backend.epsilon()),z}return B(v,_),v.prototype.applyGradients=function(d){var y=this;(Array.isArray(d)?d.map(function(C){return C.name}):Object.keys(d)).forEach(function(C,z){var Z=He.registeredVariables[C];y.accumulatedGrads[z]==null&&(y.accumulatedGrads[z]={originalName:C+"/accum_grad",variable:qi(function(){return vi(Z).variable(!1)})}),y.accumulatedUpdates[z]==null&&(y.accumulatedUpdates[z]={originalName:C+"/accum_var",variable:qi(function(){return vi(Z).variable(!1)})});var re=Array.isArray(d)?d[z].tensor:d[C];if(re!=null){var fe=y.accumulatedGrads[z].variable,xe=y.accumulatedUpdates[z].variable;qi(function(){var Oe=fe.mul(y.rho).add(re.square().mul(1-y.rho)),Re=xe.add(y.epsilon).sqrt().div(fe.add(y.epsilon).sqrt()).mul(re),Le=xe.mul(y.rho).add(Re.square().mul(1-y.rho));fe.assign(Oe),xe.assign(Le);var Be=Re.mul(-y.learningRate).add(Z);Z.assign(Be)})}}),this.incrementIterations()},v.prototype.dispose=function(){this.accumulatedUpdates!=null&&(zo(this.accumulatedGrads.map(function(d){return d.variable})),zo(this.accumulatedUpdates.map(function(d){return d.variable})))},v.prototype.getWeights=function(){return D(this,void 0,void 0,function(){var d;return R(this,function(y){switch(y.label){case 0:return d=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[y.sent()].concat(d.map(function(C){return{name:C.originalName,tensor:C.variable}}))]}})})},v.prototype.setWeights=function(d){return D(this,void 0,void 0,function(){var y;return R(this,function(C){switch(C.label){case 0:return[4,this.extractIterations(d)];case 1:return d=C.sent(),y=d.length/2,this.accumulatedGrads=d.slice(0,y).map(function(z){return{originalName:z.name,variable:z.tensor.variable(!1)}}),this.accumulatedUpdates=d.slice(y,2*y).map(function(z){return{originalName:z.name,variable:z.tensor.variable(!1)}}),[2]}})})},v.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},v.fromConfig=function(d,y){return new d(y.learningRate,y.rho,y.epsilon)},v.className="Adadelta",v}(hp);Os(G1);var q1=function(_){function v(d,y){y===void 0&&(y=.1);var C=_.call(this)||this;return C.learningRate=d,C.initialAccumulatorValue=y,C.accumulatedGrads=[],C}return B(v,_),v.prototype.applyGradients=function(d){var y=this;(Array.isArray(d)?d.map(function(C){return C.name}):Object.keys(d)).forEach(function(C,z){var Z=He.registeredVariables[C];y.accumulatedGrads[z]==null&&(y.accumulatedGrads[z]={originalName:C+"/accumulator",variable:qi(function(){return Rs(Z.shape,y.initialAccumulatorValue).variable(!1)})});var re=Array.isArray(d)?d[z].tensor:d[C];if(re!=null){var fe=y.accumulatedGrads[z].variable;qi(function(){var xe=fe.add(re.square());fe.assign(xe);var Oe=re.div(xe.add(He.backend.epsilon()).sqrt()).mul(-y.learningRate).add(Z);Z.assign(Oe)})}}),this.incrementIterations()},v.prototype.dispose=function(){this.accumulatedGrads!=null&&zo(this.accumulatedGrads.map(function(d){return d.variable}))},v.prototype.getWeights=function(){return D(this,void 0,void 0,function(){return R(this,function(d){switch(d.label){case 0:return[4,this.saveIterations()];case 1:return[2,[d.sent()].concat(this.accumulatedGrads.map(function(y){return{name:y.originalName,tensor:y.variable}}))]}})})},v.prototype.setWeights=function(d){return D(this,void 0,void 0,function(){return R(this,function(y){switch(y.label){case 0:return[4,this.extractIterations(d)];case 1:return d=y.sent(),this.accumulatedGrads=d.map(function(C){return{originalName:C.name,variable:C.tensor.variable(!1)}}),[2]}})})},v.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},v.fromConfig=function(d,y){return new d(y.learningRate,y.initialAccumulatorValue)},v.className="Adagrad",v}(hp);Os(q1);var $1=function(_){function v(d,y,C,z){z===void 0&&(z=null);var Z=_.call(this)||this;return Z.learningRate=d,Z.beta1=y,Z.beta2=C,Z.epsilon=z,Z.accumulatedFirstMoment=[],Z.accumulatedSecondMoment=[],qi(function(){Z.accBeta1=Ar(y).variable(),Z.accBeta2=Ar(C).variable()}),z==null&&(Z.epsilon=He.backend.epsilon()),Z}return B(v,_),v.prototype.applyGradients=function(d){var y=this,C=Array.isArray(d)?d.map(function(z){return z.name}):Object.keys(d);qi(function(){var z=hl(1,y.accBeta1),Z=hl(1,y.accBeta2);C.forEach(function(re,fe){var xe=He.registeredVariables[re];y.accumulatedFirstMoment[fe]==null&&(y.accumulatedFirstMoment[fe]={originalName:re+"/m",variable:qi(function(){return vi(xe).variable(!1)})}),y.accumulatedSecondMoment[fe]==null&&(y.accumulatedSecondMoment[fe]={originalName:re+"/v",variable:qi(function(){return vi(xe).variable(!1)})});var Oe=Array.isArray(d)?d[fe].tensor:d[re];if(Oe!=null){var Re=y.accumulatedFirstMoment[fe].variable,Le=y.accumulatedSecondMoment[fe].variable,Be=Re.mul(y.beta1).add(Oe.mul(1-y.beta1)),Xe=Le.mul(y.beta2).add(Oe.square().mul(1-y.beta2)),nt=Be.div(z),tt=Xe.div(Z);Re.assign(Be),Le.assign(Xe);var ut=nt.div(tt.sqrt().add(y.epsilon)).mul(-y.learningRate).add(xe);xe.assign(ut)}}),y.accBeta1.assign(y.accBeta1.mul(y.beta1)),y.accBeta2.assign(y.accBeta2.mul(y.beta2))}),this.incrementIterations()},v.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&zo(this.accumulatedFirstMoment.map(function(d){return d.variable})),this.accumulatedSecondMoment!=null&&zo(this.accumulatedSecondMoment.map(function(d){return d.variable}))},v.prototype.getWeights=function(){return D(this,void 0,void 0,function(){var d;return R(this,function(y){switch(y.label){case 0:return d=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[y.sent()].concat(d.map(function(C){return{name:C.originalName,tensor:C.variable}}))]}})})},v.prototype.setWeights=function(d){return D(this,void 0,void 0,function(){var y,C=this;return R(this,function(z){switch(z.label){case 0:return[4,this.extractIterations(d)];case 1:return d=z.sent(),qi(function(){C.accBeta1.assign(Wd(C.beta1,C.iterations_+1)),C.accBeta2.assign(Wd(C.beta2,C.iterations_+1))}),y=d.length/2,this.accumulatedFirstMoment=d.slice(0,y).map(function(Z){return{originalName:Z.name,variable:Z.tensor.variable(!1)}}),this.accumulatedSecondMoment=d.slice(y,2*y).map(function(Z){return{originalName:Z.name,variable:Z.tensor.variable(!1)}}),[2]}})})},v.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},v.fromConfig=function(d,y){return new d(y.learningRate,y.beta1,y.beta2,y.epsilon)},v.className="Adam",v}(hp);Os($1);var Xv=function(_){function v(d,y,C,z,Z){z===void 0&&(z=null),Z===void 0&&(Z=0);var re=_.call(this)||this;return re.learningRate=d,re.beta1=y,re.beta2=C,re.epsilon=z,re.decay=Z,re.accumulatedFirstMoment=[],re.accumulatedWeightedInfNorm=[],qi(function(){re.iteration=Ar(0).variable(),re.accBeta1=Ar(y).variable()}),z==null&&(re.epsilon=He.backend.epsilon()),re}return B(v,_),v.prototype.applyGradients=function(d){var y=this,C=Array.isArray(d)?d.map(function(z){return z.name}):Object.keys(d);qi(function(){var z=hl(1,y.accBeta1),Z=Rf(-y.learningRate,y.iteration.mul(y.decay).add(1));C.forEach(function(re,fe){var xe=He.registeredVariables[re];y.accumulatedFirstMoment[fe]==null&&(y.accumulatedFirstMoment[fe]={originalName:re+"/m",variable:vi(xe).variable(!1)}),y.accumulatedWeightedInfNorm[fe]==null&&(y.accumulatedWeightedInfNorm[fe]={originalName:re+"/v",variable:vi(xe).variable(!1)});var Oe=Array.isArray(d)?d[fe].tensor:d[re];if(Oe!=null){var Re=y.accumulatedFirstMoment[fe].variable,Le=y.accumulatedWeightedInfNorm[fe].variable,Be=Re.mul(y.beta1).add(Oe.mul(1-y.beta1)),Xe=Le.mul(y.beta2),nt=Oe.abs(),tt=Xe.maximum(nt);Re.assign(Be),Le.assign(tt);var ut=Z.div(z).mul(Be.div(tt.add(y.epsilon))).add(xe);xe.assign(ut)}}),y.iteration.assign(y.iteration.add(1)),y.accBeta1.assign(y.accBeta1.mul(y.beta1))}),this.incrementIterations()},v.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&zo(this.accumulatedFirstMoment.map(function(d){return d.variable})),this.accumulatedWeightedInfNorm!=null&&zo(this.accumulatedWeightedInfNorm.map(function(d){return d.variable}))},v.prototype.getWeights=function(){return D(this,void 0,void 0,function(){return R(this,function(d){throw new Error("getWeights() is not implemented for Adamax yet.")})})},v.prototype.setWeights=function(d){return D(this,void 0,void 0,function(){return R(this,function(y){throw new Error("setWeights() is not implemented for Adamax yet.")})})},v.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},v.fromConfig=function(d,y){return new d(y.learningRate,y.beta1,y.beta2,y.epsilon,y.decay)},v.className="Adamax",v}(hp);Os(Xv);var Vy=function(_){function v(d){var y=_.call(this)||this;return y.learningRate=d,y.setLearningRate(d),y}return B(v,_),v.prototype.applyGradients=function(d){var y=this;(Array.isArray(d)?d.map(function(C){return C.name}):Object.keys(d)).forEach(function(C,z){var Z=Array.isArray(d)?d[z].tensor:d[C];if(Z!=null){var re=He.registeredVariables[C];qi(function(){var fe=y.c.mul(Z).add(re);re.assign(fe)})}}),this.incrementIterations()},v.prototype.setLearningRate=function(d){this.learningRate=d,this.c!=null&&this.c.dispose(),this.c=Dh(Ar(-d))},v.prototype.dispose=function(){this.c.dispose()},v.prototype.getWeights=function(){return D(this,void 0,void 0,function(){return R(this,function(d){switch(d.label){case 0:return[4,this.saveIterations()];case 1:return[2,[d.sent()]]}})})},v.prototype.setWeights=function(d){return D(this,void 0,void 0,function(){return R(this,function(y){switch(y.label){case 0:return[4,this.extractIterations(d)];case 1:if((d=y.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},v.prototype.getConfig=function(){return{learningRate:this.learningRate}},v.fromConfig=function(d,y){return new d(y.learningRate)},v.className="SGD",v}(hp);Os(Vy);var Kv=function(_){function v(d,y,C){C===void 0&&(C=!1);var z=_.call(this,d)||this;return z.learningRate=d,z.momentum=y,z.useNesterov=C,z.accumulations=[],z.m=Ar(z.momentum),z}return B(v,_),v.prototype.applyGradients=function(d){var y=this;(Array.isArray(d)?d.map(function(C){return C.name}):Object.keys(d)).forEach(function(C,z){var Z=He.registeredVariables[C];y.accumulations[z]==null&&(y.accumulations[z]={originalName:C+"/momentum",variable:qi(function(){return vi(Z).variable(!1)})});var re=y.accumulations[z].variable,fe=Array.isArray(d)?d[z].tensor:d[C];fe!=null&&qi(function(){var xe,Oe=y.m.mul(re).add(fe);xe=y.useNesterov?y.c.mul(fe.add(Oe.mul(y.m))).add(Z):y.c.mul(Oe).add(Z),re.assign(Oe),Z.assign(xe)})}),this.incrementIterations()},v.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&zo(this.accumulations.map(function(d){return d.variable}))},v.prototype.setMomentum=function(d){this.momentum=d},v.prototype.getWeights=function(){return D(this,void 0,void 0,function(){return R(this,function(d){switch(d.label){case 0:return[4,this.saveIterations()];case 1:return[2,[d.sent()].concat(this.accumulations.map(function(y){return{name:y.originalName,tensor:y.variable}}))]}})})},v.prototype.setWeights=function(d){return D(this,void 0,void 0,function(){return R(this,function(y){switch(y.label){case 0:return[4,this.extractIterations(d)];case 1:return d=y.sent(),this.accumulations=d.map(function(C){return{originalName:C.name,variable:C.tensor.variable(!1)}}),[2]}})})},v.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},v.fromConfig=function(d,y){return new d(y.learningRate,y.momentum,y.useNesterov)},v.className="Momentum",v}(Vy);Os(Kv);var Hy=function(_){function v(d,y,C,z,Z){y===void 0&&(y=.9),C===void 0&&(C=0),z===void 0&&(z=null),Z===void 0&&(Z=!1);var re=_.call(this)||this;if(re.learningRate=d,re.decay=y,re.momentum=C,re.epsilon=z,re.accumulatedMeanSquares=[],re.accumulatedMoments=[],re.accumulatedMeanGrads=[],re.centered=Z,z==null&&(re.epsilon=He.backend.epsilon()),d==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return re}return B(v,_),v.prototype.applyGradients=function(d){var y=this;(Array.isArray(d)?d.map(function(C){return C.name}):Object.keys(d)).forEach(function(C,z){var Z=He.registeredVariables[C];y.accumulatedMeanSquares[z]==null&&(y.accumulatedMeanSquares[z]={originalName:C+"/rms",variable:qi(function(){return vi(Z).variable(!1)})}),y.accumulatedMoments[z]==null&&(y.accumulatedMoments[z]={originalName:C+"/momentum",variable:qi(function(){return vi(Z).variable(!1)})}),y.accumulatedMeanGrads[z]==null&&y.centered&&(y.accumulatedMeanGrads[z]={originalName:C+"/mg",variable:qi(function(){return vi(Z).variable(!1)})});var re=Array.isArray(d)?d[z].tensor:d[C];if(re!=null){var fe=y.accumulatedMeanSquares[z].variable,xe=y.accumulatedMoments[z].variable;qi(function(){var Oe=fe.mul(y.decay).add(re.square().mul(1-y.decay));if(y.centered){var Re=y.accumulatedMeanGrads[z].variable,Le=Re.mul(y.decay).add(re.mul(1-y.decay)),Be=xe.mul(y.momentum).add(re.mul(y.learningRate).div(Oe.sub(Le.square().add(y.epsilon)).sqrt()));fe.assign(Oe),Re.assign(Le),xe.assign(Be);var Xe=Z.sub(Be);Z.assign(Xe)}else{var nt=fe.mul(y.decay).add(re.square().mul(1-y.decay));Be=xe.mul(y.momentum).add(re.mul(y.learningRate).div(nt.add(y.epsilon).sqrt())),fe.assign(nt),xe.assign(Be),Xe=Z.sub(Be),Z.assign(Xe)}})}}),this.incrementIterations()},v.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&zo(this.accumulatedMeanSquares.map(function(d){return d.variable})),this.accumulatedMeanGrads!=null&&this.centered&&zo(this.accumulatedMeanGrads.map(function(d){return d.variable})),this.accumulatedMoments!=null&&zo(this.accumulatedMoments.map(function(d){return d.variable}))},v.prototype.getWeights=function(){return D(this,void 0,void 0,function(){var d;return R(this,function(y){switch(y.label){case 0:return d=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&d.push.apply(d,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[y.sent()].concat(d.map(function(C){return{name:C.originalName,tensor:C.variable}}))]}})})},v.prototype.setWeights=function(d){return D(this,void 0,void 0,function(){var y;return R(this,function(C){switch(C.label){case 0:return[4,this.extractIterations(d)];case 1:return d=C.sent(),y=this.centered?d.length/3:d.length/2,this.accumulatedMeanSquares=d.slice(0,y).map(function(z){return{originalName:z.name,variable:z.tensor.variable(!1)}}),this.accumulatedMoments=d.slice(y,2*y).map(function(z){return{originalName:z.name,variable:z.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=d.slice(2*y,3*y).map(function(z){return{originalName:z.name,variable:z.tensor.variable(!1)}})),[2]}})})},v.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},v.fromConfig=function(d,y){return new d(y.learningRate,y.decay,y.momentum,y.epsilon,y.centered)},v.className="RMSProp",v}(hp);Os(Hy);var Gc=function(){function _(){}return _.sgd=function(v){return new Vy(v)},_.momentum=function(v,d,y){return y===void 0&&(y=!1),new Kv(v,d,y)},_.rmsprop=function(v,d,y,C,z){return d===void 0&&(d=.9),y===void 0&&(y=0),C===void 0&&(C=null),z===void 0&&(z=!1),new Hy(v,d,y,C,z)},_.adam=function(v,d,y,C){return v===void 0&&(v=.001),d===void 0&&(d=.9),y===void 0&&(y=.999),C===void 0&&(C=null),new $1(v,d,y,C)},_.adadelta=function(v,d,y){return v===void 0&&(v=.001),d===void 0&&(d=.95),y===void 0&&(y=null),new G1(v,d,y)},_.adamax=function(v,d,y,C,z){return v===void 0&&(v=.002),d===void 0&&(d=.9),y===void 0&&(y=.999),C===void 0&&(C=null),z===void 0&&(z=0),new Xv(v,d,y,C,z)},_.adagrad=function(v,d){return d===void 0&&(d=.1),new q1(v,d)},_}(),X1={sgd:Gc.sgd,momentum:Gc.momentum,adadelta:Gc.adadelta,adagrad:Gc.adagrad,rmsprop:Gc.rmsprop,adamax:Gc.adamax,adam:Gc.adam},Ec=typeof requestAnimationFrame<"u"?requestAnimationFrame:A!==void 0?A:function(_){return _()};function Xf(){return new Promise(function(_){return Ec(function(){return _()})})}Qt.prototype.squaredDifference=function(_){return Rd(this,_)},Tt=Mg}.call(this,r(59),r(75),r(92).Buffer,r(207).setImmediate)},function(s,a,r){s.exports=r(281)},function(s,a,r){r.d(a,"c",function(){return S}),r.d(a,"a",function(){return E}),r.d(a,"b",function(){return A}),r.d(a,"d",function(){return U}),r.d(a,"e",function(){return B});var c=function(D,R){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(W,j){W.__proto__=j}||function(W,j){for(var H in j)j.hasOwnProperty(H)&&(W[H]=j[H])})(D,R)};function S(D,R){function W(){this.constructor=D}c(D,R),D.prototype=R===null?Object.create(R):(W.prototype=R.prototype,new W)}var E=function(){return(E=Object.assign||function(D){for(var R,W=1,j=arguments.length;W<j;W++)for(var H in R=arguments[W])Object.prototype.hasOwnProperty.call(R,H)&&(D[H]=R[H]);return D}).apply(this,arguments)};function A(D,R,W,j){return new(W||(W=Promise))(function(H,I){function Q(ae){try{q(j.next(ae))}catch(oe){I(oe)}}function Y(ae){try{q(j.throw(ae))}catch(oe){I(oe)}}function q(ae){ae.done?H(ae.value):function(oe){return oe instanceof W?oe:new W(function(ye){ye(oe)})}(ae.value).then(Q,Y)}q((j=j.apply(D,R||[])).next())})}function U(D,R){var W,j,H,I,Q={label:0,sent:function(){if(1&H[0])throw H[1];return H[1]},trys:[],ops:[]};return I={next:Y(0),throw:Y(1),return:Y(2)},typeof Symbol=="function"&&(I[Symbol.iterator]=function(){return this}),I;function Y(q){return function(ae){return function(oe){if(W)throw new TypeError("Generator is already executing.");for(;Q;)try{if(W=1,j&&(H=2&oe[0]?j.return:oe[0]?j.throw||((H=j.return)&&H.call(j),0):j.next)&&!(H=H.call(j,oe[1])).done)return H;switch(j=0,H&&(oe=[2&oe[0],H.value]),oe[0]){case 0:case 1:H=oe;break;case 4:return Q.label++,{value:oe[1],done:!1};case 5:Q.label++,j=oe[1],oe=[0];continue;case 7:oe=Q.ops.pop(),Q.trys.pop();continue;default:if(!(H=(H=Q.trys).length>0&&H[H.length-1])&&(oe[0]===6||oe[0]===2)){Q=0;continue}if(oe[0]===3&&(!H||oe[1]>H[0]&&oe[1]<H[3])){Q.label=oe[1];break}if(oe[0]===6&&Q.label<H[1]){Q.label=H[1],H=oe;break}if(H&&Q.label<H[2]){Q.label=H[2],Q.ops.push(oe);break}H[2]&&Q.ops.pop(),Q.trys.pop();continue}oe=R.call(D,Q)}catch(ye){oe=[6,ye],j=0}finally{W=H=0}if(5&oe[0])throw oe[1];return{value:oe[0]?oe[1]:void 0,done:!0}}([q,ae])}}}function B(){for(var D=0,R=0,W=arguments.length;R<W;R++)D+=arguments[R].length;var j=Array(D),H=0;for(R=0;R<W;R++)for(var I=arguments[R],Q=0,Y=I.length;Q<Y;Q++,H++)j[H]=I[Q];return j}},function(s,a){function r(c,S,E,A,U,B,D){try{var R=c[B](D),W=R.value}catch(j){return void E(j)}R.done?S(W):Promise.resolve(W).then(A,U)}s.exports=function(c){return function(){var S=this,E=arguments;return new Promise(function(A,U){var B=c.apply(S,E);function D(W){r(B,A,U,D,R,"next",W)}function R(W){r(B,A,U,D,R,"throw",W)}D(void 0)})}},s.exports.__esModule=!0,s.exports.default=s.exports},function(s,a){function r(c){return s.exports=r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S},s.exports.__esModule=!0,s.exports.default=s.exports,r(c)}s.exports=r,s.exports.__esModule=!0,s.exports.default=s.exports},function(s,a,r){var c=r(16),S=r(24),E=r(42),A=r(38),U=r(56),B=function(D,R,W){var j,H,I,Q,Y=D&B.F,q=D&B.G,ae=D&B.S,oe=D&B.P,ye=D&B.B,_e=q?c:ae?c[R]||(c[R]={}):(c[R]||{}).prototype,pe=q?S:S[R]||(S[R]={}),me=pe.prototype||(pe.prototype={});for(j in q&&(W=R),W)I=((H=!Y&&_e&&_e[j]!==void 0)?_e:W)[j],Q=ye&&H?U(I,c):oe&&typeof I=="function"?U(Function.call,I):I,_e&&A(_e,j,I,D&B.U),pe[j]!=I&&E(pe,j,Q),oe&&me[j]!=I&&(me[j]=I)};c.core=S,B.F=1,B.G=2,B.S=4,B.P=8,B.B=16,B.W=32,B.U=64,B.R=128,s.exports=B},function(s,a){function r(c,S){for(var E=0;E<S.length;E++){var A=S[E];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(c,A.key,A)}}s.exports=function(c,S,E){return S&&r(c.prototype,S),E&&r(c,E),Object.defineProperty(c,"prototype",{writable:!1}),c},s.exports.__esModule=!0,s.exports.default=s.exports},function(s,a){s.exports=function(r,c){if(!(r instanceof c))throw new TypeError("Cannot call a class as a function")},s.exports.__esModule=!0,s.exports.default=s.exports},function(s,a,r){r.d(a,"a",function(){return Ge}),r.d(a,"b",function(){return lt}),r.d(a,"c",function(){return It}),r.d(a,"d",function(){return wt}),r.d(a,"e",function(){return Bt}),r.d(a,"f",function(){return we}),r.d(a,"g",function(){return pe}),r.d(a,"h",function(){return _e}),r.d(a,"i",function(){return yt}),r.d(a,"j",function(){return Ot}),r.d(a,"k",function(){return me}),r.d(a,"l",function(){return ye}),r.d(a,"m",function(){return xt}),r.d(a,"n",function(){return Kr}),r.d(a,"o",function(){return sr}),r.d(a,"p",function(){return Vt}),r.d(a,"q",function(){return Dt}),r.d(a,"r",function(){return ar}),r.d(a,"s",function(){return pt}),r.d(a,"t",function(){return Ut}),r.d(a,"u",function(){return Gt}),r.d(a,"v",function(){return en}),r.d(a,"w",function(){return On}),r.d(a,"x",function(){return yr}),r.d(a,"y",function(){return Ve}),r.d(a,"z",function(){return Ye}),r.d(a,"A",function(){return _t});var c=r(1),S=r(72),E=r(40),A=r(71),U=r(39),B=r(70),D=r(135),R=r(184),W=r(183),j=r(69),H=r(182),I=r(68),Q=r(134),Y=r(181),q=r(180),ae=r(108),oe=r(45);const ye="year",_e="quarter",pe="month",me="week",Ge="date",lt="day",It="dayofyear",wt="hours",we="minutes",yt="seconds",Bt="milliseconds",Ot=[ye,_e,pe,me,Ge,lt,It,wt,we,yt,Bt],ze=Ot.reduce((Tt,Rr,Qt)=>(Tt[Rr]=1+Qt,Tt),{});function Ut(Tt){const Rr=Object(c.i)(Tt).slice(),Qt={};return Rr.length||Object(c.o)("Missing time unit."),Rr.forEach(Se=>{Object(c.w)(ze,Se)?Qt[Se]=1:Object(c.o)("Invalid time unit: ".concat(Se,"."))}),(Qt[me]||Qt[lt]?1:0)+(Qt[_e]||Qt[pe]||Qt[Ge]?1:0)+(Qt[It]?1:0)>1&&Object(c.o)("Incompatible time units: ".concat(Tt)),Rr.sort((Se,ve)=>ze[Se]-ze[ve]),Rr}const Ft={[ye]:"%Y ",[_e]:"Q%q ",[pe]:"%b ",[Ge]:"%d ",[me]:"W%U ",[lt]:"%a ",[It]:"%j ",[wt]:"%H:00",[we]:"00:%M",[yt]:":%S",[Bt]:".%L",["".concat(ye,"-").concat(pe)]:"%Y-%m ",["".concat(ye,"-").concat(pe,"-").concat(Ge)]:"%Y-%m-%d ",["".concat(wt,"-").concat(we)]:"%H:%M"};function pt(Tt,Rr){const Qt=Object(c.p)({},Ft,Rr),Se=Ut(Tt),ve=Se.length;let ke,Me,rt="",Ct=0;for(Ct=0;Ct<ve;)for(ke=Se.length;ke>Ct;--ke)if(Qt[Me=Se.slice(Ct,ke).join("-")]!=null){rt+=Qt[Me],Ct=ke;break}return rt.trim()}const vt=new Date;function rn(Tt){return vt.setFullYear(Tt),vt.setMonth(0),vt.setDate(1),vt.setHours(0,0,0,0),vt}function xt(Tt){return Xt(new Date(Tt))}function _t(Tt){return sn(new Date(Tt))}function Xt(Tt){return S.a.count(rn(Tt.getFullYear())-1,Tt)}function sn(Tt){return E.b.count(rn(Tt.getFullYear())-1,Tt)}function kn(Tt){return rn(Tt).getDay()}function an(Tt,Rr,Qt,Se,ve,ke,Me){if(0<=Tt&&Tt<100){const rt=new Date(-1,Rr,Qt,Se,ve,ke,Me);return rt.setFullYear(Tt),rt}return new Date(Tt,Rr,Qt,Se,ve,ke,Me)}function Ve(Tt){return $e(new Date(Tt))}function Ye(Tt){return ft(new Date(Tt))}function $e(Tt){const Rr=Date.UTC(Tt.getUTCFullYear(),0,1);return A.a.count(Rr-1,Tt)}function ft(Tt){const Rr=Date.UTC(Tt.getUTCFullYear(),0,1);return U.b.count(Rr-1,Tt)}function $t(Tt){return vt.setTime(Date.UTC(Tt,0,1)),vt.getUTCDay()}function Jt(Tt,Rr,Qt,Se,ve,ke,Me){if(0<=Tt&&Tt<100){const rt=new Date(Date.UTC(-1,Rr,Qt,Se,ve,ke,Me));return rt.setUTCFullYear(Qt.y),rt}return new Date(Date.UTC(Tt,Rr,Qt,Se,ve,ke,Me))}function Pn(Tt,Rr,Qt,Se,ve){const ke=Rr||1,Me=Object(c.W)(Tt),rt=(hn,nn,He)=>function(Bn,Xn,Zn,lr){const jr=Zn<=1?Bn:lr?(Cr,xi)=>lr+Zn*Math.floor((Bn(Cr,xi)-lr)/Zn):(Cr,xi)=>Zn*Math.floor(Bn(Cr,xi)/Zn);return Xn?(Cr,xi)=>Xn(jr(Cr,xi),xi):jr}(Qt[He=He||hn],Se[He],hn===Me&&ke,nn),Ct=new Date,tn=Object(c.Fa)(Tt),Sn=tn[ye]?rt(ye):Object(c.m)(2012),Rt=tn[pe]?rt(pe):tn[_e]?rt(_e):c.Ma,Zt=tn[me]&&tn[lt]?rt(lt,1,me+lt):tn[me]?rt(me,1):tn[lt]?rt(lt,1):tn[Ge]?rt(Ge,1):tn[It]?rt(It,1):c.Q,mn=tn[wt]?rt(wt):c.Ma,fn=tn[we]?rt(we):c.Ma,mt=tn[yt]?rt(yt):c.Ma,Mt=tn[Bt]?rt(Bt):c.Ma;return function(hn){Ct.setTime(+hn);const nn=Sn(Ct);return ve(nn,Rt(Ct),Zt(Ct,nn),mn(Ct),fn(Ct),mt(Ct),Mt(Ct))}}function An(Tt,Rr,Qt){return Rr+7*Tt-(Qt+6)%7}const Qn={[ye]:Tt=>Tt.getFullYear(),[_e]:Tt=>Math.floor(Tt.getMonth()/3),[pe]:Tt=>Tt.getMonth(),[Ge]:Tt=>Tt.getDate(),[wt]:Tt=>Tt.getHours(),[we]:Tt=>Tt.getMinutes(),[yt]:Tt=>Tt.getSeconds(),[Bt]:Tt=>Tt.getMilliseconds(),[It]:Tt=>Xt(Tt),[me]:Tt=>sn(Tt),[me+lt]:(Tt,Rr)=>An(sn(Tt),Tt.getDay(),kn(Rr)),[lt]:(Tt,Rr)=>An(1,Tt.getDay(),kn(Rr))},Ce={[_e]:Tt=>3*Tt,[me]:(Tt,Rr)=>An(Tt,0,kn(Rr))};function sr(Tt,Rr){return Pn(Tt,Rr||1,Qn,Ce,an)}const Mr={[ye]:Tt=>Tt.getUTCFullYear(),[_e]:Tt=>Math.floor(Tt.getUTCMonth()/3),[pe]:Tt=>Tt.getUTCMonth(),[Ge]:Tt=>Tt.getUTCDate(),[wt]:Tt=>Tt.getUTCHours(),[we]:Tt=>Tt.getUTCMinutes(),[yt]:Tt=>Tt.getUTCSeconds(),[Bt]:Tt=>Tt.getUTCMilliseconds(),[It]:Tt=>$e(Tt),[me]:Tt=>ft(Tt),[lt]:(Tt,Rr)=>An(1,Tt.getUTCDay(),$t(Rr)),[me+lt]:(Tt,Rr)=>An(ft(Tt),Tt.getUTCDay(),$t(Rr))},on={[_e]:Tt=>3*Tt,[me]:(Tt,Rr)=>An(Tt,0,$t(Rr))};function Gt(Tt,Rr){return Pn(Tt,Rr||1,Mr,on,Jt)}const Hn={[ye]:B.a,[_e]:D.a.every(3),[pe]:D.a,[me]:E.b,[Ge]:S.a,[lt]:S.a,[It]:S.a,[wt]:R.a,[we]:W.a,[yt]:j.a,[Bt]:H.a},Kt={[ye]:I.a,[_e]:Q.a.every(3),[pe]:Q.a,[me]:U.b,[Ge]:A.a,[lt]:A.a,[It]:A.a,[wt]:Y.a,[we]:q.a,[yt]:j.a,[Bt]:H.a};function Vt(Tt){return Hn[Tt]}function en(Tt){return Kt[Tt]}function Vn(Tt,Rr,Qt){return Tt?Tt.offset(Rr,Qt):void 0}function Dt(Tt,Rr,Qt){return Vn(Vt(Tt),Rr,Qt)}function On(Tt,Rr,Qt){return Vn(en(Tt),Rr,Qt)}function or(Tt,Rr,Qt,Se){return Tt?Tt.range(Rr,Qt,Se):void 0}function ar(Tt,Rr,Qt,Se){return or(Vt(Tt),Rr,Qt,Se)}function yr(Tt,Rr,Qt,Se){return or(en(Tt),Rr,Qt,Se)}const kr=31536e6,dr=[ye,pe,Ge,wt,we,yt,Bt],oi=dr.slice(0,-1),Ur=oi.slice(0,-1),Xr=Ur.slice(0,-1),zn=Xr.slice(0,-1),ir=[ye,pe],Or=[ye],qr=[[oi,1,1e3],[oi,5,5e3],[oi,15,15e3],[oi,30,3e4],[Ur,1,6e4],[Ur,5,3e5],[Ur,15,9e5],[Ur,30,18e5],[Xr,1,36e5],[Xr,3,108e5],[Xr,6,216e5],[Xr,12,432e5],[zn,1,864e5],[[ye,me],1,6048e5],[ir,1,2592e6],[ir,3,7776e6],[Or,1,kr]];function Kr(Tt){const Rr=Tt.extent,Qt=Tt.maxbins||40,Se=Math.abs(Object(c.Z)(Rr))/Qt;let ve,ke,Me=Object(ae.a)(rt=>rt[2]).right(qr,Se);return Me===qr.length?(ve=Or,ke=Object(oe.c)(Rr[0]/kr,Rr[1]/kr,Qt)):Me?(ve=(Me=qr[Se/qr[Me-1][2]<qr[Me][2]/Se?Me-1:Me])[0],ke=Me[1]):(ve=dr,ke=Math.max(Object(oe.c)(Rr[0],Rr[1],Qt),1)),{units:ve,step:ke}}},function(s,a,r){r.d(a,"e",function(){return c}),r.d(a,"c",function(){return S}),r.d(a,"b",function(){return E}),r.d(a,"a",function(){return A}),r.d(a,"f",function(){return U}),r.d(a,"d",function(){return B}),r.d(a,"g",function(){return D});const c=1e3,S=60*c,E=60*S,A=24*E,U=7*A,B=30*A,D=365*A},function(s,a){s.exports=function(r){return typeof r=="object"?r!==null:typeof r=="function"}},function(s,a,r){var c=r(13);s.exports=function(S){if(!c(S))throw TypeError(S+" is not an object!");return S}},function(s,a){s.exports=function(r){try{return!!r()}catch{return!0}}},function(s,a){var r=s.exports=typeof window<"u"&&window.Math==Math?window:typeof self<"u"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=r)},function(s,a,r){s.exports=r(280)},function(s,a){s.exports=function(r,c,S){return c in r?Object.defineProperty(r,c,{value:S,enumerable:!0,configurable:!0,writable:!0}):r[c]=S,r},s.exports.__esModule=!0,s.exports.default=s.exports},function(s,a,r){var c=r(129)("wks"),S=r(84),E=r(16).Symbol,A=typeof E=="function";(s.exports=function(U){return c[U]||(c[U]=A&&E[U]||(A?E:S)("Symbol."+U))}).store=c},function(s,a,r){r.r(a),function(c){r.d(a,"GraphModel",function(){return Tt}),r.d(a,"loadGraphModel",function(){return Rr}),r.d(a,"deregisterOp",function(){return H}),r.d(a,"registerOp",function(){return W}),r.d(a,"version_converter",function(){return Qt});var S,E,A=r(0),U=function(){return(U=Object.assign||function(Se){for(var ve,ke=1,Me=arguments.length;ke<Me;ke++)for(var rt in ve=arguments[ke])Object.prototype.hasOwnProperty.call(ve,rt)&&(Se[rt]=ve[rt]);return Se}).apply(this,arguments)};function B(Se,ve,ke,Me){return new(ke||(ke=Promise))(function(rt,Ct){function tn(Zt){try{Rt(Me.next(Zt))}catch(mn){Ct(mn)}}function Sn(Zt){try{Rt(Me.throw(Zt))}catch(mn){Ct(mn)}}function Rt(Zt){Zt.done?rt(Zt.value):new ke(function(mn){mn(Zt.value)}).then(tn,Sn)}Rt((Me=Me.apply(Se,ve||[])).next())})}function D(Se,ve){var ke,Me,rt,Ct,tn={label:0,sent:function(){if(1&rt[0])throw rt[1];return rt[1]},trys:[],ops:[]};return Ct={next:Sn(0),throw:Sn(1),return:Sn(2)},typeof Symbol=="function"&&(Ct[Symbol.iterator]=function(){return this}),Ct;function Sn(Rt){return function(Zt){return function(mn){if(ke)throw new TypeError("Generator is already executing.");for(;tn;)try{if(ke=1,Me&&(rt=2&mn[0]?Me.return:mn[0]?Me.throw||((rt=Me.return)&&rt.call(Me),0):Me.next)&&!(rt=rt.call(Me,mn[1])).done)return rt;switch(Me=0,rt&&(mn=[2&mn[0],rt.value]),mn[0]){case 0:case 1:rt=mn;break;case 4:return tn.label++,{value:mn[1],done:!1};case 5:tn.label++,Me=mn[1],mn=[0];continue;case 7:mn=tn.ops.pop(),tn.trys.pop();continue;default:if(!(rt=(rt=tn.trys).length>0&&rt[rt.length-1])&&(mn[0]===6||mn[0]===2)){tn=0;continue}if(mn[0]===3&&(!rt||mn[1]>rt[0]&&mn[1]<rt[3])){tn.label=mn[1];break}if(mn[0]===6&&tn.label<rt[1]){tn.label=rt[1],rt=mn;break}if(rt&&tn.label<rt[2]){tn.label=rt[2],tn.ops.push(mn);break}rt[2]&&tn.ops.pop(),tn.trys.pop();continue}mn=ve.call(Se,tn)}catch(fn){mn=[6,fn],Me=0}finally{ke=rt=0}if(5&mn[0])throw mn[1];return{value:mn[0]?mn[1]:void 0,done:!0}}([Rt,Zt])}}}(function(Se){Se[Se.DT_INVALID=0]="DT_INVALID",Se[Se.DT_FLOAT=1]="DT_FLOAT",Se[Se.DT_DOUBLE=2]="DT_DOUBLE",Se[Se.DT_INT32=3]="DT_INT32",Se[Se.DT_UINT8=4]="DT_UINT8",Se[Se.DT_INT16=5]="DT_INT16",Se[Se.DT_INT8=6]="DT_INT8",Se[Se.DT_STRING=7]="DT_STRING",Se[Se.DT_COMPLEX64=8]="DT_COMPLEX64",Se[Se.DT_INT64=9]="DT_INT64",Se[Se.DT_BOOL=10]="DT_BOOL",Se[Se.DT_QINT8=11]="DT_QINT8",Se[Se.DT_QUINT8=12]="DT_QUINT8",Se[Se.DT_QINT32=13]="DT_QINT32",Se[Se.DT_BFLOAT16=14]="DT_BFLOAT16",Se[Se.DT_FLOAT_REF=101]="DT_FLOAT_REF",Se[Se.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",Se[Se.DT_INT32_REF=103]="DT_INT32_REF",Se[Se.DT_UINT8_REF=104]="DT_UINT8_REF",Se[Se.DT_INT16_REF=105]="DT_INT16_REF",Se[Se.DT_INT8_REF=106]="DT_INT8_REF",Se[Se.DT_STRING_REF=107]="DT_STRING_REF",Se[Se.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",Se[Se.DT_INT64_REF=109]="DT_INT64_REF",Se[Se.DT_BOOL_REF=110]="DT_BOOL_REF",Se[Se.DT_QINT8_REF=111]="DT_QINT8_REF",Se[Se.DT_QUINT8_REF=112]="DT_QUINT8_REF",Se[Se.DT_QINT32_REF=113]="DT_QINT32_REF",Se[Se.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"})(S||(S={})),function(Se){(function(ve){ve[ve.LEGACY=0]="LEGACY",ve[ve.V1=1]="V1",ve[ve.V2=2]="V2"})(Se.CheckpointFormatVersion||(Se.CheckpointFormatVersion={}))}(E||(E={}));var R={};function W(Se,ve){var ke={tfOpName:Se,category:"custom",inputs:[],attrs:[],customExecutor:ve};R[Se]=ke}function j(Se){return R[Se]}function H(Se){delete R[Se]}function I(Se,ve,ke,Me){var rt=ve.inputParams[Se];if(rt&&rt.inputIndexStart!==void 0){var Ct=rt.inputIndexStart,tn=rt.inputIndexEnd===0?void 0:rt.inputIndexEnd===void 0?Ct+1:rt.inputIndexEnd;if(rt.type==="tensor")return Q(ve.inputNames[rt.inputIndexStart],ke,Me);if(rt.type==="tensors")return ve.inputNames.slice(Ct,tn).map(function(Zt){return Q(Zt,ke,Me)});var Sn=Array.prototype.slice.call(Q(ve.inputNames.slice(Ct)[0],ke,Me).dataSync());return rt.type==="number"?Sn[0]:Sn}var Rt=ve.attrParams[Se];return Rt&&Rt.value}function Q(Se,ve,ke){var Me=ae(Se),rt=Me[0],Ct=Me[1],tn=ke.currentContextIds.find(function(Sn){return!!ve[q(rt,Sn)]});return tn!==void 0?ve[q(rt,tn)][Ct]:void 0}function Y(Se,ve){var ke=ae(Se),Me=ke[0],rt=ke[1];return[q(Me,ve&&ve.currentContextId),rt]}function q(Se,ve){return ve?Se+"-"+ve:Se}function ae(Se){var ve=Se.lastIndexOf(":");return ve===-1?[Se,0]:[Se.substring(0,ve),Number(Se.substring(ve+1))]}function oe(Se,ve){for(var ke=[],Me=0;Me<Se.length;Me+=ve)ke.push(Se.slice(Me,Me+ve));return ke}var ye=Object.freeze({json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),_e=Object.freeze({json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"clip_value_min",name:"clipValueMin",type:"number"},{tfName:"clip_value_max",name:"clipValueMax",type:"number"}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"clipValueMin",name:"clipValueMin",type:"number",defaultValue:0},{tfName:"clipValueMax",name:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),pe=Object.freeze({json:[{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"}]}]}),me=Object.freeze({json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]}]}),Ge=Object.freeze({json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]}),lt=Object.freeze({json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),It=Object.freeze({json:[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]}]}),wt=Object.freeze({json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]}),we=Object.freeze({json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}]}),yt=Object.freeze({json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Bt=Object.freeze({json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Ot=Object.freeze({json:[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]}),ze=Object.freeze({json:[{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]}]}),Ut=Object.freeze({json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]}),Ft=Object.freeze({json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]}),pt=Object.freeze({json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]}]}),vt=function(){function Se(){var ve=[ye,_e,pe,me,Ge,lt,It,yt,we,wt,Bt,Ot,ze,Ut,Ft,pt],ke=[].concat.apply([],ve.map(function(Me){return Me.json}));this.opMappers=ke.reduce(function(Me,rt){return Me[rt.tfOpName]=rt,Me},{})}return Object.defineProperty(Se,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),Se.prototype.transformGraph=function(ve,ke){var Me=this;ke===void 0&&(ke={});var rt=[],Ct=[],tn=ve.node.reduce(function(mt,Mt){return mt[Mt.name]=Me.mapNode(Mt),Mt.op.startsWith("Placeholder")&&rt.push(mt[Mt.name]),Mt.op==="Const"&&Ct.push(mt[Mt.name]),mt},{}),Sn=[],Rt=[],Zt={},mn={};ke!=null&&(Zt=this.mapSignatureEntries(ke.inputs),mn=this.mapSignatureEntries(ke.outputs));var fn=Object.keys(tn);return fn.forEach(function(mt){var Mt=tn[mt];Mt.inputNames.forEach(function(hn){var nn=Y(hn)[0];Mt.inputs.push(tn[nn]),tn[nn].children.push(Mt)})}),Object.keys(mn).length===0?fn.forEach(function(mt){var Mt=tn[mt];Mt.children.length===0&&Rt.push(Mt)}):Object.keys(mn).forEach(function(mt){var Mt=Y(mt)[0],hn=tn[Mt];hn!=null&&(hn.signatureKey=mn[mt],Rt.push(hn))}),Object.keys(Zt).length>0?Object.keys(Zt).forEach(function(mt){var Mt=Y(mt)[0],hn=tn[Mt];hn&&(hn.signatureKey=Zt[mt],Sn.push(hn))}):Sn=rt,{nodes:tn,inputs:Sn,outputs:Rt,weights:Ct,placeholders:rt,signature:ke}},Se.prototype.mapSignatureEntries=function(ve){return Object.keys(ve||{}).reduce(function(ke,Me){return ke[ve[Me].name]=Me,ke},{})},Se.prototype.mapNode=function(ve){var ke=j(ve.op)||this.opMappers[ve.op]||{};ve.attr==null&&(ve.attr={});var Me={name:ve.name,op:ve.op,category:ke.category,inputNames:(ve.input||[]).map(function(rt){return rt.startsWith("^")?rt.substr(1):rt}),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:ve.attr};return ke.inputs!=null&&(Me.inputParams=ke.inputs.reduce(function(rt,Ct){return rt[Ct.name]={type:Ct.type,inputIndexStart:Ct.start,inputIndexEnd:Ct.end},rt},{})),ke.attrs!=null&&(Me.attrParams=ke.attrs.reduce(function(rt,Ct){var tn=Ct.type,Sn=void 0;switch(Ct.type){case"string":(Sn=xt(ve.attr,Ct.tfName,Ct.defaultValue))===void 0&&Ct.tfDeprecatedName&&(Sn=xt(ve.attr,Ct.tfDeprecatedName,Ct.defaultValue));break;case"string[]":(Sn=ft(ve.attr,Ct.tfName,Ct.defaultValue))===void 0&&Ct.tfDeprecatedName&&(Sn=ft(ve.attr,Ct.tfDeprecatedName,Ct.defaultValue));break;case"number":(Sn=Xt(ve.attr,Ct.tfName,Ct.defaultValue||0))===void 0&&Ct.tfDeprecatedName&&(Sn=Xt(ve.attr,Ct.tfDeprecatedName,Ct.defaultValue));break;case"number[]":(Sn=$e(ve.attr,Ct.tfName,Ct.defaultValue))===void 0&&Ct.tfDeprecatedName&&(Sn=$e(ve.attr,Ct.tfDeprecatedName,Ct.defaultValue));break;case"bool":(Sn=_t(ve.attr,Ct.tfName,Ct.defaultValue))===void 0&&Ct.tfDeprecatedName&&(Sn=_t(ve.attr,Ct.tfDeprecatedName,Ct.defaultValue));break;case"bool[]":(Sn=Jt(ve.attr,Ct.tfName,Ct.defaultValue))===void 0&&Ct.tfDeprecatedName&&(Sn=Jt(ve.attr,Ct.tfDeprecatedName,Ct.defaultValue));break;case"shape":(Sn=Ye(ve.attr,Ct.tfName,Ct.defaultValue))===void 0&&Ct.tfDeprecatedName&&(Sn=Ye(ve.attr,Ct.tfDeprecatedName,Ct.defaultValue));break;case"shape[]":(Sn=$t(ve.attr,Ct.tfName,Ct.defaultValue))===void 0&&Ct.tfDeprecatedName&&(Sn=$t(ve.attr,Ct.tfDeprecatedName,Ct.defaultValue));break;case"dtype":(Sn=kn(ve.attr,Ct.tfName,Ct.defaultValue))===void 0&&Ct.tfDeprecatedName&&(Sn=kn(ve.attr,Ct.tfDeprecatedName,Ct.defaultValue));break;case"dtype[]":(Sn=an(ve.attr,Ct.tfName,Ct.defaultValue))===void 0&&Ct.tfDeprecatedName&&(Sn=an(ve.attr,Ct.tfDeprecatedName,Ct.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+Ct.type+" for op: "+ve.op)}return rt[Ct.name]={value:Sn,type:tn},rt},{})),Me},Se}();function rn(Se,ve){var ke=Array.isArray(Se)?String.fromCharCode.apply(null,Se):function(Me){var rt=Object(A.env)().global;if(rt.atob!==void 0)return rt.atob(Me);if(c!==void 0)return new c(Me,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(Se);return ve?ke:ke.toLowerCase()}function xt(Se,ve,ke,Me){Me===void 0&&(Me=!1);var rt=Se[ve];return rt!=null?rn(rt.s,Me):ke}function _t(Se,ve,ke){var Me=Se[ve];return Me?Me.b:ke}function Xt(Se,ve,ke){var Me=Se[ve]||{},rt=Me.i!=null?Me.i:Me.f!=null?Me.f:ke;return typeof rt=="number"?rt:parseInt(rt,10)}function sn(Se){switch(typeof Se=="string"&&(Se=S[Se]),Se){case S.DT_FLOAT:return"float32";case S.DT_INT32:case S.DT_INT64:case S.DT_INT8:case S.DT_UINT8:return"int32";case S.DT_BOOL:return"bool";case S.DT_DOUBLE:return"float32";case S.DT_STRING:return"string";default:return null}}function kn(Se,ve,ke){var Me=Se[ve];return Me&&Me.type?sn(Me.type):ke}function an(Se,ve,ke){var Me=Se[ve];return Me&&Me.list&&Me.list.type?Me.list.type.map(function(rt){return sn(rt)}):ke}function Ve(Se){if(!Se.unknownRank)return Se.dim!=null?Se.dim.map(function(ve){return typeof ve.size=="number"?ve.size:parseInt(ve.size,10)}):[]}function Ye(Se,ve,ke){var Me=Se[ve];return Me&&Me.shape?Ve(Me.shape):ke}function $e(Se,ve,ke){var Me=Se[ve];return Me?((Me.list.f&&Me.list.f.length?Me.list.f:Me.list.i)||[]).map(function(rt){return typeof rt=="number"?rt:parseInt(rt,10)}):ke}function ft(Se,ve,ke,Me){Me===void 0&&(Me=!1);var rt=Se[ve];return rt&&rt.list&&rt.list.s?rt.list.s.map(function(Ct){return rn(Ct,Me)}):ke}function $t(Se,ve,ke){var Me=Se[ve];return Me&&Me.list&&Me.list.shape?Me.list.shape.map(function(rt){return Ve(rt)}):ke}function Jt(Se,ve,ke){var Me=Se[ve];return Me&&Me.list&&Me.list.b?Me.list.b:ke}var Pn=function(){function Se(ve,ke,Me){var rt=this;this.node=ve,this.tensorMap=ke,this.context=Me,this.inputs=[],this.attrs={},this.inputs=ve.inputNames.map(function(Ct){return rt.getInput(Ct)}),ve.rawAttrs!=null&&(this.attrs=Object.keys(ve.rawAttrs).reduce(function(Ct,tn){return Ct[tn]=rt.getAttr(tn),Ct},{}))}return Se.prototype.getInput=function(ve){return Q(ve,this.tensorMap,this.context)},Se.prototype.getAttr=function(ve,ke){var Me=this.node.rawAttrs[ve];if(Me.tensor!=null)return Q(ve,this.tensorMap,this.context);if(Me.i!=null||Me.f!=null)return Xt(this.node.rawAttrs,ve,ke);if(Me.s!=null)return xt(this.node.rawAttrs,ve,ke);if(Me.b!=null)return _t(this.node.rawAttrs,ve,ke);if(Me.shape!=null)return Ye(this.node.rawAttrs,ve,ke);if(Me.type!=null)return kn(this.node.rawAttrs,ve,ke);if(Me.list!=null){if(Me.list.i!=null||Me.list.f!=null)return $e(this.node.rawAttrs,ve,ke);if(Me.list.s!=null)return ft(this.node.rawAttrs,ve,ke);if(Me.list.shape!=null)return $t(this.node.rawAttrs,ve,ke);if(Me.list.b!=null)return Jt(this.node.rawAttrs,ve,ke);if(Me.list.type!=null)return an(this.node.rawAttrs,ve,ke)}return ke},Se}(),An=function(Se,ve,ke){switch(Se.op){case"BiasAdd":case"AddV2":case"Add":return[Object(A.add)(I("a",Se,ve,ke),I("b",Se,ve,ke))];case"AddN":return[Object(A.addN)(I("tensors",Se,ve,ke))];case"FloorMod":case"Mod":return[Object(A.mod)(I("a",Se,ve,ke),I("b",Se,ve,ke))];case"Mul":return[Object(A.mul)(I("a",Se,ve,ke),I("b",Se,ve,ke))];case"RealDiv":case"Div":return[Object(A.div)(I("a",Se,ve,ke),I("b",Se,ve,ke))];case"DivNoNan":return[Object(A.divNoNan)(I("a",Se,ve,ke),I("b",Se,ve,ke))];case"FloorDiv":return[Object(A.floorDiv)(I("a",Se,ve,ke),I("b",Se,ve,ke))];case"Sub":return[Object(A.sub)(I("a",Se,ve,ke),I("b",Se,ve,ke))];case"Minimum":return[Object(A.minimum)(I("a",Se,ve,ke),I("b",Se,ve,ke))];case"Maximum":return[Object(A.maximum)(I("a",Se,ve,ke),I("b",Se,ve,ke))];case"Pow":return[Object(A.pow)(I("a",Se,ve,ke),I("b",Se,ve,ke))];case"SquaredDifference":return[Object(A.squaredDifference)(I("a",Se,ve,ke),I("b",Se,ve,ke))];default:throw TypeError("Node type "+Se.op+" is not implemented")}},Qn=function(Se,ve,ke){switch(Se.op){case"Abs":case"ComplexAbs":return[Object(A.abs)(I("x",Se,ve,ke))];case"Acos":return[Object(A.acos)(I("x",Se,ve,ke))];case"Acosh":return[Object(A.acosh)(I("x",Se,ve,ke))];case"Asin":return[Object(A.asin)(I("x",Se,ve,ke))];case"Asinh":return[Object(A.asinh)(I("x",Se,ve,ke))];case"Atan":return[Object(A.atan)(I("x",Se,ve,ke))];case"Atan2":return[Object(A.atan2)(I("x",Se,ve,ke),I("y",Se,ve,ke))];case"Atanh":return[Object(A.atanh)(I("x",Se,ve,ke))];case"Ceil":return[Object(A.ceil)(I("x",Se,ve,ke))];case"Complex":return[Object(A.complex)(I("real",Se,ve,ke),I("imag",Se,ve,ke))];case"Cos":return[Object(A.cos)(I("x",Se,ve,ke))];case"Cosh":return[Object(A.cosh)(I("x",Se,ve,ke))];case"Elu":return[Object(A.elu)(I("x",Se,ve,ke))];case"Erf":return[Object(A.erf)(I("x",Se,ve,ke))];case"Exp":return[Object(A.exp)(I("x",Se,ve,ke))];case"Expm1":return[Object(A.expm1)(I("x",Se,ve,ke))];case"Floor":return[Object(A.floor)(I("x",Se,ve,ke))];case"Log":return[Object(A.log)(I("x",Se,ve,ke))];case"Log1p":return[Object(A.log1p)(I("x",Se,ve,ke))];case"Imag":return[Object(A.imag)(I("x",Se,ve,ke))];case"Neg":return[Object(A.neg)(I("x",Se,ve,ke))];case"Reciprocal":return[Object(A.reciprocal)(I("x",Se,ve,ke))];case"Real":return[Object(A.real)(I("x",Se,ve,ke))];case"Relu":return[Object(A.relu)(I("x",Se,ve,ke))];case"Round":return[Object(A.round)(I("x",Se,ve,ke))];case"Selu":return[Object(A.selu)(I("x",Se,ve,ke))];case"Sigmoid":return[Object(A.sigmoid)(I("x",Se,ve,ke))];case"Sin":return[Object(A.sin)(I("x",Se,ve,ke))];case"Sign":return[Object(A.sign)(I("x",Se,ve,ke))];case"Sinh":return[Object(A.sinh)(I("x",Se,ve,ke))];case"Softplus":return[Object(A.softplus)(I("x",Se,ve,ke))];case"Sqrt":return[Object(A.sqrt)(I("x",Se,ve,ke))];case"Square":return[Object(A.square)(I("x",Se,ve,ke))];case"Tanh":return[Object(A.tanh)(I("x",Se,ve,ke))];case"Tan":return[Object(A.tan)(I("x",Se,ve,ke))];case"Relu6":case"ClipByValue":return[Object(A.clipByValue)(I("x",Se,ve,ke),I("clipValueMin",Se,ve,ke),I("clipValueMax",Se,ve,ke))];case"Rsqrt":return[Object(A.rsqrt)(Q(Se.inputNames[0],ve,ke))];case"Prod":return[Object(A.prod)(I("x",Se,ve,ke),I("axes",Se,ve,ke))];case"LeakyRelu":return[Object(A.leakyRelu)(I("x",Se,ve,ke),I("alpha",Se,ve,ke))];case"Prelu":return[Object(A.prelu)(I("x",Se,ve,ke),I("alpha",Se,ve,ke))];default:throw TypeError("Node type "+Se.op+" is not implemented")}},Ce=function(){function Se(ve,ke,Me,rt,Ct,tn,Sn){this.name=ve,this.dtype=ke,this.maxSize=Me,this.elementShape=rt,this.identicalElementShapes=Ct,this.dynamicSize=tn,this.clearAfterRead=Sn,this.tensors=[],this.closed_=!1,this.id=Se.nextId++}return Object.defineProperty(Se.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),Se.prototype.clearAndClose=function(){this.tensors.forEach(function(ve){return ve.tensor.dispose()}),this.tensors=[],this.closed_=!0},Se.prototype.size=function(){return this.tensors.length},Se.prototype.read=function(ve){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(ve<0||ve>=this.tensors.length)throw new Error("Tried to read from index "+ve+", but array size is: "+this.tensors.length);var ke=this.tensors[ve];if(ke.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+ve+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(ke.cleared=!0),ke.read=!0,ke.tensor},Se.prototype.readMany=function(ve){var ke=this;return ve.map(function(Me){return ke.read(Me)})},Se.prototype.write=function(ve,ke){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(ve<0||!this.dynamicSize&&ve>=this.maxSize)throw new Error("Tried to write to index "+ve+", but array is not resizeable and size is: "+this.maxSize);var Me=this.tensors[ve]||{};if(ke.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+ve+`,
          because the value dtype is `+ke.dtype+", but TensorArray dtype is "+this.dtype+".");if(this.size()!==0||this.elementShape!=null&&this.elementShape.length!==0||(this.elementShape=ke.shape),this.assertShapesMatchAllowUndefinedSize(this.elementShape,ke.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+ve+"."),Me&&Me.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+ve+", because it has already been read.");if(Me&&Me.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+ve+", because it has already been written.");Me.tensor=ke,Me.written=!0,this.tensors[ve]=Me},Se.prototype.writeMany=function(ve,ke){var Me=this;if(ve.length!==ke.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,because the index size: "+ve.length+" is not the same as tensors size: "+ke.length+".");ve.forEach(function(rt,Ct){return Me.write(rt,ke[Ct])})},Se.prototype.gather=function(ve,ke){if(ke&&ke!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+ke);if(!ve){ve=[];for(var Me=0;Me<this.size();Me++)ve.push(Me)}if(ve.length===0)return Object(A.tensor)([],[0].concat(this.elementShape));var rt=this.readMany(ve);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,rt[0].shape,"TensorArray shape mismatch: "),Object(A.stack)(rt,0)},Se.prototype.concat=function(ve){if(ve&&ve!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+ve);if(this.size()===0)return Object(A.tensor)([],[0].concat(this.elementShape));for(var ke=[],Me=0;Me<this.size();Me++)ke.push(Me);var rt=this.readMany(ke);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,rt[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+rt[0].shape+")"),Object(A.concat)(rt,0)},Se.prototype.scatter=function(ve,ke){if(ke.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+ke.dtype);if(ve.length!==ke.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+ve.length+" vs. "+ke.shape[0]);var Me=Math.max.apply(Math,ve);if(!this.dynamicSize&&Me>=this.maxSize)throw new Error("Max index must be < array size ("+Me+"  vs. "+this.maxSize+")");this.writeMany(ve,Object(A.unstack)(ke,0))},Se.prototype.split=function(ve,ke){var Me=this;if(ke.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+ke.dtype);var rt=0,Ct=ve.map(function(mn){return rt+=mn});if(rt!==ke.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `+rt+", and tensor's shape is: "+ke.shape);if(!this.dynamicSize&&ve.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+ve.length+"), and the TensorArray is not marked as dynamically resizeable");var tn=rt===0?0:ke.size/rt,Sn=[];Object(A.tidy)(function(){ke=ke.reshape([1,rt,tn]);for(var mn=0;mn<ve.length;++mn){var fn=[0,mn===0?0:Ct[mn-1],0],mt=[1,ve[mn],tn];Sn[mn]=Object(A.slice)(ke,fn,mt).reshape(Me.elementShape)}return Sn});for(var Rt=[],Zt=0;Zt<ve.length;Zt++)Rt[Zt]=Zt;this.writeMany(Rt,Sn)},Se.prototype.assertShapesMatchAllowUndefinedSize=function(ve,ke,Me){Me===void 0&&(Me=""),A.util.assert(this.shapesEqualAllowUndefinedSize(ve,ke),function(){return Me+" Shapes "+ve+" and "+ke+" must match"})},Se.prototype.shapesEqualAllowUndefinedSize=function(ve,ke){if(ve.length!==ke.length)return!1;for(var Me=0;Me<ve.length;Me++)if(ve[Me]!==-1&&ke[Me]!==-1&&ve[Me]!==ke[Me])return!1;return!0},Se.nextId=0,Se}(),sr=function(Se,ve,ke){return B(void 0,void 0,void 0,function(){var Me,rt,Ct,tn,Sn,Rt,Zt,mn,fn,mt,Mt,hn,nn,He,Bn,Xn,Zn,lr,jr,Cr,xi,Ai,ni,to,yi,ri,Jr,Kn,pi,Ci,Wr,so,Wi,no,So;return D(this,function(_a){switch(_a.label){case 0:switch(Se.op){case"LoopCond":return[3,1];case"Switch":return[3,2];case"Merge":return[3,4];case"Enter":return[3,5];case"Exit":return[3,6];case"NextIteration":return[3,7];case"TensorArrayV3":return[3,8];case"TensorArrayWriteV3":return[3,9];case"TensorArrayReadV3":return[3,10];case"TensorArrayGatherV3":return[3,11];case"TensorArrayScatterV3":return[3,12];case"TensorArrayConcatV3":return[3,13];case"TensorArraySplitV3":return[3,14];case"TensorArraySizeV3":return[3,15];case"TensorArrayCloseV3":return[3,16]}return[3,17];case 1:return[2,[I("pred",Se,ve,ke).clone()]];case 2:return Me=I("pred",Se,ve,ke),rt=I("data",Se,ve,ke),[4,Me.data()];case 3:return[2,_a.sent()[0]?[void 0,rt.clone()]:[rt.clone(),void 0]];case 4:return[2,(Ct=Se.inputNames.find(function(Ds){return Q(Ds,ve,ke)!==void 0}))?[Q(Ct,ve,ke).clone()]:void 0];case 5:return tn=I("frameName",Se,ve,ke),Sn=I("tensor",Se,ve,ke),ke.enterFrame(tn),[2,[Sn.clone()]];case 6:return Rt=I("tensor",Se,ve,ke),ke.exitFrame(),[2,[Rt.clone()]];case 7:return Zt=I("tensor",Se,ve,ke),ke.nextIteration(),[2,[Zt.clone()]];case 8:return mn=I("size",Se,ve,ke),fn=I("dtype",Se,ve,ke),mt=I("elementShape",Se,ve,ke),Mt=I("dynamicSize",Se,ve,ke),hn=I("clearAfterRead",Se,ve,ke),nn=I("identicalElementShapes",Se,ve,ke),He=I("name",Se,ve,ke),Bn=new Ce(He,fn,mn,mt,nn,Mt,hn),ke.addTensorArray(Bn),[2,[Object(A.scalar)(Bn.id),Object(A.scalar)(1)]];case 9:return Xn=I("tensorArrayId",Se,ve,ke),Zn=I("index",Se,ve,ke),lr=I("tensor",Se,ve,ke),ke.getTensorArray(Xn).write(Zn,lr),[2,[Object(A.scalar)(1)]];case 10:return jr=I("tensorArrayId",Se,ve,ke),Cr=I("index",Se,ve,ke),[2,[ke.getTensorArray(jr).read(Cr)]];case 11:return xi=I("tensorArrayId",Se,ve,ke),Ai=I("indices",Se,ve,ke),ni=I("dtype",Se,ve,ke),[2,[ke.getTensorArray(xi).gather(Ai,ni)]];case 12:return to=I("tensorArrayId",Se,ve,ke),yi=I("indices",Se,ve,ke),ri=I("tensor",Se,ve,ke),ke.getTensorArray(to).scatter(yi,ri),[2,[Object(A.scalar)(1)]];case 13:return Jr=I("tensorArrayId",Se,ve,ke),Kn=ke.getTensorArray(Jr),pi=I("dtype",Se,ve,ke),[2,[Kn.concat(pi)]];case 14:return Ci=I("tensorArrayId",Se,ve,ke),Wr=I("tensor",Se,ve,ke),so=I("lengths",Se,ve,ke),ke.getTensorArray(Ci).split(so,Wr),[2,[Object(A.scalar)(1)]];case 15:return Wi=I("tensorArrayId",Se,ve,ke),no=ke.getTensorArray(Wi),[2,[Object(A.scalar)(no.size(),"int32")]];case 16:return So=I("tensorArrayId",Se,ve,ke),ke.getTensorArray(So).clearAndClose(),[2,[Object(A.scalar)(0)]];case 17:throw TypeError("Node type "+Se.op+" is not implemented")}})})},Mr=function(Se,ve,ke){switch(Se.op){case"Conv1D":var Me=I("stride",Se,ve,ke),rt=I("pad",Se,ve,ke),Ct=I("dataFormat",Se,ve,ke).toUpperCase(),tn=I("dilation",Se,ve,ke);return[Object(A.conv1d)(I("x",Se,ve,ke),I("filter",Se,ve,ke),Me,rt,Ct,tn)];case"Conv2D":Me=I("strides",Se,ve,ke),rt=I("pad",Se,ve,ke),Ct=I("dataFormat",Se,ve,ke).toUpperCase();var Sn=I("dilations",Se,ve,ke);return[Object(A.conv2d)(I("x",Se,ve,ke),I("filter",Se,ve,ke),[Me[1],Me[2]],rt,Ct,[Sn[1],Sn[2]])];case"_FusedConv2D":case"FusedDepthwiseConv2dNative":var Rt=I("fusedOps",Se,ve,ke),Zt=Rt[0],mn=Rt[1],fn=Zt==="biasadd",mt=mn==="prelu",Mt=Zt==="fusedbatchnorm",hn=I("numArgs",Se,ve,ke);if(fn){if(mt&&hn!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!mt&&hn!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(Mt)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.");Me=I("strides",Se,ve,ke),rt=I("pad",Se,ve,ke),Ct=I("dataFormat",Se,ve,ke).toUpperCase(),Sn=I("dilations",Se,ve,ke);var nn=I("args",Se,ve,ke),He=nn[0],Bn=nn[1];return[(Se.op==="_FusedConv2D"?A.fused.conv2d:A.fused.depthwiseConv2d)({x:I("x",Se,ve,ke),filter:I("filter",Se,ve,ke),strides:[Me[1],Me[2]],pad:rt,dataFormat:Ct,dilations:[Sn[1],Sn[2]],bias:He,activation:mn,preluActivationWeights:Bn})];case"Conv2DBackpropInput":case"Conv2dTranspose":var Xn=I("outputShape",Se,ve,ke);return Me=I("strides",Se,ve,ke),rt=I("pad",Se,ve,ke),[Object(A.conv2dTranspose)(I("x",Se,ve,ke),I("filter",Se,ve,ke),Xn,[Me[1],Me[2]],rt)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":return Me=I("strides",Se,ve,ke),rt=I("pad",Se,ve,ke),Sn=I("dilations",Se,ve,ke),Ct=I("dataFormat",Se,ve,ke).toUpperCase(),[Object(A.depthwiseConv2d)(I("input",Se,ve,ke),I("filter",Se,ve,ke),[Me[1],Me[2]],rt,Ct,[Sn[1],Sn[2]])];case"Conv3D":return Me=I("strides",Se,ve,ke),rt=I("pad",Se,ve,ke),Ct=I("dataFormat",Se,ve,ke).toUpperCase(),Sn=I("dilations",Se,ve,ke),[Object(A.conv3d)(I("x",Se,ve,ke),I("filter",Se,ve,ke),[Me[1],Me[2],Me[3]],rt,Ct,[Sn[1],Sn[2],Sn[3]])];case"AvgPool":Me=I("strides",Se,ve,ke),rt=I("pad",Se,ve,ke);var Zn=I("kernelSize",Se,ve,ke);return[Object(A.avgPool)(I("x",Se,ve,ke),[Zn[1],Zn[2]],[Me[1],Me[2]],rt)];case"MaxPool":return Me=I("strides",Se,ve,ke),rt=I("pad",Se,ve,ke),Zn=I("kernelSize",Se,ve,ke),[Object(A.maxPool)(I("x",Se,ve,ke),[Zn[1],Zn[2]],[Me[1],Me[2]],rt)];case"MaxPoolWithArgmax":Me=I("strides",Se,ve,ke),rt=I("pad",Se,ve,ke),Zn=I("kernelSize",Se,ve,ke);var lr=I("includeBatchInIndex",Se,ve,ke),jr=Object(A.maxPoolWithArgmax)(I("x",Se,ve,ke),[Zn[1],Zn[2]],[Me[1],Me[2]],rt,lr);return[jr.result,jr.indexes];case"AvgPool3D":return Me=I("strides",Se,ve,ke),rt=I("pad",Se,ve,ke),Zn=I("kernelSize",Se,ve,ke),[Object(A.avgPool3d)(I("x",Se,ve,ke),[Zn[1],Zn[2],Zn[3]],[Me[1],Me[2],Me[3]],rt)];case"MaxPool3D":return Me=I("strides",Se,ve,ke),rt=I("pad",Se,ve,ke),Zn=I("kernelSize",Se,ve,ke),[Object(A.maxPool3d)(I("x",Se,ve,ke),[Zn[1],Zn[2],Zn[3]],[Me[1],Me[2],Me[3]],rt)];default:throw TypeError("Node type "+Se.op+" is not implemented")}},on=function(Se,ve,ke){switch(Se.op){case"Fill":var Me=I("shape",Se,ve,ke),rt=I("dtype",Se,ve,ke),Ct=I("value",Se,ve,ke);return[Object(A.fill)(Me,Ct,rt)];case"LinSpace":var tn=I("start",Se,ve,ke),Sn=I("stop",Se,ve,ke),Rt=I("num",Se,ve,ke);return[Object(A.linspace)(tn,Sn,Rt)];case"Multinomial":var Zt=I("logits",Se,ve,ke),mn=I("numSamples",Se,ve,ke),fn=I("seed",Se,ve,ke);return[Object(A.multinomial)(Zt,mn,fn)];case"OneHot":var mt=I("indices",Se,ve,ke),Mt=I("depth",Se,ve,ke),hn=I("onValue",Se,ve,ke),nn=I("offValue",Se,ve,ke);return[Object(A.oneHot)(mt,Mt,hn,nn)];case"Ones":return[Object(A.ones)(I("shape",Se,ve,ke),I("dtype",Se,ve,ke))];case"OnesLike":return[Object(A.onesLike)(I("x",Se,ve,ke))];case"RandomUniform":return[Object(A.randomUniform)(I("shape",Se,ve,ke),I("minval",Se,ve,ke),I("maxval",Se,ve,ke),I("dtype",Se,ve,ke))];case"Range":tn=I("start",Se,ve,ke);var He=I("stop",Se,ve,ke),Bn=I("step",Se,ve,ke);return[Object(A.range)(tn,He,Bn,I("dtype",Se,ve,ke))];case"TruncatedNormal":Me=I("shape",Se,ve,ke);var Xn=I("mean",Se,ve,ke),Zn=I("stdDev",Se,ve,ke);return fn=I("seed",Se,ve,ke),[Object(A.truncatedNormal)(Me,Xn,Zn,I("dtype",Se,ve,ke),fn)];case"Zeros":return[Object(A.zeros)(I("shape",Se,ve,ke),I("dtype",Se,ve,ke))];case"ZerosLike":return[Object(A.zerosLike)(I("x",Se,ve,ke))];default:throw TypeError("Node type "+Se.op+" is not implemented")}},Gt=function(Se,ve,ke){return B(void 0,void 0,void 0,function(){var Me,rt,Ct,tn,Sn,Rt,Zt,mn;return D(this,function(fn){switch(fn.label){case 0:switch(Se.op){case"NonMaxSuppressionV5":case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":return[3,1];case"Where":return[3,5];case"ListDiff":return[3,7]}return[3,8];case 1:return Me=I("boxes",Se,ve,ke),rt=I("scores",Se,ve,ke),Ct=I("maxOutputSize",Se,ve,ke),tn=I("iouThreshold",Se,ve,ke),Sn=I("scoreThreshold",Se,ve,ke),Se.op!=="NonMaxSuppressionV5"?[3,3]:(Rt=I("softNmsSigma",Se,ve,ke),[4,A.image.nonMaxSuppressionWithScoreAsync(Me,rt,Ct,tn,Sn,Rt)]);case 2:return[2,[(mn=fn.sent()).selectedIndices,mn.selectedScores]];case 3:return[4,A.image.nonMaxSuppressionAsync(Me,rt,Ct,tn,Sn)];case 4:return[2,[fn.sent()]];case 5:return Zt=I("condition",Se,ve,ke).asType("bool"),[4,Object(A.whereAsync)(Zt)];case 6:return mn=[fn.sent()],Zt.dispose(),[2,mn];case 7:return[2,Object(A.setdiff1dAsync)(I("x",Se,ve,ke),I("y",Se,ve,ke))];case 8:throw TypeError("Node type "+Se.op+" is not implemented")}})})},Hn=function(Se,ve,ke){switch(Se.op){case"TopKV2":var Me=I("x",Se,ve,ke),rt=I("k",Se,ve,ke),Ct=I("sorted",Se,ve,ke),tn=Object(A.topk)(Me,rt,Ct);return[tn.values,tn.indices];default:throw TypeError("Node type "+Se.op+" is not implemented")}},Kt=function(Se,ve,ke){switch(Se.op){case"Const":return ve[Se.name];case"PlaceholderWithDefault":var Me=I("default",Se,ve,ke);return[Q(Se.name,ve,ke)||Me];case"Placeholder":return[Q(Se.name,ve,ke)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[I("x",Se,ve,ke).clone()];case"IdentityN":return I("x",Se,ve,ke).map(function(Zt){return Zt.clone()});case"Snapshot":return[I("x",Se,ve,ke).clone()];case"Shape":return[Object(A.tensor1d)(I("x",Se,ve,ke).shape,"int32")];case"ShapeN":return I("x",Se,ve,ke).map(function(Zt){return Object(A.tensor1d)(Zt.shape)});case"Size":return[Object(A.scalar)(I("x",Se,ve,ke).size,"int32")];case"Rank":return[Object(A.scalar)(I("x",Se,ve,ke).rank,"int32")];case"NoOp":return[Object(A.scalar)(1)];case"Print":var rt=I("x",Se,ve,ke),Ct=I("data",Se,ve,ke),tn=I("message",Se,ve,ke),Sn=I("summarize",Se,ve,ke);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(tn);for(var Rt=0;Rt<Ct.length;Rt++)console.log(Array.prototype.slice.call(Ct[Rt].dataSync()).slice(0,Sn));return[rt];default:throw TypeError("Node type "+Se.op+" is not implemented")}},Vt=function(Se,ve,ke){switch(Se.op){case"ResizeBilinear":var Me=I("images",Se,ve,ke),rt=I("size",Se,ve,ke),Ct=I("alignCorners",Se,ve,ke);return[A.image.resizeBilinear(Me,[rt[0],rt[1]],Ct)];case"ResizeNearestNeighbor":return Me=I("images",Se,ve,ke),rt=I("size",Se,ve,ke),Ct=I("alignCorners",Se,ve,ke),[A.image.resizeNearestNeighbor(Me,[rt[0],rt[1]],Ct)];case"CropAndResize":var tn=I("image",Se,ve,ke),Sn=I("boxes",Se,ve,ke),Rt=I("boxInd",Se,ve,ke),Zt=I("cropSize",Se,ve,ke),mn=I("method",Se,ve,ke),fn=I("extrapolationValue",Se,ve,ke);return[A.image.cropAndResize(tn,Sn,Rt,Zt,mn,fn)];default:throw TypeError("Node type "+Se.op+" is not implemented")}},en=function(Se,ve,ke){switch(Se.op){case"Equal":return[Object(A.equal)(I("a",Se,ve,ke),I("b",Se,ve,ke))];case"NotEqual":return[Object(A.notEqual)(I("a",Se,ve,ke),I("b",Se,ve,ke))];case"Greater":return[Object(A.greater)(I("a",Se,ve,ke),I("b",Se,ve,ke))];case"GreaterEqual":return[Object(A.greaterEqual)(I("a",Se,ve,ke),I("b",Se,ve,ke))];case"Less":return[Object(A.less)(I("a",Se,ve,ke),I("b",Se,ve,ke))];case"LessEqual":return[Object(A.lessEqual)(I("a",Se,ve,ke),I("b",Se,ve,ke))];case"LogicalAnd":return[Object(A.logicalAnd)(I("a",Se,ve,ke),I("b",Se,ve,ke))];case"LogicalNot":return[Object(A.logicalNot)(I("a",Se,ve,ke))];case"LogicalOr":return[Object(A.logicalOr)(I("a",Se,ve,ke),I("b",Se,ve,ke))];case"Select":case"SelectV2":return[Object(A.where)(I("condition",Se,ve,ke),I("a",Se,ve,ke),I("b",Se,ve,ke))];default:throw TypeError("Node type "+Se.op+" is not implemented")}},Vn=function(Se,ve,ke){switch(Se.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[Object(A.matMul)(I("a",Se,ve,ke),I("b",Se,ve,ke),I("transposeA",Se,ve,ke),I("transposeB",Se,ve,ke))];case"Transpose":return[Object(A.transpose)(I("x",Se,ve,ke),I("perm",Se,ve,ke))];case"_FusedMatMul":var Me=I("fusedOps",Se,ve,ke),rt=Me[0],Ct=Me[1],tn=rt==="biasadd",Sn=Ct==="prelu",Rt=I("numArgs",Se,ve,ke);if(tn){if(Sn&&Rt!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!Sn&&Rt!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var Zt=I("args",Se,ve,ke),mn=Zt[0],fn=Zt[1];return[A.fused.matMul({a:I("a",Se,ve,ke),b:I("b",Se,ve,ke),transposeA:I("transposeA",Se,ve,ke),transposeB:I("transposeB",Se,ve,ke),bias:mn,activation:Ct,preluActivationWeights:fn})];default:throw TypeError("Node type "+Se.op+" is not implemented")}},Dt=function(Se,ve,ke){switch(Se.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[Object(A.batchNorm)(I("x",Se,ve,ke),I("mean",Se,ve,ke),I("variance",Se,ve,ke),I("offset",Se,ve,ke),I("scale",Se,ve,ke),I("epsilon",Se,ve,ke))];case"LRN":return[Object(A.localResponseNormalization)(I("x",Se,ve,ke),I("radius",Se,ve,ke),I("bias",Se,ve,ke),I("alpha",Se,ve,ke),I("beta",Se,ve,ke))];case"Softmax":return[Object(A.softmax)(I("x",Se,ve,ke))];case"LogSoftmax":return[Object(A.logSoftmax)(I("x",Se,ve,ke))];case"SparseToDense":return[Object(A.sparseToDense)(I("sparseIndices",Se,ve,ke),I("outputShape",Se,ve,ke),I("sparseValues",Se,ve,ke),I("defaultValue",Se,ve,ke))];default:throw TypeError("Node type "+Se.op+" is not implemented")}},On=function(Se,ve,ke){switch(Se.op){case"Max":var Me=I("axis",Se,ve,ke),rt=I("keepDims",Se,ve,ke);return[Object(A.max)(I("x",Se,ve,ke),Me,rt)];case"Mean":return Me=I("axis",Se,ve,ke),rt=I("keepDims",Se,ve,ke),[Object(A.mean)(I("x",Se,ve,ke),Me,rt)];case"Min":return Me=I("axis",Se,ve,ke),rt=I("keepDims",Se,ve,ke),[Object(A.min)(I("x",Se,ve,ke),Me,rt)];case"Sum":return Me=I("axis",Se,ve,ke),rt=I("keepDims",Se,ve,ke),[Object(A.sum)(I("x",Se,ve,ke),Me,rt)];case"All":return Me=I("axis",Se,ve,ke),rt=I("keepDims",Se,ve,ke),[Object(A.all)(I("x",Se,ve,ke),Me,rt)];case"Any":return Me=I("axis",Se,ve,ke),rt=I("keepDims",Se,ve,ke),[Object(A.any)(I("x",Se,ve,ke),Me,rt)];case"ArgMax":return Me=I("axis",Se,ve,ke),[Object(A.argMax)(I("x",Se,ve,ke),Me)];case"ArgMin":return Me=I("axis",Se,ve,ke),[Object(A.argMin)(I("x",Se,ve,ke),Me)];case"Prod":return Me=I("axis",Se,ve,ke),rt=I("keepDims",Se,ve,ke),[Object(A.prod)(I("x",Se,ve,ke),Me,rt)];default:throw TypeError("Node type "+Se.op+" is not implemented")}},or=function(Se,ve,ke){switch(Se.op){case"ConcatV2":case"Concat":var Me=I("n",Se,ve,ke),rt=I("axis",Se,ve,ke),Ct=I("tensors",Se,ve,ke);return Ct=Ct.slice(0,Me),[Object(A.concat)(Ct,rt)];case"GatherV2":case"Gather":rt=I("axis",Se,ve,ke);var tn=I("x",Se,ve,ke),Sn=I("indices",Se,ve,ke);return[Object(A.gather)(tn,Sn.asType("int32"),rt)];case"ReverseV2":case"Reverse":return rt=I("axis",Se,ve,ke),tn=I("x",Se,ve,ke),[Object(A.reverse)(tn,rt)];case"Slice":var Rt=I("begin",Se,ve,ke),Zt=I("size",Se,ve,ke);return[Object(A.slice)(I("x",Se,ve,ke),Rt,Zt)];case"StridedSlice":Rt=I("begin",Se,ve,ke);var mn=I("end",Se,ve,ke),fn=I("strides",Se,ve,ke),mt=I("beginMask",Se,ve,ke),Mt=I("endMask",Se,ve,ke),hn=I("ellipsisMask",Se,ve,ke),nn=I("newAxisMask",Se,ve,ke),He=I("shrinkAxisMask",Se,ve,ke),Bn=I("x",Se,ve,ke);if(Rt.length===1&&Bn.shape.length>1)for(var Xn=1;Xn<Bn.shape.length;Xn++)Rt.push(0),mn.push(Bn.shape[Xn]),fn.push(fn[0]);return[Object(A.stridedSlice)(Bn,Rt,mn,fn,mt,Mt,hn,nn,He)];case"Pack":return Object(A.tidy)(function(){var to=I("axis",Se,ve,ke),yi=I("tensors",Se,ve,ke),ri=yi[0].shape,Jr=yi[0].squeeze().shape,Kn=yi.map(function(pi){var Ci=A.util.arraysEqual(pi.shape,ri);if(!Ci&&!A.util.arraysEqual(pi.squeeze().shape,Jr))throw new Error("the input tensors shape does not match");return Ci?pi:pi.reshape(ri)});return[Object(A.stack)(Kn,to)]});case"Unpack":return Object(A.tidy)(function(){var to=I("axis",Se,ve,ke),yi=I("tensor",Se,ve,ke);return Object(A.unstack)(yi,to)});case"Tile":var Zn=I("reps",Se,ve,ke);return[Object(A.tile)(I("x",Se,ve,ke),Zn)];case"Split":case"SplitV":rt=I("axis",Se,ve,ke);var lr=I("numOrSizeSplits",Se,ve,ke);return Object(A.split)(I("x",Se,ve,ke),lr,rt);case"ScatterNd":Sn=I("indices",Se,ve,ke);var jr=I("values",Se,ve,ke),Cr=I("shape",Se,ve,ke);return[Object(A.scatterND)(Sn,jr,Cr)];case"GatherNd":var xi=I("x",Se,ve,ke);return Sn=I("indices",Se,ve,ke),[Object(A.gatherND)(xi,Sn)];case"SparseToDense":Sn=I("sparseIndices",Se,ve,ke),Cr=I("outputShape",Se,ve,ke);var Ai=I("sparseValues",Se,ve,ke),ni=I("defaultValue",Se,ve,ke);return[Object(A.sparseToDense)(Sn,Ai,Cr,Ai.dtype===ni.dtype?ni:ni.asType(Ai.dtype))];default:throw TypeError("Node type "+Se.op+" is not implemented")}},ar=function(Se,ve,ke){switch(Se.op){case"FFT":return[Object(A.fft)(I("x",Se,ve,ke))];case"IFFT":return[Object(A.ifft)(I("x",Se,ve,ke))];case"RFFT":return[Object(A.rfft)(I("x",Se,ve,ke))];case"IRFFT":return[Object(A.irfft)(I("x",Se,ve,ke))];default:throw TypeError("Node type "+Se.op+" is not implemented")}},yr=function(Se,ve,ke){switch(Se.op){case"Cast":return[Object(A.cast)(I("x",Se,ve,ke),I("dtype",Se,ve,ke))];case"ExpandDims":var Me=I("axis",Se,ve,ke);return[Object(A.expandDims)(I("x",Se,ve,ke),Me)];case"Squeeze":return Me=I("axis",Se,ve,ke),[Object(A.squeeze)(I("x",Se,ve,ke),Me)];case"Reshape":return[Object(A.reshape)(I("x",Se,ve,ke),I("shape",Se,ve,ke))];case"PadV2":case"Pad":return[Object(A.pad)(I("x",Se,ve,ke),oe(I("padding",Se,ve,ke),2),I("constantValue",Se,ve,ke))];case"SpaceToBatchND":var rt=I("blockShape",Se,ve,ke),Ct=oe(I("paddings",Se,ve,ke),2);return[Object(A.spaceToBatchND)(I("x",Se,ve,ke),rt,Ct)];case"BatchToSpaceND":rt=I("blockShape",Se,ve,ke);var tn=oe(I("crops",Se,ve,ke),2);return[Object(A.batchToSpaceND)(I("x",Se,ve,ke),rt,tn)];case"DepthToSpace":var Sn=I("blockSize",Se,ve,ke),Rt=I("dataFormat",Se,ve,ke).toUpperCase();return[Object(A.depthToSpace)(I("x",Se,ve,ke),Sn,Rt)];default:throw TypeError("Node type "+Se.op+" is not implemented")}};function kr(Se,ve,ke){var Me=function(rt,Ct,tn){switch(rt.category){case"arithmetic":return Object(A.tidy)(function(){return An(rt,Ct,tn)});case"basic_math":return Object(A.tidy)(function(){return Qn(rt,Ct,tn)});case"control":return sr(rt,Ct,tn);case"convolution":return Object(A.tidy)(function(){return Mr(rt,Ct,tn)});case"creation":return Object(A.tidy)(function(){return on(rt,Ct,tn)});case"dynamic":return Gt(rt,Ct,tn);case"evaluation":return Object(A.tidy)(function(){return Hn(rt,Ct,tn)});case"image":return Object(A.tidy)(function(){return Vt(rt,Ct,tn)});case"graph":return Object(A.tidy)(function(){return Kt(rt,Ct,tn)});case"logical":return Object(A.tidy)(function(){return en(rt,Ct,tn)});case"matrices":return Object(A.tidy)(function(){return Vn(rt,Ct,tn)});case"normalization":return Object(A.tidy)(function(){return Dt(rt,Ct,tn)});case"reduction":return Object(A.tidy)(function(){return On(rt,Ct,tn)});case"slice_join":return Object(A.tidy)(function(){return or(rt,Ct,tn)});case"spectral":return Object(A.tidy)(function(){return ar(rt,Ct,tn)});case"transformation":return Object(A.tidy)(function(){return yr(rt,Ct,tn)});case"custom":var Sn=j(rt.op);if(Sn&&Sn.customExecutor)return Sn.customExecutor(new Pn(rt,Ct,tn));throw TypeError("Custom op "+rt.op+" is not registered.");default:throw TypeError("Unknown op '"+rt.op+"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(Se,ve,ke);return Me instanceof Promise?Me.then(function(rt){return[].concat(rt)}):[].concat(Me)}var dr=function(){function Se(ve,ke){this.weightMap=ve,this.tensorArrayMap=ke,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return Se.prototype.newFrame=function(ve,ke){return{id:ve,frameName:ke,iterationId:0}},Object.defineProperty(Se.prototype,"currentContext",{get:function(){return this.contexts},set:function(ve){this.contexts!==ve&&(this.contexts=ve,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),Se.prototype.generateCurrentContextIds=function(){for(var ve=[],ke=0;ke<this.contexts.length-1;ke++){var Me=this.contexts.slice(0,this.contexts.length-ke);ve.push(this.contextIdforContexts(Me))}ve.push(""),this._currentContextIds=ve},Se.prototype.contextIdforContexts=function(ve){return ve?ve.map(function(ke){return ke.id===0&&ke.iterationId===0?"":ke.frameName+"-"+ke.iterationId}).join("/"):""},Se.prototype.enterFrame=function(ve){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,ve)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},Se.prototype.exitFrame=function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()},Se.prototype.nextIteration=function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var ve=Object.assign({},this.contexts[this.contexts.length-1]);ve.iterationId+=1,ve.id=this.lastId,this.contexts.splice(-1,1,ve),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))},Se.prototype.getWeight=function(ve){return this.weightMap[ve]},Se.prototype.addTensorArray=function(ve){this.tensorArrayMap[ve.id]=ve},Se.prototype.getTensorArray=function(ve){return this.tensorArrayMap[ve]},Se}();function oi(Se,ve,ke){for(var Me=new Set,rt=[],Ct=null,tn=null,Sn=new Set,Rt=Object.keys(Se).map(function(fn){return ae(fn)[0]}),Zt=ve.slice();Zt.length>0;){var mn=Zt.pop();(zn(mn)||ir(mn))&&Ct==null&&(tn=(Ct=mn).children.map(function(fn){return fn.name}).filter(function(fn){return Me.has(fn)})),Me.add(mn.name),ke[mn.name]==null&&Rt.indexOf(mn.name)===-1&&(mn.inputs.length!==0?mn.inputs.forEach(function(fn){Sn.has(fn.name)||(Sn.add(fn.name),Zt.push(fn))}):rt.push(mn.name))}return{inputs:Se,outputs:ve,usedNodes:Me,missingInputs:rt,dynamicNode:Ct,syncInputs:tn}}var Ur=["Switch","Merge","Enter","Exit","NextIteration"],Xr=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"];function zn(Se){return Ur.indexOf(Se.op)>=0}function ir(Se){return Xr.indexOf(Se.op)>=0}var Or=function(){function Se(ve){this.graph=ve,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._outputs=ve.outputs,this._inputs=ve.inputs,this._signature=ve.signature}return Object.defineProperty(Se.prototype,"weightMap",{get:function(){return this._weightMap},set:function(ve){var ke=Object.keys(ve).map(function(Me){return ve[Me].map(function(rt){return rt.id})});this.weightIds=[].concat.apply([],ke),this._weightMap=ve},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"inputs",{get:function(){return this._inputs.map(function(ve){return{name:ve.name,shape:ve.attrParams.shape?ve.attrParams.shape.value:void 0,dtype:ve.attrParams.dtype?ve.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"outputs",{get:function(){return this._outputs.map(function(ve){return{name:ve.name,shape:ve.attrParams.shape?ve.attrParams.shape.value:void 0,dtype:ve.attrParams.dtype?ve.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"inputNodes",{get:function(){return this._inputs.map(function(ve){return ve.signatureKey||ve.name})},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"outputNodes",{get:function(){return this._outputs.map(function(ve){return ve.signatureKey||ve.name})},enumerable:!0,configurable:!0}),Se.prototype.getCompilationKey=function(ve,ke){var Me=ve.map(function(Ct){return Ct.name}).sort(),rt=ke.map(function(Ct){return Ct.name}).sort();return Me.join(this.SEPERATOR)+"--"+rt.join(this.SEPERATOR)},Se.prototype.compile=function(ve,ke){var Me=oi(ve,ke,this.weightMap),rt=Me.missingInputs,Ct=Me.dynamicNode,tn=Me.syncInputs;if(Ct!=null)throw new Error("This execution contains the node '"+Ct.name+"', which has the dynamic op '"+Ct.op+"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs ["+tn+"]");if(rt.length>0){var Sn=ke.map(function(Zt){return Zt.name}),Rt=Object.keys(ve);throw new Error("Cannot compute the outputs ["+Sn+"] from the provided inputs ["+Rt+"]. Missing the following inputs: ["+rt+"]")}return function(Zt,mn,fn){var mt=fn.usedNodes,Mt=fn.inputs,hn=[];Object.keys(Mt).map(function(Xn){return ae(Xn)[0]}).map(function(Xn){return Zt.nodes[Xn]}).forEach(function(Xn){mt.has(Xn.name)&&hn.push(Xn)}),Zt.weights.forEach(function(Xn){mt.has(Xn.name)&&hn.push(Xn)});for(var nn=new Set,He=[];hn.length>0;){var Bn=hn.pop();nn.add(Bn.name),mn[Bn.name]||He.push(Bn),Bn.children.forEach(function(Xn){!nn.has(Xn.name)&&mt.has(Xn.name)&&Xn.inputs.every(function(Zn){return nn.has(Zn.name)})&&hn.push(Xn)})}return He}(this.graph,this.weightMap,Me)},Se.prototype.execute=function(ve,ke){var Me=this;ve=this.mapInputs(ve);var rt=Object.keys(ve).sort();this.checkInputs(ve),this.checkInputShapeAndType(ve),ke=this.mapOutputs(ke),this.checkOutputs(ke);var Ct=rt.map(function(mn){return Me.graph.nodes[ae(mn)[0]]}),tn=ke.map(function(mn){return Me.graph.nodes[ae(mn)[0]]}),Sn=this.getCompilationKey(Ct,tn),Rt=this.compiledMap.get(Sn);Rt==null&&(Rt=this.compile(ve,tn),this.compiledMap.set(Sn,Rt));var Zt={};return Object(A.tidy)(function(){var mn=new dr(Me._weightMap,Zt),fn=U({},Me.weightMap);Object.keys(ve).forEach(function(Bn){var Xn=ae(Bn),Zn=Xn[0],lr=[];lr[Xn[1]]=ve[Bn],fn[Zn]=lr});for(var mt=Me.getFrozenTensorIds(fn),Mt={},hn=0;hn<Rt.length;hn++){var nn=Rt[hn];if(!fn[nn.name]){var He=kr(nn,fn,mn);if(He instanceof Promise)throw new Error("The execution of the op '"+nn.op+"' returned a promise. Please use model.executeAsync() instead.");fn[nn.name]=He,Me.checkTensorForDisposal(nn.name,nn,fn,mn,mt,ke,Mt)}}return ke.map(function(Bn){return Q(Bn,fn,mn)})})},Se.prototype.getFrozenTensorIds=function(ve){var ke=[].concat.apply([],Object.keys(ve).map(function(Me){return ve[Me]}).map(function(Me){return Me.map(function(rt){return rt.id})}));return new Set(ke)},Se.prototype.checkTensorForDisposal=function(ve,ke,Me,rt,Ct,tn,Sn){ke.category!=="control"&&tn.indexOf(ve)===-1&&(Me[ve].forEach(function(Rt){Rt!=null&&(Sn[Rt.id]=(Sn[Rt.id]||0)+ke.children.length)}),ke.inputs.forEach(function(Rt){if(Rt.category!=="control"){var Zt=function(mn,fn,mt){return fn[q(mn,mt.currentContextId)]}(Rt.name,Me,rt);Zt!=null&&Zt.forEach(function(mn){if(mn&&!Ct.has(mn.id)){var fn=Sn[mn.id];fn===1?(mn.dispose(),delete Sn[mn.id]):fn!=null&&Sn[mn.id]--}})}}))},Se.prototype.executeAsync=function(ve,ke){return B(this,void 0,void 0,function(){var Me,rt,Ct,tn,Sn,Rt,Zt=this;return D(this,function(mn){switch(mn.label){case 0:return ve=this.mapInputs(ve),this.checkInputs(ve),this.checkInputShapeAndType(ve),ke=this.mapOutputs(ke),this.checkOutputs(ke),Me={},rt=new dr(this._weightMap,Me),[4,this.executeWithControlFlow(ve,rt,ke)];case 1:return Ct=mn.sent(),tn=ke.map(function(fn){return Q(fn,Ct,rt)}),Sn=new Set(tn.map(function(fn){return fn.id})),Rt=new Set(Object.keys(ve).map(function(fn){return ve[fn].id})),Object.keys(Ct).forEach(function(fn){Ct[fn].forEach(function(mt){!mt||mt.isDisposed||Sn.has(mt.id)||Rt.has(mt.id)||Zt.weightIds.indexOf(mt.id)!==-1||mt.dispose()})}),[2,tn]}})})},Se.prototype.executeWithControlFlow=function(ve,ke,Me){return B(this,void 0,void 0,function(){var rt,Ct,tn,Sn,Rt,Zt,mn,fn,mt,Mt,hn,nn,He,Bn,Xn,Zn,lr=this;return D(this,function(jr){switch(jr.label){case 0:rt=Object.keys(ve),Ct=rt.map(function(Cr){return lr.graph.nodes[ae(Cr)[0]]}),tn=Me.map(function(Cr){return lr.graph.nodes[ae(Cr)[0]]}),Sn=oi(ve,tn,this.weightMap),Rt=Sn.usedNodes,Zt=Sn.missingInputs,mn=Sn.dynamicNode,fn=Sn.syncInputs,mt=Ct.concat(this.graph.weights).map(function(Cr){return{node:Cr,contexts:ke.currentContext}}),Mt=U({},this.weightMap),Object.keys(ve).forEach(function(Cr){var xi=ae(Cr),Ai=xi[0],ni=[];ni[xi[1]]=ve[Cr],Mt[Ai]=ni}),hn={},nn=this.getFrozenTensorIds(Mt),He={},jr.label=1;case 1:return mt.length>0?(Bn=this.processStack(Ct,mt,ke,Mt,He,nn,Me,hn,Rt),[4,Promise.all(Bn)]):[3,3];case 2:return jr.sent(),[3,1];case 3:if(mn==null&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),(Xn=tn.filter(function(Cr){return!zn(Cr)&&!Q(Cr.name,Mt,ke)}).map(function(Cr){return Cr.name})).length>0)throw Zn="",mn!=null&&(Zn="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs ["+fn+"]"),new Error("Cannot compute the outputs ["+Xn+"] from the provided inputs ["+rt+"]. Consider providing the following inputs: ["+Zt+"]. "+Zn);return[2,Mt]}})})},Se.prototype.processStack=function(ve,ke,Me,rt,Ct,tn,Sn,Rt,Zt){for(var mn=this,fn=[],mt=function(){var hn=ke.pop();Me.currentContext=hn.contexts;var nn="";if(hn.node.op==="Enter"&&I("isConstant",hn.node,rt,Me)&&(nn=Y(hn.node.name,Me)[0]),ve.indexOf(hn.node)===-1){var He=kr(hn.node,rt,Me);nn||(nn=Y(hn.node.name,Me)[0]);var Bn=Me.currentContext;He instanceof Promise?fn.push(He.then(function(Xn){return rt[nn]=Xn,Me.currentContext=Bn,mn.checkTensorForDisposal(nn,hn.node,rt,Me,tn,Sn,Rt),mn.processChildNodes(hn.node,ke,Me,rt,Ct,Zt),Xn})):(rt[nn]=He,Mt.checkTensorForDisposal(nn,hn.node,rt,Me,tn,Sn,Rt),Mt.processChildNodes(hn.node,ke,Me,rt,Ct,Zt))}else Mt.processChildNodes(hn.node,ke,Me,rt,Ct,Zt)},Mt=this;ke.length>0;)mt();return fn},Se.prototype.processChildNodes=function(ve,ke,Me,rt,Ct,tn){ve.children.forEach(function(Sn){var Rt=Y(Sn.name,Me)[0];!Ct[Rt]&&tn.has(Sn.name)&&(Sn.op==="Merge"?Sn.inputNames.some(function(Zt){return!!Q(Zt,rt,Me)})&&(Ct[Rt]=!0,ke.push({contexts:Me.currentContext,node:Sn})):Sn.inputNames.every(function(Zt){return!!Q(Zt,rt,Me)})&&(Ct[Rt]=!0,ke.push({contexts:Me.currentContext,node:Sn})))})},Se.prototype.dispose=function(){var ve=this;Object.keys(this.weightMap).forEach(function(ke){return ve.weightMap[ke].forEach(function(Me){return Me.dispose()})})},Se.prototype.checkInputShapeAndType=function(ve){var ke=this;Object.keys(ve).forEach(function(Me){var rt=ve[Me],Ct=ae(Me)[0],tn=ke.graph.nodes[Ct];if(tn.attrParams.shape&&tn.attrParams.shape.value){var Sn=tn.attrParams.shape.value,Rt=Sn.length===rt.shape.length&&rt.shape.every(function(Zt,mn){return Sn[mn]===-1||Sn[mn]===Zt});A.util.assert(Rt,function(){return"The shape of dict['"+tn.name+"'] provided in model.execute(dict) must be ["+Sn+"], but was ["+rt.shape+"]"})}tn.attrParams.dtype&&tn.attrParams.dtype.value&&A.util.assert(rt.dtype===tn.attrParams.dtype.value,function(){return"The dtype of dict['"+tn.name+"'] provided in model.execute(dict) must be "+tn.attrParams.dtype.value+", but was "+rt.dtype})})},Se.prototype.mapInputs=function(ve){var ke={};for(var Me in ve)this._signature!=null&&this._signature.inputs!=null&&this._signature.inputs[Me]!=null?ke[this._signature.inputs[Me].name]=ve[Me]:ke[Me]=ve[Me];return ke},Se.prototype.checkInputs=function(ve){var ke=this,Me=Object.keys(ve).filter(function(rt){var Ct=ae(rt)[0];return ke.graph.nodes[Ct]==null});if(Me.length>0)throw new Error("The dict provided in model.execute(dict) has keys: ["+Me+"] that are not part of graph")},Se.prototype.mapOutputs=function(ve){var ke=this;return ve.map(function(Me){return ke._signature!=null&&ke._signature.outputs!=null&&ke._signature.outputs[Me]!=null?ke._signature.outputs[Me].name:Me},{})},Se.prototype.checkOutputs=function(ve){var ke=this;ve.forEach(function(Me){var rt=ae(Me)[0];if(!ke.graph.nodes[rt])throw new Error("The output '"+Me+"' is not found in the graph")})},Se}(),qr="?tfjs-format=file",Kr="model.json",Tt=function(){function Se(ve,ke){ke===void 0&&(ke={}),this.modelUrl=ve,this.loadOptions=ke,this.version="n/a",ke==null&&(this.loadOptions={})}return Object.defineProperty(Se.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),Se.prototype.findIOHandler=function(){var ve=this.modelUrl;if(ve.load!=null)this.handler=ve;else if(this.loadOptions.requestInit!=null)this.handler=A.io.browserHTTPRequest(ve,this.loadOptions);else{var ke=A.io.getLoadHandlers(ve,this.loadOptions.onProgress);if(ke.length===0)ke.push(A.io.browserHTTPRequest(ve,this.loadOptions));else if(ke.length>1)throw new Error("Found more than one ("+ke.length+") load handlers for URL '"+[ve]+"'");this.handler=ke[0]}},Se.prototype.load=function(){return B(this,void 0,void 0,function(){var ve,ke,Me,rt;return D(this,function(Ct){switch(Ct.label){case 0:if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return ve=this,[4,this.handler.load()];case 1:return ve.artifacts=Ct.sent(),ke=this.artifacts.modelTopology,Me={},this.artifacts.userDefinedMetadata!=null&&(Me=this.artifacts.userDefinedMetadata.signature),this.version=ke.versions.producer+"."+ke.versions.minConsumer,rt=A.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs),this.executor=new Or(vt.Instance.transformGraph(ke,Me)),this.executor.weightMap=this.convertTensorMapToTensorsMap(rt),[2,!0]}})})},Se.prototype.save=function(ve,ke){return B(this,void 0,void 0,function(){var Me;return D(this,function(rt){if(typeof ve=="string"){if((Me=A.io.getSaveHandlers(ve)).length===0)throw new Error("Cannot find any save handlers for URL '"+ve+"'");if(Me.length>1)throw new Error("Found more than one ("+Me.length+") save handlers for URL '"+ve+"'");ve=Me[0]}if(ve.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[2,ve.save(this.artifacts)]})})},Se.prototype.predict=function(ve,ke){return this.execute(ve,this.outputNodes)},Se.prototype.normalizeInputs=function(ve){if(!(ve instanceof A.Tensor||Array.isArray(ve)))return ve;if((ve=Array.isArray(ve)?ve:[ve]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has "+this.inputNodes.length+" placeholders, while there are "+ve.length+" input tensors.");return this.inputNodes.reduce(function(ke,Me,rt){return ke[Me]=ve[rt],ke},{})},Se.prototype.normalizeOutputs=function(ve){return ve=ve||this.outputNodes,Array.isArray(ve)?ve:[ve]},Se.prototype.execute=function(ve,ke){ve=this.normalizeInputs(ve),ke=this.normalizeOutputs(ke);var Me=this.executor.execute(ve,ke);return Me.length>1?Me:Me[0]},Se.prototype.executeAsync=function(ve,ke){return B(this,void 0,void 0,function(){var Me;return D(this,function(rt){switch(rt.label){case 0:return ve=this.normalizeInputs(ve),ke=this.normalizeOutputs(ke),[4,this.executor.executeAsync(ve,ke)];case 1:return[2,(Me=rt.sent()).length>1?Me:Me[0]]}})})},Se.prototype.convertTensorMapToTensorsMap=function(ve){return Object.keys(ve).reduce(function(ke,Me){return ke[Me]=[ve[Me]],ke},{})},Se.prototype.dispose=function(){this.executor.dispose()},Se}();function Rr(Se,ve){return ve===void 0&&(ve={}),B(this,void 0,void 0,function(){var ke;return D(this,function(Me){switch(Me.label){case 0:if(Se==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return ve==null&&(ve={}),ve.fromTFHub&&Se.load==null&&(Se.endsWith("/")||(Se+="/"),Se=""+Se+Kr+qr),[4,(ke=new Tt(Se,ve)).load()];case 1:return Me.sent(),[2,ke]}})})}var Qt="1.7.4"}.call(this,r(92).Buffer)},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(103);function S(Y){for(var q=Y.length,ae=0,oe=0;q>0;)oe=Math.random()*q|0,ae=Y[--q],Y[q]=Y[oe],Y[oe]=ae}function E(Y,q){if(!Y)throw new Error(typeof q=="string"?q:q())}function A(Y,q,ae){if(q===void 0&&(q=[]),ae===void 0&&(ae=!1),q==null&&(q=[]),Array.isArray(Y)||W(Y)&&!ae)for(var oe=0;oe<Y.length;++oe)A(Y[oe],q,ae);else q.push(Y);return q}function U(Y,q){if(Y===q)return!0;if(Y==null||q==null||Y.length!==q.length)return!1;for(var ae=0;ae<Y.length;ae++)if(Y[ae]!==q[ae])return!1;return!0}function B(Y){return Y%1==0}function D(Y,q){var ae=q.length;return E((Y=Y==null?q.map(function(oe,ye){return ye}):[].concat(Y)).every(function(oe){return oe>=-ae&&oe<ae}),function(){return"All values in axis param must be in range [-"+ae+", "+ae+") but got axis "+Y}),E(Y.every(function(oe){return B(oe)}),function(){return"All values in axis param must be integers but got axis "+Y}),Y.map(function(oe){return oe<0?ae+oe:oe})}function R(Y,q){for(var ae=0;ae<Y.length;ae++){var oe=Y[ae];if(isNaN(oe)||!isFinite(oe))throw Error("A tensor of type "+q+" being uploaded contains "+oe+".")}}function W(Y){return Y instanceof Float32Array||Y instanceof Int32Array||Y instanceof Uint8Array}function j(Y){return typeof Y=="string"||Y instanceof String}function H(Y){return typeof Y=="boolean"}function I(Y){return typeof Y=="number"}function Q(Y,q){if(q==null||q==="float32"||q==="complex64")return new Float32Array(Y);if(q==="int32")return new Int32Array(Y);if(q==="bool")return new Uint8Array(Y);throw new Error("Unknown data type "+q)}a.shuffle=S,a.clamp=function(Y,q,ae){return Math.max(Y,Math.min(q,ae))},a.nearestLargerEven=function(Y){return Y%2==0?Y:Y+1},a.sum=function(Y){for(var q=0,ae=0;ae<Y.length;ae++)q+=Y[ae];return q},a.randUniform=function(Y,q){var ae=Math.random();return q*ae+(1-ae)*Y},a.distSquared=function(Y,q){for(var ae=0,oe=0;oe<Y.length;oe++){var ye=Number(Y[oe])-Number(q[oe]);ae+=ye*ye}return ae},a.assert=E,a.assertShapesMatch=function(Y,q,ae){ae===void 0&&(ae=""),E(U(Y,q),function(){return ae+" Shapes "+Y+" and "+q+" must match"})},a.assertNonNull=function(Y){E(Y!=null,function(){return"The input to the tensor constructor must be a non-null value."})},a.flatten=A,a.sizeFromShape=function(Y){if(Y.length===0)return 1;for(var q=Y[0],ae=1;ae<Y.length;ae++)q*=Y[ae];return q},a.isScalarShape=function(Y){return Y.length===0},a.arraysEqual=U,a.isInt=B,a.tanh=function(Y){if(Math.tanh!=null)return Math.tanh(Y);if(Y===1/0)return 1;if(Y===-1/0)return-1;var q=Math.exp(2*Y);return(q-1)/(q+1)},a.sizeToSquarishShape=function(Y){var q=Math.ceil(Math.sqrt(Y));return[q,Math.ceil(Y/q)]},a.createShuffledIndices=function(Y){for(var q=new Uint32Array(Y),ae=0;ae<Y;++ae)q[ae]=ae;return S(q),q},a.rightPad=function(Y,q){return q<=Y.length?Y:Y+" ".repeat(q-Y.length)},a.repeatedTry=function(Y,q,ae){return q===void 0&&(q=function(oe){return 0}),new Promise(function(oe,ye){var _e=0,pe=function(){if(Y())oe();else{var me=q(++_e);ae!=null&&_e>=ae?ye():setTimeout(pe,me)}};pe()})},a.inferFromImplicitShape=function(Y,q){for(var ae=1,oe=-1,ye=0;ye<Y.length;++ye)if(Y[ye]>=0)ae*=Y[ye];else if(Y[ye]===-1){if(oe!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+oe+" and dim "+ye);oe=ye}else if(Y[ye]<0)throw Error("Shapes can not be < 0. Found "+Y[ye]+" at dim "+ye);if(oe===-1){if(q>0&&q!==ae)throw Error("Size("+q+") must match the product of shape "+Y);return Y}if(ae===0)throw Error("Cannot infer the missing size in ["+Y+"] when there are 0 elements");if(q%ae!=0)throw Error("The implicit shape can't be a fractional number. Got "+q+" / "+ae);var _e=Y.slice();return _e[oe]=q/ae,_e},a.parseAxisParam=D,a.squeezeShape=function(Y,q){for(var ae=[],oe=[],ye=q!=null&&Array.isArray(q)&&q.length===0,_e=q==null||ye?null:D(q,Y).sort(),pe=0,me=0;me<Y.length;++me){if(_e!=null){if(_e[pe]===me&&Y[me]!==1)throw new Error("Can't squeeze axis "+me+" since its dim '"+Y[me]+"' is not 1");(_e[pe]==null||_e[pe]>me)&&Y[me]===1&&(ae.push(Y[me]),oe.push(me)),_e[pe]<=me&&pe++}Y[me]!==1&&(ae.push(Y[me]),oe.push(me))}return{newShape:ae,keptDims:oe}},a.getTypedArrayFromDType=function(Y,q){var ae=null;if(Y==null||Y==="float32")ae=new Float32Array(q);else if(Y==="int32")ae=new Int32Array(q);else{if(Y!=="bool")throw new Error("Unknown data type "+Y);ae=new Uint8Array(q)}return ae},a.getArrayFromDType=function(Y,q){var ae=null;if(Y==null||Y==="float32")ae=new Float32Array(q);else if(Y==="int32")ae=new Int32Array(q);else if(Y==="bool")ae=new Uint8Array(q);else{if(Y!=="string")throw new Error("Unknown data type "+Y);ae=new Array(q)}return ae},a.checkConversionForErrors=R,a.isValidDtype=function(Y){return Y==="bool"||Y==="complex64"||Y==="float32"||Y==="int32"||Y==="string"},a.hasEncodingLoss=function(Y,q){return!(q==="complex64"||q==="float32"&&Y!=="complex64"||q==="int32"&&Y!=="float32"&&Y!=="complex64"||q==="bool"&&Y==="bool")},a.isTypedArray=W,a.bytesPerElement=function(Y){if(Y==="float32"||Y==="int32")return 4;if(Y==="complex64")return 8;if(Y==="bool")return 1;throw new Error("Unknown dtype "+Y)},a.bytesFromStringArray=function(Y){if(Y==null)return 0;var q=0;return Y.forEach(function(ae){return q+=ae.length}),q},a.isString=j,a.isBoolean=H,a.isNumber=I,a.inferDtype=function Y(q){return Array.isArray(q)?Y(q[0]):q instanceof Float32Array?"float32":q instanceof Int32Array||q instanceof Uint8Array?"int32":I(q)?"float32":j(q)?"string":H(q)?"bool":"float32"},a.isFunction=function(Y){return!!(Y&&Y.constructor&&Y.call&&Y.apply)},a.nearestDivisor=function(Y,q){for(var ae=q;ae<Y;++ae)if(Y%ae==0)return ae;return Y},a.computeStrides=function(Y){var q=Y.length;if(q<2)return[];var ae=new Array(q-1);ae[q-2]=Y[q-1];for(var oe=q-3;oe>=0;--oe)ae[oe]=ae[oe+1]*Y[oe+1];return ae},a.toTypedArray=function(Y,q,ae){if(q==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(Y)&&(Y=A(Y)),ae&&R(Y,q),function(_e,pe){return _e instanceof Float32Array&&pe==="float32"||_e instanceof Int32Array&&pe==="int32"||_e instanceof Uint8Array&&pe==="bool"}(Y,q))return Y;if(q==null||q==="float32"||q==="complex64")return new Float32Array(Y);if(q==="int32")return new Int32Array(Y);if(q==="bool"){for(var oe=new Uint8Array(Y.length),ye=0;ye<oe.length;++ye)Math.round(Y[ye])!==0&&(oe[ye]=1);return oe}throw new Error("Unknown data type "+q)},a.toNestedArray=function(Y,q){if(Y.length===0)return q[0];var ae=Y.reduce(function(oe,ye){return oe*ye});if(ae===0)return[];if(ae!==q.length)throw new Error("["+Y+"] does not match the input size.");return function oe(ye,_e,pe){var me=new Array;if(_e.length===1)for(var Ge=_e[0],lt=0;lt<Ge;lt++)me[lt]=pe[ye+lt];else{Ge=_e[0];var It=_e.slice(1),wt=It.reduce(function(we,yt){return we*yt});for(lt=0;lt<Ge;lt++)me[lt]=oe(ye+lt*wt,It,pe)}return me}(0,Y,q)},a.makeOnesTypedArray=function(Y,q){for(var ae=Q(Y,q),oe=0;oe<ae.length;oe++)ae[oe]=1;return ae},a.makeZerosTypedArray=Q,a.now=function(){return c.env().platform.now()},a.assertNonNegativeIntegerDimensions=function(Y){Y.forEach(function(q){E(Number.isInteger(q)&&q>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+Y+"]."})})},a.fetch=function(Y,q){return c.env().platform.fetch(Y,q)},a.encodeString=function(Y,q){return q===void 0&&(q="utf-8"),q=q||"utf-8",c.env().platform.encode(Y,q)},a.decodeString=function(Y,q){return q===void 0&&(q="utf-8"),q=q||"utf-8",c.env().platform.decode(Y,q)},a.locToIndex=function(Y,q,ae){if(q===0)return 0;if(q===1)return Y[0];for(var oe=Y[Y.length-1],ye=0;ye<Y.length-1;++ye)oe+=ae[ye]*Y[ye];return oe},a.indexToLoc=function(Y,q,ae){if(q===0)return[];if(q===1)return[Y];for(var oe=new Array(q),ye=0;ye<oe.length-1;++ye)oe[ye]=Math.floor(Y/ae[ye]),Y-=oe[ye]*ae[ye];return oe[oe.length-1]=Y,oe}},function(s,a,r){var c=r(54),S=Math.min;s.exports=function(E){return E>0?S(c(E),9007199254740991):0}},function(s,a,r){var c=r(262),S=r(261),E=r(187),A=r(260);s.exports=function(U,B){return c(U)||S(U,B)||E(U,B)||A()},s.exports.__esModule=!0,s.exports.default=s.exports},function(s,a){var r=s.exports={version:"2.6.12"};typeof __e=="number"&&(__e=r)},function(s,a,r){(function(c,S){var E=this&&this.__awaiter||function(ae,oe,ye,_e){return new(ye||(ye=Promise))(function(pe,me){function Ge(wt){try{It(_e.next(wt))}catch(we){me(we)}}function lt(wt){try{It(_e.throw(wt))}catch(we){me(we)}}function It(wt){wt.done?pe(wt.value):new ye(function(we){we(wt.value)}).then(Ge,lt)}It((_e=_e.apply(ae,oe||[])).next())})},A=this&&this.__generator||function(ae,oe){var ye,_e,pe,me,Ge={label:0,sent:function(){if(1&pe[0])throw pe[1];return pe[1]},trys:[],ops:[]};return me={next:lt(0),throw:lt(1),return:lt(2)},typeof Symbol=="function"&&(me[Symbol.iterator]=function(){return this}),me;function lt(It){return function(wt){return function(we){if(ye)throw new TypeError("Generator is already executing.");for(;Ge;)try{if(ye=1,_e&&(pe=2&we[0]?_e.return:we[0]?_e.throw||((pe=_e.return)&&pe.call(_e),0):_e.next)&&!(pe=pe.call(_e,we[1])).done)return pe;switch(_e=0,pe&&(we=[2&we[0],pe.value]),we[0]){case 0:case 1:pe=we;break;case 4:return Ge.label++,{value:we[1],done:!1};case 5:Ge.label++,_e=we[1],we=[0];continue;case 7:we=Ge.ops.pop(),Ge.trys.pop();continue;default:if(!(pe=(pe=Ge.trys).length>0&&pe[pe.length-1])&&(we[0]===6||we[0]===2)){Ge=0;continue}if(we[0]===3&&(!pe||we[1]>pe[0]&&we[1]<pe[3])){Ge.label=we[1];break}if(we[0]===6&&Ge.label<pe[1]){Ge.label=pe[1],pe=we;break}if(pe&&Ge.label<pe[2]){Ge.label=pe[2],Ge.ops.push(we);break}pe[2]&&Ge.ops.pop(),Ge.trys.pop();continue}we=oe.call(ae,Ge)}catch(yt){we=[6,yt],_e=0}finally{ye=pe=0}if(5&we[0])throw we[1];return{value:we[0]?we[1]:void 0,done:!0}}([It,wt])}}};Object.defineProperty(a,"__esModule",{value:!0});var U,B=r(103),D=r(382),R=r(381),W=r(380),j=r(33),H=r(74),I=r(21),Q=r(21),Y=function(){function ae(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return ae.prototype.dispose=function(){for(var oe in this.registeredVariables)this.registeredVariables[oe].dispose()},ae}(),q=function(){function ae(oe){this.ENV=oe,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Y}return ae.prototype.ready=function(){return E(this,void 0,void 0,function(){var oe,ye,_e;return A(this,function(pe){switch(pe.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];oe=this.getSortedBackends(),ye=0,pe.label=1;case 1:return ye<oe.length?(_e=oe[ye],[4,this.initializeBackend(_e).success]):[3,5];case 2:return pe.sent()?[4,this.setBackend(_e)]:[3,4];case 3:return pe.sent(),[2];case 4:return ye++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(ae.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var oe=this.initializeBackendsAndReturnBest(),ye=oe.name;if(oe.asyncInit)throw new Error("The highest priority backend '"+ye+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(ye)}return this.backendInstance},enumerable:!0,configurable:!0}),ae.prototype.backendNames=function(){return Object.keys(this.registryFactory)},ae.prototype.findBackend=function(oe){return!(oe in this.registry)&&(!(oe in this.registryFactory)||this.initializeBackend(oe).asyncInit)?null:this.registry[oe]},ae.prototype.findBackendFactory=function(oe){return oe in this.registryFactory?this.registryFactory[oe].factory:null},ae.prototype.registerBackend=function(oe,ye,_e){return _e===void 0&&(_e=1),oe in this.registryFactory?(console.warn(oe+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[oe]={factory:ye,priority:_e},!0)},ae.prototype.setBackend=function(oe){return E(this,void 0,void 0,function(){var ye,_e,pe;return A(this,function(me){switch(me.label){case 0:if(this.registryFactory[oe]==null)throw new Error("Backend name '"+oe+"' not found in registry");return this.backendName=oe,this.registry[oe]!=null?[3,4]:(this.backendInstance=null,ye=this.initializeBackend(oe),_e=ye.success,ye.asyncInit?[4,_e]:[3,2]);case 1:return pe=me.sent(),[3,3];case 2:pe=_e,me.label=3;case 3:if(!pe)return[2,!1];me.label=4;case 4:return this.backendInstance=this.registry[oe],this.setupRegisteredKernels(),this.profiler=new R.Profiler(this.backendInstance),[2,!0]}})})},ae.prototype.setupRegisteredKernels=function(){var oe=this;D.getKernelsForBackend(this.backendName).forEach(function(ye){ye.setupFunc!=null&&ye.setupFunc(oe.backendInstance)})},ae.prototype.disposeRegisteredKernels=function(oe){var ye=this;D.getKernelsForBackend(oe).forEach(function(_e){_e.disposeFunc!=null&&_e.disposeFunc(ye.registry[oe])})},ae.prototype.initializeBackend=function(oe){var ye=this,_e=this.registryFactory[oe];if(_e==null)throw new Error("Cannot initialize backend "+oe+", no registration found.");try{var pe=_e.factory();if(Promise.resolve(pe)===pe){var me=++this.pendingBackendInitId,Ge=pe.then(function(lt){return!(me<ye.pendingBackendInitId)&&(ye.registry[oe]=lt,ye.pendingBackendInit=null,!0)}).catch(function(lt){return!(me<ye.pendingBackendInitId)&&(ye.pendingBackendInit=null,console.warn("Initialization of backend "+oe+" failed"),console.warn(lt.stack||lt.message),!1)});return this.pendingBackendInit=Ge,{success:Ge,asyncInit:!0}}return this.registry[oe]=pe,{success:!0,asyncInit:!1}}catch(lt){return console.warn("Initialization of backend "+oe+" failed"),console.warn(lt.stack||lt.message),{success:!1,asyncInit:!1}}},ae.prototype.removeBackend=function(oe){if(!(oe in this.registryFactory))throw new Error(oe+" backend not found in registry");this.backendName===oe&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,oe in this.registry&&(this.disposeRegisteredKernels(oe),this.registry[oe].dispose(),delete this.registry[oe]),delete this.registryFactory[oe],this.backendName===oe&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},ae.prototype.getSortedBackends=function(){var oe=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(ye,_e){return oe.registryFactory[_e].priority-oe.registryFactory[ye].priority})},ae.prototype.initializeBackendsAndReturnBest=function(){for(var oe=this.getSortedBackends(),ye=0;ye<oe.length;ye++){var _e=oe[ye],pe=this.initializeBackend(_e),me=pe.success,Ge=pe.asyncInit;if(Ge||me)return{name:_e,asyncInit:Ge}}throw new Error("Could not initialize any backends, all backend initializations failed.")},ae.prototype.moveData=function(oe,ye){var _e=this.state.tensorInfo.get(ye),pe=_e.backend,me=this.readSync(ye);pe.disposeData(ye),_e.backend=oe,oe.move(ye,me,_e.shape,_e.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},ae.prototype.tidy=function(oe,ye){var _e,pe=this,me=null;if(ye==null){if(typeof oe!="function")throw new Error("Please provide a function to tidy()");ye=oe}else{if(typeof oe!="string"&&!(oe instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof ye!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");me=oe}return this.scopedRun(function(){return pe.startScope(me)},function(){return pe.endScope(_e)},function(){return(_e=ye())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),_e})},ae.prototype.scopedRun=function(oe,ye,_e){oe();try{var pe=_e();return ye(),pe}catch(me){throw ye(),me}},ae.prototype.nextTensorId=function(){return ae.nextTensorId++},ae.prototype.nextVariableId=function(){return ae.nextVariableId++},ae.prototype.clone=function(oe){var ye=this.makeTensorFromDataId(oe.dataId,oe.shape,oe.dtype),_e={x:oe};return this.addTapeNode(this.state.activeScope.name,_e,[ye],function(pe){return{x:function(){return pe.toFloat()}}},[],{}),ye},ae.prototype.runKernel=function(oe,ye,_e,pe,me){return this.runKernelFunc(null,ye,null,oe,_e,pe,me)},ae.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},ae.prototype.checkKernelForMemLeak=function(oe,ye,_e){var pe=this.backend.numDataIds(),me=0;_e.forEach(function(It){me+=It.dtype==="complex64"?3:1});var Ge=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],lt=pe-ye-me-Ge;if(lt>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+lt+" data ids) after running '"+oe+"'")},ae.prototype.runKernelFunc=function(oe,ye,_e,pe,me,Ge,lt){var It,wt=this,we=[],yt=this.isTapeOn();pe==null&&(pe=this.state.activeScope!=null?this.state.activeScope.name:"");var Bt,Ot=this.state.numBytes,ze=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var Ut,Ft=D.getKernel(pe,this.backendName);if(Ft!=null)Bt=function(){var vt=wt.backend.numDataIds();Ut=Ft.kernelFunc({inputs:ye,attrs:me,backend:wt.backend});var rn=Array.isArray(Ut)?Ut:[Ut];wt.shouldCheckForMemLeaks()&&wt.checkKernelForMemLeak(pe,vt,rn);var xt=rn.map(function(sn){var kn=sn.dataId,an=sn.shape,Ve=sn.dtype;return wt.makeTensorFromDataId(kn,an,Ve)});if(yt){var _t=wt.getTensorsForGradient(pe,ye,xt);if(_t==null){lt==null&&(lt=[]);var Xt=xt.filter(function(sn,kn){return lt[kn]});_t=(Ge||[]).slice().concat(Xt)}we=wt.saveTensorsForBackwardMode(_t)}return xt};else{var pt=function(vt){yt&&(we=vt.map(function(rn){return wt.keep(wt.clone(rn))}))};Bt=function(){var vt=wt.backend.numDataIds();Ut=wt.tidy(function(){return oe(wt.backend,pt)});var rn=Array.isArray(Ut)?Ut:[Ut];return wt.shouldCheckForMemLeaks()&&wt.checkKernelForMemLeak(pe,vt,rn),rn}}return this.scopedRun(function(){return wt.state.kernelDepth++},function(){return wt.state.kernelDepth--},function(){It=wt.ENV.getBool("DEBUG")?wt.profiler.profileKernel(pe,ye,function(){return Bt()}):Bt()}),yt&&this.addTapeNode(pe,ye,It,_e,we,me),this.state.profiling&&this.state.activeProfile.kernels.push({name:pe,bytesAdded:this.state.numBytes-Ot,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-ze,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(ye).map(function(vt){return ye[vt].shape}),outputShapes:It.map(function(vt){return vt.shape})}),Array.isArray(Ut)?It:It[0]},ae.prototype.saveTensorsForBackwardMode=function(oe){var ye=this;return oe.map(function(_e){return ye.keep(ye.clone(_e))})},ae.prototype.getTensorsForGradient=function(oe,ye,_e){var pe=D.getGradient(oe);if(pe!=null){var me=pe.inputsToSave||[],Ge=pe.outputsToSave||[],lt=void 0;pe.saveAllInputs?(I.assert(Array.isArray(ye),function(){return"saveAllInputs is true, expected inputs to be an array."}),lt=Object.keys(ye).map(function(wt){return ye[wt]})):lt=me.map(function(wt){return ye[wt]});var It=_e.filter(function(wt,we){return Ge[we]});return lt.concat(It)}return null},ae.prototype.makeTensor=function(oe,ye,_e,pe){if(oe==null)throw new Error("Values passed to engine.makeTensor() are null");_e=_e||"float32",pe=pe||this.backend;var me=oe;_e==="string"&&I.isString(oe[0])&&(me=oe.map(function(we){return I.encodeString(we)}));var Ge=pe.write(me,ye,_e),lt=new j.Tensor(ye,_e,Ge,this.nextTensorId());if(this.incRef(lt,pe),_e==="string"){var It=this.state.tensorInfo.get(Ge),wt=Q.bytesFromStringArray(me);this.state.numBytes+=wt-It.bytes,It.bytes=wt}return lt},ae.prototype.makeTensorFromDataId=function(oe,ye,_e,pe){_e=_e||"float32";var me=new j.Tensor(ye,_e,oe,this.nextTensorId());return this.incRef(me,pe),me},ae.prototype.makeVariable=function(oe,ye,_e,pe){ye===void 0&&(ye=!0),_e=_e||this.nextVariableId().toString(),pe!=null&&pe!==oe.dtype&&(oe=oe.asType(pe));var me=new j.Variable(oe,ye,_e,this.nextTensorId());if(this.state.registeredVariables[me.name]!=null)throw new Error("Variable with name "+me.name+" was already registered");return this.state.registeredVariables[me.name]=me,this.incRef(me,this.backend),me},ae.prototype.incRef=function(oe,ye){var _e=this.state.tensorInfo.has(oe.dataId)?this.state.tensorInfo.get(oe.dataId).refCount:0;if(this.state.numTensors++,oe.dtype==="string"&&this.state.numStringTensors++,_e===0){this.state.numDataBuffers++;var pe=0;oe.dtype!=="complex64"&&oe.dtype!=="string"&&(pe=oe.size*I.bytesPerElement(oe.dtype)),this.state.tensorInfo.set(oe.dataId,{backend:ye||this.backend,dtype:oe.dtype,shape:oe.shape,bytes:pe,refCount:0}),this.state.numBytes+=pe}this.state.tensorInfo.get(oe.dataId).refCount++,oe instanceof j.Variable||this.track(oe)},ae.prototype.disposeTensor=function(oe){if(this.state.tensorInfo.has(oe.dataId)){this.state.numTensors--,oe.dtype==="string"&&this.state.numStringTensors--;var ye=this.state.tensorInfo.get(oe.dataId);ye.refCount<=1?(oe.dtype!=="complex64"&&(this.state.numBytes-=ye.bytes),this.state.numDataBuffers--,ye.backend.disposeData(oe.dataId),this.state.tensorInfo.delete(oe.dataId)):this.state.tensorInfo.get(oe.dataId).refCount--}},ae.prototype.disposeVariables=function(){for(var oe in this.state.registeredVariables){var ye=this.state.registeredVariables[oe];this.disposeVariable(ye)}},ae.prototype.disposeVariable=function(oe){this.disposeTensor(oe),this.state.registeredVariables[oe.name]!=null&&delete this.state.registeredVariables[oe.name]},ae.prototype.memory=function(){var oe=this.backend.memory();return oe.numTensors=this.state.numTensors,oe.numDataBuffers=this.state.numDataBuffers,oe.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(oe.unreliable=!0,oe.reasons==null&&(oe.reasons=[]),oe.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),oe},ae.prototype.profile=function(oe){return E(this,void 0,void 0,function(){var ye,_e;return A(this,function(pe){return this.state.profiling=!0,ye=this.state.numBytes,_e=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=oe(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(me){return me.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-ye,this.state.activeProfile.newTensors=this.state.numTensors-_e,[2,this.state.activeProfile]})})},ae.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},ae.prototype.addTapeNode=function(oe,ye,_e,pe,me,Ge){var lt=this,It={id:this.state.nextTapeNodeId++,kernelName:oe,inputs:ye,outputs:_e,saved:me},wt=D.getGradient(oe);wt!=null&&(pe=wt.gradFunc),pe!=null&&(It.gradient=function(we){return we=we.map(function(yt,Bt){if(yt==null){var Ot=_e[Bt],ze=I.makeZerosTypedArray(Ot.size,Ot.dtype);return lt.makeTensor(ze,Ot.shape,Ot.dtype)}return yt}),pe(we.length>1?we:we[0],me,Ge)}),this.state.activeTape.push(It)},ae.prototype.keep=function(oe){return oe.kept=!0,oe},ae.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},ae.prototype.endTape=function(){this.state.gradientDepth--},ae.prototype.startScope=function(oe){var ye={track:[],name:"unnamed scope",id:this.state.nextScopeId++};oe&&(ye.name=oe),this.state.scopeStack.push(ye),this.state.activeScope=ye},ae.prototype.endScope=function(oe){for(var ye=this,_e=H.getTensorsInContainer(oe),pe=new Set(_e.map(function(It){return It.id})),me=0;me<this.state.activeScope.track.length;me++){var Ge=this.state.activeScope.track[me];Ge.kept||pe.has(Ge.id)||Ge.dispose()}var lt=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],_e.forEach(function(It){It.kept||It.scopeId!==lt.id||ye.track(It)})},ae.prototype.gradients=function(oe,ye,_e,pe){var me=this;if(pe===void 0&&(pe=!1),I.assert(ye.length>0,function(){return"gradients() received an empty list of xs."}),_e!=null&&_e.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+_e.dtype+"'");var Ge=this.scopedRun(function(){return me.startTape()},function(){return me.endTape()},function(){return me.tidy("forward",oe)});I.assert(Ge instanceof j.Tensor,function(){return"The result y returned by f() must be a tensor."});var lt=W.getFilteredNodesXToY(this.state.activeTape,ye,Ge);if(!pe&&lt.length===0&&ye.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var It={};It[Ge.id]=_e??function(we){var yt=Q.makeOnesTypedArray(Q.sizeFromShape(we),"float32");return a.ENGINE.makeTensor(yt,we,"float32")}(Ge.shape),W.backpropagateGradients(It,lt,function(we){return me.tidy(we)});var wt=ye.map(function(we){return It[we.id]});return me.state.gradientDepth===0&&(me.state.activeTape.forEach(function(we){for(var yt=0,Bt=we.saved;yt<Bt.length;yt++)Bt[yt].dispose()}),me.state.activeTape=null),{value:Ge,grads:wt}})},ae.prototype.customGrad=function(oe){var ye=this;return I.assert(I.isFunction(oe),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var _e,pe=[],me=0;me<arguments.length;me++)pe[me]=arguments[me];I.assert(pe.every(function(lt){return lt instanceof j.Tensor}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var Ge={};return pe.forEach(function(lt,It){Ge[It]=lt}),ye.runKernelFunc(function(lt,It){return _e=oe.apply(void 0,pe.concat([It])),I.assert(_e.value instanceof j.Tensor,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),I.assert(I.isFunction(_e.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),_e.value},Ge,function(lt,It){var wt=_e.gradFunc(lt,It),we=Array.isArray(wt)?wt:[wt];I.assert(we.length===pe.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),I.assert(we.every(function(Bt){return Bt instanceof j.Tensor}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var yt={};return we.forEach(function(Bt,Ot){yt[Ot]=function(){return Bt}}),yt})}},ae.prototype.readSync=function(oe){return this.state.tensorInfo.get(oe).backend.readSync(oe)},ae.prototype.read=function(oe){return this.state.tensorInfo.get(oe).backend.read(oe)},ae.prototype.time=function(oe){return E(this,void 0,void 0,function(){var ye,_e;return A(this,function(pe){switch(pe.label){case 0:return ye=Q.now(),[4,this.backend.time(oe)];case 1:return(_e=pe.sent()).wallMs=Q.now()-ye,[2,_e]}})})},ae.prototype.track=function(oe){return this.state.activeScope!=null&&(oe.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(oe)),oe},Object.defineProperty(ae.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),ae.prototype.reset=function(){for(var oe in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Y,this.registry)this.disposeRegisteredKernels(oe),this.registry[oe].dispose(),delete this.registry[oe];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},ae.nextTensorId=0,ae.nextVariableId=0,ae}();a.Engine=q,a.ENGINE=function(){var ae=function(){if(U==null){var ye=void 0;if(typeof window<"u")ye=window;else if(c!==void 0)ye=c;else if(S!==void 0)ye=S;else{if(typeof self>"u")throw new Error("Could not find a global object");ye=self}U=ye}return U}();if(ae._tfengine==null){var oe=new B.Environment(ae);ae._tfengine=new q(oe)}return B.setEnvironmentGlobal(ae._tfengine.ENV),j.setTensorTracker(function(){return ae._tfengine}),ae._tfengine}()}).call(this,r(59),r(75))},function(s,a,r){var c=r(14),S=r(240),E=r(66),A=Object.defineProperty;a.f=r(27)?Object.defineProperty:function(U,B,D){if(c(U),B=E(B,!0),c(D),S)try{return A(U,B,D)}catch{}if("get"in D||"set"in D)throw TypeError("Accessors not supported!");return"value"in D&&(U[B]=D.value),U}},function(s,a,r){s.exports=!r(15)(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7})},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(25);a.op=function(S){var E=Object.keys(S);if(E.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+E.length+" keys.");var A=E[0],U=S[A];A.endsWith("_")&&(A=A.substring(0,A.length-1));var B=function(){for(var D=[],R=0;R<arguments.length;R++)D[R]=arguments[R];c.ENGINE.startScope(A);try{var W=U.apply(void 0,D);return W instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),c.ENGINE.endScope(W),W}catch(j){throw c.ENGINE.endScope(null),j}};return Object.defineProperty(B,"name",{value:A,configurable:!0}),B}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(25),S=r(103),E=r(33),A=r(21);function U(R,W){var j=R;if(A.isTypedArray(R))return W==="string"?[]:[R.length];if(!Array.isArray(R))return[];for(var H=[];Array.isArray(j)||A.isTypedArray(j)&&W!=="string";)H.push(j.length),j=j[0];return Array.isArray(R)&&S.env().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function I(Q,Y,q){if(q=q||[],!Array.isArray(Q)&&!A.isTypedArray(Q))return void A.assert(Y.length===0,function(){return"Element arr["+q.join("][")+"] is a primitive, but should be an array/TypedArray of "+Y[0]+" elements"});A.assert(Y.length>0,function(){return"Element arr["+q.join("][")+"] should be a primitive, but is an array of "+Q.length+" elements"}),A.assert(Q.length===Y[0],function(){return"Element arr["+q.join("][")+"] should have "+Y[0]+" elements, but has "+Q.length+" elements"});for(var ae=Y.slice(1),oe=0;oe<Q.length;++oe)I(Q[oe],ae,q.concat(oe))}(R,H,[]),H}function B(R,W,j,H){if(R!=null&&(R!=="numeric"&&R!==W||R==="numeric"&&W==="string"))throw new Error("Argument '"+j+"' passed to '"+H+"' must be "+R+" tensor, but got "+W+" tensor")}function D(R,W,j,H){if(H===void 0&&(H="numeric"),R instanceof E.Tensor)return B(H,R.dtype,W,j),R;var I=A.inferDtype(R);if(I!=="string"&&["bool","int32","float32"].indexOf(H)>=0&&(I=H),B(H,I,W,j),R==null||!A.isTypedArray(R)&&!Array.isArray(R)&&typeof R!="number"&&typeof R!="boolean"&&typeof R!="string"){var Q=R==null?"null":R.constructor.name;throw new Error("Argument '"+W+"' passed to '"+j+"' must be a Tensor or TensorLike, but got '"+Q+"'")}var Y=U(R,I);A.isTypedArray(R)||Array.isArray(R)||(R=[R]);var q=I!=="string"?A.toTypedArray(R,I,S.env().getBool("DEBUG")):A.flatten(R,[],!0);return c.ENGINE.makeTensor(q,Y,I)}a.inferShape=U,a.convertToTensor=D,a.convertToTensorArray=function(R,W,j,H){if(H===void 0&&(H="numeric"),!Array.isArray(R))throw new Error("Argument "+W+" passed to "+j+" must be a `Tensor[]` or `TensorLike[]`");return R.map(function(I,Q){return D(I,W+"["+Q+"]",j)},H)}},function(s,a,r){var c=r(254),S=r(253),E=r(187),A=r(252);s.exports=function(U){return c(U)||S(U)||E(U)||A()},s.exports.__esModule=!0,s.exports.default=s.exports},function(s,a,r){r.d(a,"a",function(){return E});var c=new Date,S=new Date;function E(A,U,B,D){function R(W){return A(W=arguments.length===0?new Date:new Date(+W)),W}return R.floor=function(W){return A(W=new Date(+W)),W},R.ceil=function(W){return A(W=new Date(W-1)),U(W,1),A(W),W},R.round=function(W){var j=R(W),H=R.ceil(W);return W-j<H-W?j:H},R.offset=function(W,j){return U(W=new Date(+W),j==null?1:Math.floor(j)),W},R.range=function(W,j,H){var I,Q=[];if(W=R.ceil(W),H=H==null?1:Math.floor(H),!(W<j&&H>0))return Q;do Q.push(I=new Date(+W)),U(W,H),A(W);while(I<W&&W<j);return Q},R.filter=function(W){return E(function(j){if(j>=j)for(;A(j),!W(j);)j.setTime(j-1)},function(j,H){if(j>=j)if(H<0)for(;++H<=0;)for(;U(j,-1),!W(j););else for(;--H>=0;)for(;U(j,1),!W(j););})},B&&(R.count=function(W,j){return c.setTime(+W),S.setTime(+j),A(c),A(S),Math.floor(B(c,S))},R.every=function(W){return W=Math.floor(W),isFinite(W)&&W>0?W>1?R.filter(D?function(j){return D(j)%W==0}:function(j){return R.count(0,j)%W==0}):R:null}),R}},function(s,a,r){const c=r(116),{MAX_LENGTH:S,MAX_SAFE_INTEGER:E}=r(117),{re:A,t:U}=r(90),B=r(115),{compareIdentifiers:D}=r(146);class R{constructor(j,H){if(H=B(H),j instanceof R){if(j.loose===!!H.loose&&j.includePrerelease===!!H.includePrerelease)return j;j=j.version}else if(typeof j!="string")throw new TypeError(`Invalid Version: ${j}`);if(j.length>S)throw new TypeError(`version is longer than ${S} characters`);c("SemVer",j,H),this.options=H,this.loose=!!H.loose,this.includePrerelease=!!H.includePrerelease;const I=j.trim().match(H.loose?A[U.LOOSE]:A[U.FULL]);if(!I)throw new TypeError(`Invalid Version: ${j}`);if(this.raw=j,this.major=+I[1],this.minor=+I[2],this.patch=+I[3],this.major>E||this.major<0)throw new TypeError("Invalid major version");if(this.minor>E||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>E||this.patch<0)throw new TypeError("Invalid patch version");I[4]?this.prerelease=I[4].split(".").map(Q=>{if(/^[0-9]+$/.test(Q)){const Y=+Q;if(Y>=0&&Y<E)return Y}return Q}):this.prerelease=[],this.build=I[5]?I[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(j){if(c("SemVer.compare",this.version,this.options,j),!(j instanceof R)){if(typeof j=="string"&&j===this.version)return 0;j=new R(j,this.options)}return j.version===this.version?0:this.compareMain(j)||this.comparePre(j)}compareMain(j){return j instanceof R||(j=new R(j,this.options)),D(this.major,j.major)||D(this.minor,j.minor)||D(this.patch,j.patch)}comparePre(j){if(j instanceof R||(j=new R(j,this.options)),this.prerelease.length&&!j.prerelease.length)return-1;if(!this.prerelease.length&&j.prerelease.length)return 1;if(!this.prerelease.length&&!j.prerelease.length)return 0;let H=0;do{const I=this.prerelease[H],Q=j.prerelease[H];if(c("prerelease compare",H,I,Q),I===void 0&&Q===void 0)return 0;if(Q===void 0)return 1;if(I===void 0)return-1;if(I!==Q)return D(I,Q)}while(++H)}compareBuild(j){j instanceof R||(j=new R(j,this.options));let H=0;do{const I=this.build[H],Q=j.build[H];if(c("prerelease compare",H,I,Q),I===void 0&&Q===void 0)return 0;if(Q===void 0)return 1;if(I===void 0)return-1;if(I!==Q)return D(I,Q)}while(++H)}inc(j,H){switch(j){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",H);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",H);break;case"prepatch":this.prerelease.length=0,this.inc("patch",H),this.inc("pre",H);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",H),this.inc("pre",H);break;case"major":this.minor===0&&this.patch===0&&this.prerelease.length!==0||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":this.patch===0&&this.prerelease.length!==0||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let I=this.prerelease.length;for(;--I>=0;)typeof this.prerelease[I]=="number"&&(this.prerelease[I]++,I=-2);I===-1&&this.prerelease.push(0)}H&&(this.prerelease[0]===H?isNaN(this.prerelease[1])&&(this.prerelease=[H,0]):this.prerelease=[H,0]);break;default:throw new Error(`invalid increment argument: ${j}`)}return this.format(),this.raw=this.version,this}}s.exports=R},function(s,a,r){var c=this&&this.__extends||function(){var Q=function(Y,q){return(Q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ae,oe){ae.__proto__=oe}||function(ae,oe){for(var ye in oe)oe.hasOwnProperty(ye)&&(ae[ye]=oe[ye])})(Y,q)};return function(Y,q){function ae(){this.constructor=Y}Q(Y,q),Y.prototype=q===null?Object.create(q):(ae.prototype=q.prototype,new ae)}}(),S=this&&this.__awaiter||function(Q,Y,q,ae){return new(q||(q=Promise))(function(oe,ye){function _e(Ge){try{me(ae.next(Ge))}catch(lt){ye(lt)}}function pe(Ge){try{me(ae.throw(Ge))}catch(lt){ye(lt)}}function me(Ge){Ge.done?oe(Ge.value):new q(function(lt){lt(Ge.value)}).then(_e,pe)}me((ae=ae.apply(Q,Y||[])).next())})},E=this&&this.__generator||function(Q,Y){var q,ae,oe,ye,_e={label:0,sent:function(){if(1&oe[0])throw oe[1];return oe[1]},trys:[],ops:[]};return ye={next:pe(0),throw:pe(1),return:pe(2)},typeof Symbol=="function"&&(ye[Symbol.iterator]=function(){return this}),ye;function pe(me){return function(Ge){return function(lt){if(q)throw new TypeError("Generator is already executing.");for(;_e;)try{if(q=1,ae&&(oe=2&lt[0]?ae.return:lt[0]?ae.throw||((oe=ae.return)&&oe.call(ae),0):ae.next)&&!(oe=oe.call(ae,lt[1])).done)return oe;switch(ae=0,oe&&(lt=[2&lt[0],oe.value]),lt[0]){case 0:case 1:oe=lt;break;case 4:return _e.label++,{value:lt[1],done:!1};case 5:_e.label++,ae=lt[1],lt=[0];continue;case 7:lt=_e.ops.pop(),_e.trys.pop();continue;default:if(!(oe=(oe=_e.trys).length>0&&oe[oe.length-1])&&(lt[0]===6||lt[0]===2)){_e=0;continue}if(lt[0]===3&&(!oe||lt[1]>oe[0]&&lt[1]<oe[3])){_e.label=lt[1];break}if(lt[0]===6&&_e.label<oe[1]){_e.label=oe[1],oe=lt;break}if(oe&&_e.label<oe[2]){_e.label=oe[2],_e.ops.push(lt);break}oe[2]&&_e.ops.pop(),_e.trys.pop();continue}lt=Y.call(Q,_e)}catch(It){lt=[6,It],ae=0}finally{q=oe=0}if(5&lt[0])throw lt[1];return{value:lt[0]?lt[1]:void 0,done:!0}}([me,Ge])}}};Object.defineProperty(a,"__esModule",{value:!0});var A=r(379),U=r(21),B=r(21),D=function(){function Q(Y,q,ae){var oe=this;if(this.dtype=q,this.shape=Y.slice(),this.size=U.sizeFromShape(Y),ae!=null){var ye=ae.length;U.assert(ye===this.size,function(){return"Length of values '"+ye+"' does not match the size inferred by the shape '"+oe.size+"'."})}if(q==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=ae||U.getArrayFromDType(q,this.size),this.strides=B.computeStrides(Y)}return Q.prototype.set=function(Y){for(var q=this,ae=[],oe=1;oe<arguments.length;oe++)ae[oe-1]=arguments[oe];ae.length===0&&(ae=[0]),U.assert(ae.length===this.rank,function(){return"The number of provided coordinates ("+ae.length+") must match the rank ("+q.rank+")"});var ye=this.locToIndex(ae);this.values[ye]=Y},Q.prototype.get=function(){for(var Y=[],q=0;q<arguments.length;q++)Y[q]=arguments[q];Y.length===0&&(Y=[0]);for(var ae=0,oe=0,ye=Y;oe<ye.length;oe++){var _e=ye[oe];if(_e<0||_e>=this.shape[ae]){var pe="Requested out of range element at "+Y+".   Buffer shape="+this.shape;throw new Error(pe)}ae++}for(var me=Y[Y.length-1],Ge=0;Ge<Y.length-1;++Ge)me+=this.strides[Ge]*Y[Ge];return this.values[me]},Q.prototype.locToIndex=function(Y){if(this.rank===0)return 0;if(this.rank===1)return Y[0];for(var q=Y[Y.length-1],ae=0;ae<Y.length-1;++ae)q+=this.strides[ae]*Y[ae];return q},Q.prototype.indexToLoc=function(Y){if(this.rank===0)return[];if(this.rank===1)return[Y];for(var q=new Array(this.shape.length),ae=0;ae<q.length-1;++ae)q[ae]=Math.floor(Y/this.strides[ae]),Y-=q[ae]*this.strides[ae];return q[q.length-1]=Y,q},Object.defineProperty(Q.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),Q.prototype.toTensor=function(){return R().makeTensor(this.values,this.shape,this.dtype)},Q}();a.TensorBuffer=D;var R=null,W=null,j=null;a.setTensorTracker=function(Q){R=Q},a.setOpHandler=function(Q){W=Q},a.setDeprecationWarningFn=function(Q){j=Q};var H=function(){function Q(Y,q,ae,oe){this.kept=!1,this.isDisposedInternal=!1,this.shape=Y.slice(),this.dtype=q||"float32",this.size=U.sizeFromShape(Y),this.strides=B.computeStrides(Y),this.dataId=ae,this.id=oe,this.rankType=this.rank<5?this.rank.toString():"higher"}return Q.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},Q.prototype.asScalar=function(){return this.throwIfDisposed(),U.assert(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},Q.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},Q.prototype.as2D=function(Y,q){return this.throwIfDisposed(),this.reshape([Y,q])},Q.prototype.as3D=function(Y,q,ae){return this.throwIfDisposed(),this.reshape([Y,q,ae])},Q.prototype.as4D=function(Y,q,ae,oe){return this.throwIfDisposed(),this.reshape([Y,q,ae,oe])},Q.prototype.as5D=function(Y,q,ae,oe,ye){return this.throwIfDisposed(),this.reshape([Y,q,ae,oe,ye])},Q.prototype.asType=function(Y){return this.throwIfDisposed(),W.cast(this,Y)},Object.defineProperty(Q.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),Q.prototype.buffer=function(){return S(this,void 0,void 0,function(){var Y;return E(this,function(q){switch(q.label){case 0:return[4,this.data()];case 1:return Y=q.sent(),[2,W.buffer(this.shape,this.dtype,Y)]}})})},Q.prototype.bufferSync=function(){return W.buffer(this.shape,this.dtype,this.dataSync())},Q.prototype.array=function(){return S(this,void 0,void 0,function(){var Y;return E(this,function(q){switch(q.label){case 0:return[4,this.data()];case 1:return Y=q.sent(),[2,B.toNestedArray(this.shape,Y)]}})})},Q.prototype.arraySync=function(){return B.toNestedArray(this.shape,this.dataSync())},Q.prototype.data=function(){return S(this,void 0,void 0,function(){var Y,q;return E(this,function(ae){switch(ae.label){case 0:return this.throwIfDisposed(),Y=R().read(this.dataId),this.dtype!=="string"?[3,2]:[4,Y];case 1:q=ae.sent();try{return[2,q.map(function(oe){return U.decodeString(oe)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}ae.label=2;case 2:return[2,Y]}})})},Q.prototype.dataSync=function(){this.throwIfDisposed();var Y=R().readSync(this.dataId);if(this.dtype==="string")try{return Y.map(function(q){return U.decodeString(q)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return Y},Q.prototype.bytes=function(){return S(this,void 0,void 0,function(){var Y;return E(this,function(q){switch(q.label){case 0:return this.throwIfDisposed(),[4,R().read(this.dataId)];case 1:return Y=q.sent(),this.dtype==="string"?[2,Y]:[2,new Uint8Array(Y.buffer)]}})})},Q.prototype.dispose=function(){this.isDisposed||(R().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(Q.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),Q.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},Q.prototype.toFloat=function(){return this.asType("float32")},Q.prototype.toInt=function(){return this.asType("int32")},Q.prototype.toBool=function(){return this.asType("bool")},Q.prototype.print=function(Y){return Y===void 0&&(Y=!1),W.print(this,Y)},Q.prototype.reshape=function(Y){return this.throwIfDisposed(),W.reshape(this,Y)},Q.prototype.reshapeAs=function(Y){return this.throwIfDisposed(),this.reshape(Y.shape)},Q.prototype.expandDims=function(Y){return Y===void 0&&(Y=0),W.expandDims(this,Y)},Q.prototype.cumsum=function(Y,q,ae){return Y===void 0&&(Y=0),q===void 0&&(q=!1),ae===void 0&&(ae=!1),W.cumsum(this,Y,q,ae)},Q.prototype.squeeze=function(Y){return this.throwIfDisposed(),W.squeeze(this,Y)},Q.prototype.clone=function(){return this.throwIfDisposed(),W.clone(this)},Q.prototype.toString=function(Y){Y===void 0&&(Y=!1);var q=this.dataSync();return A.tensorToString(q,this.shape,this.dtype,Y)},Q.prototype.gather=function(Y,q){return q===void 0&&(q=0),this.throwIfDisposed(),W.gather(this,Y,q)},Q.prototype.matMul=function(Y,q,ae){return q===void 0&&(q=!1),ae===void 0&&(ae=!1),this.throwIfDisposed(),W.matMul(this,Y,q,ae)},Q.prototype.dot=function(Y){return this.throwIfDisposed(),W.dot(this,Y)},Q.prototype.norm=function(Y,q,ae){return Y===void 0&&(Y="euclidean"),q===void 0&&(q=null),ae===void 0&&(ae=!1),this.throwIfDisposed(),W.norm(this,Y,q,ae)},Q.prototype.slice=function(Y,q){return this.throwIfDisposed(),W.slice(this,Y,q)},Q.prototype.reverse=function(Y){return this.throwIfDisposed(),W.reverse(this,Y)},Q.prototype.concat=function(Y,q){return q===void 0&&(q=0),this.throwIfDisposed(),Y instanceof Q&&(Y=[Y]),W.concat([this].concat(Y),q)},Q.prototype.split=function(Y,q){return q===void 0&&(q=0),this.throwIfDisposed(),W.split(this,Y,q)},Q.prototype.stack=function(Y,q){return q===void 0&&(q=0),W.stack([this,Y],q)},Q.prototype.unstack=function(Y){return Y===void 0&&(Y=0),W.unstack(this,Y)},Q.prototype.batchNormalization=function(Y,q,ae,oe,ye){return ae===void 0&&(ae=.001),j("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(Y,q,ye,oe,ae)},Q.prototype.all=function(Y,q){return Y===void 0&&(Y=null),q===void 0&&(q=!1),this.throwIfDisposed(),W.all(this,Y,q)},Q.prototype.any=function(Y,q){return Y===void 0&&(Y=null),q===void 0&&(q=!1),this.throwIfDisposed(),W.any(this,Y,q)},Q.prototype.logSumExp=function(Y,q){return Y===void 0&&(Y=null),q===void 0&&(q=!1),this.throwIfDisposed(),W.logSumExp(this,Y,q)},Q.prototype.sum=function(Y,q){return Y===void 0&&(Y=null),q===void 0&&(q=!1),this.throwIfDisposed(),W.sum(this,Y,q)},Q.prototype.prod=function(Y,q){return Y===void 0&&(Y=null),q===void 0&&(q=!1),this.throwIfDisposed(),W.prod(this,Y,q)},Q.prototype.mean=function(Y,q){return Y===void 0&&(Y=null),q===void 0&&(q=!1),this.throwIfDisposed(),W.mean(this,Y,q)},Q.prototype.min=function(Y,q){return Y===void 0&&(Y=null),q===void 0&&(q=!1),this.throwIfDisposed(),W.min(this,Y,q)},Q.prototype.max=function(Y,q){return Y===void 0&&(Y=null),q===void 0&&(q=!1),this.throwIfDisposed(),W.max(this,Y,q)},Q.prototype.argMin=function(Y){return Y===void 0&&(Y=null),this.throwIfDisposed(),W.argMin(this,Y)},Q.prototype.argMax=function(Y){return Y===void 0&&(Y=null),this.throwIfDisposed(),W.argMax(this,Y)},Q.prototype.cast=function(Y){return this.throwIfDisposed(),W.cast(this,Y)},Q.prototype.addStrict=function(Y){return this.throwIfDisposed(),W.addStrict(this,Y)},Q.prototype.atan2=function(Y){return this.throwIfDisposed(),W.atan2(this,Y)},Q.prototype.sub=function(Y){return this.throwIfDisposed(),W.sub(this,Y)},Q.prototype.subStrict=function(Y){return this.throwIfDisposed(),W.subStrict(this,Y)},Q.prototype.pow=function(Y){return this.throwIfDisposed(),W.pow(this,Y)},Q.prototype.powStrict=function(Y){return this.throwIfDisposed(),W.powStrict(this,Y)},Q.prototype.mul=function(Y){return this.throwIfDisposed(),W.mul(this,Y)},Q.prototype.mulStrict=function(Y){return this.throwIfDisposed(),W.mulStrict(this,Y)},Q.prototype.floorDiv=function(Y){return this.throwIfDisposed(),W.floorDiv(this,Y)},Q.prototype.divStrict=function(Y){return this.throwIfDisposed(),W.divStrict(this,Y)},Q.prototype.minimum=function(Y){return this.throwIfDisposed(),W.minimum(this,Y)},Q.prototype.minimumStrict=function(Y){return this.throwIfDisposed(),W.minimumStrict(this,Y)},Q.prototype.maximum=function(Y){return this.throwIfDisposed(),W.maximum(this,Y)},Q.prototype.maximumStrict=function(Y){return this.throwIfDisposed(),W.maximumStrict(this,Y)},Q.prototype.mod=function(Y){return this.throwIfDisposed(),W.mod(this,Y)},Q.prototype.modStrict=function(Y){return this.throwIfDisposed(),W.modStrict(this,Y)},Q.prototype.squaredDifferenceStrict=function(Y){return this.throwIfDisposed(),W.squaredDifferenceStrict(this,Y)},Q.prototype.notEqual=function(Y){return this.throwIfDisposed(),W.notEqual(this,Y)},Q.prototype.notEqualStrict=function(Y){return this.throwIfDisposed(),W.notEqualStrict(this,Y)},Q.prototype.less=function(Y){return this.throwIfDisposed(),W.less(this,Y)},Q.prototype.lessStrict=function(Y){return this.throwIfDisposed(),W.lessStrict(this,Y)},Q.prototype.equal=function(Y){return this.throwIfDisposed(),W.equal(this,Y)},Q.prototype.equalStrict=function(Y){return this.throwIfDisposed(),W.equalStrict(this,Y)},Q.prototype.lessEqual=function(Y){return this.throwIfDisposed(),W.lessEqual(this,Y)},Q.prototype.lessEqualStrict=function(Y){return this.throwIfDisposed(),W.lessEqualStrict(this,Y)},Q.prototype.greater=function(Y){return this.throwIfDisposed(),W.greater(this,Y)},Q.prototype.greaterStrict=function(Y){return this.throwIfDisposed(),W.greaterStrict(this,Y)},Q.prototype.greaterEqual=function(Y){return this.throwIfDisposed(),W.greaterEqual(this,Y)},Q.prototype.greaterEqualStrict=function(Y){return this.throwIfDisposed(),W.greaterEqualStrict(this,Y)},Q.prototype.logicalAnd=function(Y){return this.throwIfDisposed(),W.logicalAnd(this,Y)},Q.prototype.logicalOr=function(Y){return this.throwIfDisposed(),W.logicalOr(this,Y)},Q.prototype.logicalNot=function(){return this.throwIfDisposed(),W.logicalNot(this)},Q.prototype.logicalXor=function(Y){return this.throwIfDisposed(),W.logicalXor(this,Y)},Q.prototype.where=function(Y,q){return this.throwIfDisposed(),W.where(Y,this,q)},Q.prototype.neg=function(){return this.throwIfDisposed(),W.neg(this)},Q.prototype.ceil=function(){return this.throwIfDisposed(),W.ceil(this)},Q.prototype.floor=function(){return this.throwIfDisposed(),W.floor(this)},Q.prototype.sign=function(){return this.throwIfDisposed(),W.sign(this)},Q.prototype.isNaN=function(){return this.throwIfDisposed(),W.isNaN(this)},Q.prototype.isInf=function(){return this.throwIfDisposed(),W.isInf(this)},Q.prototype.isFinite=function(){return this.throwIfDisposed(),W.isFinite(this)},Q.prototype.exp=function(){return this.throwIfDisposed(),W.exp(this)},Q.prototype.expm1=function(){return this.throwIfDisposed(),W.expm1(this)},Q.prototype.log=function(){return this.throwIfDisposed(),W.log(this)},Q.prototype.log1p=function(){return this.throwIfDisposed(),W.log1p(this)},Q.prototype.sqrt=function(){return this.throwIfDisposed(),W.sqrt(this)},Q.prototype.rsqrt=function(){return this.throwIfDisposed(),W.rsqrt(this)},Q.prototype.square=function(){return this.throwIfDisposed(),W.square(this)},Q.prototype.reciprocal=function(){return this.throwIfDisposed(),W.reciprocal(this)},Q.prototype.abs=function(){return this.throwIfDisposed(),W.abs(this)},Q.prototype.clipByValue=function(Y,q){return this.throwIfDisposed(),W.clipByValue(this,Y,q)},Q.prototype.relu=function(){return this.throwIfDisposed(),W.relu(this)},Q.prototype.relu6=function(){return this.throwIfDisposed(),W.relu6(this)},Q.prototype.elu=function(){return this.throwIfDisposed(),W.elu(this)},Q.prototype.selu=function(){return this.throwIfDisposed(),W.selu(this)},Q.prototype.leakyRelu=function(Y){return Y===void 0&&(Y=.2),this.throwIfDisposed(),W.leakyRelu(this,Y)},Q.prototype.prelu=function(Y){return this.throwIfDisposed(),W.prelu(this,Y)},Q.prototype.sigmoid=function(){return this.throwIfDisposed(),W.sigmoid(this)},Q.prototype.logSigmoid=function(){return this.throwIfDisposed(),W.logSigmoid(this)},Q.prototype.softplus=function(){return this.throwIfDisposed(),W.softplus(this)},Q.prototype.zerosLike=function(){return this.throwIfDisposed(),W.zerosLike(this)},Q.prototype.onesLike=function(){return this.throwIfDisposed(),W.onesLike(this)},Q.prototype.sin=function(){return this.throwIfDisposed(),W.sin(this)},Q.prototype.cos=function(){return this.throwIfDisposed(),W.cos(this)},Q.prototype.tan=function(){return this.throwIfDisposed(),W.tan(this)},Q.prototype.asin=function(){return this.throwIfDisposed(),W.asin(this)},Q.prototype.acos=function(){return this.throwIfDisposed(),W.acos(this)},Q.prototype.atan=function(){return this.throwIfDisposed(),W.atan(this)},Q.prototype.sinh=function(){return this.throwIfDisposed(),W.sinh(this)},Q.prototype.cosh=function(){return this.throwIfDisposed(),W.cosh(this)},Q.prototype.tanh=function(){return this.throwIfDisposed(),W.tanh(this)},Q.prototype.asinh=function(){return this.throwIfDisposed(),W.asinh(this)},Q.prototype.acosh=function(){return this.throwIfDisposed(),W.acosh(this)},Q.prototype.atanh=function(){return this.throwIfDisposed(),W.atanh(this)},Q.prototype.erf=function(){return this.throwIfDisposed(),W.erf(this)},Q.prototype.round=function(){return this.throwIfDisposed(),W.round(this)},Q.prototype.step=function(Y){return Y===void 0&&(Y=0),this.throwIfDisposed(),W.step(this,Y)},Q.prototype.softmax=function(Y){return Y===void 0&&(Y=-1),this.throwIfDisposed(),W.softmax(this,Y)},Q.prototype.logSoftmax=function(Y){return Y===void 0&&(Y=-1),this.throwIfDisposed(),W.logSoftmax(this,Y)},Q.prototype.resizeBilinear=function(Y,q){return q===void 0&&(q=!1),this.throwIfDisposed(),W.image.resizeBilinear(this,Y,q)},Q.prototype.resizeNearestNeighbor=function(Y,q){return q===void 0&&(q=!1),this.throwIfDisposed(),W.image.resizeNearestNeighbor(this,Y,q)},Q.prototype.conv1d=function(Y,q,ae,oe,ye,_e){return oe===void 0&&(oe="NWC"),ye===void 0&&(ye=1),this.throwIfDisposed(),W.conv1d(this,Y,q,ae,oe,ye,_e)},Q.prototype.conv2d=function(Y,q,ae,oe,ye,_e){return oe===void 0&&(oe="NHWC"),ye===void 0&&(ye=[1,1]),this.throwIfDisposed(),W.conv2d(this,Y,q,ae,oe,ye,_e)},Q.prototype.conv2dTranspose=function(Y,q,ae,oe,ye){return this.throwIfDisposed(),W.conv2dTranspose(this,Y,q,ae,oe,ye)},Q.prototype.depthwiseConv2D=function(Y,q,ae,oe,ye,_e){return oe===void 0&&(oe="NHWC"),ye===void 0&&(ye=[1,1]),this.throwIfDisposed(),W.depthwiseConv2d(this,Y,q,ae,oe,ye,_e)},Q.prototype.separableConv2d=function(Y,q,ae,oe,ye,_e){return ye===void 0&&(ye=[1,1]),_e===void 0&&(_e="NHWC"),this.throwIfDisposed(),W.separableConv2d(this,Y,q,ae,oe,ye,_e)},Q.prototype.avgPool=function(Y,q,ae,oe){return this.throwIfDisposed(),W.avgPool(this,Y,q,ae,oe)},Q.prototype.maxPool=function(Y,q,ae,oe){return this.throwIfDisposed(),W.maxPool(this,Y,q,ae,oe)},Q.prototype.localResponseNormalization=function(Y,q,ae,oe){return Y===void 0&&(Y=5),q===void 0&&(q=1),ae===void 0&&(ae=1),oe===void 0&&(oe=.5),W.localResponseNormalization(this,Y,q,ae,oe)},Q.prototype.pool=function(Y,q,ae,oe,ye){return this.throwIfDisposed(),W.pool(this,Y,q,ae,oe,ye)},Q.prototype.variable=function(Y,q,ae){return Y===void 0&&(Y=!0),this.throwIfDisposed(),R().makeVariable(this,Y,q,ae)},Q.prototype.unsortedSegmentSum=function(Y,q){return this.throwIfDisposed(),W.unsortedSegmentSum(this,Y,q)},Q.prototype.batchToSpaceND=function(Y,q){return this.throwIfDisposed(),W.batchToSpaceND(this,Y,q)},Q.prototype.spaceToBatchND=function(Y,q){return this.throwIfDisposed(),W.spaceToBatchND(this,Y,q)},Q.prototype.topk=function(Y,q){return Y===void 0&&(Y=1),q===void 0&&(q=!0),this.throwIfDisposed(),W.topk(this,Y,q)},Q.prototype.stridedSlice=function(Y,q,ae,oe,ye,_e,pe,me){return oe===void 0&&(oe=0),ye===void 0&&(ye=0),_e===void 0&&(_e=0),pe===void 0&&(pe=0),me===void 0&&(me=0),this.throwIfDisposed(),W.stridedSlice(this,Y,q,ae,oe,ye,_e,pe,me)},Q.prototype.depthToSpace=function(Y,q){return this.throwIfDisposed(),W.depthToSpace(this,Y,q)},Q.prototype.fft=function(){return this.throwIfDisposed(),W.spectral.fft(this)},Q.prototype.ifft=function(){return this.throwIfDisposed(),W.spectral.ifft(this)},Q.prototype.rfft=function(){return this.throwIfDisposed(),W.spectral.rfft(this)},Q.prototype.irfft=function(){return this.throwIfDisposed(),W.spectral.irfft(this)},Q}();a.Tensor=H,Object.defineProperty(H,Symbol.hasInstance,{value:function(Q){return!!Q&&Q.dataId!=null&&Q.shape!=null&&Q.dtype!=null}});var I=function(Q){function Y(q,ae,oe,ye){var _e=Q.call(this,q.shape,q.dtype,q.dataId,ye)||this;return _e.trainable=ae,_e.name=oe,_e}return c(Y,Q),Y.prototype.assign=function(q){if(q.dtype!==this.dtype)throw new Error("dtype of the new value ("+q.dtype+") and previous value ("+this.dtype+") must match");if(!U.arraysEqual(q.shape,this.shape))throw new Error("shape of the new value ("+q.shape+") and previous value ("+this.shape+") must match");R().disposeTensor(this),this.dataId=q.dataId,R().incRef(this,null)},Y.prototype.dispose=function(){R().disposeVariable(this),this.isDisposedInternal=!0},Y}(H);a.Variable=I,Object.defineProperty(I,Symbol.hasInstance,{value:function(Q){return Q instanceof H&&Q.assign!=null&&Q.assign instanceof Function}})},function(s,a,r){var c=r(61);s.exports=function(S){return Object(c(S))}},function(s,a){function r(c){return s.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(S){return S.__proto__||Object.getPrototypeOf(S)},s.exports.__esModule=!0,s.exports.default=s.exports,r(c)}s.exports=r,s.exports.__esModule=!0,s.exports.default=s.exports},function(s,a,r){var c=r(195),S=Object.prototype.toString;function E(W){return S.call(W)==="[object Array]"}function A(W){return W===void 0}function U(W){return W!==null&&typeof W=="object"}function B(W){if(S.call(W)!=="[object Object]")return!1;var j=Object.getPrototypeOf(W);return j===null||j===Object.prototype}function D(W){return S.call(W)==="[object Function]"}function R(W,j){if(W!=null)if(typeof W!="object"&&(W=[W]),E(W))for(var H=0,I=W.length;H<I;H++)j.call(null,W[H],H,W);else for(var Q in W)Object.prototype.hasOwnProperty.call(W,Q)&&j.call(null,W[Q],Q,W)}s.exports={isArray:E,isArrayBuffer:function(W){return S.call(W)==="[object ArrayBuffer]"},isBuffer:function(W){return W!==null&&!A(W)&&W.constructor!==null&&!A(W.constructor)&&typeof W.constructor.isBuffer=="function"&&W.constructor.isBuffer(W)},isFormData:function(W){return typeof FormData<"u"&&W instanceof FormData},isArrayBufferView:function(W){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(W):W&&W.buffer&&W.buffer instanceof ArrayBuffer},isString:function(W){return typeof W=="string"},isNumber:function(W){return typeof W=="number"},isObject:U,isPlainObject:B,isUndefined:A,isDate:function(W){return S.call(W)==="[object Date]"},isFile:function(W){return S.call(W)==="[object File]"},isBlob:function(W){return S.call(W)==="[object Blob]"},isFunction:D,isStream:function(W){return U(W)&&D(W.pipe)},isURLSearchParams:function(W){return typeof URLSearchParams<"u"&&W instanceof URLSearchParams},isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:R,merge:function W(){var j={};function H(Y,q){B(j[q])&&B(Y)?j[q]=W(j[q],Y):B(Y)?j[q]=W({},Y):E(Y)?j[q]=Y.slice():j[q]=Y}for(var I=0,Q=arguments.length;I<Q;I++)R(arguments[I],H);return j},extend:function(W,j,H){return R(j,function(I,Q){W[Q]=H&&typeof I=="function"?c(I,H):I}),W},trim:function(W){return W.trim?W.trim():W.replace(/^\s+|\s+$/g,"")},stripBOM:function(W){return W.charCodeAt(0)===65279&&(W=W.slice(1)),W}}},function(s,a,r){var c=r(8),S=r(15),E=r(61),A=/"/g,U=function(B,D,R,W){var j=String(E(B)),H="<"+D;return R!==""&&(H+=" "+R+'="'+String(W).replace(A,"&quot;")+'"'),H+">"+j+"</"+D+">"};s.exports=function(B,D){var R={};R[B]=D(U),c(c.P+c.F*S(function(){var W=""[B]('"');return W!==W.toLowerCase()||W.split('"').length>3}),"String",R)}},function(s,a,r){var c=r(16),S=r(42),E=r(43),A=r(84)("src"),U=r(576),B=(""+U).split("toString");r(24).inspectSource=function(D){return U.call(D)},(s.exports=function(D,R,W,j){var H=typeof W=="function";H&&(E(W,"name")||S(W,"name",R)),D[R]!==W&&(H&&(E(W,A)||S(W,A,D[R]?""+D[R]:B.join(String(R)))),D===c?D[R]=W:j?D[R]?D[R]=W:S(D,R,W):(delete D[R],S(D,R,W)))})(Function.prototype,"toString",function(){return typeof this=="function"&&this[A]||U.call(this)})},function(s,a,r){r.d(a,"b",function(){return A}),r.d(a,"a",function(){return U}),r.d(a,"c",function(){return R});var c=r(31),S=r(12);function E(H){return Object(c.a)(function(I){I.setUTCDate(I.getUTCDate()-(I.getUTCDay()+7-H)%7),I.setUTCHours(0,0,0,0)},function(I,Q){I.setUTCDate(I.getUTCDate()+7*Q)},function(I,Q){return(Q-I)/S.f})}var A=E(0),U=E(1),B=E(2),D=E(3),R=E(4),W=E(5),j=E(6);A.range,U.range,B.range,D.range,R.range,W.range,j.range},function(s,a,r){r.d(a,"b",function(){return A}),r.d(a,"a",function(){return U}),r.d(a,"c",function(){return R});var c=r(31),S=r(12);function E(H){return Object(c.a)(function(I){I.setDate(I.getDate()-(I.getDay()+7-H)%7),I.setHours(0,0,0,0)},function(I,Q){I.setDate(I.getDate()+7*Q)},function(I,Q){return(Q-I-(Q.getTimezoneOffset()-I.getTimezoneOffset())*S.c)/S.f})}var A=E(0),U=E(1),B=E(2),D=E(3),R=E(4),W=E(5),j=E(6);A.range,U.range,B.range,D.range,R.range,W.range,j.range},function(s,a,r){var c=r(107),S=r(61);s.exports=function(E){return c(S(E))}},function(s,a,r){var c=r(26),S=r(85);s.exports=r(27)?function(E,A,U){return c.f(E,A,S(1,U))}:function(E,A,U){return E[A]=U,E}},function(s,a){var r={}.hasOwnProperty;s.exports=function(c,S){return r.call(c,S)}},function(s,a,r){var c=r(45),S=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function E(an){if(!(Ve=S.exec(an)))throw new Error("invalid format: "+an);var Ve;return new A({fill:Ve[1],align:Ve[2],sign:Ve[3],symbol:Ve[4],zero:Ve[5],width:Ve[6],comma:Ve[7],precision:Ve[8]&&Ve[8].slice(1),trim:Ve[9],type:Ve[10]})}function A(an){this.fill=an.fill===void 0?" ":an.fill+"",this.align=an.align===void 0?">":an.align+"",this.sign=an.sign===void 0?"-":an.sign+"",this.symbol=an.symbol===void 0?"":an.symbol+"",this.zero=!!an.zero,this.width=an.width===void 0?void 0:+an.width,this.comma=!!an.comma,this.precision=an.precision===void 0?void 0:+an.precision,this.trim=!!an.trim,this.type=an.type===void 0?"":an.type+""}E.prototype=A.prototype,A.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,0|this.width))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};function U(an,Ve){if((Ye=(an=Ve?an.toExponential(Ve-1):an.toExponential()).indexOf("e"))<0)return null;var Ye,$e=an.slice(0,Ye);return[$e.length>1?$e[0]+$e.slice(2):$e,+an.slice(Ye+1)]}var B,D,R,W,j=function(an){return(an=U(Math.abs(an)))?an[1]:NaN},H=function(an,Ve){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(j(Ve)/3)))-j(Math.abs(an)))},I=function(an,Ve){return an=Math.abs(an),Ve=Math.abs(Ve)-an,Math.max(0,j(Ve)-j(an))+1},Q=function(an){return Math.max(0,-j(Math.abs(an)))},Y=function(an){e:for(var Ve,Ye=an.length,$e=1,ft=-1;$e<Ye;++$e)switch(an[$e]){case".":ft=Ve=$e;break;case"0":ft===0&&(ft=$e),Ve=$e;break;default:if(!+an[$e])break e;ft>0&&(ft=0)}return ft>0?an.slice(0,ft)+an.slice(Ve+1):an},q=function(an,Ve){var Ye=U(an,Ve);if(!Ye)return an+"";var $e=Ye[0],ft=Ye[1];return ft<0?"0."+new Array(-ft).join("0")+$e:$e.length>ft+1?$e.slice(0,ft+1)+"."+$e.slice(ft+1):$e+new Array(ft-$e.length+2).join("0")},ae={"%":(an,Ve)=>(100*an).toFixed(Ve),b:an=>Math.round(an).toString(2),c:an=>an+"",d:function(an){return Math.abs(an=Math.round(an))>=1e21?an.toLocaleString("en").replace(/,/g,""):an.toString(10)},e:(an,Ve)=>an.toExponential(Ve),f:(an,Ve)=>an.toFixed(Ve),g:(an,Ve)=>an.toPrecision(Ve),o:an=>Math.round(an).toString(8),p:(an,Ve)=>q(100*an,Ve),r:q,s:function(an,Ve){var Ye=U(an,Ve);if(!Ye)return an+"";var $e=Ye[0],ft=Ye[1],$t=ft-(B=3*Math.max(-8,Math.min(8,Math.floor(ft/3))))+1,Jt=$e.length;return $t===Jt?$e:$t>Jt?$e+new Array($t-Jt+1).join("0"):$t>0?$e.slice(0,$t)+"."+$e.slice($t):"0."+new Array(1-$t).join("0")+U(an,Math.max(0,Ve+$t-1))[0]},X:an=>Math.round(an).toString(16).toUpperCase(),x:an=>Math.round(an).toString(16)},oe=function(an){return an},ye=Array.prototype.map,_e=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"],pe=function(an){var Ve=an.grouping===void 0||an.thousands===void 0?oe:function(Ce,sr){return function(Mr,on){for(var Gt=Mr.length,Hn=[],Kt=0,Vt=Ce[0],en=0;Gt>0&&Vt>0&&(en+Vt+1>on&&(Vt=Math.max(1,on-en)),Hn.push(Mr.substring(Gt-=Vt,Gt+Vt)),!((en+=Vt+1)>on));)Vt=Ce[Kt=(Kt+1)%Ce.length];return Hn.reverse().join(sr)}}(ye.call(an.grouping,Number),an.thousands+""),Ye=an.currency===void 0?"":an.currency[0]+"",$e=an.currency===void 0?"":an.currency[1]+"",ft=an.decimal===void 0?".":an.decimal+"",$t=an.numerals===void 0?oe:function(Ce){return function(sr){return sr.replace(/[0-9]/g,function(Mr){return Ce[+Mr]})}}(ye.call(an.numerals,String)),Jt=an.percent===void 0?"%":an.percent+"",Pn=an.minus===void 0?"":an.minus+"",An=an.nan===void 0?"NaN":an.nan+"";function Qn(Ce){var sr=(Ce=E(Ce)).fill,Mr=Ce.align,on=Ce.sign,Gt=Ce.symbol,Hn=Ce.zero,Kt=Ce.width,Vt=Ce.comma,en=Ce.precision,Vn=Ce.trim,Dt=Ce.type;Dt==="n"?(Vt=!0,Dt="g"):ae[Dt]||(en===void 0&&(en=12),Vn=!0,Dt="g"),(Hn||sr==="0"&&Mr==="=")&&(Hn=!0,sr="0",Mr="=");var On=Gt==="$"?Ye:Gt==="#"&&/[boxX]/.test(Dt)?"0"+Dt.toLowerCase():"",or=Gt==="$"?$e:/[%p]/.test(Dt)?Jt:"",ar=ae[Dt],yr=/[defgprs%]/.test(Dt);function kr(dr){var oi,Ur,Xr,zn=On,ir=or;if(Dt==="c")ir=ar(dr)+ir,dr="";else{var Or=(dr=+dr)<0||1/dr<0;if(dr=isNaN(dr)?An:ar(Math.abs(dr),en),Vn&&(dr=Y(dr)),Or&&+dr==0&&on!=="+"&&(Or=!1),zn=(Or?on==="("?on:Pn:on==="-"||on==="("?"":on)+zn,ir=(Dt==="s"?_e[8+B/3]:"")+ir+(Or&&on==="("?")":""),yr){for(oi=-1,Ur=dr.length;++oi<Ur;)if(48>(Xr=dr.charCodeAt(oi))||Xr>57){ir=(Xr===46?ft+dr.slice(oi+1):dr.slice(oi))+ir,dr=dr.slice(0,oi);break}}}Vt&&!Hn&&(dr=Ve(dr,1/0));var qr=zn.length+dr.length+ir.length,Kr=qr<Kt?new Array(Kt-qr+1).join(sr):"";switch(Vt&&Hn&&(dr=Ve(Kr+dr,Kr.length?Kt-ir.length:1/0),Kr=""),Mr){case"<":dr=zn+dr+ir+Kr;break;case"=":dr=zn+Kr+dr+ir;break;case"^":dr=Kr.slice(0,qr=Kr.length>>1)+zn+dr+ir+Kr.slice(qr);break;default:dr=Kr+zn+dr+ir}return $t(dr)}return en=en===void 0?6:/[gprs]/.test(Dt)?Math.max(1,Math.min(21,en)):Math.max(0,Math.min(20,en)),kr.toString=function(){return Ce+""},kr}return{format:Qn,formatPrefix:function(Ce,sr){var Mr=Qn(((Ce=E(Ce)).type="f",Ce)),on=3*Math.max(-8,Math.min(8,Math.floor(j(sr)/3))),Gt=Math.pow(10,-on),Hn=_e[8+on/3];return function(Kt){return Mr(Gt*Kt)+Hn}}}};(function(an){D=pe(an),R=D.format,W=D.formatPrefix})({thousands:",",grouping:[3],currency:["$",""]});var me=r(11),Ge=r(1),lt=r(100),It=r(246);function wt(an){const Ve={};return Ye=>Ve[Ye]||(Ve[Ye]=an(Ye))}function we(an){const Ve=wt(an.format),Ye=an.formatPrefix;return{format:Ve,formatPrefix:Ye,formatFloat($e){const ft=E($e||",");if(ft.precision==null){switch(ft.precision=12,ft.type){case"%":ft.precision-=2;break;case"e":ft.precision-=1}return function($t,Jt){return Pn=>{const An=$t(Pn),Qn=An.indexOf(Jt);if(Qn<0)return An;let Ce=function(Mr,on){let Gt,Hn=Mr.lastIndexOf("e");if(Hn>0)return Hn;for(Hn=Mr.length;--Hn>on;)if((Gt=Mr.charCodeAt(Hn))>=48&&Gt<=57)return Hn+1}(An,Qn);const sr=Ce<An.length?An.slice(Ce):"";for(;--Ce>Qn;)if(An[Ce]!=="0"){++Ce;break}return An.slice(0,Ce)+sr}}(Ve(ft),Ve(".1f")(1)[1])}return Ve(ft)},formatSpan($e,ft,$t,Jt){Jt=E(Jt??",f");const Pn=Object(c.c)($e,ft,$t),An=Math.max(Math.abs($e),Math.abs(ft));let Qn;if(Jt.precision==null)switch(Jt.type){case"s":return isNaN(Qn=H(Pn,An))||(Jt.precision=Qn),Ye(Jt,An);case"":case"e":case"g":case"p":case"r":isNaN(Qn=I(Pn,An))||(Jt.precision=Qn-(Jt.type==="e"));break;case"f":case"%":isNaN(Qn=Q(Pn))||(Jt.precision=Qn-2*(Jt.type==="%"))}return Ve(Jt)}}}let yt,Bt;function Ot(){return yt=we({format:R,formatPrefix:W})}function ze(an){return we(pe(an))}function Ut(an){return arguments.length?yt=ze(an):yt}function Ft(an,Ve,Ye){Ye=Ye||{},Object(Ge.H)(Ye)||Object(Ge.o)("Invalid time multi-format specifier: ".concat(Ye));const $e=Ve(me.i),ft=Ve(me.f),$t=Ve(me.d),Jt=Ve(me.a),Pn=Ve(me.k),An=Ve(me.g),Qn=Ve(me.h),Ce=Ve(me.l),sr=an(Ye[me.e]||".%L"),Mr=an(Ye[me.i]||":%S"),on=an(Ye[me.f]||"%I:%M"),Gt=an(Ye[me.d]||"%I %p"),Hn=an(Ye[me.a]||Ye[me.b]||"%a %d"),Kt=an(Ye[me.k]||"%b %d"),Vt=an(Ye[me.g]||"%B"),en=an(Ye[me.h]||"%B"),Vn=an(Ye[me.l]||"%Y");return Dt=>($e(Dt)<Dt?sr:ft(Dt)<Dt?Mr:$t(Dt)<Dt?on:Jt(Dt)<Dt?Gt:An(Dt)<Dt?Pn(Dt)<Dt?Hn:Kt:Ce(Dt)<Dt?Qn(Dt)<Dt?Vt:en:Vn)(Dt)}function pt(an){const Ve=wt(an.format),Ye=wt(an.utcFormat);return{timeFormat:$e=>Object(Ge.J)($e)?Ve($e):Ft(Ve,me.p,$e),utcFormat:$e=>Object(Ge.J)($e)?Ye($e):Ft(Ye,me.v,$e),timeParse:wt(an.parse),utcParse:wt(an.utcParse)}}function vt(){return Bt=pt({format:lt.a,parse:lt.b,utcFormat:lt.c,utcParse:lt.d})}function rn(an){return pt(Object(It.a)(an))}function xt(an){return arguments.length?Bt=rn(an):Bt}r.d(a,"a",function(){return sn}),r.d(a,"b",function(){return Xt}),r.d(a,"c",function(){return Ut}),r.d(a,"d",function(){return kn}),r.d(a,"e",function(){return xt}),Ot(),vt();const _t=(an,Ve)=>Object(Ge.p)({},an,Ve);function Xt(an,Ve){const Ye=an?ze(an):Ut(),$e=Ve?rn(Ve):xt();return _t(Ye,$e)}function sn(an,Ve){const Ye=arguments.length;return Ye&&Ye!==2&&Object(Ge.o)("defaultLocale expects either zero or two arguments."),Ye?_t(Ut(an),xt(Ve)):_t(Ut(),xt())}function kn(){return Ot(),vt(),sn()}},function(s,a,r){r.d(a,"b",function(){return A}),r.d(a,"c",function(){return U});var c=Math.sqrt(50),S=Math.sqrt(10),E=Math.sqrt(2);function A(B,D,R){var W=(D-B)/Math.max(0,R),j=Math.floor(Math.log(W)/Math.LN10),H=W/Math.pow(10,j);return j>=0?(H>=c?10:H>=S?5:H>=E?2:1)*Math.pow(10,j):-Math.pow(10,-j)/(H>=c?10:H>=S?5:H>=E?2:1)}function U(B,D,R){var W=Math.abs(D-B)/Math.max(0,R),j=Math.pow(10,Math.floor(Math.log(W)/Math.LN10)),H=W/j;return H>=c?j*=10:H>=S?j*=5:H>=E&&(j*=2),D<B?-j:j}a.a=function(B,D,R){var W,j,H,I,Q=-1;if(R=+R,(B=+B)==(D=+D)&&R>0)return[B];if((W=D<B)&&(j=B,B=D,D=j),(I=A(B,D,R))===0||!isFinite(I))return[];if(I>0){let Y=Math.round(B/I),q=Math.round(D/I);for(Y*I<B&&++Y,q*I>D&&--q,H=new Array(j=q-Y+1);++Q<j;)H[Q]=(Y+Q)*I}else{I=-I;let Y=Math.round(B*I),q=Math.round(D*I);for(Y/I<B&&++Y,q/I>D&&--q,H=new Array(j=q-Y+1);++Q<j;)H[Q]=(Y+Q)/I}return W&&H.reverse(),H}},function(s,a,r){var c=this&&this.__awaiter||function(A,U,B,D){return new(B||(B=Promise))(function(R,W){function j(Q){try{I(D.next(Q))}catch(Y){W(Y)}}function H(Q){try{I(D.throw(Q))}catch(Y){W(Y)}}function I(Q){Q.done?R(Q.value):new B(function(Y){Y(Q.value)}).then(j,H)}I((D=D.apply(A,U||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0});const S=r(198),E=r(197);a.getDrawArea=function(A){if(A instanceof HTMLElement)return A;if(S.isSurface(A))return A.drawArea;if(S.isSurfaceInfo(A))return E.visor().surface({name:A.name,tab:A.tab,styles:A.styles}).drawArea;throw new Error("Not a drawable")},a.shallowEquals=function(A,U){const B=Object.getOwnPropertyNames(A),D=Object.getOwnPropertyNames(U);if(B.length!==D.length)return!1;for(let R=0;R<B.length;R++){const W=B[R];if(A[W]!==U[W])return!1}return!0},a.nextFrame=function(){return c(this,void 0,void 0,function*(){yield new Promise(A=>requestAnimationFrame(A))})}},function(s,a,r){class c{constructor(Bt,Ot){if(Ot=E(Ot),Bt instanceof c)return Bt.loose===!!Ot.loose&&Bt.includePrerelease===!!Ot.includePrerelease?Bt:new c(Bt.raw,Ot);if(Bt instanceof A)return this.raw=Bt.value,this.set=[[Bt]],this.format(),this;if(this.options=Ot,this.loose=!!Ot.loose,this.includePrerelease=!!Ot.includePrerelease,this.raw=Bt,this.set=Bt.split(/\s*\|\|\s*/).map(ze=>this.parseRange(ze.trim())).filter(ze=>ze.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${Bt}`);if(this.set.length>1){const ze=this.set[0];if(this.set=this.set.filter(Ut=>!I(Ut[0])),this.set.length===0)this.set=[ze];else if(this.set.length>1){for(const Ut of this.set)if(Ut.length===1&&Q(Ut[0])){this.set=[Ut];break}}}this.format()}format(){return this.range=this.set.map(Bt=>Bt.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(Bt){Bt=Bt.trim();const Ot=`parseRange:${Object.keys(this.options).join(",")}:${Bt}`,ze=S.get(Ot);if(ze)return ze;const Ut=this.options.loose,Ft=Ut?D[R.HYPHENRANGELOOSE]:D[R.HYPHENRANGE];Bt=Bt.replace(Ft,wt(this.options.includePrerelease)),U("hyphen replace",Bt),Bt=Bt.replace(D[R.COMPARATORTRIM],W),U("comparator trim",Bt,D[R.COMPARATORTRIM]),Bt=(Bt=(Bt=Bt.replace(D[R.TILDETRIM],j)).replace(D[R.CARETTRIM],H)).split(/\s+/).join(" ");const pt=Ut?D[R.COMPARATORLOOSE]:D[R.COMPARATOR],vt=Bt.split(" ").map(_t=>q(_t,this.options)).join(" ").split(/\s+/).map(_t=>It(_t,this.options)).filter(this.options.loose?_t=>!!_t.match(pt):()=>!0).map(_t=>new A(_t,this.options)),rn=(vt.length,new Map);for(const _t of vt){if(I(_t))return[_t];rn.set(_t.value,_t)}rn.size>1&&rn.has("")&&rn.delete("");const xt=[...rn.values()];return S.set(Ot,xt),xt}intersects(Bt,Ot){if(!(Bt instanceof c))throw new TypeError("a Range is required");return this.set.some(ze=>Y(ze,Ot)&&Bt.set.some(Ut=>Y(Ut,Ot)&&ze.every(Ft=>Ut.every(pt=>Ft.intersects(pt,Ot)))))}test(Bt){if(!Bt)return!1;if(typeof Bt=="string")try{Bt=new B(Bt,this.options)}catch{return!1}for(let Ot=0;Ot<this.set.length;Ot++)if(we(this.set[Ot],Bt,this.options))return!0;return!1}}s.exports=c;const S=new(r(335))({max:1e3}),E=r(115),A=r(113),U=r(116),B=r(32),{re:D,t:R,comparatorTrimReplace:W,tildeTrimReplace:j,caretTrimReplace:H}=r(90),I=yt=>yt.value==="<0.0.0-0",Q=yt=>yt.value==="",Y=(yt,Bt)=>{let Ot=!0;const ze=yt.slice();let Ut=ze.pop();for(;Ot&&ze.length;)Ot=ze.every(Ft=>Ut.intersects(Ft,Bt)),Ut=ze.pop();return Ot},q=(yt,Bt)=>(U("comp",yt,Bt),yt=_e(yt,Bt),U("caret",yt),yt=oe(yt,Bt),U("tildes",yt),yt=me(yt,Bt),U("xrange",yt),yt=lt(yt,Bt),U("stars",yt),yt),ae=yt=>!yt||yt.toLowerCase()==="x"||yt==="*",oe=(yt,Bt)=>yt.trim().split(/\s+/).map(Ot=>ye(Ot,Bt)).join(" "),ye=(yt,Bt)=>{const Ot=Bt.loose?D[R.TILDELOOSE]:D[R.TILDE];return yt.replace(Ot,(ze,Ut,Ft,pt,vt)=>{let rn;return U("tilde",yt,ze,Ut,Ft,pt,vt),ae(Ut)?rn="":ae(Ft)?rn=`>=${Ut}.0.0 <${+Ut+1}.0.0-0`:ae(pt)?rn=`>=${Ut}.${Ft}.0 <${Ut}.${+Ft+1}.0-0`:vt?(U("replaceTilde pr",vt),rn=`>=${Ut}.${Ft}.${pt}-${vt} <${Ut}.${+Ft+1}.0-0`):rn=`>=${Ut}.${Ft}.${pt} <${Ut}.${+Ft+1}.0-0`,U("tilde return",rn),rn})},_e=(yt,Bt)=>yt.trim().split(/\s+/).map(Ot=>pe(Ot,Bt)).join(" "),pe=(yt,Bt)=>{U("caret",yt,Bt);const Ot=Bt.loose?D[R.CARETLOOSE]:D[R.CARET],ze=Bt.includePrerelease?"-0":"";return yt.replace(Ot,(Ut,Ft,pt,vt,rn)=>{let xt;return U("caret",yt,Ut,Ft,pt,vt,rn),ae(Ft)?xt="":ae(pt)?xt=`>=${Ft}.0.0${ze} <${+Ft+1}.0.0-0`:ae(vt)?xt=Ft==="0"?`>=${Ft}.${pt}.0${ze} <${Ft}.${+pt+1}.0-0`:`>=${Ft}.${pt}.0${ze} <${+Ft+1}.0.0-0`:rn?(U("replaceCaret pr",rn),xt=Ft==="0"?pt==="0"?`>=${Ft}.${pt}.${vt}-${rn} <${Ft}.${pt}.${+vt+1}-0`:`>=${Ft}.${pt}.${vt}-${rn} <${Ft}.${+pt+1}.0-0`:`>=${Ft}.${pt}.${vt}-${rn} <${+Ft+1}.0.0-0`):(U("no pr"),xt=Ft==="0"?pt==="0"?`>=${Ft}.${pt}.${vt}${ze} <${Ft}.${pt}.${+vt+1}-0`:`>=${Ft}.${pt}.${vt}${ze} <${Ft}.${+pt+1}.0-0`:`>=${Ft}.${pt}.${vt} <${+Ft+1}.0.0-0`),U("caret return",xt),xt})},me=(yt,Bt)=>(U("replaceXRanges",yt,Bt),yt.split(/\s+/).map(Ot=>Ge(Ot,Bt)).join(" ")),Ge=(yt,Bt)=>{yt=yt.trim();const Ot=Bt.loose?D[R.XRANGELOOSE]:D[R.XRANGE];return yt.replace(Ot,(ze,Ut,Ft,pt,vt,rn)=>{U("xRange",yt,ze,Ut,Ft,pt,vt,rn);const xt=ae(Ft),_t=xt||ae(pt),Xt=_t||ae(vt),sn=Xt;return Ut==="="&&sn&&(Ut=""),rn=Bt.includePrerelease?"-0":"",xt?ze=Ut===">"||Ut==="<"?"<0.0.0-0":"*":Ut&&sn?(_t&&(pt=0),vt=0,Ut===">"?(Ut=">=",_t?(Ft=+Ft+1,pt=0,vt=0):(pt=+pt+1,vt=0)):Ut==="<="&&(Ut="<",_t?Ft=+Ft+1:pt=+pt+1),Ut==="<"&&(rn="-0"),ze=`${Ut+Ft}.${pt}.${vt}${rn}`):_t?ze=`>=${Ft}.0.0${rn} <${+Ft+1}.0.0-0`:Xt&&(ze=`>=${Ft}.${pt}.0${rn} <${Ft}.${+pt+1}.0-0`),U("xRange return",ze),ze})},lt=(yt,Bt)=>(U("replaceStars",yt,Bt),yt.trim().replace(D[R.STAR],"")),It=(yt,Bt)=>(U("replaceGTE0",yt,Bt),yt.trim().replace(D[Bt.includePrerelease?R.GTE0PRE:R.GTE0],"")),wt=yt=>(Bt,Ot,ze,Ut,Ft,pt,vt,rn,xt,_t,Xt,sn,kn)=>`${Ot=ae(ze)?"":ae(Ut)?`>=${ze}.0.0${yt?"-0":""}`:ae(Ft)?`>=${ze}.${Ut}.0${yt?"-0":""}`:pt?`>=${Ot}`:`>=${Ot}${yt?"-0":""}`} ${rn=ae(xt)?"":ae(_t)?`<${+xt+1}.0.0-0`:ae(Xt)?`<${xt}.${+_t+1}.0-0`:sn?`<=${xt}.${_t}.${Xt}-${sn}`:yt?`<${xt}.${_t}.${+Xt+1}-0`:`<=${rn}`}`.trim(),we=(yt,Bt,Ot)=>{for(let ze=0;ze<yt.length;ze++)if(!yt[ze].test(Bt))return!1;if(Bt.prerelease.length&&!Ot.includePrerelease){for(let ze=0;ze<yt.length;ze++)if(U(yt[ze].semver),yt[ze].semver!==A.ANY&&yt[ze].semver.prerelease.length>0){const Ut=yt[ze].semver;if(Ut.major===Bt.major&&Ut.minor===Bt.minor&&Ut.patch===Bt.patch)return!0}return!1}return!0}},function(s,a,r){const c=r(32);s.exports=(S,E,A)=>new c(S,A).compare(new c(E,A))},function(s,a,r){var c=r(15);s.exports=function(S,E){return!!S&&c(function(){E?S.call(null,function(){},1):S.call(null)})}},function(s,a,r){r.r(a);var c=function(pe,me){if((Ge=(pe=me?pe.toExponential(me-1):pe.toExponential()).indexOf("e"))<0)return null;var Ge,lt=pe.slice(0,Ge);return[lt.length>1?lt[0]+lt.slice(2):lt,+pe.slice(Ge+1)]},S=function(pe){return(pe=c(Math.abs(pe)))?pe[1]:NaN},E=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function A(pe){return new U(pe)}function U(pe){if(!(me=E.exec(pe)))throw new Error("invalid format: "+pe);var me;this.fill=me[1]||" ",this.align=me[2]||">",this.sign=me[3]||"-",this.symbol=me[4]||"",this.zero=!!me[5],this.width=me[6]&&+me[6],this.comma=!!me[7],this.precision=me[8]&&+me[8].slice(1),this.trim=!!me[9],this.type=me[10]||""}A.prototype=U.prototype,U.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width==null?"":Math.max(1,0|this.width))+(this.comma?",":"")+(this.precision==null?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var B,D,R,W,j=function(pe){e:for(var me,Ge=pe.length,lt=1,It=-1;lt<Ge;++lt)switch(pe[lt]){case".":It=me=lt;break;case"0":It===0&&(It=lt),me=lt;break;default:if(It>0){if(!+pe[lt])break e;It=0}}return It>0?pe.slice(0,It)+pe.slice(me+1):pe},H=function(pe,me){var Ge=c(pe,me);if(!Ge)return pe+"";var lt=Ge[0],It=Ge[1];return It<0?"0."+new Array(-It).join("0")+lt:lt.length>It+1?lt.slice(0,It+1)+"."+lt.slice(It+1):lt+new Array(It-lt.length+2).join("0")},I={"%":function(pe,me){return(100*pe).toFixed(me)},b:function(pe){return Math.round(pe).toString(2)},c:function(pe){return pe+""},d:function(pe){return Math.round(pe).toString(10)},e:function(pe,me){return pe.toExponential(me)},f:function(pe,me){return pe.toFixed(me)},g:function(pe,me){return pe.toPrecision(me)},o:function(pe){return Math.round(pe).toString(8)},p:function(pe,me){return H(100*pe,me)},r:H,s:function(pe,me){var Ge=c(pe,me);if(!Ge)return pe+"";var lt=Ge[0],It=Ge[1],wt=It-(B=3*Math.max(-8,Math.min(8,Math.floor(It/3))))+1,we=lt.length;return wt===we?lt:wt>we?lt+new Array(wt-we+1).join("0"):wt>0?lt.slice(0,wt)+"."+lt.slice(wt):"0."+new Array(1-wt).join("0")+c(pe,Math.max(0,me+wt-1))[0]},X:function(pe){return Math.round(pe).toString(16).toUpperCase()},x:function(pe){return Math.round(pe).toString(16)}},Q=function(pe){return pe},Y=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"],q=function(pe){var me=pe.grouping&&pe.thousands?function(yt,Bt){return function(Ot,ze){for(var Ut=Ot.length,Ft=[],pt=0,vt=yt[0],rn=0;Ut>0&&vt>0&&(rn+vt+1>ze&&(vt=Math.max(1,ze-rn)),Ft.push(Ot.substring(Ut-=vt,Ut+vt)),!((rn+=vt+1)>ze));)vt=yt[pt=(pt+1)%yt.length];return Ft.reverse().join(Bt)}}(pe.grouping,pe.thousands):Q,Ge=pe.currency,lt=pe.decimal,It=pe.numerals?function(yt){return function(Bt){return Bt.replace(/[0-9]/g,function(Ot){return yt[+Ot]})}}(pe.numerals):Q,wt=pe.percent||"%";function we(yt){var Bt=(yt=A(yt)).fill,Ot=yt.align,ze=yt.sign,Ut=yt.symbol,Ft=yt.zero,pt=yt.width,vt=yt.comma,rn=yt.precision,xt=yt.trim,_t=yt.type;_t==="n"?(vt=!0,_t="g"):I[_t]||(rn==null&&(rn=12),xt=!0,_t="g"),(Ft||Bt==="0"&&Ot==="=")&&(Ft=!0,Bt="0",Ot="=");var Xt=Ut==="$"?Ge[0]:Ut==="#"&&/[boxX]/.test(_t)?"0"+_t.toLowerCase():"",sn=Ut==="$"?Ge[1]:/[%p]/.test(_t)?wt:"",kn=I[_t],an=/[defgprs%]/.test(_t);function Ve(Ye){var $e,ft,$t,Jt=Xt,Pn=sn;if(_t==="c")Pn=kn(Ye)+Pn,Ye="";else{var An=(Ye=+Ye)<0;if(Ye=kn(Math.abs(Ye),rn),xt&&(Ye=j(Ye)),An&&+Ye==0&&(An=!1),Jt=(An?ze==="("?ze:"-":ze==="-"||ze==="("?"":ze)+Jt,Pn=(_t==="s"?Y[8+B/3]:"")+Pn+(An&&ze==="("?")":""),an){for($e=-1,ft=Ye.length;++$e<ft;)if(48>($t=Ye.charCodeAt($e))||$t>57){Pn=($t===46?lt+Ye.slice($e+1):Ye.slice($e))+Pn,Ye=Ye.slice(0,$e);break}}}vt&&!Ft&&(Ye=me(Ye,1/0));var Qn=Jt.length+Ye.length+Pn.length,Ce=Qn<pt?new Array(pt-Qn+1).join(Bt):"";switch(vt&&Ft&&(Ye=me(Ce+Ye,Ce.length?pt-Pn.length:1/0),Ce=""),Ot){case"<":Ye=Jt+Ye+Pn+Ce;break;case"=":Ye=Jt+Ce+Ye+Pn;break;case"^":Ye=Ce.slice(0,Qn=Ce.length>>1)+Jt+Ye+Pn+Ce.slice(Qn);break;default:Ye=Ce+Jt+Ye+Pn}return It(Ye)}return rn=rn==null?6:/[gprs]/.test(_t)?Math.max(1,Math.min(21,rn)):Math.max(0,Math.min(20,rn)),Ve.toString=function(){return yt+""},Ve}return{format:we,formatPrefix:function(yt,Bt){var Ot=we(((yt=A(yt)).type="f",yt)),ze=3*Math.max(-8,Math.min(8,Math.floor(S(Bt)/3))),Ut=Math.pow(10,-ze),Ft=Y[8+ze/3];return function(pt){return Ot(Ut*pt)+Ft}}}};function ae(pe){return D=q(pe),R=D.format,W=D.formatPrefix,D}ae({decimal:".",thousands:",",grouping:[3],currency:["$",""]});var oe=function(pe){return Math.max(0,-S(Math.abs(pe)))},ye=function(pe,me){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(S(me)/3)))-S(Math.abs(pe)))},_e=function(pe,me){return pe=Math.abs(pe),me=Math.abs(me)-pe,Math.max(0,S(me)-S(pe))+1};r.d(a,"formatDefaultLocale",function(){return ae}),r.d(a,"format",function(){return R}),r.d(a,"formatPrefix",function(){return W}),r.d(a,"formatLocale",function(){return q}),r.d(a,"formatSpecifier",function(){return A}),r.d(a,"precisionFixed",function(){return oe}),r.d(a,"precisionPrefix",function(){return ye}),r.d(a,"precisionRound",function(){return _e})},function(s,a,r){var c=r(56),S=r(107),E=r(34),A=r(22),U=r(224);s.exports=function(B,D){var R=B==1,W=B==2,j=B==3,H=B==4,I=B==6,Q=B==5||I,Y=D||U;return function(q,ae,oe){for(var ye,_e,pe=E(q),me=S(pe),Ge=c(ae,oe,3),lt=A(me.length),It=0,wt=R?Y(q,lt):W?Y(q,0):void 0;lt>It;It++)if((Q||It in me)&&(_e=Ge(ye=me[It],It,pe),B)){if(R)wt[It]=_e;else if(_e)switch(B){case 3:return!0;case 5:return ye;case 6:return It;case 2:wt.push(ye)}else if(H)return!1}return I?-1:j||H?H:wt}}},function(s,a,r){var c=r(8),S=r(24),E=r(15);s.exports=function(A,U){var B=(S.Object||{})[A]||Object[A],D={};D[A]=U(B),c(c.S+c.F*E(function(){B(1)}),"Object",D)}},function(s,a,r){var c=r(106),S=r(85),E=r(41),A=r(66),U=r(43),B=r(240),D=Object.getOwnPropertyDescriptor;a.f=r(27)?D:function(R,W){if(R=E(R),W=A(W,!0),B)try{return D(R,W)}catch{}if(U(R,W))return S(!c.f.call(R,W),R[W])}},function(s,a){var r=Math.ceil,c=Math.floor;s.exports=function(S){return isNaN(S=+S)?0:(S>0?c:r)(S)}},function(s,a){s.exports=function(r){if(typeof r!="function")throw TypeError(r+" is not a function!");return r}},function(s,a,r){var c=r(55);s.exports=function(S,E,A){if(c(S),E===void 0)return S;switch(A){case 1:return function(U){return S.call(E,U)};case 2:return function(U,B){return S.call(E,U,B)};case 3:return function(U,B,D){return S.call(E,U,B,D)}}return function(){return S.apply(E,arguments)}}},function(s,a,r){var c=r(7).default,S=r(258);s.exports=function(E,A){if(A&&(c(A)==="object"||typeof A=="function"))return A;if(A!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return S(E)},s.exports.__esModule=!0,s.exports.default=s.exports},function(s,a,r){var c=r(259);s.exports=function(S,E){if(typeof E!="function"&&E!==null)throw new TypeError("Super expression must either be null or a function");S.prototype=Object.create(E&&E.prototype,{constructor:{value:S,writable:!0,configurable:!0}}),Object.defineProperty(S,"prototype",{writable:!1}),E&&c(S,E)},s.exports.__esModule=!0,s.exports.default=s.exports},function(s,a){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch{typeof window=="object"&&(r=window)}s.exports=r},function(s,a,r){if(r(27)){var c=r(83),S=r(16),E=r(15),A=r(8),U=r(118),B=r(151),D=r(56),R=r(94),W=r(85),j=r(42),H=r(93),I=r(54),Q=r(22),Y=r(213),q=r(81),ae=r(66),oe=r(43),ye=r(105),_e=r(13),pe=r(34),me=r(159),Ge=r(80),lt=r(78),It=r(79).f,wt=r(157),we=r(84),yt=r(19),Bt=r(51),Ot=r(128),ze=r(104),Ut=r(155),Ft=r(96),pt=r(125),vt=r(95),rn=r(156),xt=r(222),_t=r(26),Xt=r(53),sn=_t.f,kn=Xt.f,an=S.RangeError,Ve=S.TypeError,Ye=S.Uint8Array,$e=Array.prototype,ft=B.ArrayBuffer,$t=B.DataView,Jt=Bt(0),Pn=Bt(2),An=Bt(3),Qn=Bt(4),Ce=Bt(5),sr=Bt(6),Mr=Ot(!0),on=Ot(!1),Gt=Ut.values,Hn=Ut.keys,Kt=Ut.entries,Vt=$e.lastIndexOf,en=$e.reduce,Vn=$e.reduceRight,Dt=$e.join,On=$e.sort,or=$e.slice,ar=$e.toString,yr=$e.toLocaleString,kr=yt("iterator"),dr=yt("toStringTag"),oi=we("typed_constructor"),Ur=we("def_constructor"),Xr=U.CONSTR,zn=U.TYPED,ir=U.VIEW,Or=Bt(1,function(nn,He){return Qt(ze(nn,nn[Ur]),He)}),qr=E(function(){return new Ye(new Uint16Array([1]).buffer)[0]===1}),Kr=!!Ye&&!!Ye.prototype.set&&E(function(){new Ye(1).set({})}),Tt=function(nn,He){var Bn=I(nn);if(Bn<0||Bn%He)throw an("Wrong offset!");return Bn},Rr=function(nn){if(_e(nn)&&zn in nn)return nn;throw Ve(nn+" is not a typed array!")},Qt=function(nn,He){if(!(_e(nn)&&oi in nn))throw Ve("It is not a typed array constructor!");return new nn(He)},Se=function(nn,He){return ve(ze(nn,nn[Ur]),He)},ve=function(nn,He){for(var Bn=0,Xn=He.length,Zn=Qt(nn,Xn);Xn>Bn;)Zn[Bn]=He[Bn++];return Zn},ke=function(nn,He,Bn){sn(nn,He,{get:function(){return this._d[Bn]}})},Me=function(nn){var He,Bn,Xn,Zn,lr,jr,Cr=pe(nn),xi=arguments.length,Ai=xi>1?arguments[1]:void 0,ni=Ai!==void 0,to=wt(Cr);if(to!=null&&!me(to)){for(jr=to.call(Cr),Xn=[],He=0;!(lr=jr.next()).done;He++)Xn.push(lr.value);Cr=Xn}for(ni&&xi>2&&(Ai=D(Ai,arguments[2],2)),He=0,Bn=Q(Cr.length),Zn=Qt(this,Bn);Bn>He;He++)Zn[He]=ni?Ai(Cr[He],He):Cr[He];return Zn},rt=function(){for(var nn=0,He=arguments.length,Bn=Qt(this,He);He>nn;)Bn[nn]=arguments[nn++];return Bn},Ct=!!Ye&&E(function(){yr.call(new Ye(1))}),tn=function(){return yr.apply(Ct?or.call(Rr(this)):Rr(this),arguments)},Sn={copyWithin:function(nn,He){return xt.call(Rr(this),nn,He,arguments.length>2?arguments[2]:void 0)},every:function(nn){return Qn(Rr(this),nn,arguments.length>1?arguments[1]:void 0)},fill:function(nn){return rn.apply(Rr(this),arguments)},filter:function(nn){return Se(this,Pn(Rr(this),nn,arguments.length>1?arguments[1]:void 0))},find:function(nn){return Ce(Rr(this),nn,arguments.length>1?arguments[1]:void 0)},findIndex:function(nn){return sr(Rr(this),nn,arguments.length>1?arguments[1]:void 0)},forEach:function(nn){Jt(Rr(this),nn,arguments.length>1?arguments[1]:void 0)},indexOf:function(nn){return on(Rr(this),nn,arguments.length>1?arguments[1]:void 0)},includes:function(nn){return Mr(Rr(this),nn,arguments.length>1?arguments[1]:void 0)},join:function(nn){return Dt.apply(Rr(this),arguments)},lastIndexOf:function(nn){return Vt.apply(Rr(this),arguments)},map:function(nn){return Or(Rr(this),nn,arguments.length>1?arguments[1]:void 0)},reduce:function(nn){return en.apply(Rr(this),arguments)},reduceRight:function(nn){return Vn.apply(Rr(this),arguments)},reverse:function(){for(var nn,He=Rr(this).length,Bn=Math.floor(He/2),Xn=0;Xn<Bn;)nn=this[Xn],this[Xn++]=this[--He],this[He]=nn;return this},some:function(nn){return An(Rr(this),nn,arguments.length>1?arguments[1]:void 0)},sort:function(nn){return On.call(Rr(this),nn)},subarray:function(nn,He){var Bn=Rr(this),Xn=Bn.length,Zn=q(nn,Xn);return new(ze(Bn,Bn[Ur]))(Bn.buffer,Bn.byteOffset+Zn*Bn.BYTES_PER_ELEMENT,Q((He===void 0?Xn:q(He,Xn))-Zn))}},Rt=function(nn,He){return Se(this,or.call(Rr(this),nn,He))},Zt=function(nn){Rr(this);var He=Tt(arguments[1],1),Bn=this.length,Xn=pe(nn),Zn=Q(Xn.length),lr=0;if(Zn+He>Bn)throw an("Wrong length!");for(;lr<Zn;)this[He+lr]=Xn[lr++]},mn={entries:function(){return Kt.call(Rr(this))},keys:function(){return Hn.call(Rr(this))},values:function(){return Gt.call(Rr(this))}},fn=function(nn,He){return _e(nn)&&nn[zn]&&typeof He!="symbol"&&He in nn&&String(+He)==String(He)},mt=function(nn,He){return fn(nn,He=ae(He,!0))?W(2,nn[He]):kn(nn,He)},Mt=function(nn,He,Bn){return!(fn(nn,He=ae(He,!0))&&_e(Bn)&&oe(Bn,"value"))||oe(Bn,"get")||oe(Bn,"set")||Bn.configurable||oe(Bn,"writable")&&!Bn.writable||oe(Bn,"enumerable")&&!Bn.enumerable?sn(nn,He,Bn):(nn[He]=Bn.value,nn)};Xr||(Xt.f=mt,_t.f=Mt),A(A.S+A.F*!Xr,"Object",{getOwnPropertyDescriptor:mt,defineProperty:Mt}),E(function(){ar.call({})})&&(ar=yr=function(){return Dt.call(this)});var hn=H({},Sn);H(hn,mn),j(hn,kr,mn.values),H(hn,{slice:Rt,set:Zt,constructor:function(){},toString:ar,toLocaleString:tn}),ke(hn,"buffer","b"),ke(hn,"byteOffset","o"),ke(hn,"byteLength","l"),ke(hn,"length","e"),sn(hn,dr,{get:function(){return this[zn]}}),s.exports=function(nn,He,Bn,Xn){var Zn=nn+((Xn=!!Xn)?"Clamped":"")+"Array",lr="get"+nn,jr="set"+nn,Cr=S[Zn],xi=Cr||{},Ai=Cr&&lt(Cr),ni=!Cr||!U.ABV,to={},yi=Cr&&Cr.prototype,ri=function(Ci,Wr){sn(Ci,Wr,{get:function(){return function(so,Wi){var no=so._d;return no.v[lr](Wi*He+no.o,qr)}(this,Wr)},set:function(so){return function(Wi,no,So){var _a=Wi._d;Xn&&(So=(So=Math.round(So))<0?0:So>255?255:255&So),_a.v[jr](no*He+_a.o,So,qr)}(this,Wr,so)},enumerable:!0})};ni?(Cr=Bn(function(Ci,Wr,so,Wi){R(Ci,Cr,Zn,"_d");var no,So,_a,Ds,Ch=0,ro=0;if(_e(Wr)){if(!(Wr instanceof ft||(Ds=ye(Wr))=="ArrayBuffer"||Ds=="SharedArrayBuffer"))return zn in Wr?ve(Cr,Wr):Me.call(Cr,Wr);no=Wr,ro=Tt(so,He);var Mc=Wr.byteLength;if(Wi===void 0){if(Mc%He||(So=Mc-ro)<0)throw an("Wrong length!")}else if((So=Q(Wi)*He)+ro>Mc)throw an("Wrong length!");_a=So/He}else _a=Y(Wr),no=new ft(So=_a*He);for(j(Ci,"_d",{b:no,o:ro,l:So,e:_a,v:new $t(no)});Ch<_a;)ri(Ci,Ch++)}),yi=Cr.prototype=Ge(hn),j(yi,"constructor",Cr)):E(function(){Cr(1)})&&E(function(){new Cr(-1)})&&pt(function(Ci){new Cr,new Cr(null),new Cr(1.5),new Cr(Ci)},!0)||(Cr=Bn(function(Ci,Wr,so,Wi){var no;return R(Ci,Cr,Zn),_e(Wr)?Wr instanceof ft||(no=ye(Wr))=="ArrayBuffer"||no=="SharedArrayBuffer"?Wi!==void 0?new xi(Wr,Tt(so,He),Wi):so!==void 0?new xi(Wr,Tt(so,He)):new xi(Wr):zn in Wr?ve(Cr,Wr):Me.call(Cr,Wr):new xi(Y(Wr))}),Jt(Ai!==Function.prototype?It(xi).concat(It(Ai)):It(xi),function(Ci){Ci in Cr||j(Cr,Ci,xi[Ci])}),Cr.prototype=yi,c||(yi.constructor=Cr));var Jr=yi[kr],Kn=!!Jr&&(Jr.name=="values"||Jr.name==null),pi=mn.values;j(Cr,oi,!0),j(yi,zn,Zn),j(yi,ir,!0),j(yi,Ur,Cr),(Xn?new Cr(1)[dr]==Zn:dr in yi)||sn(yi,dr,{get:function(){return Zn}}),to[Zn]=Cr,A(A.G+A.W+A.F*(Cr!=xi),to),A(A.S,Zn,{BYTES_PER_ELEMENT:He}),A(A.S+A.F*E(function(){xi.of.call(Cr,1)}),Zn,{from:Me,of:rt}),"BYTES_PER_ELEMENT"in yi||j(yi,"BYTES_PER_ELEMENT",He),A(A.P,Zn,Sn),vt(Zn),A(A.P+A.F*Kr,Zn,{set:Zt}),A(A.P+A.F*!Kn,Zn,mn),c||yi.toString==ar||(yi.toString=ar),A(A.P+A.F*E(function(){new Cr(1).slice()}),Zn,{slice:Rt}),A(A.P+A.F*(E(function(){return[1,2].toLocaleString()!=new Cr([1,2]).toLocaleString()})||!E(function(){yi.toLocaleString.call([1,2])})),Zn,{toLocaleString:tn}),Ft[Zn]=Kn?Jr:pi,c||Kn||j(yi,kr,pi)}}else s.exports=function(){}},function(s,a){s.exports=function(r){if(r==null)throw TypeError("Can't call method on  "+r);return r}},function(s,a){var r={}.toString;s.exports=function(c){return r.call(c).slice(8,-1)}},function(s,a,r){(function(c){r.d(a,"a",function(){return It}),r.d(a,"b",function(){return wt}),r.d(a,"c",function(){return oe}),r.d(a,"d",function(){return ye}),r.d(a,"e",function(){return Bt}),r.d(a,"f",function(){return yt}),r.d(a,"g",function(){return we}),r.d(a,"h",function(){return Y});var S=r(1),E=r(582),A=r(176),U=r(44);const B=/^(data:|([A-Za-z]+:)?\/\/)/,D=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,R=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,W="file://";async function j(){Object(S.o)("No file system access.")}async function H(){Object(S.o)("No HTTP fetch method available.")}const I=Ot=>Ot!=null&&Ot==Ot,Q=Ot=>!(Number.isNaN(+Ot)||Ot instanceof Date),Y={boolean:S.Ca,integer:S.Ea,number:S.Ea,date:S.Da,string:S.Ga,unknown:S.y},q=[Ot=>Ot==="true"||Ot==="false"||Ot===!0||Ot===!1,Ot=>Q(Ot)&&Number.isInteger(+Ot),Q,Ot=>!Number.isNaN(Date.parse(Ot))],ae=["boolean","integer","number","date"];function oe(Ot,ze){if(!Ot||!Ot.length)return"unknown";const Ut=Ot.length,Ft=q.length,pt=q.map((vt,rn)=>rn+1);for(let vt,rn,xt=0,_t=0;xt<Ut;++xt)for(rn=ze?Ot[xt][ze]:Ot[xt],vt=0;vt<Ft;++vt)if(pt[vt]&&I(rn)&&!q[vt](rn)&&(pt[vt]=0,++_t===q.length))return"string";return ae[pt.reduce((vt,rn)=>vt===0?rn:vt,0)-1]}function ye(Ot,ze){return ze.reduce((Ut,Ft)=>(Ut[Ft]=oe(Ot,Ft),Ut),{})}function _e(Ot){const ze=function(Ut,Ft){const pt={delimiter:Ot};return pe(Ut,Ft?Object(S.p)(Ft,pt):pt)};return ze.responseType="text",ze}function pe(Ot,ze){return ze.header&&(Ot=ze.header.map(S.Ba).join(ze.delimiter)+`
`+Ot),Object(E.a)(ze.delimiter).parse(Ot+"")}function me(Ot,ze){const Ut=ze&&ze.property?Object(S.u)(ze.property):S.y;return Object(S.H)(Ot)&&!function(Ft){return!(typeof c!="function"||!Object(S.E)(c.isBuffer))&&c.isBuffer(Ft)}(Ot)?function(Ft,pt){return!Object(S.B)(Ft)&&Object(S.F)(Ft)&&(Ft=[...Ft]),pt&&pt.copy?JSON.parse(JSON.stringify(Ft)):Ft}(Ut(Ot),ze):Ut(JSON.parse(Ot))}pe.responseType="text",me.responseType="json";const Ge={interior:(Ot,ze)=>Ot!==ze,exterior:(Ot,ze)=>Ot===ze};function lt(Ot,ze){let Ut,Ft,pt,vt;return Ot=me(Ot,ze),ze&&ze.feature?(Ut=A.a,pt=ze.feature):ze&&ze.mesh?(Ut=A.b,pt=ze.mesh,vt=Ge[ze.filter]):Object(S.o)("Missing TopoJSON feature or mesh parameter."),(Ft=(Ft=Ot.objects[pt])?Ut(Ot,Ft,vt):Object(S.o)("Invalid TopoJSON object: "+pt))&&Ft.features||[Ft]}lt.responseType="json";const It={dsv:pe,csv:_e(","),tsv:_e("	"),json:me,topojson:lt};function wt(Ot,ze){return arguments.length>1?(It[Ot]=ze,this):Object(S.w)(It,Ot)?It[Ot]:null}function we(Ot){const ze=wt(Ot);return ze&&ze.responseType||"text"}function yt(Ot,ze,Ut,Ft){const pt=wt((ze=ze||{}).type||"json");return pt||Object(S.o)("Unknown data format type: "+ze.type),Ot=pt(Ot,ze),ze.parse&&function(vt,rn,xt,_t){if(!vt.length)return;const Xt=Object(U.e)();xt=xt||Xt.timeParse,_t=_t||Xt.utcParse;let sn,kn,an,Ve,Ye,$e,ft=vt.columns||Object.keys(vt[0]);rn==="auto"&&(rn=ye(vt,ft));const $t=(ft=Object.keys(rn)).map(Jt=>{const Pn=rn[Jt];let An,Qn;if(Pn&&(Pn.startsWith("date:")||Pn.startsWith("utc:")))return An=Pn.split(/:(.+)?/,2),((Qn=An[1])[0]==="'"&&Qn[Qn.length-1]==="'"||Qn[0]==='"'&&Qn[Qn.length-1]==='"')&&(Qn=Qn.slice(1,-1)),(An[0]==="utc"?_t:xt)(Qn);if(!Y[Pn])throw Error("Illegal format pattern: "+Jt+":"+Pn);return Y[Pn]});for(an=0,Ye=vt.length,$e=ft.length;an<Ye;++an)for(sn=vt[an],Ve=0;Ve<$e;++Ve)kn=ft[Ve],sn[kn]=$t[Ve](sn[kn])}(Ot,ze.parse,Ut,Ft),Object(S.w)(Ot,"columns")&&delete Ot.columns,Ot}const Bt=function(Ot,ze){return Ut=>({options:Ut||{},sanitize:async function(Ft,pt){pt=Object(S.p)({},this.options,pt);const vt=this.fileAccess,rn={href:null};let xt,_t,Xt;const sn=D.test(Ft.replace(R,""));Ft!=null&&typeof Ft=="string"&&sn||Object(S.o)("Sanitize failure, invalid URI: "+Object(S.Ba)(Ft));const kn=B.test(Ft);return(Xt=pt.baseURL)&&!kn&&(Ft.startsWith("/")||Xt.endsWith("/")||(Ft="/"+Ft),Ft=Xt+Ft),_t=(xt=Ft.startsWith(W))||pt.mode==="file"||pt.mode!=="http"&&!kn&&vt,xt?Ft=Ft.slice(W.length):Ft.startsWith("//")&&(pt.defaultProtocol==="file"?(Ft=Ft.slice(2),_t=!0):Ft=(pt.defaultProtocol||"http")+":"+Ft),Object.defineProperty(rn,"localFile",{value:!!_t}),rn.href=Ft,pt.target&&(rn.target=pt.target+""),pt.rel&&(rn.rel=pt.rel+""),pt.context==="image"&&pt.crossOrigin&&(rn.crossOrigin=pt.crossOrigin+""),rn},load:async function(Ft,pt){const vt=await this.sanitize(Ft,pt),rn=vt.href;return vt.localFile?this.file(rn):this.http(rn,pt)},fileAccess:!!ze,file:function(Ft){return Ft?pt=>new Promise((vt,rn)=>{Ft.readFile(pt,(xt,_t)=>{xt?rn(xt):vt(_t)})}):j}(ze),http:function(Ft){return Ft?async function(pt,vt){const rn=Object(S.p)({},this.options.http,vt),xt=vt&&vt.response,_t=await Ft(pt,rn);return _t.ok?Object(S.E)(_t[xt])?_t[xt]():_t.text():Object(S.o)(_t.status+""+_t.statusText)}:H}(Ot)})}(typeof fetch<"u"&&fetch,null)}).call(this,r(92).Buffer)},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});const c=r(102),S=r(46),E={prepend:!1};a.subSurface=function(A,U,B={}){const D=S.getDrawArea(A),R=c.css({"& canvas":{display:"block"},marginTop:".5rem",marginBottom:".5rem"}),W=c.css({backgroundColor:"white",display:"inline-block",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",padding:"0 10px 0 10px",marginBottom:"20px",fontWeight:"600",textAlign:"left"}),j=Object.assign({},E,B);let H=D.querySelector(`div[data-name=${U}]`);if(!H){if((H=document.createElement("div")).setAttribute("class",`${R}`),H.dataset.name=U,j.title){const I=document.createElement("div");I.setAttribute("class",`subsurface-title ${W}`),I.innerText=j.title,H.appendChild(I)}j.prepend?D.insertBefore(H,D.firstChild):D.appendChild(H)}return H},a.getDefaultWidth=function(A){let U=0,B=A;for(;B&&B.clientWidth===0;)B=B.parentElement,U=50;return B.clientWidth-U},a.getDefaultHeight=function(A){return A.clientHeight===0?200:A.clientHeight}},function(s,a,r){var c=r(84)("meta"),S=r(13),E=r(43),A=r(26).f,U=0,B=Object.isExtensible||function(){return!0},D=!r(15)(function(){return B(Object.preventExtensions({}))}),R=function(j){A(j,c,{value:{i:"O"+ ++U,w:{}}})},W=s.exports={KEY:c,NEED:!1,fastKey:function(j,H){if(!S(j))return typeof j=="symbol"?j:(typeof j=="string"?"S":"P")+j;if(!E(j,c)){if(!B(j))return"F";if(!H)return"E";R(j)}return j[c].i},getWeak:function(j,H){if(!E(j,c)){if(!B(j))return!0;if(!H)return!1;R(j)}return j[c].w},onFreeze:function(j){return D&&W.NEED&&B(j)&&!E(j,c)&&R(j),j}}},function(s,a,r){var c=r(13);s.exports=function(S,E){if(!c(S))return S;var A,U;if(E&&typeof(A=S.toString)=="function"&&!c(U=A.call(S))||typeof(A=S.valueOf)=="function"&&!c(U=A.call(S))||!E&&typeof(A=S.toString)=="function"&&!c(U=A.call(S)))return U;throw TypeError("Can't convert object to primitive value")}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),r(0),r(384);const c=r(349),S=r(289),E=r(288),A=r(137),U=r(196),B=r(287),D=r(109),R=r(286),W=r(285),j=r(284),H=r(283),I=r(110),Q=r(282);a.version_vis=Q.version;const Y={barchart:c.barchart,table:D.table,histogram:A.histogram,linechart:U.linechart,scatterplot:B.scatterplot,confusionMatrix:S.confusionMatrix,heatmap:E.heatmap};a.render=Y;const q={accuracy:I.accuracy,perClassAccuracy:I.perClassAccuracy,confusionMatrix:I.confusionMatrix};a.metrics=q;const ae={history:R.history,fitCallbacks:R.fitCallbacks,perClassAccuracy:j.perClassAccuracy,valuesDistribution:H.valuesDistribution,layer:W.layer,modelSummary:W.modelSummary};a.show=ae;var oe=r(197);a.visor=oe.visor,function(ye){for(var _e in ye)a.hasOwnProperty(_e)||(a[_e]=ye[_e])}(r(198))},function(s,a,r){var c=r(31),S=Object(c.a)(function(E){E.setUTCMonth(0,1),E.setUTCHours(0,0,0,0)},function(E,A){E.setUTCFullYear(E.getUTCFullYear()+A)},function(E,A){return A.getUTCFullYear()-E.getUTCFullYear()},function(E){return E.getUTCFullYear()});S.every=function(E){return isFinite(E=Math.floor(E))&&E>0?Object(c.a)(function(A){A.setUTCFullYear(Math.floor(A.getUTCFullYear()/E)*E),A.setUTCMonth(0,1),A.setUTCHours(0,0,0,0)},function(A,U){A.setUTCFullYear(A.getUTCFullYear()+U*E)}):null},a.a=S,S.range},function(s,a,r){var c=r(31),S=r(12),E=Object(c.a)(function(A){A.setTime(A-A.getMilliseconds())},function(A,U){A.setTime(+A+U*S.e)},function(A,U){return(U-A)/S.e},function(A){return A.getUTCSeconds()});a.a=E,E.range},function(s,a,r){var c=r(31),S=Object(c.a)(function(E){E.setMonth(0,1),E.setHours(0,0,0,0)},function(E,A){E.setFullYear(E.getFullYear()+A)},function(E,A){return A.getFullYear()-E.getFullYear()},function(E){return E.getFullYear()});S.every=function(E){return isFinite(E=Math.floor(E))&&E>0?Object(c.a)(function(A){A.setFullYear(Math.floor(A.getFullYear()/E)*E),A.setMonth(0,1),A.setHours(0,0,0,0)},function(A,U){A.setFullYear(A.getFullYear()+U*E)}):null},a.a=S,S.range},function(s,a,r){var c=r(31),S=r(12),E=Object(c.a)(function(A){A.setUTCHours(0,0,0,0)},function(A,U){A.setUTCDate(A.getUTCDate()+U)},function(A,U){return(U-A)/S.a},function(A){return A.getUTCDate()-1});a.a=E,E.range},function(s,a,r){var c=r(31),S=r(12),E=Object(c.a)(A=>A.setHours(0,0,0,0),(A,U)=>A.setDate(A.getDate()+U),(A,U)=>(U-A-(U.getTimezoneOffset()-A.getTimezoneOffset())*S.c)/S.a,A=>A.getDate()-1);a.a=E,E.range},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.Add="Add",a.AddN="AddN",a.Div="Div",a.FusedBatchNorm="FusedBatchNorm",a.SquaredDifference="SquaredDifference",a.Square="Square",a.Transpose="Transpose",a.NonMaxSuppressionV5="NonMaxSuppressionV5",a.BroadcastTo="BroadcastTo",a.OneHot="OneHot",a.Identity="Identity",a.Tile="Tile",a.PadV2="PadV2",a.FromPixels="FromPixels",a.MaxPoolWithArgmax="MaxPoolWithArgmax"},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(33),S=r(378),E=r(21);a.makeTypesMatch=function(A,U){if(A.dtype===U.dtype)return[A,U];var B=S.upcastType(A.dtype,U.dtype);return[A.cast(B),U.cast(B)]},a.assertTypesMatch=function(A,U){E.assert(A.dtype===U.dtype,function(){return"The dtypes of the first("+A.dtype+") and second("+U.dtype+") input must match"})},a.isTensorInList=function(A,U){return U.some(function(B){return B.id===A.id})},a.getTensorsInContainer=function(A){var U=[];return function B(D,R,W){if(D!=null){if(D instanceof c.Tensor)R.push(D);else if(function(Q){return Array.isArray(Q)||typeof Q=="object"}(D)){var j=D;for(var H in j){var I=j[H];W.has(I)||(W.add(I),B(I,R,W))}}}}(A,U,new Set),U}},function(s,a){var r,c,S=s.exports={};function E(){throw new Error("setTimeout has not been defined")}function A(){throw new Error("clearTimeout has not been defined")}function U(Y){if(r===setTimeout)return setTimeout(Y,0);if((r===E||!r)&&setTimeout)return r=setTimeout,setTimeout(Y,0);try{return r(Y,0)}catch{try{return r.call(null,Y,0)}catch{return r.call(this,Y,0)}}}(function(){try{r=typeof setTimeout=="function"?setTimeout:E}catch{r=E}try{c=typeof clearTimeout=="function"?clearTimeout:A}catch{c=A}})();var B,D=[],R=!1,W=-1;function j(){R&&B&&(R=!1,B.length?D=B.concat(D):W=-1,D.length&&H())}function H(){if(!R){var Y=U(j);R=!0;for(var q=D.length;q;){for(B=D,D=[];++W<q;)B&&B[W].run();W=-1,q=D.length}B=null,R=!1,function(ae){if(c===clearTimeout)return clearTimeout(ae);if((c===A||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(ae);try{c(ae)}catch{try{return c.call(null,ae)}catch{return c.call(this,ae)}}}(Y)}}function I(Y,q){this.fun=Y,this.array=q}function Q(){}S.nextTick=function(Y){var q=new Array(arguments.length-1);if(arguments.length>1)for(var ae=1;ae<arguments.length;ae++)q[ae-1]=arguments[ae];D.push(new I(Y,q)),D.length!==1||R||U(H)},I.prototype.run=function(){this.fun.apply(null,this.array)},S.title="browser",S.browser=!0,S.env={},S.argv=[],S.version="",S.versions={},S.on=Q,S.addListener=Q,S.once=Q,S.off=Q,S.removeListener=Q,S.removeAllListeners=Q,S.emit=Q,S.prependListener=Q,S.prependOnceListener=Q,S.listeners=function(Y){return[]},S.binding=function(Y){throw new Error("process.binding is not supported")},S.cwd=function(){return"/"},S.chdir=function(Y){throw new Error("process.chdir is not supported")},S.umask=function(){return 0}},function(s,a,r){var c=r(13);s.exports=function(S,E){if(!c(S)||S._t!==E)throw TypeError("Incompatible receiver, "+E+" required!");return S}},function(s,a,r){var c=r(19)("unscopables"),S=Array.prototype;S[c]==null&&r(42)(S,c,{}),s.exports=function(E){S[c][E]=!0}},function(s,a,r){var c=r(43),S=r(34),E=r(173)("IE_PROTO"),A=Object.prototype;s.exports=Object.getPrototypeOf||function(U){return U=S(U),c(U,E)?U[E]:typeof U.constructor=="function"&&U instanceof U.constructor?U.constructor.prototype:U instanceof Object?A:null}},function(s,a,r){var c=r(238),S=r(172).concat("length","prototype");a.f=Object.getOwnPropertyNames||function(E){return c(E,S)}},function(s,a,r){var c=r(14),S=r(237),E=r(172),A=r(173)("IE_PROTO"),U=function(){},B=function(){var D,R=r(175)("iframe"),W=E.length;for(R.style.display="none",r(171).appendChild(R),R.src="javascript:",(D=R.contentWindow.document).open(),D.write("<script>document.F=Object<\/script>"),D.close(),B=D.F;W--;)delete B.prototype[E[W]];return B()};s.exports=Object.create||function(D,R){var W;return D!==null?(U.prototype=c(D),W=new U,U.prototype=null,W[A]=D):W=B(),R===void 0?W:S(W,R)}},function(s,a,r){var c=r(54),S=Math.max,E=Math.min;s.exports=function(A,U){return(A=c(A))<0?S(A+U,0):E(A,U)}},function(s,a,r){var c=r(238),S=r(172);s.exports=Object.keys||function(E){return c(E,S)}},function(s,a){s.exports=!1},function(s,a){var r=0,c=Math.random();s.exports=function(S){return"Symbol(".concat(S===void 0?"":S,")_",(++r+c).toString(36))}},function(s,a){s.exports=function(r,c){return{enumerable:!(1&r),configurable:!(2&r),writable:!(4&r),value:c}}},function(s,a,r){s.exports=function(c,S){S||(S={}),typeof S=="function"&&(S={cmp:S});var E=typeof S.cycles=="boolean"&&S.cycles,A=S.cmp&&function(B){return function(D){return function(R,W){var j={key:R,value:D[R]},H={key:W,value:D[W]};return B(j,H)}}}(S.cmp),U=[];return function B(D){if(D&&D.toJSON&&typeof D.toJSON=="function"&&(D=D.toJSON()),D!==void 0){if(typeof D=="number")return isFinite(D)?""+D:"null";if(typeof D!="object")return JSON.stringify(D);var R,W;if(Array.isArray(D)){for(W="[",R=0;R<D.length;R++)R&&(W+=","),W+=B(D[R])||"null";return W+"]"}if(D===null)return"null";if(U.indexOf(D)!==-1){if(E)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var j=U.push(D)-1,H=Object.keys(D).sort(A&&A(D));for(W="",R=0;R<H.length;R++){var I=H[R],Q=B(D[I]);Q&&(W&&(W+=","),W+=JSON.stringify(I)+":"+Q)}return U.splice(j,1),"{"+W+"}"}}(c)}},function(s,a,r){a.a=function(c,S){return c<S?-1:c>S?1:c>=S?0:NaN}},function(s,a,r){r.r(a);var c={};r.d(c,"JsonPatchError",function(){return Ot}),r.d(c,"deepClone",function(){return ze}),r.d(c,"getValueByPointer",function(){return pt}),r.d(c,"applyOperation",function(){return vt}),r.d(c,"applyPatch",function(){return rn}),r.d(c,"applyReducer",function(){return xt}),r.d(c,"validator",function(){return _t}),r.d(c,"validate",function(){return Xt}),r.d(c,"_areEquals",function(){return sn});var S={};r.d(S,"unobserve",function(){return Ye}),r.d(S,"observe",function(){return $e}),r.d(S,"generate",function(){return ft}),r.d(S,"compare",function(){return Jt});var E={};r.d(E,"aggregate",function(){return Fc}),r.d(E,"bin",function(){return qp}),r.d(E,"collect",function(){return tg}),r.d(E,"compare",function(){return Jg}),r.d(E,"countpattern",function(){return Ml}),r.d(E,"cross",function(){return Qa}),r.d(E,"density",function(){return $p}),r.d(E,"dotbin",function(){return $u}),r.d(E,"expression",function(){return ja}),r.d(E,"extent",function(){return _u}),r.d(E,"facet",function(){return Co}),r.d(E,"field",function(){return xa}),r.d(E,"filter",function(){return No}),r.d(E,"flatten",function(){return Fs}),r.d(E,"fold",function(){return Ar}),r.d(E,"formula",function(){return au}),r.d(E,"generate",function(){return Eu}),r.d(E,"impute",function(){return Ih}),r.d(E,"joinaggregate",function(){return Xp}),r.d(E,"kde",function(){return Kp}),r.d(E,"key",function(){return Fu}),r.d(E,"load",function(){return Rs}),r.d(E,"lookup",function(){return Rc}),r.d(E,"multiextent",function(){return _s}),r.d(E,"multivalues",function(){return $o}),r.d(E,"params",function(){return Yp}),r.d(E,"pivot",function(){return gf}),r.d(E,"prefacet",function(){return Ph}),r.d(E,"project",function(){return $i}),r.d(E,"proxy",function(){return Ii}),r.d(E,"quantile",function(){return ma}),r.d(E,"relay",function(){return Jp}),r.d(E,"sample",function(){return Qp}),r.d(E,"sequence",function(){return Zp}),r.d(E,"sieve",function(){return ng}),r.d(E,"subflow",function(){return Lt}),r.d(E,"timeunit",function(){return pc}),r.d(E,"tupleindex",function(){return Nl}),r.d(E,"values",function(){return Ks}),r.d(E,"window",function(){return Il});var A={};r.d(A,"interpolate",function(){return ga}),r.d(A,"interpolateArray",function(){return pa}),r.d(A,"interpolateBasis",function(){return ai}),r.d(A,"interpolateBasisClosed",function(){return Fr}),r.d(A,"interpolateDate",function(){return sa}),r.d(A,"interpolateDiscrete",function(){return Iy}),r.d(A,"interpolateHue",function(){return fm}),r.d(A,"interpolateNumber",function(){return Gi}),r.d(A,"interpolateNumberArray",function(){return Ki}),r.d(A,"interpolateObject",function(){return Vi}),r.d(A,"interpolateRound",function(){return ua}),r.d(A,"interpolateString",function(){return Sa}),r.d(A,"interpolateTransformCss",function(){return l0}),r.d(A,"interpolateTransformSvg",function(){return j1}),r.d(A,"interpolateZoom",function(){return vv}),r.d(A,"interpolateRgb",function(){return gi}),r.d(A,"interpolateRgbBasis",function(){return ho}),r.d(A,"interpolateRgbBasisClosed",function(){return Ko}),r.d(A,"interpolateHsl",function(){return og}),r.d(A,"interpolateHslLong",function(){return bv}),r.d(A,"interpolateLab",function(){return pm}),r.d(A,"interpolateHcl",function(){return W1}),r.d(A,"interpolateHclLong",function(){return Fy}),r.d(A,"interpolateCubehelix",function(){return Jh}),r.d(A,"interpolateCubehelixLong",function(){return Ry}),r.d(A,"piecewise",function(){return ec}),r.d(A,"quantize",function(){return Py});var U={};r.d(U,"bound",function(){return $5}),r.d(U,"identifier",function(){return IT}),r.d(U,"mark",function(){return K5}),r.d(U,"overlap",function(){return Y5}),r.d(U,"render",function(){return n6}),r.d(U,"viewlayout",function(){return u6});var B={};r.d(B,"axisticks",function(){return l6}),r.d(B,"datajoin",function(){return f6}),r.d(B,"encode",function(){return d6}),r.d(B,"legendentries",function(){return h6}),r.d(B,"linkpath",function(){return FT}),r.d(B,"pie",function(){return RT}),r.d(B,"scale",function(){return b6}),r.d(B,"sortitems",function(){return _6}),r.d(B,"stack",function(){return LT});var D={};r.d(D,"contour",function(){return mM}),r.d(D,"geojson",function(){return yM}),r.d(D,"geopath",function(){return bM}),r.d(D,"geopoint",function(){return xM}),r.d(D,"geoshape",function(){return wM}),r.d(D,"graticule",function(){return _M}),r.d(D,"heatmap",function(){return EM}),r.d(D,"isocontour",function(){return dM}),r.d(D,"kde2d",function(){return pM}),r.d(D,"projection",function(){return IP});var R={};r.d(R,"force",function(){return TM});var W={};r.d(W,"nest",function(){return PM}),r.d(W,"pack",function(){return BM}),r.d(W,"partition",function(){return zM}),r.d(W,"stratify",function(){return UM}),r.d(W,"tree",function(){return VM}),r.d(W,"treelinks",function(){return HM}),r.d(W,"treemap",function(){return qM});var j={};r.d(j,"label",function(){return XM});var H={};r.d(H,"loess",function(){return KM}),r.d(H,"regression",function(){return JM});var I={};r.d(I,"voronoi",function(){return nD});var Q={};r.d(Q,"wordcloud",function(){return iD});var Y={};r.d(Y,"crossfilter",function(){return oD}),r.d(Y,"resolvefilter",function(){return aD});var q={};r.d(q,"Dataflow",function(){return fn}),r.d(q,"EventStream",function(){return Kr}),r.d(q,"MultiPulse",function(){return tn}),r.d(q,"Operator",function(){return ir}),r.d(q,"Parameters",function(){return Ur}),r.d(q,"Pulse",function(){return ke}),r.d(q,"Transform",function(){return Mt}),r.d(q,"changeset",function(){return dr}),r.d(q,"definition",function(){return nn}),r.d(q,"ingest",function(){return Dt}),r.d(q,"isTuple",function(){return Vt}),r.d(q,"transform",function(){return He}),r.d(q,"transforms",function(){return hn}),r.d(q,"tupleid",function(){return en}),r.d(q,"interpolate",function(){return gg}),r.d(q,"interpolateColors",function(){return Bf}),r.d(q,"interpolateRange",function(){return pg}),r.d(q,"quantizeInterpolator",function(){return mg}),r.d(q,"scale",function(){return Vo}),r.d(q,"scheme",function(){return v0}),r.d(q,"projection",function(){return fM}),r.d(q,"View",function(){return PB}),r.d(q,"defaultLocale",function(){return Mr.a}),r.d(q,"formatLocale",function(){return Mr.c}),r.d(q,"locale",function(){return Mr.b}),r.d(q,"resetDefaultLocale",function(){return Mr.d}),r.d(q,"timeFormatLocale",function(){return Mr.e}),r.d(q,"expressionFunction",function(){return Sc}),r.d(q,"parse",function(){return JQ}),r.d(q,"runtimeContext",function(){return gB}),r.d(q,"codegenExpression",function(){return GZ}),r.d(q,"parseExpression",function(){return WZ}),r.d(q,"parseSelector",function(){return Sx}),r.d(q,"version",function(){return ZZ}),r.d(q,"Debug",function(){return Ce.a}),r.d(q,"Error",function(){return Ce.b}),r.d(q,"Info",function(){return Ce.c}),r.d(q,"None",function(){return Ce.d}),r.d(q,"Warn",function(){return Ce.e}),r.d(q,"accessor",function(){return Ce.f}),r.d(q,"accessorFields",function(){return Ce.g}),r.d(q,"accessorName",function(){return Ce.h}),r.d(q,"array",function(){return Ce.i}),r.d(q,"ascending",function(){return Ce.j}),r.d(q,"clampRange",function(){return Ce.k}),r.d(q,"compare",function(){return Ce.l}),r.d(q,"constant",function(){return Ce.m}),r.d(q,"debounce",function(){return Ce.n}),r.d(q,"error",function(){return Ce.o}),r.d(q,"extend",function(){return Ce.p}),r.d(q,"extent",function(){return Ce.q}),r.d(q,"extentIndex",function(){return Ce.r}),r.d(q,"falsy",function(){return Ce.s}),r.d(q,"fastmap",function(){return Ce.t}),r.d(q,"field",function(){return Ce.u}),r.d(q,"flush",function(){return Ce.v}),r.d(q,"hasOwnProperty",function(){return Ce.w}),r.d(q,"id",function(){return Ce.x}),r.d(q,"identity",function(){return Ce.y}),r.d(q,"inherits",function(){return Ce.z}),r.d(q,"inrange",function(){return Ce.A}),r.d(q,"isArray",function(){return Ce.B}),r.d(q,"isBoolean",function(){return Ce.C}),r.d(q,"isDate",function(){return Ce.D}),r.d(q,"isFunction",function(){return Ce.E}),r.d(q,"isIterable",function(){return Ce.F}),r.d(q,"isNumber",function(){return Ce.G}),r.d(q,"isObject",function(){return Ce.H}),r.d(q,"isRegExp",function(){return Ce.I}),r.d(q,"isString",function(){return Ce.J}),r.d(q,"key",function(){return Ce.K}),r.d(q,"lerp",function(){return Ce.L}),r.d(q,"logger",function(){return Ce.M}),r.d(q,"lruCache",function(){return Ce.N}),r.d(q,"merge",function(){return Ce.O}),r.d(q,"mergeConfig",function(){return Ce.P}),r.d(q,"one",function(){return Ce.Q}),r.d(q,"pad",function(){return Ce.R}),r.d(q,"panLinear",function(){return Ce.S}),r.d(q,"panLog",function(){return Ce.T}),r.d(q,"panPow",function(){return Ce.U}),r.d(q,"panSymlog",function(){return Ce.V}),r.d(q,"peek",function(){return Ce.W}),r.d(q,"quarter",function(){return Ce.X}),r.d(q,"repeat",function(){return Ce.Y}),r.d(q,"span",function(){return Ce.Z}),r.d(q,"splitAccessPath",function(){return Ce.Aa}),r.d(q,"stringValue",function(){return Ce.Ba}),r.d(q,"toBoolean",function(){return Ce.Ca}),r.d(q,"toDate",function(){return Ce.Da}),r.d(q,"toNumber",function(){return Ce.Ea}),r.d(q,"toSet",function(){return Ce.Fa}),r.d(q,"toString",function(){return Ce.Ga}),r.d(q,"truncate",function(){return Ce.Ha}),r.d(q,"truthy",function(){return Ce.Ia}),r.d(q,"utcquarter",function(){return Ce.Ja}),r.d(q,"visitArray",function(){return Ce.Ka}),r.d(q,"writeConfig",function(){return Ce.La}),r.d(q,"zero",function(){return Ce.Ma}),r.d(q,"zoomLinear",function(){return Ce.Na}),r.d(q,"zoomLog",function(){return Ce.Oa}),r.d(q,"zoomPow",function(){return Ce.Pa}),r.d(q,"zoomSymlog",function(){return Ce.Qa}),r.d(q,"bandwidthNRD",function(){return ri}),r.d(q,"bin",function(){return Jr}),r.d(q,"bootstrapCI",function(){return Ci}),r.d(q,"cumulativeLogNormal",function(){return Up}),r.d(q,"cumulativeNormal",function(){return ro}),r.d(q,"cumulativeUniform",function(){return kh}),r.d(q,"densityLogNormal",function(){return tl}),r.d(q,"densityNormal",function(){return Ch}),r.d(q,"densityUniform",function(){return hd}),r.d(q,"dotbin",function(){return Wr}),r.d(q,"quantileLogNormal",function(){return xs}),r.d(q,"quantileNormal",function(){return Mc}),r.d(q,"quantileUniform",function(){return nl}),r.d(q,"quantiles",function(){return to}),r.d(q,"quartiles",function(){return yi}),r.d(q,"random",function(){return Kn}),r.d(q,"randomInteger",function(){return Wi}),r.d(q,"randomKDE",function(){return el}),r.d(q,"randomLCG",function(){return so}),r.d(q,"randomLogNormal",function(){return dd}),r.d(q,"randomMixture",function(){return Wp}),r.d(q,"randomNormal",function(){return Gu}),r.d(q,"randomUniform",function(){return hf}),r.d(q,"regressionExp",function(){return Nc}),r.d(q,"regressionLinear",function(){return ws}),r.d(q,"regressionLoess",function(){return md}),r.d(q,"regressionLog",function(){return La}),r.d(q,"regressionPoly",function(){return Iu}),r.d(q,"regressionPow",function(){return pf}),r.d(q,"regressionQuad",function(){return Ic}),r.d(q,"sampleCurve",function(){return gd}),r.d(q,"sampleLogNormal",function(){return fc}),r.d(q,"sampleNormal",function(){return Ds}),r.d(q,"sampleUniform",function(){return dc}),r.d(q,"setRandom",function(){return pi}),r.d(q,"DATE",function(){return br.a}),r.d(q,"DAY",function(){return br.b}),r.d(q,"DAYOFYEAR",function(){return br.c}),r.d(q,"HOURS",function(){return br.d}),r.d(q,"MILLISECONDS",function(){return br.e}),r.d(q,"MINUTES",function(){return br.f}),r.d(q,"MONTH",function(){return br.g}),r.d(q,"QUARTER",function(){return br.h}),r.d(q,"SECONDS",function(){return br.i}),r.d(q,"TIME_UNITS",function(){return br.j}),r.d(q,"WEEK",function(){return br.k}),r.d(q,"YEAR",function(){return br.l}),r.d(q,"dayofyear",function(){return br.m}),r.d(q,"timeBin",function(){return br.n}),r.d(q,"timeFloor",function(){return br.o}),r.d(q,"timeInterval",function(){return br.p}),r.d(q,"timeOffset",function(){return br.q}),r.d(q,"timeSequence",function(){return br.r}),r.d(q,"timeUnitSpecifier",function(){return br.s}),r.d(q,"timeUnits",function(){return br.t}),r.d(q,"utcFloor",function(){return br.u}),r.d(q,"utcInterval",function(){return br.v}),r.d(q,"utcOffset",function(){return br.w}),r.d(q,"utcSequence",function(){return br.x}),r.d(q,"utcdayofyear",function(){return br.y}),r.d(q,"utcweek",function(){return br.z}),r.d(q,"week",function(){return br.A}),r.d(q,"format",function(){return sr.a}),r.d(q,"formats",function(){return sr.b}),r.d(q,"inferType",function(){return sr.c}),r.d(q,"inferTypes",function(){return sr.d}),r.d(q,"loader",function(){return sr.e}),r.d(q,"read",function(){return sr.f}),r.d(q,"responseType",function(){return sr.g}),r.d(q,"typeParsers",function(){return sr.h}),r.d(q,"Bounds",function(){return as}),r.d(q,"CanvasHandler",function(){return Xe}),r.d(q,"CanvasRenderer",function(){return jt}),r.d(q,"Gradient",function(){return w0}),r.d(q,"GroupItem",function(){return Om}),r.d(q,"Handler",function(){return d}),r.d(q,"Item",function(){return ap}),r.d(q,"Marks",function(){return nf}),r.d(q,"RenderType",function(){return wr}),r.d(q,"Renderer",function(){return C}),r.d(q,"ResourceLoader",function(){return kg}),r.d(q,"SVGHandler",function(){return gn}),r.d(q,"SVGRenderer",function(){return gt}),r.d(q,"SVGStringRenderer",function(){return Er}),r.d(q,"Scenegraph",function(){return Kv}),r.d(q,"boundClip",function(){return _o}),r.d(q,"boundContext",function(){return Mg}),r.d(q,"boundItem",function(){return hp}),r.d(q,"boundMark",function(){return q1}),r.d(q,"boundStroke",function(){return Vf}),r.d(q,"domChild",function(){return Ec}),r.d(q,"domClear",function(){return Xf}),r.d(q,"domCreate",function(){return Gc}),r.d(q,"domFind",function(){return X1}),r.d(q,"font",function(){return dp}),r.d(q,"fontFamily",function(){return th}),r.d(q,"fontSize",function(){return _c}),r.d(q,"intersect",function(){return Pr}),r.d(q,"intersectBoxLine",function(){return Ie}),r.d(q,"intersectPath",function(){return J}),r.d(q,"intersectPoint",function(){return ie}),r.d(q,"intersectRule",function(){return Ae}),r.d(q,"lineHeight",function(){return Vs}),r.d(q,"markup",function(){return Fe}),r.d(q,"multiLineOffset",function(){return Os}),r.d(q,"pathCurves",function(){return zf}),r.d(q,"pathEqual",function(){return qo}),r.d(q,"pathParse",function(){return rp}),r.d(q,"pathRectangle",function(){return Wv}),r.d(q,"pathRender",function(){return op}),r.d(q,"pathSymbols",function(){return Wf}),r.d(q,"pathTrail",function(){return Jl}),r.d(q,"point",function(){return v}),r.d(q,"renderModule",function(){return Lr}),r.d(q,"resetSVGClipId",function(){return Hv}),r.d(q,"resetSVGDefIds",function(){return fa}),r.d(q,"sceneEqual",function(){return Do}),r.d(q,"sceneFromJSON",function(){return Vy}),r.d(q,"scenePickVisit",function(){return Jn}),r.d(q,"sceneToJSON",function(){return Xv}),r.d(q,"sceneVisit",function(){return Wn}),r.d(q,"sceneZOrder",function(){return Rn}),r.d(q,"serializeXML",function(){return qe}),r.d(q,"textMetrics",function(){return As});var ae={};r.d(ae,"invalidSpec",function(){return Wee}),r.d(ae,"FIT_NON_SINGLE",function(){return Vee}),r.d(ae,"containerSizeNonSingle",function(){return Hee}),r.d(ae,"containerSizeNotCompatibleWithAutosize",function(){return Gee}),r.d(ae,"droppingFit",function(){return qee}),r.d(ae,"cannotProjectOnChannelWithoutField",function(){return $ee}),r.d(ae,"cannotProjectAggregate",function(){return Xee}),r.d(ae,"nearestNotSupportForContinuous",function(){return Kee}),r.d(ae,"selectionNotSupported",function(){return Yee}),r.d(ae,"selectionNotFound",function(){return Jee}),r.d(ae,"SCALE_BINDINGS_CONTINUOUS",function(){return Qee}),r.d(ae,"LEGEND_BINDINGS_PROJECT_LENGTH",function(){return Zee}),r.d(ae,"noSameUnitLookup",function(){return ete}),r.d(ae,"noSuchRepeatedValue",function(){return tte}),r.d(ae,"columnsNotSupportByRowCol",function(){return nte}),r.d(ae,"CONCAT_CANNOT_SHARE_AXIS",function(){return rte}),r.d(ae,"unrecognizedParse",function(){return ite}),r.d(ae,"differentParse",function(){return ote}),r.d(ae,"invalidTransformIgnored",function(){return ate}),r.d(ae,"NO_FIELDS_NEEDS_AS",function(){return ste}),r.d(ae,"customFormatTypeNotAllowed",function(){return ute}),r.d(ae,"encodingOverridden",function(){return cte}),r.d(ae,"projectionOverridden",function(){return lte}),r.d(ae,"REPLACE_ANGLE_WITH_THETA",function(){return fte}),r.d(ae,"primitiveChannelDef",function(){return dte}),r.d(ae,"invalidFieldType",function(){return hte}),r.d(ae,"invalidFieldTypeForCountAggregate",function(){return pte}),r.d(ae,"invalidAggregate",function(){return mte}),r.d(ae,"missingFieldType",function(){return gte}),r.d(ae,"droppingColor",function(){return vte}),r.d(ae,"emptyFieldDef",function(){return yte}),r.d(ae,"latLongDeprecated",function(){return bte}),r.d(ae,"LINE_WITH_VARYING_SIZE",function(){return xte}),r.d(ae,"incompatibleChannel",function(){return wte}),r.d(ae,"invalidEncodingChannel",function(){return _te}),r.d(ae,"facetChannelShouldBeDiscrete",function(){return Ete}),r.d(ae,"facetChannelDropped",function(){return Ste}),r.d(ae,"discreteChannelCannotEncode",function(){return Cte}),r.d(ae,"lineWithRange",function(){return kte}),r.d(ae,"orientOverridden",function(){return Ate}),r.d(ae,"CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN",function(){return Ote}),r.d(ae,"RANGE_STEP_DEPRECATED",function(){return Tte}),r.d(ae,"cannotUseScalePropertyWithNonColor",function(){return Mte}),r.d(ae,"unaggregateDomainHasNoEffectForRawField",function(){return Dte}),r.d(ae,"unaggregateDomainWithNonSharedDomainOp",function(){return Nte}),r.d(ae,"unaggregatedDomainWithLogScale",function(){return Ite}),r.d(ae,"cannotApplySizeToNonOrientedMark",function(){return Fte}),r.d(ae,"scaleTypeNotWorkWithChannel",function(){return Rte}),r.d(ae,"scaleTypeNotWorkWithFieldDef",function(){return Pte}),r.d(ae,"scalePropertyNotWorkWithScaleType",function(){return Lte}),r.d(ae,"scaleTypeNotWorkWithMark",function(){return Bte}),r.d(ae,"stepDropped",function(){return jte}),r.d(ae,"mergeConflictingProperty",function(){return zte}),r.d(ae,"mergeConflictingDomainProperty",function(){return Ute}),r.d(ae,"independentScaleMeansIndependentGuide",function(){return Wte}),r.d(ae,"domainSortDropped",function(){return Vte}),r.d(ae,"MORE_THAN_ONE_SORT",function(){return Hte}),r.d(ae,"FACETED_INDEPENDENT_DIFFERENT_SOURCES",function(){return Gte}),r.d(ae,"FACETED_INDEPENDENT_SAME_FIELDS_DIFFERENT_SOURCES",function(){return qte}),r.d(ae,"FACETED_INDEPENDENT_SAME_SOURCE",function(){return $te}),r.d(ae,"INVALID_CHANNEL_FOR_AXIS",function(){return Xte}),r.d(ae,"cannotStackRangedMark",function(){return Kte}),r.d(ae,"cannotStackNonLinearScale",function(){return Yte}),r.d(ae,"stackNonSummativeAggregate",function(){return Jte}),r.d(ae,"invalidTimeUnit",function(){return Qte}),r.d(ae,"droppedDay",function(){return Zte}),r.d(ae,"errorBarCenterAndExtentAreNotNeeded",function(){return ene}),r.d(ae,"errorBarCenterIsUsedWithWrongExtent",function(){return tne}),r.d(ae,"errorBarContinuousAxisHasCustomizedAggregate",function(){return nne}),r.d(ae,"errorBarCenterIsNotNeeded",function(){return rne}),r.d(ae,"errorBand1DNotSupport",function(){return ine}),r.d(ae,"channelRequiredForBinned",function(){return one}),r.d(ae,"domainRequiredForThresholdScale",function(){return ane});var oe={};r.d(oe,"compile",function(){return koe}),r.d(oe,"extractTransforms",function(){return Ooe}),r.d(oe,"normalize",function(){return az}),r.d(oe,"version",function(){return Toe});var ye={};r.d(ye,"dark",function(){return Moe}),r.d(ye,"excel",function(){return Doe}),r.d(ye,"fivethirtyeight",function(){return Noe}),r.d(ye,"ggplot2",function(){return Ioe}),r.d(ye,"googlecharts",function(){return Boe}),r.d(ye,"latimes",function(){return Foe}),r.d(ye,"quartz",function(){return Roe}),r.d(ye,"urbaninstitute",function(){return Loe}),r.d(ye,"version",function(){return joe}),r.d(ye,"vox",function(){return Poe});var _e=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,u){o.__proto__=u}||function(o,u){for(var f in u)u.hasOwnProperty(f)&&(o[f]=u[f])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=n===null?Object.create(n):(o.prototype=n.prototype,new o)}}(),pe=Object.prototype.hasOwnProperty;function me(e,t){return pe.call(e,t)}function Ge(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);t=[];for(var o in e)me(e,o)&&t.push(o);return t}function lt(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function It(e){for(var t,n=0,o=e.length;n<o;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0}function wt(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function we(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function yt(e,t){var n=[e];for(var o in t){var u=typeof t[o]=="object"?JSON.stringify(t[o],null,2):t[o];u!==void 0&&n.push(o+": "+u)}return n.join(`
`)}var Bt=function(e){function t(n,o,u,f,g){var x=this.constructor,k=e.call(this,yt(n,{name:o,index:u,operation:f,tree:g}))||this;return k.name=o,k.index=u,k.operation=f,k.tree=g,Object.setPrototypeOf(k,x.prototype),k.message=yt(n,{name:o,index:u,operation:f,tree:g}),k}return _e(t,e),t}(Error),Ot=Bt,ze=lt,Ut={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var o=e[t];return delete e[t],{newDocument:n,removed:o}},replace:function(e,t,n){var o=e[t];return e[t]=this.value,{newDocument:n,removed:o}},move:function(e,t,n){var o=pt(n,this.path);o&&(o=lt(o));var u=vt(n,{op:"remove",path:this.from}).removed;return vt(n,{op:"add",path:this.path,value:u}),{newDocument:n,removed:o}},copy:function(e,t,n){var o=pt(n,this.from);return vt(n,{op:"add",path:this.path,value:lt(o)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:sn(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},Ft={add:function(e,t,n){return It(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var o=e[t];return e[t]=this.value,{newDocument:n,removed:o}},move:Ut.move,copy:Ut.copy,test:Ut.test,_get:Ut._get};function pt(e,t){if(t=="")return e;var n={op:"_get",path:t};return vt(e,n),n.value}function vt(e,t,n,o,u,f){if(n===void 0&&(n=!1),o===void 0&&(o=!0),u===void 0&&(u=!0),f===void 0&&(f=0),n&&(typeof n=="function"?n(t,0,e,t.path):_t(t,0)),t.path===""){var g={newDocument:e};if(t.op==="add")return g.newDocument=t.value,g;if(t.op==="replace")return g.newDocument=t.value,g.removed=e,g;if(t.op==="move"||t.op==="copy")return g.newDocument=pt(e,t.from),t.op==="move"&&(g.removed=e),g;if(t.op==="test"){if(g.test=sn(e,t.value),g.test===!1)throw new Ot("Test operation failed","TEST_OPERATION_FAILED",f,t,e);return g.newDocument=e,g}if(t.op==="remove")return g.removed=e,g.newDocument=null,g;if(t.op==="_get")return t.value=e,g;if(n)throw new Ot("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",f,t,e);return g}o||(e=lt(e));var x=(t.path||"").split("/"),k=e,F=1,V=x.length,X=void 0,te=void 0,ue=void 0;for(ue=typeof n=="function"?n:_t;;){if((te=x[F])&&te.indexOf("~")!=-1&&(te=we(te)),u&&te=="__proto__")throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&X===void 0&&(k[te]===void 0?X=x.slice(0,F).join("/"):F==V-1&&(X=t.path),X!==void 0&&ue(t,0,e,X)),F++,Array.isArray(k)){if(te==="-")te=k.length;else{if(n&&!It(te))throw new Ot("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",f,t,e);It(te)&&(te=~~te)}if(F>=V){if(n&&t.op==="add"&&te>k.length)throw new Ot("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",f,t,e);if((g=Ft[t.op].call(t,k,te,e)).test===!1)throw new Ot("Test operation failed","TEST_OPERATION_FAILED",f,t,e);return g}}else if(F>=V){if((g=Ut[t.op].call(t,k,te,e)).test===!1)throw new Ot("Test operation failed","TEST_OPERATION_FAILED",f,t,e);return g}if(k=k[te],n&&F<V&&(!k||typeof k!="object"))throw new Ot("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",f,t,e)}}function rn(e,t,n,o,u){if(o===void 0&&(o=!0),u===void 0&&(u=!0),n&&!Array.isArray(t))throw new Ot("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");o||(e=lt(e));for(var f=new Array(t.length),g=0,x=t.length;g<x;g++)f[g]=vt(e,t[g],n,!0,u,g),e=f[g].newDocument;return f.newDocument=e,f}function xt(e,t,n){var o=vt(e,t);if(o.test===!1)throw new Ot("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return o.newDocument}function _t(e,t,n,o){if(typeof e!="object"||e===null||Array.isArray(e))throw new Ot("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!Ut[e.op])throw new Ot("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if(typeof e.path!="string")throw new Ot("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Ot('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Ot("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Ot("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&function x(k){if(k===void 0)return!0;if(k){if(Array.isArray(k)){for(var F=0,V=k.length;F<V;F++)if(x(k[F]))return!0}else if(typeof k=="object"){var X=Ge(k),te=X.length;for(F=0;F<te;F++)if(x(k[X[F]]))return!0}}return!1}(e.value))throw new Ot("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var u=e.path.split("/").length,f=o.split("/").length;if(u!==f+1&&u!==f)throw new Ot("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==o)throw new Ot("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var g=Xt([{op:"_get",path:e.from,value:void 0}],n);if(g&&g.name==="OPERATION_PATH_UNRESOLVABLE")throw new Ot("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}function Xt(e,t,n){try{if(!Array.isArray(e))throw new Ot("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)rn(lt(t),lt(e),n||!0);else{n=n||_t;for(var o=0;o<e.length;o++)n(e[o],o,t,void 0)}}catch(u){if(u instanceof Ot)return u;throw u}}function sn(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n,o,u,f=Array.isArray(e),g=Array.isArray(t);if(f&&g){if((o=e.length)!=t.length)return!1;for(n=o;n--!=0;)if(!sn(e[n],t[n]))return!1;return!0}if(f!=g)return!1;var x=Object.keys(e);if((o=x.length)!==Object.keys(t).length)return!1;for(n=o;n--!=0;)if(!t.hasOwnProperty(x[n]))return!1;for(n=o;n--!=0;)if(!sn(e[u=x[n]],t[u]))return!1;return!0}return e!=e&&t!=t}var kn=new WeakMap,an=function(){return function(e){this.observers=new Map,this.obj=e}}(),Ve=function(){return function(e,t){this.callback=e,this.observer=t}}();function Ye(e,t){t.unobserve()}function $e(e,t){var n,o=function(x){return kn.get(x)}(e);if(o){var u=function(x,k){return x.observers.get(k)}(o,t);n=u&&u.observer}else o=new an(e),kn.set(e,o);if(n)return n;if(n={},o.value=lt(e),t){n.callback=t,n.next=null;var f=function(){ft(n)},g=function(){clearTimeout(n.next),n.next=setTimeout(f)};typeof window<"u"&&(window.addEventListener("mouseup",g),window.addEventListener("keyup",g),window.addEventListener("mousedown",g),window.addEventListener("keydown",g),window.addEventListener("change",g))}return n.patches=[],n.object=e,n.unobserve=function(){ft(n),clearTimeout(n.next),function(x,k){x.observers.delete(k.callback)}(o,n),typeof window<"u"&&(window.removeEventListener("mouseup",g),window.removeEventListener("keyup",g),window.removeEventListener("mousedown",g),window.removeEventListener("keydown",g),window.removeEventListener("change",g))},o.observers.set(t,new Ve(t,n)),n}function ft(e,t){t===void 0&&(t=!1);var n=kn.get(e.object);$t(n.value,e.object,e.patches,"",t),e.patches.length&&rn(n.value,e.patches);var o=e.patches;return o.length>0&&(e.patches=[],e.callback&&e.callback(o)),o}function $t(e,t,n,o,u){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var f=Ge(t),g=Ge(e),x=!1,k=g.length-1;k>=0;k--){var F=e[X=g[k]];if(!me(t,X)||t[X]===void 0&&F!==void 0&&Array.isArray(t)===!1)Array.isArray(e)===Array.isArray(t)?(u&&n.push({op:"test",path:o+"/"+wt(X),value:lt(F)}),n.push({op:"remove",path:o+"/"+wt(X)}),x=!0):(u&&n.push({op:"test",path:o,value:e}),n.push({op:"replace",path:o,value:t}));else{var V=t[X];typeof F=="object"&&F!=null&&typeof V=="object"&&V!=null&&Array.isArray(F)===Array.isArray(V)?$t(F,V,n,o+"/"+wt(X),u):F!==V&&(u&&n.push({op:"test",path:o+"/"+wt(X),value:lt(F)}),n.push({op:"replace",path:o+"/"+wt(X),value:lt(V)}))}}if(x||f.length!=g.length)for(k=0;k<f.length;k++){var X;me(e,X=f[k])||t[X]===void 0||n.push({op:"add",path:o+"/"+wt(X),value:lt(t[X])})}}}function Jt(e,t,n){n===void 0&&(n=!1);var o=[];return $t(e,t,o,"",n),o}Object.assign({},c,S,{JsonPatchError:Bt,deepClone:lt,escapePathComponent:wt,unescapePathComponent:we});var Pn=r(133),An=r.n(Pn),Qn=r(179),Ce=r(1),sr=r(63),Mr=r(44);function on(e){const t=e||Ce.y,n=[],o={};return n.add=u=>{const f=t(u);return o[f]||(o[f]=1,n.push(u)),n},n.remove=u=>{const f=t(u);if(o[f]){o[f]=0;const g=n.indexOf(u);g>=0&&n.splice(g,1)}return n},n}async function Gt(e,t){try{await t(e)}catch(n){e.error(n)}}const Hn=Symbol("vega_id");let Kt=1;function Vt(e){return!(!e||!en(e))}function en(e){return e[Hn]}function Vn(e,t){return e[Hn]=t,e}function Dt(e){const t=e===Object(e)?e:{data:e};return en(t)?t:Vn(t,Kt++)}function On(e){return or(e,Dt({}))}function or(e,t){for(const n in e)t[n]=e[n];return t}function ar(e,t){return Vn(t,en(e))}function yr(e,t){return e?t?(n,o)=>e(n,o)||en(t(n))-en(t(o)):(n,o)=>e(n,o)||en(n)-en(o):null}function kr(e){return e&&e.constructor===dr}function dr(){const e=[],t=[],n=[],o=[],u=[];let f=null,g=!1;return{constructor:dr,insert(x){const k=Object(Ce.i)(x),F=k.length;for(let V=0;V<F;++V)e.push(k[V]);return this},remove(x){const k=Object(Ce.E)(x)?o:t,F=Object(Ce.i)(x),V=F.length;for(let X=0;X<V;++X)k.push(F[X]);return this},modify(x,k,F){const V={field:k,value:Object(Ce.m)(F)};return Object(Ce.E)(x)?(V.filter=x,u.push(V)):(V.tuple=x,n.push(V)),this},encode(x,k){return Object(Ce.E)(x)?u.push({filter:x,field:k}):n.push({tuple:x,field:k}),this},clean(x){return f=x,this},reflow(){return g=!0,this},pulse(x,k){const F={},V={};let X,te,ue,he,be,Pe;for(X=0,te=k.length;X<te;++X)F[en(k[X])]=1;for(X=0,te=t.length;X<te;++X)F[en(be=t[X])]=-1;for(X=0,te=o.length;X<te;++X)he=o[X],k.forEach(We=>{he(We)&&(F[en(We)]=-1)});for(X=0,te=e.length;X<te;++X)Pe=en(be=e[X]),F[Pe]?F[Pe]=1:x.add.push(Dt(e[X]));for(X=0,te=k.length;X<te;++X)be=k[X],F[en(be)]<0&&x.rem.push(be);function Ue(We,at,st){st?We[at]=st(We):x.encode=at,g||(V[en(We)]=We)}for(X=0,te=n.length;X<te;++X)be=(ue=n[X]).tuple,he=ue.field,(Pe=F[en(be)])>0&&(Ue(be,he,ue.value),x.modifies(he));for(X=0,te=u.length;X<te;++X)ue=u[X],he=ue.filter,k.forEach(We=>{he(We)&&F[en(We)]>0&&Ue(We,ue.field,ue.value)}),x.modifies(ue.field);if(g)x.mod=t.length||o.length?k.filter(We=>F[en(We)]>0):k.slice();else for(Pe in V)x.mod.push(V[Pe]);return(f||f==null&&(t.length||o.length))&&x.clean(!0),x}}}const oi="_:mod:_";function Ur(){Object.defineProperty(this,oi,{writable:!0,value:{}})}Ur.prototype={set(e,t,n,o){const u=this,f=u[e],g=u[oi];return t!=null&&t>=0?(f[t]!==n||o)&&(f[t]=n,g[t+":"+e]=-1,g[e]=-1):(f!==n||o)&&(u[e]=n,g[e]=Object(Ce.B)(n)?1+n.length:-1),u},modified(e,t){const n=this[oi];if(!arguments.length){for(const o in n)if(n[o])return!0;return!1}if(Object(Ce.B)(e)){for(let o=0;o<e.length;++o)if(n[e[o]])return!0;return!1}return t!=null&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[oi]={},this}};let Xr=0;const zn=new Ur;function ir(e,t,n,o){this.id=++Xr,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,o)}function Or(e){return function(t){const n=this.flags;return arguments.length===0?!!(n&e):(this.flags=t?n|e:n&~e,this)}}ir.prototype={targets(){return this._targets||(this._targets=on(Ce.x))},set(e){return this.value!==e?(this.value=e,1):0},skip:Or(1),modified:Or(2),parameters(e,t,n){t=t!==!1;const o=this._argval=this._argval||new Ur,u=this._argops=this._argops||[],f=[];let g,x,k,F;const V=(X,te,ue)=>{ue instanceof ir?(ue!==this&&(t&&ue.targets().add(this),f.push(ue)),u.push({op:ue,name:X,index:te})):o.set(X,te,ue)};for(g in e)if(x=e[g],g==="pulse")Object(Ce.i)(x).forEach(X=>{X instanceof ir?X!==this&&(X.targets().add(this),f.push(X)):Object(Ce.o)("Pulse parameters must be operator instances.")}),this.source=x;else if(Object(Ce.B)(x))for(o.set(g,-1,Array(k=x.length)),F=0;F<k;++F)V(g,F,x[F]);else V(g,-1,x);return this.marshall().clear(),n&&(u.initonly=!0),f},marshall(e){const t=this._argval||zn,n=this._argops;let o,u,f,g;if(n){const x=n.length;for(u=0;u<x;++u)g=(f=(o=n[u]).op).modified()&&f.stamp===e,t.set(o.name,o.index,f.value,g);if(n.initonly){for(u=0;u<x;++u)(o=n[u]).op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,o;if(e)for(t=0,n=e.length;t<n;++t)(o=e[t].op)._targets&&o._targets.remove(this);this.pulse=null,this.source=null},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),o=t.call(this,n,e);if(n.clear(),o!==this.value)this.value=o;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};let qr=0;function Kr(e,t,n){this.id=++qr,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function Tt(e,t,n){return new Kr(e,t,n)}Kr.prototype={_filter:Ce.Ia,_apply:Ce.y,targets(){return this._targets||(this._targets=on(Ce.x))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,o=n?n.length:0;for(let u=0;u<o;++u)n[u].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=Tt(e);return this.targets().add(t),t},apply(e){const t=Tt(null,e);return this.targets().add(t),t},merge(){const e=Tt();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter(()=>{const n=Date.now();return n-t>e?(t=n,1):0})},debounce(e){const t=Tt();return this.targets().add(Tt(null,null,Object(Ce.n)(e,n=>{const o=n.dataflow;t.receive(n),o&&o.run&&o.run()}))),t},between(e,t){let n=!1;return e.targets().add(Tt(null,null,()=>n=!0)),t.targets().add(Tt(null,null,()=>n=!1)),this.filter(()=>n)},detach(){this._filter=Ce.Ia,this._targets=null}};const Rr={skip:!0};function Qt(e,t,n,o,u,f){const g=Object(Ce.p)({},f,Rr);let x,k;Object(Ce.E)(n)||(n=Object(Ce.m)(n)),o===void 0?x=F=>e.touch(n(F)):Object(Ce.E)(o)?(k=new ir(null,o,u,!1),x=F=>{k.evaluate(F);const V=n(F),X=k.value;kr(X)?e.pulse(V,X,f):e.update(V,X,g)}):x=F=>e.update(n(F),o,g),t.apply(x)}function Se(e,t,n,o,u,f){if(o===void 0)t.targets().add(n);else{const g=f||{},x=new ir(null,function(k,F){return F=Object(Ce.E)(F)?F:Object(Ce.m)(F),k?function(V,X){const te=F(V,X);return k.skip()||(k.skip(te!==this.value).value=te),te}:F}(n,o),u,!1);x.modified(g.force),x.rank=t.rank,t.targets().add(x),n&&(x.skip(!0),x.value=n.value,x.targets().add(n),e.connect(n,[x]))}}const ve={};function ke(e,t,n){this.dataflow=e,this.stamp=t??-1,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function Me(e,t){const n=[];return Object(Ce.Ka)(e,t,o=>n.push(o)),n}function rt(e,t){const n={};return e.visit(t,o=>{n[en(o)]=1}),o=>n[en(o)]?null:o}function Ct(e,t){return e?(n,o)=>e(n,o)&&t(n,o):t}function tn(e,t,n,o){const u=this,f=n.length;let g=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=o||null,this.pulses=n;for(let x=0;x<f;++x){const k=n[x];if(k.stamp===t){if(k.fields){const F=u.fields||(u.fields={});for(const V in k.fields)F[V]=1}k.changed(u.ADD)&&(g|=u.ADD),k.changed(u.REM)&&(g|=u.REM),k.changed(u.MOD)&&(g|=u.MOD)}}this.changes=g}function Sn(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}ke.prototype={StopPropagation:ve,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork(e){return new ke(this.dataflow).init(this,e)},clone(){const e=this.fork(7);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(23)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||((e=new ke(this.dataflow).init(this)).add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,!e.fields||64&t||(n.fields=e.fields),1&t?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),2&t?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),4&t?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),32&t?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||7;return 1&t&&this.add.length||2&t&&this.rem.length||4&t&&this.mod.length},reflow(e){if(e)return this.fork(7).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(4,rt(this,1))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return Object(Ce.B)(e)?e.forEach(n=>t[n]=!0):t[e]=!0,this},modified(e,t){const n=this.fields;return!(!t&&!this.mod.length||!n)&&(arguments.length?Object(Ce.B)(e)?e.some(o=>n[o]):n[e]:!!n)},filter(e,t){const n=this;return 1&e&&(n.addF=Ct(n.addF,t)),2&e&&(n.remF=Ct(n.remF,t)),4&e&&(n.modF=Ct(n.modF,t)),16&e&&(n.srcF=Ct(n.srcF,t)),n},materialize(e){const t=this;return 1&(e=e||7)&&t.addF&&(t.add=Me(t.add,t.addF),t.addF=null),2&e&&t.remF&&(t.rem=Me(t.rem,t.remF),t.remF=null),4&e&&t.modF&&(t.mod=Me(t.mod,t.modF),t.modF=null),16&e&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,o=t;if(16&e)return Object(Ce.Ka)(n.source,n.srcF,o),n;1&e&&Object(Ce.Ka)(n.add,n.addF,o),2&e&&Object(Ce.Ka)(n.rem,n.remF,o),4&e&&Object(Ce.Ka)(n.mod,n.modF,o);const u=n.source;if(8&e&&u){const f=n.add.length+n.mod.length;f===u.length||(f?Object(Ce.Ka)(u,rt(n,5),o):Object(Ce.Ka)(u,n.srcF,o))}return n}},Object(Ce.z)(tn,ke,{fork(e){const t=new ke(this.dataflow).init(this,e&this.NO_FIELDS);return e!==void 0&&(e&t.ADD&&this.visit(t.ADD,n=>t.add.push(n)),e&t.REM&&this.visit(t.REM,n=>t.rem.push(n)),e&t.MOD&&this.visit(t.MOD,n=>t.mod.push(n))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?Object(Ce.B)(e)?e.some(o=>n[o]):n[e]:0},filter(){Object(Ce.o)("MultiPulse does not support filtering.")},materialize(){Object(Ce.o)("MultiPulse does not support materialization.")},visit(e,t){const n=this,o=n.pulses,u=o.length;let f=0;if(e&n.SOURCE)for(;f<u;++f)o[f].visit(e,t);else for(;f<u;++f)o[f].stamp===n.stamp&&o[f].visit(e,t);return n}});const Rt={skip:!1,force:!1};function Zt(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),mn(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let o;return t.length?(o=t[0],t[0]=n,function(u,f,g){const x=f,k=u.length,F=u[f];let V,X=1+(f<<1);for(;X<k;)(V=X+1)<k&&g(u[X],u[V])>=0&&(X=V),u[f]=u[X],X=1+((f=X)<<1);u[f]=F,mn(u,x,f,g)}(t,0,e)):o=n,o}}}function mn(e,t,n,o){let u,f;const g=e[n];for(;n>t&&o(g,u=e[f=n-1>>1])<0;)e[n]=u,n=f;return e[n]=g}function fn(){this.logger(Object(Ce.M)()),this.logLevel(Ce.b),this._clock=0,this._rank=0,this._locale=Object(Mr.a)();try{this._loader=Object(sr.e)()}catch{}this._touched=on(Ce.x),this._input={},this._pulse=null,this._heap=Zt((e,t)=>e.qrank-t.qrank),this._postrun=[]}function mt(e){return function(){return this._log[e].apply(this,arguments)}}function Mt(e,t){ir.call(this,e,null,t)}fn.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:mt("error"),warn:mt("warn"),info:mt("info"),debug:mt("debug"),logLevel:mt("level"),cleanThreshold:1e4,add:function(e,t,n,o){let u,f=1;return e instanceof ir?u=e:e&&e.prototype instanceof ir?u=new e:Object(Ce.E)(e)?u=new ir(null,e):(f=0,u=new ir(e,t)),this.rank(u),f&&(o=n,n=t),n&&this.connect(u,u.parameters(n,o)),this.touch(u),u},connect:function(e,t){const n=e.rank,o=t.length;for(let u=0;u<o;++u)if(n<t[u].rank)return void this.rerank(e)},rank:function(e){e.rank=++this._rank},rerank:function(e){const t=[e];let n,o,u;for(;t.length;)if(this.rank(n=t.pop()),o=n._targets)for(u=o.length;--u>=0;)t.push(n=o[u]),n===e&&Object(Ce.o)("Cycle detected in dataflow graph.")},pulse:function(e,t,n){this.touch(e,n||Rt);const o=new ke(this,this._clock+(this._pulse?0:1)),u=e.pulse&&e.pulse.source||[];return o.target=e,this._input[e.id]=t.pulse(o,u),this},touch:function(e,t){const n=t||Rt;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this},update:function(e,t,n){const o=n||Rt;return(e.set(t)||o.force)&&this.touch(e,o),this},changeset:dr,ingest:function(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))},parse:function(e,t){const n=this.locale();return Object(sr.f)(e,t,n.timeParse,n.utcParse)},preload:async function(e,t,n){const o=this,u=o._pending||function(g){let x;const k=new Promise(F=>x=F);return k.requests=0,k.done=()=>{--k.requests==0&&(g._pending=null,x(g))},g._pending=k}(o);u.requests+=1;const f=await o.request(t,n);return o.pulse(e,o.changeset().remove(Ce.Ia).insert(f.data||[])),u.done(),f},request:async function(e,t){const n=this;let o,u=0;try{o=await n.loader().load(e,{context:"dataflow",response:Object(sr.g)(t&&t.type)});try{o=n.parse(o,t)}catch(f){u=-2,n.warn("Data ingestion failed",e,f)}}catch(f){u=-1,n.warn("Loading failed",e,f)}return{data:o,status:u}},events:function(e,t,n,o){const u=this,f=Tt(n,o),g=function(F){F.dataflow=u;try{f.receive(F)}catch(V){u.error(V)}finally{u.run()}};let x;const k=(x=typeof e=="string"&&typeof document<"u"?document.querySelectorAll(e):Object(Ce.i)(e)).length;for(let F=0;F<k;++F)x[F].addEventListener(t,g);return f},on:function(e,t,n,o,u){return(e instanceof ir?Se:Qt)(this,e,t,n,o,u),this},evaluate:async function(e,t,n){const o=this,u=[];if(o._pulse)return Sn(o);if(o._pending&&await o._pending,t&&await Gt(o,t),!o._touched.length)return o.debug("Dataflow invoked, but nothing to do."),o;const f=++o._clock;o._pulse=new ke(o,f,e),o._touched.forEach(V=>o._enqueue(V,!0)),o._touched=on(Ce.x);let g,x,k,F=0;try{for(;o._heap.size()>0;)(g=o._heap.pop()).rank===g.qrank?((x=g.run(o._getPulse(g,e))).then?x=await x:x.async&&(u.push(x.async),x=ve),x!==ve&&g._targets&&g._targets.forEach(V=>o._enqueue(V)),++F):o._enqueue(g,!0)}catch(V){o._heap.clear(),k=V}if(o._input={},o._pulse=null,o.debug(`Pulse ${f}: ${F} operators`),k&&(o._postrun=[],o.error(k)),o._postrun.length){const V=o._postrun.sort((X,te)=>te.priority-X.priority);o._postrun=[];for(let X=0;X<V.length;++X)await Gt(o,V[X].callback)}return n&&await Gt(o,n),u.length&&Promise.all(u).then(V=>o.runAsync(null,()=>{V.forEach(X=>{try{X(o)}catch(te){o.error(te)}})})),o},run:function(e,t,n){return this._pulse?Sn(this):(this.evaluate(e,t,n),this)},runAsync:async function(e,t,n){for(;this._running;)await this._running;const o=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(o,o),this._running},runAfter:function(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(o){this.error(o)}},_enqueue:function(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))},_getPulse:function(e,t){const n=e.source,o=this._clock;return n&&Object(Ce.B)(n)?new tn(this,o,n.map(u=>u.pulse),t):this._input[e.id]||function(u,f){return f&&f.stamp===u.stamp?f:(u=u.fork(),f&&f!==ve&&(u.source=f.source),u)}(this._pulse,n&&n.pulse)}},Object(Ce.z)(Mt,ir,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),(t=t||e).then?t=t.then(n=>this.pulse=n):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const hn={};function nn(e){const t=He(e);return t&&t.Definition||null}function He(e){return e=e&&e.toLowerCase(),Object(Ce.w)(hn,e)?hn[e]:null}var Bn=r(87);function Xn(e,t){let n;if(t===void 0)for(const o of e)o!=null&&(n<o||n===void 0&&o>=o)&&(n=o);else{let o=-1;for(let u of e)(u=t(u,++o,e))!=null&&(n<u||n===void 0&&u>=u)&&(n=u)}return n}function Zn(e,t){let n;if(t===void 0)for(const o of e)o!=null&&(n>o||n===void 0&&o>=o)&&(n=o);else{let o=-1;for(let u of e)(u=t(u,++o,e))!=null&&(n>u||n===void 0&&u>=u)&&(n=u)}return n}function lr(e,t,n){const o=e[t];e[t]=e[n],e[n]=o}var jr=function(e){return e===null?NaN:+e};function Cr(e,t,n){if(o=(e=Float64Array.from(function*(x,k){if(k===void 0)for(let F of x)F!=null&&(F=+F)>=F&&(yield F);else{let F=-1;for(let V of x)(V=k(V,++F,x))!=null&&(V=+V)>=V&&(yield V)}}(e,n))).length){if((t=+t)<=0||o<2)return Zn(e);if(t>=1)return Xn(e);var o,u=(o-1)*t,f=Math.floor(u),g=Xn(function x(k,F,V=0,X=k.length-1,te=Bn.a){for(;X>V;){if(X-V>600){const Pe=X-V+1,Ue=F-V+1,We=Math.log(Pe),at=.5*Math.exp(2*We/3),st=.5*Math.sqrt(We*at*(Pe-at)/Pe)*(Ue-Pe/2<0?-1:1);x(k,F,Math.max(V,Math.floor(F-Ue*at/Pe+st)),Math.min(X,Math.floor(F+(Pe-Ue)*at/Pe+st)),te)}const ue=k[F];let he=V,be=X;for(lr(k,V,F),te(k[X],ue)>0&&lr(k,V,X);he<be;){for(lr(k,he,be),++he,--be;te(k[he],ue)<0;)++he;for(;te(k[be],ue)>0;)--be}te(k[V],ue)===0?lr(k,V,be):lr(k,++be,X),be<=F&&(V=be+1),F<=be&&(X=be-1)}return k}(e,f).subarray(0,f+1));return g+(Zn(e.subarray(f+1))-g)*(u-f)}}function xi(e,t,n=jr){if(o=e.length){if((t=+t)<=0||o<2)return+n(e[0],0,e);if(t>=1)return+n(e[o-1],o-1,e);var o,u=(o-1)*t,f=Math.floor(u),g=+n(e[f],f,e);return g+(+n(e[f+1],f+1,e)-g)*(u-f)}}var Ai=function(e,t){return Cr(e,.5,t)};function*ni(e,t){if(t==null)for(let n of e)n!=null&&n!==""&&(n=+n)>=n&&(yield n);else{let n=-1;for(let o of e)(o=t(o,++n,e))!=null&&o!==""&&(o=+o)>=o&&(yield o)}}function to(e,t,n){const o=Float64Array.from(ni(e,n));return o.sort(Bn.a),t.map(u=>xi(o,u))}function yi(e,t){return to(e,[.25,.5,.75],t)}function ri(e,t){const n=e.length,o=function(g,x){const k=function(F,V){let X,te=0,ue=0,he=0;if(V===void 0)for(let be of F)be!=null&&(be=+be)>=be&&(he+=(X=be-ue)*(be-(ue+=X/++te)));else{let be=-1;for(let Pe of F)(Pe=V(Pe,++be,F))!=null&&(Pe=+Pe)>=Pe&&(he+=(X=Pe-ue)*(Pe-(ue+=X/++te)))}if(te>1)return he/(te-1)}(g,x);return k&&Math.sqrt(k)}(e,t),u=yi(e,t),f=(u[2]-u[0])/1.34;return 1.06*(Math.min(o,f)||o||Math.abs(u[0])||1)*Math.pow(n,-.2)}function Jr(e){const t=e.maxbins||20,n=e.base||10,o=Math.log(n),u=e.divide||[5,2];let f,g,x,k,F,V,X=e.extent[0],te=e.extent[1];const ue=e.span||te-X||Math.abs(X)||1;if(e.step)f=e.step;else if(e.steps){for(k=ue/t,F=0,V=e.steps.length;F<V&&e.steps[F]<k;++F);f=e.steps[Math.max(0,F-1)]}else{for(g=Math.ceil(Math.log(t)/o),x=e.minstep||0,f=Math.max(x,Math.pow(n,Math.round(Math.log(ue)/o)-g));Math.ceil(ue/f)>t;)f*=n;for(F=0,V=u.length;F<V;++F)(k=f/u[F])>=x&&ue/k<=t&&(f=k)}const he=(k=Math.log(f))>=0?0:1+~~(-k/o),be=Math.pow(n,-he-1);return(e.nice||e.nice===void 0)&&(X=X<(k=Math.floor(X/f+be)*f)?k-f:k,te=Math.ceil(te/f)*f),{start:X,stop:te===X?X+f:te,step:f}}var Kn=Math.random;function pi(e){Kn=e}function Ci(e,t,n,o){if(!e.length)return[void 0,void 0];const u=Float64Array.from(ni(e,o)),f=u.length,g=t;let x,k,F,V;for(F=0,V=Array(g);F<g;++F){for(x=0,k=0;k<f;++k)x+=u[~~(Kn()*f)];V[F]=x/f}return V.sort(Bn.a),[Cr(V,n/2),Cr(V,1-n/2)]}function Wr(e,t,n,o){o=o||(te=>te);const u=e.length,f=new Float64Array(u);let g,x=0,k=1,F=o(e[0]),V=F,X=F+t;for(;k<u;++k){if((g=o(e[k]))>=X){for(V=(F+V)/2;x<k;++x)f[x]=V;X=g+t,F=g}V=g}for(V=(F+V)/2;x<k;++x)f[x]=V;return n?function(te,ue){const he=te.length;let be,Pe,Ue=0,We=1;for(;te[Ue]===te[We];)++We;for(;We<he;){for(be=We+1;te[We]===te[be];)++be;if(te[We]-te[We-1]<ue){for(Pe=We+(Ue+be-We-We>>1);Pe<We;)te[Pe++]=te[We];for(;Pe>We;)te[Pe--]=te[Ue]}Ue=We,We=be}return te}(f,t+t/4):f}function so(e){return function(){return(e=(1103515245*e+12345)%2147483647)/2147483647}}function Wi(e,t){let n,o,u;t==null&&(t=e,e=0);const f={min(g){return arguments.length?(u=o-(n=g||0),f):n},max(g){return arguments.length?(u=(o=g||0)-n,f):o},sample:()=>n+Math.floor(u*Kn()),pdf:g=>g===Math.floor(g)&&g>=n&&g<o?1/u:0,cdf(g){const x=Math.floor(g);return x<n?0:x>=o?1:(x-n+1)/u},icdf:g=>g>=0&&g<=1?n-1+Math.floor(g*u):NaN};return f.min(e).max(t)}const no=Math.sqrt(2*Math.PI),So=Math.SQRT2;let _a=NaN;function Ds(e,t){e=e||0,t=t??1;let n,o,u=0,f=0;if(_a==_a)u=_a,_a=NaN;else{do n=(u=2*Kn()-1)*u+(f=2*Kn()-1)*f;while(n===0||n>1);u*=o=Math.sqrt(-2*Math.log(n)/n),_a=f*o}return e+u*t}function Ch(e,t,n){n=n??1;const o=(e-(t||0))/n;return Math.exp(-.5*o*o)/(n*no)}function ro(e,t,n){const o=(e-(t=t||0))/(n=n??1),u=Math.abs(o);let f;if(u>37)f=0;else{const g=Math.exp(-u*u/2);u<7.07106781186547?(f=g*((((((.0352624965998911*u+.700383064443688)*u+6.37396220353165)*u+33.912866078383)*u+112.079291497871)*u+221.213596169931)*u+220.206867912376),f/=((((((.0883883476483184*u+1.75566716318264)*u+16.064177579207)*u+86.7807322029461)*u+296.564248779674)*u+637.333633378831)*u+793.826512519948)*u+440.413735824752):f=g/(u+1/(u+2/(u+3/(u+4/(u+.65)))))/2.506628274631}return o>0?1-f:f}function Mc(e,t,n){return e<0||e>1?NaN:(t||0)+(n??1)*So*function(o){let u,f=-Math.log((1-o)*(1+o));return f<6.25?u=1.6536545626831027+(u=.24015818242558962+(u=(u=(u=.00018673420803405714+(u=(u=(u=42347877827932404e-23+(u=(u=(u=10512122733215323e-25+(u=(u=(u=26335093153082323e-28+(u=(u=(u=6637638134358324e-30+(u=20972767875968562e-33+(u=(u=11157877678025181e-33+(u=128584807152564e-32+(u=(u=-364441206401782e-35)*(f-=3.125)-16850591381820166e-35)*f)*f)*f-1333171662854621e-31)*f)*f)*f-4054566272975207e-29)*f-8151934197605472e-29)*f)*f-12975133253453532e-27)*f-5415412054294628e-26)*f)*f-4112633980346984e-24)*f-29070369957882005e-24)*f)*f-13654692000834679e-22)*f-13882523362786469e-21)*f)*f-.000740702534166267)*f-.006033670871430149)*f)*f:f<16?(f=Math.sqrt(f)-3.25,u=3.0838856104922208+(u=1.0052589676941592+(u=.005370914553590064+(u=(u=.002491442096107851+(u=(u=.0009532893797373805+(u=(u=24031110387097894e-21+(u=6828485145957318e-20+(u=(u=12475304481671779e-21+(u=29234449089955446e-22+(u=(u=15027403968909828e-22+(u=18239629214389228e-24+(u=(u=9075656193888539e-23+(u=22137376921775787e-25)*f)*f-27517406297064545e-23)*f)*f)*f-4013867526981546e-21)*f)*f)*f-47318229009055734e-21)*f)*f)*f-.0003550375203628475)*f)*f-.0016882755560235047)*f)*f-.003751208507569241)*f)*f)*f):Number.isFinite(f)?(f=Math.sqrt(f)-5,u=4.849906401408584+(u=1.0103004648645344+(u=(u=(u=7599527703001776e-20+(u=(u=4526062597223154e-21+(u=(u=22900482228026655e-23+(u=(u=2914795345090108e-23+(u=(u=761570120807834e-23+(u=(u=15076572693500548e-25+(u=(u=-27109920616438573e-27)*f-2555641816996525e-25)*f)*f-3789465440126737e-24)*f)*f-1496002662714924e-23)*f)*f-6771199775845234e-23)*f)*f-99298272942317e-20)*f)*f-1968177810553167e-20)*f)*f-.00021503011930044477)*f-.00013871931833623122)*f)*f):u=1/0,u*o}(2*e-1)}function Gu(e,t){let n,o;const u={mean(f){return arguments.length?(n=f||0,u):n},stdev(f){return arguments.length?(o=f??1,u):o},sample:()=>Ds(n,o),pdf:f=>Ch(f,n,o),cdf:f=>ro(f,n,o),icdf:f=>Mc(f,n,o)};return u.mean(e).stdev(t)}function el(e,t){const n=Gu();let o=0;const u={data(f){return arguments.length?(e=f,o=f?f.length:0,u.bandwidth(t)):e},bandwidth(f){return arguments.length?(!(t=f)&&e&&(t=ri(e)),u):t},sample:()=>e[~~(Kn()*o)]+t*n.sample(),pdf(f){let g=0,x=0;for(;x<o;++x)g+=n.pdf((f-e[x])/t);return g/t/o},cdf(f){let g=0,x=0;for(;x<o;++x)g+=n.cdf((f-e[x])/t);return g/o},icdf(){throw Error("KDE icdf not supported.")}};return u.data(e)}function fc(e,t){return e=e||0,t=t??1,Math.exp(e+Ds()*t)}function tl(e,t,n){if(e<=0)return 0;t=t||0,n=n??1;const o=(Math.log(e)-t)/n;return Math.exp(-.5*o*o)/(n*no*e)}function Up(e,t,n){return ro(Math.log(e),t,n)}function xs(e,t,n){return Math.exp(Mc(e,t,n))}function dd(e,t){let n,o;const u={mean(f){return arguments.length?(n=f||0,u):n},stdev(f){return arguments.length?(o=f??1,u):o},sample:()=>fc(n,o),pdf:f=>tl(f,n,o),cdf:f=>Up(f,n,o),icdf:f=>xs(f,n,o)};return u.mean(e).stdev(t)}function Wp(e,t){let n,o=0;const u={weights(f){return arguments.length?(n=function(g){const x=[];let k,F=0;for(k=0;k<o;++k)F+=x[k]=g[k]==null?1:+g[k];for(k=0;k<o;++k)x[k]/=F;return x}(t=f||[]),u):t},distributions(f){return arguments.length?(f?(o=f.length,e=f):(o=0,e=[]),u.weights(t)):e},sample(){const f=Kn();let g=e[o-1],x=n[0],k=0;for(;k<o-1;x+=n[++k])if(f<x){g=e[k];break}return g.sample()},pdf(f){let g=0,x=0;for(;x<o;++x)g+=n[x]*e[x].pdf(f);return g},cdf(f){let g=0,x=0;for(;x<o;++x)g+=n[x]*e[x].cdf(f);return g},icdf(){throw Error("Mixture icdf not supported.")}};return u.distributions(e).weights(t)}function dc(e,t){return t==null&&(t=e??1,e=0),e+(t-e)*Kn()}function hd(e,t,n){return n==null&&(n=t??1,t=0),e>=t&&e<=n?1/(n-t):0}function kh(e,t,n){return n==null&&(n=t??1,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function nl(e,t,n){return n==null&&(n=t??1,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function hf(e,t){let n,o;const u={min(f){return arguments.length?(n=f||0,u):n},max(f){return arguments.length?(o=f??1,u):o},sample:()=>dc(n,o),pdf:f=>hd(f,n,o),cdf:f=>kh(f,n,o),icdf:f=>nl(f,n,o)};return t==null&&(t=e??1,e=0),u.min(e).max(t)}function Ha(e,t,n,o){const u=o-e*e,f=Math.abs(u)<1e-24?0:(n-e*t)/u;return[t-f*e,f]}function Tl(e,t,n,o){e=e.filter(ue=>{let he=t(ue),be=n(ue);return he!=null&&(he=+he)>=he&&be!=null&&(be=+be)>=be}),o&&e.sort((ue,he)=>t(ue)-t(he));const u=e.length,f=new Float64Array(u),g=new Float64Array(u);let x,k,F,V=0,X=0,te=0;for(F of e)f[V]=x=+t(F),g[V]=k=+n(F),X+=(x-X)/++V,te+=(k-te)/V;for(V=0;V<u;++V)f[V]-=X,g[V]-=te;return[f,g,X,te]}function ba(e,t,n,o){let u,f,g=-1;for(const x of e)u=t(x),f=n(x),u!=null&&(u=+u)>=u&&f!=null&&(f=+f)>=f&&o(u,f,++g)}function Dc(e,t,n,o,u){let f=0,g=0;return ba(e,t,n,(x,k)=>{const F=k-u(x),V=k-o;f+=F*F,g+=V*V}),1-f/g}function ws(e,t,n){let o=0,u=0,f=0,g=0,x=0;ba(e,t,n,(V,X)=>{o+=(V-o)/++x,u+=(X-u)/x,f+=(V*X-f)/x,g+=(V*V-g)/x});const k=Ha(o,u,f,g),F=V=>k[0]+k[1]*V;return{coef:k,predict:F,rSquared:Dc(e,t,n,u,F)}}function La(e,t,n){let o=0,u=0,f=0,g=0,x=0;ba(e,t,n,(V,X)=>{++x,V=Math.log(V),o+=(V-o)/x,u+=(X-u)/x,f+=(V*X-f)/x,g+=(V*V-g)/x});const k=Ha(o,u,f,g),F=V=>k[0]+k[1]*Math.log(V);return{coef:k,predict:F,rSquared:Dc(e,t,n,u,F)}}function Nc(e,t,n){const[o,u,f,g]=Tl(e,t,n);let x,k,F,V=0,X=0,te=0,ue=0,he=0;ba(e,t,n,(We,at)=>{x=o[he++],k=Math.log(at),V+=(at*k-V)/he,X+=((F=x*at)-X)/he,te+=(F*k-te)/he,ue+=(x*F-ue)/he});const[be,Pe]=Ha(X/g,V/g,te/g,ue/g),Ue=We=>Math.exp(be+Pe*(We-f));return{coef:[Math.exp(be-Pe*f),Pe],predict:Ue,rSquared:Dc(e,t,n,g,Ue)}}function pf(e,t,n){let o=0,u=0,f=0,g=0,x=0,k=0;ba(e,t,n,(X,te)=>{const ue=Math.log(X),he=Math.log(te);o+=(ue-o)/++k,u+=(he-u)/k,f+=(ue*he-f)/k,g+=(ue*ue-g)/k,x+=(te-x)/k});const F=Ha(o,u,f,g),V=X=>F[0]*Math.pow(X,F[1]);return F[0]=Math.exp(F[0]),{coef:F,predict:V,rSquared:Dc(e,t,n,x,V)}}function Ic(e,t,n){const[o,u,f,g]=Tl(e,t,n),x=o.length;let k,F,V,X,te=0,ue=0,he=0,be=0,Pe=0;for(k=0;k<x;)F=o[k],V=u[k++],te+=((X=F*F)-te)/k,ue+=(X*F-ue)/k,he+=(X*X-he)/k,be+=(F*V-be)/k,Pe+=(X*V-Pe)/k;const Ue=he-te*te,We=te*Ue-ue*ue,at=(Pe*te-be*ue)/We,st=(be*Ue-Pe*ue)/We,dt=-at*te,ct=kt=>at*(kt-=f)*kt+st*kt+dt+g;return{coef:[dt-st*f+at*f*f+g,st-2*at*f,at],predict:ct,rSquared:Dc(e,t,n,g,ct)}}function Iu(e,t,n,o){if(o===1)return ws(e,t,n);if(o===2)return Ic(e,t,n);const[u,f,g,x]=Tl(e,t,n),k=u.length,F=[],V=[],X=o+1;let te,ue,he,be,Pe;for(te=0;te<X;++te){for(he=0,be=0;he<k;++he)be+=Math.pow(u[he],te)*f[he];for(F.push(be),Pe=new Float64Array(X),ue=0;ue<X;++ue){for(he=0,be=0;he<k;++he)be+=Math.pow(u[he],te+ue);Pe[ue]=be}V.push(Pe)}V.push(F);const Ue=function(at){const st=at.length-1,dt=[];let ct,kt,St,yn,Mn;for(ct=0;ct<st;++ct){for(yn=ct,kt=ct+1;kt<st;++kt)Math.abs(at[ct][kt])>Math.abs(at[ct][yn])&&(yn=kt);for(St=ct;St<st+1;++St)Mn=at[St][ct],at[St][ct]=at[St][yn],at[St][yn]=Mn;for(kt=ct+1;kt<st;++kt)for(St=st;St>=ct;St--)at[St][kt]-=at[St][ct]*at[ct][kt]/at[ct][ct]}for(kt=st-1;kt>=0;--kt){for(Mn=0,St=kt+1;St<st;++St)Mn+=at[St][kt]*dt[St];dt[kt]=(at[st][kt]-Mn)/at[kt][kt]}return dt}(V),We=at=>{at-=g;let st=x+Ue[0]+Ue[1]*at+Ue[2]*at*at;for(te=3;te<X;++te)st+=Ue[te]*Math.pow(at,te);return st};return{coef:function(at,st,dt,ct){const kt=Array(at);let St,yn,Mn,_n;for(St=0;St<at;++St)kt[St]=0;for(St=at-1;St>=0;--St)for(Mn=st[St],_n=1,kt[St]+=Mn,yn=1;yn<=St;++yn)_n*=(St+1-yn)/yn,kt[St-yn]+=Mn*Math.pow(dt,yn)*_n;return kt[0]+=ct,kt}(X,Ue,-g,x),predict:We,rSquared:Dc(e,t,n,x,We)}}const Ah=2,pd=1e-12;function md(e,t,n,o){const[u,f,g,x]=Tl(e,t,n,!0),k=u.length,F=Math.max(2,~~(o*k)),V=new Float64Array(k),X=new Float64Array(k),te=new Float64Array(k).fill(1);for(let ue=-1;++ue<=Ah;){const he=[0,F-1];for(let Pe=0;Pe<k;++Pe){const Ue=u[Pe],We=he[0],at=he[1],st=Ue-u[We]>u[at]-Ue?We:at;let dt=0,ct=0,kt=0,St=0,yn=0;const Mn=1/Math.abs(u[st]-Ue||1);for(let qn=We;qn<=at;++qn){const er=u[qn],rr=f[qn],fr=Ea(Math.abs(Ue-er)*Mn)*te[qn],Dr=er*fr;dt+=fr,ct+=Dr,kt+=rr*fr,St+=rr*Dr,yn+=er*Dr}const[_n,$n]=Ha(ct/dt,kt/dt,St/dt,yn/dt);V[Pe]=_n+$n*Ue,X[Pe]=Math.abs(f[Pe]-V[Pe]),Oh(u,Pe+1,he)}if(ue===Ah)break;const be=Ai(X);if(Math.abs(be)<pd)break;for(let Pe,Ue,We=0;We<k;++We)Pe=X[We]/(6*be),te[We]=Pe>=1?pd:(Ue=1-Pe*Pe)*Ue}return function(ue,he,be,Pe){const Ue=ue.length,We=[];let at,st=0,dt=0,ct=[];for(;st<Ue;++st)at=ue[st]+be,ct[0]===at?ct[1]+=(he[st]-ct[1])/++dt:(dt=0,ct[1]+=Pe,ct=[at,he[st]],We.push(ct));return ct[1]+=Pe,We}(u,V,g,x)}function Ea(e){return(e=1-e*e*e)*e*e}function Oh(e,t,n){const o=e[t];let u=n[0],f=n[1]+1;if(!(f>=e.length))for(;t>u&&e[f]-o<=o-e[u];)n[0]=++u,n[1]=f,++f}const Vp=.5*Math.PI/180;function gd(e,t,n,o){n=n||25,o=Math.max(n,o||200);const u=be=>[be,e(be)],f=t[0],g=t[1],x=g-f,k=x/o,F=[u(f)],V=[];if(n===o){for(let be=1;be<o;++be)F.push(u(f+be/n*x));return F.push(u(g)),F}V.push(u(g));for(let be=n;--be>0;)V.push(u(f+be/n*x));let X=F[0],te=V[V.length-1];const ue=1/x,he=function(be,Pe){let Ue=be,We=be;const at=Pe.length;for(let st=0;st<at;++st){const dt=Pe[st][1];dt<Ue&&(Ue=dt),dt>We&&(We=dt)}return 1/(We-Ue)}(X[1],V);for(;te;){const be=u((X[0]+te[0])/2);be[0]-X[0]>=k&&vd(X,be,te,ue,he)>Vp?V.push(be):(X=te,F.push(te),V.pop()),te=V[V.length-1]}return F}function vd(e,t,n,o,u){const f=Math.atan2(u*(n[1]-e[1]),o*(n[0]-e[0])),g=Math.atan2(u*(t[1]-e[1]),o*(t[0]-e[0]));return Math.abs(f-g)}var Ns=function(e,t,n){e=+e,t=+t,n=(u=arguments.length)<2?(t=e,e=0,1):u<3?1:+n;for(var o=-1,u=0|Math.max(0,Math.ceil((t-e)/n)),f=new Array(u);++o<u;)f[o]=e+o*n;return f},yd=r(108),br=r(11);function qu(e){return e&&e.length?e.length===1?e[0]:function(t){return n=>{const o=t.length;let u=1,f=String(t[0](n));for(;u<o;++u)f+="|"+t[u](n);return f}}(e):function(){return""}}function Qm(e,t,n){return n||e+(t?"_"+t:"")}const Zm=()=>{},bd={init:Zm,add:Zm,rem:Zm,idx:0},mf={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||e.min===void 0)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||e.max===void 0)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},Hp=Object.keys(mf);function Th(e,t){return mf[e](t)}function Mh(e,t){return e.idx-t.idx}function qi(){this.valid=0,this.missing=0,this._ops.forEach(e=>e.init(this))}function zo(e,t){e!=null&&e!==""?e==e&&(++this.valid,this._ops.forEach(n=>n.add(this,e,t))):++this.missing}function Dh(e,t){e!=null&&e!==""?e==e&&(--this.valid,this._ops.forEach(n=>n.rem(this,e,t))):--this.missing}function Yg(e){return this._out.forEach(t=>e[t.out]=t.value(this)),e}function xd(e,t){const n=t||Ce.y,o=function(g){const x={};g.forEach(F=>x[F.name]=F);const k=F=>{F.req&&F.req.forEach(V=>{x[V]||k(x[V]=mf[V]())})};return g.forEach(k),Object.values(x).sort(Mh)}(e),u=e.slice().sort(Mh);function f(g){this._ops=o,this._out=u,this.cell=g,this.init()}return f.prototype.init=qi,f.prototype.add=zo,f.prototype.rem=Dh,f.prototype.set=Yg,f.prototype.get=n,f.fields=e.map(g=>g.out),f}function Gp(e){this._key=e?Object(Ce.u)(e):en,this.reset()}Hp.forEach(e=>{mf[e]=function(t,n){return o=>Object(Ce.p)({name:t,out:o||t},bd,n)}(e,mf[e])});const Is=Gp.prototype;function Fc(e){Mt.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}Is.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},Is.add=function(e){this._add.push(e)},Is.rem=function(e){this._rem.push(e)},Is.values=function(){if(this._get=null,this._rem.length===0)return this._add;const e=this._add,t=this._rem,n=this._key,o=e.length,u=t.length,f=Array(o-u),g={};let x,k,F;for(x=0;x<u;++x)g[n(t[x])]=1;for(x=0,k=0;x<o;++x)g[n(F=e[x])]?g[n(F)]=0:f[k++]=F;return this._rem=[],this._add=f},Is.distinct=function(e){const t=this.values(),n={};let o,u=t.length,f=0;for(;--u>=0;)o=e(t[u])+"",Object(Ce.w)(n,o)||(n[o]=1,++f);return f},Is.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=Object(Ce.r)(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},Is.argmin=function(e){return this.extent(e)[0]||{}},Is.argmax=function(e){return this.extent(e)[1]||{}},Is.min=function(e){const t=this.extent(e)[0];return t!=null?e(t):void 0},Is.max=function(e){const t=this.extent(e)[1];return t!=null?e(t):void 0},Is.quartile=function(e){return this._get===e&&this._q||(this._q=yi(this.values(),e),this._get=e),this._q},Is.q1=function(e){return this.quartile(e)[0]},Is.q2=function(e){return this.quartile(e)[1]},Is.q3=function(e){return this.quartile(e)[2]},Is.ci=function(e){return this._get===e&&this._ci||(this._ci=Ci(this.values(),1e3,.05,e),this._get=e),this._ci},Is.ci0=function(e){return this.ci(e)[0]},Is.ci1=function(e){return this.ci(e)[1]},Fc.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Hp},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},Object(Ce.z)(Fc,Mt,{transform(e,t){const n=this,o=t.fork(t.NO_SOURCE|t.NO_FIELDS),u=e.modified();return n.stamp=o.stamp,n.value&&(u||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=u?n.init(e):{},t.visit(t.SOURCE,f=>n.add(f))):(n.value=n.value||n.init(e),t.visit(t.REM,f=>n.rem(f)),t.visit(t.ADD,f=>n.add(f))),o.modifies(n._outputs),n._drop=e.drop!==!1,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&o.clean(!0).runAfter(()=>this.clean()),n.changes(o)},cross(){const e=this,t=e.value,n=e._dnames,o=n.map(()=>({})),u=n.length;function f(g){let x,k,F,V;for(x in g)for(F=g[x].tuple,k=0;k<u;++k)o[k][V=F[n[k]]]=V}f(e._prev),f(t),function g(x,k,F){const V=n[F],X=o[F++];for(const te in X){const ue=x?x+"|"+te:te;k[V]=X[te],F<u?g(ue,k,F):t[ue]||e.cell(ue,k)}}("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],o={};function u(Pe){const Ue=Object(Ce.i)(Object(Ce.g)(Pe)),We=Ue.length;let at,st=0;for(;st<We;++st)o[at=Ue[st]]||(o[at]=1,t.push(at))}this._dims=Object(Ce.i)(e.groupby),this._dnames=this._dims.map(Pe=>{const Ue=Object(Ce.h)(Pe);return u(Pe),n.push(Ue),Ue}),this.cellkey=e.key?e.key:qu(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const f=e.fields||[null],g=e.ops||["count"],x=e.as||[],k=f.length,F={};let V,X,te,ue,he,be;for(k!==g.length&&Object(Ce.o)("Unmatched number of fields and aggregate ops."),be=0;be<k;++be)V=f[be],X=g[be],V==null&&X!=="count"&&Object(Ce.o)("Null aggregate field specified."),he=Qm(X,ue=Object(Ce.h)(V),x[be]),n.push(he),X!=="count"?((te=F[ue])||(u(V),(te=F[ue]=[]).field=V,this._measures.push(te)),X!=="count"&&(this._countOnly=!1),te.push(Th(X,he))):this._counts.push(he);return this._measures=this._measures.map(Pe=>xd(Pe,Pe.field)),{}},cellkey:qu(),cell(e,t){let n=this.value[e];return n?n.num===0&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const o=this._measures,u=o.length;n.agg=Array(u);for(let f=0;f<u;++f)n.agg[f]=new o[f](n)}return n.store&&(n.data=new Gp),n},newtuple(e,t){const n=this._dnames,o=this._dims,u=o.length,f={};for(let g=0;g<u;++g)f[n[g]]=o[g](e);return t?ar(t.tuple,f):Dt(f)},clean(){const e=this.value;for(const t in e)e[t].num===0&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const o=n.agg;for(let u=0,f=o.length;u<f;++u)o[u].add(o[u].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const o=n.agg;for(let u=0,f=o.length;u<f;++u)o[u].rem(o[u].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let o=0,u=n.length;o<u;++o)t[n[o]]=e.num;if(!this._countOnly){const o=e.agg;for(let u=0,f=o.length;u<f;++u)o[u].set(t)}return t},changes(e){const t=this._adds,n=this._mods,o=this._prev,u=this._drop,f=e.add,g=e.rem,x=e.mod;let k,F,V,X;if(o)for(F in o)k=o[F],u&&!k.num||g.push(k.tuple);for(V=0,X=this._alen;V<X;++V)f.push(this.celltuple(t[V])),t[V]=null;for(V=0,X=this._mlen;V<X;++V)((k=n[V]).num===0&&u?g:x).push(this.celltuple(k)),n[V]=null;return this._alen=this._mlen=0,this._prev=null,e}});function qp(e){Mt.call(this,null,e)}function eg(e,t,n){const o=e;let u=t||[],f=n||[],g={},x=0;return{add:k=>f.push(k),remove:k=>g[o(k)]=++x,size:()=>u.length,data:(k,F)=>(x&&(u=u.filter(V=>!g[o(V)]),g={},x=0),F&&k&&u.sort(k),f.length&&(u=k?Object(Ce.O)(k,u,f.sort(k)):u.concat(f),f=[]),u)}}function tg(e){Mt.call(this,[],e)}function Jg(e){ir.call(this,null,Qg,e)}function Qg(e){return this.value&&!e.modified()?this.value:Object(Ce.l)(e.fields,e.orders)}function Ml(e){Mt.call(this,null,e)}function Qa(e){Mt.call(this,null,e)}qp.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},Object(Ce.z)(qp,Mt,{transform(e,t){const n=e.interval!==!1,o=this._bins(e),u=o.start,f=o.step,g=e.as||["bin0","bin1"],x=g[0],k=g[1];let F;return F=e.modified()?(t=t.reflow(!0)).SOURCE:t.modified(Object(Ce.g)(e.field))?t.ADD_MOD:t.ADD,t.visit(F,n?V=>{const X=o(V);V[x]=X,V[k]=X==null?null:u+f*(1+(X-u)/f)}:V=>V[x]=o(V)),t.modifies(n?g:x)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=Jr(e),o=n.step;let u,f,g=n.start,x=g+Math.ceil((n.stop-g)/o)*o;(u=e.anchor)!=null&&(f=u-(g+o*Math.floor((u-g)/o)),g+=f,x+=f);const k=function(F){let V=Object(Ce.Ea)(t(F));return V==null?null:V<g?-1/0:V>x?1/0:(V=Math.max(g,Math.min(V,x-o)),g+o*Math.floor(1e-14+(V-g)/o))};return k.start=g,k.stop=n.stop,k.step=o,this.value=Object(Ce.f)(k,Object(Ce.g)(t),e.name||"bin_"+Object(Ce.h)(t))}}),tg.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},Object(Ce.z)(tg,Mt,{transform(e,t){const n=t.fork(t.ALL),o=eg(en,this.value,n.materialize(n.ADD).add),u=e.sort,f=t.changed()||u&&(e.modified("sort")||t.modified(u.fields));return n.visit(n.REM,o.remove),this.modified(f),this.value=n.source=o.data(yr(u),f),t.source&&t.source.root&&(this.value.root=t.source.root),n}}),Object(Ce.z)(Jg,ir),Ml.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]},Object(Ce.z)(Ml,Mt,{transform(e,t){const n=X=>te=>{for(var ue,he=function(Ue,We,at){switch(We){case"upper":Ue=Ue.toUpperCase();break;case"lower":Ue=Ue.toLowerCase()}return Ue.match(at)}(x(te),e.case,f)||[],be=0,Pe=he.length;be<Pe;++be)g.test(ue=he[be])||X(ue)},o=this._parameterCheck(e,t),u=this._counts,f=this._match,g=this._stop,x=e.field,k=e.as||["text","count"],F=n(X=>u[X]=1+(u[X]||0)),V=n(X=>u[X]-=1);return o?t.visit(t.SOURCE,F):(t.visit(t.ADD,F),t.visit(t.REM,V)),this._finish(t,k)},_parameterCheck(e,t){let n=!1;return!e.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),!e.modified("pattern")&&this._match||(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,o=this._tuples||(this._tuples={}),u=t[0],f=t[1],g=e.fork(e.NO_SOURCE|e.NO_FIELDS);let x,k,F;for(x in n)k=o[x],F=n[x]||0,!k&&F?(o[x]=k=Dt({}),k[u]=x,k[f]=F,g.add.push(k)):F===0?(k&&g.rem.push(k),n[x]=null,o[x]=null):k[f]!==F&&(k[f]=F,g.mod.push(k));return g.modifies(t)}}),Qa.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},Object(Ce.z)(Qa,Mt,{transform(e,t){const n=t.fork(t.NO_SOURCE),o=e.as||["a","b"],u=o[0],f=o[1],g=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let x=this.value;return g?(x&&(n.rem=x),x=t.materialize(t.SOURCE).source,n.add=this.value=function(k,F,V,X){for(var te,ue,he=[],be={},Pe=k.length,Ue=0;Ue<Pe;++Ue)for(be[F]=ue=k[Ue],te=0;te<Pe;++te)be[V]=k[te],X(be)&&(he.push(Dt(be)),(be={})[F]=ue);return he}(x,u,f,e.filter||Ce.Ia)):n.mod=x,n.source=this.value,n.modifies(o)}});const Nh={kde:el,mixture:Wp,normal:Gu,lognormal:dd,uniform:hf},Ze="distributions",hc="function",wd="field";function $p(e){Mt.call(this,null,e)}const Po=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],Lo={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:Po},{name:"weights",type:"number",array:!0}]};function ia(e,t){return e?e.map((n,o)=>t[o]||Object(Ce.h)(n)):null}function Ba(e,t,n){const o=[],u=X=>X(k);let f,g,x,k,F,V;if(t==null)o.push(e.map(n));else for(f={},g=0,x=e.length;g<x;++g)k=e[g],(V=f[F=t.map(u)])||(f[F]=V=[],V.dims=F,o.push(V)),V.push(n(k));return o}$p.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:Po.concat(Lo)},{name:"as",type:"string",array:!0,default:["value","density"]}]},Object(Ce.z)($p,Mt,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const o=function F(V,X){const te=V[hc];Object(Ce.w)(Nh,te)||Object(Ce.o)("Unknown distribution function: "+te);const ue=Nh[te]();for(const he in V)he===wd?ue.data((V.from||X()).map(V[he])):he===Ze?ue[he](V[he].map(be=>F(be,X))):typeof ue[he]===hc&&ue[he](V[he]);return ue}(e.distribution,function(F){return()=>F.materialize(F.SOURCE).source}(t)),u=e.steps||e.minsteps||25,f=e.steps||e.maxsteps||200;let g=e.method||"pdf";g!=="pdf"&&g!=="cdf"&&Object(Ce.o)("Invalid density method: "+g),e.extent||o.data||Object(Ce.o)("Missing density extent parameter."),g=o[g];const x=e.as||["value","density"],k=gd(g,e.extent||Object(Ce.q)(o.data()),u,f).map(F=>{const V={};return V[x[0]]=F[0],V[x[1]]=F[1],Dt(V)});this.value&&(n.rem=this.value),this.value=n.add=n.source=k}return n}});function $u(e){Mt.call(this,null,e)}$u.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]};function ja(e){ir.call(this,null,rl,e),this.modified(!0)}function rl(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:Object(Ce.f)(n=>t(n,e),Object(Ce.g)(t),Object(Ce.h)(t))}function _u(e){Mt.call(this,[void 0,void 0],e)}function Lt(e,t){ir.call(this,e),this.parent=t,this.count=0}function Co(e){Mt.call(this,{},e),this._keys=Object(Ce.t)();const t=this._targets=[];t.active=0,t.forEach=n=>{for(let o=0,u=t.active;o<u;++o)n(t[o],o,t)}}function xa(e){ir.call(this,null,Za,e)}function Za(e){return this.value&&!e.modified()?this.value:Object(Ce.B)(e.name)?Object(Ce.i)(e.name).map(t=>Object(Ce.u)(t)):Object(Ce.u)(e.name,e.as)}function No(e){Mt.call(this,Object(Ce.t)(),e)}function Fs(e){Mt.call(this,[],e)}function Ar(e){Mt.call(this,[],e)}function au(e){Mt.call(this,null,e)}function Eu(e){Mt.call(this,[],e)}Object(Ce.z)($u,Mt,{transform(e,t){if(this.value&&!e.modified()&&!t.changed())return t;const n=t.materialize(t.SOURCE).source,o=Ba(t.source,e.groupby,Ce.y),u=e.smooth||!1,f=e.field,g=e.step||((he,be)=>Object(Ce.Z)(Object(Ce.q)(he,be))/30)(n,f),x=yr((he,be)=>f(he)-f(be)),k=e.as||"bin",F=o.length;let V,X=1/0,te=-1/0,ue=0;for(;ue<F;++ue){const he=o[ue].sort(x);V=-1;for(const be of Wr(he,g,u,f))be<X&&(X=be),be>te&&(te=be),he[++V][k]=be}return this.value={start:X,stop:te,step:g},t.reflow(!0).modifies(k)}}),Object(Ce.z)(ja,ir),_u.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},Object(Ce.z)(_u,Mt,{transform(e,t){const n=this.value,o=e.field,u=t.changed()||t.modified(o.fields)||e.modified("field");let f=n[0],g=n[1];if((u||f==null)&&(f=1/0,g=-1/0),t.visit(u?t.SOURCE:t.ADD,x=>{const k=Object(Ce.Ea)(o(x));k!=null&&(k<f&&(f=k),k>g&&(g=k))}),!Number.isFinite(f)||!Number.isFinite(g)){let x=Object(Ce.h)(o);x&&(x=` for field "${x}"`),t.dataflow.warn(`Infinite extent${x}: [${f}, ${g}]`),f=g=void 0}this.value=[f,g]}}),Object(Ce.z)(Lt,ir,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}}),Object(Ce.z)(Co,Mt,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,o){const u=this.value;let f,g,x=Object(Ce.w)(u,e)&&u[e];return x?x.value.stamp<n.stamp&&(x.init(n),this.activate(x)):(g=o||(g=this._group[e])&&g.tuple,f=n.dataflow,x=new Lt(n.fork(n.NO_SOURCE),this),f.add(x).connect(t(f,e,g)),u[e]=x,this.activate(x)),x},clean(){const e=this.value;let t=0;for(const n in e)if(e[n].count===0){const o=e[n].detachSubflow;o&&o(),delete e[n],++t}if(t){const n=this._targets.filter(o=>o&&o.count>0);this.initTargets(n)}},initTargets(e){const t=this._targets,n=t.length,o=e?e.length:0;let u=0;for(;u<o;++u)t[u]=e[u];for(;u<n&&t[u]!=null;++u)t[u]=null;t.active=o},transform(e,t){const n=t.dataflow,o=e.key,u=e.subflow,f=this._keys,g=e.modified("key"),x=k=>this.subflow(k,u,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,k=>{const F=en(k),V=f.get(F);V!==void 0&&(f.delete(F),x(V).rem(k))}),t.visit(t.ADD,k=>{const F=o(k);f.set(en(k),F),x(F).add(k)}),g||t.modified(o.fields)?t.visit(t.MOD,k=>{const F=en(k),V=f.get(F),X=o(k);V===X?x(X).mod(k):(f.set(F,X),x(V).rem(k),x(X).add(k))}):t.changed(t.MOD)&&t.visit(t.MOD,k=>{x(f.get(en(k))).mod(k)}),g&&t.visit(t.REFLOW,k=>{const F=en(k),V=f.get(F),X=o(k);V!==X&&(f.set(F,X),x(V).rem(k),x(X).add(k))}),t.clean()?n.runAfter(()=>{this.clean(),f.clean()}):f.empty>n.cleanThreshold&&n.runAfter(f.clean),t}}),Object(Ce.z)(xa,ir),No.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},Object(Ce.z)(No,Mt,{transform(e,t){const n=t.dataflow,o=this.value,u=t.fork(),f=u.add,g=u.rem,x=u.mod,k=e.expr;let F=!0;function V(X){const te=en(X),ue=k(X,e),he=o.get(te);ue&&he?(o.delete(te),f.push(X)):ue||he?F&&ue&&!he&&x.push(X):(o.set(te,1),g.push(X))}return t.visit(t.REM,X=>{const te=en(X);o.has(te)?o.delete(te):g.push(X)}),t.visit(t.ADD,X=>{k(X,e)?f.push(X):o.set(en(X),1)}),t.visit(t.MOD,V),e.modified()&&(F=!1,t.visit(t.REFLOW,V)),o.empty>n.cleanThreshold&&n.runAfter(o.clean),u}}),Fs.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},Object(Ce.z)(Fs,Mt,{transform(e,t){const n=t.fork(t.NO_SOURCE),o=e.fields,u=ia(o,e.as||[]),f=e.index||null,g=u.length;return n.rem=this.value,t.visit(t.SOURCE,x=>{const k=o.map(he=>he(x)),F=k.reduce((he,be)=>Math.max(he,be.length),0);let V,X,te,ue=0;for(;ue<F;++ue){for(X=On(x),V=0;V<g;++V)X[u[V]]=(te=k[V][ue])==null?null:te;f&&(X[f]=ue),n.add.push(X)}}),this.value=n.source=n.add,f&&n.modifies(f),n.modifies(u)}}),Ar.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},Object(Ce.z)(Ar,Mt,{transform(e,t){const n=t.fork(t.NO_SOURCE),o=e.fields,u=o.map(Ce.h),f=e.as||["key","value"],g=f[0],x=f[1],k=o.length;return n.rem=this.value,t.visit(t.SOURCE,F=>{for(let V,X=0;X<k;++X)(V=On(F))[g]=u[X],V[x]=o[X](F),n.add.push(V)}),this.value=n.source=n.add,n.modifies(f)}}),au.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},Object(Ce.z)(au,Mt,{transform(e,t){const n=e.expr,o=e.as,u=e.modified(),f=e.initonly?t.ADD:u?t.SOURCE:t.modified(n.fields)||t.modified(o)?t.ADD_MOD:t.ADD;return u&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(o),t.visit(f,g=>g[o]=n(g,e))}}),Object(Ce.z)(Eu,Mt,{transform(e,t){const n=t.fork(t.ALL),o=e.generator;let u,f,g,x=this.value,k=e.size-x.length;if(k>0){for(u=[];--k>=0;)u.push(g=Dt(o(e))),x.push(g);n.add=n.add.length?n.materialize(n.ADD).add.concat(u):u}else f=x.slice(0,-k),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(f):f,x=x.slice(-k);return n.source=this.value=x,n}});const Dl={value:"value",median:Ai,mean:function(e,t){let n=0,o=0;if(t===void 0)for(let u of e)u!=null&&(u=+u)>=u&&(++n,o+=u);else{let u=-1;for(let f of e)(f=t(f,++u,e))!=null&&(f=+f)>=f&&(++n,o+=f)}if(n)return o/n},min:Zn,max:Xn},su=[];function Ih(e){Mt.call(this,[],e)}function Xp(e){Fc.call(this,e)}function Kp(e){Mt.call(this,null,e)}function Fu(e){ir.call(this,null,uo,e)}function uo(e){return this.value&&!e.modified()?this.value:Object(Ce.K)(e.fields,e.flat)}function Rs(e){Mt.call(this,[],e),this._pending=null}function Fh(e,t,n){n.forEach(Dt);const o=t.fork(t.NO_FIELDS&t.NO_SOURCE);return o.rem=e.value,e.value=o.source=o.add=n,e._pending=null,o.rem.length&&o.clean(!0),o}function Rc(e){Mt.call(this,{},e)}function _s(e){ir.call(this,null,vi,e)}function vi(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let o,u,f=1/0,g=-1/0;for(o=0;o<n;++o)(u=t[o])[0]<f&&(f=u[0]),u[1]>g&&(g=u[1]);return[f,g]}function $o(e){ir.call(this,null,Rh,e)}function Rh(e){return this.value&&!e.modified()?this.value:e.values.reduce((t,n)=>t.concat(n),[])}function Yp(e){Mt.call(this,null,e)}function gf(e){Fc.call(this,e)}function Ph(e){Co.call(this,e)}function $i(e){Mt.call(this,null,e)}function Ii(e){Mt.call(this,null,e)}function ma(e){Mt.call(this,null,e)}Ih.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},Object(Ce.z)(Ih,Mt,{transform(e,t){var n,o,u,f,g,x,k,F,V,X,te=t.fork(t.ALL),ue=function(ct){var kt,St=ct.method||Dl.value;if(Dl[St]!=null)return St===Dl.value?(kt=ct.value!==void 0?ct.value:0,()=>kt):Dl[St];Object(Ce.o)("Unrecognized imputation method: "+St)}(e),he=function(ct){const kt=ct.field;return St=>St?kt(St):NaN}(e),be=Object(Ce.h)(e.field),Pe=Object(Ce.h)(e.key),Ue=(e.groupby||[]).map(Ce.h),We=function(ct,kt,St,yn){var Mn,_n,$n,qn,er,rr,fr,Dr,Zr=Zi=>Zi(Dr),Br=[],di=yn?yn.slice():[],Ti={},Di={};for(di.forEach((Zi,Ri)=>Ti[Zi]=Ri+1),qn=0,fr=ct.length;qn<fr;++qn)Dr=ct[qn],rr=St(Dr),er=Ti[rr]||(Ti[rr]=di.push(rr)),_n=(Mn=kt?kt.map(Zr):su)+"",($n=Di[_n])||($n=Di[_n]=[],Br.push($n),$n.values=Mn),$n[er-1]=Dr;return Br.domain=di,Br}(t.source,e.groupby,e.key,e.keyvals),at=[],st=this.value,dt=We.domain.length;for(g=0,F=We.length;g<F;++g)for(u=(n=We[g]).values,o=NaN,k=0;k<dt;++k)if(n[k]==null){for(f=We.domain[k],X={_impute:!0},x=0,V=u.length;x<V;++x)X[Ue[x]]=u[x];X[Pe]=f,X[be]=Number.isNaN(o)?o=ue(n,he):o,at.push(Dt(X))}return at.length&&(te.add=te.materialize(te.ADD).add.concat(at)),st.length&&(te.rem=te.materialize(te.REM).rem.concat(st)),this.value=at,te}}),Xp.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:Hp},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},Object(Ce.z)(Xp,Fc,{transform(e,t){const n=this,o=e.modified();let u;return n.value&&(o||t.modified(n._inputs,!0))?(u=n.value=o?n.init(e):{},t.visit(t.SOURCE,f=>n.add(f))):(u=n.value=n.value||this.init(e),t.visit(t.REM,f=>n.rem(f)),t.visit(t.ADD,f=>n.add(f))),n.changes(),t.visit(t.SOURCE,f=>{Object(Ce.p)(f,u[n.cellkey(f)].tuple)}),t.reflow(o).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,o;for(n=0,o=this._alen;n<o;++n)this.celltuple(e[n]),e[n]=null;for(n=0,o=this._mlen;n<o;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}}),Kp.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},Object(Ce.z)(Kp,Mt,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const o=t.materialize(t.SOURCE).source,u=Ba(o,e.groupby,e.field),f=(e.groupby||[]).map(Ce.h),g=e.bandwidth,x=e.cumulative?"cdf":"pdf",k=e.as||["value","density"],F=[];let V=e.extent,X=e.steps||e.minsteps||25,te=e.steps||e.maxsteps||200;x!=="pdf"&&x!=="cdf"&&Object(Ce.o)("Invalid density method: "+x),e.resolve==="shared"&&(V||(V=Object(Ce.q)(o,e.field)),X=te=e.steps||te),u.forEach(ue=>{const he=el(ue,g)[x],be=e.counts?ue.length:1;gd(he,V||Object(Ce.q)(ue),X,te).forEach(Pe=>{const Ue={};for(let We=0;We<f.length;++We)Ue[f[We]]=ue.dims[We];Ue[k[0]]=Pe[0],Ue[k[1]]=Pe[1]*be,F.push(Dt(Ue))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=F}return n}}),Object(Ce.z)(Fu,ir),Object(Ce.z)(Rs,Mt,{transform(e,t){const n=t.dataflow;return this._pending?Fh(this,t,this._pending):function(o){return o.modified("async")&&!(o.modified("values")||o.modified("url")||o.modified("format"))}(e)?t.StopPropagation:e.values?Fh(this,t,n.parse(e.values,e.format)):e.async?{async:n.request(e.url,e.format).then(o=>(this._pending=Object(Ce.i)(o.data),u=>u.touch(this)))}:n.request(e.url,e.format).then(o=>Fh(this,t,Object(Ce.i)(o.data)))}}),Rc.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},Object(Ce.z)(Rc,Mt,{transform(e,t){const n=e.fields,o=e.index,u=e.values,f=e.default==null?null:e.default,g=e.modified(),x=n.length;let k,F,V=g?t.SOURCE:t.ADD,X=t,te=e.as;return u?(F=u.length,x>1&&!te&&Object(Ce.o)('Multi-field lookup requires explicit "as" parameter.'),te&&te.length!==x*F&&Object(Ce.o)('The "as" parameter has too few output field names.'),te=te||u.map(Ce.h),k=function(ue){for(var he,be,Pe=0,Ue=0;Pe<x;++Pe)if((be=o.get(n[Pe](ue)))==null)for(he=0;he<F;++he,++Ue)ue[te[Ue]]=f;else for(he=0;he<F;++he,++Ue)ue[te[Ue]]=u[he](be)}):(te||Object(Ce.o)("Missing output field names."),k=function(ue){for(var he,be=0;be<x;++be)he=o.get(n[be](ue)),ue[te[be]]=he??f}),g?X=t.reflow(!0):V|=n.some(ue=>t.modified(ue.fields))?t.MOD:0,t.visit(V,k),X.modifies(te)}}),Object(Ce.z)(_s,ir),Object(Ce.z)($o,ir),Object(Ce.z)(Yp,Mt,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),gf.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:Hp,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},Object(Ce.z)(gf,Fc,{_transform:Fc.prototype.transform,transform(e,t){return this._transform(function(n,o){const u=n.field,f=n.value,g=(n.op==="count"?"__count__":n.op)||"sum",x=Object(Ce.g)(u).concat(Object(Ce.g)(f)),k=function(F,V,X){const te={},ue=[];return X.visit(X.SOURCE,he=>{const be=F(he);te[be]||(te[be]=1,ue.push(be))}),ue.sort(Ce.j),V?ue.slice(0,V):ue}(u,n.limit||0,o);return o.changed()&&n.set("__pivot__",null,null,!0),{key:n.key,groupby:n.groupby,ops:k.map(()=>g),fields:k.map(F=>function(V,X,te,ue){return Object(Ce.f)(he=>X(he)===V?te(he):NaN,ue,V+"")}(F,u,f,x)),as:k.map(F=>F+""),modified:n.modified.bind(n)}}(e,t),t)}}),Object(Ce.z)(Ph,Co,{transform(e,t){const n=e.subflow,o=e.field,u=f=>this.subflow(en(f),n,t,f);return(e.modified("field")||o&&t.modified(Object(Ce.g)(o)))&&Object(Ce.o)("PreFacet does not support field modification."),this.initTargets(),o?(t.visit(t.MOD,f=>{const g=u(f);o(f).forEach(x=>g.mod(x))}),t.visit(t.ADD,f=>{const g=u(f);o(f).forEach(x=>g.add(Dt(x)))}),t.visit(t.REM,f=>{const g=u(f);o(f).forEach(x=>g.rem(x))})):(t.visit(t.MOD,f=>u(f).mod(f)),t.visit(t.ADD,f=>u(f).add(f)),t.visit(t.REM,f=>u(f).rem(f))),t.clean()&&t.runAfter(()=>this.clean()),t}}),$i.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},Object(Ce.z)($i,Mt,{transform(e,t){const n=t.fork(t.NO_SOURCE),o=e.fields,u=ia(e.fields,e.as||[]),f=o?(x,k)=>function(F,V,X,te){for(let ue=0,he=X.length;ue<he;++ue)V[te[ue]]=X[ue](F);return V}(x,k,o,u):or;let g;return this.value?g=this.value:(t=t.addAll(),g=this.value={}),t.visit(t.REM,x=>{const k=en(x);n.rem.push(g[k]),g[k]=null}),t.visit(t.ADD,x=>{const k=f(x,Dt({}));g[en(x)]=k,n.add.push(k)}),t.visit(t.MOD,x=>{n.mod.push(f(x,g[en(x)]))}),n}}),Object(Ce.z)(Ii,Mt,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}}),ma.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};function Jp(e){Mt.call(this,null,e)}function Qp(e){Mt.call(this,[],e),this.count=0}function Zp(e){Mt.call(this,null,e)}function ng(e){Mt.call(this,null,e),this.modified(!0)}function pc(e){Mt.call(this,null,e)}Object(Ce.z)(ma,Mt,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),o=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const u=Ba(t.materialize(t.SOURCE).source,e.groupby,e.field),f=(e.groupby||[]).map(Ce.h),g=[],x=e.step||.01,k=e.probs||Ns(x/2,1-1e-14,x),F=k.length;return u.forEach(V=>{const X=to(V,k);for(let te=0;te<F;++te){const ue={};for(let he=0;he<f.length;++he)ue[f[he]]=V.dims[he];ue[o[0]]=k[te],ue[o[1]]=X[te],g.push(Dt(ue))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=g,n}}),Object(Ce.z)(Jp,Mt,{transform(e,t){let n,o;return this.value?o=this.value:(n=t=t.addAll(),o=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,u=>{const f=en(u);n.rem.push(o[f]),o[f]=null}),t.visit(t.ADD,u=>{const f=On(u);o[en(u)]=f,n.add.push(f)}),t.visit(t.MOD,u=>{const f=o[en(u)];for(const g in u)f[g]=u[g],n.modifies(g);n.mod.push(f)})),n}}),Qp.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},Object(Ce.z)(Qp,Mt,{transform(e,t){const n=t.fork(t.NO_SOURCE),o=e.modified("size"),u=e.size,f=this.value.reduce((V,X)=>(V[en(X)]=1,V),{});let g=this.value,x=this.count,k=0;function F(V){let X,te;g.length<u?g.push(V):(te=~~((x+1)*Kn()))<g.length&&te>=k&&(X=g[te],f[en(X)]&&n.rem.push(X),g[te]=V),++x}if(t.rem.length&&(t.visit(t.REM,V=>{const X=en(V);f[X]&&(f[X]=-1,n.rem.push(V)),--x}),g=g.filter(V=>f[en(V)]!==-1)),(t.rem.length||o)&&g.length<u&&t.source&&(k=x=g.length,t.visit(t.SOURCE,V=>{f[en(V)]||F(V)}),k=-1),o&&g.length>u){const V=g.length-u;for(let X=0;X<V;++X)f[en(g[X])]=-1,n.rem.push(g[X]);g=g.slice(V)}return t.mod.length&&t.visit(t.MOD,V=>{f[en(V)]&&n.mod.push(V)}),t.add.length&&t.visit(t.ADD,F),(t.add.length||k<0)&&(n.add=g.filter(V=>!f[en(V)])),this.count=x,this.value=n.source=g,n}}),Zp.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},Object(Ce.z)(Zp,Mt,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),o=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=Ns(e.start,e.stop,e.step||1).map(u=>{const f={};return f[o]=u,Dt(f)}),n.add=t.add.concat(this.value),n}}),Object(Ce.z)(ng,Mt,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});const Ps=["unit0","unit1"];function Nl(e){Mt.call(this,Object(Ce.t)(),e)}function Ks(e){Mt.call(this,null,e)}pc.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:br.j,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:Ps}]},Object(Ce.z)(pc,Mt,{transform(e,t){const n=e.field,o=e.interval!==!1,u=e.timezone==="utc",f=this._floor(e,t),g=(u?br.v:br.p)(f.unit).offset,x=e.as||Ps,k=x[0],F=x[1],V=f.step;let X=f.start||1/0,te=f.stop||-1/0,ue=t.ADD;return(e.modified()||t.modified(Object(Ce.g)(n)))&&(ue=(t=t.reflow(!0)).SOURCE,X=1/0,te=-1/0),t.visit(ue,he=>{const be=n(he);let Pe,Ue;be==null?(he[k]=null,o&&(he[F]=null)):(he[k]=Pe=Ue=f(be),o&&(he[F]=Ue=g(Pe,V)),Pe<X&&(X=Pe),Ue>te&&(te=Ue))}),f.start=X,f.stop=te,t.modifies(o?x:k)},_floor(e,t){const n=e.timezone==="utc",{units:o,step:u}=e.units?{units:e.units,step:e.step||1}:Object(br.n)({extent:e.extent||Object(Ce.q)(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),f=Object(br.t)(o),g=this.value||{},x=(n?br.u:br.o)(f,u);return x.unit=Object(Ce.W)(f),x.units=f,x.step=u,x.start=g.start,x.stop=g.stop,this.value=x}}),Object(Ce.z)(Nl,Mt,{transform(e,t){const n=t.dataflow,o=e.field,u=this.value,f=x=>u.set(o(x),x);let g=!0;return e.modified("field")||t.modified(o.fields)?(u.clear(),t.visit(t.SOURCE,f)):t.changed()?(t.visit(t.REM,x=>u.delete(o(x))),t.visit(t.ADD,f)):g=!1,this.modified(g),u.empty>n.cleanThreshold&&n.runAfter(u.clean),t.fork()}}),Object(Ce.z)(Ks,Mt,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(yr(e.sort)):t.source).map(e.field))}});const Su={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,o=t.data;return n&&t.compare(o[n-1],o[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,o=t.data;return n&&t.compare(o[n-1],o[n])?++e:e}}},percent_rank:function(){const e=Su.rank(),t=e.next;return{init:e.init,next:n=>(t(n)-1)/(n.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,o=t.compare;let u=t.index;if(e<u){for(;u+1<n.length&&!o(n[u],n[u+1]);)++u;e=u}return(1+e)/n.length}}},ntile:function(e,t){(t=+t)>0||Object(Ce.o)("ntile num must be greater than zero.");const n=Su.cume_dist(),o=n.next;return{init:n.init,next:u=>Math.ceil(t*o(u))}},lag:function(e,t){return t=+t||1,{next:n=>{const o=n.index-t;return o>=0?e(n.data[o]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const o=n.index+t,u=n.data;return o<u.length?e(u[o]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return(t=+t)>0||Object(Ce.o)("nth_value nth must be greater than zero."),{next:n=>{const o=n.i0+(t-1);return o<n.i1?e(n.data[o]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const o=e(n.data[n.index]);return o!=null?t=o:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:o=>{const u=o.data;return o.index<=n?t:(n=function(f,g,x){for(let k=g.length;x<k;++x)if(f(g[x])!=null)return x;return-1}(e,u,o.index))<0?(n=u.length,t=null):t=e(u[n])}}}},Lh=Object.keys(Su);function Hi(e){const t=Object(Ce.i)(e.ops),n=Object(Ce.i)(e.fields),o=Object(Ce.i)(e.params),u=Object(Ce.i)(e.as),f=this.outputs=[],g=this.windows=[],x={},k={},F=[],V=[];let X=!0;function te(ue){Object(Ce.i)(Object(Ce.g)(ue)).forEach(he=>x[he]=1)}te(e.sort),t.forEach((ue,he)=>{const be=n[he],Pe=Object(Ce.h)(be),Ue=Qm(ue,Pe,u[he]);if(te(be),f.push(Ue),Object(Ce.w)(Su,ue))g.push(function(We,at,st,dt){const ct=Su[We](at,st);return{init:ct.init||Ce.Ma,update:function(kt,St){St[dt]=ct.next(kt)}}}(ue,n[he],o[he],Ue));else{if(be==null&&ue!=="count"&&Object(Ce.o)("Null aggregate field specified."),ue==="count")return void F.push(Ue);X=!1;let We=k[Pe];We||((We=k[Pe]=[]).field=be,V.push(We)),We.push(Th(ue,Ue))}}),(F.length||V.length)&&(this.cell=function(ue,he,be){ue=ue.map(dt=>xd(dt,dt.field));const Pe={num:0,agg:null,store:!1,count:he};if(!be)for(var Ue=ue.length,We=Pe.agg=Array(Ue),at=0;at<Ue;++at)We[at]=new ue[at](Pe);if(Pe.store)var st=Pe.data=new Gp;return Pe.add=function(dt){if(Pe.num+=1,!be){st&&st.add(dt);for(let ct=0;ct<Ue;++ct)We[ct].add(We[ct].get(dt),dt)}},Pe.rem=function(dt){if(Pe.num-=1,!be){st&&st.rem(dt);for(let ct=0;ct<Ue;++ct)We[ct].rem(We[ct].get(dt),dt)}},Pe.set=function(dt){let ct,kt;for(st&&st.values(),ct=0,kt=he.length;ct<kt;++ct)dt[he[ct]]=Pe.num;if(!be)for(ct=0,kt=We.length;ct<kt;++ct)We[ct].set(dt)},Pe.init=function(){Pe.num=0,st&&st.reset();for(let dt=0;dt<Ue;++dt)We[dt].init()},Pe}(V,F,X)),this.inputs=Object.keys(x)}const _d=Hi.prototype;function Il(e){Mt.call(this,{},e),this._mlen=0,this._mods=[]}function vf(e,t,n,o){const u=o.sort,f=u&&!o.ignorePeers,g=o.frame||[null,0],x=e.data(n),k=x.length,F=f?Object(yd.a)(u):null,V={i0:0,i1:0,p0:0,p1:0,index:0,data:x,compare:u||Object(Ce.m)(-1)};t.init();for(let X=0;X<k;++X)em(V,g,X,k),f&&rg(V,F),t.update(V,x[X])}function em(e,t,n,o){e.p0=e.i0,e.p1=e.i1,e.i0=t[0]==null?0:Math.max(0,n-Math.abs(t[0])),e.i1=t[1]==null?o:Math.min(o,n+Math.abs(t[1])+1),e.index=n}function rg(e,t){const n=e.i0,o=e.i1-1,u=e.compare,f=e.data,g=f.length-1;n>0&&!u(f[n],f[n-1])&&(e.i0=t.left(f,f[n])),o<g&&!u(f[o],f[o+1])&&(e.i1=t.right(f,f[o]))}function yf(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function Bh(e){this._context=e}_d.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()},_d.update=function(e,t){const n=this.cell,o=this.windows,u=e.data,f=o&&o.length;let g;if(n){for(g=e.p0;g<e.i0;++g)n.rem(u[g]);for(g=e.p1;g<e.i1;++g)n.add(u[g]);n.set(t)}for(g=0;g<f;++g)o[g].update(e,t)},Il.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Lh.concat(Hp)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},Object(Ce.z)(Il,Mt,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),o=yr(e.sort),u=qu(e.groupby),f=x=>this.group(u(x));let g=this.state;g&&!n||(g=this.state=new Hi(e)),n||t.modified(g.inputs)?(this.value={},t.visit(t.SOURCE,x=>f(x).add(x))):(t.visit(t.REM,x=>f(x).remove(x)),t.visit(t.ADD,x=>f(x).add(x)));for(let x=0,k=this._mlen;x<k;++x)vf(this._mods[x],g,o,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(g.outputs)},group(e){let t=this.value[e];return t||((t=this.value[e]=eg(en)).stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}}),Bh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:yf(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:yf(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};var Xo=function(){};function jh(e){this._context=e}jh.prototype={areaStart:Xo,areaEnd:Xo,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:yf(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function bf(e){this._context=e}bf.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,o=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,o):this._context.moveTo(n,o);break;case 3:this._point=4;default:yf(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function zh(e,t){this._basis=new Bh(e),this._beta=t}zh.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var o,u=e[0],f=t[0],g=e[n]-u,x=t[n]-f,k=-1;++k<=n;)o=k/n,this._basis.point(this._beta*e[k]+(1-this._beta)*(u+o*g),this._beta*t[k]+(1-this._beta)*(f+o*x));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};var xf=function e(t){function n(o){return t===1?new Bh(o):new zh(o,t)}return n.beta=function(o){return e(+o)},n}(.85);function Fl(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function il(e,t){this._context=e,this._k=(1-t)/6}il.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Fl(this,this._x1,this._y1)}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:Fl(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Uh=function e(t){function n(o){return new il(o,t)}return n.tension=function(o){return e(+o)},n}(0);function Ed(e,t){this._context=e,this._k=(1-t)/6}Ed.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Fl(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var wf=function e(t){function n(o){return new Ed(o,t)}return n.tension=function(o){return e(+o)},n}(0);function ol(e,t){this._context=e,this._k=(1-t)/6}ol.prototype={areaStart:Xo,areaEnd:Xo,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Fl(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Zg=function e(t){function n(o){return new ol(o,t)}return n.tension=function(o){return e(+o)},n}(0),_f=Math.abs,ha=Math.atan2,za=Math.cos,Ga=Math.max,Xi=Math.min,Ls=Math.sin,al=Math.sqrt,qa=1e-12,sl=Math.PI,mc=sl/2,Sd=2*sl;function Cd(e){return e>=1?mc:e<=-1?-mc:Math.asin(e)}function Rl(e,t,n){var o=e._x1,u=e._y1,f=e._x2,g=e._y2;if(e._l01_a>qa){var x=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,k=3*e._l01_a*(e._l01_a+e._l12_a);o=(o*x-e._x0*e._l12_2a+e._x2*e._l01_2a)/k,u=(u*x-e._y0*e._l12_2a+e._y2*e._l01_2a)/k}if(e._l23_a>qa){var F=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,V=3*e._l23_a*(e._l23_a+e._l12_a);f=(f*F+e._x1*e._l23_2a-t*e._l12_2a)/V,g=(g*F+e._y1*e._l23_2a-n*e._l12_2a)/V}e._context.bezierCurveTo(o,u,f,g,e._x2,e._y2)}function tm(e,t){this._context=e,this._alpha=t}tm.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,o=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+o*o,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:Rl(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var gc=function e(t){function n(o){return t?new tm(o,t):new il(o,0)}return n.alpha=function(o){return e(+o)},n}(.5);function e0(e,t){this._context=e,this._alpha=t}e0.prototype={areaStart:Xo,areaEnd:Xo,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,o=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+o*o,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Rl(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var nm=function e(t){function n(o){return t?new e0(o,t):new ol(o,0)}return n.alpha=function(o){return e(+o)},n}(.5);function Ef(e,t){this._context=e,this._alpha=t}Ef.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,o=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+o*o,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Rl(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var ig=function e(t){function n(o){return t?new Ef(o,t):new Ed(o,0)}return n.alpha=function(o){return e(+o)},n}(.5);function kd(e){this._context=e}kd.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};var Pl=function(e){return new kd(e)};function rm(e){this._context=e}rm.prototype={areaStart:Xo,areaEnd:Xo,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function Wh(e){return e<0?-1:1}function Da(e,t,n){var o=e._x1-e._x0,u=t-e._x1,f=(e._y1-e._y0)/(o||u<0&&-0),g=(n-e._y1)/(u||o<0&&-0),x=(f*u+g*o)/(o+u);return(Wh(f)+Wh(g))*Math.min(Math.abs(f),Math.abs(g),.5*Math.abs(x))||0}function Sf(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Bs(e,t,n){var o=e._x0,u=e._y0,f=e._x1,g=e._y1,x=(f-o)/3;e._context.bezierCurveTo(o+x,u+x*t,f-x,g-x*n,f,g)}function Cf(e){this._context=e}function Ad(e){this._context=new Vh(e)}function Vh(e){this._context=e}function im(e){this._context=e}function Od(e){var t,n,o=e.length-1,u=new Array(o),f=new Array(o),g=new Array(o);for(u[0]=0,f[0]=2,g[0]=e[0]+2*e[1],t=1;t<o-1;++t)u[t]=1,f[t]=4,g[t]=4*e[t]+2*e[t+1];for(u[o-1]=2,f[o-1]=7,g[o-1]=8*e[o-1]+e[o],t=1;t<o;++t)n=u[t]/f[t-1],f[t]-=n,g[t]-=n*g[t-1];for(u[o-1]=g[o-1]/f[o-1],t=o-2;t>=0;--t)u[t]=(g[t]-u[t+1])/f[t];for(f[o-1]=(e[o]+u[o-1])/2,t=0;t<o-1;++t)f[t]=2*e[t+1]-u[t+1];return[u,f]}Cf.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Bs(this,this._t0,Sf(this,this._t0))}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Bs(this,Sf(this,n=Da(this,e,t)),n);break;default:Bs(this,this._t0,n=Da(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}},(Ad.prototype=Object.create(Cf.prototype)).point=function(e,t){Cf.prototype.point.call(this,t,e)},Vh.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,o,u,f){this._context.bezierCurveTo(t,e,o,n,f,u)}},im.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var o=Od(e),u=Od(t),f=0,g=1;g<n;++f,++g)this._context.bezierCurveTo(o[0][f],u[0][f],o[1][f],u[1][f],e[g],t[g]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function kf(e,t){this._context=e,this._t=t}kf.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}}this._x=e,this._y=t}};const om=Math.PI,am=2*om,bn=am-1e-6;function uu(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function tr(){return new uu}uu.prototype=tr.prototype={constructor:uu,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,o){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+o)},bezierCurveTo:function(e,t,n,o,u,f){this._+="C"+ +e+","+ +t+","+ +n+","+ +o+","+(this._x1=+u)+","+(this._y1=+f)},arcTo:function(e,t,n,o,u){e=+e,t=+t,n=+n,o=+o,u=+u;var f=this._x1,g=this._y1,x=n-e,k=o-t,F=f-e,V=g-t,X=F*F+V*V;if(u<0)throw new Error("negative radius: "+u);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(X>1e-6)if(Math.abs(V*x-k*F)>1e-6&&u){var te=n-f,ue=o-g,he=x*x+k*k,be=te*te+ue*ue,Pe=Math.sqrt(he),Ue=Math.sqrt(X),We=u*Math.tan((om-Math.acos((he+X-be)/(2*Pe*Ue)))/2),at=We/Ue,st=We/Pe;Math.abs(at-1)>1e-6&&(this._+="L"+(e+at*F)+","+(t+at*V)),this._+="A"+u+","+u+",0,0,"+ +(V*te>F*ue)+","+(this._x1=e+st*x)+","+(this._y1=t+st*k)}else this._+="L"+(this._x1=e)+","+(this._y1=t)},arc:function(e,t,n,o,u,f){e=+e,t=+t,f=!!f;var g=(n=+n)*Math.cos(o),x=n*Math.sin(o),k=e+g,F=t+x,V=1^f,X=f?o-u:u-o;if(n<0)throw new Error("negative radius: "+n);this._x1===null?this._+="M"+k+","+F:(Math.abs(this._x1-k)>1e-6||Math.abs(this._y1-F)>1e-6)&&(this._+="L"+k+","+F),n&&(X<0&&(X=X%am+am),X>bn?this._+="A"+n+","+n+",0,1,"+V+","+(e-g)+","+(t-x)+"A"+n+","+n+",0,1,"+V+","+(this._x1=k)+","+(this._y1=F):X>1e-6&&(this._+="A"+n+","+n+",0,"+ +(X>=om)+","+V+","+(this._x1=e+n*Math.cos(u))+","+(this._y1=t+n*Math.sin(u))))},rect:function(e,t,n,o){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +o+"h"+-n+"Z"},toString:function(){return this._}};var js=tr,vo=function(e){return function(){return e}};function Af(e){return e.innerRadius}function Td(e){return e.outerRadius}function mr(e){return e.startAngle}function is(e){return e.endAngle}function Na(e){return e&&e.padAngle}function io(e,t,n,o,u,f,g){var x=e-n,k=t-o,F=(g?f:-f)/al(x*x+k*k),V=F*k,X=-F*x,te=e+V,ue=t+X,he=n+V,be=o+X,Pe=(te+he)/2,Ue=(ue+be)/2,We=he-te,at=be-ue,st=We*We+at*at,dt=u-f,ct=te*be-he*ue,kt=(at<0?-1:1)*al(Ga(0,dt*dt*st-ct*ct)),St=(ct*at-We*kt)/st,yn=(-ct*We-at*kt)/st,Mn=(ct*at+We*kt)/st,_n=(-ct*We+at*kt)/st,$n=St-Pe,qn=yn-Ue,er=Mn-Pe,rr=_n-Ue;return $n*$n+qn*qn>er*er+rr*rr&&(St=Mn,yn=_n),{cx:St,cy:yn,x01:-V,y01:-X,x11:St*(u/dt-1),y11:yn*(u/dt-1)}}var Xu=function(e){return typeof e=="object"&&"length"in e?e:Array.from(e)};function Pc(e){return e[0]}function cu(e){return e[1]}var Lc=function(e,t){var n=vo(!0),o=null,u=Pl,f=null;function g(x){var k,F,V,X=(x=Xu(x)).length,te=!1;for(o==null&&(f=u(V=js())),k=0;k<=X;++k)!(k<X&&n(F=x[k],k,x))===te&&((te=!te)?f.lineStart():f.lineEnd()),te&&f.point(+e(F,k,x),+t(F,k,x));if(V)return f=null,V+""||null}return e=typeof e=="function"?e:e===void 0?Pc:vo(e),t=typeof t=="function"?t:t===void 0?cu:vo(t),g.x=function(x){return arguments.length?(e=typeof x=="function"?x:vo(+x),g):e},g.y=function(x){return arguments.length?(t=typeof x=="function"?x:vo(+x),g):t},g.defined=function(x){return arguments.length?(n=typeof x=="function"?x:vo(!!x),g):n},g.curve=function(x){return arguments.length?(u=x,o!=null&&(f=u(o)),g):u},g.context=function(x){return arguments.length?(x==null?o=f=null:f=u(o=x),g):o},g},oa=function(e,t,n){var o=null,u=vo(!0),f=null,g=Pl,x=null;function k(V){var X,te,ue,he,be,Pe=(V=Xu(V)).length,Ue=!1,We=new Array(Pe),at=new Array(Pe);for(f==null&&(x=g(be=js())),X=0;X<=Pe;++X){if(!(X<Pe&&u(he=V[X],X,V))===Ue)if(Ue=!Ue)te=X,x.areaStart(),x.lineStart();else{for(x.lineEnd(),x.lineStart(),ue=X-1;ue>=te;--ue)x.point(We[ue],at[ue]);x.lineEnd(),x.areaEnd()}Ue&&(We[X]=+e(he,X,V),at[X]=+t(he,X,V),x.point(o?+o(he,X,V):We[X],n?+n(he,X,V):at[X]))}if(be)return x=null,be+""||null}function F(){return Lc().defined(u).curve(g).context(f)}return e=typeof e=="function"?e:e===void 0?Pc:vo(+e),t=typeof t=="function"?t:vo(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?cu:vo(+n),k.x=function(V){return arguments.length?(e=typeof V=="function"?V:vo(+V),o=null,k):e},k.x0=function(V){return arguments.length?(e=typeof V=="function"?V:vo(+V),k):e},k.x1=function(V){return arguments.length?(o=V==null?null:typeof V=="function"?V:vo(+V),k):o},k.y=function(V){return arguments.length?(t=typeof V=="function"?V:vo(+V),n=null,k):t},k.y0=function(V){return arguments.length?(t=typeof V=="function"?V:vo(+V),k):t},k.y1=function(V){return arguments.length?(n=V==null?null:typeof V=="function"?V:vo(+V),k):n},k.lineX0=k.lineY0=function(){return F().x(e).y(t)},k.lineY1=function(){return F().x(e).y(n)},k.lineX1=function(){return F().x(o).y(t)},k.defined=function(V){return arguments.length?(u=typeof V=="function"?V:vo(!!V),k):u},k.curve=function(V){return arguments.length?(g=V,f!=null&&(x=g(f)),k):g},k.context=function(V){return arguments.length?(V==null?f=x=null:x=g(f=V),k):f},k},vc={draw:function(e,t){var n=Math.sqrt(t/sl);e.moveTo(n,0),e.arc(0,0,n,0,Sd)}};function lu(e,t){if(typeof document<"u"&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}const bo=()=>typeof Image<"u"?Image:null,Es=Object(yd.a)(Bn.a),Ua=Es.right,Ss=Es.left;Object(yd.a)(jr).center;var aa=Ua;function fu(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function Ku(e,t){switch(arguments.length){case 0:break;case 1:typeof e=="function"?this.interpolator(e):this.range(e);break;default:this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t)}return this}const yc=Symbol("implicit");function Bc(){var e=new Map,t=[],n=[],o=yc;function u(f){var g=f+"",x=e.get(g);if(!x){if(o!==yc)return o;e.set(g,x=t.push(f))}return n[(x-1)%n.length]}return u.domain=function(f){if(!arguments.length)return t.slice();t=[],e=new Map;for(const g of f){const x=g+"";e.has(x)||e.set(x,t.push(g))}return u},u.range=function(f){return arguments.length?(n=Array.from(f),u):n.slice()},u.unknown=function(f){return arguments.length?(o=f,u):o},u.copy=function(){return Bc(t,n).unknown(o)},fu.apply(u,arguments),u}var Yu=r(45),Ll=r(50);function Bl(e,t,n,o){var u,f=Object(Yu.c)(e,t,n);switch((o=Object(Ll.formatSpecifier)(o??",f")).type){case"s":var g=Math.max(Math.abs(e),Math.abs(t));return o.precision!=null||isNaN(u=Object(Ll.precisionPrefix)(f,g))||(o.precision=u),Object(Ll.formatPrefix)(o,g);case"":case"e":case"g":case"p":case"r":o.precision!=null||isNaN(u=Object(Ll.precisionRound)(f,Math.max(Math.abs(e),Math.abs(t))))||(o.precision=u-(o.type==="e"));break;case"f":case"%":o.precision!=null||isNaN(u=Object(Ll.precisionFixed)(f))||(o.precision=u-2*(o.type==="%"))}return Object(Ll.format)(o)}var Hh=function(e,t,n){e.prototype=t.prototype=n,n.constructor=e};function jl(e,t){var n=Object.create(e.prototype);for(var o in t)n[o]=t[o];return n}function du(){}var Ju="\\s*([+-]?\\d+)\\s*",Qu="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Cu="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Gh=/^#([0-9a-f]{3,8})$/,Md=new RegExp("^rgb\\("+[Ju,Ju,Ju]+"\\)$"),Dd=new RegExp("^rgb\\("+[Cu,Cu,Cu]+"\\)$"),Of=new RegExp("^rgba\\("+[Ju,Ju,Ju,Qu]+"\\)$"),Nd=new RegExp("^rgba\\("+[Cu,Cu,Cu,Qu]+"\\)$"),se=new RegExp("^hsl\\("+[Qu,Cu,Cu]+"\\)$"),ne=new RegExp("^hsla\\("+[Qu,Cu,Cu,Qu]+"\\)$"),N={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function G(){return this.rgb().formatHex()}function ce(){return this.rgb().formatRgb()}function je(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Gh.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Qe(t):n===3?new ht(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):n===8?bt(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):n===4?bt(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Md.exec(e))?new ht(t[1],t[2],t[3],1):(t=Dd.exec(e))?new ht(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Of.exec(e))?bt(t[1],t[2],t[3],t[4]):(t=Nd.exec(e))?bt(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=se.exec(e))?nr(t[1],t[2]/100,t[3]/100,1):(t=ne.exec(e))?nr(t[1],t[2]/100,t[3]/100,t[4]):N.hasOwnProperty(e)?Qe(N[e]):e==="transparent"?new ht(NaN,NaN,NaN,0):null}function Qe(e){return new ht(e>>16&255,e>>8&255,255&e,1)}function bt(e,t,n,o){return o<=0&&(e=t=n=NaN),new ht(e,t,n,o)}function qt(e){return e instanceof du||(e=je(e)),e?new ht((e=e.rgb()).r,e.g,e.b,e.opacity):new ht}function un(e,t,n,o){return arguments.length===1?qt(e):new ht(e,t,n,o??1)}function ht(e,t,n,o){this.r=+e,this.g=+t,this.b=+n,this.opacity=+o}function In(){return"#"+Gn(this.r)+Gn(this.g)+Gn(this.b)}function Un(){var e=this.opacity;return((e=isNaN(e)?1:Math.max(0,Math.min(1,e)))===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function Gn(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function nr(e,t,n,o){return o<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new gr(e,t,n,o)}function Yn(e){if(e instanceof gr)return new gr(e.h,e.s,e.l,e.opacity);if(e instanceof du||(e=je(e)),!e)return new gr;if(e instanceof gr)return e;var t=(e=e.rgb()).r/255,n=e.g/255,o=e.b/255,u=Math.min(t,n,o),f=Math.max(t,n,o),g=NaN,x=f-u,k=(f+u)/2;return x?(g=t===f?(n-o)/x+6*(n<o):n===f?(o-t)/x+2:(t-n)/x+4,x/=k<.5?f+u:2-f-u,g*=60):x=k>0&&k<1?0:g,new gr(g,x,k,e.opacity)}function pr(e,t,n,o){return arguments.length===1?Yn(e):new gr(e,t,n,o??1)}function gr(e,t,n,o){this.h=+e,this.s=+t,this.l=+n,this.opacity=+o}function Tr(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function $r(e,t,n,o,u){var f=e*e,g=f*e;return((1-3*e+3*f-g)*t+(4-6*f+3*g)*n+(1+3*e+3*f-3*g)*o+g*u)/6}Hh(du,je,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:G,formatHex:G,formatHsl:function(){return Yn(this).formatHsl()},formatRgb:ce,toString:ce}),Hh(ht,un,jl(du,{brighter:function(e){return e=e==null?1/.7:Math.pow(1/.7,e),new ht(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?.7:Math.pow(.7,e),new ht(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:In,formatHex:In,formatRgb:Un,toString:Un})),Hh(gr,pr,jl(du,{brighter:function(e){return e=e==null?1/.7:Math.pow(1/.7,e),new gr(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?.7:Math.pow(.7,e),new gr(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,o=n+(n<.5?n:1-n)*t,u=2*n-o;return new ht(Tr(e>=240?e-240:e+120,u,o),Tr(e,u,o),Tr(e<120?e+240:e-120,u,o),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return((e=isNaN(e)?1:Math.max(0,Math.min(1,e)))===1?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(e===1?")":", "+e+")")}}));var ai=function(e){var t=e.length-1;return function(n){var o=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),u=e[o],f=e[o+1],g=o>0?e[o-1]:2*u-f,x=o<t-1?e[o+2]:2*f-u;return $r((n-o/t)*t,g,u,f,x)}},Fr=function(e){var t=e.length;return function(n){var o=Math.floor(((n%=1)<0?++n:n)*t),u=e[(o+t-1)%t],f=e[o%t],g=e[(o+1)%t],x=e[(o+2)%t];return $r((n-o/t)*t,u,f,g,x)}},ui=e=>()=>e;function ii(e,t){return function(n){return e+n*t}}function wi(e,t){var n=t-e;return n?ii(e,n>180||n<-180?n-360*Math.round(n/360):n):ui(isNaN(e)?t:e)}function Si(e){return(e=+e)==1?si:function(t,n){return n-t?function(o,u,f){return o=Math.pow(o,f),u=Math.pow(u,f)-o,f=1/f,function(g){return Math.pow(o+g*u,f)}}(t,n,e):ui(isNaN(t)?n:t)}}function si(e,t){var n=t-e;return n?ii(e,n):ui(isNaN(e)?t:e)}var gi=function e(t){var n=Si(t);function o(u,f){var g=n((u=un(u)).r,(f=un(f)).r),x=n(u.g,f.g),k=n(u.b,f.b),F=si(u.opacity,f.opacity);return function(V){return u.r=g(V),u.g=x(V),u.b=k(V),u.opacity=F(V),u+""}}return o.gamma=e,o}(1);function po(e){return function(t){var n,o,u=t.length,f=new Array(u),g=new Array(u),x=new Array(u);for(n=0;n<u;++n)o=un(t[n]),f[n]=o.r||0,g[n]=o.g||0,x[n]=o.b||0;return f=e(f),g=e(g),x=e(x),o.opacity=1,function(k){return o.r=f(k),o.g=g(k),o.b=x(k),o+""}}}var ho=po(ai),Ko=po(Fr),Ki=function(e,t){t||(t=[]);var n,o=e?Math.min(t.length,e.length):0,u=t.slice();return function(f){for(n=0;n<o;++n)u[n]=e[n]*(1-f)+t[n]*f;return u}};function mo(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}var pa=function(e,t){return(mo(t)?Ki:Go)(e,t)};function Go(e,t){var n,o=t?t.length:0,u=e?Math.min(o,e.length):0,f=new Array(u),g=new Array(o);for(n=0;n<u;++n)f[n]=ga(e[n],t[n]);for(;n<o;++n)g[n]=t[n];return function(x){for(n=0;n<u;++n)g[n]=f[n](x);return g}}var sa=function(e,t){var n=new Date;return e=+e,t=+t,function(o){return n.setTime(e*(1-o)+t*o),n}},Gi=function(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}},Vi=function(e,t){var n,o={},u={};for(n in e!==null&&typeof e=="object"||(e={}),t!==null&&typeof t=="object"||(t={}),t)n in e?o[n]=ga(e[n],t[n]):u[n]=t[n];return function(f){for(n in o)u[n]=o[n](f);return u}},Ao=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,wa=new RegExp(Ao.source,"g"),Sa=function(e,t){var n,o,u,f=Ao.lastIndex=wa.lastIndex=0,g=-1,x=[],k=[];for(e+="",t+="";(n=Ao.exec(e))&&(o=wa.exec(t));)(u=o.index)>f&&(u=t.slice(f,u),x[g]?x[g]+=u:x[++g]=u),(n=n[0])===(o=o[0])?x[g]?x[g]+=o:x[++g]=o:(x[++g]=null,k.push({i:g,x:Gi(n,o)})),f=wa.lastIndex;return f<t.length&&(u=t.slice(f),x[g]?x[g]+=u:x[++g]=u),x.length<2?k[0]?function(F){return function(V){return F(V)+""}}(k[0].x):function(F){return function(){return F}}(t):(t=k.length,function(F){for(var V,X=0;X<t;++X)x[(V=k[X]).i]=V.x(F);return x.join("")})},ga=function(e,t){var n,o=typeof t;return t==null||o==="boolean"?ui(t):(o==="number"?Gi:o==="string"?(n=je(t))?(t=n,gi):Sa:t instanceof je?gi:t instanceof Date?sa:mo(t)?Ki:Array.isArray(t)?Go:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Vi:Gi)(e,t)},ua=function(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}};function ds(e){return+e}var Ca=[0,1];function Oo(e){return e}function Ia(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(n){return function(){return n}}(isNaN(t)?NaN:.5)}function Zu(e,t,n){var o=e[0],u=e[1],f=t[0],g=t[1];return u<o?(o=Ia(u,o),f=n(g,f)):(o=Ia(o,u),f=n(f,g)),function(x){return f(o(x))}}function Cs(e,t,n){var o=Math.min(e.length,t.length)-1,u=new Array(o),f=new Array(o),g=-1;for(e[o]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++g<o;)u[g]=Ia(e[g],e[g+1]),f[g]=n(t[g],t[g+1]);return function(x){var k=aa(e,x,1,o)-1;return f[k](u[k](x))}}function $a(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Uo(){var e,t,n,o,u,f,g=Ca,x=Ca,k=ga,F=Oo;function V(){var te=Math.min(g.length,x.length);return F!==Oo&&(F=function(ue,he){var be;return ue>he&&(be=ue,ue=he,he=be),function(Pe){return Math.max(ue,Math.min(he,Pe))}}(g[0],g[te-1])),o=te>2?Cs:Zu,u=f=null,X}function X(te){return te==null||isNaN(te=+te)?n:(u||(u=o(g.map(e),x,k)))(e(F(te)))}return X.invert=function(te){return F(t((f||(f=o(x,g.map(e),Gi)))(te)))},X.domain=function(te){return arguments.length?(g=Array.from(te,ds),V()):g.slice()},X.range=function(te){return arguments.length?(x=Array.from(te),V()):x.slice()},X.rangeRound=function(te){return x=Array.from(te),k=ua,V()},X.clamp=function(te){return arguments.length?(F=!!te||Oo,V()):F!==Oo},X.interpolate=function(te){return arguments.length?(k=te,V()):k},X.unknown=function(te){return arguments.length?(n=te,X):n},function(te,ue){return e=te,t=ue,V()}}function jc(){return Uo()(Oo,Oo)}function hu(e){var t=e.domain;return e.ticks=function(n){var o=t();return Object(Yu.a)(o[0],o[o.length-1],n??10)},e.tickFormat=function(n,o){var u=t();return Bl(u[0],u[u.length-1],n??10,o)},e.nice=function(n){n==null&&(n=10);var o,u,f=t(),g=0,x=f.length-1,k=f[g],F=f[x],V=10;for(F<k&&(u=k,k=F,F=u,u=g,g=x,x=u);V-- >0;){if((u=Object(Yu.b)(k,F,n))===o)return f[g]=k,f[x]=F,t(f);if(u>0)k=Math.floor(k/u)*u,F=Math.ceil(F/u)*u;else{if(!(u<0))break;k=Math.ceil(k*u)/u,F=Math.floor(F*u)/u}o=u}return e},e}function Ys(e,t){var n,o=0,u=(e=e.slice()).length-1,f=e[o],g=e[u];return g<f&&(n=o,o=u,u=n,n=f,f=g,g=n),e[o]=t.floor(f),e[u]=t.ceil(g),e}function ca(e){return Math.log(e)}function Js(e){return Math.exp(e)}function Wo(e){return-Math.log(-e)}function zs(e){return-Math.exp(-e)}function ks(e){return isFinite(e)?+("1e"+e):e<0?0:e}function yo(e){return function(t){return-e(-t)}}function Us(e){var t,n,o=e(ca,Js),u=o.domain,f=10;function g(){return t=function(x){return x===Math.E?Math.log:x===10&&Math.log10||x===2&&Math.log2||(x=Math.log(x),function(k){return Math.log(k)/x})}(f),n=function(x){return x===10?ks:x===Math.E?Math.exp:function(k){return Math.pow(x,k)}}(f),u()[0]<0?(t=yo(t),n=yo(n),e(Wo,zs)):e(ca,Js),o}return o.base=function(x){return arguments.length?(f=+x,g()):f},o.domain=function(x){return arguments.length?(u(x),g()):u()},o.ticks=function(x){var k,F=u(),V=F[0],X=F[F.length-1];(k=X<V)&&(be=V,V=X,X=be);var te,ue,he,be=t(V),Pe=t(X),Ue=x==null?10:+x,We=[];if(!(f%1)&&Pe-be<Ue){if(be=Math.floor(be),Pe=Math.ceil(Pe),V>0){for(;be<=Pe;++be)for(ue=1,te=n(be);ue<f;++ue)if(!((he=te*ue)<V)){if(he>X)break;We.push(he)}}else for(;be<=Pe;++be)for(ue=f-1,te=n(be);ue>=1;--ue)if(!((he=te*ue)<V)){if(he>X)break;We.push(he)}2*We.length<Ue&&(We=Object(Yu.a)(V,X,Ue))}else We=Object(Yu.a)(be,Pe,Math.min(Pe-be,Ue)).map(n);return k?We.reverse():We},o.tickFormat=function(x,k){if(k==null&&(k=f===10?".0e":","),typeof k!="function"&&(k=Object(Ll.format)(k)),x===1/0)return k;x==null&&(x=10);var F=Math.max(1,f*x/o.ticks().length);return function(V){var X=V/n(Math.round(t(V)));return X*f<f-.5&&(X*=f),X<=F?k(V):""}},o.nice=function(){return u(Ys(u(),{floor:function(x){return n(Math.floor(t(x)))},ceil:function(x){return n(Math.ceil(t(x)))}}))},o}function os(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function pu(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function ul(e){return e<0?-e*e:e*e}function Yo(e){var t=e(Oo,Oo),n=1;return t.exponent=function(o){return arguments.length?(n=+o)==1?e(Oo,Oo):n===.5?e(pu,ul):e(os(n),os(1/n)):n},hu(t)}function hs(){var e=Yo(Uo());return e.copy=function(){return $a(e,hs()).exponent(e.exponent())},fu.apply(e,arguments),e}function Xa(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function zc(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function zl(e){var t=1,n=e(Xa(t),zc(t));return n.constant=function(o){return arguments.length?e(Xa(t=+o),zc(t)):t},hu(n)}var Ei=r(12),sm=r(182),Ul=r(69),Tf=r(183),uv=r(184),cv=r(72),t0=r(40),n0=r(135),lv=r(70),r0=r(180),fv=r(181),Id=r(71),um=r(39),dv=r(134),hv=r(68);function pv(e,t,n,o,u,f){const g=[[Ul.a,1,Ei.e],[Ul.a,5,5*Ei.e],[Ul.a,15,15*Ei.e],[Ul.a,30,30*Ei.e],[f,1,Ei.c],[f,5,5*Ei.c],[f,15,15*Ei.c],[f,30,30*Ei.c],[u,1,Ei.b],[u,3,3*Ei.b],[u,6,6*Ei.b],[u,12,12*Ei.b],[o,1,Ei.a],[o,2,2*Ei.a],[n,1,Ei.f],[t,1,Ei.d],[t,3,3*Ei.d],[e,1,Ei.g]];function x(k,F,V){const X=Math.abs(F-k)/V,te=Object(yd.a)(([,,be])=>be).right(g,X);if(te===g.length)return e.every(Object(Yu.c)(k/Ei.g,F/Ei.g,V));if(te===0)return sm.a.every(Math.max(Object(Yu.c)(k,F,V),1));const[ue,he]=g[X/g[te-1][2]<g[te][2]/X?te-1:te];return ue.every(he)}return[function(k,F,V){const X=F<k;X&&([k,F]=[F,k]);const te=V&&typeof V.range=="function"?V:x(k,F,V),ue=te?te.range(k,+F+1):[];return X?ue.reverse():ue},x]}const[cl,Fd]=pv(hv.a,dv.a,um.b,Id.a,fv.a,r0.a),[cm,i0]=pv(lv.a,n0.a,t0.b,cv.a,uv.a,Tf.a);var o0=r(100);function Ny(e){return new Date(e)}function a0(e){return e instanceof Date?+e:+new Date(+e)}function qh(e,t,n,o,u,f,g,x,k,F){var V=jc(),X=V.invert,te=V.domain,ue=F(".%L"),he=F(":%S"),be=F("%I:%M"),Pe=F("%I %p"),Ue=F("%a %d"),We=F("%b %d"),at=F("%B"),st=F("%Y");function dt(ct){return(k(ct)<ct?ue:x(ct)<ct?he:g(ct)<ct?be:f(ct)<ct?Pe:o(ct)<ct?u(ct)<ct?Ue:We:n(ct)<ct?at:st)(ct)}return V.invert=function(ct){return new Date(X(ct))},V.domain=function(ct){return arguments.length?te(Array.from(ct,a0)):te().map(Ny)},V.ticks=function(ct){var kt=te();return e(kt[0],kt[kt.length-1],ct??10)},V.tickFormat=function(ct,kt){return kt==null?dt:F(kt)},V.nice=function(ct){var kt=te();return ct&&typeof ct.range=="function"||(ct=t(kt[0],kt[kt.length-1],ct??10)),ct?te(Ys(kt,ct)):V},V.copy=function(){return $a(V,qh(e,t,n,o,u,f,g,x,k,F))},V}function Rd(){var e,t,n,o,u,f=0,g=1,x=Oo,k=!1;function F(X){return X==null||isNaN(X=+X)?u:x(n===0?.5:(X=(o(X)-e)*n,k?Math.max(0,Math.min(1,X)):X))}function V(X){return function(te){var ue,he;return arguments.length?([ue,he]=te,x=X(ue,he),F):[x(0),x(1)]}}return F.domain=function(X){return arguments.length?([f,g]=X,e=o(f=+f),t=o(g=+g),n=e===t?0:1/(t-e),F):[f,g]},F.clamp=function(X){return arguments.length?(k=!!X,F):k},F.interpolator=function(X){return arguments.length?(x=X,F):x},F.range=V(ga),F.rangeRound=V(ua),F.unknown=function(X){return arguments.length?(u=X,F):u},function(X){return o=X,e=X(f),t=X(g),n=e===t?0:1/(t-e),F}}function ll(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function s0(){var e=hu(Rd()(Oo));return e.copy=function(){return ll(e,s0())},Ku.apply(e,arguments)}function u0(){var e=Yo(Rd());return e.copy=function(){return ll(e,u0()).exponent(e.exponent())},Ku.apply(e,arguments)}function ec(e,t){t===void 0&&(t=e,e=ga);for(var n=0,o=t.length-1,u=t[0],f=new Array(o<0?0:o);n<o;)f[n]=e(u,u=t[++n]);return function(g){var x=Math.max(0,Math.min(o-1,Math.floor(g*=o)));return f[x](g-x)}}function c0(){var e,t,n,o,u,f,g,x=0,k=.5,F=1,V=1,X=Oo,te=!1;function ue(be){return isNaN(be=+be)?g:(be=.5+((be=+f(be))-t)*(V*be<V*t?o:u),X(te?Math.max(0,Math.min(1,be)):be))}function he(be){return function(Pe){var Ue,We,at;return arguments.length?([Ue,We,at]=Pe,X=ec(be,[Ue,We,at]),ue):[X(0),X(.5),X(1)]}}return ue.domain=function(be){return arguments.length?([x,k,F]=be,e=f(x=+x),t=f(k=+k),n=f(F=+F),o=e===t?0:.5/(t-e),u=t===n?0:.5/(n-t),V=t<e?-1:1,ue):[x,k,F]},ue.clamp=function(be){return arguments.length?(te=!!be,ue):te},ue.interpolator=function(be){return arguments.length?(X=be,ue):X},ue.range=he(ga),ue.rangeRound=he(ua),ue.unknown=function(be){return arguments.length?(g=be,ue):g},function(be){return f=be,e=be(x),t=be(k),n=be(F),o=e===t?0:.5/(t-e),u=t===n?0:.5/(n-t),V=t<e?-1:1,ue}}function $h(){var e=Yo(c0());return e.copy=function(){return ll(e,$h()).exponent(e.exponent())},Ku.apply(e,arguments)}var lm,Iy=function(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}},fm=function(e,t){var n=wi(+e,+t);return function(o){var u=n(o);return u-360*Math.floor(u/360)}},fl=180/Math.PI,dm={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},mv=function(e,t,n,o,u,f){var g,x,k;return(g=Math.sqrt(e*e+t*t))&&(e/=g,t/=g),(k=e*n+t*o)&&(n-=e*k,o-=t*k),(x=Math.sqrt(n*n+o*o))&&(n/=x,o/=x,k/=x),e*o<t*n&&(e=-e,t=-t,k=-k,g=-g),{translateX:u,translateY:f,rotate:Math.atan2(t,e)*fl,skewX:Math.atan(k)*fl,scaleX:g,scaleY:x}};function gv(e,t,n,o){function u(f){return f.length?f.pop()+" ":""}return function(f,g){var x=[],k=[];return f=e(f),g=e(g),function(F,V,X,te,ue,he){if(F!==X||V!==te){var be=ue.push("translate(",null,t,null,n);he.push({i:be-4,x:Gi(F,X)},{i:be-2,x:Gi(V,te)})}else(X||te)&&ue.push("translate("+X+t+te+n)}(f.translateX,f.translateY,g.translateX,g.translateY,x,k),function(F,V,X,te){F!==V?(F-V>180?V+=360:V-F>180&&(F+=360),te.push({i:X.push(u(X)+"rotate(",null,o)-2,x:Gi(F,V)})):V&&X.push(u(X)+"rotate("+V+o)}(f.rotate,g.rotate,x,k),function(F,V,X,te){F!==V?te.push({i:X.push(u(X)+"skewX(",null,o)-2,x:Gi(F,V)}):V&&X.push(u(X)+"skewX("+V+o)}(f.skewX,g.skewX,x,k),function(F,V,X,te,ue,he){if(F!==X||V!==te){var be=ue.push(u(ue)+"scale(",null,",",null,")");he.push({i:be-4,x:Gi(F,X)},{i:be-2,x:Gi(V,te)})}else X===1&&te===1||ue.push(u(ue)+"scale("+X+","+te+")")}(f.scaleX,f.scaleY,g.scaleX,g.scaleY,x,k),f=g=null,function(F){for(var V,X=-1,te=k.length;++X<te;)x[(V=k[X]).i]=V.x(F);return x.join("")}}}var l0=gv(function(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?dm:mv(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),j1=gv(function(e){return e==null?dm:(lm||(lm=document.createElementNS("http://www.w3.org/2000/svg","g")),lm.setAttribute("transform",e),(e=lm.transform.baseVal.consolidate())?(e=e.matrix,mv(e.a,e.b,e.c,e.d,e.e,e.f)):dm)},", ",")",")"),z1=1e-12;function xo(e){return((e=Math.exp(e))+1/e)/2}var vv=function e(t,n,o){function u(f,g){var x,k,F=f[0],V=f[1],X=f[2],te=g[0],ue=g[1],he=g[2],be=te-F,Pe=ue-V,Ue=be*be+Pe*Pe;if(Ue<z1)k=Math.log(he/X)/t,x=function(kt){return[F+kt*be,V+kt*Pe,X*Math.exp(t*kt*k)]};else{var We=Math.sqrt(Ue),at=(he*he-X*X+o*Ue)/(2*X*n*We),st=(he*he-X*X-o*Ue)/(2*he*n*We),dt=Math.log(Math.sqrt(at*at+1)-at),ct=Math.log(Math.sqrt(st*st+1)-st);k=(ct-dt)/t,x=function(kt){var St=kt*k,yn=xo(dt),Mn=X/(n*We)*(yn*function(_n){return((_n=Math.exp(2*_n))-1)/(_n+1)}(t*St+dt)-function(_n){return((_n=Math.exp(_n))-1/_n)/2}(dt));return[F+Mn*be,V+Mn*Pe,X*yn/xo(t*St+dt)]}}return x.duration=1e3*k*t/Math.SQRT2,x}return u.rho=function(f){var g=Math.max(.001,+f),x=g*g;return e(g,x,x*x)},u}(Math.SQRT2,2,4);function yv(e){return function(t,n){var o=e((t=pr(t)).h,(n=pr(n)).h),u=si(t.s,n.s),f=si(t.l,n.l),g=si(t.opacity,n.opacity);return function(x){return t.h=o(x),t.s=u(x),t.l=f(x),t.opacity=g(x),t+""}}}var og=yv(wi),bv=yv(si);const hm=Math.PI/180,Wl=180/Math.PI,Vl=.96422,xv=1,wv=.82521,Xh=4/29,Pd=6/29,Kh=3*Pd*Pd,U1=Pd*Pd*Pd;function ag(e){if(e instanceof tc)return new tc(e.l,e.a,e.b,e.opacity);if(e instanceof bc)return Ev(e);e instanceof ht||(e=qt(e));var t,n,o=_v(e.r),u=_v(e.g),f=_v(e.b),g=Mf((.2225045*o+.7168786*u+.0606169*f)/xv);return o===u&&u===f?t=n=g:(t=Mf((.4360747*o+.3850649*u+.1430804*f)/Vl),n=Mf((.0139322*o+.0971045*u+.7141733*f)/wv)),new tc(116*g-16,500*(t-g),200*(g-n),e.opacity)}function Hl(e,t,n,o){return arguments.length===1?ag(e):new tc(e,t,n,o??1)}function tc(e,t,n,o){this.l=+e,this.a=+t,this.b=+n,this.opacity=+o}function Mf(e){return e>U1?Math.pow(e,1/3):e/Kh+Xh}function Df(e){return e>Pd?e*e*e:Kh*(e-Xh)}function Nf(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function _v(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function sg(e){if(e instanceof bc)return new bc(e.h,e.c,e.l,e.opacity);if(e instanceof tc||(e=ag(e)),e.a===0&&e.b===0)return new bc(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*Wl;return new bc(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function nc(e,t,n,o){return arguments.length===1?sg(e):new bc(e,t,n,o??1)}function bc(e,t,n,o){this.h=+e,this.c=+t,this.l=+n,this.opacity=+o}function Ev(e){if(isNaN(e.h))return new tc(e.l,0,0,e.opacity);var t=e.h*hm;return new tc(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}function pm(e,t){var n=si((e=Hl(e)).l,(t=Hl(t)).l),o=si(e.a,t.a),u=si(e.b,t.b),f=si(e.opacity,t.opacity);return function(g){return e.l=n(g),e.a=o(g),e.b=u(g),e.opacity=f(g),e+""}}function f0(e){return function(t,n){var o=e((t=nc(t)).h,(n=nc(n)).h),u=si(t.c,n.c),f=si(t.l,n.l),g=si(t.opacity,n.opacity);return function(x){return t.h=o(x),t.c=u(x),t.l=f(x),t.opacity=g(x),t+""}}}Hh(tc,Hl,jl(du,{brighter:function(e){return new tc(this.l+18*(e??1),this.a,this.b,this.opacity)},darker:function(e){return new tc(this.l-18*(e??1),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new ht(Nf(3.1338561*(t=Vl*Df(t))-1.6168667*(e=xv*Df(e))-.4906146*(n=wv*Df(n))),Nf(-.9787684*t+1.9161415*e+.033454*n),Nf(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),Hh(bc,nc,jl(du,{brighter:function(e){return new bc(this.h,this.c,this.l+18*(e??1),this.opacity)},darker:function(e){return new bc(this.h,this.c,this.l-18*(e??1),this.opacity)},rgb:function(){return Ev(this).rgb()}}));var W1=f0(wi),Fy=f0(si),If=-.29227,Yh=-.90649,Ld=1.97294,Bd=Ld*Yh,Sv=1.78277*Ld,d0=1.78277*If- -.14861*Yh;function jd(e,t,n,o){return arguments.length===1?function(u){if(u instanceof go)return new go(u.h,u.s,u.l,u.opacity);u instanceof ht||(u=qt(u));var f=u.r/255,g=u.g/255,x=u.b/255,k=(d0*x+Bd*f-Sv*g)/(d0+Bd-Sv),F=x-k,V=(Ld*(g-k)-If*F)/Yh,X=Math.sqrt(V*V+F*F)/(Ld*k*(1-k)),te=X?Math.atan2(V,F)*Wl-120:NaN;return new go(te<0?te+360:te,X,k,u.opacity)}(e):new go(e,t,n,o??1)}function go(e,t,n,o){this.h=+e,this.s=+t,this.l=+n,this.opacity=+o}function Ff(e){return function t(n){function o(u,f){var g=e((u=jd(u)).h,(f=jd(f)).h),x=si(u.s,f.s),k=si(u.l,f.l),F=si(u.opacity,f.opacity);return function(V){return u.h=g(V),u.s=x(V),u.l=k(Math.pow(V,n)),u.opacity=F(V),u+""}}return n=+n,o.gamma=t,o}(1)}Hh(go,jd,jl(du,{brighter:function(e){return e=e==null?1/.7:Math.pow(1/.7,e),new go(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?.7:Math.pow(.7,e),new go(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*hm,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),o=Math.cos(e),u=Math.sin(e);return new ht(255*(t+n*(-.14861*o+1.78277*u)),255*(t+n*(If*o+Yh*u)),255*(t+n*(Ld*o)),this.opacity)}}));var Jh=Ff(wi),Ry=Ff(si),Py=function(e,t){for(var n=new Array(t),o=0;o<t;++o)n[o]=e(o/(t-1));return n};function ug(e,t,n){const o=e-t+2*n;return e?o>0?o:1:0}const Rf="linear",Gl="log",mm="pow",Qh="sqrt",zd="symlog",Pf="time",Lf="utc",rc="sequential",Zh="diverging",Ud="quantile",ql="quantize",dl="threshold",Wd="ordinal",cg="point",Vd="band",hl="bin-ordinal",ps="continuous",Uc="discrete",ic="discretizing",Ru="interpolating",ep="temporal";function lg(){const e=Bc().unknown(void 0),t=e.domain,n=e.range;let o,u,f=[0,1],g=!1,x=0,k=0,F=.5;function V(){const X=t().length,te=f[1]<f[0],ue=f[1-te],he=ug(X,x,k);let be=f[te-0];o=(ue-be)/(he||1),g&&(o=Math.floor(o)),be+=(ue-be-o*(X-x))*F,u=o*(1-x),g&&(be=Math.round(be),u=Math.round(u));const Pe=Ns(X).map(Ue=>be+o*Ue);return n(te?Pe.reverse():Pe)}return delete e.unknown,e.domain=function(X){return arguments.length?(t(X),V()):t()},e.range=function(X){return arguments.length?(f=[+X[0],+X[1]],V()):f.slice()},e.rangeRound=function(X){return f=[+X[0],+X[1]],g=!0,V()},e.bandwidth=function(){return u},e.step=function(){return o},e.round=function(X){return arguments.length?(g=!!X,V()):g},e.padding=function(X){return arguments.length?(k=Math.max(0,Math.min(1,X)),x=k,V()):x},e.paddingInner=function(X){return arguments.length?(x=Math.max(0,Math.min(1,X)),V()):x},e.paddingOuter=function(X){return arguments.length?(k=Math.max(0,Math.min(1,X)),V()):k},e.align=function(X){return arguments.length?(F=Math.max(0,Math.min(1,X)),V()):F},e.invertRange=function(X){if(X[0]==null||X[1]==null)return;const te=f[1]<f[0],ue=te?n().reverse():n(),he=ue.length-1;let be,Pe,Ue,We=+X[0],at=+X[1];return We!=We||at!=at||(at<We&&(Ue=We,We=at,at=Ue),at<ue[0]||We>f[1-te])?void 0:(be=Math.max(0,Ua(ue,We)-1),Pe=We===at?be:Ua(ue,at)-1,We-ue[be]>u+1e-10&&++be,te&&(Ue=be,be=he-Pe,Pe=he-Ue),be>Pe?void 0:t().slice(be,Pe+1))},e.invert=function(X){const te=e.invertRange([X,X]);return te&&te[0]},e.copy=function(){return lg().domain(t()).range(f).round(g).paddingInner(x).paddingOuter(k).align(F)},V()}var h0=Array.prototype.map;const p0=Array.prototype.slice,gm={};function Vo(e,t,n){return arguments.length>1?(gm[e]=function(o,u,f){const g=function(){const x=u();return x.invertRange||(x.invertRange=x.invert?function(k){return function(F){let V,X=F[0],te=F[1];return te<X&&(V=X,X=te,te=V),[k.invert(X),k.invert(te)]}}(x):x.invertExtent?function(k){return function(F){const V=k.range();let X,te,ue,he,be=F[0],Pe=F[1],Ue=-1;for(Pe<be&&(te=be,be=Pe,Pe=te),ue=0,he=V.length;ue<he;++ue)V[ue]>=be&&V[ue]<=Pe&&(Ue<0&&(Ue=ue),X=ue);if(!(Ue<0))return be=k.invertExtent(V[Ue]),Pe=k.invertExtent(V[X]),[be[0]===void 0?be[1]:be[0],Pe[1]===void 0?Pe[0]:Pe[1]]}}(x):void 0),x.type=o,x};return g.metadata=Object(Ce.Fa)(Object(Ce.i)(f)),g}(e,t,n),this):vm(e)?gm[e]:void 0}function vm(e){return Object(Ce.w)(gm,e)}function Wc(e,t){const n=gm[e];return n&&n.metadata[t]}function Hd(e){return Wc(e,ps)}function Gd(e){return Wc(e,Uc)}function ym(e){return Wc(e,ic)}function fg(e){return Wc(e,Gl)}function dg(e){return Wc(e,Ru)}function hg(e){return Wc(e,Ud)}Vo("identity",function e(t){var n;function o(u){return u==null||isNaN(u=+u)?n:u}return o.invert=o,o.domain=o.range=function(u){return arguments.length?(t=Array.from(u,ds),o):t.slice()},o.unknown=function(u){return arguments.length?(n=u,o):n},o.copy=function(){return e(t).unknown(n)},t=arguments.length?Array.from(t,ds):[0,1],hu(o)}),Vo(Rf,function e(){var t=jc();return t.copy=function(){return $a(t,e())},fu.apply(t,arguments),hu(t)},ps),Vo(Gl,function e(){var t=Us(Uo()).domain([1,10]);return t.copy=function(){return $a(t,e()).base(t.base())},fu.apply(t,arguments),t},[ps,Gl]),Vo(mm,hs,ps),Vo(Qh,function(){return hs.apply(null,arguments).exponent(.5)},ps),Vo(zd,function e(){var t=zl(Uo());return t.copy=function(){return $a(t,e()).constant(t.constant())},fu.apply(t,arguments)},ps),Vo(Pf,function(){return fu.apply(qh(cm,i0,lv.a,n0.a,t0.b,cv.a,uv.a,Tf.a,Ul.a,o0.a).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)},[ps,ep]),Vo(Lf,function(){return fu.apply(qh(cl,Fd,hv.a,dv.a,um.b,Id.a,fv.a,r0.a,Ul.a,o0.c).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)},[ps,ep]),Vo(rc,s0,[ps,Ru]),Vo("".concat(rc,"-").concat(Rf),s0,[ps,Ru]),Vo("".concat(rc,"-").concat(Gl),function e(){var t=Us(Rd()).domain([1,10]);return t.copy=function(){return ll(t,e()).base(t.base())},Ku.apply(t,arguments)},[ps,Ru,Gl]),Vo("".concat(rc,"-").concat(mm),u0,[ps,Ru]),Vo("".concat(rc,"-").concat(Qh),function(){return u0.apply(null,arguments).exponent(.5)},[ps,Ru]),Vo("".concat(rc,"-").concat(zd),function e(){var t=zl(Rd());return t.copy=function(){return ll(t,e()).constant(t.constant())},Ku.apply(t,arguments)},[ps,Ru]),Vo("".concat(Zh,"-").concat(Rf),function e(){var t=hu(c0()(Oo));return t.copy=function(){return ll(t,e())},Ku.apply(t,arguments)},[ps,Ru]),Vo("".concat(Zh,"-").concat(Gl),function e(){var t=Us(c0()).domain([.1,1,10]);return t.copy=function(){return ll(t,e()).base(t.base())},Ku.apply(t,arguments)},[ps,Ru,Gl]),Vo("".concat(Zh,"-").concat(mm),$h,[ps,Ru]),Vo("".concat(Zh,"-").concat(Qh),function(){return $h.apply(null,arguments).exponent(.5)},[ps,Ru]),Vo("".concat(Zh,"-").concat(zd),function e(){var t=zl(c0());return t.copy=function(){return ll(t,e()).constant(t.constant())},Ku.apply(t,arguments)},[ps,Ru]),Vo(Ud,function e(){var t,n=[],o=[],u=[];function f(){var x=0,k=Math.max(1,o.length);for(u=new Array(k-1);++x<k;)u[x-1]=xi(n,x/k);return g}function g(x){return x==null||isNaN(x=+x)?t:o[aa(u,x)]}return g.invertExtent=function(x){var k=o.indexOf(x);return k<0?[NaN,NaN]:[k>0?u[k-1]:n[0],k<u.length?u[k]:n[n.length-1]]},g.domain=function(x){if(!arguments.length)return n.slice();n=[];for(let k of x)k==null||isNaN(k=+k)||n.push(k);return n.sort(Bn.a),f()},g.range=function(x){return arguments.length?(o=Array.from(x),f()):o.slice()},g.unknown=function(x){return arguments.length?(t=x,g):t},g.quantiles=function(){return u.slice()},g.copy=function(){return e().domain(n).range(o).unknown(t)},fu.apply(g,arguments)},[ic,Ud]),Vo(ql,function e(){var t,n=0,o=1,u=1,f=[.5],g=[0,1];function x(F){return F!=null&&F<=F?g[aa(f,F,0,u)]:t}function k(){var F=-1;for(f=new Array(u);++F<u;)f[F]=((F+1)*o-(F-u)*n)/(u+1);return x}return x.domain=function(F){return arguments.length?([n,o]=F,n=+n,o=+o,k()):[n,o]},x.range=function(F){return arguments.length?(u=(g=Array.from(F)).length-1,k()):g.slice()},x.invertExtent=function(F){var V=g.indexOf(F);return V<0?[NaN,NaN]:V<1?[n,f[0]]:V>=u?[f[u-1],o]:[f[V-1],f[V]]},x.unknown=function(F){return arguments.length&&(t=F),x},x.thresholds=function(){return f.slice()},x.copy=function(){return e().domain([n,o]).range(g).unknown(t)},fu.apply(hu(x),arguments)},ic),Vo(dl,function e(){var t,n=[.5],o=[0,1],u=1;function f(g){return g!=null&&g<=g?o[aa(n,g,0,u)]:t}return f.domain=function(g){return arguments.length?(n=Array.from(g),u=Math.min(n.length,o.length-1),f):n.slice()},f.range=function(g){return arguments.length?(o=Array.from(g),u=Math.min(n.length,o.length-1),f):o.slice()},f.invertExtent=function(g){var x=o.indexOf(g);return[n[x-1],n[x]]},f.unknown=function(g){return arguments.length?(t=g,f):t},f.copy=function(){return e().domain(n).range(o).unknown(t)},fu.apply(f,arguments)},ic),Vo(hl,function e(){let t=[],n=[];function o(u){return u==null||u!=u?void 0:n[(aa(t,u)-1)%n.length]}return o.domain=function(u){return arguments.length?(t=function(f){return h0.call(f,Ce.Ea)}(u),o):t.slice()},o.range=function(u){return arguments.length?(n=p0.call(u),o):n.slice()},o.tickFormat=function(u,f){return Bl(t[0],Object(Ce.W)(t),u??10,f)},o.copy=function(){return e().domain(o.domain()).range(o.range())},o},[Uc,ic]),Vo(Wd,Bc,Uc),Vo(Vd,lg,Uc),Vo(cg,function(){return function e(t){const n=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,t.copy=function(){return e(n())},t}(lg().paddingInner(1))},Uc);const Cv=["clamp","base","constant","exponent"];function pg(e,t){const n=t[0],o=Object(Ce.W)(t)-n;return function(u){return e(n+u*o)}}function Bf(e,t,n){return ec(gg(t||"rgb",n),e)}function mg(e,t){const n=new Array(t),o=t+1;for(let u=0;u<t;)n[u]=e(++u/o);return n}function tp(e,t,n){const o=n-t;let u,f,g;return o&&Number.isFinite(o)?(u=(f=e.type).indexOf("-"),f=u<0?f:f.slice(u+1),g=Vo(f)().domain([t,n]).range([0,1]),Cv.forEach(x=>e[x]?g[x](e[x]()):0),g):Object(Ce.m)(.5)}function gg(e,t){const n=A[function(o){return"interpolate"+o.toLowerCase().split("-").map(u=>u[0].toUpperCase()+u.slice(1)).join("")}(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function m0(e){const t=e.length/6|0,n=new Array(t);for(let o=0;o<t;)n[o]="#"+e.slice(6*o,6*++o);return n}function g0(e,t){for(const n in e)v0(n,t(e[n]))}const bm={};function v0(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(bm[e]=t,this):bm[e]}g0({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},m0),g0({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},e=>Bf(m0(e)));const vg="symbol",kv="discrete",$l=e=>Object(Ce.B)(e)?e.map(t=>String(t)):String(e),Ly=(e,t)=>e[1]-t[1],Av=(e,t)=>t[1]-e[1];function xm(e,t,n){let o;return Object(Ce.G)(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),n!=null&&(t=Math.min(t,Math.floor(Object(Ce.Z)(e.domain())/n||1)))),Object(Ce.H)(t)&&(o=t.step,t=t.interval),Object(Ce.J)(t)&&(t=e.type===Pf?Object(br.p)(t):e.type==Lf?Object(br.v)(t):Object(Ce.o)("Only time and utc scales accept interval strings."),o&&(t=t.every(o))),t}function Ov(e,t,n){let o=e.range(),u=o[0],f=Object(Ce.W)(o),g=Ly;if(u>f&&(o=f,f=u,u=o,g=Av),u=Math.floor(u),f=Math.ceil(f),t=t.map(x=>[x,e(x)]).filter(x=>u<=x[1]&&x[1]<=f).sort(g).map(x=>x[0]),n>0&&t.length>1){const x=[t[0],Object(Ce.W)(t)];for(;t.length>n&&t.length>=3;)t=t.filter((k,F)=>!(F%2));t.length<3&&(t=x)}return t}function jf(e,t){return e.bins?Ov(e,e.bins):e.ticks?e.ticks(t):e.domain()}function Tv(e,t,n,o,u,f){const g=t.type;let x=$l;if(g===Pf||u===Pf)x=e.timeFormat(o);else if(g===Lf||u===Lf)x=e.utcFormat(o);else if(fg(g)){const k=e.formatFloat(o);if(f||t.bins)x=k;else{const F=wm(t,n,!1);x=V=>F(V)?k(V):""}}else if(t.tickFormat){const k=t.domain();x=e.formatSpan(k[0],k[k.length-1],n,o)}else o&&(x=e.format(o));return x}function wm(e,t,n){const o=jf(e,t),u=e.base(),f=Math.log(u),g=Math.max(1,u*t/o.length),x=k=>{let F=k/Math.pow(u,Math.round(Math.log(k)/f));return F*u<u-.5&&(F*=u),F<=g};return n?o.filter(x):x}const yg={[Ud]:"quantiles",[ql]:"thresholds",[dl]:"domain"},Mv={[Ud]:"quantiles",[ql]:"domain"};function Dv(e,t){return e.bins?function(n){const o=n.slice(0,-1);return o.max=Object(Ce.W)(n),o}(e.bins):e.type===Gl?wm(e,t,!0):yg[e.type]?function(n){const o=[-1/0].concat(n);return o.max=1/0,o}(e[yg[e.type]]()):jf(e,t)}const y0=e=>yg[e.type]||e.bins;function Nv(e,t,n,o,u,f,g){const x=Mv[t.type]&&f!==Pf&&f!==Lf?function(k,F,V){const X=F[Mv[F.type]](),te=X.length;let ue,he=te>1?X[1]-X[0]:X[0];for(ue=1;ue<te;++ue)he=Math.min(he,X[ue]-X[ue-1]);return k.formatSpan(0,he,30,V)}(e,t,u):Tv(e,t,n,u,f,g);return o===vg&&y0(t)?Iv(x):o===kv?By(x):Fv(x)}const Iv=e=>(t,n,o)=>{const u=qd(o[n+1],qd(o.max,1/0)),f=Xl(t,e),g=Xl(u,e);return f&&g?f+"  "+g:g?"< "+g:" "+f},qd=(e,t)=>e??t,By=e=>(t,n)=>n?e(t):null,Fv=e=>t=>e(t),Xl=(e,t)=>Number.isFinite(e)?t(e):null;function b0(e,t,n,o){const u=o||t.type;return Object(Ce.J)(n)&&function(f){return Wc(f,ep)}(u)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||u!==Pf?n||u!==Lf?Nv(e,t,5,null,n,o,!0):e.utcFormat("%A, %d %B %Y, %X UTC"):e.timeFormat("%A, %d %B %Y, %X")}function Rv(e,t,n){n=n||{};const o=Math.max(3,n.maxlen||7),u=b0(e,t,n.format,n.formatType);if(ym(t.type)){const f=Dv(t).slice(1).map(u),g=f.length;return"".concat(g," boundar").concat(g===1?"y":"ies",": ").concat(f.join(", "))}if(Gd(t.type)){const f=t.domain(),g=f.length,x=g>o?f.slice(0,o-2).map(u).join(", ")+", ending with "+f.slice(-1).map(u):f.map(u).join(", ");return"".concat(g," value").concat(g===1?"":"s",": ").concat(x)}{const f=t.domain();return"values from ".concat(u(f[0])," to ").concat(u(Object(Ce.W)(f)))}}let $d=0;const Kl="p_";function bg(e){return e&&e.gradient}function x0(e,t,n){const o=e.gradient;let u=e.id,f=o==="radial"?Kl:"";return u||(u=e.id="gradient_"+$d++,o==="radial"?(e.x1=Vc(e.x1,.5),e.y1=Vc(e.y1,.5),e.r1=Vc(e.r1,0),e.x2=Vc(e.x2,.5),e.y2=Vc(e.y2,.5),e.r2=Vc(e.r2,.5),f=Kl):(e.x1=Vc(e.x1,0),e.y1=Vc(e.y1,0),e.x2=Vc(e.x2,1),e.y2=Vc(e.y2,0))),t[u]=e,"url("+(n||"")+"#"+f+u+")"}function Vc(e,t){return e??t}function w0(e,t){var n,o=[];return n={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:o,stop:function(u,f){return o.push({offset:u,color:f}),n}}}const Pv={basis:{curve:function(e){return new Bh(e)}},"basis-closed":{curve:function(e){return new jh(e)}},"basis-open":{curve:function(e){return new bf(e)}},bundle:{curve:xf,tension:"beta",value:.85},cardinal:{curve:Uh,tension:"tension",value:0},"cardinal-open":{curve:wf,tension:"tension",value:0},"cardinal-closed":{curve:Zg,tension:"tension",value:0},"catmull-rom":{curve:gc,tension:"alpha",value:.5},"catmull-rom-closed":{curve:nm,tension:"alpha",value:.5},"catmull-rom-open":{curve:ig,tension:"alpha",value:.5},linear:{curve:Pl},"linear-closed":{curve:function(e){return new rm(e)}},monotone:{horizontal:function(e){return new Ad(e)},vertical:function(e){return new Cf(e)}},natural:{curve:function(e){return new im(e)}},step:{curve:function(e){return new kf(e,.5)}},"step-after":{curve:function(e){return new kf(e,1)}},"step-before":{curve:function(e){return new kf(e,0)}}};function zf(e,t,n){var o=Object(Ce.w)(Pv,e)&&Pv[e],u=null;return o&&(u=o.curve||o[t||"vertical"],o.tension&&n!=null&&(u=u[o.tension](n))),u}const jy={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},np=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function rp(e){const t=[];let n,o,u,f,g,x,k,F,V,X;const te=e.slice().replace(np[0],"###$1").split(np[1]).slice(1);for(k=0,V=te.length;k<V;++k){for(o=(n=te[k]).slice(1).trim().replace(np[2],"$1###$2").replace(np[3],"$1###$2").split(np[4]),u=[g=n.charAt(0)],F=0,X=o.length;F<X;++F)(f=+o[F])===f&&u.push(f);if(x=jy[g.toLowerCase()],u.length-1>x){const ue=u.length;for(F=1,t.push([g].concat(u.slice(F,F+=x))),g=g==="M"?"L":g==="m"?"l":g;F<ue;F+=x)t.push([g].concat(u.slice(F,F+x)))}else t.push(u)}return t}const Uf=Math.PI/180,Lv=1e-14,Xd=Math.PI/2,Hc=2*Math.PI,ip=Math.sqrt(3)/2;var _m={},xg={},_0=[].join;function Bv(e){const t=_0.call(e);if(xg[t])return xg[t];var n=e[0],o=e[1],u=e[2],f=e[3],g=e[4],x=e[5],k=e[6],F=e[7];const V=F*g,X=-k*x,te=k*g,ue=F*x,he=Math.cos(u),be=Math.sin(u),Pe=Math.cos(f),Ue=Math.sin(f),We=.5*(f-u),at=Math.sin(.5*We),st=8/3*at*at/Math.sin(We),dt=n+he-st*be,ct=o+be+st*he,kt=n+Pe,St=o+Ue,yn=kt+st*Ue,Mn=St-st*Pe;return xg[t]=[V*dt+X*ct,te*dt+ue*ct,V*yn+X*Mn,te*yn+ue*Mn,V*kt+X*St,te*kt+ue*St]}const ms=["l",0,0,0,0,0,0,0];function jv(e,t,n){const o=ms[0]=e[0];if(o==="a"||o==="A")ms[1]=t*e[1],ms[2]=n*e[2],ms[3]=e[3],ms[4]=e[4],ms[5]=e[5],ms[6]=t*e[6],ms[7]=n*e[7];else if(o==="h"||o==="H")ms[1]=t*e[1];else if(o==="v"||o==="V")ms[1]=n*e[1];else for(var u=1,f=e.length;u<f;++u)ms[u]=(u%2==1?t:n)*e[u];return ms}function op(e,t,n,o,u,f){var g,x,k,F,V,X=null,te=0,ue=0,he=0,be=0;n==null&&(n=0),o==null&&(o=0),u==null&&(u=1),f==null&&(f=u),e.beginPath&&e.beginPath();for(var Pe=0,Ue=t.length;Pe<Ue;++Pe){switch(g=t[Pe],u===1&&f===1||(g=jv(g,u,f)),g[0]){case"l":te+=g[1],ue+=g[2],e.lineTo(te+n,ue+o);break;case"L":te=g[1],ue=g[2],e.lineTo(te+n,ue+o);break;case"h":te+=g[1],e.lineTo(te+n,ue+o);break;case"H":te=g[1],e.lineTo(te+n,ue+o);break;case"v":ue+=g[1],e.lineTo(te+n,ue+o);break;case"V":ue=g[1],e.lineTo(te+n,ue+o);break;case"m":te+=g[1],ue+=g[2],e.moveTo(te+n,ue+o);break;case"M":te=g[1],ue=g[2],e.moveTo(te+n,ue+o);break;case"c":x=te+g[5],k=ue+g[6],he=te+g[3],be=ue+g[4],e.bezierCurveTo(te+g[1]+n,ue+g[2]+o,he+n,be+o,x+n,k+o),te=x,ue=k;break;case"C":te=g[5],ue=g[6],he=g[3],be=g[4],e.bezierCurveTo(g[1]+n,g[2]+o,he+n,be+o,te+n,ue+o);break;case"s":x=te+g[3],k=ue+g[4],he=2*te-he,be=2*ue-be,e.bezierCurveTo(he+n,be+o,te+g[1]+n,ue+g[2]+o,x+n,k+o),he=te+g[1],be=ue+g[2],te=x,ue=k;break;case"S":x=g[3],k=g[4],he=2*te-he,be=2*ue-be,e.bezierCurveTo(he+n,be+o,g[1]+n,g[2]+o,x+n,k+o),te=x,ue=k,he=g[1],be=g[2];break;case"q":x=te+g[3],k=ue+g[4],he=te+g[1],be=ue+g[2],e.quadraticCurveTo(he+n,be+o,x+n,k+o),te=x,ue=k;break;case"Q":x=g[3],k=g[4],e.quadraticCurveTo(g[1]+n,g[2]+o,x+n,k+o),te=x,ue=k,he=g[1],be=g[2];break;case"t":x=te+g[1],k=ue+g[2],X[0].match(/[QqTt]/)===null?(he=te,be=ue):X[0]==="t"?(he=2*te-F,be=2*ue-V):X[0]==="q"&&(he=2*te-he,be=2*ue-be),F=he,V=be,e.quadraticCurveTo(he+n,be+o,x+n,k+o),ue=k,he=(te=x)+g[1],be=ue+g[2];break;case"T":x=g[1],k=g[2],he=2*te-he,be=2*ue-be,e.quadraticCurveTo(he+n,be+o,x+n,k+o),te=x,ue=k;break;case"a":zv(e,te+n,ue+o,[g[1],g[2],g[3],g[4],g[5],g[6]+te+n,g[7]+ue+o]),te+=g[6],ue+=g[7];break;case"A":zv(e,te+n,ue+o,[g[1],g[2],g[3],g[4],g[5],g[6]+n,g[7]+o]),te=g[6],ue=g[7];break;case"z":case"Z":e.closePath()}X=g}}function zv(e,t,n,o){const u=function(f,g,x,k,F,V,X,te,ue){const he=_0.call(arguments);if(_m[he])return _m[he];const be=X*Uf,Pe=Math.sin(be),Ue=Math.cos(be),We=Ue*(te-f)*.5+Pe*(ue-g)*.5,at=Ue*(ue-g)*.5-Pe*(te-f)*.5;let st=We*We/((x=Math.abs(x))*x)+at*at/((k=Math.abs(k))*k);st>1&&(x*=st=Math.sqrt(st),k*=st);const dt=Ue/x,ct=Pe/x,kt=-Pe/k,St=Ue/k,yn=dt*te+ct*ue,Mn=kt*te+St*ue,_n=dt*f+ct*g,$n=kt*f+St*g;let qn=1/((_n-yn)*(_n-yn)+($n-Mn)*($n-Mn))-.25;qn<0&&(qn=0);let er=Math.sqrt(qn);V==F&&(er=-er);const rr=.5*(yn+_n)-er*($n-Mn),fr=.5*(Mn+$n)+er*(_n-yn),Dr=Math.atan2(Mn-fr,yn-rr);let Zr=Math.atan2($n-fr,_n-rr)-Dr;Zr<0&&V===1?Zr+=Hc:Zr>0&&V===0&&(Zr-=Hc);const Br=Math.ceil(Math.abs(Zr/(Xd+.001))),di=[];for(let Ti=0;Ti<Br;++Ti){const Di=Dr+Ti*Zr/Br,Zi=Dr+(Ti+1)*Zr/Br;di[Ti]=[rr,fr,Di,Zi,x,k,Pe,Ue]}return _m[he]=di}(o[5],o[6],o[0],o[1],o[3],o[4],o[2],t,n);for(let f=0;f<u.length;++f){const g=Bv(u[f]);e.bezierCurveTo(g[0],g[1],g[2],g[3],g[4],g[5])}}const wg={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,Hc)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,o=n/2.5;e.moveTo(-n,-o),e.lineTo(-n,o),e.lineTo(-o,o),e.lineTo(-o,n),e.lineTo(o,n),e.lineTo(o,o),e.lineTo(n,o),e.lineTo(n,-o),e.lineTo(o,-o),e.lineTo(o,-n),e.lineTo(-o,-n),e.lineTo(-o,-o),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),o=-n/2;e.rect(o,o,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,o=n/7,u=n/2.5,f=n/8;e.moveTo(-o,n),e.lineTo(o,n),e.lineTo(o,-f),e.lineTo(u,-f),e.lineTo(0,-n),e.lineTo(-u,-f),e.lineTo(-o,-f),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,o=ip*n,u=o-.5773502691896257*n,f=n/4;e.moveTo(0,-o-u),e.lineTo(-f,o-u),e.lineTo(f,o-u),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,o=ip*n,u=o-.5773502691896257*n;e.moveTo(0,-o-u),e.lineTo(-n,o-u),e.lineTo(n,o-u),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,o=ip*n;e.moveTo(0,-o),e.lineTo(-n,o),e.lineTo(n,o),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,o=ip*n;e.moveTo(0,o),e.lineTo(-n,-o),e.lineTo(n,-o),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,o=ip*n;e.moveTo(o,0),e.lineTo(-o,-n),e.lineTo(-o,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,o=ip*n;e.moveTo(-o,0),e.lineTo(o,-n),e.lineTo(o,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function Wf(e){return Object(Ce.w)(wg,e)?wg[e]:function(t){if(!Object(Ce.w)(Em,t)){const n=rp(t);Em[t]={draw:function(o,u){op(o,n,0,0,Math.sqrt(u)/2)}}}return Em[t]}(e)}var Em={};const Yl=.448084975506;function Uv(e){return e.x}function _g(e){return e.y}function Eg(e){return e.width}function E0(e){return e.height}function pl(e){return typeof e=="function"?e:()=>+e}function Sg(e,t,n){return Math.max(t,Math.min(e,n))}function Wv(){var e=Uv,t=_g,n=Eg,o=E0,u=pl(0),f=u,g=u,x=u,k=null;function F(V,X,te){var ue,he=X??+e.call(this,V),be=te??+t.call(this,V),Pe=+n.call(this,V),Ue=+o.call(this,V),We=Math.min(Pe,Ue)/2,at=Sg(+u.call(this,V),0,We),st=Sg(+f.call(this,V),0,We),dt=Sg(+g.call(this,V),0,We),ct=Sg(+x.call(this,V),0,We);if(k||(k=ue=js()),at<=0&&st<=0&&dt<=0&&ct<=0)k.rect(he,be,Pe,Ue);else{var kt=he+Pe,St=be+Ue;k.moveTo(he+at,be),k.lineTo(kt-st,be),k.bezierCurveTo(kt-Yl*st,be,kt,be+Yl*st,kt,be+st),k.lineTo(kt,St-ct),k.bezierCurveTo(kt,St-Yl*ct,kt-Yl*ct,St,kt-ct,St),k.lineTo(he+dt,St),k.bezierCurveTo(he+Yl*dt,St,he,St-Yl*dt,he,St-dt),k.lineTo(he,be+at),k.bezierCurveTo(he,be+Yl*at,he+Yl*at,be,he+at,be),k.closePath()}if(ue)return k=null,ue+""||null}return F.x=function(V){return arguments.length?(e=pl(V),F):e},F.y=function(V){return arguments.length?(t=pl(V),F):t},F.width=function(V){return arguments.length?(n=pl(V),F):n},F.height=function(V){return arguments.length?(o=pl(V),F):o},F.cornerRadius=function(V,X,te,ue){return arguments.length?(u=pl(V),f=X!=null?pl(X):u,x=te!=null?pl(te):u,g=ue!=null?pl(ue):f,F):u},F.context=function(V){return arguments.length?(k=V??null,F):k},F}function Jl(){var e,t,n,o,u,f,g,x,k=null;function F(X,te,ue){const he=ue/2;if(u){var be=g-te,Pe=X-f;if(be||Pe){var Ue=Math.sqrt(be*be+Pe*Pe),We=(be/=Ue)*x,at=(Pe/=Ue)*x,st=Math.atan2(Pe,be);k.moveTo(f-We,g-at),k.lineTo(X-be*he,te-Pe*he),k.arc(X,te,he,st-Math.PI,st),k.lineTo(f+We,g+at),k.arc(f,g,x,st,st+Math.PI)}else k.arc(X,te,he,0,Hc);k.closePath()}else u=1;f=X,g=te,x=he}function V(X){var te,ue,he,be=X.length,Pe=!1;for(k==null&&(k=he=js()),te=0;te<=be;++te)!(te<be&&o(ue=X[te],te,X))===Pe&&(Pe=!Pe)&&(u=0),Pe&&F(+e(ue,te,X),+t(ue,te,X),+n(ue,te,X));if(he)return k=null,he+""||null}return V.x=function(X){return arguments.length?(e=X,V):e},V.y=function(X){return arguments.length?(t=X,V):t},V.size=function(X){return arguments.length?(n=X,V):n},V.defined=function(X){return arguments.length?(o=X,V):o},V.context=function(X){return arguments.length?(k=X??null,V):k},V}function Sm(e,t){return e??t}const Kd=e=>e.x||0,Cm=e=>e.y||0,gs=e=>e.defined!==!1,Cg=function(){var e=Af,t=Td,n=vo(0),o=null,u=mr,f=is,g=Na,x=null;function k(){var F,V,X=+e.apply(this,arguments),te=+t.apply(this,arguments),ue=u.apply(this,arguments)-mc,he=f.apply(this,arguments)-mc,be=_f(he-ue),Pe=he>ue;if(x||(x=F=js()),te<X&&(V=te,te=X,X=V),te>qa)if(be>Sd-qa)x.moveTo(te*za(ue),te*Ls(ue)),x.arc(0,0,te,ue,he,!Pe),X>qa&&(x.moveTo(X*za(he),X*Ls(he)),x.arc(0,0,X,he,ue,Pe));else{var Ue,We,at=ue,st=he,dt=ue,ct=he,kt=be,St=be,yn=g.apply(this,arguments)/2,Mn=yn>qa&&(o?+o.apply(this,arguments):al(X*X+te*te)),_n=Xi(_f(te-X)/2,+n.apply(this,arguments)),$n=_n,qn=_n;if(Mn>qa){var er=Cd(Mn/X*Ls(yn)),rr=Cd(Mn/te*Ls(yn));(kt-=2*er)>qa?(dt+=er*=Pe?1:-1,ct-=er):(kt=0,dt=ct=(ue+he)/2),(St-=2*rr)>qa?(at+=rr*=Pe?1:-1,st-=rr):(St=0,at=st=(ue+he)/2)}var fr=te*za(at),Dr=te*Ls(at),Zr=X*za(ct),Br=X*Ls(ct);if(_n>qa){var di,Ti=te*za(st),Di=te*Ls(st),Zi=X*za(dt),Ri=X*Ls(dt);if(be<sl&&(di=function(Ma,rs,Gs,qs,Ms,cf,DA,xI){var g2=Gs-Ma,x1=qs-rs,v2=DA-Ms,Tb=xI-cf,vh=Tb*g2-v2*x1;if(!(vh*vh<qa))return[Ma+(vh=(v2*(rs-cf)-Tb*(Ma-Ms))/vh)*g2,rs+vh*x1]}(fr,Dr,Zi,Ri,Ti,Di,Zr,Br))){var Ni=fr-di[0],Ui=Dr-di[1],To=Ti-di[0],da=Di-di[1],eo=1/Ls(function(Ma){return Ma>1?0:Ma<-1?sl:Math.acos(Ma)}((Ni*To+Ui*da)/(al(Ni*Ni+Ui*Ui)*al(To*To+da*da)))/2),Ta=al(di[0]*di[0]+di[1]*di[1]);$n=Xi(_n,(X-Ta)/(eo-1)),qn=Xi(_n,(te-Ta)/(eo+1))}}St>qa?qn>qa?(Ue=io(Zi,Ri,fr,Dr,te,qn,Pe),We=io(Ti,Di,Zr,Br,te,qn,Pe),x.moveTo(Ue.cx+Ue.x01,Ue.cy+Ue.y01),qn<_n?x.arc(Ue.cx,Ue.cy,qn,ha(Ue.y01,Ue.x01),ha(We.y01,We.x01),!Pe):(x.arc(Ue.cx,Ue.cy,qn,ha(Ue.y01,Ue.x01),ha(Ue.y11,Ue.x11),!Pe),x.arc(0,0,te,ha(Ue.cy+Ue.y11,Ue.cx+Ue.x11),ha(We.cy+We.y11,We.cx+We.x11),!Pe),x.arc(We.cx,We.cy,qn,ha(We.y11,We.x11),ha(We.y01,We.x01),!Pe))):(x.moveTo(fr,Dr),x.arc(0,0,te,at,st,!Pe)):x.moveTo(fr,Dr),X>qa&&kt>qa?$n>qa?(Ue=io(Zr,Br,Ti,Di,X,-$n,Pe),We=io(fr,Dr,Zi,Ri,X,-$n,Pe),x.lineTo(Ue.cx+Ue.x01,Ue.cy+Ue.y01),$n<_n?x.arc(Ue.cx,Ue.cy,$n,ha(Ue.y01,Ue.x01),ha(We.y01,We.x01),!Pe):(x.arc(Ue.cx,Ue.cy,$n,ha(Ue.y01,Ue.x01),ha(Ue.y11,Ue.x11),!Pe),x.arc(0,0,X,ha(Ue.cy+Ue.y11,Ue.cx+Ue.x11),ha(We.cy+We.y11,We.cx+We.x11),Pe),x.arc(We.cx,We.cy,$n,ha(We.y11,We.x11),ha(We.y01,We.x01),!Pe))):x.arc(0,0,X,ct,dt,Pe):x.lineTo(Zr,Br)}else x.moveTo(0,0);if(x.closePath(),F)return x=null,F+""||null}return k.centroid=function(){var F=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,V=(+u.apply(this,arguments)+ +f.apply(this,arguments))/2-sl/2;return[za(V)*F,Ls(V)*F]},k.innerRadius=function(F){return arguments.length?(e=typeof F=="function"?F:vo(+F),k):e},k.outerRadius=function(F){return arguments.length?(t=typeof F=="function"?F:vo(+F),k):t},k.cornerRadius=function(F){return arguments.length?(n=typeof F=="function"?F:vo(+F),k):n},k.padRadius=function(F){return arguments.length?(o=F==null?null:typeof F=="function"?F:vo(+F),k):o},k.startAngle=function(F){return arguments.length?(u=typeof F=="function"?F:vo(+F),k):u},k.endAngle=function(F){return arguments.length?(f=typeof F=="function"?F:vo(+F),k):f},k.padAngle=function(F){return arguments.length?(g=typeof F=="function"?F:vo(+F),k):g},k.context=function(F){return arguments.length?(x=F??null,k):x},k}().startAngle(e=>e.startAngle||0).endAngle(e=>e.endAngle||0).padAngle(e=>e.padAngle||0).innerRadius(e=>e.innerRadius||0).outerRadius(e=>e.outerRadius||0).cornerRadius(e=>e.cornerRadius||0),S0=oa().x(Kd).y1(Cm).y0(e=>(e.y||0)+(e.height||0)).defined(gs),km=oa().y(Cm).x1(Kd).x0(e=>(e.x||0)+(e.width||0)).defined(gs),Am=Lc().x(Kd).y(Cm).defined(gs),C0=Wv().x(Kd).y(Cm).width(e=>e.width||0).height(e=>e.height||0).cornerRadius(e=>Sm(e.cornerRadiusTopLeft,e.cornerRadius)||0,e=>Sm(e.cornerRadiusTopRight,e.cornerRadius)||0,e=>Sm(e.cornerRadiusBottomRight,e.cornerRadius)||0,e=>Sm(e.cornerRadiusBottomLeft,e.cornerRadius)||0),Vv=function(e,t){var n=null;function o(){var u;if(n||(n=u=js()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),u)return n=null,u+""||null}return e=typeof e=="function"?e:vo(e||vc),t=typeof t=="function"?t:vo(t===void 0?64:+t),o.type=function(u){return arguments.length?(e=typeof u=="function"?u:vo(u),o):e},o.size=function(u){return arguments.length?(t=typeof u=="function"?u:vo(+u),o):t},o.context=function(u){return arguments.length?(n=u??null,o):n},o}().type(e=>Wf(e.shape||"circle")).size(e=>Sm(e.size,64)),zy=Jl().x(Kd).y(Cm).defined(gs).size(e=>e.size||1);function ml(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function Yd(e,t,n,o){return C0.context(e)(t,n,o)}var Uy=1;function Hv(){Uy=1}function gl(e,t,n){var o=t.clip,u=e._defs,f=t.clip_id||(t.clip_id="clip"+Uy++),g=u.clipping[f]||(u.clipping[f]={id:f});return Object(Ce.E)(o)?g.path=o(null):ml(n)?g.path=Yd(null,n,0,0):(g.width=n.width||0,g.height=n.height||0),"url(#"+f+")"}function as(e){this.clear(),e&&this.union(e)}function ap(e){this.mark=e,this.bounds=this.bounds||new as}function Om(e){ap.call(this,e),this.items=this.items||[]}function kg(e){this._pending=0,this._loader=e||Object(sr.e)()}function Gv(e){e._pending+=1}function Ag(e){e._pending-=1}function Vf(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){const o=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(o+(n?function(u,f){return u.strokeJoin&&u.strokeJoin!=="miter"?0:f}(t,o):0))}return e}as.prototype={clone(){return new as(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,o){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),o<t?(this.y2=t,this.y1=o):(this.y1=t,this.y2=o),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const o=this.rotatedPoints(e,t,n);return this.clear().add(o[0],o[1]).add(o[2],o[3]).add(o[4],o[5]).add(o[6],o[7])},rotatedPoints(e,t,n){var{x1:o,y1:u,x2:f,y2:g}=this,x=Math.cos(e),k=Math.sin(e),F=t-t*x+n*k,V=n-t*k-n*x;return[x*o-k*u+F,k*o+x*u+V,x*o-k*g+F,k*o+x*g+V,x*f-k*u+F,k*f+x*u+V,x*f-k*g+F,k*f+x*g+V]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},Object(Ce.z)(Om,ap),kg.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return Gv(t),t._loader.sanitize(e,{context:"href"}).then(n=>(Ag(t),n)).catch(()=>(Ag(t),null))},loadImage(e){const t=this,n=bo();return Gv(t),t._loader.sanitize(e,{context:"image"}).then(o=>{const u=o.href;if(!u||!n)throw{url:u};const f=new n,g=Object(Ce.w)(o,"crossOrigin")?o.crossOrigin:"anonymous";return g!=null&&(f.crossOrigin=g),f.onload=()=>Ag(t),f.onerror=()=>Ag(t),f.src=u,f}).catch(o=>(Ag(t),{complete:!1,width:0,height:0,src:o&&o.url||""}))},ready(){const e=this;return new Promise(t=>{(function n(o){e.pending()?setTimeout(()=>{n(!0)},10):t(o)})(!1)})}};const V1=Hc-1e-8;let Og,es,Tm,Jd,Tg,Mm,k0,A0;const Hf=(e,t)=>Og.add(e,t),xc=(e,t)=>Hf(es=e,Tm=t),qv=e=>Hf(e,Og.y1),$v=e=>Hf(Og.x1,e),sp=(e,t)=>Tg*e+k0*t,Dm=(e,t)=>Mm*e+A0*t,Wy=(e,t)=>Hf(sp(e,t),Dm(e,t)),O0=(e,t)=>xc(sp(e,t),Dm(e,t));function Mg(e,t){return Og=e,t?(Jd=t*Uf,Tg=A0=Math.cos(Jd),Mm=Math.sin(Jd),k0=-Mm):(Tg=A0=1,Jd=Mm=k0=0),Yr}const Yr={beginPath(){},closePath(){},moveTo:O0,lineTo:O0,rect(e,t,n,o){Jd?(Wy(e+n,t),Wy(e+n,t+o),Wy(e,t+o),O0(e,t)):(Hf(e+n,t+o),xc(e,t))},quadraticCurveTo(e,t,n,o){const u=sp(e,t),f=Dm(e,t),g=sp(n,o),x=Dm(n,o);$(es,u,g,qv),$(Tm,f,x,$v),xc(g,x)},bezierCurveTo(e,t,n,o,u,f){const g=sp(e,t),x=Dm(e,t),k=sp(n,o),F=Dm(n,o),V=sp(u,f),X=Dm(u,f);M(es,g,k,V,qv),M(Tm,x,F,X,$v),xc(V,X)},arc(e,t,n,o,u,f){if(o+=Jd,u+=Jd,es=n*Math.cos(u)+e,Tm=n*Math.sin(u)+t,Math.abs(u-o)>V1)Hf(e-n,t-n),Hf(e+n,t+n);else{const g=F=>Hf(n*Math.cos(F)+e,n*Math.sin(F)+t);let x,k;if(g(o),g(u),u!==o)if((o%=Hc)<0&&(o+=Hc),(u%=Hc)<0&&(u+=Hc),u<o&&(f=!f,x=o,o=u,u=x),f)for(u-=Hc,x=o-o%Xd,k=0;k<4&&x>u;++k,x-=Xd)g(x);else for(x=o-o%Xd+Xd,k=0;k<4&&x<u;++k,x+=Xd)g(x)}}};function $(e,t,n,o){const u=(e-t)/(e+n-2*t);0<u&&u<1&&o(e+(t-e)*u)}function M(e,t,n,o,u){const f=o-e+3*t-3*n,g=e+n-2*t,x=e-t;let k,F=0,V=0;Math.abs(f)>Lv?(k=g*g+x*f)>=0&&(F=(-g+(k=Math.sqrt(k)))/f,V=(-g-k)/f):F=.5*x/g,0<F&&F<1&&u(T(F,e,t,n,o)),0<V&&V<1&&u(T(V,e,t,n,o))}function T(e,t,n,o,u){const f=1-e,g=f*f,x=e*e;return g*f*t+3*g*e*n+3*f*x*o+x*e*u}var O=(O=lu(1,1))?O.getContext("2d"):null;const L=new as;function J(e){return function(t,n){if(!O)return!0;e(O,t),L.clear().union(t.bounds).intersect(n).round();const{x1:o,y1:u,x2:f,y2:g}=L;for(let x=u;x<=g;++x)for(let k=o;k<=f;++k)if(O.isPointInPath(k,x))return!0;return!1}}function ie(e,t){return t.contains(e.x||0,e.y||0)}function ge(e,t){const n=e.x||0,o=e.y||0,u=e.width||0,f=e.height||0;return t.intersects(L.set(n,o,n+u,o+f))}function Ae(e,t){const n=e.x||0,o=e.y||0;return Ie(t,n,o,e.x2!=null?e.x2:n,e.y2!=null?e.y2:o)}function Ie(e,t,n,o,u){const{x1:f,y1:g,x2:x,y2:k}=e,F=o-t,V=u-n;let X,te,ue,he,be=0,Pe=1;for(he=0;he<4;++he){if(he===0&&(X=-F,te=-(f-t)),he===1&&(X=F,te=x-t),he===2&&(X=-V,te=-(g-n)),he===3&&(X=V,te=k-n),Math.abs(X)<1e-10&&te<0)return!1;if(ue=te/X,X<0){if(ue>Pe)return!1;ue>be&&(be=ue)}else if(X>0){if(ue<be)return!1;ue<Pe&&(Pe=ue)}}return!0}function De(e,t){e.globalCompositeOperation=t.blend||"source-over"}function et(e,t){return e??t}function ot(e,t){const n=t.length;for(let o=0;o<n;++o)e.addColorStop(t[o].offset,t[o].color);return e}function zt(e,t,n){return bg(n)?function(o,u,f){const g=f.width(),x=f.height();let k;if(u.gradient==="radial")k=o.createRadialGradient(f.x1+et(u.x1,.5)*g,f.y1+et(u.y1,.5)*x,Math.max(g,x)*et(u.r1,0),f.x1+et(u.x2,.5)*g,f.y1+et(u.y2,.5)*x,Math.max(g,x)*et(u.r2,.5));else{const F=et(u.x1,0),V=et(u.y1,0),X=et(u.x2,1),te=et(u.y2,0);if(F!==X&&V!==te&&g!==x){const ue=lu(Math.ceil(g),Math.ceil(x)),he=ue.getContext("2d");return he.scale(g,x),he.fillStyle=ot(he.createLinearGradient(F,V,X,te),u.stops),he.fillRect(0,0,g,x),o.createPattern(ue,"no-repeat")}k=o.createLinearGradient(f.x1+F*g,f.y1+V*x,f.x1+X*g,f.y1+te*x)}return ot(k,u.stops)}(e,n,t.bounds):n}function Ht(e,t,n){return(n*=t.fillOpacity==null?1:t.fillOpacity)>0&&(e.globalAlpha=n,e.fillStyle=zt(e,t,t.fill),!0)}var xn=[];function En(e,t,n){var o=(o=t.strokeWidth)!=null?o:1;return!(o<=0)&&(n*=t.strokeOpacity==null?1:t.strokeOpacity)>0&&(e.globalAlpha=n,e.strokeStyle=zt(e,t,t.stroke),e.lineWidth=o,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||xn),e.lineDashOffset=t.strokeDashOffset||0),!0)}function Fn(e,t){return e.zindex-t.zindex||e.index-t.index}function Rn(e){if(!e.zdirty)return e.zitems;var t,n,o,u=e.items,f=[];for(n=0,o=u.length;n<o;++n)(t=u[n]).index=n,t.zindex&&f.push(t);return e.zdirty=!1,e.zitems=f.sort(Fn)}function Wn(e,t){var n,o,u=e.items;if(!u||!u.length)return;const f=Rn(e);if(f&&f.length){for(n=0,o=u.length;n<o;++n)u[n].zindex||t(u[n]);u=f}for(n=0,o=u.length;n<o;++n)t(u[n])}function Jn(e,t){var n,o,u=e.items;if(!u||!u.length)return null;const f=Rn(e);for(f&&f.length&&(u=f),o=u.length;--o>=0;)if(n=t(u[o]))return n;if(u===f){for(o=(u=e.items).length;--o>=0;)if(!u[o].zindex&&(n=t(u[o])))return n}return null}function Tn(e){return function(t,n,o){Wn(n,u=>{o&&!o.intersects(u.bounds)||_r(e,t,u,u)})}}function _r(e,t,n,o){var u=n.opacity==null?1:n.opacity;u!==0&&(e(t,o)||(De(t,n),n.fill&&Ht(t,n,u)&&t.fill(),n.stroke&&En(t,n,u)&&t.stroke()))}function Nr(e){return e=e||Ce.Ia,function(t,n,o,u,f,g){return o*=t.pixelRatio,u*=t.pixelRatio,Jn(n,x=>{const k=x.bounds;if((!k||k.contains(f,g))&&k)return e(t,x,o,u,f,g)?x:void 0})}}function Ir(e,t){return function(n,o,u,f){var g,x,k=Array.isArray(o)?o[0]:o,F=t??k.fill,V=k.stroke&&n.isPointInStroke;return V&&(g=k.strokeWidth,x=k.strokeCap,n.lineWidth=g??1,n.lineCap=x??"butt"),!e(n,o)&&(F&&n.isPointInPath(u,f)||V&&n.isPointInStroke(u,f))}}function Qr(e){return Nr(Ir(e))}function zr(e,t){return"translate("+e+","+t+")"}function ki(e){return"rotate("+e+")"}function Pi(e){return zr(e.x||0,e.y||0)}function Fi(e,t,n){function o(u,f){var g=f.x||0,x=f.y||0,k=f.angle||0;u.translate(g,x),k&&u.rotate(k*=Uf),u.beginPath(),t(u,f),k&&u.rotate(-k),u.translate(-g,-x)}return{type:e,tag:"path",nested:!1,attr:function(u,f){u("transform",function(g){return zr(g.x||0,g.y||0)+(g.angle?" "+ki(g.angle):"")}(f)),u("d",t(null,f))},bound:function(u,f){return t(Mg(u,f.angle),f),Vf(u,f).translate(f.x||0,f.y||0)},draw:Tn(o),pick:Qr(o),isect:n||J(o)}}var Mo=Fi("arc",function(e,t){return Cg.context(e)(t)});function Jo(e,t,n){function o(f,g){f.beginPath(),t(f,g)}const u=Ir(o);return{type:e,tag:"path",nested:!0,attr:function(f,g){var x=g.mark.items;x.length&&f("d",t(null,x))},bound:function(f,g){var x=g.items;return x.length===0?f:(t(Mg(f),x),Vf(f,x[0]))},draw:function(f){return function(g,x,k){!x.items.length||k&&!k.intersects(x.bounds)||_r(f,g,x.items[0],x.items)}}(o),pick:function(f,g,x,k,F,V){var X=g.items,te=g.bounds;return!X||!X.length||te&&!te.contains(F,V)?null:(x*=f.pixelRatio,k*=f.pixelRatio,u(f,X,x,k)?X[0]:null)},isect:ie,tip:n}}var jo=Jo("area",function(e,t){const n=t[0],o=n.interpolate||"linear";return(n.orient==="horizontal"?km:S0).curve(zf(o,n.orient,n.tension)).context(e)(t)},function(e,t){for(var n,o,u=e[0].orient==="horizontal"?t[1]:t[0],f=e[0].orient==="horizontal"?"y":"x",g=e.length,x=1/0;--g>=0;)e[g].defined!==!1&&(o=Math.abs(e[g][f]-u))<x&&(x=o,n=e[g]);return n});function Bo(e,t){e.beginPath(),ml(t)?Yd(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function Ho(e){const t=et(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function la(e,t){const n=Ho(t);e("d",Yd(null,t,n,n))}function va(e,t,n,o){const u=Ho(t);e.beginPath(),Yd(e,t,(n||0)+u,(o||0)+u)}const Fa=Ir(va),mu=Ir(va,!1),Li=Ir(va,!0);var ts={type:"group",tag:"g",nested:!1,attr:function(e,t){e("transform",Pi(t))},bound:function(e,t){if(!t.clip&&t.items){const n=t.items,o=n.length;for(let u=0;u<o;++u)e.union(n[u].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),Vf(e,t),e.translate(t.x||0,t.y||0)},draw:function(e,t,n){Wn(t,o=>{const u=o.x||0,f=o.y||0,g=o.strokeForeground,x=o.opacity==null?1:o.opacity;(o.stroke||o.fill)&&x&&(va(e,o,u,f),De(e,o),o.fill&&Ht(e,o,x)&&e.fill(),o.stroke&&!g&&En(e,o,x)&&e.stroke()),e.save(),e.translate(u,f),o.clip&&Bo(e,o),n&&n.translate(-u,-f),Wn(o,k=>{this.draw(e,k,n)}),n&&n.translate(u,f),e.restore(),g&&o.stroke&&x&&(va(e,o,u,f),De(e,o),En(e,o,x)&&e.stroke())})},pick:function(e,t,n,o,u,f){if(t.bounds&&!t.bounds.contains(u,f)||!t.items)return null;const g=n*e.pixelRatio,x=o*e.pixelRatio;return Jn(t,k=>{let F,V,X;const te=k.bounds;if(te&&!te.contains(u,f))return;V=k.x||0,X=k.y||0;const ue=V+(k.width||0),he=X+(k.height||0),be=k.clip;if(be&&(u<V||u>ue||f<X||f>he))return;if(e.save(),e.translate(V,X),V=u-V,X=f-X,be&&ml(k)&&!Li(e,k,g,x))return e.restore(),null;const Pe=k.strokeForeground,Ue=t.interactive!==!1;return Ue&&Pe&&k.stroke&&mu(e,k,g,x)?(e.restore(),k):(!(F=Jn(k,We=>function(at,st,dt){return(at.interactive!==!1||at.marktype==="group")&&at.bounds&&at.bounds.contains(st,dt)}(We,V,X)?this.pick(We,n,o,V,X):null))&&Ue&&(k.fill||!Pe&&k.stroke)&&Fa(e,k,g,x)&&(F=k),e.restore(),F||null)})},isect:ge,content:function(e,t,n){e("clip-path",t.clip?gl(n,t,t):null)},background:function(e,t){e("class","background"),e("aria-hidden",!0),la(e,t)},foreground:function(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?la(e,t):e("d","")}},ss={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function gu(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(o=>{e.image=o,e.image.url=e.url})),n}function Ws(e,t){return e.width!=null?e.width:t&&t.width?e.aspect!==!1&&e.height?e.height*t.width/t.height:t.width:0}function Pu(e,t){return e.height!=null?e.height:t&&t.height?e.aspect!==!1&&e.width?e.width*t.height/t.width:t.height:0}function Lu(e,t){return e==="center"?t/2:e==="right"?t:0}function Bu(e,t){return e==="middle"?t/2:e==="bottom"?t:0}var up={type:"image",tag:"image",nested:!1,attr:function(e,t,n){const o=gu(t,n),u=Ws(t,o),f=Pu(t,o),g=(t.x||0)-Lu(t.align,u),x=(t.y||0)-Bu(t.baseline,f);e("href",!o.src&&o.toDataURL?o.toDataURL():o.src||"",ss["xmlns:xlink"],"xlink:href"),e("transform",zr(g,x)),e("width",u),e("height",f),e("preserveAspectRatio",t.aspect===!1?"none":"xMidYMid")},bound:function(e,t){const n=t.image,o=Ws(t,n),u=Pu(t,n),f=(t.x||0)-Lu(t.align,o),g=(t.y||0)-Bu(t.baseline,u);return e.set(f,g,f+o,g+u)},draw:function(e,t,n){Wn(t,o=>{if(n&&!n.intersects(o.bounds))return;const u=gu(o,this);let f=Ws(o,u),g=Pu(o,u);if(f===0||g===0)return;let x,k,F,V,X=(o.x||0)-Lu(o.align,f),te=(o.y||0)-Bu(o.baseline,g);o.aspect!==!1&&(k=u.width/u.height,F=o.width/o.height,k==k&&F==F&&k!==F&&(F<k?(te+=(g-(V=f/k))/2,g=V):(X+=(f-(V=g*k))/2,f=V))),(u.complete||u.toDataURL)&&(De(e,o),e.globalAlpha=(x=o.opacity)!=null?x:1,e.imageSmoothingEnabled=o.smooth!==!1,e.drawImage(u,X,te,f,g))})},pick:Nr(),isect:Ce.Ia,get:gu,xOffset:Lu,yOffset:Bu},Qd=Jo("line",function(e,t){const n=t[0],o=n.interpolate||"linear";return Am.curve(zf(o,n.orient,n.tension)).context(e)(t)},function(e,t){for(var n,o,u=Math.pow(e[0].strokeWidth||1,2),f=e.length;--f>=0;)if(e[f].defined!==!1&&(n=e[f].x-t[0])*n+(o=e[f].y-t[1])*o<u)return e[f];return null});function Ql(e,t){var n=t.path;if(n==null)return!0;var o=t.x||0,u=t.y||0,f=t.scaleX||1,g=t.scaleY||1,x=(t.angle||0)*Uf,k=t.pathCache;k&&k.path===n||((t.pathCache=k=rp(n)).path=n),x&&e.rotate&&e.translate?(e.translate(o,u),e.rotate(x),op(e,k,0,0,f,g),e.rotate(-x),e.translate(-o,-u)):op(e,k,o,u,f,g)}var Gf={type:"path",tag:"path",nested:!1,attr:function(e,t){var n=t.scaleX||1,o=t.scaleY||1;n===1&&o===1||e("vector-effect","non-scaling-stroke"),e("transform",function(u){return zr(u.x||0,u.y||0)+(u.angle?" "+ki(u.angle):"")+(u.scaleX||u.scaleY?" "+function(f,g){return"scale("+f+","+g+")"}(u.scaleX||1,u.scaleY||1):"")}(t)),e("d",t.path)},bound:function(e,t){return Ql(Mg(e,t.angle),t)?e.set(0,0,0,0):Vf(e,t,!0)},draw:Tn(Ql),pick:Qr(Ql),isect:J(Ql)};function Zl(e,t){e.beginPath(),Yd(e,t)}var wc={type:"rect",tag:"path",nested:!1,attr:function(e,t){e("d",Yd(null,t))},bound:function(e,t){var n,o;return Vf(e.set(n=t.x||0,o=t.y||0,n+t.width||0,o+t.height||0),t)},draw:Tn(Zl),pick:Qr(Zl),isect:ge};function Ka(e,t,n){var o,u,f,g;return!(!t.stroke||!En(e,t,n))&&(o=t.x||0,u=t.y||0,f=t.x2!=null?t.x2:o,g=t.y2!=null?t.y2:u,e.beginPath(),e.moveTo(o,u),e.lineTo(f,g),!0)}var qf={type:"rule",tag:"line",nested:!1,attr:function(e,t){e("transform",Pi(t)),e("x2",t.x2!=null?t.x2-(t.x||0):0),e("y2",t.y2!=null?t.y2-(t.y||0):0)},bound:function(e,t){var n,o;return Vf(e.set(n=t.x||0,o=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:o),t)},draw:function(e,t,n){Wn(t,o=>{if(!n||n.intersects(o.bounds)){var u=o.opacity==null?1:o.opacity;u&&Ka(e,o,u)&&(De(e,o),e.stroke())}})},pick:Nr(function(e,t,n,o){return!!e.isPointInStroke&&Ka(e,t,1)&&e.isPointInStroke(n,o)}),isect:Ae},Zd=Fi("shape",function(e,t){return(t.mark.shape||t.shape).context(e)(t)}),cp=Fi("symbol",function(e,t){return Vv.context(e)(t)},ie);const $f=Object(Ce.N)();var As={height:_c,measureWidth:vl,estimateWidth:lp,width:lp,canvas:eh};function eh(e){As.width=e&&O?vl:lp}function lp(e,t){return fp(ef(e,t),_c(e))}function fp(e,t){return~~(.8*e.length*t)}function vl(e,t){return _c(e)<=0||!(t=ef(e,t))?0:Nm(t,dp(e))}function Nm(e,t){const n=`(${t}) ${e}`;let o=$f.get(n);return o===void 0&&(O.font=t,o=O.measureText(e).width,$f.set(n,o)),o}function _c(e){return e.fontSize!=null?+e.fontSize||0:11}function Vs(e){return e.lineHeight!=null?e.lineHeight:_c(e)+2}function oc(e){return function(t){return Object(Ce.B)(t)?t.length>1?t:t[0]:t}(e.lineBreak&&e.text&&!Object(Ce.B)(e.text)?e.text.split(e.lineBreak):e.text)}function Os(e){const t=oc(e);return(Object(Ce.B)(t)?t.length-1:0)*Vs(e)}function ef(e,t){const n=t==null?"":(t+"").trim();return e.limit>0&&n.length?function(o,u){var f=+o.limit,g=function(te){if(As.width===vl){const ue=dp(te);return he=>Nm(he,ue)}{const ue=_c(te);return he=>fp(he,ue)}}(o);if(g(u)<f)return u;var x,k=o.ellipsis||"",F=o.dir==="rtl",V=0,X=u.length;if(f-=g(k),F){for(;V<X;)x=V+X>>>1,g(u.slice(x))>f?V=x+1:X=x;return k+u.slice(V)}for(;V<X;)x=1+(V+X>>>1),g(u.slice(0,x))<f?V=x:X=x-1;return u.slice(0,V)+k}(e,n):n}function th(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function dp(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+_c(e)+"px "+th(e,t)}function nh(e){var t=e.baseline,n=_c(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*Vs(e):t==="line-bottom"?.29*n-.5*Vs(e):0)}eh(!0);const Im={left:"start",center:"middle",right:"end"},tf=new as;function ku(e){var t,n=e.x||0,o=e.y||0,u=e.radius||0;return u&&(t=(e.theta||0)-Xd,n+=u*Math.cos(t),o+=u*Math.sin(t)),tf.x1=n,tf.y1=o,tf}function H1(e,t,n){var o,u=As.height(t),f=t.align,g=ku(t),x=g.x1,k=g.y1,F=t.dx||0,V=(t.dy||0)+nh(t)-Math.round(.8*u),X=oc(t);if(Object(Ce.B)(X)?(u+=Vs(t)*(X.length-1),o=X.reduce((te,ue)=>Math.max(te,As.width(t,ue)),0)):o=As.width(t,X),f==="center"?F-=o/2:f==="right"&&(F-=o),e.set(F+=x,V+=k,F+o,V+u),t.angle&&!n)e.rotate(t.angle*Uf,x,k);else if(n===2)return e.rotatedPoints(t.angle*Uf,x,k);return e}var nf={arc:Mo,area:jo,group:ts,image:up,line:Qd,path:Gf,rect:wc,rule:qf,shape:Zd,symbol:cp,text:{type:"text",tag:"text",nested:!1,attr:function(e,t){var n,o=t.dx||0,u=(t.dy||0)+nh(t),f=ku(t),g=f.x1,x=f.y1,k=t.angle||0;e("text-anchor",Im[t.align]||"start"),k?(n=zr(g,x)+" "+ki(k),(o||u)&&(n+=" "+zr(o,u))):n=zr(g+o,x+u),e("transform",n)},bound:H1,draw:function(e,t,n){Wn(t,o=>{var u,f,g,x,k,F,V,X=o.opacity==null?1:o.opacity;if(!(n&&!n.intersects(o.bounds)||X===0||o.fontSize<=0||o.text==null||o.text.length===0)){if(e.font=dp(o),e.textAlign=o.align||"left",f=(u=ku(o)).x1,g=u.y1,o.angle&&(e.save(),e.translate(f,g),e.rotate(o.angle*Uf),f=g=0),f+=o.dx||0,g+=(o.dy||0)+nh(o),F=oc(o),De(e,o),Object(Ce.B)(F))for(k=Vs(o),x=0;x<F.length;++x)V=ef(o,F[x]),o.fill&&Ht(e,o,X)&&e.fillText(V,f,g),o.stroke&&En(e,o,X)&&e.strokeText(V,f,g),g+=k;else V=ef(o,F),o.fill&&Ht(e,o,X)&&e.fillText(V,f,g),o.stroke&&En(e,o,X)&&e.strokeText(V,f,g);o.angle&&e.restore()}})},pick:Nr(function(e,t,n,o,u,f){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var g=ku(t),x=g.x1,k=g.y1,F=H1(tf,t,1),V=-t.angle*Uf,X=Math.cos(V),te=Math.sin(V),ue=X*u-te*f+(x-X*x+te*k),he=te*u+X*f+(k-te*x-X*k);return F.contains(ue,he)}),isect:function(e,t){const n=H1(tf,e,2);return Ie(t,n[0],n[1],n[2],n[3])||Ie(t,n[0],n[1],n[4],n[5])||Ie(t,n[4],n[5],n[6],n[7])||Ie(t,n[2],n[3],n[6],n[7])}},trail:Jo("trail",function(e,t){return zy.context(e)(t)},function(e,t){for(var n,o,u=e.length;--u>=0;)if(e[u].defined!==!1&&(n=e[u].x-t[0])*n+(o=e[u].y-t[1])*o<(n=e[u].size||1)*n)return e[u];return null})};function hp(e,t,n){var o=nf[e.mark.marktype],u=t||o.bound;return o.nested&&(e=e.mark),u(e.bounds||(e.bounds=new as),e,n)}var G1={mark:null};function q1(e,t,n){var o,u,f,g,x=nf[e.marktype],k=x.bound,F=e.items,V=F&&F.length;if(x.nested)return V?f=F[0]:(G1.mark=e,f=G1),g=hp(f,k,n),t=t&&t.union(g)||g;if(t=t||e.bounds&&e.bounds.clear()||new as,V)for(o=0,u=F.length;o<u;++o)t.union(hp(F[o],k,n));return e.bounds=t}const $1=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function Xv(e,t){return JSON.stringify(e,$1,t)}function Vy(e){return function t(n){var o,u,f,g=n.marktype,x=n.items;if(x)for(u=0,f=x.length;u<f;++u)o=g?"mark":"group",x[u][o]=n,x[u].zindex&&(x[u][o].zdirty=!0),(g||o)==="group"&&t(x[u]);return g&&q1(n),n}(typeof e=="string"?JSON.parse(e):e)}function Kv(e){arguments.length?this.root=Vy(e):(this.root=Hy({marktype:"group",name:"root",role:"frame"}),this.root.items=[new Om(this.root)])}function Hy(e,t){const n={bounds:new as,clip:!!e.clip,group:t,interactive:e.interactive!==!1,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return e.aria!=null&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function Gc(e,t,n){return!e&&typeof document<"u"&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function X1(e,t){t=t.toLowerCase();for(var n=e.childNodes,o=0,u=n.length;o<u;++o)if(n[o].tagName.toLowerCase()===t)return n[o]}function Ec(e,t,n,o){var u,f=e.childNodes[t];return f&&f.tagName.toLowerCase()===n.toLowerCase()||(u=f||null,f=Gc(e.ownerDocument,n,o),e.insertBefore(f,u)),f}function Xf(e,t){for(var n=e.childNodes,o=n.length;o>t;)e.removeChild(n[--o]);return e}function _(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function v(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function d(e,t){this._active=null,this._handlers={},this._loader=e||Object(sr.e)(),this._tooltip=t||y}function y(e,t,n,o){e.element().setAttribute("title",o||"")}function C(e){this._el=null,this._bgcolor=null,this._loader=new kg(e)}Kv.prototype={toJSON(e){return Xv(this.root,e||0)},mark(e,t,n){const o=Hy(e,t=t||this.root.items[0]);return t.items[n]=o,o.zindex&&(o.group.zdirty=!0),o}},d.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let o=e?e.length:0;--o>=0;)if(e[o].type===t&&(!n||e[o].handler===n))return o;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const o in t)n.push(...t[o]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then(o=>{const u=new MouseEvent(e.type,e),f=Gc(null,"a");for(const g in o)f.setAttribute(g,o[g]);f.dispatchEvent(u)}).catch(()=>{})},handleTooltip(e,t,n){if(t&&t.tooltip!=null){t=function(u,f,g,x){var k,F,V=u&&u.mark;if(V&&(k=nf[V.marktype]).tip){for((F=v(f,g))[0]-=x[0],F[1]-=x[1];u=u.mark.group;)F[0]-=u.x||0,F[1]-=u.y||0;u=k.tip(V.items,F)}return u}(t,e,this.canvas(),this._origin);const o=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,o)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),o=this._origin,u=e.bounds,f=u.width(),g=u.height();let x=u.x1+o[0]+n.left,k=u.y1+o[1]+n.top;for(;e.mark&&(e=e.mark.group);)x+=e.x||0,k+=e.y||0;return{x,y:k,width:f,height:g,left:x,top:k,right:x+f,bottom:k+g}}},C.prototype={initialize(e,t,n,o,u){return this._el=e,this.resize(t,n,o,u)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return arguments.length===0?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,o){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=o||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then(()=>t):Promise.resolve(t)},_load(e,t){var n=this,o=n._loader[e](t);if(!n._ready){const u=n._call;n._ready=n._loader.ready().then(f=>{f&&u(),n._ready=null})}return o},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const z="dragleave",Z="mousedown",re="mousemove",fe="mouseout",xe="click",Oe=["keydown","keypress","keyup","dragenter",z,"dragover",Z,"mouseup",re,fe,"mouseover",xe,"dblclick","wheel","mousewheel","touchstart","touchmove","touchend"],Re=re,Le=fe,Be=xe;function Xe(e,t){d.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}const nt=e=>e==="touchstart"||e==="touchmove"||e==="touchend"?["touchstart","touchmove","touchend"]:[e];function tt(e,t){nt(t).forEach(n=>function(o,u){const f=o.canvas();f&&!o._events[u]&&(o._events[u]=1,f.addEventListener(u,o[u]?g=>o[u](g):g=>o.fire(u,g)))}(e,n))}function ut(e,t,n){return function(o){const u=this._active,f=this.pickEvent(o);f===u?this.fire(e,o):(u&&u.exit||this.fire(n,o),this._active=f,this.fire(t,o),this.fire(e,o))}}function Nt(e){return function(t){this.fire(e,t),this._active=null}}Object(Ce.z)(Xe,d,{initialize(e,t,n){return this._canvas=e&&X1(e,"canvas"),[xe,Z,re,fe,z].forEach(o=>tt(this,o)),d.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:Oe,DOMMouseScroll(e){this.fire("mousewheel",e)},mousemove:ut(re,"mouseover",fe),dragover:ut("dragover","dragenter",z),mouseout:Nt(fe),dragleave:Nt(z),mousedown(e){this._down=this._active,this.fire(Z,e)},click(e){this._down===this._active&&(this.fire(xe,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire("touchstart",e,!0)},touchmove(e){this.fire("touchmove",e,!0)},touchend(e){this.fire("touchend",e,!0),this._touch=null},fire(e,t,n){const o=n?this._touch:this._active,u=this._handlers[e];if(t.vegaType=e,e===Be&&o&&o.href?this.handleHref(t,o,o.href):e!==Re&&e!==Le||this.handleTooltip(t,o,e!==Le),u)for(let f=0,g=u.length;f<g;++f)u[f].handler.call(this._obj,t,o)},on(e,t){const n=this.eventName(e),o=this._handlers;return this._handlerIndex(o[n],e,t)<0&&(tt(this,e),(o[n]||(o[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),o=this._handlers[n],u=this._handlerIndex(o,e,t);return u>=0&&o.splice(u,1),this},pickEvent(e){const t=v(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,o,u){const f=this.context();return nf[e.marktype].pick.call(this,f,e,t,n,o,u)}});var Pt=typeof window<"u"&&window.devicePixelRatio||1;function jt(e){C.call(this,e),this._options={},this._redraw=!1,this._dirty=new as,this._tempb=new as}const Yt=C.prototype;function gn(e,t){d.call(this,e,t);const n=this;n._hrefHandler=wn(n,(o,u)=>{u&&u.href&&n.handleHref(o,u,u.href)}),n._tooltipHandler=wn(n,(o,u)=>{n.handleTooltip(o,u,o.type!==Le)})}Object(Ce.z)(jt,C,{initialize(e,t,n,o,u,f){return this._options=f||{},this._canvas=this._options.externalContext?null:lu(1,1,this._options.type),e&&this._canvas&&(Xf(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),Yt.initialize.call(this,e,t,n,o,u)},resize(e,t,n,o){if(Yt.resize.call(this,e,t,n,o),this._canvas)(function(u,f,g,x,k,F){const V=typeof HTMLElement<"u"&&u instanceof HTMLElement&&u.parentNode!=null,X=u.getContext("2d"),te=V?Pt:k;u.width=f*te,u.height=g*te;for(const ue in F)X[ue]=F[ue];V&&te!==1&&(u.style.width=f+"px",u.style.height=g+"px"),X.pixelRatio=te,X.setTransform(te,0,0,te,te*x[0],te*x[1])})(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const u=this._options.externalContext;u||Object(Ce.o)("CanvasRenderer is missing a valid canvas or context"),u.scale(this._scale,this._scale),u.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,o=this._width,u=this._height,f=this._dirty,g=((k,F,V)=>new as().set(0,0,F,V).translate(-k[0],-k[1]))(n,o,u);t.save();const x=this._redraw||f.empty()?(this._redraw=!1,g.expand(1)):function(k,F,V){return F.expand(1).round(),k.pixelRatio%1&&F.scale(k.pixelRatio).round().scale(1/k.pixelRatio),F.translate(-V[0]%1,-V[1]%1),k.beginPath(),k.rect(F.x1,F.y1,F.width(),F.height()),k.clip(),F}(t,g.intersect(f),n);return this.clear(-n[0],-n[1],o,u),this.draw(t,e,x),t.restore(),f.clear(),this},draw(e,t,n){const o=nf[t.marktype];t.clip&&function(u,f){var g=f.clip;u.save(),Object(Ce.E)(g)?(u.beginPath(),g(u),u.clip()):Bo(u,f.group)}(e,t),o.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,o){const u=this._options,f=this.context();u.type==="pdf"||u.externalContext||f.clearRect(e,t,n,o),this._bgcolor!=null&&(f.fillStyle=this._bgcolor,f.fillRect(e,t,n,o))}});const wn=(e,t)=>n=>{let o=n.target.__data__;o=Array.isArray(o)?o[0]:o,n.vegaType=n.type,t.call(e._obj,n,o)};Object(Ce.z)(gn,d,{initialize(e,t,n){let o=this._svg;return o&&(o.removeEventListener(Be,this._hrefHandler),o.removeEventListener(Re,this._tooltipHandler),o.removeEventListener(Le,this._tooltipHandler)),this._svg=o=e&&X1(e,"svg"),o&&(o.addEventListener(Be,this._hrefHandler),o.addEventListener(Re,this._tooltipHandler),o.addEventListener(Le,this._tooltipHandler)),d.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),o=this._handlers;if(this._handlerIndex(o[n],e,t)<0){const u={type:e,handler:t,listener:wn(this,t)};(o[n]||(o[n]=[])).push(u),this._svg&&this._svg.addEventListener(n,u.listener)}return this},off(e,t){const n=this.eventName(e),o=this._handlers[n],u=this._handlerIndex(o,e,t);return u>=0&&(this._svg&&this._svg.removeEventListener(n,o[u].listener),o.splice(u,1)),this}});const vn="aria-hidden",Cn="aria-label",Dn="role",b="aria-roledescription",p="graphics-object",l="graphics-symbol",m=(e,t,n)=>({[Dn]:e,[b]:t,[Cn]:n||void 0}),w=Object(Ce.Fa)(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),P={axis:{desc:"axis",caption:function(e){const t=e.datum,n=e.orient,o=t.title?Ee(e):null,u=e.context,f=u.scales[t.scale].value,g=u.dataflow.locale(),x=f.type;return`${n==="left"||n==="right"?"Y":"X"}-axis`+(o?` titled '${o}'`:"")+` for a ${Gd(x)?"discrete":x} scale with ${Rv(g,f,e)}`}},legend:{desc:"legend",caption:function(e){const t=e.datum,n=t.title?Ee(e):null,o=`${t.type||""} legend`.trim(),u=t.scales,f=Object.keys(u),g=e.context,x=g.scales[u[f[0]]].value,k=g.dataflow.locale();return function(F){return F.length?F[0].toUpperCase()+F.slice(1):F}(o)+(n?` titled '${n}'`:"")+` for ${function(F){return(F=F.map(V=>V+(V==="fill"||V==="stroke"?" color":""))).length<2?F[0]:F.slice(0,-1).join(", ")+" and "+Object(Ce.W)(F)}(f)} with ${Rv(k,x,e)}`}},"title-text":{desc:"title",caption:e=>`Title text '${de(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${de(e)}'`}},K={ariaRole:Dn,ariaRoleDescription:b,description:Cn};function ee(e,t){const n=t.aria===!1;if(e(vn,n||void 0),n||t.description==null)for(const o in K)e(K[o],void 0);else{const o=t.mark.marktype;e(Cn,t.description),e(Dn,t.ariaRole||(o==="group"?p:l)),e(b,t.ariaRoleDescription||`${o} mark`)}}function le(e){return e.aria===!1?{[vn]:!0}:w[e.role]?null:P[e.role]?function(t,n){try{const o=t.items[0],u=n.caption||(()=>"");return m(n.role||l,n.desc,o.description||u(o))}catch{return null}}(e,P[e.role]):function(t){const n=t.marktype,o=n==="group"||n==="text"||t.items.some(u=>u.description!=null&&u.aria!==!1);return m(o?p:l,`${n} mark container`,t.description)}(e)}function de(e){return Object(Ce.i)(e.text).join(" ")}function Ee(e){try{return Object(Ce.i)(Object(Ce.W)(e.items).items[0].text).join(" ")}catch{return null}}const Te=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),Ne=e=>Te(e).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function Fe(){let e="",t="",n="";const o=[],u=()=>t=n="",f=(x,k)=>(k!=null&&(t+=` ${x}="${Ne(k)}"`),g),g={open(x,...k){(F=>{t&&(e+=`${t}>${n}`,u()),o.push(F)})(x),t="<"+x;for(const F of k)for(const V in F)f(V,F[V]);return g},close(){const x=o.pop();return e+=t?t+(n?`>${n}</${x}>`:"/>"):`</${x}>`,u(),g},attr:f,text:x=>(n+=Te(x),g),toString:()=>e};return g}const qe=e=>function t(n,o){if(n.open(o.tagName),o.hasAttributes()){const u=o.attributes,f=u.length;for(let g=0;g<f;++g)n.attr(u[g].name,u[g].value)}if(o.hasChildNodes()){const u=o.childNodes,f=u.length;for(let g=0;g<f;g++){const x=u[g];x.nodeType===3?n.text(x.nodeValue):t(n,x)}}return n.close()}(Fe(),e)+"",Je={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},Ke={fill:"none","stroke-miterlimit":10},it=ss.xmlns;function gt(e){C.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const Et=C.prototype;function At(e,t){for(;e&&e.dirty!==t;e=e.mark.group){if(e.dirty=t,!e.mark||e.mark.dirty===t)return;e.mark.dirty=t}}function Wt(e,t,n){let o,u,f;if(t.gradient==="radial"){let g=Ec(e,n++,"pattern",it);ur(g,{id:Kl+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),ur(g=Ec(g,0,"rect",it),{width:1,height:1,fill:`url(${xr()}#${t.id})`}),ur(e=Ec(e,n++,"radialGradient",it),{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else ur(e=Ec(e,n++,"linearGradient",it),{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(o=0,u=t.stops.length;o<u;++o)(f=Ec(e,o,"stop",it)).setAttribute("offset",t.stops[o].offset),f.setAttribute("stop-color",t.stops[o].color);return Xf(e,o),n}function cn(e,t,n){return(e=Ec(e,n,"clipPath",it)).setAttribute("id",t.id),t.path?Ec(e,0,"path",it).setAttribute("d",t.path):ur(Ec(e,0,"rect",it),{x:0,y:0,width:t.width,height:t.height}),Xf(e,1),n+1}function pn(e,t,n,o,u){let f,g=e._svg;if(!g&&(g=Gc(f=t.ownerDocument,o,it),e._svg=g,e.mark&&(g.__data__=e,g.__values__={fill:"default"},o==="g"))){const x=Gc(f,"path",it);g.appendChild(x),x.__data__=e;const k=Gc(f,"g",it);g.appendChild(k),k.__data__=e;const F=Gc(f,"path",it);g.appendChild(F),F.__data__=e,F.__values__={fill:"default"}}return(g.ownerSVGElement!==u||function(x,k){return x.parentNode&&x.parentNode.childNodes.length>1&&x.previousSibling!=k}(g,n))&&t.insertBefore(g,n?n.nextSibling:t.firstChild),g}Object(Ce.z)(gt,C,{initialize(e,t,n,o,u){return this._defs={},this._clearDefs(),e&&(this._svg=Ec(e,0,"svg",it),this._svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns",it),this._svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink",ss["xmlns:xlink"]),this._svg.setAttribute("version",ss.version),this._svg.setAttribute("class","marks"),Xf(e,1),this._root=Ec(this._svg,0,"g",it),ur(this._root,Ke),Xf(this._svg,1)),this.background(this._bgcolor),Et.initialize.call(this,e,t,n,o,u)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),Et.background.apply(this,arguments)},resize(e,t,n,o){return Et.resize.call(this,e,t,n,o),this._svg&&(ur(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),ur(n=Ec(e,0,"rect",it),{width:this._width,height:this._height,fill:t}));const o=qe(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),o},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),Xf(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,o,u,f,g,x,k;for(g=0,x=e.length;g<x;++g)(o=(n=e[g]).mark).marktype!==u&&(u=o.marktype,f=nf[u]),o.zdirty&&o.dirty!==t&&(this._dirtyAll=!1,At(n,t),o.items.forEach(F=>{F.dirty=t})),o.zdirty||(n.exit?(f.nested&&o.items.length?(k=o.items[0])._svg&&this._update(f,k._svg,k):n._svg&&(k=n._svg.parentNode)&&k.removeChild(n._svg),n._svg=null):(n=f.nested?o.items[0]:n)._update!==t&&(n._svg&&n._svg.ownerSVGElement?this._update(f,n._svg,n):(this._dirtyAll=!1,At(n,t)),n._update=t));return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const o=this._svg,u=nf[t.marktype],f=t.interactive===!1?"none":null,g=u.tag==="g";let x=null,k=0;const F=pn(t,e,n,"g",o);F.setAttribute("class",_(t));const V=le(t);for(const te in V)hr(F,te,V[te]);g||hr(F,"pointer-events",f),hr(F,"clip-path",t.clip?gl(this,t,t.group):null);const X=te=>{const ue=this.isDirty(te),he=pn(te,F,x,u.tag,o);ue&&(this._update(u,he,te),g&&function(be,Pe,Ue){Pe=Pe.lastChild.previousSibling;let We,at=0;Wn(Ue,st=>{We=be.mark(Pe,st,We),++at}),Xf(Pe,1+at)}(this,he,te)),x=he,++k};return u.nested?t.items.length&&X(t.items[0]):Wn(t,X),Xf(F,k),F},_update(e,t,n){ln=t,dn=t.__values__,ee(jn,n),e.attr(jn,n,this);const o=Nn[e.type];o&&o.call(this,e,t,n),ln&&this.style(ln,n)},style(e,t){if(t!=null)for(const n in Je){let o=n==="font"?th(t):t[n];if(o===dn[n])continue;const u=Je[n];o==null?e.removeAttribute(u):(bg(o)&&(o=x0(o,this._defs.gradient,xr())),e.setAttribute(u,o+"")),dn[n]=o}},defs(){const e=this._svg,t=this._defs;let n=t.el,o=0;for(const u in t.gradient)n||(t.el=n=Ec(e,1,"defs",it)),o=Wt(n,t.gradient[u],o);for(const u in t.clipping)n||(t.el=n=Ec(e,1,"defs",it)),o=cn(n,t.clipping[u],o);n&&(o===0?(e.removeChild(n),t.el=null):Xf(n,o))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});let ln=null,dn=null;const Nn={group(e,t,n){const o=ln=t.childNodes[2];dn=o.__values__,e.foreground(jn,n,this),dn=t.__values__,ln=t.childNodes[1],e.content(jn,n,this);const u=ln=t.childNodes[0];e.background(jn,n,this);const f=n.mark.interactive===!1?"none":null;if(f!==dn.events&&(hr(o,"pointer-events",f),hr(u,"pointer-events",f),dn.events=f),n.strokeForeground&&n.stroke){const g=n.fill;hr(o,"display",null),this.style(u,n),hr(u,"stroke",null),g&&(n.fill=null),dn=o.__values__,this.style(o,n),g&&(n.fill=g),ln=null}else hr(o,"display","none")},image(e,t,n){n.smooth===!1?(Ln(t,"image-rendering","optimizeSpeed"),Ln(t,"image-rendering","pixelated")):Ln(t,"image-rendering",null)},text(e,t,n){const o=oc(n);let u,f,g,x;Object(Ce.B)(o)?(u=(f=o.map(k=>ef(n,k))).join(`
`))!==dn.text&&(Xf(t,0),g=t.ownerDocument,x=Vs(n),f.forEach((k,F)=>{const V=Gc(g,"tspan",it);V.__data__=n,V.textContent=k,F&&(V.setAttribute("x",0),V.setAttribute("dy",x)),t.appendChild(V)}),dn.text=u):(f=ef(n,o))!==dn.text&&(t.textContent=f,dn.text=f),hr(t,"font-family",th(n)),hr(t,"font-size",_c(n)+"px"),hr(t,"font-style",n.fontStyle),hr(t,"font-variant",n.fontVariant),hr(t,"font-weight",n.fontWeight)}};function jn(e,t,n){t!==dn[e]&&(n?function(o,u,f,g){f!=null?o.setAttributeNS(g,u,f):o.removeAttributeNS(g,u)}(ln,e,t,n):hr(ln,e,t),dn[e]=t)}function Ln(e,t,n){n!==dn[t]&&(n==null?e.style.removeProperty(t):e.style.setProperty(t,n+""),dn[t]=n)}function ur(e,t){for(const n in t)hr(e,n,t[n])}function hr(e,t,n){n!=null?e.setAttribute(t,n):e.removeAttribute(t)}function xr(){let e;return typeof window>"u"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function Er(e){C.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}Object(Ce.z)(Er,C,{svg(){return this._text},_render(e){const t=Fe();t.open("svg",Object(Ce.p)({},ss,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&n!=="transparent"&&n!=="none"&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",Ke,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=nf[t.marktype],o=n.tag,u=[ee,n.attr];e.open("g",{class:_(t),"clip-path":t.clip?gl(this,t,t.group):null},le(t),{"pointer-events":o!=="g"&&t.interactive===!1?"none":null});const f=g=>{const x=this.href(g);if(x&&e.open("a",x),e.open(o,this.attr(t,g,u,o!=="g"?o:null)),o==="text"){const k=oc(g);if(Object(Ce.B)(k)){const F={x:0,dy:Vs(g)};for(let V=0;V<k.length;++V)e.open("tspan",V?F:null).text(ef(g,k[V])).close()}else e.text(ef(g,k))}else if(o==="g"){const k=g.strokeForeground,F=g.fill,V=g.stroke;k&&V&&(g.stroke=null),e.open("path",this.attr(t,g,n.background,"bgrect")).close(),e.open("g",this.attr(t,g,n.content)),Wn(g,X=>this.mark(e,X)),e.close(),k&&V?(F&&(g.fill=null),g.stroke=V,e.open("path",this.attr(t,g,n.foreground,"bgrect")).close(),F&&(g.fill=F)):e.open("path",this.attr(t,g,n.foreground,"bgfore")).close()}e.close(),x&&e.close()};return n.nested?t.items&&t.items.length&&f(t.items[0]):Wn(t,f),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then(o=>{o["xlink:href"]=o.href,o.href=null,(this._hrefs||(this._hrefs={}))[t]=o})}return null},attr(e,t,n,o){const u={},f=(g,x,k,F)=>{u[F||g]=x};return Array.isArray(n)?n.forEach(g=>g(f,t,this)):n(f,t,this),o&&function(g,x,k,F,V){if(x==null||(F==="bgrect"&&k.interactive===!1&&(g["pointer-events"]="none"),F==="bgfore"&&(k.interactive===!1&&(g["pointer-events"]="none"),g.display="none",x.fill!==null)))return g;F==="image"&&x.smooth===!1&&(g.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),F==="text"&&(g["font-family"]=th(x),g["font-size"]=_c(x)+"px",g["font-style"]=x.fontStyle,g["font-variant"]=x.fontVariant,g["font-weight"]=x.fontWeight);for(const X in Je){let te=x[X];const ue=Je[X];(te!=="transparent"||ue!=="fill"&&ue!=="stroke")&&te!=null&&(bg(te)&&(te=x0(te,V.gradient,"")),g[ue]=te)}}(u,t,e,o,this._defs),u},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(Object.keys(t).length+Object.keys(n).length!==0){e.open("defs");for(const o in t){const u=t[o],f=u.stops;u.gradient==="radial"?(e.open("pattern",{id:Kl+o,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+o+")"}).close(),e.close(),e.open("radialGradient",{id:o,fx:u.x1,fy:u.y1,fr:u.r1,cx:u.x2,cy:u.y2,r:u.r2})):e.open("linearGradient",{id:o,x1:u.x1,x2:u.x2,y1:u.y1,y2:u.y2});for(let g=0;g<f.length;++g)e.open("stop",{offset:f[g].offset,"stop-color":f[g].color}).close();e.close()}for(const o in n){const u=n[o];e.open("clipPath",{id:o}),u.path?e.open("path",{d:u.path}).close():e.open("rect",{x:0,y:0,width:u.width,height:u.height}).close(),e.close()}e.close()}}});const wr={Canvas:"canvas",PNG:"png",SVG:"svg",None:"none"},vr={};function Lr(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(vr[e]=t,this):vr[e]}function Pr(e,t,n){const o=[],u=new as().union(t),f=e.marktype;return f?ei(e,u,n,o):f==="group"?hi(e,u,n,o):Object(Ce.o)("Intersect scene must be mark node or group item.")}function ei(e,t,n,o){if(function(u,f,g){return u.bounds&&f.intersects(u.bounds)&&(u.marktype==="group"||u.interactive!==!1&&(!g||g(u)))}(e,t,n)){const u=e.items,f=e.marktype,g=u.length;let x=0;if(f==="group")for(;x<g;++x)hi(u[x],t,n,o);else for(const k=nf[f].isect;x<g;++x){const F=u[x];Oi(F,t,k)&&o.push(F)}}return o}function hi(e,t,n,o){n&&n(e.mark)&&Oi(e,t,nf.group.isect)&&o.push(e);const u=e.items,f=u&&u.length;if(f){const g=e.x||0,x=e.y||0;t.translate(-g,-x);for(let k=0;k<f;++k)ei(u[k],t,n,o);t.translate(g,x)}return o}function Oi(e,t,n){const o=e.bounds;return t.encloses(o)||t.intersects(o)&&n(e,t)}vr.canvas=vr.png={renderer:jt,headless:jt,handler:Xe},vr.svg={renderer:gt,headless:Er,handler:gn},vr.none={};const wo=new as;function _o(e){const t=e.clip;if(Object(Ce.E)(t))t(Mg(wo.clear()));else{if(!t)return;wo.set(0,0,e.group.width,e.group.height)}e.bounds.intersect(wo)}const Io=1e-9;function Do(e,t,n){return e===t||(n==="path"?qo(e,t):e instanceof Date&&t instanceof Date?+e==+t:Object(Ce.G)(e)&&Object(Ce.G)(t)?Math.abs(e-t)<=Io:e&&t&&(Object(Ce.H)(e)||Object(Ce.H)(t))?function(o,u){var f,g,x=Object.keys(o),k=Object.keys(u);if(x.length!==k.length)return!1;for(x.sort(),k.sort(),g=x.length-1;g>=0;g--)if(x[g]!=k[g])return!1;for(g=x.length-1;g>=0;g--)if(f=x[g],!Do(o[f],u[f],f))return!1;return typeof o==typeof u}(e,t):e==t)}function qo(e,t){return Do(rp(e),rp(t))}function fa(){Hv(),$d=0}const Ya="top",co="left",Fo="right",Qo="bottom",Au="top-left",Qs="top-right",Zs="bottom-left",pp="bottom-right",mp="start",Fm="middle",ju="end",T0="x",Yv="y",gp="group",Jv="axis",Rm="title",wC="frame",K1="scope",vp="legend",Cw="row-header",_C="row-footer",EC="row-title",kw="column-header",Aw="column-footer",Ow="column-title",Kq="padding",Yq="symbol",q5="fit",Jq="fit-x",Qq="fit-y",Zq="pad",MT="none",SC="all",DT="each",NT="flush",Y1="column",J1="row";function $5(e){Mt.call(this,null,e)}function CC(e,t,n){return t(e.bounds.clear(),e,n)}Object(Ce.z)($5,Mt,{transform(e,t){const n=t.dataflow,o=e.mark,u=o.marktype,f=nf[u],g=f.bound;let x,k=o.bounds;if(f.nested)o.items.length&&n.dirty(o.items[0]),k=CC(o,g),o.items.forEach(F=>{F.bounds.clear().union(k)});else if(u===gp||e.modified())switch(t.visit(t.MOD,F=>n.dirty(F)),k.clear(),o.items.forEach(F=>k.union(CC(F,g))),o.role){case Jv:case vp:case Rm:t.reflow()}else x=t.changed(t.REM),t.visit(t.ADD,F=>{k.union(CC(F,g))}),t.visit(t.MOD,F=>{x=x||k.alignsWith(F.bounds),n.dirty(F),k.union(CC(F,g))}),x&&(k.clear(),o.items.forEach(F=>k.union(F.bounds)));return _o(o),t.modifies("bounds")}});const X5=":vega_identifier:";function IT(e){Mt.call(this,0,e)}function K5(e){Mt.call(this,null,e)}function Y5(e){Mt.call(this,null,e)}IT.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},Object(Ce.z)(IT,Mt,{transform(e,t){const n=function(f){return f._signals[X5]||(f._signals[X5]=f.add(0))}(t.dataflow),o=e.as;let u=n.value;return t.visit(t.ADD,f=>f[o]=f[o]||++u),n.set(this.value=u),t}}),Object(Ce.z)(K5,Mt,{transform(e,t){let n=this.value;n||((n=t.dataflow.scenegraph().mark(e.markdef,function(u){const f=u.groups,g=u.parent;return f&&f.size===1?f.get(Object.keys(f.object)[0]):f&&g?f.lookup(g):null}(e),e.index)).group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const o=n.marktype===gp?Om:ap;return t.visit(t.ADD,u=>o.call(u,n)),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});const J5={parity:e=>e.filter((t,n)=>n%2?t.opacity=0:1),greedy:(e,t)=>{let n;return e.filter((o,u)=>u&&Q5(n.bounds,o.bounds,t)?o.opacity=0:(n=o,1))}},Q5=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),Z5=(e,t)=>{for(var n,o=1,u=e.length,f=e[0].bounds;o<u;f=n,++o)if(Q5(f,n=e[o].bounds,t))return!0},e$=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},e6=e=>(e.forEach(t=>t.opacity=1),e),t6=(e,t)=>e.reflow(t.modified()).modifies("opacity");function n6(e){Mt.call(this,null,e)}Object(Ce.z)(Y5,Mt,{transform(e,t){const n=J5[e.method]||J5.parity,o=e.separation||0;let u,f,g=t.materialize(t.SOURCE).source;if(!g||!g.length)return;if(!e.method)return e.modified("method")&&(e6(g),t=t6(t,e)),t;if(!(g=g.filter(e$)).length)return;if(e.sort&&(g=g.slice().sort(e.sort)),u=e6(g),t=t6(t,e),u.length>=3&&Z5(u,o)){do u=n(u,o);while(u.length>=3&&Z5(u,o));u.length<3&&!Object(Ce.W)(g).opacity&&(u.length>1&&(Object(Ce.W)(u).opacity=0),Object(Ce.W)(g).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(f=((k,F,V)=>{var X=k.range(),te=new as;return F===Ya||F===Qo?te.set(X[0],-1/0,X[1],1/0):te.set(-1/0,X[0],1/0,X[1]),te.expand(V||1),ue=>te.encloses(ue.bounds)})(e.boundScale,e.boundOrient,+e.boundTolerance),g.forEach(k=>{f(k)||(k.opacity=0)}));const x=u[0].mark.bounds.clear();return g.forEach(k=>{k.opacity&&x.union(k.bounds)}),t}}),Object(Ce.z)(n6,Mt,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,o=>n.dirty(o)),t.fields&&t.fields.zindex){const o=t.source&&t.source[0];o&&(o.mark.zdirty=!0)}}});const Kf=new as;function Tw(e,t,n){return e[t]===n?0:(e[t]=n,1)}function t$(e){var t=e.items[0].orient;return t===co||t===Fo}function n$(e,t,n,o){var u,f,g=t.items[0],x=g.datum,k=g.translate!=null?g.translate:.5,F=g.orient,V=function(ct){let kt=+ct.grid;return[ct.ticks?kt++:-1,ct.labels?kt++:-1,kt+ +ct.domain]}(x),X=g.range,te=g.offset,ue=g.position,he=g.minExtent,be=g.maxExtent,Pe=x.title&&g.items[V[2]].items[0],Ue=g.titlePadding,We=g.bounds,at=Pe&&Os(Pe),st=0,dt=0;switch(Kf.clear().union(We),We.clear(),(u=V[0])>-1&&We.union(g.items[u].bounds),(u=V[1])>-1&&We.union(g.items[u].bounds),F){case Ya:st=ue||0,dt=-te,f=Math.max(he,Math.min(be,-We.y1)),We.add(0,-f).add(X,0),Pe&&kC(e,Pe,f,Ue,at,0,-1,We);break;case co:st=-te,dt=ue||0,f=Math.max(he,Math.min(be,-We.x1)),We.add(-f,0).add(0,X),Pe&&kC(e,Pe,f,Ue,at,1,-1,We);break;case Fo:st=n+te,dt=ue||0,f=Math.max(he,Math.min(be,We.x2)),We.add(0,0).add(f,X),Pe&&kC(e,Pe,f,Ue,at,1,1,We);break;case Qo:st=ue||0,dt=o+te,f=Math.max(he,Math.min(be,We.y2)),We.add(0,0).add(X,f),Pe&&kC(e,Pe,f,Ue,0,0,1,We);break;default:st=g.x,dt=g.y}return Vf(We.translate(st,dt),g),Tw(g,"x",st+k)|Tw(g,"y",dt+k)&&(g.bounds=Kf,e.dirty(g),g.bounds=We,e.dirty(g)),g.mark.bounds.clear().union(We)}function kC(e,t,n,o,u,f,g,x){const k=t.bounds;if(t.auto){const F=g*(n+u+o);let V=0,X=0;e.dirty(t),f?V=(t.x||0)-(t.x=F):X=(t.y||0)-(t.y=F),t.mark.bounds.clear().union(k.translate(-V,-X)),e.dirty(t)}x.union(k)}const r6=(e,t)=>Math.floor(Math.min(e,t)),i6=(e,t)=>Math.ceil(Math.max(e,t));function r$(e){return new as().set(0,0,e.width||0,e.height||0)}function i$(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function vu(e,t,n){const o=Object(Ce.H)(e)?e[t]:e;return o??(n!==void 0?n:0)}function o6(e){return e<0?Math.ceil(-e):0}function a6(e,t,n){var o,u,f,g,x,k,F,V,X,te,ue,he=!n.nodirty,be=n.bounds===NT?r$:i$,Pe=Kf.set(0,0,0,0),Ue=vu(n.align,Y1),We=vu(n.align,J1),at=vu(n.padding,Y1),st=vu(n.padding,J1),dt=n.columns||t.length,ct=dt<=0?1:Math.ceil(t.length/dt),kt=t.length,St=Array(kt),yn=Array(dt),Mn=0,_n=Array(kt),$n=Array(ct),qn=0,er=Array(kt),rr=Array(kt),fr=Array(kt);for(u=0;u<dt;++u)yn[u]=0;for(u=0;u<ct;++u)$n[u]=0;for(u=0;u<kt;++u)k=t[u],x=fr[u]=be(k),k.x=k.x||0,er[u]=0,k.y=k.y||0,rr[u]=0,f=u%dt,g=~~(u/dt),Mn=Math.max(Mn,F=Math.ceil(x.x2)),qn=Math.max(qn,V=Math.ceil(x.y2)),yn[f]=Math.max(yn[f],F),$n[g]=Math.max($n[g],V),St[u]=at+o6(x.x1),_n[u]=st+o6(x.y1),he&&e.dirty(t[u]);for(u=0;u<kt;++u)u%dt==0&&(St[u]=0),u<dt&&(_n[u]=0);if(Ue===DT)for(f=1;f<dt;++f){for(ue=0,u=f;u<kt;u+=dt)ue<St[u]&&(ue=St[u]);for(u=f;u<kt;u+=dt)St[u]=ue+yn[f-1]}else if(Ue===SC){for(ue=0,u=0;u<kt;++u)u%dt&&ue<St[u]&&(ue=St[u]);for(u=0;u<kt;++u)u%dt&&(St[u]=ue+Mn)}else for(Ue=!1,f=1;f<dt;++f)for(u=f;u<kt;u+=dt)St[u]+=yn[f-1];if(We===DT)for(g=1;g<ct;++g){for(ue=0,o=(u=g*dt)+dt;u<o;++u)ue<_n[u]&&(ue=_n[u]);for(u=g*dt;u<o;++u)_n[u]=ue+$n[g-1]}else if(We===SC){for(ue=0,u=dt;u<kt;++u)ue<_n[u]&&(ue=_n[u]);for(u=dt;u<kt;++u)_n[u]=ue+qn}else for(We=!1,g=1;g<ct;++g)for(o=(u=g*dt)+dt;u<o;++u)_n[u]+=$n[g-1];for(X=0,u=0;u<kt;++u)X=St[u]+(u%dt?X:0),er[u]+=X-t[u].x;for(f=0;f<dt;++f)for(te=0,u=f;u<kt;u+=dt)te+=_n[u],rr[u]+=te-t[u].y;if(Ue&&vu(n.center,Y1)&&ct>1)for(u=0;u<kt;++u)(X=(x=Ue===SC?Mn:yn[u%dt])-fr[u].x2-t[u].x-er[u])>0&&(er[u]+=X/2);if(We&&vu(n.center,J1)&&dt!==1)for(u=0;u<kt;++u)(te=(x=We===SC?qn:$n[~~(u/dt)])-fr[u].y2-t[u].y-rr[u])>0&&(rr[u]+=te/2);for(u=0;u<kt;++u)Pe.union(fr[u].translate(er[u],rr[u]));switch(X=vu(n.anchor,T0),te=vu(n.anchor,Yv),vu(n.anchor,Y1)){case ju:X-=Pe.width();break;case Fm:X-=Pe.width()/2}switch(vu(n.anchor,J1)){case ju:te-=Pe.height();break;case Fm:te-=Pe.height()/2}for(X=Math.round(X),te=Math.round(te),Pe.clear(),u=0;u<kt;++u)t[u].mark.bounds.clear();for(u=0;u<kt;++u)(k=t[u]).x+=er[u]+=X,k.y+=rr[u]+=te,Pe.union(k.mark.bounds.union(k.bounds.translate(er[u],rr[u]))),he&&e.dirty(k);return Pe}function o$(e,t,n){var o,u,f,g,x,k,F,V=function(We){var at,st,dt=We.items,ct=dt.length,kt=0;const St={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;kt<ct;++kt)if(st=(at=dt[kt]).items,at.marktype===gp)switch(at.role){case Jv:case vp:case Rm:break;case Cw:St.rowheaders.push(...st);break;case _C:St.rowfooters.push(...st);break;case kw:St.colheaders.push(...st);break;case Aw:St.colfooters.push(...st);break;case EC:St.rowtitle=st[0];break;case Ow:St.coltitle=st[0];break;default:St.marks.push(...st)}return St}(t),X=V.marks,te=n.bounds===NT?a$:s$,ue=n.offset,he=n.columns||X.length,be=he<=0?1:Math.ceil(X.length/he),Pe=be*he;const Ue=a6(e,X,n);Ue.empty()&&Ue.set(0,0,0,0),V.rowheaders&&(k=vu(n.headerBand,J1,null),o=AC(e,V.rowheaders,X,he,be,-vu(ue,"rowHeader"),r6,0,te,"x1",0,he,1,k)),V.colheaders&&(k=vu(n.headerBand,Y1,null),u=AC(e,V.colheaders,X,he,he,-vu(ue,"columnHeader"),r6,1,te,"y1",0,1,he,k)),V.rowfooters&&(k=vu(n.footerBand,J1,null),f=AC(e,V.rowfooters,X,he,be,vu(ue,"rowFooter"),i6,0,te,"x2",he-1,he,1,k)),V.colfooters&&(k=vu(n.footerBand,Y1,null),g=AC(e,V.colfooters,X,he,he,vu(ue,"columnFooter"),i6,1,te,"y2",Pe-he,1,he,k)),V.rowtitle&&(x=vu(n.titleAnchor,J1),F=vu(ue,"rowTitle"),F=x===ju?f+F:o-F,k=vu(n.titleBand,J1,.5),s6(e,V.rowtitle,F,0,Ue,k)),V.coltitle&&(x=vu(n.titleAnchor,Y1),F=vu(ue,"columnTitle"),F=x===ju?g+F:u-F,k=vu(n.titleBand,Y1,.5),s6(e,V.coltitle,F,1,Ue,k))}function a$(e,t){return t==="x1"?e.x||0:t==="y1"?e.y||0:t==="x2"?(e.x||0)+(e.width||0):t==="y2"?(e.y||0)+(e.height||0):void 0}function s$(e,t){return e.bounds[t]}function AC(e,t,n,o,u,f,g,x,k,F,V,X,te,ue){var he,be,Pe,Ue,We,at,st,dt,ct,kt=n.length,St=0,yn=0;if(!kt)return St;for(he=V;he<kt;he+=X)n[he]&&(St=g(St,k(n[he],F)));if(!t.length)return St;for(t.length>u&&(e.warn("Grid headers exceed limit: "+u),t=t.slice(0,u)),St+=f,be=0,Ue=t.length;be<Ue;++be)e.dirty(t[be]),t[be].mark.bounds.clear();for(he=V,be=0,Ue=t.length;be<Ue;++be,he+=X){for(We=(at=t[be]).mark.bounds,Pe=he;Pe>=0&&(st=n[Pe])==null;Pe-=te);x?(dt=ue==null?st.x:Math.round(st.bounds.x1+ue*st.bounds.width()),ct=St):(dt=St,ct=ue==null?st.y:Math.round(st.bounds.y1+ue*st.bounds.height())),We.union(at.bounds.translate(dt-(at.x||0),ct-(at.y||0))),at.x=dt,at.y=ct,e.dirty(at),yn=g(yn,We[F])}return yn}function s6(e,t,n,o,u,f){if(t){e.dirty(t);var g=n,x=n;o?g=Math.round(u.x1+f*u.width()):x=Math.round(u.y1+f*u.height()),t.bounds.translate(g-(t.x||0),x-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=g,t.y=x,e.dirty(t)}}function u$(e,t,n,o,u,f,g){const x=function(te,ue){const he=te[ue]||{};return(be,Pe)=>he[be]!=null?he[be]:te[be]!=null?te[be]:Pe}(n,t),k=function(te,ue){let he=-1/0;return te.forEach(be=>{be.offset!=null&&(he=Math.max(he,be.offset))}),he>-1/0?he:ue}(e,x("offset",0)),F=x("anchor",mp),V=F===ju?1:F===Fm?.5:0,X={align:DT,bounds:x("bounds",NT),columns:x("direction")==="vertical"?1:e.length,padding:x("margin",8),center:x("center"),nodirty:!0};switch(t){case co:X.anchor={x:Math.floor(o.x1)-k,column:ju,y:V*(g||o.height()+2*o.y1),row:F};break;case Fo:X.anchor={x:Math.ceil(o.x2)+k,y:V*(g||o.height()+2*o.y1),row:F};break;case Ya:X.anchor={y:Math.floor(u.y1)-k,row:ju,x:V*(f||u.width()+2*u.x1),column:F};break;case Qo:X.anchor={y:Math.ceil(u.y2)+k,x:V*(f||u.width()+2*u.x1),column:F};break;case Au:X.anchor={x:k,y:k};break;case Qs:X.anchor={x:f-k,y:k,column:ju};break;case Zs:X.anchor={x:k,y:g-k,row:ju};break;case pp:X.anchor={x:f-k,y:g-k,column:ju,row:ju}}return X}function c$(e,t){var n,o,u=t.items[0],f=u.datum,g=u.orient,x=u.bounds,k=u.x,F=u.y;return u._bounds?u._bounds.clear().union(x):u._bounds=x.clone(),x.clear(),function(V,X,te){var ue=X.padding,he=ue-te.x,be=ue-te.y;if(X.datum.title){var Pe=X.items[1].items[0],Ue=Pe.anchor,We=X.titlePadding||0,at=ue-Pe.x,st=ue-Pe.y;switch(Pe.orient){case co:he+=Math.ceil(Pe.bounds.width())+We;break;case Fo:case Qo:break;default:be+=Pe.bounds.height()+We}switch((he||be)&&x_(V,te,he,be),Pe.orient){case co:st+=Mw(X,te,Pe,Ue,1,1);break;case Fo:at+=Mw(X,te,Pe,ju,0,0)+We,st+=Mw(X,te,Pe,Ue,1,1);break;case Qo:at+=Mw(X,te,Pe,Ue,0,0),st+=Mw(X,te,Pe,ju,-1,0,1)+We;break;default:at+=Mw(X,te,Pe,Ue,0,0)}(at||st)&&x_(V,Pe,at,st),(at=Math.round(Pe.bounds.x1-ue))<0&&(x_(V,te,-at,0),x_(V,Pe,-at,0))}else(he||be)&&x_(V,te,he,be)}(e,u,u.items[0].items[0]),x=function(V,X){return V.items.forEach(te=>X.union(te.bounds)),X.x1=V.padding,X.y1=V.padding,X}(u,x),n=2*u.padding,o=2*u.padding,x.empty()||(n=Math.ceil(x.width()+n),o=Math.ceil(x.height()+o)),f.type===Yq&&function(V){const X=V.reduce((te,ue)=>(te[ue.column]=Math.max(ue.bounds.x2-ue.x,te[ue.column]||0),te),{});V.forEach(te=>{te.width=X[te.column],te.height=te.bounds.y2-te.y})}(u.items[0].items[0].items[0].items),g!==MT&&(u.x=k=0,u.y=F=0),u.width=n,u.height=o,Vf(x.set(k,F,k+n,F+o),u),u.mark.bounds.clear().union(x),u}function Mw(e,t,n,o,u,f,g){const x=e.datum.type!=="symbol",k=n.datum.vgrad,F=(!x||!f&&k||g?t:t.items[0]).bounds[u?"y2":"x2"]-e.padding,V=k&&f?F:0,X=k&&f?0:F,te=u<=0?0:Os(n);return Math.round(o===mp?V:o===ju?X-te:.5*(F-te))}function x_(e,t,n,o){t.x+=n,t.y+=o,t.bounds.translate(n,o),t.mark.bounds.translate(n,o),e.dirty(t)}function u6(e){Mt.call(this,null,e)}function c6(e,t){let n=0;if(t===void 0)for(let o of e)(o=+o)&&(n+=o);else{let o=-1;for(let u of e)(u=+t(u,++o,e))&&(n+=u)}return n}function l6(e){Mt.call(this,null,e)}function f6(e){Mt.call(this,null,e)}function l$(){return Dt({})}function d6(e){Mt.call(this,null,e)}function h6(e){Mt.call(this,[],e)}Object(Ce.z)(u6,Mt,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach(o=>{e.layout&&o$(n,o,e.layout),function(u,f,g){var x,k,F,V,X,te=f.items,ue=Math.max(0,f.width||0),he=Math.max(0,f.height||0),be=new as().set(0,0,ue,he),Pe=be.clone(),Ue=be.clone(),We=[];for(V=0,X=te.length;V<X;++V)switch((k=te[V]).role){case Jv:(t$(k)?Pe:Ue).union(n$(u,k,ue,he));break;case Rm:x=k;break;case vp:We.push(c$(u,k));break;case wC:case K1:case Cw:case _C:case EC:case kw:case Aw:case Ow:Pe.union(k.bounds),Ue.union(k.bounds);break;default:be.union(k.bounds)}if(We.length){const at={};We.forEach(st=>{(F=st.orient||Fo)!==MT&&(at[F]||(at[F]=[])).push(st)});for(const st in at){const dt=at[st];a6(u,dt,u$(dt,st,g.legends,Pe,Ue,ue,he))}We.forEach(st=>{const dt=st.bounds;if(dt.equals(st._bounds)||(st.bounds=st._bounds,u.dirty(st),st.bounds=dt,u.dirty(st)),g.autosize&&g.autosize.type===q5)switch(st.orient){case co:case Fo:be.add(dt.x1,0).add(dt.x2,0);break;case Ya:case Qo:be.add(0,dt.y1).add(0,dt.y2)}else be.union(dt)})}be.union(Pe).union(Ue),x&&be.union(function(at,st,dt,ct,kt){var St,yn=st.items[0],Mn=yn.frame,_n=yn.orient,$n=yn.anchor,qn=yn.offset,er=yn.padding,rr=yn.items[0].items[0],fr=yn.items[1]&&yn.items[1].items[0],Dr=_n===co||_n===Fo?ct:dt,Zr=0,Br=0,di=0,Ti=0,Di=0;if(Mn!==gp?_n===co?(Zr=kt.y2,Dr=kt.y1):_n===Fo?(Zr=kt.y1,Dr=kt.y2):(Zr=kt.x1,Dr=kt.x2):_n===co&&(Zr=ct,Dr=0),St=$n===mp?Zr:$n===ju?Dr:(Zr+Dr)/2,fr&&fr.text){switch(_n){case Ya:case Qo:Di=rr.bounds.height()+er;break;case co:Ti=rr.bounds.width()+er;break;case Fo:Ti=-rr.bounds.width()-er}Kf.clear().union(fr.bounds),Kf.translate(Ti-(fr.x||0),Di-(fr.y||0)),Tw(fr,"x",Ti)|Tw(fr,"y",Di)&&(at.dirty(fr),fr.bounds.clear().union(Kf),fr.mark.bounds.clear().union(Kf),at.dirty(fr)),Kf.clear().union(fr.bounds)}else Kf.clear();switch(Kf.union(rr.bounds),_n){case Ya:Br=St,di=kt.y1-Kf.height()-qn;break;case co:Br=kt.x1-Kf.width()-qn,di=St;break;case Fo:Br=kt.x2+Kf.width()+qn,di=St;break;case Qo:Br=St,di=kt.y2+qn;break;default:Br=yn.x,di=yn.y}return Tw(yn,"x",Br)|Tw(yn,"y",di)&&(Kf.translate(Br,di),at.dirty(yn),yn.bounds.clear().union(Kf),st.bounds.clear().union(Kf),at.dirty(yn)),yn.bounds}(u,x,ue,he,be)),f.clip&&be.set(0,0,f.width||0,f.height||0),function(at,st,dt,ct){const kt=ct.autosize||{},St=kt.type;if(at._autosize<1||!St)return;let yn=at._width,Mn=at._height,_n=Math.max(0,st.width||0),$n=Math.max(0,Math.ceil(-dt.x1)),qn=Math.max(0,st.height||0),er=Math.max(0,Math.ceil(-dt.y1));const rr=Math.max(0,Math.ceil(dt.x2-_n)),fr=Math.max(0,Math.ceil(dt.y2-qn));if(kt.contains===Kq){const Dr=at.padding();yn-=Dr.left+Dr.right,Mn-=Dr.top+Dr.bottom}St===MT?($n=0,er=0,_n=yn,qn=Mn):St===q5?(_n=Math.max(0,yn-$n-rr),qn=Math.max(0,Mn-er-fr)):St===Jq?(_n=Math.max(0,yn-$n-rr),Mn=qn+er+fr):St===Qq?(yn=_n+$n+rr,qn=Math.max(0,Mn-er-fr)):St===Zq&&(yn=_n+$n+rr,Mn=qn+er+fr),at._resizeView(yn,Mn,_n,qn,[$n,er],kt.resize)}(u,f,be,g)}(n,o,e)}),function(o){return o&&o.mark.role!=="legend-entry"}(e.mark.group)?t.reflow():t}}),Object(Ce.z)(l6,Mt,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),o=t.fork(t.NO_SOURCE|t.NO_FIELDS),u=this.value,f=e.scale,g=xm(f,e.count==null?e.values?e.values.length:10:e.count,e.minstep),x=e.format||Tv(n,f,g,e.formatSpecifier,e.formatType,!!e.values),k=e.values?Ov(f,e.values,g):jf(f,g);return u&&(o.rem=u),u=k.map((F,V)=>Dt({index:V/(k.length-1||1),value:F,label:x(F)})),e.extra&&u.length&&u.push(Dt({index:-1,extra:{value:u[0].value},label:""})),o.source=u,o.add=u,this.value=u,o}}),Object(Ce.z)(f6,Mt,{transform(e,t){var n=t.dataflow,o=t.fork(t.NO_SOURCE|t.NO_FIELDS),u=e.item||l$,f=e.key||en,g=this.value;return Object(Ce.B)(o.encode)&&(o.encode=null),g&&(e.modified("key")||t.modified(f))&&Object(Ce.o)("DataJoin does not support modified key function or fields."),g||(t=t.addAll(),this.value=g=function(x){const k=Object(Ce.t)().test(F=>F.exit);return k.lookup=F=>k.get(x(F)),k}(f)),t.visit(t.ADD,x=>{const k=f(x);let F=g.get(k);F?F.exit?(g.empty--,o.add.push(F)):o.mod.push(F):(F=u(x),g.set(k,F),o.add.push(F)),F.datum=x,F.exit=!1}),t.visit(t.MOD,x=>{const k=f(x),F=g.get(k);F&&(F.datum=x,o.mod.push(F))}),t.visit(t.REM,x=>{const k=f(x),F=g.get(k);x!==F.datum||F.exit||(o.rem.push(F),F.exit=!0,++g.empty)}),t.changed(t.ADD_MOD)&&o.modifies("datum"),(t.clean()||e.clean&&g.empty>n.cleanThreshold)&&n.runAfter(g.clean),o}}),Object(Ce.z)(d6,Mt,{transform(e,t){var n=t.fork(t.ADD_REM),o=e.mod||!1,u=e.encoders,f=t.encode;if(Object(Ce.B)(f)){if(!n.changed()&&!f.every(X=>u[X]))return t.StopPropagation;f=f[0],n.encode=null}var g=f==="enter",x=u.update||Ce.s,k=u.enter||Ce.s,F=u.exit||Ce.s,V=(f&&!g?u[f]:x)||Ce.s;if(t.changed(t.ADD)&&(t.visit(t.ADD,X=>{k(X,e),x(X,e)}),n.modifies(k.output),n.modifies(x.output),V!==Ce.s&&V!==x&&(t.visit(t.ADD,X=>{V(X,e)}),n.modifies(V.output))),t.changed(t.REM)&&F!==Ce.s&&(t.visit(t.REM,X=>{F(X,e)}),n.modifies(F.output)),g||V!==Ce.s){const X=t.MOD|(e.modified()?t.REFLOW:0);g?(t.visit(X,te=>{const ue=k(te,e)||o;(V(te,e)||ue)&&n.mod.push(te)}),n.mod.length&&n.modifies(k.output)):t.visit(X,te=>{(V(te,e)||o)&&n.mod.push(te)}),n.mod.length&&n.modifies(V.output)}return n.changed()?n:t.StopPropagation}}),Object(Ce.z)(h6,Mt,{transform(e,t){if(this.value!=null&&!e.modified())return t.StopPropagation;var n,o,u,f,g,x=t.dataflow.locale(),k=t.fork(t.NO_SOURCE|t.NO_FIELDS),F=this.value,V=e.type||vg,X=e.scale,te=+e.limit,ue=xm(X,e.count==null?5:e.count,e.minstep),he=!!e.values||V===vg,be=e.format||Nv(x,X,ue,V,e.formatSpecifier,e.formatType,he),Pe=e.values||Dv(X,ue);return F&&(k.rem=F),V===vg?(te&&Pe.length>te?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),F=Pe.slice(0,te-1),g=!0):F=Pe,Object(Ce.E)(u=e.size)?(e.values||X(F[0])!==0||(F=F.slice(1)),f=F.reduce((Ue,We)=>Math.max(Ue,u(We,e)),0)):u=Object(Ce.m)(f=u||8),F=F.map((Ue,We)=>Dt({index:We,label:be(Ue,We,F),value:Ue,offset:f,size:u(Ue,e)})),g&&(g=Pe[F.length],F.push(Dt({index:F.length,label:"".concat(Pe.length-F.length," entries"),value:g,offset:f,size:u(g,e)})))):V==="gradient"?(n=X.domain(),o=tp(X,n[0],Object(Ce.W)(n)),Pe.length<3&&!e.values&&n[0]!==Object(Ce.W)(n)&&(Pe=[n[0],Object(Ce.W)(n)]),F=Pe.map((Ue,We)=>Dt({index:We,label:be(Ue,We,Pe),value:Ue,perc:o(Ue)}))):(u=Pe.length-1,o=function(Ue){const We=Ue.domain(),at=We.length-1;let st=+We[0],dt=+Object(Ce.W)(We),ct=dt-st;if(Ue.type===dl){const kt=at?ct/at:.1;ct=(dt+=kt)-(st-=kt)}return kt=>(kt-st)/ct}(X),F=Pe.map((Ue,We)=>Dt({index:We,label:be(Ue,We,Pe),value:Ue,perc:We?o(Ue):0,perc2:We===u?1:o(Pe[We+1])}))),k.source=F,k.add=F,this.value=F,k}});const f$=e=>e.source.x,d$=e=>e.source.y,h$=e=>e.target.x,p$=e=>e.target.y;function FT(e){Mt.call(this,{},e)}FT.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},Object(Ce.z)(FT,Mt,{transform(e,t){var n=e.sourceX||f$,o=e.sourceY||d$,u=e.targetX||h$,f=e.targetY||p$,g=e.as||"path",x=e.orient||"vertical",k=e.shape||"line",F=v6.get(k+"-"+x)||v6.get(k);return F||Object(Ce.o)("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,V=>{V[g]=F(n(V),o(V),u(V),f(V))}),t.reflow(e.modified()).modifies(g)}});const p6=(e,t,n,o)=>"M"+e+","+t+"L"+n+","+o,m6=(e,t,n,o)=>{var u=n-e,f=o-t,g=Math.sqrt(u*u+f*f)/2;return"M"+e+","+t+"A"+g+","+g+" "+180*Math.atan2(f,u)/Math.PI+" 0 1 "+n+","+o},g6=(e,t,n,o)=>{const u=n-e,f=o-t,g=.2*(u+f),x=.2*(f-u);return"M"+e+","+t+"C"+(e+g)+","+(t+x)+" "+(n+x)+","+(o-g)+" "+n+","+o},v6=Object(Ce.t)({line:p6,"line-radial":(e,t,n,o)=>p6(t*Math.cos(e),t*Math.sin(e),o*Math.cos(n),o*Math.sin(n)),arc:m6,"arc-radial":(e,t,n,o)=>m6(t*Math.cos(e),t*Math.sin(e),o*Math.cos(n),o*Math.sin(n)),curve:g6,"curve-radial":(e,t,n,o)=>g6(t*Math.cos(e),t*Math.sin(e),o*Math.cos(n),o*Math.sin(n)),"orthogonal-horizontal":(e,t,n,o)=>"M"+e+","+t+"V"+o+"H"+n,"orthogonal-vertical":(e,t,n,o)=>"M"+e+","+t+"H"+n+"V"+o,"orthogonal-radial":(e,t,n,o)=>{const u=Math.cos(e),f=Math.sin(e),g=Math.cos(n),x=Math.sin(n);return"M"+t*u+","+t*f+"A"+t+","+t+" 0 0,"+((Math.abs(n-e)>Math.PI?n<=e:n>e)?1:0)+" "+t*g+","+t*x+"L"+o*g+","+o*x},"diagonal-horizontal":(e,t,n,o)=>{const u=(e+n)/2;return"M"+e+","+t+"C"+u+","+t+" "+u+","+o+" "+n+","+o},"diagonal-vertical":(e,t,n,o)=>{const u=(t+o)/2;return"M"+e+","+t+"C"+e+","+u+" "+n+","+u+" "+n+","+o},"diagonal-radial":(e,t,n,o)=>{const u=Math.cos(e),f=Math.sin(e),g=Math.cos(n),x=Math.sin(n),k=(t+o)/2;return"M"+t*u+","+t*f+"C"+k*u+","+k*f+" "+k*g+","+k*x+" "+o*g+","+o*x}});function RT(e){Mt.call(this,null,e)}RT.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},Object(Ce.z)(RT,Mt,{transform(e,t){var n,o,u,f=e.as||["startAngle","endAngle"],g=f[0],x=f[1],k=e.field||Ce.Q,F=e.startAngle||0,V=e.endAngle!=null?e.endAngle:2*Math.PI,X=t.source,te=X.map(k),ue=te.length,he=F,be=(V-F)/c6(te),Pe=Ns(ue);for(e.sort&&Pe.sort((Ue,We)=>te[Ue]-te[We]),n=0;n<ue;++n)u=te[Pe[n]],(o=X[Pe[n]])[g]=he,o[x]=he+=u*be;return this.value=te,t.reflow(e.modified()).modifies(f)}});const m$=5;function y6(e){return Hd(e)&&e!==rc}const g$=Object(Ce.Fa)(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function b6(e){Mt.call(this,null,e),this.modified(!0)}function x6(e,t,n){return fg(e)&&Math.abs(t.reduce((o,u)=>o+(u<0?-1:u>0?1:0),0))!==t.length&&n.warn("Log scale domain includes zero: "+Object(Ce.Ba)(t)),t}function w6(e,t,n){return Object(Ce.E)(e)&&(t||n)?pg(e,PT(t||[0,1],n)):e}function PT(e,t){return t?e.slice().reverse():e}function _6(e){Mt.call(this,null,e)}Object(Ce.z)(b6,Mt,{transform(e,t){var n=t.dataflow,o=this.value,u=function(f){var g,x=f.type,k="";return x===rc?rc+"-"+Rf:(function(F){const V=F.type;return Hd(V)&&V!==Pf&&V!==Lf&&(F.scheme||F.range&&F.range.length&&F.range.every(Ce.J))}(f)&&(g=f.rawDomain?f.rawDomain.length:f.domain?f.domain.length+ +(f.domainMid!=null):0,k=g===2?rc+"-":g===3?Zh+"-":""),(k+x||Rf).toLowerCase())}(e);for(u in o&&u===o.type||(this.value=o=Vo(u)()),e)if(!g$[u]){if(u==="padding"&&y6(o.type))continue;Object(Ce.E)(o[u])?o[u](e[u]):n.warn("Unsupported scale property: "+u)}return function(f,g,x){var k=f.type,F=g.round||!1,V=g.range;if(g.rangeStep!=null)V=function(X,te,ue){X!==Vd&&X!==cg&&Object(Ce.o)("Only band and point scales support rangeStep.");var he=(te.paddingOuter!=null?te.paddingOuter:te.padding)||0,be=X===cg?1:(te.paddingInner!=null?te.paddingInner:te.padding)||0;return[0,te.rangeStep*ug(ue,be,he)]}(k,g,x);else if(g.scheme&&(V=function(X,te,ue){var he,be,Pe=te.schemeExtent;return Object(Ce.B)(te.scheme)?be=Bf(te.scheme,te.interpolate,te.interpolateGamma):(he=te.scheme.toLowerCase(),(be=v0(he))||Object(Ce.o)("Unrecognized scheme name: ".concat(te.scheme))),ue=X===dl?ue+1:X===hl?ue-1:X===Ud||X===ql?+te.schemeCount||m$:ue,dg(X)?w6(be,Pe,te.reverse):Object(Ce.E)(be)?mg(w6(be,Pe),ue):X===Wd?be:be.slice(0,ue)}(k,g,x),Object(Ce.E)(V))){if(f.interpolator)return f.interpolator(V);Object(Ce.o)("Scale type ".concat(k," does not support interpolating color schemes."))}if(V&&dg(k))return f.interpolator(Bf(PT(V,g.reverse),g.interpolate,g.interpolateGamma));V&&g.interpolate&&f.interpolate?f.interpolate(gg(g.interpolate,g.interpolateGamma)):Object(Ce.E)(f.round)?f.round(F):Object(Ce.E)(f.rangeRound)&&f.interpolate(F?ua:ga),V&&f.range(PT(V,g.reverse))}(o,e,function(f,g,x){let k=g.bins;if(k&&!Object(Ce.B)(k)){const F=f.domain(),V=F[0],X=Object(Ce.W)(F),te=k.step;let ue=k.start==null?V:k.start,he=k.stop==null?X:k.stop;te||Object(Ce.o)("Scale bins parameter missing step property."),ue<V&&(ue=te*Math.ceil(V/te)),he>X&&(he=te*Math.floor(X/te)),k=Ns(ue,he+te/2,te)}return k?f.bins=k:f.bins&&delete f.bins,f.type===hl&&(k?g.domain||g.domainRaw||(f.domain(k),x=k.length):f.bins=f.domain()),x}(o,e,function(f,g,x){const k=function(he,be,Pe){return be?(he.domain(x6(he.type,be,Pe)),be.length):-1}(f,g.domainRaw,x);if(k>-1)return k;var F,V,X=g.domain,te=f.type,ue=g.zero||g.zero===void 0&&function(he){const be=he.type;return!he.bins&&(be===Rf||be===mm||be===Qh)}(f);if(!X)return 0;if(y6(te)&&g.padding&&X[0]!==Object(Ce.W)(X)&&(X=function(he,be,Pe,Ue,We,at){var st=Math.abs(Object(Ce.W)(Pe)-Pe[0]),dt=st/(st-2*Ue),ct=he===Gl?Object(Ce.Oa)(be,null,dt):he===Qh?Object(Ce.Pa)(be,null,dt,.5):he===mm?Object(Ce.Pa)(be,null,dt,We||1):he===zd?Object(Ce.Qa)(be,null,dt,at||1):Object(Ce.Na)(be,null,dt);return(be=be.slice())[0]=ct[0],be[be.length-1]=ct[1],be}(te,X,g.range,g.padding,g.exponent,g.constant)),(ue||g.domainMin!=null||g.domainMax!=null||g.domainMid!=null)&&(F=(X=X.slice()).length-1||1,ue&&(X[0]>0&&(X[0]=0),X[F]<0&&(X[F]=0)),g.domainMin!=null&&(X[0]=g.domainMin),g.domainMax!=null&&(X[F]=g.domainMax),g.domainMid!=null)){const he=(V=g.domainMid)>X[F]?F+1:V<X[0]?0:F;he!==F&&x.warn("Scale domainMid exceeds domain min or max.",V),X.splice(he,0,V)}return f.domain(x6(te,X,x)),te===Wd&&f.unknown(g.domainImplicit?yc:void 0),g.nice&&f.nice&&f.nice(g.nice!==!0&&xm(f,g.nice)||null),X.length}(o,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),Object(Ce.z)(_6,Mt,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(yr(e.sort)),this.modified(n),t}});const E6=["y0","y1"];function LT(e){Mt.call(this,null,e)}function v$(e,t,n,o,u){for(var f,g=(t-e.sum)/2,x=e.length,k=0;k<x;++k)(f=e[k])[o]=g,f[u]=g+=Math.abs(n(f))}function y$(e,t,n,o,u){for(var f,g=1/e.sum,x=0,k=e.length,F=0,V=0;F<k;++F)(f=e[F])[o]=x,f[u]=x=g*(V+=Math.abs(n(f)))}function b$(e,t,n,o,u){for(var f,g,x=0,k=0,F=e.length,V=0;V<F;++V)(f=+n(g=e[V]))<0?(g[o]=k,g[u]=k+=f):(g[o]=x,g[u]=x+=f)}LT.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:"zero",values:["zero","center","normalize"]},{name:"as",type:"string",array:!0,length:2,default:E6}]},Object(Ce.z)(LT,Mt,{transform(e,t){var n,o,u,f,g=e.as||E6,x=g[0],k=g[1],F=yr(e.sort),V=e.field||Ce.Q,X=e.offset==="center"?v$:e.offset==="normalize"?y$:b$;for(n=function(te,ue,he,be){var Pe,Ue,We,at,st,dt,ct,kt,St,yn=[],Mn=_n=>_n(st);if(ue==null)yn.push(te.slice());else for(Pe={},Ue=0,We=te.length;Ue<We;++Ue)st=te[Ue],dt=ue.map(Mn),(ct=Pe[dt])||(Pe[dt]=ct=[],yn.push(ct)),ct.push(st);for(dt=0,St=0,at=yn.length;dt<at;++dt){for(ct=yn[dt],Ue=0,kt=0,We=ct.length;Ue<We;++Ue)kt+=Math.abs(be(ct[Ue]));ct.sum=kt,kt>St&&(St=kt),he&&ct.sort(he)}return yn.max=St,yn}(t.source,e.groupby,F,V),o=0,u=n.length,f=n.max;o<u;++o)X(n[o],f,V,x,k);return t.reflow(e.modified()).modifies(g)}});var w_=e=>e;function OC(e,t){e&&C6.hasOwnProperty(e.type)&&C6[e.type](e,t)}var S6={Feature:function(e,t){OC(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,o=-1,u=n.length;++o<u;)OC(n[o].geometry,t)}},C6={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,o=-1,u=n.length;++o<u;)e=n[o],t.point(e[0],e[1],e[2])},LineString:function(e,t){BT(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,o=-1,u=n.length;++o<u;)BT(n[o],t,0)},Polygon:function(e,t){k6(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,o=-1,u=n.length;++o<u;)k6(n[o],t)},GeometryCollection:function(e,t){for(var n=e.geometries,o=-1,u=n.length;++o<u;)OC(n[o],t)}};function BT(e,t,n){var o,u=-1,f=e.length-n;for(t.lineStart();++u<f;)o=e[u],t.point(o[0],o[1],o[2]);t.lineEnd()}function k6(e,t){var n=-1,o=e.length;for(t.polygonStart();++n<o;)BT(e[n],t,1);t.polygonEnd()}var Gy=function(e,t){e&&S6.hasOwnProperty(e.type)?S6[e.type](e,t):OC(e,t)};class rh{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let o=0;for(let u=0;u<this._n&&u<32;u++){const f=n[u],g=t+f,x=Math.abs(t)<Math.abs(f)?t-(g-f):f-(g-t);x&&(n[o++]=x),t=g}return n[o]=t,this._n=o+1,this}valueOf(){const t=this._partials;let n,o,u,f=this._n,g=0;if(f>0){for(g=t[--f];f>0&&(n=g,!(u=(o=t[--f])-((g=n+o)-n))););f>0&&(u<0&&t[f-1]<0||u>0&&t[f-1]>0)&&(o=2*u)==(n=g+o)-g&&(g=n)}return g}}var oo=1e-6,Zo=Math.PI,zu=Zo/2,TC=Zo/4,ih=2*Zo,ac=180/Zo,ea=Zo/180,ka=Math.abs,Dw=Math.atan,Dg=Math.atan2,lo=Math.cos,MC=Math.ceil,A6=Math.exp,jT=Math.hypot,DC=Math.log,zT=Math.pow,Yi=Math.sin,Ng=Math.sign||function(e){return e>0?1:e<0?-1:0},oh=Math.sqrt,UT=Math.tan;function O6(e){return e>1?0:e<-1?Zo:Math.acos(e)}function yp(e){return e>1?zu:e<-1?-zu:Math.asin(e)}function rf(){}var T6,M6,WT,VT,HT=new rh,GT=new rh,Q1={point:rf,lineStart:rf,lineEnd:rf,polygonStart:function(){Q1.lineStart=x$,Q1.lineEnd=_$},polygonEnd:function(){Q1.lineStart=Q1.lineEnd=Q1.point=rf,HT.add(ka(GT)),GT=new rh},result:function(){var e=HT/2;return HT=new rh,e}};function x$(){Q1.point=w$}function w$(e,t){Q1.point=D6,T6=WT=e,M6=VT=t}function D6(e,t){GT.add(VT*e-WT*t),WT=e,VT=t}function _$(){D6(T6,M6)}var N6=Q1,Nw=1/0,NC=Nw,__=-Nw,IC=__,I6,F6,Qv,Zv,FC={point:function(e,t){e<Nw&&(Nw=e),e>__&&(__=e),t<NC&&(NC=t),t>IC&&(IC=t)},lineStart:rf,lineEnd:rf,polygonStart:rf,polygonEnd:rf,result:function(){var e=[[Nw,NC],[__,IC]];return __=IC=-(NC=Nw=1/0),e}},qT=0,$T=0,E_=0,RC=0,PC=0,Iw=0,XT=0,KT=0,S_=0,M0={point:ax,lineStart:R6,lineEnd:P6,polygonStart:function(){M0.lineStart=C$,M0.lineEnd=k$},polygonEnd:function(){M0.point=ax,M0.lineStart=R6,M0.lineEnd=P6},result:function(){var e=S_?[XT/S_,KT/S_]:Iw?[RC/Iw,PC/Iw]:E_?[qT/E_,$T/E_]:[NaN,NaN];return qT=$T=E_=RC=PC=Iw=XT=KT=S_=0,e}};function ax(e,t){qT+=e,$T+=t,++E_}function R6(){M0.point=E$}function E$(e,t){M0.point=S$,ax(Qv=e,Zv=t)}function S$(e,t){var n=e-Qv,o=t-Zv,u=oh(n*n+o*o);RC+=u*(Qv+e)/2,PC+=u*(Zv+t)/2,Iw+=u,ax(Qv=e,Zv=t)}function P6(){M0.point=ax}function C$(){M0.point=A$}function k$(){L6(I6,F6)}function A$(e,t){M0.point=L6,ax(I6=Qv=e,F6=Zv=t)}function L6(e,t){var n=e-Qv,o=t-Zv,u=oh(n*n+o*o);RC+=u*(Qv+e)/2,PC+=u*(Zv+t)/2,Iw+=u,XT+=(u=Zv*e-Qv*t)*(Qv+e),KT+=u*(Zv+t),S_+=3*u,ax(Qv=e,Zv=t)}var B6=M0;function j6(e){this._context=e}j6.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,ih)}},result:rf};var YT,z6,U6,C_,k_,JT=new rh,LC={point:rf,lineStart:function(){LC.point=O$},lineEnd:function(){YT&&W6(z6,U6),LC.point=rf},polygonStart:function(){YT=!0},polygonEnd:function(){YT=null},result:function(){var e=+JT;return JT=new rh,e}};function O$(e,t){LC.point=W6,z6=C_=e,U6=k_=t}function W6(e,t){C_-=e,k_-=t,JT.add(oh(C_*C_+k_*k_)),C_=e,k_=t}var V6=LC;function H6(){this._string=[]}function G6(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}H6.prototype={_radius:4.5,_circle:G6(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._string.push("M",e,",",t),this._point=1;break;case 1:this._string.push("L",e,",",t);break;default:this._circle==null&&(this._circle=G6(this._radius)),this._string.push("M",e,",",t,this._circle)}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}return null}};var q6=function(e,t){var n,o,u=4.5;function f(g){return g&&(typeof u=="function"&&o.pointRadius(+u.apply(this,arguments)),Gy(g,n(o))),o.result()}return f.area=function(g){return Gy(g,n(N6)),N6.result()},f.measure=function(g){return Gy(g,n(V6)),V6.result()},f.bounds=function(g){return Gy(g,n(FC)),FC.result()},f.centroid=function(g){return Gy(g,n(B6)),B6.result()},f.projection=function(g){return arguments.length?(n=g==null?(e=null,w_):(e=g).stream,f):e},f.context=function(g){return arguments.length?(o=g==null?(t=null,new H6):new j6(t=g),typeof u!="function"&&o.pointRadius(u),f):t},f.pointRadius=function(g){return arguments.length?(u=typeof g=="function"?g:(o.pointRadius(+g),+g),f):u},f.projection(e).context(t)},$6=function(){var e,t=[];return{point:function(n,o,u){e.push([n,o,u])},lineStart:function(){t.push(e=[])},lineEnd:rf,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}},BC=function(e,t){return ka(e[0]-t[0])<oo&&ka(e[1]-t[1])<oo};function jC(e,t,n,o){this.x=e,this.z=t,this.o=n,this.e=o,this.v=!1,this.n=this.p=null}var X6=function(e,t,n,o,u){var f,g,x=[],k=[];if(e.forEach(function(he){if(!((be=he.length-1)<=0)){var be,Pe,Ue=he[0],We=he[be];if(BC(Ue,We)){if(!Ue[2]&&!We[2]){for(u.lineStart(),f=0;f<be;++f)u.point((Ue=he[f])[0],Ue[1]);return void u.lineEnd()}We[0]+=2*oo}x.push(Pe=new jC(Ue,he,null,!0)),k.push(Pe.o=new jC(Ue,null,Pe,!1)),x.push(Pe=new jC(We,he,null,!1)),k.push(Pe.o=new jC(We,null,Pe,!0))}}),x.length){for(k.sort(t),K6(x),K6(k),f=0,g=k.length;f<g;++f)k[f].e=n=!n;for(var F,V,X=x[0];;){for(var te=X,ue=!0;te.v;)if((te=te.n)===X)return;F=te.z,u.lineStart();do{if(te.v=te.o.v=!0,te.e){if(ue)for(f=0,g=F.length;f<g;++f)u.point((V=F[f])[0],V[1]);else o(te.x,te.n.x,1,u);te=te.n}else{if(ue)for(F=te.p.z,f=F.length-1;f>=0;--f)u.point((V=F[f])[0],V[1]);else o(te.x,te.p.x,-1,u);te=te.p}F=(te=te.o).z,ue=!ue}while(!te.v);u.lineEnd()}}};function K6(e){if(t=e.length){for(var t,n,o=0,u=e[0];++o<t;)u.n=n=e[o],n.p=u,u=n;u.n=n=e[0],n.p=u}}function zC(e){return[Dg(e[1],e[0]),yp(e[2])]}function sx(e){var t=e[0],n=e[1],o=lo(n);return[o*lo(t),o*Yi(t),Yi(n)]}function UC(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Fw(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function QT(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function WC(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function VC(e){var t=oh(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function ZT(e){return ka(e[0])<=Zo?e[0]:Ng(e[0])*((ka(e[0])+Zo)%ih-Zo)}function Y6(e){return Array.from(function*(t){for(const n of t)yield*n}(e))}var J6=function(e,t,n,o){return function(u){var f,g,x,k=t(u),F=$6(),V=t(F),X=!1,te={point:ue,lineStart:be,lineEnd:Pe,polygonStart:function(){te.point=Ue,te.lineStart=We,te.lineEnd=at,g=[],f=[]},polygonEnd:function(){te.point=ue,te.lineStart=be,te.lineEnd=Pe,g=Y6(g);var st=function(dt,ct){var kt=ZT(ct),St=ct[1],yn=Yi(St),Mn=[Yi(kt),-lo(kt),0],_n=0,$n=0,qn=new rh;yn===1?St=zu+oo:yn===-1&&(St=-zu-oo);for(var er=0,rr=dt.length;er<rr;++er)if(Dr=(fr=dt[er]).length)for(var fr,Dr,Zr=fr[Dr-1],Br=ZT(Zr),di=Zr[1]/2+TC,Ti=Yi(di),Di=lo(di),Zi=0;Zi<Dr;++Zi,Br=Ni,Ti=To,Di=da,Zr=Ri){var Ri=fr[Zi],Ni=ZT(Ri),Ui=Ri[1]/2+TC,To=Yi(Ui),da=lo(Ui),eo=Ni-Br,Ta=eo>=0?1:-1,Ma=Ta*eo,rs=Ma>Zo,Gs=Ti*To;if(qn.add(Dg(Gs*Ta*Yi(Ma),Di*da+Gs*lo(Ma))),_n+=rs?eo+Ta*ih:eo,rs^Br>=kt^Ni>=kt){var qs=Fw(sx(Zr),sx(Ri));VC(qs);var Ms=Fw(Mn,qs);VC(Ms);var cf=(rs^eo>=0?-1:1)*yp(Ms[2]);(St>cf||St===cf&&(qs[0]||qs[1]))&&($n+=rs^eo>=0?1:-1)}}return(_n<-oo||_n<oo&&qn<-1e-12)^1&$n}(f,o);g.length?(X||(u.polygonStart(),X=!0),X6(g,M$,st,n,u)):st&&(X||(u.polygonStart(),X=!0),u.lineStart(),n(null,null,1,u),u.lineEnd()),X&&(u.polygonEnd(),X=!1),g=f=null},sphere:function(){u.polygonStart(),u.lineStart(),n(null,null,1,u),u.lineEnd(),u.polygonEnd()}};function ue(st,dt){e(st,dt)&&u.point(st,dt)}function he(st,dt){k.point(st,dt)}function be(){te.point=he,k.lineStart()}function Pe(){te.point=ue,k.lineEnd()}function Ue(st,dt){x.push([st,dt]),V.point(st,dt)}function We(){V.lineStart(),x=[]}function at(){Ue(x[0][0],x[0][1]),V.lineEnd();var st,dt,ct,kt,St=V.clean(),yn=F.result(),Mn=yn.length;if(x.pop(),f.push(x),x=null,Mn)if(1&St){if((dt=(ct=yn[0]).length-1)>0){for(X||(u.polygonStart(),X=!0),u.lineStart(),st=0;st<dt;++st)u.point((kt=ct[st])[0],kt[1]);u.lineEnd()}}else Mn>1&&2&St&&yn.push(yn.pop().concat(yn.shift())),g.push(yn.filter(T$))}return te}};function T$(e){return e.length>1}function M$(e,t){return((e=e.x)[0]<0?e[1]-zu-oo:zu-e[1])-((t=t.x)[0]<0?t[1]-zu-oo:zu-t[1])}var Q6=J6(function(){return!0},function(e){var t,n=NaN,o=NaN,u=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(f,g){var x=f>0?Zo:-Zo,k=ka(f-n);ka(k-Zo)<oo?(e.point(n,o=(o+g)/2>0?zu:-zu),e.point(u,o),e.lineEnd(),e.lineStart(),e.point(x,o),e.point(f,o),t=0):u!==x&&k>=Zo&&(ka(n-u)<oo&&(n-=u*oo),ka(f-x)<oo&&(f-=x*oo),o=function(F,V,X,te){var ue,he,be=Yi(F-X);return ka(be)>oo?Dw((Yi(V)*(he=lo(te))*Yi(X)-Yi(te)*(ue=lo(V))*Yi(F))/(ue*he*be)):(V+te)/2}(n,o,f,g),e.point(u,o),e.lineEnd(),e.lineStart(),e.point(x,o),t=0),e.point(n=f,o=g),u=x},lineEnd:function(){e.lineEnd(),n=o=NaN},clean:function(){return 2-t}}},function(e,t,n,o){var u;if(e==null)u=n*zu,o.point(-Zo,u),o.point(0,u),o.point(Zo,u),o.point(Zo,0),o.point(Zo,-u),o.point(0,-u),o.point(-Zo,-u),o.point(-Zo,0),o.point(-Zo,u);else if(ka(e[0]-t[0])>oo){var f=e[0]<t[0]?Zo:-Zo;u=n*f/2,o.point(-f,u),o.point(0,u),o.point(f,u)}else o.point(t[0],t[1])},[-Zo,-zu]),eM=function(e,t){function n(o,u){return o=e(o,u),t(o[0],o[1])}return e.invert&&t.invert&&(n.invert=function(o,u){return(o=t.invert(o,u))&&e.invert(o[0],o[1])}),n};function tM(e,t){return[ka(e)>Zo?e+Math.round(-e/ih)*ih:e,t]}function Z6(e,t,n){return(e%=ih)?t||n?eM(tP(e),nP(t,n)):tP(e):t||n?nP(t,n):tM}function eP(e){return function(t,n){return[(t+=e)>Zo?t-ih:t<-Zo?t+ih:t,n]}}function tP(e){var t=eP(e);return t.invert=eP(-e),t}function nP(e,t){var n=lo(e),o=Yi(e),u=lo(t),f=Yi(t);function g(x,k){var F=lo(k),V=lo(x)*F,X=Yi(x)*F,te=Yi(k),ue=te*n+V*o;return[Dg(X*u-ue*f,V*n-te*o),yp(ue*u+X*f)]}return g.invert=function(x,k){var F=lo(k),V=lo(x)*F,X=Yi(x)*F,te=Yi(k),ue=te*u-X*f;return[Dg(X*u+te*f,V*n+ue*o),yp(ue*n-V*o)]},g}tM.invert=tM;var D$=function(e){function t(n){return(n=e(n[0]*ea,n[1]*ea))[0]*=ac,n[1]*=ac,n}return e=Z6(e[0]*ea,e[1]*ea,e.length>2?e[2]*ea:0),t.invert=function(n){return(n=e.invert(n[0]*ea,n[1]*ea))[0]*=ac,n[1]*=ac,n},t};function N$(e,t,n,o,u,f){if(n){var g=lo(t),x=Yi(t),k=o*n;u==null?(u=t+o*ih,f=t-k/2):(u=rP(g,u),f=rP(g,f),(o>0?u<f:u>f)&&(u+=o*ih));for(var F,V=u;o>0?V>f:V<f;V-=k)F=zC([g,-x*lo(V),-x*Yi(V)]),e.point(F[0],F[1])}}function rP(e,t){(t=sx(t))[0]-=e,VC(t);var n=O6(-t[1]);return((-t[2]<0?-n:n)+ih-oo)%ih}var I$=function(e){var t=lo(e),n=6*ea,o=t>0,u=ka(t)>oo;function f(k,F){return lo(k)*lo(F)>t}function g(k,F,V){var X=[1,0,0],te=Fw(sx(k),sx(F)),ue=UC(te,te),he=te[0],be=ue-he*he;if(!be)return!V&&k;var Pe=t*ue/be,Ue=-t*he/be,We=Fw(X,te),at=WC(X,Pe);QT(at,WC(te,Ue));var st=We,dt=UC(at,st),ct=UC(st,st),kt=dt*dt-ct*(UC(at,at)-1);if(!(kt<0)){var St=oh(kt),yn=WC(st,(-dt-St)/ct);if(QT(yn,at),yn=zC(yn),!V)return yn;var Mn,_n=k[0],$n=F[0],qn=k[1],er=F[1];$n<_n&&(Mn=_n,_n=$n,$n=Mn);var rr=$n-_n,fr=ka(rr-Zo)<oo;if(!fr&&er<qn&&(Mn=qn,qn=er,er=Mn),fr||rr<oo?fr?qn+er>0^yn[1]<(ka(yn[0]-_n)<oo?qn:er):qn<=yn[1]&&yn[1]<=er:rr>Zo^(_n<=yn[0]&&yn[0]<=$n)){var Dr=WC(st,(-dt+St)/ct);return QT(Dr,at),[yn,zC(Dr)]}}}function x(k,F){var V=o?e:Zo-e,X=0;return k<-V?X|=1:k>V&&(X|=2),F<-V?X|=4:F>V&&(X|=8),X}return J6(f,function(k){var F,V,X,te,ue;return{lineStart:function(){te=X=!1,ue=1},point:function(he,be){var Pe,Ue=[he,be],We=f(he,be),at=o?We?0:x(he,be):We?x(he+(he<0?Zo:-Zo),be):0;if(!F&&(te=X=We)&&k.lineStart(),We!==X&&(!(Pe=g(F,Ue))||BC(F,Pe)||BC(Ue,Pe))&&(Ue[2]=1),We!==X)ue=0,We?(k.lineStart(),Pe=g(Ue,F),k.point(Pe[0],Pe[1])):(Pe=g(F,Ue),k.point(Pe[0],Pe[1],2),k.lineEnd()),F=Pe;else if(u&&F&&o^We){var st;at&V||!(st=g(Ue,F,!0))||(ue=0,o?(k.lineStart(),k.point(st[0][0],st[0][1]),k.point(st[1][0],st[1][1]),k.lineEnd()):(k.point(st[1][0],st[1][1]),k.lineEnd(),k.lineStart(),k.point(st[0][0],st[0][1],3)))}!We||F&&BC(F,Ue)||k.point(Ue[0],Ue[1]),F=Ue,X=We,V=at},lineEnd:function(){X&&k.lineEnd(),F=null},clean:function(){return ue|(te&&X)<<1}}},function(k,F,V,X){N$(X,e,n,V,k,F)},o?[0,-e]:[-Zo,e-Zo])},F$=function(e,t,n,o,u,f){var g,x=e[0],k=e[1],F=0,V=1,X=t[0]-x,te=t[1]-k;if(g=n-x,X||!(g>0)){if(g/=X,X<0){if(g<F)return;g<V&&(V=g)}else if(X>0){if(g>V)return;g>F&&(F=g)}if(g=u-x,X||!(g<0)){if(g/=X,X<0){if(g>V)return;g>F&&(F=g)}else if(X>0){if(g<F)return;g<V&&(V=g)}if(g=o-k,te||!(g>0)){if(g/=te,te<0){if(g<F)return;g<V&&(V=g)}else if(te>0){if(g>V)return;g>F&&(F=g)}if(g=f-k,te||!(g<0)){if(g/=te,te<0){if(g>V)return;g>F&&(F=g)}else if(te>0){if(g<F)return;g<V&&(V=g)}return F>0&&(e[0]=x+F*X,e[1]=k+F*te),V<1&&(t[0]=x+V*X,t[1]=k+V*te),!0}}}}},A_=1e9,HC=-A_;function iP(e,t,n,o){function u(F,V){return e<=F&&F<=n&&t<=V&&V<=o}function f(F,V,X,te){var ue=0,he=0;if(F==null||(ue=g(F,X))!==(he=g(V,X))||k(F,V)<0^X>0)do te.point(ue===0||ue===3?e:n,ue>1?o:t);while((ue=(ue+X+4)%4)!==he);else te.point(V[0],V[1])}function g(F,V){return ka(F[0]-e)<oo?V>0?0:3:ka(F[0]-n)<oo?V>0?2:1:ka(F[1]-t)<oo?V>0?1:0:V>0?3:2}function x(F,V){return k(F.x,V.x)}function k(F,V){var X=g(F,1),te=g(V,1);return X!==te?X-te:X===0?V[1]-F[1]:X===1?F[0]-V[0]:X===2?F[1]-V[1]:V[0]-F[0]}return function(F){var V,X,te,ue,he,be,Pe,Ue,We,at,st,dt=F,ct=$6(),kt={point:St,lineStart:function(){kt.point=yn,X&&X.push(te=[]),at=!0,We=!1,Pe=Ue=NaN},lineEnd:function(){V&&(yn(ue,he),be&&We&&ct.rejoin(),V.push(ct.result())),kt.point=St,We&&dt.lineEnd()},polygonStart:function(){dt=ct,V=[],X=[],st=!0},polygonEnd:function(){var Mn=function(){for(var qn=0,er=0,rr=X.length;er<rr;++er)for(var fr,Dr,Zr=X[er],Br=1,di=Zr.length,Ti=Zr[0],Di=Ti[0],Zi=Ti[1];Br<di;++Br)fr=Di,Dr=Zi,Ti=Zr[Br],Di=Ti[0],Zi=Ti[1],Dr<=o?Zi>o&&(Di-fr)*(o-Dr)>(Zi-Dr)*(e-fr)&&++qn:Zi<=o&&(Di-fr)*(o-Dr)<(Zi-Dr)*(e-fr)&&--qn;return qn}(),_n=st&&Mn,$n=(V=Y6(V)).length;(_n||$n)&&(F.polygonStart(),_n&&(F.lineStart(),f(null,null,1,F),F.lineEnd()),$n&&X6(V,x,Mn,f,F),F.polygonEnd()),dt=F,V=X=te=null}};function St(Mn,_n){u(Mn,_n)&&dt.point(Mn,_n)}function yn(Mn,_n){var $n=u(Mn,_n);if(X&&te.push([Mn,_n]),at)ue=Mn,he=_n,be=$n,at=!1,$n&&(dt.lineStart(),dt.point(Mn,_n));else if($n&&We)dt.point(Mn,_n);else{var qn=[Pe=Math.max(HC,Math.min(A_,Pe)),Ue=Math.max(HC,Math.min(A_,Ue))],er=[Mn=Math.max(HC,Math.min(A_,Mn)),_n=Math.max(HC,Math.min(A_,_n))];F$(qn,er,e,t,n,o)?(We||(dt.lineStart(),dt.point(qn[0],qn[1])),dt.point(er[0],er[1]),$n||dt.lineEnd(),st=!1):$n&&(dt.lineStart(),dt.point(Mn,_n),st=!1)}Pe=Mn,Ue=_n,We=$n}return kt}}function GC(e){return function(t){var n=new nM;for(var o in e)n[o]=e[o];return n.stream=t,n}}function nM(){}function rM(e,t,n){var o=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),o!=null&&e.clipExtent(null),Gy(n,e.stream(FC)),t(FC.result()),o!=null&&e.clipExtent(o),e}function qC(e,t,n){return rM(e,function(o){var u=t[1][0]-t[0][0],f=t[1][1]-t[0][1],g=Math.min(u/(o[1][0]-o[0][0]),f/(o[1][1]-o[0][1])),x=+t[0][0]+(u-g*(o[1][0]+o[0][0]))/2,k=+t[0][1]+(f-g*(o[1][1]+o[0][1]))/2;e.scale(150*g).translate([x,k])},n)}function iM(e,t,n){return qC(e,[[0,0],t],n)}function oM(e,t,n){return rM(e,function(o){var u=+t,f=u/(o[1][0]-o[0][0]),g=(u-f*(o[1][0]+o[0][0]))/2,x=-f*o[0][1];e.scale(150*f).translate([g,x])},n)}function aM(e,t,n){return rM(e,function(o){var u=+t,f=u/(o[1][1]-o[0][1]),g=-f*o[0][0],x=(u-f*(o[1][1]+o[0][1]))/2;e.scale(150*f).translate([g,x])},n)}nM.prototype={constructor:nM,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var oP=16,R$=lo(30*ea),aP=function(e,t){return+t?function(n,o){function u(f,g,x,k,F,V,X,te,ue,he,be,Pe,Ue,We){var at=X-f,st=te-g,dt=at*at+st*st;if(dt>4*o&&Ue--){var ct=k+he,kt=F+be,St=V+Pe,yn=oh(ct*ct+kt*kt+St*St),Mn=yp(St/=yn),_n=ka(ka(St)-1)<oo||ka(x-ue)<oo?(x+ue)/2:Dg(kt,ct),$n=n(_n,Mn),qn=$n[0],er=$n[1],rr=qn-f,fr=er-g,Dr=st*rr-at*fr;(Dr*Dr/dt>o||ka((at*rr+st*fr)/dt-.5)>.3||k*he+F*be+V*Pe<R$)&&(u(f,g,x,k,F,V,qn,er,_n,ct/=yn,kt/=yn,St,Ue,We),We.point(qn,er),u(qn,er,_n,ct,kt,St,X,te,ue,he,be,Pe,Ue,We))}}return function(f){var g,x,k,F,V,X,te,ue,he,be,Pe,Ue,We={point:at,lineStart:st,lineEnd:ct,polygonStart:function(){f.polygonStart(),We.lineStart=kt},polygonEnd:function(){f.polygonEnd(),We.lineStart=st}};function at(Mn,_n){Mn=n(Mn,_n),f.point(Mn[0],Mn[1])}function st(){ue=NaN,We.point=dt,f.lineStart()}function dt(Mn,_n){var $n=sx([Mn,_n]),qn=n(Mn,_n);u(ue,he,te,be,Pe,Ue,ue=qn[0],he=qn[1],te=Mn,be=$n[0],Pe=$n[1],Ue=$n[2],oP,f),f.point(ue,he)}function ct(){We.point=at,f.lineEnd()}function kt(){st(),We.point=St,We.lineEnd=yn}function St(Mn,_n){dt(g=Mn,_n),x=ue,k=he,F=be,V=Pe,X=Ue,We.point=dt}function yn(){u(ue,he,te,be,Pe,Ue,x,k,g,F,V,X,oP,f),We.lineEnd=ct,ct()}return We}}(e,t):function(n){return GC({point:function(o,u){o=n(o,u),this.stream.point(o[0],o[1])}})}(e)},P$=GC({point:function(e,t){this.stream.point(e*ea,t*ea)}});function sP(e,t,n,o,u,f){if(!f)return function(be,Pe,Ue,We,at){function st(dt,ct){return[Pe+be*(dt*=We),Ue-be*(ct*=at)]}return st.invert=function(dt,ct){return[(dt-Pe)/be*We,(Ue-ct)/be*at]},st}(e,t,n,o,u);var g=lo(f),x=Yi(f),k=g*e,F=x*e,V=g/e,X=x/e,te=(x*n-g*t)/e,ue=(x*t+g*n)/e;function he(be,Pe){return[k*(be*=o)-F*(Pe*=u)+t,n-F*be-k*Pe]}return he.invert=function(be,Pe){return[o*(V*be-X*Pe+te),u*(ue-X*be-V*Pe)]},he}function ey(e){return uP(function(){return e})()}function uP(e){var t,n,o,u,f,g,x,k,F,V,X=150,te=480,ue=250,he=0,be=0,Pe=0,Ue=0,We=0,at=0,st=1,dt=1,ct=null,kt=Q6,St=null,yn=w_,Mn=.5;function _n(rr){return k(rr[0]*ea,rr[1]*ea)}function $n(rr){return(rr=k.invert(rr[0],rr[1]))&&[rr[0]*ac,rr[1]*ac]}function qn(){var rr=sP(X,0,0,st,dt,at).apply(null,t(he,be)),fr=sP(X,te-rr[0],ue-rr[1],st,dt,at);return n=Z6(Pe,Ue,We),x=eM(t,fr),k=eM(n,x),g=aP(x,Mn),er()}function er(){return F=V=null,_n}return _n.stream=function(rr){return F&&V===rr?F:F=P$(function(fr){return GC({point:function(Dr,Zr){var Br=fr(Dr,Zr);return this.stream.point(Br[0],Br[1])}})}(n)(kt(g(yn(V=rr)))))},_n.preclip=function(rr){return arguments.length?(kt=rr,ct=void 0,er()):kt},_n.postclip=function(rr){return arguments.length?(yn=rr,St=o=u=f=null,er()):yn},_n.clipAngle=function(rr){return arguments.length?(kt=+rr?I$(ct=rr*ea):(ct=null,Q6),er()):ct*ac},_n.clipExtent=function(rr){return arguments.length?(yn=rr==null?(St=o=u=f=null,w_):iP(St=+rr[0][0],o=+rr[0][1],u=+rr[1][0],f=+rr[1][1]),er()):St==null?null:[[St,o],[u,f]]},_n.scale=function(rr){return arguments.length?(X=+rr,qn()):X},_n.translate=function(rr){return arguments.length?(te=+rr[0],ue=+rr[1],qn()):[te,ue]},_n.center=function(rr){return arguments.length?(he=rr[0]%360*ea,be=rr[1]%360*ea,qn()):[he*ac,be*ac]},_n.rotate=function(rr){return arguments.length?(Pe=rr[0]%360*ea,Ue=rr[1]%360*ea,We=rr.length>2?rr[2]%360*ea:0,qn()):[Pe*ac,Ue*ac,We*ac]},_n.angle=function(rr){return arguments.length?(at=rr%360*ea,qn()):at*ac},_n.reflectX=function(rr){return arguments.length?(st=rr?-1:1,qn()):st<0},_n.reflectY=function(rr){return arguments.length?(dt=rr?-1:1,qn()):dt<0},_n.precision=function(rr){return arguments.length?(g=aP(x,Mn=rr*rr),er()):oh(Mn)},_n.fitExtent=function(rr,fr){return qC(_n,rr,fr)},_n.fitSize=function(rr,fr){return iM(_n,rr,fr)},_n.fitWidth=function(rr,fr){return oM(_n,rr,fr)},_n.fitHeight=function(rr,fr){return aM(_n,rr,fr)},function(){return t=e.apply(this,arguments),_n.invert=t.invert&&$n,qn()}}function sM(e){var t=0,n=Zo/3,o=uP(e),u=o(t,n);return u.parallels=function(f){return arguments.length?o(t=f[0]*ea,n=f[1]*ea):[t*ac,n*ac]},u}function L$(e,t){var n=Yi(e),o=(n+Yi(t))/2;if(ka(o)<oo)return function(x){var k=lo(x);function F(V,X){return[V*k,Yi(X)/k]}return F.invert=function(V,X){return[V/k,yp(X*k)]},F}(e);var u=1+n*(2*o-n),f=oh(u)/o;function g(x,k){var F=oh(u-2*o*Yi(k))/o;return[F*Yi(x*=o),f-F*lo(x)]}return g.invert=function(x,k){var F=f-k,V=Dg(x,ka(F))*Ng(F);return F*o<0&&(V-=Zo*Ng(x)*Ng(F)),[V/o,yp((u-(x*x+F*F)*o*o)/(2*o))]},g}var $C=function(){return sM(L$).scale(155.424).center([0,33.6442])},cP=function(){return $C().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])};function lP(e){return function(t,n){var o=lo(t),u=lo(n),f=e(o*u);return f===1/0?[2,0]:[f*u*Yi(t),f*Yi(n)]}}function O_(e){return function(t,n){var o=oh(t*t+n*n),u=e(o),f=Yi(u),g=lo(u);return[Dg(t*f,o*g),yp(o&&n*f/o)]}}var fP=lP(function(e){return oh(2/(1+e))});fP.invert=O_(function(e){return 2*yp(e/2)});var dP=lP(function(e){return(e=O6(e))&&e/Yi(e)});dP.invert=O_(function(e){return e});function XC(e,t){return[e,DC(UT((zu+t)/2))]}XC.invert=function(e,t){return[e,2*Dw(A6(t))-zu]};function hP(e){var t,n,o,u=ey(e),f=u.center,g=u.scale,x=u.translate,k=u.clipExtent,F=null;function V(){var X=Zo*g(),te=u(D$(u.rotate()).invert([0,0]));return k(F==null?[[te[0]-X,te[1]-X],[te[0]+X,te[1]+X]]:e===XC?[[Math.max(te[0]-X,F),t],[Math.min(te[0]+X,n),o]]:[[F,Math.max(te[1]-X,t)],[n,Math.min(te[1]+X,o)]])}return u.scale=function(X){return arguments.length?(g(X),V()):g()},u.translate=function(X){return arguments.length?(x(X),V()):x()},u.center=function(X){return arguments.length?(f(X),V()):f()},u.clipExtent=function(X){return arguments.length?(X==null?F=t=n=o=null:(F=+X[0][0],t=+X[0][1],n=+X[1][0],o=+X[1][1]),V()):F==null?null:[[F,t],[n,o]]},V()}function KC(e){return UT((zu+e)/2)}function B$(e,t){var n=lo(e),o=e===t?Yi(e):DC(n/lo(t))/DC(KC(t)/KC(e)),u=n*zT(KC(e),o)/o;if(!o)return XC;function f(g,x){u>0?x<-zu+oo&&(x=-zu+oo):x>zu-oo&&(x=zu-oo);var k=u/zT(KC(x),o);return[k*Yi(o*g),u-k*lo(o*g)]}return f.invert=function(g,x){var k=u-x,F=Ng(o)*oh(g*g+k*k),V=Dg(g,ka(k))*Ng(k);return k*o<0&&(V-=Zo*Ng(g)*Ng(k)),[V/o,2*Dw(zT(u/F,1/o))-zu]},f}function YC(e,t){return[e,t]}YC.invert=YC;function j$(e,t){var n=lo(e),o=e===t?Yi(e):(n-lo(t))/(t-e),u=n/o+e;if(ka(o)<oo)return YC;function f(g,x){var k=u-x,F=o*g;return[k*Yi(F),u-k*lo(F)]}return f.invert=function(g,x){var k=u-x,F=Dg(g,ka(k))*Ng(k);return k*o<0&&(F-=Zo*Ng(g)*Ng(k)),[F/o,u-Ng(o)*oh(g*g+k*k)]},f}var T_=1.340264,M_=-.081106,D_=893e-6,N_=.003796,JC=oh(3)/2;function pP(e,t){var n=yp(JC*Yi(t)),o=n*n,u=o*o*o;return[e*lo(n)/(JC*(T_+3*M_*o+u*(7*D_+9*N_*o))),n*(T_+M_*o+u*(D_+N_*o))]}pP.invert=function(e,t){for(var n,o=t,u=o*o,f=u*u*u,g=0;g<12&&(f=(u=(o-=n=(o*(T_+M_*u+f*(D_+N_*u))-t)/(T_+3*M_*u+f*(7*D_+9*N_*u)))*o)*u*u,!(ka(n)<1e-12));++g);return[JC*e*(T_+3*M_*u+f*(7*D_+9*N_*u))/lo(o),yp(Yi(o)/JC)]};function mP(e,t){var n=lo(t),o=lo(e)*n;return[n*Yi(e)/o,Yi(t)/o]}mP.invert=O_(Dw);function gP(e,t){var n=t*t,o=n*n;return[e*(.8707-.131979*n+o*(o*(.003971*n-.001529*o)-.013791)),t*(1.007226+n*(.015085+o*(.028874*n-.044475-.005916*o)))]}gP.invert=function(e,t){var n,o=t,u=25;do{var f=o*o,g=f*f;o-=n=(o*(1.007226+f*(.015085+g*(.028874*f-.044475-.005916*g)))-t)/(1.007226+f*(.045255+g*(.259866*f-.311325-.005916*11*g)))}while(ka(n)>oo&&--u>0);return[e/(.8707+(f=o*o)*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979)),o]};function vP(e,t){return[lo(t)*Yi(e),Yi(t)]}vP.invert=O_(yp);function yP(e,t){var n=lo(t),o=1+lo(e)*n;return[n*Yi(e)/o,Yi(t)/o]}yP.invert=O_(function(e){return 2*Dw(e)});function bP(e,t){return[DC(UT((zu+t)/2)),-e]}bP.invert=function(e,t){return[-t,2*Dw(A6(e))-zu]};var z$=Math.abs,uM=Math.cos,QC=Math.sin,U$=1e-6,xP=Math.PI,cM=xP/2,wP=W$(2);function _P(e){return e>1?cM:e<-1?-cM:Math.asin(e)}function W$(e){return e>0?Math.sqrt(e):0}var V$=function(e,t,n){function o(u,f){return[e*u*uM(f=function(g,x){var k,F=g*QC(x),V=30;do x-=k=(x+QC(x)-F)/(1+uM(x));while(z$(k)>U$&&--V>0);return x/2}(n,f)),t*QC(f)]}return o.invert=function(u,f){return f=_P(f/t),[u/(e*uM(f)),_P((2*f+QC(2*f))/n)]},o}(wP/cM,wP,xP);const H$=q6(),lM=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function fM(e,t){if(!e||typeof e!="string")throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(ZC[e]=function(n,o){return function u(){const f=o();return f.type=n,f.path=q6().projection(f),f.copy=f.copy||function(){const g=u();return lM.forEach(x=>{f[x]&&g[x](f[x]())}),g.path.pointRadius(f.path.pointRadius()),g},f}}(e,t),this):ZC[e]||null}function EP(e){return e&&e.path||H$}const ZC={albers:cP,albersusa:function(){var e,t,n,o,u,f,g=cP(),x=$C().rotate([154,0]).center([-2,58.5]).parallels([55,65]),k=$C().rotate([157,0]).center([-3,19.9]).parallels([8,18]),F={point:function(te,ue){f=[te,ue]}};function V(te){var ue=te[0],he=te[1];return f=null,n.point(ue,he),f||(o.point(ue,he),f)||(u.point(ue,he),f)}function X(){return e=t=null,V}return V.invert=function(te){var ue=g.scale(),he=g.translate(),be=(te[0]-he[0])/ue,Pe=(te[1]-he[1])/ue;return(Pe>=.12&&Pe<.234&&be>=-.425&&be<-.214?x:Pe>=.166&&Pe<.234&&be>=-.214&&be<-.115?k:g).invert(te)},V.stream=function(te){return e&&t===te?e:e=function(ue){var he=ue.length;return{point:function(be,Pe){for(var Ue=-1;++Ue<he;)ue[Ue].point(be,Pe)},sphere:function(){for(var be=-1;++be<he;)ue[be].sphere()},lineStart:function(){for(var be=-1;++be<he;)ue[be].lineStart()},lineEnd:function(){for(var be=-1;++be<he;)ue[be].lineEnd()},polygonStart:function(){for(var be=-1;++be<he;)ue[be].polygonStart()},polygonEnd:function(){for(var be=-1;++be<he;)ue[be].polygonEnd()}}}([g.stream(t=te),x.stream(te),k.stream(te)])},V.precision=function(te){return arguments.length?(g.precision(te),x.precision(te),k.precision(te),X()):g.precision()},V.scale=function(te){return arguments.length?(g.scale(te),x.scale(.35*te),k.scale(te),V.translate(g.translate())):g.scale()},V.translate=function(te){if(!arguments.length)return g.translate();var ue=g.scale(),he=+te[0],be=+te[1];return n=g.translate(te).clipExtent([[he-.455*ue,be-.238*ue],[he+.455*ue,be+.238*ue]]).stream(F),o=x.translate([he-.307*ue,be+.201*ue]).clipExtent([[he-.425*ue+oo,be+.12*ue+oo],[he-.214*ue-oo,be+.234*ue-oo]]).stream(F),u=k.translate([he-.205*ue,be+.212*ue]).clipExtent([[he-.214*ue+oo,be+.166*ue+oo],[he-.115*ue-oo,be+.234*ue-oo]]).stream(F),X()},V.fitExtent=function(te,ue){return qC(V,te,ue)},V.fitSize=function(te,ue){return iM(V,te,ue)},V.fitWidth=function(te,ue){return oM(V,te,ue)},V.fitHeight=function(te,ue){return aM(V,te,ue)},V.scale(1070)},azimuthalequalarea:function(){return ey(fP).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return ey(dP).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return sM(B$).scale(109.5).parallels([30,30])},conicequalarea:$C,conicequidistant:function(){return sM(j$).scale(131.154).center([0,13.9389])},equalEarth:function(){return ey(pP).scale(177.158)},equirectangular:function(){return ey(YC).scale(152.63)},gnomonic:function(){return ey(mP).scale(144.049).clipAngle(60)},identity:function(){var e,t,n,o,u,f,g,x=1,k=0,F=0,V=1,X=1,te=0,ue=null,he=1,be=1,Pe=GC({point:function(st,dt){var ct=at([st,dt]);this.stream.point(ct[0],ct[1])}}),Ue=w_;function We(){return he=x*V,be=x*X,f=g=null,at}function at(st){var dt=st[0]*he,ct=st[1]*be;if(te){var kt=ct*e-dt*t;dt=dt*e+ct*t,ct=kt}return[dt+k,ct+F]}return at.invert=function(st){var dt=st[0]-k,ct=st[1]-F;if(te){var kt=ct*e+dt*t;dt=dt*e-ct*t,ct=kt}return[dt/he,ct/be]},at.stream=function(st){return f&&g===st?f:f=Pe(Ue(g=st))},at.postclip=function(st){return arguments.length?(Ue=st,ue=n=o=u=null,We()):Ue},at.clipExtent=function(st){return arguments.length?(Ue=st==null?(ue=n=o=u=null,w_):iP(ue=+st[0][0],n=+st[0][1],o=+st[1][0],u=+st[1][1]),We()):ue==null?null:[[ue,n],[o,u]]},at.scale=function(st){return arguments.length?(x=+st,We()):x},at.translate=function(st){return arguments.length?(k=+st[0],F=+st[1],We()):[k,F]},at.angle=function(st){return arguments.length?(t=Yi(te=st%360*ea),e=lo(te),We()):te*ac},at.reflectX=function(st){return arguments.length?(V=st?-1:1,We()):V<0},at.reflectY=function(st){return arguments.length?(X=st?-1:1,We()):X<0},at.fitExtent=function(st,dt){return qC(at,st,dt)},at.fitSize=function(st,dt){return iM(at,st,dt)},at.fitWidth=function(st,dt){return oM(at,st,dt)},at.fitHeight=function(st,dt){return aM(at,st,dt)},at},mercator:function(){return hP(XC).scale(961/ih)},mollweide:function(){return ey(V$).scale(169.529)},naturalEarth1:function(){return ey(gP).scale(175.295)},orthographic:function(){return ey(vP).scale(249.5).clipAngle(90+oo)},stereographic:function(){return ey(yP).scale(250).clipAngle(142)},transversemercator:function(){var e=hP(bP),t=e.center,n=e.rotate;return e.center=function(o){return arguments.length?t([-o[1],o[0]]):[(o=t())[1],-o[0]]},e.rotate=function(o){return arguments.length?n([o[0],o[1],o.length>2?o[2]+90:90]):[(o=n())[0],o[1],o[2]-90]},n([0,0,90]).scale(159.155)}};for(const e in ZC)fM(e,ZC[e]);function SP(e,t,n){var o=Ns(e,t-oo,n).concat(t);return function(u){return o.map(function(f){return[u,f]})}}function CP(e,t,n){var o=Ns(e,t-oo,n).concat(t);return function(u){return o.map(function(f){return[f,u]})}}function G$(){var e,t,n,o,u,f,g,x,k,F,V,X,te=10,ue=te,he=90,be=360,Pe=2.5;function Ue(){return{type:"MultiLineString",coordinates:We()}}function We(){return Ns(MC(o/he)*he,n,he).map(V).concat(Ns(MC(x/be)*be,g,be).map(X)).concat(Ns(MC(t/te)*te,e,te).filter(function(at){return ka(at%he)>oo}).map(k)).concat(Ns(MC(f/ue)*ue,u,ue).filter(function(at){return ka(at%be)>oo}).map(F))}return Ue.lines=function(){return We().map(function(at){return{type:"LineString",coordinates:at}})},Ue.outline=function(){return{type:"Polygon",coordinates:[V(o).concat(X(g).slice(1),V(n).reverse().slice(1),X(x).reverse().slice(1))]}},Ue.extent=function(at){return arguments.length?Ue.extentMajor(at).extentMinor(at):Ue.extentMinor()},Ue.extentMajor=function(at){return arguments.length?(o=+at[0][0],n=+at[1][0],x=+at[0][1],g=+at[1][1],o>n&&(at=o,o=n,n=at),x>g&&(at=x,x=g,g=at),Ue.precision(Pe)):[[o,x],[n,g]]},Ue.extentMinor=function(at){return arguments.length?(t=+at[0][0],e=+at[1][0],f=+at[0][1],u=+at[1][1],t>e&&(at=t,t=e,e=at),f>u&&(at=f,f=u,u=at),Ue.precision(Pe)):[[t,f],[e,u]]},Ue.step=function(at){return arguments.length?Ue.stepMajor(at).stepMinor(at):Ue.stepMinor()},Ue.stepMajor=function(at){return arguments.length?(he=+at[0],be=+at[1],Ue):[he,be]},Ue.stepMinor=function(at){return arguments.length?(te=+at[0],ue=+at[1],Ue):[te,ue]},Ue.precision=function(at){return arguments.length?(Pe=+at,k=SP(f,u,90),F=CP(t,e,Pe),V=SP(x,g,90),X=CP(o,n,Pe),Ue):Pe},Ue.extentMajor([[-180,-90+oo],[180,90-oo]]).extentMinor([[-180,-80-oo],[180,80+oo]])}function q$(){}const qy=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function kP(){var e=1,t=1,n=g;function o(x,k){return k.map(F=>u(x,F))}function u(x,k){var F=[],V=[];return function(X,te,ue){var he,be,Pe,Ue,We,at,st=new Array,dt=new Array;for(he=be=-1,Ue=X[0]>=te,qy[Ue<<1].forEach(ct);++he<e-1;)Pe=Ue,Ue=X[he+1]>=te,qy[Pe|Ue<<1].forEach(ct);for(qy[Ue<<0].forEach(ct);++be<t-1;){for(he=-1,Ue=X[be*e+e]>=te,We=X[be*e]>=te,qy[Ue<<1|We<<2].forEach(ct);++he<e-1;)Pe=Ue,Ue=X[be*e+e+he+1]>=te,at=We,We=X[be*e+he+1]>=te,qy[Pe|Ue<<1|We<<2|at<<3].forEach(ct);qy[Ue|We<<3].forEach(ct)}for(he=-1,We=X[be*e]>=te,qy[We<<2].forEach(ct);++he<e-1;)at=We,We=X[be*e+he+1]>=te,qy[We<<2|at<<3].forEach(ct);function ct(kt){var St,yn,Mn=[kt[0][0]+he,kt[0][1]+be],_n=[kt[1][0]+he,kt[1][1]+be],$n=f(Mn),qn=f(_n);(St=dt[$n])?(yn=st[qn])?(delete dt[St.end],delete st[yn.start],St===yn?(St.ring.push(_n),ue(St.ring)):st[St.start]=dt[yn.end]={start:St.start,end:yn.end,ring:St.ring.concat(yn.ring)}):(delete dt[St.end],St.ring.push(_n),dt[St.end=qn]=St):(St=st[qn])?(yn=dt[$n])?(delete st[St.start],delete dt[yn.end],St===yn?(St.ring.push(_n),ue(St.ring)):st[yn.start]=dt[St.end]={start:yn.start,end:St.end,ring:yn.ring.concat(St.ring)}):(delete st[St.start],St.ring.unshift(Mn),st[St.start=$n]=St):st[$n]=dt[qn]={start:$n,end:qn,ring:[Mn,_n]}}qy[We<<3].forEach(ct)}(x,k,X=>{n(X,x,k),function(te){for(var ue=0,he=te.length,be=te[he-1][1]*te[0][0]-te[he-1][0]*te[0][1];++ue<he;)be+=te[ue-1][1]*te[ue][0]-te[ue-1][0]*te[ue][1];return be}(X)>0?F.push([X]):V.push(X)}),V.forEach(X=>{for(var te,ue=0,he=F.length;ue<he;++ue)if($$((te=F[ue])[0],X)!==-1)return void te.push(X)}),{type:"MultiPolygon",value:k,coordinates:F}}function f(x){return 2*x[0]+x[1]*(e+1)*4}function g(x,k,F){x.forEach(V=>{var X,te=V[0],ue=V[1],he=0|te,be=0|ue,Pe=k[be*e+he];te>0&&te<e&&he===te&&(X=k[be*e+he-1],V[0]=te+(F-X)/(Pe-X)-.5),ue>0&&ue<t&&be===ue&&(X=k[(be-1)*e+he],V[1]=ue+(F-X)/(Pe-X)-.5)})}return o.contour=u,o.size=function(x){if(!arguments.length)return[e,t];var k=Math.floor(x[0]),F=Math.floor(x[1]);return k>=0&&F>=0||Object(Ce.o)("invalid size"),e=k,t=F,o},o.smooth=function(x){return arguments.length?(n=x?g:q$,o):n===g},o}function $$(e,t){for(var n,o=-1,u=t.length;++o<u;)if(n=X$(e,t[o]))return n;return 0}function X$(e,t){for(var n=t[0],o=t[1],u=-1,f=0,g=e.length,x=g-1;f<g;x=f++){var k=e[f],F=k[0],V=k[1],X=e[x],te=X[0],ue=X[1];if(K$(k,X,t))return 0;V>o!=ue>o&&n<(te-F)*(o-V)/(ue-V)+F&&(u=-u)}return u}function K$(e,t,n){var o;return function(u,f,g){return(f[0]-u[0])*(g[1]-u[1])==(g[0]-u[0])*(f[1]-u[1])}(e,t,n)&&function(u,f,g){return u<=f&&f<=g||g<=f&&f<=u}(e[o=+(e[0]===t[0])],n[o],t[o])}function AP(e,t,n){return function(o){var u=Object(Ce.q)(o),f=n?Math.min(u[0],0):u[0],g=u[1],x=g-f,k=t?Object(Yu.c)(f,g,e):x/(e+1);return Ns(f+k,g,k)}}function dM(e){Mt.call(this,null,e)}function OP(e,t,n,o,u){const f=e.x1||0,g=e.y1||0,x=t*n<0;function k(X){X.forEach(F)}function F(X){x&&X.reverse(),X.forEach(V)}function V(X){X[0]=(X[0]-f)*t+o,X[1]=(X[1]-g)*n+u}return function(X){return X.coordinates.forEach(k),X}}function TP(e,t,n){const o=e>=0?e:ri(t,n);return Math.round((Math.sqrt(4*o*o+1)-1)/2)}function hM(e){return Object(Ce.E)(e)?e:Object(Ce.m)(+e)}function MP(){var e=k=>k[0],t=k=>k[1],n=Ce.Q,o=[-1,-1],u=960,f=500,g=2;function x(k,F){const V=TP(o[0],k,e)>>g,X=TP(o[1],k,t)>>g,te=V?V+2:0,ue=X?X+2:0,he=2*te+(u>>g),be=2*ue+(f>>g),Pe=new Float32Array(he*be),Ue=new Float32Array(he*be);let We=Pe;k.forEach(st=>{const dt=te+(+e(st)>>g),ct=ue+(+t(st)>>g);dt>=0&&dt<he&&ct>=0&&ct<be&&(Pe[dt+ct*he]+=+n(st))}),V>0&&X>0?(Rw(he,be,Pe,Ue,V),Pw(he,be,Ue,Pe,X),Rw(he,be,Pe,Ue,V),Pw(he,be,Ue,Pe,X),Rw(he,be,Pe,Ue,V),Pw(he,be,Ue,Pe,X)):V>0?(Rw(he,be,Pe,Ue,V),Rw(he,be,Ue,Pe,V),Rw(he,be,Pe,Ue,V),We=Ue):X>0&&(Pw(he,be,Pe,Ue,X),Pw(he,be,Ue,Pe,X),Pw(he,be,Pe,Ue,X),We=Ue);const at=F?Math.pow(2,-2*g):1/c6(We);for(let st=0,dt=he*be;st<dt;++st)We[st]*=at;return{values:We,scale:1<<g,width:he,height:be,x1:te,y1:ue,x2:te+(u>>g),y2:ue+(f>>g)}}return x.x=function(k){return arguments.length?(e=hM(k),x):e},x.y=function(k){return arguments.length?(t=hM(k),x):t},x.weight=function(k){return arguments.length?(n=hM(k),x):n},x.size=function(k){if(!arguments.length)return[u,f];var F=+k[0],V=+k[1];return F>=0&&V>=0||Object(Ce.o)("invalid size"),u=F,f=V,x},x.cellSize=function(k){return arguments.length?((k=+k)>=1||Object(Ce.o)("invalid cell size"),g=Math.floor(Math.log(k)/Math.LN2),x):1<<g},x.bandwidth=function(k){return arguments.length?((k=Object(Ce.i)(k)).length===1&&(k=[+k[0],+k[0]]),k.length!==2&&Object(Ce.o)("invalid bandwidth"),o=k,x):o},x}function Rw(e,t,n,o,u){const f=1+(u<<1);for(let g=0;g<t;++g)for(let x=0,k=0;x<e+u;++x)x<e&&(k+=n[x+g*e]),x>=u&&(x>=f&&(k-=n[x-f+g*e]),o[x-u+g*e]=k/Math.min(x+1,e-1+f-x,f))}function Pw(e,t,n,o,u){const f=1+(u<<1);for(let g=0;g<e;++g)for(let x=0,k=0;x<t+u;++x)x<t&&(k+=n[g+x*e]),x>=u&&(x>=f&&(k-=n[g+(x-f)*e]),o[g+(x-u)*e]=k/Math.min(x+1,t-1+f-x,f))}function pM(e){Mt.call(this,null,e)}dM.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},Object(Ce.z)(dM,Mt,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),o=t.materialize(t.SOURCE).source,u=e.field||Ce.y,f=kP().smooth(e.smooth!==!1),g=e.thresholds||function(F,V,X){const te=AP(X.levels||10,X.nice,X.zero!==!1);return X.resolve!=="shared"?te:te(F.map(ue=>Xn(V(ue).values)))}(o,u,e),x=e.as===null?null:e.as||"contour",k=[];return o.forEach(F=>{const V=u(F),X=f.size([V.width,V.height])(V.values,Object(Ce.B)(g)?g:g(V.values));(function(te,ue,he,be){let Pe=be.scale||ue.scale,Ue=be.translate||ue.translate;if(Object(Ce.E)(Pe)&&(Pe=Pe(he,be)),Object(Ce.E)(Ue)&&(Ue=Ue(he,be)),(Pe===1||Pe==null)&&!Ue)return;const We=(Object(Ce.G)(Pe)?Pe:Pe[0])||1,at=(Object(Ce.G)(Pe)?Pe:Pe[1])||1,st=Ue&&Ue[0]||0,dt=Ue&&Ue[1]||0;te.forEach(OP(ue,We,at,st,dt))})(X,V,F,e),X.forEach(te=>{k.push(or(F,Dt(x!=null?{[x]:te}:te)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=k,n}}),pM.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const Y$=["x","y","weight","size","cellSize","bandwidth"];function DP(e,t){return Y$.forEach(n=>t[n]!=null?e[n](t[n]):0),e}function mM(e){Mt.call(this,null,e)}Object(Ce.z)(pM,Mt,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,o=t.fork(t.NO_SOURCE|t.NO_FIELDS),u=function(k,F){var V,X,te,ue,he,be,Pe=[],Ue=We=>We(ue);if(F==null)Pe.push(k);else for(V={},X=0,te=k.length;X<te;++X)ue=k[X],he=F.map(Ue),(be=V[he])||(V[he]=be=[],be.dims=he,Pe.push(be)),be.push(ue);return Pe}(t.materialize(t.SOURCE).source,e.groupby),f=(e.groupby||[]).map(Ce.h),g=DP(MP(),e),x=e.as||"grid";return n=u.map(k=>Dt(function(F,V){for(let X=0;X<f.length;++X)F[f[X]]=V[X];return F}({[x]:g(k,e.counts)},k.dims))),this.value&&(o.rem=this.value),this.value=o.source=o.add=n,o}}),mM.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},Object(Ce.z)(mM,Mt,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,o,u=t.fork(t.NO_SOURCE|t.NO_FIELDS),f=kP().smooth(e.smooth!==!1),g=e.values,x=e.thresholds||AP(e.count||10,e.nice,!!g),k=e.size;return g||(g=t.materialize(t.SOURCE).source,o=OP(n=DP(MP(),e)(g,!0),n.scale||1,n.scale||1,0,0),k=[n.width,n.height],g=n.values),x=Object(Ce.B)(x)?x:x(g),g=f.size(k)(g,x),o&&g.forEach(o),this.value&&(u.rem=this.value),this.value=u.source=u.add=(g||[]).map(Dt),u}});const gM="Feature",vM="FeatureCollection";function yM(e){Mt.call(this,null,e)}function bM(e){Mt.call(this,null,e)}function xM(e){Mt.call(this,null,e)}function wM(e){Mt.call(this,null,e)}function _M(e){Mt.call(this,[],e),this.generator=G$()}function EM(e){Mt.call(this,null,e)}function NP(e){if(!Object(Ce.E)(e))return!1;const t=Object(Ce.Fa)(Object(Ce.g)(e));return t.$x||t.$y||t.$value||t.$max}function IP(e){Mt.call(this,null,e),this.modified(!0)}function FP(e,t,n){Object(Ce.E)(e[t])&&e[t](n)}yM.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},Object(Ce.z)(yM,Mt,{transform(e,t){var n,o=this._features,u=this._points,f=e.fields,g=f&&f[0],x=f&&f[1],k=e.geojson||!f&&Ce.y,F=t.ADD;n=e.modified()||t.changed(t.REM)||t.modified(Object(Ce.g)(k))||g&&t.modified(Object(Ce.g)(g))||x&&t.modified(Object(Ce.g)(x)),this.value&&!n||(F=t.SOURCE,this._features=o=[],this._points=u=[]),k&&t.visit(F,V=>o.push(k(V))),g&&x&&(t.visit(F,V=>{var X=g(V),te=x(V);X!=null&&te!=null&&(X=+X)===X&&(te=+te)===te&&u.push([X,te])}),o=o.concat({type:gM,geometry:{type:"MultiPoint",coordinates:u}})),this.value={type:vM,features:o}}}),bM.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},Object(Ce.z)(bM,Mt,{transform(e,t){var n=t.fork(t.ALL),o=this.value,u=e.field||Ce.y,f=e.as||"path",g=n.SOURCE;!o||e.modified()?(this.value=o=EP(e.projection),n.materialize().reflow()):g=u===Ce.y||t.modified(u.fields)?n.ADD_MOD:n.ADD;const x=function(k,F){const V=k.pointRadius();return k.context(null),F!=null&&k.pointRadius(F),V}(o,e.pointRadius);return n.visit(g,k=>k[f]=o(u(k))),o.pointRadius(x),n.modifies(f)}}),xM.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},Object(Ce.z)(xM,Mt,{transform(e,t){var n,o=e.projection,u=e.fields[0],f=e.fields[1],g=e.as||["x","y"],x=g[0],k=g[1];function F(V){const X=o([u(V),f(V)]);X?(V[x]=X[0],V[k]=X[1]):(V[x]=void 0,V[k]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,F):(n=t.modified(u.fields)||t.modified(f.fields),t.visit(n?t.ADD_MOD:t.ADD,F)),t.modifies(g)}}),wM.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},Object(Ce.z)(wM,Mt,{transform(e,t){var n=t.fork(t.ALL),o=this.value,u=e.as||"shape",f=n.ADD;return o&&!e.modified()||(this.value=o=function(g,x,k){const F=k==null?V=>g(x(V)):V=>{var X=g.pointRadius(),te=g.pointRadius(k)(x(V));return g.pointRadius(X),te};return F.context=V=>(g.context(V),F),F}(EP(e.projection),e.field||Object(Ce.u)("datum"),e.pointRadius),n.materialize().reflow(),f=n.SOURCE),n.visit(f,g=>g[u]=o),n.modifies(u)}}),_M.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},Object(Ce.z)(_M,Mt,{transform(e,t){var n,o=this.value,u=this.generator;if(!o.length||e.modified())for(const f in e)Object(Ce.E)(u[f])&&u[f](e[f]);return n=u(),o.length?t.mod.push(ar(o[0],n)):t.add.push(Dt(n)),o[0]=n,t}}),EM.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},Object(Ce.z)(EM,Mt,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,o=e.resolve==="shared",u=e.field||Ce.y,f=function(F,V){let X;return Object(Ce.E)(F)?(X=te=>F(te,V)).dep=NP(F):F?X=Object(Ce.m)(F):(X=te=>te.$value/te.$max||0).dep=!0,X}(e.opacity,e),g=function(F,V){let X;return Object(Ce.E)(F)?(X=te=>un(F(te,V))).dep=NP(F):X=Object(Ce.m)(un(F||"#888")),X}(e.color,e),x=e.as||"image",k={$x:0,$y:0,$value:0,$max:o?Xn(n.map(F=>Xn(u(F).values))):0};return n.forEach(F=>{const V=u(F),X=Object(Ce.p)({},F,k);o||(X.$max=Xn(V.values||[])),F[x]=function(te,ue,he,be){const Pe=te.width,Ue=te.height,We=te.x1||0,at=te.y1||0,st=te.x2||Pe,dt=te.y2||Ue,ct=te.values,kt=ct?$n=>ct[$n]:Ce.Ma,St=lu(st-We,dt-at),yn=St.getContext("2d"),Mn=yn.getImageData(0,0,st-We,dt-at),_n=Mn.data;for(let $n=at,qn=0;$n<dt;++$n){ue.$y=$n-at;for(let er=We,rr=$n*Pe;er<st;++er,qn+=4){ue.$x=er-We,ue.$value=kt(er+rr);const fr=he(ue);_n[qn+0]=fr.r,_n[qn+1]=fr.g,_n[qn+2]=fr.b,_n[qn+3]=~~(255*be(ue))}}return yn.putImageData(Mn,0,0),St}(V,X,g.dep?g:Object(Ce.m)(g(X)),f.dep?f:Object(Ce.m)(f(X)))}),t.reflow(!0).modifies(x)}}),Object(Ce.z)(IP,Mt,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=function(o){const u=fM((o||"mercator").toLowerCase());return u||Object(Ce.o)("Unrecognized projection type: "+o),u()}(e.type),lM.forEach(o=>{e[o]!=null&&FP(n,o,e[o])})):lM.forEach(o=>{e.modified(o)&&FP(n,o,e[o])}),e.pointRadius!=null&&n.path.pointRadius(e.pointRadius),e.fit&&function(o,u){const f=function(g){return(g=Object(Ce.i)(g)).length===1?g[0]:{type:vM,features:g.reduce((x,k)=>x.concat(function(F){return F.type===vM?F.features:Object(Ce.i)(F).filter(V=>V!=null).map(V=>V.type===gM?V:{type:gM,geometry:V})}(k)),[])}}(u.fit);u.extent?o.fitExtent(u.extent,f):u.size&&o.fitSize(u.size,f)}(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function RP(e,t,n,o){if(isNaN(t)||isNaN(n))return e;var u,f,g,x,k,F,V,X,te,ue=e._root,he={data:o},be=e._x0,Pe=e._y0,Ue=e._x1,We=e._y1;if(!ue)return e._root=he,e;for(;ue.length;)if((F=t>=(f=(be+Ue)/2))?be=f:Ue=f,(V=n>=(g=(Pe+We)/2))?Pe=g:We=g,u=ue,!(ue=ue[X=V<<1|F]))return u[X]=he,e;if(x=+e._x.call(null,ue.data),k=+e._y.call(null,ue.data),t===x&&n===k)return he.next=ue,u?u[X]=he:e._root=he,e;do u=u?u[X]=new Array(4):e._root=new Array(4),(F=t>=(f=(be+Ue)/2))?be=f:Ue=f,(V=n>=(g=(Pe+We)/2))?Pe=g:We=g;while((X=V<<1|F)==(te=(k>=g)<<1|x>=f));return u[te]=ue,u[X]=he,e}var ah=function(e,t,n,o,u){this.node=e,this.x0=t,this.y0=n,this.x1=o,this.y1=u};function J$(e){return e[0]}function Q$(e){return e[1]}function SM(e,t,n){var o=new CM(t??J$,n??Q$,NaN,NaN,NaN,NaN);return e==null?o:o.addAll(e)}function CM(e,t,n,o,u,f){this._x=e,this._y=t,this._x0=n,this._y0=o,this._x1=u,this._y1=f,this._root=void 0}function PP(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var sh=SM.prototype=CM.prototype;sh.copy=function(){var e,t,n=new CM(this._x,this._y,this._x0,this._y0,this._x1,this._y1),o=this._root;if(!o)return n;if(!o.length)return n._root=PP(o),n;for(e=[{source:o,target:n._root=new Array(4)}];o=e.pop();)for(var u=0;u<4;++u)(t=o.source[u])&&(t.length?e.push({source:t,target:o.target[u]=new Array(4)}):o.target[u]=PP(t));return n},sh.add=function(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return RP(this.cover(t,n),t,n,e)},sh.addAll=function(e){var t,n,o,u,f=e.length,g=new Array(f),x=new Array(f),k=1/0,F=1/0,V=-1/0,X=-1/0;for(n=0;n<f;++n)isNaN(o=+this._x.call(null,t=e[n]))||isNaN(u=+this._y.call(null,t))||(g[n]=o,x[n]=u,o<k&&(k=o),o>V&&(V=o),u<F&&(F=u),u>X&&(X=u));if(k>V||F>X)return this;for(this.cover(k,F).cover(V,X),n=0;n<f;++n)RP(this,g[n],x[n],e[n]);return this},sh.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,o=this._y0,u=this._x1,f=this._y1;if(isNaN(n))u=(n=Math.floor(e))+1,f=(o=Math.floor(t))+1;else{for(var g,x,k=u-n||1,F=this._root;n>e||e>=u||o>t||t>=f;)switch(x=(t<o)<<1|e<n,(g=new Array(4))[x]=F,F=g,k*=2,x){case 0:u=n+k,f=o+k;break;case 1:n=u-k,f=o+k;break;case 2:u=n+k,o=f-k;break;case 3:n=u-k,o=f-k}this._root&&this._root.length&&(this._root=F)}return this._x0=n,this._y0=o,this._x1=u,this._y1=f,this},sh.data=function(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e},sh.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},sh.find=function(e,t,n){var o,u,f,g,x,k,F,V=this._x0,X=this._y0,te=this._x1,ue=this._y1,he=[],be=this._root;for(be&&he.push(new ah(be,V,X,te,ue)),n==null?n=1/0:(V=e-n,X=t-n,te=e+n,ue=t+n,n*=n);k=he.pop();)if(!(!(be=k.node)||(u=k.x0)>te||(f=k.y0)>ue||(g=k.x1)<V||(x=k.y1)<X))if(be.length){var Pe=(u+g)/2,Ue=(f+x)/2;he.push(new ah(be[3],Pe,Ue,g,x),new ah(be[2],u,Ue,Pe,x),new ah(be[1],Pe,f,g,Ue),new ah(be[0],u,f,Pe,Ue)),(F=(t>=Ue)<<1|e>=Pe)&&(k=he[he.length-1],he[he.length-1]=he[he.length-1-F],he[he.length-1-F]=k)}else{var We=e-+this._x.call(null,be.data),at=t-+this._y.call(null,be.data),st=We*We+at*at;if(st<n){var dt=Math.sqrt(n=st);V=e-dt,X=t-dt,te=e+dt,ue=t+dt,o=be.data}}return o},sh.remove=function(e){if(isNaN(f=+this._x.call(null,e))||isNaN(g=+this._y.call(null,e)))return this;var t,n,o,u,f,g,x,k,F,V,X,te,ue=this._root,he=this._x0,be=this._y0,Pe=this._x1,Ue=this._y1;if(!ue)return this;if(ue.length)for(;;){if((F=f>=(x=(he+Pe)/2))?he=x:Pe=x,(V=g>=(k=(be+Ue)/2))?be=k:Ue=k,t=ue,!(ue=ue[X=V<<1|F]))return this;if(!ue.length)break;(t[X+1&3]||t[X+2&3]||t[X+3&3])&&(n=t,te=X)}for(;ue.data!==e;)if(o=ue,!(ue=ue.next))return this;return(u=ue.next)&&delete ue.next,o?(u?o.next=u:delete o.next,this):t?(u?t[X]=u:delete t[X],(ue=t[0]||t[1]||t[2]||t[3])&&ue===(t[3]||t[2]||t[1]||t[0])&&!ue.length&&(n?n[te]=ue:this._root=ue),this):(this._root=u,this)},sh.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},sh.root=function(){return this._root},sh.size=function(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e},sh.visit=function(e){var t,n,o,u,f,g,x=[],k=this._root;for(k&&x.push(new ah(k,this._x0,this._y0,this._x1,this._y1));t=x.pop();)if(!e(k=t.node,o=t.x0,u=t.y0,f=t.x1,g=t.y1)&&k.length){var F=(o+f)/2,V=(u+g)/2;(n=k[3])&&x.push(new ah(n,F,V,f,g)),(n=k[2])&&x.push(new ah(n,o,V,F,g)),(n=k[1])&&x.push(new ah(n,F,u,f,V)),(n=k[0])&&x.push(new ah(n,o,u,F,V))}return this},sh.visitAfter=function(e){var t,n=[],o=[];for(this._root&&n.push(new ah(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var u=t.node;if(u.length){var f,g=t.x0,x=t.y0,k=t.x1,F=t.y1,V=(g+k)/2,X=(x+F)/2;(f=u[0])&&n.push(new ah(f,g,x,V,X)),(f=u[1])&&n.push(new ah(f,V,x,k,X)),(f=u[2])&&n.push(new ah(f,g,X,V,F)),(f=u[3])&&n.push(new ah(f,V,X,k,F))}o.push(t)}for(;t=o.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},sh.x=function(e){return arguments.length?(this._x=e,this):this._x},sh.y=function(e){return arguments.length?(this._y=e,this):this._y};var uh=function(e){return function(){return e}},Z1=function(e){return 1e-6*(e()-.5)};function Z$(e){return e.x+e.vx}function eX(e){return e.y+e.vy}var tX={value:()=>{}};function LP(){for(var e,t=0,n=arguments.length,o={};t<n;++t){if(!(e=arguments[t]+"")||e in o||/[\s.]/.test(e))throw new Error("illegal type: "+e);o[e]=[]}return new ek(o)}function ek(e){this._=e}function nX(e,t){for(var n,o=0,u=e.length;o<u;++o)if((n=e[o]).name===t)return n.value}function BP(e,t,n){for(var o=0,u=e.length;o<u;++o)if(e[o].name===t){e[o]=tX,e=e.slice(0,o).concat(e.slice(o+1));break}return n!=null&&e.push({name:t,value:n}),e}ek.prototype=LP.prototype={constructor:ek,on:function(e,t){var n,o=this._,u=function(x,k){return x.trim().split(/^|\s+/).map(function(F){var V="",X=F.indexOf(".");if(X>=0&&(V=F.slice(X+1),F=F.slice(0,X)),F&&!k.hasOwnProperty(F))throw new Error("unknown type: "+F);return{type:F,name:V}})}(e+"",o),f=-1,g=u.length;if(!(arguments.length<2)){if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++f<g;)if(n=(e=u[f]).type)o[n]=BP(o[n],e.name,t);else if(t==null)for(n in o)o[n]=BP(o[n],e.name,null);return this}for(;++f<g;)if((n=(e=u[f]).type)&&(n=nX(o[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new ek(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,o,u=new Array(n),f=0;f<n;++f)u[f]=arguments[f+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(f=0,n=(o=this._[e]).length;f<n;++f)o[f].value.apply(t,u)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var o=this._[e],u=0,f=o.length;u<f;++u)o[u].value.apply(t,n)}};var tk,I_,rX=LP,Lw=0,F_=0,R_=0,jP=1e3,nk=0,ux=0,rk=0,P_=typeof performance=="object"&&performance.now?performance:Date,zP=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function kM(){return ux||(zP(iX),ux=P_.now()+rk)}function iX(){ux=0}function ik(){this._call=this._time=this._next=null}function UP(e,t,n){var o=new ik;return o.restart(e,t,n),o}function WP(){ux=(nk=P_.now())+rk,Lw=F_=0;try{(function(){kM(),++Lw;for(var e,t=tk;t;)(e=ux-t._time)>=0&&t._call.call(null,e),t=t._next;--Lw})()}finally{Lw=0,function(){for(var e,t,n=tk,o=1/0;n;)n._call?(o>n._time&&(o=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:tk=t);I_=e,AM(o)}(),ux=0}}function oX(){var e=P_.now(),t=e-nk;t>jP&&(rk-=t,nk=e)}function AM(e){Lw||(F_&&(F_=clearTimeout(F_)),e-ux>24?(e<1/0&&(F_=setTimeout(WP,e-P_.now()-rk)),R_&&(R_=clearInterval(R_))):(R_||(nk=P_.now(),R_=setInterval(oX,jP)),Lw=1,zP(WP)))}ik.prototype=UP.prototype={constructor:ik,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?kM():+n)+(t==null?0:+t),this._next||I_===this||(I_?I_._next=this:tk=this,I_=this),this._call=e,this._time=n,AM()},stop:function(){this._call&&(this._call=null,this._time=1/0,AM())}};function aX(e){return e.x}function sX(e){return e.y}var uX=10,cX=Math.PI*(3-Math.sqrt(5)),lX=function(e){var t,n=1,o=.001,u=1-Math.pow(o,1/300),f=0,g=.6,x=new Map,k=UP(X),F=rX("tick","end"),V=function(){let be=1;return()=>(be=(1664525*be+1013904223)%4294967296)/4294967296}();function X(){te(),F.call("tick",t),n<o&&(k.stop(),F.call("end",t))}function te(be){var Pe,Ue,We=e.length;be===void 0&&(be=1);for(var at=0;at<be;++at)for(n+=(f-n)*u,x.forEach(function(st){st(n)}),Pe=0;Pe<We;++Pe)(Ue=e[Pe]).fx==null?Ue.x+=Ue.vx*=g:(Ue.x=Ue.fx,Ue.vx=0),Ue.fy==null?Ue.y+=Ue.vy*=g:(Ue.y=Ue.fy,Ue.vy=0);return t}function ue(){for(var be,Pe=0,Ue=e.length;Pe<Ue;++Pe){if((be=e[Pe]).index=Pe,be.fx!=null&&(be.x=be.fx),be.fy!=null&&(be.y=be.fy),isNaN(be.x)||isNaN(be.y)){var We=uX*Math.sqrt(.5+Pe),at=Pe*cX;be.x=We*Math.cos(at),be.y=We*Math.sin(at)}(isNaN(be.vx)||isNaN(be.vy))&&(be.vx=be.vy=0)}}function he(be){return be.initialize&&be.initialize(e,V),be}return e==null&&(e=[]),ue(),t={tick:te,restart:function(){return k.restart(X),t},stop:function(){return k.stop(),t},nodes:function(be){return arguments.length?(e=be,ue(),x.forEach(he),t):e},alpha:function(be){return arguments.length?(n=+be,t):n},alphaMin:function(be){return arguments.length?(o=+be,t):o},alphaDecay:function(be){return arguments.length?(u=+be,t):+u},alphaTarget:function(be){return arguments.length?(f=+be,t):f},velocityDecay:function(be){return arguments.length?(g=1-be,t):1-g},randomSource:function(be){return arguments.length?(V=be,x.forEach(he),t):V},force:function(be,Pe){return arguments.length>1?(Pe==null?x.delete(be):x.set(be,he(Pe)),t):x.get(be)},find:function(be,Pe,Ue){var We,at,st,dt,ct,kt=0,St=e.length;for(Ue==null?Ue=1/0:Ue*=Ue,kt=0;kt<St;++kt)(st=(We=be-(dt=e[kt]).x)*We+(at=Pe-dt.y)*at)<Ue&&(ct=dt,Ue=st);return ct},on:function(be,Pe){return arguments.length>1?(F.on(be,Pe),t):F.on(be)}}};function fX(e){return e.index}function VP(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}const HP={center:function(e,t){var n,o=1;function u(){var f,g,x=n.length,k=0,F=0;for(f=0;f<x;++f)k+=(g=n[f]).x,F+=g.y;for(k=(k/x-e)*o,F=(F/x-t)*o,f=0;f<x;++f)(g=n[f]).x-=k,g.y-=F}return e==null&&(e=0),t==null&&(t=0),u.initialize=function(f){n=f},u.x=function(f){return arguments.length?(e=+f,u):e},u.y=function(f){return arguments.length?(t=+f,u):t},u.strength=function(f){return arguments.length?(o=+f,u):o},u},collide:function(e){var t,n,o,u=1,f=1;function g(){for(var F,V,X,te,ue,he,be,Pe=t.length,Ue=0;Ue<f;++Ue)for(V=SM(t,Z$,eX).visitAfter(x),F=0;F<Pe;++F)X=t[F],he=n[X.index],be=he*he,te=X.x+X.vx,ue=X.y+X.vy,V.visit(We);function We(at,st,dt,ct,kt){var St=at.data,yn=at.r,Mn=he+yn;if(!St)return st>te+Mn||ct<te-Mn||dt>ue+Mn||kt<ue-Mn;if(St.index>X.index){var _n=te-St.x-St.vx,$n=ue-St.y-St.vy,qn=_n*_n+$n*$n;qn<Mn*Mn&&(_n===0&&(qn+=(_n=Z1(o))*_n),$n===0&&(qn+=($n=Z1(o))*$n),qn=(Mn-(qn=Math.sqrt(qn)))/qn*u,X.vx+=(_n*=qn)*(Mn=(yn*=yn)/(be+yn)),X.vy+=($n*=qn)*Mn,St.vx-=_n*(Mn=1-Mn),St.vy-=$n*Mn)}}}function x(F){if(F.data)return F.r=n[F.data.index];for(var V=F.r=0;V<4;++V)F[V]&&F[V].r>F.r&&(F.r=F[V].r)}function k(){if(t){var F,V,X=t.length;for(n=new Array(X),F=0;F<X;++F)V=t[F],n[V.index]=+e(V,F,t)}}return typeof e!="function"&&(e=uh(e==null?1:+e)),g.initialize=function(F,V){t=F,o=V,k()},g.iterations=function(F){return arguments.length?(f=+F,g):f},g.strength=function(F){return arguments.length?(u=+F,g):u},g.radius=function(F){return arguments.length?(e=typeof F=="function"?F:uh(+F),k(),g):e},g},nbody:function(){var e,t,n,o,u,f=uh(-30),g=1,x=1/0,k=.81;function F(ue){var he,be=e.length,Pe=SM(e,aX,sX).visitAfter(X);for(o=ue,he=0;he<be;++he)t=e[he],Pe.visit(te)}function V(){if(e){var ue,he,be=e.length;for(u=new Array(be),ue=0;ue<be;++ue)he=e[ue],u[he.index]=+f(he,ue,e)}}function X(ue){var he,be,Pe,Ue,We,at=0,st=0;if(ue.length){for(Pe=Ue=We=0;We<4;++We)(he=ue[We])&&(be=Math.abs(he.value))&&(at+=he.value,st+=be,Pe+=be*he.x,Ue+=be*he.y);ue.x=Pe/st,ue.y=Ue/st}else{(he=ue).x=he.data.x,he.y=he.data.y;do at+=u[he.data.index];while(he=he.next)}ue.value=at}function te(ue,he,be,Pe){if(!ue.value)return!0;var Ue=ue.x-t.x,We=ue.y-t.y,at=Pe-he,st=Ue*Ue+We*We;if(at*at/k<st)return st<x&&(Ue===0&&(st+=(Ue=Z1(n))*Ue),We===0&&(st+=(We=Z1(n))*We),st<g&&(st=Math.sqrt(g*st)),t.vx+=Ue*ue.value*o/st,t.vy+=We*ue.value*o/st),!0;if(!(ue.length||st>=x)){(ue.data!==t||ue.next)&&(Ue===0&&(st+=(Ue=Z1(n))*Ue),We===0&&(st+=(We=Z1(n))*We),st<g&&(st=Math.sqrt(g*st)));do ue.data!==t&&(at=u[ue.data.index]*o/st,t.vx+=Ue*at,t.vy+=We*at);while(ue=ue.next)}}return F.initialize=function(ue,he){e=ue,n=he,V()},F.strength=function(ue){return arguments.length?(f=typeof ue=="function"?ue:uh(+ue),V(),F):f},F.distanceMin=function(ue){return arguments.length?(g=ue*ue,F):Math.sqrt(g)},F.distanceMax=function(ue){return arguments.length?(x=ue*ue,F):Math.sqrt(x)},F.theta=function(ue){return arguments.length?(k=ue*ue,F):Math.sqrt(k)},F},link:function(e){var t,n,o,u,f,g,x=fX,k=function(be){return 1/Math.min(u[be.source.index],u[be.target.index])},F=uh(30),V=1;function X(be){for(var Pe=0,Ue=e.length;Pe<V;++Pe)for(var We,at,st,dt,ct,kt,St,yn=0;yn<Ue;++yn)at=(We=e[yn]).source,dt=(st=We.target).x+st.vx-at.x-at.vx||Z1(g),ct=st.y+st.vy-at.y-at.vy||Z1(g),dt*=kt=((kt=Math.sqrt(dt*dt+ct*ct))-n[yn])/kt*be*t[yn],ct*=kt,st.vx-=dt*(St=f[yn]),st.vy-=ct*St,at.vx+=dt*(St=1-St),at.vy+=ct*St}function te(){if(o){var be,Pe,Ue=o.length,We=e.length,at=new Map(o.map((st,dt)=>[x(st,dt,o),st]));for(be=0,u=new Array(Ue);be<We;++be)(Pe=e[be]).index=be,typeof Pe.source!="object"&&(Pe.source=VP(at,Pe.source)),typeof Pe.target!="object"&&(Pe.target=VP(at,Pe.target)),u[Pe.source.index]=(u[Pe.source.index]||0)+1,u[Pe.target.index]=(u[Pe.target.index]||0)+1;for(be=0,f=new Array(We);be<We;++be)Pe=e[be],f[be]=u[Pe.source.index]/(u[Pe.source.index]+u[Pe.target.index]);t=new Array(We),ue(),n=new Array(We),he()}}function ue(){if(o)for(var be=0,Pe=e.length;be<Pe;++be)t[be]=+k(e[be],be,e)}function he(){if(o)for(var be=0,Pe=e.length;be<Pe;++be)n[be]=+F(e[be],be,e)}return e==null&&(e=[]),X.initialize=function(be,Pe){o=be,g=Pe,te()},X.links=function(be){return arguments.length?(e=be,te(),X):e},X.id=function(be){return arguments.length?(x=be,X):x},X.iterations=function(be){return arguments.length?(V=+be,X):V},X.strength=function(be){return arguments.length?(k=typeof be=="function"?be:uh(+be),ue(),X):k},X.distance=function(be){return arguments.length?(F=typeof be=="function"?be:uh(+be),he(),X):F},X},x:function(e){var t,n,o,u=uh(.1);function f(x){for(var k,F=0,V=t.length;F<V;++F)(k=t[F]).vx+=(o[F]-k.x)*n[F]*x}function g(){if(t){var x,k=t.length;for(n=new Array(k),o=new Array(k),x=0;x<k;++x)n[x]=isNaN(o[x]=+e(t[x],x,t))?0:+u(t[x],x,t)}}return typeof e!="function"&&(e=uh(e==null?0:+e)),f.initialize=function(x){t=x,g()},f.strength=function(x){return arguments.length?(u=typeof x=="function"?x:uh(+x),g(),f):u},f.x=function(x){return arguments.length?(e=typeof x=="function"?x:uh(+x),g(),f):e},f},y:function(e){var t,n,o,u=uh(.1);function f(x){for(var k,F=0,V=t.length;F<V;++F)(k=t[F]).vy+=(o[F]-k.y)*n[F]*x}function g(){if(t){var x,k=t.length;for(n=new Array(k),o=new Array(k),x=0;x<k;++x)n[x]=isNaN(o[x]=+e(t[x],x,t))?0:+u(t[x],x,t)}}return typeof e!="function"&&(e=uh(e==null?0:+e)),f.initialize=function(x){t=x,g()},f.strength=function(x){return arguments.length?(u=typeof x=="function"?x:uh(+x),g(),f):u},f.y=function(x){return arguments.length?(e=typeof x=="function"?x:uh(+x),g(),f):e},f}},L_="forces",OM=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],dX=["static","iterations"],GP=["x","y","vx","vy"];function TM(e){Mt.call(this,null,e)}function qP(e,t,n,o){var u,f,g,x,k=Object(Ce.i)(t.forces);for(u=0,f=OM.length;u<f;++u)(g=OM[u])!==L_&&t.modified(g)&&e[g](t[g]);for(u=0,f=k.length;u<f;++u)x=L_+u,(g=n||t.modified(L_,u)?pX(k[u]):o&&hX(k[u],o)?e.force(x):null)&&e.force(x,g);for(f=e.numForces||0;u<f;++u)e.force(L_+u,null);return e.numForces=k.length,e}function hX(e,t){var n,o;for(n in e)if(Object(Ce.E)(o=e[n])&&t.modified(Object(Ce.g)(o)))return 1;return 0}function pX(e){var t,n;for(n in Object(Ce.w)(HP,e.force)||Object(Ce.o)("Unrecognized force: "+e.force),t=HP[e.force](),e)Object(Ce.E)(t[n])&&mX(t[n],e[n],e);return t}function mX(e,t,n){e(Object(Ce.E)(t)?o=>t(o,n):t)}function gX(e){var t=0,n=e.children,o=n&&n.length;if(o)for(;--o>=0;)t+=n[o].value;else t=1;e.value=t}TM.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:GP}]},Object(Ce.z)(TM,Mt,{transform(e,t){var n=this.value,o=t.changed(t.ADD_REM),u=e.modified(OM),f=e.iterations||300;if(n?(o&&(t.modifies("index"),n.nodes(t.source)),(u||t.changed(t.MOD))&&qP(n,e,0,t)):(this.value=n=function(g,x){const k=lX(g),F=k.stop,V=k.restart;let X=!1;return k.stopped=()=>X,k.restart=()=>(X=!1,V()),k.stop=()=>(X=!0,F()),qP(k,x,!0).on("end",()=>X=!0)}(t.source,e),n.on("tick",function(g,x){return()=>g.touch(x).run()}(t.dataflow,this)),e.static||(o=!0,n.tick()),t.modifies("index")),u||o||e.modified(dX)||t.changed()&&e.restart){if(n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/f)),e.static)for(n.stop();--f>=0;)n.tick();else if(n.stopped()&&n.restart(),!o)return t.StopPropagation}return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let x,k=this._argops,F=0,V=k.length;F<V;++F)if((x=k[F]).name===L_&&x.op._argval.force==="link"){for(var o,u=x.op._argops,f=0,g=u.length;f<g;++f)if(u[f].name==="links"&&(o=u[f].op.source)){n.pulse(o,n.changeset().reflow());break}}return t.reflow(e.modified()).modifies(GP)}});function MM(e,t){e instanceof Map?(e=[void 0,e],t===void 0&&(t=yX)):t===void 0&&(t=vX);for(var n,o,u,f,g,x=new Bw(e),k=[x];n=k.pop();)if((u=t(n.data))&&(g=(u=Array.from(u)).length))for(n.children=u,f=g-1;f>=0;--f)k.push(o=u[f]=new Bw(u[f])),o.parent=n,o.depth=n.depth+1;return x.eachBefore($P)}function vX(e){return e.children}function yX(e){return Array.isArray(e)?e[1]:null}function bX(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function $P(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function Bw(e){this.data=e,this.depth=this.height=0,this.parent=null}Bw.prototype=MM.prototype={constructor:Bw,count:function(){return this.eachAfter(gX)},each:function(e,t){let n=-1;for(const o of this)e.call(t,o,++n,this);return this},eachAfter:function(e,t){for(var n,o,u,f=this,g=[f],x=[],k=-1;f=g.pop();)if(x.push(f),n=f.children)for(o=0,u=n.length;o<u;++o)g.push(n[o]);for(;f=x.pop();)e.call(t,f,++k,this);return this},eachBefore:function(e,t){for(var n,o,u=this,f=[u],g=-1;u=f.pop();)if(e.call(t,u,++g,this),n=u.children)for(o=n.length-1;o>=0;--o)f.push(n[o]);return this},find:function(e,t){let n=-1;for(const o of this)if(e.call(t,o,++n,this))return o},sum:function(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,o=t.children,u=o&&o.length;--u>=0;)n+=o[u].value;t.value=n})},sort:function(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})},path:function(e){for(var t=this,n=function(f,g){if(f===g)return f;var x=f.ancestors(),k=g.ancestors(),F=null;for(f=x.pop(),g=k.pop();f===g;)F=f,f=x.pop(),g=k.pop();return F}(t,e),o=[t];t!==n;)t=t.parent,o.push(t);for(var u=o.length;e!==n;)o.splice(u,0,e),e=e.parent;return o},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e},links:function(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t},copy:function(){return MM(this).eachBefore(bX)},[Symbol.iterator]:function*(){var e,t,n,o,u=this,f=[u];do for(e=f.reverse(),f=[];u=e.pop();)if(yield u,t=u.children)for(n=0,o=t.length;n<o;++n)f.push(t[n]);while(f.length)}};var xX=function(e){return typeof e=="object"&&"length"in e?e:Array.from(e)},wX=function(e){for(var t,n,o=0,u=(e=function(g){for(var x,k,F=g.length;F;)k=Math.random()*F--|0,x=g[F],g[F]=g[k],g[k]=x;return g}(Array.from(e))).length,f=[];o<u;)t=e[o],n&&XP(n,t)?++o:(n=EX(f=_X(f,t)),o=0);return n};function _X(e,t){var n,o;if(DM(t,e))return[t];for(n=0;n<e.length;++n)if(ok(t,e[n])&&DM(B_(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(o=n+1;o<e.length;++o)if(ok(B_(e[n],e[o]),t)&&ok(B_(e[n],t),e[o])&&ok(B_(e[o],t),e[n])&&DM(KP(e[n],e[o],t),e))return[e[n],e[o],t];throw new Error}function ok(e,t){var n=e.r-t.r,o=t.x-e.x,u=t.y-e.y;return n<0||n*n<o*o+u*u}function XP(e,t){var n=e.r-t.r+1e-9*Math.max(e.r,t.r,1),o=t.x-e.x,u=t.y-e.y;return n>0&&n*n>o*o+u*u}function DM(e,t){for(var n=0;n<t.length;++n)if(!XP(e,t[n]))return!1;return!0}function EX(e){switch(e.length){case 1:return function(t){return{x:t.x,y:t.y,r:t.r}}(e[0]);case 2:return B_(e[0],e[1]);case 3:return KP(e[0],e[1],e[2])}}function B_(e,t){var n=e.x,o=e.y,u=e.r,f=t.x,g=t.y,x=t.r,k=f-n,F=g-o,V=x-u,X=Math.sqrt(k*k+F*F);return{x:(n+f+k/X*V)/2,y:(o+g+F/X*V)/2,r:(X+u+x)/2}}function KP(e,t,n){var o=e.x,u=e.y,f=e.r,g=t.x,x=t.y,k=t.r,F=n.x,V=n.y,X=n.r,te=o-g,ue=o-F,he=u-x,be=u-V,Pe=k-f,Ue=X-f,We=o*o+u*u-f*f,at=We-g*g-x*x+k*k,st=We-F*F-V*V+X*X,dt=ue*he-te*be,ct=(he*st-be*at)/(2*dt)-o,kt=(be*Pe-he*Ue)/dt,St=(ue*at-te*st)/(2*dt)-u,yn=(te*Ue-ue*Pe)/dt,Mn=kt*kt+yn*yn-1,_n=2*(f+ct*kt+St*yn),$n=ct*ct+St*St-f*f,qn=-(Mn?(_n+Math.sqrt(_n*_n-4*Mn*$n))/(2*Mn):$n/_n);return{x:o+ct+kt*qn,y:u+St+yn*qn,r:qn}}function YP(e,t,n){var o,u,f,g,x=e.x-t.x,k=e.y-t.y,F=x*x+k*k;F?(u=t.r+n.r,u*=u,g=e.r+n.r,u>(g*=g)?(o=(F+g-u)/(2*F),f=Math.sqrt(Math.max(0,g/F-o*o)),n.x=e.x-o*x-f*k,n.y=e.y-o*k+f*x):(o=(F+u-g)/(2*F),f=Math.sqrt(Math.max(0,u/F-o*o)),n.x=t.x+o*x-f*k,n.y=t.y+o*k+f*x)):(n.x=t.x+n.r,n.y=t.y)}function JP(e,t){var n=e.r+t.r-1e-6,o=t.x-e.x,u=t.y-e.y;return n>0&&n*n>o*o+u*u}function QP(e){var t=e._,n=e.next._,o=t.r+n.r,u=(t.x*n.r+n.x*t.r)/o,f=(t.y*n.r+n.y*t.r)/o;return u*u+f*f}function ak(e){this._=e,this.next=null,this.previous=null}function SX(e){if(!(u=(e=xX(e)).length))return 0;var t,n,o,u,f,g,x,k,F,V,X;if((t=e[0]).x=0,t.y=0,!(u>1))return t.r;if(n=e[1],t.x=-n.r,n.x=t.r,n.y=0,!(u>2))return t.r+n.r;YP(n,t,o=e[2]),t=new ak(t),n=new ak(n),o=new ak(o),t.next=o.previous=n,n.next=t.previous=o,o.next=n.previous=t;e:for(x=3;x<u;++x){YP(t._,n._,o=e[x]),o=new ak(o),k=n.next,F=t.previous,V=n._.r,X=t._.r;do if(V<=X){if(JP(k._,o._)){n=k,t.next=n,n.previous=t,--x;continue e}V+=k._.r,k=k.next}else{if(JP(F._,o._)){(t=F).next=n,n.previous=t,--x;continue e}X+=F._.r,F=F.previous}while(k!==F.next);for(o.previous=t,o.next=n,t.next=n.previous=n=o,f=QP(t);(o=o.next)!==n;)(g=QP(o))<f&&(t=o,f=g);n=t.next}for(t=[n._],o=n;(o=o.next)!==n;)t.push(o._);for(o=wX(t),x=0;x<u;++x)(t=e[x]).x-=o.x,t.y-=o.y;return o.r}function sk(e){if(typeof e!="function")throw new Error;return e}function cx(){return 0}var jw=function(e){return function(){return e}};function CX(e){return Math.sqrt(e.value)}function ZP(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function NM(e,t){return function(n){if(o=n.children){var o,u,f,g=o.length,x=e(n)*t||0;if(x)for(u=0;u<g;++u)o[u].r+=x;if(f=SX(o),x)for(u=0;u<g;++u)o[u].r-=x;n.r=f+x}}}function eL(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}var tL=function(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)},j_=function(e,t,n,o,u){for(var f,g=e.children,x=-1,k=g.length,F=e.value&&(o-t)/e.value;++x<k;)(f=g[x]).y0=n,f.y1=u,f.x0=t,f.x1=t+=f.value*F},kX={depth:-1},nL={};function AX(e){return e.id}function OX(e){return e.parentId}var rL=function(){var e=AX,t=OX;function n(o){var u,f,g,x,k,F,V,X=Array.from(o),te=X.length,ue=new Map;for(f=0;f<te;++f)u=X[f],k=X[f]=new Bw(u),(F=e(u,f,o))!=null&&(F+="")&&(V=k.id=F,ue.set(V,ue.has(V)?nL:k)),(F=t(u,f,o))!=null&&(F+="")&&(k.parent=F);for(f=0;f<te;++f)if(F=(k=X[f]).parent){if(!(x=ue.get(F)))throw new Error("missing: "+F);if(x===nL)throw new Error("ambiguous: "+F);x.children?x.children.push(k):x.children=[k],k.parent=x}else{if(g)throw new Error("multiple roots");g=k}if(!g)throw new Error("no root");if(g.parent=kX,g.eachBefore(function(he){he.depth=he.parent.depth+1,--te}).eachBefore($P),g.parent=null,te>0)throw new Error("cycle");return g}return n.id=function(o){return arguments.length?(e=sk(o),n):e},n.parentId=function(o){return arguments.length?(t=sk(o),n):t},n};function TX(e,t){return e.parent===t.parent?1:2}function IM(e){var t=e.children;return t?t[0]:e.t}function FM(e){var t=e.children;return t?t[t.length-1]:e.t}function MX(e,t,n){var o=n/(t.i-e.i);t.c-=o,t.s+=n,e.c+=o,t.z+=n,t.m+=n}function DX(e,t,n){return e.a.parent===t.parent?e.a:n}function uk(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}uk.prototype=Object.create(Bw.prototype);function NX(e,t){return e.parent===t.parent?1:2}function IX(e,t){return e+t.x}function FX(e,t){return Math.max(e,t.y)}var ck=function(e,t,n,o,u){for(var f,g=e.children,x=-1,k=g.length,F=e.value&&(u-n)/e.value;++x<k;)(f=g[x]).x0=t,f.x1=o,f.y0=n,f.y1=n+=f.value*F},iL=(1+Math.sqrt(5))/2;function oL(e,t,n,o,u,f){for(var g,x,k,F,V,X,te,ue,he,be,Pe,Ue=[],We=t.children,at=0,st=0,dt=We.length,ct=t.value;at<dt;){k=u-n,F=f-o;do V=We[st++].value;while(!V&&st<dt);for(X=te=V,Pe=V*V*(be=Math.max(F/k,k/F)/(ct*e)),he=Math.max(te/Pe,Pe/X);st<dt;++st){if(V+=x=We[st].value,x<X&&(X=x),x>te&&(te=x),Pe=V*V*be,(ue=Math.max(te/Pe,Pe/X))>he){V-=x;break}he=ue}Ue.push(g={value:V,dice:k<F,children:We.slice(at,st)}),g.dice?j_(g,n,o,u,ct?o+=F*V/ct:f):ck(g,n,o,ct?n+=k*V/ct:u,f),ct-=V,at=st}return Ue}var aL=function e(t){function n(o,u,f,g,x){oL(t,o,u,f,g,x)}return n.ratio=function(o){return e((o=+o)>1?o:1)},n}(iL),RX=function e(t){function n(o,u,f,g,x){if((k=o._squarify)&&k.ratio===t)for(var k,F,V,X,te,ue=-1,he=k.length,be=o.value;++ue<he;){for(V=(F=k[ue]).children,X=F.value=0,te=V.length;X<te;++X)F.value+=V[X].value;F.dice?j_(F,u,f,g,be?f+=(x-f)*F.value/be:x):ck(F,u,f,be?u+=(g-u)*F.value/be:g,x),be-=F.value}else o._squarify=k=oL(t,o,u,f,g,x),k.ratio=t}return n.ratio=function(o){return e((o=+o)>1?o:1)},n}(iL);function RM(e,t,n){const o={};return e.each(u=>{const f=u.data;n(f)&&(o[t(f)]=u)}),e.lookup=o,e}function PM(e){Mt.call(this,null,e)}PM.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const PX=e=>e.values;function $y(e){Mt.call(this,null,e)}Object(Ce.z)(PM,Mt,{transform(e,t){t.source||Object(Ce.o)("Nest transform requires an upstream data source.");var n=e.generate,o=e.modified(),u=t.clone(),f=this.value;return(!f||o||t.changed())&&(f&&f.each(g=>{g.children&&Vt(g.data)&&u.rem.push(g.data)}),this.value=f=MM({values:Object(Ce.i)(e.keys).reduce((g,x)=>(g.key(x),g),function(){const g=[],x={entries:k=>function F(V,X){if(++X>g.length)return V;const te=[];for(const ue in V)te.push({key:ue,values:F(V[ue],X)});return te}(function F(V,X){if(X>=g.length)return V;const te=V.length,ue=g[X++],he={},be={};let Pe,Ue,We,at=-1;for(;++at<te;)Pe=ue(Ue=V[at])+"",(We=he[Pe])?We.push(Ue):he[Pe]=[Ue];for(Pe in he)be[Pe]=F(he[Pe],X);return be}(k,0),0),key:k=>(g.push(k),x)};return x}()).entries(u.source)},PX),n&&f.each(g=>{g.children&&(g=Dt(g.data),u.add.push(g),u.source.push(g))}),RM(f,en,en)),u.source.root=f,u}});const LX=(e,t)=>e.parent===t.parent?1:2;Object(Ce.z)($y,Mt,{transform(e,t){t.source&&t.source.root||Object(Ce.o)(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),o=this.fields,u=t.source.root,f=e.as||o;e.field?u.sum(e.field):u.count(),e.sort&&u.sort(yr(e.sort,g=>g.data)),function(g,x,k){for(let F,V=0,X=x.length;V<X;++V)(F=x[V])in k&&g[F](k[F])}(n,this.params,e),n.separation&&n.separation(e.separation!==!1?LX:Ce.Q);try{this.value=n(u)}catch(g){Object(Ce.o)(g)}return u.each(g=>function(x,k,F){const V=x.data,X=k.length-1;for(let te=0;te<X;++te)V[F[te]]=x[k[te]];V[F[X]]=x.children?x.children.length:0}(g,o,f)),t.reflow(e.modified()).modifies(f).modifies("leaf")}});const LM=["x","y","r","depth","children"];function BM(e){$y.call(this,e)}BM.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:LM.length,default:LM}]},Object(Ce.z)(BM,$y,{layout:function(){var e=null,t=1,n=1,o=cx;function u(f){return f.x=t/2,f.y=n/2,e?f.eachBefore(ZP(e)).eachAfter(NM(o,.5)).eachBefore(eL(1)):f.eachBefore(ZP(CX)).eachAfter(NM(cx,1)).eachAfter(NM(o,f.r/Math.min(t,n))).eachBefore(eL(Math.min(t,n)/(2*f.r))),f}return u.radius=function(f){return arguments.length?(e=function(g){return g==null?null:sk(g)}(f),u):e},u.size=function(f){return arguments.length?(t=+f[0],n=+f[1],u):[t,n]},u.padding=function(f){return arguments.length?(o=typeof f=="function"?f:jw(+f),u):o},u},params:["radius","size","padding"],fields:LM});const jM=["x0","y0","x1","y1","depth","children"];function zM(e){$y.call(this,e)}function UM(e){Mt.call(this,null,e)}zM.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:jM.length,default:jM}]},Object(Ce.z)(zM,$y,{layout:function(){var e=1,t=1,n=0,o=!1;function u(f){var g=f.height+1;return f.x0=f.y0=n,f.x1=e,f.y1=t/g,f.eachBefore(function(x,k){return function(F){F.children&&j_(F,F.x0,x*(F.depth+1)/k,F.x1,x*(F.depth+2)/k);var V=F.x0,X=F.y0,te=F.x1-n,ue=F.y1-n;te<V&&(V=te=(V+te)/2),ue<X&&(X=ue=(X+ue)/2),F.x0=V,F.y0=X,F.x1=te,F.y1=ue}}(t,g)),o&&f.eachBefore(tL),f}return u.round=function(f){return arguments.length?(o=!!f,u):o},u.size=function(f){return arguments.length?(e=+f[0],t=+f[1],u):[e,t]},u.padding=function(f){return arguments.length?(n=+f,u):n},u},params:["size","round","padding"],fields:jM}),UM.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},Object(Ce.z)(UM,Mt,{transform(e,t){t.source||Object(Ce.o)("Stratify transform requires an upstream data source.");let n=this.value;const o=e.modified(),u=t.fork(t.ALL).materialize(t.SOURCE),f=!n||o||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return u.source=u.source.slice(),f&&(n=u.source.length?RM(rL().id(e.key).parentId(e.parentKey)(u.source),e.key,Ce.Ia):RM(rL()([{}]),e.key,e.key)),u.source.root=this.value=n,u}});const sL={tidy:function(){var e=TX,t=1,n=1,o=null;function u(k){var F=function(Ue){for(var We,at,st,dt,ct,kt=new uk(Ue,0),St=[kt];We=St.pop();)if(st=We._.children)for(We.children=new Array(ct=st.length),dt=ct-1;dt>=0;--dt)St.push(at=We.children[dt]=new uk(st[dt],dt)),at.parent=We;return(kt.parent=new uk(null,0)).children=[kt],kt}(k);if(F.eachAfter(f),F.parent.m=-F.z,F.eachBefore(g),o)k.eachBefore(x);else{var V=k,X=k,te=k;k.eachBefore(function(Ue){Ue.x<V.x&&(V=Ue),Ue.x>X.x&&(X=Ue),Ue.depth>te.depth&&(te=Ue)});var ue=V===X?1:e(V,X)/2,he=ue-V.x,be=t/(X.x+ue+he),Pe=n/(te.depth||1);k.eachBefore(function(Ue){Ue.x=(Ue.x+he)*be,Ue.y=Ue.depth*Pe})}return k}function f(k){var F=k.children,V=k.parent.children,X=k.i?V[k.i-1]:null;if(F){(function(ue){for(var he,be=0,Pe=0,Ue=ue.children,We=Ue.length;--We>=0;)(he=Ue[We]).z+=be,he.m+=be,be+=he.s+(Pe+=he.c)})(k);var te=(F[0].z+F[F.length-1].z)/2;X?(k.z=X.z+e(k._,X._),k.m=k.z-te):k.z=te}else X&&(k.z=X.z+e(k._,X._));k.parent.A=function(ue,he,be){if(he){for(var Pe,Ue=ue,We=ue,at=he,st=Ue.parent.children[0],dt=Ue.m,ct=We.m,kt=at.m,St=st.m;at=FM(at),Ue=IM(Ue),at&&Ue;)st=IM(st),(We=FM(We)).a=ue,(Pe=at.z+kt-Ue.z-dt+e(at._,Ue._))>0&&(MX(DX(at,ue,be),ue,Pe),dt+=Pe,ct+=Pe),kt+=at.m,dt+=Ue.m,St+=st.m,ct+=We.m;at&&!FM(We)&&(We.t=at,We.m+=kt-ct),Ue&&!IM(st)&&(st.t=Ue,st.m+=dt-St,be=ue)}return be}(k,X,k.parent.A||V[0])}function g(k){k._.x=k.z+k.parent.m,k.m+=k.parent.m}function x(k){k.x*=t,k.y=k.depth*n}return u.separation=function(k){return arguments.length?(e=k,u):e},u.size=function(k){return arguments.length?(o=!1,t=+k[0],n=+k[1],u):o?null:[t,n]},u.nodeSize=function(k){return arguments.length?(o=!0,t=+k[0],n=+k[1],u):o?[t,n]:null},u},cluster:function(){var e=NX,t=1,n=1,o=!1;function u(f){var g,x=0;f.eachAfter(function(te){var ue=te.children;ue?(te.x=function(he){return he.reduce(IX,0)/he.length}(ue),te.y=function(he){return 1+he.reduce(FX,0)}(ue)):(te.x=g?x+=e(te,g):0,te.y=0,g=te)});var k=function(te){for(var ue;ue=te.children;)te=ue[0];return te}(f),F=function(te){for(var ue;ue=te.children;)te=ue[ue.length-1];return te}(f),V=k.x-e(k,F)/2,X=F.x+e(F,k)/2;return f.eachAfter(o?function(te){te.x=(te.x-f.x)*t,te.y=(f.y-te.y)*n}:function(te){te.x=(te.x-V)/(X-V)*t,te.y=(1-(f.y?te.y/f.y:1))*n})}return u.separation=function(f){return arguments.length?(e=f,u):e},u.size=function(f){return arguments.length?(o=!1,t=+f[0],n=+f[1],u):o?null:[t,n]},u.nodeSize=function(f){return arguments.length?(o=!0,t=+f[0],n=+f[1],u):o?[t,n]:null},u}},WM=["x","y","depth","children"];function VM(e){$y.call(this,e)}function HM(e){Mt.call(this,[],e)}VM.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:WM.length,default:WM}]},Object(Ce.z)(VM,$y,{layout(e){const t=e||"tidy";if(Object(Ce.w)(sL,t))return sL[t]();Object(Ce.o)("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:WM}),HM.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},Object(Ce.z)(HM,Mt,{transform(e,t){const n=this.value,o=t.source&&t.source.root,u=t.fork(t.NO_SOURCE),f={};return o||Object(Ce.o)("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(u.rem=n,t.visit(t.SOURCE,g=>f[en(g)]=1),o.each(g=>{const x=g.data,k=g.parent&&g.parent.data;k&&f[en(x)]&&f[en(k)]&&u.add.push(Dt({source:k,target:x}))}),this.value=u.add):t.changed(t.MOD)&&(t.visit(t.MOD,g=>f[en(g)]=1),n.forEach(g=>{(f[en(g.source)]||f[en(g.target)])&&u.mod.push(g)})),u}});const uL={binary:function(e,t,n,o,u){var f,g,x=e.children,k=x.length,F=new Array(k+1);for(F[0]=g=f=0;f<k;++f)F[f+1]=g+=x[f].value;(function V(X,te,ue,he,be,Pe,Ue){if(X>=te-1){var We=x[X];return We.x0=he,We.y0=be,We.x1=Pe,void(We.y1=Ue)}for(var at=F[X],st=ue/2+at,dt=X+1,ct=te-1;dt<ct;){var kt=dt+ct>>>1;F[kt]<st?dt=kt+1:ct=kt}st-F[dt-1]<F[dt]-st&&X+1<dt&&--dt;var St=F[dt]-at,yn=ue-St;if(Pe-he>Ue-be){var Mn=ue?(he*yn+Pe*St)/ue:Pe;V(X,dt,St,he,be,Mn,Ue),V(dt,te,yn,Mn,be,Pe,Ue)}else{var _n=ue?(be*yn+Ue*St)/ue:Ue;V(X,dt,St,he,be,Pe,_n),V(dt,te,yn,he,_n,Pe,Ue)}})(0,k,e.value,t,n,o,u)},dice:j_,slice:ck,slicedice:function(e,t,n,o,u){(1&e.depth?ck:j_)(e,t,n,o,u)},squarify:aL,resquarify:RX},GM=["x0","y0","x1","y1","depth","children"];function qM(e){$y.call(this,e)}qM.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:GM.length,default:GM}]},Object(Ce.z)(qM,$y,{layout(){const e=function(){var t=aL,n=!1,o=1,u=1,f=[0],g=cx,x=cx,k=cx,F=cx,V=cx;function X(ue){return ue.x0=ue.y0=0,ue.x1=o,ue.y1=u,ue.eachBefore(te),f=[0],n&&ue.eachBefore(tL),ue}function te(ue){var he=f[ue.depth],be=ue.x0+he,Pe=ue.y0+he,Ue=ue.x1-he,We=ue.y1-he;Ue<be&&(be=Ue=(be+Ue)/2),We<Pe&&(Pe=We=(Pe+We)/2),ue.x0=be,ue.y0=Pe,ue.x1=Ue,ue.y1=We,ue.children&&(he=f[ue.depth+1]=g(ue)/2,be+=V(ue)-he,Pe+=x(ue)-he,Ue-=k(ue)-he,We-=F(ue)-he,Ue<be&&(be=Ue=(be+Ue)/2),We<Pe&&(Pe=We=(Pe+We)/2),t(ue,be,Pe,Ue,We))}return X.round=function(ue){return arguments.length?(n=!!ue,X):n},X.size=function(ue){return arguments.length?(o=+ue[0],u=+ue[1],X):[o,u]},X.tile=function(ue){return arguments.length?(t=sk(ue),X):t},X.padding=function(ue){return arguments.length?X.paddingInner(ue).paddingOuter(ue):X.paddingInner()},X.paddingInner=function(ue){return arguments.length?(g=typeof ue=="function"?ue:jw(+ue),X):g},X.paddingOuter=function(ue){return arguments.length?X.paddingTop(ue).paddingRight(ue).paddingBottom(ue).paddingLeft(ue):X.paddingTop()},X.paddingTop=function(ue){return arguments.length?(x=typeof ue=="function"?ue:jw(+ue),X):x},X.paddingRight=function(ue){return arguments.length?(k=typeof ue=="function"?ue:jw(+ue),X):k},X.paddingBottom=function(ue){return arguments.length?(F=typeof ue=="function"?ue:jw(+ue),X):F},X.paddingLeft=function(ue){return arguments.length?(V=typeof ue=="function"?ue:jw(+ue),X):V},X}();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{Object(Ce.w)(uL,t)?e.tile(uL[t]):Object(Ce.o)("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:GM});const BX=4278190080,jX=268435456,zX=.0625;function UX(e,t,n,o){const u=e.width,f=e.height,g=n||o,x=lu(u,f).getContext("2d");t.forEach(Pe=>function Ue(We,at,st){if(!at.length)return;const dt=at[0].mark.marktype;dt==="group"?at.forEach(ct=>{ct.items.forEach(kt=>Ue(We,kt.items,st))}):nf[dt].draw(We,{items:st?at.map(WX):at})}(x,Pe,g));const k=new Uint32Array(x.getImageData(0,0,u,f).data.buffer),F=e.bitmap(),V=g&&e.bitmap();let X,te,ue,he,be;for(te=0;te<f;++te)for(X=0;X<u;++X)(be=k[te*u+X]&BX)&&(ue=e(X),he=e(te),o||F.set(ue,he),g&&be^jX&&V.set(ue,he));return[F,V]}function WX(e){const t=or(e,{});return t.stroke&&(t.strokeOpacity=1),t.fill&&(t.fillOpacity=zX,t.stroke="#000",t.strokeOpacity=1,t.strokeWidth=2),t}const Xy=5,ch=31,z_=32,eb=new Uint32Array(z_+1),D0=new Uint32Array(z_+1);D0[0]=0,eb[0]=~D0[0];for(let e=1;e<=z_;++e)D0[e]=D0[e-1]<<1|1,eb[e]=~D0[e];function VX(e,t,n){const o=Math.max(1,Math.sqrt(e*t/1e6)),u=~~((e+2*n+o)/o),f=~~((t+2*n+o)/o),g=x=>~~((x+n)/o);return g.invert=x=>x*o-n,g.bitmap=()=>function(x,k){const F=new Uint32Array(~~((x*k+z_)/z_));function V(te,ue){F[te]|=ue}function X(te,ue){F[te]&=ue}return{array:F,get:(te,ue)=>{const he=ue*x+te;return F[he>>>Xy]&1<<(he&ch)},set:(te,ue)=>{const he=ue*x+te;V(he>>>Xy,1<<(he&ch))},clear:(te,ue)=>{const he=ue*x+te;X(he>>>Xy,~(1<<(he&ch)))},getRange:(te,ue,he,be)=>{let Pe,Ue,We,at,st=be;for(;st>=ue;--st)if((We=(Pe=st*x+te)>>>Xy)==(at=(Ue=st*x+he)>>>Xy)){if(F[We]&eb[Pe&ch]&D0[1+(Ue&ch)])return!0}else{if(F[We]&eb[Pe&ch]||F[at]&D0[1+(Ue&ch)])return!0;for(let dt=We+1;dt<at;++dt)if(F[dt])return!0}return!1},setRange:(te,ue,he,be)=>{let Pe,Ue,We,at,st;for(;ue<=be;++ue)if((We=(Pe=ue*x+te)>>>Xy)==(at=(Ue=ue*x+he)>>>Xy))V(We,eb[Pe&ch]&D0[1+(Ue&ch)]);else for(V(We,eb[Pe&ch]),V(at,D0[1+(Ue&ch)]),st=We+1;st<at;++st)V(st,4294967295)},clearRange:(te,ue,he,be)=>{let Pe,Ue,We,at,st;for(;ue<=be;++ue)if((We=(Pe=ue*x+te)>>>Xy)==(at=(Ue=ue*x+he)>>>Xy))X(We,D0[Pe&ch]|eb[1+(Ue&ch)]);else for(X(We,D0[Pe&ch]),X(at,eb[1+(Ue&ch)]),st=We+1;st<at;++st)X(st,0)},outOfBounds:(te,ue,he,be)=>te<0||ue<0||be>=k||he>=x}}(u,f),g.ratio=o,g.padding=n,g.width=e,g.height=t,g}function lk(e,t,n,o,u,f){let g=n/2;return e-g<0||e+g>u||t-(g=o/2)<0||t+g>f}function tb(e,t,n,o,u,f,g,x){const k=u*f/(2*o),F=e(t-k),V=e(t+k),X=e(n-(f/=2)),te=e(n+f);return g.outOfBounds(F,X,V,te)||g.getRange(F,X,V,te)||x&&x.getRange(F,X,V,te)}const HX=[-1,-1,1,1],GX=[-1,1,-1,1],qX=["right","center","left"],$X=["bottom","middle","top"];function cL(e,t,n,o,u,f,g,x,k,F,V,X){return!(u.outOfBounds(e,n,t,o)||(X&&f?f.getRange(e,n,t,o)||!function(te,ue,he,be,Pe){return Pe[0]<=te&&he<=Pe[2]&&Pe[3]<=ue&&be<=Pe[5]}(g,k,x,F,V):u.getRange(e,n,t,o)))}const XX={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},KX={naive:function(e,t,n,o){const u=e.width,f=e.height;return function(g){const x=g.datum.datum.items[o].items,k=x.length,F=g.datum.fontSize,V=As.width(g.datum,g.datum.text);let X,te,ue,he,be,Pe,Ue,We=0;for(let at=0;at<k;++at)X=x[at].x,ue=x[at].y,be=(X+(te=x[at].x2===void 0?X:x[at].x2))/2,Pe=(ue+(he=x[at].y2===void 0?ue:x[at].y2))/2,(Ue=Math.abs(te-X+he-ue))>=We&&(We=Ue,g.x=be,g.y=Pe);return be=V/2,Pe=F/2,X=g.x-be,te=g.x+be,ue=g.y-Pe,he=g.y+Pe,g.align="center",X<0&&te<=u?g.align="left":0<=X&&u<te&&(g.align="right"),g.baseline="middle",ue<0&&he<=f?g.baseline="top":0<=ue&&f<he&&(g.baseline="bottom"),!0}},"reduced-search":function(e,t,n,o){const u=e.width,f=e.height,g=t[0],x=t[1];function k(F,V,X,te,ue){const he=e.invert(F),be=e.invert(V);let Pe,Ue=X,We=f;if(!lk(he,be,te,ue,u,f)&&!tb(e,he,be,ue,te,Ue,g,x)&&!tb(e,he,be,ue,te,ue,g,null)){for(;We-Ue>=1;)tb(e,he,be,ue,te,Pe=(Ue+We)/2,g,x)?We=Pe:Ue=Pe;if(Ue>X)return[he,be,Ue,!0]}}return function(F){const V=F.datum.datum.items[o].items,X=V.length,te=F.datum.fontSize,ue=As.width(F.datum,F.datum.text);let he,be,Pe,Ue,We,at,st,dt,ct,kt,St,yn,Mn,_n,$n,qn,er,rr=n?te:0,fr=!1,Dr=!1,Zr=0;for(let Br=0;Br<X;++Br){for(he=V[Br].x,Pe=V[Br].y,be=V[Br].x2===void 0?he:V[Br].x2,Ue=V[Br].y2===void 0?Pe:V[Br].y2,he>be&&(er=he,he=be,be=er),Pe>Ue&&(er=Pe,Pe=Ue,Ue=er),kt=~~(((ct=e(he))+(St=e(be)))/2),Mn=~~(((yn=e(Pe))+(_n=e(Ue)))/2),st=kt;st>=ct;--st)for(dt=Mn;dt>=yn;--dt)(qn=k(st,dt,rr,ue,te))&&([F.x,F.y,rr,fr]=qn);for(st=kt;st<=St;++st)for(dt=Mn;dt<=_n;++dt)(qn=k(st,dt,rr,ue,te))&&([F.x,F.y,rr,fr]=qn);fr||n||(We=(he+be)/2,at=(Pe+Ue)/2,($n=Math.abs(be-he+Ue-Pe))>=Zr&&!lk(We,at,ue,te,u,f)&&!tb(e,We,at,te,ue,te,g,null)&&(Zr=$n,F.x=We,F.y=at,Dr=!0))}return!(!fr&&!Dr||(We=ue/2,at=te/2,g.setRange(e(F.x-We),e(F.y-at),e(F.x+We),e(F.y+at)),F.align="center",F.baseline="middle",0))}},floodfill:function(e,t,n,o){const u=e.width,f=e.height,g=t[0],x=t[1],k=e.bitmap();return function(F){const V=F.datum.datum.items[o].items,X=V.length,te=F.datum.fontSize,ue=As.width(F.datum,F.datum.text),he=[];let be,Pe,Ue,We,at,st,dt,ct,kt,St,yn,Mn,_n=n?te:0,$n=!1,qn=!1,er=0;for(let rr=0;rr<X;++rr){for(be=V[rr].x,Ue=V[rr].y,Pe=V[rr].x2===void 0?be:V[rr].x2,We=V[rr].y2===void 0?Ue:V[rr].y2,he.push([e((be+Pe)/2),e((Ue+We)/2)]);he.length;)if([dt,ct]=he.pop(),!(g.get(dt,ct)||x.get(dt,ct)||k.get(dt,ct))){k.set(dt,ct);for(let fr=0;fr<4;++fr)at=dt+HX[fr],st=ct+GX[fr],k.outOfBounds(at,st,at,st)||he.push([at,st]);if(at=e.invert(dt),st=e.invert(ct),kt=_n,St=f,!lk(at,st,ue,te,u,f)&&!tb(e,at,st,te,ue,kt,g,x)&&!tb(e,at,st,te,ue,te,g,null)){for(;St-kt>=1;)tb(e,at,st,te,ue,yn=(kt+St)/2,g,x)?St=yn:kt=yn;kt>_n&&(F.x=at,F.y=st,_n=kt,$n=!0)}}$n||n||(at=(be+Pe)/2,st=(Ue+We)/2,(Mn=Math.abs(Pe-be+We-Ue))>=er&&!lk(at,st,ue,te,u,f)&&!tb(e,at,st,te,ue,te,g,null)&&(er=Mn,F.x=at,F.y=st,qn=!0))}return!(!$n&&!qn||(at=ue/2,st=te/2,g.setRange(e(F.x-at),e(F.y-st),e(F.x+at),e(F.y+st)),F.align="center",F.baseline="middle",0))}}};function YX(e,t,n,o,u,f,g,x,k,F,V){if(!e.length)return e;const X=Math.max(o.length,u.length),te=function(kt,St){const yn=new Float64Array(St),Mn=kt.length;for(let _n=0;_n<Mn;++_n)yn[_n]=kt[_n]||0;for(let _n=Mn;_n<St;++_n)yn[_n]=yn[Mn-1];return yn}(o,X),ue=function(kt,St){const yn=new Int8Array(St),Mn=kt.length;for(let _n=0;_n<Mn;++_n)yn[_n]|=XX[kt[_n]];for(let _n=Mn;_n<St;++_n)yn[_n]=yn[Mn-1];return yn}(u,X),he=function(kt){return kt&&kt.mark&&kt.mark.marktype}(e[0].datum),be=he==="group"&&e[0].datum.items[k].marktype,Pe=be==="area",Ue=function(kt,St,yn,Mn){const _n=$n=>[$n.x,$n.x,$n.x,$n.y,$n.y,$n.y];return kt?kt==="line"||kt==="area"?$n=>_n($n.datum):St==="line"?$n=>{const qn=$n.datum.items[Mn].items;return _n(qn.length?qn[yn==="start"?0:qn.length-1]:{x:NaN,y:NaN})}:$n=>{const qn=$n.datum.bounds;return[qn.x1,(qn.x1+qn.x2)/2,qn.x2,qn.y1,(qn.y1+qn.y2)/2,qn.y2]}:_n}(he,be,x,k),We=VX(t[0],t[1],F),at=Pe&&V==="naive",st=e.map(kt=>({datum:kt,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:Ue(kt)}));let dt;if(!at){n&&st.sort((St,yn)=>n(St.datum,yn.datum));let kt=!1;for(let St=0;St<ue.length&&!kt;++St)kt=ue[St]===5||te[St]<0;he&&(g||Pe)&&(f=[e.map(St=>St.datum)].concat(f)),dt=f.length?UX(We,f,kt,Pe):function(St,yn){const Mn=St.bitmap();return(yn||[]).forEach(_n=>Mn.set(St(_n.boundary[0]),St(_n.boundary[3]))),[Mn,void 0]}(We,g&&st)}const ct=Pe?KX[V](We,dt,g,k):function(kt,St,yn,Mn){const _n=kt.width,$n=kt.height,qn=St[0],er=St[1],rr=Mn.length;return function(fr){const Dr=fr.boundary,Zr=fr.datum.fontSize;if(Dr[2]<0||Dr[5]<0||Dr[0]>_n||Dr[3]>$n)return!1;let Br,di,Ti,Di,Zi,Ri,Ni,Ui,To,da,eo,Ta,Ma,rs,Gs,qs=0;for(let Ms=0;Ms<rr;++Ms){if(Br=(3&yn[Ms])-1,di=(yn[Ms]>>>2&3)-1,Ti=Br===0&&di===0||Mn[Ms]<0,Di=Br&&di?Math.SQRT1_2:1,Zi=Mn[Ms]<0?-1:1,Ri=Dr[1+Br]+Mn[Ms]*Br*Di,Ui=(eo=Dr[4+di]+Zi*Zr*di/2+Mn[Ms]*di*Di)-Zr/2,To=eo+Zr/2,Ta=kt(Ri),rs=kt(Ui),Gs=kt(To),!qs){if(!cL(Ta,Ta,rs,Gs,qn,er,Ri,Ri,Ui,To,Dr,Ti))continue;qs=As.width(fr.datum,fr.datum.text)}if(Ni=(da=Ri+Zi*qs*Br/2)+qs/2,cL(Ta=kt(Ri=da-qs/2),Ma=kt(Ni),rs,Gs,qn,er,Ri,Ni,Ui,To,Dr,Ti))return fr.x=Br?Br*Zi<0?Ni:Ri:da,fr.y=di?di*Zi<0?To:Ui:eo,fr.align=qX[Br*Zi+1],fr.baseline=$X[di*Zi+1],qn.setRange(Ta,rs,Ma,Gs),!0}return!1}}(We,dt,ue,te);return st.forEach(kt=>kt.opacity=+ct(kt)),st}const $M=["x","y","opacity","align","baseline"],lL=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function XM(e){Mt.call(this,null,e)}function fL(e,t){var n,o,u,f,g,x,k=[],F=function(V){return V(f)};if(t==null)k.push(e);else for(n={},o=0,u=e.length;o<u;++o)f=e[o],(x=n[g=t.map(F)])||(n[g]=x=[],x.dims=g,k.push(x)),x.push(f);return k}function KM(e){Mt.call(this,null,e)}XM.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:lL},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:$M.length,default:$M}]},Object(Ce.z)(XM,Mt,{transform(e,t){const n=e.modified();if(!(n||t.changed(t.ADD_REM)||function(u){const f=e[u];return Object(Ce.E)(f)&&t.modified(f.fields)}("sort")))return;e.size&&e.size.length===2||Object(Ce.o)("Size parameter should be specified as a [width, height] array.");const o=e.as||$M;return YX(t.materialize(t.SOURCE).source,e.size,e.sort,Object(Ce.i)(e.offset||1),Object(Ce.i)(e.anchor||lL),e.avoidMarks||[],e.avoidBaseMark!==!1,e.lineAnchor||"end",e.markIndex||0,e.padding||0,e.method||"naive").forEach(u=>{const f=u.datum;f[o[0]]=u.x,f[o[1]]=u.y,f[o[2]]=u.opacity,f[o[3]]=u.align,f[o[4]]=u.baseline}),t.reflow(n).modifies(o)}}),KM.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},Object(Ce.z)(KM,Mt,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const o=fL(t.materialize(t.SOURCE).source,e.groupby),u=(e.groupby||[]).map(Ce.h),f=u.length,g=e.as||[Object(Ce.h)(e.x),Object(Ce.h)(e.y)],x=[];o.forEach(k=>{md(k,e.x,e.y,e.bandwidth||.3).forEach(F=>{const V={};for(let X=0;X<f;++X)V[u[X]]=k.dims[X];V[g[0]]=F[0],V[g[1]]=F[1],x.push(Dt(V))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=x}return n}});const YM={linear:ws,log:La,exp:Nc,pow:pf,quad:Ic,poly:Iu};function JM(e){Mt.call(this,null,e)}JM.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(YM)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},Object(Ce.z)(JM,Mt,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const o=fL(t.materialize(t.SOURCE).source,e.groupby),u=(e.groupby||[]).map(Ce.h),f=e.method||"linear",g=e.order||3,x=((te,ue)=>te==="poly"?ue:te==="quad"?2:1)(f,g),k=e.as||[Object(Ce.h)(e.x),Object(Ce.h)(e.y)],F=YM[f],V=[];let X=e.extent;Object(Ce.w)(YM,f)||Object(Ce.o)("Invalid regression method: "+f),X!=null&&f==="log"&&X[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),X=null),o.forEach(te=>{if(te.length<=x)return void t.dataflow.warn("Skipping regression with more parameters than data points.");const ue=F(te,e.x,e.y,g);if(e.params)return void V.push(Dt({keys:te.dims,coef:ue.coef,rSquared:ue.rSquared}));const he=X||Object(Ce.q)(te,e.x),be=Pe=>{const Ue={};for(let We=0;We<u.length;++We)Ue[u[We]]=te.dims[We];Ue[k[0]]=Pe[0],Ue[k[1]]=Pe[1],V.push(Dt(Ue))};f==="linear"?he.forEach(Pe=>be([Pe,ue.predict(Pe)])):gd(ue.predict,he,25,200).forEach(be)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=V}return n}});const dL=Math.pow(2,-52),fk=new Uint32Array(512);class dk{static from(t,n=function(u){return u[0]},o=function(u){return u[1]}){const u=t.length,f=new Float64Array(2*u);for(let g=0;g<u;g++){const x=t[g];f[2*g]=n(x),f[2*g+1]=o(x)}return new dk(f)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const o=Math.max(2*n-5,0);this._triangles=new Uint32Array(3*o),this._halfedges=new Int32Array(3*o),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:o,_hullTri:u,_hullHash:f}=this,g=t.length>>1;let x=1/0,k=1/0,F=-1/0,V=-1/0;for(let Mn=0;Mn<g;Mn++){const _n=t[2*Mn],$n=t[2*Mn+1];_n<x&&(x=_n),$n<k&&(k=$n),_n>F&&(F=_n),$n>V&&(V=$n),this._ids[Mn]=Mn}const X=(x+F)/2,te=(k+V)/2;let ue,he,be,Pe=1/0;for(let Mn=0;Mn<g;Mn++){const _n=QM(X,te,t[2*Mn],t[2*Mn+1]);_n<Pe&&(ue=Mn,Pe=_n)}const Ue=t[2*ue],We=t[2*ue+1];Pe=1/0;for(let Mn=0;Mn<g;Mn++){if(Mn===ue)continue;const _n=QM(Ue,We,t[2*Mn],t[2*Mn+1]);_n<Pe&&_n>0&&(he=Mn,Pe=_n)}let at=t[2*he],st=t[2*he+1],dt=1/0;for(let Mn=0;Mn<g;Mn++){if(Mn===ue||Mn===he)continue;const _n=QX(Ue,We,at,st,t[2*Mn],t[2*Mn+1]);_n<dt&&(be=Mn,dt=_n)}let ct=t[2*be],kt=t[2*be+1];if(dt===1/0){for(let $n=0;$n<g;$n++)this._dists[$n]=t[2*$n]-t[0]||t[2*$n+1]-t[1];zw(this._ids,this._dists,0,g-1);const Mn=new Uint32Array(g);let _n=0;for(let $n=0,qn=-1/0;$n<g;$n++){const er=this._ids[$n];this._dists[er]>qn&&(Mn[_n++]=er,qn=this._dists[er])}return this.hull=Mn.subarray(0,_n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(hk(Ue,We,at,st,ct,kt)){const Mn=he,_n=at,$n=st;he=be,at=ct,st=kt,be=Mn,ct=_n,kt=$n}const St=function(Mn,_n,$n,qn,er,rr){const fr=$n-Mn,Dr=qn-_n,Zr=er-Mn,Br=rr-_n,di=fr*fr+Dr*Dr,Ti=Zr*Zr+Br*Br,Di=.5/(fr*Br-Dr*Zr);return{x:Mn+(Br*di-Dr*Ti)*Di,y:_n+(fr*Ti-Zr*di)*Di}}(Ue,We,at,st,ct,kt);this._cx=St.x,this._cy=St.y;for(let Mn=0;Mn<g;Mn++)this._dists[Mn]=QM(t[2*Mn],t[2*Mn+1],St.x,St.y);zw(this._ids,this._dists,0,g-1),this._hullStart=ue;let yn=3;o[ue]=n[be]=he,o[he]=n[ue]=be,o[be]=n[he]=ue,u[ue]=0,u[he]=1,u[be]=2,f.fill(-1),f[this._hashKey(Ue,We)]=ue,f[this._hashKey(at,st)]=he,f[this._hashKey(ct,kt)]=be,this.trianglesLen=0,this._addTriangle(ue,he,be,-1,-1,-1);for(let Mn,_n,$n=0;$n<this._ids.length;$n++){const qn=this._ids[$n],er=t[2*qn],rr=t[2*qn+1];if($n>0&&Math.abs(er-Mn)<=dL&&Math.abs(rr-_n)<=dL||(Mn=er,_n=rr,qn===ue||qn===he||qn===be))continue;let fr=0;for(let Ti=0,Di=this._hashKey(er,rr);Ti<this._hashSize&&((fr=f[(Di+Ti)%this._hashSize])===-1||fr===o[fr]);Ti++);let Dr,Zr=fr=n[fr];for(;Dr=o[Zr],!hk(er,rr,t[2*Zr],t[2*Zr+1],t[2*Dr],t[2*Dr+1]);)if((Zr=Dr)===fr){Zr=-1;break}if(Zr===-1)continue;let Br=this._addTriangle(Zr,qn,o[Zr],-1,-1,u[Zr]);u[qn]=this._legalize(Br+2),u[Zr]=Br,yn++;let di=o[Zr];for(;Dr=o[di],hk(er,rr,t[2*di],t[2*di+1],t[2*Dr],t[2*Dr+1]);)Br=this._addTriangle(di,qn,Dr,u[qn],-1,u[di]),u[qn]=this._legalize(Br+2),o[di]=di,yn--,di=Dr;if(Zr===fr)for(;hk(er,rr,t[2*(Dr=n[Zr])],t[2*Dr+1],t[2*Zr],t[2*Zr+1]);)Br=this._addTriangle(Dr,qn,Zr,-1,u[Zr],u[Dr]),this._legalize(Br+2),u[Dr]=Br,o[Zr]=Zr,yn--,Zr=Dr;this._hullStart=n[qn]=Zr,o[Zr]=n[di]=qn,o[qn]=di,f[this._hashKey(er,rr)]=qn,f[this._hashKey(t[2*Zr],t[2*Zr+1])]=Zr}this.hull=new Uint32Array(yn);for(let Mn=0,_n=this._hullStart;Mn<yn;Mn++)this.hull[Mn]=_n,_n=o[_n];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(function(o,u){const f=o/(Math.abs(o)+Math.abs(u));return(u>0?3-f:1+f)/4}(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:o,coords:u}=this;let f=0,g=0;for(;;){const x=o[t],k=t-t%3;if(g=k+(t+2)%3,x===-1){if(f===0)break;t=fk[--f];continue}const F=x-x%3,V=k+(t+1)%3,X=F+(x+2)%3,te=n[g],ue=n[t],he=n[V],be=n[X];if(JX(u[2*te],u[2*te+1],u[2*ue],u[2*ue+1],u[2*he],u[2*he+1],u[2*be],u[2*be+1])){n[t]=be,n[x]=te;const Pe=o[X];if(Pe===-1){let We=this._hullStart;do{if(this._hullTri[We]===X){this._hullTri[We]=t;break}We=this._hullPrev[We]}while(We!==this._hullStart)}this._link(t,Pe),this._link(x,o[g]),this._link(g,X);const Ue=F+(x+1)%3;f<fk.length&&(fk[f++]=Ue)}else{if(f===0)break;t=fk[--f]}}return g}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,o,u,f,g){const x=this.trianglesLen;return this._triangles[x]=t,this._triangles[x+1]=n,this._triangles[x+2]=o,this._link(x,u),this._link(x+1,f),this._link(x+2,g),this.trianglesLen+=3,x}}function QM(e,t,n,o){const u=e-n,f=t-o;return u*u+f*f}function ZM(e,t,n,o,u,f){const g=(o-t)*(u-e),x=(n-e)*(f-t);return Math.abs(g-x)>=33306690738754716e-32*Math.abs(g+x)?g-x:0}function hk(e,t,n,o,u,f){return(ZM(u,f,e,t,n,o)||ZM(e,t,n,o,u,f)||ZM(n,o,u,f,e,t))<0}function JX(e,t,n,o,u,f,g,x){const k=e-g,F=t-x,V=n-g,X=o-x,te=u-g,ue=f-x,he=V*V+X*X,be=te*te+ue*ue;return k*(X*be-he*ue)-F*(V*be-he*te)+(k*k+F*F)*(V*ue-X*te)<0}function QX(e,t,n,o,u,f){const g=n-e,x=o-t,k=u-e,F=f-t,V=g*g+x*x,X=k*k+F*F,te=.5/(g*F-x*k),ue=(F*V-x*X)*te,he=(g*X-k*V)*te;return ue*ue+he*he}function zw(e,t,n,o){if(o-n<=20)for(let u=n+1;u<=o;u++){const f=e[u],g=t[f];let x=u-1;for(;x>=n&&t[e[x]]>g;)e[x+1]=e[x--];e[x+1]=f}else{let u=n+1,f=o;U_(e,n+o>>1,u),t[e[n]]>t[e[o]]&&U_(e,n,o),t[e[u]]>t[e[o]]&&U_(e,u,o),t[e[n]]>t[e[u]]&&U_(e,n,u);const g=e[u],x=t[g];for(;;){do u++;while(t[e[u]]<x);do f--;while(t[e[f]]>x);if(f<u)break;U_(e,u,f)}e[n+1]=e[f],e[f]=g,o-u+1>=f-n?(zw(e,t,u,o),zw(e,t,n,f-1)):(zw(e,t,n,f-1),zw(e,t,u,o))}}function U_(e,t,n){const o=e[t];e[t]=e[n],e[n]=o}const hL=1e-6;class lx{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,o){const u=(t=+t)+(o=+o),f=n=+n;if(o<0)throw new Error("negative radius");this._x1===null?this._+=`M${u},${f}`:(Math.abs(this._x1-u)>hL||Math.abs(this._y1-f)>hL)&&(this._+="L"+u+","+f),o&&(this._+=`A${o},${o},0,1,1,${t-o},${n}A${o},${o},0,1,1,${this._x1=u},${this._y1=f}`)}rect(t,n,o,u){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+o}v${+u}h${-o}Z`}value(){return this._||null}}class eD{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}class ZX{constructor(t,[n,o,u,f]=[0,0,960,500]){if(!((u=+u)>=(n=+n)&&(f=+f)>=(o=+o)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=u,this.xmin=n,this.ymax=f,this.ymin=o,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:o},vectors:u}=this,f=this.circumcenters=this._circumcenters.subarray(0,o.length/3*2);for(let ue,he,be=0,Pe=0,Ue=o.length;be<Ue;be+=3,Pe+=2){const We=2*o[be],at=2*o[be+1],st=2*o[be+2],dt=t[We],ct=t[We+1],kt=t[at],St=t[at+1],yn=t[st],Mn=t[st+1],_n=kt-dt,$n=St-ct,qn=yn-dt,er=Mn-ct,rr=_n*_n+$n*$n,fr=qn*qn+er*er,Dr=2*(_n*er-$n*qn);if(Dr)if(Math.abs(Dr)<1e-8)ue=(dt+yn)/2,he=(ct+Mn)/2;else{const Zr=1/Dr;ue=dt+(er*rr-$n*fr)*Zr,he=ct+(_n*fr-qn*rr)*Zr}else ue=(dt+yn)/2-1e8*er,he=(ct+Mn)/2+1e8*qn;f[Pe]=ue,f[Pe+1]=he}let g,x,k,F=n[n.length-1],V=4*F,X=t[2*F],te=t[2*F+1];u.fill(0);for(let ue=0;ue<n.length;++ue)g=V,x=X,k=te,V=4*(F=n[ue]),X=t[2*F],te=t[2*F+1],u[g+2]=u[V]=k-te,u[g+3]=u[V+1]=X-x}render(t){const n=t==null?t=new lx:void 0,{delaunay:{halfedges:o,inedges:u,hull:f},circumcenters:g,vectors:x}=this;if(f.length<=1)return null;for(let V=0,X=o.length;V<X;++V){const te=o[V];if(te<V)continue;const ue=2*Math.floor(V/3),he=2*Math.floor(te/3),be=g[ue],Pe=g[ue+1],Ue=g[he],We=g[he+1];this._renderSegment(be,Pe,Ue,We,t)}let k,F=f[f.length-1];for(let V=0;V<f.length;++V){k=F,F=f[V];const X=2*Math.floor(u[F]/3),te=g[X],ue=g[X+1],he=4*k,be=this._project(te,ue,x[he+2],x[he+3]);be&&this._renderSegment(te,ue,be[0],be[1],t)}return n&&n.value()}renderBounds(t){const n=t==null?t=new lx:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const o=n==null?n=new lx:void 0,u=this._clip(t);if(u===null||!u.length)return;n.moveTo(u[0],u[1]);let f=u.length;for(;u[0]===u[f-2]&&u[1]===u[f-1]&&f>1;)f-=2;for(let g=2;g<f;g+=2)u[g]===u[g-2]&&u[g+1]===u[g-1]||n.lineTo(u[g],u[g+1]);return n.closePath(),o&&o.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,o=t.length/2;n<o;++n){const u=this.cellPolygon(n);u&&(u.index=n,yield u)}}cellPolygon(t){const n=new eD;return this.renderCell(t,n),n.value()}_renderSegment(t,n,o,u,f){let g;const x=this._regioncode(t,n),k=this._regioncode(o,u);x===0&&k===0?(f.moveTo(t,n),f.lineTo(o,u)):(g=this._clipSegment(t,n,o,u,x,k))&&(f.moveTo(g[0],g[1]),f.lineTo(g[2],g[3]))}contains(t,n,o){return(n=+n)==n&&(o=+o)==o&&this.delaunay._step(t,n,o)===t}*neighbors(t){const n=this._clip(t);if(n)for(const o of this.delaunay.neighbors(t)){const u=this._clip(o);if(u){e:for(let f=0,g=n.length;f<g;f+=2)for(let x=0,k=u.length;x<k;x+=2)if(n[f]==u[x]&&n[f+1]==u[x+1]&&n[(f+2)%g]==u[(x+k-2)%k]&&n[(f+3)%g]==u[(x+k-1)%k]){yield o;break e}}}}_cell(t){const{circumcenters:n,delaunay:{inedges:o,halfedges:u,triangles:f}}=this,g=o[t];if(g===-1)return null;const x=[];let k=g;do{const F=Math.floor(k/3);if(x.push(n[2*F],n[2*F+1]),f[k=k%3==2?k-2:k+1]!==t)break;k=u[k]}while(k!==g&&k!==-1);return x}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(n===null)return null;const{vectors:o}=this,u=4*t;return o[u]||o[u+1]?this._clipInfinite(t,n,o[u],o[u+1],o[u+2],o[u+3]):this._clipFinite(t,n)}_clipFinite(t,n){const o=n.length;let u,f,g,x,k,F=null,V=n[o-2],X=n[o-1],te=this._regioncode(V,X);for(let ue=0;ue<o;ue+=2)if(u=V,f=X,V=n[ue],X=n[ue+1],g=te,te=this._regioncode(V,X),g===0&&te===0)x=k,k=0,F?F.push(V,X):F=[V,X];else{let he,be,Pe,Ue,We;if(g===0){if((he=this._clipSegment(u,f,V,X,g,te))===null)continue;[be,Pe,Ue,We]=he}else{if((he=this._clipSegment(V,X,u,f,te,g))===null)continue;[Ue,We,be,Pe]=he,x=k,k=this._edgecode(be,Pe),x&&k&&this._edge(t,x,k,F,F.length),F?F.push(be,Pe):F=[be,Pe]}x=k,k=this._edgecode(Ue,We),x&&k&&this._edge(t,x,k,F,F.length),F?F.push(Ue,We):F=[Ue,We]}if(F)x=k,k=this._edgecode(F[0],F[1]),x&&k&&this._edge(t,x,k,F,F.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return F}_clipSegment(t,n,o,u,f,g){for(;;){if(f===0&&g===0)return[t,n,o,u];if(f&g)return null;let x,k,F=f||g;8&F?(x=t+(o-t)*(this.ymax-n)/(u-n),k=this.ymax):4&F?(x=t+(o-t)*(this.ymin-n)/(u-n),k=this.ymin):2&F?(k=n+(u-n)*(this.xmax-t)/(o-t),x=this.xmax):(k=n+(u-n)*(this.xmin-t)/(o-t),x=this.xmin),f?(t=x,n=k,f=this._regioncode(t,n)):(o=x,u=k,g=this._regioncode(o,u))}}_clipInfinite(t,n,o,u,f,g){let x,k=Array.from(n);if((x=this._project(k[0],k[1],o,u))&&k.unshift(x[0],x[1]),(x=this._project(k[k.length-2],k[k.length-1],f,g))&&k.push(x[0],x[1]),k=this._clipFinite(t,k))for(let F,V=0,X=k.length,te=this._edgecode(k[X-2],k[X-1]);V<X;V+=2)F=te,te=this._edgecode(k[V],k[V+1]),F&&te&&(V=this._edge(t,F,te,k,V),X=k.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(k=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return k}_edge(t,n,o,u,f){for(;n!==o;){let g,x;switch(n){case 5:n=4;continue;case 4:n=6,g=this.xmax,x=this.ymin;break;case 6:n=2;continue;case 2:n=10,g=this.xmax,x=this.ymax;break;case 10:n=8;continue;case 8:n=9,g=this.xmin,x=this.ymax;break;case 9:n=1;continue;case 1:n=5,g=this.xmin,x=this.ymin}u[f]===g&&u[f+1]===x||!this.contains(t,g,x)||(u.splice(f,0,g,x),f+=2)}if(u.length>4)for(let g=0;g<u.length;g+=2){const x=(g+2)%u.length,k=(g+4)%u.length;(u[g]===u[x]&&u[x]===u[k]||u[g+1]===u[x+1]&&u[x+1]===u[k+1])&&(u.splice(x,2),g-=2)}return f}_project(t,n,o,u){let f,g,x,k=1/0;if(u<0){if(n<=this.ymin)return null;(f=(this.ymin-n)/u)<k&&(x=this.ymin,g=t+(k=f)*o)}else if(u>0){if(n>=this.ymax)return null;(f=(this.ymax-n)/u)<k&&(x=this.ymax,g=t+(k=f)*o)}if(o>0){if(t>=this.xmax)return null;(f=(this.xmax-t)/o)<k&&(g=this.xmax,x=n+(k=f)*u)}else if(o<0){if(t<=this.xmin)return null;(f=(this.xmin-t)/o)<k&&(g=this.xmin,x=n+(k=f)*u)}return[g,x]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}}const eK=2*Math.PI,Uw=Math.pow;function tK(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class tD{static from(t,n=function(f){return f[0]},o=function(f){return f[1]},u){return new tD("length"in t?function(f,g,x,k){const F=f.length,V=new Float64Array(2*F);for(let X=0;X<F;++X){const te=f[X];V[2*X]=g.call(k,te,X,f),V[2*X+1]=x.call(k,te,X,f)}return V}(t,n,o,u):Float64Array.from(function*(f,g,x,k){let F=0;for(const V of f)yield g.call(k,V,F,f),yield x.call(k,V,F,f),++F}(t,n,o,u)))}constructor(t){this._delaunator=new dk(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&function(k){const{triangles:F,coords:V}=k;for(let X=0;X<F.length;X+=3){const te=2*F[X],ue=2*F[X+1],he=2*F[X+2];if((V[he]-V[te])*(V[ue+1]-V[te+1])-(V[ue]-V[te])*(V[he+1]-V[te+1])>1e-10)return!1}return!0}(t)){this.collinear=Int32Array.from({length:n.length/2},(te,ue)=>ue).sort((te,ue)=>n[2*te]-n[2*ue]||n[2*te+1]-n[2*ue+1]);const k=this.collinear[0],F=this.collinear[this.collinear.length-1],V=[n[2*k],n[2*k+1],n[2*F],n[2*F+1]],X=1e-8*Math.hypot(V[3]-V[1],V[2]-V[0]);for(let te=0,ue=n.length/2;te<ue;++te){const he=tK(n[2*te],n[2*te+1],X);n[2*te]=he[0],n[2*te+1]=he[1]}this._delaunator=new dk(n)}else delete this.collinear;const o=this.halfedges=this._delaunator.halfedges,u=this.hull=this._delaunator.hull,f=this.triangles=this._delaunator.triangles,g=this.inedges.fill(-1),x=this._hullIndex.fill(-1);for(let k=0,F=o.length;k<F;++k){const V=f[k%3==2?k-2:k+1];o[k]!==-1&&g[V]!==-1||(g[V]=k)}for(let k=0,F=u.length;k<F;++k)x[u[k]]=k;u.length<=2&&u.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=u[0],this.triangles[1]=u[1],this.triangles[2]=u[1],g[u[0]]=1,u.length===2&&(g[u[1]]=0))}voronoi(t){return new ZX(this,t)}*neighbors(t){const{inedges:n,hull:o,_hullIndex:u,halfedges:f,triangles:g,collinear:x}=this;if(x){const X=x.indexOf(t);return X>0&&(yield x[X-1]),void(X<x.length-1&&(yield x[X+1]))}const k=n[t];if(k===-1)return;let F=k,V=-1;do{if(yield V=g[F],g[F=F%3==2?F-2:F+1]!==t)return;if((F=f[F])===-1){const X=o[(u[t]+1)%o.length];return void(X!==V&&(yield X))}}while(F!==k)}find(t,n,o=0){if((t=+t)!=t||(n=+n)!=n)return-1;const u=o;let f;for(;(f=this._step(o,t,n))>=0&&f!==o&&f!==u;)o=f;return f}_step(t,n,o){const{inedges:u,hull:f,_hullIndex:g,halfedges:x,triangles:k,points:F}=this;if(u[t]===-1||!F.length)return(t+1)%(F.length>>1);let V=t,X=Uw(n-F[2*t],2)+Uw(o-F[2*t+1],2);const te=u[t];let ue=te;do{let he=k[ue];const be=Uw(n-F[2*he],2)+Uw(o-F[2*he+1],2);if(be<X&&(X=be,V=he),k[ue=ue%3==2?ue-2:ue+1]!==t)break;if((ue=x[ue])===-1){if((ue=f[(g[t]+1)%f.length])!==he&&Uw(n-F[2*ue],2)+Uw(o-F[2*ue+1],2)<X)return ue;break}}while(ue!==te);return V}render(t){const n=t==null?t=new lx:void 0,{points:o,halfedges:u,triangles:f}=this;for(let g=0,x=u.length;g<x;++g){const k=u[g];if(k<g)continue;const F=2*f[g],V=2*f[k];t.moveTo(o[F],o[F+1]),t.lineTo(o[V],o[V+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n=2){const o=t==null?t=new lx:void 0,{points:u}=this;for(let f=0,g=u.length;f<g;f+=2){const x=u[f],k=u[f+1];t.moveTo(x+n,k),t.arc(x,k,n,0,eK)}return o&&o.value()}renderHull(t){const n=t==null?t=new lx:void 0,{hull:o,points:u}=this,f=2*o[0],g=o.length;t.moveTo(u[f],u[f+1]);for(let x=1;x<g;++x){const k=2*o[x];t.lineTo(u[k],u[k+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new eD;return this.renderHull(t),t.value()}renderTriangle(t,n){const o=n==null?n=new lx:void 0,{points:u,triangles:f}=this,g=2*f[t*=3],x=2*f[t+1],k=2*f[t+2];return n.moveTo(u[g],u[g+1]),n.lineTo(u[x],u[x+1]),n.lineTo(u[k],u[k+1]),n.closePath(),o&&o.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,o=t.length/3;n<o;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new eD;return this.renderTriangle(t,n),n.value()}}function nD(e){Mt.call(this,null,e)}nD.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const nK=[-1e5,-1e5,1e5,1e5];function rK(e){const t=e[0][0],n=e[0][1];let o=e.length-1;for(;e[o][0]===t&&e[o][1]===n;--o);return"M"+e.slice(0,o+1).join("L")+"Z"}Object(Ce.z)(nD,Mt,{transform(e,t){const n=e.as||"path",o=t.source;if(!o||!o.length)return t;let u=e.size;u=u?[0,0,u[0],u[1]]:(u=e.extent)?[u[0][0],u[0][1],u[1][0],u[1][1]]:nK;const f=this.value=tD.from(o,e.x,e.y).voronoi(u);for(let g=0,x=o.length;g<x;++g){const k=f.cellPolygon(g);o[g][n]=k?rK(k):null}return t.reflow(e.modified()).modifies(n)}});var rD=Math.PI/180,W_=64,pk=2048;function iK(){var e,t,n,o,u,f,g,x=[256,256],k=pL,F=[],V=Math.random,X={};function te(ue,he,be){for(var Pe,Ue,We,at=he.x,st=he.y,dt=Math.sqrt(x[0]*x[0]+x[1]*x[1]),ct=k(x),kt=V()<.5?1:-1,St=-kt;(Pe=ct(St+=kt))&&(Ue=~~Pe[0],We=~~Pe[1],!(Math.min(Math.abs(Ue),Math.abs(We))>=dt));)if(he.x=at+Ue,he.y=st+We,!(he.x+he.x0<0||he.y+he.y0<0||he.x+he.x1>x[0]||he.y+he.y1>x[1])&&(!be||!aK(he,ue,x[0]))&&(!be||uK(he,be))){for(var yn,Mn=he.sprite,_n=he.width>>5,$n=x[0]>>5,qn=he.x-(_n<<4),er=127&qn,rr=32-er,fr=he.y1-he.y0,Dr=(he.y+he.y0)*$n+(qn>>5),Zr=0;Zr<fr;Zr++){yn=0;for(var Br=0;Br<=_n;Br++)ue[Dr+Br]|=yn<<rr|(Br<_n?(yn=Mn[Zr*_n+Br])>>>er:0);Dr+=$n}return he.sprite=null,!0}return!1}return X.layout=function(){for(var ue=function(dt){dt.width=dt.height=1;var ct=Math.sqrt(dt.getContext("2d").getImageData(0,0,1,1).data.length>>2);dt.width=(W_<<5)/ct,dt.height=pk/ct;var kt=dt.getContext("2d");return kt.fillStyle=kt.strokeStyle="red",kt.textAlign="center",{context:kt,ratio:ct}}(lu()),he=function(dt){for(var ct=[],kt=-1;++kt<dt;)ct[kt]=0;return ct}((x[0]>>5)*x[1]),be=null,Pe=F.length,Ue=-1,We=[],at=F.map(dt=>({text:e(dt),font:t(dt),style:o(dt),weight:u(dt),rotate:f(dt),size:~~(n(dt)+1e-14),padding:g(dt),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:dt})).sort((dt,ct)=>ct.size-dt.size);++Ue<Pe;){var st=at[Ue];st.x=x[0]*(V()+.5)>>1,st.y=x[1]*(V()+.5)>>1,oK(ue,st,at,Ue),st.hasText&&te(he,st,be)&&(We.push(st),be?sK(be,st):be=[{x:st.x+st.x0,y:st.y+st.y0},{x:st.x+st.x1,y:st.y+st.y1}],st.x-=x[0]>>1,st.y-=x[1]>>1)}return We},X.words=function(ue){return arguments.length?(F=ue,X):F},X.size=function(ue){return arguments.length?(x=[+ue[0],+ue[1]],X):x},X.font=function(ue){return arguments.length?(t=fx(ue),X):t},X.fontStyle=function(ue){return arguments.length?(o=fx(ue),X):o},X.fontWeight=function(ue){return arguments.length?(u=fx(ue),X):u},X.rotate=function(ue){return arguments.length?(f=fx(ue),X):f},X.text=function(ue){return arguments.length?(e=fx(ue),X):e},X.spiral=function(ue){return arguments.length?(k=cK[ue]||ue,X):k},X.fontSize=function(ue){return arguments.length?(n=fx(ue),X):n},X.padding=function(ue){return arguments.length?(g=fx(ue),X):g},X.random=function(ue){return arguments.length?(V=ue,X):V},X}function oK(e,t,n,o){if(!t.sprite){var u=e.context,f=e.ratio;u.clearRect(0,0,(W_<<5)/f,pk/f);var g,x,k,F,V,X=0,te=0,ue=0,he=n.length;for(--o;++o<he;){if(t=n[o],u.save(),u.font=t.style+" "+t.weight+" "+~~((t.size+1)/f)+"px "+t.font,g=u.measureText(t.text+"m").width*f,k=t.size<<1,t.rotate){var be=Math.sin(t.rotate*rD),Pe=Math.cos(t.rotate*rD),Ue=g*Pe,We=g*be,at=k*Pe,st=k*be;g=Math.max(Math.abs(Ue+st),Math.abs(Ue-st))+31>>5<<5,k=~~Math.max(Math.abs(We+at),Math.abs(We-at))}else g=g+31>>5<<5;if(k>ue&&(ue=k),X+g>=W_<<5&&(X=0,te+=ue,ue=0),te+k>=pk)break;u.translate((X+(g>>1))/f,(te+(k>>1))/f),t.rotate&&u.rotate(t.rotate*rD),u.fillText(t.text,0,0),t.padding&&(u.lineWidth=2*t.padding,u.strokeText(t.text,0,0)),u.restore(),t.width=g,t.height=k,t.xoff=X,t.yoff=te,t.x1=g>>1,t.y1=k>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,X+=g}for(var dt=u.getImageData(0,0,(W_<<5)/f,pk/f).data,ct=[];--o>=0;)if((t=n[o]).hasText){for(x=(g=t.width)>>5,k=t.y1-t.y0,F=0;F<k*x;F++)ct[F]=0;if((X=t.xoff)==null)return;te=t.yoff;var kt=0,St=-1;for(V=0;V<k;V++){for(F=0;F<g;F++){var yn=x*V+(F>>5),Mn=dt[(te+V)*(W_<<5)+(X+F)<<2]?1<<31-F%32:0;ct[yn]|=Mn,kt|=Mn}kt?St=V:(t.y0++,k--,V--,te++)}t.y1=t.y0+St,t.sprite=ct.slice(0,(t.y1-t.y0)*x)}}}function aK(e,t,n){n>>=5;for(var o,u=e.sprite,f=e.width>>5,g=e.x-(f<<4),x=127&g,k=32-x,F=e.y1-e.y0,V=(e.y+e.y0)*n+(g>>5),X=0;X<F;X++){o=0;for(var te=0;te<=f;te++)if((o<<k|(te<f?(o=u[X*f+te])>>>x:0))&t[V+te])return!0;V+=n}return!1}function sK(e,t){var n=e[0],o=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>o.x&&(o.x=t.x+t.x1),t.y+t.y1>o.y&&(o.y=t.y+t.y1)}function uK(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function pL(e){var t=e[0]/e[1];return function(n){return[t*(n*=.1)*Math.cos(n),n*Math.sin(n)]}}function fx(e){return typeof e=="function"?e:function(){return e}}var cK={archimedean:pL,rectangular:function(e){var t=4*e[0]/e[1],n=0,o=0;return function(u){var f=u<0?-1:1;switch(Math.sqrt(1+4*f*u)-f&3){case 0:n+=t;break;case 1:o+=4;break;case 2:n-=t;break;default:o-=4}return[n,o]}}};const mL=["x","y","font","fontSize","fontStyle","fontWeight","angle"],lK=["text","font","rotate","fontSize","fontStyle","fontWeight"];function iD(e){Mt.call(this,iK(),e)}iD.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:mL}]},Object(Ce.z)(iD,Mt,{transform(e,t){!e.size||e.size[0]&&e.size[1]||Object(Ce.o)("Wordcloud size dimensions must be non-zero.");const n=e.modified();if(!(n||t.changed(t.ADD_REM)||lK.some(function(ue){const he=e[ue];return Object(Ce.E)(he)&&t.modified(he.fields)})))return;const o=t.materialize(t.SOURCE).source,u=this.value,f=e.as||mL;let g,x=e.fontSize||14;if(Object(Ce.E)(x)?g=e.fontSizeRange:x=Object(Ce.m)(x),g){const ue=x,he=Vo("sqrt")().domain(Object(Ce.q)(o,ue)).range(g);x=be=>he(ue(be))}o.forEach(ue=>{ue[f[0]]=NaN,ue[f[1]]=NaN,ue[f[3]]=0});const k=u.words(o).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(x).random(Kn).layout(),F=u.size(),V=F[0]>>1,X=F[1]>>1,te=k.length;for(let ue,he,be=0;be<te;++be)(he=(ue=k[be]).datum)[f[0]]=ue.x+V,he[f[1]]=ue.y+X,he[f[2]]=ue.font,he[f[3]]=ue.size,he[f[4]]=ue.style,he[f[5]]=ue.weight,he[f[6]]=ue.rotate;return t.reflow(n).modifies(f)}});var fK=function(e,t){return Array.from(t,n=>e[n])};const dK=e=>new Uint8Array(e),hK=e=>new Uint16Array(e),V_=e=>new Uint32Array(e);function mk(e,t,n){const o=(t<257?dK:t<65537?hK:V_)(e);return n&&o.set(n),o}function gL(e,t,n){const o=1<<t;return{one:o,zero:~o,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(u,f){const g=this.bisect(this.range,u.value),x=u.index,k=g[0],F=g[1],V=x.length;let X;for(X=0;X<k;++X)f[x[X]]|=o;for(X=F;X<V;++X)f[x[X]]|=o;return this}}}function vL(){let e=V_(0),t=[],n=0;return{insert:function(o,u,f){if(!u.length)return[];const g=n,x=u.length,k=V_(x);let F,V,X,te=Array(x);for(X=0;X<x;++X)te[X]=o(u[X]),k[X]=X;if(te=function(ue,he){return ue.sort.call(he,(be,Pe)=>{const Ue=ue[be],We=ue[Pe];return Ue<We?-1:Ue>We?1:0}),fK(ue,he)}(te,k),g)F=t,V=e,t=Array(g+x),e=V_(g+x),function(ue,he,be,Pe,Ue,We,at,st,dt){let ct,kt=0,St=0;for(ct=0;kt<Pe&&St<at;++ct)he[kt]<Ue[St]?(st[ct]=he[kt],dt[ct]=be[kt++]):(st[ct]=Ue[St],dt[ct]=We[St++]+ue);for(;kt<Pe;++kt,++ct)st[ct]=he[kt],dt[ct]=be[kt];for(;St<at;++St,++ct)st[ct]=Ue[St],dt[ct]=We[St]+ue}(f,F,V,g,te,k,x,t,e);else{if(f>0)for(X=0;X<x;++X)k[X]+=f;t=te,e=k}return n=g+x,{index:k,value:te}},remove:function(o,u){const f=n;let g,x,k;for(x=0;!u[e[x]]&&x<f;++x);for(k=x;x<f;++x)u[g=e[x]]||(e[k]=g,t[k]=t[x],++k);n=f-o},bisect:function(o,u){let f;return u?f=u.length:(u=t,f=n),[Ss(u,o[0],0,f),Ua(u,o[1],0,f)]},reindex:function(o){for(let u=0,f=n;u<f;++u)e[u]=o[e[u]]},index:()=>e,size:()=>n}}function oD(e){Mt.call(this,function(){let t=8,n=[],o=V_(0),u=mk(0,t),f=mk(0,t);return{data:()=>n,seen:()=>o=function(g,x,k){return g.length>=x?g:((k=k||new g.constructor(x)).set(g),k)}(o,n.length),add(g){for(let x,k=0,F=n.length,V=g.length;k<V;++k)(x=g[k])._index=F++,n.push(x)},remove(g,x){const k=n.length,F=Array(k-g),V=n;let X,te,ue;for(te=0;!x[te]&&te<k;++te)F[te]=n[te],V[te]=te;for(ue=te;te<k;++te)X=n[te],x[te]?V[te]=-1:(V[te]=ue,u[ue]=u[te],f[ue]=f[te],F[ue]=X,X._index=ue++),u[te]=0;return n=F,V},size:()=>n.length,curr:()=>u,prev:()=>f,reset:g=>f[g]=u[g],all:()=>t<257?255:t<65537?65535:4294967295,set(g,x){u[g]|=x},clear(g,x){u[g]&=~x},resize(g,x){(g>u.length||x>t)&&(t=Math.max(x,t),u=mk(g,t,u),f=mk(g,t))}}}(),e),this._indices=null,this._dims=null}function aD(e){Mt.call(this,null,e)}oD.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},Object(Ce.z)(oD,Mt,{transform(e,t){return this._dims?e.modified("fields")||e.fields.some(n=>t.modified(n.fields))?this.reinit(e,t):this.eval(e,t):this.init(e,t)},init(e,t){const n=e.fields,o=e.query,u=this._indices={},f=this._dims=[],g=o.length;let x,k,F=0;for(;F<g;++F)k=u[x=n[F].fname]||(u[x]=vL()),f.push(gL(k,F,o[F]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),o=e.fields,u=e.query,f=this._indices,g=this._dims,x=this.value,k=x.curr(),F=x.prev(),V=x.all(),X=n.rem=n.add,te=n.mod,ue=u.length,he={};let be,Pe,Ue,We,at,st,dt,ct,kt;if(F.set(k),t.rem.length&&(at=this.remove(e,t,n)),t.add.length&&x.add(t.add),t.mod.length)for(st={},dt=0,ct=(We=t.mod).length;dt<ct;++dt)st[We[dt]._index]=1;for(dt=0;dt<ue;++dt)kt=o[dt],(!g[dt]||e.modified("fields",dt)||t.modified(kt.fields))&&((be=he[Ue=kt.fname])||(f[Ue]=Pe=vL(),he[Ue]=be=Pe.insert(kt,t.source,0)),g[dt]=gL(Pe,dt,u[dt]).onAdd(be,k));for(dt=0,ct=x.data().length;dt<ct;++dt)at[dt]||(F[dt]!==k[dt]?X.push(dt):st[dt]&&k[dt]!==V&&te.push(dt));return x.mask=(1<<ue)-1,n},eval(e,t){const n=t.materialize().fork(),o=this._dims.length;let u=0;return t.rem.length&&(this.remove(e,t,n),u|=(1<<o)-1),e.modified("query")&&!e.modified("fields")&&(u|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),u|=(1<<o)-1),t.mod.length&&(this.modify(t,n),u|=(1<<o)-1),this.value.mask=u,n},insert(e,t,n){const o=t.add,u=this.value,f=this._dims,g=this._indices,x=e.fields,k={},F=n.add,V=u.size()+o.length,X=f.length;let te,ue,he,be=u.size();u.resize(V,X),u.add(o);const Pe=u.curr(),Ue=u.prev(),We=u.all();for(te=0;te<X;++te)he=k[ue=x[te].fname]||(k[ue]=g[ue].insert(x[te],o,be)),f[te].onAdd(he,Pe);for(;be<V;++be)Ue[be]=We,Pe[be]!==We&&F.push(be)},modify(e,t){const n=t.mod,o=this.value,u=o.curr(),f=o.all(),g=e.mod;let x,k,F;for(x=0,k=g.length;x<k;++x)u[F=g[x]._index]!==f&&n.push(F)},remove(e,t,n){const o=this._indices,u=this.value,f=u.curr(),g=u.prev(),x=u.all(),k={},F=n.rem,V=t.rem;let X,te,ue,he;for(X=0,te=V.length;X<te;++X)k[ue=V[X]._index]=1,g[ue]=he=f[ue],f[ue]=x,he!==x&&F.push(ue);for(ue in o)o[ue].remove(te,k);return this.reindex(t,te,k),k},reindex(e,t,n){const o=this._indices,u=this.value;e.runAfter(()=>{const f=u.remove(t,n);for(const g in o)o[g].reindex(f)})},update(e,t,n){const o=this._dims,u=e.query,f=t.stamp,g=o.length;let x,k,F=0;for(n.filters=0,k=0;k<g;++k)e.modified("query",k)&&(x=k,++F);if(F===1)F=o[x].one,this.incrementOne(o[x],u[x],n.add,n.rem);else for(k=0,F=0;k<g;++k)e.modified("query",k)&&(F|=o[k].one,this.incrementAll(o[k],u[k],f,n.add),n.rem=n.add);return F},incrementAll(e,t,n,o){const u=this.value,f=u.seen(),g=u.curr(),x=u.prev(),k=e.index(),F=e.bisect(e.range),V=e.bisect(t),X=V[0],te=V[1],ue=F[0],he=F[1],be=e.one;let Pe,Ue,We;if(X<ue)for(Pe=X,Ue=Math.min(ue,te);Pe<Ue;++Pe)f[We=k[Pe]]!==n&&(x[We]=g[We],f[We]=n,o.push(We)),g[We]^=be;else if(X>ue)for(Pe=ue,Ue=Math.min(X,he);Pe<Ue;++Pe)f[We=k[Pe]]!==n&&(x[We]=g[We],f[We]=n,o.push(We)),g[We]^=be;if(te>he)for(Pe=Math.max(X,he),Ue=te;Pe<Ue;++Pe)f[We=k[Pe]]!==n&&(x[We]=g[We],f[We]=n,o.push(We)),g[We]^=be;else if(te<he)for(Pe=Math.max(ue,te),Ue=he;Pe<Ue;++Pe)f[We=k[Pe]]!==n&&(x[We]=g[We],f[We]=n,o.push(We)),g[We]^=be;e.range=t.slice()},incrementOne(e,t,n,o){const u=this.value.curr(),f=e.index(),g=e.bisect(e.range),x=e.bisect(t),k=x[0],F=x[1],V=g[0],X=g[1],te=e.one;let ue,he,be;if(k<V)for(ue=k,he=Math.min(V,F);ue<he;++ue)u[be=f[ue]]^=te,n.push(be);else if(k>V)for(ue=V,he=Math.min(k,X);ue<he;++ue)u[be=f[ue]]^=te,o.push(be);if(F>X)for(ue=Math.max(k,X),he=F;ue<he;++ue)u[be=f[ue]]^=te,n.push(be);else if(F<X)for(ue=Math.max(V,F),he=X;ue<he;++ue)u[be=f[ue]]^=te,o.push(be);e.range=t.slice()}}),aD.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},Object(Ce.z)(aD,Mt,{transform(e,t){const n=~(e.ignore||0),o=e.filter,u=o.mask;if(!(u&n))return t.StopPropagation;const f=t.fork(t.ALL),g=o.data(),x=o.curr(),k=o.prev(),F=V=>x[V]&n?null:g[V];return f.filter(f.MOD,F),u&u-1?(f.filter(f.ADD,V=>{const X=x[V]&n;return!X&&X^k[V]&n?g[V]:null}),f.filter(f.REM,V=>{const X=x[V]&n;return X&&!(X^X^k[V]&n)?g[V]:null})):(f.filter(f.ADD,F),f.filter(f.REM,V=>(x[V]&n)===u?g[V]:null)),f.filter(f.SOURCE,V=>F(V._index))}});const pK="RawCode",Ww="Literal",mK="Property",gK="Identifier",vK="ArrayExpression",yK="BinaryExpression",yL="CallExpression",bK="ConditionalExpression",xK="LogicalExpression",wK="MemberExpression",_K="ObjectExpression",EK="UnaryExpression";function N0(e){this.type=e}var Ky,Bi,Vr,Yf,us;N0.prototype.visit=function(e){let t,n,o;if(e(this))return 1;for(n=0,o=(t=function(u){switch(u.type){case vK:return u.elements;case yK:case xK:return[u.left,u.right];case yL:return[u.callee].concat(u.arguments);case bK:return[u.test,u.consequent,u.alternate];case wK:return[u.object,u.property];case _K:return u.properties;case mK:return[u.key,u.value];case EK:return[u.argument];case gK:case Ww:case pK:default:return[]}}(this)).length;n<o;++n)if(t[n].visit(e))return 1};var gk=1,H_=2,dx=3,nb=4,vk=5,hx=6,bp=7,G_=8;(Ky={})[gk]="Boolean",Ky[H_]="<end>",Ky[dx]="Identifier",Ky[nb]="Keyword",Ky[vk]="Null",Ky[hx]="Numeric",Ky[bp]="Punctuator",Ky[G_]="String",Ky[9]="RegularExpression";var SK="ArrayExpression",CK="BinaryExpression",kK="CallExpression",AK="ConditionalExpression",bL="Identifier",OK="Literal",TK="LogicalExpression",MK="MemberExpression",DK="ObjectExpression",NK="Property",IK="UnaryExpression",yl="Unexpected token %0",FK="Unexpected number",RK="Unexpected string",PK="Unexpected identifier",LK="Unexpected reserved word",BK="Unexpected end of input",sD="Invalid regular expression",uD="Invalid regular expression: missing /",xL="Octal literals are not allowed in strict mode.",jK="Duplicate data property in object literal not allowed in strict mode",of="ILLEGAL",q_="Disabled.",zK=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),UK=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function yk(e,t){if(!e)throw new Error("ASSERT: "+t)}function Yy(e){return e>=48&&e<=57}function cD(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function $_(e){return"01234567".indexOf(e)>=0}function WK(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function X_(e){return e===10||e===13||e===8232||e===8233}function K_(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&zK.test(String.fromCharCode(e))}function bk(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&UK.test(String.fromCharCode(e))}const VK={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function wL(){for(;Vr<Yf;){const e=Bi.charCodeAt(Vr);if(!WK(e)&&!X_(e))break;++Vr}}function lD(e){var t,n,o,u=0;for(n=e==="u"?4:2,t=0;t<n;++t)Vr<Yf&&cD(Bi[Vr])?(o=Bi[Vr++],u=16*u+"0123456789abcdef".indexOf(o.toLowerCase())):Wa({},yl,of);return String.fromCharCode(u)}function HK(){var e,t,n,o;for(t=0,(e=Bi[Vr])==="}"&&Wa({},yl,of);Vr<Yf&&cD(e=Bi[Vr++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&Wa({},yl,of),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),o=56320+(t-65536&1023),String.fromCharCode(n,o))}function _L(){var e,t;for(e=Bi.charCodeAt(Vr++),t=String.fromCharCode(e),e===92&&(Bi.charCodeAt(Vr)!==117&&Wa({},yl,of),++Vr,(e=lD("u"))&&e!=="\\"&&K_(e.charCodeAt(0))||Wa({},yl,of),t=e);Vr<Yf&&bk(e=Bi.charCodeAt(Vr));)++Vr,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),Bi.charCodeAt(Vr)!==117&&Wa({},yl,of),++Vr,(e=lD("u"))&&e!=="\\"&&bk(e.charCodeAt(0))||Wa({},yl,of),t+=e);return t}function GK(){var e,t;return e=Vr,{type:(t=Bi.charCodeAt(Vr)===92?_L():function(){var n,o;for(n=Vr++;Vr<Yf;){if((o=Bi.charCodeAt(Vr))===92)return Vr=n,_L();if(!bk(o))break;++Vr}return Bi.slice(n,Vr)}()).length===1?dx:VK.hasOwnProperty(t)?nb:t==="null"?vk:t==="true"||t==="false"?gk:dx,value:t,start:e,end:Vr}}function fD(){var e,t,n,o,u=Vr,f=Bi.charCodeAt(Vr),g=Bi[Vr];switch(f){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Vr,{type:bp,value:String.fromCharCode(f),start:u,end:Vr};default:if((e=Bi.charCodeAt(Vr+1))===61)switch(f){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Vr+=2,{type:bp,value:String.fromCharCode(f)+String.fromCharCode(e),start:u,end:Vr};case 33:case 61:return Vr+=2,Bi.charCodeAt(Vr)===61&&++Vr,{type:bp,value:Bi.slice(u,Vr),start:u,end:Vr}}}return(o=Bi.substr(Vr,4))===">>>="?{type:bp,value:o,start:u,end:Vr+=4}:(n=o.substr(0,3))===">>>"||n==="<<="||n===">>="?{type:bp,value:n,start:u,end:Vr+=3}:g===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(g)>=0||t==="=>"?{type:bp,value:t,start:u,end:Vr+=2}:(t==="//"&&Wa({},yl,of),"<>=!+-*%&|^/".indexOf(g)>=0?{type:bp,value:g,start:u,end:++Vr}:void Wa({},yl,of))}function EL(){var e,t,n;if(yk(Yy((n=Bi[Vr]).charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=Vr,e="",n!=="."){if(e=Bi[Vr++],n=Bi[Vr],e==="0"){if(n==="x"||n==="X")return++Vr,function(o){let u="";for(;Vr<Yf&&cD(Bi[Vr]);)u+=Bi[Vr++];return u.length===0&&Wa({},yl,of),K_(Bi.charCodeAt(Vr))&&Wa({},yl,of),{type:hx,value:parseInt("0x"+u,16),start:o,end:Vr}}(t);if($_(n))return function(o){let u="0"+Bi[Vr++];for(;Vr<Yf&&$_(Bi[Vr]);)u+=Bi[Vr++];return(K_(Bi.charCodeAt(Vr))||Yy(Bi.charCodeAt(Vr)))&&Wa({},yl,of),{type:hx,value:parseInt(u,8),octal:!0,start:o,end:Vr}}(t);n&&Yy(n.charCodeAt(0))&&Wa({},yl,of)}for(;Yy(Bi.charCodeAt(Vr));)e+=Bi[Vr++];n=Bi[Vr]}if(n==="."){for(e+=Bi[Vr++];Yy(Bi.charCodeAt(Vr));)e+=Bi[Vr++];n=Bi[Vr]}if(n==="e"||n==="E")if(e+=Bi[Vr++],(n=Bi[Vr])!=="+"&&n!=="-"||(e+=Bi[Vr++]),Yy(Bi.charCodeAt(Vr)))for(;Yy(Bi.charCodeAt(Vr));)e+=Bi[Vr++];else Wa({},yl,of);return K_(Bi.charCodeAt(Vr))&&Wa({},yl,of),{type:hx,value:parseFloat(e),start:t,end:Vr}}function qK(){var e,t,n,o;return us=null,wL(),e=Vr,t=function(){var u,f,g,x;for(yk((u=Bi[Vr])==="/","Regular expression literal must start with a slash"),f=Bi[Vr++],g=!1,x=!1;Vr<Yf;)if(f+=u=Bi[Vr++],u==="\\")X_((u=Bi[Vr++]).charCodeAt(0))&&Wa({},uD),f+=u;else if(X_(u.charCodeAt(0)))Wa({},uD);else if(g)u==="]"&&(g=!1);else{if(u==="/"){x=!0;break}u==="["&&(g=!0)}return x||Wa({},uD),{value:f.substr(1,f.length-2),literal:f}}(),n=function(){var u,f,g;for(f="",g="";Vr<Yf&&bk((u=Bi[Vr]).charCodeAt(0));)++Vr,u==="\\"&&Vr<Yf?Wa({},yl,of):(g+=u,f+=u);return g.search(/[^gimuy]/g)>=0&&Wa({},sD,g),{value:g,literal:f}}(),o=function(u,f){let g=u;f.indexOf("u")>=0&&(g=g.replace(/\\u\{([0-9a-fA-F]+)\}/g,(x,k)=>{if(parseInt(k,16)<=1114111)return"x";Wa({},sD)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(g)}catch{Wa({},sD)}try{return new RegExp(u,f)}catch{return null}}(t.value,n.value),{literal:t.literal+n.literal,value:o,regex:{pattern:t.value,flags:n.value},start:e,end:Vr}}function SL(){if(wL(),Vr>=Yf)return{type:H_,start:Vr,end:Vr};const e=Bi.charCodeAt(Vr);return K_(e)?GK():e===40||e===41||e===59?fD():e===39||e===34?function(){var t,n,o,u,f="",g=!1;for(yk((t=Bi[Vr])==="'"||t==='"',"String literal must starts with a quote"),n=Vr,++Vr;Vr<Yf;){if((o=Bi[Vr++])===t){t="";break}if(o==="\\")if((o=Bi[Vr++])&&X_(o.charCodeAt(0)))o==="\r"&&Bi[Vr]===`
`&&++Vr;else switch(o){case"u":case"x":Bi[Vr]==="{"?(++Vr,f+=HK()):f+=lD(o);break;case"n":f+=`
`;break;case"r":f+="\r";break;case"t":f+="	";break;case"b":f+="\b";break;case"f":f+="\f";break;case"v":f+="\v";break;default:$_(o)?((u="01234567".indexOf(o))!==0&&(g=!0),Vr<Yf&&$_(Bi[Vr])&&(g=!0,u=8*u+"01234567".indexOf(Bi[Vr++]),"0123".indexOf(o)>=0&&Vr<Yf&&$_(Bi[Vr])&&(u=8*u+"01234567".indexOf(Bi[Vr++]))),f+=String.fromCharCode(u)):f+=o}else{if(X_(o.charCodeAt(0)))break;f+=o}}return t!==""&&Wa({},yl,of),{type:G_,value:f,octal:g,start:n,end:Vr}}():e===46?Yy(Bi.charCodeAt(Vr+1))?EL():fD():Yy(e)?EL():fD()}function xp(){const e=us;return Vr=e.end,us=SL(),Vr=e.end,e}function CL(){const e=Vr;us=SL(),Vr=e}function kL(e,t,n){const o=new N0(e==="||"||e==="&&"?TK:CK);return o.operator=e,o.left=t,o.right=n,o}function $K(e,t){const n=new N0(kK);return n.callee=e,n.arguments=t,n}function dD(e){const t=new N0(bL);return t.name=e,t}function Y_(e){const t=new N0(OK);return t.value=e.value,t.raw=Bi.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function AL(e,t,n){const o=new N0(MK);return o.computed=e==="[",o.object=t,o.property=n,o.computed||(n.member=!0),o}function OL(e,t,n){const o=new N0(NK);return o.key=t,o.value=n,o.kind=e,o}function Wa(e,t){var n,o=Array.prototype.slice.call(arguments,2),u=t.replace(/%(\d)/g,(f,g)=>(yk(g<o.length,"Message reference must be in range"),o[g]));throw(n=new Error(u)).index=Vr,n.description=u,n}function xk(e){e.type===H_&&Wa(e,BK),e.type===hx&&Wa(e,FK),e.type===G_&&Wa(e,RK),e.type===dx&&Wa(e,PK),e.type===nb&&Wa(e,LK),Wa(e,yl,e.value)}function Jf(e){const t=xp();t.type===bp&&t.value===e||xk(t)}function eu(e){return us.type===bp&&us.value===e}function hD(e){return us.type===nb&&us.value===e}function XK(){const e=[];for(Vr=us.start,Jf("[");!eu("]");)eu(",")?(xp(),e.push(null)):(e.push(px()),eu("]")||Jf(","));return xp(),function(t){const n=new N0(SK);return n.elements=t,n}(e)}function TL(){Vr=us.start;const e=xp();return e.type===G_||e.type===hx?(e.octal&&Wa(e,xL),Y_(e)):dD(e.value)}function KK(){var e,t,n;return Vr=us.start,(e=us).type===dx?(n=TL(),Jf(":"),OL("init",n,px())):e.type!==H_&&e.type!==bp?(t=TL(),Jf(":"),OL("init",t,px())):void xk(e)}function YK(){var e,t,n=[],o={},u=String;for(Vr=us.start,Jf("{");!eu("}");)t="$"+((e=KK()).key.type===bL?e.key.name:u(e.key.value)),Object.prototype.hasOwnProperty.call(o,t)?Wa({},jK):o[t]=!0,n.push(e),eu("}")||Jf(",");return Jf("}"),function(f){const g=new N0(DK);return g.properties=f,g}(n)}const JK={if:1};function QK(){var e,t,n;if(eu("("))return function(){Jf("(");const o=pD();return Jf(")"),o}();if(eu("["))return XK();if(eu("{"))return YK();if(e=us.type,Vr=us.start,e===dx||JK[us.value])n=dD(xp().value);else if(e===G_||e===hx)us.octal&&Wa(us,xL),n=Y_(xp());else{if(e===nb)throw new Error(q_);e===gk?((t=xp()).value=t.value==="true",n=Y_(t)):e===vk?((t=xp()).value=null,n=Y_(t)):eu("/")||eu("/=")?(n=Y_(qK()),CL()):xk(xp())}return n}function ZK(){const e=[];if(Jf("("),!eu(")"))for(;Vr<Yf&&(e.push(px()),!eu(")"));)Jf(",");return Jf(")"),e}function eY(){Vr=us.start;const e=xp();return function(t){return t.type===dx||t.type===nb||t.type===gk||t.type===vk}(e)||xk(e),dD(e.value)}function tY(){Jf("[");const e=pD();return Jf("]"),e}function ML(){const e=function(){var t;for(t=QK();;)if(eu("."))Jf("."),t=AL(".",t,eY());else if(eu("("))t=$K(t,ZK());else{if(!eu("["))break;t=AL("[",t,tY())}return t}();if(us.type===bp&&(eu("++")||eu("--")))throw new Error(q_);return e}function wk(){var e,t;if(us.type!==bp&&us.type!==nb)t=ML();else{if(eu("++")||eu("--"))throw new Error(q_);if(eu("+")||eu("-")||eu("~")||eu("!"))e=xp(),t=wk(),t=function(n,o){const u=new N0(IK);return u.operator=n,u.argument=o,u.prefix=!0,u}(e.value,t);else{if(hD("delete")||hD("void")||hD("typeof"))throw new Error(q_);t=ML()}}return t}function DL(e){let t=0;if(e.type!==bp&&e.type!==nb)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function px(){var e,t;return e=function(){var n,o,u,f,g,x,k,F,V,X;if(n=us,V=wk(),(g=DL(f=us))===0)return V;for(f.prec=g,xp(),o=[n,us],x=[V,f,k=wk()];(g=DL(us))>0;){for(;x.length>2&&g<=x[x.length-2].prec;)k=x.pop(),F=x.pop().value,V=x.pop(),o.pop(),u=kL(F,V,k),x.push(u);(f=xp()).prec=g,x.push(f),o.push(us),u=wk(),x.push(u)}for(u=x[X=x.length-1],o.pop();X>1;)o.pop(),u=kL(x[X-1].value,x[X-2],u),X-=2;return u}(),eu("?")&&(xp(),t=px(),Jf(":"),e=function(n,o,u){const f=new N0(AK);return f.test=n,f.consequent=o,f.alternate=u,f}(e,t,px())),e}function pD(){const e=px();if(eu(","))throw new Error(q_);return e}var NL={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function IL(e){function t(o,u,f){return g=>function(x,k,F,V){let X=e(k[0]);return F&&(X=F+"("+X+")",F.lastIndexOf("new ",0)===0&&(X="("+X+")")),X+"."+x+(V<0?"":V===0?"()":"("+k.slice(1).map(e).join(",")+")")}(o,g,u,f)}const n="new Date";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(o){o.length<3&&Object(Ce.o)("Missing arguments to clamp function."),o.length>3&&Object(Ce.o)("Too many arguments to clamp function.");const u=o.map(e);return"Math.max("+u[1]+", Math.min("+u[2]+","+u[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase","String",0),lower:t("toLowerCase","String",0),substring:t("substring","String"),split:t("split","String"),trim:t("trim","String",0),regexp:"RegExp",test:t("test","RegExp"),if:function(o){o.length<3&&Object(Ce.o)("Missing arguments to if function."),o.length>3&&Object(Ce.o)("Too many arguments to if function.");const u=o.map(e);return"("+u[0]+"?"+u[1]+":"+u[2]+")"}}}var FL,RL,mD,gD,vD,_k=new rh,Ek=new rh,ty={point:rf,lineStart:rf,lineEnd:rf,polygonStart:function(){_k=new rh,ty.lineStart=nY,ty.lineEnd=rY},polygonEnd:function(){var e=+_k;Ek.add(e<0?ih+e:e),this.lineStart=this.lineEnd=this.point=rf},sphere:function(){Ek.add(ih)}};function nY(){ty.point=iY}function rY(){PL(FL,RL)}function iY(e,t){ty.point=PL,FL=e,RL=t,mD=e*=ea,gD=lo(t=(t*=ea)/2+TC),vD=Yi(t)}function PL(e,t){t=(t*=ea)/2+TC;var n=(e*=ea)-mD,o=n>=0?1:-1,u=o*n,f=lo(t),g=Yi(t),x=vD*g,k=gD*f+x*lo(u),F=x*o*Yi(u);_k.add(Dg(F,k)),mD=e,gD=f,vD=g}var Ou,wp,Uu,Pm,mx,LL,BL,Vw,J_,rb,Jy,Qy={point:yD,lineStart:zL,lineEnd:UL,polygonStart:function(){Qy.point=WL,Qy.lineStart=oY,Qy.lineEnd=aY,J_=new rh,ty.polygonStart()},polygonEnd:function(){ty.polygonEnd(),Qy.point=yD,Qy.lineStart=zL,Qy.lineEnd=UL,_k<0?(Ou=-(Uu=180),wp=-(Pm=90)):J_>oo?Pm=90:J_<-oo&&(wp=-90),Jy[0]=Ou,Jy[1]=Uu},sphere:function(){Ou=-(Uu=180),wp=-(Pm=90)}};function yD(e,t){rb.push(Jy=[Ou=e,Uu=e]),t<wp&&(wp=t),t>Pm&&(Pm=t)}function jL(e,t){var n=sx([e*ea,t*ea]);if(Vw){var o=Fw(Vw,n),u=Fw([o[1],-o[0],0],o);VC(u),u=zC(u);var f,g=e-mx,x=g>0?1:-1,k=u[0]*ac*x,F=ka(g)>180;F^(x*mx<k&&k<x*e)?(f=u[1]*ac)>Pm&&(Pm=f):F^(x*mx<(k=(k+360)%360-180)&&k<x*e)?(f=-u[1]*ac)<wp&&(wp=f):(t<wp&&(wp=t),t>Pm&&(Pm=t)),F?e<mx?Lm(Ou,e)>Lm(Ou,Uu)&&(Uu=e):Lm(e,Uu)>Lm(Ou,Uu)&&(Ou=e):Uu>=Ou?(e<Ou&&(Ou=e),e>Uu&&(Uu=e)):e>mx?Lm(Ou,e)>Lm(Ou,Uu)&&(Uu=e):Lm(e,Uu)>Lm(Ou,Uu)&&(Ou=e)}else rb.push(Jy=[Ou=e,Uu=e]);t<wp&&(wp=t),t>Pm&&(Pm=t),Vw=n,mx=e}function zL(){Qy.point=jL}function UL(){Jy[0]=Ou,Jy[1]=Uu,Qy.point=yD,Vw=null}function WL(e,t){if(Vw){var n=e-mx;J_.add(ka(n)>180?n+(n>0?360:-360):n)}else LL=e,BL=t;ty.point(e,t),jL(e,t)}function oY(){ty.lineStart()}function aY(){WL(LL,BL),ty.lineEnd(),ka(J_)>oo&&(Ou=-(Uu=180)),Jy[0]=Ou,Jy[1]=Uu,Vw=null}function Lm(e,t){return(t-=e)<0?t+360:t}function sY(e,t){return e[0]-t[0]}function VL(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var Sk,Ck,kk,Ak,Ok,Tk,Mk,Dk,bD,xD,wD,HL,GL,lh,fh,dh,I0={sphere:rf,point:_D,lineStart:qL,lineEnd:$L,polygonStart:function(){I0.lineStart=lY,I0.lineEnd=fY},polygonEnd:function(){I0.lineStart=qL,I0.lineEnd=$L}};function _D(e,t){e*=ea;var n=lo(t*=ea);Q_(n*lo(e),n*Yi(e),Yi(t))}function Q_(e,t,n){kk+=(e-kk)/++Sk,Ak+=(t-Ak)/Sk,Ok+=(n-Ok)/Sk}function qL(){I0.point=uY}function uY(e,t){e*=ea;var n=lo(t*=ea);lh=n*lo(e),fh=n*Yi(e),dh=Yi(t),I0.point=cY,Q_(lh,fh,dh)}function cY(e,t){e*=ea;var n=lo(t*=ea),o=n*lo(e),u=n*Yi(e),f=Yi(t),g=Dg(oh((g=fh*f-dh*u)*g+(g=dh*o-lh*f)*g+(g=lh*u-fh*o)*g),lh*o+fh*u+dh*f);Ck+=g,Tk+=g*(lh+(lh=o)),Mk+=g*(fh+(fh=u)),Dk+=g*(dh+(dh=f)),Q_(lh,fh,dh)}function $L(){I0.point=_D}function lY(){I0.point=dY}function fY(){XL(HL,GL),I0.point=_D}function dY(e,t){HL=e,GL=t,e*=ea,t*=ea,I0.point=XL;var n=lo(t);lh=n*lo(e),fh=n*Yi(e),dh=Yi(t),Q_(lh,fh,dh)}function XL(e,t){e*=ea;var n=lo(t*=ea),o=n*lo(e),u=n*Yi(e),f=Yi(t),g=fh*f-dh*u,x=dh*o-lh*f,k=lh*u-fh*o,F=jT(g,x,k),V=yp(F),X=F&&-V/F;bD.add(X*g),xD.add(X*x),wD.add(X*k),Ck+=V,Tk+=V*(lh+(lh=o)),Mk+=V*(fh+(fh=u)),Dk+=V*(dh+(dh=f)),Q_(lh,fh,dh)}const hY="Literal";var Zy,pY=1,mY=2,gY=3,vY=4,yY=5,bY=6,xY=7,wY=8;(Zy={})[pY]="Boolean",Zy[mY]="<end>",Zy[gY]="Identifier",Zy[vY]="Keyword",Zy[yY]="Null",Zy[bY]="Numeric",Zy[xY]="Punctuator",Zy[wY]="String",Zy[9]="RegularExpression";const ED="intersect",KL="union",_Y="vlMulti",EY="vlPoint",YL="or",SY="and",CY="E",kY="R",AY="R-E",OY="R-LE",TY="R-RE",Nk="index:unit";function JL(e,t){for(var n,o,u=t.fields,f=t.values,g=u.length,x=0;x<g;++x)if((o=u[x]).getter=Ce.u.getter||Object(Ce.u)(o.field),n=o.getter(e),Object(Ce.D)(n)&&(n=Object(Ce.Ea)(n)),Object(Ce.D)(f[x])&&(f[x]=Object(Ce.Ea)(f[x])),Object(Ce.D)(f[x][0])&&(f[x]=f[x].map(Ce.Ea)),o.type===CY){if(Object(Ce.B)(f[x])?f[x].indexOf(n)<0:n!==f[x])return!1}else if(o.type===kY){if(!Object(Ce.A)(n,f[x]))return!1}else if(o.type===TY){if(!Object(Ce.A)(n,f[x],!0,!1))return!1}else if(o.type===AY){if(!Object(Ce.A)(n,f[x],!1,!1))return!1}else if(o.type===OY&&!Object(Ce.A)(n,f[x],!1,!0))return!1;return!0}const SD=Object(Ce.u)("_vgsid_"),QL=function(e){let t=e,n=e;function o(u,f,g,x){for(g==null&&(g=0),x==null&&(x=u.length);g<x;){const k=g+x>>>1;n(u[k],f)<0?g=k+1:x=k}return g}return e.length===1&&(t=(u,f)=>e(u)-f,n=function(u){return(f,g)=>function(x,k){return x<k?-1:x>k?1:x>=k?0:NaN}(u(f),g)}(e)),{left:o,center:function(u,f,g,x){g==null&&(g=0),x==null&&(x=u.length);const k=o(u,f,g,x-1);return k>g&&t(u[k-1],f)>-t(u[k],f)?k-1:k},right:function(u,f,g,x){for(g==null&&(g=0),x==null&&(x=u.length);g<x;){const k=g+x>>>1;n(u[k],f)>0?x=k:g=k+1}return g}}}(SD),MY=QL.left,DY=QL.right;var ZL={E_union:function(e,t){if(!e.length)return t;for(var n=0,o=t.length;n<o;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter(n=>t.indexOf(n)>=0):t},R_union:function(e,t){var n=Object(Ce.Ea)(t[0]),o=Object(Ce.Ea)(t[1]);return n>o&&(n=t[1],o=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<o&&(e[1]=o),e):[n,o]},R_intersect:function(e,t){var n=Object(Ce.Ea)(t[0]),o=Object(Ce.Ea)(t[1]);return n>o&&(n=t[1],o=t[0]),e.length?o<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>o&&(e[1]=o),e):[n,o]}};const NY=":",IY="@";function CD(e,t,n,o){t[0].type!==hY&&Object(Ce.o)("First argument to selection functions must be a string literal.");const u=t[0].value,f=t.length>=2&&Object(Ce.W)(t).value,g=IY+"unit",x=NY+u;f!==ED||Object(Ce.w)(o,g)||(o[g]=n.getData(u).indataRef(n,"unit")),Object(Ce.w)(o,x)||(o[x]=n.getData(u).tuplesRef())}function eB(e){const t=this.context.data[e];return t?t.values.value:[]}const Z_=e=>function(t,n){return this.context.dataflow.locale()[e](n)(t)},FY=Z_("format"),tB=Z_("timeFormat"),RY=Z_("utcFormat"),PY=Z_("timeParse"),LY=Z_("utcParse"),Ik=new Date(2e3,0,1);function Fk(e,t,n){return Number.isInteger(e)&&Number.isInteger(t)?(Ik.setYear(2e3),Ik.setMonth(e),Ik.setDate(t),tB.call(this,Ik,n)):""}const BY=":",jY="@",kD="%",nB="$";function AD(e,t,n,o){t[0].type!==Ww&&Object(Ce.o)("First argument to data functions must be a string literal.");const u=t[0].value,f=BY+u;if(!Object(Ce.w)(f,o))try{o[f]=n.getData(u).tuplesRef()}catch{}}function _p(e,t,n,o){if(t[0].type===Ww)rB(n,o,t[0].value);else for(e in n.scales)rB(n,o,e)}function rB(e,t,n){const o=kD+n;if(!Object(Ce.w)(t,o))try{t[o]=e.scaleRef(n)}catch{}}function e1(e,t){let n;return Object(Ce.E)(e)?e:Object(Ce.J)(e)?(n=t.scales[e])&&n.value:void 0}function OD(e,t){return function(n,o,u){if(n){const f=e1(n,(u||this).context);return f&&f.path[e](o)}return t(o)}}const zY=OD("area",function(e){return Ek=new rh,Gy(e,ty),2*Ek}),UY=OD("bounds",function(e){var t,n,o,u,f,g,x;if(Pm=Uu=-(Ou=wp=1/0),rb=[],Gy(e,Qy),n=rb.length){for(rb.sort(sY),t=1,f=[o=rb[0]];t<n;++t)VL(o,(u=rb[t])[0])||VL(o,u[1])?(Lm(o[0],u[1])>Lm(o[0],o[1])&&(o[1]=u[1]),Lm(u[0],o[1])>Lm(o[0],o[1])&&(o[0]=u[0])):f.push(o=u);for(g=-1/0,t=0,o=f[n=f.length-1];t<=n;o=u,++t)u=f[t],(x=Lm(o[1],u[0]))>g&&(g=x,Ou=u[0],Uu=o[1])}return rb=Jy=null,Ou===1/0||wp===1/0?[[NaN,NaN],[NaN,NaN]]:[[Ou,wp],[Uu,Pm]]}),WY=OD("centroid",function(e){Sk=Ck=kk=Ak=Ok=Tk=Mk=Dk=0,bD=new rh,xD=new rh,wD=new rh,Gy(e,I0);var t=+bD,n=+xD,o=+wD,u=jT(t,n,o);return u<1e-12&&(t=Tk,n=Mk,o=Dk,Ck<oo&&(t=kk,n=Ak,o=Ok),(u=jT(t,n,o))<1e-12)?[NaN,NaN]:[Dg(n,t)*ac,yp(o/u)*ac]});function TD(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(o){e.warn(o)}return n[n.length-1]}function MD(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function DD(e){const t=un(e);return .2126*MD(t.r)+.7152*MD(t.g)+.0722*MD(t.b)}function iB(e,t){return e===t||e!=e&&t!=t||(Object(Ce.B)(e)?!(!Object(Ce.B)(t)||e.length!==t.length)&&function(n,o){for(let u=0,f=n.length;u<f;++u)if(!iB(n[u],o[u]))return!1;return!0}(e,t):!(!Object(Ce.H)(e)||!Object(Ce.H)(t))&&oB(e,t))}function oB(e,t){for(const n in e)if(!iB(e[n],t[n]))return!1;return!0}function aB(e){return t=>oB(e,t)}const sB={};function ND(e){return Object(Ce.B)(e)||ArrayBuffer.isView(e)?e:null}function ID(e){return ND(e)||(Object(Ce.J)(e)?e:null)}const uB=e=>e.data;function cB(e,t){const n=eB.call(t,e);return n.root&&n.root.lookup||{}}const lB=()=>typeof window<"u"&&window||null,eE={random:()=>Kn(),cumulativeNormal:ro,cumulativeLogNormal:Up,cumulativeUniform:kh,densityNormal:Ch,densityLogNormal:tl,densityUniform:hd,quantileNormal:Mc,quantileLogNormal:xs,quantileUniform:nl,sampleNormal:Ds,sampleLogNormal:fc,sampleUniform:dc,isArray:Ce.B,isBoolean:Ce.C,isDate:Ce.D,isDefined:e=>e!==void 0,isNumber:Ce.G,isObject:Ce.H,isRegExp:Ce.I,isString:Ce.J,isTuple:Vt,isValid:e=>e!=null&&e==e,toBoolean:Ce.Ca,toDate:Ce.Da,toNumber:Ce.Ea,toString:Ce.Ga,indexof:function(e,...t){return ID(e).indexOf(...t)},join:function(e,...t){return ND(e).join(...t)},lastindexof:function(e,...t){return ID(e).lastIndexOf(...t)},replace:function(e,t,n){return Object(Ce.E)(n)&&Object(Ce.o)("Function argument passed to replace."),String(e).replace(t,n)},reverse:function(e){return ND(e).slice().reverse()},slice:function(e,...t){return ID(e).slice(...t)},flush:Ce.v,lerp:Ce.L,merge:function(){const e=[].slice.call(arguments);return e.unshift({}),Object(Ce.p)(...e)},pad:Ce.R,peek:Ce.W,pluck:function(e,t){const n=sB[t]||(sB[t]=Object(Ce.u)(t));return Object(Ce.B)(e)?e.map(n):n(e)},span:Ce.Z,inrange:Ce.A,truncate:Ce.Ha,rgb:un,lab:Hl,hcl:nc,hsl:pr,luminance:DD,contrast:function(e,t){const n=DD(e),o=DD(t);return(Math.max(n,o)+.05)/(Math.min(n,o)+.05)},sequence:Ns,format:FY,utcFormat:RY,utcParse:LY,utcOffset:br.w,utcSequence:br.x,timeFormat:tB,timeParse:PY,timeOffset:br.q,timeSequence:br.r,timeUnitSpecifier:br.s,monthFormat:function(e){return Fk.call(this,e,1,"%B")},monthAbbrevFormat:function(e){return Fk.call(this,e,1,"%b")},dayFormat:function(e){return Fk.call(this,0,2+e,"%A")},dayAbbrevFormat:function(e){return Fk.call(this,0,2+e,"%a")},quarter:Ce.X,utcquarter:Ce.Ja,week:br.A,utcweek:br.z,dayofyear:br.m,utcdayofyear:br.y,warn:function(){return TD(this.context.dataflow,"warn",arguments)},info:function(){return TD(this.context.dataflow,"info",arguments)},debug:function(){return TD(this.context.dataflow,"debug",arguments)},extent:Ce.q,inScope:function(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},intersect:function(e,t,n){if(!e)return[];const[o,u]=e,f=new as().set(o[0],o[1],u[0],u[1]);return Pr(n||this.context.dataflow.scenegraph().root,f,function(g){let x=null;if(g){const k=Object(Ce.i)(g.marktype),F=Object(Ce.i)(g.markname);x=V=>(!k.length||k.some(X=>V.marktype===X))&&(!F.length||F.some(X=>V.name===X))}return x}(t))},clampRange:Ce.k,pinchDistance:function(e){const t=e.touches,n=t[0].clientX-t[1].clientX,o=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+o*o)},pinchAngle:function(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)},screen:function(){const e=lB();return e?e.screen:{}},containerSize:function(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]},windowSize:function(){const e=lB();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]},bandspace:function(e,t,n){return ug(e||0,t||0,n||0)},setdata:function(e,t){const n=this.context.dataflow,o=this.context.data[e].input;return n.pulse(o,n.changeset().remove(Ce.Ia).insert(t)),1},pathShape:function(e){let t=null;return function(n){return n?op(n,t=t||rp(e)):e}},panLinear:Ce.S,panLog:Ce.T,panPow:Ce.U,panSymlog:Ce.V,zoomLinear:Ce.Na,zoomLog:Ce.Oa,zoomPow:Ce.Pa,zoomSymlog:Ce.Qa,encode:function(e,t,n){if(e){const o=this.context.dataflow,u=e.mark.source;o.pulse(u,o.changeset().encode(e,t))}return n!==void 0?n:e},modify:function(e,t,n,o,u,f){const g=this.context.dataflow,x=this.context.data[e],k=x.input,F=g.stamp();let V,X,te=x.changes;if(g._trigger===!1||!(k.value.length||t||o))return 0;if((!te||te.stamp<F)&&(x.changes=te=g.changeset(),te.stamp=F,g.runAfter(()=>{x.modified=!0,g.pulse(k,te).run()},!0,1)),n&&(V=n===!0?Ce.Ia:Object(Ce.B)(n)||Vt(n)?n:aB(n),te.remove(V)),t&&te.insert(t),o&&(V=aB(o),k.value.some(V)?te.remove(V):te.insert(o)),u)for(X in f)te.modify(u,X,f[X]);return 1}},VY=["view","item","group","xy","x","y"],HY="event.vega.",fB="this.",FD={},dB={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>`_[${Object(Ce.Ba)(nB+e)}]`,functions:function(e){const t=IL(e);VY.forEach(n=>t[n]=HY+n);for(const n in eE)t[n]=fB+n;return Object(Ce.p)(t,function(n,o,u){o.__bandwidth=g=>g&&g.bandwidth?g.bandwidth():0,u._bandwidth=_p,u._range=_p,u._scale=_p;const f=g=>"_["+(g.type===Ww?Object(Ce.Ba)(kD+g.value):Object(Ce.Ba)(kD)+"+"+n(g))+"]";return{_bandwidth:g=>`this.__bandwidth(${f(g[0])})`,_range:g=>`${f(g[0])}.range()`,_scale:g=>`${f(g[0])}(${n(g[1])})`}}(e,eE,FD)),t},constants:NL,visitors:FD},RD=function(e){const t=(e=e||{}).allowed?Object(Ce.Fa)(e.allowed):{},n=e.forbidden?Object(Ce.Fa)(e.forbidden):{},o=e.constants||NL,u=(e.functions||IL)(X),f=e.globalvar,g=e.fieldvar,x=Object(Ce.E)(f)?f:he=>`${f}["${he}"]`;let k={},F={},V=0;function X(he){if(Object(Ce.J)(he))return he;const be=te[he.type];return be==null&&Object(Ce.o)("Unsupported type: "+he.type),be(he)}const te={Literal:he=>he.raw,Identifier:he=>{const be=he.name;return V>0?be:Object(Ce.w)(n,be)?Object(Ce.o)("Illegal identifier: "+be):Object(Ce.w)(o,be)?o[be]:Object(Ce.w)(t,be)?be:(k[be]=1,x(be))},MemberExpression:he=>{const be=!he.computed,Pe=X(he.object);be&&(V+=1);const Ue=X(he.property);return Pe===g&&(F[function(We){const at=We&&We.length-1;return at&&(We[0]==='"'&&We[at]==='"'||We[0]==="'"&&We[at]==="'")?We.slice(1,-1):We}(Ue)]=1),be&&(V-=1),Pe+(be?"."+Ue:"["+Ue+"]")},CallExpression:he=>{he.callee.type!=="Identifier"&&Object(Ce.o)("Illegal callee type: "+he.callee.type);const be=he.callee.name,Pe=he.arguments,Ue=Object(Ce.w)(u,be)&&u[be];return Ue||Object(Ce.o)("Unrecognized function: "+be),Object(Ce.E)(Ue)?Ue(Pe):Ue+"("+Pe.map(X).join(",")+")"},ArrayExpression:he=>"["+he.elements.map(X).join(",")+"]",BinaryExpression:he=>"("+X(he.left)+" "+he.operator+" "+X(he.right)+")",UnaryExpression:he=>"("+he.operator+X(he.argument)+")",ConditionalExpression:he=>"("+X(he.test)+"?"+X(he.consequent)+":"+X(he.alternate)+")",LogicalExpression:he=>"("+X(he.left)+he.operator+X(he.right)+")",ObjectExpression:he=>"{"+he.properties.map(X).join(",")+"}",Property:he=>{V+=1;const be=X(he.key);return V-=1,be+":"+X(he.value)}};function ue(he){const be={code:X(he),globals:Object.keys(k),fields:Object.keys(F)};return k={},F={},be}return ue.functions=u,ue.constants=o,ue}(dB);function Sc(e,t,n){return arguments.length===1?eE[e]:(eE[e]=t,n&&(FD[e]=n),RD&&(RD.functions[e]=fB+e),this)}function ny(e,t){const n={};let o;try{o=function(f){Vr=0,Yf=(Bi=f).length,us=null,CL();const g=pD();if(us.type!==H_)throw new Error("Unexpect token after expression.");return g}(e=Object(Ce.J)(e)?e:Object(Ce.Ba)(e)+"")}catch{Object(Ce.o)("Expression parse error: "+e)}o.visit(f=>{if(f.type!==yL)return;const g=f.callee.name,x=dB.visitors[g];x&&x(g,f.arguments,t,n)});const u=RD(o);return u.globals.forEach(f=>{const g=nB+f;!Object(Ce.w)(n,g)&&t.getSignal(f)&&(n[g]=t.signalRef(f))}),{$expr:Object(Ce.p)({code:u.code},t.options.ast?{ast:o}:null),$fields:u.fields,$params:n}}Sc("bandwidth",function(e,t){const n=e1(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0},_p),Sc("copy",function(e,t){const n=e1(e,(t||this).context);return n?n.copy():void 0},_p),Sc("domain",function(e,t){const n=e1(e,(t||this).context);return n?n.domain():[]},_p),Sc("range",function(e,t){const n=e1(e,(t||this).context);return n&&n.range?n.range():[]},_p),Sc("invert",function(e,t,n){const o=e1(e,(n||this).context);return o?Object(Ce.B)(t)?(o.invertRange||o.invert)(t):(o.invert||o.invertExtent)(t):void 0},_p),Sc("scale",function(e,t,n){const o=e1(e,(n||this).context);return o?o(t):void 0},_p),Sc("gradient",function(e,t,n,o,u){e=e1(e,(u||this).context);const f=w0(t,n);let g=e.domain(),x=g[0],k=Object(Ce.W)(g),F=Ce.y;return k-x?F=tp(e,x,k):e=(e.interpolator?Vo("sequential")().interpolator(e.interpolator()):Vo("linear")().interpolate(e.interpolate()).range(e.range())).domain([x=0,k=1]),e.ticks&&(x!==(g=e.ticks(+o||15))[0]&&g.unshift(x),k!==Object(Ce.W)(g)&&g.push(k)),g.forEach(V=>f.stop(F(V),e(V))),f},_p),Sc("geoArea",zY,_p),Sc("geoBounds",UY,_p),Sc("geoCentroid",WY,_p),Sc("geoShape",function(e,t,n){const o=e1(e,(n||this).context);return function(u){return o?o.path.context(u)(t):""}},_p),Sc("indata",function(e,t,n){const o=this.context.data[e]["index:"+t],u=o?o.value.get(n):void 0;return u&&u.count},function(e,t,n,o){t[0].type!==Ww&&Object(Ce.o)("First argument to indata must be a string literal."),t[1].type!==Ww&&Object(Ce.o)("Second argument to indata must be a string literal.");const u=t[0].value,f=t[1].value,g=jY+f;Object(Ce.w)(g,o)||(o[g]=n.getData(u).indataRef(n,f))}),Sc("data",eB,AD),Sc("treePath",function(e,t,n){const o=cB(e,this),u=o[t],f=o[n];return u&&f?u.path(f).map(uB):void 0},AD),Sc("treeAncestors",function(e,t){const n=cB(e,this)[t];return n?n.ancestors().map(uB):void 0},AD),Sc("vlSelectionTest",function(e,t,n){for(var o,u,f,g,x,k=this.context.data[e],F=k?k.values.value:[],V=k?k[Nk]&&k[Nk].value:void 0,X=n===ED,te=F.length,ue=0;ue<te;++ue)if(o=F[ue],V&&X){if((f=(u=u||{})[g=o.unit]||0)===-1)continue;if(x=JL(t,o),u[g]=x?-1:++f,x&&V.size===1)return!0;if(!x&&f===V.get(g).count)return!1}else if(X^(x=JL(t,o)))return x;return te&&X},CD),Sc("vlSelectionIdTest",function(e,t,n){const o=this.context.data[e],u=o?o.values.value:[],f=o?o[Nk]&&o[Nk].value:void 0,g=n===ED,x=SD(t),k=MY(u,x);if(k===u.length||SD(u[k])!==x)return!1;if(f&&g){if(f.size===1)return!0;if(DY(u,x)-k<f.size)return!1}return!0},CD),Sc("vlSelectionResolve",function(e,t,n,o){for(var u,f,g,x,k,F,V,X,te,ue,he,be=this.context.data[e],Pe=be?be.values.value:[],Ue={},We={},at={},st=Pe.length,dt=0;dt<st;++dt){for(x=(u=Pe[dt]).unit,f=u.fields,g=u.values,ue=0,he=f.length;ue<he;++ue)k=f[ue],V=(F=Ue[k.field]||(Ue[k.field]={}))[x]||(F[x]=[]),at[k.field]=X=k.type.charAt(0),te=ZL[X+"_union"],F[x]=te(V,Object(Ce.i)(g[ue]));n&&(V=We[x]||(We[x]=[])).push(Object(Ce.i)(g).reduce((ct,kt,St)=>(ct[f[St].field]=kt,ct),{}))}return t=t||KL,Object.keys(Ue).forEach(ct=>{Ue[ct]=Object.keys(Ue[ct]).map(kt=>Ue[ct][kt]).reduce((kt,St)=>kt===void 0?St:ZL[at[ct]+"_"+t](kt,St))}),Pe=Object.keys(We),n&&Pe.length&&(Ue[o?EY:_Y]=t===KL?{[YL]:Pe.reduce((ct,kt)=>(ct.push(...We[kt]),ct),[])}:{[SY]:Pe.map(ct=>({[YL]:We[ct]}))}),Ue},CD),Sc("vlSelectionTuples",function(e,t){return e.map(n=>Object(Ce.p)({values:t.fields.map(o=>(o.getter||(o.getter=Object(Ce.u)(o.field)))(n.datum))},t))});const GY=Object(Ce.Fa)(["rule"]),hB=Object(Ce.Fa)(["group","image","rect"]);function PD(e){return(e+"").toLowerCase()}function tE(e,t,n){n[n.length-1]!==";"&&(n="return("+n+");");const o=Function(...t.concat(n));return e&&e.functions?o.bind(e.functions):o}var qY={operator:(e,t)=>tE(e,["_"],t.code),parameter:(e,t)=>tE(e,["datum","_"],t.code),event:(e,t)=>tE(e,["event"],t.code),handler:(e,t)=>tE(e,["_","event"],"var datum=event.item&&event.item.datum;return ".concat(t.code,";")),encode:(e,t)=>{const{marktype:n,channels:o}=t;let u="var o=item,datum=o.datum,m=0,$;";for(const f in o){const g="o["+Object(Ce.Ba)(f)+"]";u+="$=".concat(o[f].code,";if(").concat(g,"!==$)").concat(g,"=$,m=1;")}return u+=function(f,g){let x="";return GY[g]||(f.x2&&(f.x?(hB[g]&&(x+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),x+="o.width=o.x2-o.x;"):x+="o.x=o.x2-(o.width||0);"),f.xc&&(x+="o.x=o.xc-(o.width||0)/2;"),f.y2&&(f.y?(hB[g]&&(x+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),x+="o.height=o.y2-o.y;"):x+="o.y=o.y2-(o.height||0);"),f.yc&&(x+="o.y=o.yc-(o.height||0)/2;")),x}(o,n),tE(e,["item","_"],u+="return m;")},codegen:{get(e){const t="[".concat(e.map(Ce.Ba).join("]["),"]"),n=Function("_","return _".concat(t,";"));return n.path=t,n},comparator(e,t){let n;const o=Function("a","b","var u, v; return "+e.map((u,f)=>{const g=t[f];let x,k;return u.path?(x="a".concat(u.path),k="b".concat(u.path)):((n=n||{})["f"+f]=u,x="this.f".concat(f,"(a)"),k="this.f".concat(f,"(b)")),function(F,V,X,te){return"((u = ".concat(F,") < (v = ").concat(V,") || u == null) && v != null ? ").concat(X,`
  : (u > v || v == null) && u != null ? `).concat(te,`
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? `).concat(X,`
  : v !== v && u === u ? `).concat(te," : ")}(x,k,-g,g)}).join("")+"0;");return n?o.bind(n):o}}};function pB(e,t,n){if(!e||!Object(Ce.H)(e))return e;for(let o,u=0,f=mB.length;u<f;++u)if(o=mB[u],Object(Ce.w)(e,o.key))return o.parse(e,t,n);return e}var mB=[{key:"$ref",parse:function(e,t){return t.get(e.$ref)||Object(Ce.o)("Operator not defined: "+e.$ref)}},{key:"$key",parse:function(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=Object(Ce.K)(e.$key,e.$flat,t.expr.codegen))}},{key:"$expr",parse:function(e,t,n){e.$params&&t.parseParameters(e.$params,n);const o="e:"+e.$expr.code+"_"+e.$name;return t.fn[o]||(t.fn[o]=Object(Ce.f)(t.parameterExpression(e.$expr),e.$fields,e.$name))}},{key:"$field",parse:function(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=Object(Ce.u)(e.$field,e.$name,t.expr.codegen))}},{key:"$encode",parse:function(e,t){const n=e.$encode,o={};for(const u in n){const f=n[u];o[u]=Object(Ce.f)(t.encodeExpression(f.$expr),f.$fields),o[u].output=f.$output}return o}},{key:"$compare",parse:function(e,t){const n="c:"+e.$compare+"_"+e.$order,o=Object(Ce.i)(e.$compare).map(u=>u&&u.$tupleid?en:u);return t.fn[n]||(t.fn[n]=Object(Ce.l)(o,e.$order,t.expr.codegen))}},{key:"$context",parse:function(e,t){return t}},{key:"$subflow",parse:function(e,t){const n=e.$subflow;return function(o,u,f){const g=t.fork().parse(n),x=g.get(n.operators[0].id),k=g.signals.parent;return k&&k.set(f),x.detachSubflow=()=>t.detach(g),x}}},{key:"$tupleid",parse:function(){return en}}];const $Y={skip:!0};function gB(e,t,n,o){return new vB(e,t,n,o)}function vB(e,t,n,o){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=o||qY,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function yB(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}vB.prototype=yB.prototype={fork(){const e=new yB(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter(n=>n!==e);const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,o=n.dataflow,u=e.value;if(n.set(e.id,t),function(f){return PD(f)==="collect"}(e.type)&&u&&(u.$ingest?o.ingest(t,u.$ingest,u.$format):u.$request?o.preload(t,u.$request,u.$format):o.pulse(t,o.changeset().insert(u))),e.root&&(n.root=t),e.parent){let f=n.get(e.parent.$ref);f?(o.connect(f,[t]),t.targets().add(f)):(n.unresolved=n.unresolved||[]).push(()=>{f=n.get(e.parent.$ref),o.connect(f,[t]),t.targets().add(f)})}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const f in e.data){const g=n.data[f]||(n.data[f]={});e.data[f].forEach(x=>g[x]=t)}},resolve(){return(this.unresolved||[]).forEach(e=>e()),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[PD(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,o,u){this.dataflow.on(t,n,o,u,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:function(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach(o=>t.parseOperator(o)),n.forEach(o=>t.parseOperatorParameters(o)),(e.streams||[]).forEach(o=>t.parseStream(o)),(e.updates||[]).forEach(o=>t.parseUpdate(o)),t.resolve()},parseOperator:function(e){const t=this;!function(n){return PD(n)==="operator"}(e.type)&&e.type?t.transform(e,e.type):t.operator(e,e.update?t.operatorExpression(e.update):null)},parseOperatorParameters:function(e){const t=this;if(e.params){const n=t.get(e.id);n||Object(Ce.o)("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}},parseParameters:function(e,t){t=t||{};const n=this;for(const o in e){const u=e[o];t[o]=Object(Ce.B)(u)?u.map(f=>pB(f,n,t)):pB(u,n,t)}return t},parseStream:function(e){var t,n=this,o=e.filter!=null?n.eventExpression(e.filter):void 0,u=e.stream!=null?n.get(e.stream):void 0;e.source?u=n.events(e.source,e.type,o):e.merge&&(u=(t=e.merge.map(f=>n.get(f)))[0].merge.apply(t[0],t.slice(1))),e.between&&(t=e.between.map(f=>n.get(f)),u=u.between(t[0],t[1])),e.filter&&(u=u.filter(o)),e.throttle!=null&&(u=u.throttle(+e.throttle)),e.debounce!=null&&(u=u.debounce(+e.debounce)),u==null&&Object(Ce.o)("Invalid stream definition: "+JSON.stringify(e)),e.consume&&u.consume(!0),n.stream(e,u)},parseUpdate:function(e){var t,n=Object(Ce.H)(n=e.source)?n.$ref:n,o=this.get(n),u=e.update,f=void 0;o||Object(Ce.o)("Source not defined: "+e.source),t=e.target&&e.target.$expr?this.eventExpression(e.target.$expr):this.get(e.target),u&&u.$expr&&(u.$params&&(f=this.parseParameters(u.$params)),u=this.handlerExpression(u.$expr)),this.update(e,o,t,u,f)},getState:function(e){var t=this,n={};if(e.signals){var o=n.signals={};Object.keys(t.signals).forEach(f=>{const g=t.signals[f];e.signals(f,g)&&(o[f]=g.value)})}if(e.data){var u=n.data={};Object.keys(t.data).forEach(f=>{const g=t.data[f];e.data(f,g)&&(u[f]=g.input.value)})}return t.subcontext&&e.recurse!==!1&&(n.subcontext=t.subcontext.map(f=>f.getState(e))),n},setState:function(e){var t=this,n=t.dataflow,o=e.data,u=e.signals;Object.keys(u||{}).forEach(f=>{n.update(t.signals[f],u[f],$Y)}),Object.keys(o||{}).forEach(f=>{n.pulse(t.data[f].input,n.changeset().remove(Ce.Ia).insert(o[f]))}),(e.subcontext||[]).forEach((f,g)=>{const x=t.subcontext[g];x&&x.setState(f)})}};var XY=function(e,t,n){var o=new ik,u=t;return t==null?(o.restart(e,t,n),o):(o._restart=o.restart,o.restart=function(f,g,x){g=+g,x=x==null?kM():+x,o._restart(function k(F){F+=u,o._restart(k,u+=g,x),f(F)},g,x)},o.restart(e,t,n),o)};function bB(e,t){e&&(t==null?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}const LD="default";function BD(e,t){const n=e.globalCursor()?typeof document<"u"&&document.body:e.container();if(n)return t==null?n.style.removeProperty("cursor"):n.style.cursor=t}function Rk(e,t){var n=e._runtime.data;return Object(Ce.w)(n,t)||Object(Ce.o)("Unrecognized data set: "+t),n[t]}function Pk(e,t){kr(t)||Object(Ce.o)("Second argument to changes must be a changeset.");const n=Rk(this,e);return n.modified=!0,this.pulse(n.input,t)}function xB(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function wB(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function Lk(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function KY(e,t,n){var o,u,f=e._renderer,g=f&&f.canvas();return g&&(u=Lk(e),(o=v(t.changedTouches?t.changedTouches[0]:t,g))[0]-=u[0],o[1]-=u[1]),t.dataflow=e,t.item=n,t.vega=function(x,k,F){const V=k?k.mark.marktype==="group"?k:k.mark.group:null;function X(ue){var he,be=V;if(ue){for(he=k;he;he=he.mark.group)if(he.mark.name===ue){be=he;break}}return be&&be.mark&&be.mark.interactive?be:{}}function te(ue){if(!ue)return F;Object(Ce.J)(ue)&&(ue=X(ue));const he=F.slice();for(;ue;)he[0]-=ue.x||0,he[1]-=ue.y||0,ue=ue.mark&&ue.mark.group;return he}return{view:Object(Ce.m)(x),item:Object(Ce.m)(k||{}),group:X,xy:te,x:ue=>te(ue)[0],y:ue=>te(ue)[1]}}(e,n,o),t}const _B="view",YY="timer",JY="window",QY={trap:!1};function EB(e,t,n,o){e._eventListeners.push({type:n,sources:Object(Ce.i)(t),handler:o})}function Bk(e,t,n){const o=e._eventConfig&&e._eventConfig[t];return!(o===!1||Object(Ce.H)(o)&&!o[n])||(e.warn(`Blocked ${t} ${n} event listener.`),!1)}function SB(e){return e.item}function CB(e){return e.item.mark.source}function kB(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function Bm(e,t,n){const o=document.createElement(e);for(const u in t)o.setAttribute(u,t[u]);return n!=null&&(o.textContent=n),o}const ZY="vega-bind",eJ="vega-bind-name",tJ="vega-bind-radio";function nJ(e,t,n,o){const u=n.event||"input",f=()=>e.update(t.value);o.signal(n.signal,t.value),t.addEventListener(u,f),EB(o,t,u,f),e.set=g=>{t.value=g,t.dispatchEvent(function(x){return typeof Event<"u"?new Event(x):{type:x}}(u))}}function rJ(e,t,n,o){const u=o.signal(n.signal),f=Bm("div",{class:ZY}),g=n.input==="radio"?f:f.appendChild(Bm("label"));g.appendChild(Bm("span",{class:eJ},n.name||n.signal)),t.appendChild(f);let x=iJ;switch(n.input){case"checkbox":x=oJ;break;case"select":x=aJ;break;case"radio":x=sJ;break;case"range":x=uJ}x(e,g,n,u)}function iJ(e,t,n,o){const u=Bm("input");for(const f in n)f!=="signal"&&f!=="element"&&u.setAttribute(f==="input"?"type":f,n[f]);u.setAttribute("name",n.signal),u.value=o,t.appendChild(u),u.addEventListener("input",()=>e.update(u.value)),e.elements=[u],e.set=f=>u.value=f}function oJ(e,t,n,o){const u={type:"checkbox",name:n.signal};o&&(u.checked=!0);const f=Bm("input",u);t.appendChild(f),f.addEventListener("change",()=>e.update(f.checked)),e.elements=[f],e.set=g=>f.checked=!!g||null}function aJ(e,t,n,o){const u=Bm("select",{name:n.signal}),f=n.labels||[];n.options.forEach((g,x)=>{const k={value:g};jk(g,o)&&(k.selected=!0),u.appendChild(Bm("option",k,(f[x]||g)+""))}),t.appendChild(u),u.addEventListener("change",()=>{e.update(n.options[u.selectedIndex])}),e.elements=[u],e.set=g=>{for(let x=0,k=n.options.length;x<k;++x)if(jk(n.options[x],g))return void(u.selectedIndex=x)}}function sJ(e,t,n,o){const u=Bm("span",{class:tJ}),f=n.labels||[];t.appendChild(u),e.elements=n.options.map((g,x)=>{const k={type:"radio",name:n.signal,value:g};jk(g,o)&&(k.checked=!0);const F=Bm("input",k);F.addEventListener("change",()=>e.update(g));const V=Bm("label",{},(f[x]||g)+"");return V.prepend(F),u.appendChild(V),F}),e.set=g=>{const x=e.elements,k=x.length;for(let F=0;F<k;++F)jk(x[F].value,g)&&(x[F].checked=!0)}}function uJ(e,t,n,o){o=o!==void 0?o:(+n.max+ +n.min)/2;const u=n.max!=null?n.max:Math.max(100,+o)||100,f=n.min||Math.min(0,u,+o)||0,g=n.step||Object(Yu.c)(f,u,100),x=Bm("input",{type:"range",name:n.signal,min:f,max:u,step:g});x.value=o;const k=Bm("span",{},+o);t.appendChild(x),t.appendChild(k);const F=()=>{k.textContent=x.value,e.update(+x.value)};x.addEventListener("input",F),x.addEventListener("change",F),e.elements=[x],e.set=V=>{x.value=V,k.textContent=V}}function jk(e,t){return e===t||e+""==t+""}function AB(e,t,n,o,u,f){return(t=t||new o(e.loader())).initialize(n,xB(e),wB(e),Lk(e),u,f).background(e.background())}function jD(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null}function zD(e,t,n){if(typeof t=="string"){if(typeof document>"u")return e.error("DOM document instance not found."),null;if(!(t=document.querySelector(t)))return e.error("Signal bind element not found: "+t),null}if(t&&n)try{t.innerHTML=""}catch(o){t=null,e.error(o)}return t}const nE=e=>+e||0,cJ=e=>({top:e,bottom:e,left:e,right:e});function OB(e){return Object(Ce.H)(e)?{top:nE(e.top),bottom:nE(e.bottom),left:nE(e.left),right:nE(e.right)}:cJ(nE(e))}async function UD(e,t,n,o){const u=Lr(t),f=u&&u.headless;return f||Object(Ce.o)("Unrecognized renderer type: "+t),await e.runAsync(),AB(e,null,null,f,n,o).renderAsync(e._scenegraph.root)}var TB="width",MB="height",WD="padding",DB={skip:!0};function NB(e,t){var n=e.autosize(),o=e.padding();return t-(n&&n.contains===WD?o.left+o.right:0)}function IB(e,t){var n=e.autosize(),o=e.padding();return t-(n&&n.contains===WD?o.top+o.bottom:0)}function lJ(e,t){return t.modified&&Object(Ce.B)(t.input.value)&&e.indexOf("_:vega:_")}function fJ(e,t){return!(e==="parent"||t instanceof hn.proxy)}function dJ(e,t,n,o){const u=e.element();u&&u.setAttribute("title",function(f){return f==null?"":Object(Ce.B)(f)?FB(f):Object(Ce.H)(f)&&!Object(Ce.D)(f)?function(g){return Object.keys(g).map(x=>{const k=g[x];return x+": "+(Object(Ce.B)(k)?FB(k):RB(k))}).join(`
`)}(f):f+""}(o))}function FB(e){return"["+e.map(RB).join(", ")+"]"}function RB(e){return Object(Ce.B)(e)?"[]":Object(Ce.H)(e)&&!Object(Ce.D)(e)?"{}":e}function PB(e,t){const n=this;if(t=t||{},fn.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),t.logLevel!=null&&n.logLevel(t.logLevel),t.locale||e.locale){const f=Object(Ce.p)({},e.locale,t.locale);n.locale(Object(Mr.b)(f.number,f.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||wr.Canvas,n._scenegraph=new Kv;const o=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||dJ,n._redraw=!0,n._handler=new Xe().scene(o),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=function(f){const g=Object(Ce.p)({defaults:{}},f),x=(k,F)=>{F.forEach(V=>{Object(Ce.B)(k[V])&&(k[V]=Object(Ce.Fa)(k[V]))})};return x(g.defaults,["prevent","allow"]),x(g,["view","window","selector"]),g}(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const u=function(f,g,x){return gB(f,hn,eE,x).parse(g)}(n,e,t.expr);n._runtime=u,n._signals=u.signals,n._bind=(e.bindings||[]).map(f=>({state:null,param:Object(Ce.p)({},f)})),u.root&&u.root.set(o),o.source=u.data.root.input,n.pulse(u.data.root.input,n.changeset().insert(o.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=NB(n,n._width),n._viewHeight=IB(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(f){var g=f._signals,x=g[TB],k=g[MB],F=g[WD];function V(){f._autosize=f._resize=1}f._resizeWidth=f.add(null,te=>{f._width=te.size,f._viewWidth=NB(f,te.size),V()},{size:x}),f._resizeHeight=f.add(null,te=>{f._height=te.size,f._viewHeight=IB(f,te.size),V()},{size:k});const X=f.add(null,V,{pad:F});f._resizeWidth.rank=x.rank+1,f._resizeHeight.rank=k.rank+1,X.rank=F.rank+1}(n),function(f){f.add(null,g=>(f._background=g.bg,f._resize=1,g.bg),{bg:f._signals.background})}(n),function(f){const g=f._signals.cursor||(f._signals.cursor=f.add({user:LD,item:null}));f.on(f.events("view","mousemove"),g,(x,k)=>{const F=g.value,V=F?Object(Ce.J)(F)?F:F.user:LD,X=k.item&&k.item.cursor||null;return F&&V===F.user&&X==F.item?F:{user:V,item:X}}),f.add(null,function(x){let k=x.cursor,F=this.value;return Object(Ce.J)(k)||(F=k.item,k=k.user),BD(f,k&&k!==LD?k:F||k),F},{cursor:g})}(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function zk(e,t){return Object(Ce.w)(e._signals,t)?e._signals[t]:Object(Ce.o)("Unrecognized signal name: "+Object(Ce.Ba)(t))}function LB(e,t){const n=(e._targets||[]).filter(o=>o._update&&o._update.handler===t);return n.length?n[0]:null}function BB(e,t,n,o){let u=LB(n,o);return u||((u=jD(e,()=>o(t,n.value))).handler=o,e.on(n,null,u)),e}function jB(e,t,n){const o=LB(t,n);return o&&t._targets.remove(o),e}Object(Ce.z)(PB,fn,{async evaluate(e,t,n){if(await fn.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,function(o){var u=Lk(o),f=xB(o),g=wB(o);o._renderer.background(o.background()),o._renderer.resize(f,g,u),o._handler.origin(u),o._resizeListeners.forEach(x=>{try{x(f,g)}catch(k){o.error(k)}})}(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(o){this.error(o)}return n&&Gt(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=e!=null?e+"":null;return t!==this._desc&&bB(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const o=zk(this,e);return arguments.length===1?o.value:this.update(o,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",OB(e)):OB(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(Lr(e)||Object(Ce.o)("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(fn.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(zk(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:function(e,t,n,o,u,f){this.runAfter(g=>{let x=0;g._autosize=0,g.width()!==n&&(x=1,g.signal(TB,n,DB),g._resizeWidth.skip(!0)),g.height()!==o&&(x=1,g.signal(MB,o,DB),g._resizeHeight.skip(!0)),g._viewWidth!==e&&(g._resize=1,g._viewWidth=e),g._viewHeight!==t&&(g._resize=1,g._viewHeight=t),g._origin[0]===u[0]&&g._origin[1]===u[1]||(g._resize=1,g._origin=u),x&&g.run("enter"),f&&g.runAfter(k=>k.resize())},!1,1)},addEventListener(e,t,n){let o=t;return n&&n.trap===!1||((o=jD(this,t)).raw=t),this._handler.on(e,o),this},removeEventListener(e,t){for(var n,o,u=this._handler.handlers(e),f=u.length;--f>=0;)if(o=u[f].type,n=u[f].handler,e===o&&(t===n||t===n.raw)){this._handler.off(o,n);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return BB(this,e,zk(this,e),t)},removeSignalListener(e,t){return jB(this,zk(this,e),t)},addDataListener(e,t){return BB(this,e,Rk(this,e).values,t)},removeDataListener(e,t){return jB(this,Rk(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=BD(this,null);this._globalCursor=!!e,t&&BD(this,t)}return this}return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:function(e,t){this._timers.push(XY(function(n){e({timestamp:Date.now(),elapsed:n})},t))},events:function(e,t,n){var o,u=this,f=new Kr(n),g=function(F,V){u.runAsync(null,()=>{e===_B&&function(X,te){var ue=X._eventConfig.defaults,he=ue.prevent,be=ue.allow;return he!==!1&&be!==!0&&(he===!0||be===!1||(he?he[te]:be?!be[te]:X.preventDefault()))}(u,t)&&F.preventDefault(),f.receive(KY(u,F,V))})};if(e===YY)Bk(u,"timer",t)&&u.timer(g,t);else if(e===_B)Bk(u,"view",t)&&u.addEventListener(t,g,QY);else if(e===JY?Bk(u,"window",t)&&typeof window<"u"&&(o=[window]):typeof document<"u"&&Bk(u,"selector",t)&&(o=document.querySelectorAll(e)),o){for(var x=0,k=o.length;x<k;++x)o[x].addEventListener(t,g);EB(u,o,t,g)}else u.warn("Can not resolve event source: "+e);return f},finalize:function(){var e,t,n,o=this._tooltip,u=this._timers,f=this._eventListeners;for(e=u.length;--e>=0;)u[e].stop();for(e=f.length;--e>=0;)for(t=(n=f[e]).sources.length;--t>=0;)n.sources[t].removeEventListener(n.type,n.handler);return o&&o.call(this,this._handler,null,null,null),this},hover:function(e,t){return e=[e||"hover"],t=[t||"update",e[0]],this.on(this.events("view","mouseover",SB),CB,kB(e)),this.on(this.events("view","mouseout",SB),CB,kB(t)),this},data:function(e,t){return arguments.length<2?Rk(this,e).values.value:Pk.call(this,e,dr().remove(Ce.Ia).insert(t))},change:Pk,insert:function(e,t){return Pk.call(this,e,dr().insert(t))},remove:function(e,t){return Pk.call(this,e,dr().remove(t))},scale:function(e){var t=this._runtime.scales;return Object(Ce.w)(t,e)||Object(Ce.o)("Unrecognized scale or projection: "+e),t[e].value},initialize:function(e,t){const n=this,o=n._renderType,u=n._eventConfig.bind,f=Lr(o);e=n._el=e?zD(n,e,!0):null,function(k){const F=k.container();F&&(F.setAttribute("role","graphics-document"),F.setAttribute("aria-roleDescription","visualization"),bB(F,k.description()))}(n),f||n.error("Unrecognized renderer type: "+o);const g=f.handler||Xe,x=e?f.renderer:f.headless;return n._renderer=x?AB(n,n._renderer,e,x):null,n._handler=function(k,F,V,X){const te=new X(k.loader(),jD(k,k.tooltip())).scene(k.scenegraph().root).initialize(V,Lk(k),k);return F&&F.handlers().forEach(ue=>{te.on(ue.type,ue.handler)}),te}(n,n._handler,e,g),n._redraw=!0,e&&u!=="none"&&(t=t?n._elBind=zD(n,t,!0):e.appendChild(Bm("form",{class:"vega-bindings"})),n._bind.forEach(k=>{k.param.element&&u!=="container"&&(k.element=zD(n,k.param.element,!!k.param.input))}),n._bind.forEach(k=>{(function(F,V,X){if(!V)return;const te=X.param;let ue=X.state;ue||(ue=X.state={elements:null,active:!1,set:null,update:he=>{he!=F.signal(te.signal)&&F.runAsync(null,()=>{ue.source=!0,F.signal(te.signal,he)})}},te.debounce&&(ue.update=Object(Ce.n)(te.debounce,ue.update))),(te.input==null&&te.element?nJ:rJ)(ue,V,te,F),ue.active||(F.on(F._signals[te.signal],null,()=>{ue.source?ue.source=!1:ue.set(F.signal(te.signal))}),ue.active=!0)})(n,k.element||t,k)})),n},toImageURL:async function(e,t){e!==wr.Canvas&&e!==wr.SVG&&e!==wr.PNG&&Object(Ce.o)("Unrecognized image type: "+e);const n=await UD(this,e,t);return e===wr.SVG?function(o,u){const f=new Blob([o],{type:u});return window.URL.createObjectURL(f)}(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")},toCanvas:async function(e,t){return(await UD(this,wr.Canvas,e,t)).canvas()},toSVG:async function(e){return(await UD(this,wr.SVG,e)).svg()},getState:function(e){return this._runtime.getState(e||{data:lJ,signals:fJ,recurse:!0})},setState:function(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},t=>{t._trigger=!0}),this}});const hJ="view",Uk="[",Wk="]",zB="{",UB="}",pJ=":",WB=",",mJ="@",gJ=">",vJ=/[[\]{}]/,yJ={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let VB,HB;function rE(e,t,n,o,u){const f=e.length;let g,x=0;for(;t<f;++t){if(g=e[t],!x&&g===n)return t;u&&u.indexOf(g)>=0?--x:o&&o.indexOf(g)>=0&&++x}return t}function GB(e){const t=[],n=e.length;let o=0,u=0;for(;u<n;)u=rE(e,u,WB,Uk+zB,Wk+UB),t.push(e.substring(o,u).trim()),o=++u;if(t.length===0)throw"Empty event selector: "+e;return t}function VD(e){return e[0]==="["?function(t){const n=t.length;let o,u=1;if((u=rE(t,u,Wk,Uk,Wk))===n)throw"Empty between selector: "+t;if((o=GB(t.substring(1,u))).length!==2)throw"Between selector must have two elements: "+t;if((t=t.slice(u+1).trim())[0]!==gJ)throw"Expected '>' after between selector: "+t;o=o.map(VD);const f=VD(t.slice(1).trim());return f.between?{between:o,stream:f}:(f.between=o,f)}(e):function(t){const n={source:VB},o=[];let u,f,g=[0,0],x=0,k=0,F=t.length,V=0;if(t[F-1]===UB){if(!((V=t.lastIndexOf(zB))>=0))throw"Unmatched right brace: "+t;try{g=function(X){const te=X.split(WB);if(!X.length||te.length>2)throw X;return te.map(ue=>{const he=+ue;if(he!=he)throw X;return he})}(t.substring(V+1,F-1))}catch{throw"Invalid throttle specification: "+t}t=t.slice(0,V).trim(),F=t.length,V=0}if(!F)throw t;if(t[0]===mJ&&(x=++V),(u=rE(t,V,pJ))<F&&(o.push(t.substring(k,u).trim()),k=V=++u),(V=rE(t,V,Uk))===F)o.push(t.substring(k,F).trim());else if(o.push(t.substring(k,V).trim()),f=[],(k=++V)===F)throw"Unmatched left bracket: "+t;for(;V<F;){if((V=rE(t,V,Wk))===F)throw"Unmatched left bracket: "+t;if(f.push(t.substring(k,V).trim()),V<F-1&&t[++V]!==Uk)throw"Expected left bracket: "+t;k=++V}if(!(F=o.length)||vJ.test(o[F-1]))throw"Invalid event selector: "+t;return F>1?(n.type=o[1],x?n.markname=o[0].slice(1):function(X){return HB[X]}(o[0])?n.marktype=o[0]:n.source=o[0]):n.type=o[0],n.type.slice(-1)==="!"&&(n.consume=!0,n.type=n.type.slice(0,-1)),f!=null&&(n.filter=f),g[0]&&(n.throttle=g[0]),g[1]&&(n.debounce=g[1]),n}(e)}const iE=e=>+e||0,bJ=e=>({top:e,bottom:e,left:e,right:e}),bl=e=>Object(Ce.H)(e)&&!Object(Ce.B)(e)?Object(Ce.p)({},e):{value:e};function qB(e,t,n,o){return n!=null?(Object(Ce.H)(n)&&!Object(Ce.B)(n)||Object(Ce.B)(n)&&n.length&&Object(Ce.H)(n[0])?e.update[t]=n:e[o||"enter"][t]={value:n},1):0}function af(e,t,n){for(const o in t)qB(e,o,t[o]);for(const o in n)qB(e,o,n[o],"update")}function Hw(e,t,n){for(const o in t)n&&Object(Ce.w)(n,o)||(e[o]=Object(Ce.p)(e[o]||{},t[o]));return e}function Gw(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const HD="mark",GD="frame",qD="scope",xJ="axis",wJ="axis-domain",_J="axis-grid",EJ="axis-label",SJ="axis-tick",CJ="axis-title",kJ="legend",AJ="legend-band",OJ="legend-entry",TJ="legend-gradient",$B="legend-label",MJ="legend-symbol",DJ="legend-title",NJ="title",IJ="title-text",FJ="title-subtitle";function $D(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const XB=e=>Object(Ce.J)(e)?Object(Ce.Ba)(e):e.signal?`(${e.signal})`:KB(e);function Vk(e){if(e.gradient!=null)return function(n){const o=[n.start,n.stop,n.count].map(u=>u==null?null:Object(Ce.Ba)(u));for(;o.length&&Object(Ce.W)(o)==null;)o.pop();return o.unshift(XB(n.gradient)),`gradient(${o.join(",")})`}(e);let t=e.signal?`(${e.signal})`:e.color?function(n){return n.c?Hk("hcl",n.h,n.c,n.l):n.h||n.s?Hk("hsl",n.h,n.s,n.l):n.l||n.a?Hk("lab",n.l,n.a,n.b):n.r||n.g||n.b?Hk("rgb",n.r,n.g,n.b):null}(e.color):e.field!=null?KB(e.field):e.value!==void 0?Object(Ce.Ba)(e.value):void 0;return e.scale!=null&&(t=function(n,o){const u=XB(n.scale);return n.range!=null?o=`lerp(_range(${u}), ${+n.range})`:(o!==void 0&&(o=`_scale(${u}, ${o})`),n.band&&(o=(o?o+"+":"")+`_bandwidth(${u})`+(+n.band==1?"":"*"+Gk(n.band)),n.extra&&(o=`(datum.extra ? _scale(${u}, datum.extra.value) : ${o})`)),o==null&&(o="0")),o}(e,t)),t===void 0&&(t=null),e.exponent!=null&&(t=`pow(${t},${Gk(e.exponent)})`),e.mult!=null&&(t+=`*${Gk(e.mult)}`),e.offset!=null&&(t+=`+${Gk(e.offset)}`),e.round&&(t=`round(${t})`),t}const Hk=(e,t,n,o)=>`(${e}(${[t,n,o].map(Vk).join(",")})+'')`;function Gk(e){return Object(Ce.H)(e)?"("+Vk(e)+")":e}function KB(e){return function t(n){let o,u,f;if(n.signal)o="datum",f=n.signal;else if(n.group||n.parent){for(u=Math.max(1,n.level||1),o="item";u-- >0;)o+=".mark.group";n.parent?(f=n.parent,o+=".datum"):f=n.group}else n.datum?(o="datum",f=n.datum):Object(Ce.o)("Invalid field reference: "+Object(Ce.Ba)(n));return n.signal||(f=Object(Ce.J)(f)?Object(Ce.Aa)(f).map(Ce.Ba).join("]["):t(f)),o+"["+f+"]"}(Object(Ce.H)(e)?e:{datum:e})}function YB(e,t,n,o,u,f){const g={};(f=f||{}).encoders={$encode:g},e=function(x,k,F,V,X){const te={},ue={};let he,be,Pe;for(be in be="lineBreak",k!=="text"||X[be]==null||Gw(be,x)||$D(te,be,X[be]),(F=="legend"||String(F).startsWith("axis"))&&(F=null),Pe=F===GD?X.group:F===HD?Object(Ce.p)({},X.mark,X[k]):null)Gw(be,x)||(be==="fill"||be==="stroke")&&(Gw("fill",x)||Gw("stroke",x))||$D(te,be,Pe[be]);for(be in Object(Ce.i)(V).forEach(Ue=>{const We=X.style&&X.style[Ue];for(const at in We)Gw(at,x)||$D(te,at,We[at])}),x=Object(Ce.p)({},x),te)(Pe=te[be]).signal?(he=he||{})[be]=Pe:ue[be]=Pe;return x.enter=Object(Ce.p)(ue,x.enter),he&&(x.update=Object(Ce.p)(he,x.update)),x}(e,t,n,o,u.config);for(const x in e)g[x]=RJ(e[x],t,f,u);return f}function RJ(e,t,n,o){const u={},f={};for(const g in e)e[g]!=null&&(u[g]=LJ(PJ(e[g]),o,n,f));return{$expr:{marktype:t,channels:u},$fields:Object.keys(f),$output:Object.keys(e)}}function PJ(e){return Object(Ce.B)(e)?function(t){let n="";return t.forEach(o=>{const u=Vk(o);n+=o.test?`(${o.test})?${u}:`:u}),Object(Ce.W)(n)===":"&&(n+="null"),n}(e):Vk(e)}function LJ(e,t,n,o){const u=ny(e,t);return u.$fields.forEach(f=>o[f]=1),Object(Ce.p)(n,u.$params),u.$expr}const BJ="outer",jJ=["value","update","init","react","bind"];function JB(e,t){Object(Ce.o)(e+' for "outer" push: '+Object(Ce.Ba)(t))}function QB(e,t){const n=e.name;if(e.push===BJ)t.signals[n]||JB("No prior signal definition",n),jJ.forEach(o=>{e[o]!==void 0&&JB("Invalid property ",o)});else{const o=t.addSignal(n,e.value);e.react===!1&&(o.react=!1),e.bind&&t.addBinding(n,e.bind)}}function XD(e,t,n,o){this.id=-1,this.type=e,this.value=t,this.params=n,o&&(this.parent=o)}function qk(e,t,n,o){return new XD(e,t,n,o)}function $k(e,t){return qk("operator",e,t)}function Ji(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function oE(e,t){return t?{$field:e,$name:t}:{$field:e}}const KD=oE("key");function ZB(e,t){return{$compare:e,$order:t}}const zJ="descending";function Xk(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const YD="scope",JD="view";function qc(e){return e&&e.signal}function Kk(e){if(qc(e))return!0;if(Object(Ce.H)(e)){for(const t in e)if(Kk(e[t]))return!0}return!1}function F0(e,t){return e??t}function gx(e){return e&&e.signal||e}const ej="timer";function aE(e,t){return(e.merge?UJ:e.stream?WJ:e.type?VJ:Object(Ce.o)("Invalid stream specification: "+Object(Ce.Ba)(e)))(e,t)}function UJ(e,t){const n=QD({merge:e.merge.map(o=>aE(o,t))},e,t);return t.addStream(n).id}function WJ(e,t){const n=QD({stream:aE(e.stream,t)},e,t);return t.addStream(n).id}function VJ(e,t){let n;e.type===ej?(n=t.event(ej,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(function(u){return u===YD?JD:u||JD}(e.source),e.type);const o=QD({stream:n},e,t);return Object.keys(o).length===1?n:t.addStream(o).id}function QD(e,t,n){let o=t.between;return o&&(o.length!==2&&Object(Ce.o)('Stream "between" parameter must have 2 entries: '+Object(Ce.Ba)(t)),e.between=[aE(o[0],n),aE(o[1],n)]),o=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&o.push(function(u,f,g){const x="event.item";return x+(u&&u!=="*"?"&&"+x+".mark.marktype==='"+u+"'":"")+(g?"&&"+x+".mark.role==='"+g+"'":"")+(f?"&&"+x+".mark.name==='"+f+"'":"")}(t.marktype,t.markname,t.markrole)),t.source===YD&&o.push("inScope(event.item)"),o.length&&(e.filter=ny("("+o.join(")&&(")+")",n).$expr),(o=t.throttle)!=null&&(e.throttle=+o),(o=t.debounce)!=null&&(e.debounce=+o),t.consume&&(e.consume=!0),e}const HJ={code:"_.$value",ast:{type:"Identifier",value:"value"}};function GJ(e,t,n){const o=e.encode,u={target:n};let f=e.events,g=e.update,x=[];f||Object(Ce.o)("Signal update missing events specification."),Object(Ce.J)(f)&&(f=function(k,F,V){return VB=F||hJ,HB=V||yJ,GB(k.trim()).map(VD)}(f,t.isSubscope()?YD:JD)),f=Object(Ce.i)(f).filter(k=>k.signal||k.scale?(x.push(k),0):1),x.length>1&&(x=[function(k){return{signal:"["+k.map(F=>F.scale?'scale("'+F.scale+'")':F.signal)+"]"}}(x)]),f.length&&x.push(f.length>1?{merge:f}:f[0]),o!=null&&(g&&Object(Ce.o)("Signal encode and update are mutually exclusive."),g="encode(item(),"+Object(Ce.Ba)(o)+")"),u.update=Object(Ce.J)(g)?ny(g,t):g.expr!=null?ny(g.expr,t):g.value!=null?g.value:g.signal!=null?{$expr:HJ,$params:{$value:t.signalRef(g.signal)}}:Object(Ce.o)("Invalid signal update specification."),e.force&&(u.options={force:!0}),x.forEach(k=>t.addUpdate(Object(Ce.p)(function(F,V){return{source:F.signal?V.signalRef(F.signal):F.scale?V.scaleRef(F.scale):aE(F,V)}}(k,t),u)))}const vs=e=>(t,n,o)=>qk(e,n,t||void 0,o),tj=vs("aggregate"),qJ=vs("axisticks"),nj=vs("bound"),R0=vs("collect"),rj=vs("compare"),$J=vs("datajoin"),ij=vs("encode"),XJ=vs("expression"),KJ=vs("facet"),YJ=vs("field"),JJ=vs("key"),QJ=vs("legendentries"),ZJ=vs("load"),eQ=vs("mark"),tQ=vs("multiextent"),nQ=vs("multivalues"),rQ=vs("overlap"),iQ=vs("params"),oj=vs("prefacet"),oQ=vs("projection"),aQ=vs("proxy"),sQ=vs("relay"),aj=vs("render"),uQ=vs("scale"),vx=vs("sieve"),cQ=vs("sortitems"),sj=vs("viewlayout"),lQ=vs("values");let fQ=0;const uj={min:"min",max:"max",count:"sum"};function dQ(e,t){const n=t.getScale(e.name).params;let o;for(o in n.domain=cj(e.domain,e,t),e.range!=null&&(n.range=function u(f,g,x){const k=g.config.range;let F=f.range;if(F.signal)return g.signalRef(F.signal);if(Object(Ce.J)(F)){if(k&&Object(Ce.w)(k,F))return f=Object(Ce.p)({},f,{range:k[F]}),u(f,g,x);F==="width"?F=[0,{signal:"width"}]:F==="height"?F=Gd(f.type)?[0,{signal:"height"}]:[{signal:"height"},0]:Object(Ce.o)("Unrecognized scale range value: "+Object(Ce.Ba)(F))}else{if(F.scheme)return x.scheme=Object(Ce.B)(F.scheme)?Yk(F.scheme,g):Ig(F.scheme,g),F.extent&&(x.schemeExtent=Yk(F.extent,g)),void(F.count&&(x.schemeCount=Ig(F.count,g)));if(F.step)return void(x.rangeStep=Ig(F.step,g));if(Gd(f.type)&&!Object(Ce.B)(F))return cj(F,f,g);Object(Ce.B)(F)||Object(Ce.o)("Unsupported range type: "+Object(Ce.Ba)(F))}return F.map(V=>(Object(Ce.B)(V)?Yk:Ig)(V,g))}(e,t,n)),e.interpolate!=null&&function(u,f){f.interpolate=Ig(u.type||u),u.gamma!=null&&(f.interpolateGamma=Ig(u.gamma))}(e.interpolate,n),e.nice!=null&&(n.nice=function(u){return Object(Ce.H)(u)?{interval:Ig(u.interval),step:Ig(u.step)}:Ig(u)}(e.nice)),e.bins!=null&&(n.bins=function(u,f){return u.signal||Object(Ce.B)(u)?Yk(u,f):f.objectProperty(u)}(e.bins,t)),e)Object(Ce.w)(n,o)||o==="name"||(n[o]=Ig(e[o],t))}function Ig(e,t){return Object(Ce.H)(e)?e.signal?t.signalRef(e.signal):Object(Ce.o)("Unsupported object: "+Object(Ce.Ba)(e)):e}function Yk(e,t){return e.signal?t.signalRef(e.signal):e.map(n=>Ig(n,t))}function Jk(e){Object(Ce.o)("Can not find data set: "+Object(Ce.Ba)(e))}function cj(e,t,n){if(e)return e.signal?n.signalRef(e.signal):(Object(Ce.B)(e)?function(o,u,f){return o.map(g=>Ig(g,f))}:e.fields?function(o,u,f){const g=o.data,x=o.fields.reduce((k,F)=>(F=Object(Ce.J)(F)?{data:g,field:F}:Object(Ce.B)(F)||F.signal?function(V,X){const te="_:vega:_"+fQ++,ue=R0({});if(Object(Ce.B)(V))ue.value={$ingest:V};else if(V.signal){const he="setdata("+Object(Ce.Ba)(te)+","+V.signal+")";ue.params.input=X.signalRef(he)}return X.addDataPipeline(te,[ue,vx({})]),{data:te,field:"data"}}(F,f):F,k.push(F),k),[]);return(Gd(u.type)?function(k,F,V){const X=lj(k.sort,!0);let te,ue;const he=V.map(Ue=>{const We=F.getData(Ue.data);return We||Jk(Ue.data),We.countsRef(F,Ue.field,X)}),be={groupby:KD,pulse:he};X&&(te=X.op||"count",ue=X.field?Xk(te,X.field):"count",be.ops=[uj[te]],be.fields=[F.fieldRef(ue)],be.as=[ue]),te=F.add(tj(be));const Pe=F.add(R0({pulse:Ji(te)}));return Ji(ue=F.add(lQ({field:KD,sort:F.sortRef(X),pulse:Ji(Pe)})))}:hg(u.type)?function(k,F,V){const X=V.map(te=>{const ue=F.getData(te.data);return ue||Jk(te.data),ue.domainRef(F,te.field)});return Ji(F.add(nQ({values:X})))}:function(k,F,V){const X=V.map(te=>{const ue=F.getData(te.data);return ue||Jk(te.data),ue.extentRef(F,te.field)});return Ji(F.add(tQ({extents:X})))})(o,f,x)}:function(o,u,f){const g=f.getData(o.data);return g||Jk(o.data),Gd(u.type)?g.valuesRef(f,o.field,lj(o.sort,!1)):hg(u.type)?g.domainRef(f,o.field):g.extentRef(f,o.field)})(e,t,n);t.domainMin==null&&t.domainMax==null||Object(Ce.o)("No scale domain defined for domainMin/domainMax to override.")}function lj(e,t){return e&&(e.field||e.op?e.field||e.op==="count"?t&&e.field&&e.op&&!uj[e.op]&&Object(Ce.o)("Multiple domain scales can not be sorted using "+e.op):Object(Ce.o)("No field provided for sort aggregate op: "+e.op):Object(Ce.H)(e)?e.field="key":e={field:"key"}),e}function ZD(e,t,n){return Object(Ce.B)(e)?e.map(o=>ZD(o,t,n)):Object(Ce.H)(e)?e.signal?n.signalRef(e.signal):t==="fit"?e:Object(Ce.o)("Unsupported parameter object: "+Object(Ce.Ba)(e)):e}const P0="top",ib="bottom",hQ="vertical",pQ="start",mQ="end",e4="index",t4="label",gQ="offset",qw="perc",vQ="perc2",Fg="value",sE="guide-label",n4="guide-title",yQ="group-title",bQ="group-subtitle",fj="symbol",Qk="gradient",r4="discrete",i4="size",o4=[i4,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],uE={name:1,style:1,interactive:1},Aa={value:0},Rg={value:1},Zk="group",dj="rect",a4="rule",xQ="symbol",yx="text";function cE(e){return e.type=Zk,e.interactive=e.interactive||!1,e}function Ep(e,t){const n=(o,u)=>F0(e[o],F0(t[o],u));return n.isVertical=o=>hQ===F0(e.direction,t.direction||(o?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>F0(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>F0(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>F0(e.columns,F0(t.columns,+n.isVertical(!0))),n}function hj(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function e3(e,t,n){return`item.anchor === '${pQ}' ? ${e} : item.anchor === '${mQ}' ? ${t} : ${n}`}const s4=e3(Object(Ce.Ba)("left"),Object(Ce.Ba)("right"),Object(Ce.Ba)("center"));function jm(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=Hw(e.encode,t,uE)):e.interactive=!1,e}const wQ=`datum.${qw}<=0?"left":datum.${qw}>=1?"right":"center"`,_Q=`datum.${qw}<=0?"${ib}":datum.${qw}>=1?"${P0}":"middle"`;function pj(e,t,n,o){const u=Ep(e,t),f=u.isVertical(),g=bl(u.gradientThickness()),x=u.gradientLength();let k,F,V,X,te=u("labelOverlap"),ue="";const he={enter:k={opacity:Aa},update:F={opacity:Rg,text:{field:t4}},exit:{opacity:Aa}};return af(he,{fill:u("labelColor"),fillOpacity:u("labelOpacity"),font:u("labelFont"),fontSize:u("labelFontSize"),fontStyle:u("labelFontStyle"),fontWeight:u("labelFontWeight"),limit:F0(e.labelLimit,t.gradientLabelLimit)}),f?(k.align={value:"left"},k.baseline=F.baseline={signal:_Q},V="y",X="x",ue="1-"):(k.align=F.align={signal:wQ},k.baseline={value:"top"},V="x",X="y"),k[V]=F[V]={signal:ue+"datum."+qw,mult:x},k[X]=F[X]=g,g.offset=F0(e.labelOffset,t.gradientLabelOffset)||0,te=te?{separation:u("labelSeparation"),method:te,order:"datum."+e4}:void 0,jm({type:yx,role:$B,style:sE,key:Fg,from:o,encode:he,overlap:te},n)}const t3='(item.orient === "left" || item.orient === "right")',EQ=`datum.vgrad && ${t3}`,SQ=e3('"top"','"bottom"','"middle"'),CQ=`datum.vgrad && item.orient === "right" ? (${e3('"right"','"left"','"center"')}) : (${t3} && !(datum.vgrad && item.orient === "left")) ? "left" : ${s4}`,kQ=`item._anchor || (${t3} ? "middle" : "start")`,AQ=`${EQ} ? (item.orient === "left" ? -90 : 90) : 0`,OQ=`${t3} ? (datum.vgrad ? (item.orient === "right" ? "bottom" : "top") : ${SQ}) : "top"`;function mj(e){return Object(Ce.H)(e)&&e.signal?e.signal:Object(Ce.Ba)(e)}function gj(e){const t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")&&t.indexOf("title")?e.type===Zk?qD:t||HD:t}function u4(e,t){const n=nn(e.type);n||Object(Ce.o)("Unrecognized transform type: "+Object(Ce.Ba)(e.type));const o=qk(n.type.toLowerCase(),null,vj(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(o)),o.metadata=n.metadata||{},o}function vj(e,t,n){const o={},u=e.params.length;for(let f=0;f<u;++f){const g=e.params[f];o[g.name]=TQ(g,t,n)}return o}function TQ(e,t,n){const o=e.type,u=t[e.name];return o==="index"?function(f,g,x){return Object(Ce.J)(g.from)||Object(Ce.o)('Lookup "from" parameter must be a string literal.'),x.getData(g.from).lookupRef(x,g.key)}(0,t,n):u!==void 0?o==="param"?function(f,g,x){const k=g[f.name];return f.array?(Object(Ce.B)(k)||Object(Ce.o)("Expected an array of sub-parameters. Instead: "+Object(Ce.Ba)(k)),k.map(F=>bj(f,F,x))):bj(f,k,x)}(e,t,n):o==="projection"?n.projectionRef(t[e.name]):e.array&&!qc(u)?u.map(f=>yj(e,f,n)):yj(e,u,n):void(e.required&&Object(Ce.o)("Missing required "+Object(Ce.Ba)(t.type)+" parameter: "+Object(Ce.Ba)(e.name)))}function yj(e,t,n){const o=e.type;if(qc(t))return xj(o)?Object(Ce.o)("Expression references can not be signals."):c4(o)?n.fieldRef(t):wj(o)?n.compareRef(t):n.signalRef(t.signal);{const u=e.expr||c4(o);return u&&MQ(t)?n.exprRef(t.expr,t.as):u&&DQ(t)?oE(t.field,t.as):xj(o)?ny(t,n):NQ(o)?Ji(n.getData(t).values):c4(o)?oE(t):wj(o)?n.compareRef(t):t}}function bj(e,t,n){const o=e.params.length;let u;for(let g=0;g<o;++g){u=e.params[g];for(const x in u.key)if(u.key[x]!==t[x]){u=null;break}if(u)break}u||Object(Ce.o)("Unsupported parameter: "+Object(Ce.Ba)(t));const f=Object(Ce.p)(vj(u,t,n),u.key);return Ji(n.add(iQ(f)))}const MQ=e=>e&&e.expr,DQ=e=>e&&e.field,NQ=e=>e==="data",xj=e=>e==="expr",c4=e=>e==="field",wj=e=>e==="compare";function n3(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:Ji(t.getData(e.data).output)}function bx(e,t,n,o,u){this.scope=e,this.input=t,this.output=n,this.values=o,this.aggregate=u,this.index={}}function _j(e){return Object(Ce.J)(e)?e:null}function Ej(e,t,n){const o=Xk(n.op,n.field);let u;if(t.ops){for(let f=0,g=t.as.length;f<g;++f)if(t.as[f]===o)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((u=n.op.signal)?e.signalRef(u):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(o))}function lE(e,t,n,o,u,f,g){const x=t[n]||(t[n]={}),k=function(te){return Object(Ce.H)(te)?(te.order===zJ?"-":"+")+Xk(te.op,te.field):""}(f);let F,V,X=_j(u);if(X!=null&&(e=t.scope,F=x[X+=k?"|"+k:""]),!F){const te=f?{field:KD,pulse:t.countsRef(e,u,f)}:{field:e.fieldRef(u),pulse:Ji(t.output)};k&&(te.sort=e.sortRef(f)),V=e.add(qk(o,void 0,te)),g&&(t.index[u]=V),F=Ji(V),X!=null&&(x[X]=F)}return F}function Sj(e,t,n){const o=e.remove,u=e.insert,f=e.toggle,g=e.modify,x=e.values,k=t.add($k()),F=ny("if("+e.trigger+',modify("'+n+'",'+[u,o,f,g,x].map(V=>V??"null").join(",")+"),0)",t);k.update=F.$expr,k.params=F.$params}function r3(e,t){const n=gj(e),o=e.type===Zk,u=e.from&&e.from.facet,f=e.overlap;let g,x,k,F,V,X,te,ue=e.layout||n===qD||n===GD;const he=n===HD||ue||u,be=function(ct,kt,St){let yn,Mn,_n,$n,qn;return ct?(yn=ct.facet)&&(kt||Object(Ce.o)("Only group marks can be faceted."),yn.field!=null?$n=qn=n3(yn,St):(ct.data?qn=Ji(St.getData(ct.data).aggregate):((_n=u4(Object(Ce.p)({type:"aggregate",groupby:Object(Ce.i)(yn.groupby)},yn.aggregate),St)).params.key=St.keyRef(yn.groupby),_n.params.pulse=n3(yn,St),$n=qn=Ji(St.add(_n))),Mn=St.keyRef(yn.groupby,!0))):$n=Ji(St.add(R0(null,[{}]))),$n||($n=n3(ct,St)),{key:Mn,pulse:$n,parent:qn}}(e.from,o,t),Pe=Ji(x=t.add($J({key:be.key||(e.key?oE(e.key):void 0),pulse:be.pulse,clean:!o})));x=k=t.add(R0({pulse:Pe}));const Ue=Ji(x=t.add(eQ({markdef:function(ct){return{marktype:ct.type,name:ct.name||void 0,role:ct.role||gj(ct),zindex:+ct.zindex||void 0,aria:ct.aria,description:ct.description}}(e),interactive:function(ct,kt){return ct&&ct.signal?kt.signalRef(ct.signal):ct!==!1}(e.interactive,t),clip:function(ct,kt){let St;return Object(Ce.H)(ct)&&(ct.signal?St=ct.signal:ct.path?St="pathShape("+mj(ct.path)+")":ct.sphere&&(St="geoShape("+mj(ct.sphere)+', {type: "Sphere"})')),St?kt.signalRef(St):!!ct}(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:Ji(x)})));(x=F=t.add(ij(YB(e.encode,e.type,n,e.style,t,{mod:!1,pulse:Ue})))).params.parent=t.encode(),e.transform&&e.transform.forEach(ct=>{const kt=u4(ct,t),St=kt.metadata;(St.generates||St.changes)&&Object(Ce.o)("Mark transforms should not generate new data."),St.nomod||(F.params.mod=!0),kt.params.pulse=Ji(x),t.add(x=kt)}),e.sort&&(x=t.add(cQ({sort:t.compareRef(e.sort),pulse:Ji(x)})));const We=Ji(x);(u||ue)&&(X=Ji(ue=t.add(sj({layout:t.objectProperty(e.layout),legends:t.legends,mark:Ue,pulse:We}))));const at=t.add(nj({mark:Ue,pulse:X||We}));te=Ji(at),o&&(he&&((g=t.operators).pop(),ue&&g.pop()),t.pushState(We,X||te,Pe),u?function(ct,kt,St){const yn=ct.from.facet,Mn=yn.name,_n=n3(yn,kt);let $n;yn.name||Object(Ce.o)("Facet must have a name: "+Object(Ce.Ba)(yn)),yn.data||Object(Ce.o)("Facet must reference a data set: "+Object(Ce.Ba)(yn)),yn.field?$n=kt.add(oj({field:kt.fieldRef(yn.field),pulse:_n})):yn.groupby?$n=kt.add(KJ({key:kt.keyRef(yn.groupby),group:Ji(kt.proxy(St.parent)),pulse:_n})):Object(Ce.o)("Facet must specify groupby or field: "+Object(Ce.Ba)(yn));const qn=kt.fork(),er=qn.add(R0()),rr=qn.add(vx({pulse:Ji(er)}));qn.addData(Mn,new bx(qn,er,er,rr)),qn.addSignal("parent",null),$n.params.subflow={$subflow:qn.parse(ct).toRuntime()}}(e,t,be):he?function(ct,kt,St){const yn=kt.add(oj({pulse:St.pulse})),Mn=kt.fork();Mn.add(vx()),Mn.addSignal("parent",null),yn.params.subflow={$subflow:Mn.parse(ct).toRuntime()}}(e,t,be):t.parse(e),t.popState(),he&&(ue&&g.push(ue),g.push(at))),f&&(te=function(ct,kt,St){const yn=ct.method,Mn=ct.bound,_n=ct.separation,$n={separation:qc(_n)?St.signalRef(_n.signal):_n,method:qc(yn)?St.signalRef(yn.signal):yn,pulse:kt};if(ct.order&&($n.sort=St.compareRef({field:ct.order})),Mn){const qn=Mn.tolerance;$n.boundTolerance=qc(qn)?St.signalRef(qn.signal):+qn,$n.boundScale=St.scaleRef(Mn.scale),$n.boundOrient=Mn.orient}return Ji(St.add(rQ($n)))}(f,te,t));const st=t.add(aj({pulse:te})),dt=t.add(vx({pulse:Ji(st)},void 0,t.parent()));e.name!=null&&(V=e.name,t.addData(V,new bx(t,k,st,dt)),e.on&&e.on.forEach(ct=>{(ct.insert||ct.remove||ct.toggle)&&Object(Ce.o)("Marks only support modify triggers."),Sj(ct,t,V)}))}function IQ(e,t){const n=t.config.legend,o=e.encode||{},u=Ep(e,n),f=o.legend||{},g=f.name||void 0,x=f.interactive,k=f.style,F={};let V,X,te,ue=0;o4.forEach(We=>e[We]?(F[We]=e[We],ue=ue||e[We]):0),ue||Object(Ce.o)("Missing valid scale for legend.");const he=function(We,at){let st=We.type||fj;return We.type||function(dt){return o4.reduce((ct,kt)=>ct+(dt[kt]?1:0),0)}(We)!==1||!We.fill&&!We.stroke||(st=Hd(at)?Qk:ym(at)?r4:fj),st!==Qk?st:ym(at)?r4:Qk}(e,t.scaleType(ue)),be={title:e.title!=null,scales:F,type:he,vgrad:he!=="symbol"&&u.isVertical()},Pe=Ji(t.add(R0(null,[be]))),Ue=Ji(t.add(QJ(X={type:he,scale:t.scaleRef(ue),count:t.objectProperty(u("tickCount")),limit:t.property(u("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return he===Qk?(te=[function(We,at,st,dt){const ct=Ep(We,st),kt=ct.isVertical(),St=ct.gradientThickness(),yn=ct.gradientLength();let Mn,_n,$n,qn,er;kt?(_n=[0,1],$n=[0,0],qn=St,er=yn):(_n=[0,0],$n=[1,0],qn=yn,er=St);const rr={enter:Mn={opacity:Aa,x:Aa,y:Aa,width:bl(qn),height:bl(er)},update:Object(Ce.p)({},Mn,{opacity:Rg,fill:{gradient:at,start:_n,stop:$n}}),exit:{opacity:Aa}};return af(rr,{stroke:ct("gradientStrokeColor"),strokeWidth:ct("gradientStrokeWidth")},{opacity:ct("gradientOpacity")}),jm({type:dj,role:TJ,encode:rr},dt)}(e,ue,n,o.gradient),pj(e,n,o.labels,Ue)],X.count=X.count||t.signalRef(`max(2,2*floor((${gx(u.gradientLength())})/100))`)):he===r4?te=[function(We,at,st,dt,ct){const kt=Ep(We,st),St=kt.isVertical(),yn=kt.gradientThickness(),Mn=kt.gradientLength();let _n,$n,qn,er,rr="";St?(_n="y",qn="y2",$n="x",er="width",rr="1-"):(_n="x",qn="x2",$n="y",er="height");const fr={opacity:Aa,fill:{scale:at,field:Fg}};fr[_n]={signal:rr+"datum."+qw,mult:Mn},fr[$n]=Aa,fr[qn]={signal:rr+"datum."+vQ,mult:Mn},fr[er]=bl(yn);const Dr={enter:fr,update:Object(Ce.p)({},fr,{opacity:Rg}),exit:{opacity:Aa}};return af(Dr,{stroke:kt("gradientStrokeColor"),strokeWidth:kt("gradientStrokeWidth")},{opacity:kt("gradientOpacity")}),jm({type:dj,role:AJ,key:Fg,from:ct,encode:Dr},dt)}(e,ue,n,o.gradient,Ue),pj(e,n,o.labels,Ue)]:(V=function(We,at){const st=Ep(We,at);return{align:st("gridAlign"),columns:st.entryColumns(),center:{row:!0,column:!1},padding:{row:st("rowPadding"),column:st("columnPadding")}}}(e,n),te=[function(We,at,st,dt,ct){const kt=Ep(We,at),St=st.entries,yn=!(!St||!St.interactive),Mn=St?St.name:void 0,_n=kt("clipHeight"),$n=kt("symbolOffset"),qn={data:"value"},er=`(${ct}) ? datum.${gQ} : datum.${i4}`,rr=_n?bl(_n):{field:i4},fr=`datum.${e4}`,Dr=`max(1, ${ct})`;let Zr,Br,di,Ti,Di;rr.mult=.5,Zr={enter:Br={opacity:Aa,x:{signal:er,mult:.5,offset:$n},y:rr},update:di={opacity:Rg,x:Br.x,y:Br.y},exit:{opacity:Aa}};let Zi=null,Ri=null;We.fill||(Zi=at.symbolBaseFillColor,Ri=at.symbolBaseStrokeColor),af(Zr,{fill:kt("symbolFillColor",Zi),shape:kt("symbolType"),size:kt("symbolSize"),stroke:kt("symbolStrokeColor",Ri),strokeDash:kt("symbolDash"),strokeDashOffset:kt("symbolDashOffset"),strokeWidth:kt("symbolStrokeWidth")},{opacity:kt("symbolOpacity")}),o4.forEach(da=>{We[da]&&(di[da]=Br[da]={scale:We[da],field:Fg})});const Ni=jm({type:xQ,role:MJ,key:Fg,from:qn,clip:!!_n||void 0,encode:Zr},st.symbols),Ui=bl($n);Ui.offset=kt("labelOffset"),af(Zr={enter:Br={opacity:Aa,x:{signal:er,offset:Ui},y:rr},update:di={opacity:Rg,text:{field:t4},x:Br.x,y:Br.y},exit:{opacity:Aa}},{align:kt("labelAlign"),baseline:kt("labelBaseline"),fill:kt("labelColor"),fillOpacity:kt("labelOpacity"),font:kt("labelFont"),fontSize:kt("labelFontSize"),fontStyle:kt("labelFontStyle"),fontWeight:kt("labelFontWeight"),limit:kt("labelLimit")});const To=jm({type:yx,role:$B,style:sE,key:Fg,from:qn,encode:Zr},st.labels);return Zr={enter:{noBound:{value:!_n},width:Aa,height:_n?bl(_n):Aa,opacity:Aa},exit:{opacity:Aa},update:di={opacity:Rg,row:{signal:null},column:{signal:null}}},kt.isVertical(!0)?(Ti=`ceil(item.mark.items.length / ${Dr})`,di.row.signal=`${fr}%${Ti}`,di.column.signal=`floor(${fr} / ${Ti})`,Di={field:["row",fr]}):(di.row.signal=`floor(${fr} / ${Dr})`,di.column.signal=`${fr} % ${Dr}`,Di={field:fr}),di.column.signal=`(${ct})?${di.column.signal}:${fr}`,cE({role:qD,from:dt={facet:{data:dt,name:"value",groupby:e4}},encode:Hw(Zr,St,uE),marks:[Ni,To],name:Mn,interactive:yn,sort:Di})}(e,n,o,Ue,gx(V.columns))],X.size=function(We,at,st){const dt=gx(Cj("size",We,st)),ct=gx(Cj("strokeWidth",We,st)),kt=gx(function(St,yn,Mn){return hj("fontSize",St)||function(_n,$n,qn){const er=$n.config.style[qn];return er&&er[_n]}("fontSize",yn,Mn)}(st[1].encode,at,sE));return ny(`max(ceil(sqrt(${dt})+${ct}),${kt})`,at)}(e,t,te[0].marks)),te=[cE({role:OJ,from:Pe,encode:{enter:{x:{value:0},y:{value:0}}},marks:te,layout:V,interactive:x})],be.title&&te.push(function(We,at,st,dt){const ct=Ep(We,at),kt={enter:{opacity:Aa},update:{opacity:Rg,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:Aa}};return af(kt,{orient:ct("titleOrient"),_anchor:ct("titleAnchor"),anchor:{signal:kQ},angle:{signal:AQ},align:{signal:CQ},baseline:{signal:OQ},text:We.title,fill:ct("titleColor"),fillOpacity:ct("titleOpacity"),font:ct("titleFont"),fontSize:ct("titleFontSize"),fontStyle:ct("titleFontStyle"),fontWeight:ct("titleFontWeight"),limit:ct("titleLimit"),lineHeight:ct("titleLineHeight")},{align:ct("titleAlign"),baseline:ct("titleBaseline")}),jm({type:yx,role:DJ,style:n4,from:dt,encode:kt},st)}(e,n,o.title,Pe)),r3(cE({role:kJ,from:Pe,encode:Hw(function(We,at,st){const dt={enter:{},update:{}};return af(dt,{orient:We("orient"),offset:We("offset"),padding:We("padding"),titlePadding:We("titlePadding"),cornerRadius:We("cornerRadius"),fill:We("fillColor"),stroke:We("strokeColor"),strokeWidth:st.strokeWidth,strokeDash:st.strokeDash,x:We("legendX"),y:We("legendY"),format:at.format,formatType:at.formatType}),dt}(u,e,n),f,uE),marks:te,aria:u("aria"),description:u("description"),zindex:u("zindex"),name:g,interactive:x,style:k}),t)}function Cj(e,t,n){return t[e]?`scale("${t[e]}",datum)`:hj(e,n[0].encode)}bx.fromEntries=function(e,t){const n=t.length,o=t[n-1],u=t[n-2];let f=t[0],g=null,x=1;for(f&&f.type==="load"&&(f=t[1]),e.add(t[0]);x<n;++x)t[x].params.pulse=Ji(t[x-1]),e.add(t[x]),t[x].type==="aggregate"&&(g=t[x]);return new bx(e,f,u,o,g)},bx.prototype={countsRef(e,t,n){const o=this,u=o.counts||(o.counts={}),f=_j(t);let g,x,k;return f!=null&&(e=o.scope,g=u[f]),g?n&&n.field&&Ej(e,g.agg.params,n):(k={groupby:e.fieldRef(t,"key"),pulse:Ji(o.output)},n&&n.field&&Ej(e,k,n),g={agg:x=e.add(tj(k)),ref:Ji(g=e.add(R0({pulse:Ji(x)})))},f!=null&&(u[f]=g)),g.ref},tuplesRef(){return Ji(this.values)},extentRef(e,t){return lE(e,this,"extent","extent",t,!1)},domainRef(e,t){return lE(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return lE(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return lE(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return lE(e,this,"indata","tupleindex",t,!0,!0)}};const FQ='item.orient==="left"?-90:item.orient==="right"?90:0';function RQ(e,t){const n=Ep(e=Object(Ce.J)(e)?{text:e}:e,t.config.title),o=e.encode||{},u=o.group||{},f=u.name||void 0,g=u.interactive,x=u.style,k=[],F=Ji(t.add(R0(null,[{}])));return k.push(function(V,X,te,ue){const he={value:0},be=V.text,Pe={enter:{opacity:he},update:{opacity:{value:1}},exit:{opacity:he}};return af(Pe,{text:be,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:X("dx"),dy:X("dy"),fill:X("color"),font:X("font"),fontSize:X("fontSize"),fontStyle:X("fontStyle"),fontWeight:X("fontWeight"),lineHeight:X("lineHeight")},{align:X("align"),angle:X("angle"),baseline:X("baseline")}),jm({type:yx,role:IJ,style:yQ,from:ue,encode:Pe},te)}(e,n,function(V){const X=V.encode;return X&&X.title||Object(Ce.p)({name:V.name,interactive:V.interactive,style:V.style},X)}(e),F)),e.subtitle&&k.push(function(V,X,te,ue){const he={value:0},be=V.subtitle,Pe={enter:{opacity:he},update:{opacity:{value:1}},exit:{opacity:he}};return af(Pe,{text:be,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:X("dx"),dy:X("dy"),fill:X("subtitleColor"),font:X("subtitleFont"),fontSize:X("subtitleFontSize"),fontStyle:X("subtitleFontStyle"),fontWeight:X("subtitleFontWeight"),lineHeight:X("subtitleLineHeight")},{align:X("align"),angle:X("angle"),baseline:X("baseline")}),jm({type:yx,role:FJ,style:bQ,from:ue,encode:Pe},te)}(e,n,o.subtitle,F)),r3(cE({role:NJ,from:F,encode:function(V,X){const te={enter:{},update:{}};return af(te,{orient:V("orient"),anchor:V("anchor"),align:{signal:s4},angle:{signal:FQ},limit:V("limit"),frame:V("frame"),offset:V("offset")||0,padding:V("subtitlePadding")}),Hw(te,X,uE)}(n,u),marks:k,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:f,interactive:g,style:x}),t)}function PQ(e,t){const n=[];e.transform&&e.transform.forEach(o=>{n.push(u4(o,t))}),e.on&&e.on.forEach(o=>{Sj(o,t,e.name)}),t.addDataPipeline(e.name,function(o,u,f){const g=[];let x,k,F,V,X,te=null,ue=!1,he=!1;for(o.values?qc(o.values)||Kk(o.format)?(g.push(kj(u,o)),g.push(te=xx())):g.push(te=xx({$ingest:o.values,$format:o.format})):o.url?Kk(o.url)||Kk(o.format)?(g.push(kj(u,o)),g.push(te=xx())):g.push(te=xx({$request:o.url,$format:o.format})):o.source&&(te=x=Object(Ce.i)(o.source).map(be=>Ji(u.getData(be).output)),g.push(null)),k=0,F=f.length;k<F;++k)V=f[k],X=V.metadata,te||X.source||g.push(te=xx()),g.push(V),X.generates&&(he=!0),X.modifies&&!he&&(ue=!0),X.source?te=V:X.changes&&(te=null);return x&&(F=x.length-1,g[0]=sQ({derive:ue,pulse:F?x:x[0]}),(ue||F)&&g.splice(1,0,xx())),te||g.push(xx()),g.push(vx({})),g}(e,t,n))}function xx(e){const t=R0({},e);return t.metadata={source:!0},t}function kj(e,t){return ZJ({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const Aj=e=>e===ib||e===P0,i3=(e,t,n)=>qc(e)?zQ(e.signal,t,n):e==="left"||e===P0?t:n,xl=(e,t,n)=>qc(e)?BQ(e.signal,t,n):Aj(e)?t:n,L0=(e,t,n)=>qc(e)?jQ(e.signal,t,n):Aj(e)?n:t,Oj=(e,t,n)=>qc(e)?UQ(e.signal,t,n):e===P0?{value:t}:{value:n},LQ=(e,t,n)=>qc(e)?WQ(e.signal,t,n):e==="right"?{value:t}:{value:n},BQ=(e,t,n)=>Tj(`${e} === '${P0}' || ${e} === '${ib}'`,t,n),jQ=(e,t,n)=>Tj(`${e} !== '${P0}' && ${e} !== '${ib}'`,t,n),zQ=(e,t,n)=>l4(`${e} === 'left' || ${e} === '${P0}'`,t,n),UQ=(e,t,n)=>l4(`${e} === '${P0}'`,t,n),WQ=(e,t,n)=>l4(`${e} === 'right'`,t,n),Tj=(e,t,n)=>(t=t!=null?bl(t):t,n=n!=null?bl(n):n,Mj(t)&&Mj(n)?{signal:`${e} ? (${t=t?t.signal||Object(Ce.Ba)(t.value):null}) : (${n=n?n.signal||Object(Ce.Ba)(n.value):null})`}:[Object(Ce.p)({test:e},t)].concat(n||[])),Mj=e=>e==null||Object.keys(e).length===1,l4=(e,t,n)=>({signal:`${e} ? (${$w(t)}) : (${$w(n)})`}),VQ=(e,t,n,o,u)=>({signal:(o!=null?`${e} === 'left' ? (${$w(o)}) : `:"")+(n!=null?`${e} === '${ib}' ? (${$w(n)}) : `:"")+(u!=null?`${e} === 'right' ? (${$w(u)}) : `:"")+(t!=null?`${e} === '${P0}' ? (${$w(t)}) : `:"")+"(null)"}),$w=e=>qc(e)?e.signal:e==null?null:Object(Ce.Ba)(e),HQ=(e,t)=>t===0?0:qc(e)?{signal:`(${e.signal}) * ${t}`}:{value:e*t},Xw=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function Kw(e,t,n,o){let u;if(t&&Object(Ce.w)(t,e))return t[e];if(Object(Ce.w)(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":u="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":u=e[5].toLowerCase()+e.slice(6)}return o[n4][u]}if(e.startsWith("label")){switch(e){case"labelColor":u="fill";break;case"labelFont":case"labelFontSize":u=e[5].toLowerCase()+e.slice(6)}return o[sE][u]}return null}function Dj(e){const t={};for(const n of e)if(n)for(const o in n)t[o]=1;return Object.keys(t)}function Nj(e,t){return{scale:e.scale,range:t}}function GQ(e,t,n,o,u){const f=Ep(e,t),g=e.orient,x=e.gridScale,k=i3(g,1,-1),F=function(We,at){if(at!==1)if(Object(Ce.H)(We)){let st=We=Object(Ce.p)({},We);for(;st.mult!=null;){if(!Object(Ce.H)(st.mult))return st.mult=qc(at)?{signal:`(${st.mult}) * (${at.signal})`}:st.mult*at,We;st=st.mult=Object(Ce.p)({},st.mult)}st.mult=at}else We=qc(at)?{signal:`(${at.signal}) * (${We||0})`}:at*(We||0);return We}(e.offset,k);let V,X,te;const ue={enter:V={opacity:Aa},update:te={opacity:Rg},exit:X={opacity:Aa}};af(ue,{stroke:f("gridColor"),strokeCap:f("gridCap"),strokeDash:f("gridDash"),strokeDashOffset:f("gridDashOffset"),strokeOpacity:f("gridOpacity"),strokeWidth:f("gridWidth")});const he={scale:e.scale,field:Fg,band:u.band,extra:u.extra,offset:u.offset,round:f("tickRound")},be=xl(g,{signal:"height"},{signal:"width"}),Pe=x?{scale:x,range:0,mult:k,offset:F}:{value:0,offset:F},Ue=x?{scale:x,range:1,mult:k,offset:F}:Object(Ce.p)(be,{mult:k,offset:F});return V.x=te.x=xl(g,he,Pe),V.y=te.y=L0(g,he,Pe),V.x2=te.x2=L0(g,Ue),V.y2=te.y2=xl(g,Ue),X.x=xl(g,he),X.y=L0(g,he),jm({type:a4,role:_J,key:Fg,from:o,encode:ue},n)}function f4(e,t,n,o,u){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+o+","+u+")"}}function qQ(e,t,n,o,u,f){const g=Ep(e,t),x=e.orient,k=e.scale,F=i3(x,-1,1),V=gx(g("labelFlush")),X=gx(g("labelFlushOffset")),te=g("labelAlign"),ue=g("labelBaseline");let he,be=V===0||!!V;const Pe=bl(u);Pe.mult=F,Pe.offset=bl(g("labelPadding")||0),Pe.offset.mult=F;const Ue={scale:k,field:Fg,band:.5,offset:function yn(Mn,_n){return _n?Mn?Object(Ce.H)(Mn)?Object.assign({},Mn,{offset:yn(Mn.offset,_n)}):{value:Mn,offset:_n}:_n:Mn}(f.offset,g("labelOffset"))},We=xl(x,be?f4(k,V,'"left"','"right"','"center"'):{value:"center"},LQ(x,"left","right")),at=xl(x,Oj(x,"bottom","top"),be?f4(k,V,'"top"','"bottom"','"middle"'):{value:"middle"}),st=f4(k,V,`-(${X})`,X,0);be=be&&X;const dt={opacity:Aa,x:xl(x,Ue,Pe),y:L0(x,Ue,Pe)},ct={enter:dt,update:he={opacity:Rg,text:{field:t4},x:dt.x,y:dt.y,align:We,baseline:at},exit:{opacity:Aa,x:dt.x,y:dt.y}};af(ct,{dx:!te&&be?xl(x,st):null,dy:!ue&&be?L0(x,st):null}),af(ct,{angle:g("labelAngle"),fill:g("labelColor"),fillOpacity:g("labelOpacity"),font:g("labelFont"),fontSize:g("labelFontSize"),fontWeight:g("labelFontWeight"),fontStyle:g("labelFontStyle"),limit:g("labelLimit"),lineHeight:g("labelLineHeight")},{align:te,baseline:ue});const kt=g("labelBound");let St=g("labelOverlap");return St=St||kt?{separation:g("labelSeparation"),method:St,order:"datum.index",bound:kt?{scale:k,orient:x,tolerance:kt}:null}:void 0,he.align!==We&&(he.align=Xw(he.align,We)),he.baseline!==at&&(he.baseline=Xw(he.baseline,at)),jm({type:yx,role:EJ,style:sE,key:Fg,from:o,encode:ct,overlap:St},n)}function $Q(e,t,n,o){const u=Ep(e,t),f=e.orient,g=i3(f,-1,1);let x,k;const F={enter:x={opacity:Aa,anchor:bl(u("titleAnchor",null)),align:{signal:s4}},update:k=Object(Ce.p)({},x,{opacity:Rg,text:bl(e.title)}),exit:{opacity:Aa}},V={signal:`lerp(range("${e.scale}"), ${e3(0,1,.5)})`};return k.x=xl(f,V),k.y=L0(f,V),x.angle=xl(f,Aa,HQ(g,90)),x.baseline=xl(f,Oj(f,ib,P0),{value:ib}),k.angle=x.angle,k.baseline=x.baseline,af(F,{fill:u("titleColor"),fillOpacity:u("titleOpacity"),font:u("titleFont"),fontSize:u("titleFontSize"),fontStyle:u("titleFontStyle"),fontWeight:u("titleFontWeight"),limit:u("titleLimit"),lineHeight:u("titleLineHeight")},{align:u("titleAlign"),angle:u("titleAngle"),baseline:u("titleBaseline")}),function(X,te,ue,he){const be=(We,at)=>We!=null?(ue.update[at]=Xw(bl(We),ue.update[at]),!1):!Gw(at,he),Pe=be(X("titleX"),"x"),Ue=be(X("titleY"),"y");ue.enter.auto=Ue===Pe?bl(Ue):xl(te,bl(Ue),bl(Pe))}(u,f,F,n),F.update.align=Xw(F.update.align,x.align),F.update.angle=Xw(F.update.angle,x.angle),F.update.baseline=Xw(F.update.baseline,x.baseline),jm({type:yx,role:CJ,style:n4,from:o,encode:F},n)}function XQ(e,t){const n=function(be,Pe){var Ue,We,at,st=Pe.config,dt=st.style,ct=st.axis,kt=Pe.scaleType(be.scale)==="band"&&st.axisBand,St=be.orient;if(qc(St)){const yn=Dj([st.axisX,st.axisY]),Mn=Dj([st.axisTop,st.axisBottom,st.axisLeft,st.axisRight]);for(at of(Ue={},yn))Ue[at]=xl(St,Kw(at,st.axisX,ct,dt),Kw(at,st.axisY,ct,dt));for(at of(We={},Mn))We[at]=VQ(St.signal,Kw(at,st.axisTop,ct,dt),Kw(at,st.axisBottom,ct,dt),Kw(at,st.axisLeft,ct,dt),Kw(at,st.axisRight,ct,dt))}else Ue=St===P0||St===ib?st.axisX:st.axisY,We=st["axis"+St[0].toUpperCase()+St.slice(1)];return Ue||We||kt?Object(Ce.p)({},ct,Ue,We,kt):ct}(e,t),o=e.encode||{},u=o.axis||{},f=u.name||void 0,g=u.interactive,x=u.style,k=Ep(e,n),F=function(be){const Pe=be("tickBand");let Ue,We,at=be("tickOffset");return Pe?Pe.signal?(Ue={signal:`(${Pe.signal}) === 'extent' ? 1 : 0.5`},We={signal:`(${Pe.signal}) === 'extent'`},Object(Ce.H)(at)||(at={signal:`(${Pe.signal}) === 'extent' ? 0 : ${at}`})):Pe==="extent"?(Ue=1,We=!0,at=0):(Ue=.5,We=!1):(Ue=be("bandPosition"),We=be("tickExtra")),{extra:We,band:Ue,offset:at}}(k),V={scale:e.scale,ticks:!!k("ticks"),labels:!!k("labels"),grid:!!k("grid"),domain:!!k("domain"),title:e.title!=null},X=Ji(t.add(R0({},[V]))),te=Ji(t.add(qJ({scale:t.scaleRef(e.scale),extra:t.property(F.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),ue=[];let he;return V.grid&&ue.push(GQ(e,n,o.grid,te,F)),V.ticks&&(he=k("tickSize"),ue.push(function(be,Pe,Ue,We,at,st){const dt=Ep(be,Pe),ct=be.orient,kt=i3(ct,-1,1);let St,yn,Mn;const _n={enter:St={opacity:Aa},update:Mn={opacity:Rg},exit:yn={opacity:Aa}};af(_n,{stroke:dt("tickColor"),strokeCap:dt("tickCap"),strokeDash:dt("tickDash"),strokeDashOffset:dt("tickDashOffset"),strokeOpacity:dt("tickOpacity"),strokeWidth:dt("tickWidth")});const $n=bl(at);$n.mult=kt;const qn={scale:be.scale,field:Fg,band:st.band,extra:st.extra,offset:st.offset,round:dt("tickRound")};return Mn.y=St.y=xl(ct,Aa,qn),Mn.y2=St.y2=xl(ct,$n),yn.x=xl(ct,qn),Mn.x=St.x=L0(ct,Aa,qn),Mn.x2=St.x2=L0(ct,$n),yn.y=L0(ct,qn),jm({type:a4,role:SJ,key:Fg,from:We,encode:_n},Ue)}(e,n,o.ticks,te,he,F))),V.labels&&(he=V.ticks?he:0,ue.push(qQ(e,n,o.labels,te,he,F))),V.domain&&ue.push(function(be,Pe,Ue,We){const at=Ep(be,Pe),st=be.orient;let dt,ct;const kt={enter:dt={opacity:Aa},update:ct={opacity:Rg},exit:{opacity:Aa}};af(kt,{stroke:at("domainColor"),strokeCap:at("domainCap"),strokeDash:at("domainDash"),strokeDashOffset:at("domainDashOffset"),strokeWidth:at("domainWidth"),strokeOpacity:at("domainOpacity")});const St=Nj(be,0),yn=Nj(be,1);return dt.x=ct.x=xl(st,St,Aa),dt.x2=ct.x2=xl(st,yn),dt.y=ct.y=L0(st,St,Aa),dt.y2=ct.y2=L0(st,yn),jm({type:a4,role:wJ,from:We,encode:kt},Ue)}(e,n,o.domain,X)),V.title&&ue.push($Q(e,n,o.title,X)),r3(cE({role:xJ,from:X,encode:Hw(function(be,Pe){const Ue={enter:{},update:{}};return af(Ue,{orient:be("orient"),offset:be("offset")||0,position:F0(Pe.position,0),titlePadding:be("titlePadding"),minExtent:be("minExtent"),maxExtent:be("maxExtent"),range:{signal:`abs(span(range("${Pe.scale}")))`},translate:be("translate"),format:Pe.format,formatType:Pe.formatType}),Ue}(k,e),u,uE),marks:ue,aria:k("aria"),description:k("description"),zindex:k("zindex"),name:f,interactive:g,style:x}),t)}function Ij(e,t,n){const o=Object(Ce.i)(e.signals),u=Object(Ce.i)(e.scales);return n||o.forEach(f=>QB(f,t)),Object(Ce.i)(e.projections).forEach(f=>function(g,x){const k=x.config.projection||{},F={};for(const V in g)V!=="name"&&(F[V]=ZD(g[V],V,x));for(const V in k)F[V]==null&&(F[V]=ZD(k[V],V,x));x.addProjection(g.name,F)}(f,t)),u.forEach(f=>function(g,x){const k=g.type||"linear";vm(k)||Object(Ce.o)("Unrecognized scale type: "+Object(Ce.Ba)(k)),x.addScale(g.name,{type:k,domain:void 0})}(f,t)),Object(Ce.i)(e.data).forEach(f=>PQ(f,t)),u.forEach(f=>dQ(f,t)),(n||o).forEach(f=>function(g,x){const k=x.getSignal(g.name);let F=g.update;g.init&&(F?Object(Ce.o)("Signals can not include both init and update expressions."):(F=g.init,k.initonly=!0)),F&&(F=ny(F,x),k.update=F.$expr,k.params=F.$params),g.on&&g.on.forEach(V=>GJ(V,x,k.id))}(f,t)),Object(Ce.i)(e.axes).forEach(f=>XQ(f,t)),Object(Ce.i)(e.marks).forEach(f=>r3(f,t)),Object(Ce.i)(e.legends).forEach(f=>IQ(f,t)),e.title&&RQ(e.title,t),t.parseLambdas(),t}const KQ=e=>Hw({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e);function YQ(e,t){const n=t.config,o=Ji(t.root=t.add($k())),u=function(F,V){const X=be=>F0(F[be],V[be]),te=[fE("background",X("background")),fE("autosize",function(be){return Object(Ce.H)(be)?be:{type:be||"pad"}}(X("autosize"))),fE("padding",function(be){return Object(Ce.H)(be)?be.signal?be:{top:iE(be.top),bottom:iE(be.bottom),left:iE(be.left),right:iE(be.right)}:bJ(iE(be))}(X("padding"))),fE("width",X("width")||0),fE("height",X("height")||0)],ue=te.reduce((be,Pe)=>(be[Pe.name]=Pe,be),{}),he={};return Object(Ce.i)(F.signals).forEach(be=>{Object(Ce.w)(ue,be.name)?be=Object(Ce.p)(ue[be.name],be):te.push(be),he[be.name]=be}),Object(Ce.i)(V.signals).forEach(be=>{Object(Ce.w)(he,be.name)||Object(Ce.w)(ue,be.name)||te.push(be)}),te}(e,n);u.forEach(F=>QB(F,t)),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const f=t.add(R0()),g=t.add(ij(YB(KQ(e.encode),Zk,GD,e.style,t,{pulse:Ji(f)}))),x=t.add(sj({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:o,pulse:Ji(g)}));t.operators.pop(),t.pushState(Ji(g),Ji(x),null),Ij(e,t,u),t.operators.push(x);let k=t.add(nj({mark:o,pulse:Ji(x)}));return k=t.add(aj({pulse:Ji(k)})),k=t.add(vx({pulse:Ji(k)})),t.addData("root",new bx(t,f,f,k)),t}function fE(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function Fj(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function Rj(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function d4(e){return(Object(Ce.B)(e)?function(t){const n=t.length;let o="[";for(let u=0;u<n;++u){const f=t[u];o+=(u>0?",":"")+(Object(Ce.H)(f)?f.signal||d4(f):Object(Ce.Ba)(f))}return o+"]"}:function(t){let n,o,u="{",f=0;for(n in t)o=t[n],u+=(++f>1?",":"")+Object(Ce.Ba)(n)+":"+(Object(Ce.H)(o)?o.signal||d4(o):Object(Ce.Ba)(o));return u+"}"})(e)}function JQ(e,t,n){return Object(Ce.H)(e)||Object(Ce.o)("Input Vega specification must be an object."),YQ(e,new Fj(t=Object(Ce.P)({description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:"#4c78a8"},area:{fill:"#4c78a8"},image:null,line:{stroke:"#4c78a8",strokeWidth:2},path:{stroke:"#4c78a8"},rect:{fill:"#4c78a8"},rule:{stroke:"#000"},shape:{stroke:"#4c78a8"},symbol:{fill:"#4c78a8",size:64},text:{fill:"#000",font:"sans-serif",fontSize:11},trail:{fill:"#4c78a8",size:2},style:{"guide-label":{fill:"#000",font:"sans-serif",fontSize:10},"guide-title":{fill:"#000",font:"sans-serif",fontSize:11,fontWeight:"bold"},"group-title":{fill:"#000",font:"sans-serif",fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:"#000",font:"sans-serif",fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:"#ddd"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:"#888",grid:!1,gridWidth:1,gridColor:"#ddd",labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:"#888",tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:"#ddd",gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:"#888",titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}},t,e.config),n)).toRuntime()}Fj.prototype=Rj.prototype={parse(e){return Ij(e,this)},fork(){return new Rj(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(t=>{t.$ref=e.id}),e.refs=null),e},proxy(e){const t=e instanceof XD?Ji(e):e;return this.add(aQ({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(o,u,f){let g;o&&((g=o.data||(o.data={}))[u]||(g[u]=[])).push(f)}for(e in this.data){n((t=this.data[e]).input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const o in t.index)n(t.index[o],e,"index:"+o)}return this},pushState(e,t,n){this._encode.push(Ji(this.add(vx({pulse:e})))),this._parent.push(t),this._lookup.push(n?Ji(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return Object(Ce.W)(this._parent)},encode(){return Object(Ce.W)(this._encode)},lookup(){return Object(Ce.W)(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(Object(Ce.J)(e))return oE(e,t);e.signal||Object(Ce.o)("Unsupported field reference: "+Object(Ce.Ba)(e));const n=e.signal;let o=this.field[n];if(!o){const u={name:this.signalRef(n)};t&&(u.as=t),this.field[n]=o=Ji(this.add(YJ(u)))}return o},compareRef(e){let t=!1;const n=f=>qc(f)?(t=!0,this.signalRef(f.signal)):function(g){return g&&g.expr}(f)?(t=!0,this.exprRef(f.expr)):f,o=Object(Ce.i)(e.field).map(n),u=Object(Ce.i)(e.order).map(n);return t?Ji(this.add(rj({fields:o,orders:u}))):ZB(o,u)},keyRef(e,t){let n=!1;const o=this.signals;return e=Object(Ce.i)(e).map(u=>qc(u)?(n=!0,Ji(o[u.signal])):u),n?Ji(this.add(JJ({fields:e,flat:t}))):function(u,f){const g={$key:u};return f&&(g.$flat=!0),g}(e,t)},sortRef(e){if(!e)return e;const t=Xk(e.op,e.field),n=e.order||"ascending";return n.signal?Ji(this.add(rj({fields:t,orders:this.signalRef(n.signal)}))):ZB(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const o=this.id();this.streams.push({id:o,source:e,type:t}),this.events[n]=o}return this.events[n]},hasOwnSignal(e){return Object(Ce.w)(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&Object(Ce.o)("Duplicate signal name: "+Object(Ce.Ba)(e));const n=t instanceof XD?t:this.add($k(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||Object(Ce.o)("Unrecognized signal name: "+Object(Ce.Ba)(e)),this.signals[e]},signalRef(e){return this.signals[e]?Ji(this.signals[e]):(Object(Ce.w)(this.lambdas,e)||(this.lambdas[e]=this.add($k(null))),Ji(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const o=e[t],u=ny(o,this),f=this.lambdas[o];f.params=u.$params,f.update=u.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return e&&Object(Ce.H)(e)?this.signalRef(e.signal||d4(e)):e},exprRef(e,t){const n={expr:ny(e,this)};return t&&(n.expr.$name=t),Ji(this.add(XJ(n)))},addBinding(e,t){this.bindings||Object(Ce.o)("Nested signals do not support binding: "+Object(Ce.Ba)(e)),this.bindings.push(Object(Ce.p)({signal:e},t))},addScaleProj(e,t){Object(Ce.w)(this.scales,e)&&Object(Ce.o)("Duplicate scale or projection name: "+Object(Ce.Ba)(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,uQ(t))},addProjection(e,t){this.addScaleProj(e,oQ(t))},getScale(e){return this.scales[e]||Object(Ce.o)("Unrecognized scale name: "+Object(Ce.Ba)(e)),this.scales[e]},scaleRef(e){return Ji(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return Object(Ce.w)(this.data,e)&&Object(Ce.o)("Duplicate data set name: "+Object(Ce.Ba)(e)),this.data[e]=t},getData(e){return this.data[e]||Object(Ce.o)("Undefined data set name: "+Object(Ce.Ba)(e)),this.data[e]},addDataPipeline(e,t){return Object(Ce.w)(this.data,e)&&Object(Ce.o)("Duplicate data set name: "+Object(Ce.Ba)(e)),this.addData(e,bx.fromEntries(this,t))}};const QQ="RawCode",ZQ="Literal",eZ="Property",tZ="Identifier",nZ="ArrayExpression",rZ="BinaryExpression",iZ="CallExpression",oZ="ConditionalExpression",aZ="LogicalExpression",sZ="MemberExpression",uZ="ObjectExpression",cZ="UnaryExpression";function B0(e){this.type=e}var t1,ji,Hr,Qf,cs;B0.prototype.visit=function(e){let t,n,o;if(e(this))return 1;for(n=0,o=(t=function(u){switch(u.type){case nZ:return u.elements;case rZ:case aZ:return[u.left,u.right];case iZ:return[u.callee].concat(u.arguments);case oZ:return[u.test,u.consequent,u.alternate];case sZ:return[u.object,u.property];case uZ:return u.properties;case eZ:return[u.key,u.value];case cZ:return[u.argument];case tZ:case ZQ:case QQ:default:return[]}}(this)).length;n<o;++n)if(t[n].visit(e))return 1};var o3=1,dE=2,wx=3,ob=4,a3=5,_x=6,Sp=7,hE=8;(t1={})[o3]="Boolean",t1[dE]="<end>",t1[wx]="Identifier",t1[ob]="Keyword",t1[a3]="Null",t1[_x]="Numeric",t1[Sp]="Punctuator",t1[hE]="String",t1[9]="RegularExpression";var lZ="ArrayExpression",fZ="BinaryExpression",dZ="CallExpression",hZ="ConditionalExpression",Pj="Identifier",pZ="Literal",mZ="LogicalExpression",gZ="MemberExpression",vZ="ObjectExpression",yZ="Property",bZ="UnaryExpression",wl="Unexpected token %0",xZ="Unexpected number",wZ="Unexpected string",_Z="Unexpected identifier",EZ="Unexpected reserved word",SZ="Unexpected end of input",h4="Invalid regular expression",p4="Invalid regular expression: missing /",Lj="Octal literals are not allowed in strict mode.",CZ="Duplicate data property in object literal not allowed in strict mode",sf="ILLEGAL",pE="Disabled.",kZ=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),AZ=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function s3(e,t){if(!e)throw new Error("ASSERT: "+t)}function n1(e){return e>=48&&e<=57}function m4(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function mE(e){return"01234567".indexOf(e)>=0}function OZ(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function gE(e){return e===10||e===13||e===8232||e===8233}function vE(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&kZ.test(String.fromCharCode(e))}function u3(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&AZ.test(String.fromCharCode(e))}const TZ={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function Bj(){for(;Hr<Qf;){const e=ji.charCodeAt(Hr);if(!OZ(e)&&!gE(e))break;++Hr}}function g4(e){var t,n,o,u=0;for(n=e==="u"?4:2,t=0;t<n;++t)Hr<Qf&&m4(ji[Hr])?(o=ji[Hr++],u=16*u+"0123456789abcdef".indexOf(o.toLowerCase())):Va({},wl,sf);return String.fromCharCode(u)}function MZ(){var e,t,n,o;for(t=0,(e=ji[Hr])==="}"&&Va({},wl,sf);Hr<Qf&&m4(e=ji[Hr++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&Va({},wl,sf),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),o=56320+(t-65536&1023),String.fromCharCode(n,o))}function jj(){var e,t;for(e=ji.charCodeAt(Hr++),t=String.fromCharCode(e),e===92&&(ji.charCodeAt(Hr)!==117&&Va({},wl,sf),++Hr,(e=g4("u"))&&e!=="\\"&&vE(e.charCodeAt(0))||Va({},wl,sf),t=e);Hr<Qf&&u3(e=ji.charCodeAt(Hr));)++Hr,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),ji.charCodeAt(Hr)!==117&&Va({},wl,sf),++Hr,(e=g4("u"))&&e!=="\\"&&u3(e.charCodeAt(0))||Va({},wl,sf),t+=e);return t}function DZ(){var e,t;return e=Hr,{type:(t=ji.charCodeAt(Hr)===92?jj():function(){var n,o;for(n=Hr++;Hr<Qf;){if((o=ji.charCodeAt(Hr))===92)return Hr=n,jj();if(!u3(o))break;++Hr}return ji.slice(n,Hr)}()).length===1?wx:TZ.hasOwnProperty(t)?ob:t==="null"?a3:t==="true"||t==="false"?o3:wx,value:t,start:e,end:Hr}}function v4(){var e,t,n,o,u=Hr,f=ji.charCodeAt(Hr),g=ji[Hr];switch(f){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Hr,{type:Sp,value:String.fromCharCode(f),start:u,end:Hr};default:if((e=ji.charCodeAt(Hr+1))===61)switch(f){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Hr+=2,{type:Sp,value:String.fromCharCode(f)+String.fromCharCode(e),start:u,end:Hr};case 33:case 61:return Hr+=2,ji.charCodeAt(Hr)===61&&++Hr,{type:Sp,value:ji.slice(u,Hr),start:u,end:Hr}}}return(o=ji.substr(Hr,4))===">>>="?{type:Sp,value:o,start:u,end:Hr+=4}:(n=o.substr(0,3))===">>>"||n==="<<="||n===">>="?{type:Sp,value:n,start:u,end:Hr+=3}:g===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(g)>=0||t==="=>"?{type:Sp,value:t,start:u,end:Hr+=2}:(t==="//"&&Va({},wl,sf),"<>=!+-*%&|^/".indexOf(g)>=0?{type:Sp,value:g,start:u,end:++Hr}:void Va({},wl,sf))}function zj(){var e,t,n;if(s3(n1((n=ji[Hr]).charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=Hr,e="",n!=="."){if(e=ji[Hr++],n=ji[Hr],e==="0"){if(n==="x"||n==="X")return++Hr,function(o){let u="";for(;Hr<Qf&&m4(ji[Hr]);)u+=ji[Hr++];return u.length===0&&Va({},wl,sf),vE(ji.charCodeAt(Hr))&&Va({},wl,sf),{type:_x,value:parseInt("0x"+u,16),start:o,end:Hr}}(t);if(mE(n))return function(o){let u="0"+ji[Hr++];for(;Hr<Qf&&mE(ji[Hr]);)u+=ji[Hr++];return(vE(ji.charCodeAt(Hr))||n1(ji.charCodeAt(Hr)))&&Va({},wl,sf),{type:_x,value:parseInt(u,8),octal:!0,start:o,end:Hr}}(t);n&&n1(n.charCodeAt(0))&&Va({},wl,sf)}for(;n1(ji.charCodeAt(Hr));)e+=ji[Hr++];n=ji[Hr]}if(n==="."){for(e+=ji[Hr++];n1(ji.charCodeAt(Hr));)e+=ji[Hr++];n=ji[Hr]}if(n==="e"||n==="E")if(e+=ji[Hr++],(n=ji[Hr])!=="+"&&n!=="-"||(e+=ji[Hr++]),n1(ji.charCodeAt(Hr)))for(;n1(ji.charCodeAt(Hr));)e+=ji[Hr++];else Va({},wl,sf);return vE(ji.charCodeAt(Hr))&&Va({},wl,sf),{type:_x,value:parseFloat(e),start:t,end:Hr}}function NZ(){var e,t,n,o;return cs=null,Bj(),e=Hr,t=function(){var u,f,g,x;for(s3((u=ji[Hr])==="/","Regular expression literal must start with a slash"),f=ji[Hr++],g=!1,x=!1;Hr<Qf;)if(f+=u=ji[Hr++],u==="\\")gE((u=ji[Hr++]).charCodeAt(0))&&Va({},p4),f+=u;else if(gE(u.charCodeAt(0)))Va({},p4);else if(g)u==="]"&&(g=!1);else{if(u==="/"){x=!0;break}u==="["&&(g=!0)}return x||Va({},p4),{value:f.substr(1,f.length-2),literal:f}}(),n=function(){var u,f,g;for(f="",g="";Hr<Qf&&u3((u=ji[Hr]).charCodeAt(0));)++Hr,u==="\\"&&Hr<Qf?Va({},wl,sf):(g+=u,f+=u);return g.search(/[^gimuy]/g)>=0&&Va({},h4,g),{value:g,literal:f}}(),o=function(u,f){let g=u;f.indexOf("u")>=0&&(g=g.replace(/\\u\{([0-9a-fA-F]+)\}/g,(x,k)=>{if(parseInt(k,16)<=1114111)return"x";Va({},h4)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(g)}catch{Va({},h4)}try{return new RegExp(u,f)}catch{return null}}(t.value,n.value),{literal:t.literal+n.literal,value:o,regex:{pattern:t.value,flags:n.value},start:e,end:Hr}}function Uj(){if(Bj(),Hr>=Qf)return{type:dE,start:Hr,end:Hr};const e=ji.charCodeAt(Hr);return vE(e)?DZ():e===40||e===41||e===59?v4():e===39||e===34?function(){var t,n,o,u,f="",g=!1;for(s3((t=ji[Hr])==="'"||t==='"',"String literal must starts with a quote"),n=Hr,++Hr;Hr<Qf;){if((o=ji[Hr++])===t){t="";break}if(o==="\\")if((o=ji[Hr++])&&gE(o.charCodeAt(0)))o==="\r"&&ji[Hr]===`
`&&++Hr;else switch(o){case"u":case"x":ji[Hr]==="{"?(++Hr,f+=MZ()):f+=g4(o);break;case"n":f+=`
`;break;case"r":f+="\r";break;case"t":f+="	";break;case"b":f+="\b";break;case"f":f+="\f";break;case"v":f+="\v";break;default:mE(o)?((u="01234567".indexOf(o))!==0&&(g=!0),Hr<Qf&&mE(ji[Hr])&&(g=!0,u=8*u+"01234567".indexOf(ji[Hr++]),"0123".indexOf(o)>=0&&Hr<Qf&&mE(ji[Hr])&&(u=8*u+"01234567".indexOf(ji[Hr++]))),f+=String.fromCharCode(u)):f+=o}else{if(gE(o.charCodeAt(0)))break;f+=o}}return t!==""&&Va({},wl,sf),{type:hE,value:f,octal:g,start:n,end:Hr}}():e===46?n1(ji.charCodeAt(Hr+1))?zj():v4():n1(e)?zj():v4()}function Cp(){const e=cs;return Hr=e.end,cs=Uj(),Hr=e.end,e}function Wj(){const e=Hr;cs=Uj(),Hr=e}function Vj(e,t,n){const o=new B0(e==="||"||e==="&&"?mZ:fZ);return o.operator=e,o.left=t,o.right=n,o}function IZ(e,t){const n=new B0(dZ);return n.callee=e,n.arguments=t,n}function y4(e){const t=new B0(Pj);return t.name=e,t}function yE(e){const t=new B0(pZ);return t.value=e.value,t.raw=ji.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function Hj(e,t,n){const o=new B0(gZ);return o.computed=e==="[",o.object=t,o.property=n,o.computed||(n.member=!0),o}function Gj(e,t,n){const o=new B0(yZ);return o.key=t,o.value=n,o.kind=e,o}function Va(e,t){var n,o=Array.prototype.slice.call(arguments,2),u=t.replace(/%(\d)/g,(f,g)=>(s3(g<o.length,"Message reference must be in range"),o[g]));throw(n=new Error(u)).index=Hr,n.description=u,n}function c3(e){e.type===dE&&Va(e,SZ),e.type===_x&&Va(e,xZ),e.type===hE&&Va(e,wZ),e.type===wx&&Va(e,_Z),e.type===ob&&Va(e,EZ),Va(e,wl,e.value)}function Zf(e){const t=Cp();t.type===Sp&&t.value===e||c3(t)}function tu(e){return cs.type===Sp&&cs.value===e}function b4(e){return cs.type===ob&&cs.value===e}function FZ(){const e=[];for(Hr=cs.start,Zf("[");!tu("]");)tu(",")?(Cp(),e.push(null)):(e.push(Ex()),tu("]")||Zf(","));return Cp(),function(t){const n=new B0(lZ);return n.elements=t,n}(e)}function qj(){Hr=cs.start;const e=Cp();return e.type===hE||e.type===_x?(e.octal&&Va(e,Lj),yE(e)):y4(e.value)}function RZ(){var e,t,n;return Hr=cs.start,(e=cs).type===wx?(n=qj(),Zf(":"),Gj("init",n,Ex())):e.type!==dE&&e.type!==Sp?(t=qj(),Zf(":"),Gj("init",t,Ex())):void c3(e)}function PZ(){var e,t,n=[],o={},u=String;for(Hr=cs.start,Zf("{");!tu("}");)t="$"+((e=RZ()).key.type===Pj?e.key.name:u(e.key.value)),Object.prototype.hasOwnProperty.call(o,t)?Va({},CZ):o[t]=!0,n.push(e),tu("}")||Zf(",");return Zf("}"),function(f){const g=new B0(vZ);return g.properties=f,g}(n)}const LZ={if:1};function BZ(){var e,t,n;if(tu("("))return function(){Zf("(");const o=x4();return Zf(")"),o}();if(tu("["))return FZ();if(tu("{"))return PZ();if(e=cs.type,Hr=cs.start,e===wx||LZ[cs.value])n=y4(Cp().value);else if(e===hE||e===_x)cs.octal&&Va(cs,Lj),n=yE(Cp());else{if(e===ob)throw new Error(pE);e===o3?((t=Cp()).value=t.value==="true",n=yE(t)):e===a3?((t=Cp()).value=null,n=yE(t)):tu("/")||tu("/=")?(n=yE(NZ()),Wj()):c3(Cp())}return n}function jZ(){const e=[];if(Zf("("),!tu(")"))for(;Hr<Qf&&(e.push(Ex()),!tu(")"));)Zf(",");return Zf(")"),e}function zZ(){Hr=cs.start;const e=Cp();return function(t){return t.type===wx||t.type===ob||t.type===o3||t.type===a3}(e)||c3(e),y4(e.value)}function UZ(){Zf("[");const e=x4();return Zf("]"),e}function $j(){const e=function(){var t;for(t=BZ();;)if(tu("."))Zf("."),t=Hj(".",t,zZ());else if(tu("("))t=IZ(t,jZ());else{if(!tu("["))break;t=Hj("[",t,UZ())}return t}();if(cs.type===Sp&&(tu("++")||tu("--")))throw new Error(pE);return e}function l3(){var e,t;if(cs.type!==Sp&&cs.type!==ob)t=$j();else{if(tu("++")||tu("--"))throw new Error(pE);if(tu("+")||tu("-")||tu("~")||tu("!"))e=Cp(),t=l3(),t=function(n,o){const u=new B0(bZ);return u.operator=n,u.argument=o,u.prefix=!0,u}(e.value,t);else{if(b4("delete")||b4("void")||b4("typeof"))throw new Error(pE);t=$j()}}return t}function Xj(e){let t=0;if(e.type!==Sp&&e.type!==ob)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function Ex(){var e,t;return e=function(){var n,o,u,f,g,x,k,F,V,X;if(n=cs,V=l3(),(g=Xj(f=cs))===0)return V;for(f.prec=g,Cp(),o=[n,cs],x=[V,f,k=l3()];(g=Xj(cs))>0;){for(;x.length>2&&g<=x[x.length-2].prec;)k=x.pop(),F=x.pop().value,V=x.pop(),o.pop(),u=Vj(F,V,k),x.push(u);(f=Cp()).prec=g,x.push(f),o.push(cs),u=l3(),x.push(u)}for(u=x[X=x.length-1],o.pop();X>1;)o.pop(),u=Vj(x[X-1].value,x[X-2],u),X-=2;return u}(),tu("?")&&(Cp(),t=Ex(),Zf(":"),e=function(n,o,u){const f=new B0(hZ);return f.test=n,f.consequent=o,f.alternate=u,f}(e,t,Ex())),e}function x4(){const e=Ex();if(tu(","))throw new Error(pE);return e}function WZ(e){Hr=0,Qf=(ji=e).length,cs=null,Wj();const t=x4();if(cs.type!==dE)throw new Error("Unexpect token after expression.");return t}var VZ={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function HZ(e){function t(o,u,f){return g=>function(x,k,F,V){let X=e(k[0]);return F&&(X=F+"("+X+")",F.lastIndexOf("new ",0)===0&&(X="("+X+")")),X+"."+x+(V<0?"":V===0?"()":"("+k.slice(1).map(e).join(",")+")")}(o,g,u,f)}const n="new Date";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(o){o.length<3&&Object(Ce.o)("Missing arguments to clamp function."),o.length>3&&Object(Ce.o)("Too many arguments to clamp function.");const u=o.map(e);return"Math.max("+u[1]+", Math.min("+u[2]+","+u[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase","String",0),lower:t("toLowerCase","String",0),substring:t("substring","String"),split:t("split","String"),trim:t("trim","String",0),regexp:"RegExp",test:t("test","RegExp"),if:function(o){o.length<3&&Object(Ce.o)("Missing arguments to if function."),o.length>3&&Object(Ce.o)("Too many arguments to if function.");const u=o.map(e);return"("+u[0]+"?"+u[1]+":"+u[2]+")"}}}function GZ(e){const t=(e=e||{}).allowed?Object(Ce.Fa)(e.allowed):{},n=e.forbidden?Object(Ce.Fa)(e.forbidden):{},o=e.constants||VZ,u=(e.functions||HZ)(X),f=e.globalvar,g=e.fieldvar,x=Object(Ce.E)(f)?f:he=>"".concat(f,'["').concat(he,'"]');let k={},F={},V=0;function X(he){if(Object(Ce.J)(he))return he;const be=te[he.type];return be==null&&Object(Ce.o)("Unsupported type: "+he.type),be(he)}const te={Literal:he=>he.raw,Identifier:he=>{const be=he.name;return V>0?be:Object(Ce.w)(n,be)?Object(Ce.o)("Illegal identifier: "+be):Object(Ce.w)(o,be)?o[be]:Object(Ce.w)(t,be)?be:(k[be]=1,x(be))},MemberExpression:he=>{const be=!he.computed,Pe=X(he.object);be&&(V+=1);const Ue=X(he.property);return Pe===g&&(F[function(We){const at=We&&We.length-1;return at&&(We[0]==='"'&&We[at]==='"'||We[0]==="'"&&We[at]==="'")?We.slice(1,-1):We}(Ue)]=1),be&&(V-=1),Pe+(be?"."+Ue:"["+Ue+"]")},CallExpression:he=>{he.callee.type!=="Identifier"&&Object(Ce.o)("Illegal callee type: "+he.callee.type);const be=he.callee.name,Pe=he.arguments,Ue=Object(Ce.w)(u,be)&&u[be];return Ue||Object(Ce.o)("Unrecognized function: "+be),Object(Ce.E)(Ue)?Ue(Pe):Ue+"("+Pe.map(X).join(",")+")"},ArrayExpression:he=>"["+he.elements.map(X).join(",")+"]",BinaryExpression:he=>"("+X(he.left)+" "+he.operator+" "+X(he.right)+")",UnaryExpression:he=>"("+he.operator+X(he.argument)+")",ConditionalExpression:he=>"("+X(he.test)+"?"+X(he.consequent)+":"+X(he.alternate)+")",LogicalExpression:he=>"("+X(he.left)+he.operator+X(he.right)+")",ObjectExpression:he=>"{"+he.properties.map(X).join(",")+"}",Property:he=>{V+=1;const be=X(he.key);return V-=1,be+":"+X(he.value)}};function ue(he){const be={code:X(he),globals:Object.keys(k),fields:Object.keys(F)};return k={},F={},be}return ue.functions=u,ue.constants=o,ue}const qZ="view",f3="[",d3="]",Kj="{",Yj="}",$Z=":",Jj=",",XZ="@",KZ=">",YZ=/[[\]{}]/,JZ={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let Qj,Zj;function Sx(e,t,n){return Qj=t||qZ,Zj=n||JZ,e8(e.trim()).map(w4)}function bE(e,t,n,o,u){const f=e.length;let g,x=0;for(;t<f;++t){if(g=e[t],!x&&g===n)return t;u&&u.indexOf(g)>=0?--x:o&&o.indexOf(g)>=0&&++x}return t}function e8(e){const t=[],n=e.length;let o=0,u=0;for(;u<n;)u=bE(e,u,Jj,f3+Kj,d3+Yj),t.push(e.substring(o,u).trim()),o=++u;if(t.length===0)throw"Empty event selector: "+e;return t}function w4(e){return e[0]==="["?function(t){const n=t.length;let o,u=1;if((u=bE(t,u,d3,f3,d3))===n)throw"Empty between selector: "+t;if((o=e8(t.substring(1,u))).length!==2)throw"Between selector must have two elements: "+t;if((t=t.slice(u+1).trim())[0]!==KZ)throw"Expected '>' after between selector: "+t;o=o.map(w4);const f=w4(t.slice(1).trim());return f.between?{between:o,stream:f}:(f.between=o,f)}(e):function(t){const n={source:Qj},o=[];let u,f,g=[0,0],x=0,k=0,F=t.length,V=0;if(t[F-1]===Yj){if(!((V=t.lastIndexOf(Kj))>=0))throw"Unmatched right brace: "+t;try{g=function(X){const te=X.split(Jj);if(!X.length||te.length>2)throw X;return te.map(ue=>{const he=+ue;if(he!=he)throw X;return he})}(t.substring(V+1,F-1))}catch{throw"Invalid throttle specification: "+t}t=t.slice(0,V).trim(),F=t.length,V=0}if(!F)throw t;if(t[0]===XZ&&(x=++V),(u=bE(t,V,$Z))<F&&(o.push(t.substring(k,u).trim()),k=V=++u),(V=bE(t,V,f3))===F)o.push(t.substring(k,F).trim());else if(o.push(t.substring(k,V).trim()),f=[],(k=++V)===F)throw"Unmatched left bracket: "+t;for(;V<F;){if((V=bE(t,V,d3))===F)throw"Unmatched left bracket: "+t;if(f.push(t.substring(k,V).trim()),V<F-1&&t[++V]!==f3)throw"Expected left bracket: "+t;k=++V}if(!(F=o.length)||YZ.test(o[F-1]))throw"Invalid event selector: "+t;return F>1?(n.type=o[1],x?n.markname=o[0].slice(1):function(X){return Zj[X]}(o[0])?n.marktype=o[0]:n.source=o[0]):n.type=o[0],n.type.slice(-1)==="!"&&(n.consume=!0,n.type=n.type.slice(0,-1)),f!=null&&(n.filter=f),g[0]&&(n.throttle=g[0]),g[1]&&(n.debounce=g[1]),n}(e)}var QZ="5.20.0";Object(Ce.p)(hn,E,U,B,D,R,j,W,H,I,Q,Y);const ZZ=QZ;var eee=r(245),Yw=function(e,t,n){return e.fields=t||[],e.fname=n,e},tee=function(e){return e.length===1?nee(e[0]):ree(e)};const nee=e=>function(t){return t[e]},ree=e=>{const t=e.length;return function(n){for(let o=0;o<t;++o)n=n[e[o]];return n}};var _4=function(e){throw Error(e)},Cx=function(e){var t,n,o,u=[],f=null,g=0,x=e.length,k="";function F(){u.push(k+e.substring(t,n)),k="",t=n+1}for(e+="",t=n=0;n<x;++n)if((o=e[n])==="\\")k+=e.substring(t,n),k+=e.substring(++n,++n),t=n;else if(o===f)F(),f=null,g=-1;else{if(f)continue;t===g&&o==='"'||t===g&&o==="'"?(t=n+1,f=o):o!=="."||g?o==="["?(n>t&&F(),g=t=n+1):o==="]"&&(g||_4("Access path missing open bracket: "+e),g>0&&F(),g=0,t=n+1):n>t?F():t=n+1}return g&&_4("Access path missing closing bracket: "+e),f&&_4("Access path missing closing quote: "+e),n>t&&(n++,F()),u},iee=function(e,t,n){const o=Cx(e);return e=o.length===1?o[0]:e,Yw((n&&n.get||tee)(o),[e],t||e)},xE=[],oee=(iee("id"),Yw(function(e){return e},xE,"identity"));Yw(function(){return 0},xE,"zero"),Yw(function(){return 1},xE,"one"),Yw(function(){return!0},xE,"true"),Yw(function(){return!1},xE,"false");function h3(e,t,n){var o=[t].concat([].slice.call(n));console[e].apply(console,o)}var ao=Array.isArray,_l=function(e){return e===Object(e)};const t8=e=>e!=="__proto__";function n8(...e){return e.reduce((t,n)=>{for(var o in n)if(o==="signals")t.signals=aee(t.signals,n.signals);else{var u=o==="legend"?{layout:1}:o==="style"||null;E4(t,o,n[o],u)}return t},{})}function E4(e,t,n,o){var u,f;if(t8(t))if(_l(n)&&!ao(n))for(u in f=_l(e[t])?e[t]:e[t]={},n)o&&(o===!0||o[u])?E4(f,u,n[u]):t8(u)&&(f[u]=n[u]);else e[t]=n}function aee(e,t){if(e==null)return t;const n={},o=[];function u(f){n[f.name]||(n[f.name]=1,o.push(f))}return t.forEach(u),e.forEach(u),o}var sc=function(e){return e!=null?ao(e)?e:[e]:[]},see=function(e){return typeof e=="function"};const uee=Object.prototype.hasOwnProperty;var kx=function(e,t){return uee.call(e,t)},wE=function(e){return typeof e=="boolean"},Cc=function(e){return typeof e=="number"},ta=function(e){return typeof e=="string"};function Oa(e){return ao(e)?"["+e.map(Oa)+"]":_l(e)||ta(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}var Ax=function(e){for(var t={},n=0,o=e.length;n<o;++n)t[e[n]]=!0;return t};function Qi(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function"){var u=0;for(o=Object.getOwnPropertySymbols(e);u<o.length;u++)t.indexOf(o[u])<0&&Object.prototype.propertyIsEnumerable.call(e,o[u])&&(n[o[u]]=e[o[u]])}return n}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,function(n,o){return Array.isArray(o)?n.push.apply(n,e.call(o,t-1)):n.push(o),n},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var cee=r(244),lee=r.n(cee),fee=r(243),dee=r.n(fee),hee=r(86),_E=r.n(hee);function S4(e){return!!e.or}function C4(e){return!!e.and}function k4(e){return!!e.not}const EE=dee.a,na=lee.a;function SE(e,t){const n={};for(const o of t)kx(e,o)&&(n[o]=e[o]);return n}function r1(e,t){const n=Object.assign({},e);for(const o of t)delete n[o];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>_E()(e)).join(",")})`};const yu=_E.a;function Ra(e){if(Cc(e))return e;const t=ta(e)?e:_E()(e);if(t.length<250)return t;let n=0;for(let o=0;o<t.length;o++)n=(n<<5)-n+t.charCodeAt(o),n&=n;return n}function r8(e){return e===!1||e===null}function fo(e,t){return e.indexOf(t)>-1}function CE(e,t){let n=0;for(const[o,u]of e.entries())if(t(u,o,n++))return!0;return!1}function i8(e,t){let n=0;for(const[o,u]of e.entries())if(!t(u,o,n++))return!1;return!0}function pee(e,t){for(const n of fi(t))E4(e,n,t[n],!0)}function ab(e,t){const n=[],o={};let u;for(const f of e)(u=t(f))in o||(o[u]=1,n.push(f));return n}function o8(e,t){for(const n of e)if(t.has(n))return!0;return!1}function a8(e){const t=new Set;for(const n of e){const o=Cx(n).map((f,g)=>g===0?f:`[${f}]`),u=o.map((f,g)=>o.slice(0,g+1).join(""));for(const f of u)t.add(f)}return t}function s8(e,t){return e===void 0||t===void 0||o8(a8(e),a8(t))}function Ts(e){return fi(e).length===0}const fi=Object.keys,sb=Object.values;function u8(e){const t=[];for(const n in e)kx(e,n)&&t.push({key:n,value:e[n]});return t}function p3(e){return e===!0||e===!1}function bu(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function kE(e,t){return k4(e)?"!("+kE(e.not,t)+")":C4(e)?"("+e.and.map(n=>kE(n,t)).join(") && (")+")":S4(e)?"("+e.or.map(n=>kE(n,t)).join(") || (")+")":t(e)}function A4(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&A4(e[n],t)&&delete e[n],Ts(e)}function m3(e){return e.charAt(0).toUpperCase()+e.substr(1)}function c8(e,t="datum"){const n=Cx(e),o=[];for(let u=1;u<=n.length;u++){const f=`[${n.slice(0,u).map(Oa).join("][")}]`;o.push(`${t}${f}`)}return o.join(" && ")}function mee(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function ub(e){return`${Cx(e).map(mee).join("\\.")}`}function Jw(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function l8(e){return`${Cx(e).join(".")}`}function AE(e){return e?Cx(e).length:0}function kc(...e){for(const t of e)if(t!==void 0)return t}let gee=42;function vee(e){const t=++gee;return e?String(e)+t:t}function g3(e){if(e!==void 0)return(e%360+360)%360}function O4(e){return!!Cc(e)||!isNaN(e)&&!isNaN(parseFloat(e))}const f8={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDash"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDash"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function T4(e){return e&&e.condition}const d8=["domain","grid","labels","ticks","title"],yee={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},h8={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},bee=Object.assign(Object.assign({},h8),{style:1,labelExpr:1,encoding:1});function p8(e){return!!bee[e]}const hh={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},m8=hh.arc,v3=hh.area,y3=hh.bar,xee=hh.image,b3=hh.line,x3=hh.point,wee=hh.rect,w3=hh.rule,g8=hh.text,M4=hh.tick,_ee=hh.trail,D4=hh.circle,N4=hh.square,v8=hh.geoshape;function Ox(e){return fo(["line","area","trail"],e)}function y8(e){return fo(["rect","bar","image","arc"],e)}const b8=fi(hh);function ry(e){return e.type}Ax(b8);const Eee=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],x8=fi({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),See={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},Cee={binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},kee={binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5};function i1(e){return"mark"in e}class _3{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return!!i1(t)&&function(n){return ry(n)?n.type:n}(t.mark)===this.name}}const Aee={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},Oee={count:1,min:1,max:1};function cb(e){return!!e&&!!e.argmin}function Tx(e){return!!e&&!!e.argmax}function I4(e){return ta(e)&&!!Aee[e]}const Tee=["count","valid","missing","distinct"];function w8(e){return ta(e)&&fo(Tee,e)}const Mee=["count","sum","distinct","valid","missing"],Dee=Ax(["mean","average","median","q1","q3","min","max"]),o1="row",a1="column",E3="facet",Tu="x",$c="y",j0="x2",iy="y2",oy="radius",s1="radius2",z0="theta",u1="theta2",ay="latitude",sy="longitude",U0="latitude2",Pg="longitude2",kp="color",uy="fill",cy="stroke",Ap="shape",c1="size",Mx="angle",l1="opacity",lb="fillOpacity",fb="strokeOpacity",db="strokeWidth",hb="strokeDash",OE="text",TE="order",ME="detail",S3="key",Dx="tooltip",C3="href",k3="url",A3="description",_8={theta:1,theta2:1,radius:1,radius2:1};function E8(e){return e in _8}const F4={longitude:1,longitude2:1,latitude:1,latitude2:1},Nee=fi(F4),S8=Object.assign(Object.assign(Object.assign(Object.assign({},{x:1,y:1,x2:1,y2:1}),_8),F4),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function Qw(e){return e===kp||e===uy||e===cy}const C8={row:1,column:1,facet:1},Lg=fi(C8),R4=Object.assign(Object.assign({},S8),C8),k8=fi(R4),Iee=Qi(R4,["order","detail","tooltip"]),Fee=Qi(Iee,["row","column","facet"]);function Ree(e){return!!Fee[e]}function A8(e){return!!R4[e]}const Pee=[j0,iy,U0,Pg,u1,s1];function O8(e){return Nx(e)!==e}function Nx(e){switch(e){case j0:return Tu;case iy:return $c;case U0:return ay;case Pg:return sy;case u1:return z0;case s1:return oy}return e}function pb(e){if(E8(e))switch(e){case z0:return"startAngle";case u1:return"endAngle";case oy:return"outerRadius";case s1:return"innerRadius"}return e}function ly(e){switch(e){case Tu:return j0;case $c:return iy;case ay:return U0;case sy:return Pg;case z0:return u1;case oy:return s1}}function fy(e){switch(e){case Tu:case j0:return"width";case $c:case iy:return"height"}}const P4=Qi(S8,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),Lee=fi(P4),mb={x:1,y:1},Bg=fi(mb);function dy(e){return e in mb}const L4={theta:1,radius:1},Bee=fi(L4);function O3(e){return e==="width"?Tu:$c}const T8=Qi(P4,["text","tooltip","href","url","description","detail","key","order"]),jee=fi(T8),M8=Object.assign(Object.assign(Object.assign({},mb),L4),T8),T3=fi(M8);function gb(e){return!!M8[e]}function zee(e,t){return function(n){switch(n){case kp:case uy:case cy:case A3:case ME:case S3:case Dx:case C3:case TE:case l1:case lb:case fb:case db:case E3:case o1:case a1:return D8;case Tu:case $c:case ay:case sy:return Uee;case j0:case iy:case U0:case Pg:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case c1:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case hb:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case Ap:return{point:"always",geoshape:"always"};case OE:return{text:"always"};case Mx:return{point:"always",square:"always",text:"always"};case k3:return{image:"always"};case z0:case oy:return{text:"always",arc:"always"};case u1:case s1:return{arc:"always"}}}(e)[t]}const D8={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},Uee=Qi(D8,["geoshape"]);function M3(e){switch(e){case Tu:case $c:case z0:case oy:case c1:case Mx:case db:case l1:case lb:case fb:case j0:case iy:case u1:case s1:return;case E3:case o1:case a1:case Ap:case hb:case OE:case Dx:case C3:case k3:case A3:return"discrete";case kp:case uy:case cy:return"flexible";case ay:case sy:case U0:case Pg:case ME:case S3:case TE:return}}function N8(e){return wE(e)&&(e=U3(e,void 0)),"bin"+fi(e).map(t=>D3(e[t])?bu(`_${t}_${Object.entries(e[t])}`):bu(`_${t}_${e[t]}`)).join("")}function Hs(e){return e===!0||DE(e)&&!e.binned}function ph(e){return e==="binned"||DE(e)&&e.binned===!0}function DE(e){return _l(e)}function D3(e){return e==null?void 0:e.selection}function I8(e){switch(e){case o1:case a1:case c1:case kp:case uy:case cy:case db:case l1:case lb:case fb:case Ap:return 6;case hb:return 4;default:return 10}}function Wee(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const Vee='Autosize "fit" only works for single views and layered views.';function Hee(e){return`${e=="width"?"Width":"Height"} "container" only works for single views and layered views.`}function Gee(e){return`${e=="width"?"Width":"Height"} "container" only works well with autosize "fit" or "fit-${e=="width"?"x":"y"}".`}function qee(e){return e?`Dropping "fit-${e}" because spec has discrete ${fy(e)}.`:'Dropping "fit" because spec has discrete size.'}function $ee(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function Xee(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function Kee(e){return`The "nearest" transform is not supported for ${e} marks.`}function Yee(e){return`Selection not supported for ${e} yet.`}function Jee(e){return`Cannot find a selection named "${e}".`}const Qee="Scale bindings are currently only supported for scales with unbinned, continuous domains.",Zee="Legend bindings are only supported for selections over an individual field or encoding channel.";function ete(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}function tte(e){return`Unknown repeated value "${e}".`}function nte(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const rte="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function ite(e){return`Unrecognized parse "${e}".`}function ote(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function ate(e){return`Ignoring an invalid transform: ${yu(e)}.`}const ste='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function ute(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function cte(e){return`Layer's shared ${e.join(",")} channel ${e.length===1?"is":"are"} overriden.`}function lte(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${yu(t)} is overridden by a child projection ${yu(n)}.`}const fte="Arc marks uses theta channel rather than angle, replacing angle with theta.";function dte(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${yu(n)}}.`}function hte(e){return`Invalid field type "${e}".`}function pte(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function mte(e){return`Invalid aggregation operator "${e}".`}function gte(e,t){return`Missing type for channel "${e}", using "${t}" instead.`}function vte(e,t){const{fill:n,stroke:o}=t;return`Dropping color ${e} as the plot also has ${n&&o?"fill and stroke":n?"fill":"stroke"}.`}function yte(e,t){return`Dropping ${yu(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}function bte(e,t,n){return`${e}-encoding with type ${t} is deprecated. Replacing with ${n}-encoding.`}const xte="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function wte(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function _te(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function Ete(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function Ste(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function Cte(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function kte(e,t){return`Line mark is for continuous lines and thus cannot be used with ${e&&t?"x2 and y2":e?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function Ate(e,t){return`Specified orient "${e}" overridden with "${t}".`}const Ote="Custom domain scale cannot be unioned with default field-based domain.",Tte=`Scale's "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.`;function Mte(e){return`Cannot use the scale property "${e}" with non-color channel.`}function Dte(e){return`Using unaggregated domain with raw field has no effect (${yu(e)}).`}function Nte(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function Ite(e){return`Unaggregated domain is currently unsupported for log scale (${yu(e)}).`}function Fte(e){return`Cannot apply size to non-oriented mark "${e}".`}function Rte(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function Pte(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function Lte(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function Bte(e,t){return`Scale type "${t}" does not work with mark "${e}".`}function jte(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function zte(e,t,n,o){return`Conflicting ${t.toString()} property "${e.toString()}" (${yu(n)} and ${yu(o)}). Using ${yu(n)}.`}function Ute(e,t,n,o){return`Conflicting ${t.toString()} property "${e.toString()}" (${yu(n)} and ${yu(o)}). Using the union of the two domains.`}function Wte(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function Vte(e){return`Dropping sort property ${yu(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const Hte="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",Gte="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",qte="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",$te="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.",Xte="Invalid channel for axis.";function Kte(e){return`Cannot stack "${e}" if there is already "${e}2".`}function Yte(e){return`Cannot stack non-linear scale (${e}).`}function Jte(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function Qte(e,t){return`Invalid ${e}: ${yu(t)}.`}function Zte(e){return`Dropping day from datetime ${yu(e)} as day cannot be combined with other units.`}function ene(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function tne(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function nne(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function rne(e,t){return`Center is not needed to be specified in ${t} when extent is ${e}.`}function ine(e){return`1D error band does not support ${e}.`}function one(e){return`Channel ${e} is required for "binned" bin.`}function ane(e){return`Domain for ${e} is required for threshold scale.`}const F8=function(e,t){var n=e||0;return{level:function(o){return arguments.length?(n=+o,this):n},error:function(){return n>=1&&h3(t||"error","ERROR",arguments),this},warn:function(){return n>=2&&h3(t||"warn","WARN",arguments),this},info:function(){return n>=3&&h3(t||"log","INFO",arguments),this},debug:function(){return n>=4&&h3(t||"log","DEBUG",arguments),this}}}(2);let N3=F8;function sne(){return N3=F8}function ci(...e){N3.warn(...e)}function Zw(e){if(e&&_l(e)){for(const t of j4)if(t in e)return!0}return!1}const R8=["january","february","march","april","may","june","july","august","september","october","november","december"],une=R8.map(e=>e.substr(0,3)),P8=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],cne=P8.map(e=>e.substr(0,3));function B4(e,t){const n=[];if(t&&e.day!==void 0&&fi(e).length>1&&(ci(ae.droppedDay(e)),delete(e=na(e)).day),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const o=t?function(u){if(O4(u)&&(u=+u),Cc(u))return u-1;{const f=u.toLowerCase(),g=R8.indexOf(f);if(g!==-1)return g;const x=f.substr(0,3),k=une.indexOf(x);if(k!==-1)return k;throw new Error(ae.invalidTimeUnit("month",u))}}(e.month):e.month;n.push(o)}else if(e.quarter!==void 0){const o=t?function(u){if(O4(u)&&(u=+u),Cc(u))return u>4&&ci(ae.invalidTimeUnit("quarter",u)),u-1;throw new Error(ae.invalidTimeUnit("quarter",u))}(e.quarter):e.quarter;n.push(Cc(o)?3*o:o+"*3")}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const o=t?function(u){if(O4(u)&&(u=+u),Cc(u))return u%7;{const f=u.toLowerCase(),g=P8.indexOf(f);if(g!==-1)return g;const x=f.substr(0,3),k=cne.indexOf(x);if(k!==-1)return k;throw new Error(ae.invalidTimeUnit("day",u))}}(e.day):e.day;n.push(Cc(o)?o+1:o+"+1")}else n.push(1);for(const o of["hours","minutes","seconds","milliseconds"]){const u=e[o];n.push(u===void 0?0:u)}return n}function NE(e){const t=B4(e,!0).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}const L8={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},j4=fi(L8);function z4(e){return e.startsWith("utc")}const lne={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function U4(e){const t=[];for(const n of j4)B8(e,n)&&t.push(n);return t}function B8(e,t){const n=e.indexOf(t);return!(n<0)&&!(n>0&&t==="seconds"&&e.charAt(n-1)==="i")&&!(e.length>n+3&&t==="day"&&e.charAt(n+3)==="o")&&!(n>0&&t==="year"&&e.charAt(n-1)==="f")}function fne(e,t,{end:n}={end:!1}){const o=c8(t),u=z4(e)?"utc":"";function f(k){return k==="quarter"?`(${u}quarter(${o})-1)`:`${u}${k}(${o})`}let g;const x={};for(const k of j4)B8(e,k)&&(x[k]=f(k),g=k);return n&&(x[g]+="+1"),function(k){const F=B4(k,!1).join(", ");return k.utc?`utc(${F})`:`datetime(${F})`}(x)}function j8(e){if(!e)return;const t=U4(e);return`timeUnitSpecifier(${_E()(t)}, ${_E()(lne)})`}function mh(e){if(!e)return;let t;return ta(e)?t={unit:e}:_l(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),z4(t.unit)&&(t.utc=!0,t.unit=function(n){return n.substr(3)}(t.unit)),t}function ko(e){return e&&!!e.signal}function vb(e){return!!e.step}function yb(e){return!ao(e)&&"field"in e&&"data"in e}const dne=fi({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1}),hne={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},W4=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function V4(e){return e&&!!e.field&&e.equal!==void 0}function z8(e){return e&&!!e.field&&e.lt!==void 0}function U8(e){return e&&!!e.field&&e.lte!==void 0}function W8(e){return e&&!!e.field&&e.gt!==void 0}function V8(e){return e&&!!e.field&&e.gte!==void 0}function H4(e){return!!(e&&e.field&&(ao(e.range)&&e.range.length===2||ko(e.range)))}function G4(e){return e&&!!e.field&&(ao(e.oneOf)||ao(e.in))}function H8(e){return G4(e)||V4(e)||H4(e)||z8(e)||W8(e)||U8(e)||V8(e)}function hy(e,t){return cN(e,{timeUnit:t,wrapTime:!0})}function G8(e,t=!0){var n;const{field:o}=e,u=(n=mh(e.timeUnit))===null||n===void 0?void 0:n.unit,f=u?"time("+fne(u,o)+")":mi(e,{expr:"datum"});if(V4(e))return f+"==="+hy(e.equal,u);if(z8(e))return`${f}<${hy(e.lt,u)}`;if(W8(e))return`${f}>${hy(e.gt,u)}`;if(U8(e))return`${f}<=${hy(e.lte,u)}`;if(V8(e))return`${f}>=${hy(e.gte,u)}`;if(G4(e))return`indexof([${function(g,x){return g.map(k=>hy(k,x))}(e.oneOf,u).join(",")}], ${f}) !== -1`;if(function(g){return g&&!!g.field&&g.valid!==void 0}(e))return q4(f,e.valid);if(H4(e)){const{range:g}=e,x=ko(g)?{signal:`${g.signal}[0]`}:g[0],k=ko(g)?{signal:`${g.signal}[1]`}:g[1];if(x!==null&&k!==null&&t)return"inrange("+f+", ["+hy(x,u)+", "+hy(k,u)+"])";const F=[];return x!==null&&F.push(`${f} >= ${hy(x,u)}`),k!==null&&F.push(`${f} <= ${hy(k,u)}`),F.length>0?F.join(" && "):"true"}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function q4(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function pne(e){var t;return H8(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:(t=mh(e.timeUnit))===null||t===void 0?void 0:t.unit}):e}const e2={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},Ix=e2.quantitative,$4=e2.ordinal,t2=e2.temporal,X4=e2.nominal,n2=e2.geojson,mne=fi(e2),Ac={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},K4={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},gne=fi(K4);function vne(e,t){const n=K4[e],o=K4[t];return n===o||n==="ordinal-position"&&o==="time"||o==="ordinal-position"&&n==="time"}const yne={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function q8(e){return yne[e]}const $8=["linear","log","pow","sqrt","symlog","time","utc"],bne=Ax($8),xne=Ax(["linear","log","pow","sqrt","symlog"]),wne=Ax(["quantile","quantize","threshold"]),_ne=Ax($8.concat(["quantile","quantize","threshold","sequential","identity"])),Ene=Ax(["ordinal","bin-ordinal","point","band"]);function Op(e){return e in Ene}function jg(e){return e in _ne}function W0(e){return e in bne}function I3(e){return e in wne}function X8(e){return e==null?void 0:e.selection}const Sne={type:1,domain:1,domainMid:1,align:1,range:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},Cne=Qi(Sne,["type","domain","range","scheme"]),kne=fi(Cne);(function(){var e;const t={};for(const n of k8)for(const o of mne)for(const u of gne){const f=Ane(n,o);Q8(n,u)&&J8(u,o)&&(t[f]=(e=t[f])!==null&&e!==void 0?e:[],t[f].push(u))}})();function K8(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!fo(["point","band","identity"],e);case"bins":return!fo(["point","band","identity","ordinal"],e);case"round":return W0(e)||e==="band"||e==="point";case"padding":return W0(e)||fo(["point","band"],e);case"paddingOuter":case"align":return fo(["point","band"],e);case"paddingInner":return e==="band";case"domainMid":case"clamp":return W0(e);case"nice":return W0(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return jg(e)&&!fo(["log","time","utc","threshold","quantile"],e)}}function Y8(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return Qw(e)?void 0:ae.cannotUseScalePropertyWithNonColor(e);case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"reverse":case"round":case"clamp":case"zero":return}}function J8(e,t){return fo([$4,X4],t)?e===void 0||Op(e):t===t2?fo([Ac.TIME,Ac.UTC,void 0],e):t!==Ix||fo([Ac.LOG,Ac.POW,Ac.SQRT,Ac.SYMLOG,Ac.QUANTILE,Ac.QUANTIZE,Ac.THRESHOLD,Ac.LINEAR,void 0],e)}function Q8(e,t){if(!gb(e))return!1;switch(e){case Tu:case $c:case z0:case oy:return W0(t)||fo(["band","point"],t);case c1:case db:case l1:case lb:case fb:case Mx:return W0(t)||I3(t)||fo(["band","point","ordinal"],t);case kp:case uy:case cy:return t!=="band";case hb:return t==="ordinal"||I3(t);case Ap:return t==="ordinal"}}function Ane(e,t){return e+"_"+t}function Y4(e){const{channel:t,channelDef:n,markDef:o,scale:u,config:f}=e,g=e9(e);return _i(n)&&!w8(n.aggregate)&&u&&W0(u.get("type"))&&u.get("zero")===!1?Z8({fieldDef:n,channel:t,markDef:o,ref:g,config:f}):g}function Z8({fieldDef:e,channel:t,markDef:n,ref:o,config:u}){return Ox(n.type)||ns("invalid",n,u)===null?o:[function(f,g){const x=J4(f,!0),k=Nx(g)==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:x},k)}(e,t),o]}function J4(e,t=!0){return q4(ta(e)?e:mi(e,{expr:"datum"}),!t)}function Fx(e,t,n,o){const u={};if(t&&(u.scale=t),xb(e)){const{datum:f}=e;Zw(f)?u.signal=NE(f):ko(f)?u.signal=f.signal:u.value=f}else u.field=mi(e,n);if(o){const{offset:f,band:g}=o;f&&(u.offset=f),g&&(u.band=g)}return u}function F3({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:o,startSuffix:u,band:f=.5}){const g=0<f&&f<1?"datum":void 0,x=mi(t,{expr:g,suffix:u}),k=n!==void 0?mi(n,{expr:g}):mi(t,{suffix:"end",expr:g}),F={};if(f===0||f===1){F.scale=e;const V=f===0?x:k;F.field=V}else{const V=`${f} * ${x} + ${1-f} * ${k}`;F.signal=`scale("${e}", ${V})`}return o&&(F.offset=o),F}function e9({channel:e,channelDef:t,channel2Def:n,markDef:o,config:u,scaleName:f,scale:g,stack:x,offset:k,defaultRef:F,band:V}){var X;if(t){if(Ro(t)){if(zm(t)){V=V??RE({channel:e,fieldDef:t,fieldDef2:n,markDef:o,stack:x,config:u,isMidPoint:!0});const{bin:ue,timeUnit:he,type:be}=t;if(Hs(ue)||V&&he&&be===t2)return x&&x.impute?Fx(t,f,{binSuffix:"mid"},{offset:k}):V?F3({scaleName:f,fieldOrDatumDef:t,band:V,offset:k}):Fx(t,f,PE(t,e)?{binSuffix:"range"}:{},{offset:k});if(ph(ue)){if(_i(n))return F3({scaleName:f,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:V,offset:k});{const Pe=e===Tu?j0:iy;ci(ae.channelRequiredForBinned(Pe))}}}const te=g==null?void 0:g.get("type");return Fx(t,f,Op(te)?{binSuffix:"range"}:{},{offset:k,band:te==="band"?(X=V??t.band)!==null&&X!==void 0?X:.5:void 0})}if(f1(t)){const te=t.value,ue=k?{offset:k}:{};return Object.assign(Object.assign({},IE(e,te)),ue)}}return see(F)&&(F=F()),F&&Object.assign(Object.assign({},F),k?{offset:k}:{})}function IE(e,t){return fo(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:fo(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:uc(t)}function Rx(e){return e&&e!=="number"&&e!=="time"}function t9(e,t,n){return`${e}(${t}${n?`, ${JSON.stringify(n)}`:""})`}const One="  ";function Q4({fieldOrDatumDef:e,format:t,formatType:n,expr:o,normalizeStack:u,config:f}){var g,x;if(Rx(n))return Z4({fieldOrDatumDef:e,format:t,formatType:n,expr:o,config:f});const k=n9(e,o,u);if(W3(e)){const F=function(V,X,te,ue,he){return!X||te?(te=ta(te)?te:ue,`${he?"utc":"time"}Format(${V}, '${te}')`):function(be,Pe,Ue){if(!be)return;const We=j8(be);return`${Ue||z4(be)?"utc":"time"}Format(${Pe}, ${We})`}(X,V,he)}(k,_i(e)?(g=mh(e.timeUnit))===null||g===void 0?void 0:g.unit:void 0,t,f.timeFormat,oN(e)&&((x=e.scale)===null||x===void 0?void 0:x.type)===Ac.UTC);return F?{signal:F}:void 0}return t=o9(bb(e),t,f),_i(e)&&Hs(e.bin)?{signal:R3(k,mi(e,{expr:o,binSuffix:"end"}),t,n,f)}:t||bb(e)==="quantitative"?{signal:`${a9(k,t)}`}:{signal:`isValid(${k}) ? ${k} : ""+${k}`}}function n9(e,t,n){return _i(e)?n?`${mi(e,{expr:t,suffix:"end"})}-${mi(e,{expr:t,suffix:"start"})}`:mi(e,{expr:t}):function(o){const{datum:u}=o;return Zw(u)?NE(u):`${JSON.stringify(u)}`}(e)}function Z4({fieldOrDatumDef:e,format:t,formatType:n,expr:o,normalizeStack:u,config:f,field:g}){return g=g??n9(e,o,u),_i(e)&&Hs(e.bin)?{signal:R3(g,mi(e,{expr:o,binSuffix:"end"}),t,n,f)}:{signal:t9(n,g,t)}}function r9(e,t,n,o,u,f){var g;if(!Rx(o))return W3(e)?function(x,k,F,V){return x||(k?{signal:j8(k)}:V?void 0:F.timeFormat)}(n,_i(e)?(g=mh(e.timeUnit))===null||g===void 0?void 0:g.unit:void 0,u,f):o9(t,n,u)}function i9(e,t,n){return e&&(ko(e)||e==="number"||e==="time")?e:W3(t)&&n!=="time"&&n!=="utc"?"time":void 0}function o9(e,t,n){return ta(t)?t:e===Ix?n.numberFormat:void 0}function a9(e,t){return`format(${e}, "${t||""}")`}function s9(e,t,n,o){var u;return Rx(n)?t9(n,e,t):a9(e,(u=ta(t)?t:void 0)!==null&&u!==void 0?u:o.numberFormat)}function R3(e,t,n,o,u){const f=s9(e,n,o,u),g=s9(t,n,o,u);return`${q4(e,!1)} ? "null" : ${f} + "${One}" + ${g}`}const P3="min",Tne={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function u9(e){return e in Tne}function c9(e){return!!e&&!!e.encoding}function py(e){return!(!e||e.op!=="count"&&!e.field)}function l9(e){return!!e&&ao(e)}function FE(e){return"row"in e||"column"in e}function eN(e){return!!e&&"header"in e}function L3(e){return"facet"in e}function f9(e){const{field:t,timeUnit:n,bin:o,aggregate:u}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),o?{bin:o}:{}),u?{aggregate:u}:{}),{field:t})}function d9(e){return zm(e)&&"sort"in e}function RE({channel:e,fieldDef:t,fieldDef2:n,markDef:o,stack:u,config:f,isMidPoint:g}){if(Ro(t)&&t.band!==void 0)return t.band;if(_i(t)){const{timeUnit:x,bin:k}=t;if(x&&!n)return g?Bx("timeUnitBandPosition",o,f):y8(o.type)?Bx("timeUnitBand",o,f):0;if(Hs(k))return y8(o.type)&&!g?1:.5}return(u==null?void 0:u.fieldChannel)===e&&g?.5:void 0}function tN(e,t,n,o,u,f){return!!(Hs(t.bin)||t.timeUnit&&zm(t)&&t.type==="temporal")&&!!RE({channel:e,fieldDef:t,fieldDef2:n,stack:o,markDef:u,config:f})}function nN(e){return!!e&&"condition"in e}function B3(e){const t=e&&e.condition;return!!t&&!ao(t)&&_i(t)}function rN(e){const t=e&&e.condition;return!!t&&!ao(t)&&Ro(t)}function _i(e){return!(!e||!e.field&&e.aggregate!=="count")}function bb(e){return e&&e.type}function xb(e){return!!e&&"datum"in e}function my(e){return zm(e)&&g9(e)||iN(e)}function iN(e){return xb(e)&&Cc(e.datum)}function Ro(e){return _i(e)||xb(e)}function zm(e){return!!e&&("field"in e&&"type"in e||e.aggregate==="count")}function f1(e){return e&&"value"in e&&"value"in e}function oN(e){return!!e&&("scale"in e||"sort"in e)}function aN(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function h9(e){return!!e&&"legend"in e}function p9(e){return!!e&&("format"in e||"formatType"in e)}function mi(e,t={}){var n,o,u;let f=e.field;const g=t.prefix;let x=t.suffix,k="";if(function(F){return F.aggregate==="count"}(e))f=function(F){return function(V){return V.indexOf("__")===0}(F)?F:`__${F}`}("count");else{let F;if(!t.nofn)if(function(V){return"op"in V}(e))F=e.op;else{const{bin:V,aggregate:X,timeUnit:te}=e;Hs(V)?(F=N8(V),x=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((o=t.suffix)!==null&&o!==void 0?o:"")):X?Tx(X)?(k=`["${f}"]`,f=`argmax_${X.argmax}`):cb(X)?(k=`["${f}"]`,f=`argmin_${X.argmin}`):F=String(X):te&&(F=function(ue){const he=mh(ue),{utc:be}=he,Pe=Qi(he,["utc"]);return Pe.unit?(be?"utc":"")+fi(Pe).map(Ue=>bu(`${Ue==="unit"?"":`_${Ue}_`}${Pe[Ue]}`)).join(""):(be?"utc":"")+"timeunit"+fi(Pe).map(Ue=>bu(`_${Ue}_${Pe[Ue]}`)).join("")}(te),x=(!fo(["range","mid"],t.binSuffix)&&t.binSuffix||"")+((u=t.suffix)!==null&&u!==void 0?u:""))}F&&(f=f?`${F}_${f}`:F)}return x&&(f=`${f}_${x}`),g&&(f=`${g}_${f}`),t.forAs?l8(f):t.expr?function(F,V="datum"){return`${V}[${Oa(Cx(F).join("."))}]`}(f,t.expr)+k:ub(f)+k}function m9(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return _i(e)&&!!e.bin;case"temporal":return!1}throw new Error(ae.invalidFieldType(e.type))}function g9(e){return!m9(e)}const v9=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return function(n){const{aggregate:o,bin:u,timeUnit:f,field:g}=n;if(Tx(o))return`${g} for argmax(${o.argmax})`;if(cb(o))return`${g} for argmin(${o.argmin})`;const x=mh(f),k=o||(x==null?void 0:x.unit)||(x==null?void 0:x.maxbins)&&"timeunit"||Hs(u)&&"bin";return k?k.toUpperCase()+"("+g+")":g}(e);default:return function(n,o){var u;const{field:f,bin:g,timeUnit:x,aggregate:k}=n;if(k==="count")return o.countTitle;if(Hs(g))return`${f} (binned)`;if(x){const F=(u=mh(x))===null||u===void 0?void 0:u.unit;if(F)return`${f} (${U4(F).join("-")})`}else if(k)return Tx(k)?`${f} for max ${k.argmax}`:cb(k)?`${f} for min ${k.argmin}`:`${m3(k)} of ${f}`;return f}(e,t)}};let y9=v9;function b9(e){y9=e}function Px(e,t,{allowDisabling:n,includeDefault:o=!0}){var u,f;const g=((u=sN(e))!==null&&u!==void 0?u:{}).title;if(!_i(e))return g;const x=e,k=o?x9(x,t):void 0;return n?kc(g,x.title,k):(f=g??x.title)!==null&&f!==void 0?f:k}function sN(e){return aN(e)&&e.axis?e.axis:h9(e)&&e.legend?e.legend:eN(e)&&e.header?e.header:void 0}function x9(e,t){return y9(e,t)}function j3(e){var t;if(p9(e)){const{format:n,formatType:o}=e;return{format:n,formatType:o}}{const n=(t=sN(e))!==null&&t!==void 0?t:{},{format:o,formatType:u}=n;return{format:o,formatType:u}}}function gy(e){return _i(e)?e:B3(e)?e.condition:void 0}function Xc(e){return Ro(e)?e:rN(e)?e.condition:void 0}function uN(e,t,n){if(ta(e)||Cc(e)||wE(e)){const o=ta(e)?"string":Cc(e)?"number":"boolean";return ci(ae.primitiveChannelDef(t,o,e)),{value:e}}return Ro(e)?z3(e,t,n):rN(e)?Object.assign(Object.assign({},e),{condition:z3(e.condition,t,n)}):e}function z3(e,t,n){if(p9(e)){const{format:o,formatType:u}=e,f=Qi(e,["format","formatType"]);if(Rx(u)&&!n.customFormatTypes)return ci(ae.customFormatTypeNotAllowed(t)),z3(f,t,n)}else{const o=aN(e)?"axis":h9(e)?"legend":eN(e)?"header":null;if(o&&e[o]){const u=e[o],{format:f,formatType:g}=u,x=Qi(u,["format","formatType"]);if(Rx(g)&&!n.customFormatTypes)return ci(ae.customFormatTypeNotAllowed(t)),z3(Object.assign(Object.assign({},e),{[o]:x}),t,n)}}return _i(e)?w9(e,t):function(o){let u=o.type;if(u)return o;const{datum:f}=o;return u=Cc(f)?"quantitative":ta(f)?"nominal":Zw(f)?"temporal":void 0,Object.assign(Object.assign({},o),{type:u})}(e)}function w9(e,t){const{aggregate:n,timeUnit:o,bin:u,field:f}=e,g=Object.assign({},e);if(!n||I4(n)||Tx(n)||cb(n)||(ci(ae.invalidAggregate(n)),delete g.aggregate),o&&(g.timeUnit=mh(o)),f&&(g.field=`${f}`),Hs(u)&&(g.bin=U3(u,t)),ph(u)&&!dy(t)&&ci(`Channel ${t} should not be used with "binned" bin.`),zm(g)){const{type:x}=g,k=function(F){if(F)switch(F=F.toLowerCase()){case"q":case Ix:return"quantitative";case"t":case t2:return"temporal";case"o":case $4:return"ordinal";case"n":case X4:return"nominal";case n2:return"geojson"}}(x);x!==k&&(g.type=k),x!=="quantitative"&&w8(n)&&(ci(ae.invalidFieldTypeForCountAggregate(x,n)),g.type="quantitative")}else if(!O8(t)){const x=function(k,F){if(k.timeUnit)return"temporal";if(Hs(k.bin))return"quantitative";switch(M3(F)){case"continuous":return"quantitative";case"discrete":case"flexible":return"nominal";default:return"quantitative"}}(g,t);ci(ae.missingFieldType(t,x)),g.type=x}if(zm(g)){const{compatible:x,warning:k}=function(F,V){const X=F.type;if(X==="geojson"&&V!=="shape")return{compatible:!1,warning:`Channel ${V} should not be used with a geojson data.`};switch(V){case o1:case a1:case E3:return g9(F)?{compatible:!1,warning:ae.facetChannelShouldBeDiscrete(V)}:Lx;case Tu:case $c:case kp:case uy:case cy:case OE:case ME:case S3:case Dx:case C3:case k3:case Mx:case z0:case oy:case A3:return Lx;case sy:case Pg:case ay:case U0:return X!==Ix?{compatible:!1,warning:`Channel ${V} should be used with a quantitative field only, not ${F.type} field.`}:Lx;case l1:case lb:case fb:case db:case c1:case u1:case s1:case j0:case iy:return X!=="nominal"||F.sort?Lx:{compatible:!1,warning:`Channel ${V} should not be used with an unsorted discrete field.`};case hb:return fo(["ordinal","nominal"],F.type)?Lx:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case Ap:return fo(["ordinal","nominal","geojson"],F.type)?Lx:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case TE:return F.type!=="nominal"||"sort"in F?Lx:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}(g,t);x||ci(k)}if(d9(g)&&ta(g.sort)){const{sort:x}=g;if(u9(x))return Object.assign(Object.assign({},g),{sort:{encoding:x}});const k=x.substr(1);if(x.charAt(0)==="-"&&u9(k))return Object.assign(Object.assign({},g),{sort:{encoding:k,order:"descending"}})}if(eN(g)){const{header:x}=g,{orient:k}=x,F=Qi(x,["orient"]);if(k)return Object.assign(Object.assign({},g),{header:Object.assign(Object.assign({},F),{labelOrient:x.labelOrient||k,titleOrient:x.titleOrient||k})})}return g}function U3(e,t){return wE(e)?{maxbins:I8(t)}:e==="binned"?{binned:!0}:e.maxbins||e.step?e:Object.assign(Object.assign({},e),{maxbins:I8(t)})}const Lx={compatible:!0};function W3(e){const{formatType:t}=j3(e);return t==="time"||!t&&function(n){return n&&(n.type==="temporal"||_i(n)&&!!n.timeUnit)}(e)}function cN(e,{timeUnit:t,type:n,wrapTime:o,undefinedIfExprNotRequired:u}){var f;const g=t&&((f=mh(t))===null||f===void 0?void 0:f.unit);let x,k=g||n==="temporal";return ko(e)?x=e.signal:Zw(e)?(k=!0,x=NE(e)):(ta(e)||Cc(e))&&k&&(x=`datetime(${JSON.stringify(e)})`,function(F){return!!L8[F]}(g)&&(Cc(e)&&e<1e4||ta(e)&&isNaN(Date.parse(e)))&&(x=NE({[g]:e}))),x?o&&k?`time(${x})`:x:u?void 0:JSON.stringify(e)}function _9(e,t){const{type:n}=e;return t.map(o=>{const u=cN(o,{timeUnit:_i(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return u!==void 0?{signal:u}:o})}function PE(e,t){return Hs(e.bin)?gb(t)&&fo(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}function E9(e){const{anchor:t,frame:n,offset:o,orient:u,color:f,subtitleColor:g,subtitleFont:x,subtitleFontSize:k,subtitleFontStyle:F,subtitleFontWeight:V,subtitleLineHeight:X,subtitlePadding:te}=e,ue=Qi(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),he=Object.assign(Object.assign({},ue),f?{fill:f}:{}),be=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),o?{offset:o}:{}),u?{orient:u}:{}),Pe=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},g?{subtitleColor:g}:{}),x?{subtitleFont:x}:{}),k?{subtitleFontSize:k}:{}),F?{subtitleFontStyle:F}:{}),V?{subtitleFontWeight:V}:{}),X?{subtitleLineHeight:X}:{}),te?{subtitlePadding:te}:{});return{titleMarkConfig:he,subtitleMarkConfig:SE(he,["align","baseline","dx","dy","limit"]),nonMark:be,subtitle:Pe}}function wb(e){return ta(e)||ao(e)&&ta(e[0])}function uc(e){return ko(e)?e:e!==void 0?{value:e}:void 0}function S9(e){return ko(e)?e.signal:Oa(e.value)}function LE(e){return ko(e)?e.signal:e==null?null:Oa(e)}function C9(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function ns(e,t,n,o={}){const{vgChannel:u,ignoreVgConfig:f}=o;return u&&t[u]!==void 0?t[u]:t[e]!==void 0?t[e]:!f||u&&u!==e?Bx(e,t,n,o):void 0}function Bx(e,t,n,{vgChannel:o}={}){return kc(o?V3(e,t,n.style):void 0,V3(e,t,n.style),o?n[t.type][o]:void 0,n[t.type][e],o?n.mark[o]:n.mark[e])}function V3(e,t,n){return k9(e,C9(t),n)}function k9(e,t,n){let o;t=sc(t);for(const u of t){const f=n[u];f&&f[e]!==void 0&&(o=f[e])}return o}function A9(e,t){return sc(e).reduce((n,o)=>{var u;return n.field.push(mi(o,t)),n.order.push((u=o.sort)!==null&&u!==void 0?u:"ascending"),n},{field:[],order:[]})}function O9(e,t){const n=[...e];return t.forEach(o=>{for(const u of n)if(EE(u,o))return;n.push(o)}),n}function T9(e,t){return EE(e,t)||!t?e:e?[...sc(e),...sc(t)].join(", "):t}function M9(e,t){const n=e.value,o=t.value;if(n==null||o===null)return{explicit:e.explicit,value:null};if((wb(n)||ko(n))&&(wb(o)||ko(o)))return{explicit:e.explicit,value:T9(n,o)};if(wb(n)||ko(n))return{explicit:e.explicit,value:n};if(wb(o)||ko(o))return{explicit:e.explicit,value:o};if(!(wb(n)||ko(n)||wb(o)||ko(o)))return{explicit:e.explicit,value:O9(n,o)};throw new Error("It should never reach here")}function jx(e,t){const n=e&&e[t];return!!n&&(ao(n)?CE(n,o=>!!o.field):_i(n)||B3(n))}function lN(e){return CE(k8,t=>{if(jx(e,t)){const n=e[t];if(ao(n))return CE(n,o=>!!o.aggregate);{const o=gy(n);return o&&!!o.aggregate}}return!1})}function fN(e,t){const n=[],o=[],u=[],f=[],g={};return dN(e,(x,k)=>{if(_i(x)){const{field:F,aggregate:V,bin:X,timeUnit:te}=x,ue=Qi(x,["field","aggregate","bin","timeUnit"]);if(V||te||X){const he=sN(x),be=he&&he.title;let Pe=mi(x,{forAs:!0});const Ue=Object.assign(Object.assign(Object.assign({},be?[]:{title:Px(x,t,{allowDisabling:!0})}),ue),{field:Pe});if(V){let We;if(Tx(V)?(We="argmax",Pe=mi({op:"argmax",field:V.argmax},{forAs:!0}),Ue.field=`${Pe}.${F}`):cb(V)?(We="argmin",Pe=mi({op:"argmin",field:V.argmin},{forAs:!0}),Ue.field=`${Pe}.${F}`):V!=="boxplot"&&V!=="errorbar"&&V!=="errorband"&&(We=V),We){const at={op:We,as:Pe};F&&(at.field=F),f.push(at)}}else if(n.push(Pe),zm(x)&&Hs(X)){if(o.push({bin:X,field:F,as:Pe}),n.push(mi(x,{binSuffix:"end"})),PE(x,k)&&n.push(mi(x,{binSuffix:"range"})),dy(k)){const We={field:Pe+"_end"};g[k+"2"]=We}Ue.bin="binned",O8(k)||(Ue.type=Ix)}else if(te){u.push({timeUnit:te,field:F,as:Pe});const We=zm(x)&&x.type!==t2&&"time";We&&(k===OE||k===Dx?Ue.formatType=We:function(at){return!!P4[at]}(k)?Ue.legend=Object.assign({formatType:We},Ue.legend):dy(k)&&(Ue.axis=Object.assign({formatType:We},Ue.axis)))}g[k]=Ue}else n.push(F),g[k]=e[k]}else g[k]=e[k]}),{bins:o,timeUnits:u,aggregate:f,groupby:n,encoding:g}}function Mne(e,t,n){const o=t.type;return fi(e).reduce((u,f)=>{if(!A8(f))return ci(ae.invalidEncodingChannel(f)),u;const g=e[f];if(f!=="angle"||o!=="arc"||e.theta||(ci(ae.REPLACE_ANGLE_WITH_THETA),f=z0),!function(x,k,F){const V=zee(k,F);if(!V)return!1;if(V==="binned"){const X=x[k===j0?Tu:$c];return!!(_i(X)&&_i(x[k])&&ph(X.bin))}return!0}(e,f,o))return ci(ae.incompatibleChannel(f,o)),u;if(f===c1&&o==="line"){const x=gy(e[f]);if(x!=null&&x.aggregate)return ci(ae.LINE_WITH_VARYING_SIZE),u}if(f===kp&&(t.filled?"fill"in e:"stroke"in e))return ci(ae.droppingColor("encoding",{fill:"fill"in e,stroke:"stroke"in e})),u;if(f===ME||f===TE&&!ao(g)&&!f1(g)||f===Dx&&ao(g))g&&(u[f]=sc(g).reduce((x,k)=>(_i(k)?x.push(w9(k,f)):ci(ae.emptyFieldDef(k,f)),x),[]));else{if(f===Dx&&g===null)u[f]=null;else if(!(_i(g)||xb(g)||f1(g)||nN(g)||ko(g)))return ci(ae.emptyFieldDef(g,f)),u;u[f]=uN(g,f,n)}return u},{})}function dN(e,t,n){if(e)for(const o of fi(e)){const u=e[o];if(ao(u))for(const f of u)t.call(n,f,o);else t.call(n,u,o)}}function D9(e,t,n,o){return e?fi(e).reduce((u,f)=>{const g=e[f];return ao(g)?g.reduce((x,k)=>t.call(o,x,k,f),u):t.call(o,u,g,f)},n):n}function N9(e,t){return fi(t).reduce((n,o)=>{switch(o){case Tu:case $c:case C3:case A3:case k3:case j0:case iy:case z0:case u1:case oy:case s1:case ay:case sy:case U0:case Pg:case OE:case Ap:case Mx:case Dx:return n;case TE:if(e==="line"||e==="trail")return n;case ME:case S3:{const u=t[o];if(ao(u)||_i(u))for(const f of sc(u))f.aggregate||n.push(mi(f,{}));return n}case c1:if(e==="trail")return n;case kp:case uy:case cy:case l1:case lb:case fb:case hb:case db:{const u=gy(t[o]);return u&&!u.aggregate&&n.push(mi(u,{})),n}}},[])}function hN(e,t,n,o=!0){return"tooltip"in n?{tooltip:n.tooltip}:{tooltip:[...e.map(({fieldPrefix:u,titlePrefix:f})=>{const g=o?` of ${t.field}`:"";return{field:u+t.field,type:t.type,title:ko(f)?{signal:f+`"${escape(g)}"`}:f+g}}),...function(u){const f=[];for(const g of fi(u))if(jx(u,g)){const x=u[g],k=sc(x);for(const F of k)_i(F)?f.push(F):B3(F)&&f.push(F.condition)}return f}(n)]}}function I9(e){const{axis:t,title:n,field:o}=e;return t&&t.title!==void 0?void 0:kc(n,o)}function pN(e,t,n,o,u){const{scale:f,axis:g}=n;return({partName:x,mark:k,positionPrefix:F,endPositionPrefix:V,aria:X,extraEncoding:te={}})=>{const ue=I9(n);return F9(e,x,u,X,{mark:k,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:F+"_"+n.field,type:n.type},ue!==void 0?{title:ue}:{}),f!==void 0?{scale:f}:{}),g!==void 0?{axis:g}:{})},ta(V)?{[t+"2"]:{field:V+"_"+n.field}}:{}),o),te)})}}function F9(e,t,n,o,u){const{clip:f,color:g,opacity:x}=e,k=e.type;return e[t]||e[t]===void 0&&n[t]?[Object.assign(Object.assign({},u),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),f?{clip:f}:{}),g?{color:g}:{}),x?{opacity:x}:{}),ry(u.mark)?u.mark:{type:u.mark}),{style:`${k}-${t}`}),wE(e[t])?{}:e[t]),o===!1?{aria:o}:{})})]:[]}function R9(e,t,n){const{encoding:o}=e,u=t==="vertical"?"y":"x",f=o[u],g=o[u+"2"],x=o[u+"Error"],k=o[u+"Error2"];return{continuousAxisChannelDef:H3(f,n),continuousAxisChannelDef2:H3(g,n),continuousAxisChannelDefError:H3(x,n),continuousAxisChannelDefError2:H3(k,n),continuousAxis:u}}function H3(e,t){if(e&&e.aggregate){const{aggregate:n}=e,o=Qi(e,["aggregate"]);return n!==t&&ci(ae.errorBarContinuousAxisHasCustomizedAggregate(n,t)),o}return e}function P9(e,t){const{mark:n,encoding:o}=e,{x:u,y:f}=o;if(my(u)){if(my(f)){const g=_i(u)&&u.aggregate,x=_i(f)&&f.aggregate;if(g||x!==t){if(x||g!==t){if(g===t&&x===t)throw new Error("Both x and y cannot have aggregate");return ry(n)&&n.orient?n.orient:"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(my(f))return"vertical";throw new Error("Need a valid continuous axis for "+t+"s")}const G3="boxplot",Dne=new _3(G3,B9);function L9(e){return Cc(e)?"tukey":e}function B9(e,{config:t}){var n,o;const{mark:u,encoding:f,selection:g,projection:x}=e,k=Qi(e,["mark","encoding","selection","projection"]),F=ry(u)?u:{type:u};g&&ci(ae.selectionNotSupported("boxplot"));const V=(n=F.extent)!==null&&n!==void 0?n:t.boxplot.extent,X=ns("size",F,t),te=L9(V),{transform:ue,continuousAxisChannelDef:he,continuousAxis:be,groupby:Pe,aggregate:Ue,encodingWithoutContinuousAxis:We,ticksOrient:at,boxOrient:st,customTooltipWithoutAggregatedField:dt}=function(Br,di,Ti){const Di=P9(Br,G3),{continuousAxisChannelDef:Zi,continuousAxis:Ri}=R9(Br,Di,G3),Ni=Zi.field,Ui=L9(di),To=[...j9(Ni),{op:"median",field:Ni,as:"mid_box_"+Ni},{op:"min",field:Ni,as:(Ui==="min-max"?"lower_whisker_":"min_")+Ni},{op:"max",field:Ni,as:(Ui==="min-max"?"upper_whisker_":"max_")+Ni}],da=Ui==="min-max"||Ui==="tukey"?[]:[{calculate:`datum["upper_box_${Ni}"] - datum["lower_box_${Ni}"]`,as:"iqr_"+Ni},{calculate:`min(datum["upper_box_${Ni}"] + datum["iqr_${Ni}"] * ${di}, datum["max_${Ni}"])`,as:"upper_whisker_"+Ni},{calculate:`max(datum["lower_box_${Ni}"] - datum["iqr_${Ni}"] * ${di}, datum["min_${Ni}"])`,as:"lower_whisker_"+Ni}],eo=Br.encoding,Ta=Ri,Ma=(eo[Ta],Qi(eo,[typeof Ta=="symbol"?Ta:Ta+""])),{customTooltipWithoutAggregatedField:rs,filteredEncoding:Gs}=function(g2){const{tooltip:x1}=g2,v2=Qi(g2,["tooltip"]);if(!x1)return{filteredEncoding:g2};let Tb,vh;if(ao(x1)){for(const wI of x1)wI.aggregate?(Tb||(Tb=[]),Tb.push(wI)):(vh||(vh=[]),vh.push(wI));Tb&&(v2.tooltip=Tb)}else x1.aggregate?v2.tooltip=x1:vh=x1;return ao(vh)&&vh.length===1&&(vh=vh[0]),{customTooltipWithoutAggregatedField:vh,filteredEncoding:v2}}(Ma),{bins:qs,timeUnits:Ms,aggregate:cf,groupby:DA,encoding:xI}=fN(Gs,Ti);return{transform:[...qs,...Ms,{aggregate:[...cf,...To],groupby:DA},...da],groupby:DA,aggregate:cf,continuousAxisChannelDef:Zi,continuousAxis:Ri,encodingWithoutContinuousAxis:xI,ticksOrient:Di==="vertical"?"horizontal":"vertical",boxOrient:Di,customTooltipWithoutAggregatedField:rs}}(e,V,t),{color:ct,size:kt}=We,St=Qi(We,["color","size"]),yn=Br=>pN(F,be,he,Br,t.boxplot),Mn=yn(St),_n=yn(We),$n=yn(Object.assign(Object.assign({},St),kt?{size:kt}:{})),qn=hN([{fieldPrefix:te==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:te==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],he,We),er={type:"tick",color:"black",opacity:1,orient:at,invalid:null},rr=te==="min-max"?qn:hN([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],he,We),fr=[...Mn({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",aria:!1,extraEncoding:rr}),...Mn({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",aria:!1,extraEncoding:rr}),...Mn({partName:"ticks",mark:er,positionPrefix:"lower_whisker",aria:!1,extraEncoding:rr}),...Mn({partName:"ticks",mark:er,positionPrefix:"upper_whisker",aria:!1,extraEncoding:rr})],Dr=[...te!=="tukey"?fr:[],..._n({partName:"box",mark:Object.assign(Object.assign({type:"bar"},X?{size:X}:{}),{orient:st,invalid:null}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",aria:!1,extraEncoding:qn}),...$n({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},_l(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),X?{size:X}:{}),{orient:at,ariaRoleDescription:"box"}),positionPrefix:"mid_box",extraEncoding:qn})];let Zr;if(te!=="min-max"){const Br=`datum["lower_box_${he.field}"]`,di=`datum["upper_box_${he.field}"]`,Ti=`(${di} - ${Br})`,Di=`${Br} - ${V} * ${Ti}`,Zi=`${di} + ${V} * ${Ti}`,Ri=`datum["${he.field}"]`,Ni={joinaggregate:j9(he.field),groupby:Pe};let Ui;te==="tukey"&&(Ui={transform:[{filter:`(${Di} <= ${Ri}) && (${Ri} <= ${Zi})`},{aggregate:[{op:"min",field:he.field,as:"lower_whisker_"+he.field},{op:"max",field:he.field,as:"upper_whisker_"+he.field},{op:"min",field:"lower_box_"+he.field,as:"lower_box_"+he.field},{op:"max",field:"upper_box_"+he.field,as:"upper_box_"+he.field},...Ue],groupby:Pe}],layer:fr});const To=Qi(St,["tooltip"]),{scale:da,axis:eo}=he,Ta=I9(he),Ma=F9(F,"outliers",t.boxplot,!0,{transform:[{filter:`(${Ri} < ${Di}) || (${Ri} > ${Zi})`}],mark:"point",encoding:Object.assign(Object.assign({[be]:Object.assign(Object.assign(Object.assign({field:he.field,type:he.type},Ta!==void 0?{title:Ta}:{}),da!==void 0?{scale:da}:{}),eo!==void 0?{axis:eo}:{})},To),dt?{tooltip:dt}:{})})[0];Ma&&Ui?Zr={transform:[Ni],layer:[Ma,Ui]}:Ma?(Zr=Ma).transform.unshift(Ni):Ui&&(Zr=Ui).transform.unshift(Ni)}return Zr?Object.assign(Object.assign({},k),{layer:[Zr,{transform:ue,layer:Dr}]}):Object.assign(Object.assign({},k),{transform:((o=k.transform)!==null&&o!==void 0?o:[]).concat(ue),layer:Dr})}function j9(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}const mN="errorbar",Nne=new _3(mN,z9);function z9(e,{config:t}){const{transform:n,continuousAxisChannelDef:o,continuousAxis:u,encodingWithoutContinuousAxis:f,ticksOrient:g,markDef:x,outerSpec:k,tooltipEncoding:F}=U9(e,mN,t),V=pN(x,u,o,f,t.errorbar),X={type:"tick",orient:g},te=[...V({partName:"ticks",mark:X,positionPrefix:"lower",aria:!1,extraEncoding:F}),...V({partName:"ticks",mark:X,positionPrefix:"upper",aria:!1,extraEncoding:F}),...V({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar"},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:F})];return Object.assign(Object.assign(Object.assign({},k),{transform:n}),te.length>1?{layer:te}:Object.assign({},te[0]))}function Ine(e,t){const{encoding:n}=e;if(function(x){return(Ro(x.x)||Ro(x.y))&&!Ro(x.x2)&&!Ro(x.y2)&&!Ro(x.xError)&&!Ro(x.xError2)&&!Ro(x.yError)&&!Ro(x.yError2)}(n))return{orient:P9(e,t),inputType:"raw"};const o=function(x){return Ro(x.x2)||Ro(x.y2)}(n),u=function(x){return Ro(x.xError)||Ro(x.xError2)||Ro(x.yError)||Ro(x.yError2)}(n),f=n.x,g=n.y;if(o){if(u)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const x=n.x2,k=n.y2;if(Ro(x)&&Ro(k))throw new Error(`${t} cannot have both x2 and y2`);if(Ro(x)){if(my(f))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}if(Ro(k)){if(my(g))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}{const x=n.xError,k=n.xError2,F=n.yError,V=n.yError2;if(Ro(k)&&!Ro(x))throw new Error(`${t} cannot have xError2 without xError`);if(Ro(V)&&!Ro(F))throw new Error(`${t} cannot have yError2 without yError`);if(Ro(x)&&Ro(F))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(Ro(x)){if(my(f))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(Ro(F)){if(my(g))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function U9(e,t,n){var o;const{mark:u,encoding:f,selection:g,projection:x}=e,k=Qi(e,["mark","encoding","selection","projection"]),F=ry(u)?u:{type:u};g&&ci(ae.selectionNotSupported(t));const{orient:V,inputType:X}=Ine(e,t),{continuousAxisChannelDef:te,continuousAxisChannelDef2:ue,continuousAxisChannelDefError:he,continuousAxisChannelDefError2:be,continuousAxis:Pe}=R9(e,V,t),{errorBarSpecificAggregate:Ue,postAggregateCalculates:We,tooltipSummary:at,tooltipTitleWithFieldName:st}=function(Br,di,Ti,Di,Zi,Ri,Ni,Ui){let To=[],da=[];const eo=di.field;let Ta,Ma=!1;if(Ri==="raw"){const rs=Br.center?Br.center:Br.extent?Br.extent==="iqr"?"median":"mean":Ui.errorbar.center,Gs=Br.extent?Br.extent:rs==="mean"?"stderr":"iqr";if(rs==="median"!=(Gs==="iqr")&&ci(ae.errorBarCenterIsUsedWithWrongExtent(rs,Gs,Ni)),Gs==="stderr"||Gs==="stdev")To=[{op:Gs,field:eo,as:"extent_"+eo},{op:rs,field:eo,as:"center_"+eo}],da=[{calculate:`datum["center_${eo}"] + datum["extent_${eo}"]`,as:"upper_"+eo},{calculate:`datum["center_${eo}"] - datum["extent_${eo}"]`,as:"lower_"+eo}],Ta=[{fieldPrefix:"center_",titlePrefix:m3(rs)},{fieldPrefix:"upper_",titlePrefix:W9(rs,Gs,"+")},{fieldPrefix:"lower_",titlePrefix:W9(rs,Gs,"-")}],Ma=!0;else{let qs,Ms,cf;Br.center&&Br.extent&&ci(ae.errorBarCenterIsNotNeeded(Br.extent,Ni)),Gs==="ci"?(qs="mean",Ms="ci0",cf="ci1"):(qs="median",Ms="q1",cf="q3"),To=[{op:Ms,field:eo,as:"lower_"+eo},{op:cf,field:eo,as:"upper_"+eo},{op:qs,field:eo,as:"center_"+eo}],Ta=[{fieldPrefix:"upper_",titlePrefix:Px({field:eo,aggregate:cf,type:"quantitative"},Ui,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:Px({field:eo,aggregate:Ms,type:"quantitative"},Ui,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:Px({field:eo,aggregate:qs,type:"quantitative"},Ui,{allowDisabling:!1})}]}}else{(Br.center||Br.extent)&&ci(ae.errorBarCenterAndExtentAreNotNeeded(Br.center,Br.extent)),Ri==="aggregated-upper-lower"?(Ta=[],da=[{calculate:`datum["${Ti.field}"]`,as:"upper_"+eo},{calculate:`datum["${eo}"]`,as:"lower_"+eo}]):Ri==="aggregated-error"&&(Ta=[{fieldPrefix:"",titlePrefix:eo}],da=[{calculate:`datum["${eo}"] + datum["${Di.field}"]`,as:"upper_"+eo}],Zi?da.push({calculate:`datum["${eo}"] + datum["${Zi.field}"]`,as:"lower_"+eo}):da.push({calculate:`datum["${eo}"] - datum["${Di.field}"]`,as:"lower_"+eo}));for(const rs of da)Ta.push({fieldPrefix:rs.as.substring(0,6),titlePrefix:Jw(Jw(rs.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:da,errorBarSpecificAggregate:To,tooltipSummary:Ta,tooltipTitleWithFieldName:Ma}}(F,te,ue,he,be,X,t,n),dt=f,ct=Pe,kt=(dt[ct],Pe==="x"?"x2":"y2"),St=(dt[kt],Pe==="x"?"xError":"yError"),yn=(dt[St],Pe==="x"?"xError2":"yError2"),Mn=(dt[yn],Qi(dt,[typeof ct=="symbol"?ct:ct+"",typeof kt=="symbol"?kt:kt+"",typeof St=="symbol"?St:St+"",typeof yn=="symbol"?yn:yn+""])),{bins:_n,timeUnits:$n,aggregate:qn,groupby:er,encoding:rr}=fN(Mn,n),fr=[...qn,...Ue],Dr=X!=="raw"?[]:er,Zr=hN(at,te,rr,st);return{transform:[...(o=k.transform)!==null&&o!==void 0?o:[],..._n,...$n,...fr.length===0?[]:[{aggregate:fr,groupby:Dr}],...We],groupby:Dr,continuousAxisChannelDef:te,continuousAxis:Pe,encodingWithoutContinuousAxis:rr,ticksOrient:V==="vertical"?"horizontal":"vertical",markDef:F,outerSpec:k,tooltipEncoding:Zr}}function W9(e,t,n){return m3(e)+" "+n+" "+t}const gN="errorband",Fne=new _3(gN,V9);function V9(e,{config:t}){const{transform:n,continuousAxisChannelDef:o,continuousAxis:u,encodingWithoutContinuousAxis:f,markDef:g,outerSpec:x,tooltipEncoding:k}=U9(e,gN,t),F=g,V=pN(F,u,o,f,t.errorband),X=e.encoding.x!==void 0&&e.encoding.y!==void 0;let te={type:X?"area":"rect"},ue={type:X?"line":"rule"};const he=Object.assign(Object.assign({},F.interpolate?{interpolate:F.interpolate}:{}),F.tension&&F.interpolate?{tension:F.tension}:{});return X?(te=Object.assign(Object.assign(Object.assign({},te),he),{ariaRoleDescription:"errorband"}),ue=Object.assign(Object.assign({},ue),he)):F.interpolate?ci(ae.errorBand1DNotSupport("interpolate")):F.tension&&ci(ae.errorBand1DNotSupport("tension")),Object.assign(Object.assign({},x),{transform:n,layer:[...V({partName:"band",mark:te,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:k}),...V({partName:"borders",mark:ue,positionPrefix:"lower",aria:!1,extraEncoding:k}),...V({partName:"borders",mark:ue,positionPrefix:"upper",aria:!1,extraEncoding:k})]})}const H9={};function vN(e,t,n){const o=new _3(e,t);H9[e]={normalizer:o,parts:n}}vN(G3,B9,["box","median","outliers","rule","ticks"]),vN(mN,z9,["ticks","rule"]),vN(gN,V9,["band","borders"]);const Rne=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],G9=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],Pne={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},Lne={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},r2="_vgsid_",Bne={single:{on:"click",fields:[r2],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[r2],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function yN(e){return!(!e||e!=="legend"&&!e.legend)}function bN(e){return yN(e)&&_l(e)}function xN(e){return"concat"in e}function q3(e){return"vconcat"in e}function wN(e){return"hconcat"in e}function vy(e){return _l(e)&&e.step!==void 0}function q9(e){return e.view||e.width||e.height}const jne=fi({align:1,bounds:1,center:1,columns:1,spacing:1});function _N(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function $3(e,t){const n=BE(e,t);return vy(n)?n.step:EN}function BE(e,t){var n;return kc((n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"],{step:e.step})}const EN=20,zne={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:EN},mark:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},arc:{},area:{},bar:Cee,circle:{},geoshape:{},image:{},line:{},point:{},rect:kee,rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:Bne,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},d1=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],$9={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},X9={blue:d1[0],orange:d1[1],red:d1[2],teal:d1[3],green:d1[4],yellow:d1[5],purple:d1[6],pink:d1[7],brown:d1[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function K9(e={}){const{color:t,font:n,fontSize:o}=e,u=Qi(e,["color","font","fontSize"]);return n8({},zne,n?function(f){return{text:{font:f},style:{"guide-label":{font:f},"guide-title":{font:f},"group-title":{font:f},"group-subtitle":{font:f}}}}(n):{},t?function(f={}){return{signals:[{name:"color",value:_l(f)?Object.assign(Object.assign({},X9),f):X9}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(t):{},o?function(f){return{signals:[{name:"fontSize",value:_l(f)?Object.assign(Object.assign({},$9),f):$9}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}(o):{},u||{})}const Une=["view",...b8],Wne=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],Vne=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]});function Hne(e){e=na(e);for(const t of Wne)delete e[t];if(e.axis)for(const t in e.axis)T4(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of Rne)delete e.legend[t];if(e.mark){for(const t of x8)delete e.mark[t];e.mark.tooltip&&_l(e.mark.tooltip)&&delete e.mark.tooltip}for(const t of Une){for(const o of x8)delete e[t][o];const n=Vne[t];if(n)for(const o of n)delete e[t][o];Gne(e,t)}for(const t of fi(H9))delete e[t];(function(t){const{titleMarkConfig:n,subtitleMarkConfig:o,subtitle:u}=E9(t.title);Ts(n)||(t.style["group-title"]=Object.assign(Object.assign({},t.style["group-title"]),n)),Ts(o)||(t.style["group-subtitle"]=Object.assign(Object.assign({},t.style["group-subtitle"]),o)),Ts(u)?delete t.title:t.title=u})(e);for(const t in e)_l(e[t])&&Ts(e[t])&&delete e[t];return Ts(e)?void 0:e}function Gne(e,t,n,o){const u=o?e[t][o]:e[t];t==="view"&&(n="cell");const f=Object.assign(Object.assign({},u),e.style[n??t]);Ts(f)||(e.style[n??t]=f),o||delete e[t]}function X3(e){return"layer"in e}class Y9{map(t,n){return L3(t)?this.mapFacet(t,n):function(o){return"repeat"in o}(t)?this.mapRepeat(t,n):wN(t)?this.mapHConcat(t,n):q3(t)?this.mapVConcat(t,n):xN(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(X3(t))return this.mapLayer(t,n);if(i1(t))return this.mapUnit(t,n);throw new Error(ae.invalidSpec(t))}mapLayer(t,n){return Object.assign(Object.assign({},t),{layer:t.layer.map(o=>this.mapLayerOrUnit(o,n))})}mapHConcat(t,n){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map(o=>this.map(o,n))})}mapVConcat(t,n){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map(o=>this.map(o,n))})}mapConcat(t,n){const{concat:o}=t,u=Qi(t,["concat"]);return Object.assign(Object.assign({},u),{concat:o.map(f=>this.map(f,n))})}mapFacet(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}mapRepeat(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}}const qne={zero:1,center:1,normalize:1},$ne=new Set([m8,y3,v3,w3,x3,D4,N4,b3,g8,M4]),Xne=new Set([y3,v3,m8]);function J9(e,t){var n,o;const u=t==="x"?"y":"radius",f=e[t],g=e[u];if(_i(f)&&_i(g))if(bb(f)==="quantitative"&&bb(g)==="quantitative"){if(f.stack)return t;if(g.stack)return u;const x=_i(f)&&!!f.aggregate;if(x!==(_i(g)&&!!g.aggregate))return x?t:u;{const k=(n=f.scale)===null||n===void 0?void 0:n.type,F=(o=g.scale)===null||o===void 0?void 0:o.type;if(k&&k!=="linear")return u;if(F&&F!=="linear")return t}}else{if(bb(f)==="quantitative")return t;if(bb(g)==="quantitative")return u}else{if(bb(f)==="quantitative")return t;if(bb(g)==="quantitative")return u}}function Q9(e,t,n={}){const o=ry(e)?e.type:e;if(!$ne.has(o))return null;const u=J9(t,"x")||J9(t,"theta");if(!u)return null;const f=t[u],g=_i(f)?mi(f,{}):void 0;let x=function(te){switch(te){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(u),k=t[x],F=_i(k)?mi(k,{}):void 0;F===g&&(F=void 0,k=void 0,x=void 0);const V=Lee.reduce((te,ue)=>{if(ue!=="tooltip"&&jx(t,ue)){const he=t[ue];for(const be of sc(he)){const Pe=gy(be);if(Pe.aggregate)continue;const Ue=mi(Pe,{});Ue&&Ue===F||te.push({channel:ue,fieldDef:Pe})}}return te},[]);let X;if(f.stack!==void 0?X=wE(f.stack)?f.stack?"zero":null:f.stack:V.length>0&&Xne.has(o)&&(X="zero"),!X||!function(te){return te in qne}(X)||lN(t)&&V.length===0)return null;if(f.scale&&f.scale.type&&f.scale.type!==Ac.LINEAR){if(n.disallowNonLinearStack)return null;ci(ae.cannotStackNonLinearScale(f.scale.type))}return Ro(t[ly(u)])?(f.stack!==void 0&&ci(ae.cannotStackRangedMark(u)),null):(_i(f)&&f.aggregate&&!fo(Mee,f.aggregate)&&ci(ae.stackNonSummativeAggregate(f.aggregate)),{groupbyChannel:k?x:void 0,groupbyField:F,fieldChannel:u,impute:f.impute!==null&&Ox(o),stackBy:V,offset:X})}function SN(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?_l(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?_l(t.point)?t.point:{}:void 0}function Z9(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class Kne{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(i1(t)){const{mark:o,encoding:u}=t,f=ry(o)?o:{type:o};switch(f.type){case"line":case"rule":case"trail":return!!SN(f,n[f.type],u);case"area":return!!SN(f,n[f.type],u)||!!Z9(f,n[f.type])}}return!1}run(t,n,o){const{config:u}=n,{selection:f,projection:g,encoding:x,mark:k}=t,F=Qi(t,["selection","projection","encoding","mark"]),V=ry(k)?k:{type:k},X=SN(V,u[V.type],x),te=V.type==="area"&&Z9(V,u[V.type]),ue=[Object.assign(Object.assign({},f?{selection:f}:{}),{mark:function(Pe){const Ue=Qi(Pe,["point","line"]);return fi(Ue).length>1?Ue:Ue.type}(Object.assign(Object.assign({},V.type==="area"&&V.opacity===void 0&&V.fillOpacity===void 0?{opacity:.7}:{}),V)),encoding:r1(x,["shape"])})],he=Q9(V,x);let be=x;if(he){const{fieldChannel:Pe,offset:Ue}=he;be=Object.assign(Object.assign({},x),{[Pe]:Object.assign(Object.assign({},x[Pe]),Ue?{stack:Ue}:{})})}return te&&ue.push(Object.assign(Object.assign({},g?{projection:g}:{}),{mark:Object.assign(Object.assign({type:"line"},SE(V,["clip","interpolate","tension","tooltip"])),te),encoding:be})),X&&ue.push(Object.assign(Object.assign({},g?{projection:g}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},SE(V,["clip","tooltip"])),X),encoding:be})),o(Object.assign(Object.assign({},F),{layer:ue}),Object.assign(Object.assign({},n),{config:function(Pe){for(const Ue of["line","area","rule","trail"])Pe[Ue]&&(Pe=Object.assign(Object.assign({},Pe),{[Ue]:r1(Pe[Ue],["point","line"])}));return Pe}(u)}))}}class Yne{constructor(){this.name="RangeStep"}hasMatchingType(t){var n;if(i1(t)&&t.encoding)for(const o of Bg){const u=t.encoding[o];if(u&&Ro(u)&&(!((n=u==null?void 0:u.scale)===null||n===void 0)&&n.rangeStep))return!0}return!1}run(t){var n;const o={};let u=Object.assign({},t.encoding);for(const f of Bg){const g=fy(f),x=u[f];if(x&&Ro(x)&&(!((n=x==null?void 0:x.scale)===null||n===void 0)&&n.rangeStep)){const{scale:k}=x,F=Qi(x,["scale"]),V=k,X=Qi(V,["rangeStep"]);o[g]={step:k.rangeStep},ci(ae.RANGE_STEP_DEPRECATED),u=Object.assign(Object.assign({},u),{[f]:Object.assign(Object.assign({},F),Ts(X)?{}:{scale:X})})}}return Object.assign(Object.assign(Object.assign({},o),t),{encoding:u})}}function CN(e,t){return t?rz(e,t):e}function kN(e,t,n){const o=t[e];return function(u){return u&&!ta(u)&&"repeat"in u}(o)?o.repeat in n?Object.assign(Object.assign({},t),{[e]:n[o.repeat]}):void ci(ae.noSuchRepeatedValue(o.repeat)):t}function ez(e,t){if((e=kN("field",e,t))!==void 0){if(e===null)return null;if(d9(e)&&py(e.sort)){const n=kN("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function tz(e,t){if(_i(e))return ez(e,t);{const n=kN("datum",e,t);return n===e||n.type||(n.type="nominal"),n}}function nz(e,t){if(!Ro(e)){if(rN(e)){const n=tz(e.condition,t);return n?Object.assign(Object.assign({},e),{condition:n}):Qi(e,["condition"])}return e}{const n=tz(e,t);if(n)return n;if(nN(e))return{condition:e.condition}}}function rz(e,t){const n={};for(const o in e)if(kx(e,o)){const u=e[o];if(ao(u))n[o]=u.map(f=>nz(f,t)).filter(f=>f);else{const f=nz(u,t);f!==void 0&&(n[o]=f)}}return n}class Jne{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(i1(t)){const{encoding:n,mark:o}=t;if(o==="line")for(const u of Pee){const f=n[Nx(u)];if(n[u]&&(_i(f)&&!ph(f.bin)||xb(f)))return!0}}return!1}run(t,n,o){const{encoding:u}=t;return ci(ae.lineWithRange(!!u.x2,!!u.y2)),o(Object.assign(Object.assign({},t),{mark:"rule"}),n)}}function iz(e){const{parentEncoding:t,encoding:n}=e;if(t&&n){const u=fi(t).reduce((f,g)=>(n[g]&&f.push(g),f),[]);u.length>0&&ci(ae.encodingOverridden(u))}const o=Object.assign(Object.assign({},t??{}),n??{});return Ts(o)?void 0:o}function oz(e){const{parentProjection:t,projection:n}=e;return t&&n&&ci(ae.projectionOverridden({parentProjection:t,projection:n})),n??t}function az(e,t){t===void 0&&(t=K9(e.config));const n=function(g,x={}){return Qne.map(g,{config:x})}(e,t),{width:o,height:u}=e,f=function(g,x,k){let{width:F,height:V}=x;const X=i1(g)||X3(g),te={};X?F=="container"&&V=="container"?(te.type="fit",te.contains="padding"):F=="container"?(te.type="fit-x",te.contains="padding"):V=="container"&&(te.type="fit-y",te.contains="padding"):(F=="container"&&(ci(ae.containerSizeNonSingle("width")),F=void 0),V=="container"&&(ci(ae.containerSizeNonSingle("height")),V=void 0));const ue=Object.assign(Object.assign(Object.assign({type:"pad"},te),k?sz(k.autosize):{}),sz(g.autosize));if(ue.type!=="fit"||X||(ci(ae.FIT_NON_SINGLE),ue.type="pad"),F=="container"&&ue.type!="fit"&&ue.type!="fit-x"&&ci(ae.containerSizeNotCompatibleWithAutosize("width")),V=="container"&&ue.type!="fit"&&ue.type!="fit-y"&&ci(ae.containerSizeNotCompatibleWithAutosize("height")),!EE(ue,{type:"pad"}))return ue}(n,{width:o,height:u,autosize:e.autosize},t);return Object.assign(Object.assign({},n),f?{autosize:f}:{})}const Qne=new class extends Y9{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[Dne,Nne,Fne,new Kne,new Jne,new Yne]}map(e,t){if(i1(e)){const n=jx(e.encoding,o1),o=jx(e.encoding,a1),u=jx(e.encoding,E3);if(n||o||u)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:o}=t,u=Object.assign(Object.assign({},e),{encoding:CN(e.encoding,t.repeater)});if(n||o)return this.mapUnitWithParentEncodingOrProjection(u,t);const f=this.mapLayerOrUnit.bind(this);for(const g of this.nonFacetUnitNormalizers)if(g.hasMatchingType(u,t.config))return g.run(u,t,f);return u}mapRepeat(e,t){return function(n){return!ao(n.repeat)&&n.repeat.layer}(e)?this.mapLayerRepeat(e,t):this.mapNonLayerRepeat(e,t)}mapLayerRepeat(e,t){const{repeat:n,spec:o}=e,u=Qi(e,["repeat","spec"]),{row:f,column:g,layer:x}=n,{repeater:k={},repeaterPrefix:F=""}=t;return f||g?this.mapRepeat(Object.assign(Object.assign({},e),{repeat:Object.assign(Object.assign({},f?{row:f}:{}),g?{column:g}:{}),spec:{repeat:{layer:x},spec:o}}),t):Object.assign(Object.assign({},u),{layer:x.map(V=>{const X=Object.assign(Object.assign({},k),{layer:V}),te=(o.name||"")+F+`child__layer_${bu(V)}`,ue=this.mapLayerOrUnit(o,Object.assign(Object.assign({},t),{repeater:X,repeaterPrefix:te}));return ue.name=te,ue})})}mapNonLayerRepeat(e,t){var n;const{repeat:o,spec:u,data:f}=e,g=Qi(e,["repeat","spec","data"]);!ao(o)&&e.columns&&(e=r1(e,["columns"]),ci(ae.columnsNotSupportByRowCol("repeat")));const x=[],{repeater:k={},repeaterPrefix:F=""}=t,V=!ao(o)&&o.row||[k?k.row:null],X=!ao(o)&&o.column||[k?k.column:null],te=ao(o)&&o||[k?k.repeat:null];for(const he of te)for(const be of V)for(const Pe of X){const Ue={repeat:he,row:be,column:Pe,layer:k.layer},We=(u.name||"")+F+"child__"+(ao(o)?`${bu(he)}`:(o.row?`row_${bu(be)}`:"")+(o.column?`column_${bu(Pe)}`:"")),at=this.map(u,Object.assign(Object.assign({},t),{repeater:Ue,repeaterPrefix:We}));at.name=We,x.push(r1(at,["data"]))}const ue=ao(o)?e.columns:o.column?o.column.length:1;return Object.assign(Object.assign({data:(n=u.data)!==null&&n!==void 0?n:f,align:"all"},g),{columns:ue,concat:x})}mapFacet(e,t){const{facet:n}=e;return FE(n)&&e.columns&&(e=r1(e,["columns"]),ci(ae.columnsNotSupportByRowCol("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:o}=e,{parentEncoding:u,parentProjection:f,config:g}=t,x=oz({parentProjection:f,projection:o}),k=iz({parentEncoding:u,encoding:CN(n,t.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),x?{projection:x}:{}),k?{encoding:k}:{}),{config:g})}mapFacetedUnit(e,t){const n=e.encoding,{row:o,column:u,facet:f}=n,g=Qi(n,["row","column","facet"]),{mark:x,width:k,projection:F,height:V,view:X,selection:te,encoding:ue}=e,he=Qi(e,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:be,layout:Pe}=this.getFacetMappingAndLayout({row:o,column:u,facet:f},t),Ue=CN(g,t.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},he),Pe),{facet:be,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},k?{width:k}:{}),V?{height:V}:{}),X?{view:X}:{}),F?{projection:F}:{}),{mark:x,encoding:Ue}),te?{selection:te}:{})}),t)}getFacetMappingAndLayout(e,t){var n;const{row:o,column:u,facet:f}=e;if(o||u){f&&ci(ae.facetChannelDropped([...o?[o1]:[],...u?[a1]:[]]));const g={},x={};for(const k of[o1,a1]){const F=e[k];if(F){const V=Qi(F,["align","center","spacing","columns"]);g[k]=V;for(const X of["align","center","spacing"])F[X]!==void 0&&(x[X]=(n=x[X])!==null&&n!==void 0?n:{},x[X][k]=F[X])}}return{facetMapping:g,layout:x}}{const{align:g,center:x,spacing:k,columns:F}=f;return{facetMapping:function(V,X){return X?FE(V)?rz(V,X):ez(V,X):V}(Qi(f,["align","center","spacing","columns"]),t.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},g?{align:g}:{}),x?{center:x}:{}),k?{spacing:k}:{}),F?{columns:F}:{})}}}mapLayer(e,t){var{parentEncoding:n,parentProjection:o}=t,u=Qi(t,["parentEncoding","parentProjection"]);const{encoding:f,projection:g}=e,x=Qi(e,["encoding","projection"]),k=Object.assign(Object.assign({},u),{parentEncoding:iz({parentEncoding:n,encoding:f}),parentProjection:oz({parentProjection:o,projection:g})});return super.mapLayer(x,k)}};function sz(e){return ta(e)?{type:e}:e??{}}const Zne=["background","padding"];function uz(e){return Zne.reduce((t,n)=>(e&&e[n]!==void 0&&(t[n]=e[n]),t),{})}class h1{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new h1(na(this.explicit),na(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return kc(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,n){n.value!==void 0&&this.set(t,n.value,n.explicit)}set(t,n,o){return delete this[o?"implicit":"explicit"][t],this[o?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,n){n.explicit[t]!==void 0?this.set(t,n.explicit[t],!0):n.implicit[t]!==void 0&&this.set(t,n.implicit[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of fi(t.combine())){const o=t.getWithExplicit(n);this.setWithExplicit(n,o)}}}function zx(e){return{explicit:!0,value:e}}function V0(e){return{explicit:!1,value:e}}function cz(e){return(t,n,o,u)=>{const f=e(t.value,n.value);return f>0?t:f<0?n:K3(t,n,o,u)}}function K3(e,t,n,o){return e.explicit&&t.explicit&&ci(ae.mergeConflictingProperty(n,o,e.value,t.value)),e}function _b(e,t,n,o,u=K3){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:EE(e.value,t.value)?e:u(e,t,n,o)}class ere extends h1{constructor(t={},n={},o=!1){super(t,n),this.explicit=t,this.implicit=n,this.parseNothing=o}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function jE(e){return"url"in e}function Y3(e){return"values"in e}function lz(e){return"name"in e&&!jE(e)&&!Y3(e)&&!Ux(e)}function Ux(e){return e&&(fz(e)||dz(e)||AN(e))}function fz(e){return"sequence"in e}function dz(e){return"sphere"in e}function AN(e){return"graticule"in e}const ed="main",J3="raw";function hz(e){return"filter"in e}function tre(e){return"lookup"in e}function nre(e){return"pivot"in e}function rre(e){return"density"in e}function ire(e){return"quantile"in e}function ore(e){return"regression"in e}function are(e){return"loess"in e}function sre(e){return"sample"in e}function ure(e){return"window"in e}function cre(e){return"joinaggregate"in e}function lre(e){return"flatten"in e}function fre(e){return"calculate"in e}function dre(e){return"bin"in e}function hre(e){return"impute"in e}function pre(e){return"timeUnit"in e}function mre(e){return"aggregate"in e}function gre(e){return"stack"in e}function vre(e){return"fold"in e}function yre(e){return e.map(t=>hz(t)?{filter:function n(o,u){return k4(o)?{not:n(o.not,u)}:C4(o)?{and:o.and.map(f=>n(f,u))}:S4(o)?{or:o.or.map(f=>n(f,u))}:u(o)}(t.filter,pne)}:t)}function zE(e,t,n,o){const u=nN(t)&&t.condition,f=o(t);return u?{[n]:[...sc(u).map(g=>{const x=o(g),k=function(F){return F.selection}(g)?Jz(e,g.selection):cA(e,g.test);return Object.assign({test:k},x)}),...f!==void 0?[f]:[]]}:f!==void 0?{[n]:f}:{}}function ON(e,t="text"){const n=e.encoding[t];return zE(e,n,t,o=>Q3(o,e.config))}function Q3(e,t,n="datum"){if(e){if(f1(e))return uc(e.value);if(Ro(e)){const{format:o,formatType:u}=j3(e);return Q4({fieldOrDatumDef:e,format:o,formatType:u,expr:n,config:t})}}}function pz(e,t={}){const{encoding:n,markDef:o,config:u,stack:f}=e,g=n.tooltip;if(ao(g))return{tooltip:gz({tooltip:g},f,u,t)};{const x=t.reactiveGeom?"datum.datum":"datum";return zE(e,g,"tooltip",k=>{const F=Q3(k,u,x);if(F)return F;if(k===null)return;let V=ns("tooltip",o,u);return V===!0&&(V={content:"encoding"}),ta(V)?{value:V}:_l(V)?V.content==="encoding"?gz(n,f,u,t):{signal:x}:void 0})}}function mz(e,t,n,{reactiveGeom:o}={}){const u={},f=o?"datum.datum":"datum",g=[];function x(F,V){const X=Nx(V),te=zm(F)?F:Object.assign(Object.assign({},F),{type:e[X].type}),ue=sc(Px(te,n,{allowDisabling:!1})).join(", ");let he;if(dy(V)){const be=V==="x"?"x2":"y2",Pe=gy(e[be]);if(ph(te.bin)&&Pe){const Ue=mi(te,{expr:f}),We=mi(Pe,{expr:f}),{format:at,formatType:st}=j3(te);he=R3(Ue,We,at,st,n),u[be]=!0}else if(t&&t.fieldChannel===V&&t.offset==="normalize"){const{format:Ue,formatType:We}=j3(te);he=Q4({fieldOrDatumDef:te,format:Ue,formatType:We,expr:f,config:n,normalizeStack:!0}).signal}}he=he??Q3(te,n,f).signal,g.push({channel:V,key:ue,value:he})}dN(e,(F,V)=>{_i(F)?x(F,V):B3(F)&&x(F.condition,V)});const k={};for(const{channel:F,key:V,value:X}of g)u[F]||k[V]||(k[Oa(V)]=X);return k}function gz(e,t,n,{reactiveGeom:o}={}){const u=u8(mz(e,t,n,{reactiveGeom:o})).map(({key:f,value:g})=>`${f}: ${g}`);return u.length>0?{signal:`{${u.join(", ")}}`}:void 0}function bre(e){const{markDef:t,config:n}=e,o=ns("aria",t,n);return o===!1?{}:Object.assign(Object.assign(Object.assign({},o?{aria:o}:{}),function(u){const{mark:f,markDef:g,config:x}=u;if(x.aria===!1)return{};const k=ns("ariaRoleDescription",g,x);return k!=null?{ariaRoleDescription:{value:k}}:f in hne?{}:{ariaRoleDescription:{value:f}}}(e)),function(u){const{encoding:f,markDef:g,config:x,stack:k}=u,F=f.description;if(F)return zE(u,F,"description",te=>Q3(te,u.config));const V=ns("description",g,x);if(V!=null)return{description:uc(V)};if(x.aria===!1)return{};const X=mz(f,k,x);if(!Ts(X))return{description:{signal:u8(X).map(({key:te,value:ue})=>`${te} + ": " + (${ue})`).join(' + "; " + ')}}}(e))}function El(e,t,n={}){const{markDef:o,encoding:u,config:f}=t,{vgChannel:g}=n;let{defaultRef:x,defaultValue:k}=n;x===void 0&&(k=k??ns(e,o,f,{vgChannel:g,ignoreVgConfig:!0}))!==void 0&&(x=uc(k));const F=u[e];return zE(t,F,g??e,V=>e9({channel:e,channelDef:V,markDef:o,config:f,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:x}))}function vz(e,t={filled:void 0}){var n,o,u,f;const{markDef:g,encoding:x,config:k}=e,{type:F}=g,V=(n=t.filled)!==null&&n!==void 0?n:ns("filled",g,k),X=fo(["bar","point","circle","square","geoshape"],F)?"transparent":void 0,te=(u=(o=ns(V===!0?"color":void 0,g,k,{vgChannel:"fill"}))!==null&&o!==void 0?o:k.mark[V===!0&&"color"])!==null&&u!==void 0?u:X,ue=(f=ns(V===!1?"color":void 0,g,k,{vgChannel:"stroke"}))!==null&&f!==void 0?f:k.mark[V===!1&&"color"],he=V?"fill":"stroke",be=Object.assign(Object.assign({},te?{fill:uc(te)}:{}),ue?{stroke:uc(ue)}:{});return g.color&&(V?g.fill:g.stroke)&&ci(ae.droppingColor("property",{fill:"fill"in g,stroke:"stroke"in g})),Object.assign(Object.assign(Object.assign(Object.assign({},be),El("color",e,{vgChannel:he,defaultValue:V?te:ue})),El("fill",e,{defaultValue:x.fill?te:void 0})),El("stroke",e,{defaultValue:x.stroke?ue:void 0}))}function Z3(e,t){const n=t[function(o){switch(o){case Tu:return"xOffset";case $c:return"yOffset";case j0:return"x2Offset";case iy:return"y2Offset";case z0:return"thetaOffset";case oy:return"radiusOffset";case u1:return"theta2Offset";case s1:return"radius2Offset"}}(e)];if(n)return n}function td(e,t,{defaultPos:n,vgChannel:o,isMidPoint:u}){const{encoding:f,markDef:g,config:x,stack:k}=t,F=f[e],V=f[ly(e)],X=t.scaleName(e),te=t.getScaleComponent(e),ue=Z3(e,g),he=TN({model:t,defaultPos:n,channel:e,scaleName:X,scale:te}),be=!F&&dy(e)&&(f.latitude||f.longitude)?{field:t.getName(e)}:function(Pe){const{channel:Ue,channelDef:We,isMidPoint:at,scaleName:st,stack:dt,offset:ct,markDef:kt,config:St}=Pe;if(Ro(We)&&dt&&Ue===dt.fieldChannel){if(_i(We)){const yn=RE({channel:Ue,fieldDef:We,isMidPoint:at,markDef:kt,stack:dt,config:St});if(yn!==void 0)return F3({scaleName:st,fieldOrDatumDef:We,startSuffix:"start",band:yn,offset:ct})}return Fx(We,st,{suffix:"end"},{offset:ct})}return Y4(Pe)}({channel:e,channelDef:F,channel2Def:V,markDef:g,config:x,isMidPoint:u,scaleName:X,scale:te,stack:k,offset:ue,defaultRef:he});return be?{[o||e]:be}:void 0}function TN({model:e,defaultPos:t,channel:n,scaleName:o,scale:u}){const{markDef:f,config:g}=e;return()=>{const x=Nx(n),k=pb(n),F=ns(n,f,g,{vgChannel:k});if(F!==void 0)return IE(n,F);switch(t){case"zeroOrMin":case"zeroOrMax":if(o){const V=u.get("type");if(!fo([Ac.LOG,Ac.TIME,Ac.UTC],V)){if(u.domainDefinitelyIncludesZero())return{scale:o,value:0}}}if(t==="zeroOrMin")return x==="y"?{field:{group:"height"}}:{value:0};switch(x){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const V=e[fy(n)];return Object.assign(Object.assign({},V),{mult:.5})}}}}const xre={left:"x",center:"xc",right:"x2"},wre={top:"y",middle:"yc",bottom:"y2"};function yz(e,t,n,o="middle"){if(e==="radius"||e==="theta")return pb(e);const u=ns(e==="x"?"align":"baseline",t,n);return e==="x"?xre[u||(o==="top"?"left":"center")]:wre[u||o]}function eA(e,t,{defaultPos:n,defaultPos2:o,range:u}){return u?bz(e,t,{defaultPos:n,defaultPos2:o}):td(e,t,{defaultPos:n})}function bz(e,t,{defaultPos:n,defaultPos2:o}){const{markDef:u,config:f}=t,g=ly(e),x=fy(e),k=function(V,X,te){const{encoding:ue,mark:he,markDef:be,stack:Pe,config:Ue}=V,We=Nx(te),at=fy(te),st=pb(te),dt=ue[We],ct=V.scaleName(We),kt=V.getScaleComponent(We),St=Z3(te in ue||te in be?te:We,V.markDef);if(!dt&&(te==="x2"||te==="y2")&&(ue.latitude||ue.longitude))return{[st]:{field:V.getName(te)}};const yn=function({channel:Mn,channelDef:_n,channel2Def:$n,markDef:qn,config:er,scaleName:rr,scale:fr,stack:Dr,offset:Zr,defaultRef:Br}){return Ro(_n)&&Dr&&Mn.charAt(0)===Dr.fieldChannel.charAt(0)?Fx(_n,rr,{suffix:"start"},{offset:Zr}):Y4({channel:Mn,channelDef:$n,scaleName:rr,scale:fr,stack:Dr,markDef:qn,config:er,offset:Zr,defaultRef:Br})}({channel:te,channelDef:dt,channel2Def:ue[te],markDef:be,config:Ue,scaleName:ct,scale:kt,stack:Pe,offset:St,defaultRef:void 0});return yn!==void 0?{[st]:yn}:tA(te,be)||tA(te,{[te]:V3(te,be,Ue.style),[at]:V3(at,be,Ue.style)})||tA(te,Ue[he])||tA(te,Ue.mark)||{[st]:TN({model:V,defaultPos:X,channel:te,scaleName:ct,scale:kt})()}}(t,o,g),F=k[x]?yz(e,u,f):pb(e);return Object.assign(Object.assign({},td(e,t,{defaultPos:n,vgChannel:F})),k)}function tA(e,t){const n=fy(e),o=pb(e);return t[o]!==void 0?{[o]:IE(e,t[o])}:t[e]!==void 0?{[o]:IE(e,t[e])}:t[n]?{[n]:IE(e,t[n])}:void 0}function Eb(e,t,n){var o,u,f,g;const{config:x,encoding:k,markDef:F,stack:V}=e,X=ly(t),te=fy(t),ue=k[t],he=k[X],be=e.getScaleComponent(t),Pe=be?be.get("type"):void 0,Ue=e.scaleName(t),We=F.orient,at=(u=(o=k[te])!==null&&o!==void 0?o:k.size)!==null&&u!==void 0?u:ns("size",F,x,{vgChannel:te}),st=n==="bar"&&(t==="x"?We==="vertical":We==="horizontal");if(_i(ue)&&(Hs(ue.bin)||ph(ue.bin)||ue.timeUnit&&!he)&&!at&&!Op(Pe)){const dt=RE({channel:t,fieldDef:ue,stack:V,markDef:F,config:x}),ct=(f=e.component.axes[t])===null||f===void 0?void 0:f[0];return function({fieldDef:kt,fieldDef2:St,channel:yn,band:Mn,scaleName:_n,markDef:$n,spacing:qn=0,axisTranslate:er,reverse:rr,config:fr}){const Dr=ly(yn),Zr=pb(yn),Br=pb(Dr),di=Z3(yn,$n);if(Hs(kt.bin)||kt.timeUnit)return{[Br]:xz({channel:yn,fieldDef:kt,scaleName:_n,markDef:$n,band:(1-Mn)/2,offset:UE(Dr,qn,rr,er,di),config:fr}),[Zr]:xz({channel:yn,fieldDef:kt,scaleName:_n,markDef:$n,band:1-(1-Mn)/2,offset:UE(yn,qn,rr,er,di),config:fr})};if(ph(kt.bin)){const Ti=Fx(kt,_n,{},{offset:UE(Dr,qn,rr,er,di)});if(_i(St))return{[Br]:Ti,[Zr]:Fx(St,_n,{},{offset:UE(yn,qn,rr,er,di)})};if(DE(kt.bin)&&kt.bin.step)return{[Br]:Ti,[Zr]:{signal:`scale("${_n}", ${mi(kt,{expr:"datum"})} + ${kt.bin.step})`,offset:UE(yn,qn,rr,er,di)}}}return void ci(ae.channelRequiredForBinned(Dr))}({fieldDef:ue,fieldDef2:he,channel:t,markDef:F,scaleName:Ue,band:dt,axisTranslate:(g=ct==null?void 0:ct.get("translate"))!==null&&g!==void 0?g:.5,spacing:dy(t)?ns("binSpacing",F,x):void 0,reverse:be.get("reverse"),config:x})}return(Ro(ue)&&Op(Pe)||st)&&!he?function(dt,ct,kt,St){var yn;const{markDef:Mn,encoding:_n,config:$n,stack:qn}=St,er=Mn.orient,rr=St.scaleName(kt),fr=St.getScaleComponent(kt),Dr=fy(kt),Zr=ly(kt),Br=er==="horizontal"&&kt==="y"||er==="vertical"&&kt==="x",di=ns(Br?"size":Dr,Mn,$n,{vgChannel:Dr});let Ti;(_n.size||di!==void 0)&&(Br?Ti=El("size",St,{vgChannel:Dr,defaultValue:di}):ci(ae.cannotApplySizeToNonOrientedMark(Mn.type)));const Di=(yn=Ro(ct)?RE({channel:kt,fieldDef:ct,markDef:Mn,stack:qn,config:$n}):void 0)!==null&&yn!==void 0?yn:1;Ti=Ti||{[Dr]:function(To,da,eo,Ta,Ma,rs){if(Ta){const Ms=Ta.get("type");if(Ms==="point"||Ms==="band"){if(Ma[To].discreteBandSize!==void 0)return{value:Ma[To].discreteBandSize};if(Ms===Ac.POINT){const cf=Ta.get("range");return vb(cf)&&Cc(cf.step)?{value:cf.step-2}:{value:EN-2}}return{scale:eo,band:rs}}return{value:Ma[To].continuousBandSize}}const Gs=$3(Ma.view,da),qs=kc(Ma[To].discreteBandSize,Gs-2);return qs!==void 0?{value:qs}:void 0}(dt,Dr,rr,fr,$n,Di)};const Zi=(fr==null?void 0:fr.get("type"))!=="band"||!("band"in Ti[Dr]),Ri=yz(kt,Mn,$n,Zi?"middle":"top"),Ni=Z3(kt,Mn),Ui=Y4({channel:kt,channelDef:ct,markDef:Mn,config:$n,scaleName:rr,scale:fr,stack:qn,offset:Ni,defaultRef:TN({model:St,defaultPos:"mid",channel:kt,scaleName:rr,scale:fr}),band:Zi?.5:(1-Di)/2});if(Dr)return Object.assign({[Ri]:Ui},Ti);{const To=pb(Zr),da=Ti[Dr],eo=Ni?Object.assign(Object.assign({},da),{offset:Ni}):da;return{[Ri]:Ui,[To]:ao(Ui)?[Ui[0],Object.assign(Object.assign({},Ui[1]),{offset:eo})]:Object.assign(Object.assign({},Ui),{offset:eo})}}}(n,ue,t,e):bz(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function UE(e,t,n,o,u){if(E8(e))return 0;const f=e==="x"||e==="y2"?-t/2:t/2;if(ko(n)){const g=LE(u);return{signal:`${n.signal} ? ${o-f}${g?"-"+g:""} : ${o+f}${g?"+"+g:""}`}}if(ko(u)){const g=o+(n?-f:f);return{signal:`${g||""}${n?" - ":g?" + ":""}${u.signal}`}}return u=u||0,o+(n?-u-f:+u+f)}function xz({channel:e,fieldDef:t,scaleName:n,markDef:o,band:u,offset:f,config:g}){return Z8({fieldDef:t,channel:e,markDef:o,ref:F3({scaleName:n,fieldOrDatumDef:t,band:u,offset:f}),config:g})}const _re=new Set(["aria"]);function zg(e,t){const{fill:n,stroke:o}=t.color==="include"?vz(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},function(u,f){return dne.reduce((g,x)=>(_re.has(x)||u[x]===void 0||f[x]==="ignore"||(g[x]=uc(u[x])),g),{})}(e.markDef,t)),wz(e,"fill",n)),wz(e,"stroke",o)),El("opacity",e)),El("fillOpacity",e)),El("strokeOpacity",e)),El("strokeWidth",e)),El("strokeDash",e)),pz(e)),ON(e,"href")),bre(e))}function wz(e,t,n){const{config:o,mark:u,markDef:f}=e;if(ns("invalid",f,o)==="hide"&&n&&!Ox(u)){const g=function(x,{invalid:k=!1,channels:F}){const V=F.reduce((te,ue)=>{const he=x.getScaleComponent(ue);if(he){const be=he.get("type"),Pe=x.vgField(ue,{expr:"datum"});Pe&&jg(be)&&(te[Pe]=!0)}return te},{}),X=fi(V);if(X.length>0){const te=k?"||":"&&";return X.map(ue=>J4(ue,k)).join(` ${te} `)}}(e,{invalid:!0,channels:T3});if(g)return{[t]:[{test:g,value:null},...sc(n)]}}return n?{[t]:n}:{}}function MN(e){const{config:t,markDef:n}=e;if(ns("invalid",n,t)){const o=function(u,{invalid:f=!1,channels:g}){const x=g.reduce((F,V)=>{const X=u.getScaleComponent(V);if(X){const te=X.get("type"),ue=u.vgField(V,{expr:"datum"});ue&&jg(te)&&(F[ue]=!0)}return F},{}),k=fi(x);if(k.length>0){const F=f?"||":"&&";return k.map(V=>J4(V,f)).join(` ${F} `)}}(e,{channels:Bg});if(o)return{defined:{signal:o}}}return{}}function _z(e,t){if(t!==void 0)return{[e]:uc(t)}}var Ez={has:e=>e.type!=="interval"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName("voronoi")},marks:(e,t,n)=>{const{x:o,y:u}=t.project.hasChannel,f=e.mark;if(Ox(f))return ci(ae.nearestNotSupportForContinuous(f)),n;const g={name:e.getName("voronoi"),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},pz(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:o||!u?"datum.datum.x || 0":"0"},y:{expr:u||!o?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let x=0,k=!1;return n.forEach((F,V)=>{var X;const te=(X=F.name)!==null&&X!==void 0?X:"";te===e.component.mark[0].name?x=V:te.indexOf("voronoi")>=0&&(k=!0)}),k||n.splice(x+1,0,g),n}};class ys{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){this._children.indexOf(t)>-1?console.warn("Attempt to add the same child twice."):n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const o of this._children)o.parent=t;this._children=[],t.removeChild(this),t.parent.removeChild(t),this.parent=n,t.parent=this}}class gh extends ys{constructor(t,n,o,u){super(t,n),this.type=o,this.refCounts=u,this._source=this._name=n,!this.refCounts||this._name in this.refCounts||(this.refCounts[this._name]=0)}clone(){const t=new this.constructor;return t.debugName="clone_"+this.debugName,t._source=this._source,t._name="clone_"+this._name,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${vee()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}class yy extends ys{constructor(t,n){super(t),this.formula=n}clone(){return new yy(null,na(this.formula))}static makeFromEncoding(t,n){const o=n.reduceFieldDef((u,f,g)=>{const{field:x,timeUnit:k}=f,F=Wu(n)?n.encoding[ly(g)]:void 0,V=Wu(n)&&tN(g,f,F,n.stack,n.markDef,n.config);if(k){const X=mi(f,{forAs:!0});u[Ra({as:X,field:x,timeUnit:k})]=Object.assign({as:X,field:x,timeUnit:k},V?{band:!0}:{})}return u},{});return Ts(o)?null:new yy(t,o)}static makeFromTransform(t,n){const o=Object.assign({},n),{timeUnit:u}=o,f=Qi(o,["timeUnit"]),g=mh(u),x=Object.assign(Object.assign({},f),{timeUnit:g});return new yy(t,{[Ra(x)]:x})}merge(t){this.formula=Object.assign({},this.formula);for(const n in t.formula)this.formula[n]&&!t.formula[n].band||(this.formula[n]=t.formula[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}producedFields(){return new Set(sb(this.formula).map(t=>t.as))}dependentFields(){return new Set(sb(this.formula).map(t=>t.field))}hash(){return`TimeUnit ${Ra(this.formula)}`}assemble(){const t=[];for(const n of sb(this.formula)){const{field:o,as:u,timeUnit:f}=n,g=mh(f),{unit:x,utc:k}=g,F=Qi(g,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:ub(o),type:"timeunit"},x?{units:U4(x)}:{}),k?{timezone:"utc"}:{}),F),{as:[u,`${u}_end`]}))}return t}}const WE="_tuple_fields";var Sz={has:e=>e.type==="single"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!yN(e.bind),parse:(e,t,n,o)=>{o.on||delete t.events,o.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const o=t.name,u=t.project,f=t.bind,g=t.init&&t.init[0],x=Ez.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return u.items.forEach((k,F)=>{var V,X;const te=bu(`${o}_${k.field}`);n.filter(ue=>ue.name===te).length||n.unshift(Object.assign(Object.assign({name:te},g?{init:i2(g[F])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${x}[${Oa(k.field)}] : null`}]:[],bind:(X=(V=f[k.field])!==null&&V!==void 0?V:f[k.channel])!==null&&X!==void 0?X:f}))}),n},signals:(e,t,n)=>{const o=t.name,u=t.project,f=n.filter(F=>F.name===o+by)[0],g=o+WE,x=u.items.map(F=>bu(`${o}_${F.field}`)),k=x.map(F=>`${F} !== null`).join(" && ");return x.length&&(f.update=`${k} ? {fields: ${g}, values: [${x.join(", ")}]} : null`),delete f.value,delete f.on,n}},Cz={has:e=>e.type==="multi"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+"_toggle",value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+by,o=t.name+"_toggle";return`${o} ? null : ${n}, `+(t.resolve==="global"?`${o} ? null : true, `:`${o} ? null : {unit: ${p1(e)}}, `)+`${o} ? ${n} : null`}},Sb={has:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const o of t.project.items){const u=o.channel;if(!gb(u))continue;const f=e.getScaleComponent(u),g=f?f.get("type"):void 0;if(!f||!jg(g)){ci(ae.SCALE_BINDINGS_CONTINUOUS);continue}const x={selection:t.name,field:o.field};f.set("selectionExtent",x,!0),n.push(o)}},topLevelSignals:(e,t,n)=>{const o=t.scales.filter(g=>n.filter(x=>x.name===g.signals.data).length===0);if(!e.parent||NN(e)||o.length===0)return n;const u=n.filter(g=>g.name===t.name)[0];let f=u.update;if(f.indexOf(Pz)>=0)u.update=`{${o.map(g=>`${Oa(g.field)}: ${g.signals.data}`).join(", ")}}`;else{for(const g of o){const x=`${Oa(g.field)}: ${g.signals.data}`;f.indexOf(x)<0&&(f=`${f.substring(0,f.length-1)}, ${x}}`)}u.update=f}return n.concat(o.map(g=>({name:g.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!NN(e))for(const o of t.scales){const u=n.filter(f=>f.name===o.signals.data)[0];u.push="outer",delete u.value,delete u.update}return n}};function DN(e,t){return`domain(${Oa(e.scaleName(t))})`}function NN(e){var t;return e.parent&&h2(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:NN(e.parent.parent))}const kz={has:e=>{const t=e.resolve==="global"&&e.bind&&yN(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==r2;return t&&!n&&ci(ae.LEGEND_BINDINGS_PROJECT_LENGTH),t&&n},parse:(e,t,n,o)=>{var u;if(o.on||delete t.events,o.clear||delete t.clear,o.on||o.clear){const x='event.item && indexof(event.item.mark.role, "legend") < 0';for(const k of t.events)k.filter=sc((u=k.filter)!==null&&u!==void 0?u:[]),k.filter.indexOf(x)<0&&k.filter.push(x)}const f=bN(t.bind)?t.bind.legend:"click",g=ta(f)?Sx(f,"view"):sc(f);t.bind={legend:{merge:g}}},topLevelSignals:(e,t,n)=>{const o=t.name,u=bN(t.bind)&&t.bind.legend,f=g=>x=>{const k=na(x);return k.markname=g,k};for(const g of t.project.items){if(!g.hasLegend)continue;const x=`${bu(g.field)}_legend`,k=`${o}_${x}`;if(n.filter(F=>F.name===k).length===0){const F=u.merge.map(f(`${x}_symbols`)).concat(u.merge.map(f(`${x}_labels`))).concat(u.merge.map(f(`${x}_entries`)));n.unshift(Object.assign(Object.assign({name:k},t.init?{}:{value:null}),{on:[{events:F,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:u.merge,update:`!event.item || !datum ? null : ${k}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const o=t.name,u=t.project,f=n.find(X=>X.name===o+by),g=o+WE,x=u.items.filter(X=>X.hasLegend).map(X=>bu(`${o}_${bu(X.field)}_legend`)),k=`${x.map(X=>`${X} !== null`).join(" && ")} ? {fields: ${g}, values: [${x.join(", ")}]} : null`;t.events&&x.length>0?f.on.push({events:x.map(X=>({signal:X})),update:k}):x.length>0&&(f.update=k,delete f.value,delete f.on);const F=n.find(X=>X.name===o+"_toggle"),V=bN(t.bind)&&t.bind.legend;return F&&(t.events?F.on.push(Object.assign(Object.assign({},F.on[0]),{events:V})):F.on[0].events=V),n}},Az="_translate_anchor",Oz="_translate_delta";function Tz(e,t,n,o,u){var f;const g=t.name,x=g+Az,k=g+Oz,F=n.channel,V=Sb.has(t),X=u.filter(Ue=>Ue.name===n.signals[V?"data":"visual"])[0],te=e.getSizeSignalRef(o).signal,ue=e.getScaleComponent(F),he=ue.get("type"),be=`${x}.extent_${F}`,Pe=`${V?he==="log"?"panLog":he==="pow"?"panPow":"panLinear":"panLinear"}(${be}, ${`${V&&F===Tu?"-":""}${k}.${F} / `+(V?`${te}`:`span(${be})`)}`+(V&&he==="pow"?`, ${(f=ue.get("exponent"))!==null&&f!==void 0?f:1}`:"")+")";X.on.push({events:{signal:k},update:V?Pe:`clampRange(${Pe}, 0, ${te})`})}const Mz="_zoom_anchor",Dz="_zoom_delta";function Nz(e,t,n,o,u){var f;const g=t.name,x=n.channel,k=Sb.has(t),F=u.filter(Pe=>Pe.name===n.signals[k?"data":"visual"])[0],V=e.getSizeSignalRef(o).signal,X=e.getScaleComponent(x),te=X.get("type"),ue=k?DN(e,x):F.name,he=g+Dz,be=`${k?te==="log"?"zoomLog":te==="pow"?"zoomPow":"zoomLinear":"zoomLinear"}(${ue}, ${`${g}${Mz}.${x}`}, ${he}`+(k&&te==="pow"?`, ${(f=X.get("exponent"))!==null&&f!==void 0?f:1}`:"")+")";F.on.push({events:{signal:he},update:k?be:`clampRange(${be}, 0, ${V})`})}const Ere=[{has:()=>!0,parse:(e,t,n)=>{var o,u,f;const g=t.name,x=(o=t.project)!==null&&o!==void 0?o:t.project=new class{constructor(...te){this.items=te,this.hasChannel={},this.hasField={}}},k={},F={},V=new Set,X=(te,ue)=>{const he=ue==="visual"?te.channel:te.field;let be=bu(`${g}_${he}`);for(let Pe=1;V.has(be);Pe++)be=bu(`${g}_${he}_${Pe}`);return V.add(be),{[ue]:be}};if(!n.fields&&!n.encodings){const te=e.config.selection[n.type];if(n.init)for(const ue of sc(n.init))for(const he of fi(ue))Ree(he)?(n.encodings||(n.encodings=[])).push(he):n.type==="interval"?(ci('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=te.encodings):(n.fields||(n.fields=[])).push(he);else n.encodings=te.encodings,n.fields=te.fields}for(const te of(u=n.fields)!==null&&u!==void 0?u:[]){const ue={type:"E",field:te};ue.signals=Object.assign({},X(ue,"data")),x.items.push(ue),x.hasField[te]=ue}for(const te of(f=n.encodings)!==null&&f!==void 0?f:[]){const ue=e.fieldDef(te);if(ue){let he=ue.field;if(ue.aggregate){ci(ae.cannotProjectAggregate(te,ue.aggregate));continue}if(!he){ci(ae.cannotProjectOnChannelWithoutField(te));continue}if(ue.timeUnit){he=e.vgField(te);const be={timeUnit:ue.timeUnit,as:he,field:ue.field};F[Ra(be)]=be}if(!k[he]){let be="E";t.type==="interval"?jg(e.getScaleComponent(te).get("type"))&&(be="R"):ue.bin&&(be="R-RE");const Pe={field:he,channel:te,type:be};Pe.signals=Object.assign(Object.assign({},X(Pe,"data")),X(Pe,"visual")),x.items.push(k[he]=Pe),x.hasField[he]=x.hasChannel[te]=k[he]}}else ci(ae.cannotProjectOnChannelWithoutField(te))}if(n.init){const te=ue=>x.items.map(he=>ue[he.channel]!==void 0?ue[he.channel]:ue[he.field]);if(n.type==="interval")t.init=te(n.init);else{const ue=sc(n.init);t.init=ue.map(te)}}Ts(F)||(x.timeUnit=new yy(null,F))},signals:(e,t,n)=>{const o=t.name+WE;return n.filter(u=>u.name===o).length>0?n:n.concat({name:o,value:t.project.items.map(u=>{const f=Qi(u,["signals","hasLegend"]);return f.field=ub(f.field),f})})}},Cz,Sb,kz,{has:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const o=t.name,u=Sb.has(t),f=o+Az,{x:g,y:x}=t.project.hasChannel;let k=Sx(t.translate,"scope");return u||(k=k.map(F=>(F.between[0].markname=o+VE,F))),n.push({name:f,value:{},on:[{events:k.map(F=>F.between[0]),update:"{x: x(unit), y: y(unit)"+(g!==void 0?", extent_x: "+(u?DN(e,Tu):`slice(${g.signals.visual})`):"")+(x!==void 0?", extent_y: "+(u?DN(e,$c):`slice(${x.signals.visual})`):"")+"}"}]},{name:o+Oz,value:{},on:[{events:k,update:`{x: ${f}.x - x(unit), y: ${f}.y - y(unit)}`}]}),g!==void 0&&Tz(e,t,g,"width",n),x!==void 0&&Tz(e,t,x,"height",n),n}},{has:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const o=t.name,u=Sb.has(t),f=o+Dz,{x:g,y:x}=t.project.hasChannel,k=Oa(e.scaleName(Tu)),F=Oa(e.scaleName($c));let V=Sx(t.zoom,"scope");return u||(V=V.map(X=>(X.markname=o+VE,X))),n.push({name:o+Mz,on:[{events:V,update:u?"{"+[k?`x: invert(${k}, x(unit))`:"",F?`y: invert(${F}, y(unit))`:""].filter(X=>!!X).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:f,on:[{events:V,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),g!==void 0&&Nz(e,t,g,"width",n),x!==void 0&&Nz(e,t,x,"height",n),n}},Sz,Ez,{has:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t,n)=>{n.clear&&(t.clear=ta(n.clear)?Sx(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(Sz.has(t))for(const o of t.project.items){const u=n.findIndex(f=>f.name===bu(`${t.name}_${o.field}`));u!==-1&&n[u].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function o(u,f){u!==-1&&n[u].on&&n[u].on.push({events:t.clear,update:f})}if(t.type==="interval")for(const u of t.project.items){const f=n.findIndex(g=>g.name===u.signals.visual);o(f,"[0, 0]"),f===-1&&o(n.findIndex(g=>g.name===u.signals.data),"null")}else{let u=n.findIndex(f=>f.name===t.name+by);o(u,"null"),Cz.has(t)&&o(u=n.findIndex(f=>f.name===t.name+"_toggle"),"false")}return n}}];function nA(e,t){for(const n of Ere)n.has(e)&&t(n)}function i2(e,t=!0,n=oee){if(ao(e)){const o=e.map(u=>i2(u,t,n));return t?`[${o.join(", ")}]`:o}return Zw(e)?n(t?NE(e):function(o){const u=B4(o,!0);return o.utc?+new Date(Date.UTC(...u)):+new Date(...u)}(e)):t?n(JSON.stringify(e)):e}function Iz(e,t){return Vx(e,(n,o)=>{t=o.marks?o.marks(e,n,t):t,nA(n,u=>{u.marks&&(t=u.marks(e,n,t))})}),t}function IN(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}const VE="_brush",FN="_scale_trigger",Sre={signals:(e,t)=>{const n=t.name,o=n+WE,u=Sb.has(t),f=[],g=[],x=[];if(t.translate&&!u){const V=`!event.item || event.item.mark.name !== ${Oa(n+VE)}`;Fz(t,(X,te)=>{var ue;const he=sc((ue=te.between[0].filter)!==null&&ue!==void 0?ue:te.between[0].filter=[]);return he.indexOf(V)<0&&he.push(V),X})}t.project.items.forEach((V,X)=>{const te=V.channel;if(te!==Tu&&te!==$c)return void ci("Interval selections only support x and y encoding channels.");const ue=t.init?t.init[X]:null,he=function(at,st,dt,ct){const kt=dt.channel,St=dt.signals.visual,yn=dt.signals.data,Mn=Sb.has(st),_n=Oa(at.scaleName(kt)),$n=at.getScaleComponent(kt),qn=$n?$n.get("type"):void 0,er=Zr=>`scale(${_n}, ${Zr})`,rr=at.getSizeSignalRef(kt===Tu?"width":"height").signal,fr=`${kt}(unit)`,Dr=Fz(st,(Zr,Br)=>[...Zr,{events:Br.between[0],update:`[${fr}, ${fr}]`},{events:Br,update:`[${St}[0], clamp(${fr}, 0, ${rr})]`}]);return Dr.push({events:{signal:st.name+FN},update:jg(qn)?`[${er(`${yn}[0]`)}, ${er(`${yn}[1]`)}]`:"[0, 0]"}),Mn?[{name:yn,on:[]}]:[Object.assign(Object.assign({name:St},ct?{init:i2(ct,!0,er)}:{value:[]}),{on:Dr}),Object.assign(Object.assign({name:yn},ct?{init:i2(ct)}:{}),{on:[{events:{signal:St},update:`${St}[0] === ${St}[1] ? null : invert(${_n}, ${St})`}]})]}(e,t,V,ue),be=V.signals.data,Pe=V.signals.visual,Ue=Oa(e.scaleName(te)),We=jg(e.getScaleComponent(te).get("type"))?"+":"";f.push(...he),g.push(be),x.push({scaleName:e.scaleName(te),expr:`(!isArray(${be}) || (${We}invert(${Ue}, ${Pe})[0] === ${We}${be}[0] && ${We}invert(${Ue}, ${Pe})[1] === ${We}${be}[1]))`})}),u||f.push({name:n+FN,value:{},on:[{events:x.map(V=>({scale:V.scaleName})),update:x.map(V=>V.expr).join(" && ")+` ? ${n+FN} : {}`}]});const k=t.init,F=`unit: ${p1(e)}, fields: ${o}, values`;return f.concat(Object.assign(Object.assign({name:n+by},k?{init:`{${F}: ${i2(k)}}`}:{}),{on:[{events:[{signal:g.join(" || ")}],update:g.join(" && ")+` ? {${F}: [${g}]} : null`}]}))},modifyExpr:(e,t)=>t.name+by+", "+(t.resolve==="global"?"true":`{unit: ${p1(e)}}`),marks:(e,t,n)=>{const o=t.name,{x:u,y:f}=t.project.hasChannel,g=u&&u.signals.visual,x=f&&f.signals.visual,k=`data(${Oa(t.name+Wx)})`;if(Sb.has(t))return n;const F={x:u!==void 0?{signal:`${g}[0]`}:{value:0},y:f!==void 0?{signal:`${x}[0]`}:{value:0},x2:u!==void 0?{signal:`${g}[1]`}:{field:{group:"width"}},y2:f!==void 0?{signal:`${x}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const Pe of fi(F))F[Pe]=[Object.assign({test:`${k}.length && ${k}[0].unit === ${p1(e)}`},F[Pe]),{value:0}];const V=t.mark,{fill:X,fillOpacity:te,cursor:ue}=V,he=Qi(V,["fill","fillOpacity","cursor"]),be=fi(he).reduce((Pe,Ue)=>(Pe[Ue]=[{test:[u!==void 0&&`${g}[0] !== ${g}[1]`,f!==void 0&&`${x}[0] !== ${x}[1]`].filter(We=>We).join(" && "),value:he[Ue]},{value:null}],Pe),{});return[{name:o+VE+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:X},fillOpacity:{value:te}},update:F}},...n,{name:o+VE,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},ue?{cursor:{value:ue}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},F),be)}}]}};function Fz(e,t){return e.events.reduce((n,o)=>o.between?t(n,o):(ci(`${o} is not an ordered event stream for interval selections.`),n),[])}function Rz(e,t){const n=t.name,o=n+WE,u="(item().isVoronoi ? datum.datum : datum)",f=t.project.items.map(k=>{const F=e.fieldDef(k.channel);return F&&F.bin?`[${u}[${Oa(e.vgField(k.channel,{}))}], ${u}[${Oa(e.vgField(k.channel,{binSuffix:"end"}))}]]`:`${u}[${Oa(k.field)}]`}).join(", "),g=`unit: ${p1(e)}, fields: ${o}, values`,x=t.events;return[{name:n+by,on:x?[{events:x,update:`datum && item().mark.marktype !== 'group' ? {${g}: [${f}]} : null`,force:!0}]:[]}]}const Cre={signals:Rz,modifyExpr:(e,t)=>t.name+by+", "+(t.resolve==="global"?"null":`{unit: ${p1(e)}}`)},kre={signals:Rz,modifyExpr:(e,t)=>t.name+by+", "+(t.resolve==="global"?"true":`{unit: ${p1(e)}}`)},Wx="_store",by="_tuple",Are="_modify",Pz="vlSelectionResolve",Ore={single:kre,multi:Cre,interval:Sre};function Vx(e,t){const n=e.component.selection;if(n){for(const o of sb(n))if(t(o,Ore[o.type])===!0)break}}function p1(e,{escape:t}={escape:!0}){let n=t?Oa(e.name):e.name;const o=function(u){let f=u.parent;for(;f&&!$0(f);)f=f.parent;return f}(e);if(o){const{facet:u}=o;for(const f of Lg)u[f]&&(n+=` + '__facet_${f}_' + (facet[${Oa(o.vgField(f))}])`)}return n}function RN(e){let t=!1;return Vx(e,n=>{t=t||n.project.items.some(o=>o.field===r2)}),t}const Tre="RawCode",Mre="Literal",Dre="Property",Nre="Identifier",Ire="ArrayExpression",Fre="BinaryExpression",Rre="CallExpression",Pre="ConditionalExpression",Lre="LogicalExpression",Bre="MemberExpression",jre="ObjectExpression",zre="UnaryExpression";function H0(e){this.type=e}var m1,zi,Gr,nd,ls;H0.prototype.visit=function(e){let t,n,o;if(e(this))return 1;for(n=0,o=(t=function(u){switch(u.type){case Ire:return u.elements;case Fre:case Lre:return[u.left,u.right];case Rre:return[u.callee].concat(u.arguments);case Pre:return[u.test,u.consequent,u.alternate];case Bre:return[u.object,u.property];case jre:return u.properties;case Dre:return[u.key,u.value];case zre:return[u.argument];case Nre:case Mre:case Tre:default:return[]}}(this)).length;n<o;++n)if(t[n].visit(e))return 1};var rA=1,HE=2,Hx=3,Cb=4,iA=5,Gx=6,Tp=7,GE=8;(m1={})[rA]="Boolean",m1[HE]="<end>",m1[Hx]="Identifier",m1[Cb]="Keyword",m1[iA]="Null",m1[Gx]="Numeric",m1[Tp]="Punctuator",m1[GE]="String",m1[9]="RegularExpression";var Ure="ArrayExpression",Wre="BinaryExpression",Vre="CallExpression",Hre="ConditionalExpression",Lz="Identifier",Gre="Literal",qre="LogicalExpression",$re="MemberExpression",Xre="ObjectExpression",Kre="Property",Yre="UnaryExpression",uf="Unexpected token %0",Jre="Unexpected number",Qre="Unexpected string",Zre="Unexpected identifier",eie="Unexpected reserved word",tie="Unexpected end of input",PN="Invalid regular expression",LN="Invalid regular expression: missing /",Bz="Octal literals are not allowed in strict mode.",nie="Duplicate data property in object literal not allowed in strict mode",rd="ILLEGAL",qE="Disabled.",rie=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),iie=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function oA(e,t){if(!e)throw new Error("ASSERT: "+t)}function g1(e){return e>=48&&e<=57}function BN(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function $E(e){return"01234567".indexOf(e)>=0}function oie(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function XE(e){return e===10||e===13||e===8232||e===8233}function KE(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&rie.test(String.fromCharCode(e))}function aA(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&iie.test(String.fromCharCode(e))}var aie={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function jz(){for(var e;Gr<nd&&(oie(e=zi.charCodeAt(Gr))||XE(e));)++Gr}function jN(e){var t,n,o,u=0;for(n=e==="u"?4:2,t=0;t<n;++t)Gr<nd&&BN(zi[Gr])?(o=zi[Gr++],u=16*u+"0123456789abcdef".indexOf(o.toLowerCase())):Ja({},uf,rd);return String.fromCharCode(u)}function sie(){var e,t,n,o;for(t=0,(e=zi[Gr])==="}"&&Ja({},uf,rd);Gr<nd&&BN(e=zi[Gr++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&Ja({},uf,rd),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),o=56320+(t-65536&1023),String.fromCharCode(n,o))}function zz(){var e,t;for(e=zi.charCodeAt(Gr++),t=String.fromCharCode(e),e===92&&(zi.charCodeAt(Gr)!==117&&Ja({},uf,rd),++Gr,(e=jN("u"))&&e!=="\\"&&KE(e.charCodeAt(0))||Ja({},uf,rd),t=e);Gr<nd&&aA(e=zi.charCodeAt(Gr));)++Gr,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),zi.charCodeAt(Gr)!==117&&Ja({},uf,rd),++Gr,(e=jN("u"))&&e!=="\\"&&aA(e.charCodeAt(0))||Ja({},uf,rd),t+=e);return t}function uie(){var e,t;return e=Gr,{type:(t=zi.charCodeAt(Gr)===92?zz():function(){var n,o;for(n=Gr++;Gr<nd;){if((o=zi.charCodeAt(Gr))===92)return Gr=n,zz();if(!aA(o))break;++Gr}return zi.slice(n,Gr)}()).length===1?Hx:aie.hasOwnProperty(t)?Cb:t==="null"?iA:t==="true"||t==="false"?rA:Hx,value:t,start:e,end:Gr}}function zN(){var e,t,n,o,u=Gr,f=zi.charCodeAt(Gr),g=zi[Gr];switch(f){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Gr,{type:Tp,value:String.fromCharCode(f),start:u,end:Gr};default:if((e=zi.charCodeAt(Gr+1))===61)switch(f){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Gr+=2,{type:Tp,value:String.fromCharCode(f)+String.fromCharCode(e),start:u,end:Gr};case 33:case 61:return Gr+=2,zi.charCodeAt(Gr)===61&&++Gr,{type:Tp,value:zi.slice(u,Gr),start:u,end:Gr}}}return(o=zi.substr(Gr,4))===">>>="?{type:Tp,value:o,start:u,end:Gr+=4}:(n=o.substr(0,3))===">>>"||n==="<<="||n===">>="?{type:Tp,value:n,start:u,end:Gr+=3}:g===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(g)>=0||t==="=>"?{type:Tp,value:t,start:u,end:Gr+=2}:"<>=!+-*%&|^/".indexOf(g)>=0?{type:Tp,value:g,start:u,end:++Gr}:void Ja({},uf,rd)}function Uz(){var e,t,n;if(oA(g1((n=zi[Gr]).charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=Gr,e="",n!=="."){if(e=zi[Gr++],n=zi[Gr],e==="0"){if(n==="x"||n==="X")return++Gr,function(o){for(var u="";Gr<nd&&BN(zi[Gr]);)u+=zi[Gr++];return u.length===0&&Ja({},uf,rd),KE(zi.charCodeAt(Gr))&&Ja({},uf,rd),{type:Gx,value:parseInt("0x"+u,16),start:o,end:Gr}}(t);if($E(n))return function(o){for(var u="0"+zi[Gr++];Gr<nd&&$E(zi[Gr]);)u+=zi[Gr++];return(KE(zi.charCodeAt(Gr))||g1(zi.charCodeAt(Gr)))&&Ja({},uf,rd),{type:Gx,value:parseInt(u,8),octal:!0,start:o,end:Gr}}(t);n&&g1(n.charCodeAt(0))&&Ja({},uf,rd)}for(;g1(zi.charCodeAt(Gr));)e+=zi[Gr++];n=zi[Gr]}if(n==="."){for(e+=zi[Gr++];g1(zi.charCodeAt(Gr));)e+=zi[Gr++];n=zi[Gr]}if(n==="e"||n==="E")if(e+=zi[Gr++],(n=zi[Gr])!=="+"&&n!=="-"||(e+=zi[Gr++]),g1(zi.charCodeAt(Gr)))for(;g1(zi.charCodeAt(Gr));)e+=zi[Gr++];else Ja({},uf,rd);return KE(zi.charCodeAt(Gr))&&Ja({},uf,rd),{type:Gx,value:parseFloat(e),start:t,end:Gr}}function cie(){var e,t,n,o;return ls=null,jz(),e=Gr,t=function(){var u,f,g,x;for(oA((u=zi[Gr])==="/","Regular expression literal must start with a slash"),f=zi[Gr++],g=!1,x=!1;Gr<nd;)if(f+=u=zi[Gr++],u==="\\")XE((u=zi[Gr++]).charCodeAt(0))&&Ja({},LN),f+=u;else if(XE(u.charCodeAt(0)))Ja({},LN);else if(g)u==="]"&&(g=!1);else{if(u==="/"){x=!0;break}u==="["&&(g=!0)}return x||Ja({},LN),{value:f.substr(1,f.length-2),literal:f}}(),n=function(){var u,f,g;for(f="",g="";Gr<nd&&aA((u=zi[Gr]).charCodeAt(0));)++Gr,u==="\\"&&Gr<nd?Ja({},uf,rd):(g+=u,f+=u);return g.search(/[^gimuy]/g)>=0&&Ja({},PN,g),{value:g,literal:f}}(),o=function(u,f){var g=u;f.indexOf("u")>=0&&(g=g.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(x,k){if(parseInt(k,16)<=1114111)return"x";Ja({},PN)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(g)}catch{Ja({},PN)}try{return new RegExp(u,f)}catch{return null}}(t.value,n.value),{literal:t.literal+n.literal,value:o,regex:{pattern:t.value,flags:n.value},start:e,end:Gr}}function Wz(){var e;return jz(),Gr>=nd?{type:HE,start:Gr,end:Gr}:KE(e=zi.charCodeAt(Gr))?uie():e===40||e===41||e===59?zN():e===39||e===34?function(){var t,n,o,u,f="",g=!1;for(oA((t=zi[Gr])==="'"||t==='"',"String literal must starts with a quote"),n=Gr,++Gr;Gr<nd;){if((o=zi[Gr++])===t){t="";break}if(o==="\\")if((o=zi[Gr++])&&XE(o.charCodeAt(0)))o==="\r"&&zi[Gr]===`
`&&++Gr;else switch(o){case"u":case"x":zi[Gr]==="{"?(++Gr,f+=sie()):f+=jN(o);break;case"n":f+=`
`;break;case"r":f+="\r";break;case"t":f+="	";break;case"b":f+="\b";break;case"f":f+="\f";break;case"v":f+="\v";break;default:$E(o)?((u="01234567".indexOf(o))!==0&&(g=!0),Gr<nd&&$E(zi[Gr])&&(g=!0,u=8*u+"01234567".indexOf(zi[Gr++]),"0123".indexOf(o)>=0&&Gr<nd&&$E(zi[Gr])&&(u=8*u+"01234567".indexOf(zi[Gr++]))),f+=String.fromCharCode(u)):f+=o}else{if(XE(o.charCodeAt(0)))break;f+=o}}return t!==""&&Ja({},uf,rd),{type:GE,value:f,octal:g,start:n,end:Gr}}():e===46?g1(zi.charCodeAt(Gr+1))?Uz():zN():g1(e)?Uz():zN()}function Mp(){var e;return Gr=(e=ls).end,ls=Wz(),Gr=e.end,e}function Vz(){var e;e=Gr,ls=Wz(),Gr=e}function Hz(e,t,n){var o=new H0(e==="||"||e==="&&"?qre:Wre);return o.operator=e,o.left=t,o.right=n,o}function lie(e,t){var n=new H0(Vre);return n.callee=e,n.arguments=t,n}function UN(e){var t=new H0(Lz);return t.name=e,t}function YE(e){var t=new H0(Gre);return t.value=e.value,t.raw=zi.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function Gz(e,t,n){var o=new H0($re);return o.computed=e==="[",o.object=t,o.property=n,o.computed||(n.member=!0),o}function qz(e,t,n){var o=new H0(Kre);return o.key=t,o.value=n,o.kind=e,o}function Ja(e,t){var n,o=Array.prototype.slice.call(arguments,2),u=t.replace(/%(\d)/g,function(f,g){return oA(g<o.length,"Message reference must be in range"),o[g]});throw(n=new Error(u)).index=Gr,n.description=u,n}function sA(e){e.type===HE&&Ja(e,tie),e.type===Gx&&Ja(e,Jre),e.type===GE&&Ja(e,Qre),e.type===Hx&&Ja(e,Zre),e.type===Cb&&Ja(e,eie),Ja(e,uf,e.value)}function id(e){var t=Mp();t.type===Tp&&t.value===e||sA(t)}function nu(e){return ls.type===Tp&&ls.value===e}function WN(e){return ls.type===Cb&&ls.value===e}function fie(){var e=[];for(Gr=ls.start,id("[");!nu("]");)nu(",")?(Mp(),e.push(null)):(e.push(qx()),nu("]")||id(","));return Mp(),function(t){var n=new H0(Ure);return n.elements=t,n}(e)}function $z(){var e;return Gr=ls.start,(e=Mp()).type===GE||e.type===Gx?(e.octal&&Ja(e,Bz),YE(e)):UN(e.value)}function die(){var e,t,n;return Gr=ls.start,(e=ls).type===Hx?(n=$z(),id(":"),qz("init",n,qx())):e.type!==HE&&e.type!==Tp?(t=$z(),id(":"),qz("init",t,qx())):void sA(e)}function hie(){var e,t,n=[],o={},u=String;for(Gr=ls.start,id("{");!nu("}");)t="$"+((e=die()).key.type===Lz?e.key.name:u(e.key.value)),Object.prototype.hasOwnProperty.call(o,t)?Ja({},nie):o[t]=!0,n.push(e),nu("}")||id(",");return id("}"),function(f){var g=new H0(Xre);return g.properties=f,g}(n)}var pie={if:1};function mie(){var e,t,n;if(nu("("))return function(){var o;return id("("),o=VN(),id(")"),o}();if(nu("["))return fie();if(nu("{"))return hie();if(e=ls.type,Gr=ls.start,e===Hx||pie[ls.value])n=UN(Mp().value);else if(e===GE||e===Gx)ls.octal&&Ja(ls,Bz),n=YE(Mp());else{if(e===Cb)throw new Error(qE);e===rA?((t=Mp()).value=t.value==="true",n=YE(t)):e===iA?((t=Mp()).value=null,n=YE(t)):nu("/")||nu("/=")?(n=YE(cie()),Vz()):sA(Mp())}return n}function gie(){var e=[];if(id("("),!nu(")"))for(;Gr<nd&&(e.push(qx()),!nu(")"));)id(",");return id(")"),e}function vie(){var e;return Gr=ls.start,function(t){return t.type===Hx||t.type===Cb||t.type===rA||t.type===iA}(e=Mp())||sA(e),UN(e.value)}function yie(){var e;return id("["),e=VN(),id("]"),e}function Xz(){var e=function(){var t;for(t=mie();;)if(nu("."))id("."),t=Gz(".",t,vie());else if(nu("("))t=lie(t,gie());else{if(!nu("["))break;t=Gz("[",t,yie())}return t}();if(ls.type===Tp&&(nu("++")||nu("--")))throw new Error(qE);return e}function uA(){var e,t;if(ls.type!==Tp&&ls.type!==Cb)t=Xz();else{if(nu("++")||nu("--"))throw new Error(qE);if(nu("+")||nu("-")||nu("~")||nu("!"))e=Mp(),t=uA(),t=function(n,o){var u=new H0(Yre);return u.operator=n,u.argument=o,u.prefix=!0,u}(e.value,t);else{if(WN("delete")||WN("void")||WN("typeof"))throw new Error(qE);t=Xz()}}return t}function Kz(e){var t=0;if(e.type!==Tp&&e.type!==Cb)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function qx(){var e,t;return e=function(){var n,o,u,f,g,x,k,F,V,X;if(n=ls,V=uA(),(g=Kz(f=ls))===0)return V;for(f.prec=g,Mp(),o=[n,ls],x=[V,f,k=uA()];(g=Kz(ls))>0;){for(;x.length>2&&g<=x[x.length-2].prec;)k=x.pop(),F=x.pop().value,V=x.pop(),o.pop(),u=Hz(F,V,k),x.push(u);(f=Mp()).prec=g,x.push(f),o.push(ls),u=uA(),x.push(u)}for(u=x[X=x.length-1],o.pop();X>1;)o.pop(),u=Hz(x[X-1].value,x[X-2],u),X-=2;return u}(),nu("?")&&(Mp(),t=qx(),id(":"),e=function(n,o,u){var f=new H0(Hre);return f.test=n,f.consequent=o,f.alternate=u,f}(e,t,qx())),e}function VN(){var e=qx();if(nu(","))throw new Error(qE);return e}var bie=function(e){Gr=0,nd=(zi=e).length,ls=null,Vz();var t=VN();if(ls.type!==HE)throw new Error("Unexpect token after expression.");return t};function o2(e,t,n){return e.fields=t||[],e.fname=n,e}function xie(e){return e.length===1?wie(e[0]):_ie(e)}const wie=e=>function(t){return t[e]},_ie=e=>{const t=e.length;return function(n){for(let o=0;o<t;++o)n=n[e[o]];return n}};function HN(e){throw Error(e)}function Eie(e){const t=[],n=e.length;let o,u,f,g=null,x=0,k="";function F(){t.push(k+e.substring(o,u)),k="",o=u+1}for(e+="",o=u=0;u<n;++u)if((f=e[u])==="\\")k+=e.substring(o,u),k+=e.substring(++u,++u),o=u;else if(f===g)F(),g=null,x=-1;else{if(g)continue;o===x&&f==='"'||o===x&&f==="'"?(o=u+1,g=f):f!=="."||x?f==="["?(u>o&&F(),x=o=u+1):f==="]"&&(x||HN("Access path missing open bracket: "+e),x>0&&F(),x=0,o=u+1):u>o?F():o=u+1}return x&&HN("Access path missing closing bracket: "+e),g&&HN("Access path missing closing quote: "+e),u>o&&(u++,F()),t}function Sie(e,t,n){const o=Eie(e);return e=o.length===1?o[0]:e,o2((n&&n.get||xie)(o),[e],t||e)}Sie("id"),o2(e=>e,[],"identity"),o2(()=>0,[],"zero"),o2(()=>1,[],"one"),o2(()=>!0,[],"true"),o2(()=>!1,[],"false");function Yz(e){const t=bie(e),n=new Set;return t.visit(o=>{o.type==="MemberExpression"&&function u(f){return f.object.type==="MemberExpression"?u(f.object):f.object.name==="datum"}(o)&&n.add(function u(f){const g=[];return f.type==="Identifier"?[f.name]:f.type==="Literal"?[f.value]:(f.type==="MemberExpression"&&(g.push(...u(f.object)),g.push(...u(f.property))),g)}(o).slice(1).join("."))}),n}class a2 extends ys{constructor(t,n,o){super(t),this.model=n,this.filter=o,this.expr=cA(this.model,this.filter,this),this._dependentFields=Yz(this.expr)}clone(){return new a2(null,this.model,na(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function Jz(e,t,n,o="datum"){const u=[],f=kE(t,function(g){const x=bu(g),k=e.getSelectionComponent(x,g),F=Oa(x+Wx);if(k.project.timeUnit){const V=n??e.component.data.raw,X=k.project.timeUnit.clone();V.parent?X.insertAsParentOf(V):V.parent=X}return k.empty!=="none"&&u.push(F),`vlSelectionTest(${F}, ${o}`+(k.resolve==="global"?")":`, ${Oa(k.resolve)})`)});return(u.length?"!("+u.map(g=>`length(data(${g}))`).join(" || ")+") || ":"")+`(${f})`}function Qz(e,t){const n=t.encoding;let o=t.field;if(n||o){if(n&&!o){const u=e.project.items.filter(f=>f.channel===n);!u.length||u.length>1?(o=e.project.items[0].field,ci((u.length?"Multiple ":"No ")+`matching ${Oa(n)} encoding found for selection ${Oa(t.selection)}. Using "field": ${Oa(o)}.`)):o=u[0].field}}else o=e.project.items[0].field,e.project.items.length>1&&ci(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${Oa(o)}.`);return`${e.name}[${Oa(o)}]`}function cA(e,t,n){return kE(t,o=>ta(o)?o:function(u){return u==null?void 0:u.selection}(o)?Jz(e,o.selection,n):G8(o))}function GN(e,t,n,o){var u,f,g;e.encode=(u=e.encode)!==null&&u!==void 0?u:{},e.encode[t]=(f=e.encode[t])!==null&&f!==void 0?f:{},e.encode[t].update=(g=e.encode[t].update)!==null&&g!==void 0?g:{},e.encode[t].update[n]=o}function JE(e,t,n,o={header:!1}){var u,f;const g=e.combine(),{disable:x,orient:k,scale:F,labelExpr:V,title:X,zindex:te}=g,ue=Qi(g,["disable","orient","scale","labelExpr","title","zindex"]);if(!x){for(const he in ue){const be=yee[he],Pe=ue[he];if(be&&be!==t&&be!=="both")delete ue[he];else if(T4(Pe)){const{condition:Ue}=Pe,We=Qi(Pe,["condition"]),at=sc(Ue),st=f8[he];if(st){const{vgProp:dt,part:ct}=st;GN(ue,ct,dt,[...at.map(kt=>{const{test:St}=kt,yn=Qi(kt,["test"]);return Object.assign({test:cA(null,St)},yn)}),We]),delete ue[he]}else if(st===null){const dt={signal:at.map(ct=>{const{test:kt}=ct,St=Qi(ct,["test"]);return`${cA(null,kt)} ? ${S9(St)} : `}).join("")+S9(We)};ue[he]=dt}}else if(ko(Pe)){const Ue=f8[he];if(Ue){const{vgProp:We,part:at}=Ue;GN(ue,at,We,Pe),delete ue[he]}}}if(t==="grid"){if(!ue.grid)return;if(ue.encode){const{grid:he}=ue.encode;ue.encode=Object.assign({},he?{grid:he}:{}),Ts(ue.encode)&&delete ue.encode}return Object.assign(Object.assign({scale:F,orient:k},ue),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:kc(te,0)})}{if(!o.header&&e.mainExtracted)return;if(V!==void 0){let be=V;!((f=(u=ue.encode)===null||u===void 0?void 0:u.labels)===null||f===void 0)&&f.update&&ko(ue.encode.labels.update.text)&&(be=Jw(V,"datum.label",ue.encode.labels.update.text.signal)),GN(ue,"labels","text",{signal:be})}if(ue.labelAlign===null&&delete ue.labelAlign,ue.encode){for(const be of d8)e.hasAxisPart(be)||delete ue.encode[be];Ts(ue.encode)&&delete ue.encode}const he=function(be,Pe){if(be)return ao(be)&&!wb(be)?be.map(Ue=>x9(Ue,Pe)).join(", "):be}(X,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:F,orient:k,grid:!1},he?{title:he}:{}),ue),n.aria===!1?{aria:!1}:{}),{zindex:kc(te,0)})}}}function Zz(e){const{axes:t}=e.component,n=[];for(const o of Bg)if(t[o]){for(const u of t[o])if(!u.get("disable")&&!u.get("gridScale")){const f=o==="x"?"height":"width",g=e.getSizeSignalRef(f).signal;f!==g&&n.push({name:f,update:g})}}return n}const e7={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},t7={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},Cie=fi(e7),kie=fi(t7);function n7(e,t,n,o){return Object.assign.apply(null,[{},...e.map(u=>{if(u==="axisOrient"){const f=n==="x"?"bottom":"left",g=t[n==="x"?"axisBottom":"axisLeft"]||{},x=t[n==="x"?"axisTop":"axisRight"]||{},k=new Set([...fi(g),...fi(x)]),F={};for(const V of k.values())F[V]={signal:`${o.signal} === "${f}" ? ${LE(g[V])} : ${LE(x[V])}`};return F}return t[u]})])}function Aie(e,t,n,o){const u=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:function(F){return F in xne}(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],f=e==="x"?"axisX":"axisY",g=ko(n)?"axisOrient":"axis"+m3(n),x=[...u,...u.map(F=>f+F.substr(4))],k=["axis",g,f];return{vlOnlyAxisConfig:n7(x,o,e,n),vgAxisConfig:n7(k,o,e,n),axisConfigStyle:function(F,V){var X;const te=[{}];for(const ue of F){let he=(X=V[ue])===null||X===void 0?void 0:X.style;if(he){he=sc(he);for(const be of he)te.push(V.style[be])}}return Object.assign.apply(null,te)}([...k,...x],o)}}function qN(e,t,n,o={}){var u;const f=k9(e,n,t.style);if(f!==void 0)return{configFrom:"style",configValue:f};for(const g of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((u=o[g])===null||u===void 0?void 0:u[e])!==void 0)return{configFrom:g,configValue:o[g][e]};return{}}const r7={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:o,formatType:u}=n;return r9(e,e.type,o,u,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:o}=e;return i9(o,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var o;return(!_i(e)||!ph(e.bin))&&((o=t.grid)!==null&&o!==void 0?o:function(u,f){return!Op(u)&&_i(f)&&!Hs(f==null?void 0:f.bin)}(n,e))},gridScale:({model:e,channel:t})=>function(n,o){const u=o==="x"?"y":"x";if(n.getScaleComponent(u))return n.scaleName(u)}(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:o})=>e.labelAlign||o7(t,n,o),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:o})=>e.labelBaseline||i7(t,n,o),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var o;return(o=e.labelFlush)!==null&&o!==void 0?o:function(u,f){if(f==="x"&&fo(["quantitative","temporal"],u))return!0}(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var o;return(o=e.labelOverlap)!==null&&o!==void 0?o:function(u,f){if(u!=="nominal")return f!=="log"||"greedy"}(t.type,n)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:o,scaleType:u})=>{var f;const g=e==="x"?"width":e==="y"?"height":void 0,x=g?t.getSizeSignalRef(g):void 0;return(f=n.tickCount)!==null&&f!==void 0?f:function({fieldOrDatumDef:k,scaleType:F,size:V,values:X}){var te;if(!X&&!Op(F)&&F!=="log"){if(_i(k)){if(Hs(k.bin))return{signal:`ceil(${V.signal}/10)`};if(k.timeUnit&&fo(["month","hours","day","quarter"],(te=mh(k.timeUnit))===null||te===void 0?void 0:te.unit))return}return{signal:`ceil(${V.signal}/40)`}}}({fieldOrDatumDef:o,scaleType:u,size:x,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const o=a7(t,n);if(o!==void 0)return o;const u=t.typedFieldDef(n),f=n==="x"?"x2":"y2",g=t.fieldDef(f);return O9(u?[f9(u)]:[],_i(g)?[f9(g)]:[])},values:({axis:e,fieldOrDatumDef:t})=>function(n,o){const u=n.values;if(ao(u))return _9(o,u);if(ko(u))return u}(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var o;return(o=e.zindex)!==null&&o!==void 0?o:function(u,f){return u==="rect"&&m9(f)?1:0}(n,t)}};function $N(e){return`(((${e.signal} % 360) + 360) % 360)`}function i7(e,t,n,o){if(e!==void 0){if(n==="x"){if(ko(e)){const u=$N(e);return{signal:`(45 < ${u} && ${u} < 135) || (225 < ${u} && ${u} < 315) ? "middle" :(${u} <= 45 || 315 <= ${u}) === ${ko(t)?`(${t.signal} === "top")`:t==="top"} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(ko(t)){const u=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${u} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==(t==="top")?"bottom":"top"}if(ko(e)){const u=$N(e),f=ko(t)?`(${t.signal} === "left")`:t==="left";return{signal:`${u} <= 45 || 315 <= ${u} || (135 <= ${u} && ${u} <= 225) ? ${o?'"middle"':"null"} : (45 <= ${u} && ${u} <= 135) === ${f} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return o?"middle":null;if(ko(t)){const u=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${u} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==(t==="left")?"top":"bottom"}}function o7(e,t,n){if(e===void 0)return;const o=n==="x",u=o?0:90,f=o?"bottom":"left";if(ko(e)){const g=$N(e),x=ko(t)?`(${t.signal} === "${f}")`:t===f;return{signal:`(${u?"("+g+" + 90)":g} % 180 === 0) ? ${o?null:'"center"'} :(${u} < ${g} && ${g} < ${180+u}) === ${x} ? "left" : "right"`}}if((e+u)%180==0)return o?null:"center";if(ko(t)){const g=u<e&&e<180+u?"===":"!==";return{signal:`${`${t.signal} ${g} "${f}"`} ? "left" : "right"`}}return(u<e&&e<180+u)==(t===f)?"left":"right"}function a7(e,t){const n=t==="x"?"x2":"y2",o=e.fieldDef(t),u=e.fieldDef(n),f=o?o.title:void 0,g=u?u.title:void 0;return f&&g?T9(f,g):f||g||(f!==void 0?f:g!==void 0?g:void 0)}class s2 extends ys{constructor(t,n){super(t),this.transform=n,this._dependentFields=Yz(this.transform.calculate)}clone(){return new s2(null,na(this.transform))}static parseAllForSortIndex(t,n){return n.forEachFieldDef((o,u)=>{if(oN(o)&&l9(o.sort)){const{field:f,timeUnit:g}=o,x=o.sort,k=x.map((F,V)=>`${G8({field:f,timeUnit:g,equal:F})} ? ${V} : `).join("")+x.length;t=new s2(t,{calculate:k,as:u2(o,u,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${Ra(this.transform)}`}}function u2(e,t,n){return mi(e,Object.assign({prefix:t,suffix:"sort_index"},n??{}))}function lA(e,t){return fo(["top","bottom"],t)?"column":fo(["left","right"],t)||e==="row"?"row":"column"}function c2(e,t,n,o){const u=o==="row"?n.headerRow:o==="column"?n.headerColumn:n.headerFacet;return kc(((t==null?void 0:t.header)||{})[e],u[e],n.header[e])}function fA(e,t,n,o){const u={};for(const f of e){const g=c2(f,t,n,o);g!==void 0&&(u[f]=g)}return u}const XN=["row","column"],KN=["header","footer"];function Oie(e,t){const n=e.component.layoutHeaders[t].title,o=e.config?e.config:void 0,u=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:f,titleAngle:g,titleOrient:x}=fA(["titleAnchor","titleAngle","titleOrient"],u,o,t),k=lA(t,x),F=g3(g);return{name:`${t}-title`,type:"group",role:`${k}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),u7(F,k)),s7(k,F,f)),c7(o,u,t,Cie,e7))}}function s7(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const o=o7(t,e==="row"?"left":"top",e==="row"?"y":"x");return o?{align:o}:{}}function u7(e,t){const n=i7(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function Tie(e,t){const n=e.component.layoutHeaders[t],o=[];for(const u of KN)if(n[u])for(const f of n[u]){const g=Mie(e,t,u,n,f);g!=null&&o.push(g)}return o}function YN(e,t,n){const{format:o,formatType:u,labelAngle:f,labelAnchor:g,labelOrient:x,labelExpr:k}=fA(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e,n,t),F=Q4({fieldOrDatumDef:e,format:o,formatType:u,expr:"parent",config:n}).signal,V=lA(t,x);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:k?Jw(Jw(k,"datum.label",F),"datum.value",mi(e,{expr:"parent"})):F}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),u7(f,V)),s7(V,f,g)),c7(n,e,t,kie,t7))}function Mie(e,t,n,o,u){if(u){let f=null;const{facetFieldDef:g}=o,x=e.config?e.config:void 0;if(g&&u.labels){const{labelOrient:X}=fA(["labelOrient"],g,x,t);(t==="row"&&!fo(["top","bottom"],X)||t==="column"&&!fo(["left","right"],X))&&(f=YN(g,t,x))}const k=$0(e)&&!FE(e.facet),F=u.axes,V=(F==null?void 0:F.length)>0;if(f||V){const X=t==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},o.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:function(te,ue){var he;const{sort:be}=te;return py(be)?{field:mi(be,{expr:"datum"}),order:(he=be.order)!==null&&he!==void 0?he:"ascending"}:ao(be)?{field:u2(te,ue,{expr:"datum"}),order:"ascending"}:{field:mi(te,{expr:"datum"}),order:be??"ascending"}}(g,t)}:{}),V&&k?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),f?{title:f}:{}),u.sizeSignal?{encode:{update:{[X]:u.sizeSignal}}}:{}),V?{axes:F}:{})}}return null}const Die={column:{start:0,end:1},row:{start:1,end:0}};function Nie(e,t){return Die[t][e]}function c7(e,t,n,o,u){const f={};for(const g of o){if(!u[g])continue;const x=c2(g,t,e,n);x!==void 0&&(f[u[g]]=x)}return f}function JN(e){return[...dA(e,"width"),...dA(e,"height"),...dA(e,"childWidth"),...dA(e,"childHeight")]}function dA(e,t){const n=t==="width"?"x":"y",o=e.component.layoutSize.get(t);if(!o||o==="merged")return[];const u=e.getSizeSignalRef(t).signal;if(o==="step"){const f=e.getScaleComponent(n);if(f){const g=f.get("type"),x=f.get("range");if(Op(g)&&vb(x)){const k=e.scaleName(n);return $0(e.parent)&&e.parent.component.resolve.scale[n]==="independent"?[l7(k,x)]:[l7(k,x),{name:u,update:f7(k,f,`domain('${k}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}if(o=="container"){const f=u.endsWith("width"),g=f?"containerSize()[0]":"containerSize()[1]",x=`isFinite(${g}) ? ${g} : ${_N(e.config.view,f?"width":"height")}`;return[{name:u,init:x,on:[{update:x,events:"window:resize"}]}]}return[{name:u,value:o}]}function l7(e,t){return{name:e+"_step",value:t.step}}function f7(e,t,n){const o=t.get("type"),u=t.get("padding"),f=kc(t.get("paddingOuter"),u);let g=t.get("paddingInner");return`bandspace(${n}, ${g=o==="band"?g!==void 0?g:u:1}, ${f}) * ${e}_step`}function d7(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function h7(e,t){return fi(e).reduce((n,o)=>{const u=e[o];return Object.assign(Object.assign({},n),zE(t,u,o,f=>ko(f)?f:{value:f.value}))},{})}function Iie(e,t){if(h2(t)||$0(t))return"shared";if(lI(t))return dy(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function QN(e,t){const n=e.scale[t],o=dy(t)?"axis":"legend";return n==="independent"?(e[o][t]==="shared"&&ci(ae.independentScaleMeansIndependentGuide(t)),"independent"):e[o][t]||"shared"}const Fie=Object.assign(Object.assign({},Lne),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),p7=fi(Fie);class Rie extends h1{}const m7={symbols:function(e,{fieldOrDatumDef:t,model:n,channel:o,legendCmpt:u,legendType:f}){var g,x,k,F,V;if(f!=="symbol")return;const{markDef:X,encoding:te,config:ue,mark:he}=n,be=X.filled&&he!=="trail";let Pe=Object.assign(Object.assign({},function(We,at,st){for(const dt of st){const ct=Bx(dt,at.markDef,at.config);ct!==void 0&&(We[dt]=uc(ct))}return We}({},n,Eee)),vz(n,{filled:be}));const Ue=(g=g7(te.opacity))!==null&&g!==void 0?g:X.opacity;if(Pe.fill){if(o==="fill"||be&&o===kp)delete Pe.fill;else if(Pe.fill.field)u.get("symbolFillColor")?delete Pe.fill:(Pe.fill=uc((x=ue.legend.symbolBaseFillColor)!==null&&x!==void 0?x:"black"),Pe.fillOpacity=uc(Ue??1));else if(ao(Pe.fill)){const We=(V=(F=ZN((k=te.fill)!==null&&k!==void 0?k:te.color))!==null&&F!==void 0?F:X.fill)!==null&&V!==void 0?V:be&&X.color;We&&(Pe.fill=uc(We))}}if(Pe.stroke){if(o==="stroke"||!be&&o===kp)delete Pe.stroke;else if(Pe.stroke.field)delete Pe.stroke;else if(ao(Pe.stroke)){const We=kc(ZN(te.stroke||te.color),X.stroke,be?X.color:void 0);We&&(Pe.stroke={value:We})}}if(o!==l1){const We=_i(t)&&y7(n,u,t);We?Pe.opacity=[Object.assign({test:We},uc(Ue??1)),uc(ue.legend.unselectedOpacity)]:Ue&&(Pe.opacity=uc(Ue))}return Ts(Pe=Object.assign(Object.assign({},Pe),e))?void 0:Pe},gradient:function(e,{model:t,legendType:n}){if(n!=="gradient")return;let o={};const u=g7(t.encoding.opacity)||t.markDef.opacity;return u&&(o.opacity=uc(u)),Ts(o=Object.assign(Object.assign({},o),e))?void 0:o},labels:function(e,{fieldOrDatumDef:t,model:n,channel:o,legendCmpt:u}){const f=n.legend(o)||{},g=n.config,x=_i(t)?y7(n,u,t):void 0,k=x?[{test:x,value:1},{value:g.legend.unselectedOpacity}]:void 0,{format:F,formatType:V}=f,X=Rx(V)?Z4({fieldOrDatumDef:t,field:"datum.value",format:F,formatType:V,config:g}):void 0,te=Object.assign(Object.assign(Object.assign({},k?{opacity:k}:{}),X?{text:X}:{}),e);return Ts(te)?void 0:te},entries:function(e,{legendCmpt:t}){const n=t.get("selections");return n!=null&&n.length?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}};function g7(e){return v7(e,(t,n)=>Math.max(t,n.value))}function ZN(e){return v7(e,(t,n)=>kc(t,n.value))}function v7(e,t){return function(n){const o=n&&n.condition;return!!o&&(ao(o)||f1(o))}(e)?sc(e.condition).reduce(t,e.value):f1(e)?e.value:void 0}function y7(e,t,n){const o=t.get("selections");if(!(o!=null&&o.length))return;const u=Oa(n.field);return o.map(f=>`(!length(data(${Oa(bu(f)+Wx)})) || (${f}[${u}] && indexof(${f}[${u}], datum.value) >= 0))`).join(" || ")}const b7={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:o,formatType:u}=t;return r9(e,e.type,o,u,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:o}=e;return i9(o,t,n)},gradientLength:e=>{var t,n;const{legend:o,legendConfig:u}=e;return(n=(t=o.gradientLength)!==null&&t!==void 0?t:u.gradientLength)!==null&&n!==void 0?n:function({legendConfig:f,model:g,direction:x,orient:k,scaleType:F}){const{gradientHorizontalMaxLength:V,gradientHorizontalMinLength:X,gradientVerticalMaxLength:te,gradientVerticalMinLength:ue}=f;if(W0(F))return x==="horizontal"?k==="top"||k==="bottom"?x7(g,"width",X,V):X:x7(g,"height",ue,te)}(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var o,u;return(u=(o=e.labelOverlap)!==null&&o!==void 0?o:t.labelOverlap)!==null&&u!==void 0?u:function(f){if(fo(["quantile","threshold","log"],f))return"greedy"}(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:o})=>{var u;return(u=e.symbolType)!==null&&u!==void 0?u:function(f,g,x,k){var F;if(g!=="shape"){const V=(F=ZN(x))!==null&&F!==void 0?F:k;if(V)return V}switch(f){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(t.type,n,o.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>Px(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(Qw(n)&&W0(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>function(n,o){const u=n.values;if(ao(u))return _9(o,u);if(ko(u))return u}(t,e)};function Pie(e){const{legend:t}=e;return kc(t.type,function({channel:n,timeUnit:o,scaleType:u}){if(Qw(n)){if(fo(["quarter","month","day"],o))return"symbol";if(W0(u))return"gradient"}return"symbol"}(e))}function Lie({legendConfig:e,legendType:t,orient:n,legend:o}){var u,f;return(f=(u=o.direction)!==null&&u!==void 0?u:e[t?"gradientDirection":"symbolDirection"])!==null&&f!==void 0?f:function(g,x){switch(g){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return x==="gradient"?"horizontal":void 0}}(n,t)}function x7(e,t,n,o){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${o})`}}function w7(e){const t=Wu(e)?function(n){const{encoding:o}=n,u={};for(const f of[kp,...G9]){const g=Xc(o[f]);g&&n.getScaleComponent(f)&&(f===Ap&&_i(g)&&g.type===n2||(u[f]=jie(n,f)))}return u}(e):function(n){const{legends:o,resolve:u}=n.component;for(const f of n.children){w7(f);for(const g of fi(f.component.legends))u.legend[g]=QN(n.component.resolve,g),u.legend[g]==="shared"&&(o[g]=_7(o[g],f.component.legends[g]),o[g]||(u.legend[g]="independent",delete o[g]))}for(const f of fi(o))for(const g of n.children)g.component.legends[f]&&u.legend[f]==="shared"&&delete g.component.legends[f];return o}(e);return e.component.legends=t,t}function Bie(e,t,n,o){switch(t){case"disable":return n!==void 0;case"values":return!!(n!=null&&n.values);case"title":if(t==="title"&&e===(o==null?void 0:o.title))return!0}return e===(n||{})[t]}function jie(e,t){var n,o,u;let f=e.legend(t);const{markDef:g,encoding:x,config:k}=e,F=k.legend,V=new Rie({},function(ct,kt){const St=ct.scaleName(kt);if(ct.mark==="trail"){if(kt==="color")return{stroke:St};if(kt==="size")return{strokeWidth:St}}return kt==="color"?ct.markDef.filled?{fill:St}:{stroke:St}:{[kt]:St}}(e,t));(function(ct,kt,St){var yn;const Mn=(yn=ct.fieldDef(kt))===null||yn===void 0?void 0:yn.field;Vx(ct,_n=>{var $n,qn;const er=($n=_n.project.hasField[Mn])!==null&&$n!==void 0?$n:_n.project.hasChannel[kt];if(er&&kz.has(_n)){const rr=(qn=St.get("selections"))!==null&&qn!==void 0?qn:[];rr.push(_n.name),St.set("selections",rr,!1),er.hasLegend=!0}})})(e,t,V);const X=f!==void 0?!f:F.disable;if(V.set("disable",X,f!==void 0),X)return V;f=f||{};const te=e.getScaleComponent(t).get("type"),ue=Xc(x[t]),he=_i(ue)?(n=mh(ue.timeUnit))===null||n===void 0?void 0:n.unit:void 0,be=f.orient||k.legend.orient||"right",Pe=Pie({legend:f,channel:t,timeUnit:he,scaleType:te}),Ue={legend:f,channel:t,model:e,markDef:g,encoding:x,fieldOrDatumDef:ue,legendConfig:F,config:k,scaleType:te,orient:be,legendType:Pe,direction:Lie({legend:f,legendType:Pe,orient:be,legendConfig:F})};for(const ct of p7){const kt=ct in b7?b7[ct](Ue):f[ct];if(kt!==void 0){const St=Bie(kt,ct,f,e.fieldDef(t));(St||k.legend[ct]===void 0)&&V.set(ct,kt,St)}}const We=(o=f==null?void 0:f.encoding)!==null&&o!==void 0?o:{},at=V.get("selections"),st={},dt={fieldOrDatumDef:ue,model:e,channel:t,legendCmpt:V,legendType:Pe};for(const ct of["labels","legend","title","symbols","gradient","entries"]){const kt=h7((u=We[ct])!==null&&u!==void 0?u:{},e),St=ct in m7?m7[ct](kt,dt):kt;St===void 0||Ts(St)||(st[ct]=Object.assign(Object.assign(Object.assign({},at!=null&&at.length&&_i(ue)?{name:`${bu(ue.field)}_legend_${ct}`}:{}),at!=null&&at.length?{interactive:!!at}:{}),{update:St}))}return Ts(st)||V.set("encode",st,!!(f!=null&&f.encoding)),V}function _7(e,t){var n,o,u,f;if(!e)return t.clone();const g=e.getWithExplicit("orient"),x=t.getWithExplicit("orient");if(g.explicit&&x.explicit&&g.value!==x.value)return;let k=!1;for(const F of p7){const V=_b(e.getWithExplicit(F),t.getWithExplicit(F),F,"legend",(X,te)=>{switch(F){case"symbolType":return zie(X,te);case"title":return M9(X,te);case"type":return k=!0,V0("symbol")}return K3(X,te,F,"legend")});e.setWithExplicit(F,V)}return k&&(!((o=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||o===void 0)&&o.gradient&&A4(e.implicit,["encode","gradient"]),!((f=(u=e.explicit)===null||u===void 0?void 0:u.encode)===null||f===void 0)&&f.gradient&&A4(e.explicit,["encode","gradient"])),e}function zie(e,t){return t.value==="circle"?t:e}function E7(e,t,n,o){var u,f,g;e.encode=(u=e.encode)!==null&&u!==void 0?u:{},e.encode[t]=(f=e.encode[t])!==null&&f!==void 0?f:{},e.encode[t].update=(g=e.encode[t].update)!==null&&g!==void 0?g:{},e.encode[t].update[n]=o}function S7(e){const t=e.component.legends,n={};for(const o of fi(t)){const u=e.getScaleComponent(o),f=yu(u.get("domains"));if(n[f])for(const g of n[f])_7(g,t[o])||n[f].push(t[o]);else n[f]=[t[o].clone()]}return sb(n).flat().map(o=>function(u,f){var g,x,k;const F=u.combine(),{disable:V,labelExpr:X,selections:te}=F,ue=Qi(F,["disable","labelExpr","selections"]);if(!V){if(f.aria===!1&&ue.aria==null&&(ue.aria=!1),!((g=ue.encode)===null||g===void 0)&&g.symbols){const he=ue.encode.symbols.update;!he.fill||he.fill.value==="transparent"||he.stroke||ue.stroke||(he.stroke={value:"transparent"});for(const be of G9)ue[be]&&delete he[be]}if(ue.title||delete ue.title,X!==void 0){let he=X;!((k=(x=ue.encode)===null||x===void 0?void 0:x.labels)===null||k===void 0)&&k.update&&ko(ue.encode.labels.update.text)&&(he=Jw(X,"datum.label",ue.encode.labels.update.text.signal)),E7(ue,"labels","text",{signal:he})}for(const he in ue){const be=ue[he];if(ko(be)){const Pe=Pne[he];if(Pe){const{vgProp:Ue,part:We}=Pe;E7(ue,We,Ue,be),delete ue[he]}}}return ue}}(o,e.config)).filter(o=>o!==void 0)}function Uie(e){return h2(e)||lI(e)?function(t){return t.children.reduce((n,o)=>n.concat(o.assembleProjections()),C7(t))}(e):C7(e)}function C7(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:o}=n;if(t.data){const u={signal:`[${t.size.map(g=>g.signal).join(", ")}]`},f=t.data.reduce((g,x)=>{const k=ko(x)?x.signal:`data('${e.lookupDataSource(x)}')`;return fo(g,k)||g.push(k),g},[]);if(f.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:o,size:u,fit:{signal:f.length>1?`[${f.join(", ")}]`:f[0]}},n)]}return[Object.assign(Object.assign({name:o},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const Wie=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class k7 extends h1{constructor(t,n,o,u){super(Object.assign({},n),{name:t}),this.specifiedProjection=n,this.size=o,this.data=u,this.merged=!1}get isFit(){return!!this.data}}function A7(e){e.component.projection=Wu(e)?function(t){var n;if(t.hasProjection){const o=t.specifiedProjection,u=!(o&&(o.scale!=null||o.translate!=null)),f=u?[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]:void 0,g=u?function(x){const k=[],{encoding:F}=x;for(const V of[[sy,ay],[Pg,U0]])(Xc(F[V[0]])||Xc(F[V[1]]))&&k.push({signal:x.getName(`geojson_${k.length}`)});return x.channelHasField(Ap)&&x.typedFieldDef(Ap).type===n2&&k.push({signal:x.getName(`geojson_${k.length}`)}),k.length===0&&k.push(x.requestDataName(ed)),k}(t):void 0;return new k7(t.projectionName(!0),Object.assign(Object.assign({},(n=t.config.projection)!==null&&n!==void 0?n:{}),o??{}),f,g)}}(e):function(t){if(t.children.length===0)return;let n;for(const u of t.children)A7(u);const o=i8(t.children,u=>{const f=u.component.projection;if(f){if(n){const g=function(x,k){const F=i8(Wie,V=>!kx(x.explicit,V)&&!kx(k.explicit,V)||!(!kx(x.explicit,V)||!kx(k.explicit,V)||yu(x.get(V))!==yu(k.get(V))));if(yu(x.size)===yu(k.size)){if(F)return x;if(yu(x.explicit)===yu({}))return k;if(yu(k.explicit)===yu({}))return x}return null}(n,f);return g&&(n=g),!!g}return n=f,!0}return!0});if(n&&o){const u=t.projectionName(!0),f=new k7(u,n.specifiedProjection,n.size,na(n.data));for(const g of t.children){const x=g.component.projection;x&&(x.isFit&&f.data.push(...g.component.projection.data),g.renameProjection(x.get("name"),u),x.merged=!0)}return f}}(e)}function O7(e,t){return`${N8(e)}_${t}`}function eI(e,t,n){var o;const u=O7((o=U3(n,void 0))!==null&&o!==void 0?o:{},t);return e.getName(`${u}_bins`)}function T7(e,t,n){let o,u;o=function(F){return"as"in F}(e)?ta(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:[mi(e,{forAs:!0}),mi(e,{binSuffix:"end",forAs:!0})];const f=Object.assign({},U3(t,void 0)),g=O7(f,e.field),{signal:x,extentSignal:k}=function(F,V){return{signal:F.getName(`${V}_bins`),extentSignal:F.getName(`${V}_extent`)}}(n,g);if(D3(f.extent)){const F=f.extent,V=F.selection;u=Qz(n.getSelectionComponent(bu(V),V),F),delete f.extent}return{key:g,binComponent:Object.assign(Object.assign(Object.assign({bin:f,field:e.field,as:[o]},x?{signal:x}:{}),k?{extentSignal:k}:{}),u?{span:u}:{})}}class xy extends ys{constructor(t,n){super(t),this.bins=n}clone(){return new xy(null,na(this.bins))}static makeFromEncoding(t,n){const o=n.reduceFieldDef((u,f,g)=>{if(zm(f)&&Hs(f.bin)){const{key:x,binComponent:k}=T7(f,f.bin,n);u[x]=Object.assign(Object.assign(Object.assign({},k),u[x]),function(F,V,X,te){var ue,he;if(PE(V,X)){const be=Wu(F)&&(he=(ue=F.axis(X))!==null&&ue!==void 0?ue:F.legend(X))!==null&&he!==void 0?he:{},Pe=mi(V,{expr:"datum"}),Ue=mi(V,{expr:"datum",binSuffix:"end"});return{formulaAs:mi(V,{binSuffix:"range",forAs:!0}),formula:R3(Pe,Ue,be.format,be.formatType,te)}}return{}}(n,f,g,n.config))}return u},{});return Ts(o)?null:new xy(t,o)}static makeFromTransform(t,n,o){const{key:u,binComponent:f}=T7(n,n.bin,o);return new xy(t,{[u]:f})}merge(t,n){for(const o of fi(t.bins))o in this.bins?(n(t.bins[o].signal,this.bins[o].signal),this.bins[o].as=ab([...this.bins[o].as,...t.bins[o].as],Ra)):this.bins[o]=t.bins[o];for(const o of t.children)t.removeChild(o),o.parent=this;t.remove()}producedFields(){return new Set(sb(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(sb(this.bins).map(t=>t.field))}hash(){return`Bin ${Ra(this.bins)}`}assemble(){return sb(this.bins).flatMap(t=>{const n=[],[o,...u]=t.as,f=t.bin,{extent:g}=f,x=Qi(f,["extent"]),k=Object.assign(Object.assign(Object.assign({type:"bin",field:ub(t.field),as:o,signal:t.signal},D3(g)?{extent:null}:{extent:g}),t.span?{span:{signal:`span(${t.span})`}}:{}),x);!g&&t.extentSignal&&(n.push({type:"extent",field:ub(t.field),signal:t.extentSignal}),k.extent={signal:t.extentSignal}),n.push(k);for(const F of u)for(let V=0;V<2;V++)n.push({type:"formula",expr:mi({field:o[V]},{expr:"datum"}),as:F[V]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}class l2 extends ys{constructor(t){let n;if(super(null),Ux(t=t??{name:"source"})||(n=t.format?Object.assign({},r1(t.format,["parse"])):{}),Y3(t))this._data={values:t.values};else if(jE(t)){if(this._data={url:t.url},!n.type){let o=/(?:\.([^.]+))?$/.exec(t.url)[1];fo(["json","csv","tsv","dsv","topojson"],o)||(o="json"),n.type=o}}else dz(t)?this._data={values:[{type:"Sphere"}]}:(lz(t)||Ux(t))&&(this._data={});this._generator=Ux(t),t.name&&(this._name=t.name),n&&!Ts(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}function tI(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return console.error("Dataflow graph is inconsistent.",t,n),!1;if(!tI(t.children))return!1}return!0}class QE extends ys{constructor(t,n){super(t),this.params=n}clone(){return new QE(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${Ra(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class ZE extends ys{constructor(t,n){super(t),this.params=n}clone(){return new ZE(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([(t=this.params.as)!==null&&t!==void 0?t:"data"])}hash(){return`Hash ${Ra(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}function hA(e){return e instanceof l2||e instanceof QE||e instanceof ZE}class M7{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class v1 extends M7{constructor(){super(),this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:t,mutatedFlag:n}){t&&this.setContinue(),n&&this.setMutated()}reset(){}optimizeNextFromLeaves(t){if(hA(t))return!1;const n=t.parent,{continueFlag:o}=this.run(t);return o&&this.optimizeNextFromLeaves(n),this.mutatedFlag}}class nI extends M7{}function Vie(e,t,n,o){const u=Wu(o)?o.encoding[ly(t)]:void 0;if(zm(n)&&Wu(o)&&tN(t,n,u,o.stack,o.markDef,o.config))e.add(mi(n,{})),e.add(mi(n,{suffix:"end"})),n.bin&&PE(n,t)&&e.add(mi(n,{binSuffix:"range"}));else if(function(f){return f in F4}(t)){const f=function(g){switch(g){case ay:return"y";case U0:return"y2";case sy:return"x";case Pg:return"x2"}}(t);e.add(o.getName(f))}else e.add(mi(n));return e}class G0 extends ys{constructor(t,n,o){super(t),this.dimensions=n,this.measures=o}clone(){return new G0(null,new Set(this.dimensions),na(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let o=!1;n.forEachFieldDef(g=>{g.aggregate&&(o=!0)});const u={},f=new Set;return o?(n.forEachFieldDef((g,x)=>{var k,F,V,X;const{aggregate:te,field:ue}=g;if(te)if(te==="count")u["*"]=(k=u["*"])!==null&&k!==void 0?k:{},u["*"].count=new Set([mi(g,{forAs:!0})]);else{if(cb(te)||Tx(te)){const he=cb(te)?"argmin":"argmax",be=te[he];u[be]=(F=u[be])!==null&&F!==void 0?F:{},u[be][he]=new Set([mi({op:he,field:be},{forAs:!0})])}else u[ue]=(V=u[ue])!==null&&V!==void 0?V:{},u[ue][te]=new Set([mi(g,{forAs:!0})]);gb(x)&&n.scaleDomain(x)==="unaggregated"&&(u[ue]=(X=u[ue])!==null&&X!==void 0?X:{},u[ue].min=new Set([mi({field:ue,aggregate:"min"},{forAs:!0})]),u[ue].max=new Set([mi({field:ue,aggregate:"max"},{forAs:!0})]))}else Vie(f,x,g,n)}),f.size+fi(u).length===0?null:new G0(t,f,u)):null}static makeFromTransform(t,n){var o,u,f;const g=new Set,x={};for(const k of n.aggregate){const{op:F,field:V,as:X}=k;F&&(F==="count"?(x["*"]=(o=x["*"])!==null&&o!==void 0?o:{},x["*"].count=new Set([X||mi(k,{forAs:!0})])):(x[V]=(u=x[V])!==null&&u!==void 0?u:{},x[V][F]=new Set([X||mi(k,{forAs:!0})])))}for(const k of(f=n.groupby)!==null&&f!==void 0?f:[])g.add(k);return g.size+fi(x).length===0?null:new G0(t,g,x)}merge(t){return function(n,o){if(n.size!==o.size)return!1;for(const u of n)if(!o.has(u))return!1;return!0}(this.dimensions,t.dimensions)?(function(n,o){var u;for(const f of fi(o)){const g=o[f];for(const x of fi(g))f in n?n[f][x]=new Set([...(u=n[f][x])!==null&&u!==void 0?u:[],...g[x]]):n[f]={[x]:g[x]}}}(this.measures,t.measures),!0):(function(...n){N3.debug(...n)}("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...fi(this.measures)])}producedFields(){const t=new Set;for(const n of fi(this.measures))for(const o of fi(this.measures[n])){const u=this.measures[n][o];u.size===0?t.add(`${o}_${n}`):u.forEach(t.add,t)}return t}hash(){return`Aggregate ${Ra({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],n=[],o=[];for(const u of fi(this.measures))for(const f of fi(this.measures[u]))for(const g of this.measures[u][f])o.push(g),t.push(f),n.push(u==="*"?null:ub(u));return{type:"aggregate",groupby:[...this.dimensions].map(ub),ops:t,fields:n,as:o}}}class f2 extends ys{constructor(t,n,o,u){super(t),this.model=n,this.name=o,this.data=u;for(const f of Lg){const g=n.facet[f];if(g){const{bin:x,sort:k}=g;this[f]=Object.assign({name:n.getName(`${f}_domain`),fields:[mi(g),...Hs(x)?[mi(g,{binSuffix:"end"})]:[]]},py(k)?{sortField:k}:ao(k)?{sortIndexField:u2(g,f)}:{})}}this.childModel=n.child}hash(){let t="Facet";for(const n of Lg)this[n]&&(t+=` ${n.charAt(0)}:${Ra(this[n])}`);return t}get fields(){var t;const n=[];for(const o of Lg)!((t=this[o])===null||t===void 0)&&t.fields&&n.push(...this[o].fields);return n}dependentFields(){const t=new Set(this.fields);for(const n of Lg)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of Bg){const o=this.childModel.component.scales[n];if(o&&!o.merged){const u=o.get("type"),f=o.get("range");if(Op(u)&&vb(f)){const g=uI(mA(this.childModel,n));g?t[n]=g:ci(`Unknown field for ${n}. Cannot calculate view size.`)}}}return t}assembleRowColumnHeaderData(t,n,o){const u={row:"y",column:"x"}[t],f=[],g=[],x=[];o&&o[u]&&(n?(f.push(`distinct_${o[u]}`),g.push("max")):(f.push(o[u]),g.push("distinct")),x.push(`distinct_${o[u]}`));const{sortField:k,sortIndexField:F}=this[t];if(k){const{op:V=P3,field:X}=k;f.push(X),g.push(V),x.push(mi(k,{forAs:!0}))}else F&&(f.push(F),g.push("max"),x.push(F));return{name:this[t].name,source:n??this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},f.length?{fields:f,ops:g,as:x}:{})]}}assembleFacetHeaderData(t){var n,o;const{columns:u}=this.model.layout,{layoutHeaders:f}=this.model.component,g=[],x={};for(const V of XN){for(const X of KN){const te=(n=f[V]&&f[V][X])!==null&&n!==void 0?n:[];for(const ue of te)if(((o=ue.axes)===null||o===void 0?void 0:o.length)>0){x[V]=!0;break}}if(x[V]){const X=`length(data("${this.facet.name}"))`,te=V==="row"?u?{signal:`ceil(${X} / ${u})`}:1:u?{signal:`min(${X}, ${u})`}:{signal:X};g.push({name:`${this.facet.name}_${V}`,transform:[{type:"sequence",start:0,stop:te}]})}}const{row:k,column:F}=x;return(k||F)&&g.unshift(this.assembleRowColumnHeaderData("facet",null,t)),g}assemble(){var t,n;const o=[];let u=null;const f=this.getChildIndependentFieldsWithStep(),{column:g,row:x,facet:k}=this;if(g&&x&&(f.x||f.y)){u=`cross_${this.column.name}_${this.row.name}`;const F=[].concat((t=f.x)!==null&&t!==void 0?t:[],(n=f.y)!==null&&n!==void 0?n:[]),V=F.map(()=>"distinct");o.push({name:u,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:F,ops:V}]})}for(const F of[a1,o1])this[F]&&o.push(this.assembleRowColumnHeaderData(F,u,f));if(k){const F=this.assembleFacetHeaderData(f);F&&o.push(...F)}return o}}function D7(e){return e[0]==="'"&&e[e.length-1]==="'"||e[0]==='"'&&e[e.length-1]==='"'?e.slice(1,-1):e}function Hie(e){const t={};return function n(o,u){if(k4(o))n(o.not,u);else if(C4(o))for(const f of o.and)n(f,u);else if(S4(o))for(const f of o.or)n(f,u);else u(o)}(e.filter,n=>{var o;if(H8(n)){let u=null;V4(n)?u=n.equal:H4(n)?u=n.range[0]:G4(n)&&(u=((o=n.oneOf)!==null&&o!==void 0?o:n.in)[0]),u&&(Zw(u)?t[n.field]="date":Cc(u)?t[n.field]="number":ta(u)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function Gie(e){const t={};function n(o){W3(o)?t[o.field]="date":o.type==="quantitative"&&function(u){return ta(u)&&fo(["min","max"],u)}(o.aggregate)?t[o.field]="number":AE(o.field)>1?o.field in t||(t[o.field]="flatten"):oN(o)&&py(o.sort)&&AE(o.sort.field)>1&&(o.sort.field in t||(t[o.sort.field]="flatten"))}if((Wu(e)||$0(e))&&e.forEachFieldDef((o,u)=>{if(zm(o))n(o);else{const f=Nx(u),g=e.fieldDef(f);n(Object.assign(Object.assign({},o),{type:g.type}))}}),Wu(e)){const{mark:o,markDef:u,encoding:f}=e;if(Ox(o)&&!e.encoding.order){const g=f[u.orient==="horizontal"?"y":"x"];!_i(g)||g.type!=="quantitative"||g.field in t||(t[g.field]="number")}}return t}class od extends ys{constructor(t,n){super(t),this._parse=n}clone(){return new od(null,na(this._parse))}hash(){return`Parse ${Ra(this._parse)}`}static makeExplicit(t,n,o){let u={};const f=n.data;return!Ux(f)&&f&&f.format&&f.format.parse&&(u=f.format.parse),this.makeWithAncestors(t,u,{},o)}static makeWithAncestors(t,n,o,u){for(const x of fi(o)){const k=u.getWithExplicit(x);k.value!==void 0&&(k.explicit||k.value===o[x]||k.value==="derived"||o[x]==="flatten"?delete o[x]:ci(ae.differentParse(x,o[x],k.value)))}for(const x of fi(n)){const k=u.get(x);k!==void 0&&(k===n[x]?delete n[x]:ci(ae.differentParse(x,n[x],k)))}const f=new h1(n,o);u.copyAll(f);const g={};for(const x of fi(f.combine())){const k=f.get(x);k!==null&&(g[x]=k)}return fi(g).length===0||u.parseNothing?null:new od(t,g)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse),t.remove()}assembleFormatParse(){const t={};for(const n of fi(this._parse)){const o=this._parse[n];AE(n)===1&&(t[n]=o)}return t}producedFields(){return new Set(fi(this._parse))}dependentFields(){return new Set(fi(this._parse))}assembleTransforms(t=!1){return fi(this._parse).filter(n=>!t||AE(n)>1).map(n=>{const o=function(u,f){const g=c8(u);return f==="number"?`toNumber(${g})`:f==="boolean"?`toBoolean(${g})`:f==="string"?`toString(${g})`:f==="date"?`toDate(${g})`:f==="flatten"?g:f.indexOf("date:")===0?`timeParse(${g},'${D7(f.slice(5,f.length))}')`:f.indexOf("utc:")===0?`utcParse(${g},'${D7(f.slice(4,f.length))}')`:(ci(ae.unrecognizedParse(f)),null)}(n,this._parse[n]);return o?{type:"formula",expr:o,as:l8(n)}:null}).filter(n=>n!==null)}}class kb extends ys{clone(){return new kb(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([r2])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:r2}}}class $x extends ys{constructor(t,n){super(t),this.transform=n}clone(){return new $x(null,na(this.transform))}addDimensions(t){this.transform.groupby=ab(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:mi(t)}hash(){return`JoinAggregateTransform ${Ra(this.transform)}`}assemble(){const t=[],n=[],o=[];for(const f of this.transform.joinaggregate)n.push(f.op),o.push(this.getDefaultName(f)),t.push(f.field===void 0?null:f.field);const u=this.transform.groupby;return Object.assign({type:"joinaggregate",as:o,ops:n,fields:t},u!==void 0?{groupby:u}:{})}}class y1 extends ys{constructor(t,n){super(t),this._stack=n}clone(){return new y1(null,na(this._stack))}static makeFromTransform(t,n){const{stack:o,groupby:u,as:f,offset:g="zero"}=n,x=[],k=[];if(n.sort!==void 0)for(const X of n.sort)x.push(X.field),k.push(kc(X.order,"ascending"));const F={field:x,order:k};let V;return V=function(X){return ao(X)&&X.every(te=>ta(te))&&X.length>1}(f)?f:ta(f)?[f,f+"_end"]:[n.stack+"_start",n.stack+"_end"],new y1(t,{stackField:o,groupby:u,offset:g,sort:F,facetby:[],as:V})}static makeFromEncoding(t,n){const o=n.stack,{encoding:u}=n;if(!o)return null;const{groupbyChannel:f,fieldChannel:g,offset:x,impute:k}=o;let F;f&&(F=gy(u[f]));const V=function(ue){return ue.stack.stackBy.reduce((he,be)=>{const Pe=mi(be.fieldDef);return Pe&&he.push(Pe),he},[])}(n),X=n.encoding.order;let te;return te=ao(X)||_i(X)?A9(X):V.reduce((ue,he)=>(ue.field.push(he),ue.order.push(g==="y"?"descending":"ascending"),ue),{field:[],order:[]}),new y1(t,{dimensionFieldDef:F,stackField:n.vgField(g),facetby:[],stackby:V,sort:te,offset:x,impute:k,as:[n.vgField(g,{suffix:"start",forAs:!0}),n.vgField(g,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${Ra(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:t,impute:n,groupby:o}=this._stack;return t?t.bin?n?[mi(t,{binSuffix:"mid"})]:[mi(t,{}),mi(t,{binSuffix:"end"})]:[mi(t)]:o??[]}assemble(){const t=[],{facetby:n,dimensionFieldDef:o,stackField:u,stackby:f,sort:g,offset:x,impute:k,as:F}=this._stack;if(k&&o){const{band:V=.5,bin:X}=o;X&&t.push({type:"formula",expr:`${V}*`+mi(o,{expr:"datum"})+`+${1-V}*`+mi(o,{expr:"datum",binSuffix:"end"}),as:mi(o,{binSuffix:"mid",forAs:!0})}),t.push({type:"impute",field:u,groupby:[...f,...n],key:mi(o,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:u,sort:g,as:F,offset:x}),t}}class d2 extends ys{constructor(t,n){super(t),this.transform=n}clone(){return new d2(null,na(this.transform))}addDimensions(t){this.transform.groupby=ab(this.transform.groupby.concat(t),n=>n)}dependentFields(){var t,n;const o=new Set;return((t=this.transform.groupby)!==null&&t!==void 0?t:[]).forEach(o.add,o),((n=this.transform.sort)!==null&&n!==void 0?n:[]).forEach(u=>o.add(u.field)),this.transform.window.map(u=>u.field).filter(u=>u!==void 0).forEach(o.add,o),o}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:mi(t)}hash(){return`WindowTransform ${Ra(this.transform)}`}assemble(){var t;const n=[],o=[],u=[],f=[];for(const te of this.transform.window)o.push(te.op),u.push(this.getDefaultName(te)),f.push(te.param===void 0?null:te.param),n.push(te.field===void 0?null:te.field);const g=this.transform.frame,x=this.transform.groupby;if(g&&g[0]===null&&g[1]===null&&o.every(te=>I4(te)))return Object.assign({type:"joinaggregate",as:u,ops:o,fields:n},x!==void 0?{groupby:x}:{});const k=[],F=[];if(this.transform.sort!==void 0)for(const te of this.transform.sort)k.push(te.field),F.push((t=te.order)!==null&&t!==void 0?t:"ascending");const V={field:k,order:F},X=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:f,as:u,ops:o,fields:n,sort:V},X!==void 0?{ignorePeers:X}:{}),x!==void 0?{groupby:x}:{}),g!==void 0?{frame:g}:{})}}class qie extends v1{run(t){const n=t.parent;if(t instanceof od){if(hA(n))return this.flags;if(n.numChildren()>1)return this.setContinue(),this.flags;if(n instanceof od)this.setMutated(),n.merge(t);else{if(s8(n.producedFields(),t.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),t.swapWithParent()}}return this.setContinue(),this.flags}}class $ie extends nI{mergeNodes(t,n){const o=n.shift();for(const u of n)t.removeChild(u),u.parent=o,u.remove()}run(t){const n=t.children.map(u=>u.hash()),o={};for(let u=0;u<n.length;u++)o[n[u]]===void 0?o[n[u]]=[t.children[u]]:o[n[u]].push(t.children[u]);for(const u of fi(o))o[u].length>1&&(this.setMutated(),this.mergeNodes(t,o[u]));for(const u of t.children)this.run(u);return this.mutatedFlag}}class Xie extends v1{run(t){return t instanceof gh||t.numChildren()>0||t instanceof f2?this.flags:(this.setMutated(),t.remove(),this.flags)}}class Kie extends v1{constructor(){super(...arguments),this.fields=new Set,this.prev=null}run(t){if(this.setContinue(),t instanceof yy){const n=t.producedFields();o8(n,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...n]),this.prev=t}return this.flags}reset(){this.fields.clear()}}class Yie extends v1{run(t){this.setContinue();const n=t.parent.children.filter(u=>u instanceof yy),o=n.pop();for(const u of n)this.setMutated(),o.merge(u);return this.flags}}function rI(e){if(e instanceof f2)if(e.numChildren()!==1||e.children[0]instanceof gh){const t=e.model.component.data.main;(function u(f){if(f instanceof gh&&f.type===ed&&f.numChildren()===1){const g=f.children[0];g instanceof f2||(g.swapWithParent(),u(f))}})(t);const n=function(u){return function f(g){if(!(g instanceof f2)){const x=g.clone();if(x instanceof gh){const k=iI+x.getSource();x.setSource(k),u.model.component.data.outputNodes[k]=x}else(x instanceof G0||x instanceof y1||x instanceof d2||x instanceof $x)&&x.addDimensions(u.fields);for(const k of g.children.flatMap(f))k.parent=x;return[x]}return g.children.flatMap(f)}}(e),o=e.children.map(n).flat();for(const u of o)u.parent=t}else{const t=e.children[0];(t instanceof G0||t instanceof y1||t instanceof d2||t instanceof $x)&&t.addDimensions(e.fields),t.swapWithParent(),rI(e)}else e.children.map(rI)}class Jie extends nI{constructor(){super()}run(t){t instanceof gh&&!t.isRequired()&&(this.setMutated(),t.remove());for(const n of t.children)this.run(n);return this.mutatedFlag}}class Qie extends nI{constructor(t){super(),this.requiresSelectionId=t&&RN(t)}run(t){t instanceof kb&&(this.requiresSelectionId&&(hA(t.parent)||t.parent instanceof G0||t.parent instanceof od)||(this.setMutated(),t.remove()));for(const n of t.children)this.run(n);return this.mutatedFlag}}class Zie extends v1{run(t){const n=t.parent,o=[...n.children],u=n.children.filter(f=>f instanceof od);if(n.numChildren()>1&&u.length>=1){const f={},g=new Set;for(const x of u){const k=x.parse;for(const F of fi(k))F in f?f[F]!==k[F]&&g.add(F):f[F]=k[F]}for(const x of g)delete f[x];if(!Ts(f)){this.setMutated();const x=new od(n,f);for(const k of o){if(k instanceof od)for(const F of fi(f))delete k.parse[F];n.removeChild(k),k.parent=x,k instanceof od&&fi(k.parse).length===0&&k.remove()}}}return this.setContinue(),this.flags}}class eoe extends v1{run(t){const n=t.parent,o=n.children.filter(f=>f instanceof G0),u={};for(const f of o){const g=Ra(f.groupBy);g in u||(u[g]=[]),u[g].push(f)}for(const f of fi(u)){const g=u[f];if(g.length>1){const x=g.pop();for(const k of g)x.merge(k)&&(n.removeChild(k),k.parent=x,k.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class toe extends v1{constructor(t){super(),this.model=t}run(t){const n=t.parent,o=!(hA(n)||n instanceof a2||n instanceof od||n instanceof kb),u=[],f=[];for(const g of n.children)g instanceof xy&&(o&&!s8(n.producedFields(),g.dependentFields())?u.push(g):f.push(g));if(u.length>0){const g=u.pop();for(const x of u)g.merge(x,this.model.renameSignal.bind(this.model));this.setMutated(),n instanceof xy?n.merge(g,this.model.renameSignal.bind(this.model)):g.swapWithParent()}if(f.length>1){const g=f.pop();for(const x of f)g.merge(x,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class noe extends v1{run(t){const n=t.parent,o=[...n.children];if(!CE(o,g=>g instanceof gh)||n.numChildren()<=1)return this.setContinue(),this.flags;const u=[];let f;for(const g of o)if(g instanceof gh){let x=g;for(;x.numChildren()===1;){const k=x.children[0];if(!(k instanceof gh))break;x=k}u.push(...x.children),f?(n.removeChild(g),g.parent=f.parent,f.parent.removeChild(f),f.parent=x,this.setMutated()):f=x}else u.push(g);if(u.length){this.setMutated();for(const g of u)g.parent.removeChild(g),g.parent=f}return this.setContinue(),this.flags}}const iI="scale_",pA=5;function Ab(e){const t=[];function n(o){if(o.numChildren()===0)t.push(o);else for(const u of o.children)n(u)}for(const o of e)n(o);return t}function roe(e){return e}function q0(e,t){return t.map(n=>{if(e instanceof v1){const o=e.optimizeNextFromLeaves(n);return e.reset(),o}return e.run(n)}).some(roe)}function N7(e,t){let n=e.sources;const o=new Set;return o.add(q0(new Jie,n)),o.add(q0(new Qie(t),n)),n=n.filter(u=>u.numChildren()>0),o.add(q0(new Xie,Ab(n))),n=n.filter(u=>u.numChildren()>0),o.add(q0(new qie,Ab(n))),o.add(q0(new toe(t),Ab(n))),o.add(q0(new Kie,Ab(n))),o.add(q0(new Zie,Ab(n))),o.add(q0(new eoe,Ab(n))),o.add(q0(new Yie,Ab(n))),o.add(q0(new $ie,n)),o.add(q0(new noe,Ab(n))),e.sources=n,o.has(!0)}class Um{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new Um(()=>t(n))}}function I7(e){Wu(e)?function(t){const n=t.component.scales;for(const o of fi(n)){const u=ioe(t,o);if(n[o].setWithExplicit("domains",u),ooe(t,o),t.component.data.isFaceted){let g=t;for(;!$0(g)&&g.parent;)g=g.parent;if(g.component.resolve.scale[o]==="shared")for(const k of u.value)yb(k)&&(k.data=iI+k.data.replace(iI,""))}}}(e):function(t){for(const o of t.children)I7(o);const n=t.component.scales;for(const o of fi(n)){let u,f=null;for(const g of t.children){const x=g.component.scales[o];if(x){u=u===void 0?x.getWithExplicit("domains"):_b(u,x.getWithExplicit("domains"),"domains","scale",sI);const k=x.get("selectionExtent");f&&k&&f.selection!==k.selection&&ci("The same selection must be used to override scale domains in a layered view."),f=k}}n[o].setWithExplicit("domains",u),f&&n[o].set("selectionExtent",f,!0)}}(e)}function ioe(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:o}=e,u=function(f,g,x,k){if(f==="unaggregated"){const{valid:F,reason:V}=F7(g,x);if(!F)return void ci(V)}else if(f===void 0&&k.useUnaggregatedDomain){const{valid:F}=F7(g,x);if(F)return"unaggregated"}return f}(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return u!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:u})),t==="x"&&Xc(o.x2)?Xc(o.x)?_b(Ob(n,u,e,"x"),Ob(n,u,e,"x2"),"domain","scale",sI):Ob(n,u,e,"x2"):t==="y"&&Xc(o.y2)?Xc(o.y)?_b(Ob(n,u,e,"y"),Ob(n,u,e,"y2"),"domain","scale",sI):Ob(n,u,e,"y2"):Ob(n,u,e,t)}function oI(e,t,n){var o;const u=(o=mh(n))===null||o===void 0?void 0:o.unit;return t==="temporal"||u?function(f,g,x){return f.map(k=>({signal:`{data: ${cN(k,{timeUnit:x,type:g})}}`}))}(e,t,u):[e]}function Ob(e,t,n,o){const{encoding:u}=n,f=Xc(u[o]),{type:g}=f,x=f.timeUnit;if(function(X){return X&&X.unionWith}(t)){const X=Ob(e,void 0,n,o),te=oI(t.unionWith,g,x);return zx([...X.value,...te])}if(ko(t))return zx([t]);if(t&&t!=="unaggregated"&&!X8(t))return zx(oI(t,g,x));const k=n.stack;if(k&&o===k.fieldChannel){if(k.offset==="normalize")return V0([[0,1]]);const X=n.requestDataName(ed);return V0([{data:X,field:n.vgField(o,{suffix:"start"})},{data:X,field:n.vgField(o,{suffix:"end"})}])}const F=gb(o)&&_i(f)?function(X,te,ue){if(!Op(ue))return;const he=X.fieldDef(te),be=he.sort;if(l9(be))return{op:"min",field:u2(he,te),order:"ascending"};const{stack:Pe}=X,Ue=Pe?[...Pe.groupbyField?[Pe.groupbyField]:[],...Pe.stackBy.map(We=>We.fieldDef.field)]:void 0;if(py(be)){const We=Pe&&!fo(Ue,be.field);return aI(be,We)}if(c9(be)){const{encoding:We,order:at}=be,st=X.fieldDef(We),{aggregate:dt,field:ct}=st,kt=Pe&&!fo(Ue,ct);if(cb(dt)||Tx(dt))return aI({field:mi(st),order:at},kt);if(I4(dt)||!dt)return aI({op:dt,field:ct,order:at},kt)}else{if(be==="descending")return{op:"min",field:X.vgField(te),order:"descending"};if(fo(["ascending",void 0],be))return!0}}(n,o,e):void 0;if(xb(f))return V0(oI([f.datum],g,x));const V=f;if(t==="unaggregated"){const X=n.requestDataName(ed),{field:te}=f;return V0([{data:X,field:mi({field:te,aggregate:"min"})},{data:X,field:mi({field:te,aggregate:"max"})}])}if(Hs(V.bin)){if(Op(e))return V0(e==="bin-ordinal"?[]:[{data:p3(F)?n.requestDataName(ed):n.requestDataName(J3),field:n.vgField(o,PE(V,o)?{binSuffix:"range"}:{}),sort:F!==!0&&_l(F)?F:{field:n.vgField(o,{}),op:"min"}}]);{const{bin:X}=V;if(Hs(X)){const te=eI(n,V.field,X);return V0([new Um(()=>{const ue=n.getSignalName(te);return`[${ue}.start, ${ue}.stop]`})])}return V0([{data:n.requestDataName(ed),field:n.vgField(o,{})}])}}if(V.timeUnit&&fo(["time","utc"],e)&&tN(o,V,Wu(n)?n.encoding[ly(o)]:void 0,n.stack,n.markDef,n.config)){const X=n.requestDataName(ed);return V0([{data:X,field:n.vgField(o)},{data:X,field:n.vgField(o,{suffix:"end"})}])}return V0(F?[{data:p3(F)?n.requestDataName(ed):n.requestDataName(J3),field:n.vgField(o),sort:F}]:[{data:n.requestDataName(ed),field:n.vgField(o)}])}function aI(e,t){const{op:n,field:o,order:u}=e;return Object.assign(Object.assign({op:n??(t?"sum":P3)},o?{field:ub(o)}:{}),u?{order:u}:{})}function ooe(e,t){var n;const o=e.component.scales[t],u=e.specifiedScales[t].domain,f=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin,g=X8(u)&&u,x=DE(f)&&D3(f.extent)&&f.extent;(g||x)&&o.set("selectionExtent",g??x,!0)}function F7(e,t){const{aggregate:n,type:o}=e;return n?ta(n)&&!Dee[n]?{valid:!1,reason:ae.unaggregateDomainWithNonSharedDomainOp(n)}:o==="quantitative"&&t==="log"?{valid:!1,reason:ae.unaggregatedDomainWithLogScale(e)}:{valid:!0}:{valid:!1,reason:ae.unaggregateDomainHasNoEffectForRawField(e)}}function sI(e,t,n,o){return e.explicit&&t.explicit&&ci(ae.mergeConflictingDomainProperty(n,o,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function uI(e){if(yb(e)&&ta(e.field))return e.field;if(function(t){return!ao(t)&&"fields"in t&&!("data"in t)}(e)){let t;for(const n of e.fields)if(yb(n)&&ta(n.field))if(t){if(t!==n.field)return ci(ae.FACETED_INDEPENDENT_DIFFERENT_SOURCES),t}else t=n.field;return ci(ae.FACETED_INDEPENDENT_SAME_FIELDS_DIFFERENT_SOURCES),t}if(function(t){return!ao(t)&&"fields"in t&&"data"in t}(e)){ci(ae.FACETED_INDEPENDENT_SAME_SOURCE);const t=e.fields[0];return ta(t)?t:void 0}}function mA(e,t){return function(n){const o=ab(n.map(k=>yb(k)?Qi(k,["sort"]):k),Ra),u=ab(n.map(k=>{if(yb(k)){const F=k.sort;return F===void 0||p3(F)||("op"in F&&F.op==="count"&&delete F.field,F.order==="ascending"&&delete F.order),F}}).filter(k=>k!==void 0),Ra);if(o.length===0)return;if(o.length===1){const k=n[0];if(yb(k)&&u.length>0){let F=u[0];if(u.length>1)ci(ae.MORE_THAN_ONE_SORT),F=!0;else if(_l(F)&&"field"in F){const V=F.field;k.field===V&&(F=!F.order||{order:F.order})}return Object.assign(Object.assign({},k),{sort:F})}return k}const f=ab(u.map(k=>p3(k)||!("op"in k)||k.op in Oee?k:(ci(ae.domainSortDropped(k)),!0)),Ra);let g;f.length===1?g=f[0]:f.length>1&&(ci(ae.MORE_THAN_ONE_SORT),g=!0);const x=ab(n.map(k=>yb(k)?k.data:null),k=>k);return x.length===1&&x[0]!==null?Object.assign({data:x[0],fields:o.map(k=>k.field)},g?{sort:g}:{}):Object.assign({fields:o},g?{sort:g}:{})}(e.component.scales[t].get("domains").map(n=>(yb(n)&&(n.data=e.lookupDataSource(n.data)),n)))}function R7(e){return fi(e.component.scales).reduce((t,n)=>{const o=e.component.scales[n];if(o.merged)return t;const u=o.combine(),{name:f,type:g,selectionExtent:x,domains:k,range:F,reverse:V}=u,X=Qi(u,["name","type","selectionExtent","domains","range","reverse"]),te=function(be,Pe,Ue){return dy(Ue)&&vb(be)?{step:{signal:Pe+"_step"}}:be}(u.range,f,n);let ue;x&&(ue=function(be,Pe){const Ue=Pe.selection;return{signal:Qz(be.getSelectionComponent(Ue,bu(Ue)),Pe)}}(e,x));const he=mA(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:f,type:g},he?{domain:he}:{}),ue?{domainRaw:ue}:{}),{range:te}),V!==void 0?{reverse:V}:{}),X)),t},[])}class P7 extends h1{constructor(t,n){super({},{name:t}),this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1||CE(this.get("domains"),t=>ao(t)&&t.length===2&&t[0]<=0&&t[1]>=0)}}const aoe=["range","scheme"];function L7(e){return e==="x"?"width":e==="y"?"height":void 0}function B7(e,t){const n=e.fieldDef(t);if(n&&n.bin&&Hs(n.bin)){const o=eI(e,n.field,n.bin),u=L7(t),f=e.getName(u);return new Um(()=>{const g=e.getSignalName(o),x=`(${g}.stop - ${g}.start) / ${g}.step`;return`${e.getSignalName(f)} / (${x})`})}}function soe(e,t){const n=t.specifiedScales[e],{size:o}=t,u=t.getScaleComponent(e).get("type");for(const f of aoe)if(n[f]!==void 0){const g=K8(u,f),x=Y8(e,f);if(g)if(x)ci(x);else switch(f){case"range":return ao(n.range)&&dy(e)?zx(n.range.map(k=>{if(k==="width"||k==="height"){const F=t.getName(k),V=t.getSignalName.bind(t);return Um.fromName(V,F)}return k})):zx(n.range);case"scheme":return zx(uoe(n[f]))}else ci(ae.scalePropertyNotWorkWithScaleType(u,f,e))}if(e===Tu||e===$c){const f=e===Tu?"width":"height",g=o[f];if(vy(g)){if(Op(u))return zx({step:g.step});ci(ae.stepDropped(f))}}return V0(function(f,g){const{size:x,config:k,mark:F,encoding:V}=g,X=g.getSignalName.bind(g),{type:te}=Xc(V[f]),ue=g.getScaleComponent(f).get("type"),{domain:he,domainMid:be}=g.specifiedScales[f];switch(f){case Tu:case $c:{if(fo(["point","band"],ue))if(f!==Tu||x.width){if(f===$c&&!x.height){const We=BE(k.view,"height");if(vy(We))return We}}else{const We=BE(k.view,"width");if(vy(We))return We}const Pe=L7(f),Ue=g.getName(Pe);return f===$c&&jg(ue)?[Um.fromName(X,Ue),0]:[0,Um.fromName(X,Ue)]}case c1:{const Pe=g.component.scales[f].get("zero"),Ue=function at(st,dt,ct){if(dt)return ko(dt)?{signal:`${dt.signal} ? 0 : ${at(st,!1,ct)}`}:0;switch(st){case"bar":case"tick":return ct.scale.minBandSize;case"line":case"trail":case"rule":return ct.scale.minStrokeWidth;case"text":return ct.scale.minFontSize;case"point":case"square":case"circle":return ct.scale.minSize}throw new Error(ae.incompatibleChannel("size",st))}(F,Pe,k),We=function(at,st,dt,ct){const kt={x:B7(dt,"x"),y:B7(dt,"y")};switch(at){case"bar":case"tick":{if(ct.scale.maxBandSize!==void 0)return ct.scale.maxBandSize;const St=z7(st,kt,ct.view);return Cc(St)?St-1:new Um(()=>`${St.signal} - 1`)}case"line":case"trail":case"rule":return ct.scale.maxStrokeWidth;case"text":return ct.scale.maxFontSize;case"point":case"square":case"circle":{if(ct.scale.maxSize)return ct.scale.maxSize;const St=z7(st,kt,ct.view);return Cc(St)?Math.pow(j7*St,2):new Um(()=>`pow(${j7} * ${St.signal}, 2)`)}}throw new Error(ae.incompatibleChannel("size",at))}(F,x,g,k);return I3(ue)?function(at,st,dt){const ct=()=>{const kt=LE(st),St=LE(at),yn=`(${kt} - ${St}) / (${dt} - 1)`;return`sequence(${St}, ${kt} + ${yn}, ${yn})`};return ko(st)?new Um(ct):{signal:ct()}}(Ue,We,function(at,st,dt,ct){switch(at){case"quantile":return st.scale.quantileCount;case"quantize":return st.scale.quantizeCount;case"threshold":return dt!==void 0&&ao(dt)?dt.length+1:(ci(ae.domainRequiredForThresholdScale(ct)),3)}}(ue,k,he,f)):[Ue,We]}case z0:return[0,2*Math.PI];case Mx:return[0,360];case oy:return[0,new Um(()=>{const Pe=g.getSignalName("width"),Ue=g.getSignalName("height");return`min(${Pe},${Ue})/2`})];case db:return[k.scale.minStrokeWidth,k.scale.maxStrokeWidth];case hb:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case Ap:return"symbol";case kp:case uy:case cy:return ue==="ordinal"?te==="nominal"?"category":"ordinal":be!==void 0?"diverging":F==="rect"||F==="geoshape"?"heatmap":"ramp";case l1:case lb:case fb:return[k.scale.minOpacity,k.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${f}`)}(e,t))}function uoe(e){return function(t){return!ta(t)&&!!t.name}(e)?Object.assign({scheme:e.name},r1(e,["name"])):{scheme:e}}const j7=.95;function z7(e,t,n){const o=vy(e.width)?e.width.step:$3(n,"width"),u=vy(e.height)?e.height.step:$3(n,"height");return t.x||t.y?new Um(()=>`min(${[t.x?t.x.signal:o,t.y?t.y.signal:u].join(", ")})`):Math.min(o,u)}function U7(e,t){Wu(e)?function(n,o){const u=n.component.scales,{config:f,encoding:g,markDef:x,specifiedScales:k}=n;for(const F of fi(u)){const V=k[F],X=u[F],te=n.getScaleComponent(F),ue=Xc(g[F]),he=V[o],be=te.get("type"),Pe=te.get("padding"),Ue=te.get("paddingInner"),We=K8(be,o),at=Y8(F,o);if(he!==void 0&&(We?at&&ci(at):ci(ae.scalePropertyNotWorkWithScaleType(be,o,F))),We&&at===void 0)if(he!==void 0)X.copyKeyFromObject(o,V);else{const st=o in W7?W7[o]({model:n,channel:F,fieldOrDatumDef:ue,scaleType:be,scalePadding:Pe,scalePaddingInner:Ue,domain:V.domain,markDef:x,config:f}):f.scale[o];st!==void 0&&X.set(o,st,!1)}}}(e,t):H7(e,t)}const W7={bins:({model:e,fieldOrDatumDef:t})=>_i(t)?function(n,o){const u=o.bin;if(Hs(u)){const f=eI(n,o.field,u);return new Um(()=>n.getSignalName(f))}if(ph(u)&&DE(u)&&u.step!==void 0)return{step:u.step}}(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>function(n,o){if(fo([kp,uy,cy],n)&&o!=="nominal")return"hcl"}(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>function(o,u,f){var g;if(!(!((g=gy(f))===null||g===void 0)&&g.bin||fo([Ac.TIME,Ac.UTC],o)))return u in mb||void 0}(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:o,config:u})=>function(f,g,x,k,F,V){if(f in mb){if(W0(g)){if(x.continuousPadding!==void 0)return x.continuousPadding;const{type:X,orient:te}=F;if(X==="bar"&&(!_i(k)||!k.bin&&!k.timeUnit)&&(te==="vertical"&&f==="x"||te==="horizontal"&&f==="y"))return V.continuousBandSize}if(g===Ac.POINT)return x.pointPadding}}(e,t,u.scale,n,o,u.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:o})=>function(u,f,g,x){if(u===void 0&&f in mb){const{bandPaddingInner:k,barBandPaddingInner:F,rectBandPaddingInner:V}=x;return kc(k,g==="bar"?F:V)}}(e,t,n.type,o.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:o,scalePaddingInner:u,config:f})=>function(g,x,k,F,V,X){if(g===void 0&&x in mb&&k===Ac.BAND){const{bandPaddingOuter:te}=X;return kc(te,ko(V)?{signal:`${V.signal}/2`}:V/2)}}(e,t,n,o.type,u,f.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:o})=>function(u,f,g,x){if(g==="x"&&x.xReverse!==void 0)return jg(u)&&f==="descending"?ko(x.xReverse)?{signal:`!${x.xReverse.signal}`}:!x.xReverse:x.xReverse;if(jg(u)&&f==="descending")return!0}(t,_i(e)?e.sort:void 0,n,o.scale),zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:o,scaleType:u})=>function(f,g,x,k,F){if(x&&x!=="unaggregated"&&jg(F)){if(ao(x)){const V=x[0],X=x[x.length-1];if(V<=0&&X>=0)return!0}return!1}if(f==="size"&&g.type==="quantitative"&&!I3(F))return!0;if((!_i(g)||!g.bin)&&fo([...Bg,...Bee],f)){const{orient:V,type:X}=k;return!fo(["bar","area","line","trail"],X)||!(V==="horizontal"&&f==="y"||V==="vertical"&&f==="x")}return!1}(e,t,n,o,u)};function V7(e){Wu(e)?function(t){const n=t.component.scales;for(const o of T3){const u=n[o];if(!u)continue;const f=soe(o,t);u.setWithExplicit("range",f)}}(e):H7(e,"range")}function H7(e,t){const n=e.component.scales;for(const o of e.children)t==="range"?V7(o):U7(o,t);for(const o of fi(n)){let u;for(const f of e.children){const g=f.component.scales[o];g&&(u=_b(u,g.getWithExplicit(t),t,"scale",cz((x,k)=>{switch(t){case"range":return x.step&&k.step?x.step-k.step:0}return 0})))}n[o].setWithExplicit(t,u)}}function coe(e,t,n,o){const u=function(g,x,k){var F;switch(x.type){case"nominal":case"ordinal":if(Qw(g)||M3(g)==="discrete")return g==="shape"&&x.type==="ordinal"&&ci(ae.discreteChannelCannotEncode(g,"ordinal")),"ordinal";if(g in mb){if(fo(["rect","bar","image","rule"],k))return"band"}else if(k==="arc"&&g in L4)return"band";return x.band!==void 0||aN(x)&&(!((F=x.axis)===null||F===void 0)&&F.tickBand)?"band":"point";case"temporal":return Qw(g)?"time":M3(g)==="discrete"?(ci(ae.discreteChannelCannotEncode(g,"temporal")),"ordinal"):_i(x)&&x.timeUnit&&mh(x.timeUnit).utc?"utc":"time";case"quantitative":return Qw(g)?_i(x)&&Hs(x.bin)?"bin-ordinal":"linear":M3(g)==="discrete"?(ci(ae.discreteChannelCannotEncode(g,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(ae.invalidFieldType(x.type))}(t,n,o),{type:f}=e;return gb(t)?f!==void 0?Q8(t,f)?_i(n)&&!J8(f,n.type)?(ci(ae.scaleTypeNotWorkWithFieldDef(f,u)),u):f:(ci(ae.scaleTypeNotWorkWithChannel(t,f,u)),u):u:null}function G7(e){Wu(e)?e.component.scales=function(t){const{encoding:n,mark:o}=t;return T3.reduce((u,f)=>{const g=Xc(n[f]);if(g&&o===v8&&f===Ap&&g.type===n2)return u;let x=g&&g.scale;if(g&&x!==null&&x!==!1){const k=coe(x=x??{},f,g,o);u[f]=new P7(t.scaleName(f+"",!0),{value:k,explicit:x.type===k})}return u},{})}(e):e.component.scales=function(t){var n;const o=t.component.scales={},u={},f=t.component.resolve;for(const g of t.children){G7(g);for(const x of fi(g.component.scales))if(f.scale[x]=(n=f.scale[x])!==null&&n!==void 0?n:Iie(x,t),f.scale[x]==="shared"){const k=u[x],F=g.component.scales[x].getWithExplicit("type");k?vne(k.value,F.value)?u[x]=_b(k,F,"type","scale",loe):(f.scale[x]="independent",delete u[x]):u[x]=F}}for(const g of fi(u)){const x=t.scaleName(g,!0),k=u[g];o[g]=new P7(x,k);for(const F of t.children){const V=F.component.scales[g];V&&(F.renameScale(V.get("name"),x),V.merged=!0)}}return o}(e)}const loe=cz((e,t)=>q8(e)-q8(t));class cI{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function Wu(e){return(e==null?void 0:e.type)==="unit"}function $0(e){return(e==null?void 0:e.type)==="facet"}function lI(e){return(e==null?void 0:e.type)==="concat"}function h2(e){return(e==null?void 0:e.type)==="layer"}class fI{constructor(t,n,o,u,f,g,x){var k,F;this.type=n,this.parent=o,this.config=f,this.view=x,this.children=[],this.correctDataNames=V=>(V.from&&V.from.data&&(V.from.data=this.lookupDataSource(V.from.data)),V.from&&V.from.facet&&V.from.facet.data&&(V.from.facet.data=this.lookupDataSource(V.from.facet.data)),V),this.parent=o,this.config=f,this.name=(k=t.name)!==null&&k!==void 0?k:u,this.title=wb(t.title)?{text:t.title}:t.title,this.scaleNameMap=o?o.scaleNameMap:new cI,this.projectionNameMap=o?o.projectionNameMap:new cI,this.signalNameMap=o?o.signalNameMap:new cI,this.data=t.data,this.description=t.description,this.transforms=yre((F=t.transform)!==null&&F!==void 0?F:[]),this.layout=n==="layer"||n==="unit"?{}:function(V,X,te){var ue,he;const be=te[X],Pe={},{spacing:Ue,columns:We}=be;Ue!==void 0&&(Pe.spacing=Ue),We!==void 0&&(L3(V)&&!FE(V.facet)||xN(V))&&(Pe.columns=We),q3(V)&&(Pe.columns=1);for(const at of jne)if(V[at]!==void 0)if(at==="spacing"){const st=V[at];Pe[at]=Cc(st)?st:{row:(ue=st.row)!==null&&ue!==void 0?ue:Ue,column:(he=st.column)!==null&&he!==void 0?he:Ue}}else Pe[at]=V[at];return Pe}(t,n,f),this.component={data:{sources:o?o.component.data.sources:[],outputNodes:o?o.component.data.outputNodes:{},outputNodeRefCounts:o?o.component.data.outputNodeRefCounts:{},isFaceted:L3(t)||o&&o.component.data.isFaceted&&t.data===void 0},layoutSize:new h1,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},g?na(g):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){(function(t,{ignoreRange:n}={}){G7(t),I7(t);for(const o of kne)U7(t,o);n||V7(t)})(this)}parseProjection(){A7(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){w7(this)}assembleGroupStyle(){var t,n;if(this.type==="unit"||this.type==="layer")return(n=(t=this.view)===null||t===void 0?void 0:t.style)!==null&&n!==void 0?n:"cell"}assembleEncodeFromView(t){const n=Qi(t,["style"]),o={};for(const u of fi(n)){const f=n[u];f!==void 0&&(o[u]=uc(f))}return o}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),t||(this.description&&(n.description=uc(this.description)),this.type!=="unit"&&this.type!=="layer")?Ts(n)?void 0:n:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},n??{})}assembleLayout(){if(!this.layout)return;const t=this.layout,{spacing:n}=t,o=Qi(t,["spacing"]),{component:u,config:f}=this,g=function(x,k){const F={};for(const V of Lg){const X=x[V];if(X!=null&&X.facetFieldDef){const{titleAnchor:te,titleOrient:ue}=fA(["titleAnchor","titleOrient"],X.facetFieldDef,k,V),he=lA(V,ue),be=Nie(te,he);be!==void 0&&(F[he]=be)}}return Ts(F)?void 0:F}(u.layoutHeaders,f);return Object.assign(Object.assign(Object.assign({padding:n},this.assembleDefaultLayout()),o),g?{titleBand:g}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const o of Lg)t[o].title&&n.push(Oie(this,o));for(const o of XN)n=n.concat(Tie(this,o));return n}assembleAxes(){return function(t,n){const{x:o=[],y:u=[]}=t;return[...o.map(f=>JE(f,"grid",n)),...u.map(f=>JE(f,"grid",n)),...o.map(f=>JE(f,"main",n)),...u.map(f=>JE(f,"main",n))].filter(f=>f)}(this.component.axes,this.config)}assembleLegends(){return S7(this)}assembleProjections(){return Uie(this)}assembleTitle(){var t,n,o;const u=(t=this.title)!==null&&t!==void 0?t:{},{encoding:f}=u,g=Qi(u,["encoding"]),x=Object.assign(Object.assign(Object.assign({},E9(this.config.title).nonMark),g),f?{encode:{update:f}}:{});if(x.text)return fo(["unit","layer"],this.type)?fo(["middle",void 0],x.anchor)&&(x.frame=(n=x.frame)!==null&&n!==void 0?n:"group"):x.anchor=(o=x.anchor)!==null&&o!==void 0?o:"start",Ts(x)?void 0:x}assembleGroup(t=[]){const n={};(t=t.concat(this.assembleSignals())).length>0&&(n.signals=t);const o=this.assembleLayout();o&&(n.layout=o),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const u=!this.parent||$0(this.parent)?function x(k){return h2(k)||lI(k)?k.children.reduce((F,V)=>F.concat(x(V)),R7(k)):R7(k)}(this):[];u.length>0&&(n.scales=u);const f=this.assembleAxes();f.length>0&&(n.axes=f);const g=this.assembleLegends();return g.length>0&&(n.legends=g),n}getName(t){return bu((this.name?this.name+"_":"")+t)}requestDataName(t){var n;const o=this.getName(t),u=this.component.data.outputNodeRefCounts;return u[o]=((n=u[o])!==null&&n!==void 0?n:0)+1,o}getSizeSignalRef(t){if($0(this.parent)){const n=O3(d7(t)),o=this.component.scales[n];if(o&&!o.merged){const u=o.get("type"),f=o.get("range");if(Op(u)&&vb(f)){const g=o.get("name"),x=uI(mA(this,n));return x?{signal:f7(g,o,mi({aggregate:"distinct",field:x},{expr:"datum"}))}:(ci(`Unknown field for ${n}. Cannot calculate view size.`),null)}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){return n?this.getName(t):A8(t)&&gb(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t))?this.scaleNameMap.get(this.getName(t)):void 0}projectionName(t){return t?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,n){let o=this.component.selection[t];if(!o&&this.parent&&(o=this.parent.getSelectionComponent(t,n)),!o)throw new Error(ae.selectionNotFound(n));return o}hasAxisOrientSignalRef(){var t,n;return((t=this.component.axes.x)===null||t===void 0?void 0:t.some(o=>o.hasOrientSignalRef()))||((n=this.component.axes.y)===null||n===void 0?void 0:n.some(o=>o.hasOrientSignalRef()))}}class q7 extends fI{vgField(t,n={}){const o=this.fieldDef(t);if(o)return mi(o,n)}reduceFieldDef(t,n){return D9(this.getMapping(),(o,u,f)=>{const g=gy(u);return g?t(o,g,f):o},n)}forEachFieldDef(t,n){dN(this.getMapping(),(o,u)=>{const f=gy(o);f&&t(f,u)},n)}}class gA extends ys{constructor(t,n){var o,u,f;super(t),this.transform=n,this.transform=na(n);const g=(o=this.transform.as)!==null&&o!==void 0?o:[void 0,void 0];this.transform.as=[(u=g[0])!==null&&u!==void 0?u:"value",(f=g[1])!==null&&f!==void 0?f:"density"]}clone(){return new gA(null,na(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${Ra(this.transform)}`}assemble(){const t=this.transform,{density:n}=t,o=Qi(t,["density"]);return Object.assign({type:"kde",field:n},o)}}class eS extends ys{constructor(t,n){super(t),this.filter=n}clone(){return new eS(null,Object.assign({},this.filter))}static make(t,n){const{config:o,mark:u,markDef:f}=n;if(ns("invalid",f,o)!=="filter")return null;const g=n.reduceFieldDef((x,k,F)=>{const V=gb(F)&&n.getScaleComponent(F);return V&&jg(V.get("type"))&&k.aggregate!=="count"&&!Ox(u)&&(x[k.field]=k),x},{});return fi(g).length?new eS(t,g):null}dependentFields(){return new Set(fi(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${Ra(this.filter)}`}assemble(){const t=fi(this.filter).reduce((n,o)=>{const u=this.filter[o],f=mi(u,{expr:"datum"});return u!==null&&(u.type==="temporal"?n.push(`(isDate(${f}) || (isValid(${f}) && isFinite(+${f})))`):u.type==="quantitative"&&(n.push(`isValid(${f})`),n.push(`isFinite(+${f})`))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class vA extends ys{constructor(t,n){super(t),this.transform=n,this.transform=na(n);const{flatten:o,as:u=[]}=this.transform;this.transform.as=o.map((f,g)=>{var x;return(x=u[g])!==null&&x!==void 0?x:f})}clone(){return new vA(this.parent,na(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${Ra(this.transform)}`}assemble(){const{flatten:t,as:n}=this.transform;return{type:"flatten",fields:t,as:n}}}class yA extends ys{constructor(t,n){var o,u,f;super(t),this.transform=n,this.transform=na(n);const g=(o=this.transform.as)!==null&&o!==void 0?o:[void 0,void 0];this.transform.as=[(u=g[0])!==null&&u!==void 0?u:"key",(f=g[1])!==null&&f!==void 0?f:"value"]}clone(){return new yA(null,na(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${Ra(this.transform)}`}assemble(){const{fold:t,as:n}=this.transform;return{type:"fold",fields:t,as:n}}}class p2 extends ys{constructor(t,n,o,u){super(t),this.fields=n,this.geojson=o,this.signal=u}clone(){return new p2(null,na(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let o=0;for(const u of[[sy,ay],[Pg,U0]]){const f=u.map(g=>{const x=Xc(n.encoding[g]);return _i(x)?x.field:xb(x)?{expr:`${x.datum}`}:f1(x)?{expr:`${x.value}`}:void 0});(f[0]||f[1])&&(t=new p2(t,f,null,n.getName(`geojson_${o++}`)))}if(n.channelHasField(Ap)){const u=n.typedFieldDef(Ap);u.type===n2&&(t=new p2(t,null,u.field,n.getName(`geojson_${o++}`)))}return t}dependentFields(){var t;const n=((t=this.fields)!==null&&t!==void 0?t:[]).filter(ta);return new Set([...this.geojson?[this.geojson]:[],...n])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${Ra(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class tS extends ys{constructor(t,n,o,u){super(t),this.projection=n,this.fields=o,this.as=u}clone(){return new tS(null,this.projection,na(this.fields),na(this.as))}static parseAll(t,n){if(!n.projectionName())return t;for(const o of[[sy,ay],[Pg,U0]]){const u=o.map(g=>{const x=Xc(n.encoding[g]);return _i(x)?x.field:xb(x)?{expr:`${x.datum}`}:f1(x)?{expr:`${x.value}`}:void 0}),f=o[0]===Pg?"2":"";(u[0]||u[1])&&(t=new tS(t,n.projectionName(),u,[n.getName("x"+f),n.getName("y"+f)]))}return t}dependentFields(){return new Set(this.fields.filter(ta))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${Ra(this.fields)} ${Ra(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Xx extends ys{constructor(t,n){super(t),this.transform=n}clone(){return new Xx(null,na(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:o,step:u}=t;return{signal:`sequence(${[n,o,...u?[u]:[]].join(",")})`}}static makeFromTransform(t,n){return new Xx(t,n)}static makeFromEncoding(t,n){const o=n.encoding,u=o.x,f=o.y;if(_i(u)&&_i(f)){const g=u.impute?u:f.impute?f:void 0;if(g===void 0)return;const x=u.impute?f:f.impute?u:void 0,{method:k,value:F,frame:V,keyvals:X}=g.impute,te=N9(n.mark,o);return new Xx(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:g.field,key:x.field},k?{method:k}:{}),F!==void 0?{value:F}:{}),V?{frame:V}:{}),X!==void 0?{keyvals:X}:{}),te.length?{groupby:te}:{}))}return null}hash(){return`Impute ${Ra(this.transform)}`}assemble(){const{impute:t,key:n,keyvals:o,method:u,groupby:f,value:g,frame:x=[null,null]}=this.transform,k=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:n},o?{keyvals:function(F){return(F==null?void 0:F.stop)!==void 0}(o)?this.processSequence(o):o}:{}),{method:"value"}),f?{groupby:f}:{}),{value:u&&u!=="value"?null:g});return u&&u!=="value"?[k,Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[u],fields:[t],frame:x,ignorePeers:!1},f?{groupby:f}:{}),{type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t}]:[k]}}class bA extends ys{constructor(t,n){var o,u,f;super(t),this.transform=n,this.transform=na(n);const g=(o=this.transform.as)!==null&&o!==void 0?o:[void 0,void 0];this.transform.as=[(u=g[0])!==null&&u!==void 0?u:n.on,(f=g[1])!==null&&f!==void 0?f:n.loess]}clone(){return new bA(null,na(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${Ra(this.transform)}`}assemble(){const t=this.transform,{loess:n,on:o}=t,u=Qi(t,["loess","on"]);return Object.assign({type:"loess",x:o,y:n},u)}}class nS extends ys{constructor(t,n,o){super(t),this.transform=n,this.secondary=o}clone(){return new nS(null,na(this.transform),this.secondary)}static make(t,n,o,u){const f=n.component.data.sources,{from:g}=o;let x=null;if(function(k){return"data"in k}(g)){let k=Y7(g.data,f);k||(k=new l2(g.data),f.push(k));const F=n.getName(`lookup_${u}`);x=new gh(k,F,"lookup",n.component.data.outputNodeRefCounts),n.component.data.outputNodes[F]=x}else if(function(k){return"selection"in k}(g)){const k=g.selection;if(o=Object.assign({as:k},o),!(x=n.getSelectionComponent(bu(k),k).materialized))throw new Error(ae.noSameUnitLookup(k))}return new nS(t,o,x.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?sc(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${Ra({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:sc(this.transform.as)}:{});else{let n=this.transform.as;ta(n)||(ci(ae.NO_FIELDS_NEEDS_AS),n="_lookup"),t={as:[n]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}class xA extends ys{constructor(t,n){var o,u,f;super(t),this.transform=n,this.transform=na(n);const g=(o=this.transform.as)!==null&&o!==void 0?o:[void 0,void 0];this.transform.as=[(u=g[0])!==null&&u!==void 0?u:"prob",(f=g[1])!==null&&f!==void 0?f:"value"]}clone(){return new xA(null,na(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${Ra(this.transform)}`}assemble(){const t=this.transform,{quantile:n}=t,o=Qi(t,["quantile"]);return Object.assign({type:"quantile",field:n},o)}}class wA extends ys{constructor(t,n){var o,u,f;super(t),this.transform=n,this.transform=na(n);const g=(o=this.transform.as)!==null&&o!==void 0?o:[void 0,void 0];this.transform.as=[(u=g[0])!==null&&u!==void 0?u:n.on,(f=g[1])!==null&&f!==void 0?f:n.regression]}clone(){return new wA(null,na(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${Ra(this.transform)}`}assemble(){const t=this.transform,{regression:n,on:o}=t,u=Qi(t,["regression","on"]);return Object.assign({type:"regression",x:o,y:n},u)}}class _A extends ys{constructor(t,n){super(t),this.transform=n}clone(){return new _A(null,na(this.transform))}addDimensions(t){var n;this.transform.groupby=ab(((n=this.transform.groupby)!==null&&n!==void 0?n:[]).concat(t),o=>o)}producedFields(){}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}hash(){return`PivotTransform ${Ra(this.transform)}`}assemble(){const{pivot:t,value:n,groupby:o,limit:u,op:f}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:n},u!==void 0?{limit:u}:{}),f!==void 0?{op:f}:{}),o!==void 0?{groupby:o}:{})}}class EA extends ys{constructor(t,n){super(t),this.transform=n}clone(){return new EA(null,na(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${Ra(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function $7(e){let t=0;return function n(o,u){var f;if(o instanceof l2&&!o.isGenerator&&!jE(o.data)&&(e.push(u),u={name:null,source:u.name,transform:[]}),o instanceof od&&(o.parent instanceof l2&&!u.source?(u.format=Object.assign(Object.assign({},(f=u.format)!==null&&f!==void 0?f:{}),{parse:o.assembleFormatParse()}),u.transform.push(...o.assembleTransforms(!0))):u.transform.push(...o.assembleTransforms())),o instanceof f2){u.name||(u.name=`data_${t++}`),!u.source||u.transform.length>0?(e.push(u),o.data=u.name):o.data=u.source;for(const g of o.assemble())e.push(g)}else switch((o instanceof QE||o instanceof ZE||o instanceof eS||o instanceof a2||o instanceof s2||o instanceof tS||o instanceof p2||o instanceof G0||o instanceof nS||o instanceof d2||o instanceof $x||o instanceof yA||o instanceof vA||o instanceof gA||o instanceof bA||o instanceof xA||o instanceof wA||o instanceof kb||o instanceof EA||o instanceof _A)&&u.transform.push(o.assemble()),(o instanceof xy||o instanceof yy||o instanceof Xx||o instanceof y1)&&u.transform.push(...o.assemble()),o instanceof gh&&(u.source&&u.transform.length===0?o.setSource(u.source):o.parent instanceof gh?o.setSource(u.name):(u.name||(u.name=`data_${t++}`),o.setSource(u.name),o.numChildren()===1&&(e.push(u),u={name:null,source:u.name,transform:[]}))),o.numChildren()){case 0:o instanceof gh&&(!u.source||u.transform.length>0)&&e.push(u);break;case 1:n(o.children[0],u);break;default:{u.name||(u.name=`data_${t++}`);let g=u.name;!u.source||u.transform.length>0?e.push(u):g=u.source;for(const x of o.children)n(x,{name:null,source:g,transform:[]});break}}}}function foe(e){return e==="top"||e==="left"||ko(e)?"header":"footer"}function doe(e,t){var n;const{facet:o,config:u,child:f,component:g}=e;if(e.channelHasField(t)){const x=o[t],k=c2("title",null,u,t);let F=Px(x,u,{allowDisabling:!0,includeDefault:k===void 0||!!k});f.component.layoutHeaders[t].title&&(F=ao(F)?F.join(", "):F,F+=" / "+f.component.layoutHeaders[t].title,f.component.layoutHeaders[t].title=null);const V=c2("labelOrient",x,u,t),X=kc(((n=x.header)!==null&&n!==void 0?n:{}).labels,u.header.labels,!0),te=fo(["bottom","right"],V)?"footer":"header";g.layoutHeaders[t]={title:F,facetFieldDef:x,[te]:t==="facet"?[]:[X7(e,t,X)]}}}function X7(e,t,n){const o=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(o)?e.child.getSizeSignalRef(o):void 0,axes:[]}}function K7(e,t){var n;const{child:o}=e;if(o.component.axes[t]){const{layoutHeaders:u,resolve:f}=e.component;if(f.axis[t]=QN(f,t),f.axis[t]==="shared"){const g=t==="x"?"column":"row",x=u[g];for(const k of o.component.axes[t]){const F=foe(k.get("orient"));x[F]=(n=x[F])!==null&&n!==void 0?n:[X7(e,g,!1)];const V=JE(k,"main",e.config,{header:!0});V&&x[F][0].axes.push(V),k.mainExtracted=!0}}}}function hoe(e){dI(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";SA(e,t),SA(e,n)}function dI(e){for(const t of e.children)t.parseLayoutSize()}function SA(e,t){const n=d7(t),o=O3(n),u=e.component.resolve,f=e.component.layoutSize;let g;for(const x of e.children){const k=x.component.layoutSize.getWithExplicit(n),F=u.scale[o];if(F==="independent"&&k.value==="step"){g=void 0;break}if(g){if(F==="independent"&&g.value!==k.value){g=void 0;break}g=_b(g,k,n,"")}else g=k}if(g){for(const x of e.children)e.renameSignal(x.getName(n),e.getName(t)),x.component.layoutSize.set(n,"merged",!1);f.setWithExplicit(t,g)}else f.setWithExplicit(t,{explicit:!1,value:void 0})}function poe(e,t){const n=t==="width"?"x":"y",o=e.config,u=e.getScaleComponent(n);if(u){const f=u.get("type"),g=u.get("range");if(Op(f)){const x=BE(o.view,t);return vb(g)||vy(x)?"step":x}return _N(o.view,t)}if(e.hasProjection||e.mark==="arc")return _N(o.view,t);{const f=BE(o.view,t);return vy(f)?f.step:f}}function hI(e,t,n){return mi(t,Object.assign({suffix:`by_${mi(e)}`},n??{}))}class rS extends q7{constructor(t,n,o,u){super(t,"facet",n,o,u,t.resolve),this.child=vI(t.spec,this,this.getName("child"),void 0,u),this.children=[this.child],this.facet=this.initFacet(t.facet,u)}initFacet(t,n){return FE(t)?D9(t,(o,u,f)=>fo([o1,a1],f)?u.field===void 0?(ci(ae.emptyFieldDef(u,f)),o):(o[f]=uN(u,f,n),o):(ci(ae.incompatibleChannel(f,"facet")),o),{}):{facet:uN(t,"facet",n)}}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=CA(this),this.child.parseData()}parseLayoutSize(){dI(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(t){for(const n of Lg)doe(t,n);K7(t,"x"),K7(t,"y")}(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,n,o;const u={};for(const f of Lg)for(const g of KN){const x=this.component.layoutHeaders[f],k=x[g],{facetFieldDef:F}=x;if(F){const V=c2("titleOrient",F,this.config,f);if(fo(["right","bottom"],V)){const X=lA(f,V);u.titleAnchor=(t=u.titleAnchor)!==null&&t!==void 0?t:{},u.titleAnchor[X]="end"}}if(k!=null&&k[0]){const V=f==="row"?"height":"width",X=g==="header"?"headerBand":"footerBand";f==="facet"||this.child.component.layoutSize.get(V)||(u[X]=(n=u[X])!==null&&n!==void 0?n:{},u[X][f]=.5),x.title&&(u.offset=(o=u.offset)!==null&&o!==void 0?o:{},u.offset[f==="row"?"rowTitle":"columnTitle"]=10)}}return u}assembleDefaultLayout(){const{column:t,row:n}=this.facet,o=t?this.columnDistinctSignal():n?1:void 0;let u="all";return(n||this.component.resolve.scale.x!=="independent")&&(t||this.component.resolve.scale.y!=="independent")||(u="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),o?{columns:o}:{}),{bounds:"full",align:u})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof rS))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroup(t){return this.parent&&this.parent instanceof rS?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:mi(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t)):super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],o=[];if(this.child instanceof rS){if(this.child.channelHasField("column")){const u=mi(this.child.facet.column);t.push(u),n.push("distinct"),o.push(`distinct_${u}`)}}else for(const u of Bg){const f=this.child.component.scales[u];if(f&&!f.merged){const g=f.get("type"),x=f.get("range");if(Op(g)&&vb(x)){const k=uI(mA(this.child,u));k?(t.push(k),n.push("distinct"),o.push(`distinct_${k}`)):ci(`Unknown field for ${u}. Cannot calculate view size.`)}}}return{fields:t,ops:n,as:o}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:o,column:u}=this.facet,{fields:f,ops:g,as:x}=this.getCardinalityAggregateForChild(),k=[];for(const V of Lg){const X=this.facet[V];if(X){k.push(mi(X));const{bin:te,sort:ue}=X;if(Hs(te)&&k.push(mi(X,{binSuffix:"end"})),py(ue)){const{field:he,op:be=P3}=ue,Pe=hI(X,ue);o&&u?(f.push(Pe),g.push("max"),x.push(Pe)):(f.push(he),g.push(be),x.push(Pe))}else if(ao(ue)){const he=u2(X,V);f.push(he),g.push("max"),x.push(he)}}}const F=!!o&&!!u;return Object.assign({name:t,data:n,groupby:k},F||f.length>0?{aggregate:Object.assign(Object.assign({},F?{cross:F}:{}),f.length?{fields:f,ops:g,as:x}:{})}:{})}facetSortFields(t){const{facet:n}=this,o=n[t];return o?py(o.sort)?[hI(o,o.sort,{expr:"datum"})]:ao(o.sort)?[u2(o,t,{expr:"datum"})]:[mi(o,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,o=n[t];if(o){const{sort:u}=o;return[(py(u)?u.order:!ao(u)&&u)||"ascending"]}return[]}assembleLabelTitle(){const{facet:t,config:n}=this;if(t.facet)return YN(t.facet,"facet",n);const o={row:["top","bottom"],column:["left","right"]};for(const u of XN)if(t[u]){const f=c2("labelOrient",t[u],n,u);if(fo(o[u],f))return YN(t[u],u,n)}}assembleMarks(){const{child:t}=this,n=function(g){const x=[],k=$7(x);for(const F of g.children)k(F,{source:g.name,name:null,transform:[]});return x}(this.component.data.facetRoot),o=t.assembleGroupEncodeEntry(!1),u=this.assembleLabelTitle()||t.assembleTitle(),f=t.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},u?{title:u}:{}),f?{style:f}:{}),{from:{facet:this.assembleFacet()},sort:{field:Lg.map(g=>this.facetSortFields(g)).flat(),order:Lg.map(g=>this.facetSortOrder(g)).flat()}}),n.length>0?{data:n}:{}),o?{encode:{update:o}}:{}),t.assembleGroup(function(g,x){if(g.component.selection&&fi(g.component.selection).length){const k=Oa(g.getName("cell"));x.unshift({name:"facet",value:{},on:[{events:Sx("mousemove","scope"),update:`isTuple(facet) ? facet : group(${k}).datum`}]})}return IN(x)}(this,[])))]}getMapping(){return this.facet}}function Y7(e,t){var n,o,u,f,g,x,k,F,V,X;for(const te of t){const ue=te.data;if((!e.name||!te.hasName()||e.name===te.dataName)&&!(!((n=e.format)===null||n===void 0)&&n.mesh&&(!((o=ue.format)===null||o===void 0)&&o.feature)||(!((u=e.format)===null||u===void 0)&&u.feature||!((f=ue.format)===null||f===void 0)&&f.feature)&&((g=e.format)===null||g===void 0?void 0:g.feature)!==((x=ue.format)===null||x===void 0?void 0:x.feature)||(!((k=e.format)===null||k===void 0)&&k.mesh||!((F=ue.format)===null||F===void 0)&&F.mesh)&&((V=e.format)===null||V===void 0?void 0:V.mesh)!==((X=ue.format)===null||X===void 0?void 0:X.mesh))){if(Y3(e)&&Y3(ue)){if(EE(e.values,ue.values))return te}else if(jE(e)&&jE(ue)){if(e.url===ue.url)return te}else if(lz(e)&&e.name===te.dataName)return te}}return null}function moe(e,t){if(e.data||!e.parent){if(e.data===null){const o=new l2({values:[]});return t.push(o),o}const n=Y7(e.data,t);if(n)return Ux(e.data)||(n.data.format=function(o,...u){for(const f of u)pee(o,f??{});return o}({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const o=new l2(e.data);return t.push(o),o}}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function CA(e){var t,n,o,u,f,g,x,k,F,V;let X=moe(e,e.component.data.sources);const{outputNodes:te,outputNodeRefCounts:ue}=e.component.data,he=e.parent?e.parent.component.data.ancestorParse.clone():new ere,be=e.data;Ux(be)?(fz(be)?X=new ZE(X,be.sequence):AN(be)&&(X=new QE(X,be.graticule)),he.parseNothing=!0):((t=be==null?void 0:be.format)===null||t===void 0?void 0:t.parse)===null&&(he.parseNothing=!0),X=(n=od.makeExplicit(X,e,he))!==null&&n!==void 0?n:X,X=new kb(X);const Pe=e.parent&&h2(e.parent);(Wu(e)||$0(e))&&Pe&&(X=(o=xy.makeFromEncoding(X,e))!==null&&o!==void 0?o:X),e.transforms.length>0&&(X=function(St,yn,Mn){var _n,$n;let qn=0;for(const er of yn.transforms){let rr,fr;if(fre(er))rr=St=new s2(St,er),fr="derived";else if(hz(er)){const Dr=Hie(er);rr=St=(_n=od.makeWithAncestors(St,{},Dr,Mn))!==null&&_n!==void 0?_n:St,St=new a2(St,yn,er.filter)}else if(dre(er))rr=St=xy.makeFromTransform(St,er,yn),fr="number";else if(pre(er))fr="date",Mn.getWithExplicit(er.field).value===void 0&&(St=new od(St,{[er.field]:fr}),Mn.set(er.field,fr,!1)),rr=St=yy.makeFromTransform(St,er);else if(mre(er))rr=St=G0.makeFromTransform(St,er),fr="number",RN(yn)&&(St=new kb(St));else if(tre(er))rr=St=nS.make(St,yn,er,qn++),fr="derived";else if(ure(er))rr=St=new d2(St,er),fr="number";else if(cre(er))rr=St=new $x(St,er),fr="number";else if(gre(er))rr=St=y1.makeFromTransform(St,er),fr="derived";else if(vre(er))rr=St=new yA(St,er),fr="derived";else if(lre(er))rr=St=new vA(St,er),fr="derived";else if(nre(er))rr=St=new _A(St,er),fr="derived";else if(sre(er))St=new EA(St,er);else if(hre(er))rr=St=Xx.makeFromTransform(St,er),fr="derived";else if(rre(er))rr=St=new gA(St,er),fr="derived";else if(ire(er))rr=St=new xA(St,er),fr="derived";else if(ore(er))rr=St=new wA(St,er),fr="derived";else{if(!are(er)){ci(ae.invalidTransformIgnored(er));continue}rr=St=new bA(St,er),fr="derived"}if(rr&&fr!==void 0)for(const Dr of($n=rr.producedFields())!==null&&$n!==void 0?$n:[])Mn.set(Dr,fr,!1)}return St}(X,e,he));const Ue=function(St){const yn={};if(Wu(St)&&St.component.selection)for(const Mn of fi(St.component.selection)){const _n=St.component.selection[Mn];for(const $n of _n.project.items)!$n.channel&&AE($n.field)>1&&(yn[$n.field]="flatten")}return yn}(e),We=Gie(e);X=(u=od.makeWithAncestors(X,{},Object.assign(Object.assign({},Ue),We),he))!==null&&u!==void 0?u:X,Wu(e)&&(X=p2.parseAll(X,e),X=tS.parseAll(X,e)),(Wu(e)||$0(e))&&(Pe||(X=(f=xy.makeFromEncoding(X,e))!==null&&f!==void 0?f:X),X=(g=yy.makeFromEncoding(X,e))!==null&&g!==void 0?g:X,X=s2.parseAllForSortIndex(X,e));const at=e.getName(J3),st=new gh(X,at,J3,ue);if(te[at]=st,X=st,Wu(e)){const St=G0.makeFromEncoding(X,e);St&&(X=St,RN(e)&&(X=new kb(X))),X=(x=Xx.makeFromEncoding(X,e))!==null&&x!==void 0?x:X,X=(k=y1.makeFromEncoding(X,e))!==null&&k!==void 0?k:X}Wu(e)&&(X=(F=eS.make(X,e))!==null&&F!==void 0?F:X);const dt=e.getName(ed),ct=new gh(X,dt,ed,ue);te[dt]=ct,X=ct,Wu(e)&&function(St,yn){Vx(St,Mn=>{const _n=Mn.name,$n=St.getName(`lookup_${_n}`);St.component.data.outputNodes[$n]=Mn.materialized=new gh(new a2(yn,St,{selection:_n}),$n,"lookup",St.component.data.outputNodeRefCounts)})}(e,ct);let kt=null;if($0(e)){const St=e.getName("facet");X=(V=function(yn,Mn){const{row:_n,column:$n}=Mn;if(_n&&$n){let qn=null;for(const er of[_n,$n])if(py(er.sort)){const{field:rr,op:fr=P3}=er.sort;yn=qn=new $x(yn,{joinaggregate:[{op:fr,field:rr,as:hI(er,er.sort,{forAs:!0})}],groupby:[mi(er)]})}return qn}return null}(X,e.facet))!==null&&V!==void 0?V:X,kt=new f2(X,e,St,ct.getSource()),te[St]=kt}return Object.assign(Object.assign({},e.component.data),{outputNodes:te,outputNodeRefCounts:ue,raw:st,main:ct,facetRoot:kt,ancestorParse:he})}class goe extends fI{constructor(t,n,o,u){var f,g,x,k;super(t,"concat",n,o,u,t.resolve),((g=(f=t.resolve)===null||f===void 0?void 0:f.axis)===null||g===void 0?void 0:g.x)!=="shared"&&((k=(x=t.resolve)===null||x===void 0?void 0:x.axis)===null||k===void 0?void 0:k.y)!=="shared"||ci(ae.CONCAT_CANNOT_SHARE_AXIS),this.children=this.getChildren(t).map((F,V)=>vI(F,this,this.getName("concat_"+V),void 0,u))}parseData(){this.component.data=CA(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of fi(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return q3(t)?t.vconcat:wN(t)?t.hconcat:t.concat}parseLayoutSize(){hoe(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,o)=>o.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=JN(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,o)=>o.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),o=t.assembleGroupStyle(),u=t.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},n?{title:n}:{}),o?{style:o}:{}),u?{encode:{update:u}}:{}),t.assembleGroup())})}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},t!=null?{columns:t}:{}),{bounds:"full",align:"each"})}}const voe=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},h8),{labelExpr:1,encode:1}),J7=fi(voe);class pI extends h1{constructor(t={},n={},o=!1){super(),this.explicit=t,this.implicit=n,this.mainExtracted=o}clone(){return new pI(na(this.explicit),na(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"||(t==="grid"||t==="title"?!!this.get(t):!function(n){return n===!1||n===null}(this.get(t)))}hasOrientSignalRef(){return ko(this.explicit.orient)}}function yoe(e){return Bg.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[function(o,u){var f,g,x;let k=u.axis(o);const F=new pI,V=Xc(u.encoding[o]),{mark:X,config:te}=u,ue=(k==null?void 0:k.orient)||((f=te[o==="x"?"axisX":"axisY"])===null||f===void 0?void 0:f.orient)||((g=te.axis)===null||g===void 0?void 0:g.orient)||function(dt){return dt==="x"?"bottom":"left"}(o),he=u.getScaleComponent(o).get("type"),be=Aie(o,he,ue,u.config),Pe=k!==void 0?!k:qN("disable",te,k==null?void 0:k.style,be).configValue;if(F.set("disable",Pe,k!==void 0),Pe)return F;const Ue=function(dt,ct,kt,St,yn){const Mn=ct==null?void 0:ct.labelAngle;if(Mn!==void 0)return ko(Mn)?Mn:g3(Mn);{const{configValue:_n}=qN("labelAngle",dt.config,ct==null?void 0:ct.style,yn);return _n!==void 0?g3(_n):kt===Tu&&fo([X4,$4],St.type)?270:void 0}}(u,k=k||{},o,V,be),We={fieldOrDatumDef:V,axis:k,channel:o,model:u,scaleType:he,orient:ue,labelAngle:Ue,mark:X,config:te};for(const dt of J7){const ct=dt in r7?r7[dt](We):p8(dt)?k[dt]:void 0,kt=ct!==void 0,St=_oe(ct,dt,k,u,o);if(kt&&St)F.set(dt,ct,St);else{const{configValue:yn,configFrom:Mn}=p8(dt)&&dt!=="values"?qN(dt,u.config,k.style,be):{},_n=yn!==void 0;kt&&!_n?F.set(dt,ct,St):(Mn!=="vgAxisConfig"||Eoe.has(dt)&&_n||T4(yn)||ko(yn))&&F.set(dt,yn,!1)}}const at=(x=k.encoding)!==null&&x!==void 0?x:{},st=d8.reduce((dt,ct)=>{var kt;if(!F.hasAxisPart(ct))return dt;const St=h7((kt=at[ct])!==null&&kt!==void 0?kt:{},u),yn=ct==="labels"?function(Mn,_n,$n){var qn;const{encoding:er,config:rr}=Mn,fr=(qn=Xc(er[_n]))!==null&&qn!==void 0?qn:Xc(er[ly(_n)]),Dr=Mn.axis(_n)||{},{format:Zr,formatType:Br}=Dr;return Rx(Br)?Object.assign({text:Z4({fieldOrDatumDef:fr,field:"datum.value",format:Zr,formatType:Br,config:rr})},$n):$n}(u,o,St):St;return yn===void 0||Ts(yn)||(dt[ct]={update:yn}),dt},{});return Ts(st)||F.set("encode",st,!!k.encoding||k.labelAngle!==void 0),F}(n,e)]),t),{})}const boe={bottom:"top",top:"bottom",left:"right",right:"left"};function xoe(e,t){if(!e)return t.map(n=>n.clone());{if(e.length!==t.length)return;const n=e.length;for(let o=0;o<n;o++){const u=e[o],f=t[o];if(!!u!=!!f)return;if(u&&f){const g=u.getWithExplicit("orient"),x=f.getWithExplicit("orient");if(g.explicit&&x.explicit&&g.value!==x.value)return;e[o]=woe(u,f)}}}return e}function woe(e,t){for(const n of J7){const o=_b(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(u,f)=>{switch(n){case"title":return M9(u,f);case"gridScale":return{explicit:u.explicit,value:kc(u.value,f.value)}}return K3(u,f,n,"axis")});e.setWithExplicit(n,o)}return e}function _oe(e,t,n,o,u){if(t==="disable")return n!==void 0;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(ko(n.labelAngle)?n.labelAngle:g3(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===a7(o,u))return!0}return e===n[t]}const Eoe=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function Soe(e,t,n,{graticule:o}){const u=ry(e)?Object.assign({},e):{type:e},f=ns("orient",u,n);if(u.orient=function(g,x,k){switch(g){case x3:case D4:case N4:case g8:case wee:case xee:return}const{x:F,y:V,x2:X,y2:te}=x;switch(g){case y3:if(_i(F)&&(ph(F.bin)||_i(V)&&V.aggregate&&!F.aggregate))return"vertical";if(_i(V)&&(ph(V.bin)||_i(F)&&F.aggregate&&!V.aggregate))return"horizontal";if(te||X){if(k)return k;if(!X&&(_i(F)&&F.type===Ix&&!Hs(F.bin)||iN(F)))return"horizontal";if(!te&&(_i(V)&&V.type===Ix&&!Hs(V.bin)||iN(V)))return"vertical"}case w3:if(X&&(!_i(F)||!ph(F.bin))&&te&&(!_i(V)||!ph(V.bin)))return;case v3:if(te)return _i(V)&&ph(V.bin)?"horizontal":"vertical";if(X)return _i(F)&&ph(F.bin)?"vertical":"horizontal";if(g===w3){if(F&&!V)return"vertical";if(V&&!F)return"horizontal"}case b3:case M4:{const ue=my(F),he=my(V);if(ue&&!he)return g!=="tick"?"horizontal":"vertical";if(!ue&&he)return g!=="tick"?"vertical":"horizontal";if(ue&&he){const be=F,Pe=V,Ue=be.type===t2,We=Pe.type===t2;return Ue&&!We?g!=="tick"?"vertical":"horizontal":!Ue&&We?g!=="tick"?"horizontal":"vertical":!be.aggregate&&Pe.aggregate?g!=="tick"?"vertical":"horizontal":be.aggregate&&!Pe.aggregate?g!=="tick"?"horizontal":"vertical":k||"vertical"}return k||void 0}}return"vertical"}(u.type,t,f),f!==void 0&&f!==u.orient&&ci(ae.orientOverridden(u.orient,f)),u.type==="bar"&&u.orient){const g=ns("cornerRadiusEnd",u,n);if(g!==void 0){const x=u.orient==="horizontal"&&t.x2||u.orient==="vertical"&&t.y2?["cornerRadius"]:See[u.orient];for(const k of x)u[k]=g;u.cornerRadiusEnd!==void 0&&delete u.cornerRadiusEnd}}return ns("opacity",u,n)===void 0&&(u.opacity=function(g,x){if(fo([x3,M4,D4,N4],g)&&!lN(x))return .7}(u.type,t)),u.filled===void 0&&(u.filled=!o&&function(g,x){const k=Bx("filled",g,x),F=g.type;return kc(k,F!==x3&&F!==b3&&F!==w3)}(u,n)),ns("cursor",u,n)===void 0&&(u.cursor=function(g,x,k){return x.href||g.href||ns("href",g,k)?"pointer":g.cursor}(u,t,n)),u}function mI(e,t){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},zg(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),td("x",e,{defaultPos:"mid"})),td("y",e,{defaultPos:"mid"})),El("size",e)),El("angle",e)),function(n,o,u){return u?{shape:{value:u}}:El("shape",n)}(e,0,t))}const kA={arc:{vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},zg(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),td("x",e,{defaultPos:"mid"})),td("y",e,{defaultPos:"mid"})),Eb(e,"radius","arc")),Eb(e,"theta","arc"))},area:{vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},zg(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),eA("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),eA("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),MN(e))},bar:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},zg(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Eb(e,"x","bar")),Eb(e,"y","bar"))},circle:{vgMark:"symbol",encodeEntry:e=>mI(e,"circle")},geoshape:{vgMark:"shape",encodeEntry:e=>Object.assign({},zg(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&_i(n)&&n.type===n2?{field:mi(n,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},zg(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),Eb(e,"x","image")),Eb(e,"y","image")),ON(e,"url"))},line:{vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},zg(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),td("x",e,{defaultPos:"mid"})),td("y",e,{defaultPos:"mid"})),El("size",e,{vgChannel:"strokeWidth"})),MN(e))},point:{vgMark:"symbol",encodeEntry:e=>mI(e)},rect:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},zg(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Eb(e,"x","rect")),Eb(e,"y","rect"))},rule:{vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?Object.assign(Object.assign(Object.assign(Object.assign({},zg(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),eA("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),eA("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),El("size",e,{vgChannel:"strokeWidth"})):{}}},square:{vgMark:"symbol",encodeEntry:e=>mI(e,"square")},text:{vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},zg(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),td("x",e,{defaultPos:"mid"})),td("y",e,{defaultPos:"mid"})),ON(e)),El("size",e,{vgChannel:"fontSize"})),El("angle",e)),_z("align",function(o,u,f){if(ns("align",o,f)===void 0)return"center"}(e.markDef,0,t))),_z("baseline",function(o,u,f){if(ns("baseline",o,f)===void 0)return"middle"}(e.markDef,0,t))),td("radius",e,{defaultPos:null,isMidPoint:!0})),td("theta",e,{defaultPos:null,isMidPoint:!0}))}},tick:{vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,o=n.orient,u=o==="horizontal"?"width":"height",f=o==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},zg(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),td("x",e,{defaultPos:"mid",vgChannel:"xc"})),td("y",e,{defaultPos:"mid",vgChannel:"yc"})),El("size",e,{defaultValue:function(g){var x;const{config:k,markDef:F}=g,{orient:V}=F,X=V==="horizontal"?"width":"height",te=g.getScaleComponent(V==="horizontal"?"x":"y"),ue=(x=ns("size",F,k,{vgChannel:X}))!==null&&x!==void 0?x:k.tick.bandSize;if(ue!==void 0)return ue;{const he=te?te.get("range"):void 0;return he&&vb(he)&&Cc(he.step)?3*he.step/4:3*$3(k.view,X)/4}}(e),vgChannel:u})),{[f]:uc(ns("thickness",n,t))})}},trail:{vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},zg(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),td("x",e,{defaultPos:"mid"})),td("y",e,{defaultPos:"mid"})),El("size",e)),MN(e))}};function Coe(e){return fo([b3,v3,_ee],e.mark)?function(t){const n=N9(t.mark,t.encoding),o=AA(t,{fromPrefix:n.length>0?Q7:""});return n.length>0?[{name:t.getName("pathgroup"),type:"group",from:{facet:{name:Q7+t.requestDataName(ed),data:t.requestDataName(ed),groupby:n}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:o}]:o}(e):fo([y3],e.mark)?function(t){const n=W4.some(o=>ns(o,t.markDef,t.config));if(t.stack&&!t.fieldDef("size")&&n){const[o]=AA(t,{fromPrefix:Z7}),u=t.scaleName(t.stack.fieldChannel),f=(te={})=>t.vgField(t.stack.fieldChannel,te),g=(te,ue)=>{const he=[f({prefix:"min",suffix:"start",expr:ue}),f({prefix:"max",suffix:"start",expr:ue}),f({prefix:"min",suffix:"end",expr:ue}),f({prefix:"max",suffix:"end",expr:ue})];return`${te}(${he.map(be=>`scale('${u}',${be})`).join(",")})`};let x,k;t.stack.fieldChannel==="x"?(x=Object.assign(Object.assign({},SE(o.encode.update,["y","yc","y2","height",...W4])),{x:{signal:g("min","datum")},x2:{signal:g("max","datum")},clip:{value:!0}}),k={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},o.encode.update=Object.assign(Object.assign({},r1(o.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(x=Object.assign(Object.assign({},SE(o.encode.update,["x","xc","x2","width"])),{y:{signal:g("min","datum")},y2:{signal:g("max","datum")},clip:{value:!0}}),k={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},o.encode.update=Object.assign(Object.assign({},r1(o.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const te of W4){const ue=Bx(te,t.markDef,t.config);o.encode.update[te]?(x[te]=o.encode.update[te],delete o.encode.update[te]):ue&&(x[te]=uc(ue)),ue&&(o.encode.update[te]={value:0})}const F=t.fieldDef(t.stack.groupbyChannel),V=mi(F)?[mi(F)]:[];return(F!=null&&F.bin||F!=null&&F.timeUnit)&&V.push(mi(F,{binSuffix:"end"})),(x=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((te,ue)=>{if(o.encode.update[ue])return Object.assign(Object.assign({},te),{[ue]:o.encode.update[ue]});{const he=Bx(ue,t.markDef,t.config);return he!==void 0?Object.assign(Object.assign({},te),{[ue]:uc(he)}):te}},x)).stroke&&(x.strokeForeground={value:!0},x.strokeOffset={value:0}),[{type:"group",from:{facet:{data:t.requestDataName(ed),name:Z7+t.requestDataName(ed),groupby:V,aggregate:{fields:[f({suffix:"start"}),f({suffix:"start"}),f({suffix:"end"}),f({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:x},marks:[{type:"group",encode:{update:k},marks:[o]}]}]}return AA(t)}(e):AA(e)}const Q7="faceted_path_",Z7="stack_group_";function AA(e,t={fromPrefix:""}){const{mark:n,markDef:o,config:u}=e,f=kc(o.clip,function(te){const ue=te.getScaleComponent("x"),he=te.getScaleComponent("y");return!!(ue&&ue.get("selectionExtent")||he&&he.get("selectionExtent"))||void 0}(e),function(te){const ue=te.component.projection;return!(!ue||ue.isFit)||void 0}(e)),g=C9(o),x=e.encoding.key,k=function(te){const{encoding:ue,stack:he,mark:be,markDef:Pe,config:Ue}=te,We=ue.order;if(!(!ao(We)&&f1(We)&&r8(We.value)||!We&&r8(ns("order",Pe,Ue)))){if((ao(We)||_i(We))&&!he)return A9(We,{expr:"datum"});if(Ox(be)){const at=Pe.orient==="horizontal"?"y":"x",st=ue[at];if(_i(st)){const dt=st.sort;return ao(dt)?{field:mi(st,{prefix:at,suffix:"sort_index",expr:"datum"})}:py(dt)?{field:mi({aggregate:lN(te.encoding)?dt.op:void 0,field:dt.field},{expr:"datum"})}:c9(dt)?{field:mi(te.fieldDef(dt.encoding),{expr:"datum"}),order:dt.order}:dt===null?void 0:{field:mi(st,{binSuffix:te.stack&&te.stack.impute?"mid":void 0,expr:"datum"})}}}}}(e),F=function(te){if(!te.component.selection)return null;const ue=fi(te.component.selection).length;let he=ue,be=te.parent;for(;be&&he===0;)he=fi(be.component.selection).length,be=be.parent;return he?{interactive:ue>0}:null}(e),V=ns("aria",o,u),X=kA[n].postEncodingTransform?kA[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:kA[n].vgMark},f?{clip:!0}:{}),g?{style:g}:{}),x?{key:x.field}:{}),k?{sort:k}:{}),F||{}),V===!1?{aria:V}:{}),{from:{data:t.fromPrefix+e.requestDataName(ed)},encode:{update:kA[n].encodeEntry(e)}}),X?{transform:X}:{})]}class eU extends q7{constructor(t,n,o,u={},f){var g,x;super(t,"unit",n,o,f,void 0,q9(t)?t.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const k=ry(t.mark)?t.mark.type:t.mark;this.markDef=Soe(t.mark,(g=t.encoding)!==null&&g!==void 0?g:{},f,{graticule:t.data&&AN(t.data)});const F=this.encoding=Mne((x=t.encoding)!==null&&x!==void 0?x:{},this.markDef,f);this.size=function({encoding:V,size:X}){for(const te of Bg){const ue=fy(te);vy(X[ue])&&my(V[te])&&(delete X[ue],ci(ae.stepDropped(ue)))}return X}({encoding:F,size:q9(t)?Object.assign(Object.assign(Object.assign({},u),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):u}),this.stack=Q9(k,F),this.specifiedScales=this.initScales(k,F),this.specifiedAxes=this.initAxes(F),this.specifiedLegends=this.initLegend(F),this.specifiedProjection=t.projection,this.selection=t.selection}get hasProjection(){const{encoding:t}=this,n=this.mark===v8,o=t&&Nee.some(u=>Ro(t[u]));return n||o}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return T3.reduce((o,u)=>{var f;const g=Xc(n[u]);return g&&(o[u]=(f=g.scale)!==null&&f!==void 0?f:{}),o},{})}initAxes(t){return Bg.reduce((n,o)=>{const u=t[o];if(Ro(u)||o===Tu&&Ro(t.x2)||o===$c&&Ro(t.y2)){const f=Ro(u)?u.axis:void 0;n[o]=f&&Object.assign({},f)}return n},{})}initLegend(t){return jee.reduce((n,o)=>{const u=Xc(t[o]);if(u&&function(f){switch(f){case kp:case uy:case cy:case c1:case Ap:case l1:case db:case hb:return!0;case lb:case fb:case Mx:return!1}}(o)){const f=u.legend;n[o]=f&&Object.assign({},f)}return n},{})}parseData(){this.component.data=CA(this)}parseLayoutSize(){(function(t){const{size:n,component:o}=t;for(const u of Bg){const f=fy(u);if(n[f]){const g=n[f];o.layoutSize.set(f,vy(g)?"step":g,!0)}else{const g=poe(t,f);o.layoutSize.set(f,g,!1)}}})(this)}parseSelections(){this.component.selection=function(t,n){var o;const u={},f=t.config.selection;for(const g of fi(n??{})){const x=na(n[g]),k=f[x.type],F=Qi(k,["fields","encodings"]);for(const te in F)te==="encodings"&&x.fields||te==="fields"&&x.encodings||(te==="mark"&&(x[te]=Object.assign(Object.assign({},F[te]),x[te])),x[te]!==void 0&&x[te]!==!0||(x[te]=(o=F[te])!==null&&o!==void 0?o:x[te]));const V=bu(g),X=u[V]=Object.assign(Object.assign({},x),{name:V,events:ta(x.on)?Sx(x.on,"scope"):na(x.on)});nA(X,te=>{te.has(X)&&te.parse&&te.parse(t,X,x,n[g])})}return u}(this,this.selection)}parseMarkGroup(){this.component.mark=Coe(this)}parseAxesAndHeaders(){this.component.axes=yoe(this)}assembleSelectionTopLevelSignals(t){return function(n,o){let u=!1;return Vx(n,(f,g)=>{const x=f.name,k=Oa(x+Wx);if(o.filter(F=>F.name===x).length===0){const F=f.resolve==="global"?"union":f.resolve,V=f.type==="multi"?", true)":")";o.push({name:f.name,update:`${Pz}(${k}, ${Oa(F)}${V}`})}u=!0,g.topLevelSignals&&(o=g.topLevelSignals(n,f,o)),nA(f,F=>{F.topLevelSignals&&(o=F.topLevelSignals(n,f,o))})}),u&&o.filter(f=>f.name==="unit").length===0&&o.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),IN(o)}(this,t)}assembleSignals(){return[...Zz(this),...function(t,n){return Vx(t,(o,u)=>{const f=o.name;let g=u.modifyExpr(t,o);n.push(...u.signals(t,o)),nA(o,x=>{x.signals&&(n=x.signals(t,o,n)),x.modifyExpr&&(g=x.modifyExpr(t,o,g))}),n.push({name:f+Are,on:[{events:{signal:o.name+by},update:`modify(${Oa(o.name+Wx)}, ${g})`}]})}),IN(n)}(this,[])]}assembleSelectionData(t){return function(n,o){const u=[...o];return Vx(n,f=>{const g={name:f.name+Wx};if(f.init){const x=f.project.items.map(F=>Qi(F,["signals"])),k=f.init.map(F=>i2(F,!1));g.values=f.type==="interval"?[{unit:p1(n,{escape:!1}),fields:x,values:k}]:k.map(F=>({unit:p1(n,{escape:!1}),fields:x,values:F}))}u.filter(x=>x.name===f.name+Wx).length||u.push(g)}),u}(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return JN(this)}assembleMarks(){var t;let n=(t=this.component.mark)!==null&&t!==void 0?t:[];return this.parent&&h2(this.parent)||(n=Iz(this,n)),n.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return jx(this.encoding,t)}fieldDef(t){return gy(this.encoding[t])}typedFieldDef(t){const n=this.fieldDef(t);return zm(n)?n:null}}class gI extends fI{constructor(t,n,o,u,f){super(t,"layer",n,o,f,t.resolve,t.view);const g=Object.assign(Object.assign(Object.assign({},u),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map((x,k)=>{if(X3(x))return new gI(x,this,this.getName("layer_"+k),g,f);if(i1(x))return new eU(x,this,this.getName("layer_"+k),g,f);throw new Error(ae.invalidSpec(x))})}parseData(){this.component.data=CA(this);for(const t of this.children)t.parseData()}parseLayoutSize(){(function(t){dI(t),SA(t,"width"),SA(t,"height")})(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of fi(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){(function(t){var n;const{axes:o,resolve:u}=t.component,f={top:0,bottom:0,right:0,left:0};for(const g of t.children){g.parseAxesAndHeaders();for(const x of fi(g.component.axes))u.axis[x]=QN(t.component.resolve,x),u.axis[x]==="shared"&&(o[x]=xoe(o[x],g.component.axes[x]),o[x]||(u.axis[x]="independent",delete o[x]))}for(const g of Bg){for(const x of t.children)if(x.component.axes[g]){if(u.axis[g]==="independent"){o[g]=((n=o[g])!==null&&n!==void 0?n:[]).concat(x.component.axes[g]);for(const k of x.component.axes[g]){const{value:F,explicit:V}=k.getWithExplicit("orient");if(!ko(F)){if(f[F]>0&&!V){const X=boe[F];f[F]>f[X]&&k.set("orient",X,!1)}f[F]++}}}delete x.component.axes[g]}if(u.axis[g]==="independent"&&o[g]&&o[g].length>1)for(const x of o[g])x.get("grid")&&!x.explicit.grid&&(x.implicit.grid=!1)}})(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,o)=>o.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),Zz(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),JN(this))}assembleSelectionData(t){return this.children.reduce((n,o)=>o.assembleSelectionData(n),t)}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle())return t}assembleLayout(){return null}assembleMarks(){return function(t,n){for(const o of t.children)Wu(o)&&(n=Iz(o,n));return n}(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),S7(this))}}function vI(e,t,n,o,u){if(L3(e))return new rS(e,t,n,u);if(X3(e))return new gI(e,t,n,o,u);if(i1(e))return new eU(e,t,n,o,u);if(function(f){return q3(f)||wN(f)||xN(f)}(e))return new goe(e,t,n,u);throw new Error(ae.invalidSpec(e))}function koe(e,t={}){t.logger&&function(n){N3=n}(t.logger),t.fieldTitle&&b9(t.fieldTitle);try{const n=K9(n8(t.config,e.config)),o=az(e,n),u=vI(o,null,"",void 0,n);return u.parse(),function(f,g){tI(f.sources);let x=0,k=0;for(let F=0;F<pA&&N7(f,g);F++)x++;f.sources.map(rI);for(let F=0;F<pA&&N7(f,g);F++)k++;tI(f.sources),Math.max(x,k)===pA&&ci(`Maximum optimization runs(${pA}) reached.`)}(u.component.data,u),{spec:function(f,g,x={},k){const F=f.config?Hne(f.config):void 0,V=[].concat(f.assembleSelectionData([]),function(Pe,Ue){var We,at;const st=[],dt=$7(st);let ct=0;for(const St of Pe.sources)St.hasName()||(St.dataName=`source_${ct++}`),dt(St,St.assemble());for(const St of st)St.transform.length===0&&delete St.transform;let kt=0;for(const[St,yn]of st.entries())((We=yn.transform)!==null&&We!==void 0?We:[]).length!==0||yn.source||st.splice(kt++,0,st.splice(St,1)[0]);for(const St of st)for(const yn of(at=St.transform)!==null&&at!==void 0?at:[])yn.type==="lookup"&&(yn.from=Pe.outputNodes[yn.from].getSource());for(const St of st)St.name in Ue&&(St.values=Ue[St.name]);return st}(f.component.data,x)),X=f.assembleProjections(),te=f.assembleTitle(),ue=f.assembleGroupStyle(),he=f.assembleGroupEncodeEntry(!0);let be=f.assembleLayoutSignals();return be=be.filter(Pe=>Pe.name!=="width"&&Pe.name!=="height"||Pe.value===void 0||(g[Pe.name]=+Pe.value,!1)),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},f.description?{description:f.description}:{}),g),te?{title:te}:{}),ue?{style:ue}:{}),he?{encode:{update:he}}:{}),{data:V}),X.length>0?{projections:X}:{}),f.assembleGroup([...be,...f.assembleSelectionTopLevelSignals([])])),F?{config:F}:{}),k?{usermeta:k}:{})}(u,function(f,g,x,k){const F=k.component.layoutSize.get("width"),V=k.component.layoutSize.get("height");if(g===void 0?(g={type:"pad"},k.hasAxisOrientSignalRef()&&(g.resize=!0)):ta(g)&&(g={type:g}),F&&V&&function(X){return X==="fit"||X==="fit-x"||X==="fit-y"}(g.type)){if(F==="step"&&V==="step")ci(ae.droppingFit()),g.type="pad";else if(F==="step"||V==="step"){const X=F==="step"?"width":"height";ci(ae.droppingFit(O3(X)));const te=X==="width"?"height":"width";g.type=function(ue){return ue?`fit-${O3(ue)}`:"fit"}(te)}}return Object.assign(Object.assign(Object.assign({},fi(g).length===1&&g.type?g.type==="pad"?{}:{autosize:g.type}:{autosize:g}),uz(x)),uz(f))}(e,o.autosize,n,u),e.datasets,e.usermeta),normalized:o}}finally{t.logger&&sne(),t.fieldTitle&&b9(v9)}}const Aoe=new class extends Y9{mapUnit(e,{config:t}){if(e.encoding){const{encoding:n,transform:o}=e,{bins:u,timeUnits:f,aggregate:g,groupby:x,encoding:k}=fN(n,t),F=[...o||[],...u,...f,...g.length===0?[]:[{aggregate:g,groupby:x}]];return Object.assign(Object.assign(Object.assign({},e),F.length>0?{transform:F}:{}),{encoding:k})}return e}};function Ooe(e,t){return Aoe.map(e,{config:t})}const Toe=eee.version;var tU=function(e){const[t,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}};const Moe={background:"#333",title:{color:"#fff",subtitleColor:"#fff"},style:{"guide-label":{fill:"#fff"},"guide-title":{fill:"#fff"}},axis:{domainColor:"#fff",gridColor:"#888",tickColor:"#fff"}},Doe={background:"#fff",arc:{fill:"#4572a7"},area:{fill:"#4572a7"},line:{stroke:"#4572a7",strokeWidth:2},path:{stroke:"#4572a7"},rect:{fill:"#4572a7"},shape:{stroke:"#4572a7"},symbol:{fill:"#4572a7",strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},Noe={arc:{fill:"#30a2da"},area:{fill:"#30a2da"},axis:{domainColor:"#cbcbcb",grid:!0,gridColor:"#cbcbcb",gridWidth:1,labelColor:"#999",labelFontSize:10,titleColor:"#333",tickColor:"#cbcbcb",tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:"#f0f0f0",group:{fill:"#f0f0f0"},legend:{labelColor:"#333",labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:"#333",titleFontSize:14,titlePadding:10},line:{stroke:"#30a2da",strokeWidth:2},path:{stroke:"#30a2da",strokeWidth:.5},rect:{fill:"#30a2da"},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:"#30a2da"},bar:{binSpacing:2,fill:"#30a2da",stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},Ioe={group:{fill:"#e5e5e5"},arc:{fill:"#000"},area:{fill:"#000"},line:{stroke:"#000"},path:{stroke:"#000"},rect:{fill:"#000"},shape:{stroke:"#000"},symbol:{fill:"#000",size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},yI="Benton Gothic Bold, sans-serif",iS={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},Foe={background:"#ffffff",title:{anchor:"start",color:"#000000",font:yI,fontSize:22,fontWeight:"normal"},arc:{fill:"#82c6df"},area:{fill:"#82c6df"},line:{stroke:"#82c6df",strokeWidth:2},path:{stroke:"#82c6df"},rect:{fill:"#82c6df"},shape:{stroke:"#82c6df"},symbol:{fill:"#82c6df",size:30},axis:{labelFont:"Benton Gothic, sans-serif",labelFontSize:11.5,labelFontWeight:"normal",titleFont:yI,titleFontSize:13,titleFontWeight:"normal"},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:"Benton Gothic, sans-serif",labelFontSize:11.5,symbolType:"square",titleFont:yI,titleFontSize:13,titleFontWeight:"normal"},range:{category:iS["category-6"],diverging:iS["fireandice-6"],heatmap:iS["fire-7"],ordinal:iS["fire-7"],ramp:iS["fire-7"]}},Roe={background:"#f9f9f9",arc:{fill:"#ab5787"},area:{fill:"#ab5787"},line:{stroke:"#ab5787"},path:{stroke:"#ab5787"},rect:{fill:"#ab5787"},shape:{stroke:"#ab5787"},symbol:{fill:"#ab5787",size:30},axis:{domainColor:"#979797",domainWidth:.5,gridWidth:.2,labelColor:"#979797",tickColor:"#979797",tickWidth:.2,titleColor:"#979797"},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},Poe={background:"#fff",arc:{fill:"#3e5c69"},area:{fill:"#3e5c69"},line:{stroke:"#3e5c69"},path:{stroke:"#3e5c69"},rect:{fill:"#3e5c69"},shape:{stroke:"#3e5c69"},symbol:{fill:"#3e5c69"},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},oS={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},Loe={background:"#FFFFFF",title:{anchor:"start",fontSize:18,font:"Lato"},axisX:{domain:!0,domainColor:"#000000",domainWidth:1,grid:!1,labelFontSize:12,labelFont:"Lato",labelAngle:0,tickColor:"#000000",tickSize:5,titleFontSize:12,titlePadding:10,titleFont:"Lato"},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:"#DEDDDD",gridWidth:1,labelFontSize:12,labelFont:"Lato",labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:"Lato",titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:"Lato",symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:"Lato",orient:"right",offset:10},view:{stroke:"transparent"},range:{category:oS["six-groups-cat-1"],diverging:oS["diverging-colors"],heatmap:oS["diverging-colors"],ordinal:oS["six-groups-seq"],ramp:oS["shades-blue"]},area:{fill:"#1696d2"},rect:{fill:"#1696d2"},line:{color:"#1696d2",stroke:"#1696d2",strokeWidth:5},trail:{color:"#1696d2",stroke:"#1696d2",strokeWidth:0,size:1},path:{stroke:"#1696d2",strokeWidth:.5},point:{filled:!0},text:{font:"Lato",color:"#1696d2",fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:"#1696d2",stroke:null}},arc:{fill:"#1696d2"},shape:{stroke:"#1696d2"},symbol:{fill:"#1696d2",size:30}},Boe={arc:{fill:"#3366CC"},area:{fill:"#3366CC"},path:{stroke:"#3366CC"},rect:{fill:"#3366CC"},shape:{stroke:"#3366CC"},symbol:{stroke:"#3366CC"},circle:{fill:"#3366CC"},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:"Arial, sans-serif",fontSize:12},"guide-title":{font:"Arial, sans-serif",fontSize:12},"group-title":{font:"Arial, sans-serif",fontSize:12}},title:{font:"Arial, sans-serif",fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:"#ccc",tickColor:"#ccc",domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},joe="2.10.0";var zoe=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black; }
  #vg-tooltip-element.visible {
    visibility: visible; }
  #vg-tooltip-element h2 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 13px; }
  #vg-tooltip-element img {
    max-width: 200px;
    max-height: 200px; }
  #vg-tooltip-element table {
    border-spacing: 0; }
    #vg-tooltip-element table tr {
      border: none; }
      #vg-tooltip-element table tr td {
        overflow: hidden;
        text-overflow: ellipsis;
        padding-top: 2px;
        padding-bottom: 2px; }
        #vg-tooltip-element table tr td.key {
          color: #808080;
          max-width: 150px;
          text-align: right;
          padding-right: 4px; }
        #vg-tooltip-element table tr td.value {
          display: block;
          max-width: 300px;
          max-height: 7em;
          text-align: left; }
  #vg-tooltip-element.dark-theme {
    background-color: rgba(32, 32, 32, 0.9);
    border: 1px solid #f5f5f5;
    color: white; }
    #vg-tooltip-element.dark-theme td.key {
      color: #bfbfbf; }
`;const nU="vg-tooltip-element",Uoe={offsetX:10,offsetY:10,id:nU,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")},maxDepth:2};function Woe(e,t,n){if(Object(Ce.B)(e))return`[${e.map(o=>t(Object(Ce.J)(o)?o:rU(o,n))).join(", ")}]`;if(Object(Ce.H)(e)){let o="";const u=e,{title:f,image:g}=u,x=function(F,V){var X={};for(var te in F)Object.prototype.hasOwnProperty.call(F,te)&&V.indexOf(te)<0&&(X[te]=F[te]);if(F!=null&&typeof Object.getOwnPropertySymbols=="function"){var ue=0;for(te=Object.getOwnPropertySymbols(F);ue<te.length;ue++)V.indexOf(te[ue])<0&&Object.prototype.propertyIsEnumerable.call(F,te[ue])&&(X[te[ue]]=F[te[ue]])}return X}(u,["title","image"]);f&&(o+=`<h2>${t(f)}</h2>`),g&&(o+=`<img src="${t(g)}">`);const k=Object.keys(x);if(k.length>0){o+="<table>";for(const F of k){let V=x[F];V!==void 0&&(Object(Ce.H)(V)&&(V=rU(V,n)),o+=`<tr><td class="key">${t(F)}:</td><td class="value">${t(V)}</td></tr>`)}o+="</table>"}return o||"{}"}return t(e)}function rU(e,t){return JSON.stringify(e,function(n){const o=[];return function(u,f){if(typeof f!="object"||f===null)return f;const g=o.indexOf(this)+1;return o.length=g,o.length>n?"[Object]":o.indexOf(f)>=0?"[Circular]":(o.push(f),f)}}(t))}class Voe{constructor(t){this.options=Object.assign(Object.assign({},Uoe),t);const n=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const o=document.createElement("style");o.setAttribute("id",this.options.styleId),o.innerHTML=function(f){if(!/^[A-Za-z]+[-:.\w]*$/.test(f))throw new Error("Invalid HTML ID");return zoe.toString().replace(nU,f)}(n);const u=document.head;u.childNodes.length>0?u.insertBefore(o,u.childNodes[0]):u.appendChild(o)}}tooltipHandler(t,n,o,u){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el)),(document.fullscreenElement!=null?document.fullscreenElement:document.body).appendChild(this.el),u==null||u==="")return void this.el.classList.remove("visible",`${this.options.theme}-theme`);this.el.innerHTML=Woe(u,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:f,y:g}=function(x,k,F,V){let X=x.clientX+F;X+k.width>window.innerWidth&&(X=+x.clientX-F-k.width);let te=x.clientY+V;return te+k.height>window.innerHeight&&(te=+x.clientY-V-k.height),{x:X,y:te}}(n,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${g}px; left: ${f}px`)}}function OA(e,t,n,o){return new(n||(n=Promise))(function(u,f){function g(F){try{k(o.next(F))}catch(V){f(V)}}function x(F){try{k(o.throw(F))}catch(V){f(V)}}function k(F){F.done?u(F.value):function(V){return V instanceof n?V:new n(function(X){X(V)})}(F.value).then(g,x)}k((o=o.apply(e,t||[])).next())})}r.d(a,"DEFAULT_ACTIONS",function(){return oU}),r.d(a,"guessMode",function(){return sU}),r.d(a,"vega",function(){return b1}),r.d(a,"vegaLite",function(){return m2});var bI,Hoe=`.vega-embed {
  position: relative;
  display: inline-block;
  box-sizing: border-box; }
  .vega-embed.has-actions {
    padding-right: 38px; }
  .vega-embed details:not([open]) > :not(summary) {
    display: none !important; }
  .vega-embed summary {
    list-style: none;
    position: absolute;
    top: 0;
    right: 0;
    padding: 6px;
    z-index: 1000;
    background: white;
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
    color: #1b1e23;
    border: 1px solid #aaa;
    border-radius: 999px;
    opacity: 0.2;
    transition: opacity 0.4s ease-in;
    outline: none;
    cursor: pointer;
    line-height: 0px; }
    .vega-embed summary::-webkit-details-marker {
      display: none; }
    .vega-embed summary:active {
      box-shadow: #aaa 0px 0px 0px 1px inset; }
    .vega-embed summary svg {
      width: 14px;
      height: 14px; }
  .vega-embed details[open] summary {
    opacity: 0.7; }
  .vega-embed:hover summary,
  .vega-embed:focus summary {
    opacity: 1 !important;
    transition: opacity 0.2s ease; }
  .vega-embed .vega-actions {
    position: absolute;
    z-index: 1001;
    top: 35px;
    right: -9px;
    display: flex;
    flex-direction: column;
    padding-bottom: 8px;
    padding-top: 8px;
    border-radius: 4px;
    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
    border: 1px solid #d9d9d9;
    background: white;
    animation-duration: 0.15s;
    animation-name: scale-in;
    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
    text-align: left; }
    .vega-embed .vega-actions a {
      padding: 8px 16px;
      font-family: sans-serif;
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      color: #434a56;
      text-decoration: none; }
      .vega-embed .vega-actions a:hover {
        background-color: #f7f7f9;
        color: black; }
    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
      content: "";
      display: inline-block;
      position: absolute; }
    .vega-embed .vega-actions::before {
      left: auto;
      right: 14px;
      top: -16px;
      border: 8px solid #0000;
      border-bottom-color: #d9d9d9; }
    .vega-embed .vega-actions::after {
      left: auto;
      right: 15px;
      top: -14px;
      border: 7px solid #0000;
      border-bottom-color: #fff; }
  .vega-embed .chart-wrapper {
    width: 100%;
    height: 100%; }

.vega-embed-wrapper {
  max-width: 100%;
  overflow: auto;
  padding-right: 14px; }

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6); }
  to {
    opacity: 1;
    transform: scale(1); } }
`;function iU(e,...t){for(const n of t)Goe(e,n);return e}function Goe(e,t){for(const n of Object.keys(t))Object(Ce.La)(e,n,t[n],!0)}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});const b1=q;let m2=oe;const TA=typeof window<"u"?window:void 0;m2===void 0&&(!((bI=TA==null?void 0:TA.vl)===null||bI===void 0)&&bI.compile)&&(m2=TA.vl);const oU={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},qoe={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},aS={vega:"Vega","vega-lite":"Vega-Lite"},MA={vega:b1.version,"vega-lite":m2?m2.version:"not available"},$oe={vega:e=>e,"vega-lite":(e,t)=>m2.compile(e,{config:t}).spec},Xoe=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`,Koe="chart-wrapper";function aU(e,t,n,o){const u=`<html><head>${t}</head><body><pre><code class="json">`,f=`</code></pre>${n}</body></html>`,g=window.open("");g.document.write(u+e+f),g.document.title=`${aS[o]} JSON Source`}function sU(e,t){var n;if(e.$schema){const o=tU(e.$schema);t&&t!==o.library&&console.warn(`The given visualization spec is written in ${aS[o.library]}, but mode argument sets ${(n=aS[t])!==null&&n!==void 0?n:t}.`);const u=o.library;return Object(Qn.satisfies)(MA[u],`^${o.version.slice(1)}`)||console.warn(`The input spec uses ${aS[u]} ${o.version}, but the current version of ${aS[u]} is v${MA[u]}.`),u}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":t??"vega"}function uU(e){return function(t){return!!(t&&"load"in t)}(e)?e:b1.loader(e)}function cU(e){var t;return(t=e.usermeta&&e.usermeta.embedOptions)!==null&&t!==void 0?t:{}}function lU(e,t){var n;return OA(this,void 0,void 0,function*(){const o=Object(Ce.J)(e.config)?JSON.parse(yield t.load(e.config)):(n=e.config)!==null&&n!==void 0?n:{},u=Object(Ce.J)(e.patch)?JSON.parse(yield t.load(e.patch)):e.patch;return Object.assign(Object.assign(Object.assign({},e),u?{patch:u}:{}),o?{config:o}:{})})}a.default=function(e,t,n={}){var o,u,f;return OA(this,void 0,void 0,function*(){let g,x;Object(Ce.J)(t)?(x=uU(n.loader),g=JSON.parse(yield x.load(t))):g=t;const k=cU(g).loader;x&&!k||(x=uU((o=n.loader)!==null&&o!==void 0?o:k));const F=yield lU(cU(g),x),V=yield lU(n,x),X=Object.assign(Object.assign({},iU(V,F)),{config:Object(Ce.P)((u=V.config)!==null&&u!==void 0?u:{},(f=F.config)!==null&&f!==void 0?f:{})});return yield function(te,ue,he={},be){var Pe,Ue,We,at,st,dt;return OA(this,void 0,void 0,function*(){const ct=he.theme?Object(Ce.P)(ye[he.theme],(Pe=he.config)!==null&&Pe!==void 0?Pe:{}):he.config,kt=Object(Ce.C)(he.actions)?he.actions:iU({},oU,(Ue=he.actions)!==null&&Ue!==void 0?Ue:{}),St=Object.assign(Object.assign({},qoe),he.i18n),yn=(We=he.renderer)!==null&&We!==void 0?We:"canvas",Mn=(at=he.logLevel)!==null&&at!==void 0?at:b1.Warn,_n=(st=he.downloadFileName)!==null&&st!==void 0?st:"visualization",$n=typeof te=="string"?document.querySelector(te):te;if(!$n)throw new Error(`${te} does not exist`);if(he.defaultStyle!==!1){const Di="vega-embed-style",{root:Zi,rootContainer:Ri}=function(Ni){var Ui;const To=Ni.getRootNode?Ni.getRootNode():document;return To instanceof ShadowRoot?{root:To,rootContainer:To}:{root:document,rootContainer:(Ui=document.head)!==null&&Ui!==void 0?Ui:document.body}}($n);if(!Zi.getElementById(Di)){const Ni=document.createElement("style");Ni.id=Di,Ni.innerText=he.defaultStyle===void 0||he.defaultStyle===!0?Hoe.toString():he.defaultStyle,Ri.appendChild(Ni)}}const qn=sU(ue,he.mode);let er=$oe[qn](ue,ct);if(qn==="vega-lite"&&er.$schema){const Di=tU(er.$schema);Object(Qn.satisfies)(MA.vega,`^${Di.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${Di.version}, but current version is v${MA.vega}.`)}$n.classList.add("vega-embed"),kt&&$n.classList.add("has-actions"),$n.innerHTML="";let rr=$n;if(kt){const Di=document.createElement("div");Di.classList.add(Koe),$n.appendChild(Di),rr=Di}const fr=he.patch;fr&&(er=fr instanceof Function?fr(er):rn(er,fr,!0,!1).newDocument),he.formatLocale&&b1.formatLocale(he.formatLocale),he.timeFormatLocale&&b1.timeFormatLocale(he.timeFormatLocale);const{ast:Dr}=he,Zr=b1.parse(er,qn==="vega-lite"?{}:ct,{ast:Dr}),Br=new(he.viewClass||b1.View)(Zr,Object.assign({loader:be,logLevel:Mn,renderer:yn},Dr?{expr:b1.expressionInterpreter}:{}));if(he.tooltip!==!1){let Di;Di=function(Zi){return typeof Zi=="function"}(he.tooltip)?he.tooltip:new Voe(he.tooltip===!0?{}:he.tooltip).call,Br.tooltip(Di)}let di,{hover:Ti}=he;if(Ti===void 0&&(Ti=qn==="vega"),Ti){const{hoverSet:Di,updateSet:Zi}=typeof Ti=="boolean"?{}:Ti;Br.hover(Di,Zi)}if(he&&(he.width!=null&&Br.width(he.width),he.height!=null&&Br.height(he.height),he.padding!=null&&Br.padding(he.padding)),yield Br.initialize(rr,he.bind).runAsync(),kt!==!1){let Di=$n;if(he.defaultStyle!==!1){const Ri=document.createElement("details");Ri.title=St.CLICK_TO_VIEW_ACTIONS,$n.append(Ri),Di=Ri;const Ni=document.createElement("summary");Ni.innerHTML=Xoe,Ri.append(Ni),di=Ui=>{Ri.contains(Ui.target)||Ri.removeAttribute("open")},document.addEventListener("click",di)}const Zi=document.createElement("div");if(Di.append(Zi),Zi.classList.add("vega-actions"),kt===!0||kt.export!==!1){for(const Ri of["svg","png"])if(kt===!0||kt.export===!0||kt.export[Ri]){const Ni=St[`${Ri.toUpperCase()}_ACTION`],Ui=document.createElement("a");Ui.text=Ni,Ui.href="#",Ui.target="_blank",Ui.download=`${_n}.${Ri}`,Ui.addEventListener("mousedown",function(To){return OA(this,void 0,void 0,function*(){To.preventDefault();const da=yield Br.toImageURL(Ri,he.scaleFactor);this.href=da})}),Zi.append(Ui)}}if(kt===!0||kt.source!==!1){const Ri=document.createElement("a");Ri.text=St.SOURCE_ACTION,Ri.href="#",Ri.addEventListener("click",function(Ni){var Ui,To;aU(An()(ue),(Ui=he.sourceHeader)!==null&&Ui!==void 0?Ui:"",(To=he.sourceFooter)!==null&&To!==void 0?To:"",qn),Ni.preventDefault()}),Zi.append(Ri)}if(qn==="vega-lite"&&(kt===!0||kt.compiled!==!1)){const Ri=document.createElement("a");Ri.text=St.COMPILED_ACTION,Ri.href="#",Ri.addEventListener("click",function(Ni){var Ui,To;aU(An()(er),(Ui=he.sourceHeader)!==null&&Ui!==void 0?Ui:"",(To=he.sourceFooter)!==null&&To!==void 0?To:"","vega"),Ni.preventDefault()}),Zi.append(Ri)}if(kt===!0||kt.editor!==!1){const Ri=(dt=he.editorUrl)!==null&&dt!==void 0?dt:"https://vega.github.io/editor/",Ni=document.createElement("a");Ni.text=St.EDITOR_ACTION,Ni.href="#",Ni.addEventListener("click",function(Ui){(function(To,da,eo){const Ta=To.open(da),Ma=250,{origin:rs}=new URL(da);let Gs=~~(1e4/Ma);To.addEventListener("message",function qs(Ms){Ms.source===Ta&&(Gs=0,To.removeEventListener("message",qs,!1))},!1),setTimeout(function qs(){Gs<=0||(Ta.postMessage(eo,rs),setTimeout(qs,Ma),Gs-=1)},Ma)})(window,Ri,{config:ct,mode:qn,renderer:yn,spec:An()(ue)}),Ui.preventDefault()}),Zi.append(Ni)}}return{view:Br,spec:ue,vgSpec:er,finalize:function(){di&&document.removeEventListener("click",di),Br.finalize()}}})}(e,g,X,x)})}},function(s,a,r){const{MAX_LENGTH:c}=r(117),{re:S,t:E}=r(90),A=r(32),U=r(115);s.exports=(B,D)=>{if(D=U(D),B instanceof A)return B;if(typeof B!="string"||B.length>c||!(D.loose?S[E.LOOSE]:S[E.FULL]).test(B))return null;try{return new A(B,D)}catch{return null}}},function(s,a,r){const{MAX_SAFE_COMPONENT_LENGTH:c}=r(117),S=r(116),E=(a=s.exports={}).re=[],A=a.src=[],U=a.t={};let B=0;const D=(R,W,j)=>{const H=B++;S(H,W),U[R]=H,A[H]=W,E[H]=new RegExp(W,j?"g":void 0)};D("NUMERICIDENTIFIER","0|[1-9]\\d*"),D("NUMERICIDENTIFIERLOOSE","[0-9]+"),D("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),D("MAINVERSION",`(${A[U.NUMERICIDENTIFIER]})\\.(${A[U.NUMERICIDENTIFIER]})\\.(${A[U.NUMERICIDENTIFIER]})`),D("MAINVERSIONLOOSE",`(${A[U.NUMERICIDENTIFIERLOOSE]})\\.(${A[U.NUMERICIDENTIFIERLOOSE]})\\.(${A[U.NUMERICIDENTIFIERLOOSE]})`),D("PRERELEASEIDENTIFIER",`(?:${A[U.NUMERICIDENTIFIER]}|${A[U.NONNUMERICIDENTIFIER]})`),D("PRERELEASEIDENTIFIERLOOSE",`(?:${A[U.NUMERICIDENTIFIERLOOSE]}|${A[U.NONNUMERICIDENTIFIER]})`),D("PRERELEASE",`(?:-(${A[U.PRERELEASEIDENTIFIER]}(?:\\.${A[U.PRERELEASEIDENTIFIER]})*))`),D("PRERELEASELOOSE",`(?:-?(${A[U.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${A[U.PRERELEASEIDENTIFIERLOOSE]})*))`),D("BUILDIDENTIFIER","[0-9A-Za-z-]+"),D("BUILD",`(?:\\+(${A[U.BUILDIDENTIFIER]}(?:\\.${A[U.BUILDIDENTIFIER]})*))`),D("FULLPLAIN",`v?${A[U.MAINVERSION]}${A[U.PRERELEASE]}?${A[U.BUILD]}?`),D("FULL",`^${A[U.FULLPLAIN]}$`),D("LOOSEPLAIN",`[v=\\s]*${A[U.MAINVERSIONLOOSE]}${A[U.PRERELEASELOOSE]}?${A[U.BUILD]}?`),D("LOOSE",`^${A[U.LOOSEPLAIN]}$`),D("GTLT","((?:<|>)?=?)"),D("XRANGEIDENTIFIERLOOSE",`${A[U.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),D("XRANGEIDENTIFIER",`${A[U.NUMERICIDENTIFIER]}|x|X|\\*`),D("XRANGEPLAIN",`[v=\\s]*(${A[U.XRANGEIDENTIFIER]})(?:\\.(${A[U.XRANGEIDENTIFIER]})(?:\\.(${A[U.XRANGEIDENTIFIER]})(?:${A[U.PRERELEASE]})?${A[U.BUILD]}?)?)?`),D("XRANGEPLAINLOOSE",`[v=\\s]*(${A[U.XRANGEIDENTIFIERLOOSE]})(?:\\.(${A[U.XRANGEIDENTIFIERLOOSE]})(?:\\.(${A[U.XRANGEIDENTIFIERLOOSE]})(?:${A[U.PRERELEASELOOSE]})?${A[U.BUILD]}?)?)?`),D("XRANGE",`^${A[U.GTLT]}\\s*${A[U.XRANGEPLAIN]}$`),D("XRANGELOOSE",`^${A[U.GTLT]}\\s*${A[U.XRANGEPLAINLOOSE]}$`),D("COERCE",`(^|[^\\d])(\\d{1,${c}})(?:\\.(\\d{1,${c}}))?(?:\\.(\\d{1,${c}}))?(?:$|[^\\d])`),D("COERCERTL",A[U.COERCE],!0),D("LONETILDE","(?:~>?)"),D("TILDETRIM",`(\\s*)${A[U.LONETILDE]}\\s+`,!0),a.tildeTrimReplace="$1~",D("TILDE",`^${A[U.LONETILDE]}${A[U.XRANGEPLAIN]}$`),D("TILDELOOSE",`^${A[U.LONETILDE]}${A[U.XRANGEPLAINLOOSE]}$`),D("LONECARET","(?:\\^)"),D("CARETTRIM",`(\\s*)${A[U.LONECARET]}\\s+`,!0),a.caretTrimReplace="$1^",D("CARET",`^${A[U.LONECARET]}${A[U.XRANGEPLAIN]}$`),D("CARETLOOSE",`^${A[U.LONECARET]}${A[U.XRANGEPLAINLOOSE]}$`),D("COMPARATORLOOSE",`^${A[U.GTLT]}\\s*(${A[U.LOOSEPLAIN]})$|^$`),D("COMPARATOR",`^${A[U.GTLT]}\\s*(${A[U.FULLPLAIN]})$|^$`),D("COMPARATORTRIM",`(\\s*)${A[U.GTLT]}\\s*(${A[U.LOOSEPLAIN]}|${A[U.XRANGEPLAIN]})`,!0),a.comparatorTrimReplace="$1$2$3",D("HYPHENRANGE",`^\\s*(${A[U.XRANGEPLAIN]})\\s+-\\s+(${A[U.XRANGEPLAIN]})\\s*$`),D("HYPHENRANGELOOSE",`^\\s*(${A[U.XRANGEPLAINLOOSE]})\\s+-\\s+(${A[U.XRANGEPLAINLOOSE]})\\s*$`),D("STAR","(<|>)?=?\\s*\\*"),D("GTE0","^\\s*>=\\s*0.0.0\\s*$"),D("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(25),S=r(103),E=r(29),A=r(21),U=r(373),B=r(28);function D(j,H,I,Q){if(Q==null&&(Q=A.inferDtype(j)),Q==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!A.isTypedArray(j)&&!Array.isArray(j)&&typeof j!="number"&&typeof j!="boolean"&&typeof j!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(H!=null){A.assertNonNegativeIntegerDimensions(H);var Y=A.sizeFromShape(H),q=A.sizeFromShape(I);A.assert(Y===q,function(){return"Based on the provided shape, ["+H+"], the tensor should have "+Y+" values but has "+q});for(var ae=0;ae<I.length;++ae){var oe=I[ae],ye=ae!==I.length-1||oe!==A.sizeFromShape(H.slice(ae));A.assert(I[ae]===H[ae]||!ye,function(){return"Error creating a new Tensor. Inferred shape ("+I+") does not match the provided shape ("+H+"). "})}}return A.isTypedArray(j)||Array.isArray(j)||(j=[j]),H=H||I,j=Q!=="string"?A.toTypedArray(j,Q,S.env().getBool("DEBUG")):A.flatten(j,[],!0),c.ENGINE.makeTensor(j,H,Q)}function R(j,H){A.assertNonNull(j);var I=E.inferShape(j,H);if(I.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return D(j,null,I,H)}function W(j,H){if(H===void 0&&(H="float32"),H==="complex64"){var I=W(j,"float32"),Q=W(j,"float32");return U.complex(I,Q)}var Y=A.makeZerosTypedArray(A.sizeFromShape(j),H);return c.ENGINE.makeTensor(Y,j,H)}a.tensor=function(j,H,I){return D(j,H,E.inferShape(j,I),I)},a.scalar=function(j,H){if((A.isTypedArray(j)&&H!=="string"||Array.isArray(j))&&H!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(H==="string"&&A.isTypedArray(j)&&!(j instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return D(j,[],[],H)},a.tensor1d=R,a.tensor2d=function(j,H,I){if(A.assertNonNull(j),H!=null&&H.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var Q=E.inferShape(j,I);if(Q.length!==2&&Q.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(Q.length===1&&H==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return D(j,H,Q,I)},a.tensor3d=function(j,H,I){if(A.assertNonNull(j),H!=null&&H.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var Q=E.inferShape(j,I);if(Q.length!==3&&Q.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(Q.length===1&&H==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return D(j,H,Q,I)},a.tensor4d=function(j,H,I){if(A.assertNonNull(j),H!=null&&H.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var Q=E.inferShape(j,I);if(Q.length!==4&&Q.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(Q.length===1&&H==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return D(j,H,Q,I)},a.tensor5d=function(j,H,I){if(A.assertNonNull(j),H!=null&&H.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var Q=E.inferShape(j,I);if(Q.length!==5&&Q.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(Q.length===1&&H==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return D(j,H,Q,I)},a.tensor6d=function(j,H,I){if(A.assertNonNull(j),H!=null&&H.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var Q=E.inferShape(j,I);if(Q.length!==6&&Q.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(Q.length===1&&H==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return D(j,H=H||Q,Q,I)},a.variable=function(j,H,I,Q){return H===void 0&&(H=!0),c.ENGINE.makeVariable(j,H,I,Q)},a.ones=function j(H,I){if(I===void 0&&(I="float32"),I==="complex64"){var Q=j(H,"float32"),Y=W(H,"float32");return U.complex(Q,Y)}var q=A.makeOnesTypedArray(A.sizeFromShape(H),I);return c.ENGINE.makeTensor(q,H,I)},a.zeros=W,a.fill=function(j,H,I){return c.ENGINE.runKernelFunc(function(Q){return Q.fill(j,H,I)},{})},a.linspace=function(j,H,I){if(I<=0)throw new Error("The number of values should be positive.");return c.ENGINE.runKernelFunc(function(Q){return Q.linspace(j,H,I)},{})},a.range=function(j,H,I,Q){if(I===void 0&&(I=1),Q===void 0&&(Q="float32"),I===0)throw new Error("Cannot have a step of zero");if(j===H||j<H&&I<0||H<j&&I>1)return W([0],Q);var Y=Math.abs(Math.ceil((H-j)/I)),q=A.makeZerosTypedArray(Y,Q);H<j&&I===1&&(I=-1),q[0]=j;for(var ae=1;ae<q.length;ae++)q[ae]=q[ae-1]+I;return R(q,Q)},a.onesLike=B.op({onesLike_:function(j){var H=E.convertToTensor(j,"x","onesLike");if(H.dtype==="complex64"){var I=a.onesLike(U.real(H)),Q=a.zerosLike(U.imag(H));return U.complex(I,Q)}return c.ENGINE.runKernelFunc(function(Y){return Y.onesLike(H)},{x:H},function(Y,q){return{x:function(){return a.zerosLike(Y)}}},"OnesLike")}}),a.zerosLike=B.op({zerosLike_:function(j){var H=E.convertToTensor(j,"x","zerosLike");return c.ENGINE.runKernelFunc(function(I){return I.zerosLike(H)},{x:H},function(I,Q){return{x:function(){return a.zerosLike(I)}}},"ZerosLike")}})},function(s,a,r){(function(c){var S=r(394),E=r(393),A=r(392);function U(){return D.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function B(Ve,Ye){if(U()<Ye)throw new RangeError("Invalid typed array length");return D.TYPED_ARRAY_SUPPORT?(Ve=new Uint8Array(Ye)).__proto__=D.prototype:(Ve===null&&(Ve=new D(Ye)),Ve.length=Ye),Ve}function D(Ve,Ye,$e){if(!(D.TYPED_ARRAY_SUPPORT||this instanceof D))return new D(Ve,Ye,$e);if(typeof Ve=="number"){if(typeof Ye=="string")throw new Error("If encoding is specified then the first argument must be a string");return j(this,Ve)}return R(this,Ve,Ye,$e)}function R(Ve,Ye,$e,ft){if(typeof Ye=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&Ye instanceof ArrayBuffer?function($t,Jt,Pn,An){if(Jt.byteLength,Pn<0||Jt.byteLength<Pn)throw new RangeError("'offset' is out of bounds");if(Jt.byteLength<Pn+(An||0))throw new RangeError("'length' is out of bounds");return Jt=Pn===void 0&&An===void 0?new Uint8Array(Jt):An===void 0?new Uint8Array(Jt,Pn):new Uint8Array(Jt,Pn,An),D.TYPED_ARRAY_SUPPORT?($t=Jt).__proto__=D.prototype:$t=H($t,Jt),$t}(Ve,Ye,$e,ft):typeof Ye=="string"?function($t,Jt,Pn){if(typeof Pn=="string"&&Pn!==""||(Pn="utf8"),!D.isEncoding(Pn))throw new TypeError('"encoding" must be a valid string encoding');var An=0|Q(Jt,Pn),Qn=($t=B($t,An)).write(Jt,Pn);return Qn!==An&&($t=$t.slice(0,Qn)),$t}(Ve,Ye,$e):function($t,Jt){if(D.isBuffer(Jt)){var Pn=0|I(Jt.length);return($t=B($t,Pn)).length===0||Jt.copy($t,0,0,Pn),$t}if(Jt){if(typeof ArrayBuffer<"u"&&Jt.buffer instanceof ArrayBuffer||"length"in Jt)return typeof Jt.length!="number"||function(An){return An!=An}(Jt.length)?B($t,0):H($t,Jt);if(Jt.type==="Buffer"&&A(Jt.data))return H($t,Jt.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(Ve,Ye)}function W(Ve){if(typeof Ve!="number")throw new TypeError('"size" argument must be a number');if(Ve<0)throw new RangeError('"size" argument must not be negative')}function j(Ve,Ye){if(W(Ye),Ve=B(Ve,Ye<0?0:0|I(Ye)),!D.TYPED_ARRAY_SUPPORT)for(var $e=0;$e<Ye;++$e)Ve[$e]=0;return Ve}function H(Ve,Ye){var $e=Ye.length<0?0:0|I(Ye.length);Ve=B(Ve,$e);for(var ft=0;ft<$e;ft+=1)Ve[ft]=255&Ye[ft];return Ve}function I(Ve){if(Ve>=U())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+U().toString(16)+" bytes");return 0|Ve}function Q(Ve,Ye){if(D.isBuffer(Ve))return Ve.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(Ve)||Ve instanceof ArrayBuffer))return Ve.byteLength;typeof Ve!="string"&&(Ve=""+Ve);var $e=Ve.length;if($e===0)return 0;for(var ft=!1;;)switch(Ye){case"ascii":case"latin1":case"binary":return $e;case"utf8":case"utf-8":case void 0:return sn(Ve).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*$e;case"hex":return $e>>>1;case"base64":return kn(Ve).length;default:if(ft)return sn(Ve).length;Ye=(""+Ye).toLowerCase(),ft=!0}}function Y(Ve,Ye,$e){var ft=Ve[Ye];Ve[Ye]=Ve[$e],Ve[$e]=ft}function q(Ve,Ye,$e,ft,$t){if(Ve.length===0)return-1;if(typeof $e=="string"?(ft=$e,$e=0):$e>2147483647?$e=2147483647:$e<-2147483648&&($e=-2147483648),$e=+$e,isNaN($e)&&($e=$t?0:Ve.length-1),$e<0&&($e=Ve.length+$e),$e>=Ve.length){if($t)return-1;$e=Ve.length-1}else if($e<0){if(!$t)return-1;$e=0}if(typeof Ye=="string"&&(Ye=D.from(Ye,ft)),D.isBuffer(Ye))return Ye.length===0?-1:ae(Ve,Ye,$e,ft,$t);if(typeof Ye=="number")return Ye&=255,D.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?$t?Uint8Array.prototype.indexOf.call(Ve,Ye,$e):Uint8Array.prototype.lastIndexOf.call(Ve,Ye,$e):ae(Ve,[Ye],$e,ft,$t);throw new TypeError("val must be string, number or Buffer")}function ae(Ve,Ye,$e,ft,$t){var Jt,Pn=1,An=Ve.length,Qn=Ye.length;if(ft!==void 0&&((ft=String(ft).toLowerCase())==="ucs2"||ft==="ucs-2"||ft==="utf16le"||ft==="utf-16le")){if(Ve.length<2||Ye.length<2)return-1;Pn=2,An/=2,Qn/=2,$e/=2}function Ce(Gt,Hn){return Pn===1?Gt[Hn]:Gt.readUInt16BE(Hn*Pn)}if($t){var sr=-1;for(Jt=$e;Jt<An;Jt++)if(Ce(Ve,Jt)===Ce(Ye,sr===-1?0:Jt-sr)){if(sr===-1&&(sr=Jt),Jt-sr+1===Qn)return sr*Pn}else sr!==-1&&(Jt-=Jt-sr),sr=-1}else for($e+Qn>An&&($e=An-Qn),Jt=$e;Jt>=0;Jt--){for(var Mr=!0,on=0;on<Qn;on++)if(Ce(Ve,Jt+on)!==Ce(Ye,on)){Mr=!1;break}if(Mr)return Jt}return-1}function oe(Ve,Ye,$e,ft){$e=Number($e)||0;var $t=Ve.length-$e;ft?(ft=Number(ft))>$t&&(ft=$t):ft=$t;var Jt=Ye.length;if(Jt%2!=0)throw new TypeError("Invalid hex string");ft>Jt/2&&(ft=Jt/2);for(var Pn=0;Pn<ft;++Pn){var An=parseInt(Ye.substr(2*Pn,2),16);if(isNaN(An))return Pn;Ve[$e+Pn]=An}return Pn}function ye(Ve,Ye,$e,ft){return an(sn(Ye,Ve.length-$e),Ve,$e,ft)}function _e(Ve,Ye,$e,ft){return an(function($t){for(var Jt=[],Pn=0;Pn<$t.length;++Pn)Jt.push(255&$t.charCodeAt(Pn));return Jt}(Ye),Ve,$e,ft)}function pe(Ve,Ye,$e,ft){return _e(Ve,Ye,$e,ft)}function me(Ve,Ye,$e,ft){return an(kn(Ye),Ve,$e,ft)}function Ge(Ve,Ye,$e,ft){return an(function($t,Jt){for(var Pn,An,Qn,Ce=[],sr=0;sr<$t.length&&!((Jt-=2)<0);++sr)Pn=$t.charCodeAt(sr),An=Pn>>8,Qn=Pn%256,Ce.push(Qn),Ce.push(An);return Ce}(Ye,Ve.length-$e),Ve,$e,ft)}function lt(Ve,Ye,$e){return Ye===0&&$e===Ve.length?S.fromByteArray(Ve):S.fromByteArray(Ve.slice(Ye,$e))}function It(Ve,Ye,$e){$e=Math.min(Ve.length,$e);for(var ft=[],$t=Ye;$t<$e;){var Jt,Pn,An,Qn,Ce=Ve[$t],sr=null,Mr=Ce>239?4:Ce>223?3:Ce>191?2:1;if($t+Mr<=$e)switch(Mr){case 1:Ce<128&&(sr=Ce);break;case 2:(192&(Jt=Ve[$t+1]))==128&&(Qn=(31&Ce)<<6|63&Jt)>127&&(sr=Qn);break;case 3:Jt=Ve[$t+1],Pn=Ve[$t+2],(192&Jt)==128&&(192&Pn)==128&&(Qn=(15&Ce)<<12|(63&Jt)<<6|63&Pn)>2047&&(Qn<55296||Qn>57343)&&(sr=Qn);break;case 4:Jt=Ve[$t+1],Pn=Ve[$t+2],An=Ve[$t+3],(192&Jt)==128&&(192&Pn)==128&&(192&An)==128&&(Qn=(15&Ce)<<18|(63&Jt)<<12|(63&Pn)<<6|63&An)>65535&&Qn<1114112&&(sr=Qn)}sr===null?(sr=65533,Mr=1):sr>65535&&(sr-=65536,ft.push(sr>>>10&1023|55296),sr=56320|1023&sr),ft.push(sr),$t+=Mr}return function(on){var Gt=on.length;if(Gt<=wt)return String.fromCharCode.apply(String,on);for(var Hn="",Kt=0;Kt<Gt;)Hn+=String.fromCharCode.apply(String,on.slice(Kt,Kt+=wt));return Hn}(ft)}a.Buffer=D,a.SlowBuffer=function(Ve){return+Ve!=Ve&&(Ve=0),D.alloc(+Ve)},a.INSPECT_MAX_BYTES=50,D.TYPED_ARRAY_SUPPORT=c.TYPED_ARRAY_SUPPORT!==void 0?c.TYPED_ARRAY_SUPPORT:function(){try{var Ve=new Uint8Array(1);return Ve.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},Ve.foo()===42&&typeof Ve.subarray=="function"&&Ve.subarray(1,1).byteLength===0}catch{return!1}}(),a.kMaxLength=U(),D.poolSize=8192,D._augment=function(Ve){return Ve.__proto__=D.prototype,Ve},D.from=function(Ve,Ye,$e){return R(null,Ve,Ye,$e)},D.TYPED_ARRAY_SUPPORT&&(D.prototype.__proto__=Uint8Array.prototype,D.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&D[Symbol.species]===D&&Object.defineProperty(D,Symbol.species,{value:null,configurable:!0})),D.alloc=function(Ve,Ye,$e){return function(ft,$t,Jt,Pn){return W($t),$t<=0?B(ft,$t):Jt!==void 0?typeof Pn=="string"?B(ft,$t).fill(Jt,Pn):B(ft,$t).fill(Jt):B(ft,$t)}(null,Ve,Ye,$e)},D.allocUnsafe=function(Ve){return j(null,Ve)},D.allocUnsafeSlow=function(Ve){return j(null,Ve)},D.isBuffer=function(Ve){return!(Ve==null||!Ve._isBuffer)},D.compare=function(Ve,Ye){if(!D.isBuffer(Ve)||!D.isBuffer(Ye))throw new TypeError("Arguments must be Buffers");if(Ve===Ye)return 0;for(var $e=Ve.length,ft=Ye.length,$t=0,Jt=Math.min($e,ft);$t<Jt;++$t)if(Ve[$t]!==Ye[$t]){$e=Ve[$t],ft=Ye[$t];break}return $e<ft?-1:ft<$e?1:0},D.isEncoding=function(Ve){switch(String(Ve).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},D.concat=function(Ve,Ye){if(!A(Ve))throw new TypeError('"list" argument must be an Array of Buffers');if(Ve.length===0)return D.alloc(0);var $e;if(Ye===void 0)for(Ye=0,$e=0;$e<Ve.length;++$e)Ye+=Ve[$e].length;var ft=D.allocUnsafe(Ye),$t=0;for($e=0;$e<Ve.length;++$e){var Jt=Ve[$e];if(!D.isBuffer(Jt))throw new TypeError('"list" argument must be an Array of Buffers');Jt.copy(ft,$t),$t+=Jt.length}return ft},D.byteLength=Q,D.prototype._isBuffer=!0,D.prototype.swap16=function(){var Ve=this.length;if(Ve%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var Ye=0;Ye<Ve;Ye+=2)Y(this,Ye,Ye+1);return this},D.prototype.swap32=function(){var Ve=this.length;if(Ve%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var Ye=0;Ye<Ve;Ye+=4)Y(this,Ye,Ye+3),Y(this,Ye+1,Ye+2);return this},D.prototype.swap64=function(){var Ve=this.length;if(Ve%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var Ye=0;Ye<Ve;Ye+=8)Y(this,Ye,Ye+7),Y(this,Ye+1,Ye+6),Y(this,Ye+2,Ye+5),Y(this,Ye+3,Ye+4);return this},D.prototype.toString=function(){var Ve=0|this.length;return Ve===0?"":arguments.length===0?It(this,0,Ve):function(Ye,$e,ft){var $t=!1;if(($e===void 0||$e<0)&&($e=0),$e>this.length||((ft===void 0||ft>this.length)&&(ft=this.length),ft<=0)||(ft>>>=0)<=($e>>>=0))return"";for(Ye||(Ye="utf8");;)switch(Ye){case"hex":return Bt(this,$e,ft);case"utf8":case"utf-8":return It(this,$e,ft);case"ascii":return we(this,$e,ft);case"latin1":case"binary":return yt(this,$e,ft);case"base64":return lt(this,$e,ft);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ot(this,$e,ft);default:if($t)throw new TypeError("Unknown encoding: "+Ye);Ye=(Ye+"").toLowerCase(),$t=!0}}.apply(this,arguments)},D.prototype.equals=function(Ve){if(!D.isBuffer(Ve))throw new TypeError("Argument must be a Buffer");return this===Ve||D.compare(this,Ve)===0},D.prototype.inspect=function(){var Ve="",Ye=a.INSPECT_MAX_BYTES;return this.length>0&&(Ve=this.toString("hex",0,Ye).match(/.{2}/g).join(" "),this.length>Ye&&(Ve+=" ... ")),"<Buffer "+Ve+">"},D.prototype.compare=function(Ve,Ye,$e,ft,$t){if(!D.isBuffer(Ve))throw new TypeError("Argument must be a Buffer");if(Ye===void 0&&(Ye=0),$e===void 0&&($e=Ve?Ve.length:0),ft===void 0&&(ft=0),$t===void 0&&($t=this.length),Ye<0||$e>Ve.length||ft<0||$t>this.length)throw new RangeError("out of range index");if(ft>=$t&&Ye>=$e)return 0;if(ft>=$t)return-1;if(Ye>=$e)return 1;if(Ye>>>=0,$e>>>=0,ft>>>=0,$t>>>=0,this===Ve)return 0;for(var Jt=$t-ft,Pn=$e-Ye,An=Math.min(Jt,Pn),Qn=this.slice(ft,$t),Ce=Ve.slice(Ye,$e),sr=0;sr<An;++sr)if(Qn[sr]!==Ce[sr]){Jt=Qn[sr],Pn=Ce[sr];break}return Jt<Pn?-1:Pn<Jt?1:0},D.prototype.includes=function(Ve,Ye,$e){return this.indexOf(Ve,Ye,$e)!==-1},D.prototype.indexOf=function(Ve,Ye,$e){return q(this,Ve,Ye,$e,!0)},D.prototype.lastIndexOf=function(Ve,Ye,$e){return q(this,Ve,Ye,$e,!1)},D.prototype.write=function(Ve,Ye,$e,ft){if(Ye===void 0)ft="utf8",$e=this.length,Ye=0;else if($e===void 0&&typeof Ye=="string")ft=Ye,$e=this.length,Ye=0;else{if(!isFinite(Ye))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");Ye|=0,isFinite($e)?($e|=0,ft===void 0&&(ft="utf8")):(ft=$e,$e=void 0)}var $t=this.length-Ye;if(($e===void 0||$e>$t)&&($e=$t),Ve.length>0&&($e<0||Ye<0)||Ye>this.length)throw new RangeError("Attempt to write outside buffer bounds");ft||(ft="utf8");for(var Jt=!1;;)switch(ft){case"hex":return oe(this,Ve,Ye,$e);case"utf8":case"utf-8":return ye(this,Ve,Ye,$e);case"ascii":return _e(this,Ve,Ye,$e);case"latin1":case"binary":return pe(this,Ve,Ye,$e);case"base64":return me(this,Ve,Ye,$e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ge(this,Ve,Ye,$e);default:if(Jt)throw new TypeError("Unknown encoding: "+ft);ft=(""+ft).toLowerCase(),Jt=!0}},D.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var wt=4096;function we(Ve,Ye,$e){var ft="";$e=Math.min(Ve.length,$e);for(var $t=Ye;$t<$e;++$t)ft+=String.fromCharCode(127&Ve[$t]);return ft}function yt(Ve,Ye,$e){var ft="";$e=Math.min(Ve.length,$e);for(var $t=Ye;$t<$e;++$t)ft+=String.fromCharCode(Ve[$t]);return ft}function Bt(Ve,Ye,$e){var ft=Ve.length;(!Ye||Ye<0)&&(Ye=0),(!$e||$e<0||$e>ft)&&($e=ft);for(var $t="",Jt=Ye;Jt<$e;++Jt)$t+=Xt(Ve[Jt]);return $t}function Ot(Ve,Ye,$e){for(var ft=Ve.slice(Ye,$e),$t="",Jt=0;Jt<ft.length;Jt+=2)$t+=String.fromCharCode(ft[Jt]+256*ft[Jt+1]);return $t}function ze(Ve,Ye,$e){if(Ve%1!=0||Ve<0)throw new RangeError("offset is not uint");if(Ve+Ye>$e)throw new RangeError("Trying to access beyond buffer length")}function Ut(Ve,Ye,$e,ft,$t,Jt){if(!D.isBuffer(Ve))throw new TypeError('"buffer" argument must be a Buffer instance');if(Ye>$t||Ye<Jt)throw new RangeError('"value" argument is out of bounds');if($e+ft>Ve.length)throw new RangeError("Index out of range")}function Ft(Ve,Ye,$e,ft){Ye<0&&(Ye=65535+Ye+1);for(var $t=0,Jt=Math.min(Ve.length-$e,2);$t<Jt;++$t)Ve[$e+$t]=(Ye&255<<8*(ft?$t:1-$t))>>>8*(ft?$t:1-$t)}function pt(Ve,Ye,$e,ft){Ye<0&&(Ye=4294967295+Ye+1);for(var $t=0,Jt=Math.min(Ve.length-$e,4);$t<Jt;++$t)Ve[$e+$t]=Ye>>>8*(ft?$t:3-$t)&255}function vt(Ve,Ye,$e,ft,$t,Jt){if($e+ft>Ve.length)throw new RangeError("Index out of range");if($e<0)throw new RangeError("Index out of range")}function rn(Ve,Ye,$e,ft,$t){return $t||vt(Ve,0,$e,4),E.write(Ve,Ye,$e,ft,23,4),$e+4}function xt(Ve,Ye,$e,ft,$t){return $t||vt(Ve,0,$e,8),E.write(Ve,Ye,$e,ft,52,8),$e+8}D.prototype.slice=function(Ve,Ye){var $e,ft=this.length;if(Ve=~~Ve,Ye=Ye===void 0?ft:~~Ye,Ve<0?(Ve+=ft)<0&&(Ve=0):Ve>ft&&(Ve=ft),Ye<0?(Ye+=ft)<0&&(Ye=0):Ye>ft&&(Ye=ft),Ye<Ve&&(Ye=Ve),D.TYPED_ARRAY_SUPPORT)($e=this.subarray(Ve,Ye)).__proto__=D.prototype;else{var $t=Ye-Ve;$e=new D($t,void 0);for(var Jt=0;Jt<$t;++Jt)$e[Jt]=this[Jt+Ve]}return $e},D.prototype.readUIntLE=function(Ve,Ye,$e){Ve|=0,Ye|=0,$e||ze(Ve,Ye,this.length);for(var ft=this[Ve],$t=1,Jt=0;++Jt<Ye&&($t*=256);)ft+=this[Ve+Jt]*$t;return ft},D.prototype.readUIntBE=function(Ve,Ye,$e){Ve|=0,Ye|=0,$e||ze(Ve,Ye,this.length);for(var ft=this[Ve+--Ye],$t=1;Ye>0&&($t*=256);)ft+=this[Ve+--Ye]*$t;return ft},D.prototype.readUInt8=function(Ve,Ye){return Ye||ze(Ve,1,this.length),this[Ve]},D.prototype.readUInt16LE=function(Ve,Ye){return Ye||ze(Ve,2,this.length),this[Ve]|this[Ve+1]<<8},D.prototype.readUInt16BE=function(Ve,Ye){return Ye||ze(Ve,2,this.length),this[Ve]<<8|this[Ve+1]},D.prototype.readUInt32LE=function(Ve,Ye){return Ye||ze(Ve,4,this.length),(this[Ve]|this[Ve+1]<<8|this[Ve+2]<<16)+16777216*this[Ve+3]},D.prototype.readUInt32BE=function(Ve,Ye){return Ye||ze(Ve,4,this.length),16777216*this[Ve]+(this[Ve+1]<<16|this[Ve+2]<<8|this[Ve+3])},D.prototype.readIntLE=function(Ve,Ye,$e){Ve|=0,Ye|=0,$e||ze(Ve,Ye,this.length);for(var ft=this[Ve],$t=1,Jt=0;++Jt<Ye&&($t*=256);)ft+=this[Ve+Jt]*$t;return ft>=($t*=128)&&(ft-=Math.pow(2,8*Ye)),ft},D.prototype.readIntBE=function(Ve,Ye,$e){Ve|=0,Ye|=0,$e||ze(Ve,Ye,this.length);for(var ft=Ye,$t=1,Jt=this[Ve+--ft];ft>0&&($t*=256);)Jt+=this[Ve+--ft]*$t;return Jt>=($t*=128)&&(Jt-=Math.pow(2,8*Ye)),Jt},D.prototype.readInt8=function(Ve,Ye){return Ye||ze(Ve,1,this.length),128&this[Ve]?-1*(255-this[Ve]+1):this[Ve]},D.prototype.readInt16LE=function(Ve,Ye){Ye||ze(Ve,2,this.length);var $e=this[Ve]|this[Ve+1]<<8;return 32768&$e?4294901760|$e:$e},D.prototype.readInt16BE=function(Ve,Ye){Ye||ze(Ve,2,this.length);var $e=this[Ve+1]|this[Ve]<<8;return 32768&$e?4294901760|$e:$e},D.prototype.readInt32LE=function(Ve,Ye){return Ye||ze(Ve,4,this.length),this[Ve]|this[Ve+1]<<8|this[Ve+2]<<16|this[Ve+3]<<24},D.prototype.readInt32BE=function(Ve,Ye){return Ye||ze(Ve,4,this.length),this[Ve]<<24|this[Ve+1]<<16|this[Ve+2]<<8|this[Ve+3]},D.prototype.readFloatLE=function(Ve,Ye){return Ye||ze(Ve,4,this.length),E.read(this,Ve,!0,23,4)},D.prototype.readFloatBE=function(Ve,Ye){return Ye||ze(Ve,4,this.length),E.read(this,Ve,!1,23,4)},D.prototype.readDoubleLE=function(Ve,Ye){return Ye||ze(Ve,8,this.length),E.read(this,Ve,!0,52,8)},D.prototype.readDoubleBE=function(Ve,Ye){return Ye||ze(Ve,8,this.length),E.read(this,Ve,!1,52,8)},D.prototype.writeUIntLE=function(Ve,Ye,$e,ft){Ve=+Ve,Ye|=0,$e|=0,ft||Ut(this,Ve,Ye,$e,Math.pow(2,8*$e)-1,0);var $t=1,Jt=0;for(this[Ye]=255&Ve;++Jt<$e&&($t*=256);)this[Ye+Jt]=Ve/$t&255;return Ye+$e},D.prototype.writeUIntBE=function(Ve,Ye,$e,ft){Ve=+Ve,Ye|=0,$e|=0,ft||Ut(this,Ve,Ye,$e,Math.pow(2,8*$e)-1,0);var $t=$e-1,Jt=1;for(this[Ye+$t]=255&Ve;--$t>=0&&(Jt*=256);)this[Ye+$t]=Ve/Jt&255;return Ye+$e},D.prototype.writeUInt8=function(Ve,Ye,$e){return Ve=+Ve,Ye|=0,$e||Ut(this,Ve,Ye,1,255,0),D.TYPED_ARRAY_SUPPORT||(Ve=Math.floor(Ve)),this[Ye]=255&Ve,Ye+1},D.prototype.writeUInt16LE=function(Ve,Ye,$e){return Ve=+Ve,Ye|=0,$e||Ut(this,Ve,Ye,2,65535,0),D.TYPED_ARRAY_SUPPORT?(this[Ye]=255&Ve,this[Ye+1]=Ve>>>8):Ft(this,Ve,Ye,!0),Ye+2},D.prototype.writeUInt16BE=function(Ve,Ye,$e){return Ve=+Ve,Ye|=0,$e||Ut(this,Ve,Ye,2,65535,0),D.TYPED_ARRAY_SUPPORT?(this[Ye]=Ve>>>8,this[Ye+1]=255&Ve):Ft(this,Ve,Ye,!1),Ye+2},D.prototype.writeUInt32LE=function(Ve,Ye,$e){return Ve=+Ve,Ye|=0,$e||Ut(this,Ve,Ye,4,4294967295,0),D.TYPED_ARRAY_SUPPORT?(this[Ye+3]=Ve>>>24,this[Ye+2]=Ve>>>16,this[Ye+1]=Ve>>>8,this[Ye]=255&Ve):pt(this,Ve,Ye,!0),Ye+4},D.prototype.writeUInt32BE=function(Ve,Ye,$e){return Ve=+Ve,Ye|=0,$e||Ut(this,Ve,Ye,4,4294967295,0),D.TYPED_ARRAY_SUPPORT?(this[Ye]=Ve>>>24,this[Ye+1]=Ve>>>16,this[Ye+2]=Ve>>>8,this[Ye+3]=255&Ve):pt(this,Ve,Ye,!1),Ye+4},D.prototype.writeIntLE=function(Ve,Ye,$e,ft){if(Ve=+Ve,Ye|=0,!ft){var $t=Math.pow(2,8*$e-1);Ut(this,Ve,Ye,$e,$t-1,-$t)}var Jt=0,Pn=1,An=0;for(this[Ye]=255&Ve;++Jt<$e&&(Pn*=256);)Ve<0&&An===0&&this[Ye+Jt-1]!==0&&(An=1),this[Ye+Jt]=(Ve/Pn>>0)-An&255;return Ye+$e},D.prototype.writeIntBE=function(Ve,Ye,$e,ft){if(Ve=+Ve,Ye|=0,!ft){var $t=Math.pow(2,8*$e-1);Ut(this,Ve,Ye,$e,$t-1,-$t)}var Jt=$e-1,Pn=1,An=0;for(this[Ye+Jt]=255&Ve;--Jt>=0&&(Pn*=256);)Ve<0&&An===0&&this[Ye+Jt+1]!==0&&(An=1),this[Ye+Jt]=(Ve/Pn>>0)-An&255;return Ye+$e},D.prototype.writeInt8=function(Ve,Ye,$e){return Ve=+Ve,Ye|=0,$e||Ut(this,Ve,Ye,1,127,-128),D.TYPED_ARRAY_SUPPORT||(Ve=Math.floor(Ve)),Ve<0&&(Ve=255+Ve+1),this[Ye]=255&Ve,Ye+1},D.prototype.writeInt16LE=function(Ve,Ye,$e){return Ve=+Ve,Ye|=0,$e||Ut(this,Ve,Ye,2,32767,-32768),D.TYPED_ARRAY_SUPPORT?(this[Ye]=255&Ve,this[Ye+1]=Ve>>>8):Ft(this,Ve,Ye,!0),Ye+2},D.prototype.writeInt16BE=function(Ve,Ye,$e){return Ve=+Ve,Ye|=0,$e||Ut(this,Ve,Ye,2,32767,-32768),D.TYPED_ARRAY_SUPPORT?(this[Ye]=Ve>>>8,this[Ye+1]=255&Ve):Ft(this,Ve,Ye,!1),Ye+2},D.prototype.writeInt32LE=function(Ve,Ye,$e){return Ve=+Ve,Ye|=0,$e||Ut(this,Ve,Ye,4,2147483647,-2147483648),D.TYPED_ARRAY_SUPPORT?(this[Ye]=255&Ve,this[Ye+1]=Ve>>>8,this[Ye+2]=Ve>>>16,this[Ye+3]=Ve>>>24):pt(this,Ve,Ye,!0),Ye+4},D.prototype.writeInt32BE=function(Ve,Ye,$e){return Ve=+Ve,Ye|=0,$e||Ut(this,Ve,Ye,4,2147483647,-2147483648),Ve<0&&(Ve=4294967295+Ve+1),D.TYPED_ARRAY_SUPPORT?(this[Ye]=Ve>>>24,this[Ye+1]=Ve>>>16,this[Ye+2]=Ve>>>8,this[Ye+3]=255&Ve):pt(this,Ve,Ye,!1),Ye+4},D.prototype.writeFloatLE=function(Ve,Ye,$e){return rn(this,Ve,Ye,!0,$e)},D.prototype.writeFloatBE=function(Ve,Ye,$e){return rn(this,Ve,Ye,!1,$e)},D.prototype.writeDoubleLE=function(Ve,Ye,$e){return xt(this,Ve,Ye,!0,$e)},D.prototype.writeDoubleBE=function(Ve,Ye,$e){return xt(this,Ve,Ye,!1,$e)},D.prototype.copy=function(Ve,Ye,$e,ft){if($e||($e=0),ft||ft===0||(ft=this.length),Ye>=Ve.length&&(Ye=Ve.length),Ye||(Ye=0),ft>0&&ft<$e&&(ft=$e),ft===$e||Ve.length===0||this.length===0)return 0;if(Ye<0)throw new RangeError("targetStart out of bounds");if($e<0||$e>=this.length)throw new RangeError("sourceStart out of bounds");if(ft<0)throw new RangeError("sourceEnd out of bounds");ft>this.length&&(ft=this.length),Ve.length-Ye<ft-$e&&(ft=Ve.length-Ye+$e);var $t,Jt=ft-$e;if(this===Ve&&$e<Ye&&Ye<ft)for($t=Jt-1;$t>=0;--$t)Ve[$t+Ye]=this[$t+$e];else if(Jt<1e3||!D.TYPED_ARRAY_SUPPORT)for($t=0;$t<Jt;++$t)Ve[$t+Ye]=this[$t+$e];else Uint8Array.prototype.set.call(Ve,this.subarray($e,$e+Jt),Ye);return Jt},D.prototype.fill=function(Ve,Ye,$e,ft){if(typeof Ve=="string"){if(typeof Ye=="string"?(ft=Ye,Ye=0,$e=this.length):typeof $e=="string"&&(ft=$e,$e=this.length),Ve.length===1){var $t=Ve.charCodeAt(0);$t<256&&(Ve=$t)}if(ft!==void 0&&typeof ft!="string")throw new TypeError("encoding must be a string");if(typeof ft=="string"&&!D.isEncoding(ft))throw new TypeError("Unknown encoding: "+ft)}else typeof Ve=="number"&&(Ve&=255);if(Ye<0||this.length<Ye||this.length<$e)throw new RangeError("Out of range index");if($e<=Ye)return this;var Jt;if(Ye>>>=0,$e=$e===void 0?this.length:$e>>>0,Ve||(Ve=0),typeof Ve=="number")for(Jt=Ye;Jt<$e;++Jt)this[Jt]=Ve;else{var Pn=D.isBuffer(Ve)?Ve:sn(new D(Ve,ft).toString()),An=Pn.length;for(Jt=0;Jt<$e-Ye;++Jt)this[Jt+Ye]=Pn[Jt%An]}return this};var _t=/[^+\/0-9A-Za-z-_]/g;function Xt(Ve){return Ve<16?"0"+Ve.toString(16):Ve.toString(16)}function sn(Ve,Ye){var $e;Ye=Ye||1/0;for(var ft=Ve.length,$t=null,Jt=[],Pn=0;Pn<ft;++Pn){if(($e=Ve.charCodeAt(Pn))>55295&&$e<57344){if(!$t){if($e>56319){(Ye-=3)>-1&&Jt.push(239,191,189);continue}if(Pn+1===ft){(Ye-=3)>-1&&Jt.push(239,191,189);continue}$t=$e;continue}if($e<56320){(Ye-=3)>-1&&Jt.push(239,191,189),$t=$e;continue}$e=65536+($t-55296<<10|$e-56320)}else $t&&(Ye-=3)>-1&&Jt.push(239,191,189);if($t=null,$e<128){if((Ye-=1)<0)break;Jt.push($e)}else if($e<2048){if((Ye-=2)<0)break;Jt.push($e>>6|192,63&$e|128)}else if($e<65536){if((Ye-=3)<0)break;Jt.push($e>>12|224,$e>>6&63|128,63&$e|128)}else{if(!($e<1114112))throw new Error("Invalid code point");if((Ye-=4)<0)break;Jt.push($e>>18|240,$e>>12&63|128,$e>>6&63|128,63&$e|128)}}return Jt}function kn(Ve){return S.toByteArray(function(Ye){if((Ye=function($e){return $e.trim?$e.trim():$e.replace(/^\s+|\s+$/g,"")}(Ye).replace(_t,"")).length<2)return"";for(;Ye.length%4!=0;)Ye+="=";return Ye}(Ve))}function an(Ve,Ye,$e,ft){for(var $t=0;$t<ft&&!($t+$e>=Ye.length||$t>=Ve.length);++$t)Ye[$t+$e]=Ve[$t];return $t}}).call(this,r(59))},function(s,a,r){var c=r(38);s.exports=function(S,E,A){for(var U in E)c(S,U,E[U],A);return S}},function(s,a){s.exports=function(r,c,S,E){if(!(r instanceof c)||E!==void 0&&E in r)throw TypeError(S+": incorrect invocation!");return r}},function(s,a,r){var c=r(16),S=r(26),E=r(27),A=r(19)("species");s.exports=function(U){var B=c[U];E&&B&&!B[A]&&S.f(B,A,{configurable:!0,get:function(){return this}})}},function(s,a){s.exports={}},function(s,a,r){var c=r(8),S=r(61),E=r(15),A=r(169),U="["+A+"]",B=RegExp("^"+U+U+"*"),D=RegExp(U+U+"*$"),R=function(j,H,I){var Q={},Y=E(function(){return!!A[j]()||""[j]()!=""}),q=Q[j]=Y?H(W):A[j];I&&(Q[I]=q),c(c.P+c.F*Y,"String",Q)},W=R.trim=function(j,H){return j=String(S(j)),1&H&&(j=j.replace(B,"")),2&H&&(j=j.replace(D,"")),j};s.exports=R},function(s,a,r){var c=r(26).f,S=r(43),E=r(19)("toStringTag");s.exports=function(A,U,B){A&&!S(A=B?A:A.prototype,E)&&c(A,E,{configurable:!0,value:U})}},function(s,a,r){var c,S=typeof Reflect=="object"?Reflect:null,E=S&&typeof S.apply=="function"?S.apply:function(q,ae,oe){return Function.prototype.apply.call(q,ae,oe)};c=S&&typeof S.ownKeys=="function"?S.ownKeys:Object.getOwnPropertySymbols?function(q){return Object.getOwnPropertyNames(q).concat(Object.getOwnPropertySymbols(q))}:function(q){return Object.getOwnPropertyNames(q)};var A=Number.isNaN||function(q){return q!=q};function U(){U.init.call(this)}s.exports=U,s.exports.once=function(q,ae){return new Promise(function(oe,ye){function _e(me){q.removeListener(ae,pe),ye(me)}function pe(){typeof q.removeListener=="function"&&q.removeListener("error",_e),oe([].slice.call(arguments))}Y(q,ae,pe,{once:!0}),ae!=="error"&&function(me,Ge,lt){typeof me.on=="function"&&Y(me,"error",Ge,lt)}(q,_e,{once:!0})})},U.EventEmitter=U,U.prototype._events=void 0,U.prototype._eventsCount=0,U.prototype._maxListeners=void 0;var B=10;function D(q){if(typeof q!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof q)}function R(q){return q._maxListeners===void 0?U.defaultMaxListeners:q._maxListeners}function W(q,ae,oe,ye){var _e,pe,me;if(D(oe),(pe=q._events)===void 0?(pe=q._events=Object.create(null),q._eventsCount=0):(pe.newListener!==void 0&&(q.emit("newListener",ae,oe.listener?oe.listener:oe),pe=q._events),me=pe[ae]),me===void 0)me=pe[ae]=oe,++q._eventsCount;else if(typeof me=="function"?me=pe[ae]=ye?[oe,me]:[me,oe]:ye?me.unshift(oe):me.push(oe),(_e=R(q))>0&&me.length>_e&&!me.warned){me.warned=!0;var Ge=new Error("Possible EventEmitter memory leak detected. "+me.length+" "+String(ae)+" listeners added. Use emitter.setMaxListeners() to increase limit");Ge.name="MaxListenersExceededWarning",Ge.emitter=q,Ge.type=ae,Ge.count=me.length,function(lt){console&&console.warn&&console.warn(lt)}(Ge)}return q}function j(q,ae,oe){var ye={fired:!1,wrapFn:void 0,target:q,type:ae,listener:oe},_e=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}.bind(ye);return _e.listener=oe,ye.wrapFn=_e,_e}function H(q,ae,oe){var ye=q._events;if(ye===void 0)return[];var _e=ye[ae];return _e===void 0?[]:typeof _e=="function"?oe?[_e.listener||_e]:[_e]:oe?function(pe){for(var me=new Array(pe.length),Ge=0;Ge<me.length;++Ge)me[Ge]=pe[Ge].listener||pe[Ge];return me}(_e):Q(_e,_e.length)}function I(q){var ae=this._events;if(ae!==void 0){var oe=ae[q];if(typeof oe=="function")return 1;if(oe!==void 0)return oe.length}return 0}function Q(q,ae){for(var oe=new Array(ae),ye=0;ye<ae;++ye)oe[ye]=q[ye];return oe}function Y(q,ae,oe,ye){if(typeof q.on=="function")ye.once?q.once(ae,oe):q.on(ae,oe);else{if(typeof q.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof q);q.addEventListener(ae,function _e(pe){ye.once&&q.removeEventListener(ae,_e),oe(pe)})}}Object.defineProperty(U,"defaultMaxListeners",{enumerable:!0,get:function(){return B},set:function(q){if(typeof q!="number"||q<0||A(q))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+q+".");B=q}}),U.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},U.prototype.setMaxListeners=function(q){if(typeof q!="number"||q<0||A(q))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+q+".");return this._maxListeners=q,this},U.prototype.getMaxListeners=function(){return R(this)},U.prototype.emit=function(q){for(var ae=[],oe=1;oe<arguments.length;oe++)ae.push(arguments[oe]);var ye=q==="error",_e=this._events;if(_e!==void 0)ye=ye&&_e.error===void 0;else if(!ye)return!1;if(ye){var pe;if(ae.length>0&&(pe=ae[0]),pe instanceof Error)throw pe;var me=new Error("Unhandled error."+(pe?" ("+pe.message+")":""));throw me.context=pe,me}var Ge=_e[q];if(Ge===void 0)return!1;if(typeof Ge=="function")E(Ge,this,ae);else{var lt=Ge.length,It=Q(Ge,lt);for(oe=0;oe<lt;++oe)E(It[oe],this,ae)}return!0},U.prototype.addListener=function(q,ae){return W(this,q,ae,!1)},U.prototype.on=U.prototype.addListener,U.prototype.prependListener=function(q,ae){return W(this,q,ae,!0)},U.prototype.once=function(q,ae){return D(ae),this.on(q,j(this,q,ae)),this},U.prototype.prependOnceListener=function(q,ae){return D(ae),this.prependListener(q,j(this,q,ae)),this},U.prototype.removeListener=function(q,ae){var oe,ye,_e,pe,me;if(D(ae),(ye=this._events)===void 0)return this;if((oe=ye[q])===void 0)return this;if(oe===ae||oe.listener===ae)--this._eventsCount==0?this._events=Object.create(null):(delete ye[q],ye.removeListener&&this.emit("removeListener",q,oe.listener||ae));else if(typeof oe!="function"){for(_e=-1,pe=oe.length-1;pe>=0;pe--)if(oe[pe]===ae||oe[pe].listener===ae){me=oe[pe].listener,_e=pe;break}if(_e<0)return this;_e===0?oe.shift():function(Ge,lt){for(;lt+1<Ge.length;lt++)Ge[lt]=Ge[lt+1];Ge.pop()}(oe,_e),oe.length===1&&(ye[q]=oe[0]),ye.removeListener!==void 0&&this.emit("removeListener",q,me||ae)}return this},U.prototype.off=U.prototype.removeListener,U.prototype.removeAllListeners=function(q){var ae,oe,ye;if((oe=this._events)===void 0)return this;if(oe.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):oe[q]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete oe[q]),this;if(arguments.length===0){var _e,pe=Object.keys(oe);for(ye=0;ye<pe.length;++ye)(_e=pe[ye])!=="removeListener"&&this.removeAllListeners(_e);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(ae=oe[q])=="function")this.removeListener(q,ae);else if(ae!==void 0)for(ye=ae.length-1;ye>=0;ye--)this.removeListener(q,ae[ye]);return this},U.prototype.listeners=function(q){return H(this,q,!0)},U.prototype.rawListeners=function(q){return H(this,q,!1)},U.listenerCount=function(q,ae){return typeof q.listenerCount=="function"?q.listenerCount(ae):I.call(q,ae)},U.prototype.listenerCount=I,U.prototype.eventNames=function(){return this._eventsCount>0?c(this._events):[]}},function(s,a,r){r.d(a,"a",function(){return S}),r.d(a,"b",function(){return E}),r.d(a,"c",function(){return A}),r.d(a,"d",function(){return U});var c,S,E,A,U,B=r(246);(function(D){c=Object(B.a)(D),S=c.format,E=c.parse,A=c.utcFormat,U=c.utcParse})({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]})},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(S){return typeof S=="string"&&c.test(S)};var c=/-webkit-|-moz-|-ms-/;s.exports=a.default},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.compose=a.merge=a.$=a.style=a.presets=a.keyframes=a.fontFace=a.insertGlobal=a.insertRule=a.plugins=a.styleSheet=void 0,a.speedy=function($e){return W.speedy($e)},a.simulations=function(){var $e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];Y=!!$e},a.simulate=function(){for(var $e=arguments.length,ft=Array($e),$t=0;$t<$e;$t++)ft[$t]=arguments[$t];return(ft=(0,A.default)(ft))?Y?ft.reduce(function(Jt,Pn){return Jt["data-simulate-"+ye(Pn)]="",Jt},{}):(q||(console.warn("can't simulate without once calling simulations(true)"),q=!0),H||I||ae||(console.warn("don't use simulation outside dev"),ae=!0),{}):{}},a.cssLabels=function($e){oe=!!$e},a.isLikeRule=pe,a.idFor=me,a.css=kn,a.rehydrate=function($e){(0,c.default)(Bt,$e.reduce(function(ft,$t){return ft[$t]=!0,ft},{}))},a.flush=function(){Bt=W.inserted={},Ot=W.registered={},Ut={},W.flush(),W.inject()},a.select=Ve,a.parent=function($e){for(var ft=arguments.length,$t=Array(ft>1?ft-1:0),Jt=1;Jt<ft;Jt++)$t[Jt-1]=arguments[Jt];return kn(R({},$e+" &",$t))},a.media=function($e){for(var ft=arguments.length,$t=Array(ft>1?ft-1:0),Jt=1;Jt<ft;Jt++)$t[Jt-1]=arguments[Jt];return kn(R({},"@media "+$e,$t))},a.pseudo=Ye,a.active=function($e){return Ye(":active",$e)},a.any=function($e){return Ye(":any",$e)},a.checked=function($e){return Ye(":checked",$e)},a.disabled=function($e){return Ye(":disabled",$e)},a.empty=function($e){return Ye(":empty",$e)},a.enabled=function($e){return Ye(":enabled",$e)},a._default=function($e){return Ye(":default",$e)},a.first=function($e){return Ye(":first",$e)},a.firstChild=function($e){return Ye(":first-child",$e)},a.firstOfType=function($e){return Ye(":first-of-type",$e)},a.fullscreen=function($e){return Ye(":fullscreen",$e)},a.focus=function($e){return Ye(":focus",$e)},a.hover=function($e){return Ye(":hover",$e)},a.indeterminate=function($e){return Ye(":indeterminate",$e)},a.inRange=function($e){return Ye(":in-range",$e)},a.invalid=function($e){return Ye(":invalid",$e)},a.lastChild=function($e){return Ye(":last-child",$e)},a.lastOfType=function($e){return Ye(":last-of-type",$e)},a.left=function($e){return Ye(":left",$e)},a.link=function($e){return Ye(":link",$e)},a.onlyChild=function($e){return Ye(":only-child",$e)},a.onlyOfType=function($e){return Ye(":only-of-type",$e)},a.optional=function($e){return Ye(":optional",$e)},a.outOfRange=function($e){return Ye(":out-of-range",$e)},a.readOnly=function($e){return Ye(":read-only",$e)},a.readWrite=function($e){return Ye(":read-write",$e)},a.required=function($e){return Ye(":required",$e)},a.right=function($e){return Ye(":right",$e)},a.root=function($e){return Ye(":root",$e)},a.scope=function($e){return Ye(":scope",$e)},a.target=function($e){return Ye(":target",$e)},a.valid=function($e){return Ye(":valid",$e)},a.visited=function($e){return Ye(":visited",$e)},a.dir=function($e,ft){return Ye(":dir("+$e+")",ft)},a.lang=function($e,ft){return Ye(":lang("+$e+")",ft)},a.not=function($e,ft){var $t=$e.split(",").map(function(Jt){return Jt.trim()}).map(function(Jt){return":not("+Jt+")"});return $t.length===1?Ye(":not("+$e+")",ft):Ve($t.join(""),ft)},a.nthChild=function($e,ft){return Ye(":nth-child("+$e+")",ft)},a.nthLastChild=function($e,ft){return Ye(":nth-last-child("+$e+")",ft)},a.nthLastOfType=function($e,ft){return Ye(":nth-last-of-type("+$e+")",ft)},a.nthOfType=function($e,ft){return Ye(":nth-of-type("+$e+")",ft)},a.after=function($e){return Ye("::after",$e)},a.before=function($e){return Ye("::before",$e)},a.firstLetter=function($e){return Ye("::first-letter",$e)},a.firstLine=function($e){return Ye("::first-line",$e)},a.selection=function($e){return Ye("::selection",$e)},a.backdrop=function($e){return Ye("::backdrop",$e)},a.placeholder=function($e){return kn({"::placeholder":$e})},a.cssFor=function(){for(var $e=arguments.length,ft=Array($e),$t=0;$t<$e;$t++)ft[$t]=arguments[$t];return(ft=(0,A.default)(ft))?ft.map(function(Jt){var Pn={label:[]};return rn(Pn,{src:Jt}),yt(_e(Pn),we(Pn)).join("")}).join(""):""},a.attribsFor=function(){for(var $e=arguments.length,ft=Array($e),$t=0;$t<$e;$t++)ft[$t]=arguments[$t];return(ft=(0,A.default)(ft))?ft.map(function(Jt){me(Jt);var Pn=Object.keys(Jt)[0],An=Jt[Pn];return Pn+'="'+(An||"")+'"'}).join(" "):""};var c=D(r(139)),S=r(320),E=r(201),A=D(r(311)),U=r(310),B=D(r(293));function D($e){return $e&&$e.__esModule?$e:{default:$e}}function R($e,ft,$t){return ft in $e?Object.defineProperty($e,ft,{value:$t,enumerable:!0,configurable:!0,writable:!0}):$e[ft]=$t,$e}var W=a.styleSheet=new S.StyleSheet;W.inject();var j=a.plugins=W.plugins=new U.PluginSet([U.prefixes,U.contentWrap,U.fallbacks]);j.media=new U.PluginSet,j.fontFace=new U.PluginSet,j.keyframes=new U.PluginSet([U.prefixes,U.fallbacks]);var H=!1,I=!1,Q=typeof window<"u",Y=H,q=!1,ae=!1,oe=H;function ye($e){var ft=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return $e.toLowerCase().replace(/[^a-z0-9]/g,ft)}function _e($e){var ft=JSON.stringify($e),$t=(0,B.default)(ft).toString(36);return $e.label&&$e.label.length>0&&H?ye($e.label.join("."),"-")+"-"+$t:$t}function pe($e){var ft=Object.keys($e).filter(function($t){return $t!=="toString"});return ft.length===1&&!!/data\-css\-([a-zA-Z0-9\-_]+)/.exec(ft[0])}function me($e){var ft=Object.keys($e).filter(function(Jt){return Jt!=="toString"});if(ft.length!==1)throw new Error("not a rule");var $t=/data\-css\-([a-zA-Z0-9\-_]+)/.exec(ft[0]);if(!$t)throw new Error("not a rule");return $t[1]}var Ge=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g;function lt($e){if($e.indexOf(",")===-1)return[$e];for(var ft,$t=[],Jt=[],Pn=0;ft=Ge.exec($e);)switch(ft[0]){case"(":Pn++;break;case")":Pn--;break;case",":if(Pn)break;$t.push(ft.index)}for(ft=$t.length;ft--;)Jt.unshift($e.slice($t[ft]+1)),$e=$e.slice(0,$t[ft]);return Jt.unshift($e),Jt}function It($e,ft){if(!$e)return ft.replace(/\&/g,"");if(!ft)return".css-"+$e+",[data-css-"+$e+"]";var $t=lt(ft).map(function(Jt){return Jt.indexOf("&")>=0?[Jt.replace(/\&/gm,".css-"+$e),Jt.replace(/\&/gm,"[data-css-"+$e+"]")].join(","):".css-"+$e+Jt+",[data-css-"+$e+"]"+Jt}).join(",");return Y&&/^\&\:/.exec(ft)&&!/\s/.exec(ft)&&($t+=",.css-"+$e+"[data-simulate-"+ye(ft)+"],[data-css-"+$e+"][data-simulate-"+ye(ft)+"]"),$t}function wt($e){var ft=$e.selector,$t=$e.style,Jt=j.transform({selector:ft,style:$t});return Jt.selector+"{"+(0,E.createMarkupForStyles)(Jt.style)+"}"}function we($e){var ft=void 0,$t=void 0,Jt=void 0,Pn=void 0;return Object.keys($e).forEach(function(An){An.indexOf("&")>=0?($t=$t||{})[An]=$e[An]:An.indexOf("@media")===0?(Jt=Jt||{})[An]=we($e[An]):An.indexOf("@supports")===0?(Pn=Pn||{})[An]=we($e[An]):An==="label"?$e.label.length>0&&((ft=ft||{}).label=oe?$e.label.join("."):""):(ft=ft||{})[An]=$e[An]}),{plain:ft,selects:$t,medias:Jt,supports:Pn}}function yt($e,ft){var $t=[],Jt=ft.plain,Pn=ft.selects,An=ft.medias,Qn=ft.supports;return Jt&&$t.push(wt({style:Jt,selector:It($e)})),Pn&&Object.keys(Pn).forEach(function(Ce){return $t.push(wt({style:Pn[Ce],selector:It($e,Ce)}))}),An&&Object.keys(An).forEach(function(Ce){return $t.push(Ce+"{"+yt($e,An[Ce]).join("")+"}")}),Qn&&Object.keys(Qn).forEach(function(Ce){return $t.push(Ce+"{"+yt($e,Qn[Ce]).join("")+"}")}),$t}var Bt=W.inserted={},Ot=W.registered={};function ze($e){Ot[$e.id]||(Ot[$e.id]=$e)}var Ut={};function Ft($e){if(ze($e),function($t){if(!Bt[$t.id]){Bt[$t.id]=!0;var Jt=we($t.style),Pn=yt($t.id,Jt);Bt[$t.id]=!!Q||Pn,Pn.forEach(function(An){return W.insert(An)})}}($e),Ut[$e.id])return Ut[$e.id];var ft=R({},"data-css-"+$e.id,oe&&$e.label||"");return Object.defineProperty(ft,"toString",{enumerable:!1,value:function(){return"css-"+$e.id}}),Ut[$e.id]=ft,ft}function pt($e,ft){var $t=lt($e).map(function(Jt){return Jt.indexOf("&")>=0?Jt:"&"+Jt});return lt(ft).map(function(Jt){return Jt.indexOf("&")>=0?Jt:"&"+Jt}).reduce(function(Jt,Pn){return Jt.concat($t.map(function(An){return Pn.replace(/\&/g,An)}))},[]).join(",")}var vt={"::placeholder":["::-webkit-input-placeholder","::-moz-placeholder","::-ms-input-placeholder"],":fullscreen":[":-webkit-full-screen",":-moz-full-screen",":-ms-fullscreen"]};function rn($e,ft){var $t=ft.selector,Jt=$t===void 0?"":$t,Pn=ft.mq,An=Pn===void 0?"":Pn,Qn=ft.supp,Ce=Qn===void 0?"":Qn,sr=ft.src,Mr=sr===void 0?{}:sr;Array.isArray(Mr)||(Mr=[Mr]),(Mr=function on(Gt){for(var Hn=[],Kt=0;Kt<Gt.length;Kt++)Hn=Array.isArray(Gt[Kt])?Hn.concat(on(Gt[Kt])):Hn.concat(Gt[Kt]);return Hn}(Mr)).forEach(function(on){if(pe(on)){var Gt=function(Hn){if(pe(Hn)){var Kt=Ot[me(Hn)];if(Kt==null)throw new Error("[glamor] an unexpected rule cache miss occurred. This is probably a sign of multiple glamor instances in your app. See https://github.com/threepointone/glamor/issues/79");return Kt}return Hn}(on);if(Gt.type!=="css")throw new Error("cannot merge this rule");on=Gt.style}(on=(0,A.default)(on))&&on.composes&&rn($e,{selector:Jt,mq:An,supp:Ce,src:on.composes}),Object.keys(on||{}).forEach(function(Hn){if(function(Vt){for(var en=[":",".","[",">"," "],Vn=!1,Dt=Vt.charAt(0),On=0;On<en.length;On++)if(Dt===en[On]){Vn=!0;break}return Vn||Vt.indexOf("&")>=0}(Hn))vt[Hn]&&vt[Hn].forEach(function(Vt){return rn($e,{selector:pt(Jt,Vt),mq:An,supp:Ce,src:on[Hn]})}),rn($e,{selector:pt(Jt,Hn),mq:An,supp:Ce,src:on[Hn]});else if(function(Vt){return Vt.indexOf("@media")===0}(Hn))rn($e,{selector:Jt,mq:function(Vt,en){return Vt?"@media "+Vt.substring(6)+" and "+en.substring(6):en}(An,Hn),supp:Ce,src:on[Hn]});else if(function(Vt){return Vt.indexOf("@supports")===0}(Hn))rn($e,{selector:Jt,mq:An,supp:function(Vt,en){return Vt?"@supports "+Vt.substring(9)+" and "+en.substring(9):en}(Ce,Hn),src:on[Hn]});else if(Hn!=="composes"){var Kt=$e;Ce&&(Kt[Ce]=Kt[Ce]||{},Kt=Kt[Ce]),An&&(Kt[An]=Kt[An]||{},Kt=Kt[An]),Jt&&(Kt[Jt]=Kt[Jt]||{},Kt=Kt[Jt]),Hn==="label"?oe&&($e.label=$e.label.concat(on.label)):Kt[Hn]=on[Hn]}})})}function xt($e){var ft={label:[]};return rn(ft,{src:$e}),Ft({id:_e(ft),style:ft,label:oe?ft.label.join("."):"",type:"css"})}var _t={};Object.defineProperty(_t,"toString",{enumerable:!1,value:function(){return"css-nil"}});var Xt=typeof WeakMap<"u"?[_t,new WeakMap,new WeakMap,new WeakMap]:[_t],sn=typeof WeakMap<"u"?function($e){return function(ft){if(Xt[ft.length]){for(var $t=Xt[ft.length],Jt=0;Jt<ft.length-1;)$t.has(ft[Jt])||$t.set(ft[Jt],new WeakMap),$t=$t.get(ft[Jt]),Jt++;if($t.has(ft[ft.length-1])){var Pn=$t.get(ft[Jt]);if(Ot[Pn.toString().substring(4)])return Pn}}var An=$e(ft);if(Xt[ft.length]){for(var Qn=0,Ce=Xt[ft.length];Qn<ft.length-1;)Ce=Ce.get(ft[Qn]),Qn++;try{Ce.set(ft[Qn],An)}catch{}}return An}}(xt):xt;function kn(){for(var $e=arguments.length,ft=Array($e),$t=0;$t<$e;$t++)ft[$t]=arguments[$t];if(ft[0]&&ft[0].length&&ft[0].raw)throw new Error("you forgot to include glamor/babel in your babel plugins.");return(ft=(0,A.default)(ft))?sn(ft):_t}kn.insert=function($e){var ft={id:_e($e),css:$e,type:"raw"};ze(ft),Bt[ft.id]||(W.insert(ft.css),Bt[ft.id]=!!Q||[ft.css])},a.insertRule=kn.insert,kn.global=function($e,ft){if(ft=(0,A.default)(ft))return kn.insert(wt({selector:$e,style:ft}))},a.insertGlobal=kn.global,kn.keyframes=function($e,ft){ft||(ft=$e,$e="animation");var $t={id:_e({name:$e,kfs:ft=(0,A.default)(ft)||{}}),type:"keyframes",name:$e,keyframes:ft};return ze($t),function(Jt){if(!Bt[Jt.id]){var Pn=Object.keys(Jt.keyframes).map(function(Qn){var Ce=j.keyframes.transform({id:Jt.id,name:Qn,style:Jt.keyframes[Qn]});return Ce.name+"{"+(0,E.createMarkupForStyles)(Ce.style)+"}"}).join(""),An=["-webkit-","-moz-","-o-",""].map(function(Qn){return"@"+Qn+"keyframes "+Jt.name+"_"+Jt.id+"{"+Pn+"}"});An.forEach(function(Qn){return W.insert(Qn)}),Bt[Jt.id]=!!Q||An}}($t),$e+"_"+$t.id},kn.fontFace=function($e){var ft={id:_e($e=(0,A.default)($e)),type:"font-face",font:$e};return ze(ft),function($t){if(!Bt[$t.id]){var Jt="@font-face{"+(0,E.createMarkupForStyles)($t.font)+"}";W.insert(Jt),Bt[$t.id]=!!Q||[Jt]}}(ft),$e.fontFamily},a.fontFace=kn.fontFace,a.keyframes=kn.keyframes,a.presets={mobile:"(min-width: 400px)",Mobile:"@media (min-width: 400px)",phablet:"(min-width: 550px)",Phablet:"@media (min-width: 550px)",tablet:"(min-width: 750px)",Tablet:"@media (min-width: 750px)",desktop:"(min-width: 1000px)",Desktop:"@media (min-width: 1000px)",hd:"(min-width: 1200px)",Hd:"@media (min-width: 1200px)"};var an=a.style=kn;function Ve($e){for(var ft=arguments.length,$t=Array(ft>1?ft-1:0),Jt=1;Jt<ft;Jt++)$t[Jt-1]=arguments[Jt];return $e?kn(R({},$e,$t)):an($t)}a.$=Ve,a.merge=kn,a.compose=kn;function Ye($e){for(var ft=arguments.length,$t=Array(ft>1?ft-1:0),Jt=1;Jt<ft;Jt++)$t[Jt-1]=arguments[Jt];return kn(R({},$e,$t))}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=function(){function E(A){this.global=A,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return E.prototype.setPlatform=function(A,U){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+U+"."),this.platformName=A,this.platform=U},E.prototype.registerFlag=function(A,U,B){if(this.flagRegistry[A]={evaluationFn:U,setHook:B},this.urlFlags[A]!=null){var D=this.urlFlags[A];console.warn("Setting feature override from URL "+A+": "+D+"."),this.set(A,D)}},E.prototype.get=function(A){return A in this.flags?this.flags[A]:(this.flags[A]=this.evaluateFlag(A),this.flags[A])},E.prototype.getNumber=function(A){return this.get(A)},E.prototype.getBool=function(A){return this.get(A)},E.prototype.getFlags=function(){return this.flags},Object.defineProperty(E.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),E.prototype.set=function(A,U){if(this.flagRegistry[A]==null)throw new Error("Cannot set flag "+A+" as it has not been registered.");this.flags[A]=U,this.flagRegistry[A].setHook!=null&&this.flagRegistry[A].setHook(U)},E.prototype.evaluateFlag=function(A){if(this.flagRegistry[A]==null)throw new Error("Cannot evaluate flag '"+A+"': no evaluation function found.");return this.flagRegistry[A].evaluationFn()},E.prototype.setFlags=function(A){this.flags=Object.assign({},A)},E.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},E.prototype.populateURLFlags=function(){var A=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var U=S(this.global.location.search);"tfjsflags"in U&&U.tfjsflags.split(",").forEach(function(B){var D=B.split(":"),R=D[0],W=D[1];A.urlFlags[R]=function(j,H){if((H=H.toLowerCase())==="true"||H==="false")return H==="true";if(""+ +H===H)return+H;throw new Error("Could not parse value flag value "+H+" for flag "+j+".")}(R,W)})}},E}();function S(E){var A={};return E.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(U){for(var B=[],D=1;D<arguments.length;D++)B[D-1]=arguments[D];return function(R,W,j){R[decodeURIComponent(W)]=decodeURIComponent(j||"")}(A,B[0],B[1]),B.join("=")}),A}a.Environment=c,a.getQueryParams=S,a.env=function(){return a.ENV},a.ENV=null,a.setEnvironmentGlobal=function(E){a.ENV=E}},function(s,a,r){var c=r(14),S=r(55),E=r(19)("species");s.exports=function(A,U){var B,D=c(A).constructor;return D===void 0||(B=c(D)[E])==null?U:S(B)}},function(s,a,r){var c=r(62),S=r(19)("toStringTag"),E=c(function(){return arguments}())=="Arguments";s.exports=function(A){var U,B,D;return A===void 0?"Undefined":A===null?"Null":typeof(B=function(R,W){try{return R[W]}catch{}}(U=Object(A),S))=="string"?B:E?c(U):(D=c(U))=="Object"&&typeof U.callee=="function"?"Arguments":D}},function(s,a){a.f={}.propertyIsEnumerable},function(s,a,r){var c=r(62);s.exports=Object("z").propertyIsEnumerable(0)?Object:function(S){return c(S)=="String"?S.split(""):Object(S)}},function(s,a,r){var c=r(87);a.a=function(S){let E=S,A=S;function U(B,D,R,W){for(R==null&&(R=0),W==null&&(W=B.length);R<W;){const j=R+W>>>1;A(B[j],D)<0?R=j+1:W=j}return R}return S.length===1&&(E=(B,D)=>S(B)-D,A=function(B){return(D,R)=>Object(c.a)(B(D),R)}(S)),{left:U,center:function(B,D,R,W){R==null&&(R=0),W==null&&(W=B.length);const j=U(B,D,R,W-1);return j>R&&E(B[j-1],D)>-E(B[j],D)?j-1:j},right:function(B,D,R,W){for(R==null&&(R=0),W==null&&(W=B.length);R<W;){const j=R+W>>>1;A(B[j],D)>0?W=j:R=j+1}return R}}}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});const c=r(50),S=r(247),E=r(102),A=r(46);a.table=function(B,D,R={}){if(D&&D.headers==null)throw new Error('Data to render must have a "headers" property');if(D&&D.values==null)throw new Error('Data to render must have a "values" property');const W=A.getDrawArea(B),j=Object.assign({},U,R);let H=S.select(W).select("table.tf-table");const I=E.css({fontSize:j.fontSize||".875rem",width:"100%",maxWidth:"64rem",marginRight:"auto",marginLeft:"auto"});if(H.size()===0&&((H=S.select(W).append("table")).attr("class",` ${I} tf-table`),H.append("thead").append("tr"),H.append("tbody")),H.size()!==1)throw new Error("Error inserting table");const Q=E.css({fontWeight:"600",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )",textAlign:"left",paddingBottom:"1rem",paddingRight:"1rem",backgroundColor:"#fff"}),Y=H.select("thead").select("tr").selectAll("th").data(D.headers),q=Y.enter().append("th").attr("class",`${Q}`);Y.merge(q).html(Ge=>Ge),Y.exit().remove();const ae=c.format(",.4~f"),oe=H.select("tbody").selectAll("tr").data(D.values),ye=oe.enter().append("tr"),_e=E.css({padding:"0.25rem",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )"}),pe=oe.merge(ye).selectAll("td").data(Ge=>Ge),me=pe.enter().append("td").attr("class",`${_e}`);pe.merge(me).html(Ge=>typeof Ge=="number"?ae(Ge):Ge),pe.exit().remove(),oe.exit().remove()};const U={fontSize:14}},function(s,a,r){var c=this&&this.__awaiter||function(A,U,B,D){return new(B||(B=Promise))(function(R,W){function j(Q){try{I(D.next(Q))}catch(Y){W(Y)}}function H(Q){try{I(D.throw(Q))}catch(Y){W(Y)}}function I(Q){Q.done?R(Q.value):new B(function(Y){Y(Q.value)}).then(j,H)}I((D=D.apply(A,U||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0});const S=r(0),E=r(111);a.arrayStats=function(A){if(!Array.isArray(A))throw new Error("input must be an array");if(A.length===0)return{numVals:0,numNans:0,numZeros:0,max:void 0,min:void 0};const U=A.length;let B=-1/0,D=1/0,R=0,W=0,j=0;for(let I=0;I<U;I++){const Q=A[I];Q>B&&(B=Q),Q<D&&(D=Q),Q===0&&(R+=1),isNaN(Q)?W+=1:isFinite(Q)||(j+=1)}const H={numVals:U,numZeros:R,numNans:W,max:B,min:D,numInfs:j};return H.max===-1/0&&(H.max=NaN),H.min===1/0&&(H.min=NaN),H},a.tensorStats=function(A){return c(this,void 0,void 0,function*(){const[U,B,D]=S.tidy(()=>{const R=S.scalar(0,A.dtype);return[A.min(),A.max(),A.equal(R).sum()]});return Promise.all([A.data(),U.data(),B.data(),D.data()]).then(([R,W,j,H])=>{const I=R.length;let Q=0,Y=0;for(let oe=0;oe<I;oe++){const ye=R[oe];isNaN(ye)?Q+=1:isFinite(ye)||(Y+=1)}let q=W[0],ae=j[0];return Q===I&&(q=NaN,ae=NaN),{numVals:I,numZeros:H[0],numNans:Q,min:q,max:ae,numInfs:Y}})})},a.confusionMatrix=function(A,U,B,D){return c(this,void 0,void 0,function*(){E.assert(A.rank===1,"labels must be a 1D tensor"),E.assert(U.rank===1,"predictions must be a 1D tensor"),E.assert(A.size===U.size,"labels and predictions must be the same length"),D!=null&&E.assert(D.size===U.size,"labels and predictions must be the same length");const R=A.cast("int32"),W=U.cast("int32");B==null&&(B=S.tidy(()=>S.maximum(R.max(),W.max()).cast("int32").dataSync()[0]+1));let j=Promise.resolve(null);return D!=null&&(j=D.data()),Promise.all([R.data(),W.data(),j]).then(([H,I,Q])=>{const Y=Array(B).fill(0);for(let q=0;q<B;q++)Y[q]=Array(B).fill(0);for(let q=0;q<H.length;q++){const ae=H[q],oe=I[q];Y[ae][oe]+=Q!=null?Q[q]:1}return Y})})},a.accuracy=function(A,U){return c(this,void 0,void 0,function*(){E.assertShapesMatch(A.shape,U.shape,"Error computing accuracy.");const B=A.equal(U),D=B.mean(),R=(yield D.data())[0];return S.dispose([B,D]),R})},a.perClassAccuracy=function(A,U,B){return c(this,void 0,void 0,function*(){return E.assert(A.rank===1,"labels must be a 1D tensor"),E.assert(U.rank===1,"predictions must be a 1D tensor"),E.assert(A.size===U.size,"labels and predictions must be the same length"),B==null&&(B=S.tidy(()=>S.maximum(A.max(),U.max()).dataSync()[0]+1)),Promise.all([A.data(),U.data()]).then(([D,R])=>{const W=Array(B).fill(0),j=Array(B).fill(0);for(let I=0;I<D.length;I++){const Q=D[I],Y=R[I];W[Q]+=1,Q===Y&&(j[Q]+=1)}const H=[];for(let I=0;I<W.length;I++)H.push({count:W[I],accuracy:W[I]===0?0:j[I]/W[I]});return H})})}},function(s,a,r){function c(E,A){if(!E)throw new Error(typeof A=="string"?A:A())}function S(E,A){if(E.length!==A.length)return!1;for(let U=0;U<E.length;U++)if(E[U]!==A[U])return!1;return!0}Object.defineProperty(a,"__esModule",{value:!0}),a.assert=c,a.assertShapesMatch=function(E,A,U=""){c(S(E,A),U+` Shapes ${E} and ${A} must match`)},a.arraysEqual=S,a.DECIMAL_PLACES_TO_CHECK=4},function(s,a,r){const c=r(47);s.exports=(S,E,A)=>{try{E=new c(E,A)}catch{return!1}return E.test(S)}},function(s,a,r){const c=Symbol("SemVer ANY");class S{static get ANY(){return c}constructor(H,I){if(I=E(I),H instanceof S){if(H.loose===!!I.loose)return H;H=H.value}D("comparator",H,I),this.options=I,this.loose=!!I.loose,this.parse(H),this.semver===c?this.value="":this.value=this.operator+this.semver.version,D("comp",this)}parse(H){const I=this.options.loose?A[U.COMPARATORLOOSE]:A[U.COMPARATOR],Q=H.match(I);if(!Q)throw new TypeError(`Invalid comparator: ${H}`);this.operator=Q[1]!==void 0?Q[1]:"",this.operator==="="&&(this.operator=""),Q[2]?this.semver=new R(Q[2],this.options.loose):this.semver=c}toString(){return this.value}test(H){if(D("Comparator.test",H,this.options.loose),this.semver===c||H===c)return!0;if(typeof H=="string")try{H=new R(H,this.options)}catch{return!1}return B(H,this.operator,this.semver,this.options)}intersects(H,I){if(!(H instanceof S))throw new TypeError("a Comparator is required");if(I&&typeof I=="object"||(I={loose:!!I,includePrerelease:!1}),this.operator==="")return this.value===""||new W(H.value,I).test(this.value);if(H.operator==="")return H.value===""||new W(this.value,I).test(H.semver);const Q=!(this.operator!==">="&&this.operator!==">"||H.operator!==">="&&H.operator!==">"),Y=!(this.operator!=="<="&&this.operator!=="<"||H.operator!=="<="&&H.operator!=="<"),q=this.semver.version===H.semver.version,ae=!(this.operator!==">="&&this.operator!=="<="||H.operator!==">="&&H.operator!=="<="),oe=B(this.semver,"<",H.semver,I)&&(this.operator===">="||this.operator===">")&&(H.operator==="<="||H.operator==="<"),ye=B(this.semver,">",H.semver,I)&&(this.operator==="<="||this.operator==="<")&&(H.operator===">="||H.operator===">");return Q||Y||q&&ae||oe||ye}}s.exports=S;const E=r(115),{re:A,t:U}=r(90),B=r(203),D=r(116),R=r(32),W=r(47)},function(s,a,r){const c=r(48);s.exports=(S,E,A)=>c(S,E,A)>0},function(s,a){const r=["includePrerelease","loose","rtl"];s.exports=c=>c?typeof c!="object"?{loose:!0}:r.filter(S=>c[S]).reduce((S,E)=>(S[E]=!0,S),{}):{}},function(s,a,r){(function(c){const S=typeof c=="object"&&c.env&&c.env.NODE_DEBUG&&/\bsemver\b/i.test(c.env.NODE_DEBUG)?(...E)=>console.error("SEMVER",...E):()=>{};s.exports=S}).call(this,r(75))},function(s,a){const r=Number.MAX_SAFE_INTEGER||9007199254740991;s.exports={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:r,MAX_SAFE_COMPONENT_LENGTH:16}},function(s,a,r){for(var c,S=r(16),E=r(42),A=r(84),U=A("typed_array"),B=A("view"),D=!(!S.ArrayBuffer||!S.DataView),R=D,W=0,j="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");W<9;)(c=S[j[W++]])?(E(c.prototype,U,!0),E(c.prototype,B,!0)):R=!1;s.exports={ABV:D,CONSTR:R,TYPED:U,VIEW:B}},function(s,a,r){var c=r(16),S=r(8),E=r(38),A=r(93),U=r(65),B=r(121),D=r(94),R=r(13),W=r(15),j=r(125),H=r(98),I=r(168);s.exports=function(Q,Y,q,ae,oe,ye){var _e=c[Q],pe=_e,me=oe?"set":"add",Ge=pe&&pe.prototype,lt={},It=function(ze){var Ut=Ge[ze];E(Ge,ze,ze=="delete"?function(Ft){return!(ye&&!R(Ft))&&Ut.call(this,Ft===0?0:Ft)}:ze=="has"?function(Ft){return!(ye&&!R(Ft))&&Ut.call(this,Ft===0?0:Ft)}:ze=="get"?function(Ft){return ye&&!R(Ft)?void 0:Ut.call(this,Ft===0?0:Ft)}:ze=="add"?function(Ft){return Ut.call(this,Ft===0?0:Ft),this}:function(Ft,pt){return Ut.call(this,Ft===0?0:Ft,pt),this})};if(typeof pe=="function"&&(ye||Ge.forEach&&!W(function(){new pe().entries().next()}))){var wt=new pe,we=wt[me](ye?{}:-0,1)!=wt,yt=W(function(){wt.has(1)}),Bt=j(function(ze){new pe(ze)}),Ot=!ye&&W(function(){for(var ze=new pe,Ut=5;Ut--;)ze[me](Ut,Ut);return!ze.has(-0)});Bt||((pe=Y(function(ze,Ut){D(ze,pe,Q);var Ft=I(new _e,ze,pe);return Ut!=null&&B(Ut,oe,Ft[me],Ft),Ft})).prototype=Ge,Ge.constructor=pe),(yt||Ot)&&(It("delete"),It("has"),oe&&It("get")),(Ot||we)&&It(me),ye&&Ge.clear&&delete Ge.clear}else pe=ae.getConstructor(Y,Q,oe,me),A(pe.prototype,q),U.NEED=!0;return H(pe,Q),lt[Q]=pe,S(S.G+S.W+S.F*(pe!=_e),lt),ye||ae.setStrong(pe,Q,oe),pe}},function(s,a,r){var c=r(16).navigator;s.exports=c&&c.userAgent||""},function(s,a,r){var c=r(56),S=r(225),E=r(159),A=r(14),U=r(22),B=r(157),D={},R={};(a=s.exports=function(W,j,H,I,Q){var Y,q,ae,oe,ye=Q?function(){return W}:B(W),_e=c(H,I,j?2:1),pe=0;if(typeof ye!="function")throw TypeError(W+" is not iterable!");if(E(ye)){for(Y=U(W.length);Y>pe;pe++)if((oe=j?_e(A(q=W[pe])[0],q[1]):_e(W[pe]))===D||oe===R)return oe}else for(ae=ye.call(W);!(q=ae.next()).done;)if((oe=S(ae,_e,q.value,j))===D||oe===R)return oe}).BREAK=D,a.RETURN=R},function(s,a,r){r(220);var c=r(38),S=r(42),E=r(15),A=r(61),U=r(19),B=r(154),D=U("species"),R=!E(function(){var j=/./;return j.exec=function(){var H=[];return H.groups={a:"7"},H},"".replace(j,"$<a>")!=="7"}),W=function(){var j=/(?:)/,H=j.exec;j.exec=function(){return H.apply(this,arguments)};var I="ab".split(j);return I.length===2&&I[0]==="a"&&I[1]==="b"}();s.exports=function(j,H,I){var Q=U(j),Y=!E(function(){var pe={};return pe[Q]=function(){return 7},""[j](pe)!=7}),q=Y?!E(function(){var pe=!1,me=/a/;return me.exec=function(){return pe=!0,null},j==="split"&&(me.constructor={},me.constructor[D]=function(){return me}),me[Q](""),!pe}):void 0;if(!Y||!q||j==="replace"&&!R||j==="split"&&!W){var ae=/./[Q],oe=I(A,Q,""[j],function(pe,me,Ge,lt,It){return me.exec===B?Y&&!It?{done:!0,value:ae.call(me,Ge,lt)}:{done:!0,value:pe.call(Ge,me,lt)}:{done:!1}}),ye=oe[0],_e=oe[1];c(String.prototype,j,ye),S(RegExp.prototype,Q,H==2?function(pe,me){return _e.call(pe,this,me)}:function(pe){return _e.call(pe,this)})}}},function(s,a,r){var c=r(105),S=RegExp.prototype.exec;s.exports=function(E,A){var U=E.exec;if(typeof U=="function"){var B=U.call(E,A);if(typeof B!="object")throw new TypeError("RegExp exec method returned something other than an Object or null");return B}if(c(E)!=="RegExp")throw new TypeError("RegExp#exec called on incompatible receiver");return S.call(E,A)}},function(s,a,r){var c=r(14);s.exports=function(){var S=c(this),E="";return S.global&&(E+="g"),S.ignoreCase&&(E+="i"),S.multiline&&(E+="m"),S.unicode&&(E+="u"),S.sticky&&(E+="y"),E}},function(s,a,r){var c=r(19)("iterator"),S=!1;try{var E=[7][c]();E.return=function(){S=!0},Array.from(E,function(){throw 2})}catch{}s.exports=function(A,U){if(!U&&!S)return!1;var B=!1;try{var D=[7],R=D[c]();R.next=function(){return{done:B=!0}},D[c]=function(){return R},A(D)}catch{}return B}},function(s,a,r){var c=r(62);s.exports=Array.isArray||function(S){return c(S)=="Array"}},function(s,a){a.f=Object.getOwnPropertySymbols},function(s,a,r){var c=r(41),S=r(22),E=r(81);s.exports=function(A){return function(U,B,D){var R,W=c(U),j=S(W.length),H=E(D,j);if(A&&B!=B){for(;j>H;)if((R=W[H++])!=R)return!0}else for(;j>H;H++)if((A||H in W)&&W[H]===B)return A||H||0;return!A&&-1}}},function(s,a,r){var c=r(24),S=r(16),E=S["__core-js_shared__"]||(S["__core-js_shared__"]={});(s.exports=function(A,U){return E[A]||(E[A]=U!==void 0?U:{})})("versions",[]).push({version:c.version,mode:r(83)?"pure":"global",copyright:" 2020 Denis Pushkarev (zloirock.ru)"})},function(s,a,r){r.r(a),function(c,S){r.d(a,"array",function(){return Pn}),r.d(a,"Dataset",function(){return $t}),r.d(a,"zip",function(){return An}),r.d(a,"CSVDataset",function(){return Kt}),r.d(a,"TextLineDataset",function(){return Ce}),r.d(a,"csv",function(){return ir}),r.d(a,"func",function(){return Or}),r.d(a,"generator",function(){return qr}),r.d(a,"microphone",function(){return Tt}),r.d(a,"webcam",function(){return Kr}),r.d(a,"FileDataSource",function(){return Xr}),r.d(a,"URLDataSource",function(){return zn}),r.d(a,"version_data",function(){return Rr});var E=r(0),A=function(Qt,Se){return(A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ve,ke){ve.__proto__=ke}||function(ve,ke){for(var Me in ke)ke.hasOwnProperty(Me)&&(ve[Me]=ke[Me])})(Qt,Se)};function U(Qt,Se){function ve(){this.constructor=Qt}A(Qt,Se),Qt.prototype=Se===null?Object.create(Se):(ve.prototype=Se.prototype,new ve)}function B(Qt,Se,ve,ke){return new(ve||(ve=Promise))(function(Me,rt){function Ct(Rt){try{Sn(ke.next(Rt))}catch(Zt){rt(Zt)}}function tn(Rt){try{Sn(ke.throw(Rt))}catch(Zt){rt(Zt)}}function Sn(Rt){Rt.done?Me(Rt.value):new ve(function(Zt){Zt(Rt.value)}).then(Ct,tn)}Sn((ke=ke.apply(Qt,Se||[])).next())})}function D(Qt,Se){var ve,ke,Me,rt,Ct={label:0,sent:function(){if(1&Me[0])throw Me[1];return Me[1]},trys:[],ops:[]};return rt={next:tn(0),throw:tn(1),return:tn(2)},typeof Symbol=="function"&&(rt[Symbol.iterator]=function(){return this}),rt;function tn(Sn){return function(Rt){return function(Zt){if(ve)throw new TypeError("Generator is already executing.");for(;Ct;)try{if(ve=1,ke&&(Me=2&Zt[0]?ke.return:Zt[0]?ke.throw||((Me=ke.return)&&Me.call(ke),0):ke.next)&&!(Me=Me.call(ke,Zt[1])).done)return Me;switch(ke=0,Me&&(Zt=[2&Zt[0],Me.value]),Zt[0]){case 0:case 1:Me=Zt;break;case 4:return Ct.label++,{value:Zt[1],done:!1};case 5:Ct.label++,ke=Zt[1],Zt=[0];continue;case 7:Zt=Ct.ops.pop(),Ct.trys.pop();continue;default:if(!(Me=(Me=Ct.trys).length>0&&Me[Me.length-1])&&(Zt[0]===6||Zt[0]===2)){Ct=0;continue}if(Zt[0]===3&&(!Me||Zt[1]>Me[0]&&Zt[1]<Me[3])){Ct.label=Zt[1];break}if(Zt[0]===6&&Ct.label<Me[1]){Ct.label=Me[1],Me=Zt;break}if(Me&&Ct.label<Me[2]){Ct.label=Me[2],Ct.ops.push(Zt);break}Me[2]&&Ct.ops.pop(),Ct.trys.pop();continue}Zt=Se.call(Qt,Ct)}catch(mn){Zt=[6,mn],ke=0}finally{ve=Me=0}if(5&Zt[0])throw Zt[1];return{value:Zt[0]?Zt[1]:void 0,done:!0}}([Sn,Rt])}}}function R(Qt,Se){return Qt(Se={exports:{}},Se.exports),Se.exports}var W=R(function(Qt){(function(Se,ve,ke){function Me(Ct,tn){return tn.c=Ct.c,tn.s0=Ct.s0,tn.s1=Ct.s1,tn.s2=Ct.s2,tn}function rt(Ct,tn){var Sn=new function(mn){var fn,mt=this,Mt=(fn=4022871197,function(hn){hn=hn.toString();for(var nn=0;nn<hn.length;nn++){var He=.02519603282416938*(fn+=hn.charCodeAt(nn));He-=fn=He>>>0,fn=(He*=fn)>>>0,fn+=4294967296*(He-=fn)}return 23283064365386963e-26*(fn>>>0)});mt.next=function(){var hn=2091639*mt.s0+23283064365386963e-26*mt.c;return mt.s0=mt.s1,mt.s1=mt.s2,mt.s2=hn-(mt.c=0|hn)},mt.c=1,mt.s0=Mt(" "),mt.s1=Mt(" "),mt.s2=Mt(" "),mt.s0-=Mt(mn),mt.s0<0&&(mt.s0+=1),mt.s1-=Mt(mn),mt.s1<0&&(mt.s1+=1),mt.s2-=Mt(mn),mt.s2<0&&(mt.s2+=1),Mt=null}(Ct),Rt=tn&&tn.state,Zt=Sn.next;return Zt.int32=function(){return 4294967296*Sn.next()|0},Zt.double=function(){return Zt()+11102230246251565e-32*(2097152*Zt()|0)},Zt.quick=Zt,Rt&&(typeof Rt=="object"&&Me(Rt,Sn),Zt.state=function(){return Me(Sn,{})}),Zt}ve&&ve.exports?ve.exports=rt:this.alea=rt})(0,Qt)}),j=R(function(Qt){(function(Se,ve,ke){function Me(Ct,tn){return tn.x=Ct.x,tn.y=Ct.y,tn.z=Ct.z,tn.w=Ct.w,tn}function rt(Ct,tn){var Sn=new function(mn){var fn=this,mt="";fn.x=0,fn.y=0,fn.z=0,fn.w=0,fn.next=function(){var hn=fn.x^fn.x<<11;return fn.x=fn.y,fn.y=fn.z,fn.z=fn.w,fn.w^=fn.w>>>19^hn^hn>>>8},mn===(0|mn)?fn.x=mn:mt+=mn;for(var Mt=0;Mt<mt.length+64;Mt++)fn.x^=0|mt.charCodeAt(Mt),fn.next()}(Ct),Rt=tn&&tn.state,Zt=function(){return(Sn.next()>>>0)/4294967296};return Zt.double=function(){do var mn=((Sn.next()>>>11)+(Sn.next()>>>0)/4294967296)/2097152;while(mn===0);return mn},Zt.int32=Sn.next,Zt.quick=Zt,Rt&&(typeof Rt=="object"&&Me(Rt,Sn),Zt.state=function(){return Me(Sn,{})}),Zt}ve&&ve.exports?ve.exports=rt:this.xor128=rt})(0,Qt)}),H=R(function(Qt){(function(Se,ve,ke){function Me(Ct,tn){return tn.x=Ct.x,tn.y=Ct.y,tn.z=Ct.z,tn.w=Ct.w,tn.v=Ct.v,tn.d=Ct.d,tn}function rt(Ct,tn){var Sn=new function(mn){var fn=this,mt="";fn.next=function(){var hn=fn.x^fn.x>>>2;return fn.x=fn.y,fn.y=fn.z,fn.z=fn.w,fn.w=fn.v,(fn.d=fn.d+362437|0)+(fn.v=fn.v^fn.v<<4^hn^hn<<1)|0},fn.x=0,fn.y=0,fn.z=0,fn.w=0,fn.v=0,mn===(0|mn)?fn.x=mn:mt+=mn;for(var Mt=0;Mt<mt.length+64;Mt++)fn.x^=0|mt.charCodeAt(Mt),Mt==mt.length&&(fn.d=fn.x<<10^fn.x>>>4),fn.next()}(Ct),Rt=tn&&tn.state,Zt=function(){return(Sn.next()>>>0)/4294967296};return Zt.double=function(){do var mn=((Sn.next()>>>11)+(Sn.next()>>>0)/4294967296)/2097152;while(mn===0);return mn},Zt.int32=Sn.next,Zt.quick=Zt,Rt&&(typeof Rt=="object"&&Me(Rt,Sn),Zt.state=function(){return Me(Sn,{})}),Zt}ve&&ve.exports?ve.exports=rt:this.xorwow=rt})(0,Qt)}),I=R(function(Qt){(function(Se,ve,ke){function Me(Ct,tn){return tn.x=Ct.x.slice(),tn.i=Ct.i,tn}function rt(Ct,tn){Ct==null&&(Ct=+new Date);var Sn=new function(mn){var fn=this;fn.next=function(){var mt,Mt,hn=fn.x,nn=fn.i;return mt=hn[nn],Mt=(mt^=mt>>>7)^mt<<24,Mt^=(mt=hn[nn+1&7])^mt>>>10,Mt^=(mt=hn[nn+3&7])^mt>>>3,Mt^=(mt=hn[nn+4&7])^mt<<7,mt=hn[nn+7&7],Mt^=(mt^=mt<<13)^mt<<9,hn[nn]=Mt,fn.i=nn+1&7,Mt},function(mt,Mt){var hn,nn=[];if(Mt===(0|Mt))nn[0]=Mt;else for(Mt=""+Mt,hn=0;hn<Mt.length;++hn)nn[7&hn]=nn[7&hn]<<15^Mt.charCodeAt(hn)+nn[hn+1&7]<<13;for(;nn.length<8;)nn.push(0);for(hn=0;hn<8&&nn[hn]===0;++hn);for(hn==8?nn[7]=-1:nn[hn],mt.x=nn,mt.i=0,hn=256;hn>0;--hn)mt.next()}(fn,mn)}(Ct),Rt=tn&&tn.state,Zt=function(){return(Sn.next()>>>0)/4294967296};return Zt.double=function(){do var mn=((Sn.next()>>>11)+(Sn.next()>>>0)/4294967296)/2097152;while(mn===0);return mn},Zt.int32=Sn.next,Zt.quick=Zt,Rt&&(Rt.x&&Me(Rt,Sn),Zt.state=function(){return Me(Sn,{})}),Zt}ve&&ve.exports?ve.exports=rt:this.xorshift7=rt})(0,Qt)}),Q=R(function(Qt){(function(Se,ve,ke){function Me(Ct,tn){return tn.i=Ct.i,tn.w=Ct.w,tn.X=Ct.X.slice(),tn}function rt(Ct,tn){Ct==null&&(Ct=+new Date);var Sn=new function(mn){var fn=this;fn.next=function(){var mt,Mt,hn=fn.w,nn=fn.X,He=fn.i;return fn.w=hn=hn+1640531527|0,Mt=nn[He+34&127],mt=nn[He=He+1&127],Mt^=Mt<<13,mt^=mt<<17,Mt^=Mt>>>15,mt^=mt>>>12,Mt=nn[He]=Mt^mt,fn.i=He,Mt+(hn^hn>>>16)|0},function(mt,Mt){var hn,nn,He,Bn,Xn,Zn=[],lr=128;for(Mt===(0|Mt)?(nn=Mt,Mt=null):(Mt+="\0",nn=0,lr=Math.max(lr,Mt.length)),He=0,Bn=-32;Bn<lr;++Bn)Mt&&(nn^=Mt.charCodeAt((Bn+32)%Mt.length)),Bn===0&&(Xn=nn),nn^=nn<<10,nn^=nn>>>15,nn^=nn<<4,nn^=nn>>>13,Bn>=0&&(Xn=Xn+1640531527|0,He=(hn=Zn[127&Bn]^=nn+Xn)==0?He+1:0);for(He>=128&&(Zn[127&(Mt&&Mt.length||0)]=-1),He=127,Bn=512;Bn>0;--Bn)nn=Zn[He+34&127],hn=Zn[He=He+1&127],nn^=nn<<13,hn^=hn<<17,nn^=nn>>>15,hn^=hn>>>12,Zn[He]=nn^hn;mt.w=Xn,mt.X=Zn,mt.i=He}(fn,mn)}(Ct),Rt=tn&&tn.state,Zt=function(){return(Sn.next()>>>0)/4294967296};return Zt.double=function(){do var mn=((Sn.next()>>>11)+(Sn.next()>>>0)/4294967296)/2097152;while(mn===0);return mn},Zt.int32=Sn.next,Zt.quick=Zt,Rt&&(Rt.X&&Me(Rt,Sn),Zt.state=function(){return Me(Sn,{})}),Zt}ve&&ve.exports?ve.exports=rt:this.xor4096=rt})(0,Qt)}),Y=R(function(Qt){(function(Se,ve,ke){function Me(Ct,tn){return tn.a=Ct.a,tn.b=Ct.b,tn.c=Ct.c,tn.d=Ct.d,tn}function rt(Ct,tn){var Sn=new function(mn){var fn=this,mt="";fn.next=function(){var hn=fn.b,nn=fn.c,He=fn.d,Bn=fn.a;return hn=hn<<25^hn>>>7^nn,nn=nn-He|0,He=He<<24^He>>>8^Bn,Bn=Bn-hn|0,fn.b=hn=hn<<20^hn>>>12^nn,fn.c=nn=nn-He|0,fn.d=He<<16^nn>>>16^Bn,fn.a=Bn-hn|0},fn.a=0,fn.b=0,fn.c=-1640531527,fn.d=1367130551,mn===Math.floor(mn)?(fn.a=mn/4294967296|0,fn.b=0|mn):mt+=mn;for(var Mt=0;Mt<mt.length+20;Mt++)fn.b^=0|mt.charCodeAt(Mt),fn.next()}(Ct),Rt=tn&&tn.state,Zt=function(){return(Sn.next()>>>0)/4294967296};return Zt.double=function(){do var mn=((Sn.next()>>>11)+(Sn.next()>>>0)/4294967296)/2097152;while(mn===0);return mn},Zt.int32=Sn.next,Zt.quick=Zt,Rt&&(typeof Rt=="object"&&Me(Rt,Sn),Zt.state=function(){return Me(Sn,{})}),Zt}ve&&ve.exports?ve.exports=rt:this.tychei=rt})(0,Qt)}),q=R(function(Qt){(function(Se,ve){var ke,Me=this,rt=256,Ct=6,tn="random",Sn=ve.pow(rt,Ct),Rt=ve.pow(2,52),Zt=2*Rt,mn=rt-1;function fn(nn,He,Bn){var Xn=[],Zn=Mt(function Cr(xi,Ai){var ni,to=[],yi=typeof xi;if(Ai&&yi=="object")for(ni in xi)try{to.push(Cr(xi[ni],Ai-1))}catch{}return to.length?to:yi=="string"?xi:xi+"\0"}((He=He==1?{entropy:!0}:He||{}).entropy?[nn,hn(Se)]:nn??function(){try{var Cr;return ke&&(Cr=ke.randomBytes)?Cr=Cr(rt):(Cr=new Uint8Array(rt),(Me.crypto||Me.msCrypto).getRandomValues(Cr)),hn(Cr)}catch{var xi=Me.navigator,Ai=xi&&xi.plugins;return[+new Date,Me,Ai,Me.screen,hn(Se)]}}(),3),Xn),lr=new function(Cr){var xi,Ai=Cr.length,ni=this,to=0,yi=ni.i=ni.j=0,ri=ni.S=[];for(Ai||(Cr=[Ai++]);to<rt;)ri[to]=to++;for(to=0;to<rt;to++)ri[to]=ri[yi=mn&yi+Cr[to%Ai]+(xi=ri[to])],ri[yi]=xi;(ni.g=function(Jr){for(var Kn,pi=0,Ci=ni.i,Wr=ni.j,so=ni.S;Jr--;)Kn=so[Ci=mn&Ci+1],pi=pi*rt+so[mn&(so[Ci]=so[Wr=mn&Wr+Kn])+(so[Wr]=Kn)];return ni.i=Ci,ni.j=Wr,pi})(rt)}(Xn),jr=function(){for(var Cr=lr.g(Ct),xi=Sn,Ai=0;Cr<Rt;)Cr=(Cr+Ai)*rt,xi*=rt,Ai=lr.g(1);for(;Cr>=Zt;)Cr/=2,xi/=2,Ai>>>=1;return(Cr+Ai)/xi};return jr.int32=function(){return 0|lr.g(4)},jr.quick=function(){return lr.g(4)/4294967296},jr.double=jr,Mt(hn(lr.S),Se),(He.pass||Bn||function(Cr,xi,Ai,ni){return ni&&(ni.S&&mt(ni,lr),Cr.state=function(){return mt(lr,{})}),Ai?(ve[tn]=Cr,xi):Cr})(jr,Zn,"global"in He?He.global:this==ve,He.state)}function mt(nn,He){return He.i=nn.i,He.j=nn.j,He.S=nn.S.slice(),He}function Mt(nn,He){for(var Bn,Xn=nn+"",Zn=0;Zn<Xn.length;)He[mn&Zn]=mn&(Bn^=19*He[mn&Zn])+Xn.charCodeAt(Zn++);return hn(He)}function hn(nn){return String.fromCharCode.apply(0,nn)}if(ve["seed"+tn]=fn,Mt(ve.random(),Se),Qt.exports){Qt.exports=fn;try{ke=r(387)}catch{}}})([],Math)});q.alea=W,q.xor128=j,q.xorwow=H,q.xorshift7=I,q.xor4096=Q,q.tychei=Y;var ae=q.alea;function oe(Qt,Se,ve,ke){if(ve===void 0&&(ve=new Map),ke===void 0&&(ke=new Set),Qt==null)return null;if(ke.has(Qt))throw new Error("Circular references are not supported.");if(ve.has(Qt))return ve.get(Qt);var Me=Se(Qt);if(Me.recurse&&Me.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(Me.recurse){if(me(Qt)){var rt=Array.isArray(Qt)?[]:{};for(var Ct in ke.add(Qt),Qt){var tn=oe(Qt[Ct],Se,ve,ke);rt[Ct]=tn}return ke.delete(Qt),rt}throw new Error("Can't recurse into non-iterable type: "+Qt)}return ve.set(Qt,Me.value),Me.value}function ye(Qt,Se){return Se===void 0&&(Se=_e),function ve(ke,Me,rt){rt===void 0&&(rt=new Set);var Ct=ke[0];if(rt.has(Ct))throw new Error("Circular references are not supported.");var tn=Me(ke);if(tn.recurse&&tn.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(tn.recurse){if(me(Ct)){var Sn=Array.isArray(Ct)?[]:{};rt.add(Ct);var Rt=function(mn){var fn=ve(ke.map(function(mt){return mt[mn]}),Me,rt);Sn[mn]=fn};for(var Zt in Ct)Rt(Zt);return rt.delete(Ct),Sn}throw new Error("Can't recurse into non-iterable type: "+Ct)}return tn.value}(Qt,Se)}function _e(Qt){return Qt===null?null:me(Qt[0])?{value:null,recurse:!0}:{value:Qt,recurse:!1}}function pe(Qt,Se){return B(this,void 0,void 0,function(){var ve,ke,Me,rt,Ct,tn;return D(this,function(Sn){switch(Sn.label){case 0:ve=new Map,oe(Qt,Se,ve),ke=0,Me=Array.from(ve.keys()),Sn.label=1;case 1:return ke<Me.length?(rt=Me[ke],(Ct=ve.get(rt))instanceof Promise?[4,Ct]:[3,3]):[3,4];case 2:tn=Sn.sent(),ve.set(rt,tn),Sn.label=3;case 3:return ke++,[3,1];case 4:return[2,oe(Qt,Se,ve)]}})})}function me(Qt){return Qt!=null&&!ArrayBuffer.isView(Qt)&&(Array.isArray(Qt)||typeof Qt=="object"&&!(Qt instanceof E.Tensor))}function Ge(Qt){return function(Se,ve){return oe(Se,ve)}(Qt,lt)}function lt(Qt){return Qt instanceof E.Tensor?{value:Qt.clone(),recurse:!1}:me(Qt)?{value:null,recurse:!0}:{value:Qt,recurse:!1}}var It=function(){function Qt(Se){if(this.capacity=Se,this.begin=0,this.end=0,Se==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(Se<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(Se),this.doubledCapacity=2*Se}return Qt.prototype.wrap=function(Se){for(;Se<0;)Se+=this.doubledCapacity;return Se%this.doubledCapacity},Qt.prototype.get=function(Se){if(Se<0)throw new RangeError("Can't get item at a negative index.");return this.data[Se%this.capacity]},Qt.prototype.set=function(Se,ve){if(Se<0)throw new RangeError("Can't set item at a negative index.");this.data[Se%this.capacity]=ve},Qt.prototype.length=function(){var Se=this.end-this.begin;return Se<0&&(Se=this.doubledCapacity+Se),Se},Qt.prototype.isFull=function(){return this.length()===this.capacity},Qt.prototype.isEmpty=function(){return this.length()===0},Qt.prototype.push=function(Se){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,Se),this.end=this.wrap(this.end+1)},Qt.prototype.pushAll=function(Se){for(var ve=0,ke=Se;ve<ke.length;ve++){var Me=ke[ve];this.push(Me)}},Qt.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var Se=this.get(this.end);return this.set(this.end,void 0),Se},Qt.prototype.unshift=function(Se){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,Se)},Qt.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var Se=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),Se},Qt.prototype.shuffleExcise=function(Se){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var ve=this.wrap(this.begin+Se),ke=this.get(ve);return this.set(ve,this.pop()),ke},Qt}(),wt=function(Qt){function Se(){return Qt.call(this,Se.INITIAL_CAPACITY)||this}return U(Se,Qt),Se.prototype.isFull=function(){return!1},Se.prototype.push=function(ve){Qt.prototype.isFull.call(this)&&this.expand(),Qt.prototype.push.call(this,ve)},Se.prototype.unshift=function(ve){Qt.prototype.isFull.call(this)&&this.expand(),Qt.prototype.unshift.call(this,ve)},Se.prototype.expand=function(){for(var ve=2*this.capacity,ke=new Array(ve),Me=this.length(),rt=0;rt<Me;rt++)ke[rt]=this.get(this.wrap(this.begin+rt));this.data=ke,this.capacity=ve,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=Me},Se.INITIAL_CAPACITY=32,Se}(It);function we(Qt){return new ze(Qt)}function yt(Qt){return new Ut(Qt)}var Bt,Ot=function(){function Qt(){}return Qt.prototype.toArray=function(){return B(this,void 0,void 0,function(){var Se,ve;return D(this,function(ke){switch(ke.label){case 0:return Se=[],[4,this.next()];case 1:ve=ke.sent(),ke.label=2;case 2:return ve.done?[3,4]:(Se.push(ve.value),[4,this.next()]);case 3:return ve=ke.sent(),[3,2];case 4:return[2,Se]}})})},Qt.prototype.toArrayForTest=function(){return B(this,void 0,void 0,function(){var Se,ve,ke;return D(this,function(Me){switch(Me.label){case 0:return Se=this.prefetch(100),ve=[],[4,Se.next()];case 1:ke=Me.sent(),Me.label=2;case 2:return ke.done?[3,4]:(ve.push(ke.value),[4,Se.next()]);case 3:return ke=Me.sent(),[3,2];case 4:return[2,ve]}})})},Qt.prototype.resolveFully=function(){return B(this,void 0,void 0,function(){var Se;return D(this,function(ve){switch(ve.label){case 0:return[4,this.next()];case 1:Se=ve.sent(),ve.label=2;case 2:return Se.done?[3,4]:[4,this.next()];case 3:return Se=ve.sent(),[3,2];case 4:return[2]}})})},Qt.prototype.resolveWhile=function(Se){return B(this,void 0,void 0,function(){var ve,ke;return D(this,function(Me){switch(Me.label){case 0:return[4,this.next()];case 1:ve=Me.sent(),ke=Se(ve.value),Me.label=2;case 2:return ve.done||!ke?[3,4]:[4,this.next()];case 3:return ve=Me.sent(),ke=Se(ve.value),[3,2];case 4:return[2]}})})},Qt.prototype.handleErrors=function(Se){return new Xt(this,Se)},Qt.prototype.filter=function(Se){return new xt(this,Se)},Qt.prototype.map=function(Se){return new _t(this,Se)},Qt.prototype.mapAsync=function(Se){return new sn(this,Se)},Qt.prototype.serialMapAsync=function(Se){return new sn(this,Se).serial()},Qt.prototype.flatmap=function(Se){return new an(this,Se)},Qt.prototype.forEachAsync=function(Se){return B(this,void 0,void 0,function(){return D(this,function(ve){return[2,this.map(Se).resolveFully()]})})},Qt.prototype.serialForEach=function(Se){return B(this,void 0,void 0,function(){return D(this,function(ve){return[2,this.serialMapAsync(Se).resolveWhile(function(ke){return ke===!0})]})})},Qt.prototype.rowMajorBatch=function(Se,ve){return ve===void 0&&(ve=!0),new rn(this,Se,ve)},Qt.prototype.columnMajorBatch=function(Se,ve,ke){return ve===void 0&&(ve=!0),ke===void 0&&(ke=_e),this.rowMajorBatch(Se,ve).map(function(Me){return ye(Me,ke)})},Qt.prototype.concatenate=function(Se,ve){return new Ve(we([this,Se]),ve)},Qt.prototype.take=function(Se){return Se<0||Se==null?this:new vt(this,Se)},Qt.prototype.skip=function(Se){return Se<0||Se==null?this:new pt(this,Se)},Qt.prototype.prefetch=function(Se){return new $e(this,Se)},Qt.prototype.shuffle=function(Se,ve){return new ft(this,Se,ve)},Qt.prototype.serial=function(){return new Ft(this)},Qt}(),ze=function(Qt){function Se(ve){var ke=Qt.call(this)||this;return ke.items=ve,ke.trav=0,ke}return U(Se,Qt),Se.prototype.summary=function(){return"Array of "+this.items.length+" items"},Se.prototype.next=function(){return B(this,void 0,void 0,function(){var ve;return D(this,function(ke){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(ve=this.items[this.trav],this.trav++,[2,{value:Ge(ve),done:!1}])})})},Se}(Ot),Ut=function(Qt){function Se(ve){var ke=Qt.call(this)||this;return ke.nextFn=ve,ke}return U(Se,Qt),Se.prototype.summary=function(){return"Function call"},Se.prototype.next=function(){return B(this,void 0,void 0,function(){return D(this,function(ve){try{return[2,this.nextFn()]}catch(ke){throw ke.message="Error thrown while iterating through a dataset: "+ke.message,ke}return[2]})})},Se}(Ot),Ft=function(Qt){function Se(ve){var ke=Qt.call(this)||this;return ke.upstream=ve,ke.lastRead=Promise.resolve({value:null,done:!1}),ke}return U(Se,Qt),Se.prototype.summary=function(){return this.upstream.summary()+" -> Serial"},Se.prototype.next=function(){return B(this,void 0,void 0,function(){var ve=this;return D(this,function(ke){return this.lastRead=this.lastRead.then(function(){return ve.serialNext()}),[2,this.lastRead]})})},Se.prototype.serialNext=function(){return B(this,void 0,void 0,function(){return D(this,function(ve){return[2,this.upstream.next()]})})},Se}(Ot),pt=function(Qt){function Se(ve,ke){var Me=Qt.call(this)||this;return Me.upstream=ve,Me.maxCount=ke,Me.count=0,Me.lastRead=Promise.resolve({value:null,done:!1}),Me}return U(Se,Qt),Se.prototype.summary=function(){return this.upstream.summary()+" -> Skip"},Se.prototype.next=function(){return B(this,void 0,void 0,function(){var ve=this;return D(this,function(ke){return this.lastRead=this.lastRead.then(function(){return ve.serialNext()}),[2,this.lastRead]})})},Se.prototype.serialNext=function(){return B(this,void 0,void 0,function(){var ve;return D(this,function(ke){switch(ke.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return(ve=ke.sent()).done?[2,ve]:(Object(E.dispose)(ve.value),[3,0]);case 2:return[2,this.upstream.next()]}})})},Se}(Ot),vt=function(Qt){function Se(ve,ke){var Me=Qt.call(this)||this;return Me.upstream=ve,Me.maxCount=ke,Me.count=0,Me}return U(Se,Qt),Se.prototype.summary=function(){return this.upstream.summary()+" -> Take"},Se.prototype.next=function(){return B(this,void 0,void 0,function(){return D(this,function(ve){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]})})},Se}(Ot),rn=function(Qt){function Se(ve,ke,Me){Me===void 0&&(Me=!0);var rt=Qt.call(this)||this;return rt.upstream=ve,rt.batchSize=ke,rt.enableSmallLastBatch=Me,rt.lastRead=Promise.resolve({value:null,done:!1}),rt}return U(Se,Qt),Se.prototype.summary=function(){return this.upstream.summary()+" -> RowMajorBatch"},Se.prototype.next=function(){return B(this,void 0,void 0,function(){var ve=this;return D(this,function(ke){return this.lastRead=this.lastRead.then(function(){return ve.serialNext()}),[2,this.lastRead]})})},Se.prototype.serialNext=function(){return B(this,void 0,void 0,function(){var ve,ke;return D(this,function(Me){switch(Me.label){case 0:ve=[],Me.label=1;case 1:return ve.length<this.batchSize?[4,this.upstream.next()]:[3,3];case 2:return(ke=Me.sent()).done?this.enableSmallLastBatch&&ve.length>0?[2,{value:ve,done:!1}]:[2,{value:null,done:!0}]:(ve.push(ke.value),[3,1]);case 3:return[2,{value:ve,done:!1}]}})})},Se}(Ot),xt=function(Qt){function Se(ve,ke){var Me=Qt.call(this)||this;return Me.upstream=ve,Me.predicate=ke,Me.lastRead=Promise.resolve({value:null,done:!1}),Me}return U(Se,Qt),Se.prototype.summary=function(){return this.upstream.summary()+" -> Filter"},Se.prototype.next=function(){return B(this,void 0,void 0,function(){var ve=this;return D(this,function(ke){return this.lastRead=this.lastRead.then(function(){return ve.serialNext()}),[2,this.lastRead]})})},Se.prototype.serialNext=function(){return B(this,void 0,void 0,function(){var ve;return D(this,function(ke){switch(ke.label){case 0:return[4,this.upstream.next()];case 1:return(ve=ke.sent()).done||this.predicate(ve.value)?[2,ve]:(Object(E.dispose)(ve.value),[3,0]);case 2:return[2]}})})},Se}(Ot),_t=function(Qt){function Se(ve,ke){var Me=Qt.call(this)||this;return Me.upstream=ve,Me.transform=ke,Me}return U(Se,Qt),Se.prototype.summary=function(){return this.upstream.summary()+" -> Map"},Se.prototype.next=function(){return B(this,void 0,void 0,function(){var ve,ke,Me,rt,Ct,tn,Sn;return D(this,function(Rt){switch(Rt.label){case 0:return[4,this.upstream.next()];case 1:if((ve=Rt.sent()).done)return[2,{value:null,done:!0}];for(ke=E.tensor_util.getTensorsInContainer(ve.value),Me=this.transform(ve.value),rt=E.tensor_util.getTensorsInContainer(Me),Ct=0,tn=ke;Ct<tn.length;Ct++)Sn=tn[Ct],E.tensor_util.isTensorInList(Sn,rt)||Sn.dispose();return[2,{value:Me,done:!1}]}})})},Se}(Ot),Xt=function(Qt){function Se(ve,ke){var Me=Qt.call(this)||this;return Me.upstream=ve,Me.handler=ke,Me.count=0,Me.lastRead=Promise.resolve({value:null,done:!1}),Me}return U(Se,Qt),Se.prototype.summary=function(){return this.upstream.summary()+" -> handleErrors"},Se.prototype.next=function(){return B(this,void 0,void 0,function(){var ve=this;return D(this,function(ke){return this.lastRead=this.lastRead.then(function(){return ve.serialNext()}),[2,this.lastRead]})})},Se.prototype.serialNext=function(){return B(this,void 0,void 0,function(){var ve;return D(this,function(ke){switch(ke.label){case 0:ke.label=1;case 1:return ke.trys.push([1,3,,4]),[4,this.upstream.next()];case 2:return[2,ke.sent()];case 3:return ve=ke.sent(),this.handler(ve)?[3,4]:[2,{value:null,done:!0}];case 4:return[3,0];case 5:return[2]}})})},Se}(Ot),sn=function(Qt){function Se(ve,ke){var Me=Qt.call(this)||this;return Me.upstream=ve,Me.transform=ke,Me}return U(Se,Qt),Se.prototype.summary=function(){return this.upstream.summary()+" -> AsyncMap"},Se.prototype.next=function(){return B(this,void 0,void 0,function(){var ve,ke,Me,rt,Ct,tn,Sn;return D(this,function(Rt){switch(Rt.label){case 0:return[4,this.upstream.next()];case 1:return(ve=Rt.sent()).done?[2,{value:null,done:!0}]:(ke=E.tensor_util.getTensorsInContainer(ve.value),[4,this.transform(ve.value)]);case 2:for(Me=Rt.sent(),rt=E.tensor_util.getTensorsInContainer(Me),Ct=0,tn=ke;Ct<tn.length;Ct++)Sn=tn[Ct],E.tensor_util.isTensorInList(Sn,rt)||Sn.dispose();return[2,{value:Me,done:!1}]}})})},Se}(Ot),kn=function(Qt){function Se(){var ve=Qt.call(this)||this;return ve.outputQueue=new wt,ve.lastRead=Promise.resolve({value:null,done:!1}),ve}return U(Se,Qt),Se.prototype.next=function(){return B(this,void 0,void 0,function(){var ve=this;return D(this,function(ke){return this.lastRead=this.lastRead.then(function(){return ve.serialNext()}),[2,this.lastRead]})})},Se.prototype.serialNext=function(){return B(this,void 0,void 0,function(){return D(this,function(ve){switch(ve.label){case 0:return this.outputQueue.length()!==0?[3,2]:[4,this.pump()];case 1:return ve.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}})})},Se}(Ot),an=function(Qt){function Se(ve,ke){var Me=Qt.call(this)||this;return Me.upstream=ve,Me.transform=ke,Me}return U(Se,Qt),Se.prototype.summary=function(){return this.upstream.summary()+" -> Flatmap"},Se.prototype.pump=function(){return B(this,void 0,void 0,function(){var ve,ke,Me,rt,Ct,tn,Sn;return D(this,function(Rt){switch(Rt.label){case 0:return[4,this.upstream.next()];case 1:if((ve=Rt.sent()).done)return[2,!1];for(ke=E.tensor_util.getTensorsInContainer(ve.value),Me=this.transform(ve.value),rt=E.tensor_util.getTensorsInContainer(Me),this.outputQueue.pushAll(Me),Ct=0,tn=ke;Ct<tn.length;Ct++)Sn=tn[Ct],E.tensor_util.isTensorInList(Sn,rt)||Sn.dispose();return[2,!0]}})})},Se}(kn),Ve=function(Qt){function Se(ve,ke){var Me=Qt.call(this)||this;return Me.baseErrorHandler=ke,Me.lastRead=null,Me.iterator=null,Me.moreIterators=ve,Me}return U(Se,Qt),Se.prototype.summary=function(){return"TODO: fill in upstream of chained summaries -> Chained"},Se.prototype.next=function(){return B(this,void 0,void 0,function(){return D(this,function(ve){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]})})},Se.prototype.readFromChain=function(ve){return B(this,void 0,void 0,function(){var ke,Me;return D(this,function(rt){switch(rt.label){case 0:return[4,ve];case 1:return rt.sent(),this.iterator!=null?[3,3]:[4,this.moreIterators.next()];case 2:if((ke=rt.sent()).done)return[2,{value:null,done:!0}];this.iterator=ke.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler)),rt.label=3;case 3:return[4,this.iterator.next()];case 4:return(Me=rt.sent()).done?(this.iterator=null,[2,this.readFromChain(ve)]):[2,Me]}})})},Se}(Ot);(function(Qt){Qt[Qt.FAIL=0]="FAIL",Qt[Qt.SHORTEST=1]="SHORTEST",Qt[Qt.LONGEST=2]="LONGEST"})(Bt||(Bt={}));var Ye=function(Qt){function Se(ve,ke){ke===void 0&&(ke=Bt.FAIL);var Me=Qt.call(this)||this;return Me.iterators=ve,Me.mismatchMode=ke,Me.count=0,Me.currentPromise=null,Me}return U(Se,Qt),Se.prototype.summary=function(){return"{TODO: fill in upstream of zip summaries} -> Zip"},Se.prototype.nextState=function(ve){return B(this,void 0,void 0,function(){function ke(tn){return tn instanceof Ot?{value:tn.next().then(function(Sn){return Me++,Sn.done&&rt++,Sn.value}),recurse:!1}:{value:null,recurse:!0}}var Me,rt,Ct;return D(this,function(tn){switch(tn.label){case 0:return[4,ve];case 1:return tn.sent(),Me=0,rt=0,[4,pe(this.iterators,ke)];case 2:if(Ct=tn.sent(),Me===rt)return[2,{value:null,done:!0}];if(rt>0)switch(this.mismatchMode){case Bt.FAIL:throw new Error("Zipped streams should have the same length. Mismatched at element "+this.count+".");case Bt.SHORTEST:return[2,{value:null,done:!0}];case Bt.LONGEST:}return this.count++,[2,{value:Ct,done:!1}]}})})},Se.prototype.next=function(){return B(this,void 0,void 0,function(){return D(this,function(ve){return this.currentPromise=this.nextState(this.currentPromise),[2,this.currentPromise]})})},Se}(Ot),$e=function(Qt){function Se(ve,ke){var Me=Qt.call(this)||this;return Me.upstream=ve,Me.bufferSize=ke,Me.buffer=new It(ke),Me}return U(Se,Qt),Se.prototype.summary=function(){return this.upstream.summary()+" -> Prefetch"},Se.prototype.refill=function(){for(;!this.buffer.isFull();){var ve=this.upstream.next();this.buffer.push(ve)}},Se.prototype.next=function(){return this.refill(),this.buffer.shift()},Se}(Ot),ft=function(Qt){function Se(ve,ke,Me){var rt=Qt.call(this,ve,ke)||this;return rt.upstream=ve,rt.windowSize=ke,rt.upstreamExhausted=!1,rt.random=ae(Me||E.util.now().toString()),rt.lastRead=Promise.resolve({value:null,done:!1}),rt}return U(Se,Qt),Se.prototype.next=function(){return B(this,void 0,void 0,function(){var ve=this;return D(this,function(ke){return this.lastRead=this.lastRead.then(function(){return ve.serialNext()}),[2,this.lastRead]})})},Se.prototype.randomInt=function(ve){return Math.floor(this.random()*ve)},Se.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},Se.prototype.serialNext=function(){return B(this,void 0,void 0,function(){var ve,ke;return D(this,function(Me){switch(Me.label){case 0:this.upstreamExhausted||this.refill(),Me.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(ve=this.chooseIndex(),[4,this.buffer.shuffleExcise(ve)]);case 2:return(ke=Me.sent()).done?(this.upstreamExhausted=!0,[3,1]):(this.refill(),[2,ke]);case 3:return[2,{value:null,done:!0}]}})})},Se}($e),$t=function(){function Qt(){this.size=null}return Qt.prototype.batch=function(Se,ve){var ke=this;ve===void 0&&(ve=!0);var Me=this;return E.util.assert(Se>0,function(){return`batchSize needs to be positive, but it is
      `+Se}),Jt(function(){return B(ke,void 0,void 0,function(){return D(this,function(rt){switch(rt.label){case 0:return[4,Me.iterator()];case 1:return[2,rt.sent().columnMajorBatch(Se,ve,Qn)]}})})},this.size===1/0||this.size==null?this.size:ve?Math.ceil(this.size/Se):Math.floor(this.size/Se))},Qt.prototype.concatenate=function(Se){var ve=this,ke=this;return Jt(function(){return B(ve,void 0,void 0,function(){var Me,rt;return D(this,function(Ct){switch(Ct.label){case 0:return[4,ke.iterator()];case 1:return rt=(Me=Ct.sent()).concatenate,[4,Se.iterator()];case 2:return[2,rt.apply(Me,[Ct.sent()])]}})})},this.size===1/0||Se.size===1/0?1/0:this.size!=null&&Se.size!=null?this.size+Se.size:null)},Qt.prototype.filter=function(Se){var ve=this,ke=this;return Jt(function(){return B(ve,void 0,void 0,function(){return D(this,function(Me){switch(Me.label){case 0:return[4,ke.iterator()];case 1:return[2,Me.sent().filter(function(rt){return Object(E.tidy)(function(){return Se(rt)})})]}})})},this.size===1/0?1/0:null)},Qt.prototype.forEachAsync=function(Se){return B(this,void 0,void 0,function(){return D(this,function(ve){switch(ve.label){case 0:return[4,this.iterator()];case 1:return[2,ve.sent().forEachAsync(Se)]}})})},Qt.prototype.forEach=function(Se){return B(this,void 0,void 0,function(){return D(this,function(ve){return Object(E.deprecationWarn)("dataset.forEach() is deprecated and will be removed. Please use dataset.forEachAsync() instead"),[2,this.forEachAsync(Se)]})})},Qt.prototype.map=function(Se){var ve=this,ke=this;return Jt(function(){return B(ve,void 0,void 0,function(){return D(this,function(Me){switch(Me.label){case 0:return[4,ke.iterator()];case 1:return[2,Me.sent().map(function(rt){return Object(E.tidy)(function(){return Se(rt)})})]}})})},this.size)},Qt.prototype.mapAsync=function(Se){var ve=this,ke=this;return Jt(function(){return B(ve,void 0,void 0,function(){return D(this,function(Me){switch(Me.label){case 0:return[4,ke.iterator()];case 1:return[2,Me.sent().mapAsync(Se)]}})})},this.size)},Qt.prototype.prefetch=function(Se){var ve=this;if(Se==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var ke=this;return Jt(function(){return B(ve,void 0,void 0,function(){return D(this,function(Me){switch(Me.label){case 0:return[4,ke.iterator()];case 1:return[2,Me.sent().prefetch(Se)]}})})},this.size)},Qt.prototype.repeat=function(Se){var ve=this,ke=this;return Jt(function(){return B(ve,void 0,void 0,function(){var Me=this;return D(this,function(rt){return[2,function(Ct,tn){return new Ve(Ct,tn)}(yt(function(){return B(Me,void 0,void 0,function(){var Ct;return D(this,function(tn){switch(tn.label){case 0:return Ct={},[4,ke.iterator()];case 1:return[2,(Ct.value=tn.sent(),Ct.done=!1,Ct)]}})})}).take(Se))]})})},this.size!=null&&Se>0?this.size*Se:Se===0?0:this.size!=null&&(Se===void 0||Se<0)?1/0:null)},Qt.prototype.skip=function(Se){var ve=this,ke=this;return Jt(function(){return B(ve,void 0,void 0,function(){return D(this,function(Me){switch(Me.label){case 0:return[4,ke.iterator()];case 1:return[2,Me.sent().skip(Se)]}})})},this.size!=null&&Se>=0&&this.size>=Se?this.size-Se:this.size!=null&&(this.size<Se||Se===void 0||Se<0)?0:null)},Qt.prototype.shuffle=function(Se,ve,ke){var Me=this;if(ke===void 0&&(ke=!0),Se==null||Se<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting bufferSize to the dataset size ("+this.size+" elements)");var rt=this,Ct=ae(ve||E.util.now().toString());return Jt(function(){return B(Me,void 0,void 0,function(){var tn;return D(this,function(Sn){switch(Sn.label){case 0:return tn=Ct.int32(),ke&&(tn+=Ct.int32()),[4,rt.iterator()];case 1:return[2,Sn.sent().shuffle(Se,tn.toString())]}})})},this.size)},Qt.prototype.take=function(Se){var ve=this,ke=this;return Jt(function(){return B(ve,void 0,void 0,function(){return D(this,function(Me){switch(Me.label){case 0:return[4,ke.iterator()];case 1:return[2,Me.sent().take(Se)]}})})},this.size!=null&&this.size>Se?Se:this.size!=null&&this.size<=Se?this.size:null)},Qt.prototype.toArray=function(){return B(this,void 0,void 0,function(){return D(this,function(Se){switch(Se.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,Se.sent().toArray()]}})})},Qt.prototype.toArrayForTest=function(){return B(this,void 0,void 0,function(){return D(this,function(Se){switch(Se.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,Se.sent().toArrayForTest()]}})})},Qt.MAX_BUFFER_SIZE=1e4,Qt}();function Jt(Qt,Se){return Se===void 0&&(Se=null),new(function(ve){function ke(){var Me=ve!==null&&ve.apply(this,arguments)||this;return Me.size=Se,Me}return U(ke,ve),ke.prototype.iterator=function(){return B(this,void 0,void 0,function(){return D(this,function(Me){return[2,Qt()]})})},ke}($t))}function Pn(Qt){var Se=this;return Jt(function(){return B(Se,void 0,void 0,function(){return D(this,function(ve){return[2,we(Qt)]})})},Qt.length)}function An(Qt){var Se,ve=this;if(!me(Qt))throw new Error("The argument to zip() must be an object or array.");if(Array.isArray(Qt))for(var ke=0;ke<Qt.length;ke++)Se=Se==null?Qt[ke].size:Math.min(Se,Qt[ke].size);else if(Qt instanceof Object)for(var Me in Qt)Se=Se==null?Qt[Me].size:Math.min(Se,Qt[Me].size);return Jt(function(){return B(ve,void 0,void 0,function(){return D(this,function(rt){switch(rt.label){case 0:return[4,pe(Qt,function(Ct){if(Ct instanceof $t)return{value:Ct.iterator(),recurse:!1};if(me(Ct))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")})];case 1:return[2,function(Ct,tn){return tn===void 0&&(tn=Bt.FAIL),new Ye(Ct,tn)}(rt.sent(),Bt.SHORTEST)]}})})},Se)}function Qn(Qt){return Qt===null?null:function(Se){return Se==null||function(ve){return ve===null||typeof ve!="object"&&typeof ve!="function"}(Se)||Array.isArray(Se)||typeof Se=="object"&&Se instanceof E.Tensor||E.util.isTypedArray(Se)}(Qt[0])?{value:function(Se){if(Se.length===0)throw new Error("Can't make a batch of zero elements.");return Se[0]instanceof E.Tensor?Object(E.stack)(Se):Object(E.tensor)(Se)}(Qt),recurse:!1}:{value:null,recurse:!0}}var Ce=function(Qt){function Se(ve){var ke=Qt.call(this)||this;return ke.input=ve,ke}return U(Se,Qt),Se.prototype.iterator=function(){return B(this,void 0,void 0,function(){var ve;return D(this,function(ke){switch(ke.label){case 0:return[4,this.input.iterator()];case 1:return ve=ke.sent(),[2,ve.decodeUTF8().split(`
`).map(function(Me){return Me.endsWith("\r")&&(Me=Me.slice(0,-1)),Me})]}})})},Se}($t),sr=Symbol("out"),Mr=Symbol("field"),on=Symbol("quote"),Gt=Symbol("quoteafterquote"),Hn=Symbol("quoteinquote"),Kt=function(Qt){function Se(ve,ke){var Me=Qt.call(this)||this;return Me.input=ve,Me.hasHeader=!0,Me.fullColumnNames=null,Me.columnNamesValidated=!1,Me.columnConfigs=null,Me.configuredColumnsOnly=!1,Me.delimiter=",",Me.delimWhitespace=!1,Me.base=new Ce(ve),ke||(ke={}),Me.hasHeader=ke.hasHeader!==!1,Me.fullColumnNames=ke.columnNames,Me.columnConfigs=ke.columnConfigs,Me.configuredColumnsOnly=ke.configuredColumnsOnly,ke.delimWhitespace?(E.util.assert(ke.delimiter==null,function(){return"Delimiter should not be provided when delimWhitespace is true."}),Me.delimWhitespace=!0,Me.delimiter=" "):Me.delimiter=ke.delimiter?ke.delimiter:",",Me}return U(Se,Qt),Se.prototype.columnNames=function(){return B(this,void 0,void 0,function(){return D(this,function(ve){switch(ve.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:ve.sent(),ve.label=2;case 2:return[2,this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames]}})})},Se.prototype.setColumnNames=function(){return B(this,void 0,void 0,function(){var ve,ke,Me,rt,Ct,tn,Sn=this;return D(this,function(Rt){switch(Rt.label){case 0:return[4,this.maybeReadHeaderLine()];case 1:if(ve=Rt.sent(),!this.fullColumnNames&&!ve)throw new Error("Column names must be provided if there is no header line.");if(this.fullColumnNames&&ve&&E.util.assert(ve.length===this.fullColumnNames.length,function(){return"The length of provided columnNames ("+Sn.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+ve.length.toString()+")."}),this.fullColumnNames||(this.fullColumnNames=ve),ke=this.fullColumnNames.reduce(function(Zt,mn){return Zt[mn]=Zt[mn]+1||1,Zt},{}),Me=Object.keys(ke).filter(function(Zt){return ke[Zt]>1}),E.util.assert(Me.length===0,function(){return"Duplicate column names found: "+Me.toString()}),this.columnConfigs){for(rt=0,Ct=Object.keys(this.columnConfigs);rt<Ct.length;rt++)if(tn=Ct[rt],this.fullColumnNames.indexOf(tn)===-1)throw new Error('The key "'+tn+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}return this.columnNamesValidated=!0,[2]}})})},Se.prototype.maybeReadHeaderLine=function(){return B(this,void 0,void 0,function(){var ve,ke;return D(this,function(Me){switch(Me.label){case 0:return this.hasHeader?[4,this.base.iterator()]:[3,3];case 1:return[4,Me.sent().next()];case 2:if((ve=Me.sent()).done)throw new Error("No data was found for CSV parsing.");return ke=ve.value,[2,this.parseRow(ke,!1)];case 3:return[2,null]}})})},Se.prototype.iterator=function(){return B(this,void 0,void 0,function(){var ve,ke=this;return D(this,function(Me){switch(Me.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:Me.sent(),Me.label=2;case 2:return[4,this.base.iterator()];case 3:return ve=Me.sent(),this.hasHeader&&(ve=ve.skip(1)),[2,ve.map(function(rt){return ke.makeDataElement(rt)})]}})})},Se.prototype.makeDataElement=function(ve){for(var ke=this.parseRow(ve),Me={},rt={},Ct=0;Ct<this.fullColumnNames.length;Ct++){var tn=this.fullColumnNames[Ct],Sn=this.columnConfigs?this.columnConfigs[tn]:null;if(!this.configuredColumnsOnly||Sn){var Rt=ke[Ct],Zt=null;if(Rt==="")if(Sn&&Sn.default!==void 0)Zt=Sn.default;else{if(Sn&&(Sn.required||Sn.isLabel))throw new Error("Required column "+tn+" is empty in this line: "+ve);Zt=void 0}else{var mn=Number(Rt);if(isNaN(mn))Zt=Sn&&Sn.dtype==="bool"?this.getBoolean(Rt):Rt;else if(Sn&&Sn.dtype)switch(Sn.dtype){case"float32":Zt=mn;break;case"int32":Zt=Math.floor(mn);break;case"bool":Zt=this.getBoolean(Rt);break;default:Zt=mn}else Zt=mn}Sn&&Sn.isLabel?rt[tn]=Zt:Me[tn]=Zt}}return Object.keys(rt).length===0?Me:{xs:Me,ys:rt}},Se.prototype.getBoolean=function(ve){return ve==="1"||ve.toLowerCase()==="true"?1:0},Se.prototype.parseRow=function(ve,ke){ke===void 0&&(ke=!0);for(var Me=[],rt=0,Ct=ve.length,tn=sr,Sn=0;Sn<Ct;Sn++)switch(tn){case sr:switch(ve.charAt(Sn)){case'"':rt=Sn+1,tn=on;break;case this.delimiter:if(rt=Sn+1,this.delimiter===" "&&this.delimWhitespace)break;Me.push(""),tn=sr;break;default:tn=Mr,rt=Sn}break;case Mr:switch(ve.charAt(Sn)){case this.delimiter:Me.push(ve.substring(rt,Sn)),tn=sr,rt=Sn+1}break;case on:switch(ve.charAt(Sn)){case'"':tn=Gt}break;case Gt:switch(ve.charAt(Sn)){case this.delimiter:Me.push(ve.substring(rt,Sn-1)),tn=sr,rt=Sn+1;break;case'"':tn=on;break;default:tn=Hn}break;case Hn:switch(ve.charAt(Sn)){case'"':tn=on}}if(tn===Gt?Me.push(ve.substring(rt,Ct-1)):Me.push(ve.substring(rt)),ke&&Me.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have "+this.fullColumnNames.length+" elements in a row, but got "+Me);return Me},Se}($t),Vt=function(Qt){function Se(ve){var ke=Qt.call(this)||this;ke.microphoneConfig=ve,ke.isClosed=!1,ke.fftSize=ve.fftSize||1024;var Me=Math.log2(ke.fftSize);if(ke.fftSize<0||Me<4||Me>14||!Number.isInteger(Me))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got "+ke.fftSize);if(ke.numFrames=ve.numFramesPerSpectrogram||43,ke.sampleRateHz=ve.sampleRateHz,ke.columnTruncateLength=ve.columnTruncateLength||ke.fftSize,ke.audioTrackConstraints=ve.audioTrackConstraints,ke.smoothingTimeConstant=ve.smoothingTimeConstant||0,ke.includeSpectrogram=ve.includeSpectrogram!==!1,ke.includeWaveform=ve.includeWaveform===!0,!ke.includeSpectrogram&&!ke.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return ke}return U(Se,Qt),Se.prototype.summary=function(){return"microphone"},Se.create=function(ve){return ve===void 0&&(ve={}),B(this,void 0,void 0,function(){var ke;return D(this,function(Me){switch(Me.label){case 0:if(Object(E.env)().get("IS_NODE"))throw new Error("microphone API is only supported in browser environment.");return[4,(ke=new Se(ve)).start()];case 1:return Me.sent(),[2,ke]}})})},Se.prototype.start=function(){return B(this,void 0,void 0,function(){var ve,ke,Me,rt;return D(this,function(Ct){switch(Ct.label){case 0:return Ct.trys.push([0,2,,3]),ve=this,[4,navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null||this.audioTrackConstraints,video:!1})];case 1:return ve.stream=Ct.sent(),[3,3];case 2:throw ke=Ct.sent(),new Error("Error thrown while initializing video stream: "+ke.message);case 3:if(!this.stream)throw new Error("Could not obtain audio from microphone.");if(Me=window.AudioContext||window.webkitAudioContext,this.audioContext=new Me,this.sampleRateHz){if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error("Mismatch in sampling rate: Expected: "+this.sampleRateHz+"; Actual: "+this.audioContext.sampleRate)}else this.sampleRateHz=this.audioContext.sampleRate;return rt=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,rt.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),[2]}})})},Se.prototype.next=function(){return B(this,void 0,void 0,function(){var ve,ke,Me,rt,Ct;return D(this,function(tn){switch(tn.label){case 0:return this.isClosed?[2,{value:null,done:!0}]:[4,this.getAudioData()];case 1:return Me=tn.sent(),this.includeSpectrogram&&(rt=this.flattenQueue(Me.freqDataQueue),ve=this.getTensorFromAudioDataArray(rt,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(Ct=this.flattenQueue(Me.timeDataQueue),ke=this.getTensorFromAudioDataArray(Ct,[this.numFrames*this.fftSize,1])),[2,{value:{spectrogram:ve,waveform:ke},done:!1}]}})})},Se.prototype.capture=function(){return B(this,void 0,void 0,function(){return D(this,function(ve){switch(ve.label){case 0:return[4,this.next()];case 1:return[2,ve.sent().value]}})})},Se.prototype.getAudioData=function(){return B(this,void 0,void 0,function(){var ve,ke,Me,rt=this;return D(this,function(Ct){return ve=[],ke=[],Me=0,[2,new Promise(function(tn){var Sn=setInterval(function(){rt.includeSpectrogram&&(rt.analyser.getFloatFrequencyData(rt.freqData),rt.freqData[0]===-1/0&&tn({freqDataQueue:ve,timeDataQueue:ke}),ve.push(rt.freqData.slice(0,rt.columnTruncateLength))),rt.includeWaveform&&(rt.analyser.getFloatTimeDomainData(rt.timeData),ke.push(rt.timeData.slice())),++Me===rt.numFrames&&(clearInterval(Sn),tn({freqDataQueue:ve,timeDataQueue:ke}))},rt.fftSize/rt.sampleRateHz*1e3)})]})})},Se.prototype.stop=function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())},Se.prototype.toArray=function(){throw new Error("Can not convert infinite audio stream to array.")},Se.prototype.getSampleRate=function(){return this.sampleRateHz},Se.prototype.flattenQueue=function(ve){var ke=ve[0].length,Me=new Float32Array(ve.length*ke);return ve.forEach(function(rt,Ct){return Me.set(rt,Ct*ke)}),Me},Se.prototype.getTensorFromAudioDataArray=function(ve,ke){var Me=new Float32Array(E.util.sizeFromShape(ke));return Me.set(ve,Me.length-ve.length),Object(E.tensor)(Me,ke)},Se}(Ot),en=function(Qt){function Se(ve,ke){var Me=Qt.call(this)||this;if(Me.webcamVideoElement=ve,Me.webcamConfig=ke,Me.isClosed=!0,Me.resize=!1,Me.needToResize())if(Me.resize=!0,Me.cropSize=[Me.webcamConfig.resizeHeight,Me.webcamConfig.resizeWidth],Me.cropBoxInd=Object(E.tensor1d)([0],"int32"),Me.webcamConfig.centerCrop){var rt=1*Me.webcamConfig.resizeWidth/Me.webcamVideoElement.width,Ct=1*Me.webcamConfig.resizeHeight/Me.webcamVideoElement.height,tn=(1-rt)/2,Sn=(1-Ct)/2,Rt=tn+rt,Zt=Ct+Sn;Me.cropBox=Object(E.tensor2d)([Sn,tn,Zt,Rt],[1,4])}else Me.cropBox=Object(E.tensor2d)([0,0,1,1],[1,4]);return Me}return U(Se,Qt),Se.prototype.summary=function(){return"webcam"},Se.create=function(ve,ke){return ke===void 0&&(ke={}),B(this,void 0,void 0,function(){var Me;return D(this,function(rt){switch(rt.label){case 0:if(Object(E.env)().get("IS_NODE"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!ve){if(ve=document.createElement("video"),!ke.resizeWidth||!ke.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");ve.width=ke.resizeWidth,ve.height=ke.resizeHeight}return[4,(Me=new Se(ve,ke)).start()];case 1:return rt.sent(),[2,Me]}})})},Se.prototype.start=function(){return B(this,void 0,void 0,function(){var ve,ke,Me=this;return D(this,function(rt){switch(rt.label){case 0:this.webcamConfig.facingMode&&E.util.assert(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",function(){return"Invalid webcam facing mode: "+Me.webcamConfig.facingMode+". Please provide 'user' or 'environment'"}),rt.label=1;case 1:return rt.trys.push([1,3,,4]),ve=this,[4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})];case 2:return ve.stream=rt.sent(),[3,4];case 3:throw(ke=rt.sent()).message="Error thrown while initializing video stream: "+ke.message,ke;case 4:if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(Ct){console.log(Ct),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,[2,new Promise(function(Ct){Me.webcamVideoElement.onloadedmetadata=function(){Ct()}})]}})})},Se.prototype.next=function(){return B(this,void 0,void 0,function(){var ve;return D(this,function(ke){if(this.isClosed)return[2,{value:null,done:!0}];try{ve=E.browser.fromPixels(this.webcamVideoElement)}catch(Me){throw new Error("Error thrown converting video to pixels: "+JSON.stringify(Me))}if(!this.resize)return[2,{value:ve,done:!1}];try{return[2,{value:this.cropAndResizeFrame(ve),done:!1}]}catch(Me){throw new Error("Error thrown cropping the video: "+Me.message)}finally{ve.dispose()}return[2]})})},Se.prototype.needToResize=function(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)},Se.prototype.cropAndResizeFrame=function(ve){var ke=this;return Object(E.tidy)(function(){var Me,rt=ve.toFloat().expandDims(0),Ct=(Me=E.image.cropAndResize(rt,ke.cropBox,ke.cropBoxInd,ke.cropSize,"bilinear")).shape;return Me.reshape(Ct.slice(1))})},Se.prototype.capture=function(){return B(this,void 0,void 0,function(){return D(this,function(ve){switch(ve.label){case 0:return[4,this.next()];case 1:return[2,ve.sent().value]}})})},Se.prototype.stop=function(){this.stream.getTracks().forEach(function(ve){return ve.stop()});try{this.webcamVideoElement.srcObject=null}catch(ve){console.log(ve),this.webcamVideoElement.src=null}this.isClosed=!0},Se.prototype.toArray=function(){throw new Error("Can not convert infinite video stream to array.")},Se}(Ot),Vn=function(){},Dt=function(Qt){function Se(){return Qt!==null&&Qt.apply(this,arguments)||this}return U(Se,Qt),Se.prototype.split=function(ve){return new On(this,ve)},Se}(Ot),On=function(Qt){function Se(ve,ke){var Me=Qt.call(this)||this;return Me.upstream=ve,Me.impl=new or(ve,ke),Me}return U(Se,Qt),Se.prototype.summary=function(){return this.impl.summary()},Se.prototype.next=function(){return B(this,void 0,void 0,function(){return D(this,function(ve){return[2,this.impl.next()]})})},Se}(Dt),or=function(Qt){function Se(ve,ke){var Me=Qt.call(this)||this;return Me.upstream=ve,Me.separator=ke,Me.carryover="",Me}return U(Se,Qt),Se.prototype.summary=function(){return this.upstream.summary()+" -> Split('"+this.separator+"')"},Se.prototype.pump=function(){return B(this,void 0,void 0,function(){var ve,ke,Me,rt,Ct;return D(this,function(tn){switch(tn.label){case 0:return[4,this.upstream.next()];case 1:if((ve=tn.sent()).done)return this.carryover===""?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);for((ke=ve.value.split(this.separator))[0]=this.carryover+ke[0],Me=0,rt=ke.slice(0,-1);Me<rt.length;Me++)Ct=rt[Me],this.outputQueue.push(Ct);return this.carryover=ke[ke.length-1],[2,!0]}})})},Se}(kn),ar=function(Qt){function Se(){return Qt!==null&&Qt.apply(this,arguments)||this}return U(Se,Qt),Se.prototype.decodeUTF8=function(){return new yr(this)},Se}(Ot),yr=function(Qt){function Se(ve){var ke=Qt.call(this)||this;return ke.upstream=ve,ke.impl=new kr(ve),ke}return U(Se,Qt),Se.prototype.summary=function(){return this.impl.summary()},Se.prototype.next=function(){return B(this,void 0,void 0,function(){return D(this,function(ve){return[2,this.impl.next()]})})},Se}(Dt),kr=function(Qt){function Se(ve){var ke=Qt.call(this)||this;if(ke.upstream=ve,Object(E.env)().get("IS_BROWSER"))ke.decoder=new TextDecoder("utf-8");else{var Me=r(386).StringDecoder;ke.decoder=new Me("utf8")}return ke}return U(Se,Qt),Se.prototype.summary=function(){return this.upstream.summary()+" -> Utf8"},Se.prototype.pump=function(){return B(this,void 0,void 0,function(){var ve,ke,Me;return D(this,function(rt){switch(rt.label){case 0:return[4,this.upstream.next()];case 1:return(ve=rt.sent()).done?[2,!1]:(ke=ve.value,Me=Object(E.env)().get("IS_BROWSER")?this.decoder.decode(ke,{stream:!0}):this.decoder.write(S.from(ke.buffer)),this.outputQueue.push(Me),[2,!0])}})})},Se}(kn),dr=function(Qt){function Se(ve,ke){ke===void 0&&(ke={});var Me=Qt.call(this)||this;return Me.file=ve,Me.options=ke,E.util.assert(ve instanceof Uint8Array||!!Object(E.env)().get("IS_BROWSER")&&(ve instanceof File||ve instanceof Blob),function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."}),Me.offset=ke.offset||0,Me.chunkSize=ke.chunkSize||1048576,Me}return U(Se,Qt),Se.prototype.summary=function(){return"FileChunks "+this.file},Se.prototype.next=function(){return B(this,void 0,void 0,function(){var ve,ke,Me=this;return D(this,function(rt){switch(rt.label){case 0:return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?[2,{value:null,done:!0}]:(ve=new Promise(function(Ct,tn){var Sn=Me.offset+Me.chunkSize;if(Me.file instanceof Uint8Array)Ct(new Uint8Array(Me.file.slice(Me.offset,Sn)));else{var Rt=new FileReader;Rt.onload=function(mn){var fn=Rt.result;if(fn instanceof ArrayBuffer&&(fn=new Uint8Array(fn)),!(fn instanceof Uint8Array))return tn(new TypeError("FileReader returned unknown type."));Ct(fn)},Rt.onabort=function(mn){return tn(new Error("Aborted"))},Rt.onerror=function(mn){return tn(new Error(mn.type))};var Zt=Me.file.slice(Me.offset,Sn);Rt.readAsArrayBuffer(Zt)}Me.offset=Sn}),ke={},[4,ve]);case 1:return[2,(ke.value=rt.sent(),ke.done=!1,ke)]}})})},Se}(ar),oi=function(Qt){return{method:Qt.method,headers:Qt.headers,body:Qt.body,mode:Qt.mode,credentials:Qt.credentials,cache:Qt.cache,redirect:Qt.redirect,referrer:Qt.referrer,integrity:Qt.integrity}};function Ur(Qt){return typeof Qt=="string"&&Qt.substr(0,7)==="file://"}var Xr=function(Qt){function Se(ve,ke){ke===void 0&&(ke={});var Me=Qt.call(this)||this;return Me.input=ve,Me.options=ke,Me}return U(Se,Qt),Se.prototype.iterator=function(){return B(this,void 0,void 0,function(){var ve;return D(this,function(ke){return Ur(this.input)&&Object(E.env)().get("IS_NODE")&&(ve=r(385),this.input=ve.readFileSync(this.input.substr(7))),[2,new dr(this.input,this.options)]})})},Se}(Vn),zn=function(Qt){function Se(ve,ke){ke===void 0&&(ke={});var Me=Qt.call(this)||this;return Me.url=ve,Me.fileOptions=ke,Me}return U(Se,Qt),Se.prototype.iterator=function(){return B(this,void 0,void 0,function(){return D(this,function(ve){return Ur(this.url)?[2,new Xr(this.url,this.fileOptions).iterator()]:[2,function(ke,Me){return Me===void 0&&(Me={}),B(this,void 0,void 0,function(){var rt,Ct,tn,Sn,Rt;return D(this,function(Zt){switch(Zt.label){case 0:return typeof ke=="string"?rt=ke:(rt=ke.url,Ct=oi(ke)),[4,E.util.fetch(rt,Ct)];case 1:return(tn=Zt.sent()).ok?(Rt=Uint8Array.bind,[4,tn.arrayBuffer()]):[3,3];case 2:return Sn=new(Rt.apply(Uint8Array,[void 0,Zt.sent()])),[2,new dr(Sn,Me)];case 3:throw new Error(tn.statusText)}})})}(this.url,this.fileOptions)]})})},Se}(Vn);function ir(Qt,Se){return Se===void 0&&(Se={}),new Kt(new zn(Qt),Se)}function Or(Qt){var Se=this,ve=yt(Qt);return Jt(function(){return B(Se,void 0,void 0,function(){return D(this,function(ke){return[2,ve]})})})}function qr(Qt){var Se=this;return Jt(function(){return B(Se,void 0,void 0,function(){var ve;return D(this,function(ke){switch(ke.label){case 0:return[4,Qt()];case 1:return ve=ke.sent(),[2,yt(function(){return ve.next()})]}})})})}function Kr(Qt,Se){return B(this,void 0,void 0,function(){return D(this,function(ve){return[2,en.create(Qt,Se)]})})}function Tt(Qt){return B(this,void 0,void 0,function(){return D(this,function(Se){return[2,Vt.create(Qt)]})})}var Rr="1.7.4"}.call(this,r(59),r(92).Buffer)},function(s,a,r){function c(S){var E="";if(!S)try{S=r(185)}catch(A){E=A.toString()}return{readFile:S?function(A){return new Promise(function(U,B){S.readFile(A,function(D,R){return D?B(D):U(R)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+E)}}}r.d(a,"a",function(){return c})},function(s){s.exports={a:"0.12.2"}},function(s,a,r){var c=/("(?:[^\\"]|\\.)*")|[:,]/g;s.exports=function(S,E){var A,U,B;return E=E||{},A=JSON.stringify([1],void 0,E.indent===void 0?2:E.indent).slice(2,-3),U=A===""?1/0:E.maxLength===void 0?80:E.maxLength,B=E.replacer,function D(R,W,j){var H,I,Q,Y,q,ae,oe,ye,_e,pe,me,Ge;if(R&&typeof R.toJSON=="function"&&(R=R.toJSON()),(me=JSON.stringify(R,B))===void 0)return me;if(oe=U-W.length-j,me.length<=oe&&(_e=me.replace(c,function(lt,It){return It||lt+" "})).length<=oe)return _e;if(B!=null&&(R=JSON.parse(me),B=void 0),typeof R=="object"&&R!==null){if(ye=W+A,Q=[],I=0,Array.isArray(R))for(pe="[",H="]",oe=R.length;I<oe;I++)Q.push(D(R[I],ye,I===oe-1?0:1)||"null");else for(pe="{",H="}",oe=(ae=Object.keys(R)).length;I<oe;I++)Y=ae[I],q=JSON.stringify(Y)+": ",(Ge=D(R[Y],ye,q.length+(I===oe-1?0:1)))!==void 0&&Q.push(q+Ge);if(Q.length>0)return[pe,A+Q.join(`,
`+ye),H].join(`
`+W)}return me}(S,"",0)}},function(s,a,r){var c=r(31),S=Object(c.a)(function(E){E.setUTCDate(1),E.setUTCHours(0,0,0,0)},function(E,A){E.setUTCMonth(E.getUTCMonth()+A)},function(E,A){return A.getUTCMonth()-E.getUTCMonth()+12*(A.getUTCFullYear()-E.getUTCFullYear())},function(E){return E.getUTCMonth()});a.a=S,S.range},function(s,a,r){var c=r(31),S=Object(c.a)(function(E){E.setDate(1),E.setHours(0,0,0,0)},function(E,A){E.setMonth(E.getMonth()+A)},function(E,A){return A.getMonth()-E.getMonth()+12*(A.getFullYear()-E.getFullYear())},function(E){return E.getMonth()});a.a=S,S.range},function(s,a,r){(function(c){var S=r(36),E=r(275),A=r(193),U={"Content-Type":"application/x-www-form-urlencoded"};function B(R,W){!S.isUndefined(R)&&S.isUndefined(R["Content-Type"])&&(R["Content-Type"]=W)}var D={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:function(){var R;return(typeof XMLHttpRequest<"u"||c!==void 0&&Object.prototype.toString.call(c)==="[object process]")&&(R=r(192)),R}(),transformRequest:[function(R,W){return E(W,"Accept"),E(W,"Content-Type"),S.isFormData(R)||S.isArrayBuffer(R)||S.isBuffer(R)||S.isStream(R)||S.isFile(R)||S.isBlob(R)?R:S.isArrayBufferView(R)?R.buffer:S.isURLSearchParams(R)?(B(W,"application/x-www-form-urlencoded;charset=utf-8"),R.toString()):S.isObject(R)||W&&W["Content-Type"]==="application/json"?(B(W,"application/json"),function(j,H,I){if(S.isString(j))try{return(H||JSON.parse)(j),S.trim(j)}catch(Q){if(Q.name!=="SyntaxError")throw Q}return(I||JSON.stringify)(j)}(R)):R}],transformResponse:[function(R){var W=this.transitional,j=W&&W.silentJSONParsing,H=W&&W.forcedJSONParsing,I=!j&&this.responseType==="json";if(I||H&&S.isString(R)&&R.length)try{return JSON.parse(R)}catch(Q){if(I)throw Q.name==="SyntaxError"?A(Q,this,"E_JSON_PARSE"):Q}return R}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(R){return R>=200&&R<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};S.forEach(["delete","get","head"],function(R){D.headers[R]={}}),S.forEach(["post","put","patch"],function(R){D.headers[R]=S.merge(U)}),s.exports=D}).call(this,r(75))},function(s,a,r){var c=this&&this.__awaiter||function(W,j,H,I){return new(H||(H=Promise))(function(Q,Y){function q(ye){try{oe(I.next(ye))}catch(_e){Y(_e)}}function ae(ye){try{oe(I.throw(ye))}catch(_e){Y(_e)}}function oe(ye){ye.done?Q(ye.value):new H(function(_e){_e(ye.value)}).then(q,ae)}oe((I=I.apply(W,j||[])).next())})},S=this&&this.__importDefault||function(W){return W&&W.__esModule?W:{default:W}};Object.defineProperty(a,"__esModule",{value:!0});const E=r(50),A=S(r(88)),U=r(64),B=r(110),D=r(109),R={maxBins:12,fontSize:11};a.histogram=function(W,j,H={}){return c(this,void 0,void 0,function*(){const I=function(oe){if(oe.length==null)throw new Error("input data must be an array");if(oe.length===0)return[];if(typeof oe[0]=="object"){if(oe[0].value==null)throw new Error("input data must have a value field");return oe}{const ye=Array(oe.length);for(let _e=0;_e<oe.length;_e++)ye[_e]={value:oe[_e]};return ye}}(j),Q=Object.assign({},R,H),Y=U.subSurface(W,"histogram");if(H.stats!==!1){const oe=U.subSurface(W,"stats",{prepend:!0});(function(ye,_e,pe){const me=E.format(",.4~f"),Ge=E.format(".4~p"),lt=[],It=[];if(ye.numVals!=null&&(lt.push("Num Vals"),It.push(me(ye.numVals))),ye.min!=null&&(lt.push("Min"),It.push(me(ye.min))),ye.max!=null&&(lt.push("Max"),It.push(me(ye.max))),ye.numZeros!=null){lt.push("# Zeros");let wt="";ye.numVals&&(wt=ye.numZeros>0?`(${Ge(ye.numZeros/ye.numVals)})`:""),It.push(`${me(ye.numZeros)} ${wt}`)}if(ye.numNans!=null){lt.push("# NaNs");let wt="";ye.numVals&&(wt=ye.numNans>0?`(${Ge(ye.numNans/ye.numVals)})`:""),It.push(`${me(ye.numNans)} ${wt}`)}if(ye.numInfs!=null){lt.push("# Infinity");let wt="";ye.numVals&&(wt=ye.numInfs>0?`(${Ge(ye.numInfs/ye.numVals)})`:""),It.push(`${me(ye.numInfs)} ${wt}`)}D.table(_e,{headers:lt,values:[It]},pe)})(H.stats?H.stats:B.arrayStats(I.map(ye=>ye.value)),oe,{fontSize:Q.fontSize})}if(I.length===0)return;const q=[];for(let oe=0;oe<I.length;oe++){const ye=I[oe].value;ye!=null&&isFinite(ye)&&q.push(I[oe])}const ae={width:Q.width||U.getDefaultWidth(Y),height:Q.height||U.getDefaultHeight(Y),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},data:{values:q},mark:{type:"bar",tooltip:!0},config:{axis:{labelFontSize:Q.fontSize,titleFontSize:Q.fontSize},text:{fontSize:Q.fontSize},legend:{labelFontSize:Q.fontSize,titleFontSize:Q.fontSize}},encoding:{x:{bin:{maxbins:Q.maxBins},field:"value",type:"quantitative"},y:{aggregate:"count",type:"quantitative"},color:{value:Q.color||"#001B44"}}};return A.default(Y,ae,{actions:!1,mode:"vega-lite",defaultStyle:!1})})}},function(s,a,r){r.r(a),r.d(a,"h",function(){return A}),r.d(a,"createElement",function(){return A}),r.d(a,"cloneElement",function(){return D}),r.d(a,"Component",function(){return pt}),r.d(a,"render",function(){return vt}),r.d(a,"rerender",function(){return H}),r.d(a,"options",function(){return c});var c={},S=[],E=[];function A(xt,_t){var Xt,sn,kn,an,Ve=E;for(an=arguments.length;an-- >2;)S.push(arguments[an]);for(_t&&_t.children!=null&&(S.length||S.push(_t.children),delete _t.children);S.length;)if((sn=S.pop())&&sn.pop!==void 0)for(an=sn.length;an--;)S.push(sn[an]);else typeof sn=="boolean"&&(sn=null),(kn=typeof xt!="function")&&(sn==null?sn="":typeof sn=="number"?sn=String(sn):typeof sn!="string"&&(kn=!1)),kn&&Xt?Ve[Ve.length-1]+=sn:Ve===E?Ve=[sn]:Ve.push(sn),Xt=kn;var Ye=new function(){};return Ye.nodeName=xt,Ye.children=Ve,Ye.attributes=_t??void 0,Ye.key=_t==null?void 0:_t.key,c.vnode!==void 0&&c.vnode(Ye),Ye}function U(xt,_t){for(var Xt in _t)xt[Xt]=_t[Xt];return xt}var B=typeof Promise=="function"?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function D(xt,_t){return A(xt.nodeName,U(U({},xt.attributes),_t),arguments.length>2?[].slice.call(arguments,2):xt.children)}var R=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,W=[];function j(xt){!xt._dirty&&(xt._dirty=!0)&&W.push(xt)==1&&(c.debounceRendering||B)(H)}function H(){var xt,_t=W;for(W=[];xt=_t.pop();)xt._dirty&&Ut(xt)}function I(xt,_t,Xt){return typeof _t=="string"||typeof _t=="number"?xt.splitText!==void 0:typeof _t.nodeName=="string"?!xt._componentConstructor&&Q(xt,_t.nodeName):Xt||xt._componentConstructor===_t.nodeName}function Q(xt,_t){return xt.normalizedNodeName===_t||xt.nodeName.toLowerCase()===_t.toLowerCase()}function Y(xt){var _t=U({},xt.attributes);_t.children=xt.children;var Xt=xt.nodeName.defaultProps;if(Xt!==void 0)for(var sn in Xt)_t[sn]===void 0&&(_t[sn]=Xt[sn]);return _t}function q(xt){var _t=xt.parentNode;_t&&_t.removeChild(xt)}function ae(xt,_t,Xt,sn,kn){if(_t==="className"&&(_t="class"),_t!=="key")if(_t==="ref")Xt&&Xt(null),sn&&sn(xt);else if(_t!=="class"||kn)if(_t==="style"){if(sn&&typeof sn!="string"&&typeof Xt!="string"||(xt.style.cssText=sn||""),sn&&typeof sn=="object"){if(typeof Xt!="string")for(var an in Xt)an in sn||(xt.style[an]="");for(var an in sn)xt.style[an]=typeof sn[an]=="number"&&R.test(an)===!1?sn[an]+"px":sn[an]}}else if(_t==="dangerouslySetInnerHTML")sn&&(xt.innerHTML=sn.__html||"");else if(_t[0]=="o"&&_t[1]=="n"){var Ve=_t!==(_t=_t.replace(/Capture$/,""));_t=_t.toLowerCase().substring(2),sn?Xt||xt.addEventListener(_t,oe,Ve):xt.removeEventListener(_t,oe,Ve),(xt._listeners||(xt._listeners={}))[_t]=sn}else if(_t!=="list"&&_t!=="type"&&!kn&&_t in xt)(function($e,ft,$t){try{$e[ft]=$t}catch{}})(xt,_t,sn??""),sn!=null&&sn!==!1||xt.removeAttribute(_t);else{var Ye=kn&&_t!==(_t=_t.replace(/^xlink:?/,""));sn==null||sn===!1?Ye?xt.removeAttributeNS("http://www.w3.org/1999/xlink",_t.toLowerCase()):xt.removeAttribute(_t):typeof sn!="function"&&(Ye?xt.setAttributeNS("http://www.w3.org/1999/xlink",_t.toLowerCase(),sn):xt.setAttribute(_t,sn))}else xt.className=sn||""}function oe(xt){return this._listeners[xt.type](c.event&&c.event(xt)||xt)}var ye=[],_e=0,pe=!1,me=!1;function Ge(){for(var xt;xt=ye.pop();)c.afterMount&&c.afterMount(xt),xt.componentDidMount&&xt.componentDidMount()}function lt(xt,_t,Xt,sn,kn,an){_e++||(pe=kn!=null&&kn.ownerSVGElement!==void 0,me=xt!=null&&!("__preactattr_"in xt));var Ve=It(xt,_t,Xt,sn,an);return kn&&Ve.parentNode!==kn&&kn.appendChild(Ve),--_e||(me=!1,an||Ge()),Ve}function It(xt,_t,Xt,sn,kn){var an=xt,Ve=pe;if(_t!=null&&typeof _t!="boolean"||(_t=""),typeof _t=="string"||typeof _t=="number")return xt&&xt.splitText!==void 0&&xt.parentNode&&(!xt._component||kn)?xt.nodeValue!=_t&&(xt.nodeValue=_t):(an=document.createTextNode(_t),xt&&(xt.parentNode&&xt.parentNode.replaceChild(an,xt),wt(xt,!0))),an.__preactattr_=!0,an;var Ye=_t.nodeName;if(typeof Ye=="function")return function(An,Qn,Ce,sr){for(var Mr=An&&An._component,on=Mr,Gt=An,Hn=Mr&&An._componentConstructor===Qn.nodeName,Kt=Hn,Vt=Y(Qn);Mr&&!Kt&&(Mr=Mr._parentComponent);)Kt=Mr.constructor===Qn.nodeName;return Mr&&Kt&&(!sr||Mr._component)?(ze(Mr,Vt,3,Ce,sr),An=Mr.base):(on&&!Hn&&(Ft(on),An=Gt=null),Mr=Bt(Qn.nodeName,Vt,Ce),An&&!Mr.nextBase&&(Mr.nextBase=An,Gt=null),ze(Mr,Vt,1,Ce,sr),An=Mr.base,Gt&&An!==Gt&&(Gt._component=null,wt(Gt,!1))),An}(xt,_t,Xt,sn);if(pe=Ye==="svg"||Ye!=="foreignObject"&&pe,Ye=String(Ye),(!xt||!Q(xt,Ye))&&(an=function(An,Qn){var Ce=Qn?document.createElementNS("http://www.w3.org/2000/svg",An):document.createElement(An);return Ce.normalizedNodeName=An,Ce}(Ye,pe),xt)){for(;xt.firstChild;)an.appendChild(xt.firstChild);xt.parentNode&&xt.parentNode.replaceChild(an,xt),wt(xt,!0)}var $e=an.firstChild,ft=an.__preactattr_,$t=_t.children;if(ft==null){ft=an.__preactattr_={};for(var Jt=an.attributes,Pn=Jt.length;Pn--;)ft[Jt[Pn].name]=Jt[Pn].value}return!me&&$t&&$t.length===1&&typeof $t[0]=="string"&&$e!=null&&$e.splitText!==void 0&&$e.nextSibling==null?$e.nodeValue!=$t[0]&&($e.nodeValue=$t[0]):($t&&$t.length||$e!=null)&&function(An,Qn,Ce,sr,Mr){var on,Gt,Hn,Kt,Vt,en=An.childNodes,Vn=[],Dt={},On=0,or=0,ar=en.length,yr=0,kr=Qn?Qn.length:0;if(ar!==0)for(var dr=0;dr<ar;dr++){var oi=en[dr],Ur=oi.__preactattr_,Xr=kr&&Ur?oi._component?oi._component.__key:Ur.key:null;Xr!=null?(On++,Dt[Xr]=oi):(Ur||(oi.splitText!==void 0?!Mr||oi.nodeValue.trim():Mr))&&(Vn[yr++]=oi)}if(kr!==0)for(var dr=0;dr<kr;dr++){Kt=Qn[dr],Vt=null;var Xr=Kt.key;if(Xr!=null)On&&Dt[Xr]!==void 0&&(Vt=Dt[Xr],Dt[Xr]=void 0,On--);else if(!Vt&&or<yr){for(on=or;on<yr;on++)if(Vn[on]!==void 0&&I(Gt=Vn[on],Kt,Mr)){Vt=Gt,Vn[on]=void 0,on===yr-1&&yr--,on===or&&or++;break}}Vt=It(Vt,Kt,Ce,sr),Hn=en[dr],Vt&&Vt!==An&&Vt!==Hn&&(Hn==null?An.appendChild(Vt):Vt===Hn.nextSibling?q(Hn):An.insertBefore(Vt,Hn))}if(On)for(var dr in Dt)Dt[dr]!==void 0&&wt(Dt[dr],!1);for(;or<=yr;)(Vt=Vn[yr--])!==void 0&&wt(Vt,!1)}(an,$t,Xt,sn,me||ft.dangerouslySetInnerHTML!=null),function(An,Qn,Ce){var sr;for(sr in Ce)Qn&&Qn[sr]!=null||Ce[sr]==null||ae(An,sr,Ce[sr],Ce[sr]=void 0,pe);for(sr in Qn)sr==="children"||sr==="innerHTML"||sr in Ce&&Qn[sr]===(sr==="value"||sr==="checked"?An[sr]:Ce[sr])||ae(An,sr,Ce[sr],Ce[sr]=Qn[sr],pe)}(an,_t.attributes,ft),pe=Ve,an}function wt(xt,_t){var Xt=xt._component;Xt?Ft(Xt):(xt.__preactattr_!=null&&xt.__preactattr_.ref&&xt.__preactattr_.ref(null),_t!==!1&&xt.__preactattr_!=null||q(xt),we(xt))}function we(xt){for(xt=xt.lastChild;xt;){var _t=xt.previousSibling;wt(xt,!0),xt=_t}}var yt={};function Bt(xt,_t,Xt){var sn,kn=yt[xt.name];if(xt.prototype&&xt.prototype.render?(sn=new xt(_t,Xt),pt.call(sn,_t,Xt)):((sn=new pt(_t,Xt)).constructor=xt,sn.render=Ot),kn){for(var an=kn.length;an--;)if(kn[an].constructor===xt){sn.nextBase=kn[an].nextBase,kn.splice(an,1);break}}return sn}function Ot(xt,_t,Xt){return this.constructor(xt,Xt)}function ze(xt,_t,Xt,sn,kn){xt._disable||(xt._disable=!0,(xt.__ref=_t.ref)&&delete _t.ref,(xt.__key=_t.key)&&delete _t.key,!xt.base||kn?xt.componentWillMount&&xt.componentWillMount():xt.componentWillReceiveProps&&xt.componentWillReceiveProps(_t,sn),sn&&sn!==xt.context&&(xt.prevContext||(xt.prevContext=xt.context),xt.context=sn),xt.prevProps||(xt.prevProps=xt.props),xt.props=_t,xt._disable=!1,Xt!==0&&(Xt!==1&&c.syncComponentUpdates===!1&&xt.base?j(xt):Ut(xt,1,kn)),xt.__ref&&xt.__ref(xt))}function Ut(xt,_t,Xt,sn){if(!xt._disable){var kn,an,Ve,Ye=xt.props,$e=xt.state,ft=xt.context,$t=xt.prevProps||Ye,Jt=xt.prevState||$e,Pn=xt.prevContext||ft,An=xt.base,Qn=xt.nextBase,Ce=An||Qn,sr=xt._component,Mr=!1;if(An&&(xt.props=$t,xt.state=Jt,xt.context=Pn,_t!==2&&xt.shouldComponentUpdate&&xt.shouldComponentUpdate(Ye,$e,ft)===!1?Mr=!0:xt.componentWillUpdate&&xt.componentWillUpdate(Ye,$e,ft),xt.props=Ye,xt.state=$e,xt.context=ft),xt.prevProps=xt.prevState=xt.prevContext=xt.nextBase=null,xt._dirty=!1,!Mr){kn=xt.render(Ye,$e,ft),xt.getChildContext&&(ft=U(U({},ft),xt.getChildContext()));var on,Gt,Hn=kn&&kn.nodeName;if(typeof Hn=="function"){var Kt=Y(kn);(an=sr)&&an.constructor===Hn&&Kt.key==an.__key?ze(an,Kt,1,ft,!1):(on=an,xt._component=an=Bt(Hn,Kt,ft),an.nextBase=an.nextBase||Qn,an._parentComponent=xt,ze(an,Kt,0,ft,!1),Ut(an,1,Xt,!0)),Gt=an.base}else Ve=Ce,(on=sr)&&(Ve=xt._component=null),(Ce||_t===1)&&(Ve&&(Ve._component=null),Gt=lt(Ve,kn,ft,Xt||!An,Ce&&Ce.parentNode,!0));if(Ce&&Gt!==Ce&&an!==sr){var Vt=Ce.parentNode;Vt&&Gt!==Vt&&(Vt.replaceChild(Gt,Ce),on||(Ce._component=null,wt(Ce,!1)))}if(on&&Ft(on),xt.base=Gt,Gt&&!sn){for(var en=xt,Vn=xt;Vn=Vn._parentComponent;)(en=Vn).base=Gt;Gt._component=en,Gt._componentConstructor=en.constructor}}if(!An||Xt?ye.unshift(xt):Mr||(xt.componentDidUpdate&&xt.componentDidUpdate($t,Jt,Pn),c.afterUpdate&&c.afterUpdate(xt)),xt._renderCallbacks!=null)for(;xt._renderCallbacks.length;)xt._renderCallbacks.pop().call(xt);_e||sn||Ge()}}function Ft(xt){c.beforeUnmount&&c.beforeUnmount(xt);var _t=xt.base;xt._disable=!0,xt.componentWillUnmount&&xt.componentWillUnmount(),xt.base=null;var Xt=xt._component;Xt?Ft(Xt):_t&&(_t.__preactattr_&&_t.__preactattr_.ref&&_t.__preactattr_.ref(null),xt.nextBase=_t,q(_t),function(sn){var kn=sn.constructor.name;(yt[kn]||(yt[kn]=[])).push(sn)}(xt),we(_t)),xt.__ref&&xt.__ref(null)}function pt(xt,_t){this._dirty=!0,this.context=_t,this.props=xt,this.state=this.state||{}}function vt(xt,_t,Xt){return lt(Xt,xt,{},!1,_t,!1)}U(pt.prototype,{setState:function(xt,_t){var Xt=this.state;this.prevState||(this.prevState=U({},Xt)),U(Xt,typeof xt=="function"?xt(Xt,this.props):xt),_t&&(this._renderCallbacks=this._renderCallbacks||[]).push(_t),j(this)},forceUpdate:function(xt){xt&&(this._renderCallbacks=this._renderCallbacks||[]).push(xt),Ut(this,2)},render:function(){}});var rn={h:A,createElement:A,cloneElement:D,Component:pt,render:vt,rerender:H,options:c};a.default=rn},function(s,a,r){var c=Object.getOwnPropertySymbols,S=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;s.exports=function(){try{if(!Object.assign)return!1;var A=new String("abc");if(A[5]="de",Object.getOwnPropertyNames(A)[0]==="5")return!1;for(var U={},B=0;B<10;B++)U["_"+String.fromCharCode(B)]=B;if(Object.getOwnPropertyNames(U).map(function(R){return U[R]}).join("")!=="0123456789")return!1;var D={};return"abcdefghijklmnopqrst".split("").forEach(function(R){D[R]=R}),Object.keys(Object.assign({},D)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}()?Object.assign:function(A,U){for(var B,D,R=function(I){if(I==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(I)}(A),W=1;W<arguments.length;W++){for(var j in B=Object(arguments[W]))S.call(B,j)&&(R[j]=B[j]);if(c){D=c(B);for(var H=0;H<D.length;H++)E.call(B,D[H])&&(R[D[H]]=B[D[H]])}}return R}},function(s,a,r){const c=r(32),S=r(113),{ANY:E}=S,A=r(47),U=r(112),B=r(114),D=r(143),R=r(141),W=r(142);s.exports=(j,H,I,Q)=>{let Y,q,ae,oe,ye;switch(j=new c(j,Q),H=new A(H,Q),I){case">":Y=B,q=R,ae=D,oe=">",ye=">=";break;case"<":Y=D,q=W,ae=B,oe="<",ye="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(U(j,H,Q))return!1;for(let _e=0;_e<H.set.length;++_e){let pe=null,me=null;if(H.set[_e].forEach(Ge=>{Ge.semver===E&&(Ge=new S(">=0.0.0")),pe=pe||Ge,me=me||Ge,Y(Ge.semver,pe.semver,Q)?pe=Ge:ae(Ge.semver,me.semver,Q)&&(me=Ge)}),pe.operator===oe||pe.operator===ye||(!me.operator||me.operator===oe)&&q(j,me.semver)||me.operator===ye&&ae(j,me.semver))return!1}return!0}},function(s,a,r){const c=r(48);s.exports=(S,E,A)=>c(S,E,A)<=0},function(s,a,r){const c=r(48);s.exports=(S,E,A)=>c(S,E,A)>=0},function(s,a,r){const c=r(48);s.exports=(S,E,A)=>c(S,E,A)<0},function(s,a,r){const c=r(32);s.exports=(S,E,A)=>{const U=new c(S,A),B=new c(E,A);return U.compare(B)||U.compareBuild(B)}},function(s,a,r){const c=r(48);s.exports=(S,E,A)=>c(S,E,A)===0},function(s,a){const r=/^[0-9]+$/,c=(S,E)=>{const A=r.test(S),U=r.test(E);return A&&U&&(S=+S,E=+E),S===E?0:A&&!U?-1:U&&!A?1:S<E?-1:1};s.exports={compareIdentifiers:c,rcompareIdentifiers:(S,E)=>c(E,S)}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.getBroadcastDims=function(c,S){for(var E=c.length,A=[],U=0;U<E;U++){var B=E-1-U,D=c[B]||1;(S[S.length-1-U]||1)>1&&D===1&&A.unshift(B)}return A},a.getReductionAxes=function(c,S){for(var E=[],A=0;A<S.length;A++){var U=c[c.length-A-1],B=S.length-A-1,D=S[B];(U==null||U===1&&D>1)&&E.unshift(B)}return E},a.assertAndGetBroadcastShape=function(c,S){for(var E=[],A=Math.max(c.length,S.length),U=0;U<A;U++){var B=c[c.length-U-1];B==null&&(B=1);var D=S[S.length-U-1];if(D==null&&(D=1),B===1)E.unshift(D);else if(D===1)E.unshift(B);else{if(B!==D)throw Error("Operands could not be broadcast together with shapes "+c+" and "+S+".");E.unshift(B)}}return E}},function(s,a,r){s.exports=!r(208)(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7})},function(s,a){s.exports=function(r){return typeof r=="object"?r!==null:typeof r=="function"}},function(s,a){var r=s.exports=typeof window<"u"&&window.Math==Math?window:typeof self<"u"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=r)},function(s,a,r){var c=r(16),S=r(27),E=r(83),A=r(118),U=r(42),B=r(93),D=r(15),R=r(94),W=r(54),j=r(22),H=r(213),I=r(79).f,Q=r(26).f,Y=r(156),q=r(98),ae="prototype",oe="Wrong index!",ye=c.ArrayBuffer,_e=c.DataView,pe=c.Math,me=c.RangeError,Ge=c.Infinity,lt=ye,It=pe.abs,wt=pe.pow,we=pe.floor,yt=pe.log,Bt=pe.LN2,Ot=S?"_b":"buffer",ze=S?"_l":"byteLength",Ut=S?"_o":"byteOffset";function Ft(An,Qn,Ce){var sr,Mr,on,Gt=new Array(Ce),Hn=8*Ce-Qn-1,Kt=(1<<Hn)-1,Vt=Kt>>1,en=Qn===23?wt(2,-24)-wt(2,-77):0,Vn=0,Dt=An<0||An===0&&1/An<0?1:0;for((An=It(An))!=An||An===Ge?(Mr=An!=An?1:0,sr=Kt):(sr=we(yt(An)/Bt),An*(on=wt(2,-sr))<1&&(sr--,on*=2),(An+=sr+Vt>=1?en/on:en*wt(2,1-Vt))*on>=2&&(sr++,on/=2),sr+Vt>=Kt?(Mr=0,sr=Kt):sr+Vt>=1?(Mr=(An*on-1)*wt(2,Qn),sr+=Vt):(Mr=An*wt(2,Vt-1)*wt(2,Qn),sr=0));Qn>=8;Gt[Vn++]=255&Mr,Mr/=256,Qn-=8);for(sr=sr<<Qn|Mr,Hn+=Qn;Hn>0;Gt[Vn++]=255&sr,sr/=256,Hn-=8);return Gt[--Vn]|=128*Dt,Gt}function pt(An,Qn,Ce){var sr,Mr=8*Ce-Qn-1,on=(1<<Mr)-1,Gt=on>>1,Hn=Mr-7,Kt=Ce-1,Vt=An[Kt--],en=127&Vt;for(Vt>>=7;Hn>0;en=256*en+An[Kt],Kt--,Hn-=8);for(sr=en&(1<<-Hn)-1,en>>=-Hn,Hn+=Qn;Hn>0;sr=256*sr+An[Kt],Kt--,Hn-=8);if(en===0)en=1-Gt;else{if(en===on)return sr?NaN:Vt?-Ge:Ge;sr+=wt(2,Qn),en-=Gt}return(Vt?-1:1)*sr*wt(2,en-Qn)}function vt(An){return An[3]<<24|An[2]<<16|An[1]<<8|An[0]}function rn(An){return[255&An]}function xt(An){return[255&An,An>>8&255]}function _t(An){return[255&An,An>>8&255,An>>16&255,An>>24&255]}function Xt(An){return Ft(An,52,8)}function sn(An){return Ft(An,23,4)}function kn(An,Qn,Ce){Q(An[ae],Qn,{get:function(){return this[Ce]}})}function an(An,Qn,Ce,sr){var Mr=H(+Ce);if(Mr+Qn>An[ze])throw me(oe);var on=An[Ot]._b,Gt=Mr+An[Ut],Hn=on.slice(Gt,Gt+Qn);return sr?Hn:Hn.reverse()}function Ve(An,Qn,Ce,sr,Mr,on){var Gt=H(+Ce);if(Gt+Qn>An[ze])throw me(oe);for(var Hn=An[Ot]._b,Kt=Gt+An[Ut],Vt=sr(+Mr),en=0;en<Qn;en++)Hn[Kt+en]=Vt[on?en:Qn-en-1]}if(A.ABV){if(!D(function(){ye(1)})||!D(function(){new ye(-1)})||D(function(){return new ye,new ye(1.5),new ye(NaN),ye.name!="ArrayBuffer"})){for(var Ye,$e=(ye=function(An){return R(this,ye),new lt(H(An))})[ae]=lt[ae],ft=I(lt),$t=0;ft.length>$t;)(Ye=ft[$t++])in ye||U(ye,Ye,lt[Ye]);E||($e.constructor=ye)}var Jt=new _e(new ye(2)),Pn=_e[ae].setInt8;Jt.setInt8(0,2147483648),Jt.setInt8(1,2147483649),!Jt.getInt8(0)&&Jt.getInt8(1)||B(_e[ae],{setInt8:function(An,Qn){Pn.call(this,An,Qn<<24>>24)},setUint8:function(An,Qn){Pn.call(this,An,Qn<<24>>24)}},!0)}else ye=function(An){R(this,ye,"ArrayBuffer");var Qn=H(An);this._b=Y.call(new Array(Qn),0),this[ze]=Qn},_e=function(An,Qn,Ce){R(this,_e,"DataView"),R(An,ye,"DataView");var sr=An[ze],Mr=W(Qn);if(Mr<0||Mr>sr)throw me("Wrong offset!");if(Mr+(Ce=Ce===void 0?sr-Mr:j(Ce))>sr)throw me("Wrong length!");this[Ot]=An,this[Ut]=Mr,this[ze]=Ce},S&&(kn(ye,"byteLength","_l"),kn(_e,"buffer","_b"),kn(_e,"byteLength","_l"),kn(_e,"byteOffset","_o")),B(_e[ae],{getInt8:function(An){return an(this,1,An)[0]<<24>>24},getUint8:function(An){return an(this,1,An)[0]},getInt16:function(An){var Qn=an(this,2,An,arguments[1]);return(Qn[1]<<8|Qn[0])<<16>>16},getUint16:function(An){var Qn=an(this,2,An,arguments[1]);return Qn[1]<<8|Qn[0]},getInt32:function(An){return vt(an(this,4,An,arguments[1]))},getUint32:function(An){return vt(an(this,4,An,arguments[1]))>>>0},getFloat32:function(An){return pt(an(this,4,An,arguments[1]),23,4)},getFloat64:function(An){return pt(an(this,8,An,arguments[1]),52,8)},setInt8:function(An,Qn){Ve(this,1,An,rn,Qn)},setUint8:function(An,Qn){Ve(this,1,An,rn,Qn)},setInt16:function(An,Qn){Ve(this,2,An,xt,Qn,arguments[2])},setUint16:function(An,Qn){Ve(this,2,An,xt,Qn,arguments[2])},setInt32:function(An,Qn){Ve(this,4,An,_t,Qn,arguments[2])},setUint32:function(An,Qn){Ve(this,4,An,_t,Qn,arguments[2])},setFloat32:function(An,Qn){Ve(this,4,An,sn,Qn,arguments[2])},setFloat64:function(An,Qn){Ve(this,8,An,Xt,Qn,arguments[2])}});q(ye,"ArrayBuffer"),q(_e,"DataView"),U(_e[ae],A.VIEW,!0),a.ArrayBuffer=ye,a.DataView=_e},function(s,a,r){var c,S,E,A=r(56),U=r(232),B=r(171),D=r(175),R=r(16),W=R.process,j=R.setImmediate,H=R.clearImmediate,I=R.MessageChannel,Q=R.Dispatch,Y=0,q={},ae=function(){var ye=+this;if(q.hasOwnProperty(ye)){var _e=q[ye];delete q[ye],_e()}},oe=function(ye){ae.call(ye.data)};j&&H||(j=function(ye){for(var _e=[],pe=1;arguments.length>pe;)_e.push(arguments[pe++]);return q[++Y]=function(){U(typeof ye=="function"?ye:Function(ye),_e)},c(Y),Y},H=function(ye){delete q[ye]},r(62)(W)=="process"?c=function(ye){W.nextTick(A(ae,ye,1))}:Q&&Q.now?c=function(ye){Q.now(A(ae,ye,1))}:I?(E=(S=new I).port2,S.port1.onmessage=oe,c=A(E.postMessage,E,1)):R.addEventListener&&typeof postMessage=="function"&&!R.importScripts?(c=function(ye){R.postMessage(ye+"","*")},R.addEventListener("message",oe,!1)):c="onreadystatechange"in D("script")?function(ye){B.appendChild(D("script")).onreadystatechange=function(){B.removeChild(this),ae.call(ye)}}:function(ye){setTimeout(A(ae,ye,1),0)}),s.exports={set:j,clear:H}},function(s,a,r){var c=r(164)(!0);s.exports=function(S,E,A){return E+(A?c(S,E).length:1)}},function(s,a,r){var c=r(124),S=RegExp.prototype.exec,E=String.prototype.replace,A=S,U=function(){var D=/a/,R=/b*/g;return S.call(D,"a"),S.call(R,"a"),D.lastIndex!==0||R.lastIndex!==0}(),B=/()??/.exec("")[1]!==void 0;(U||B)&&(A=function(D){var R,W,j,H,I=this;return B&&(W=new RegExp("^"+I.source+"$(?!\\s)",c.call(I))),U&&(R=I.lastIndex),j=S.call(I,D),U&&j&&(I.lastIndex=I.global?j.index+j[0].length:R),B&&j&&j.length>1&&E.call(j[0],W,function(){for(H=1;H<arguments.length-2;H++)arguments[H]===void 0&&(j[H]=void 0)}),j}),s.exports=A},function(s,a,r){var c=r(77),S=r(221),E=r(96),A=r(41);s.exports=r(163)(Array,"Array",function(U,B){this._t=A(U),this._i=0,this._k=B},function(){var U=this._t,B=this._k,D=this._i++;return!U||D>=U.length?(this._t=void 0,S(1)):S(0,B=="keys"?D:B=="values"?U[D]:[D,U[D]])},"values"),E.Arguments=E.Array,c("keys"),c("values"),c("entries")},function(s,a,r){var c=r(34),S=r(81),E=r(22);s.exports=function(A){for(var U=c(this),B=E(U.length),D=arguments.length,R=S(D>1?arguments[1]:void 0,B),W=D>2?arguments[2]:void 0,j=W===void 0?B:S(W,B);j>R;)U[R++]=A;return U}},function(s,a,r){var c=r(105),S=r(19)("iterator"),E=r(96);s.exports=r(24).getIteratorMethod=function(A){if(A!=null)return A[S]||A["@@iterator"]||E[c(A)]}},function(s,a,r){var c=r(26),S=r(85);s.exports=function(E,A,U){A in E?c.f(E,A,S(0,U)):E[A]=U}},function(s,a,r){var c=r(96),S=r(19)("iterator"),E=Array.prototype;s.exports=function(A){return A!==void 0&&(c.Array===A||E[S]===A)}},function(s,a,r){var c=r(19)("match");s.exports=function(S){var E=/./;try{"/./"[S](E)}catch{try{return E[c]=!1,!"/./"[S](E)}catch{}}return!0}},function(s,a,r){var c=r(13),S=r(62),E=r(19)("match");s.exports=function(A){var U;return c(A)&&((U=A[E])!==void 0?!!U:S(A)=="RegExp")}},function(s,a,r){var c=r(161),S=r(61);s.exports=function(E,A,U){if(c(A))throw TypeError("String#"+U+" doesn't accept regex!");return String(S(E))}},function(s,a,r){var c=r(83),S=r(8),E=r(38),A=r(42),U=r(96),B=r(226),D=r(98),R=r(78),W=r(19)("iterator"),j=!([].keys&&"next"in[].keys()),H=function(){return this};s.exports=function(I,Q,Y,q,ae,oe,ye){B(Y,Q,q);var _e,pe,me,Ge=function(Ut){if(!j&&Ut in we)return we[Ut];switch(Ut){case"keys":case"values":return function(){return new Y(this,Ut)}}return function(){return new Y(this,Ut)}},lt=Q+" Iterator",It=ae=="values",wt=!1,we=I.prototype,yt=we[W]||we["@@iterator"]||ae&&we[ae],Bt=yt||Ge(ae),Ot=ae?It?Ge("entries"):Bt:void 0,ze=Q=="Array"&&we.entries||yt;if(ze&&(me=R(ze.call(new I)))!==Object.prototype&&me.next&&(D(me,lt,!0),c||typeof me[W]=="function"||A(me,W,H)),It&&yt&&yt.name!=="values"&&(wt=!0,Bt=function(){return yt.call(this)}),c&&!ye||!j&&!wt&&we[W]||A(we,W,Bt),U[Q]=Bt,U[lt]=H,ae)if(_e={values:It?Bt:Ge("values"),keys:oe?Bt:Ge("keys"),entries:Ot},ye)for(pe in _e)pe in we||E(we,pe,_e[pe]);else S(S.P+S.F*(j||wt),Q,_e);return _e}},function(s,a,r){var c=r(54),S=r(61);s.exports=function(E){return function(A,U){var B,D,R=String(S(A)),W=c(U),j=R.length;return W<0||W>=j?E?"":void 0:(B=R.charCodeAt(W))<55296||B>56319||W+1===j||(D=R.charCodeAt(W+1))<56320||D>57343?E?R.charAt(W):B:E?R.slice(W,W+2):D-56320+(B-55296<<10)+65536}}},function(s,a){var r=Math.expm1;s.exports=!r||r(10)>22025.465794806718||r(10)<22025.465794806718||r(-2e-17)!=-2e-17?function(c){return(c=+c)==0?c:c>-1e-6&&c<1e-6?c+c*c/2:Math.exp(c)-1}:r},function(s,a){s.exports=Math.sign||function(r){return(r=+r)==0||r!=r?r:r<0?-1:1}},function(s,a,r){var c=r(54),S=r(61);s.exports=function(E){var A=String(S(this)),U="",B=c(E);if(B<0||B==1/0)throw RangeError("Count can't be negative");for(;B>0;(B>>>=1)&&(A+=A))1&B&&(U+=A);return U}},function(s,a,r){var c=r(13),S=r(170).set;s.exports=function(E,A,U){var B,D=A.constructor;return D!==U&&typeof D=="function"&&(B=D.prototype)!==U.prototype&&c(B)&&S&&S(E,B),E}},function(s,a){s.exports=`	
\v\f\r \u2028\u2029\uFEFF`},function(s,a,r){var c=r(13),S=r(14),E=function(A,U){if(S(A),!c(U)&&U!==null)throw TypeError(U+": can't set as prototype!")};s.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(A,U,B){try{(B=r(56)(Function.call,r(53).f(Object.prototype,"__proto__").set,2))(A,[]),U=!(A instanceof Array)}catch{U=!0}return function(D,R){return E(D,R),U?D.__proto__=R:B(D,R),D}}({},!1):void 0),check:E}},function(s,a,r){var c=r(16).document;s.exports=c&&c.documentElement},function(s,a){s.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(s,a,r){var c=r(129)("keys"),S=r(84);s.exports=function(E){return c[E]||(c[E]=S(E))}},function(s,a,r){a.f=r(19)},function(s,a,r){var c=r(13),S=r(16).document,E=c(S)&&c(S.createElement);s.exports=function(A){return E?S.createElement(A):{}}},function(s,a,r){var c=function(oe){return oe},S=function(oe){if(oe==null)return c;var ye,_e,pe=oe.scale[0],me=oe.scale[1],Ge=oe.translate[0],lt=oe.translate[1];return function(It,wt){wt||(ye=_e=0);var we=2,yt=It.length,Bt=new Array(yt);for(Bt[0]=(ye+=It[0])*pe+Ge,Bt[1]=(_e+=It[1])*me+lt;we<yt;)Bt[we]=It[we],++we;return Bt}},E=function(oe){var ye,_e=S(oe.transform),pe=1/0,me=pe,Ge=-pe,lt=-pe;function It(we){(we=_e(we))[0]<pe&&(pe=we[0]),we[0]>Ge&&(Ge=we[0]),we[1]<me&&(me=we[1]),we[1]>lt&&(lt=we[1])}function wt(we){switch(we.type){case"GeometryCollection":we.geometries.forEach(wt);break;case"Point":It(we.coordinates);break;case"MultiPoint":we.coordinates.forEach(It)}}for(ye in oe.arcs.forEach(function(we){for(var yt,Bt=-1,Ot=we.length;++Bt<Ot;)(yt=_e(we[Bt],Bt))[0]<pe&&(pe=yt[0]),yt[0]>Ge&&(Ge=yt[0]),yt[1]<me&&(me=yt[1]),yt[1]>lt&&(lt=yt[1])}),oe.objects)wt(oe.objects[ye]);return[pe,me,Ge,lt]},A=function(oe,ye){for(var _e,pe=oe.length,me=pe-ye;me<--pe;)_e=oe[me],oe[me++]=oe[pe],oe[pe]=_e},U=function(oe,ye){return typeof ye=="string"&&(ye=oe.objects[ye]),ye.type==="GeometryCollection"?{type:"FeatureCollection",features:ye.geometries.map(function(_e){return B(oe,_e)})}:B(oe,ye)};function B(oe,ye){var _e=ye.id,pe=ye.bbox,me=ye.properties==null?{}:ye.properties,Ge=D(oe,ye);return _e==null&&pe==null?{type:"Feature",properties:me,geometry:Ge}:pe==null?{type:"Feature",id:_e,properties:me,geometry:Ge}:{type:"Feature",id:_e,bbox:pe,properties:me,geometry:Ge}}function D(oe,ye){var _e=S(oe.transform),pe=oe.arcs;function me(we,yt){yt.length&&yt.pop();for(var Bt=pe[we<0?~we:we],Ot=0,ze=Bt.length;Ot<ze;++Ot)yt.push(_e(Bt[Ot],Ot));we<0&&A(yt,ze)}function Ge(we){return _e(we)}function lt(we){for(var yt=[],Bt=0,Ot=we.length;Bt<Ot;++Bt)me(we[Bt],yt);return yt.length<2&&yt.push(yt[0]),yt}function It(we){for(var yt=lt(we);yt.length<4;)yt.push(yt[0]);return yt}function wt(we){return we.map(It)}return function we(yt){var Bt,Ot=yt.type;switch(Ot){case"GeometryCollection":return{type:Ot,geometries:yt.geometries.map(we)};case"Point":Bt=Ge(yt.coordinates);break;case"MultiPoint":Bt=yt.coordinates.map(Ge);break;case"LineString":Bt=lt(yt.arcs);break;case"MultiLineString":Bt=yt.arcs.map(lt);break;case"Polygon":Bt=wt(yt.arcs);break;case"MultiPolygon":Bt=yt.arcs.map(wt);break;default:return null}return{type:Ot,coordinates:Bt}}(ye)}var R=function(oe,ye){var _e={},pe={},me={},Ge=[],lt=-1;function It(wt,we){for(var yt in wt){var Bt=wt[yt];delete we[Bt.start],delete Bt.start,delete Bt.end,Bt.forEach(function(Ot){_e[Ot<0?~Ot:Ot]=1}),Ge.push(Bt)}}return ye.forEach(function(wt,we){var yt,Bt=oe.arcs[wt<0?~wt:wt];Bt.length<3&&!Bt[1][0]&&!Bt[1][1]&&(yt=ye[++lt],ye[lt]=wt,ye[we]=yt)}),ye.forEach(function(wt){var we,yt,Bt=function(pt){var vt,rn=oe.arcs[pt<0?~pt:pt],xt=rn[0];return oe.transform?(vt=[0,0],rn.forEach(function(_t){vt[0]+=_t[0],vt[1]+=_t[1]})):vt=rn[rn.length-1],pt<0?[vt,xt]:[xt,vt]}(wt),Ot=Bt[0],ze=Bt[1];if(we=me[Ot])if(delete me[we.end],we.push(wt),we.end=ze,yt=pe[ze]){delete pe[yt.start];var Ut=yt===we?we:we.concat(yt);pe[Ut.start=we.start]=me[Ut.end=yt.end]=Ut}else pe[we.start]=me[we.end]=we;else if(we=pe[ze])if(delete pe[we.start],we.unshift(wt),we.start=Ot,yt=me[Ot]){delete me[yt.end];var Ft=yt===we?we:yt.concat(we);pe[Ft.start=yt.start]=me[Ft.end=we.end]=Ft}else pe[we.start]=me[we.end]=we;else pe[(we=[wt]).start=Ot]=me[we.end=ze]=we}),It(me,pe),It(pe,me),ye.forEach(function(wt){_e[wt<0?~wt:wt]||Ge.push([wt])}),Ge},W=function(oe){return D(oe,j.apply(this,arguments))};function j(oe,ye,_e){var pe,me,Ge;if(arguments.length>1)pe=function(lt,It,wt){var we,yt=[],Bt=[];function Ot(Ft){var pt=Ft<0?~Ft:Ft;(Bt[pt]||(Bt[pt]=[])).push({i:Ft,g:we})}function ze(Ft){Ft.forEach(Ot)}function Ut(Ft){Ft.forEach(ze)}return function Ft(pt){switch(we=pt,pt.type){case"GeometryCollection":pt.geometries.forEach(Ft);break;case"LineString":ze(pt.arcs);break;case"MultiLineString":case"Polygon":Ut(pt.arcs);break;case"MultiPolygon":(function(vt){vt.forEach(Ut)})(pt.arcs)}}(It),Bt.forEach(wt==null?function(Ft){yt.push(Ft[0].i)}:function(Ft){wt(Ft[0].g,Ft[Ft.length-1].g)&&yt.push(Ft[0].i)}),yt}(0,ye,_e);else for(me=0,pe=new Array(Ge=oe.arcs.length);me<Ge;++me)pe[me]=me;return{type:"MultiLineString",arcs:R(oe,pe)}}var H=function(oe){return D(oe,I.apply(this,arguments))};function I(oe,ye){var _e={},pe=[],me=[];function Ge(It){It.forEach(function(wt){wt.forEach(function(we){(_e[we=we<0?~we:we]||(_e[we]=[])).push(It)})}),pe.push(It)}function lt(It){return function(wt){for(var we,yt=-1,Bt=wt.length,Ot=wt[Bt-1],ze=0;++yt<Bt;)we=Ot,Ot=wt[yt],ze+=we[0]*Ot[1]-we[1]*Ot[0];return Math.abs(ze)}(D(oe,{type:"Polygon",arcs:[It]}).coordinates[0])}return ye.forEach(function It(wt){switch(wt.type){case"GeometryCollection":wt.geometries.forEach(It);break;case"Polygon":Ge(wt.arcs);break;case"MultiPolygon":wt.arcs.forEach(Ge)}}),pe.forEach(function(It){if(!It._){var wt=[],we=[It];for(It._=1,me.push(wt);It=we.pop();)wt.push(It),It.forEach(function(yt){yt.forEach(function(Bt){_e[Bt<0?~Bt:Bt].forEach(function(Ot){Ot._||(Ot._=1,we.push(Ot))})})})}}),pe.forEach(function(It){delete It._}),{type:"MultiPolygon",arcs:me.map(function(It){var wt,we=[];if(It.forEach(function(Ut){Ut.forEach(function(Ft){Ft.forEach(function(pt){_e[pt<0?~pt:pt].length<2&&we.push(pt)})})}),(wt=(we=R(oe,we)).length)>1)for(var yt,Bt,Ot=1,ze=lt(we[0]);Ot<wt;++Ot)(yt=lt(we[Ot]))>ze&&(Bt=we[0],we[0]=we[Ot],we[Ot]=Bt,ze=yt);return we}).filter(function(It){return It.length>0})}}var Q=function(oe,ye){for(var _e=0,pe=oe.length;_e<pe;){var me=_e+pe>>>1;oe[me]<ye?_e=me+1:pe=me}return _e},Y=function(oe){var ye={},_e=oe.map(function(){return[]});function pe(Ut,Ft){Ut.forEach(function(pt){pt<0&&(pt=~pt);var vt=ye[pt];vt?vt.push(Ft):ye[pt]=[Ft]})}function me(Ut,Ft){Ut.forEach(function(pt){pe(pt,Ft)})}var Ge={LineString:pe,MultiLineString:me,Polygon:me,MultiPolygon:function(Ut,Ft){Ut.forEach(function(pt){me(pt,Ft)})}};for(var lt in oe.forEach(function Ut(Ft,pt){Ft.type==="GeometryCollection"?Ft.geometries.forEach(function(vt){Ut(vt,pt)}):Ft.type in Ge&&Ge[Ft.type](Ft.arcs,pt)}),ye)for(var It=ye[lt],wt=It.length,we=0;we<wt;++we)for(var yt=we+1;yt<wt;++yt){var Bt,Ot=It[we],ze=It[yt];(Bt=_e[Ot])[lt=Q(Bt,ze)]!==ze&&Bt.splice(lt,0,ze),(Bt=_e[ze])[lt=Q(Bt,Ot)]!==Ot&&Bt.splice(lt,0,Ot)}return _e},q=function(oe){if(oe==null)return c;var ye,_e,pe=oe.scale[0],me=oe.scale[1],Ge=oe.translate[0],lt=oe.translate[1];return function(It,wt){wt||(ye=_e=0);var we=2,yt=It.length,Bt=new Array(yt),Ot=Math.round((It[0]-Ge)/pe),ze=Math.round((It[1]-lt)/me);for(Bt[0]=Ot-ye,ye=Ot,Bt[1]=ze-_e,_e=ze;we<yt;)Bt[we]=It[we],++we;return Bt}},ae=function(oe,ye){if(oe.transform)throw new Error("already quantized");if(ye&&ye.scale)It=oe.bbox;else{if(!((_e=Math.floor(ye))>=2))throw new Error("n must be 2");var _e,pe=(It=oe.bbox||E(oe))[0],me=It[1],Ge=It[2],lt=It[3];ye={scale:[Ge-pe?(Ge-pe)/(_e-1):1,lt-me?(lt-me)/(_e-1):1],translate:[pe,me]}}var It,wt,we=q(ye),yt=oe.objects,Bt={};function Ot(Ut){return we(Ut)}function ze(Ut){var Ft;switch(Ut.type){case"GeometryCollection":Ft={type:"GeometryCollection",geometries:Ut.geometries.map(ze)};break;case"Point":Ft={type:"Point",coordinates:Ot(Ut.coordinates)};break;case"MultiPoint":Ft={type:"MultiPoint",coordinates:Ut.coordinates.map(Ot)};break;default:return Ut}return Ut.id!=null&&(Ft.id=Ut.id),Ut.bbox!=null&&(Ft.bbox=Ut.bbox),Ut.properties!=null&&(Ft.properties=Ut.properties),Ft}for(wt in yt)Bt[wt]=ze(yt[wt]);return{type:"Topology",bbox:It,transform:ye,objects:Bt,arcs:oe.arcs.map(function(Ut){var Ft,pt=0,vt=1,rn=Ut.length,xt=new Array(rn);for(xt[0]=we(Ut[0],0);++pt<rn;)((Ft=we(Ut[pt],pt))[0]||Ft[1])&&(xt[vt++]=Ft);return vt===1&&(xt[vt++]=[0,0]),xt.length=vt,xt})}};r.d(a,!1,function(){return E}),r.d(a,"a",function(){return U}),r.d(a,"b",function(){return W}),r.d(a,!1,function(){return j}),r.d(a,!1,function(){return H}),r.d(a,!1,function(){return I}),r.d(a,!1,function(){return Y}),r.d(a,!1,function(){return ae}),r.d(a,!1,function(){return S}),r.d(a,!1,function(){return q})},function(s,a,r){(function(c,S){function E(){return typeof c=="object"&&s!==void 0&&S!==void 0&&!!S.version}r.d(a,"a",function(){return E})}).call(this,r(59),r(75))},function(s,a,r){(function(c){r.d(a,"a",function(){return A});var S=r(5),E=r(131);function A(){var U=c.Canvas||c.HTMLCanvasElement,B=c.Image||c.HTMLImageElement,D=c.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},R=Object(E.a)();return Object(S.a)({Canvas:U||function(){return function(){}}(),CanvasRenderingContext2D:c.CanvasRenderingContext2D||function(){return function(){}}(),Image:B||function(){return function(){}}(),ImageData:c.ImageData||function(){return function(){}}(),Video:c.HTMLVideoElement||function(){return function(){}}(),createCanvasElement:function(){if(U)return new U;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(B)return new B;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:D},R)}}).call(this,r(59))},function(s,a,r){const c=r(90);s.exports={re:c.re,src:c.src,tokens:c.t,SEMVER_SPEC_VERSION:r(117).SEMVER_SPEC_VERSION,SemVer:r(32),compareIdentifiers:r(146).compareIdentifiers,rcompareIdentifiers:r(146).rcompareIdentifiers,parse:r(89),valid:r(348),clean:r(347),inc:r(346),diff:r(345),major:r(344),minor:r(343),patch:r(342),prerelease:r(341),compare:r(48),rcompare:r(340),compareLoose:r(339),compareBuild:r(144),sort:r(338),rsort:r(337),gt:r(114),lt:r(143),eq:r(145),neq:r(204),gte:r(142),lte:r(141),cmp:r(203),coerce:r(336),Comparator:r(113),Range:r(47),satisfies:r(112),toComparators:r(332),maxSatisfying:r(331),minSatisfying:r(330),minVersion:r(329),validRange:r(328),outside:r(140),gtr:r(327),ltr:r(326),intersects:r(325),simplifyRange:r(324),subset:r(323)}},function(s,a,r){var c=r(31),S=r(12),E=Object(c.a)(function(A){A.setUTCSeconds(0,0)},function(A,U){A.setTime(+A+U*S.c)},function(A,U){return(U-A)/S.c},function(A){return A.getUTCMinutes()});a.a=E,E.range},function(s,a,r){var c=r(31),S=r(12),E=Object(c.a)(function(A){A.setUTCMinutes(0,0,0)},function(A,U){A.setTime(+A+U*S.b)},function(A,U){return(U-A)/S.b},function(A){return A.getUTCHours()});a.a=E,E.range},function(s,a,r){var c=r(31),S=Object(c.a)(function(){},function(E,A){E.setTime(+E+A)},function(E,A){return A-E});S.every=function(E){return E=Math.floor(E),isFinite(E)&&E>0?E>1?Object(c.a)(function(A){A.setTime(Math.floor(A/E)*E)},function(A,U){A.setTime(+A+U*E)},function(A,U){return(U-A)/E}):S:null},a.a=S,S.range},function(s,a,r){var c=r(31),S=r(12),E=Object(c.a)(function(A){A.setTime(A-A.getMilliseconds()-A.getSeconds()*S.e)},function(A,U){A.setTime(+A+U*S.c)},function(A,U){return(U-A)/S.c},function(A){return A.getMinutes()});a.a=E,E.range},function(s,a,r){var c=r(31),S=r(12),E=Object(c.a)(function(A){A.setTime(A-A.getMilliseconds()-A.getSeconds()*S.e-A.getMinutes()*S.c)},function(A,U){A.setTime(+A+U*S.b)},function(A,U){return(U-A)/S.b},function(A){return A.getHours()});a.a=E,E.range},function(s,a){},function(s,a){s.exports=function(r,c){(c==null||c>r.length)&&(c=r.length);for(var S=0,E=new Array(c);S<c;S++)E[S]=r[S];return E},s.exports.__esModule=!0,s.exports.default=s.exports},function(s,a,r){var c=r(186);s.exports=function(S,E){if(S){if(typeof S=="string")return c(S,E);var A=Object.prototype.toString.call(S).slice(8,-1);return A==="Object"&&S.constructor&&(A=S.constructor.name),A==="Map"||A==="Set"?Array.from(S):A==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(A)?c(S,E):void 0}},s.exports.__esModule=!0,s.exports.default=s.exports},function(s,a,r){function c(S){this.message=S}c.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},c.prototype.__CANCEL__=!0,s.exports=c},function(s,a,r){var c=r(36);s.exports=function(S,E){E=E||{};var A={},U=["url","method","data"],B=["headers","auth","proxy","params"],D=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],R=["validateStatus"];function W(Q,Y){return c.isPlainObject(Q)&&c.isPlainObject(Y)?c.merge(Q,Y):c.isPlainObject(Y)?c.merge({},Y):c.isArray(Y)?Y.slice():Y}function j(Q){c.isUndefined(E[Q])?c.isUndefined(S[Q])||(A[Q]=W(void 0,S[Q])):A[Q]=W(S[Q],E[Q])}c.forEach(U,function(Q){c.isUndefined(E[Q])||(A[Q]=W(void 0,E[Q]))}),c.forEach(B,j),c.forEach(D,function(Q){c.isUndefined(E[Q])?c.isUndefined(S[Q])||(A[Q]=W(void 0,S[Q])):A[Q]=W(void 0,E[Q])}),c.forEach(R,function(Q){Q in E?A[Q]=W(S[Q],E[Q]):Q in S&&(A[Q]=W(void 0,S[Q]))});var H=U.concat(B).concat(D).concat(R),I=Object.keys(S).concat(Object.keys(E)).filter(function(Q){return H.indexOf(Q)===-1});return c.forEach(I,j),A}},function(s,a,r){s.exports=function(c){return!(!c||!c.__CANCEL__)}},function(s,a,r){var c=r(193);s.exports=function(S,E,A,U,B){var D=new Error(S);return c(D,E,A,U,B)}},function(s,a,r){var c=r(36),S=r(274),E=r(273),A=r(194),U=r(272),B=r(269),D=r(268),R=r(191);s.exports=function(W){return new Promise(function(j,H){var I=W.data,Q=W.headers,Y=W.responseType;c.isFormData(I)&&delete Q["Content-Type"];var q=new XMLHttpRequest;if(W.auth){var ae=W.auth.username||"",oe=W.auth.password?unescape(encodeURIComponent(W.auth.password)):"";Q.Authorization="Basic "+btoa(ae+":"+oe)}var ye=U(W.baseURL,W.url);function _e(){if(q){var me="getAllResponseHeaders"in q?B(q.getAllResponseHeaders()):null,Ge={data:Y&&Y!=="text"&&Y!=="json"?q.response:q.responseText,status:q.status,statusText:q.statusText,headers:me,config:W,request:q};S(j,H,Ge),q=null}}if(q.open(W.method.toUpperCase(),A(ye,W.params,W.paramsSerializer),!0),q.timeout=W.timeout,"onloadend"in q?q.onloadend=_e:q.onreadystatechange=function(){q&&q.readyState===4&&(q.status!==0||q.responseURL&&q.responseURL.indexOf("file:")===0)&&setTimeout(_e)},q.onabort=function(){q&&(H(R("Request aborted",W,"ECONNABORTED",q)),q=null)},q.onerror=function(){H(R("Network Error",W,null,q)),q=null},q.ontimeout=function(){var me="timeout of "+W.timeout+"ms exceeded";W.timeoutErrorMessage&&(me=W.timeoutErrorMessage),H(R(me,W,W.transitional&&W.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",q)),q=null},c.isStandardBrowserEnv()){var pe=(W.withCredentials||D(ye))&&W.xsrfCookieName?E.read(W.xsrfCookieName):void 0;pe&&(Q[W.xsrfHeaderName]=pe)}"setRequestHeader"in q&&c.forEach(Q,function(me,Ge){I===void 0&&Ge.toLowerCase()==="content-type"?delete Q[Ge]:q.setRequestHeader(Ge,me)}),c.isUndefined(W.withCredentials)||(q.withCredentials=!!W.withCredentials),Y&&Y!=="json"&&(q.responseType=W.responseType),typeof W.onDownloadProgress=="function"&&q.addEventListener("progress",W.onDownloadProgress),typeof W.onUploadProgress=="function"&&q.upload&&q.upload.addEventListener("progress",W.onUploadProgress),W.cancelToken&&W.cancelToken.promise.then(function(me){q&&(q.abort(),H(me),q=null)}),I||(I=null),q.send(I)})}},function(s,a,r){s.exports=function(c,S,E,A,U){return c.config=S,E&&(c.code=E),c.request=A,c.response=U,c.isAxiosError=!0,c.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},c}},function(s,a,r){var c=r(36);function S(E){return encodeURIComponent(E).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}s.exports=function(E,A,U){if(!A)return E;var B;if(U)B=U(A);else if(c.isURLSearchParams(A))B=A.toString();else{var D=[];c.forEach(A,function(W,j){W!=null&&(c.isArray(W)?j+="[]":W=[W],c.forEach(W,function(H){c.isDate(H)?H=H.toISOString():c.isObject(H)&&(H=JSON.stringify(H)),D.push(S(j)+"="+S(H))}))}),B=D.join("&")}if(B){var R=E.indexOf("#");R!==-1&&(E=E.slice(0,R)),E+=(E.indexOf("?")===-1?"?":"&")+B}return E}},function(s,a,r){s.exports=function(c,S){return function(){for(var E=new Array(arguments.length),A=0;A<E.length;A++)E[A]=arguments[A];return c.apply(S,E)}}},function(s,a,r){var c=this&&this.__awaiter||function(R,W,j,H){return new(j||(j=Promise))(function(I,Q){function Y(oe){try{ae(H.next(oe))}catch(ye){Q(ye)}}function q(oe){try{ae(H.throw(oe))}catch(ye){Q(ye)}}function ae(oe){oe.done?I(oe.value):new j(function(ye){ye(oe.value)}).then(Y,q)}ae((H=H.apply(R,W||[])).next())})},S=this&&this.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};Object.defineProperty(a,"__esModule",{value:!0});const E=S(r(88)),A=r(64),U=r(111),B=r(46);a.linechart=function(R,W,j={}){return c(this,void 0,void 0,function*(){const H=Array.isArray(W.values[0])?W.values:[W.values],I=H[0].length,Q=W.series?W.series:H.map((pe,me)=>`Series ${me+1}`);U.assert(Q.length===H.length,"Must have an equal number of series labels as there are data series"),j.seriesColors!=null&&U.assert(j.seriesColors.length===H.length,"Must have an equal number of series colors as there are data series");const Y=[];for(let pe=0;pe<I;pe++){const me={x:pe};Q.forEach((Ge,lt)=>{const It=H[lt][pe].y;me[Ge]=It,me[`${Ge}-name`]=Ge}),Y.push(me)}const q=Object.assign({},D,j),ae={x:{field:"x",type:q.xType,title:q.xLabel},tooltip:[{field:"x",type:"quantitative"},...Q.map(pe=>({field:pe,type:"quantitative"}))]},oe=Q.map(pe=>({data:void 0,mark:{type:"line",clip:!0},encoding:{y:{field:pe,type:q.yType,title:q.yLabel,scale:q.zoomToFit?{zero:!1}:q.yAxisDomain!=null?{domain:q.yAxisDomain}:void 0},color:{field:`${pe}-name`,type:"nominal",legend:{values:Q,title:null},scale:{range:q.seriesColors}}}})),ye=B.getDrawArea(R),_e={width:q.width||A.getDefaultWidth(ye),height:q.height||A.getDefaultHeight(ye),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:q.fontSize,titleFontSize:q.fontSize},text:{fontSize:q.fontSize},legend:{labelFontSize:q.fontSize,titleFontSize:q.fontSize}},data:{values:Y},encoding:ae,layer:[...oe,{mark:"rule",selection:{hover:{type:"single",on:"mouseover",nearest:!0,clear:"mouseout"}},encoding:{color:{value:"grey",condition:{selection:{not:"hover"},value:"transparent"}}}}]};return yield E.default(ye,_e,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()})};const D={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});const c=r(292);let S;const E="Visor",A="tfjs-visor-container";a.visor=function(){if(typeof document>"u")throw new Error("No document defined. This library needs a browser/dom to work");if(document.getElementById(A)&&S!=null)return S;let B,D=document.getElementById(A);function R(H,I){let Q=null;return B=c.VisorComponent.render(H,B,{ref:Y=>Q=Y,surfaceList:Array.from(I.values())}),Q}D==null&&((D=document.createElement("div")).id=A,document.body.appendChild(D));const W=new Map,j=R(D,W);return S=new U(j,D,W,R)};class U{constructor(D,R,W,j){this.visorComponent=D,this.el=R,this.surfaceList=W,this.renderVisor=j}surface(D){const{name:R}=D,W=D.tab==null?E:D.tab;if(R==null||!(typeof R=="string"||R instanceof String))throw new Error("You must pass a config object with a 'name' property to create or retrieve a surface");const j=Object.assign({},D,{tab:W}),H=`${R}-${W}`;return this.surfaceList.has(H)||this.surfaceList.set(H,j),this.renderVisor(this.el,this.surfaceList),this.visorComponent.getSurface(R,W)}isFullscreen(){return this.visorComponent.isFullscreen()}isOpen(){return this.visorComponent.isOpen()}close(){return this.visorComponent.close()}open(){return this.visorComponent.open()}toggle(){return this.visorComponent.toggle()}toggleFullScreen(){return this.visorComponent.toggleFullScreen()}bindKeys(){return this.visorComponent.bindKeys()}unbindKeys(){return this.visorComponent.unbindKeys()}setActiveTab(D){if(!this.visorComponent.state.tabs.has(D))throw new Error(`Tab '${D}' does not exist`);this.visorComponent.setState({activeTab:D})}}a.Visor=U},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.isSurfaceInfo=function(c){return c.name!=null},a.isSurface=function(c){return c.drawArea instanceof HTMLElement}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(c){return c.charAt(0).toUpperCase()+c.slice(1)},s.exports=a.default},function(s,a,r){var c=r(315);s.exports=c},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.processStyleName=void 0,a.createMarkupForStyles=function(B,D){var R="";for(var W in B){var j=W.indexOf("--")===0;if(B.hasOwnProperty(W)&&W!=="label"){var H=B[W];H!=null&&(j?R+=W+":"+H+";":(R+=U(W)+":",R+=(0,c.default)(W,H,D)+";"))}}return R||null},A(r(319));var c=A(r(317)),S=A(r(314)),E=A(r(312));A(r(200));function A(B){return B&&B.__esModule?B:{default:B}}var U=a.processStyleName=(0,E.default)(S.default)},function(s,a,r){r.r(a),r.d(a,"default",function(){return A}),r.d(a,"point",function(){return U});var c=r(null),S=r(null),E=r(null);function A(){var B,D,R=Object(E.a)().unknown(void 0),W=R.domain,j=R.range,H=0,I=1,Q=!1,Y=0,q=0,ae=.5;function oe(){var ye=W().length,_e=I<H,pe=_e?I:H,me=_e?H:I;B=(me-pe)/Math.max(1,ye-Y+2*q),Q&&(B=Math.floor(B)),pe+=(me-pe-B*(ye-Y))*ae,D=B*(1-Y),Q&&(pe=Math.round(pe),D=Math.round(D));var Ge=Object(c.a)(ye).map(function(lt){return pe+B*lt});return j(_e?Ge.reverse():Ge)}return delete R.unknown,R.domain=function(ye){return arguments.length?(W(ye),oe()):W()},R.range=function(ye){return arguments.length?([H,I]=ye,H=+H,I=+I,oe()):[H,I]},R.rangeRound=function(ye){return[H,I]=ye,H=+H,I=+I,Q=!0,oe()},R.bandwidth=function(){return D},R.step=function(){return B},R.round=function(ye){return arguments.length?(Q=!!ye,oe()):Q},R.padding=function(ye){return arguments.length?(Y=Math.min(1,q=+ye),oe()):Y},R.paddingInner=function(ye){return arguments.length?(Y=Math.min(1,ye),oe()):Y},R.paddingOuter=function(ye){return arguments.length?(q=+ye,oe()):q},R.align=function(ye){return arguments.length?(ae=Math.max(0,Math.min(1,ye)),oe()):ae},R.copy=function(){return A(W(),[H,I]).round(Q).paddingInner(Y).paddingOuter(q).align(ae)},S.a.apply(oe(),arguments)}function U(){return function B(D){var R=D.copy;return D.padding=D.paddingOuter,delete D.paddingInner,delete D.paddingOuter,D.copy=function(){return B(R())},D}(A.apply(null,arguments).paddingInner(1))}},function(s,a,r){const c=r(145),S=r(204),E=r(114),A=r(142),U=r(143),B=r(141);s.exports=(D,R,W,j)=>{switch(R){case"===":return typeof D=="object"&&(D=D.version),typeof W=="object"&&(W=W.version),D===W;case"!==":return typeof D=="object"&&(D=D.version),typeof W=="object"&&(W=W.version),D!==W;case"":case"=":case"==":return c(D,W,j);case"!=":return S(D,W,j);case">":return E(D,W,j);case">=":return A(D,W,j);case"<":return U(D,W,j);case"<=":return B(D,W,j);default:throw new TypeError(`Invalid operator: ${R}`)}}},function(s,a,r){const c=r(48);s.exports=(S,E,A)=>c(S,E,A)!==0},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(25),S=r(73),E=r(74),A=r(29),U=r(374),B=r(28);a.div=B.op({div_:function(D,R){var W,j=A.convertToTensor(D,"a","div"),H=A.convertToTensor(R,"b","div");if(W=E.makeTypesMatch(j,H),j=W[0],H=W[1],j.dtype==="int32"&&H.dtype==="int32")return U.floorDiv(j,H);var I={a:j,b:H};return c.ENGINE.runKernelFunc(function(Q,Y){var q=Q.realDivide(j,H);return Y([j,H]),q},I,null,S.Div,{})}})},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(25),S=r(73),E=r(74),A=r(29),U=r(28);a.add=U.op({add_:function(B,D){var R,W=A.convertToTensor(B,"a","add"),j=A.convertToTensor(D,"b","add");R=E.makeTypesMatch(W,j),W=R[0],j=R[1];var H={a:W,b:j};return c.ENGINE.runKernelFunc(function(I,Q){var Y=I.add(W,j);return Q([W,j]),Y},H,null,S.Add)}})},function(s,a,r){(function(c){var S=c!==void 0&&c||typeof self<"u"&&self||window,E=Function.prototype.apply;function A(U,B){this._id=U,this._clearFn=B}a.setTimeout=function(){return new A(E.call(setTimeout,S,arguments),clearTimeout)},a.setInterval=function(){return new A(E.call(setInterval,S,arguments),clearInterval)},a.clearTimeout=a.clearInterval=function(U){U&&U.close()},A.prototype.unref=A.prototype.ref=function(){},A.prototype.close=function(){this._clearFn.call(S,this._id)},a.enroll=function(U,B){clearTimeout(U._idleTimeoutId),U._idleTimeout=B},a.unenroll=function(U){clearTimeout(U._idleTimeoutId),U._idleTimeout=-1},a._unrefActive=a.active=function(U){clearTimeout(U._idleTimeoutId);var B=U._idleTimeout;B>=0&&(U._idleTimeoutId=setTimeout(function(){U._onTimeout&&U._onTimeout()},B))},r(391),a.setImmediate=typeof self<"u"&&self.setImmediate||c!==void 0&&c.setImmediate||this&&this.setImmediate,a.clearImmediate=typeof self<"u"&&self.clearImmediate||c!==void 0&&c.clearImmediate||this&&this.clearImmediate}).call(this,r(59))},function(s,a){s.exports=function(r){try{return!!r()}catch{return!0}}},function(s,a){var r=s.exports={version:"2.6.12"};typeof __e=="number"&&(__e=r)},function(s,a,r){var c=r(27),S=r(82),E=r(41),A=r(106).f;s.exports=function(U){return function(B){for(var D,R=E(B),W=S(R),j=W.length,H=0,I=[];j>H;)D=W[H++],c&&!A.call(R,D)||I.push(U?[D,R[D]]:R[D]);return I}}},function(s,a,r){var c=r(22),S=r(167),E=r(61);s.exports=function(A,U,B,D){var R=String(E(A)),W=R.length,j=B===void 0?" ":String(B),H=c(U);if(H<=W||j=="")return R;var I=H-W,Q=S.call(j,Math.ceil(I/j.length));return Q.length>I&&(Q=Q.slice(0,I)),D?Q+R:R+Q}},function(s,a,r){var c=r(79),S=r(127),E=r(14),A=r(16).Reflect;s.exports=A&&A.ownKeys||function(U){var B=c.f(E(U)),D=S.f;return D?B.concat(D(U)):B}},function(s,a,r){var c=r(54),S=r(22);s.exports=function(E){if(E===void 0)return 0;var A=c(E),U=S(A);if(A!==U)throw RangeError("Wrong length!");return U}},function(s,a,r){var c=r(93),S=r(65).getWeak,E=r(14),A=r(13),U=r(94),B=r(121),D=r(51),R=r(43),W=r(76),j=D(5),H=D(6),I=0,Q=function(ae){return ae._l||(ae._l=new Y)},Y=function(){this.a=[]},q=function(ae,oe){return j(ae.a,function(ye){return ye[0]===oe})};Y.prototype={get:function(ae){var oe=q(this,ae);if(oe)return oe[1]},has:function(ae){return!!q(this,ae)},set:function(ae,oe){var ye=q(this,ae);ye?ye[1]=oe:this.a.push([ae,oe])},delete:function(ae){var oe=H(this.a,function(ye){return ye[0]===ae});return~oe&&this.a.splice(oe,1),!!~oe}},s.exports={getConstructor:function(ae,oe,ye,_e){var pe=ae(function(me,Ge){U(me,pe,oe,"_i"),me._t=oe,me._i=I++,me._l=void 0,Ge!=null&&B(Ge,ye,me[_e],me)});return c(pe.prototype,{delete:function(me){if(!A(me))return!1;var Ge=S(me);return Ge===!0?Q(W(this,oe)).delete(me):Ge&&R(Ge,this._i)&&delete Ge[this._i]},has:function(me){if(!A(me))return!1;var Ge=S(me);return Ge===!0?Q(W(this,oe)).has(me):Ge&&R(Ge,this._i)}}),pe},def:function(ae,oe,ye){var _e=S(E(oe),!0);return _e===!0?Q(ae).set(oe,ye):_e[ae._i]=ye,ae},ufstore:Q}},function(s,a,r){var c=r(26).f,S=r(80),E=r(93),A=r(56),U=r(94),B=r(121),D=r(163),R=r(221),W=r(95),j=r(27),H=r(65).fastKey,I=r(76),Q=j?"_s":"size",Y=function(q,ae){var oe,ye=H(ae);if(ye!=="F")return q._i[ye];for(oe=q._f;oe;oe=oe.n)if(oe.k==ae)return oe};s.exports={getConstructor:function(q,ae,oe,ye){var _e=q(function(pe,me){U(pe,_e,ae,"_i"),pe._t=ae,pe._i=S(null),pe._f=void 0,pe._l=void 0,pe[Q]=0,me!=null&&B(me,oe,pe[ye],pe)});return E(_e.prototype,{clear:function(){for(var pe=I(this,ae),me=pe._i,Ge=pe._f;Ge;Ge=Ge.n)Ge.r=!0,Ge.p&&(Ge.p=Ge.p.n=void 0),delete me[Ge.i];pe._f=pe._l=void 0,pe[Q]=0},delete:function(pe){var me=I(this,ae),Ge=Y(me,pe);if(Ge){var lt=Ge.n,It=Ge.p;delete me._i[Ge.i],Ge.r=!0,It&&(It.n=lt),lt&&(lt.p=It),me._f==Ge&&(me._f=lt),me._l==Ge&&(me._l=It),me[Q]--}return!!Ge},forEach:function(pe){I(this,ae);for(var me,Ge=A(pe,arguments.length>1?arguments[1]:void 0,3);me=me?me.n:this._f;)for(Ge(me.v,me.k,this);me&&me.r;)me=me.p},has:function(pe){return!!Y(I(this,ae),pe)}}),j&&c(_e.prototype,"size",{get:function(){return I(this,ae)[Q]}}),_e},def:function(q,ae,oe){var ye,_e,pe=Y(q,ae);return pe?pe.v=oe:(q._l=pe={i:_e=H(ae,!0),k:ae,v:oe,p:ye=q._l,n:void 0,r:!1},q._f||(q._f=pe),ye&&(ye.n=pe),q[Q]++,_e!=="F"&&(q._i[_e]=pe)),q},getEntry:Y,setStrong:function(q,ae,oe){D(q,ae,function(ye,_e){this._t=I(ye,ae),this._k=_e,this._l=void 0},function(){for(var ye=this._k,_e=this._l;_e&&_e.r;)_e=_e.p;return this._t&&(this._l=_e=_e?_e.n:this._t._f)?R(0,ye=="keys"?_e.k:ye=="values"?_e.v:[_e.k,_e.v]):(this._t=void 0,R(1))},oe?"entries":"values",!oe,!0),W(ae)}}},function(s,a,r){var c=r(14),S=r(13),E=r(217);s.exports=function(A,U){if(c(A),S(U)&&U.constructor===A)return U;var B=E.f(A);return(0,B.resolve)(U),B.promise}},function(s,a,r){var c=r(55);s.exports.f=function(S){return new function(E){var A,U;this.promise=new E(function(B,D){if(A!==void 0||U!==void 0)throw TypeError("Bad Promise constructor");A=B,U=D}),this.resolve=c(A),this.reject=c(U)}(S)}},function(s,a,r){var c,S,E,A,U=r(83),B=r(16),D=r(56),R=r(105),W=r(8),j=r(13),H=r(55),I=r(94),Q=r(121),Y=r(104),q=r(152).set,ae=r(466)(),oe=r(217),ye=r(465),_e=r(120),pe=r(216),me=B.TypeError,Ge=B.process,lt=Ge&&Ge.versions,It=lt&&lt.v8||"",wt=B.Promise,we=R(Ge)=="process",yt=function(){},Bt=S=oe.f,Ot=!!function(){try{var _t=wt.resolve(1),Xt=(_t.constructor={})[r(19)("species")]=function(sn){sn(yt,yt)};return(we||typeof PromiseRejectionEvent=="function")&&_t.then(yt)instanceof Xt&&It.indexOf("6.6")!==0&&_e.indexOf("Chrome/66")===-1}catch{}}(),ze=function(_t){var Xt;return!(!j(_t)||typeof(Xt=_t.then)!="function")&&Xt},Ut=function(_t,Xt){if(!_t._n){_t._n=!0;var sn=_t._c;ae(function(){for(var kn=_t._v,an=_t._s==1,Ve=0,Ye=function($e){var ft,$t,Jt,Pn=an?$e.ok:$e.fail,An=$e.resolve,Qn=$e.reject,Ce=$e.domain;try{Pn?(an||(_t._h==2&&vt(_t),_t._h=1),Pn===!0?ft=kn:(Ce&&Ce.enter(),ft=Pn(kn),Ce&&(Ce.exit(),Jt=!0)),ft===$e.promise?Qn(me("Promise-chain cycle")):($t=ze(ft))?$t.call(ft,An,Qn):An(ft)):Qn(kn)}catch(sr){Ce&&!Jt&&Ce.exit(),Qn(sr)}};sn.length>Ve;)Ye(sn[Ve++]);_t._c=[],_t._n=!1,Xt&&!_t._h&&Ft(_t)})}},Ft=function(_t){q.call(B,function(){var Xt,sn,kn,an=_t._v,Ve=pt(_t);if(Ve&&(Xt=ye(function(){we?Ge.emit("unhandledRejection",an,_t):(sn=B.onunhandledrejection)?sn({promise:_t,reason:an}):(kn=B.console)&&kn.error&&kn.error("Unhandled promise rejection",an)}),_t._h=we||pt(_t)?2:1),_t._a=void 0,Ve&&Xt.e)throw Xt.v})},pt=function(_t){return _t._h!==1&&(_t._a||_t._c).length===0},vt=function(_t){q.call(B,function(){var Xt;we?Ge.emit("rejectionHandled",_t):(Xt=B.onrejectionhandled)&&Xt({promise:_t,reason:_t._v})})},rn=function(_t){var Xt=this;Xt._d||(Xt._d=!0,(Xt=Xt._w||Xt)._v=_t,Xt._s=2,Xt._a||(Xt._a=Xt._c.slice()),Ut(Xt,!0))},xt=function(_t){var Xt,sn=this;if(!sn._d){sn._d=!0,sn=sn._w||sn;try{if(sn===_t)throw me("Promise can't be resolved itself");(Xt=ze(_t))?ae(function(){var kn={_w:sn,_d:!1};try{Xt.call(_t,D(xt,kn,1),D(rn,kn,1))}catch(an){rn.call(kn,an)}}):(sn._v=_t,sn._s=1,Ut(sn,!1))}catch(kn){rn.call({_w:sn,_d:!1},kn)}}};Ot||(wt=function(_t){I(this,wt,"Promise","_h"),H(_t),c.call(this);try{_t(D(xt,this,1),D(rn,this,1))}catch(Xt){rn.call(this,Xt)}},(c=function(_t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(93)(wt.prototype,{then:function(_t,Xt){var sn=Bt(Y(this,wt));return sn.ok=typeof _t!="function"||_t,sn.fail=typeof Xt=="function"&&Xt,sn.domain=we?Ge.domain:void 0,this._c.push(sn),this._a&&this._a.push(sn),this._s&&Ut(this,!1),sn.promise},catch:function(_t){return this.then(void 0,_t)}}),E=function(){var _t=new c;this.promise=_t,this.resolve=D(xt,_t,1),this.reject=D(rn,_t,1)},oe.f=Bt=function(_t){return _t===wt||_t===A?new E(_t):S(_t)}),W(W.G+W.W+W.F*!Ot,{Promise:wt}),r(98)(wt,"Promise"),r(95)("Promise"),A=r(24).Promise,W(W.S+W.F*!Ot,"Promise",{reject:function(_t){var Xt=Bt(this);return(0,Xt.reject)(_t),Xt.promise}}),W(W.S+W.F*(U||!Ot),"Promise",{resolve:function(_t){return pe(U&&this===A?wt:this,_t)}}),W(W.S+W.F*!(Ot&&r(125)(function(_t){wt.all(_t).catch(yt)})),"Promise",{all:function(_t){var Xt=this,sn=Bt(Xt),kn=sn.resolve,an=sn.reject,Ve=ye(function(){var Ye=[],$e=0,ft=1;Q(_t,!1,function($t){var Jt=$e++,Pn=!1;Ye.push(void 0),ft++,Xt.resolve($t).then(function(An){Pn||(Pn=!0,Ye[Jt]=An,--ft||kn(Ye))},an)}),--ft||kn(Ye)});return Ve.e&&an(Ve.v),sn.promise},race:function(_t){var Xt=this,sn=Bt(Xt),kn=sn.reject,an=ye(function(){Q(_t,!1,function(Ve){Xt.resolve(Ve).then(sn.resolve,kn)})});return an.e&&kn(an.v),sn.promise}})},function(s,a,r){r(27)&&/./g.flags!="g"&&r(26).f(RegExp.prototype,"flags",{configurable:!0,get:r(124)})},function(s,a,r){var c=r(154);r(8)({target:"RegExp",proto:!0,forced:c!==/./.exec},{exec:c})},function(s,a){s.exports=function(r,c){return{value:c,done:!!r}}},function(s,a,r){var c=r(34),S=r(81),E=r(22);s.exports=[].copyWithin||function(A,U){var B=c(this),D=E(B.length),R=S(A,D),W=S(U,D),j=arguments.length>2?arguments[2]:void 0,H=Math.min((j===void 0?D:S(j,D))-W,D-R),I=1;for(W<R&&R<W+H&&(I=-1,W+=H-1,R+=H-1);H-- >0;)W in B?B[R]=B[W]:delete B[R],R+=I,W+=I;return B}},function(s,a,r){var c=r(55),S=r(34),E=r(107),A=r(22);s.exports=function(U,B,D,R,W){c(B);var j=S(U),H=E(j),I=A(j.length),Q=W?I-1:0,Y=W?-1:1;if(D<2)for(;;){if(Q in H){R=H[Q],Q+=Y;break}if(Q+=Y,W?Q<0:I<=Q)throw TypeError("Reduce of empty array with no initial value")}for(;W?Q>=0:I>Q;Q+=Y)Q in H&&(R=B(R,H[Q],Q,j));return R}},function(s,a,r){var c=r(486);s.exports=function(S,E){return new(c(S))(E)}},function(s,a,r){var c=r(14);s.exports=function(S,E,A,U){try{return U?E(c(A)[0],A[1]):E(A)}catch(D){var B=S.return;throw B!==void 0&&c(B.call(S)),D}}},function(s,a,r){var c=r(80),S=r(85),E=r(98),A={};r(42)(A,r(19)("iterator"),function(){return this}),s.exports=function(U,B,D){U.prototype=c(A,{next:S(1,D)}),E(U,B+" Iterator")}},function(s,a){s.exports=Math.log1p||function(r){return(r=+r)>-1e-8&&r<1e-8?r-r*r/2:Math.log(1+r)}},function(s,a,r){var c=r(13),S=Math.floor;s.exports=function(E){return!c(E)&&isFinite(E)&&S(E)===E}},function(s,a,r){var c=r(62);s.exports=function(S,E){if(typeof S!="number"&&c(S)!="Number")throw TypeError(E);return+S}},function(s,a,r){var c=r(16).parseFloat,S=r(97).trim;s.exports=1/c(r(169)+"-0")!=-1/0?function(E){var A=S(String(E),3),U=c(A);return U===0&&A.charAt(0)=="-"?-0:U}:c},function(s,a,r){var c=r(16).parseInt,S=r(97).trim,E=r(169),A=/^[-+]?0[xX]/;s.exports=c(E+"08")!==8||c(E+"0x16")!==22?function(U,B){var D=S(String(U),3);return c(D,B>>>0||(A.test(D)?16:10))}:c},function(s,a){s.exports=function(r,c,S){var E=S===void 0;switch(c.length){case 0:return E?r():r.call(S);case 1:return E?r(c[0]):r.call(S,c[0]);case 2:return E?r(c[0],c[1]):r.call(S,c[0],c[1]);case 3:return E?r(c[0],c[1],c[2]):r.call(S,c[0],c[1],c[2]);case 4:return E?r(c[0],c[1],c[2],c[3]):r.call(S,c[0],c[1],c[2],c[3])}return r.apply(S,c)}},function(s,a,r){var c=r(55),S=r(13),E=r(232),A=[].slice,U={};s.exports=Function.bind||function(B){var D=c(this),R=A.call(arguments,1),W=function(){var j=R.concat(A.call(arguments));return this instanceof W?function(H,I,Q){if(!(I in U)){for(var Y=[],q=0;q<I;q++)Y[q]="a["+q+"]";U[I]=Function("F,a","return new F("+Y.join(",")+")")}return U[I](H,Q)}(D,j.length,j):E(D,j,B)};return S(D.prototype)&&(W.prototype=D.prototype),W}},function(s,a){s.exports=Object.is||function(r,c){return r===c?r!==0||1/r==1/c:r!=r&&c!=c}},function(s,a,r){var c=r(27),S=r(82),E=r(127),A=r(106),U=r(34),B=r(107),D=Object.assign;s.exports=!D||r(15)(function(){var R={},W={},j=Symbol(),H="abcdefghijklmnopqrst";return R[j]=7,H.split("").forEach(function(I){W[I]=I}),D({},R)[j]!=7||Object.keys(D({},W)).join("")!=H})?function(R,W){for(var j=U(R),H=arguments.length,I=1,Q=E.f,Y=A.f;H>I;)for(var q,ae=B(arguments[I++]),oe=Q?S(ae).concat(Q(ae)):S(ae),ye=oe.length,_e=0;ye>_e;)q=oe[_e++],c&&!Y.call(ae,q)||(j[q]=ae[q]);return j}:D},function(s,a,r){var c=r(41),S=r(79).f,E={}.toString,A=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];s.exports.f=function(U){return A&&E.call(U)=="[object Window]"?function(B){try{return S(B)}catch{return A.slice()}}(U):S(c(U))}},function(s,a,r){var c=r(26),S=r(14),E=r(82);s.exports=r(27)?Object.defineProperties:function(A,U){S(A);for(var B,D=E(U),R=D.length,W=0;R>W;)c.f(A,B=D[W++],U[B]);return A}},function(s,a,r){var c=r(43),S=r(41),E=r(128)(!1),A=r(173)("IE_PROTO");s.exports=function(U,B){var D,R=S(U),W=0,j=[];for(D in R)D!=A&&c(R,D)&&j.push(D);for(;B.length>W;)c(R,D=B[W++])&&(~E(j,D)||j.push(D));return j}},function(s,a,r){var c=r(16),S=r(24),E=r(83),A=r(174),U=r(26).f;s.exports=function(B){var D=S.Symbol||(S.Symbol=E?{}:c.Symbol||{});B.charAt(0)=="_"||B in D||U(D,B,{value:A.f(B)})}},function(s,a,r){s.exports=!r(27)&&!r(15)(function(){return Object.defineProperty(r(175)("div"),"a",{get:function(){return 7}}).a!=7})},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(2);a.tf=c,function(S){for(var E in S)a.hasOwnProperty(E)||(a[E]=S[E])}(r(257))},function(s,a,r){(function(c,S,E){const A={1:{name:"/m/01g317",id:1,displayName:"person"},2:{name:"/m/0199g",id:2,displayName:"bicycle"},3:{name:"/m/0k4j",id:3,displayName:"car"},4:{name:"/m/04_sv",id:4,displayName:"motorcycle"},5:{name:"/m/05czz6l",id:5,displayName:"airplane"},6:{name:"/m/01bjv",id:6,displayName:"bus"},7:{name:"/m/07jdr",id:7,displayName:"train"},8:{name:"/m/07r04",id:8,displayName:"truck"},9:{name:"/m/019jd",id:9,displayName:"boat"},10:{name:"/m/015qff",id:10,displayName:"traffic light"},11:{name:"/m/01pns0",id:11,displayName:"fire hydrant"},13:{name:"/m/02pv19",id:13,displayName:"stop sign"},14:{name:"/m/015qbp",id:14,displayName:"parking meter"},15:{name:"/m/0cvnqh",id:15,displayName:"bench"},16:{name:"/m/015p6",id:16,displayName:"bird"},17:{name:"/m/01yrx",id:17,displayName:"cat"},18:{name:"/m/0bt9lr",id:18,displayName:"dog"},19:{name:"/m/03k3r",id:19,displayName:"horse"},20:{name:"/m/07bgp",id:20,displayName:"sheep"},21:{name:"/m/01xq0k1",id:21,displayName:"cow"},22:{name:"/m/0bwd_0j",id:22,displayName:"elephant"},23:{name:"/m/01dws",id:23,displayName:"bear"},24:{name:"/m/0898b",id:24,displayName:"zebra"},25:{name:"/m/03bk1",id:25,displayName:"giraffe"},27:{name:"/m/01940j",id:27,displayName:"backpack"},28:{name:"/m/0hnnb",id:28,displayName:"umbrella"},31:{name:"/m/080hkjn",id:31,displayName:"handbag"},32:{name:"/m/01rkbr",id:32,displayName:"tie"},33:{name:"/m/01s55n",id:33,displayName:"suitcase"},34:{name:"/m/02wmf",id:34,displayName:"frisbee"},35:{name:"/m/071p9",id:35,displayName:"skis"},36:{name:"/m/06__v",id:36,displayName:"snowboard"},37:{name:"/m/018xm",id:37,displayName:"sports ball"},38:{name:"/m/02zt3",id:38,displayName:"kite"},39:{name:"/m/03g8mr",id:39,displayName:"baseball bat"},40:{name:"/m/03grzl",id:40,displayName:"baseball glove"},41:{name:"/m/06_fw",id:41,displayName:"skateboard"},42:{name:"/m/019w40",id:42,displayName:"surfboard"},43:{name:"/m/0dv9c",id:43,displayName:"tennis racket"},44:{name:"/m/04dr76w",id:44,displayName:"bottle"},46:{name:"/m/09tvcd",id:46,displayName:"wine glass"},47:{name:"/m/08gqpm",id:47,displayName:"cup"},48:{name:"/m/0dt3t",id:48,displayName:"fork"},49:{name:"/m/04ctx",id:49,displayName:"knife"},50:{name:"/m/0cmx8",id:50,displayName:"spoon"},51:{name:"/m/04kkgm",id:51,displayName:"bowl"},52:{name:"/m/09qck",id:52,displayName:"banana"},53:{name:"/m/014j1m",id:53,displayName:"apple"},54:{name:"/m/0l515",id:54,displayName:"sandwich"},55:{name:"/m/0cyhj_",id:55,displayName:"orange"},56:{name:"/m/0hkxq",id:56,displayName:"broccoli"},57:{name:"/m/0fj52s",id:57,displayName:"carrot"},58:{name:"/m/01b9xk",id:58,displayName:"hot dog"},59:{name:"/m/0663v",id:59,displayName:"pizza"},60:{name:"/m/0jy4k",id:60,displayName:"donut"},61:{name:"/m/0fszt",id:61,displayName:"cake"},62:{name:"/m/01mzpv",id:62,displayName:"chair"},63:{name:"/m/02crq1",id:63,displayName:"couch"},64:{name:"/m/03fp41",id:64,displayName:"potted plant"},65:{name:"/m/03ssj5",id:65,displayName:"bed"},67:{name:"/m/04bcr3",id:67,displayName:"dining table"},70:{name:"/m/09g1w",id:70,displayName:"toilet"},72:{name:"/m/07c52",id:72,displayName:"tv"},73:{name:"/m/01c648",id:73,displayName:"laptop"},74:{name:"/m/020lf",id:74,displayName:"mouse"},75:{name:"/m/0qjjc",id:75,displayName:"remote"},76:{name:"/m/01m2v",id:76,displayName:"keyboard"},77:{name:"/m/050k8",id:77,displayName:"cell phone"},78:{name:"/m/0fx9l",id:78,displayName:"microwave"},79:{name:"/m/029bxz",id:79,displayName:"oven"},80:{name:"/m/01k6s3",id:80,displayName:"toaster"},81:{name:"/m/0130jx",id:81,displayName:"sink"},82:{name:"/m/040b_t",id:82,displayName:"refrigerator"},84:{name:"/m/0bt_c3",id:84,displayName:"book"},85:{name:"/m/01x3z",id:85,displayName:"clock"},86:{name:"/m/02s195",id:86,displayName:"vase"},87:{name:"/m/01lsmm",id:87,displayName:"scissors"},88:{name:"/m/0kmg4",id:88,displayName:"teddy bear"},89:{name:"/m/03wvsk",id:89,displayName:"hair drier"},90:{name:"/m/012xff",id:90,displayName:"toothbrush"}};class U{constructor(D,R){this.modelPath=R||`https://storage.googleapis.com/tfjs-models/savedmodel/${this.getPrefix(D)}/model.json`}getPrefix(D){return D==="lite_mobilenet_v2"?`ssd${D}`:`ssd_${D}`}async load(){this.model=await S.loadGraphModel(this.modelPath);const D=E.zeros([1,300,300,3],"int32"),R=await this.model.executeAsync(D);await Promise.all(R.map(W=>W.data())),R.map(W=>W.dispose()),D.dispose()}async infer(D,R,W){const j=E.tidy(()=>(D instanceof E.Tensor||(D=E.browser.fromPixels(D)),E.expandDims(D))),H=j.shape[1],I=j.shape[2],Q=await this.model.executeAsync(j),Y=Q[0].dataSync(),q=Q[1].dataSync();j.dispose(),E.dispose(Q);const[ae,oe]=this.calculateMaxScores(Y,Q[0].shape[1],Q[0].shape[2]),ye=E.getBackend();E.getBackend()==="webgl"&&E.setBackend("cpu");const _e=E.tidy(()=>{const me=E.tensor2d(q,[Q[1].shape[1],Q[1].shape[3]]);return E.image.nonMaxSuppression(me,ae,R,W,W)}),pe=_e.dataSync();return _e.dispose(),ye!==E.getBackend()&&E.setBackend(ye),this.buildDetectedObjects(I,H,q,ae,pe,oe)}buildDetectedObjects(D,R,W,j,H,I){const Q=H.length,Y=[];for(let q=0;q<Q;q++){const ae=[];for(let me=0;me<4;me++)ae[me]=W[4*H[q]+me];const oe=ae[0]*R,ye=ae[1]*D,_e=ae[2]*R,pe=ae[3]*D;ae[0]=ye,ae[1]=oe,ae[2]=pe-ye,ae[3]=_e-oe,Y.push({bbox:ae,class:A[I[H[q]]+1].displayName,score:j[H[q]]})}return Y}calculateMaxScores(D,R,W){const j=[],H=[];for(let I=0;I<R;I++){let Q=Number.MIN_VALUE,Y=-1;for(let q=0;q<W;q++)D[I*W+q]>Q&&(Q=D[I*W+q],Y=q);j[I]=Q,H[I]=Y}return[j,H]}async detect(D,R=20,W=.5){return this.infer(D,R,W)}dispose(){this.model!=null&&this.model.dispose()}}c.ObjectDetection=U,c.load=async function(B={}){if(E==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");const D=B.base||"lite_mobilenet_v2",R=B.modelUrl;if(["mobilenet_v1","mobilenet_v2","lite_mobilenet_v2"].indexOf(D)===-1)throw new Error(`ObjectDetection constructed with invalid base model ${D}. Valid names are 'mobilenet_v1', 'mobilenet_v2' and 'lite_mobilenet_v2'.`);const W=new U(D,R);return await W.load(),W},c.version="2.2.2",Object.defineProperty(c,"__esModule",{value:!0})})(a,r(20),r(0))},function(s,a,r){s.exports=function c(S,E){if(S===E)return!0;if(S&&E&&typeof S=="object"&&typeof E=="object"){if(S.constructor!==E.constructor)return!1;var A,U,B;if(Array.isArray(S)){if((A=S.length)!=E.length)return!1;for(U=A;U--!=0;)if(!c(S[U],E[U]))return!1;return!0}if(S.constructor===RegExp)return S.source===E.source&&S.flags===E.flags;if(S.valueOf!==Object.prototype.valueOf)return S.valueOf()===E.valueOf();if(S.toString!==Object.prototype.toString)return S.toString()===E.toString();if((A=(B=Object.keys(S)).length)!==Object.keys(E).length)return!1;for(U=A;U--!=0;)if(!Object.prototype.hasOwnProperty.call(E,B[U]))return!1;for(U=A;U--!=0;){var D=B[U];if(!c(S[D],E[D]))return!1}return!0}return S!=S&&E!=E}},function(s,a,r){(function(c){var S=function(){function E(j,H){return H!=null&&j instanceof H}var A,U,B;try{A=Map}catch{A=function(){}}try{U=Set}catch{U=function(){}}try{B=Promise}catch{B=function(){}}function D(j,H,I,Q,Y){typeof H=="object"&&(I=H.depth,Q=H.prototype,Y=H.includeNonEnumerable,H=H.circular);var q=[],ae=[],oe=c!==void 0;return H===void 0&&(H=!0),I===void 0&&(I=1/0),function ye(_e,pe){if(_e===null)return null;if(pe===0)return _e;var me,Ge;if(typeof _e!="object")return _e;if(E(_e,A))me=new A;else if(E(_e,U))me=new U;else if(E(_e,B))me=new B(function(Ut,Ft){_e.then(function(pt){Ut(ye(pt,pe-1))},function(pt){Ft(ye(pt,pe-1))})});else if(D.__isArray(_e))me=[];else if(D.__isRegExp(_e))me=new RegExp(_e.source,W(_e)),_e.lastIndex&&(me.lastIndex=_e.lastIndex);else if(D.__isDate(_e))me=new Date(_e.getTime());else{if(oe&&c.isBuffer(_e))return me=c.allocUnsafe?c.allocUnsafe(_e.length):new c(_e.length),_e.copy(me),me;E(_e,Error)?me=Object.create(_e):Q===void 0?(Ge=Object.getPrototypeOf(_e),me=Object.create(Ge)):(me=Object.create(Q),Ge=Q)}if(H){var lt=q.indexOf(_e);if(lt!=-1)return ae[lt];q.push(_e),ae.push(me)}for(var It in E(_e,A)&&_e.forEach(function(Ut,Ft){var pt=ye(Ft,pe-1),vt=ye(Ut,pe-1);me.set(pt,vt)}),E(_e,U)&&_e.forEach(function(Ut){var Ft=ye(Ut,pe-1);me.add(Ft)}),_e){var wt;Ge&&(wt=Object.getOwnPropertyDescriptor(Ge,It)),wt&&wt.set==null||(me[It]=ye(_e[It],pe-1))}if(Object.getOwnPropertySymbols){var we=Object.getOwnPropertySymbols(_e);for(It=0;It<we.length;It++){var yt=we[It];(!(Ot=Object.getOwnPropertyDescriptor(_e,yt))||Ot.enumerable||Y)&&(me[yt]=ye(_e[yt],pe-1),Ot.enumerable||Object.defineProperty(me,yt,{enumerable:!1}))}}if(Y){var Bt=Object.getOwnPropertyNames(_e);for(It=0;It<Bt.length;It++){var Ot,ze=Bt[It];(Ot=Object.getOwnPropertyDescriptor(_e,ze))&&Ot.enumerable||(me[ze]=ye(_e[ze],pe-1),Object.defineProperty(me,ze,{enumerable:!1}))}}return me}(j,I)}function R(j){return Object.prototype.toString.call(j)}function W(j){var H="";return j.global&&(H+="g"),j.ignoreCase&&(H+="i"),j.multiline&&(H+="m"),H}return D.clonePrototype=function(j){if(j===null)return null;var H=function(){};return H.prototype=j,new H},D.__objToStr=R,D.__isDate=function(j){return typeof j=="object"&&R(j)==="[object Date]"},D.__isArray=function(j){return typeof j=="object"&&R(j)==="[object Array]"},D.__isRegExp=function(j){return typeof j=="object"&&R(j)==="[object RegExp]"},D.__getRegExpFlags=W,D}();typeof s=="object"&&s.exports&&(s.exports=S)}).call(this,r(92).Buffer)},function(s){s.exports={name:"vega-lite",author:'Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',version:"4.13.1",collaborators:["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],homepage:"https://vega.github.io/vega-lite/",description:"Vega-Lite is a concise high-level language for interactive visualization.",main:"build/vega-lite.js",unpkg:"build/vega-lite.min.js",jsdelivr:"build/vega-lite.min.js",module:"build/src/index",types:"build/src/index.d.ts",bin:{vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"},directories:{test:"test"},scripts:{changelog:"conventional-changelog -p angular -r 2",build:"yarn build:only","build:only":"yarn tsc:src && rollup -c",postbuild:"terser build/vega-lite.js -cm --source-map content=build/vega-lite.js.map,filename=build/vega-lite.min.js.map -o build/vega-lite.min.js && yarn schema && babel build/vega-lite.js --out-dir build-es5 --config-file ./babel.config.js","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"yarn tsc:site && rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"find build ! -name 'vega-lite-schema.json' -type f -delete && rm -rf site/data/* && rm -f examples/compiled/*.png && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"pushd site && bundle exec jekyll serve -I -l && popd","tsc:src":"tsc -b src/tsconfig.src.json","tsc:site":"tsc -b site/tsconfig.site.json",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",test:"jest test/ && yarn lint && yarn schema && jest examples/ && yarn test:runtime","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand test","test:runtime":"TZ=America/Los_Angeles jest test-runtime/","test:runtime:generate":"yarn build:only && rm -Rf test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime","watch:build":"yarn build:only && concurrently --kill-others -n Typescript,Rollup 'yarn tsc:src -w' 'rollup -c -w'","watch:site":"concurrently --kill-others -n Typescript,Rollup 'yarn tsc:site -w' 'rollup -c site/rollup.config.js -w'","watch:test":"jest --watch"},repository:{type:"git",url:"https://github.com/vega/vega-lite.git"},license:"BSD-3-Clause",bugs:{url:"https://github.com/vega/vega-lite/issues"},devDependencies:{"@babel/cli":"^7.10.1","@babel/core":"^7.10.1","@babel/preset-env":"^7.10.1","@rollup/plugin-commonjs":"12.0.0","@rollup/plugin-json":"^4.0.3","@rollup/plugin-node-resolve":"^8.0.0","@types/chai":"^4.2.11","@types/d3":"^5.7.2","@types/jest":"^25.2.3","@types/mkdirp":"^1.0.0","@types/puppeteer":"^3.0.0","@typescript-eslint/eslint-plugin":"^3.0.2","@typescript-eslint/parser":"^3.0.2",ajv:"^6.12.2",chai:"^4.2.0",cheerio:"^1.0.0-rc.3",codecov:"^3.7.0",concurrently:"^5.2.0","conventional-changelog-cli":"^2.0.34",d3:"^5.16.0",eslint:"^7.1.0","eslint-config-prettier":"^6.11.0","eslint-plugin-jest":"^23.13.2","eslint-plugin-prettier":"^3.1.3","gh-pages":"^2.2.0","highlight.js":"^10.0.3","http-server":"^0.12.3",jest:"^26.0.1","jest-puppeteer":"^4.4.0",mkdirp:"^1.0.4",prettier:"^2.0.5",puppeteer:"^3.1.0",rollup:"^2.11.0","rollup-plugin-sourcemaps":"^0.6.2","rollup-plugin-terser":"^6.1.0","svg2png-many":"^0.0.7",terser:"^4.7.0","ts-jest":"^26.0.0","ts-json-schema-generator":"^0.68.1",typescript:"~3.9.3","vega-cli":"^5.12.1","vega-datasets":"^1.30.2","vega-embed":"^6.8.0","vega-tooltip":"^0.23.0","vega-typings":"^0.17.0","yaml-front-matter":"^4.1.0"},dependencies:{"@types/clone":"~0.1.30","@types/fast-json-stable-stringify":"^2.0.0","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.1","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~2.0.0",tslib:"~2.0.0","vega-event-selector":"~2.0.3","vega-expression":"~2.6.5","vega-util":"~1.14.0",yargs:"~15.3.1"},peerDependencies:{vega:"^5.12.1"},jest:{preset:"jest-puppeteer",transform:{"^.+\\.tsx?$":"ts-jest"},testRegex:"(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$",moduleFileExtensions:["ts","tsx","js","jsx","json","node"],testPathIgnorePatterns:["<rootDir>/node_modules","<rootDir>/build","<rootDir>/_site","<rootDir>/src"],coverageDirectory:"./coverage/",collectCoverage:!1}}},function(s,a,r){r.d(a,"a",function(){return j});var c=r(39),S=r(71),E=r(40),A=r(72),U=r(70),B=r(68);function D(Me){if(0<=Me.y&&Me.y<100){var rt=new Date(-1,Me.m,Me.d,Me.H,Me.M,Me.S,Me.L);return rt.setFullYear(Me.y),rt}return new Date(Me.y,Me.m,Me.d,Me.H,Me.M,Me.S,Me.L)}function R(Me){if(0<=Me.y&&Me.y<100){var rt=new Date(Date.UTC(-1,Me.m,Me.d,Me.H,Me.M,Me.S,Me.L));return rt.setUTCFullYear(Me.y),rt}return new Date(Date.UTC(Me.y,Me.m,Me.d,Me.H,Me.M,Me.S,Me.L))}function W(Me,rt,Ct){return{y:Me,m:rt,d:Ct,H:0,M:0,S:0,L:0}}function j(Me){var rt=Me.dateTime,Ct=Me.date,tn=Me.time,Sn=Me.periods,Rt=Me.days,Zt=Me.shortDays,mn=Me.months,fn=Me.shortMonths,mt=oe(Sn),Mt=ye(Sn),hn=oe(Rt),nn=ye(Rt),He=oe(Zt),Bn=ye(Zt),Xn=oe(mn),Zn=ye(mn),lr=oe(fn),jr=ye(fn),Cr={a:function(ri){return Zt[ri.getDay()]},A:function(ri){return Rt[ri.getDay()]},b:function(ri){return fn[ri.getMonth()]},B:function(ri){return mn[ri.getMonth()]},c:null,d:sn,e:sn,f:$e,g:Gt,G:Kt,H:kn,I:an,j:Ve,L:Ye,m:ft,M:$t,p:function(ri){return Sn[+(ri.getHours()>=12)]},q:function(ri){return 1+~~(ri.getMonth()/3)},Q:ve,s:ke,S:Jt,u:Pn,U:An,V:Ce,w:sr,W:Mr,x:null,X:null,y:on,Y:Hn,Z:Vt,"%":Se},xi={a:function(ri){return Zt[ri.getUTCDay()]},A:function(ri){return Rt[ri.getUTCDay()]},b:function(ri){return fn[ri.getUTCMonth()]},B:function(ri){return mn[ri.getUTCMonth()]},c:null,d:en,e:en,f:ar,g:Kr,G:Rr,H:Vn,I:Dt,j:On,L:or,m:yr,M:kr,p:function(ri){return Sn[+(ri.getUTCHours()>=12)]},q:function(ri){return 1+~~(ri.getUTCMonth()/3)},Q:ve,s:ke,S:dr,u:oi,U:Ur,V:zn,w:ir,W:Or,x:null,X:null,y:qr,Y:Tt,Z:Qt,"%":Se},Ai={a:function(ri,Jr,Kn){var pi=He.exec(Jr.slice(Kn));return pi?(ri.w=Bn.get(pi[0].toLowerCase()),Kn+pi[0].length):-1},A:function(ri,Jr,Kn){var pi=hn.exec(Jr.slice(Kn));return pi?(ri.w=nn.get(pi[0].toLowerCase()),Kn+pi[0].length):-1},b:function(ri,Jr,Kn){var pi=lr.exec(Jr.slice(Kn));return pi?(ri.m=jr.get(pi[0].toLowerCase()),Kn+pi[0].length):-1},B:function(ri,Jr,Kn){var pi=Xn.exec(Jr.slice(Kn));return pi?(ri.m=Zn.get(pi[0].toLowerCase()),Kn+pi[0].length):-1},c:function(ri,Jr,Kn){return yi(ri,rt,Jr,Kn)},d:Ot,e:Ot,f:rn,g:wt,G:It,H:Ut,I:Ut,j:ze,L:vt,m:Bt,M:Ft,p:function(ri,Jr,Kn){var pi=mt.exec(Jr.slice(Kn));return pi?(ri.p=Mt.get(pi[0].toLowerCase()),Kn+pi[0].length):-1},q:yt,Q:_t,s:Xt,S:pt,u:pe,U:me,V:Ge,w:_e,W:lt,x:function(ri,Jr,Kn){return yi(ri,Ct,Jr,Kn)},X:function(ri,Jr,Kn){return yi(ri,tn,Jr,Kn)},y:wt,Y:It,Z:we,"%":xt};function ni(ri,Jr){return function(Kn){var pi,Ci,Wr,so=[],Wi=-1,no=0,So=ri.length;for(Kn instanceof Date||(Kn=new Date(+Kn));++Wi<So;)ri.charCodeAt(Wi)===37&&(so.push(ri.slice(no,Wi)),(Ci=H[pi=ri.charAt(++Wi)])!=null?pi=ri.charAt(++Wi):Ci=pi==="e"?" ":"0",(Wr=Jr[pi])&&(pi=Wr(Kn,Ci)),so.push(pi),no=Wi+1);return so.push(ri.slice(no,Wi)),so.join("")}}function to(ri,Jr){return function(Kn){var pi,Ci,Wr=W(1900,void 0,1);if(yi(Wr,ri,Kn+="",0)!=Kn.length)return null;if("Q"in Wr)return new Date(Wr.Q);if("s"in Wr)return new Date(1e3*Wr.s+("L"in Wr?Wr.L:0));if(!Jr||"Z"in Wr||(Wr.Z=0),"p"in Wr&&(Wr.H=Wr.H%12+12*Wr.p),Wr.m===void 0&&(Wr.m="q"in Wr?Wr.q:0),"V"in Wr){if(Wr.V<1||Wr.V>53)return null;"w"in Wr||(Wr.w=1),"Z"in Wr?(pi=(Ci=(pi=R(W(Wr.y,0,1))).getUTCDay())>4||Ci===0?c.a.ceil(pi):Object(c.a)(pi),pi=S.a.offset(pi,7*(Wr.V-1)),Wr.y=pi.getUTCFullYear(),Wr.m=pi.getUTCMonth(),Wr.d=pi.getUTCDate()+(Wr.w+6)%7):(pi=(Ci=(pi=D(W(Wr.y,0,1))).getDay())>4||Ci===0?E.a.ceil(pi):Object(E.a)(pi),pi=A.a.offset(pi,7*(Wr.V-1)),Wr.y=pi.getFullYear(),Wr.m=pi.getMonth(),Wr.d=pi.getDate()+(Wr.w+6)%7)}else("W"in Wr||"U"in Wr)&&("w"in Wr||(Wr.w="u"in Wr?Wr.u%7:"W"in Wr?1:0),Ci="Z"in Wr?R(W(Wr.y,0,1)).getUTCDay():D(W(Wr.y,0,1)).getDay(),Wr.m=0,Wr.d="W"in Wr?(Wr.w+6)%7+7*Wr.W-(Ci+5)%7:Wr.w+7*Wr.U-(Ci+6)%7);return"Z"in Wr?(Wr.H+=Wr.Z/100|0,Wr.M+=Wr.Z%100,R(Wr)):D(Wr)}}function yi(ri,Jr,Kn,pi){for(var Ci,Wr,so=0,Wi=Jr.length,no=Kn.length;so<Wi;){if(pi>=no)return-1;if((Ci=Jr.charCodeAt(so++))===37){if(Ci=Jr.charAt(so++),!(Wr=Ai[Ci in H?Jr.charAt(so++):Ci])||(pi=Wr(ri,Kn,pi))<0)return-1}else if(Ci!=Kn.charCodeAt(pi++))return-1}return pi}return Cr.x=ni(Ct,Cr),Cr.X=ni(tn,Cr),Cr.c=ni(rt,Cr),xi.x=ni(Ct,xi),xi.X=ni(tn,xi),xi.c=ni(rt,xi),{format:function(ri){var Jr=ni(ri+="",Cr);return Jr.toString=function(){return ri},Jr},parse:function(ri){var Jr=to(ri+="",!1);return Jr.toString=function(){return ri},Jr},utcFormat:function(ri){var Jr=ni(ri+="",xi);return Jr.toString=function(){return ri},Jr},utcParse:function(ri){var Jr=to(ri+="",!0);return Jr.toString=function(){return ri},Jr}}}var H={"-":"",_:" ",0:"0"},I=/^\s*\d+/,Q=/^%/,Y=/[\\^$*+?|[\]().{}]/g;function q(Me,rt,Ct){var tn=Me<0?"-":"",Sn=(tn?-Me:Me)+"",Rt=Sn.length;return tn+(Rt<Ct?new Array(Ct-Rt+1).join(rt)+Sn:Sn)}function ae(Me){return Me.replace(Y,"\\$&")}function oe(Me){return new RegExp("^(?:"+Me.map(ae).join("|")+")","i")}function ye(Me){return new Map(Me.map((rt,Ct)=>[rt.toLowerCase(),Ct]))}function _e(Me,rt,Ct){var tn=I.exec(rt.slice(Ct,Ct+1));return tn?(Me.w=+tn[0],Ct+tn[0].length):-1}function pe(Me,rt,Ct){var tn=I.exec(rt.slice(Ct,Ct+1));return tn?(Me.u=+tn[0],Ct+tn[0].length):-1}function me(Me,rt,Ct){var tn=I.exec(rt.slice(Ct,Ct+2));return tn?(Me.U=+tn[0],Ct+tn[0].length):-1}function Ge(Me,rt,Ct){var tn=I.exec(rt.slice(Ct,Ct+2));return tn?(Me.V=+tn[0],Ct+tn[0].length):-1}function lt(Me,rt,Ct){var tn=I.exec(rt.slice(Ct,Ct+2));return tn?(Me.W=+tn[0],Ct+tn[0].length):-1}function It(Me,rt,Ct){var tn=I.exec(rt.slice(Ct,Ct+4));return tn?(Me.y=+tn[0],Ct+tn[0].length):-1}function wt(Me,rt,Ct){var tn=I.exec(rt.slice(Ct,Ct+2));return tn?(Me.y=+tn[0]+(+tn[0]>68?1900:2e3),Ct+tn[0].length):-1}function we(Me,rt,Ct){var tn=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(rt.slice(Ct,Ct+6));return tn?(Me.Z=tn[1]?0:-(tn[2]+(tn[3]||"00")),Ct+tn[0].length):-1}function yt(Me,rt,Ct){var tn=I.exec(rt.slice(Ct,Ct+1));return tn?(Me.q=3*tn[0]-3,Ct+tn[0].length):-1}function Bt(Me,rt,Ct){var tn=I.exec(rt.slice(Ct,Ct+2));return tn?(Me.m=tn[0]-1,Ct+tn[0].length):-1}function Ot(Me,rt,Ct){var tn=I.exec(rt.slice(Ct,Ct+2));return tn?(Me.d=+tn[0],Ct+tn[0].length):-1}function ze(Me,rt,Ct){var tn=I.exec(rt.slice(Ct,Ct+3));return tn?(Me.m=0,Me.d=+tn[0],Ct+tn[0].length):-1}function Ut(Me,rt,Ct){var tn=I.exec(rt.slice(Ct,Ct+2));return tn?(Me.H=+tn[0],Ct+tn[0].length):-1}function Ft(Me,rt,Ct){var tn=I.exec(rt.slice(Ct,Ct+2));return tn?(Me.M=+tn[0],Ct+tn[0].length):-1}function pt(Me,rt,Ct){var tn=I.exec(rt.slice(Ct,Ct+2));return tn?(Me.S=+tn[0],Ct+tn[0].length):-1}function vt(Me,rt,Ct){var tn=I.exec(rt.slice(Ct,Ct+3));return tn?(Me.L=+tn[0],Ct+tn[0].length):-1}function rn(Me,rt,Ct){var tn=I.exec(rt.slice(Ct,Ct+6));return tn?(Me.L=Math.floor(tn[0]/1e3),Ct+tn[0].length):-1}function xt(Me,rt,Ct){var tn=Q.exec(rt.slice(Ct,Ct+1));return tn?Ct+tn[0].length:-1}function _t(Me,rt,Ct){var tn=I.exec(rt.slice(Ct));return tn?(Me.Q=+tn[0],Ct+tn[0].length):-1}function Xt(Me,rt,Ct){var tn=I.exec(rt.slice(Ct));return tn?(Me.s=+tn[0],Ct+tn[0].length):-1}function sn(Me,rt){return q(Me.getDate(),rt,2)}function kn(Me,rt){return q(Me.getHours(),rt,2)}function an(Me,rt){return q(Me.getHours()%12||12,rt,2)}function Ve(Me,rt){return q(1+A.a.count(Object(U.a)(Me),Me),rt,3)}function Ye(Me,rt){return q(Me.getMilliseconds(),rt,3)}function $e(Me,rt){return Ye(Me,rt)+"000"}function ft(Me,rt){return q(Me.getMonth()+1,rt,2)}function $t(Me,rt){return q(Me.getMinutes(),rt,2)}function Jt(Me,rt){return q(Me.getSeconds(),rt,2)}function Pn(Me){var rt=Me.getDay();return rt===0?7:rt}function An(Me,rt){return q(E.b.count(Object(U.a)(Me)-1,Me),rt,2)}function Qn(Me){var rt=Me.getDay();return rt>=4||rt===0?Object(E.c)(Me):E.c.ceil(Me)}function Ce(Me,rt){return Me=Qn(Me),q(E.c.count(Object(U.a)(Me),Me)+(Object(U.a)(Me).getDay()===4),rt,2)}function sr(Me){return Me.getDay()}function Mr(Me,rt){return q(E.a.count(Object(U.a)(Me)-1,Me),rt,2)}function on(Me,rt){return q(Me.getFullYear()%100,rt,2)}function Gt(Me,rt){return q((Me=Qn(Me)).getFullYear()%100,rt,2)}function Hn(Me,rt){return q(Me.getFullYear()%1e4,rt,4)}function Kt(Me,rt){var Ct=Me.getDay();return q((Me=Ct>=4||Ct===0?Object(E.c)(Me):E.c.ceil(Me)).getFullYear()%1e4,rt,4)}function Vt(Me){var rt=Me.getTimezoneOffset();return(rt>0?"-":(rt*=-1,"+"))+q(rt/60|0,"0",2)+q(rt%60,"0",2)}function en(Me,rt){return q(Me.getUTCDate(),rt,2)}function Vn(Me,rt){return q(Me.getUTCHours(),rt,2)}function Dt(Me,rt){return q(Me.getUTCHours()%12||12,rt,2)}function On(Me,rt){return q(1+S.a.count(Object(B.a)(Me),Me),rt,3)}function or(Me,rt){return q(Me.getUTCMilliseconds(),rt,3)}function ar(Me,rt){return or(Me,rt)+"000"}function yr(Me,rt){return q(Me.getUTCMonth()+1,rt,2)}function kr(Me,rt){return q(Me.getUTCMinutes(),rt,2)}function dr(Me,rt){return q(Me.getUTCSeconds(),rt,2)}function oi(Me){var rt=Me.getUTCDay();return rt===0?7:rt}function Ur(Me,rt){return q(c.b.count(Object(B.a)(Me)-1,Me),rt,2)}function Xr(Me){var rt=Me.getUTCDay();return rt>=4||rt===0?Object(c.c)(Me):c.c.ceil(Me)}function zn(Me,rt){return Me=Xr(Me),q(c.c.count(Object(B.a)(Me),Me)+(Object(B.a)(Me).getUTCDay()===4),rt,2)}function ir(Me){return Me.getUTCDay()}function Or(Me,rt){return q(c.a.count(Object(B.a)(Me)-1,Me),rt,2)}function qr(Me,rt){return q(Me.getUTCFullYear()%100,rt,2)}function Kr(Me,rt){return q((Me=Xr(Me)).getUTCFullYear()%100,rt,2)}function Tt(Me,rt){return q(Me.getUTCFullYear()%1e4,rt,4)}function Rr(Me,rt){var Ct=Me.getUTCDay();return q((Me=Ct>=4||Ct===0?Object(c.c)(Me):c.c.ceil(Me)).getUTCFullYear()%1e4,rt,4)}function Qt(){return"+0000"}function Se(){return"%"}function ve(Me){return+Me}function ke(Me){return Math.floor(+Me/1e3)}},function(s,a,r){r.r(a);var c="http://www.w3.org/1999/xhtml",S={svg:"http://www.w3.org/2000/svg",xhtml:c,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},E=function(Kt){var Vt=Kt+="",en=Vt.indexOf(":");return en>=0&&(Vt=Kt.slice(0,en))!=="xmlns"&&(Kt=Kt.slice(en+1)),S.hasOwnProperty(Vt)?{space:S[Vt],local:Kt}:Kt},A=function(Kt){var Vt=E(Kt);return(Vt.local?function(en){return function(){return this.ownerDocument.createElementNS(en.space,en.local)}}:function(en){return function(){var Vn=this.ownerDocument,Dt=this.namespaceURI;return Dt===c&&Vn.documentElement.namespaceURI===c?Vn.createElement(en):Vn.createElementNS(Dt,en)}})(Vt)};function U(){}var B=function(Kt){return Kt==null?U:function(){return this.querySelector(Kt)}};function D(){return[]}var R=function(Kt){return Kt==null?D:function(){return this.querySelectorAll(Kt)}},W=function(Kt){return function(){return this.matches(Kt)}};if(typeof document<"u"){var j=document.documentElement;if(!j.matches){var H=j.webkitMatchesSelector||j.msMatchesSelector||j.mozMatchesSelector||j.oMatchesSelector;W=function(Kt){return function(){return H.call(this,Kt)}}}}var I=W,Q=function(Kt){return new Array(Kt.length)};function Y(Kt,Vt){this.ownerDocument=Kt.ownerDocument,this.namespaceURI=Kt.namespaceURI,this._next=null,this._parent=Kt,this.__data__=Vt}Y.prototype={constructor:Y,appendChild:function(Kt){return this._parent.insertBefore(Kt,this._next)},insertBefore:function(Kt,Vt){return this._parent.insertBefore(Kt,Vt)},querySelector:function(Kt){return this._parent.querySelector(Kt)},querySelectorAll:function(Kt){return this._parent.querySelectorAll(Kt)}};var q="$";function ae(Kt,Vt,en,Vn,Dt,On){for(var or,ar=0,yr=Vt.length,kr=On.length;ar<kr;++ar)(or=Vt[ar])?(or.__data__=On[ar],Vn[ar]=or):en[ar]=new Y(Kt,On[ar]);for(;ar<yr;++ar)(or=Vt[ar])&&(Dt[ar]=or)}function oe(Kt,Vt,en,Vn,Dt,On,or){var ar,yr,kr,dr={},oi=Vt.length,Ur=On.length,Xr=new Array(oi);for(ar=0;ar<oi;++ar)(yr=Vt[ar])&&(Xr[ar]=kr=q+or.call(yr,yr.__data__,ar,Vt),kr in dr?Dt[ar]=yr:dr[kr]=yr);for(ar=0;ar<Ur;++ar)(yr=dr[kr=q+or.call(Kt,On[ar],ar,On)])?(Vn[ar]=yr,yr.__data__=On[ar],dr[kr]=null):en[ar]=new Y(Kt,On[ar]);for(ar=0;ar<oi;++ar)(yr=Vt[ar])&&dr[Xr[ar]]===yr&&(Dt[ar]=yr)}function ye(Kt,Vt){return Kt<Vt?-1:Kt>Vt?1:Kt>=Vt?0:NaN}var _e=function(Kt){return Kt.ownerDocument&&Kt.ownerDocument.defaultView||Kt.document&&Kt||Kt.defaultView};function pe(Kt,Vt){return Kt.style.getPropertyValue(Vt)||_e(Kt).getComputedStyle(Kt,null).getPropertyValue(Vt)}function me(Kt){return Kt.trim().split(/^|\s+/)}function Ge(Kt){return Kt.classList||new lt(Kt)}function lt(Kt){this._node=Kt,this._names=me(Kt.getAttribute("class")||"")}function It(Kt,Vt){for(var en=Ge(Kt),Vn=-1,Dt=Vt.length;++Vn<Dt;)en.add(Vt[Vn])}function wt(Kt,Vt){for(var en=Ge(Kt),Vn=-1,Dt=Vt.length;++Vn<Dt;)en.remove(Vt[Vn])}lt.prototype={add:function(Kt){this._names.indexOf(Kt)<0&&(this._names.push(Kt),this._node.setAttribute("class",this._names.join(" ")))},remove:function(Kt){var Vt=this._names.indexOf(Kt);Vt>=0&&(this._names.splice(Vt,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(Kt){return this._names.indexOf(Kt)>=0}};function we(){this.textContent=""}function yt(){this.innerHTML=""}function Bt(){this.nextSibling&&this.parentNode.appendChild(this)}function Ot(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ze(){return null}function Ut(){var Kt=this.parentNode;Kt&&Kt.removeChild(this)}function Ft(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function pt(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}var vt={},rn=null;typeof document<"u"&&("onmouseenter"in document.documentElement||(vt={mouseenter:"mouseover",mouseleave:"mouseout"}));function xt(Kt,Vt,en){return Kt=_t(Kt,Vt,en),function(Vn){var Dt=Vn.relatedTarget;Dt&&(Dt===this||8&Dt.compareDocumentPosition(this))||Kt.call(this,Vn)}}function _t(Kt,Vt,en){return function(Vn){var Dt=rn;rn=Vn;try{Kt.call(this,this.__data__,Vt,en)}finally{rn=Dt}}}function Xt(Kt){return function(){var Vt=this.__on;if(Vt){for(var en,Vn=0,Dt=-1,On=Vt.length;Vn<On;++Vn)en=Vt[Vn],Kt.type&&en.type!==Kt.type||en.name!==Kt.name?Vt[++Dt]=en:this.removeEventListener(en.type,en.listener,en.capture);++Dt?Vt.length=Dt:delete this.__on}}}function sn(Kt,Vt,en){var Vn=vt.hasOwnProperty(Kt.type)?xt:_t;return function(Dt,On,or){var ar,yr=this.__on,kr=Vn(Vt,On,or);if(yr){for(var dr=0,oi=yr.length;dr<oi;++dr)if((ar=yr[dr]).type===Kt.type&&ar.name===Kt.name)return this.removeEventListener(ar.type,ar.listener,ar.capture),this.addEventListener(ar.type,ar.listener=kr,ar.capture=en),void(ar.value=Vt)}this.addEventListener(Kt.type,kr,en),ar={type:Kt.type,name:Kt.name,value:Vt,listener:kr,capture:en},yr?yr.push(ar):this.__on=[ar]}}function kn(Kt,Vt,en,Vn){var Dt=rn;Kt.sourceEvent=rn,rn=Kt;try{return Vt.apply(en,Vn)}finally{rn=Dt}}function an(Kt,Vt,en){var Vn=_e(Kt),Dt=Vn.CustomEvent;typeof Dt=="function"?Dt=new Dt(Vt,en):(Dt=Vn.document.createEvent("Event"),en?(Dt.initEvent(Vt,en.bubbles,en.cancelable),Dt.detail=en.detail):Dt.initEvent(Vt,!1,!1)),Kt.dispatchEvent(Dt)}var Ve=[null];function Ye(Kt,Vt){this._groups=Kt,this._parents=Vt}function $e(){return new Ye([[document.documentElement]],Ve)}Ye.prototype=$e.prototype={constructor:Ye,select:function(Kt){typeof Kt!="function"&&(Kt=B(Kt));for(var Vt=this._groups,en=Vt.length,Vn=new Array(en),Dt=0;Dt<en;++Dt)for(var On,or,ar=Vt[Dt],yr=ar.length,kr=Vn[Dt]=new Array(yr),dr=0;dr<yr;++dr)(On=ar[dr])&&(or=Kt.call(On,On.__data__,dr,ar))&&("__data__"in On&&(or.__data__=On.__data__),kr[dr]=or);return new Ye(Vn,this._parents)},selectAll:function(Kt){typeof Kt!="function"&&(Kt=R(Kt));for(var Vt=this._groups,en=Vt.length,Vn=[],Dt=[],On=0;On<en;++On)for(var or,ar=Vt[On],yr=ar.length,kr=0;kr<yr;++kr)(or=ar[kr])&&(Vn.push(Kt.call(or,or.__data__,kr,ar)),Dt.push(or));return new Ye(Vn,Dt)},filter:function(Kt){typeof Kt!="function"&&(Kt=I(Kt));for(var Vt=this._groups,en=Vt.length,Vn=new Array(en),Dt=0;Dt<en;++Dt)for(var On,or=Vt[Dt],ar=or.length,yr=Vn[Dt]=[],kr=0;kr<ar;++kr)(On=or[kr])&&Kt.call(On,On.__data__,kr,or)&&yr.push(On);return new Ye(Vn,this._parents)},data:function(Kt,Vt){if(!Kt)return Xr=new Array(this.size()),kr=-1,this.each(function(Qt){Xr[++kr]=Qt}),Xr;var en=Vt?oe:ae,Vn=this._parents,Dt=this._groups;typeof Kt!="function"&&(Kt=function(Qt){return function(){return Qt}}(Kt));for(var On=Dt.length,or=new Array(On),ar=new Array(On),yr=new Array(On),kr=0;kr<On;++kr){var dr=Vn[kr],oi=Dt[kr],Ur=oi.length,Xr=Kt.call(dr,dr&&dr.__data__,kr,Vn),zn=Xr.length,ir=ar[kr]=new Array(zn),Or=or[kr]=new Array(zn);en(dr,oi,ir,Or,yr[kr]=new Array(Ur),Xr,Vt);for(var qr,Kr,Tt=0,Rr=0;Tt<zn;++Tt)if(qr=ir[Tt]){for(Tt>=Rr&&(Rr=Tt+1);!(Kr=Or[Rr])&&++Rr<zn;);qr._next=Kr||null}}return(or=new Ye(or,Vn))._enter=ar,or._exit=yr,or},enter:function(){return new Ye(this._enter||this._groups.map(Q),this._parents)},exit:function(){return new Ye(this._exit||this._groups.map(Q),this._parents)},merge:function(Kt){for(var Vt=this._groups,en=Kt._groups,Vn=Vt.length,Dt=en.length,On=Math.min(Vn,Dt),or=new Array(Vn),ar=0;ar<On;++ar)for(var yr,kr=Vt[ar],dr=en[ar],oi=kr.length,Ur=or[ar]=new Array(oi),Xr=0;Xr<oi;++Xr)(yr=kr[Xr]||dr[Xr])&&(Ur[Xr]=yr);for(;ar<Vn;++ar)or[ar]=Vt[ar];return new Ye(or,this._parents)},order:function(){for(var Kt=this._groups,Vt=-1,en=Kt.length;++Vt<en;)for(var Vn,Dt=Kt[Vt],On=Dt.length-1,or=Dt[On];--On>=0;)(Vn=Dt[On])&&(or&&or!==Vn.nextSibling&&or.parentNode.insertBefore(Vn,or),or=Vn);return this},sort:function(Kt){function Vt(oi,Ur){return oi&&Ur?Kt(oi.__data__,Ur.__data__):!oi-!Ur}Kt||(Kt=ye);for(var en=this._groups,Vn=en.length,Dt=new Array(Vn),On=0;On<Vn;++On){for(var or,ar=en[On],yr=ar.length,kr=Dt[On]=new Array(yr),dr=0;dr<yr;++dr)(or=ar[dr])&&(kr[dr]=or);kr.sort(Vt)}return new Ye(Dt,this._parents).order()},call:function(){var Kt=arguments[0];return arguments[0]=this,Kt.apply(null,arguments),this},nodes:function(){var Kt=new Array(this.size()),Vt=-1;return this.each(function(){Kt[++Vt]=this}),Kt},node:function(){for(var Kt=this._groups,Vt=0,en=Kt.length;Vt<en;++Vt)for(var Vn=Kt[Vt],Dt=0,On=Vn.length;Dt<On;++Dt){var or=Vn[Dt];if(or)return or}return null},size:function(){var Kt=0;return this.each(function(){++Kt}),Kt},empty:function(){return!this.node()},each:function(Kt){for(var Vt=this._groups,en=0,Vn=Vt.length;en<Vn;++en)for(var Dt,On=Vt[en],or=0,ar=On.length;or<ar;++or)(Dt=On[or])&&Kt.call(Dt,Dt.__data__,or,On);return this},attr:function(Kt,Vt){var en=E(Kt);if(arguments.length<2){var Vn=this.node();return en.local?Vn.getAttributeNS(en.space,en.local):Vn.getAttribute(en)}return this.each((Vt==null?en.local?function(Dt){return function(){this.removeAttributeNS(Dt.space,Dt.local)}}:function(Dt){return function(){this.removeAttribute(Dt)}}:typeof Vt=="function"?en.local?function(Dt,On){return function(){var or=On.apply(this,arguments);or==null?this.removeAttributeNS(Dt.space,Dt.local):this.setAttributeNS(Dt.space,Dt.local,or)}}:function(Dt,On){return function(){var or=On.apply(this,arguments);or==null?this.removeAttribute(Dt):this.setAttribute(Dt,or)}}:en.local?function(Dt,On){return function(){this.setAttributeNS(Dt.space,Dt.local,On)}}:function(Dt,On){return function(){this.setAttribute(Dt,On)}})(en,Vt))},style:function(Kt,Vt,en){return arguments.length>1?this.each((Vt==null?function(Vn){return function(){this.style.removeProperty(Vn)}}:typeof Vt=="function"?function(Vn,Dt,On){return function(){var or=Dt.apply(this,arguments);or==null?this.style.removeProperty(Vn):this.style.setProperty(Vn,or,On)}}:function(Vn,Dt,On){return function(){this.style.setProperty(Vn,Dt,On)}})(Kt,Vt,en??"")):pe(this.node(),Kt)},property:function(Kt,Vt){return arguments.length>1?this.each((Vt==null?function(en){return function(){delete this[en]}}:typeof Vt=="function"?function(en,Vn){return function(){var Dt=Vn.apply(this,arguments);Dt==null?delete this[en]:this[en]=Dt}}:function(en,Vn){return function(){this[en]=Vn}})(Kt,Vt)):this.node()[Kt]},classed:function(Kt,Vt){var en=me(Kt+"");if(arguments.length<2){for(var Vn=Ge(this.node()),Dt=-1,On=en.length;++Dt<On;)if(!Vn.contains(en[Dt]))return!1;return!0}return this.each((typeof Vt=="function"?function(or,ar){return function(){(ar.apply(this,arguments)?It:wt)(this,or)}}:Vt?function(or){return function(){It(this,or)}}:function(or){return function(){wt(this,or)}})(en,Vt))},text:function(Kt){return arguments.length?this.each(Kt==null?we:(typeof Kt=="function"?function(Vt){return function(){var en=Vt.apply(this,arguments);this.textContent=en??""}}:function(Vt){return function(){this.textContent=Vt}})(Kt)):this.node().textContent},html:function(Kt){return arguments.length?this.each(Kt==null?yt:(typeof Kt=="function"?function(Vt){return function(){var en=Vt.apply(this,arguments);this.innerHTML=en??""}}:function(Vt){return function(){this.innerHTML=Vt}})(Kt)):this.node().innerHTML},raise:function(){return this.each(Bt)},lower:function(){return this.each(Ot)},append:function(Kt){var Vt=typeof Kt=="function"?Kt:A(Kt);return this.select(function(){return this.appendChild(Vt.apply(this,arguments))})},insert:function(Kt,Vt){var en=typeof Kt=="function"?Kt:A(Kt),Vn=Vt==null?ze:typeof Vt=="function"?Vt:B(Vt);return this.select(function(){return this.insertBefore(en.apply(this,arguments),Vn.apply(this,arguments)||null)})},remove:function(){return this.each(Ut)},clone:function(Kt){return this.select(Kt?pt:Ft)},datum:function(Kt){return arguments.length?this.property("__data__",Kt):this.node().__data__},on:function(Kt,Vt,en){var Vn,Dt,On=function(oi){return oi.trim().split(/^|\s+/).map(function(Ur){var Xr="",zn=Ur.indexOf(".");return zn>=0&&(Xr=Ur.slice(zn+1),Ur=Ur.slice(0,zn)),{type:Ur,name:Xr}})}(Kt+""),or=On.length;if(!(arguments.length<2)){for(ar=Vt?sn:Xt,en==null&&(en=!1),Vn=0;Vn<or;++Vn)this.each(ar(On[Vn],Vt,en));return this}var ar=this.node().__on;if(ar){for(var yr,kr=0,dr=ar.length;kr<dr;++kr)for(Vn=0,yr=ar[kr];Vn<or;++Vn)if((Dt=On[Vn]).type===yr.type&&Dt.name===yr.name)return yr.value}},dispatch:function(Kt,Vt){return this.each((typeof Vt=="function"?function(en,Vn){return function(){return an(this,en,Vn.apply(this,arguments))}}:function(en,Vn){return function(){return an(this,en,Vn)}})(Kt,Vt))}};var ft=$e,$t=function(Kt){return typeof Kt=="string"?new Ye([[document.querySelector(Kt)]],[document.documentElement]):new Ye([[Kt]],Ve)},Jt=function(Kt){return $t(A(Kt).call(document.documentElement))},Pn=0;function An(){return new Qn}function Qn(){this._="@"+(++Pn).toString(36)}Qn.prototype=An.prototype={constructor:Qn,get:function(Kt){for(var Vt=this._;!(Vt in Kt);)if(!(Kt=Kt.parentNode))return;return Kt[Vt]},set:function(Kt,Vt){return Kt[this._]=Vt},remove:function(Kt){return this._ in Kt&&delete Kt[this._]},toString:function(){return this._}};var Ce=function(){for(var Kt,Vt=rn;Kt=Vt.sourceEvent;)Vt=Kt;return Vt},sr=function(Kt,Vt){var en=Kt.ownerSVGElement||Kt;if(en.createSVGPoint){var Vn=en.createSVGPoint();return Vn.x=Vt.clientX,Vn.y=Vt.clientY,[(Vn=Vn.matrixTransform(Kt.getScreenCTM().inverse())).x,Vn.y]}var Dt=Kt.getBoundingClientRect();return[Vt.clientX-Dt.left-Kt.clientLeft,Vt.clientY-Dt.top-Kt.clientTop]},Mr=function(Kt){var Vt=Ce();return Vt.changedTouches&&(Vt=Vt.changedTouches[0]),sr(Kt,Vt)},on=function(Kt){return typeof Kt=="string"?new Ye([document.querySelectorAll(Kt)],[document.documentElement]):new Ye([Kt??[]],Ve)},Gt=function(Kt,Vt,en){arguments.length<3&&(en=Vt,Vt=Ce().changedTouches);for(var Vn,Dt=0,On=Vt?Vt.length:0;Dt<On;++Dt)if((Vn=Vt[Dt]).identifier===en)return sr(Kt,Vn);return null},Hn=function(Kt,Vt){Vt==null&&(Vt=Ce().touches);for(var en=0,Vn=Vt?Vt.length:0,Dt=new Array(Vn);en<Vn;++en)Dt[en]=sr(Kt,Vt[en]);return Dt};r.d(a,"create",function(){return Jt}),r.d(a,"creator",function(){return A}),r.d(a,"local",function(){return An}),r.d(a,"matcher",function(){return I}),r.d(a,"mouse",function(){return Mr}),r.d(a,"namespace",function(){return E}),r.d(a,"namespaces",function(){return S}),r.d(a,"clientPoint",function(){return sr}),r.d(a,"select",function(){return $t}),r.d(a,"selectAll",function(){return on}),r.d(a,"selection",function(){return ft}),r.d(a,"selector",function(){return B}),r.d(a,"selectorAll",function(){return R}),r.d(a,"style",function(){return pe}),r.d(a,"touch",function(){return Gt}),r.d(a,"touches",function(){return Hn}),r.d(a,"window",function(){return _e}),r.d(a,"event",function(){return rn}),r.d(a,"customEvent",function(){return kn})},function(s,a,r){r.r(a);var c={};r.d(c,"load",function(){return xt});var S={};r.d(S,"Darknet",function(){return $e}),r.d(S,"load",function(){return ft});var E={};r.d(E,"Doodlenet",function(){return sr}),r.d(E,"load",function(){return Mr});var A={};r.d(A,"array3DToImage",function(){return Kt}),r.d(A,"processVideo",function(){return Hn}),r.d(A,"cropImage",function(){return Vt}),r.d(A,"imgToTensor",function(){return Vn}),r.d(A,"isInstanceOfSupportedElement",function(){return Dt}),r.d(A,"flipImage",function(){return en}),r.d(A,"imgToPixelArray",function(){return On});var U={};r.d(U,"SpeechCommands",function(){return lr}),r.d(U,"load",function(){return jr});var B={};r.d(B,"isTensor",function(){return vo}),r.d(B,"isTensor1D",function(){return Af}),r.d(B,"isTensor2D",function(){return Td}),r.d(B,"isTensor3D",function(){return mr}),r.d(B,"isTensor4D",function(){return is}),r.d(B,"isFloat",function(){return Na}),r.d(B,"isEven",function(){return io}),r.d(B,"round",function(){return Xu}),r.d(B,"isDimensions",function(){return Pc}),r.d(B,"computeReshapedDimensions",function(){return cu}),r.d(B,"getCenterPoint",function(){return Lc}),r.d(B,"range",function(){return oa}),r.d(B,"isValidNumber",function(){return vc}),r.d(B,"isValidProbablitiy",function(){return lu});var D={};r.d(D,"drawContour",function(){return uu}),r.d(D,"drawDetections",function(){return pr}),r.d(D,"drawFaceExpressions",function(){return pu}),r.d(D,"DrawBoxOptions",function(){return nr}),r.d(D,"DrawBox",function(){return Yn}),r.d(D,"DrawFaceLandmarksOptions",function(){return hs}),r.d(D,"DrawFaceLandmarks",function(){return Xa}),r.d(D,"drawFaceLandmarks",function(){return zc}),r.d(D,"AnchorPosition",function(){return qt}),r.d(D,"DrawTextFieldOptions",function(){return Un}),r.d(D,"DrawTextField",function(){return Gn});var R={};r.d(R,"draw",function(){return D}),r.d(R,"utils",function(){return B}),r.d(R,"tf",function(){return bn}),r.d(R,"env",function(){return un}),r.d(R,"FaceLandmarkNet",function(){return fv}),r.d(R,"createFaceRecognitionNet",function(){return i0}),r.d(R,"createMtcnn",function(){return v0}),r.d(R,"sigmoid",function(){return Bl}),r.d(R,"inverseSigmoid",function(){return Hh}),r.d(R,"createSsdMobilenetv1",function(){return mv}),r.d(R,"createFaceDetectionNet",function(){return gv}),r.d(R,"FaceDetectionNet",function(){return j1}),r.d(R,"createTinyFaceDetector",function(){return vg}),r.d(R,"TinyYolov2",function(){return Kh}),r.d(R,"createTinyYolov2",function(){return U1}),r.d(R,"euclideanDistance",function(){return g0}),r.d(R,"NeuralNetwork",function(){return Vi}),r.d(R,"resizeResults",function(){return kv}),r.d(R,"AgeGenderNet",function(){return cv}),r.d(R,"Gender",function(){return Tf}),r.d(R,"BoundingBox",function(){return Ua}),r.d(R,"Box",function(){return Es}),r.d(R,"Dimensions",function(){return js}),r.d(R,"FaceDetection",function(){return aa}),r.d(R,"FaceLandmarks",function(){return du}),r.d(R,"FaceLandmarks5",function(){return Ju}),r.d(R,"FaceLandmarks68",function(){return Qu}),r.d(R,"FaceMatch",function(){return Cu}),r.d(R,"LabeledBox",function(){return Gh}),r.d(R,"LabeledFaceDescriptors",function(){return Md}),r.d(R,"ObjectDetection",function(){return Ss}),r.d(R,"Point",function(){return bo}),r.d(R,"PredictedBox",function(){return Dd}),r.d(R,"Rect",function(){return jl}),r.d(R,"awaitMediaLoaded",function(){return Tr}),r.d(R,"bufferToImage",function(){return $r}),r.d(R,"createCanvas",function(){return Fr}),r.d(R,"createCanvasFromMedia",function(){return ui}),r.d(R,"extractFaces",function(){return po}),r.d(R,"extractFaceTensors",function(){return ho}),r.d(R,"fetchImage",function(){return Ki}),r.d(R,"fetchJson",function(){return mo}),r.d(R,"fetchNetWeights",function(){return pa}),r.d(R,"fetchOrThrow",function(){return Ko}),r.d(R,"getContext2dOrThrow",function(){return In}),r.d(R,"getMediaDimensions",function(){return ai}),r.d(R,"imageTensorToCanvas",function(){return ii}),r.d(R,"imageToSquare",function(){return Si}),r.d(R,"isMediaElement",function(){return wi}),r.d(R,"isMediaLoaded",function(){return gr}),r.d(R,"loadWeightMap",function(){return sa}),r.d(R,"matchDimensions",function(){return Gi}),r.d(R,"NetInput",function(){return si}),r.d(R,"resolveInput",function(){return ht}),r.d(R,"toNetInput",function(){return gi}),r.d(R,"FaceExpressionNet",function(){return yo}),r.d(R,"FACE_EXPRESSION_LABELS",function(){return zs}),r.d(R,"FaceExpressions",function(){return ks}),r.d(R,"FaceLandmark68Net",function(){return n0}),r.d(R,"FaceLandmark68TinyNet",function(){return r0}),r.d(R,"FaceRecognitionNet",function(){return cm}),r.d(R,"extendWithFaceDescriptor",function(){return o0}),r.d(R,"isWithFaceDetection",function(){return Of}),r.d(R,"extendWithFaceDetection",function(){return Nd}),r.d(R,"isWithFaceExpressions",function(){return Us}),r.d(R,"extendWithFaceExpressions",function(){return os}),r.d(R,"isWithFaceLandmarks",function(){return ul}),r.d(R,"extendWithFaceLandmarks",function(){return Yo}),r.d(R,"isWithAge",function(){return Ny}),r.d(R,"extendWithAge",function(){return a0}),r.d(R,"isWithGender",function(){return qh}),r.d(R,"extendWithGender",function(){return Rd}),r.d(R,"allFacesSsdMobilenetv1",function(){return mg}),r.d(R,"allFacesTinyYolov2",function(){return tp}),r.d(R,"allFacesMtcnn",function(){return gg}),r.d(R,"allFaces",function(){return m0}),r.d(R,"ComposableTask",function(){return Hl}),r.d(R,"ComputeFaceDescriptorsTaskBase",function(){return vm}),r.d(R,"ComputeAllFaceDescriptorsTask",function(){return Wc}),r.d(R,"ComputeSingleFaceDescriptorTask",function(){return Hd}),r.d(R,"detectSingleFace",function(){return pg}),r.d(R,"detectAllFaces",function(){return Bf}),r.d(R,"DetectFacesTaskBase",function(){return dg}),r.d(R,"DetectAllFacesTask",function(){return hg}),r.d(R,"DetectSingleFaceTask",function(){return Cv}),r.d(R,"DetectFaceLandmarksTaskBase",function(){return Gd}),r.d(R,"DetectAllFaceLandmarksTask",function(){return ym}),r.d(R,"DetectSingleFaceLandmarksTask",function(){return fg}),r.d(R,"FaceMatcher",function(){return bm}),r.d(R,"nets",function(){return go}),r.d(R,"ssdMobilenetv1",function(){return Ff}),r.d(R,"tinyFaceDetector",function(){return Jh}),r.d(R,"tinyYolov2",function(){return Ry}),r.d(R,"mtcnn",function(){return Py}),r.d(R,"detectFaceLandmarks",function(){return ug}),r.d(R,"detectFaceLandmarksTiny",function(){return Rf}),r.d(R,"computeFaceDescriptor",function(){return Gl}),r.d(R,"recognizeFaceExpressions",function(){return mm}),r.d(R,"predictAgeAndGender",function(){return Qh}),r.d(R,"loadSsdMobilenetv1Model",function(){return zd}),r.d(R,"loadTinyFaceDetectorModel",function(){return Pf}),r.d(R,"loadMtcnnModel",function(){return Lf}),r.d(R,"loadTinyYolov2Model",function(){return rc}),r.d(R,"loadFaceLandmarkModel",function(){return Zh}),r.d(R,"loadFaceLandmarkTinyModel",function(){return Ud}),r.d(R,"loadFaceRecognitionModel",function(){return ql}),r.d(R,"loadFaceExpressionModel",function(){return dl}),r.d(R,"loadAgeGenderModel",function(){return Wd}),r.d(R,"loadFaceDetectionModel",function(){return cg}),r.d(R,"locateFaces",function(){return Vd}),r.d(R,"detectLandmarks",function(){return hl}),r.d(R,"Mtcnn",function(){return Ld}),r.d(R,"MtcnnOptions",function(){return ll}),r.d(R,"iou",function(){return fu}),r.d(R,"minBbox",function(){return Ku}),r.d(R,"nonMaxSuppression",function(){return yc}),r.d(R,"normalize",function(){return Bc}),r.d(R,"padToSquare",function(){return Yu}),r.d(R,"shuffleArray",function(){return Ll}),r.d(R,"SsdMobilenetv1",function(){return dm}),r.d(R,"SsdMobilenetv1Options",function(){return fl}),r.d(R,"TinyFaceDetector",function(){return jd}),r.d(R,"TinyFaceDetectorOptions",function(){return ag}),r.d(R,"TinyYolov2SizeType",function(){return l0}),r.d(R,"TinyYolov2Options",function(){return Xh}),r.d(R,"validateConfig",function(){return bv});var W={};r.d(W,"getRobin",function(){return Dm}),r.d(W,"getImageData",function(){return Wy});var j=r(18),H=r.n(j),I=r(2),Q=r(67),Y=r(6),q=r.n(Y),ae=r(10),oe=r.n(ae),ye=r(9),_e=r.n(ye),pe=r(4),me=r.n(pe);function Ge($,M){return M?new Promise(function(T,O){$.then(function(L){M(void 0,L),T(L)}).catch(function(L){M(L),O(L)})}):$}var lt=function(){function $(M,T,O,L){oe()(this,$),this.model=M,this.audioContext=T,this.stream=O,this.frequency=null,this.ready=Ge(this.loadModel(M),L)}return _e()($,[{key:"loadModel",value:function(){var M=q()(me.a.mark(function T(O){return me.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,I.loadLayersModel("".concat(O,"/model.json"));case 2:if(this.model=L.sent,!this.audioContext){L.next=8;break}return L.next=6,this.processStream();case 6:L.next=9;break;case 8:throw new Error("Could not access microphone - getUserMedia not available");case 9:return L.abrupt("return",this);case 10:case"end":return L.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"processStream",value:function(){var M=q()(me.a.mark(function T(){var O,L,J,ie,ge;return me.a.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:return Ae.next=2,I.nextFrame();case 2:for(O=this.audioContext.createMediaStreamSource(this.stream),L=this.audioContext.sampleRate/16e3*1024,J=4;J<L;)J*=2;(ie=this.audioContext.createScriptProcessor(J,1,1)).onaudioprocess=this.processMicrophoneBuffer.bind(this),(ge=this.audioContext.createGain()).gain.setValueAtTime(0,this.audioContext.currentTime),O.connect(ie),ie.connect(ge),ge.connect(this.audioContext.destination),this.audioContext.state!=="running"&&console.warn("User gesture needed to start AudioContext, please click");case 14:case"end":return Ae.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"processMicrophoneBuffer",value:function(){var M=q()(me.a.mark(function T(O){var L=this;return me.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,I.nextFrame();case 2:this.results={},$.resample(O.inputBuffer,function(ie){I.tidy(function(){var ge=I.add(I.linspace(0,7180,360),I.tensor(1997.379408437619));L.running=!0;var Ae=I.tensor(ie.slice(0,1024)),Ie=I.sub(Ae,I.mean(Ae)),De=I.tensor(I.norm(Ie).dataSync()/Math.sqrt(1024)),et=I.div(Ie,De).reshape([1,1024]),ot=L.model.predict([et]).reshape([360]),zt=ot.max().dataSync()[0],Ht=ot.argMax().dataSync()[0];L.results.confidence=zt.toFixed(3);var xn=Math.max(0,Ht-4),En=Math.min(360,Ht+5),Fn=ot.slice([xn],[En-xn]),Rn=ge.slice([xn],[En-xn]),Wn=I.mul(Fn,Rn).dataSync().reduce(function(_r,Nr){return _r+Nr},0)/Fn.dataSync().reduce(function(_r,Nr){return _r+Nr},0),Jn=10*Math.pow(2,Wn/1200),Tn=zt>.5?Jn:null;L.frequency=Tn})});case 4:case"end":return J.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"getPitch",value:function(){var M=q()(me.a.mark(function T(O){var L;return me.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,this.ready;case 2:return J.next=4,I.nextFrame();case 4:return L=this.frequency,O&&O(void 0,L),J.abrupt("return",L);case 7:case"end":return J.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()}],[{key:"resample",value:function(M,T){for(var O=M.sampleRate%16e3!=0,L=M.sampleRate/16e3,J=M.getChannelData(0),ie=new Float32Array(1024),ge=0;ge<1024;ge+=1)if(O){var Ae=Math.floor(ge*L),Ie=Ae+1,De=ge*L-Ae;ie[ge]=(1-De)*J[Ae]+De*J[Ie]}else ie[ge]=J[ge*L];T(ie)}}]),$}(),It=function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"./",M=arguments.length>1?arguments[1]:void 0,T=arguments.length>2?arguments[2]:void 0,O=arguments.length>3?arguments[3]:void 0;return new lt($,M,T,O)},wt=r(7),we=r.n(wt),yt=r(17),Bt=r.n(yt),Ot=r(20),ze=r(0);function Ut($,M,T,O){return new(T||(T=Promise))(function(L,J){function ie(Ie){try{Ae(O.next(Ie))}catch(De){J(De)}}function ge(Ie){try{Ae(O.throw(Ie))}catch(De){J(De)}}function Ae(Ie){Ie.done?L(Ie.value):new T(function(De){De(Ie.value)}).then(ie,ge)}Ae((O=O.apply($,M||[])).next())})}function Ft($,M){var T,O,L,J,ie={label:0,sent:function(){if(1&L[0])throw L[1];return L[1]},trys:[],ops:[]};return J={next:ge(0),throw:ge(1),return:ge(2)},typeof Symbol=="function"&&(J[Symbol.iterator]=function(){return this}),J;function ge(Ae){return function(Ie){return function(De){if(T)throw new TypeError("Generator is already executing.");for(;ie;)try{if(T=1,O&&(L=2&De[0]?O.return:De[0]?O.throw||((L=O.return)&&L.call(O),0):O.next)&&!(L=L.call(O,De[1])).done)return L;switch(O=0,L&&(De=[2&De[0],L.value]),De[0]){case 0:case 1:L=De;break;case 4:return ie.label++,{value:De[1],done:!1};case 5:ie.label++,O=De[1],De=[0];continue;case 7:De=ie.ops.pop(),ie.trys.pop();continue;default:if(!(L=(L=ie.trys).length>0&&L[L.length-1])&&(De[0]===6||De[0]===2)){ie=0;continue}if(De[0]===3&&(!L||De[1]>L[0]&&De[1]<L[3])){ie.label=De[1];break}if(De[0]===6&&ie.label<L[1]){ie.label=L[1],L=De;break}if(L&&ie.label<L[2]){ie.label=L[2],ie.ops.push(De);break}L[2]&&ie.ops.pop(),ie.trys.pop();continue}De=M.call($,ie)}catch(et){De=[6,et],O=0}finally{T=L=0}if(5&De[0])throw De[1];return{value:De[0]?De[1]:void 0,done:!0}}([Ae,Ie])}}}var pt={0:"tench, Tinca tinca",1:"goldfish, Carassius auratus",2:"great white shark, white shark, man-eater, man-eating shark, Carcharodon carcharias",3:"tiger shark, Galeocerdo cuvieri",4:"hammerhead, hammerhead shark",5:"electric ray, crampfish, numbfish, torpedo",6:"stingray",7:"cock",8:"hen",9:"ostrich, Struthio camelus",10:"brambling, Fringilla montifringilla",11:"goldfinch, Carduelis carduelis",12:"house finch, linnet, Carpodacus mexicanus",13:"junco, snowbird",14:"indigo bunting, indigo finch, indigo bird, Passerina cyanea",15:"robin, American robin, Turdus migratorius",16:"bulbul",17:"jay",18:"magpie",19:"chickadee",20:"water ouzel, dipper",21:"kite",22:"bald eagle, American eagle, Haliaeetus leucocephalus",23:"vulture",24:"great grey owl, great gray owl, Strix nebulosa",25:"European fire salamander, Salamandra salamandra",26:"common newt, Triturus vulgaris",27:"eft",28:"spotted salamander, Ambystoma maculatum",29:"axolotl, mud puppy, Ambystoma mexicanum",30:"bullfrog, Rana catesbeiana",31:"tree frog, tree-frog",32:"tailed frog, bell toad, ribbed toad, tailed toad, Ascaphus trui",33:"loggerhead, loggerhead turtle, Caretta caretta",34:"leatherback turtle, leatherback, leathery turtle, Dermochelys coriacea",35:"mud turtle",36:"terrapin",37:"box turtle, box tortoise",38:"banded gecko",39:"common iguana, iguana, Iguana iguana",40:"American chameleon, anole, Anolis carolinensis",41:"whiptail, whiptail lizard",42:"agama",43:"frilled lizard, Chlamydosaurus kingi",44:"alligator lizard",45:"Gila monster, Heloderma suspectum",46:"green lizard, Lacerta viridis",47:"African chameleon, Chamaeleo chamaeleon",48:"Komodo dragon, Komodo lizard, dragon lizard, giant lizard, Varanus komodoensis",49:"African crocodile, Nile crocodile, Crocodylus niloticus",50:"American alligator, Alligator mississipiensis",51:"triceratops",52:"thunder snake, worm snake, Carphophis amoenus",53:"ringneck snake, ring-necked snake, ring snake",54:"hognose snake, puff adder, sand viper",55:"green snake, grass snake",56:"king snake, kingsnake",57:"garter snake, grass snake",58:"water snake",59:"vine snake",60:"night snake, Hypsiglena torquata",61:"boa constrictor, Constrictor constrictor",62:"rock python, rock snake, Python sebae",63:"Indian cobra, Naja naja",64:"green mamba",65:"sea snake",66:"horned viper, cerastes, sand viper, horned asp, Cerastes cornutus",67:"diamondback, diamondback rattlesnake, Crotalus adamanteus",68:"sidewinder, horned rattlesnake, Crotalus cerastes",69:"trilobite",70:"harvestman, daddy longlegs, Phalangium opilio",71:"scorpion",72:"black and gold garden spider, Argiope aurantia",73:"barn spider, Araneus cavaticus",74:"garden spider, Aranea diademata",75:"black widow, Latrodectus mactans",76:"tarantula",77:"wolf spider, hunting spider",78:"tick",79:"centipede",80:"black grouse",81:"ptarmigan",82:"ruffed grouse, partridge, Bonasa umbellus",83:"prairie chicken, prairie grouse, prairie fowl",84:"peacock",85:"quail",86:"partridge",87:"African grey, African gray, Psittacus erithacus",88:"macaw",89:"sulphur-crested cockatoo, Kakatoe galerita, Cacatua galerita",90:"lorikeet",91:"coucal",92:"bee eater",93:"hornbill",94:"hummingbird",95:"jacamar",96:"toucan",97:"drake",98:"red-breasted merganser, Mergus serrator",99:"goose",100:"black swan, Cygnus atratus",101:"tusker",102:"echidna, spiny anteater, anteater",103:"platypus, duckbill, duckbilled platypus, duck-billed platypus, Ornithorhynchus anatinus",104:"wallaby, brush kangaroo",105:"koala, koala bear, kangaroo bear, native bear, Phascolarctos cinereus",106:"wombat",107:"jelly fish",108:"sea anemone, anemone",109:"brain coral",110:"flatworm, platyhelminth",111:"nematode, nematode worm, roundworm",112:"conch",113:"snail",114:"slug",115:"sea slug, nudibranch",116:"chiton, coat-of-mail shell, sea cradle, polyplacophore",117:"chambered nautilus, pearly nautilus, nautilus",118:"Dungeness crab, Cancer magister",119:"rock crab, Cancer irroratus",120:"fiddler crab",121:"king crab, Alaska crab, Alaskan king crab, Alaska king crab, Paralithodes camtschatica",122:"American lobster, Northern lobster, Maine lobster, Homarus americanus",123:"spiny lobster, langouste, rock lobster, crawfish, crayfish, sea crawfish",124:"crayfish, crawfish, crawdad, crawdaddy",125:"hermit crab",126:"isopod",127:"white stork, Ciconia ciconia",128:"black stork, Ciconia nigra",129:"spoonbill",130:"flamingo",131:"little blue heron, Egretta caerulea",132:"American egret, great white heron, Egretta albus",133:"bittern",134:"crane",135:"limpkin, Aramus pictus",136:"European gallinule, Porphyrio porphyrio",137:"American coot, marsh hen, mud hen, water hen, Fulica americana",138:"bustard",139:"ruddy turnstone, Arenaria interpres",140:"red-backed sandpiper, dunlin, Erolia alpina",141:"redshank, Tringa totanus",142:"dowitcher",143:"oystercatcher, oyster catcher",144:"pelican",145:"king penguin, Aptenodytes patagonica",146:"albatross, mollymawk",147:"grey whale, gray whale, devilfish, Eschrichtius gibbosus, Eschrichtius robustus",148:"killer whale, killer, orca, grampus, sea wolf, Orcinus orca",149:"dugong, Dugong dugon",150:"sea lion",151:"Chihuahua",152:"Japanese spaniel",153:"Maltese dog, Maltese terrier, Maltese",154:"Pekinese, Pekingese, Peke",155:"Shih-Tzu",156:"Blenheim spaniel",157:"papillon",158:"toy terrier",159:"Rhodesian ridgeback",160:"Afghan hound, Afghan",161:"basset, basset hound",162:"beagle",163:"bloodhound, sleuthhound",164:"bluetick",165:"black-and-tan coonhound",166:"Walker hound, Walker foxhound",167:"English foxhound",168:"redbone",169:"borzoi, Russian wolfhound",170:"Irish wolfhound",171:"Italian greyhound",172:"whippet",173:"Ibizan hound, Ibizan Podenco",174:"Norwegian elkhound, elkhound",175:"otterhound, otter hound",176:"Saluki, gazelle hound",177:"Scottish deerhound, deerhound",178:"Weimaraner",179:"Staffordshire bullterrier, Staffordshire bull terrier",180:"American Staffordshire terrier, Staffordshire terrier, American pit bull terrier, pit bull terrier",181:"Bedlington terrier",182:"Border terrier",183:"Kerry blue terrier",184:"Irish terrier",185:"Norfolk terrier",186:"Norwich terrier",187:"Yorkshire terrier",188:"wire-haired fox terrier",189:"Lakeland terrier",190:"Sealyham terrier, Sealyham",191:"Airedale, Airedale terrier",192:"cairn, cairn terrier",193:"Australian terrier",194:"Dandie Dinmont, Dandie Dinmont terrier",195:"Boston bull, Boston terrier",196:"miniature schnauzer",197:"giant schnauzer",198:"standard schnauzer",199:"Scotch terrier, Scottish terrier, Scottie",200:"Tibetan terrier, chrysanthemum dog",201:"silky terrier, Sydney silky",202:"soft-coated wheaten terrier",203:"West Highland white terrier",204:"Lhasa, Lhasa apso",205:"flat-coated retriever",206:"curly-coated retriever",207:"golden retriever",208:"Labrador retriever",209:"Chesapeake Bay retriever",210:"German short-haired pointer",211:"vizsla, Hungarian pointer",212:"English setter",213:"Irish setter, red setter",214:"Gordon setter",215:"Brittany spaniel",216:"clumber, clumber spaniel",217:"English springer, English springer spaniel",218:"Welsh springer spaniel",219:"cocker spaniel, English cocker spaniel, cocker",220:"Sussex spaniel",221:"Irish water spaniel",222:"kuvasz",223:"schipperke",224:"groenendael",225:"malinois",226:"briard",227:"kelpie",228:"komondor",229:"Old English sheepdog, bobtail",230:"Shetland sheepdog, Shetland sheep dog, Shetland",231:"collie",232:"Border collie",233:"Bouvier des Flandres, Bouviers des Flandres",234:"Rottweiler",235:"German shepherd, German shepherd dog, German police dog, alsatian",236:"Doberman, Doberman pinscher",237:"miniature pinscher",238:"Greater Swiss Mountain dog",239:"Bernese mountain dog",240:"Appenzeller",241:"EntleBucher",242:"boxer",243:"bull mastiff",244:"Tibetan mastiff",245:"French bulldog",246:"Great Dane",247:"Saint Bernard, St Bernard",248:"Eskimo dog, husky",249:"malamute, malemute, Alaskan malamute",250:"Siberian husky",251:"dalmatian, coach dog, carriage dog",252:"affenpinscher, monkey pinscher, monkey dog",253:"basenji",254:"pug, pug-dog",255:"Leonberg",256:"Newfoundland, Newfoundland dog",257:"Great Pyrenees",258:"Samoyed, Samoyede",259:"Pomeranian",260:"chow, chow chow",261:"keeshond",262:"Brabancon griffon",263:"Pembroke, Pembroke Welsh corgi",264:"Cardigan, Cardigan Welsh corgi",265:"toy poodle",266:"miniature poodle",267:"standard poodle",268:"Mexican hairless",269:"timber wolf, grey wolf, gray wolf, Canis lupus",270:"white wolf, Arctic wolf, Canis lupus tundrarum",271:"red wolf, maned wolf, Canis rufus, Canis niger",272:"coyote, prairie wolf, brush wolf, Canis latrans",273:"dingo, warrigal, warragal, Canis dingo",274:"dhole, Cuon alpinus",275:"African hunting dog, hyena dog, Cape hunting dog, Lycaon pictus",276:"hyena, hyaena",277:"red fox, Vulpes vulpes",278:"kit fox, Vulpes macrotis",279:"Arctic fox, white fox, Alopex lagopus",280:"grey fox, gray fox, Urocyon cinereoargenteus",281:"tabby, tabby cat",282:"tiger cat",283:"Persian cat",284:"Siamese cat, Siamese",285:"Egyptian cat",286:"cougar, puma, catamount, mountain lion, painter, panther, Felis concolor",287:"lynx, catamount",288:"leopard, Panthera pardus",289:"snow leopard, ounce, Panthera uncia",290:"jaguar, panther, Panthera onca, Felis onca",291:"lion, king of beasts, Panthera leo",292:"tiger, Panthera tigris",293:"cheetah, chetah, Acinonyx jubatus",294:"brown bear, bruin, Ursus arctos",295:"American black bear, black bear, Ursus americanus, Euarctos americanus",296:"ice bear, polar bear, Ursus Maritimus, Thalarctos maritimus",297:"sloth bear, Melursus ursinus, Ursus ursinus",298:"mongoose",299:"meerkat, mierkat",300:"tiger beetle",301:"ladybug, ladybeetle, lady beetle, ladybird, ladybird beetle",302:"ground beetle, carabid beetle",303:"long-horned beetle, longicorn, longicorn beetle",304:"leaf beetle, chrysomelid",305:"dung beetle",306:"rhinoceros beetle",307:"weevil",308:"fly",309:"bee",310:"ant, emmet, pismire",311:"grasshopper, hopper",312:"cricket",313:"walking stick, walkingstick, stick insect",314:"cockroach, roach",315:"mantis, mantid",316:"cicada, cicala",317:"leafhopper",318:"lacewing, lacewing fly",319:"dragonfly, darning needle, devil's darning needle, sewing needle, snake feeder, snake doctor, mosquito hawk, skeeter hawk",320:"damselfly",321:"admiral",322:"ringlet, ringlet butterfly",323:"monarch, monarch butterfly, milkweed butterfly, Danaus plexippus",324:"cabbage butterfly",325:"sulphur butterfly, sulfur butterfly",326:"lycaenid, lycaenid butterfly",327:"starfish, sea star",328:"sea urchin",329:"sea cucumber, holothurian",330:"wood rabbit, cottontail, cottontail rabbit",331:"hare",332:"Angora, Angora rabbit",333:"hamster",334:"porcupine, hedgehog",335:"fox squirrel, eastern fox squirrel, Sciurus niger",336:"marmot",337:"beaver",338:"guinea pig, Cavia cobaya",339:"sorrel",340:"zebra",341:"hog, pig, grunter, squealer, Sus scrofa",342:"wild boar, boar, Sus scrofa",343:"warthog",344:"hippopotamus, hippo, river horse, Hippopotamus amphibius",345:"ox",346:"water buffalo, water ox, Asiatic buffalo, Bubalus bubalis",347:"bison",348:"ram, tup",349:"bighorn, bighorn sheep, cimarron, Rocky Mountain bighorn, Rocky Mountain sheep, Ovis canadensis",350:"ibex, Capra ibex",351:"hartebeest",352:"impala, Aepyceros melampus",353:"gazelle",354:"Arabian camel, dromedary, Camelus dromedarius",355:"llama",356:"weasel",357:"mink",358:"polecat, fitch, foulmart, foumart, Mustela putorius",359:"black-footed ferret, ferret, Mustela nigripes",360:"otter",361:"skunk, polecat, wood pussy",362:"badger",363:"armadillo",364:"three-toed sloth, ai, Bradypus tridactylus",365:"orangutan, orang, orangutang, Pongo pygmaeus",366:"gorilla, Gorilla gorilla",367:"chimpanzee, chimp, Pan troglodytes",368:"gibbon, Hylobates lar",369:"siamang, Hylobates syndactylus, Symphalangus syndactylus",370:"guenon, guenon monkey",371:"patas, hussar monkey, Erythrocebus patas",372:"baboon",373:"macaque",374:"langur",375:"colobus, colobus monkey",376:"proboscis monkey, Nasalis larvatus",377:"marmoset",378:"capuchin, ringtail, Cebus capucinus",379:"howler monkey, howler",380:"titi, titi monkey",381:"spider monkey, Ateles geoffroyi",382:"squirrel monkey, Saimiri sciureus",383:"Madagascar cat, ring-tailed lemur, Lemur catta",384:"indri, indris, Indri indri, Indri brevicaudatus",385:"Indian elephant, Elephas maximus",386:"African elephant, Loxodonta africana",387:"lesser panda, red panda, panda, bear cat, cat bear, Ailurus fulgens",388:"giant panda, panda, panda bear, coon bear, Ailuropoda melanoleuca",389:"barracouta, snoek",390:"eel",391:"coho, cohoe, coho salmon, blue jack, silver salmon, Oncorhynchus kisutch",392:"rock beauty, Holocanthus tricolor",393:"anemone fish",394:"sturgeon",395:"gar, garfish, garpike, billfish, Lepisosteus osseus",396:"lionfish",397:"puffer, pufferfish, blowfish, globefish",398:"abacus",399:"abaya",400:"academic gown, academic robe, judge's robe",401:"accordion, piano accordion, squeeze box",402:"acoustic guitar",403:"aircraft carrier, carrier, flattop, attack aircraft carrier",404:"airliner",405:"airship, dirigible",406:"altar",407:"ambulance",408:"amphibian, amphibious vehicle",409:"analog clock",410:"apiary, bee house",411:"apron",412:"ashcan, trash can, garbage can, wastebin, ash bin, ash-bin, ashbin, dustbin, trash barrel, trash bin",413:"assault rifle, assault gun",414:"backpack, back pack, knapsack, packsack, rucksack, haversack",415:"bakery, bakeshop, bakehouse",416:"balance beam, beam",417:"balloon",418:"ballpoint, ballpoint pen, ballpen, Biro",419:"Band Aid",420:"banjo",421:"bannister, banister, balustrade, balusters, handrail",422:"barbell",423:"barber chair",424:"barbershop",425:"barn",426:"barometer",427:"barrel, cask",428:"barrow, garden cart, lawn cart, wheelbarrow",429:"baseball",430:"basketball",431:"bassinet",432:"bassoon",433:"bathing cap, swimming cap",434:"bath towel",435:"bathtub, bathing tub, bath, tub",436:"beach wagon, station wagon, wagon, estate car, beach waggon, station waggon, waggon",437:"beacon, lighthouse, beacon light, pharos",438:"beaker",439:"bearskin, busby, shako",440:"beer bottle",441:"beer glass",442:"bell cote, bell cot",443:"bib",444:"bicycle-built-for-two, tandem bicycle, tandem",445:"bikini, two-piece",446:"binder, ring-binder",447:"binoculars, field glasses, opera glasses",448:"birdhouse",449:"boathouse",450:"bobsled, bobsleigh, bob",451:"bolo tie, bolo, bola tie, bola",452:"bonnet, poke bonnet",453:"bookcase",454:"bookshop, bookstore, bookstall",455:"bottlecap",456:"bow",457:"bow tie, bow-tie, bowtie",458:"brass, memorial tablet, plaque",459:"brassiere, bra, bandeau",460:"breakwater, groin, groyne, mole, bulwark, seawall, jetty",461:"breastplate, aegis, egis",462:"broom",463:"bucket, pail",464:"buckle",465:"bulletproof vest",466:"bullet train, bullet",467:"butcher shop, meat market",468:"cab, hack, taxi, taxicab",469:"caldron, cauldron",470:"candle, taper, wax light",471:"cannon",472:"canoe",473:"can opener, tin opener",474:"cardigan",475:"car mirror",476:"carousel, carrousel, merry-go-round, roundabout, whirligig",477:"carpenter's kit, tool kit",478:"carton",479:"car wheel",480:"cash machine, cash dispenser, automated teller machine, automatic teller machine, automated teller, automatic teller, ATM",481:"cassette",482:"cassette player",483:"castle",484:"catamaran",485:"CD player",486:"cello, violoncello",487:"cellular telephone, cellular phone, cellphone, cell, mobile phone",488:"chain",489:"chainlink fence",490:"chain mail, ring mail, mail, chain armor, chain armour, ring armor, ring armour",491:"chain saw, chainsaw",492:"chest",493:"chiffonier, commode",494:"chime, bell, gong",495:"china cabinet, china closet",496:"Christmas stocking",497:"church, church building",498:"cinema, movie theater, movie theatre, movie house, picture palace",499:"cleaver, meat cleaver, chopper",500:"cliff dwelling",501:"cloak",502:"clog, geta, patten, sabot",503:"cocktail shaker",504:"coffee mug",505:"coffeepot",506:"coil, spiral, volute, whorl, helix",507:"combination lock",508:"computer keyboard, keypad",509:"confectionery, confectionary, candy store",510:"container ship, containership, container vessel",511:"convertible",512:"corkscrew, bottle screw",513:"cornet, horn, trumpet, trump",514:"cowboy boot",515:"cowboy hat, ten-gallon hat",516:"cradle",517:"crane",518:"crash helmet",519:"crate",520:"crib, cot",521:"Crock Pot",522:"croquet ball",523:"crutch",524:"cuirass",525:"dam, dike, dyke",526:"desk",527:"desktop computer",528:"dial telephone, dial phone",529:"diaper, nappy, napkin",530:"digital clock",531:"digital watch",532:"dining table, board",533:"dishrag, dishcloth",534:"dishwasher, dish washer, dishwashing machine",535:"disk brake, disc brake",536:"dock, dockage, docking facility",537:"dogsled, dog sled, dog sleigh",538:"dome",539:"doormat, welcome mat",540:"drilling platform, offshore rig",541:"drum, membranophone, tympan",542:"drumstick",543:"dumbbell",544:"Dutch oven",545:"electric fan, blower",546:"electric guitar",547:"electric locomotive",548:"entertainment center",549:"envelope",550:"espresso maker",551:"face powder",552:"feather boa, boa",553:"file, file cabinet, filing cabinet",554:"fireboat",555:"fire engine, fire truck",556:"fire screen, fireguard",557:"flagpole, flagstaff",558:"flute, transverse flute",559:"folding chair",560:"football helmet",561:"forklift",562:"fountain",563:"fountain pen",564:"four-poster",565:"freight car",566:"French horn, horn",567:"frying pan, frypan, skillet",568:"fur coat",569:"garbage truck, dustcart",570:"gasmask, respirator, gas helmet",571:"gas pump, gasoline pump, petrol pump, island dispenser",572:"goblet",573:"go-kart",574:"golf ball",575:"golfcart, golf cart",576:"gondola",577:"gong, tam-tam",578:"gown",579:"grand piano, grand",580:"greenhouse, nursery, glasshouse",581:"grille, radiator grille",582:"grocery store, grocery, food market, market",583:"guillotine",584:"hair slide",585:"hair spray",586:"half track",587:"hammer",588:"hamper",589:"hand blower, blow dryer, blow drier, hair dryer, hair drier",590:"hand-held computer, hand-held microcomputer",591:"handkerchief, hankie, hanky, hankey",592:"hard disc, hard disk, fixed disk",593:"harmonica, mouth organ, harp, mouth harp",594:"harp",595:"harvester, reaper",596:"hatchet",597:"holster",598:"home theater, home theatre",599:"honeycomb",600:"hook, claw",601:"hoopskirt, crinoline",602:"horizontal bar, high bar",603:"horse cart, horse-cart",604:"hourglass",605:"iPod",606:"iron, smoothing iron",607:"jack-o'-lantern",608:"jean, blue jean, denim",609:"jeep, landrover",610:"jersey, T-shirt, tee shirt",611:"jigsaw puzzle",612:"jinrikisha, ricksha, rickshaw",613:"joystick",614:"kimono",615:"knee pad",616:"knot",617:"lab coat, laboratory coat",618:"ladle",619:"lampshade, lamp shade",620:"laptop, laptop computer",621:"lawn mower, mower",622:"lens cap, lens cover",623:"letter opener, paper knife, paperknife",624:"library",625:"lifeboat",626:"lighter, light, igniter, ignitor",627:"limousine, limo",628:"liner, ocean liner",629:"lipstick, lip rouge",630:"Loafer",631:"lotion",632:"loudspeaker, speaker, speaker unit, loudspeaker system, speaker system",633:"loupe, jeweler's loupe",634:"lumbermill, sawmill",635:"magnetic compass",636:"mailbag, postbag",637:"mailbox, letter box",638:"maillot",639:"maillot, tank suit",640:"manhole cover",641:"maraca",642:"marimba, xylophone",643:"mask",644:"matchstick",645:"maypole",646:"maze, labyrinth",647:"measuring cup",648:"medicine chest, medicine cabinet",649:"megalith, megalithic structure",650:"microphone, mike",651:"microwave, microwave oven",652:"military uniform",653:"milk can",654:"minibus",655:"miniskirt, mini",656:"minivan",657:"missile",658:"mitten",659:"mixing bowl",660:"mobile home, manufactured home",661:"Model T",662:"modem",663:"monastery",664:"monitor",665:"moped",666:"mortar",667:"mortarboard",668:"mosque",669:"mosquito net",670:"motor scooter, scooter",671:"mountain bike, all-terrain bike, off-roader",672:"mountain tent",673:"mouse, computer mouse",674:"mousetrap",675:"moving van",676:"muzzle",677:"nail",678:"neck brace",679:"necklace",680:"nipple",681:"notebook, notebook computer",682:"obelisk",683:"oboe, hautboy, hautbois",684:"ocarina, sweet potato",685:"odometer, hodometer, mileometer, milometer",686:"oil filter",687:"organ, pipe organ",688:"oscilloscope, scope, cathode-ray oscilloscope, CRO",689:"overskirt",690:"oxcart",691:"oxygen mask",692:"packet",693:"paddle, boat paddle",694:"paddlewheel, paddle wheel",695:"padlock",696:"paintbrush",697:"pajama, pyjama, pj's, jammies",698:"palace",699:"panpipe, pandean pipe, syrinx",700:"paper towel",701:"parachute, chute",702:"parallel bars, bars",703:"park bench",704:"parking meter",705:"passenger car, coach, carriage",706:"patio, terrace",707:"pay-phone, pay-station",708:"pedestal, plinth, footstall",709:"pencil box, pencil case",710:"pencil sharpener",711:"perfume, essence",712:"Petri dish",713:"photocopier",714:"pick, plectrum, plectron",715:"pickelhaube",716:"picket fence, paling",717:"pickup, pickup truck",718:"pier",719:"piggy bank, penny bank",720:"pill bottle",721:"pillow",722:"ping-pong ball",723:"pinwheel",724:"pirate, pirate ship",725:"pitcher, ewer",726:"plane, carpenter's plane, woodworking plane",727:"planetarium",728:"plastic bag",729:"plate rack",730:"plow, plough",731:"plunger, plumber's helper",732:"Polaroid camera, Polaroid Land camera",733:"pole",734:"police van, police wagon, paddy wagon, patrol wagon, wagon, black Maria",735:"poncho",736:"pool table, billiard table, snooker table",737:"pop bottle, soda bottle",738:"pot, flowerpot",739:"potter's wheel",740:"power drill",741:"prayer rug, prayer mat",742:"printer",743:"prison, prison house",744:"projectile, missile",745:"projector",746:"puck, hockey puck",747:"punching bag, punch bag, punching ball, punchball",748:"purse",749:"quill, quill pen",750:"quilt, comforter, comfort, puff",751:"racer, race car, racing car",752:"racket, racquet",753:"radiator",754:"radio, wireless",755:"radio telescope, radio reflector",756:"rain barrel",757:"recreational vehicle, RV, R.V.",758:"reel",759:"reflex camera",760:"refrigerator, icebox",761:"remote control, remote",762:"restaurant, eating house, eating place, eatery",763:"revolver, six-gun, six-shooter",764:"rifle",765:"rocking chair, rocker",766:"rotisserie",767:"rubber eraser, rubber, pencil eraser",768:"rugby ball",769:"rule, ruler",770:"running shoe",771:"safe",772:"safety pin",773:"saltshaker, salt shaker",774:"sandal",775:"sarong",776:"sax, saxophone",777:"scabbard",778:"scale, weighing machine",779:"school bus",780:"schooner",781:"scoreboard",782:"screen, CRT screen",783:"screw",784:"screwdriver",785:"seat belt, seatbelt",786:"sewing machine",787:"shield, buckler",788:"shoe shop, shoe-shop, shoe store",789:"shoji",790:"shopping basket",791:"shopping cart",792:"shovel",793:"shower cap",794:"shower curtain",795:"ski",796:"ski mask",797:"sleeping bag",798:"slide rule, slipstick",799:"sliding door",800:"slot, one-armed bandit",801:"snorkel",802:"snowmobile",803:"snowplow, snowplough",804:"soap dispenser",805:"soccer ball",806:"sock",807:"solar dish, solar collector, solar furnace",808:"sombrero",809:"soup bowl",810:"space bar",811:"space heater",812:"space shuttle",813:"spatula",814:"speedboat",815:"spider web, spider's web",816:"spindle",817:"sports car, sport car",818:"spotlight, spot",819:"stage",820:"steam locomotive",821:"steel arch bridge",822:"steel drum",823:"stethoscope",824:"stole",825:"stone wall",826:"stopwatch, stop watch",827:"stove",828:"strainer",829:"streetcar, tram, tramcar, trolley, trolley car",830:"stretcher",831:"studio couch, day bed",832:"stupa, tope",833:"submarine, pigboat, sub, U-boat",834:"suit, suit of clothes",835:"sundial",836:"sunglass",837:"sunglasses, dark glasses, shades",838:"sunscreen, sunblock, sun blocker",839:"suspension bridge",840:"swab, swob, mop",841:"sweatshirt",842:"swimming trunks, bathing trunks",843:"swing",844:"switch, electric switch, electrical switch",845:"syringe",846:"table lamp",847:"tank, army tank, armored combat vehicle, armoured combat vehicle",848:"tape player",849:"teapot",850:"teddy, teddy bear",851:"television, television system",852:"tennis ball",853:"thatch, thatched roof",854:"theater curtain, theatre curtain",855:"thimble",856:"thresher, thrasher, threshing machine",857:"throne",858:"tile roof",859:"toaster",860:"tobacco shop, tobacconist shop, tobacconist",861:"toilet seat",862:"torch",863:"totem pole",864:"tow truck, tow car, wrecker",865:"toyshop",866:"tractor",867:"trailer truck, tractor trailer, trucking rig, rig, articulated lorry, semi",868:"tray",869:"trench coat",870:"tricycle, trike, velocipede",871:"trimaran",872:"tripod",873:"triumphal arch",874:"trolleybus, trolley coach, trackless trolley",875:"trombone",876:"tub, vat",877:"turnstile",878:"typewriter keyboard",879:"umbrella",880:"unicycle, monocycle",881:"upright, upright piano",882:"vacuum, vacuum cleaner",883:"vase",884:"vault",885:"velvet",886:"vending machine",887:"vestment",888:"viaduct",889:"violin, fiddle",890:"volleyball",891:"waffle iron",892:"wall clock",893:"wallet, billfold, notecase, pocketbook",894:"wardrobe, closet, press",895:"warplane, military plane",896:"washbasin, handbasin, washbowl, lavabo, wash-hand basin",897:"washer, automatic washer, washing machine",898:"water bottle",899:"water jug",900:"water tower",901:"whiskey jug",902:"whistle",903:"wig",904:"window screen",905:"window shade",906:"Windsor tie",907:"wine bottle",908:"wing",909:"wok",910:"wooden spoon",911:"wool, woolen, woollen",912:"worm fence, snake fence, snake-rail fence, Virginia fence",913:"wreck",914:"yawl",915:"yurt",916:"web site, website, internet site, site",917:"comic book",918:"crossword puzzle, crossword",919:"street sign",920:"traffic light, traffic signal, stoplight",921:"book jacket, dust cover, dust jacket, dust wrapper",922:"menu",923:"plate",924:"guacamole",925:"consomme",926:"hot pot, hotpot",927:"trifle",928:"ice cream, icecream",929:"ice lolly, lolly, lollipop, popsicle",930:"French loaf",931:"bagel, beigel",932:"pretzel",933:"cheeseburger",934:"hotdog, hot dog, red hot",935:"mashed potato",936:"head cabbage",937:"broccoli",938:"cauliflower",939:"zucchini, courgette",940:"spaghetti squash",941:"acorn squash",942:"butternut squash",943:"cucumber, cuke",944:"artichoke, globe artichoke",945:"bell pepper",946:"cardoon",947:"mushroom",948:"Granny Smith",949:"strawberry",950:"orange",951:"lemon",952:"fig",953:"pineapple, ananas",954:"banana",955:"jackfruit, jak, jack",956:"custard apple",957:"pomegranate",958:"hay",959:"carbonara",960:"chocolate sauce, chocolate syrup",961:"dough",962:"meat loaf, meatloaf",963:"pizza, pizza pie",964:"potpie",965:"burrito",966:"red wine",967:"espresso",968:"cup",969:"eggnog",970:"alp",971:"bubble",972:"cliff, drop, drop-off",973:"coral reef",974:"geyser",975:"lakeside, lakeshore",976:"promontory, headland, head, foreland",977:"sandbar, sand bar",978:"seashore, coast, seacoast, sea-coast",979:"valley, vale",980:"volcano",981:"ballplayer, baseball player",982:"groom, bridegroom",983:"scuba diver",984:"rapeseed",985:"daisy",986:"yellow lady's slipper, yellow lady-slipper, Cypripedium calceolus, Cypripedium parviflorum",987:"corn",988:"acorn",989:"hip, rose hip, rosehip",990:"buckeye, horse chestnut, conker",991:"coral fungus",992:"agaric",993:"gyromitra",994:"stinkhorn, carrion fungus",995:"earthstar",996:"hen-of-the-woods, hen of the woods, Polyporus frondosus, Grifola frondosa",997:"bolete",998:"ear, spike, capitulum",999:"toilet tissue, toilet paper, bathroom tissue"},vt={"1.00":"module_apply_default/MobilenetV1/Logits/global_pool","2.00":"module_apply_default/MobilenetV2/Logits/AvgPool"},rn={"1.00":{.25:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_025_224/classification/1",inputRange:[0,1]},"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_050_224/classification/1",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_075_224/classification/1",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_100_224/classification/1",inputRange:[0,1]}},"2.00":{"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_050_224/classification/2",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_075_224/classification/2",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/classification/2",inputRange:[0,1]}}};function xt($){return $===void 0&&($={version:1,alpha:1}),Ut(this,void 0,void 0,function(){var M,T,O,L,J,ie;return Ft(this,function(ge){switch(ge.label){case 0:if(ze==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");if(T=$.version.toFixed(2),O=$.alpha?$.alpha.toFixed(2):"",L=-1,J=1,$.modelUrl==null){if(!(T in rn))throw new Error("Invalid version of MobileNet. Valid versions are: "+Object.keys(rn));if(!(O in rn[T]))throw new Error("MobileNet constructed with invalid alpha "+$.alpha+". Valid multipliers for this version are: "+Object.keys(rn[T])+".");M=rn[T][O].inputRange,L=M[0],J=M[1]}return[4,(ie=new _t(T,O,$.modelUrl,L,J)).load()];case 1:return ge.sent(),[2,ie]}})})}var _t=function(){function $(M,T,O,L,J){L===void 0&&(L=-1),J===void 0&&(J=1),this.version=M,this.alpha=T,this.modelUrl=O,this.inputMin=L,this.inputMax=J,this.inputRange=J-L}return $.prototype.load=function(){return Ut(this,void 0,void 0,function(){var M,T,O,L,J=this;return Ft(this,function(ie){switch(ie.label){case 0:return this.modelUrl?(M=this,[4,Object(Ot.loadGraphModel)(this.modelUrl)]):[3,2];case 1:return M.model=ie.sent(),[3,4];case 2:return T=rn[this.version][this.alpha].url,O=this,[4,Object(Ot.loadGraphModel)(T,{fromTFHub:!0})];case 3:O.model=ie.sent(),ie.label=4;case 4:return[4,(L=Object(ze.tidy)(function(){return J.model.predict(Object(ze.zeros)([1,224,224,3]))})).data()];case 5:return ie.sent(),L.dispose(),[2]}})})},$.prototype.infer=function(M,T){var O=this;return T===void 0&&(T=!1),Object(ze.tidy)(function(){M instanceof ze.Tensor||(M=ze.browser.fromPixels(M));var L=M.toFloat().mul(O.inputRange).add(O.inputMin),J=L;M.shape[0]===224&&M.shape[1]===224||(J=ze.image.resizeBilinear(L,[224,224],!0));var ie,ge=J.reshape([-1,224,224,3]);if(T){var Ae=vt[O.version];ie=O.model.execute(ge,Ae).squeeze([1,2])}else ie=O.model.predict(ge).slice([0,1],[-1,1e3]);return ie})},$.prototype.classify=function(M,T){return T===void 0&&(T=3),Ut(this,void 0,void 0,function(){var O,L;return Ft(this,function(J){switch(J.label){case 0:return[4,function(ie,ge){return Ut(this,void 0,void 0,function(){var Ae,Ie,De,et,ot,zt,Ht;return Ft(this,function(xn){switch(xn.label){case 0:return[4,(Ae=ie.softmax()).data()];case 1:for(Ie=xn.sent(),Ae.dispose(),De=[],Ht=0;Ht<Ie.length;Ht++)De.push({value:Ie[Ht],index:Ht});for(De.sort(function(En,Fn){return Fn.value-En.value}),et=new Float32Array(ge),ot=new Int32Array(ge),Ht=0;Ht<ge;Ht++)et[Ht]=De[Ht].value,ot[Ht]=De[Ht].index;for(zt=[],Ht=0;Ht<ot.length;Ht++)zt.push({className:pt[ot[Ht]],probability:et[Ht]});return[2,zt]}})})}(O=this.infer(M),T)];case 1:return L=J.sent(),O.dispose(),[2,L]}})})},$}();function Xt($,M,T){for(var O=[],L=0;L<$.length;L+=1)O.push({value:$[L],index:L});O.sort(function(De,et){return et.value-De.value});for(var J=new Float32Array(M),ie=new Int32Array(M),ge=0;ge<M;ge+=1)J[ge]=O[ge].value,ie[ge]=O[ge].index;for(var Ae=[],Ie=0;Ie<ie.length;Ie+=1)Ae.push({className:T[ie[Ie]],probability:J[Ie]});return Ae}function sn($,M,T){return kn.apply(this,arguments)}function kn(){return(kn=q()(me.a.mark(function $(M,T,O){var L;return me.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,M.data();case 2:return L=J.sent,J.abrupt("return",Xt(L,T,O));case 4:case"end":return J.stop()}},$)}))).apply(this,arguments)}var an=["kit fox","English setter","Siberian husky","Australian terrier","English springer","grey whale","lesser panda","Egyptian cat","ibex","Persian cat","cougar","gazelle","porcupine","sea lion","malamute","badger","Great Dane","Walker hound","Welsh springer spaniel","whippet","Scottish deerhound","killer whale","mink","African elephant","Weimaraner","soft-coated wheaten terrier","Dandie Dinmont","red wolf","Old English sheepdog","jaguar","otterhound","bloodhound","Airedale","hyena","meerkat","giant schnauzer","titi","three-toed sloth","sorrel","black-footed ferret","dalmatian","black-and-tan coonhound","papillon","skunk","Staffordshire bullterrier","Mexican hairless","Bouvier des Flandres","weasel","miniature poodle","Cardigan","malinois","bighorn","fox squirrel","colobus","tiger cat","Lhasa","impala","coyote","Yorkshire terrier","Newfoundland","brown bear","red fox","Norwegian elkhound","Rottweiler","hartebeest","Saluki","grey fox","schipperke","Pekinese","Brabancon griffon","West Highland white terrier","Sealyham terrier","guenon","mongoose","indri","tiger","Irish wolfhound","wild boar","EntleBucher","zebra","ram","French bulldog","orangutan","basenji","leopard","Bernese mountain dog","Maltese dog","Norfolk terrier","toy terrier","vizsla","cairn","squirrel monkey","groenendael","clumber","Siamese cat","chimpanzee","komondor","Afghan hound","Japanese spaniel","proboscis monkey","guinea pig","white wolf","ice bear","gorilla","borzoi","toy poodle","Kerry blue terrier","ox","Scotch terrier","Tibetan mastiff","spider monkey","Doberman","Boston bull","Greater Swiss Mountain dog","Appenzeller","Shih-Tzu","Irish water spaniel","Pomeranian","Bedlington terrier","warthog","Arabian camel","siamang","miniature schnauzer","collie","golden retriever","Irish terrier","affenpinscher","Border collie","hare","boxer","silky terrier","beagle","Leonberg","German short-haired pointer","patas","dhole","baboon","macaque","Chesapeake Bay retriever","bull mastiff","kuvasz","capuchin","pug","curly-coated retriever","Norwich terrier","flat-coated retriever","hog","keeshond","Eskimo dog","Brittany spaniel","standard poodle","Lakeland terrier","snow leopard","Gordon setter","dingo","standard schnauzer","hamster","Tibetan terrier","Arctic fox","wire-haired fox terrier","basset","water buffalo","American black bear","Angora","bison","howler monkey","hippopotamus","chow","giant panda","American Staffordshire terrier","Shetland sheepdog","Great Pyrenees","Chihuahua","tabby","marmoset","Labrador retriever","Saint Bernard","armadillo","Samoyed","bluetick","redbone","polecat","marmot","kelpie","gibbon","llama","miniature pinscher","wood rabbit","Italian greyhound","lion","cocker spaniel","Irish setter","dugong","Indian elephant","beaver","Sussex spaniel","Pembroke","Blenheim spaniel","Madagascar cat","Rhodesian ridgeback","lynx","African hunting dog","langur","Ibizan hound","timber wolf","cheetah","English foxhound","briard","sloth bear","Border terrier","German shepherd","otter","koala","tusker","echidna","wallaby","platypus","wombat","revolver","umbrella","schooner","soccer ball","accordion","ant","starfish","chambered nautilus","grand piano","laptop","strawberry","airliner","warplane","airship","balloon","space shuttle","fireboat","gondola","speedboat","lifeboat","canoe","yawl","catamaran","trimaran","container ship","liner","pirate","aircraft carrier","submarine","wreck","half track","tank","missile","bobsled","dogsled","bicycle-built-for-two","mountain bike","freight car","passenger car","barrow","shopping cart","motor scooter","forklift","electric locomotive","steam locomotive","amphibian","ambulance","beach wagon","cab","convertible","jeep","limousine","minivan","Model T","racer","sports car","go-kart","golfcart","moped","snowplow","fire engine","garbage truck","pickup","tow truck","trailer truck","moving van","police van","recreational vehicle","streetcar","snowmobile","tractor","mobile home","tricycle","unicycle","horse cart","jinrikisha","oxcart","bassinet","cradle","crib","four-poster","bookcase","china cabinet","medicine chest","chiffonier","table lamp","file","park bench","barber chair","throne","folding chair","rocking chair","studio couch","toilet seat","desk","pool table","dining table","entertainment center","wardrobe","Granny Smith","orange","lemon","fig","pineapple","banana","jackfruit","custard apple","pomegranate","acorn","hip","ear","rapeseed","corn","buckeye","organ","upright","chime","drum","gong","maraca","marimba","steel drum","banjo","cello","violin","harp","acoustic guitar","electric guitar","cornet","French horn","trombone","harmonica","ocarina","panpipe","bassoon","oboe","sax","flute","daisy","yellow lady's slipper","cliff","valley","alp","volcano","promontory","sandbar","coral reef","lakeside","seashore","geyser","hatchet","cleaver","letter opener","plane","power drill","lawn mower","hammer","corkscrew","can opener","plunger","screwdriver","shovel","plow","chain saw","cock","hen","ostrich","brambling","goldfinch","house finch","junco","indigo bunting","robin","bulbul","jay","magpie","chickadee","water ouzel","kite","bald eagle","vulture","great grey owl","black grouse","ptarmigan","ruffed grouse","prairie chicken","peacock","quail","partridge","African grey","macaw","sulphur-crested cockatoo","lorikeet","coucal","bee eater","hornbill","hummingbird","jacamar","toucan","drake","red-breasted merganser","goose","black swan","white stork","black stork","spoonbill","flamingo","American egret","little blue heron","bittern","crane","limpkin","American coot","bustard","ruddy turnstone","red-backed sandpiper","redshank","dowitcher","oystercatcher","European gallinule","pelican","king penguin","albatross","great white shark","tiger shark","hammerhead","electric ray","stingray","barracouta","coho","tench","goldfish","eel","rock beauty","anemone fish","lionfish","puffer","sturgeon","gar","loggerhead","leatherback turtle","mud turtle","terrapin","box turtle","banded gecko","common iguana","American chameleon","whiptail","agama","frilled lizard","alligator lizard","Gila monster","green lizard","African chameleon","Komodo dragon","triceratops","African crocodile","American alligator","thunder snake","ringneck snake","hognose snake","green snake","king snake","garter snake","water snake","vine snake","night snake","boa constrictor","rock python","Indian cobra","green mamba","sea snake","horned viper","diamondback","sidewinder","European fire salamander","common newt","eft","spotted salamander","axolotl","bullfrog","tree frog","tailed frog","whistle","wing","paintbrush","hand blower","oxygen mask","snorkel","loudspeaker","microphone","screen","mouse","electric fan","oil filter","strainer","space heater","stove","guillotine","barometer","rule","odometer","scale","analog clock","digital clock","wall clock","hourglass","sundial","parking meter","stopwatch","digital watch","stethoscope","syringe","magnetic compass","binoculars","projector","sunglasses","loupe","radio telescope","bow","cannon","assault rifle","rifle","projectile","computer keyboard","typewriter keyboard","crane","lighter","abacus","cash machine","slide rule","desktop computer","hand-held computer","notebook","web site","harvester","thresher","printer","slot","vending machine","sewing machine","joystick","switch","hook","car wheel","paddlewheel","pinwheel","potter's wheel","gas pump","carousel","swing","reel","radiator","puck","hard disc","sunglass","pick","car mirror","solar dish","remote control","disk brake","buckle","hair slide","knot","combination lock","padlock","nail","safety pin","screw","muzzle","seat belt","ski","candle","jack-o'-lantern","spotlight","torch","neck brace","pier","tripod","maypole","mousetrap","spider web","trilobite","harvestman","scorpion","black and gold garden spider","barn spider","garden spider","black widow","tarantula","wolf spider","tick","centipede","isopod","Dungeness crab","rock crab","fiddler crab","king crab","American lobster","spiny lobster","crayfish","hermit crab","tiger beetle","ladybug","ground beetle","long-horned beetle","leaf beetle","dung beetle","rhinoceros beetle","weevil","fly","bee","grasshopper","cricket","walking stick","cockroach","mantis","cicada","leafhopper","lacewing","dragonfly","damselfly","admiral","ringlet","monarch","cabbage butterfly","sulphur butterfly","lycaenid","jellyfish","sea anemone","brain coral","flatworm","nematode","conch","snail","slug","sea slug","chiton","sea urchin","sea cucumber","iron","espresso maker","microwave","Dutch oven","rotisserie","toaster","waffle iron","vacuum","dishwasher","refrigerator","washer","Crock Pot","frying pan","wok","caldron","coffeepot","teapot","spatula","altar","triumphal arch","patio","steel arch bridge","suspension bridge","viaduct","barn","greenhouse","palace","monastery","library","apiary","boathouse","church","mosque","stupa","planetarium","restaurant","cinema","home theater","lumbermill","coil","obelisk","totem pole","castle","prison","grocery store","bakery","barbershop","bookshop","butcher shop","confectionery","shoe shop","tobacco shop","toyshop","fountain","cliff dwelling","yurt","dock","brass","megalith","bannister","breakwater","dam","chainlink fence","picket fence","worm fence","stone wall","grille","sliding door","turnstile","mountain tent","scoreboard","honeycomb","plate rack","pedestal","beacon","mashed potato","bell pepper","head cabbage","broccoli","cauliflower","zucchini","spaghetti squash","acorn squash","butternut squash","cucumber","artichoke","cardoon","mushroom","shower curtain","jean","carton","handkerchief","sandal","ashcan","safe","plate","necklace","croquet ball","fur coat","thimble","pajama","running shoe","cocktail shaker","chest","manhole cover","modem","tub","tray","balance beam","bagel","prayer rug","kimono","hot pot","whiskey jug","knee pad","book jacket","spindle","ski mask","beer bottle","crash helmet","bottlecap","tile roof","mask","maillot","Petri dish","football helmet","bathing cap","teddy","holster","pop bottle","photocopier","vestment","crossword puzzle","golf ball","trifle","suit","water tower","feather boa","cloak","red wine","drumstick","shield","Christmas stocking","hoopskirt","menu","stage","bonnet","meat loaf","baseball","face powder","scabbard","sunscreen","beer glass","hen-of-the-woods","guacamole","lampshade","wool","hay","bow tie","mailbag","water jug","bucket","dishrag","soup bowl","eggnog","mortar","trench coat","paddle","chain","swab","mixing bowl","potpie","wine bottle","shoji","bulletproof vest","drilling platform","binder","cardigan","sweatshirt","pot","birdhouse","hamper","ping-pong ball","pencil box","pay-phone","consomme","apron","punching bag","backpack","groom","bearskin","pencil sharpener","broom","mosquito net","abaya","mortarboard","poncho","crutch","Polaroid camera","space bar","cup","racket","traffic light","quill","radio","dough","cuirass","military uniform","lipstick","shower cap","monitor","oscilloscope","mitten","brassiere","French loaf","vase","milk can","rugby ball","paper towel","earthstar","envelope","miniskirt","cowboy hat","trolleybus","perfume","bathtub","hotdog","coral fungus","bullet train","pillow","toilet tissue","cassette","carpenter's kit","ladle","stinkhorn","lotion","hair spray","academic gown","dome","crate","wig","burrito","pill bottle","chain mail","theater curtain","window shade","barrel","washbasin","ballpoint","basketball","bath towel","cowboy boot","gown","window screen","agaric","cellular telephone","nipple","barbell","mailbox","lab coat","fire screen","minibus","packet","maze","pole","horizontal bar","sombrero","pickelhaube","rain barrel","wallet","cassette player","comic book","piggy bank","street sign","bell cote","fountain pen","Windsor tie","volleyball","overskirt","sarong","purse","bolo tie","bib","parachute","sleeping bag","television","swimming trunks","measuring cup","espresso","pizza","breastplate","shopping basket","wooden spoon","saltshaker","chocolate sauce","ballplayer","goblet","gyromitra","stretcher","water bottle","dial telephone","soap dispenser","jersey","school bus","jigsaw puzzle","plastic bag","reflex camera","diaper","Band Aid","ice lolly","velvet","tennis ball","gasmask","doormat","Loafer","ice cream","pretzel","quilt","maillot","tape player","clog","iPod","bolete","scuba diver","pitcher","matchstick","bikini","sock","CD player","lens cap","thatch","vault","beaker","bubble","cheeseburger","parallel bars","flagpole","coffee mug","rubber eraser","stole","carbonara","dumbbell"],Ve={DARKNET_URL:"https://cdn.jsdelivr.net/gh/ml5js/ml5-data-and-models@master/models/darknetclassifier/darknetreference/model.json",DARKNET_TINY_URL:"https://cdn.jsdelivr.net/gh/ml5js/ml5-data-and-models@master/models/darknetclassifier/darknettiny/model.json",IMAGE_SIZE_DARKNET:256,IMAGE_SIZE_DARKNET_TINY:224};function Ye($,M){var T;$ instanceof I.Tensor?T=$:$ instanceof HTMLImageElement||$ instanceof HTMLVideoElement||$ instanceof HTMLCanvasElement||$ instanceof ImageData?T=I.browser.fromPixels($):we()($)==="object"&&($.elt instanceof HTMLImageElement||$.elt instanceof HTMLVideoElement||$.elt instanceof HTMLCanvasElement||$.elt instanceof ImageData)&&(T=I.browser.fromPixels($.elt));var O=T.toFloat().div(I.scalar(255)),L=O;return(O.shape[0]!==M||O.shape[1]!==M)&&(L=I.image.resizeBilinear(O,[M,M],!0)),L.reshape([1,M,M,3])}var $e=function(){function $(M){switch(oe()(this,$),this.version=M,this.version){case"reference":this.imgSize=Ve.IMAGE_SIZE_DARKNET;break;case"tiny":this.imgSize=Ve.IMAGE_SIZE_DARKNET_TINY}}return _e()($,[{key:"load",value:function(){var M=q()(me.a.mark(function T(){var O,L=this;return me.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:J.t0=this.version,J.next=J.t0==="reference"?3:J.t0==="tiny"?7:11;break;case 3:return J.next=5,I.loadLayersModel(Ve.DARKNET_URL);case 5:return this.model=J.sent,J.abrupt("break",12);case 7:return J.next=9,I.loadLayersModel(Ve.DARKNET_TINY_URL);case 9:return this.model=J.sent,J.abrupt("break",12);case 11:return J.abrupt("break",12);case 12:return O=I.tidy(function(){return L.model.predict(I.zeros([1,L.imgSize,L.imgSize,3]))}),J.next=15,O.data();case 15:O.dispose();case 16:case"end":return J.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"classify",value:function(){var M=q()(me.a.mark(function T(O){var L,J,ie,ge=this,Ae=arguments;return me.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return L=Ae.length>1&&Ae[1]!==void 0?Ae[1]:3,J=I.tidy(function(){var De=Ye(O,ge.imgSize),et=ge.model.predict(De);return I.softmax(et)}),Ie.next=4,sn(J,L,an);case 4:return ie=Ie.sent,J.dispose(),Ie.abrupt("return",ie);case 7:case"end":return Ie.stop()}},T)}));return function(T){return M.apply(this,arguments)}}()}]),$}();function ft($){return $t.apply(this,arguments)}function $t(){return($t=q()(me.a.mark(function $(M){var T,O;return me.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if((T=M.version)==="reference"||T==="tiny"){L.next=3;break}throw new Error("Please select a version: darknet-reference or darknet-tiny");case 3:return O=new $e(T),L.next=6,O.load();case 6:return L.abrupt("return",O);case 7:case"end":return L.stop()}},$)}))).apply(this,arguments)}var Jt=r(23),Pn=r.n(Jt),An=["flashlight","belt","mushroom","pond","strawberry","pineapple","sun","cow","ear","bush","pliers","watermelon","apple","baseball","feather","shoe","leaf","lollipop","crown","ocean","horse","mountain","mosquito","mug","hospital","saw","castle","angel","underwear","traffic_light","cruise_ship","marker","blueberry","flamingo","face","hockey_stick","bucket","campfire","asparagus","skateboard","door","suitcase","skull","cloud","paint_can","hockey_puck","steak","house_plant","sleeping_bag","bench","snowman","arm","crayon","fan","shovel","leg","washing_machine","harp","toothbrush","tree","bear","rake","megaphone","knee","guitar","calculator","hurricane","grapes","paintbrush","couch","nose","square","wristwatch","penguin","bridge","octagon","submarine","screwdriver","rollerskates","ladder","wine_bottle","cake","bracelet","broom","yoga","finger","fish","line","truck","snake","bus","stitches","snorkel","shorts","bowtie","pickup_truck","tooth","snail","foot","crab","school_bus","train","dresser","sock","tractor","map","hedgehog","coffee_cup","computer","matches","beard","frog","crocodile","bathtub","rain","moon","bee","knife","boomerang","lighthouse","chandelier","jail","pool","stethoscope","frying_pan","cell_phone","binoculars","purse","lantern","birthday_cake","clarinet","palm_tree","aircraft_carrier","vase","eraser","shark","skyscraper","bicycle","sink","teapot","circle","tornado","bird","stereo","mouth","key","hot_dog","spoon","laptop","cup","bottlecap","The_Great_Wall_of_China","The_Mona_Lisa","smiley_face","waterslide","eyeglasses","ceiling_fan","lobster","moustache","carrot","garden","police_car","postcard","necklace","helmet","blackberry","beach","golf_club","car","panda","alarm_clock","t-shirt","dog","bread","wine_glass","lighter","flower","bandage","drill","butterfly","swan","owl","raccoon","squiggle","calendar","giraffe","elephant","trumpet","rabbit","trombone","sheep","onion","church","flip_flops","spreadsheet","pear","clock","roller_coaster","parachute","kangaroo","duck","remote_control","compass","monkey","rainbow","tennis_racquet","lion","pencil","string_bean","oven","star","cat","pizza","soccer_ball","syringe","flying_saucer","eye","cookie","floor_lamp","mouse","toilet","toaster","The_Eiffel_Tower","airplane","stove","cello","stop_sign","tent","diving_board","light_bulb","hammer","scorpion","headphones","basket","spider","paper_clip","sweater","ice_cream","envelope","sea_turtle","donut","hat","hourglass","broccoli","jacket","backpack","book","lightning","drums","snowflake","radio","banana","camel","canoe","toothpaste","chair","picture_frame","parrot","sandwich","lipstick","pants","violin","brain","power_outlet","triangle","hamburger","dragon","bulldozer","cannon","dolphin","zebra","animal_migration","camouflage","scissors","basketball","elbow","umbrella","windmill","table","rifle","hexagon","potato","anvil","sword","peanut","axe","television","rhinoceros","baseball_bat","speedboat","sailboat","zigzag","garden_hose","river","house","pillow","ant","tiger","stairs","cooler","see_saw","piano","fireplace","popsicle","dumbbell","mailbox","barn","hot_tub","teddy-bear","fork","dishwasher","peas","hot_air_balloon","keyboard","microwave","wheel","fire_hydrant","van","camera","whale","candle","octopus","pig","swing_set","helicopter","saxophone","passport","bat","ambulance","diamond","goatee","fence","grass","mermaid","motorbike","microphone","toe","cactus","nail","telephone","hand","squirrel","streetlight","bed","firetruck"],Qn={DOODLENET_URL:"https://cdn.jsdelivr.net/gh/ml5js/ml5-data-and-models@master/models/doodlenet/model.json",IMAGE_SIZE_DOODLENET:28};function Ce($,M){var T;$ instanceof I.Tensor?T=$:$ instanceof HTMLImageElement||$ instanceof HTMLVideoElement||$ instanceof HTMLCanvasElement||$ instanceof ImageData?T=I.browser.fromPixels($):we()($)==="object"&&($.elt instanceof HTMLImageElement||$.elt instanceof HTMLVideoElement||$.elt instanceof HTMLCanvasElement||$.elt instanceof ImageData)&&(T=I.browser.fromPixels($.elt));var O=I.scalar(1).sub(T.toFloat().div(I.scalar(255))),L=O;O.shape[0]===M&&O.shape[1]===M||(L=I.image.resizeBilinear(O,[M,M]));var J=I.split(L,3,3),ie=Pn()(J,3),ge=ie[0],Ae=ie[1],Ie=ie[2];return ge.add(Ae).add(Ie).div(I.scalar(3)).floor().reshape([1,M,M,1])}var sr=function(){function $(){oe()(this,$),this.imgSize=Qn.IMAGE_SIZE_DOODLENET}return _e()($,[{key:"load",value:function(){var M=q()(me.a.mark(function T(){var O,L=this;return me.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,I.loadLayersModel(Qn.DOODLENET_URL);case 2:return this.model=J.sent,O=I.tidy(function(){return L.model.predict(I.zeros([1,L.imgSize,L.imgSize,1]))}),J.next=6,O.data();case 6:O.dispose();case 7:case"end":return J.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"classify",value:function(){var M=q()(me.a.mark(function T(O){var L,J,ie,ge=this,Ae=arguments;return me.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return L=Ae.length>1&&Ae[1]!==void 0?Ae[1]:10,J=I.tidy(function(){var De=Ce(O,ge.imgSize);return ge.model.predict(De)}),Ie.next=4,sn(J,L,An);case 4:return ie=Ie.sent,J.dispose(),Ie.abrupt("return",ie);case 7:case"end":return Ie.stop()}},T)}));return function(T){return M.apply(this,arguments)}}()}]),$}();function Mr(){return on.apply(this,arguments)}function on(){return(on=q()(me.a.mark(function $(){var M;return me.a.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return M=new sr,T.next=3,M.load();case 3:return T.abrupt("return",M);case 4:case"end":return T.stop()}},$)}))).apply(this,arguments)}var Gt=new(function(){function $(){oe()(this,$),typeof window<"u"&&(this.m_p5Instance=window)}return _e()($,[{key:"setP5Instance",value:function(M){this.m_p5Instance=M}},{key:"p5Instance",get:function(){return this.m_p5Instance!==void 0&&typeof this.m_p5Instance.loadImage=="function"?this.m_p5Instance:this.m_p5Instance.p5!==void 0&&this.m_p5Instance.p5.Image!==void 0&&typeof this.m_p5Instance.p5.Image=="function"?this.m_p5Instance.p5:void 0}},{key:"checkP5",value:function(){return!!this.p5Instance}},{key:"getBlob",value:function(M){return new Promise(function(T,O){M.toBlob(function(L){L?T(L):O(new Error("Canvas could not be converted to Blob."))})})}},{key:"loadAsync",value:function(M){var T=this;return new Promise(function(O,L){T.p5Instance.loadImage(M,function(J){O(J)},function(){L(new Error("Could not load image from url ".concat(M)))})})}},{key:"rawToBlob",value:function(){var M=q()(me.a.mark(function T(O,L,J){var ie,ge,Ae,Ie,De,et;return me.a.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:for(ie=Array.from(O),ge=document.createElement("canvas"),Ae=ge.getContext("2d"),ge.width=L,ge.height=J,Ie=Ae.createImageData(L,J),De=Ie.data,et=0;et<L*J*4;et+=1)De[et]=ie[et];return Ae.putImageData(Ie,0,0),ot.abrupt("return",this.getBlob(ge));case 10:case"end":return ot.stop()}},T,this)}));return function(T,O,L){return M.apply(this,arguments)}}()},{key:"blobToP5Image",value:function(){var M=q()(me.a.mark(function T(O){return me.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(!this.checkP5()||typeof URL>"u"){L.next=2;break}return L.abrupt("return",this.loadAsync(URL.createObjectURL(O)));case 2:return L.abrupt("return",null);case 3:case"end":return L.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()}]),$}()),Hn=function($,M){var T=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){},O=$,L=document.createElement("video");return O.onplay=function(){var J=O.captureStream();L.srcObject=J,L.width=M,L.height=M,L.autoplay=!0,L.playsinline=!0,L.muted=!0,T()},L},Kt=function($){var M=Pn()($.shape,2),T=M[0],O=M[1],L=$.dataSync(),J=document.createElement("canvas");J.width=O,J.height=T;for(var ie=J.getContext("2d"),ge=ie.getImageData(0,0,J.width,J.height),Ae=0;Ae<O*T;Ae+=1){var Ie=4*Ae,De=3*Ae;ge.data[Ie+0]=Math.floor(256*L[De+0]),ge.data[Ie+1]=Math.floor(256*L[De+1]),ge.data[Ie+2]=Math.floor(256*L[De+2]),ge.data[Ie+3]=255}ie.putImageData(ge,0,0);var et=J.toDataURL(),ot=document.createElement("img");return ot.src=et,ot.style.width=O,ot.style.height=T,$.dispose(),ot},Vt=function($){var M=Math.min($.shape[0],$.shape[1]),T=$.shape[0]/2-M/2,O=$.shape[1]/2-M/2;return $.slice([T,O,0],[M,M,3])},en=function($){var M,T,O;if(O=$ instanceof HTMLImageElement||$ instanceof HTMLCanvasElement||$ instanceof HTMLVideoElement||$ instanceof ImageData?$:we()($)==="object"&&($.elt instanceof HTMLImageElement||$.elt instanceof HTMLCanvasElement||$.elt instanceof HTMLVideoElement||$.elt instanceof ImageData)?$.elt:we()($)==="object"&&$.canvas instanceof HTMLCanvasElement?$.canvas:$,M=O.width,T=O.height,Gt.checkP5()){var L=Gt.p5Instance.createGraphics(M,T);return L.push(),L.translate(M,0),L.scale(-1,1),L.image($,0,0,M,T),L.pop(),L}var J=document.createElement("canvas");J.width=M,J.height=T;var ie=J.getContext("2d");return ie.drawImage(O,0,0,M,T),ie.translate(M,0),ie.scale(-1,1),ie.drawImage(J,-1*M,0,M,T),J};function Vn($){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return I.tidy(function(){var T=I.browser.fromPixels($);return M&&(T=I.image.resizeBilinear(T,M)),Vt(T).expandDims(0).toFloat().div(I.scalar(127)).sub(I.scalar(1))})}function Dt($){return $ instanceof HTMLVideoElement||$ instanceof HTMLImageElement||$ instanceof HTMLCanvasElement||$ instanceof ImageData}function On($){var M,T,O;O=$ instanceof HTMLImageElement||$ instanceof HTMLCanvasElement||$ instanceof HTMLVideoElement||$ instanceof ImageData?$:we()($)==="object"&&($.elt instanceof HTMLImageElement||$.elt instanceof HTMLCanvasElement||$.elt instanceof HTMLVideoElement||$.elt instanceof ImageData)?$.elt:we()($)==="object"&&$.canvas instanceof HTMLCanvasElement?$.canvas:$,M=O.width,T=O.height;var L=document.createElement("canvas");L.width=M,L.height=T;var J=L.getContext("2d");J.drawImage(O,0,0,M,T);var ie=J.getImageData(0,0,M,T);return Array.from(ie.data)}var or={mobilenet:{version:2,alpha:1,topk:3}},ar=["mobilenet","darknet","darknet-tiny","doodlenet"],yr=function(){function $(M,T,O,L){if(oe()(this,$),this.video=T,this.model=null,this.mapStringToIndex=[],typeof M=="string")if(ar.includes(M))switch(this.modelName=M,this.modelUrl=null,this.modelName){case"mobilenet":this.modelToUse=c,this.version=O.version||or.mobilenet.version,this.alpha=O.alpha||or.mobilenet.alpha,this.topk=O.topk||or.mobilenet.topk;break;case"darknet":this.version="reference",this.modelToUse=S;break;case"darknet-tiny":this.version="tiny",this.modelToUse=S;break;case"doodlenet":this.modelToUse=E;break;default:this.modelToUse=null}else this.modelUrl=M,this.modelUrl.endsWith("/")&&(this.modelUrl+="model.json");this.ready=Ge(this.loadModel(this.modelUrl),L)}return _e()($,[{key:"loadModel",value:function(){var M=q()(me.a.mark(function T(O){return me.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(!O){L.next=6;break}return L.next=3,this.loadModelFrom(O);case 3:this.model=L.sent,L.next=9;break;case 6:return L.next=8,this.modelToUse.load({version:this.version,alpha:this.alpha});case 8:this.model=L.sent;case 9:return L.abrupt("return",this);case 10:case"end":return L.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"loadModelFrom",value:function(){var M=q()(me.a.mark(function T(){var O,L,J,ie,ge,Ae,Ie,De,et=arguments;return me.a.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:if(O=et.length>0&&et[0]!==void 0?et[0]:null,ot.prev=1,O===null){ot.next=7;break}return ot.next=5,Bt.a.get(O);case 5:J=ot.sent,L=J.data;case 7:if(L.ml5Specs&&(this.mapStringToIndex=L.ml5Specs.mapStringToIndex),this.mapStringToIndex.length!==0){ot.next=16;break}return ie=O.split("/"),ge=ie.slice(0,ie.length-1).join("/"),Ae="".concat(ge,"/metadata.json"),ot.next=14,Bt.a.get(Ae).catch(function(zt){console.log("Tried to fetch metadata.json, but it seems to be missing.",zt)});case 14:(Ie=ot.sent)&&(De=Ie.data).labels&&(this.mapStringToIndex=De.labels);case 16:return ot.next=18,I.loadLayersModel(O);case 18:return this.model=ot.sent,ot.abrupt("return",this.model);case 22:return ot.prev=22,ot.t0=ot.catch(1),console.error(ot.t0),ot.abrupt("return",ot.t0);case 26:case"end":return ot.stop()}},T,this,[[1,22]])}));return function(){return M.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var M=q()(me.a.mark(function T(O,L){var J,ie,ge,Ae,Ie,De,et=this;return me.a.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:return ot.next=2,this.ready;case 2:return ot.next=4,I.nextFrame();case 4:if(!(O instanceof HTMLVideoElement&&O.readyState===0)){ot.next=8;break}return J=O,ot.next=8,new Promise(function(zt){J.onloadeddata=function(){return zt()}});case 8:if(!this.video||this.video.readyState!==0){ot.next=11;break}return ot.next=11,new Promise(function(zt){et.video.onloadeddata=function(){return zt()}});case 11:if(ie=[224,224],!this.modelUrl){ot.next=20;break}return ot.next=15,I.nextFrame();case 15:return ge=I.tidy(function(){var zt=Vn(O,ie),Ht=et.model.predict(zt);return Array.from(Ht.as1D().dataSync())}),ot.next=18,ge.map(function(zt,Ht){return{label:et.mapStringToIndex.length>0&&et.mapStringToIndex[Ht]?et.mapStringToIndex[Ht]:Ht,confidence:zt}}).sort(function(zt,Ht){return Ht.confidence-zt.confidence});case 18:return Ae=ot.sent,ot.abrupt("return",Ae);case 20:return Ie=Vn(O,ie),De=this.model.classify(Ie,L).then(function(zt){return zt.map(function(Ht){return{label:Ht.className,confidence:Ht.probability}})}),Ie.dispose(),ot.abrupt("return",De);case 24:case"end":return ot.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()},{key:"classify",value:function(){var M=q()(me.a.mark(function T(O){var L,J,ie,ge,Ae,Ie=arguments;return me.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(L=Ie.length>1&&Ie[1]!==void 0?Ie[1]:null,J=Ie.length>2?Ie[2]:void 0,ie=this.video,ge=this.topk,typeof O!="function"){De.next=9;break}ie=this.video,Ae=O,De.next=28;break;case 9:if(typeof O!="number"){De.next=14;break}ie=this.video,ge=O,De.next=28;break;case 14:if(!(O instanceof HTMLVideoElement||O instanceof HTMLImageElement||O instanceof HTMLCanvasElement||O instanceof ImageData)){De.next=18;break}ie=O,De.next=28;break;case 18:if(we()(O)!=="object"||!(O.elt instanceof HTMLVideoElement||O.elt instanceof HTMLImageElement||O.elt instanceof HTMLCanvasElement||O.elt instanceof ImageData)){De.next=22;break}ie=O.elt,De.next=28;break;case 22:if(!(we()(O)==="object"&&O.canvas instanceof HTMLCanvasElement)){De.next=26;break}ie=O.canvas,De.next=28;break;case 26:if(this.video instanceof HTMLVideoElement){De.next=28;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 28:return typeof L=="number"?ge=L:typeof L=="function"&&(Ae=L),typeof J=="function"&&(Ae=J),De.abrupt("return",Ge(this.classifyInternal(ie,ge),Ae));case 31:case"end":return De.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"predict",value:function(){var M=q()(me.a.mark(function T(O,L,J){return me.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.abrupt("return",this.classify(O,L||null,J));case 1:case"end":return ie.stop()}},T,this)}));return function(T,O,L){return M.apply(this,arguments)}}()}]),$}(),kr=function($,M,T,O){var L,J={},ie=O,ge=$;if(typeof ge!="string")throw new Error('Please specify a model to use. E.g: "MobileNet"');ge.indexOf("http")===-1&&(ge=$.toLowerCase()),M instanceof HTMLVideoElement?L=M:we()(M)==="object"&&M.elt instanceof HTMLVideoElement?L=M.elt:we()(M)==="object"?J=M:typeof M=="function"&&(ie=M),we()(T)==="object"?J=T:typeof T=="function"&&(ie=T);var Ae=new yr(ge,L,J,ie);return ie?Ae:Ae.ready},dr=function($,M){return(dr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,O){T.__proto__=O}||function(T,O){for(var L in O)O.hasOwnProperty(L)&&(T[L]=O[L])})($,M)},oi=function(){return(oi=Object.assign||function($){for(var M,T=1,O=arguments.length;T<O;T++)for(var L in M=arguments[T])Object.prototype.hasOwnProperty.call(M,L)&&($[L]=M[L]);return $}).apply(this,arguments)};function Ur($,M,T,O){return new(T||(T=Promise))(function(L,J){function ie(Ie){try{Ae(O.next(Ie))}catch(De){J(De)}}function ge(Ie){try{Ae(O.throw(Ie))}catch(De){J(De)}}function Ae(Ie){Ie.done?L(Ie.value):new T(function(De){De(Ie.value)}).then(ie,ge)}Ae((O=O.apply($,M||[])).next())})}function Xr($,M){var T,O,L,J,ie={label:0,sent:function(){if(1&L[0])throw L[1];return L[1]},trys:[],ops:[]};return J={next:ge(0),throw:ge(1),return:ge(2)},typeof Symbol=="function"&&(J[Symbol.iterator]=function(){return this}),J;function ge(Ae){return function(Ie){return function(De){if(T)throw new TypeError("Generator is already executing.");for(;ie;)try{if(T=1,O&&(L=2&De[0]?O.return:De[0]?O.throw||((L=O.return)&&L.call(O),0):O.next)&&!(L=L.call(O,De[1])).done)return L;switch(O=0,L&&(De=[2&De[0],L.value]),De[0]){case 0:case 1:L=De;break;case 4:return ie.label++,{value:De[1],done:!1};case 5:ie.label++,O=De[1],De=[0];continue;case 7:De=ie.ops.pop(),ie.trys.pop();continue;default:if(!(L=(L=ie.trys).length>0&&L[L.length-1])&&(De[0]===6||De[0]===2)){ie=0;continue}if(De[0]===3&&(!L||De[1]>L[0]&&De[1]<L[3])){ie.label=De[1];break}if(De[0]===6&&ie.label<L[1]){ie.label=L[1],L=De;break}if(L&&ie.label<L[2]){ie.label=L[2],ie.ops.push(De);break}L[2]&&ie.ops.pop(),ie.trys.pop();continue}De=M.call($,ie)}catch(et){De=[6,et],O=0}finally{T=L=0}if(5&De[0])throw De[1];return{value:De[0]?De[1]:void 0,done:!0}}([Ae,Ie])}}}function zn($){var M=typeof Symbol=="function"&&$[Symbol.iterator],T=0;return M?M.call($):{next:function(){return $&&T>=$.length&&($=void 0),{value:$&&$[T++],done:!$}}}}function ir($,M){var T=typeof Symbol=="function"&&$[Symbol.iterator];if(!T)return $;var O,L,J=T.call($),ie=[];try{for(;(M===void 0||M-- >0)&&!(O=J.next()).done;)ie.push(O.value)}catch(ge){L={error:ge}}finally{try{O&&!O.done&&(T=J.return)&&T.call(J)}finally{if(L)throw L.error}}return ie}function Or(){for(var $=[],M=0;M<arguments.length;M++)$=$.concat(ir(arguments[M]));return $}var qr=null;function Kr($){return qr==null&&(qr=Object(I.backend)().epsilon()),Object(I.tidy)(function(){var M=Object(I.moments)($),T=M.mean,O=M.variance;return $.sub(T).div(O.sqrt().add(qr))})}var Tt=function(){function $(M){var T=this;if(M==null)throw new Error("Required configuration object is missing for BrowserFftFeatureExtractor constructor");if(M.spectrogramCallback==null)throw new Error("spectrogramCallback cannot be null or undefined");if(!(M.numFramesPerSpectrogram>0))throw new Error("Invalid value in numFramesPerSpectrogram: "+M.numFramesPerSpectrogram);if(M.suppressionTimeMillis<0)throw new Error("Expected suppressionTimeMillis to be >= 0, but got "+M.suppressionTimeMillis);if(this.suppressionTimeMillis=M.suppressionTimeMillis,this.spectrogramCallback=M.spectrogramCallback,this.numFrames=M.numFramesPerSpectrogram,this.sampleRateHz=M.sampleRateHz||44100,this.fftSize=M.fftSize||1024,this.frameDurationMillis=this.fftSize/this.sampleRateHz*1e3,this.columnTruncateLength=M.columnTruncateLength||this.fftSize,this.overlapFactor=M.overlapFactor,this.includeRawAudio=M.includeRawAudio,I.util.assert(this.overlapFactor>=0&&this.overlapFactor<1,function(){return"Expected overlapFactor to be >= 0 and < 1, but got "+T.overlapFactor}),this.columnTruncateLength>this.fftSize)throw new Error("columnTruncateLength "+this.columnTruncateLength+" exceeds fftSize ("+this.fftSize+").");this.audioContextConstructor=window.AudioContext||window.webkitAudioContext}return $.prototype.start=function(M){return Ur(this,void 0,void 0,function(){var T,O,L;return Xr(this,function(J){switch(J.label){case 0:if(this.frameIntervalTask!=null)throw new Error("Cannot start already-started BrowserFftFeatureExtractor");return T=this,[4,function(ie){return Ur(this,void 0,void 0,function(){return Xr(this,function(ge){switch(ge.label){case 0:return[4,navigator.mediaDevices.getUserMedia({audio:ie==null||ie,video:!1})];case 1:return[2,ge.sent()]}})})}(M)];case 1:return T.stream=J.sent(),this.audioContext=new this.audioContextConstructor,this.audioContext.sampleRate!==this.sampleRateHz&&console.warn("Mismatch in sampling rate: Expected: "+this.sampleRateHz+"; Actual: "+this.audioContext.sampleRate),O=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=0,O.connect(this.analyser),this.freqDataQueue=[],this.freqData=new Float32Array(this.fftSize),this.includeRawAudio&&(this.timeDataQueue=[],this.timeData=new Float32Array(this.fftSize)),L=Math.max(1,Math.round(this.numFrames*(1-this.overlapFactor))),this.tracker=new Se(L,Math.round(this.suppressionTimeMillis/this.frameDurationMillis)),this.frameIntervalTask=setInterval(this.onAudioFrame.bind(this),this.fftSize/this.sampleRateHz*1e3),[2]}})})},$.prototype.onAudioFrame=function(){return Ur(this,void 0,void 0,function(){var M,T,O,L;return Xr(this,function(J){switch(J.label){case 0:return this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0?[2]:(this.freqDataQueue.push(this.freqData.slice(0,this.columnTruncateLength)),this.includeRawAudio&&(this.analyser.getFloatTimeDomainData(this.timeData),this.timeDataQueue.push(this.timeData.slice())),this.freqDataQueue.length>this.numFrames&&this.freqDataQueue.shift(),this.tracker.tick()?(M=Rr(this.freqDataQueue),T=Qt(M,[1,this.numFrames,this.columnTruncateLength,1]),O=void 0,this.includeRawAudio&&(L=Rr(this.timeDataQueue),O=Qt(L,[1,this.numFrames*this.fftSize])),[4,this.spectrogramCallback(T,O)]):[3,2]);case 1:J.sent()&&this.tracker.suppress(),Object(I.dispose)([T,O]),J.label=2;case 2:return[2]}})})},$.prototype.stop=function(){return Ur(this,void 0,void 0,function(){return Xr(this,function(M){if(this.frameIntervalTask==null)throw new Error("Cannot stop because there is no ongoing streaming activity.");return clearInterval(this.frameIntervalTask),this.frameIntervalTask=null,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop(),[2]})})},$.prototype.setConfig=function(M){throw new Error("setConfig() is not implemented for BrowserFftFeatureExtractor.")},$.prototype.getFeatures=function(){throw new Error("getFeatures() is not implemented for BrowserFftFeatureExtractor. Use the spectrogramCallback field of the constructor config instead.")},$}();function Rr($){var M=$[0].length,T=new Float32Array($.length*M);return $.forEach(function(O,L){return T.set(O,L*M)}),T}function Qt($,M){var T=new Float32Array(I.util.sizeFromShape(M));return T.set($,T.length-$.length),Object(I.tensor)(T,M)}var Se=function(){function $(M,T){var O=this;this.period=M,this.suppressionTime=T??0,this.counter=0,I.util.assert(this.period>0,function(){return"Expected period to be positive, but got "+O.period})}return $.prototype.tick=function(){return this.counter++,this.counter%this.period==0&&(this.suppressionOnset==null||this.counter-this.suppressionOnset>this.suppressionTime)},$.prototype.suppress=function(){this.suppressionOnset=this.counter},$}();function ve($){var M=0;$.forEach(function(L){M+=L.byteLength});var T=new Uint8Array(M),O=0;return $.forEach(function(L){T.set(new Uint8Array(L),O),O+=L.byteLength}),T.buffer}function ke($){var M=0;$.forEach(function(L){return M+=L.length});var T=new Float32Array(M),O=0;return $.forEach(function(L){T.set(L,O),O+=L.length}),T}function Me($){if($==null)throw new Error("Received null or undefind string");for(var M=unescape(encodeURIComponent($)),T=new Uint8Array(M.length),O=0;O<M.length;++O)T[O]=M.charCodeAt(O);return T.buffer}function rt($){if($==null)throw new Error("Received null or undefind buffer");var M=new Uint8Array($);return decodeURIComponent(escape(String.fromCharCode.apply(String,Or(M))))}var Ct="TFJSSCDS",tn=1,Sn=function(){function $(M){if(this.examples={},this.label2Ids={},M!=null)for(var T=function(ge){I.util.assert(ge!=null,function(){return"Received null or undefined buffer"});var Ae=0,Ie=rt(ge.slice(Ae,Ct.length));I.util.assert(Ie===Ct,function(){return"Deserialization error: Invalid descriptor"}),Ae+=Ct.length,Ae+=4;var De=new Uint32Array(ge,Ae,1),et=Ae+=4;Ae=et+De[0];var ot=rt(ge.slice(et,Ae));return{manifest:JSON.parse(ot),data:ge.slice(Ae)}}(M),O=0,L=0;L<T.manifest.length;++L){var J=T.manifest[L],ie=J.spectrogramNumFrames*J.spectrogramFrameSize;J.rawAudioNumSamples!=null&&(ie+=J.rawAudioNumSamples),ie*=4,this.addExample(Zt({spec:J,data:T.data.slice(O,O+ie)})),O+=ie}}return $.prototype.addExample=function(M){I.util.assert(M!=null,function(){return"Got null or undefined example"}),I.util.assert(M.label!=null&&M.label.length>0,function(){return"Expected label to be a non-empty string, but got "+JSON.stringify(M.label)});var T=function(){function O(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return O()+O()+"-"+O()+"-"+O()+"-"+O()+"-"+O()+O()+O()}();return this.examples[T]=M,M.label in this.label2Ids||(this.label2Ids[M.label]=[]),this.label2Ids[M.label].push(T),T},$.prototype.merge=function(M){var T,O,L,J;I.util.assert(M!==this,function(){return"Cannot merge a dataset into itself"});var ie=M.getVocabulary();try{for(var ge=zn(ie),Ae=ge.next();!Ae.done;Ae=ge.next()){var Ie=Ae.value,De=M.getExamples(Ie);try{for(var et=zn(De),ot=et.next();!ot.done;ot=et.next()){var zt=ot.value;this.addExample(zt.example)}}catch(Ht){L={error:Ht}}finally{try{ot&&!ot.done&&(J=et.return)&&J.call(et)}finally{if(L)throw L.error}}}}catch(Ht){T={error:Ht}}finally{try{Ae&&!Ae.done&&(O=ge.return)&&O.call(ge)}finally{if(T)throw T.error}}},$.prototype.getExampleCounts=function(){var M={};for(var T in this.examples){var O=this.examples[T];O.label in M||(M[O.label]=0),M[O.label]++}return M},$.prototype.getExamples=function(M){var T=this;I.util.assert(M!=null,function(){return"Expected label to be a string, but got "+JSON.stringify(M)}),I.util.assert(M in this.label2Ids,function(){return'No example of label "'+M+'" exists in dataset'});var O=[];return this.label2Ids[M].forEach(function(L){O.push({uid:L,example:T.examples[L]})}),O},$.prototype.getData=function(M,T){var O=this;I.util.assert(this.size()>0,function(){return"Cannot get spectrograms as tensors because the dataset is empty"});var L=this.getVocabulary();M!=null?I.util.assert(L.indexOf(M)!==-1,function(){return"Label "+M+" is not in the vocabulary ("+JSON.stringify(L)+")"}):I.util.assert(L.length>1,function(){return"One-hot encoding of labels requires the vocabulary to have at least two words, but it has only "+L.length+" word."}),T==null&&(T={});var J,ie,ge=this.getSortedUniqueNumFrames();ge.length===1?(J=T.numFrames==null?ge[0]:T.numFrames,ie=T.hopFrames==null?1:T.hopFrames):(J=T.numFrames,I.util.assert(J!=null&&Number.isInteger(J)&&J>0,function(){return"There are "+ge.length+" unique lengths among the "+O.size()+" examples of this Dataset, hence numFrames is required. But it is not provided."}),I.util.assert(J<=ge[0],function(){return"numFrames ("+J+") exceeds the minimum numFrames ("+ge[0]+") among the examples of the Dataset."}),ie=T.hopFrames,I.util.assert(ie!=null&&Number.isInteger(ie)&&ie>0,function(){return"There are "+ge.length+" unique lengths among the "+O.size()+" examples of this Dataset, hence hopFrames is required. But it is not provided."}));var Ae=T.normalize==null||T.normalize;return Object(I.tidy)(function(){for(var Ie,De,et,ot=[],zt=[],Ht=[],xn=0;xn<L.length;++xn){var En=L[xn];if(M==null||En===M){var Fn=O.label2Ids[En],Rn=function(Li){var ts,ss,gu=O.examples[Li].spectrogram,Ws=gu.frameSize;et==null?et=Ws:I.util.assert(Ws===et,function(){return"Mismatch in frameSize  ("+Ws+" vs "+et+")"});var Pu=gu.data.length/Ws,Lu=null;En!=="_background_noise_"&&(Lu=gu.keyFrameIndex==null?fn(gu).dataSync()[0]:gu.keyFrameIndex);var Bu=Object(I.tensor3d)(gu.data,[Pu,Ws,1]),up=mn(Pu,Lu,J,ie),Qd=function(Zl){var wc=Object(I.tidy)(function(){var Ka=Bu.slice([Zl[0],0,0],[Zl[1]-Zl[0],-1,-1]);return Ae?Kr(Ka):Ka});T.getDataset?zt.push(wc.dataSync()):ot.push(wc),M==null&&Ht.push(xn)};try{for(var Ql=zn(up),Gf=Ql.next();!Gf.done;Gf=Ql.next())Qd(Gf.value)}catch(Zl){ts={error:Zl}}finally{try{Gf&&!Gf.done&&(ss=Ql.return)&&ss.call(Ql)}finally{if(ts)throw ts.error}}Object(I.dispose)(Bu)};try{for(var Wn=zn(Fn),Jn=Wn.next();!Jn.done;Jn=Wn.next())Rn(Jn.value)}catch(Li){Ie={error:Li}}finally{try{Jn&&!Jn.done&&(De=Wn.return)&&De.call(Wn)}finally{if(Ie)throw Ie.error}}}}T.augmentByMixingNoiseRatio!=null&&O.augmentByMixingNoise(T.getDataset?zt:ot,Ht,T.augmentByMixingNoiseRatio);var Tn=T.shuffle==null||T.shuffle;if(T.getDataset){var _r=T.datasetBatchSize==null?32:T.datasetBatchSize,Nr=T.datasetValidationSplit==null?.15:T.datasetValidationSplit;I.util.assert(Nr>0&&Nr<1,function(){return"Invalid dataset validation split: "+Nr});var Ir=zt.map(function(Li,ts){return[Li,Ht[ts]]});I.util.shuffle(Ir),zt=Ir.map(function(Li){return Li[0]});var Qr=Ir.map(function(Li){return Li[1]}),zr=function(Li,ts,ss){var gu,Ws,Pu,Lu,Bu,up,Qd,Ql;I.util.assert(ss>0&&ss<1,function(){return"validationSplit is expected to be >0 and <1, but got "+ss});for(var Gf=!Array.isArray(Li[0]),Zl=ts,wc=[],Ka=0;Ka<Zl.length;++Ka){var qf=Zl[Ka];wc[qf]==null&&(wc[qf]=[]),wc[qf].push(Ka)}var Zd=wc.length,cp=[],$f=[];for(wc.map(function(ku){return I.util.shuffle(ku)}),Ka=0;Ka<Zd;++Ka)for(var As=wc[Ka],eh=Math.round(As.length*(1-ss)),lp=0;lp<As.length;++lp)lp<eh?cp.push(As[lp]):$f.push(As[lp]);if(Gf){var fp=[],vl=[],Nm=[],_c=[];try{for(var Vs=zn(cp),oc=Vs.next();!oc.done;oc=Vs.next()){var Os=oc.value;fp.push(Li[Os]),vl.push(ts[Os])}}catch(ku){gu={error:ku}}finally{try{oc&&!oc.done&&(Ws=Vs.return)&&Ws.call(Vs)}finally{if(gu)throw gu.error}}try{for(var ef=zn($f),th=ef.next();!th.done;th=ef.next())Os=th.value,Nm.push(Li[Os]),_c.push(ts[Os])}catch(ku){Pu={error:ku}}finally{try{th&&!th.done&&(Lu=ef.return)&&Lu.call(ef)}finally{if(Pu)throw Pu.error}}return{trainXs:fp,trainYs:vl,valXs:Nm,valYs:_c}}fp=[],vl=[],Nm=[],_c=[];try{for(var dp=zn(cp),nh=dp.next();!nh.done;nh=dp.next())Os=nh.value,fp.push(Li[Os]),vl.push(ts[Os])}catch(ku){Bu={error:ku}}finally{try{nh&&!nh.done&&(up=dp.return)&&up.call(dp)}finally{if(Bu)throw Bu.error}}try{for(var Im=zn($f),tf=Im.next();!tf.done;tf=Im.next())Os=tf.value,Nm.push(Li[Os]),_c.push(ts[Os])}catch(ku){Qd={error:ku}}finally{try{tf&&!tf.done&&(Ql=Im.return)&&Ql.call(Im)}finally{if(Qd)throw Qd.error}}return{trainXs:fp,trainYs:vl,valXs:Nm,valYs:_c}}(zt,Qr,Nr),ki=zr.trainXs,Pi=zr.trainYs,Fi=zr.valXs,Mo=zr.valYs,Jo=I.data.array(ki).map(function(Li){return Object(I.tensor3d)(Li,[J,et,1])}),jo=I.data.array(Pi).map(function(Li){return Object(I.oneHot)([Li],L.length).squeeze([0])}),Bo=I.data.zip({xs:Jo,ys:jo});Tn&&(Bo=Bo.shuffle(zt.length)),Bo=Bo.batch(_r).prefetch(4);var Ho=I.data.array(Fi).map(function(Li){return Object(I.tensor3d)(Li,[J,et,1])}),la=I.data.array(Mo).map(function(Li){return Object(I.oneHot)([Li],L.length).squeeze([0])}),va=I.data.zip({xs:Ho,ys:la});return[Bo,va=va.batch(_r).prefetch(4)]}if(Tn){var Fa=[];ot.forEach(function(Li,ts){Fa.push({x:Li,y:Ht[ts]})}),I.util.shuffle(Fa),ot=Fa.map(function(Li){return Li.x}),Ht=Fa.map(function(Li){return Li.y})}var mu=M==null?Object(I.oneHot)(Object(I.tensor1d)(Ht,"int32"),L.length).asType("float32"):void 0;return{xs:Object(I.stack)(ot),ys:mu}})},$.prototype.augmentByMixingNoise=function(M,T,O){var L,J;if(M==null||M.length===0)throw new Error("Cannot perform augmentation because data is null or empty");for(var ie=M[0]instanceof Float32Array,ge=this.getVocabulary(),Ae=[],Ie=[],De=0;De<T.length;++De)ge[T[De]]==="_background_noise_"?Ae.push(De):Ie.push(De);if(Ae.length===0)throw new Error("Cannot perform augmentation by mixing with noise when there is no example with label _background_noise_");var et=[],ot=[],zt=function(En){var Fn=Ae[function(Tn,_r){return Math.floor((_r-Tn)*Math.random())+Tn}(0,Ae.length)],Rn=ie?Object(I.tensor1d)(M[En]):M[En],Wn=ie?Object(I.tensor1d)(M[Fn]):M[Fn],Jn=Object(I.tidy)(function(){return Kr(Rn.add(Wn.mul(O)))});ie?et.push(Jn.dataSync()):et.push(Jn),ot.push(T[En])};try{for(var Ht=zn(Ie),xn=Ht.next();!xn.done;xn=Ht.next())zt(xn.value)}catch(En){L={error:En}}finally{try{xn&&!xn.done&&(J=Ht.return)&&J.call(Ht)}finally{if(L)throw L.error}}console.log("Data augmentation: mixing noise: added "+et.length+" examples"),et.forEach(function(En){return M.push(En)}),T.push.apply(T,Or(ot))},$.prototype.getSortedUniqueNumFrames=function(){for(var M,T,O=new Set,L=this.getVocabulary(),J=0;J<L.length;++J){var ie=L[J],ge=this.label2Ids[ie];try{for(var Ae=zn(ge),Ie=Ae.next();!Ie.done;Ie=Ae.next()){var De=Ie.value,et=this.examples[De].spectrogram,ot=et.data.length/et.frameSize;O.add(ot)}}catch(Ht){M={error:Ht}}finally{try{Ie&&!Ie.done&&(T=Ae.return)&&T.call(Ae)}finally{if(M)throw M.error}}}var zt=Or(O);return zt.sort(),zt},$.prototype.removeExample=function(M){if(!(M in this.examples))throw new Error("Nonexistent example UID: "+M);var T=this.examples[M].label;delete this.examples[M];var O=this.label2Ids[T].indexOf(M);this.label2Ids[T].splice(O,1),this.label2Ids[T].length===0&&delete this.label2Ids[T]},$.prototype.setExampleKeyFrameIndex=function(M,T){if(!(M in this.examples))throw new Error("Nonexistent example UID: "+M);var O=this.examples[M].spectrogram,L=O.data.length/O.frameSize;I.util.assert(T>=0&&T<L&&Number.isInteger(T),function(){return"Invalid keyFrameIndex: "+T+". Must be >= 0, < "+L+", and an integer."}),O.keyFrameIndex=T},$.prototype.size=function(){return Object.keys(this.examples).length},$.prototype.durationMillis=function(){var M=0;for(var T in this.examples){var O=this.examples[T].spectrogram,L=23.22|O.frameDurationMillis;M+=O.data.length/O.frameSize*L}return M},$.prototype.empty=function(){return this.size()===0},$.prototype.clear=function(){this.examples={}},$.prototype.getVocabulary=function(){var M=new Set;for(var T in this.examples){var O=this.examples[T];M.add(O.label)}var L=Or(M);return L.sort(),L},$.prototype.serialize=function(M){var T,O,L,J,ie=this.getVocabulary();I.util.assert(!this.empty(),function(){return"Cannot serialize empty Dataset"}),M!=null&&(Array.isArray(M)||(M=[M]),M.forEach(function(Fn){if(ie.indexOf(Fn)===-1)throw new Error('Word label "'+Fn+'" does not exist in the vocabulary of this dataset. The vocabulary is: '+JSON.stringify(ie)+".")}));var ge=[],Ae=[];try{for(var Ie=zn(ie),De=Ie.next();!De.done;De=Ie.next()){var et=De.value;if(M==null||M.indexOf(et)!==-1){var ot=this.label2Ids[et];try{for(var zt=zn(ot),Ht=zt.next();!Ht.done;Ht=zt.next()){var xn=Ht.value,En=Rt(this.examples[xn]);ge.push(En.spec),Ae.push(En.data)}}catch(Fn){L={error:Fn}}finally{try{Ht&&!Ht.done&&(J=zt.return)&&J.call(zt)}finally{if(L)throw L.error}}}}}catch(Fn){T={error:Fn}}finally{try{De&&!De.done&&(O=Ie.return)&&O.call(Ie)}finally{if(T)throw T.error}}return function(Fn){var Rn=Me(JSON.stringify(Fn.manifest)),Wn=Me(Ct),Jn=new Uint32Array([tn]),Tn=new Uint32Array([Rn.byteLength]);return ve([ve([Wn,Jn.buffer,Tn.buffer]),Rn,Fn.data])}({manifest:ge,data:ve(Ae)})},$}();function Rt($){var M=$.rawAudio!=null,T={label:$.label,spectrogramNumFrames:$.spectrogram.data.length/$.spectrogram.frameSize,spectrogramFrameSize:$.spectrogram.frameSize};$.spectrogram.keyFrameIndex!=null&&(T.spectrogramKeyFrameIndex=$.spectrogram.keyFrameIndex);var O=$.spectrogram.data.buffer.slice(0);return M&&(T.rawAudioNumSamples=$.rawAudio.data.length,T.rawAudioSampleRateHz=$.rawAudio.sampleRateHz,O=ve([O,$.rawAudio.data.buffer])),{spec:T,data:O}}function Zt($){var M={frameSize:$.spec.spectrogramFrameSize,data:new Float32Array($.data.slice(0,4*$.spec.spectrogramFrameSize*$.spec.spectrogramNumFrames))};$.spec.spectrogramKeyFrameIndex!=null&&(M.keyFrameIndex=$.spec.spectrogramKeyFrameIndex);var T={label:$.spec.label,spectrogram:M};return $.spec.rawAudioNumSamples!=null&&(T.rawAudio={sampleRateHz:$.spec.rawAudioSampleRateHz,data:new Float32Array($.data.slice(4*$.spec.spectrogramFrameSize*$.spec.spectrogramNumFrames))}),T}function mn($,M,T,O){if(I.util.assert(Number.isInteger($)&&$>0,function(){return"snippetLength must be a positive integer, but got "+$}),M!=null&&I.util.assert(Number.isInteger(M)&&M>=0,function(){return"focusIndex must be a non-negative integer, but got "+M}),I.util.assert(Number.isInteger(T)&&T>0,function(){return"windowLength must be a positive integer, but got "+T}),I.util.assert(Number.isInteger(O)&&O>0,function(){return"windowHop must be a positive integer, but got "+O}),I.util.assert(T<=$,function(){return"windowLength ("+T+") exceeds snippetLength ("+$+")"}),I.util.assert(M<$,function(){return"focusIndex ("+M+") equals or exceeds snippetLength ("+$+")"}),T===$)return[[0,$]];var L=[];if(M==null){for(var J=0;J+T<=$;)L.push([J,J+T]),J+=O;return L}var ie=Math.floor(T/2),ge=M-ie;for(ge<0?ge=0:ge+T>$&&(ge=$-T);!(ge-O<0||M>=ge-O+T);)ge-=O;for(;ge+T<=$&&!(M<ge);)L.push([ge,ge+T]),ge+=O;return L}function fn($){return Object(I.tidy)(function(){return function(M){return Object(I.tidy)(function(){var T=M.data.length/M.frameSize;return Object(I.tensor2d)(M.data,[T,M.frameSize]).mean(-1)})}($).argMax()})}var mt="0.3.9",Mt="tfjs-speech-commands-saved-model-metadata",hn="indexeddb://tfjs-speech-commands-model/",nn={localStorage:typeof window>"u"?null:window.localStorage},He=function(){function $(M,T,O){this.MODEL_URL_PREFIX="https://storage.googleapis.com/tfjs-models/tfjs/speech-commands/v"+function(L){return L.split(".").slice(0,2).join(".")}(mt)+"/browser_fft",this.SAMPLE_RATE_HZ=44100,this.FFT_SIZE=1024,this.DEFAULT_SUPPRESSION_TIME_MILLIS=0,this.streaming=!1,this.transferRecognizers={},I.util.assert(T==null&&O==null||T!=null&&O!=null,function(){return"modelURL and metadataURL must be both provided or both not provided."}),T==null?(M==null?M=$.DEFAULT_VOCABULARY_NAME:I.util.assert($.VALID_VOCABULARY_NAMES.indexOf(M)!==-1,function(){return"Invalid vocabulary name: '"+M+"'"}),this.vocabulary=M,this.modelArtifactsOrURL=this.MODEL_URL_PREFIX+"/"+this.vocabulary+"/model.json",this.metadataOrURL=this.MODEL_URL_PREFIX+"/"+this.vocabulary+"/metadata.json"):(I.util.assert(M==null,function(){return"vocabulary name must be null or undefined when modelURL is provided"}),this.modelArtifactsOrURL=T,this.metadataOrURL=O),this.parameters={sampleRateHz:this.SAMPLE_RATE_HZ,fftSize:this.FFT_SIZE}}return $.prototype.listen=function(M,T){return Ur(this,void 0,void 0,function(){var O,L,J,ie,ge,Ae=this;return Xr(this,function(Ie){switch(Ie.label){case 0:if(this.streaming)throw new Error("Cannot start streaming again when streaming is ongoing.");return[4,this.ensureModelLoaded()];case 1:if(Ie.sent(),T==null&&(T={}),O=T.probabilityThreshold==null?0:T.probabilityThreshold,T.includeEmbedding&&(O=0),I.util.assert(O>=0&&O<=1,function(){return"Invalid probabilityThreshold value: "+O}),L=T.invokeCallbackOnNoiseAndUnknown!=null&&T.invokeCallbackOnNoiseAndUnknown,T.includeEmbedding&&(L=!0),T.suppressionTimeMillis<0)throw new Error("suppressionTimeMillis is expected to be >= 0, but got "+T.suppressionTimeMillis);return J=T.overlapFactor==null?.5:T.overlapFactor,I.util.assert(J>=0&&J<1,function(){return"Expected overlapFactor to be >= 0 and < 1, but got "+J}),ie=function(De,et){return Ur(Ae,void 0,void 0,function(){var ot,zt,Ht,xn,En,Fn,Rn,Wn,Jn,Tn,_r;return Xr(this,function(Nr){switch(Nr.label){case 0:return zt=Kr(De),T.includeEmbedding?[4,this.ensureModelWithEmbeddingOutputCreated()]:[3,2];case 1:return Nr.sent(),ot=ir(this.modelWithEmbeddingOutput.predict(zt),2),Ht=ot[0],xn=ot[1],[3,3];case 2:Ht=this.model.predict(zt),Nr.label=3;case 3:return[4,Ht.data()];case 4:return En=Nr.sent(),[4,(Fn=Ht.argMax(-1)).data()];case 5:return Rn=Nr.sent()[0],Wn=Math.max.apply(Math,Or(En)),Object(I.dispose)([Ht,Fn,zt]),Wn<O?[2,!1]:[3,6];case 6:return Jn=void 0,T.includeSpectrogram?(Tn={},[4,De.data()]):[3,8];case 7:Tn.data=Nr.sent(),Tn.frameSize=this.nonBatchInputShape[1],Jn=Tn,Nr.label=8;case 8:return _r=!0,L||this.words[Rn]!=="_background_noise_"&&this.words[Rn]!=="_unknown_"||(_r=!1),_r&&M({scores:En,spectrogram:Jn,embedding:xn}),[2,_r]}})})},ge=T.suppressionTimeMillis==null?this.DEFAULT_SUPPRESSION_TIME_MILLIS:T.suppressionTimeMillis,this.audioDataExtractor=new Tt({sampleRateHz:this.parameters.sampleRateHz,numFramesPerSpectrogram:this.nonBatchInputShape[0],columnTruncateLength:this.nonBatchInputShape[1],suppressionTimeMillis:ge,spectrogramCallback:ie,overlapFactor:J}),[4,this.audioDataExtractor.start(T.audioTrackConstraints)];case 2:return Ie.sent(),this.streaming=!0,[2]}})})},$.prototype.ensureModelLoaded=function(){return Ur(this,void 0,void 0,function(){var M,T,O,L,J=this;return Xr(this,function(ie){switch(ie.label){case 0:return this.model!=null?[2]:[4,this.ensureMetadataLoaded()];case 1:return ie.sent(),typeof this.modelArtifactsOrURL!="string"?[3,3]:[4,Object(I.loadLayersModel)(this.modelArtifactsOrURL)];case 2:return M=ie.sent(),[3,5];case 3:return[4,Object(I.loadLayersModel)(I.io.fromMemory(this.modelArtifactsOrURL.modelTopology,this.modelArtifactsOrURL.weightSpecs,this.modelArtifactsOrURL.weightData))];case 4:M=ie.sent(),ie.label=5;case 5:if(M.inputs.length!==1)throw new Error("Expected model to have 1 input, but got a model with "+M.inputs.length+" inputs");if(M.inputs[0].shape.length!==4)throw new Error("Expected model to have an input shape of rank 4, but got an input shape of rank "+M.inputs[0].shape.length);if(M.inputs[0].shape[3]!==1)throw new Error("Expected model to have an input shape with 1 as the last dimension, but got input shape"+JSON.stringify(M.inputs[0].shape[3])+"}");if((T=M.outputShape).length!==2)throw new Error("Expected loaded model to have an output shape of rank 2,but received shape "+JSON.stringify(T));if(T[1]!==this.words.length)throw new Error("Mismatch between the last dimension of model's output shape ("+T[1]+") and number of words ("+this.words.length+").");return this.model=M,this.freezeModel(),this.nonBatchInputShape=M.inputs[0].shape.slice(1),this.elementsPerExample=1,M.inputs[0].shape.slice(1).forEach(function(ge){return J.elementsPerExample*=ge}),this.warmUpModel(),O=this.parameters.fftSize/this.parameters.sampleRateHz*1e3,L=M.inputs[0].shape[1],this.parameters.spectrogramDurationMillis=L*O,[2]}})})},$.prototype.ensureModelWithEmbeddingOutputCreated=function(){return Ur(this,void 0,void 0,function(){var M,T;return Xr(this,function(O){switch(O.label){case 0:return this.modelWithEmbeddingOutput!=null?[2]:[4,this.ensureModelLoaded()];case 1:for(O.sent(),T=this.model.layers.length-2;T>=0;--T)if(this.model.layers[T].getClassName()==="Dense"){M=this.model.layers[T];break}if(M==null)throw new Error("Failed to find second last dense layer in the original model.");return this.modelWithEmbeddingOutput=Object(I.model)({inputs:this.model.inputs,outputs:[this.model.outputs[0],M.output]}),[2]}})})},$.prototype.warmUpModel=function(){var M=this;Object(I.tidy)(function(){for(var T=Object(I.zeros)([1].concat(M.nonBatchInputShape)),O=0;O<3;++O)M.model.predict(T)})},$.prototype.ensureMetadataLoaded=function(){return Ur(this,void 0,void 0,function(){var M,T,O;return Xr(this,function(L){switch(L.label){case 0:return this.words!=null?[2]:typeof this.metadataOrURL!="string"?[3,2]:[4,function(J){return Ur(this,void 0,void 0,function(){return Xr(this,function(ie){return[2,new Promise(function(ge,Ae){J.indexOf("http://")===0||J.indexOf("https://")===0?fetch(J).then(function(Ie){Ie.json().then(function(De){return ge(De)})}):J.indexOf("file://")===0?r(185).readFile(J.slice(7),{encoding:"utf-8"},function(Ie,De){return ge(JSON.parse(De))}):Ae(new Error("Unsupported URL scheme in metadata URL: "+J+". Supported schemes are: http://, https://, and (node.js-only) file://"))})]})})}(this.metadataOrURL)];case 1:return T=L.sent(),[3,3];case 2:T=this.metadataOrURL,L.label=3;case 3:if((M=T).wordLabels==null){if((O=M.words)==null)throw new Error('Cannot find field "words" or "wordLabels" in metadata JSON file');this.words=O}else this.words=M.wordLabels;return[2]}})})},$.prototype.stopListening=function(){return Ur(this,void 0,void 0,function(){return Xr(this,function(M){switch(M.label){case 0:if(!this.streaming)throw new Error("Cannot stop streaming when streaming is not ongoing.");return[4,this.audioDataExtractor.stop()];case 1:return M.sent(),this.streaming=!1,[2]}})})},$.prototype.isListening=function(){return this.streaming},$.prototype.wordLabels=function(){return this.words},$.prototype.params=function(){return this.parameters},$.prototype.modelInputShape=function(){if(this.model==null)throw new Error("Model has not been loaded yet. Load model by calling ensureModelLoaded(), recognize(), or listen().");return this.model.inputs[0].shape},$.prototype.recognize=function(M,T){return Ur(this,void 0,void 0,function(){var O,L,J,ie,ge,Ae,Ie,De,et,ot,zt,Ht,xn;return Xr(this,function(En){switch(En.label){case 0:return T==null&&(T={}),[4,this.ensureModelLoaded()];case 1:return En.sent(),M!=null?[3,3]:[4,this.recognizeOnline()];case 2:O=En.sent(),M=O.data,En.label=3;case 3:if(M instanceof I.Tensor)this.checkInputTensorShape(M),J=M,L=M.shape[0];else{if((M=M).length%this.elementsPerExample)throw new Error("The length of the input Float32Array "+M.length+" is not divisible by the number of tensor elements per per example expected by the model "+this.elementsPerExample+".");L=M.length/this.elementsPerExample,J=Object(I.tensor4d)(M,[L].concat(this.nonBatchInputShape))}return ge={scores:null},T.includeEmbedding?[4,this.ensureModelWithEmbeddingOutputCreated()]:[3,5];case 4:return En.sent(),Ae=this.modelWithEmbeddingOutput.predict(J),ie=Ae[0],ge.embedding=Ae[1],[3,6];case 5:ie=this.model.predict(J),En.label=6;case 6:return L!==1?[3,8]:(Ie=ge,[4,ie.data()]);case 7:return Ie.scores=En.sent(),[3,10];case 8:return De=Object(I.unstack)(ie),et=De.map(function(Fn){return Fn.data()}),ot=ge,[4,Promise.all(et)];case 9:ot.scores=En.sent(),Object(I.dispose)(De),En.label=10;case 10:return T.includeSpectrogram?(zt=ge,Ht={},M instanceof I.Tensor?[4,M.data()]:[3,12]):[3,14];case 11:return xn=En.sent(),[3,13];case 12:xn=M,En.label=13;case 13:zt.spectrogram=(Ht.data=xn,Ht.frameSize=this.nonBatchInputShape[1],Ht),En.label=14;case 14:return[2,ge]}})})},$.prototype.recognizeOnline=function(){return Ur(this,void 0,void 0,function(){var M=this;return Xr(this,function(T){return[2,new Promise(function(O,L){M.audioDataExtractor=new Tt({sampleRateHz:M.parameters.sampleRateHz,numFramesPerSpectrogram:M.nonBatchInputShape[0],columnTruncateLength:M.nonBatchInputShape[1],suppressionTimeMillis:0,spectrogramCallback:function(J){return Ur(M,void 0,void 0,function(){var ie,ge,Ae;return Xr(this,function(Ie){switch(Ie.label){case 0:return ie=Kr(J),[4,this.audioDataExtractor.stop()];case 1:return Ie.sent(),ge=O,Ae={},[4,ie.data()];case 2:return ge.apply(void 0,[(Ae.data=Ie.sent(),Ae.frameSize=this.nonBatchInputShape[1],Ae)]),ie.dispose(),[2,!1]}})})},overlapFactor:0}),M.audioDataExtractor.start()})]})})},$.prototype.createTransfer=function(M){if(this.model==null)throw new Error("Model has not been loaded yet. Load model by calling ensureModelLoaded(), recognizer(), or listen().");I.util.assert(M!=null&&typeof M=="string"&&M.length>1,function(){return"Expected the name for a transfer-learning recognized to be a non-empty string, but got "+JSON.stringify(M)}),I.util.assert(this.transferRecognizers[M]==null,function(){return"There is already a transfer-learning model named '"+M+"'"});var T=new Bn(M,this.parameters,this.model);return this.transferRecognizers[M]=T,T},$.prototype.freezeModel=function(){var M,T;try{for(var O=zn(this.model.layers),L=O.next();!L.done;L=O.next())L.value.trainable=!1}catch(J){M={error:J}}finally{try{L&&!L.done&&(T=O.return)&&T.call(O)}finally{if(M)throw M.error}}},$.prototype.checkInputTensorShape=function(M){var T=this.model.inputs[0].shape.length;if(M.shape.length!==T)throw new Error("Expected input Tensor to have rank "+T+", but got rank "+M.shape.length+" that differs ");var O=M.shape.slice(1),L=this.model.inputs[0].shape.slice(1);if(!I.util.arraysEqual(O,L))throw new Error("Expected input to have shape [null,"+L+"], but got shape [null,"+O+"]")},$.VALID_VOCABULARY_NAMES=["18w","directional4w"],$.DEFAULT_VOCABULARY_NAME="18w",$}(),Bn=function($){function M(T,O,L){var J=$.call(this)||this;return J.name=T,J.parameters=O,J.baseModel=L,I.util.assert(T!=null&&typeof T=="string"&&T.length>0,function(){return"The name of a transfer model must be a non-empty string, but got "+JSON.stringify(T)}),J.nonBatchInputShape=J.baseModel.inputs[0].shape.slice(1),J.words=null,J.dataset=new Sn,J}return function(T,O){function L(){this.constructor=T}dr(T,O),T.prototype=O===null?Object.create(O):(L.prototype=O.prototype,new L)}(M,$),M.prototype.collectExample=function(T,O){return Ur(this,void 0,void 0,function(){var L,J,ie,ge,Ae=this;return Xr(this,function(Ie){if(I.util.assert(!this.streaming,function(){return"Cannot start collection of transfer-learning example because a streaming recognition or transfer-learning example collection is ongoing"}),I.util.assert(T!=null&&typeof T=="string"&&T.length>0,function(){return"Must provide a non-empty string when collecting transfer-learning example"}),O==null&&(O={}),O.durationMultiplier!=null&&O.durationSec!=null)throw new Error("durationMultiplier and durationSec are mutually exclusive, but are both specified.");return O.durationSec!=null?(I.util.assert(O.durationSec>0,function(){return"Expected durationSec to be > 0, but got "+O.durationSec}),J=this.parameters.fftSize/this.parameters.sampleRateHz,L=Math.ceil(O.durationSec/J)):O.durationMultiplier!=null?(I.util.assert(O.durationMultiplier>=1,function(){return"Expected duration multiplier to be >= 1, but got "+O.durationMultiplier}),L=Math.round(this.nonBatchInputShape[0]*O.durationMultiplier)):L=this.nonBatchInputShape[0],O.snippetDurationSec!=null&&(I.util.assert(O.snippetDurationSec>0,function(){return"snippetDurationSec is expected to be > 0, but got "+O.snippetDurationSec}),I.util.assert(O.onSnippet!=null,function(){return"onSnippet must be provided if snippetDurationSec is provided."})),O.onSnippet!=null&&I.util.assert(O.snippetDurationSec!=null,function(){return"snippetDurationSec must be provided if onSnippet is provided."}),ie=this.parameters.fftSize/this.parameters.sampleRateHz,ge=ie*L,this.streaming=!0,[2,new Promise(function(De){var et=O.snippetDurationSec==null?1:O.snippetDurationSec/ge,ot=1-et,zt=Math.round(1/et),Ht=0,xn=-1,En=[];Ae.audioDataExtractor=new Tt({sampleRateHz:Ae.parameters.sampleRateHz,numFramesPerSpectrogram:L,columnTruncateLength:Ae.nonBatchInputShape[1],suppressionTimeMillis:0,spectrogramCallback:function(Fn,Rn){return Ur(Ae,void 0,void 0,function(){var Wn,Jn,Tn,_r,Nr,Ir,Qr,zr,ki,Pi,Fi,Mo,Jo,jo,Bo,Ho,la,va,Fa,mu;return Xr(this,function(Li){switch(Li.label){case 0:return O.onSnippet!=null?[3,7]:(Wn=Kr(Fn),Tn=(Jn=this.dataset).addExample,_r={label:T},Nr={},[4,Wn.data()]);case 1:return _r.spectrogram=(Nr.data=Li.sent(),Nr.frameSize=this.nonBatchInputShape[1],Nr),O.includeRawAudio?(Qr={},[4,Rn.data()]):[3,3];case 2:return Qr.data=Li.sent(),Qr.sampleRateHz=this.audioDataExtractor.sampleRateHz,Ir=Qr,[3,4];case 3:Ir=void 0,Li.label=4;case 4:return Tn.apply(Jn,[(_r.rawAudio=Ir,_r)]),Wn.dispose(),[4,this.audioDataExtractor.stop()];case 5:return Li.sent(),this.streaming=!1,this.collateTransferWords(),zr=De,ki={},[4,Fn.data()];case 6:return zr.apply(void 0,[(ki.data=Li.sent(),ki.frameSize=this.nonBatchInputShape[1],ki)]),[3,13];case 7:return[4,Fn.data()];case 8:for(Pi=Li.sent(),xn===-1&&(xn=Pi.length),Fi=xn-1;Pi[Fi]!==0&&Fi>=0;)Fi--;return Mo=xn-Fi-1,xn=Fi+1,Jo=Pi.slice(Pi.length-Mo,Pi.length),En.push(Jo),O.onSnippet!=null&&O.onSnippet({data:Jo,frameSize:this.nonBatchInputShape[1]}),Ht++!==zt?[3,13]:[4,this.audioDataExtractor.stop()];case 9:return Li.sent(),this.streaming=!1,this.collateTransferWords(),jo=function(ts){if(ts.length<2)throw new Error("Cannot normalize a Float32Array with fewer than 2 elements.");return qr==null&&(qr=Object(I.backend)().epsilon()),Object(I.tidy)(function(){var ss=Object(I.moments)(Object(I.tensor1d)(ts)),gu=ss.mean,Ws=ss.variance,Pu=gu.arraySync(),Lu=Math.sqrt(Ws.arraySync()),Bu=Array.from(ts).map(function(up){return(up-Pu)/(Lu+qr)});return new Float32Array(Bu)})}(ke(En)),Bo={data:jo,frameSize:this.nonBatchInputShape[1]},la=(Ho=this.dataset).addExample,va={label:T,spectrogram:Bo},O.includeRawAudio?(mu={},[4,Rn.data()]):[3,11];case 10:return mu.data=Li.sent(),mu.sampleRateHz=this.audioDataExtractor.sampleRateHz,Fa=mu,[3,12];case 11:Fa=void 0,Li.label=12;case 12:la.apply(Ho,[(va.rawAudio=Fa,va)]),De(Bo),Li.label=13;case 13:return[2,!1]}})})},overlapFactor:ot,includeRawAudio:O.includeRawAudio}),Ae.audioDataExtractor.start(O.audioTrackConstraints)})]})})},M.prototype.clearExamples=function(){var T=this;I.util.assert(this.words!=null&&this.words.length>0&&!this.dataset.empty(),function(){return"No transfer learning examples exist for model name "+T.name}),this.dataset.clear(),this.words=null},M.prototype.countExamples=function(){if(this.dataset.empty())throw new Error("No examples have been collected for transfer-learning model named '"+this.name+"' yet.");return this.dataset.getExampleCounts()},M.prototype.getExamples=function(T){return this.dataset.getExamples(T)},M.prototype.setExampleKeyFrameIndex=function(T,O){this.dataset.setExampleKeyFrameIndex(T,O)},M.prototype.removeExample=function(T){this.dataset.removeExample(T),this.collateTransferWords()},M.prototype.isDatasetEmpty=function(){return this.dataset.empty()},M.prototype.loadExamples=function(T,O){var L,J,ie,ge;O===void 0&&(O=!1);var Ae=new Sn(T);O&&this.clearExamples();var Ie=Ae.getVocabulary();try{for(var De=zn(Ie),et=De.next();!et.done;et=De.next()){var ot=et.value,zt=Ae.getExamples(ot);try{for(var Ht=zn(zt),xn=Ht.next();!xn.done;xn=Ht.next()){var En=xn.value;this.dataset.addExample(En.example)}}catch(Fn){ie={error:Fn}}finally{try{xn&&!xn.done&&(ge=Ht.return)&&ge.call(Ht)}finally{if(ie)throw ie.error}}}}catch(Fn){L={error:Fn}}finally{try{et&&!et.done&&(J=De.return)&&J.call(De)}finally{if(L)throw L.error}}this.collateTransferWords()},M.prototype.serializeExamples=function(T){return this.dataset.serialize(T)},M.prototype.collateTransferWords=function(){this.words=this.dataset.getVocabulary()},M.prototype.collectTransferDataAsTensors=function(T,O){var L=this.nonBatchInputShape[0];T=T||.25;var J=Math.round(T*L),ie=this.dataset.getData(null,oi({numFrames:L,hopFrames:J},O));return{xs:ie.xs,ys:ie.ys}},M.prototype.collectTransferDataAsTfDataset=function(T,O,L,J){O===void 0&&(O=.15),L===void 0&&(L=32);var ie=this.nonBatchInputShape[0];T=T||.25;var ge=Math.round(T*ie);return this.dataset.getData(null,oi({numFrames:ie,hopFrames:ge,getDataset:!0,datasetBatchSize:L,datasetValidationSplit:O},J))},M.prototype.train=function(T){return Ur(this,void 0,void 0,function(){var O,L=this;return Xr(this,function(J){switch(J.label){case 0:return I.util.assert(this.words!=null&&this.words.length>0,function(){return"Cannot train transfer-learning model '"+L.name+"' because no transfer learning example has been collected."}),I.util.assert(this.words.length>1,function(){return"Cannot train transfer-learning model '"+L.name+"' because only 1 word label ('"+JSON.stringify(L.words)+"') has been collected for transfer learning. Requires at least 2."}),T.fineTuningEpochs!=null&&I.util.assert(T.fineTuningEpochs>=0&&Number.isInteger(T.fineTuningEpochs),function(){return"If specified, fineTuningEpochs must be a non-negative integer, but received "+T.fineTuningEpochs}),T==null&&(T={}),this.model==null&&this.createTransferModelFromBaseModel(),this.secondLastBaseDenseLayer.trainable=!1,this.model.compile({loss:"categoricalCrossentropy",optimizer:T.optimizer||"sgd",metrics:["acc"]}),O=T.fitDatasetDurationMillisThreshold==null?6e4:T.fitDatasetDurationMillisThreshold,this.dataset.durationMillis()>O?(console.log("Detected large dataset: total duration = "+this.dataset.durationMillis()+" ms > "+O+" ms. Training transfer model using fitDataset() instead of fit()"),[4,this.trainOnDataset(T)]):[3,2];case 1:return[2,J.sent()];case 2:return[4,this.trainOnTensors(T)];case 3:return[2,J.sent()]}})})},M.prototype.trainOnDataset=function(T){return Ur(this,void 0,void 0,function(){var O,L,J,ie,ge,Ae,Ie,De,et;return Xr(this,function(ot){switch(ot.label){case 0:return I.util.assert(T.epochs>0,function(){return"Invalid config.epochs"}),O=T.batchSize==null?32:T.batchSize,L=T.windowHopRatio||.25,J=ir(this.collectTransferDataAsTfDataset(L,T.validationSplit,O,{augmentByMixingNoiseRatio:T.augmentByMixingNoiseRatio}),2),ie=J[0],ge=J[1],Ae=I.util.now(),[4,this.model.fitDataset(ie,{epochs:T.epochs,validationData:T.validationSplit>0?ge:null,callbacks:T.callback==null?null:[T.callback]})];case 1:return Ie=ot.sent(),console.log("fitDataset() took "+(I.util.now()-Ae).toFixed(2)+" ms"),T.fineTuningEpochs!=null&&T.fineTuningEpochs>0?(De=I.util.now(),[4,this.fineTuningUsingTfDatasets(T,ie,ge)]):[3,3];case 2:return et=ot.sent(),console.log("fitDataset() (fine-tuning) took "+(I.util.now()-De).toFixed(2)+" ms"),[2,[Ie,et]];case 3:return[2,Ie]}})})},M.prototype.trainOnTensors=function(T){return Ur(this,void 0,void 0,function(){var O,L,J,ie,ge,Ae,Ie,De,et,ot;return Xr(this,function(zt){switch(zt.label){case 0:O=T.windowHopRatio||.25,L=this.collectTransferDataAsTensors(O,{augmentByMixingNoiseRatio:T.augmentByMixingNoiseRatio}),J=L.xs,ie=L.ys,console.log("Training data: xs.shape = "+J.shape+", ys.shape = "+ie.shape),zt.label=1;case 1:return zt.trys.push([1,,6,7]),T.validationSplit!=null?(De=function(Ht,xn,En){return I.util.assert(En>0&&En<1,function(){return"validationSplit is expected to be >0 and <1, but got "+En}),Object(I.tidy)(function(){for(var Fn=xn.argMax(-1).dataSync(),Rn=[],Wn=0;Wn<Fn.length;++Wn){var Jn=Fn[Wn];Rn[Jn]==null&&(Rn[Jn]=[]),Rn[Jn].push(Wn)}var Tn=Rn.length,_r=[],Nr=[];for(Rn.map(function(ki){return I.util.shuffle(ki)}),Wn=0;Wn<Tn;++Wn)for(var Ir=Rn[Wn],Qr=Math.round(Ir.length*(1-En)),zr=0;zr<Ir.length;++zr)zr<Qr?_r.push(Ir[zr]):Nr.push(Ir[zr]);return{trainXs:Object(I.gather)(Ht,_r),trainYs:Object(I.gather)(xn,_r),valXs:Object(I.gather)(Ht,Nr),valYs:Object(I.gather)(xn,Nr)}})}(J,ie,T.validationSplit),ge=De.trainXs,Ae=De.trainYs,Ie=[De.valXs,De.valYs]):(ge=J,Ae=ie),[4,this.model.fit(ge,Ae,{epochs:T.epochs==null?20:T.epochs,validationData:Ie,batchSize:T.batchSize,callbacks:T.callback==null?null:[T.callback]})];case 2:return et=zt.sent(),T.fineTuningEpochs!=null&&T.fineTuningEpochs>0?[4,this.fineTuningUsingTensors(T,ge,Ae,Ie)]:[3,4];case 3:return ot=zt.sent(),[2,[et,ot]];case 4:return[2,et];case 5:return[3,7];case 6:return Object(I.dispose)([J,ie,ge,Ae,Ie]),[7];case 7:return[2]}})})},M.prototype.fineTuningUsingTfDatasets=function(T,O,L){return Ur(this,void 0,void 0,function(){var J,ie,ge;return Xr(this,function(Ae){switch(Ae.label){case 0:return J=this.secondLastBaseDenseLayer.trainable,this.secondLastBaseDenseLayer.trainable=!0,ie=T.fineTuningOptimizer==null?"sgd":T.fineTuningOptimizer,this.model.compile({loss:"categoricalCrossentropy",optimizer:ie,metrics:["acc"]}),[4,this.model.fitDataset(O,{epochs:T.fineTuningEpochs,validationData:L,callbacks:T.callback==null?null:[T.callback]})];case 1:return ge=Ae.sent(),this.secondLastBaseDenseLayer.trainable=J,[2,ge]}})})},M.prototype.fineTuningUsingTensors=function(T,O,L,J){return Ur(this,void 0,void 0,function(){var ie,ge,Ae;return Xr(this,function(Ie){switch(Ie.label){case 0:return ie=this.secondLastBaseDenseLayer.trainable,this.secondLastBaseDenseLayer.trainable=!0,ge=T.fineTuningOptimizer==null?"sgd":T.fineTuningOptimizer,this.model.compile({loss:"categoricalCrossentropy",optimizer:ge,metrics:["acc"]}),[4,this.model.fit(O,L,{epochs:T.fineTuningEpochs,validationData:J,batchSize:T.batchSize,callbacks:T.fineTuningCallback==null?null:[T.fineTuningCallback]})];case 1:return Ae=Ie.sent(),this.secondLastBaseDenseLayer.trainable=ie,[2,Ae]}})})},M.prototype.evaluate=function(T){return Ur(this,void 0,void 0,function(){var O,L=this;return Xr(this,function(J){return I.util.assert(T.wordProbThresholds!=null&&T.wordProbThresholds.length>0,function(){return"Received null or empty wordProbThresholds"}),O=0,I.util.assert(this.words[O]==="_background_noise_",function(){return"Cannot perform evaluation when the first tag is not _background_noise_"}),[2,Object(I.tidy)(function(){for(var ie=[],ge=0,Ae=L.collectTransferDataAsTensors(T.windowHopRatio),Ie=Ae.xs,De=Ae.ys.argMax(-1).dataSync(),et=L.model.predict(Ie),ot=et.slice([0,1],[et.shape[0],et.shape[1]-1]).max(-1),zt=et.shape[0],Ht=0;Ht<T.wordProbThresholds.length;++Ht){for(var xn=T.wordProbThresholds[Ht],En=ot.greater(Object(I.scalar)(xn)).dataSync(),Fn=0,Rn=0,Wn=0,Jn=0,Tn=0;Tn<zt;++Tn)De[Tn]===O?(Fn++,En[Tn]&&Wn++):(Rn++,En[Tn]&&Jn++);var _r=Wn/Fn,Nr=Jn/Rn;ie.push({probThreshold:xn,fpr:_r,tpr:Nr}),console.log("ROC thresh="+xn+": fpr="+_r.toFixed(4)+", tpr="+Nr.toFixed(4)),Ht>0&&(ge+=Math.abs(ie[Ht-1].fpr-ie[Ht].fpr)*(ie[Ht-1].tpr+ie[Ht].tpr)/2)}return{rocCurve:ie,auc:ge}})]})})},M.prototype.createTransferModelFromBaseModel=function(){var T=this;I.util.assert(this.words!=null,function(){return"No word example is available for tranfer-learning model of name "+T.name});for(var O=this.baseModel.layers,L=O.length-2;L>=0&&O[L].getClassName().toLowerCase()!=="dense";)L--;if(L<0)throw new Error("Cannot find a hidden dense layer in the base model.");this.secondLastBaseDenseLayer=O[L];var J=this.secondLastBaseDenseLayer.output;this.transferHead=Object(I.sequential)(),this.transferHead.add(I.layers.dense({units:this.words.length,activation:"softmax",inputShape:J.shape.slice(1),name:"NewHeadDense"}));var ie=this.transferHead.apply(J);this.model=Object(I.model)({inputs:this.baseModel.inputs,outputs:ie})},M.prototype.modelInputShape=function(){return this.baseModel.inputs[0].shape},M.prototype.getMetadata=function(){return{tfjsSpeechCommandsVersion:mt,modelName:this.name,timeStamp:new Date().toISOString(),wordLabels:this.wordLabels()}},M.prototype.save=function(T){return Ur(this,void 0,void 0,function(){var O,L,J;return Xr(this,function(ie){return O=T!=null,T=T||Xn(this.name),O||(L=nn.localStorage.getItem(Mt),(J=L==null?{}:JSON.parse(L))[this.name]=this.getMetadata(),nn.localStorage.setItem(Mt,JSON.stringify(J))),console.log("Saving model to "+T),[2,this.model.save(T)]})})},M.prototype.load=function(T){return Ur(this,void 0,void 0,function(){var O,L,J;return Xr(this,function(ie){switch(ie.label){case 0:if(O=T!=null,T=T||Xn(this.name),!O){if((L=JSON.parse(nn.localStorage.getItem(Mt)))==null||L[this.name]==null)throw new Error("Cannot find metadata for transfer model named "+this.name+'"');this.words=L[this.name].wordLabels,console.log("Loaded word list for model named "+this.name+": "+this.words)}return J=this,[4,Object(I.loadLayersModel)(T)];case 1:return J.model=ie.sent(),console.log("Loaded model from "+T+":"),this.model.summary(),[2]}})})},M.prototype.createTransfer=function(T){throw new Error("Creating transfer-learned recognizer from a transfer-learned recognizer is not supported.")},M}(He);function Xn($){return""+hn+$}function Zn($,M,T,O){if(I.util.assert(T==null&&O==null||T!=null&&O!=null,function(){return"customModelURL and customMetadataURL must be both provided or both not provided."}),T!=null&&I.util.assert(M==null,function(){return"vocabulary name must be null or undefined when modelURL is provided."}),$==="BROWSER_FFT")return new He(M,T,O);throw $==="SOFT_FFT"?new Error("SOFT_FFT SpeechCommandRecognizer has not been implemented yet."):new Error("Invalid fftType: '"+$+"'")}var lr=function(){function $(M){oe()(this,$),this.options=M}return _e()($,[{key:"load",value:function(){var M=q()(me.a.mark(function T(O){var L,J,ie;return me.a.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return O?(L=O.split("/"),J=L.slice(0,L.length-1).join("/"),ie="".concat(J,"/metadata.json"),this.model=Zn("BROWSER_FFT",void 0,O,ie)):this.model=Zn("BROWSER_FFT"),ge.next=3,this.model.ensureModelLoaded();case 3:this.allLabels=this.model.wordLabels();case 4:case"end":return ge.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"classify",value:function(){var M=this,T=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.allLabels.length,O=arguments.length>1?arguments[1]:void 0;return this.model.listen(function(L){if(L.scores){var J=Xt(L.scores,T,M.allLabels).map(function(ie){return{label:ie.className,confidence:ie.probability}});return O(null,J)}return O("ERROR: Cannot find scores in result: ".concat(L))},this.options).catch(function(L){return O("ERROR: ".concat(L.message))})}}]),$}();function jr($,M){return Cr.apply(this,arguments)}function Cr(){return(Cr=q()(me.a.mark(function $(M,T){var O;return me.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return O=new lr(M),L.next=3,O.load(T);case 3:return L.abrupt("return",O);case 4:case"end":return L.stop()}},$)}))).apply(this,arguments)}var xi=["speechcommands18w"],Ai=function(){function $(M,T,O){if(oe()(this,$),this.model=null,this.options=T,typeof M=="string")if(xi.includes(M))switch(this.modelName=M,this.modelUrl=null,this.modelName){case"speechcommands18w":this.modelToUse=U;break;default:this.modelToUse=null}else this.modelToUse=U,this.modelUrl=M;this.ready=Ge(this.loadModel(T,this.modelUrl),O)}return _e()($,[{key:"loadModel",value:function(){var M=q()(me.a.mark(function T(O){return me.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,this.modelToUse.load(O,this.modelUrl);case 2:return this.model=L.sent,L.abrupt("return",this);case 4:case"end":return L.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var M=q()(me.a.mark(function T(O,L){return me.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,this.ready;case 2:return J.next=4,I.nextFrame();case 4:return J.abrupt("return",this.model.classify(O,L));case 5:case"end":return J.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()},{key:"classify",value:function(){var M=q()(me.a.mark(function T(){var O,L,J,ie,ge=arguments;return me.a.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:return O=ge.length>0&&ge[0]!==void 0?ge[0]:null,L=ge.length>1?ge[1]:void 0,J=this.topk,typeof O=="number"?J=O:typeof O=="function"&&(ie=O),typeof L=="function"&&(ie=L),Ae.abrupt("return",this.classifyInternal(J,ie));case 6:case"end":return Ae.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()}]),$}(),ni=function($,M,T){var O={},L=T,J=$;if(typeof J!="string")throw new Error('Please specify a model to use. E.g: "SpeechCommands18w"');J.indexOf("http")===-1&&(J=$.toLowerCase()),we()(M)==="object"?O=M:typeof M=="function"&&(L=M);var ie=new Ai(J,O,L);return L?ie:ie.ready};function to($,M){return $==null&&M==null?null:$==null?M.clone():M===null?$.clone():$.concat(M,0)}function yi($,M){for(var T=[],O=0;O<$.length;O++)T.push({value:$[O],index:O});T.sort(function(ie,ge){return ge.value-ie.value});var L=new Float32Array(M),J=new Int32Array(M);for(O=0;O<M;O++)L[O]=T[O].value,J[O]=T[O].index;return{values:L,indices:J}}var ri=function(){function $(){this.classDatasetMatrices={},this.classExampleCount={},this.labelToClassId={},this.nextClassId=0}return $.prototype.addExample=function(M,T){var O=this;if(this.exampleShape==null&&(this.exampleShape=M.shape),!ze.util.arraysEqual(this.exampleShape,M.shape))throw new Error("Example shape provided, "+M.shape+" does not match previously provided example shapes "+this.exampleShape+".");this.clearTrainDatasetMatrix(),T in this.labelToClassId||(this.labelToClassId[T]=this.nextClassId++),Object(ze.tidy)(function(){var L=O.normalizeVectorToUnitLength(M.flatten()),J=L.shape[0];if(O.classDatasetMatrices[T]==null)O.classDatasetMatrices[T]=L.as2D(1,J);else{var ie=O.classDatasetMatrices[T].as2D(O.classExampleCount[T],J).concat(L.as2D(1,J),0);O.classDatasetMatrices[T].dispose(),O.classDatasetMatrices[T]=ie}Object(ze.keep)(O.classDatasetMatrices[T]),O.classExampleCount[T]==null&&(O.classExampleCount[T]=0),O.classExampleCount[T]++})},$.prototype.similarities=function(M){var T=this;return Object(ze.tidy)(function(){var O=T.normalizeVectorToUnitLength(M.flatten()),L=O.shape[0];if(T.trainDatasetMatrix==null){var J=null;for(var ie in T.classDatasetMatrices)J=to(J,T.classDatasetMatrices[ie]);T.trainDatasetMatrix=J}if(T.trainDatasetMatrix==null)return console.warn("Cannot predict without providing training examples."),null;Object(ze.keep)(T.trainDatasetMatrix);var ge=T.getNumExamples();return T.trainDatasetMatrix.as2D(ge,L).matMul(O.as2D(L,1)).as1D()})},$.prototype.predictClass=function(M,T){return T===void 0&&(T=3),function(O,L,J,ie){return new(J||(J=Promise))(function(ge,Ae){function Ie(ot){try{et(ie.next(ot))}catch(zt){Ae(zt)}}function De(ot){try{et(ie.throw(ot))}catch(zt){Ae(zt)}}function et(ot){ot.done?ge(ot.value):new J(function(zt){zt(ot.value)}).then(Ie,De)}et((ie=ie.apply(O,L||[])).next())})}(this,void 0,void 0,function(){var O,L,J,ie,ge=this;return function(Ae,Ie){var De,et,ot,zt,Ht={label:0,sent:function(){if(1&ot[0])throw ot[1];return ot[1]},trys:[],ops:[]};return zt={next:xn(0),throw:xn(1),return:xn(2)},typeof Symbol=="function"&&(zt[Symbol.iterator]=function(){return this}),zt;function xn(En){return function(Fn){return function(Rn){if(De)throw new TypeError("Generator is already executing.");for(;Ht;)try{if(De=1,et&&(ot=2&Rn[0]?et.return:Rn[0]?et.throw||((ot=et.return)&&ot.call(et),0):et.next)&&!(ot=ot.call(et,Rn[1])).done)return ot;switch(et=0,ot&&(Rn=[2&Rn[0],ot.value]),Rn[0]){case 0:case 1:ot=Rn;break;case 4:return Ht.label++,{value:Rn[1],done:!1};case 5:Ht.label++,et=Rn[1],Rn=[0];continue;case 7:Rn=Ht.ops.pop(),Ht.trys.pop();continue;default:if(!(ot=(ot=Ht.trys).length>0&&ot[ot.length-1])&&(Rn[0]===6||Rn[0]===2)){Ht=0;continue}if(Rn[0]===3&&(!ot||Rn[1]>ot[0]&&Rn[1]<ot[3])){Ht.label=Rn[1];break}if(Rn[0]===6&&Ht.label<ot[1]){Ht.label=ot[1],ot=Rn;break}if(ot&&Ht.label<ot[2]){Ht.label=ot[2],Ht.ops.push(Rn);break}ot[2]&&Ht.ops.pop(),Ht.trys.pop();continue}Rn=Ie.call(Ae,Ht)}catch(Wn){Rn=[6,Wn],et=0}finally{De=ot=0}if(5&Rn[0])throw Rn[1];return{value:Rn[0]?Rn[1]:void 0,done:!0}}([En,Fn])}}}(this,function(Ae){switch(Ae.label){case 0:if(T<1)throw new Error("Please provide a positive integer k value to predictClass.");if(this.getNumExamples()===0)throw new Error("You have not added any examples to the KNN classifier. Please add examples before calling predictClass.");return O=Object(ze.tidy)(function(){return ge.similarities(M).asType("float32")}),L=Math.min(T,this.getNumExamples()),ie=yi,[4,O.data()];case 1:return J=ie.apply(void 0,[Ae.sent(),L]).indices,O.dispose(),[2,this.calculateTopClass(J,L)]}})})},$.prototype.clearClass=function(M){if(this.classDatasetMatrices[M]==null)throw new Error("Cannot clear invalid class "+M);delete this.classDatasetMatrices[M],delete this.classExampleCount[M],this.clearTrainDatasetMatrix()},$.prototype.clearAllClasses=function(){for(var M in this.classDatasetMatrices)this.clearClass(M)},$.prototype.getClassExampleCount=function(){return this.classExampleCount},$.prototype.getClassifierDataset=function(){return this.classDatasetMatrices},$.prototype.getNumClasses=function(){return Object.keys(this.classExampleCount).length},$.prototype.setClassifierDataset=function(M){for(var T in this.clearTrainDatasetMatrix(),this.classDatasetMatrices=M,M)this.classExampleCount[T]=M[T].shape[0]},$.prototype.calculateTopClass=function(M,T){var O,L={};if(M==null)return{classIndex:this.labelToClassId[O],label:O,confidences:L};var J={},ie=0;for(var ge in this.classDatasetMatrices)ie+=this.classExampleCount[ge],J[ge]=ie;var Ae={};for(var ge in this.classDatasetMatrices)Ae[ge]=0;for(var Ie=0;Ie<M.length;Ie++){var De=M[Ie];for(var ge in this.classDatasetMatrices)if(De<J[ge]){Ae[ge]++;break}}var et=0;for(var ge in this.classDatasetMatrices){var ot=Ae[ge]/T;ot>et&&(et=ot,O=ge),L[ge]=ot}return{classIndex:this.labelToClassId[O],label:O,confidences:L}},$.prototype.clearTrainDatasetMatrix=function(){this.trainDatasetMatrix!=null&&(this.trainDatasetMatrix.dispose(),this.trainDatasetMatrix=null)},$.prototype.normalizeVectorToUnitLength=function(M){return Object(ze.tidy)(function(){var T=M.norm();return Object(ze.div)(M,T)})},$.prototype.getNumExamples=function(){var M=0;for(var T in this.classDatasetMatrices)M+=this.classExampleCount[T];return M},$.prototype.dispose=function(){for(var M in this.clearTrainDatasetMatrix(),this.classDatasetMatrices)this.classDatasetMatrices[M].dispose()},$}(),Jr=function(){var $=q()(me.a.mark(function M(T,O,L){var J,ie;return me.a.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:(J=document.createElement("a")).style.display="none",document.body.appendChild(J),ie=new Blob([T],{type:L}),J.href=URL.createObjectURL(ie),J.download=O,J.click();case 7:case"end":return ge.stop()}},M)}));return function(M,T,O){return $.apply(this,arguments)}}(),Kn=function(){var $=q()(me.a.mark(function M(T,O){return me.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.abrupt("return",Bt.a.get(T).then(function(J){return J.data}).then(function(J){return O&&O(null,J),J}).catch(function(J){throw O&&O(J),console.error("There has been a problem loading the file: ".concat(J.message)),J}));case 1:case"end":return L.stop()}},M)}));return function(M,T){return $.apply(this,arguments)}}(),pi=function(){function $(){oe()(this,$),this.knnClassifier=new ri,this.mapStringToIndex=[]}return _e()($,[{key:"addExample",value:function(M,T){var O,L;typeof T=="string"?O=this.mapStringToIndex.includes(T)?this.mapStringToIndex.indexOf(T):this.mapStringToIndex.push(T)-1:typeof T=="number"&&(O=T),L=Array.isArray(M)?I.tensor(M):M,this.knnClassifier.addExample(L,O)}},{key:"classify",value:function(){var M=q()(me.a.mark(function T(O,L,J){var ie,ge,Ae;return me.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return ie=3,ge=J,typeof L=="number"?ie=L:typeof L=="function"&&(ge=L),Ae=Array.isArray(O)?I.tensor(O):O,Ie.abrupt("return",Ge(this.classifyInternal(Ae,ie),ge));case 5:case"end":return Ie.stop()}},T,this)}));return function(T,O,L){return M.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var M=q()(me.a.mark(function T(O,L){var J,ie,ge,Ae=this;return me.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:if(!(this.knnClassifier.getNumClasses()<=0)){Ie.next=5;break}throw new Error("There is no example in any class");case 5:return Ie.next=7,this.knnClassifier.predictClass(O,L);case 7:return J=Ie.sent,this.mapStringToIndex.length>0&&((J.classIndex||J.classIndex===0)&&(ie=this.mapStringToIndex[J.classIndex])&&(J.label=ie),J.confidences&&(J.confidencesByLabel={},ge=J.confidences,Object.keys(ge).forEach(function(De){var et=Ae.mapStringToIndex[De];J.confidencesByLabel[et]=ge[De]}))),Ie.abrupt("return",J);case 10:case"end":return Ie.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()},{key:"clearLabel",value:function(M){var T;typeof M=="string"?this.mapStringToIndex.includes(M)&&(T=this.mapStringToIndex.indexOf(M)):typeof M=="number"&&(T=M),this.knnClassifier.clearClass(T)}},{key:"clearAllLabels",value:function(){this.mapStringToIndex=[],this.knnClassifier.clearAllClasses()}},{key:"getCountByLabel",value:function(){var M=this,T=this.knnClassifier.getClassExampleCount();if(this.mapStringToIndex.length>0){var O={};return Object.keys(T).forEach(function(L){if(M.mapStringToIndex[L]){var J=M.mapStringToIndex[L];O[J]=T[L]}}),O}return T}},{key:"getCount",value:function(){return this.knnClassifier.getClassExampleCount()}},{key:"getClassifierDataset",value:function(){return this.knnClassifier.getClassifierDataset()}},{key:"setClassifierDataset",value:function(M){this.knnClassifier.setClassifierDataset(M)}},{key:"getNumLabels",value:function(){return this.knnClassifier.getNumClasses()}},{key:"dispose",value:function(){this.knnClassifier.dispose()}},{key:"save",value:function(){var M=q()(me.a.mark(function T(O){var L,J,ie,ge=this;return me.a.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:return L=this.knnClassifier.getClassifierDataset(),this.mapStringToIndex.length>0&&Object.keys(L).forEach(function(Ie){ge.mapStringToIndex[Ie]&&(L[Ie].label=ge.mapStringToIndex[Ie])}),J=Object.keys(L).map(function(Ie){var De=L[Ie];return De?De.dataSync():null}),ie="myKNN.json",O&&(ie=O.endsWith(".json")?O:"".concat(O,".json")),Ae.next=7,Jr(JSON.stringify({dataset:L,tensors:J}),ie,"application/octet-stream");case 7:case"end":return Ae.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"load",value:function(){var M=q()(me.a.mark(function T(O,L){var J,ie,ge,Ae,Ie;return me.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(we()(O)!=="object"){De.next=4;break}J=O,De.next=7;break;case 4:return De.next=6,Kn(O);case 6:J=De.sent;case 7:J&&(ge=(ie=J).dataset,Ae=ie.tensors,this.mapStringToIndex=Object.keys(ge).map(function(et){return ge[et].label}),Ie=Ae.map(function(et,ot){if(et){var zt=Object.keys(et).map(function(Ht){return et[Ht]});return I.tensor(zt,ge[ot].shape,ge[ot].dtype)}return null}).reduce(function(et,ot,zt){return et[zt]=ot,et},{}),this.knnClassifier.setClassifierDataset(Ie),L&&L());case 8:case"end":return De.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()}]),$}(),Ci=function(){return new pi},Wr=function(){function $(M,T){oe()(this,$),this.videoElt=null,this.size=T,this.videoReady=!1,typeof HTMLVideoElement<"u"&&(M instanceof HTMLVideoElement?this.videoElt=M:M!==null&&we()(M)==="object"&&M.elt instanceof HTMLVideoElement&&(this.videoElt=M.elt))}return _e()($,[{key:"loadVideo",value:function(){var M=q()(me.a.mark(function T(){var O,L=this;return me.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.abrupt("return",new Promise(function(ie,ge){L.videoElt||ge(new Error("No video was passed to the constructor.")),L.video=document.createElement("video");var Ae=navigator.userAgent;O=Ae.indexOf("Firefox")>-1?L.videoElt.mozCaptureStream():L.videoElt.captureStream(),L.video.srcObject=O,L.size&&(L.video.width=L.size,L.video.height=L.size),L.video.autoplay=!0,L.video.playsinline=!0,L.video.muted=!0;var Ie=L.video.play();Ie!==void 0&&Ie.then(function(){L.videoReady=!0,ie(L.video)})}));case 1:case"end":return J.stop()}},T)}));return function(){return M.apply(this,arguments)}}()}]),$}(),so=224,Wi=[so,so],no="https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v",So={version:1,alpha:.25,topk:3,learningRate:1e-4,hiddenUnits:100,epochs:20,numLabels:2,batchSize:.4,layer:"conv_pw_13_relu"},_a={1:{.25:"https://tfhub.dev/google/imagenet/mobilenet_v1_025_224/classification/1",.5:"https://tfhub.dev/google/imagenet/mobilenet_v1_050_224/classification/1",.75:"https://tfhub.dev/google/imagenet/mobilenet_v1_075_224/classification/1",1:"https://tfhub.dev/google/imagenet/mobilenet_v1_100_224/classification/1"},2:{.5:"https://tfhub.dev/google/imagenet/mobilenet_v2_050_224/classification/2",.75:"https://tfhub.dev/google/imagenet/mobilenet_v2_075_224/classification/2",1:"https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/classification/2"}},Ds={1:"module_apply_default/MobilenetV1/Logits/global_pool",2:"module_apply_default/MobilenetV2/Logits/AvgPool"},Ch=function(){function $(M,T){oe()(this,$),this.mobilenet=null,this.topKPredictions=10,this.hasAnyTrainedClass=!1,this.customModel=null,this.jointModel=null,this.config={epochs:M.epochs||So.epochs,version:M.version||So.version,hiddenUnits:M.hiddenUnits||So.hiddenUnits,numLabels:M.numLabels||So.numLabels,learningRate:M.learningRate||So.learningRate,batchSize:M.batchSize||So.batchSize,layer:M.layer||So.layer,alpha:M.alpha||So.alpha},this.model=null,this.url=_a[this.config.version][this.config.alpha],this.normalizationOffset=I.scalar(127.5),this.mobilenetURL=M.mobilenetURL||"".concat(no).concat(this.config.version,"_").concat(this.config.alpha,"_").concat(so,"/model.json"),this.graphModelURL=M.graphModelURL||this.url,this.isPredicting=!1,this.mapStringToIndex=[],this.usageType=null,this.ready=Ge(this.loadModel(),T)}return _e()($,[{key:"loadModel",value:function(){var M=q()(me.a.mark(function T(){var O;return me.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,I.loadLayersModel(this.mobilenetURL);case 2:if(this.mobilenet=L.sent,!this.graphModelURL.includes("https://tfhub.dev/")){L.next=9;break}return L.next=6,I.loadGraphModel(this.graphModelURL,{fromTFHub:!0});case 6:this.model=L.sent,L.next=12;break;case 9:return L.next=11,I.loadGraphModel(this.graphModelURL,{fromTFHub:!1});case 11:this.model=L.sent;case 12:return O=this.mobilenet.getLayer(this.config.layer),L.next=15,I.model({inputs:this.mobilenet.inputs,outputs:O.output});case 15:if(this.mobilenetFeatures=L.sent,!this.video){L.next=19;break}return L.next=19,this.mobilenetFeatures.predict(Vn(this.video,Wi));case 19:return L.abrupt("return",this);case 20:case"end":return L.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"classification",value:function(M){var T,O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0;return this.usageType="classifier",we()(O)==="object"?Object.assign(this.config,O):typeof O=="function"&&(T=O),typeof L=="function"&&(T=L),M&&Ge(this.loadVideo(M),T),this}},{key:"regression",value:function(M,T){return this.usageType="regressor",M&&Ge(this.loadVideo(M),T),this}},{key:"loadVideo",value:function(){var M=q()(me.a.mark(function T(O){var L,J;return me.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(L=null,O instanceof HTMLVideoElement?L=O:we()(O)==="object"&&O.elt instanceof HTMLVideoElement&&(L=O.elt),!L){ie.next=7;break}return J=new Wr(L,so),ie.next=6,J.loadVideo();case 6:this.video=ie.sent;case 7:return ie.abrupt("return",this);case 8:case"end":return ie.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"addImage",value:function(){var M=q()(me.a.mark(function T(O,L,J){var ie,ge,Ae;return me.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return Ae=J,O instanceof HTMLImageElement||O instanceof HTMLVideoElement||O instanceof HTMLCanvasElement||O.elt instanceof ImageData?ie=O:we()(O)==="object"&&(O.elt instanceof HTMLImageElement||O.elt instanceof HTMLVideoElement||O.elt instanceof HTMLCanvasElement||O.elt instanceof ImageData)?ie=O.elt:typeof O!="string"&&typeof O!="number"||(ie=this.video,ge=O),typeof L=="string"||typeof L=="number"?ge=L:typeof L=="function"&&(Ae=L),typeof ge=="string"&&(ge=this.mapStringToIndex.includes(ge)?this.mapStringToIndex.indexOf(ge):this.mapStringToIndex.push(ge)-1),Ie.abrupt("return",Ge(this.addImageInternal(ie,ge),Ae));case 5:case"end":return Ie.stop()}},T,this)}));return function(T,O,L){return M.apply(this,arguments)}}()},{key:"addImageInternal",value:function(){var M=q()(me.a.mark(function T(O,L){var J=this;return me.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.next=2,this.ready;case 2:return I.tidy(function(){var ge,Ae=Vn(O,Wi),Ie=J.mobilenetFeatures.predict(Ae);if(J.usageType==="classifier"?ge=I.tidy(function(){return I.oneHot(I.tensor1d([L],"int32"),J.config.numLabels)}):J.usageType==="regressor"&&(ge=I.tensor2d([[L]])),J.xs==null)J.xs=I.keep(Ie),J.ys=I.keep(ge),J.hasAnyTrainedClass=!0;else{var De=J.xs;J.xs=I.keep(De.concat(Ie,0));var et=J.ys;J.ys=I.keep(et.concat(ge,0)),De.dispose(),et.dispose(),ge.dispose()}}),ie.abrupt("return",this);case 4:case"end":return ie.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()},{key:"train",value:function(){var M=q()(me.a.mark(function T(O){var L,J;return me.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(this.hasAnyTrainedClass){ie.next=2;break}throw new Error("Add some examples before training!");case 2:if(this.isPredicting=!1,this.usageType==="classifier"?(this.loss="categoricalCrossentropy",this.customModel=I.sequential({layers:[I.layers.flatten({inputShape:[7,7,256]}),I.layers.dense({units:this.config.hiddenUnits,activation:"relu",kernelInitializer:"varianceScaling",useBias:!0}),I.layers.dense({units:this.config.numLabels,kernelInitializer:"varianceScaling",useBias:!1,activation:"softmax"})]})):this.usageType==="regressor"&&(this.loss="meanSquaredError",this.customModel=I.sequential({layers:[I.layers.flatten({inputShape:[7,7,256]}),I.layers.dense({units:this.config.hiddenUnits,activation:"relu",kernelInitializer:"varianceScaling",useBias:!0}),I.layers.dense({units:1,useBias:!1,kernelInitializer:"Zeros",activation:"linear"})]})),this.jointModel=I.sequential(),this.jointModel.add(this.mobilenetFeatures),this.jointModel.add(this.customModel),L=I.train.adam(this.config.learningRate),this.customModel.compile({optimizer:L,loss:this.loss}),(J=Math.floor(this.xs.shape[0]*this.config.batchSize))>0){ie.next=12;break}throw new Error("Batch size is 0 or NaN. Please choose a non-zero fraction.");case 12:return ie.abrupt("return",this.customModel.fit(this.xs,this.ys,{batchSize:J,epochs:this.config.epochs,callbacks:{onBatchEnd:function(){var ge=q()(me.a.mark(function Ae(Ie,De){return me.a.wrap(function(et){for(;;)switch(et.prev=et.next){case 0:return O(De.loss.toFixed(5)),et.next=3,I.nextFrame();case 3:case"end":return et.stop()}},Ae)}));return function(Ae,Ie){return ge.apply(this,arguments)}}(),onTrainEnd:function(){return O(null)}}}));case 13:case"end":return ie.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"classify",value:function(){var M=q()(me.a.mark(function T(O,L){var J,ie;return me.a.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return O instanceof HTMLImageElement||O instanceof HTMLVideoElement||O instanceof HTMLCanvasElement||O instanceof ImageData?J=O:we()(O)==="object"&&(O.elt instanceof HTMLImageElement||O.elt instanceof HTMLVideoElement||O.elt instanceof HTMLCanvasElement||O.elt instanceof ImageData)?J=O.elt:typeof O=="function"&&(J=this.video,ie=O),typeof L=="function"&&(ie=L),ge.abrupt("return",Ge(this.classifyInternal(J),ie));case 3:case"end":return ge.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var M=q()(me.a.mark(function T(O){var L,J,ie=this;return me.a.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:if(this.usageType==="classifier"){ge.next=2;break}throw new Error("Mobilenet Feature Extraction has not been set to be a classifier.");case 2:return ge.next=4,I.nextFrame();case 4:return this.isPredicting=!0,L=I.tidy(function(){var Ae=Vn(O,Wi),Ie=ie.jointModel.predict(Ae);return Array.from(Ie.as1D().dataSync())}),ge.next=8,L.map(function(Ae,Ie){return{label:ie.mapStringToIndex.length>0&&ie.mapStringToIndex[Ie]?ie.mapStringToIndex[Ie]:Ie,confidence:Ae}}).sort(function(Ae,Ie){return Ie.confidence-Ae.confidence});case 8:return J=ge.sent,ge.abrupt("return",J);case 10:case"end":return ge.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"predict",value:function(){var M=q()(me.a.mark(function T(O,L){var J,ie;return me.a.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return O instanceof HTMLImageElement||O instanceof HTMLVideoElement||O instanceof HTMLCanvasElement||O instanceof ImageData?J=O:we()(O)==="object"&&(O.elt instanceof HTMLImageElement||O.elt instanceof HTMLVideoElement||O.elt instanceof HTMLCanvasElement||O.elt instanceof ImageData)?J=O.elt:typeof O=="function"&&(J=this.video,ie=O),typeof L=="function"&&(ie=L),ge.abrupt("return",Ge(this.predictInternal(J),ie));case 3:case"end":return ge.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()},{key:"predictInternal",value:function(){var M=q()(me.a.mark(function T(O){var L,J,ie=this;return me.a.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:if(this.usageType==="regressor"){ge.next=2;break}throw new Error("Mobilenet Feature Extraction has not been set to be a regressor.");case 2:return ge.next=4,I.nextFrame();case 4:return this.isPredicting=!0,L=I.tidy(function(){var Ae=Vn(O,Wi);return ie.jointModel.predict(Ae).as1D()}),ge.next=8,L.data();case 8:return J=ge.sent,L.dispose(),ge.abrupt("return",{value:J[0]});case 11:case"end":return ge.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"load",value:function(){var M=q()(me.a.mark(function T(){var O,L,J,ie,ge,Ae,Ie=this,De=arguments;return me.a.wrap(function(et){for(;;)switch(et.prev=et.next){case 0:if(O=De.length>0&&De[0]!==void 0?De[0]:null,L=De.length>1?De[1]:void 0,typeof O=="string"){et.next=11;break}return J=null,ie=null,Array.from(O).forEach(function(ot){if(ot.name.includes(".json")){J=ot;var zt=new FileReader;zt.onload=function(Ht){JSON.parse(Ht.target.result).ml5Specs&&(Ie.mapStringToIndex=JSON.parse(Ht.target.result).ml5Specs.mapStringToIndex)},zt.readAsText(ot)}else ot.name.includes(".bin")&&(ie=ot)}),et.next=8,I.loadLayersModel(I.io.browserFiles([J,ie]));case 8:this.jointModel=et.sent,et.next=20;break;case 11:return et.next=13,Bt.a.get(O);case 13:return ge=et.sent,(Ae=ge.data).ml5Specs&&(this.mapStringToIndex=Ae.ml5Specs.mapStringToIndex),et.next=18,I.loadLayersModel(O);case 18:this.jointModel=et.sent,L&&L();case 20:return et.abrupt("return",this.jointModel);case 21:case"end":return et.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"save",value:function(){var M=q()(me.a.mark(function T(O,L){var J=this;return me.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(this.jointModel){ie.next=2;break}throw new Error("No model found.");case 2:this.jointModel.save(I.io.withSaveHandler(function(){var ge=q()(me.a.mark(function Ae(Ie){var De;return me.a.wrap(function(et){for(;;)switch(et.prev=et.next){case 0:return De="model",L&&(De=L),J.weightsManifest={modelTopology:Ie.modelTopology,weightsManifest:[{paths:["./".concat(De,".weights.bin")],weights:Ie.weightSpecs}],ml5Specs:{mapStringToIndex:J.mapStringToIndex}},et.next=5,Jr(Ie.weightData,"".concat(De,".weights.bin"),"application/octet-stream");case 5:return et.next=7,Jr(JSON.stringify(J.weightsManifest),"".concat(De,".json"),"text/plain");case 7:O&&O();case 8:case"end":return et.stop()}},Ae)}));return function(Ae){return ge.apply(this,arguments)}}()));case 3:case"end":return ie.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()},{key:"mobilenetInfer",value:function(M){var T=this,O=arguments.length>1&&arguments[1]!==void 0&&arguments[1],L=M;return L instanceof I.Tensor||L instanceof ImageData||L instanceof HTMLImageElement||L instanceof HTMLCanvasElement||L instanceof HTMLVideoElement?I.tidy(function(){L instanceof I.Tensor||(L=I.browser.fromPixels(L));var J=L.toFloat().sub(T.normalizationOffset).div(T.normalizationOffset),ie=J;(L.shape[0]!==so||L.shape[1]!==so)&&(ie=I.image.resizeBilinear(J,Wi,!0));var ge,Ae=ie.reshape([-1,so,so,3]);if(O){var Ie=Ds[T.config.version];ge=T.model.execute(Ae,Ie).squeeze([1,2])}else ge=T.model.predict(Ae).slice([0,1],[-1,1e3]);return ge}):null}},{key:"infer",value:function(M,T){var O,L;if(M instanceof HTMLImageElement||M instanceof HTMLVideoElement||M instanceof HTMLCanvasElement||M instanceof ImageData)O=M;else{if(we()(M)!=="object"||!(M.elt instanceof HTMLImageElement||M.elt instanceof HTMLVideoElement||M.elt instanceof HTMLCanvasElement||M.elt instanceof ImageData))throw new Error("No input image found.");O=M.elt}return L=T&&typeof T=="string"?T:"conv_preds",this.mobilenetInfer(O,L)}}]),$}(),ro=function($,M,T){var O;if(typeof $!="string")throw new Error('Please specify a model to use. E.g: "MobileNet"');O=$.toLowerCase();var L={},J=T;if(we()(M)==="object"?L=M:typeof M=="function"&&(J=M),O==="mobilenet")return new Ch(L,J);throw new Error("".concat(O," is not a valid model."))},Mc=function(){console.log("%cword2vec has been disabled","color: #A155FF; font-size: 16px"),console.log("We've intentionally disabled the word2vec function after recognizing it has the potential to produce harmful outputs while using the model files included in our examples. We'll consider reenabling the word2vec function along with changes to address these issues in a future release of ml5.js. You can find further updates about this topic on our Twitter account (https://twitter.com/ml5js/status/1445762321444315147) and GitHub (https://github.com/ml5js/ml5-library/issues/1238).")},Gu=r(58),el=r.n(Gu),fc=r(57),tl=r.n(fc),Up=r(35),xs=r.n(Up),dd=["person","bicycle","car","motorbike","aeroplane","bus","train","truck","boat","traffic light","fire hydrant","stop sign","parking meter","bench","bird","cat","dog","horse","sheep","cow","elephant","bear","zebra","giraffe","backpack","umbrella","handbag","tie","suitcase","frisbee","skis","snowboard","sports ball","kite","baseball bat","baseball glove","skateboard","surfboard","tennis racket","bottle","wine glass","cup","fork","knife","spoon","bowl","banana","apple","sandwich","orange","broccoli","carrot","hot dog","pizza","donut","cake","chair","sofa","pottedplant","bed","diningtable","toilet","tvmonitor","laptop","mouse","remote","keyboard","cell phone","microwave","oven","toaster","sink","refrigerator","book","clock","vase","scissors","teddy bear","hair drier","toothbrush"];function Wp($){return new RegExp("^(?:[a-z]+:)?//","i").test($)}var dc={isAbsoluteURL:Wp,getModelPath:function($){return Wp($)||typeof window>"u"?$:window.location.pathname+$}},hd=function($,M){var T=Math.min($[3],M[3])-Math.max($[1],M[1]),O=Math.min($[2],M[2])-Math.max($[0],M[0]);return T<0||O<0?0:T*O},kh=function($,M){return hd($,M)/function(T,O){var L=hd(T,O);return(T[3]-T[1])*(T[2]-T[0])+(O[3]-O[1])*(O[2]-O[0])-L}($,M)};function nl($,M,T,O){return hf.apply(this,arguments)}function hf(){return(hf=q()(me.a.mark(function $(M,T,O,L){return me.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.abrupt("return",I.tidy(function(){for(var ie=I.mul(T,O),ge=I.argMax(ie,-1),Ae=I.max(ie,-1),Ie=I.greaterEqual(Ae,I.scalar(L)).dataSync(),De=[],et=0;et<Ie.length;et+=1)Ie[et]&&De.push(et);if(De.length===0)return[null,null,null];var ot=I.tensor1d(De,"int32");return[I.gather(M.reshape([Ie.length,4]),ot),I.gather(Ae.flatten(),ot),I.gather(ge.flatten(),ot)]}));case 1:case"end":return J.stop()}},$)}))).apply(this,arguments)}var Ha=function($,M){return I.tidy(function(){var T=I.tensor1d([2]),O=I.sub($,I.div(M,T)),L=I.add($,I.div(M,T)),J=[O.shape[0],O.shape[1],O.shape[2],1];return I.concat([O.slice([0,0,0,1],J),O.slice([0,0,0,0],J),L.slice([0,0,0,1],J),L.slice([0,0,0,0],J)],3)})},Tl=function($,M,T){return I.tidy(function(){for(var O=[],L=0;L<M.length;L+=1)O.push([M[L],[$[4*L],$[4*L+1],$[4*L+2],$[4*L+3]],L]);var J=[];return O.sort(function(ie,ge){return ge[0]-ie[0]}).forEach(function(ie){for(var ge=!0,Ae=0;Ae<J.length;Ae+=1)if(kh(ie[1],J[Ae][1])>T){ge=!1;break}ge&&J.push(ie)}),[J.map(function(ie){return ie[2]}),J.map(function(ie){return ie[1]}),J.map(function(ie){return ie[0]})]})};function ba($,M,T){return I.tidy(function(){var O=M.shape[0],L=I.reshape(M,[1,1,O,2]),J=$.shape.slice(1,3),ie=J[0],ge=J[1],Ae=I.range(0,J[0]),Ie=I.range(0,J[1]);Ae=I.tile(Ae,[J[1]]),Ie=I.tile(I.expandDims(Ie,0),[J[0],1]),Ie=I.transpose(Ie).flatten();var De=I.transpose(I.stack([Ae,Ie]));De=I.reshape(De,[J[0],J[1],1,2]),De=I.cast(De,$.dtype),$=I.reshape($,[J[0],J[1],O,T+5]),J=I.cast(I.reshape(I.tensor1d(J),[1,1,1,2]),$.dtype);var et=I.sigmoid($.slice([0,0,0,0],[ie,ge,O,2])),ot=I.exp($.slice([0,0,0,2],[ie,ge,O,2])),zt=I.sigmoid($.slice([0,0,0,4],[ie,ge,O,1])),Ht=I.softmax($.slice([0,0,0,5],[ie,ge,O,T]));return[et=I.div(I.add(et,De),J),ot=I.div(I.mul(ot,L),J),zt,Ht]})}function Dc($){var M=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var T,O=xs()($);if(M){var L=xs()(this).constructor;T=Reflect.construct(O,arguments,L)}else T=O.apply(this,arguments);return tl()(this,T)}}var ws={modelUrl:"https://raw.githubusercontent.com/ml5js/ml5-data-and-training/master/models/YOLO/model.json",filterBoxesThreshold:.01,IOUThreshold:.4,classProbThreshold:.4},La=416,Nc=function($){el()(T,$);var M=Dc(T);function T(O,L,J){var ie;return oe()(this,T),(ie=M.call(this,O,La)).modelUrl=L.modelUrl||ws.modelUrl,ie.filterBoxesThreshold=L.filterBoxesThreshold||ws.filterBoxesThreshold,ie.IOUThreshold=L.IOUThreshold||ws.IOUThreshold,ie.classProbThreshold=L.classProbThreshold||ws.classProbThreshold,ie.modelReady=!1,ie.isPredicting=!1,ie.callback=J,ie.ready=Ge(ie.loadModel(),ie.callback),L.disableDeprecationNotice||console.warn("WARNING! Function YOLO has been deprecated, please use the new ObjectDetector function instead"),ie}return _e()(T,[{key:"loadModel",value:function(){var O=q()(me.a.mark(function L(){var J;return me.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(!this.videoElt||this.video){ie.next=4;break}return ie.next=3,this.loadVideo();case 3:this.video=ie.sent;case 4:if(dc.isAbsoluteURL(this.modelUrl)!==!0){ie.next=10;break}return ie.next=7,I.loadLayersModel(this.modelUrl);case 7:this.model=ie.sent,ie.next=15;break;case 10:return J=dc.getModelPath(this.modelUrl),this.modelUrl="".concat(J,"/model.json"),ie.next=14,I.loadLayersModel(this.modelUrl);case 14:this.model=ie.sent;case 15:return this.modelReady=!0,ie.abrupt("return",this);case 17:case"end":return ie.stop()}},L,this)}));return function(){return O.apply(this,arguments)}}()},{key:"detect",value:function(){var O=q()(me.a.mark(function L(J,ie){var ge,Ae;return me.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return Ie.next=2,this.ready;case 2:if(Ae=ie,!Dt(J)){Ie.next=7;break}ge=J,Ie.next=21;break;case 7:if(we()(J)!=="object"||!Dt(J.elt)){Ie.next=11;break}ge=J.elt,Ie.next=21;break;case 11:if(we()(J)!=="object"||!Dt(J.canvas)){Ie.next=15;break}ge=J.canvas,Ie.next=21;break;case 15:if(typeof J!="function"){Ie.next=20;break}ge=this.video,Ae=J,Ie.next=21;break;case 20:throw new Error("Detection subject not supported");case 21:return Ie.abrupt("return",Ge(this.detectInternal(ge),Ae));case 22:case"end":return Ie.stop()}},L,this)}));return function(L,J){return O.apply(this,arguments)}}()},{key:"detectInternal",value:function(){var O=q()(me.a.mark(function L(J){var ie,ge,Ae,Ie,De,et,ot,zt,Ht,xn,En,Fn=this;return me.a.wrap(function(Rn){for(;;)switch(Rn.prev=Rn.next){case 0:return Rn.next=2,this.ready;case 2:return Rn.next=4,I.nextFrame();case 4:return ie=I.tensor2d([[.57273,.677385],[1.87446,2.06253],[3.33843,5.47434],[7.88282,3.52778],[9.77052,9.16828]]),this.isPredicting=!0,ge=I.tidy(function(){var Wn=Vn(J,[La,La]),Jn=ba(Fn.model.predict(Wn),ie,80),Tn=Pn()(Jn,4),_r=Tn[0],Nr=Tn[1],Ir=Tn[2],Qr=Tn[3];return[Ha(_r,Nr),Ir,Qr]}),Ae=Pn()(ge,3),Ie=Ae[0],De=Ae[1],et=Ae[2],Rn.next=9,nl(Ie,De,et,this.filterBoxesThreshold);case 9:if(ot=Rn.sent,zt=Pn()(ot,3),Ht=zt[0],xn=zt[1],En=zt[2],Ie.dispose(),De.dispose(),et.dispose(),Ht!=null){Rn.next=19;break}return Rn.abrupt("return",[]);case 19:return Rn.abrupt("return",I.tidy(function(){var Wn=I.scalar(La),Jn=I.scalar(La),Tn=I.stack([Jn,Wn,Jn,Wn]).reshape([1,4]),_r=I.mul(Ht,Tn),Nr=_r.dataSync(),Ir=xn.dataSync(),Qr=Tl(Nr,Ir,Fn.IOUThreshold),zr=Pn()(Qr,3),ki=zr[0],Pi=zr[1],Fi=zr[2],Mo=[];return En.gather(I.tensor1d(ki,"int32")).dataSync().forEach(function(Jo,jo){var Bo=Fi[jo];if(!(Bo<Fn.classProbThreshold)){var Ho=dd[Jo],la=Pn()(Pi[jo],4),va=la[0],Fa=la[1],mu=la[2],Li=la[3];va=Math.max(0,va),Fa=Math.max(0,Fa),mu=Math.min(La,mu)-va;var ts={label:Ho,confidence:Bo,x:Fa,y:va,width:Li=Math.min(La,Li)-Fa,height:mu,normalized:{x:Fa/La,y:va/La,width:Li/La,height:mu/La}};Mo.push(ts)}}),Fn.isPredicting=!1,Wn.dispose(),Jn.dispose(),Tn.dispose(),_r.dispose(),Ht.dispose(),xn.dispose(),En.dispose(),ie.dispose(),Mo}));case 20:case"end":return Rn.stop()}},L,this)}));return function(L){return O.apply(this,arguments)}}()}]),T}(Wr),pf=function($,M,T){var O=null,L={},J=T;return $ instanceof HTMLVideoElement?O=$:we()($)==="object"&&$.elt instanceof HTMLVideoElement?O=$.elt:typeof $=="function"?J=$:we()($)==="object"&&(L=$),we()(M)==="object"?L=M:typeof M=="function"&&(J=M),new Nc(O,L,J)},Ic=r(242),Iu={base:"lite_mobilenet_v2",modelUrl:void 0},Ah=function(){function $(M,T,O){oe()(this,$),this.video=M||null,this.modelReady=!1,this.isPredicting=!1,this.config={base:T.base||Iu.base,modelUrl:T.modelUrl||Iu.modelUrl},this.callback=O,this.ready=Ge(this.loadModel(),this.callback)}return _e()($,[{key:"loadModel",value:function(){var M=q()(me.a.mark(function T(){return me.a.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,Ic.load(this.config);case 2:return this.model=O.sent,this.modelReady=!0,O.abrupt("return",this);case 5:case"end":return O.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"detectInternal",value:function(){var M=q()(me.a.mark(function T(O){var L,J;return me.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return this.isPredicting=!0,ie.next=3,this.model.detect(O);case 3:return L=ie.sent,J=L.map(function(ge){return{label:ge.class,confidence:ge.score,x:ge.bbox[0],y:ge.bbox[1],width:ge.bbox[2],height:ge.bbox[3],normalized:{x:ge.bbox[0]/O.width,y:ge.bbox[1]/O.height,width:ge.bbox[2]/O.width,height:ge.bbox[3]/O.height}}}),this.isPredicting=!1,ie.abrupt("return",J);case 7:case"end":return ie.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"detect",value:function(){var M=q()(me.a.mark(function T(O,L){var J,ie;return me.a.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return ge.next=2,this.ready;case 2:return ge.next=4,I.nextFrame();case 4:if(ie=L,!Dt(O)){ge.next=9;break}J=O,ge.next=23;break;case 9:if(we()(O)!=="object"||!Dt(O.elt)){ge.next=13;break}J=O.elt,ge.next=23;break;case 13:if(we()(O)!=="object"||!Dt(O.canvas)){ge.next=17;break}J=O.canvas,ge.next=23;break;case 17:if(typeof O!="function"){ge.next=22;break}J=this.video,ie=O,ge.next=23;break;case 22:throw new Error("Detection subject not supported");case 23:return ge.abrupt("return",Ge(this.detectInternal(J),ie));case 24:case"end":return ge.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()}]),$}(),pd=function($,M,T){var O=null,L={},J=T;return $ instanceof HTMLVideoElement?O=$:we()($)==="object"&&$.elt instanceof HTMLVideoElement?O=$.elt:typeof $=="function"?J=$:we()($)==="object"&&(L=$),we()(M)==="object"?L=M:typeof M=="function"&&(J=M),new Ah(O,L,J)};function md($,M){var T=Object.keys($);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols($);M&&(O=O.filter(function(L){return Object.getOwnPropertyDescriptor($,L).enumerable})),T.push.apply(T,O)}return T}var Ea=_e()(function $(M,T,O,L){switch(oe()(this,$),this.video=T,this.modelNameOrUrl=M,this.options=O||{},this.callback=L,M){case"yolo":return this.model=new pf(this.video,function(J){for(var ie=1;ie<arguments.length;ie++){var ge=arguments[ie]!=null?arguments[ie]:{};ie%2?md(Object(ge),!0).forEach(function(Ae){H()(J,Ae,ge[Ae])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(ge)):md(Object(ge)).forEach(function(Ae){Object.defineProperty(J,Ae,Object.getOwnPropertyDescriptor(ge,Ae))})}return J}({disableDeprecationNotice:!0},this.options),L),this;case"cocossd":default:return this.model=new pd(this.video,this.options,L),this}}),Oh=function($,M,T,O){var L,J={},ie=O,ge=$;if(typeof ge!="string")throw new Error('Please specify a model to use. E.g: "YOLO"');ge.indexOf("http")===-1&&(ge=$.toLowerCase()),M instanceof HTMLVideoElement?L=M:we()(M)==="object"&&M.elt instanceof HTMLVideoElement?L=M.elt:we()(M)==="object"?J=M:typeof M=="function"&&(ie=M),we()(T)==="object"?J=T:typeof T=="function"&&(ie=T);var Ae=new Ea(ge,L,J,ie);return Ae.model.callback?Ae.model:Ae.model.ready},Vp=r(99),gd=r.n(Vp),vd=function($,M){return(vd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,O){T.__proto__=O}||function(T,O){for(var L in O)O.hasOwnProperty(L)&&(T[L]=O[L])})($,M)};function Ns($,M){function T(){this.constructor=$}vd($,M),$.prototype=M===null?Object.create(M):(T.prototype=M.prototype,new T)}var yd=function(){return(yd=Object.assign||function($){for(var M,T=1,O=arguments.length;T<O;T++)for(var L in M=arguments[T])Object.prototype.hasOwnProperty.call(M,L)&&($[L]=M[L]);return $}).apply(this,arguments)};function br($,M,T,O){return new(T||(T=Promise))(function(L,J){function ie(Ie){try{Ae(O.next(Ie))}catch(De){J(De)}}function ge(Ie){try{Ae(O.throw(Ie))}catch(De){J(De)}}function Ae(Ie){Ie.done?L(Ie.value):new T(function(De){De(Ie.value)}).then(ie,ge)}Ae((O=O.apply($,M||[])).next())})}function qu($,M){var T,O,L,J,ie={label:0,sent:function(){if(1&L[0])throw L[1];return L[1]},trys:[],ops:[]};return J={next:ge(0),throw:ge(1),return:ge(2)},typeof Symbol=="function"&&(J[Symbol.iterator]=function(){return this}),J;function ge(Ae){return function(Ie){return function(De){if(T)throw new TypeError("Generator is already executing.");for(;ie;)try{if(T=1,O&&(L=2&De[0]?O.return:De[0]?O.throw||((L=O.return)&&L.call(O),0):O.next)&&!(L=L.call(O,De[1])).done)return L;switch(O=0,L&&(De=[2&De[0],L.value]),De[0]){case 0:case 1:L=De;break;case 4:return ie.label++,{value:De[1],done:!1};case 5:ie.label++,O=De[1],De=[0];continue;case 7:De=ie.ops.pop(),ie.trys.pop();continue;default:if(!(L=(L=ie.trys).length>0&&L[L.length-1])&&(De[0]===6||De[0]===2)){ie=0;continue}if(De[0]===3&&(!L||De[1]>L[0]&&De[1]<L[3])){ie.label=De[1];break}if(De[0]===6&&ie.label<L[1]){ie.label=L[1],L=De;break}if(L&&ie.label<L[2]){ie.label=L[2],ie.ops.push(De);break}L[2]&&ie.ops.pop(),ie.trys.pop();continue}De=M.call($,ie)}catch(et){De=[6,et],O=0}finally{T=L=0}if(5&De[0])throw De[1];return{value:De[0]?De[1]:void 0,done:!0}}([Ae,Ie])}}}var Qm=function(){function $(M,T){this.model=M,this.outputStride=T;var O=this.model.inputs[0].shape;ze.util.assert(O[1]===-1&&O[2]===-1,function(){return"Input shape ["+O[1]+", "+O[2]+"] must both be equal to or -1"})}return $.prototype.predict=function(M){var T=this;return Object(ze.tidy)(function(){var O=T.preprocessInput(Object(ze.cast)(M,"float32")),L=Object(ze.expandDims)(O,0),J=T.model.predict(L).map(function(ge){return Object(ze.squeeze)(ge,[0])}),ie=T.nameOutputResults(J);return{heatmapScores:Object(ze.sigmoid)(ie.heatmap),offsets:ie.offsets,displacementFwd:ie.displacementFwd,displacementBwd:ie.displacementBwd}})},$.prototype.dispose=function(){this.model.dispose()},$}(),Zm=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Ns(M,$),M.prototype.preprocessInput=function(T){return Object(ze.tidy)(function(){return Object(ze.sub)(Object(ze.div)(T,127.5),1)})},M.prototype.nameOutputResults=function(T){return{offsets:T[0],heatmap:T[1],displacementFwd:T[2],displacementBwd:T[3]}},M}(Qm);function bd($){return Math.floor($/2)}var mf=function(){function $(M,T){this.priorityQueue=new Array(M),this.numberOfElements=-1,this.getElementValue=T}return $.prototype.enqueue=function(M){this.priorityQueue[++this.numberOfElements]=M,this.swim(this.numberOfElements)},$.prototype.dequeue=function(){var M=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,M},$.prototype.empty=function(){return this.numberOfElements===-1},$.prototype.size=function(){return this.numberOfElements+1},$.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},$.prototype.max=function(){return this.priorityQueue[0]},$.prototype.swim=function(M){for(;M>0&&this.less(bd(M),M);)this.exchange(M,bd(M)),M=bd(M)},$.prototype.sink=function(M){for(;2*M<=this.numberOfElements;){var T=2*M;if(T<this.numberOfElements&&this.less(T,T+1)&&T++,!this.less(M,T))break;this.exchange(M,T),M=T}},$.prototype.getValueAt=function(M){return this.getElementValue(this.priorityQueue[M])},$.prototype.less=function(M,T){return this.getValueAt(M)<this.getValueAt(T)},$.prototype.exchange=function(M,T){var O=this.priorityQueue[M];this.priorityQueue[M]=this.priorityQueue[T],this.priorityQueue[T]=O},$}();function Hp($,M,T,O,L,J){for(var ie=J.shape,ge=ie[0],Ae=ie[1],Ie=!0,De=Math.max(T-L,0),et=Math.min(T+L+1,ge),ot=De;ot<et;++ot){for(var zt=Math.max(O-L,0),Ht=Math.min(O+L+1,Ae),xn=zt;xn<Ht;++xn)if(J.get(ot,xn,$)>M){Ie=!1;break}if(!Ie)break}return Ie}var Th=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],Mh=Th.length,qi=Th.reduce(function($,M,T){return $[M]=T,$},{}),zo=[["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]].map(function($){var M=$[0],T=$[1];return[qi[M],qi[T]]});function Dh($,M,T,O){return{y:O.get($,M,T),x:O.get($,M,T+Mh)}}function Yg($,M,T){var O=Dh($.heatmapY,$.heatmapX,$.id,T),L=O.y,J=O.x;return{x:$.heatmapX*M+J,y:$.heatmapY*M+L}}function xd($,M,T){return $<M?M:$>T?T:$}function Gp($,M){return{x:$.x+M.x,y:$.y+M.y}}var Is=[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]].map(function($){var M=$[0],T=$[1];return[qi[M],qi[T]]}),Fc=Is.map(function($){return $[1]}),qp=Is.map(function($){return $[0]});function eg($,M,T,O){return{y:xd(Math.round($.y/M),0,T-1),x:xd(Math.round($.x/M),0,O-1)}}function tg($,M,T,O,L,J,ie,ge){ge===void 0&&(ge=2);for(var Ae=O.shape,Ie=Ae[0],De=Ae[1],et=function(Rn,Wn,Jn){var Tn=Jn.shape[2]/2;return{y:Jn.get(Wn.y,Wn.x,Rn),x:Jn.get(Wn.y,Wn.x,Tn+Rn)}}($,eg(M.position,J,Ie,De),ie),ot=Gp(M.position,et),zt=0;zt<ge;zt++){var Ht=eg(ot,J,Ie,De),xn=Dh(Ht.y,Ht.x,T,L);ot=Gp({x:Ht.x*J,y:Ht.y*J},{x:xn.x,y:xn.y})}var En=eg(ot,J,Ie,De),Fn=O.get(En.y,En.x,T);return{position:ot,part:Th[T],score:Fn}}function Jg($,M,T,O,L,J){var ie=M.shape[2],ge=Fc.length,Ae=new Array(ie),Ie=$.part,De=$.score,et=Yg(Ie,O,T);Ae[Ie.id]={score:De,part:Th[Ie.id],position:et};for(var ot=ge-1;ot>=0;--ot){var zt=Fc[ot],Ht=qp[ot];Ae[zt]&&!Ae[Ht]&&(Ae[Ht]=tg(ot,Ae[zt],Ht,M,T,O,J))}for(ot=0;ot<ge;++ot)zt=qp[ot],Ht=Fc[ot],Ae[zt]&&!Ae[Ht]&&(Ae[Ht]=tg(ot,Ae[zt],Ht,M,T,O,L));return Ae}function Qg($,M,T,O){var L=T.x,J=T.y;return $.some(function(ie){var ge=ie.keypoints[O].position;return function(Ae,Ie,De,et){var ot=De-Ae,zt=et-Ie;return ot*ot+zt*zt}(J,L,ge.y,ge.x)<=M})}function Ml($,M,T){return T.reduce(function(O,L,J){var ie=L.position,ge=L.score;return Qg($,M,ie,J)||(O+=ge),O},0)/T.length}var Qa=1;function Nh($,M,T,O,L,J,ie,ge){ie===void 0&&(ie=.5),ge===void 0&&(ge=20);for(var Ae=[],Ie=function(Ht,xn,En){for(var Fn=En.shape,Rn=Fn[0],Wn=Fn[1],Jn=Fn[2],Tn=new mf(Rn*Wn*Jn,function(zr){return zr.score}),_r=0;_r<Rn;++_r)for(var Nr=0;Nr<Wn;++Nr)for(var Ir=0;Ir<Jn;++Ir){var Qr=En.get(_r,Nr,Ir);Qr<Ht||Hp(Ir,Qr,_r,Nr,xn,En)&&Tn.enqueue({score:Qr,part:{heatmapY:_r,heatmapX:Nr,id:Ir}})}return Tn}(ie,Qa,$),De=ge*ge;Ae.length<J&&!Ie.empty();){var et=Ie.dequeue();if(!Qg(Ae,De,Yg(et.part,L,M),et.part.id)){var ot=Jg(et,$,M,L,T,O),zt=Ml(Ae,De,ot);Ae.push({keypoints:ot,score:zt})}}return Ae}function Ze($){var M=$.shape,T=M[0],O=M[1],L=M[2];return Object(ze.tidy)(function(){var J=Object(ze.reshape)($,[T*O,L]),ie=Object(ze.argMax)(J,0),ge=Object(ze.expandDims)(Object(ze.div)(ie,Object(ze.scalar)(O,"int32")),1),Ae=Object(ze.expandDims)(function(Ie,De){return Object(ze.tidy)(function(){var et=Object(ze.div)(Ie,Object(ze.scalar)(De,"int32"));return Object(ze.sub)(Ie,Object(ze.mul)(et,Object(ze.scalar)(De,"int32")))})}(ie,O),1);return Object(ze.concat)([ge,Ae],1)})}function hc($,M,T,O){return{y:O.get($,M,T),x:O.get($,M,T+Mh)}}function wd($,M,T){return Object(ze.tidy)(function(){var O=function(L,J){for(var ie=[],ge=0;ge<Mh;ge++){var Ae=hc(L.get(ge,0).valueOf(),L.get(ge,1).valueOf(),ge,J),Ie=Ae.x,De=Ae.y;ie.push(De),ie.push(Ie)}return Object(ze.tensor2d)(ie,[Mh,2])}($,T);return Object(ze.add)(Object(ze.cast)(Object(ze.mul)($.toTensor(),Object(ze.scalar)(M,"int32")),"float32"),O)})}function $p($,M,T){return br(this,void 0,void 0,function(){var O,L,J,ie,ge,Ae,Ie,De,et,ot;return qu(this,function(zt){switch(zt.label){case 0:return O=0,L=Ze($),[4,Promise.all([$.buffer(),M.buffer(),L.buffer()])];case 1:return J=zt.sent(),ie=J[0],ge=J[1],Ae=J[2],[4,(Ie=wd(Ae,T,ge)).buffer()];case 2:return De=zt.sent(),et=Array.from(function(Ht,xn){for(var En=xn.shape[0],Fn=new Float32Array(En),Rn=0;Rn<En;Rn++){var Wn=xn.get(Rn,0),Jn=xn.get(Rn,1);Fn[Rn]=Ht.get(Wn,Jn,Rn)}return Fn}(ie,Ae)),ot=et.map(function(Ht,xn){return O+=Ht,{position:{y:De.get(xn,0),x:De.get(xn,1)},part:Th[xn],score:Ht}}),L.dispose(),Ie.dispose(),[2,{keypoints:ot,score:O/ot.length}]}})})}var Po="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/mobilenet/",Lo="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/resnet50/",ia=[-123.15,-115.9,-103.06],Ba=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Ns(M,$),M.prototype.preprocessInput=function(T){return Object(ze.add)(T,ia)},M.prototype.nameOutputResults=function(T){var O=T[0],L=T[1];return{offsets:T[2],heatmap:T[3],displacementFwd:O,displacementBwd:L}},M}(Qm);function $u($,M){return Lt($,M)?$:Math.floor($/M)*M+1}function ja($){ze.util.assert(typeof $=="number"||typeof $=="object",function(){return"Invalid inputResolution "+$+". Should be a number or an object with width and height"}),typeof $=="object"&&(ze.util.assert(typeof $.width=="number",function(){return"inputResolution.width has a value of "+$.width+" which is invalid; it must be a number"}),ze.util.assert(typeof $.height=="number",function(){return"inputResolution.height has a value of "+$.height+" which is invalid; it must be a number"}))}function rl($,M){return ja($),typeof $=="object"?[$u($.height,M),$u($.width,M)]:[$u($,M),$u($,M)]}var _u=[8,16,32];function Lt($,M){return($-1)%M==0}function Co($){return $ instanceof ze.Tensor?[$.shape[0],$.shape[1]]:[$.height,$.width]}function xa($,M){var T=M[0],O=M[1],L=Co($),J=L[0],ie=L[1],ge=O/T,Ae=[0,0,0,0],Ie=Ae[0],De=Ae[1],et=Ae[2],ot=Ae[3];return ie/J<ge?(Ie=0,De=0,et=Math.round(.5*(ge*J-ie)),ot=Math.round(.5*(ge*J-ie))):(Ie=Math.round(.5*(1/ge*ie-J)),De=Math.round(.5*(1/ge*ie-J)),et=0,ot=0),{resized:Object(ze.tidy)(function(){var zt=function(Ht){return Ht instanceof ze.Tensor?Ht:ze.browser.fromPixels(Ht)}($);return zt=Object(ze.pad3d)(zt,[[Ie,De],[et,ot],[0,0]]),ze.image.resizeBilinear(zt,[T,O])}),padding:{top:Ie,left:et,right:ot,bottom:De}}}function Za($,M,T,O,L){var J=M[0],ie=M[1],ge=T[0],Ae=T[1],Ie=function(De,et,ot,zt,Ht){return zt===void 0&&(zt=0),Ht===void 0&&(Ht=0),ot===1&&et===1&&zt===0&&Ht===0?De:De.map(function(xn){return function(En,Fn,Rn,Wn,Jn){return Wn===void 0&&(Wn=0),Jn===void 0&&(Jn=0),{score:En.score,keypoints:En.keypoints.map(function(Tn){var _r=Tn.score,Nr=Tn.part,Ir=Tn.position;return{score:_r,part:Nr,position:{x:Ir.x*Rn+Jn,y:Ir.y*Fn+Wn}}})}}(xn,et,ot,zt,Ht)})}($,(J+O.top+O.bottom)/ge,(ie+O.left+O.right)/Ae,-O.top,-O.left);return L?function(De,et){return et<=0?De:De.map(function(ot){return function(zt,Ht){return{score:zt.score,keypoints:zt.keypoints.map(function(xn){var En=xn.score,Fn=xn.part,Rn=xn.position;return{score:En,part:Fn,position:{x:Ht-1-Rn.x,y:Rn.y}}})}}(ot,et)})}(Ie,ie):Ie}var No={architecture:"MobileNetV1",outputStride:16,multiplier:.75,inputResolution:257},Fs=["MobileNetV1","ResNet50"],Ar={MobileNetV1:[8,16,32],ResNet50:[32,16]},au={MobileNetV1:[.5,.75,1],ResNet50:[1]},Eu=[1,2,4],Dl={flipHorizontal:!1},su={flipHorizontal:!1,maxDetections:5,scoreThreshold:.5,nmsRadius:20},Ih=function(){function $(M,T){(function(O){ze.util.assert(typeof O=="number",function(){return"outputStride is not a number"}),ze.util.assert(_u.indexOf(O)>=0,function(){return"outputStride of "+O+" is invalid. It must be either 8, 16, or 32"})})(M.outputStride),function(O,L){ze.util.assert(typeof O[0]=="number"&&typeof O[1]=="number",function(){return"both resolution values must be a number but had values "+O}),ze.util.assert(Lt(O[0],L),function(){return"height of "+O[0]+" is invalid for output stride "+L+"."}),ze.util.assert(Lt(O[1],L),function(){return"width of "+O[1]+" is invalid for output stride "+L+"."})}(T,M.outputStride),this.baseModel=M,this.inputResolution=T}return $.prototype.estimateMultiplePoses=function(M,T){return T===void 0&&(T=su),br(this,void 0,void 0,function(){var O,L,J,ie,ge,Ae,Ie,De,et,ot,zt,Ht,xn,En,Fn,Rn,Wn,Jn,Tn,_r,Nr;return qu(this,function(Ir){switch(Ir.label){case 0:return O=yd({},su,T),function(Qr){var zr=Qr.maxDetections,ki=Qr.scoreThreshold,Pi=Qr.nmsRadius;if(zr<=0)throw new Error("Invalid maxDetections "+zr+". Should be > 0");if(ki<0||ki>1)throw new Error("Invalid scoreThreshold "+ki+". Should be in range [0.0, 1.0]");if(Pi<=0)throw new Error("Invalid nmsRadius "+Pi+".")}(T),L=this.baseModel.outputStride,J=this.inputResolution,ie=Co(M),ge=ie[0],Ae=ie[1],Ie=xa(M,J),De=Ie.resized,et=Ie.padding,ot=this.baseModel.predict(De),zt=ot.heatmapScores,Ht=ot.offsets,xn=ot.displacementFwd,En=ot.displacementBwd,[4,function(Qr){return br(this,void 0,void 0,function(){return qu(this,function(zr){return[2,Promise.all(Qr.map(function(ki){return ki.buffer()}))]})})}([zt,Ht,xn,En])];case 1:return Fn=Ir.sent(),Rn=Fn[0],Wn=Fn[1],Jn=Fn[2],Tn=Fn[3],[4,Nh(Rn,Wn,Jn,Tn,L,O.maxDetections,O.scoreThreshold,O.nmsRadius)];case 2:return _r=Ir.sent(),Nr=Za(_r,[ge,Ae],J,et,O.flipHorizontal),zt.dispose(),Ht.dispose(),xn.dispose(),En.dispose(),De.dispose(),[2,Nr]}})})},$.prototype.estimateSinglePose=function(M,T){return T===void 0&&(T=Dl),br(this,void 0,void 0,function(){var O,L,J,ie,ge,Ae,Ie,De,et,ot,zt,Ht,xn,En,Fn,Rn;return qu(this,function(Wn){switch(Wn.label){case 0:return O=yd({},Dl,T),L=this.baseModel.outputStride,J=this.inputResolution,ie=Co(M),ge=ie[0],Ae=ie[1],Ie=xa(M,J),De=Ie.resized,et=Ie.padding,ot=this.baseModel.predict(De),zt=ot.heatmapScores,Ht=ot.offsets,xn=ot.displacementFwd,En=ot.displacementBwd,[4,$p(zt,Ht,L)];case 1:return Fn=Wn.sent(),Rn=Za([Fn],[ge,Ae],J,et,O.flipHorizontal),zt.dispose(),Ht.dispose(),xn.dispose(),En.dispose(),De.dispose(),[2,Rn[0]]}})})},$.prototype.estimatePoses=function(M,T){return br(this,void 0,void 0,function(){return qu(this,function(O){switch(O.label){case 0:return T.decodingMethod!=="single-person"?[3,2]:[4,this.estimateSinglePose(M,T)];case 1:return[2,[O.sent()]];case 2:return[2,this.estimateMultiplePoses(M,T)]}})})},$.prototype.dispose=function(){this.baseModel.dispose()},$}();function Xp($){return br(this,void 0,void 0,function(){var M,T,O,L,J,ie,ge;return qu(this,function(Ae){switch(Ae.label){case 0:if(M=$.outputStride,T=$.quantBytes,O=$.multiplier,ze==null)throw new Error(`Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this
        model.`);return L=function(Ie,De,et){var ot={1:"100",.75:"075",.5:"050"},zt="model-stride"+Ie+".json";return et===4?Po+"float/"+ot[De]+"/"+zt:Po+"quant"+et+"/"+ot[De]+"/"+zt}(M,O,T),[4,Object(Ot.loadGraphModel)($.modelUrl||L)];case 1:return J=Ae.sent(),ie=new Zm(J,M),ge=rl($.inputResolution,ie.outputStride),[2,new Ih(ie,ge)]}})})}function Kp($){return br(this,void 0,void 0,function(){var M,T,O,L,J,ie;return qu(this,function(ge){switch(ge.label){case 0:if(M=$.outputStride,T=$.quantBytes,ze==null)throw new Error(`Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this
        model.`);return O=function(Ae,Ie){var De="model-stride"+Ae+".json";return Ie===4?Lo+"float/"+De:Lo+"quant"+Ie+"/"+De}(M,T),[4,Object(Ot.loadGraphModel)($.modelUrl||O)];case 1:return L=ge.sent(),J=new Ba(L,M),ie=rl($.inputResolution,J.outputStride),[2,new Ih(J,ie)]}})})}function Fu($){return $===void 0&&($=No),br(this,void 0,void 0,function(){return qu(this,function(M){return($=function(T){if((T=T||No).architecture==null&&(T.architecture="MobileNetV1"),Fs.indexOf(T.architecture)<0)throw new Error("Invalid architecture "+T.architecture+". Should be one of "+Fs);if(T.inputResolution==null&&(T.inputResolution=257),ja(T.inputResolution),T.outputStride==null&&(T.outputStride=16),Ar[T.architecture].indexOf(T.outputStride)<0)throw new Error("Invalid outputStride "+T.outputStride+". Should be one of "+Ar[T.architecture]+" for architecture "+T.architecture+".");if(T.multiplier==null&&(T.multiplier=1),au[T.architecture].indexOf(T.multiplier)<0)throw new Error("Invalid multiplier "+T.multiplier+". Should be one of "+au[T.architecture]+" for architecture "+T.architecture+".");if(T.quantBytes==null&&(T.quantBytes=4),Eu.indexOf(T.quantBytes)<0)throw new Error("Invalid quantBytes "+T.quantBytes+". Should be one of "+Eu+" for architecture "+T.architecture+".");if(T.architecture==="MobileNetV1"&&T.outputStride===32&&T.multiplier!==1)throw new Error("When using an output stride of 32, you must select 1 as the multiplier.");return T}($)).architecture==="ResNet50"?[2,Kp($)]:$.architecture==="MobileNetV1"?[2,Xp($)]:[2,null]})})}function uo($){var M=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var T,O=xs()($);if(M){var L=xs()(this).constructor;T=Reflect.construct(O,arguments,L)}else T=O.apply(this,arguments);return tl()(this,T)}}var Rs={architecture:"MobileNetV1",outputStride:16,flipHorizontal:!1,minConfidence:.5,maxPoseDetections:5,scoreThreshold:.5,nmsRadius:20,detectionType:"multiple",inputResolution:256,multiplier:.75,quantBytes:2,modelUrl:null},Fh=function($){el()(T,$);var M=uo(T);function T(O,L,J,ie){var ge;return oe()(this,T),(ge=M.call(this)).video=O,ge.modelUrl=L.modelUrl||null,ge.architecture=L.architecture||Rs.architecture,ge.detectionType=J||L.detectionType||Rs.detectionType,ge.outputStride=L.outputStride||Rs.outputStride,ge.flipHorizontal=L.flipHorizontal||Rs.flipHorizontal,ge.scoreThreshold=L.scoreThreshold||Rs.scoreThreshold,ge.minConfidence=L.minConfidence||Rs.minConfidence,ge.maxPoseDetections=L.maxPoseDetections||Rs.maxPoseDetections,ge.multiplier=L.multiplier||Rs.multiplier,ge.inputResolution=L.inputResolution||Rs.inputResolution,ge.quantBytes=L.quantBytes||Rs.quantBytes,ge.nmsRadius=L.nmsRadius||Rs.nmsRadius,ge.ready=Ge(ge.load(),ie),ge}return _e()(T,[{key:"load",value:function(){var O=q()(me.a.mark(function L(){var J,ie=this;return me.a.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return J=this.architecture.toLowerCase()==="mobilenetv1"?{architecture:this.architecture,outputStride:this.outputStride,inputResolution:this.inputResolution,multiplier:this.multiplier,quantBytes:this.quantBytes,modelUrl:this.modelUrl}:{architecture:this.architecture,outputStride:this.outputStride,inputResolution:this.inputResolution,quantBytes:this.quantBytes},ge.next=3,Fu(J);case 3:if(this.net=ge.sent,!this.video){ge.next=9;break}if(this.video.readyState!==0){ge.next=8;break}return ge.next=8,new Promise(function(Ae){ie.video.onloadeddata=function(){return Ae()}});case 8:this.detectionType==="single"?this.singlePose():this.multiPose();case 9:return ge.abrupt("return",this);case 10:case"end":return ge.stop()}},L,this)}));return function(){return O.apply(this,arguments)}}()},{key:"skeleton",value:function(O){return function(L,J){return zo.reduce(function(ie,ge){var Ae=ge[0],Ie=ge[1];return function(De,et,ot){return De<ot||et<ot}(L[Ae].score,L[Ie].score,J)||ie.push([L[Ae],L[Ie]]),ie},[])}(O,arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.minConfidence)}},{key:"mapParts",value:function(O){var L=JSON.parse(JSON.stringify(O));return L.keypoints.forEach(function(J){L[J.part]={x:J.position.x,y:J.position.y,confidence:J.score}}),L}},{key:"getInput",value:function(O){return O instanceof HTMLImageElement||O instanceof HTMLVideoElement||O instanceof HTMLCanvasElement||O instanceof ImageData?O:we()(O)==="object"&&(O.elt instanceof HTMLImageElement||O.elt instanceof HTMLVideoElement||O.elt instanceof ImageData)?O.elt:we()(O)==="object"&&O.canvas instanceof HTMLCanvasElement?O.canvas:this.video}},{key:"singlePose",value:function(){var O=q()(me.a.mark(function L(J,ie){var ge,Ae,Ie,De,et=this;return me.a.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:return ge=this.getInput(J),ot.next=3,this.net.estimateSinglePose(ge,{flipHorizontal:this.flipHorizontal});case 3:if(Ae=ot.sent,Ie=this.mapParts(Ae),De=[{pose:Ie,skeleton:this.skeleton(Ae.keypoints)}],this.emit("pose",De),!this.video){ot.next=9;break}return ot.abrupt("return",I.nextFrame().then(function(){return et.singlePose()}));case 9:return typeof ie=="function"&&ie(De),ot.abrupt("return",De);case 11:case"end":return ot.stop()}},L,this)}));return function(L,J){return O.apply(this,arguments)}}()},{key:"multiPose",value:function(){var O=q()(me.a.mark(function L(J,ie){var ge,Ae,Ie,De,et=this;return me.a.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:return ge=this.getInput(J),ot.next=3,this.net.estimateMultiplePoses(ge,{flipHorizontal:this.flipHorizontal,maxDetections:this.maxPoseDetections,scoreThreshold:this.scoreThreshold,nmsRadius:this.nmsRadius});case 3:if(Ae=ot.sent,Ie=Ae.map(function(zt){return et.mapParts(zt)}),De=Ie.map(function(zt){return{pose:zt,skeleton:et.skeleton(zt.keypoints)}}),this.emit("pose",De),!this.video){ot.next=9;break}return ot.abrupt("return",I.nextFrame().then(function(){return et.multiPose()}));case 9:return typeof ie=="function"&&ie(De),ot.abrupt("return",De);case 11:case"end":return ot.stop()}},L,this)}));return function(L,J){return O.apply(this,arguments)}}()}]),T}(gd.a),Rc=function($,M,T){var O,L={},J=T,ie=null;return $ instanceof HTMLVideoElement?O=$:we()($)==="object"&&$.elt instanceof HTMLVideoElement?O=$.elt:we()($)==="object"?L=$:typeof $=="function"&&(J=$),we()(M)==="object"?L=M:typeof M=="string"&&(ie=M),typeof M=="function"&&(J=M),new Fh(O,L,ie,J)},_s=function(){function $(M){oe()(this,$),this.urlPath=M.endsWith("/")?M:"".concat(M,"/"),this.variables={}}return _e()($,[{key:"loadManifest",value:function(){var M=q()(me.a.mark(function T(){var O;return me.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.prev=0,L.next=3,Bt.a.get(this.urlPath+"manifest.json");case 3:return O=L.sent,L.abrupt("return",O.data);case 7:throw L.prev=7,L.t0=L.catch(0),new Error("".concat("manifest.json"," not found at ").concat(this.urlPath,". ").concat(L.t0));case 10:case"end":return L.stop()}},T,this,[[0,7]])}));return function(){return M.apply(this,arguments)}}()},{key:"loadVariable",value:function(){var M=q()(me.a.mark(function T(O){var L,J,ie,ge,Ae,Ie,De;return me.a.wrap(function(et){for(;;)switch(et.prev=et.next){case 0:return et.next=2,this.getCheckpointManifest();case 2:if(L=et.sent,O in L){et.next=5;break}throw new Error("Cannot load non-existent variable ".concat(O));case 5:return J=L[O],ie=J.filename,ge=J.shape,Ae=this.urlPath+ie,et.prev=7,et.next=10,Bt.a.get(Ae,{responseType:"arraybuffer"});case 10:return Ie=et.sent,De=new Float32Array(Ie.data),et.abrupt("return",I.tensor(De,ge));case 15:throw et.prev=15,et.t0=et.catch(7),new Error("Error loading variable ".concat(O," from URL ").concat(Ae,": ").concat(et.t0));case 18:case"end":return et.stop()}},T,this,[[7,15]])}));return function(T){return M.apply(this,arguments)}}()},{key:"getCheckpointManifest",value:function(){var M=q()(me.a.mark(function T(){return me.a.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(this.checkpointManifest){O.next=4;break}return O.next=3,this.loadManifest();case 3:this.checkpointManifest=O.sent;case 4:return O.abrupt("return",this.checkpointManifest);case 5:case"end":return O.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"getKeys",value:function(){var M=q()(me.a.mark(function T(){var O;return me.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,this.getCheckpointManifest();case 2:return O=L.sent,L.abrupt("return",Object.keys(O));case 4:case"end":return L.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"getAllVariables",value:function(){var M=q()(me.a.mark(function T(){var O,L,J=this;return me.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.next=2,this.getKeys();case 2:return O=ie.sent,L=O.map(function(ge){return J.getVariable(ge)}),ie.next=6,Promise.all(L);case 6:return ie.abrupt("return",this.variables);case 7:case"end":return ie.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"getVariable",value:function(){var M=q()(me.a.mark(function T(O){return me.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(this.variables[O]){L.next=4;break}return L.next=3,this.loadVariable(O);case 3:this.variables[O]=L.sent;case 4:return L.abrupt("return",this.variables[O]);case 5:case"end":return L.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()}]),$}();function vi($){var M=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var T,O=xs()($);if(M){var L=xs()(this).constructor;T=Reflect.construct(O,arguments,L)}else T=O.apply(this,arguments);return tl()(this,T)}}var $o=200,Rh=function($){return new Promise(function(M){var T=new Image($o,$o);T.onload=function(){return M(T)},T.src=$.toDataURL()})},Yp=function($){el()(T,$);var M=vi(T);function T(O,L,J){var ie;return oe()(this,T),(ie=M.call(this,L,$o)).ready=!1,ie.variableDictionary={},ie.timesScalar=I.scalar(150),ie.plusScalar=I.scalar(127.5),ie.epsilonScalar=I.scalar(.001),ie.video=null,ie.ready=Ge(ie.load(O),J),ie}return _e()(T,[{key:"load",value:function(){var O=q()(me.a.mark(function L(J){return me.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(!this.videoElt){ie.next=3;break}return ie.next=3,this.loadVideo();case 3:return ie.next=5,this.loadCheckpoints(J);case 5:return ie.abrupt("return",this);case 6:case"end":return ie.stop()}},L,this)}));return function(L){return O.apply(this,arguments)}}()},{key:"loadCheckpoints",value:function(){var O=q()(me.a.mark(function L(J){var ie;return me.a.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return ie=new _s(J),ge.next=3,ie.getAllVariables();case 3:this.variables=ge.sent;case 4:case"end":return ge.stop()}},L,this)}));return function(L){return O.apply(this,arguments)}}()},{key:"instanceNorm",value:function(O,L){var J=this;return I.tidy(function(){var ie=Pn()(O.shape,3),ge=ie[0],Ae=ie[1],Ie=ie[2],De=I.moments(O,[0,1]),et=De.mean,ot=De.variance,zt=J.variables[T.getVariableName(L)],Ht=J.variables[T.getVariableName(L+1)],xn=J.epsilonScalar,En=I.div(I.sub(O.asType("float32"),et),I.sqrt(I.add(ot,xn)));return I.add(I.mul(Ht,En),zt).as3D(ge,Ae,Ie)})}},{key:"convLayer",value:function(O,L,J,ie){var ge=I.conv2d(O,this.variables[T.getVariableName(ie)],[L,L],"same"),Ae=this.instanceNorm(ge,ie+1);return J?I.relu(Ae):Ae}},{key:"residualBlock",value:function(O,L){var J=this.convLayer(O,1,!0,L),ie=this.convLayer(J,1,!1,L+3);return I.add(ie,O)}},{key:"convTransposeLayer",value:function(O,L,J,ie){var ge=Pn()(O.shape,2),Ae=[ge[0]*J,ge[1]*J,L],Ie=I.conv2dTranspose(O,this.variables[T.getVariableName(ie)],Ae,[J,J],"same"),De=this.instanceNorm(Ie,ie+1);return I.relu(De)}},{key:"transfer",value:function(){var O=q()(me.a.mark(function L(J,ie){var ge,Ae;return me.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:if(Ae=ie,!(J instanceof HTMLVideoElement||J instanceof HTMLImageElement||J instanceof ImageData)){Ie.next=5;break}ge=J,Ie.next=18;break;case 5:if(!(J instanceof HTMLCanvasElement)){Ie.next=11;break}return Ie.next=8,Rh(J);case 8:ge=Ie.sent,Ie.next=18;break;case 11:if(!(we()(J)==="object"&&J.elt instanceof HTMLCanvasElement)){Ie.next=17;break}return Ie.next=14,Rh(J.elt);case 14:ge=Ie.sent,Ie.next=18;break;case 17:we()(J)==="object"&&(J.elt instanceof HTMLVideoElement||J.elt instanceof HTMLImageElement||J.elt instanceof ImageData)?ge=J.elt:typeof J=="function"&&(ge=this.video,Ae=J);case 18:return Ie.abrupt("return",Ge(this.transferInternal(ge),Ae));case 19:case"end":return Ie.stop()}},L,this)}));return function(L,J){return O.apply(this,arguments)}}()},{key:"transferInternal",value:function(){var O=q()(me.a.mark(function L(J){var ie,ge,Ae=this;return me.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return ie=I.browser.fromPixels(J),ge=Kt(I.tidy(function(){var De=Ae.convLayer(ie,1,!0,0),et=Ae.convLayer(De,2,!0,3),ot=Ae.convLayer(et,2,!0,6),zt=Ae.residualBlock(ot,9),Ht=Ae.residualBlock(zt,15),xn=Ae.residualBlock(Ht,21),En=Ae.residualBlock(xn,27),Fn=Ae.residualBlock(En,33),Rn=Ae.convTransposeLayer(Fn,64,2,39),Wn=Ae.convTransposeLayer(Rn,32,2,42),Jn=Ae.convLayer(Wn,1,!1,45),Tn=I.tanh(Jn),_r=I.mul(Ae.timesScalar,Tn),Nr=I.add(Ae.plusScalar,_r),Ir=I.clipByValue(Nr,0,255);return I.div(Ir,I.scalar(255))})),ie.dispose(),Ie.next=5,I.nextFrame();case 5:return Ie.abrupt("return",ge);case 6:case"end":return Ie.stop()}},L)}));return function(L){return O.apply(this,arguments)}}()}],[{key:"getVariableName",value:function(O){return O===0?"Variable":"Variable_".concat(O)}}]),T}(Wr),gf=function($,M,T){var O=T;typeof M=="function"&&(O=M);var L=new Yp($,M,O);return O?L:L.ready},Ph=function($){for(var M,T=Math.random(),O=0,L=0;L<$.length;L+=1)if(T<(O+=$[L])){M=L;break}return M},$i=/cell_[0-9]|lstm_[0-9]/gi,Ii=/weights|weight|kernel|kernels|w/gi,ma=/softmax/gi,Jp=function(){function $(M,T){oe()(this,$),this.ready=!1,this.model={},this.cellsAmount=0,this.cells=[],this.zeroState={c:[],h:[]},this.state={c:[],h:[]},this.vocab={},this.vocabSize=0,this.probabilities=[],this.defaults={seed:"a",length:20,temperature:.5,stateful:!1},this.ready=Ge(this.loadCheckpoints(M),T)}return _e()($,[{key:"resetState",value:function(){this.state=this.zeroState}},{key:"setState",value:function(M){this.state=M}},{key:"getState",value:function(){return this.state}},{key:"loadCheckpoints",value:function(){var M=q()(me.a.mark(function T(O){var L,J,ie=this;return me.a.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return L=new _s(O),ge.next=3,L.getAllVariables();case 3:return J=ge.sent,Object.keys(J).forEach(function(Ae){Ae.match($i)?Ae.match(Ii)?(ie.model["Kernel_".concat(Ae.match(/[0-9]/)[0])]=J[Ae],ie.cellsAmount+=1):ie.model["Bias_".concat(Ae.match(/[0-9]/)[0])]=J[Ae]:Ae.match(ma)?Ae.match(Ii)?ie.model.fullyConnectedWeights=J[Ae]:ie.model.fullyConnectedBiases=J[Ae]:ie.model[Ae]=J[Ae]}),ge.next=7,this.loadVocab(O);case 7:return ge.next=9,this.initCells();case 9:return ge.abrupt("return",this);case 10:case"end":return ge.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"loadVocab",value:function(){var M=q()(me.a.mark(function T(O){var L,J;return me.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.prev=0,ie.next=3,Bt.a.get("".concat(O,"/vocab.json"));case 3:return L=ie.sent,J=L.data,this.vocab=J,this.vocabSize=Object.keys(J).length,ie.abrupt("return",this.vocab);case 10:return ie.prev=10,ie.t0=ie.catch(0),ie.abrupt("return",ie.t0);case 13:case"end":return ie.stop()}},T,this,[[0,10]])}));return function(T){return M.apply(this,arguments)}}()},{key:"initCells",value:function(){var M=q()(me.a.mark(function T(){var O,L,J,ie=this;return me.a.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:for(this.cells=[],this.zeroState={c:[],h:[]},O=I.tensor(1),L=function(Ae){return function(Ie,De,et){return I.basicLSTMCell(O,ie.model["Kernel_".concat(Ae)],ie.model["Bias_".concat(Ae)],Ie,De,et)}},J=0;J<this.cellsAmount;J+=1)this.zeroState.c.push(I.zeros([1,this.model["Bias_".concat(J)].shape[0]/4])),this.zeroState.h.push(I.zeros([1,this.model["Bias_".concat(J)].shape[0]/4])),this.cells.push(L(J));this.state=this.zeroState;case 6:case"end":return ge.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"generateInternal",value:function(){var M=q()(me.a.mark(function T(O){var L,J,ie,ge,Ae,Ie,De,et,ot,zt,Ht,xn,En,Fn,Rn,Wn,Jn,Tn,_r,Nr=this;return me.a.wrap(function(Ir){for(;;)switch(Ir.prev=Ir.next){case 0:return Ir.next=2,this.ready;case 2:L=O.seed||this.defaults.seed,J=+O.length||this.defaults.length,ie=+O.temperature||this.defaults.temperature,O.stateful||this.defaults.stateful||(this.state=this.zeroState),ge=[],Ae=Array.from(L),Ie=[],Ae.forEach(function(Qr){Ie.push(Nr.vocab[Qr])}),De=Ie[0],et=[],ot=0;case 14:if(!(ot<Ae.length+J+-1)){Ir.next=36;break}return Ir.next=17,I.buffer([1,this.vocabSize]);case 17:return(zt=Ir.sent).set(1,0,De),Ht=zt.toTensor(),xn=void 0,this.model.embedding?(En=I.matMul(Ht,this.model.embedding),xn=I.multiRNNCell(this.cells,En,this.state.c,this.state.h)):xn=I.multiRNNCell(this.cells,Ht,this.state.c,this.state.h),this.state.c=xn[0],this.state.h=xn[1],Fn=this.state.h[1],Rn=I.matMul(Fn,this.model.fullyConnectedWeights),Wn=I.add(Rn,this.model.fullyConnectedBiases),Jn=I.div(Wn,I.tensor(ie)),Tn=I.exp(Jn),Ir.next=31,I.div(Tn,I.sum(Tn)).data();case 31:et=Ir.sent,ot<Ae.length-1?De=Ie[ot+1]:(De=Ph(et),ge.push(De));case 33:ot+=1,Ir.next=14;break;case 36:return _r="",ge.forEach(function(Qr){var zr=Object.keys(Nr.vocab).find(function(ki){return Nr.vocab[ki]===Qr});zr&&(_r+=zr)}),this.probabilities=et,Ir.abrupt("return",{sample:_r,state:this.state});case 40:case"end":return Ir.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"reset",value:function(){this.state=this.zeroState}},{key:"generate",value:function(){var M=q()(me.a.mark(function T(O,L){return me.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return this.reset(),J.abrupt("return",Ge(this.generateInternal(O),L));case 2:case"end":return J.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()},{key:"predict",value:function(){var M=q()(me.a.mark(function T(O,L){var J,ie,ge,Ae,Ie,De,et,ot,zt,Ht,xn=this;return me.a.wrap(function(En){for(;;)switch(En.prev=En.next){case 0:return J=[],ie=O>0?O:.1,ge=this.state.h[1],Ae=I.matMul(ge,this.model.fullyConnectedWeights),Ie=I.add(Ae,this.model.fullyConnectedBiases),De=I.div(Ie,I.tensor(ie)),et=I.exp(De),En.next=9,I.div(et,I.sum(et)).data();case 9:return J=En.sent,ot=Ph(J),zt=Object.keys(this.vocab).find(function(Fn){return xn.vocab[Fn]===ot}),this.probabilities=J,L&&L(zt),Ht=Object.keys(this.vocab).map(function(Fn){return{char:Fn,probability:xn.probabilities[xn.vocab[Fn]]}}),En.abrupt("return",{sample:zt,probabilities:Ht});case 16:case"end":return En.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()},{key:"feed",value:function(){var M=q()(me.a.mark(function T(O,L){var J,ie,ge,Ae,Ie,De,et,ot,zt=this;return me.a.wrap(function(Ht){for(;;)switch(Ht.prev=Ht.next){case 0:return Ht.next=2,this.ready;case 2:J=Array.from(O),ie=[],J.forEach(function(xn){ie.push(zt.vocab[xn])}),ge=ie[0],Ae=0;case 7:if(!(Ae<J.length)){Ht.next=21;break}return Ht.next=10,I.buffer([1,this.vocabSize]);case 10:(Ie=Ht.sent).set(1,0,ge),De=Ie.toTensor(),et=void 0,this.model.embedding?(ot=I.matMul(De,this.model.embedding),et=I.multiRNNCell(this.cells,ot,this.state.c,this.state.h)):et=I.multiRNNCell(this.cells,De,this.state.c,this.state.h),this.state.c=et[0],this.state.h=et[1],ge=ie[Ae];case 18:Ae+=1,Ht.next=7;break;case 21:L&&L();case 22:case"end":return Ht.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()}]),$}(),Qp=function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"./",M=arguments.length>1?arguments[1]:void 0;return new Jp($,M)},Zp=function(){function $(M){oe()(this,$),this.urlPath=M}return _e()($,[{key:"getAllVariables",value:function(){var M=q()(me.a.mark(function T(){var O,L,J,ie,ge,Ae,Ie,De,et,ot;return me.a.wrap(function(zt){for(;;)switch(zt.prev=zt.next){case 0:return zt.next=2,Bt.a.get(this.urlPath,{responseType:"arraybuffer"}).catch(function(Ht){throw new Error("No model found. Failed with error ".concat(Ht))});case 2:for(O=zt.sent,L=O.data,J=[],ie=0;ie<L.byteLength;)ge=new Uint8Array(L.slice(ie,ie+4)),ie+=4,Ae=(ge[0]<<24)+(ge[1]<<16)+(ge[2]<<8)+ge[3],J.push(L.slice(ie,ie+Ae)),ie+=Ae;return Ie=JSON.parse(new TextDecoder("utf8").decode(J[0])),De=new Float32Array(J[1]),et=new Uint8Array(J[2]),ot={},ie=0,Ie.forEach(function(Ht){var xn=Ht.shape,En=Ht.name,Fn=xn.reduce(function(Jn,Tn){return Jn*Tn}),Rn=et.slice(ie,ie+Fn),Wn=new Float32Array(Rn.length);Rn.forEach(function(Jn,Tn){Wn[Tn]=De[Jn]}),ot[En]=I.tensor(Wn,xn,"float32"),ie+=Fn}),zt.abrupt("return",ot);case 14:case"end":return zt.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()}]),$}(),ng=function(){function $(M,T){oe()(this,$),this.ready=Ge(this.loadCheckpoints(M),T)}return _e()($,[{key:"loadCheckpoints",value:function(){var M=q()(me.a.mark(function T(O){var L;return me.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return L=new Zp(O),J.next=3,L.getAllVariables();case 3:return this.variables=J.sent,J.abrupt("return",this);case 5:case"end":return J.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"transfer",value:function(){var M=q()(me.a.mark(function T(O,L){return me.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.abrupt("return",Ge(this.transferInternal(O),L));case 1:case"end":return J.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()},{key:"transferInternal",value:function(){var M=q()(me.a.mark(function T(O){var L,J=this;return me.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return L=Kt(I.tidy(function(){var ge=I.browser.fromPixels(O),Ae=ge.dataSync(),Ie=I.tensor3d(Ae,ge.shape),De=I.div(Ie,I.scalar(255)),et=$.preprocess(De),ot=[],zt=J.variables["generator/encoder_1/conv2d/kernel"],Ht=J.variables["generator/encoder_1/conv2d/bias"],xn=$.conv2d(et,zt,Ht);ot.push(xn);for(var En=2;En<=8;En+=1){var Fn="generator/encoder_".concat(En.toString());zt=J.variables["".concat(Fn,"/conv2d/kernel")];var Rn=J.variables["".concat(Fn,"/conv2d/bias")],Wn=ot[ot.length-1],Jn=I.leakyRelu(Wn,.2);xn=$.conv2d(Jn,zt,Rn);var Tn=J.variables["".concat(Fn,"/batch_normalization/gamma")],_r=J.variables["".concat(Fn,"/batch_normalization/beta")],Nr=$.batchnorm(xn,Tn,_r);ot.push(Nr)}for(var Ir=8;Ir>=2;Ir-=1){var Qr=void 0;if(Ir===8)Qr=ot[ot.length-1];else{var zr=Ir-1;Qr=I.concat([ot[ot.length-1],ot[zr]],2)}var ki=I.relu(Qr),Pi="generator/decoder_".concat(Ir.toString());zt=J.variables["".concat(Pi,"/conv2d_transpose/kernel")],Ht=J.variables["".concat(Pi,"/conv2d_transpose/bias")],xn=$.deconv2d(ki,zt,Ht);var Fi=J.variables["".concat(Pi,"/batch_normalization/gamma")],Mo=J.variables["".concat(Pi,"/batch_normalization/beta")],Jo=$.batchnorm(xn,Fi,Mo);ot.push(Jo)}var jo=I.concat([ot[ot.length-1],ot[0]],2),Bo=I.relu(jo);zt=J.variables["generator/decoder_1/conv2d_transpose/kernel"];var Ho=J.variables["generator/decoder_1/conv2d_transpose/bias"];xn=$.deconv2d(Bo,zt,Ho),Bo=I.tanh(xn),ot.push(Bo);var la=ot[ot.length-1];return $.deprocess(la)})),ie.next=3,I.nextFrame();case 3:return ie.abrupt("return",L);case 4:case"end":return ie.stop()}},T)}));return function(T){return M.apply(this,arguments)}}()}],[{key:"preprocess",value:function(M){var T=I.tidy(function(){return I.sub(I.mul(M,I.scalar(2)),I.scalar(1))});return M.dispose(),T}},{key:"deprocess",value:function(M){var T=I.tidy(function(){return I.div(I.add(M,I.scalar(1)),I.scalar(2))});return M.dispose(),T}},{key:"batchnorm",value:function(M,T,O){var L=I.tidy(function(){var J=I.moments(M,[0,1]);return I.batchNorm(M,J.mean,J.variance,O,T,1e-5)});return M.dispose(),L}},{key:"conv2d",value:function(M,T){var O=T.clone(),L=I.tidy(function(){return I.conv2d(M,O,[2,2],"same")});return M.dispose(),O.dispose(),L}},{key:"deconv2d",value:function(M,T,O){var L=I.tidy(function(){var J=I.conv2dTranspose(M,T,[2*M.shape[0],2*M.shape[1],T.shape[2]],[2,2],"same");return I.add(J,O)});return M.dispose(),T.dispose(),O.dispose(),L}}]),$}(),pc=function($,M){var T=new ng($,M);return M?T:T.ready},Ps=r(241),Nl=new Set(["alarm_clock","ambulance","angel","ant","antyoga","backpack","barn","basket","bear","bee","beeflower","bicycle","bird","book","brain","bridge","bulldozer","bus","butterfly","cactus","calendar","castle","cat","catbus","catpig","chair","couch","crab","crabchair","crabrabbitfacepig","cruise_ship","diving_board","dog","dogbunny","dolphin","duck","elephant","elephantpig","eye","face","fan","fire_hydrant","firetruck","flamingo","flower","floweryoga","frog","frogsofa","garden","hand","hedgeberry","hedgehog","helicopter","kangaroo","key","lantern","lighthouse","lion","lionsheep","lobster","map","mermaid","monapassport","monkey","mosquito","octopus","owl","paintbrush","palm_tree","parrot","passport","peas","penguin","pig","pigsheep","pineapple","pool","postcard","power_outlet","rabbit","rabbitturtle","radio","radioface","rain","rhinoceros","rifle","roller_coaster","sandwich","scorpion","sea_turtle","sheep","skull","snail","snowflake","speedboat","spider","squirrel","steak","stove","strawberry","swan","swing_set","the_mona_lisa","tiger","toothbrush","toothpaste","tractor","trombone","truck","whale","windmill","yoga","yogabicycle","everything"]),Ks={modelPath:"https://storage.googleapis.com/quickdraw-models/sketchRNN/large_models/",modelPath_large:"https://storage.googleapis.com/quickdraw-models/sketchRNN/models/",modelPath_small:"https://storage.googleapis.com/quickdraw-models/sketchRNN/models/",PATH_END:".gen.json",temperature:.65,pixelFactor:3},Su=function(){function $(M,T){var O=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];oe()(this,$);var L=M;if(this.config={temperature:.65,pixelFactor:3,modelPath:Ks.modelPath,modelPath_small:Ks.modelPath_small,modelPath_large:Ks.modelPath_large,PATH_END:Ks.PATH_END},dc.isAbsoluteURL(L)===!0){var J=dc.getModelPath(L);this.config.modelPath=J}else{if(!Nl.has(L))return console.log("no model found!"),this;L=(O?this.config.modelPath:this.config.modelPath_small)+L+this.config.PATH_END,this.config.modelPath=L}this.model=new Ps.SketchRNN(this.config.modelPath),this.penState=this.model.zeroInput(),this.ready=Ge(this.model.initialize(),T)}return _e()($,[{key:"generateInternal",value:function(){var M=q()(me.a.mark(function T(O,L){var J,ie,ge,Ae;return me.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return J=+O.temperature||this.config.temperature,ie=+O.pixelFactor||this.config.pixelFactor,Ie.next=4,this.ready;case 4:return this.rnnState||(this.rnnState=this.model.zeroState(),this.model.setPixelFactor(ie)),Array.isArray(L)&&L.length&&(this.rnnState=this.model.updateStrokes(L,this.rnnState)),this.rnnState=this.model.update(this.penState,this.rnnState),ge=this.model.getPDF(this.rnnState,J),this.penState=this.model.sample(ge),Ae={dx:this.penState[0],dy:this.penState[1]},this.penState[2]===1?Ae.pen="down":this.penState[3]===1?Ae.pen="up":this.penState[4]===1&&(Ae.pen="end"),Ie.abrupt("return",Ae);case 12:case"end":return Ie.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()},{key:"generate",value:function(){var M=q()(me.a.mark(function T(O,L,J){var ie,ge,Ae,Ie;return me.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return typeof O=="function"?(ge={},Ae=[],ie=O):Array.isArray(O)?(ge={},Ae=O,ie=L):typeof L=="function"?(ge=O||{},Ae=[],ie=L):(ge=O||{},Ae=L||[],ie=J),Ie=Ae.map(function(et){var ot=et.pen==="up"?1:0,zt=et.pen==="down"?1:0,Ht=et.pen==="end"?1:0;return[et.dx,et.dy,zt,ot,Ht]}),De.abrupt("return",Ge(this.generateInternal(ge,Ie),ie));case 3:case"end":return De.stop()}},T,this)}));return function(T,O,L){return M.apply(this,arguments)}}()},{key:"reset",value:function(){this.penState=this.model.zeroInput(),this.rnnState&&(this.rnnState=this.model.zeroState())}}]),$}(),Lh=function($,M){var T=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];return new Su($,M,T)},Hi={modelPath:"https://raw.githubusercontent.com/zaidalyafeai/HostedModels/master/unet-128/model.json",imageSize:128,returnTensors:!1},_d=function(){function $(M,T,O){oe()(this,$),this.modelReady=!1,this.isPredicting=!1,this.config={modelPath:T.modelPath!==void 0?T.modelPath:Hi.modelPath,imageSize:T.imageSize!==void 0?T.imageSize:Hi.imageSize,returnTensors:T.returnTensors!==void 0?T.returnTensors:Hi.returnTensors},this.ready=Ge(this.loadModel(),O)}return _e()($,[{key:"loadModel",value:function(){var M=q()(me.a.mark(function T(){return me.a.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,I.loadLayersModel(this.config.modelPath);case 2:return this.model=O.sent,this.modelReady=!0,O.abrupt("return",this);case 5:case"end":return O.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"segment",value:function(){var M=q()(me.a.mark(function T(O,L){var J,ie;return me.a.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return ge.next=2,this.ready;case 2:return ie=L,O instanceof HTMLImageElement||O instanceof HTMLVideoElement||O instanceof HTMLCanvasElement||O instanceof ImageData?J=O:we()(O)==="object"&&(O.elt instanceof HTMLImageElement||O.elt instanceof HTMLVideoElement||O.elt instanceof HTMLCanvasElement||O.elt instanceof ImageData)?J=O.elt:typeof O=="function"&&(J=this.video,ie=O),ge.abrupt("return",Ge(this.segmentInternal(J),ie));case 5:case"end":return ge.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()},{key:"convertToP5Image",value:function(){var M=q()(me.a.mark(function T(O){var L,J;return me.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.next=2,Gt.rawToBlob(O,this.config.imageSize,this.config.imageSize);case 2:return L=ie.sent,ie.next=5,Gt.blobToP5Image(L);case 5:return J=ie.sent,ie.abrupt("return",J);case 7:case"end":return ie.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"segmentInternal",value:function(){var M=q()(me.a.mark(function T(O){var L,J,ie,ge,Ae,Ie,De,et,ot,zt,Ht,xn,En,Fn,Rn=this;return me.a.wrap(function(Wn){for(;;)switch(Wn.prev=Wn.next){case 0:return Wn.next=2,this.ready;case 2:if(!(O instanceof HTMLVideoElement)){Wn.next=5;break}return Wn.next=5,I.nextFrame();case 5:return this.isPredicting=!0,L=I.tidy(function(){var Jn=I.browser.fromPixels(O).toFloat(),Tn=I.image.resizeBilinear(Jn,[Rn.config.imageSize,Rn.config.imageSize]).div(I.scalar(255)),_r=Tn.expandDims(0),Nr=Rn.model.predict(_r),Ir=I.ones([128,128,1]).tile([1,1,1]);Tn=Tn.concat(Ir,2);var Qr=Nr.squeeze([0]),zr=(Qr=(Qr=Qr.tile([1,1,4])).sub(.3).sign().relu().neg().add(1)).mul(Tn),ki=Nr.squeeze([0]),Pi=(ki=(ki=ki.tile([1,1,4])).sub(.3).sign().relu()).mul(Tn),Fi=I.ones([128,128,1]).tile([1,1,1]).mul(255),Mo=Nr.squeeze([0]);return{featureMask:zr,backgroundMask:Pi,segmentation:Mo=(Mo=I.cast(Mo.tile([1,1,3]).sub(.3).sign().relu().mul(255),"int32")).concat(Fi,2)}}),J=L.featureMask,ie=L.backgroundMask,ge=L.segmentation,this.isPredicting=!1,Wn.next=10,I.browser.toPixels(J);case 10:return Ae=Wn.sent,Wn.next=13,I.browser.toPixels(ie);case 13:return Ie=Wn.sent,Wn.next=16,I.browser.toPixels(ge);case 16:if(De=Wn.sent,et=Kt(J),ot=Kt(ie),zt=$.dataURLtoBlob(et.src),Ht=$.dataURLtoBlob(ot.src),!Gt.checkP5()){Wn.next=31;break}return Wn.next=24,this.convertToP5Image(Ae);case 24:return xn=Wn.sent,Wn.next=27,this.convertToP5Image(Ie);case 27:return En=Wn.sent,Wn.next=30,this.convertToP5Image(De);case 30:Fn=Wn.sent;case 31:return this.config.returnTensors||(J.dispose(),ie.dispose(),ge.dispose()),Wn.abrupt("return",{segmentation:De,blob:{featureMask:zt,backgroundMask:Ht},tensor:{featureMask:J,backgroundMask:ie},raw:{featureMask:Ae,backgroundMask:Ie},featureMask:xn,backgroundMask:En,mask:Fn});case 33:case"end":return Wn.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()}],[{key:"dataURLtoBlob",value:function(M){for(var T=M.split(","),O=T[0].match(/:(.*?);/)[1],L=atob(T[1]),J=L.length,ie=new Uint8Array(J);J;)ie[J]=L.charCodeAt(J),J-=1;return new Blob([ie],{type:O})}}]),$}(),Il=function($,M,T){var O=null,L={},J=T;return $ instanceof HTMLVideoElement?O=$:we()($)==="object"&&$.elt instanceof HTMLVideoElement?O=$.elt:typeof $=="function"?J=$:we()($)==="object"&&(L=$),we()(M)==="object"?L=M:typeof M=="function"&&(J=M),new _d(O,L,J)},vf=function(){function $(M,T){var O=this;oe()(this,$),this.ready=!1,this.model={},this.latentDim=I.randomUniform([1,16]);var L=M.split("manifest.json"),J=Pn()(L,1)[0];Bt.a.get(M).then(function(ie){var ge=ie.data;O.ready=Ge(O.loadCVAEModel(J+ge.model),T),O.labels=ge.labels,O.labelVector=Array(O.labels.length+1).fill(0)})}return _e()($,[{key:"loadCVAEModel",value:function(){var M=q()(me.a.mark(function T(O){return me.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,I.loadLayersModel(O);case 2:return this.model=L.sent,L.abrupt("return",this);case 4:case"end":return L.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"generate",value:function(){var M=q()(me.a.mark(function T(O,L){return me.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.abrupt("return",Ge(this.generateInternal(O),L));case 1:case"end":return J.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()},{key:"loadAsync",value:function(M){var T=this;return new Promise(function(O,L){T.ready||L(),loadImage(M,function(J){O(J)})})}},{key:"getBlob",value:function(M){var T=this;return new Promise(function(O,L){T.ready||L(),M.toBlob(function(J){O(J)})})}},{key:"generateInternal",value:function(){var M=q()(me.a.mark(function T(O){var L,J,ie,ge,Ae,Ie,De,et,ot,zt,Ht,xn,En=this;return me.a.wrap(function(Fn){for(;;)switch(Fn.prev=Fn.next){case 0:return L=I.tidy(function(){En.latentDim=I.randomUniform([1,16]);var Rn=En.labels.indexOf(O);if(Rn<0)return console.log("Wrong input of the label!"),[void 0,void 0];En.labelVector=En.labelVector.map(function(){return 0}),En.labelVector[Rn+1]=1;var Wn=I.tensor([En.labelVector]),Jn=En.model.predict([En.latentDim,Wn]);return Jn.reshape([Jn.shape[1],Jn.shape[2],Jn.shape[3]])}),Fn.next=3,I.browser.toPixels(L);case 3:for(J=Fn.sent,L.dispose(),ie=document.createElement("canvas"),ge=ie.getContext("2d"),Ae=Pn()(L.shape,2),Ie=Ae[0],De=Ae[1],ie.width=Ie,ie.height=De,et=ge.createImageData(Ie,De),ot=et.data,zt=0;zt<Ie*De*4;zt+=1)ot[zt]=J[zt];return ge.putImageData(et,0,0),Fn.t0=URL,Fn.next=17,this.getBlob(ie);case 17:if(Fn.t1=Fn.sent,Ht=Fn.t0.createObjectURL.call(Fn.t0,Fn.t1),!Gt.checkP5()){Fn.next=23;break}return Fn.next=22,this.loadAsync(Ht);case 22:xn=Fn.sent;case 23:return Fn.abrupt("return",{src:Ht,raws:J,image:xn});case 24:case"end":return Fn.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()}]),$}(),em=function($,M){return new vf($,M)},rg=function(){function $(M,T,O){oe()(this,$),this.model={},this.modelPath=M,this.modelInfo={},this.modelPathPrefix="",this.modelReady=!1,this.config={returnTensors:T.returnTensors||!1},this.ready=Ge(this.loadModel(),O)}return _e()($,[{key:"loadModel",value:function(){var M=q()(me.a.mark(function T(){var O,L,J,ie,ge,Ae;return me.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return Ie.next=2,Bt.a.get(this.modelPath);case 2:return O=Ie.sent,L=O.data,this.modelInfo=L,J=this.modelPath.split("manifest.json"),ie=Pn()(J,1),ge=ie[0],Ae=this.isAbsoluteURL(ge)?this.modelInfo.model:this.modelPathPrefix+this.modelInfo.model,Ie.next=9,I.loadLayersModel(Ae);case 9:return this.model=Ie.sent,this.modelReady=!0,Ie.abrupt("return",this);case 12:case"end":return Ie.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"generate",value:function(){var M=q()(me.a.mark(function T(O,L){return me.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,this.ready;case 2:return J.abrupt("return",Ge(this.generateInternal(L),O));case 3:case"end":return J.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()},{key:"compute",value:function(){var M=q()(me.a.mark(function T(O,L){var J,ie=this;return me.a.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return J=I.tidy(function(){var Ae;if(Array.isArray(L)===!1)Ae=I.randomNormal([1,O]);else{for(var Ie=I.buffer([1,O]),De=0;De<O;De+=1)Ie.set(L[De],0,De);Ae=Ie.toTensor()}return ie.model.predict(Ae).squeeze().transpose([1,2,0]).div(I.scalar(2)).add(I.scalar(.5))}),ge.abrupt("return",J);case 2:case"end":return ge.stop()}},T)}));return function(T,O){return M.apply(this,arguments)}}()},{key:"generateInternal",value:function(){var M=q()(me.a.mark(function T(O){var L,J,ie,ge,Ae,Ie,De,et,ot;return me.a.wrap(function(zt){for(;;)switch(zt.prev=zt.next){case 0:return L=this.modelInfo.modelLatentDim,zt.next=3,this.compute(L,O);case 3:return J=zt.sent,zt.next=6,I.browser.toPixels(J);case 6:return ie=zt.sent,ge=Pn()(J.shape,2),Ae=ge[0],Ie=ge[1],zt.next=10,Gt.rawToBlob(ie,Ie,Ae);case 10:if(De=zt.sent,!Gt.checkP5()){zt.next=15;break}return zt.next=14,Gt.blobToP5Image(De);case 14:et=zt.sent;case 15:return(ot={}).blob=De,ot.raw=ie,Gt.checkP5()&&(ot.image=et),this.config.returnTensors?ot.tensor=J:(ot.tensor=null,J.dispose()),zt.abrupt("return",ot);case 21:case"end":return zt.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"isAbsoluteURL",value:function(M){return!!new RegExp("^(?:[a-z]+:)?//","i").test(M)}}]),$}(),yf=function($,M,T){var O,L={};if(typeof $!="string")throw new Error(`Please specify a path to a "manifest.json" file: 

         "models/face/manifest.json" 


         This "manifest.json" file should include:

         {
            "description": "DCGAN, human faces, 64x64",
            "model": "https://raw.githubusercontent.com/viztopia/ml5dcgan/master/model/model.json", // "https://github.com/viztopia/ml5dcgan/blob/master/model/model.json",
            "modelSize": 64,
            "modelLatentDim": 128 
         }
         `);typeof M=="function"?O=M:we()(M)==="object"&&(L=M,O=T);var J=new rg($,L,O);return O?J:J.ready},Bh=r(30),Xo=r.n(Bh),jh=r(132),bf=0,zh=function(){function $(M,T){oe()(this,$),this.ready=Ge(this.loadModel(M),T)}return _e()($,[{key:"loadModel",value:function(){var M=q()(me.a.mark(function T(O){var L,J,ie,ge;return me.a.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:if(L={model:null,metadata:null},O.toLowerCase()!=="moviereviews"){Ae.next=6;break}L.model="https://storage.googleapis.com/tfjs-models/tfjs/sentiment_cnn_v1/model.json",L.metadata="https://storage.googleapis.com/tfjs-models/tfjs/sentiment_cnn_v1/metadata.json",Ae.next=14;break;case 6:if(dc.isAbsoluteURL(O)!==!0){Ae.next=12;break}J=dc.getModelPath(O),L.model="".concat(J,"/model.json"),L.metadata="".concat(J,"/metadata.json"),Ae.next=14;break;case 12:return console.error("problem loading model"),Ae.abrupt("return",this);case 14:return Ae.next=16,I.loadLayersModel(L.model);case 16:return this.model=Ae.sent,Ae.next=19,Bt.a.get(L.metadata);case 19:return ie=Ae.sent,ge=ie.data,this.indexFrom=ge.index_from,this.maxLen=ge.max_len,this.wordIndex=ge.word_index,this.vocabularySize=ge.vocabulary_size,Ae.abrupt("return",this);case 26:case"end":return Ae.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"predict",value:function(M){var T=this,O=function(ge,Ae){var Ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"pre",De=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"pre",et=arguments.length>4&&arguments[4]!==void 0?arguments[4]:bf;return ge.map(function(ot){if(ot.length>Ae&&(De==="pre"?ot.splice(0,ot.length-Ae):ot.splice(Ae,ot.length-Ae)),ot.length<Ae){for(var zt=[],Ht=0;Ht<Ae-ot.length;Ht+=1)zt.push(et);ot=Ie==="pre"?zt.concat(ot):ot.concat(zt)}return ot})}([M.trim().toLowerCase().replace(/[.,?!]/g,"").split(" ").map(function(ge){var Ae=T.wordIndex[ge]+T.indexFrom;return Ae>T.vocabularySize&&(Ae=2),Ae})],this.maxLen),L=I.tensor2d(O,[1,this.maxLen]),J=this.model.predict(L),ie=J.dataSync()[0];return J.dispose(),L.dispose(),{score:ie}}}]),$}(),xf=function($,M){return new zh($,M)};function Fl($,M,T,O){return new(T||(T=Promise))(function(L,J){function ie(Ie){try{Ae(O.next(Ie))}catch(De){J(De)}}function ge(Ie){try{Ae(O.throw(Ie))}catch(De){J(De)}}function Ae(Ie){Ie.done?L(Ie.value):new T(function(De){De(Ie.value)}).then(ie,ge)}Ae((O=O.apply($,M||[])).next())})}function il($,M){var T,O,L,J,ie={label:0,sent:function(){if(1&L[0])throw L[1];return L[1]},trys:[],ops:[]};return J={next:ge(0),throw:ge(1),return:ge(2)},typeof Symbol=="function"&&(J[Symbol.iterator]=function(){return this}),J;function ge(Ae){return function(Ie){return function(De){if(T)throw new TypeError("Generator is already executing.");for(;ie;)try{if(T=1,O&&(L=2&De[0]?O.return:De[0]?O.throw||((L=O.return)&&L.call(O),0):O.next)&&!(L=L.call(O,De[1])).done)return L;switch(O=0,L&&(De=[2&De[0],L.value]),De[0]){case 0:case 1:L=De;break;case 4:return ie.label++,{value:De[1],done:!1};case 5:ie.label++,O=De[1],De=[0];continue;case 7:De=ie.ops.pop(),ie.trys.pop();continue;default:if(!(L=(L=ie.trys).length>0&&L[L.length-1])&&(De[0]===6||De[0]===2)){ie=0;continue}if(De[0]===3&&(!L||De[1]>L[0]&&De[1]<L[3])){ie.label=De[1];break}if(De[0]===6&&ie.label<L[1]){ie.label=L[1],L=De;break}if(L&&ie.label<L[2]){ie.label=L[2],ie.ops.push(De);break}L[2]&&ie.ops.pop(),ie.trys.pop();continue}De=M.call($,ie)}catch(et){De=[6,et],O=0}finally{T=L=0}if(5&De[0])throw De[1];return{value:De[0]?De[1]:void 0,done:!0}}([Ae,Ie])}}}var Uh=[["conv2d",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1]],Ed=[8,16,32];function wf($){ze.util.assert(typeof $=="number",function(){return"outputStride is not a number"}),ze.util.assert(Ed.indexOf($)>=0,function(){return"outputStride of "+$+" is invalid. It must be either 8, 16, or 32"})}var ol={100:[["conv2d",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",2],["separableConv",1]],75:[["conv2d",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1]],50:Uh,25:Uh},Zg=function(){function $(M,T){this.PREPROCESS_DIVISOR=Object(ze.scalar)(127.5),this.ONE=Object(ze.scalar)(1),this.modelWeights=M,this.convolutionDefinitions=T}return $.prototype.predict=function(M,T){var O=this,L=Object(ze.div)(M.toFloat(),this.PREPROCESS_DIVISOR),J=Object(ze.sub)(L,this.ONE);return function(ie,ge){var Ae=1,Ie=1;return ie.map(function(De,et){var ot,zt,Ht=De[0],xn=De[1];return Ae===ge?(ot=1,zt=Ie,Ie*=xn):(ot=xn,zt=1,Ae*=xn),{blockId:et,convType:Ht,stride:ot,rate:zt,outputStride:Ae}})}(this.convolutionDefinitions,T).reduce(function(ie,ge){var Ae=ge.blockId,Ie=ge.stride,De=ge.convType,et=ge.rate;if(De==="conv2d")return O.conv(ie,Ie,Ae);if(De==="separableConv")return O.separableConv(ie,Ie,Ae,et);throw Error("Unknown conv type of "+De)},J)},$.prototype.convToOutput=function(M,T){return M.conv2d(this.weights(T),1,"same").add(this.convBias(T,!1))},$.prototype.conv=function(M,T,O){var L=this.weights("Conv2d_"+String(O));return M.conv2d(L,T,"same").add(this.convBias("Conv2d_"+String(O))).clipByValue(0,6)},$.prototype.separableConv=function(M,T,O,L){L===void 0&&(L=1);var J="Conv2d_"+String(O)+"_depthwise",ie="Conv2d_"+String(O)+"_pointwise";return M.depthwiseConv2D(this.depthwiseWeights(J),T,"same","NHWC",L).add(this.depthwiseBias(J)).clipByValue(0,6).conv2d(this.weights(ie),[1,1],"same").add(this.convBias(ie)).clipByValue(0,6)},$.prototype.weights=function(M){return this.modelWeights.weights(M)},$.prototype.convBias=function(M,T){return T===void 0&&(T=!0),this.modelWeights.convBias(M,T)},$.prototype.depthwiseBias=function(M){return this.modelWeights.depthwiseBias(M)},$.prototype.depthwiseWeights=function(M){return this.modelWeights.depthwiseWeights(M)},$.prototype.dispose=function(){this.modelWeights.dispose()},$}(),_f="https://storage.googleapis.com/tfjs-models/savedmodel/",ha={1:{url:_f+"posenet_mobilenet_100_partmap/",architecture:ol[100]},.75:{url:_f+"posenet_mobilenet_075_partmap/",architecture:ol[75]},.5:{url:_f+"posenet_mobilenet_050_partmap/",architecture:ol[50]},.25:{url:_f+"posenet_mobilenet_025_partmap/",architecture:ol[25]}};function za($,M){return Object(ze.tidy)(function(){return $.greater(Object(ze.scalar)(M)).toInt()})}function Ga($,M){var T=M.shape,O=T[0],L=T[1],J=T[2];return Object(ze.tidy)(function(){var ie=function(Ae){var Ie=Ae.shape[2],De=Ae.argMax(2).reshape([-1]);return Object(ze.oneHot)(De,Ie)}(M),ge=Object(ze.range)(0,J,1,"int32").expandDims(1);return function(Ae,Ie){return Ae.mul(Ie)}(ie.matMul(ge).toInt().reshape([O,L]).add(Object(ze.scalar)(1,"int32")),$).sub(Object(ze.scalar)(1,"int32"))})}var Xi=function(){function $(M){this.graphModel=M}return $.prototype.weights=function(M){return this.getVariable("MobilenetV1/"+M+"/weights")},$.prototype.convBias=function(M,T){return this.getVariable("MobilenetV1/"+M+"/Conv2D_bias")},$.prototype.depthwiseBias=function(M){return this.getVariable("MobilenetV1/"+M+"/depthwise_bias")},$.prototype.depthwiseWeights=function(M){return this.getVariable("MobilenetV1/"+M+"/depthwise_weights")},$.prototype.getVariable=function(M){return this.graphModel.weights[""+M][0]},$.prototype.dispose=function(){this.graphModel.dispose()},$}();function Ls($){return $ instanceof ze.Tensor?$:ze.browser.fromPixels($)}function al($,M,T){var O=M[0],L=M[1];T===void 0&&(T=!1);var J,ie,ge,Ae,Ie,De,et=$.shape,ot=et[0],zt=et[1]/ot;if(zt>L/O){J=L;var Ht=O-(ie=Math.ceil(J/zt));ge=0,Ae=0,Ie=Math.floor(Ht/2),De=O-(ie+Ie)}else{ie=O;var xn=L-(J=Math.ceil(O*zt));ge=Math.floor(xn/2),Ae=L-(J+ge),Ie=0,De=0}return{resizedAndPadded:Object(ze.tidy)(function(){var En;return En=T?$.reverse(1).resizeBilinear([ie,J]):$.resizeBilinear([ie,J]),Object(ze.pad3d)(En,[[Ie,De],[ge,Ae],[0,0]])}),paddedBy:[[Ie,De],[ge,Ae]]}}function qa($,M,T,O){var L=M[0],J=M[1],ie=T[0],ge=T[1],Ae=O[0],Ie=Ae[0],De=Ae[1],et=O[1],ot=et[0],zt=et[1];return Object(ze.tidy)(function(){return function(Ht,xn,En){var Fn=xn[0],Rn=xn[1],Wn=En[0],Jn=Wn[0],Tn=Wn[1],_r=En[1],Nr=_r[0],Ir=_r[1],Qr=Ht.shape,zr=Qr[0],ki=Qr[1],Pi=zr-(Jn+Tn),Fi=ki-(Nr+Ir);return Object(ze.tidy)(function(){return Object(ze.slice3d)(Ht,[Jn,Nr,0],[Pi,Fi,Ht.shape[2]]).resizeBilinear([Fn,Rn],!0)})}($.resizeBilinear([ie,ge],!0),[L,J],[[Ie,De],[ot,zt]])})}var sl=[353,257],mc=function(){function $(M){this.mobileNet=M}return $.prototype.predictForSegmentation=function(M,T){var O=this;return T===void 0&&(T=16),wf(T),Object(ze.tidy)(function(){var L=O.mobileNet.predict(M,T);return O.mobileNet.convToOutput(L,"segment_2").sigmoid()})},$.prototype.predictForPartMap=function(M,T){var O=this;return T===void 0&&(T=16),wf(T),Object(ze.tidy)(function(){var L=O.mobileNet.predict(M,T),J=O.mobileNet.convToOutput(L,"segment_2"),ie=O.mobileNet.convToOutput(L,"part_heatmap_2");return{segmentScores:J.sigmoid(),partHeatmapScores:ie.sigmoid()}})},$.prototype.estimatePersonSegmentationActivation=function(M,T,O){var L=this;return T===void 0&&(T=16),O===void 0&&(O=.5),wf(T),Object(ze.tidy)(function(){var J=Ls(M),ie=al(J,sl),ge=ie.resizedAndPadded,Ae=ie.paddedBy,Ie=L.predictForSegmentation(ge,T),De=ge.shape,et=De[0],ot=De[1],zt=J.shape;return za(qa(Ie,[zt[0],zt[1]],[et,ot],Ae).squeeze(),O)})},$.prototype.estimatePersonSegmentation=function(M,T,O){return T===void 0&&(T=16),O===void 0&&(O=.5),Fl(this,void 0,void 0,function(){var L,J,ie,ge,Ae;return il(this,function(Ie){switch(Ie.label){case 0:return L=this.estimatePersonSegmentationActivation(M,T,O),J=L.shape,ie=J[0],ge=J[1],[4,L.data()];case 1:return Ae=Ie.sent(),L.dispose(),[2,{height:ie,width:ge,data:Ae}]}})})},$.prototype.estimatePartSegmentationActivation=function(M,T,O){var L=this;return T===void 0&&(T=16),O===void 0&&(O=.5),wf(T),Object(ze.tidy)(function(){var J=Ls(M),ie=al(J,sl),ge=ie.resizedAndPadded,Ae=ie.paddedBy,Ie=L.predictForPartMap(ge,T),De=Ie.segmentScores,et=Ie.partHeatmapScores,ot=ge.shape,zt=ot[0],Ht=ot[1],xn=J.shape,En=xn[0],Fn=xn[1],Rn=qa(De,[En,Fn],[zt,Ht],Ae),Wn=qa(et,[En,Fn],[zt,Ht],Ae);return Ga(za(Rn.squeeze(),O),Wn)})},$.prototype.estimatePartSegmentation=function(M,T,O){return T===void 0&&(T=16),O===void 0&&(O=.5),Fl(this,void 0,void 0,function(){var L,J,ie,ge,Ae;return il(this,function(Ie){switch(Ie.label){case 0:return L=this.estimatePartSegmentationActivation(M,T,O),J=L.shape,ie=J[0],ge=J[1],[4,L.data()];case 1:return Ae=Ie.sent(),L.dispose(),[2,{height:ie,width:ge,data:Ae}]}})})},$.prototype.dispose=function(){this.mobileNet.dispose()},$}();function Sd($){return $===void 0&&($=.75),Fl(this,void 0,void 0,function(){var M,T;return il(this,function(O){switch(O.label){case 0:if(ze==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");return M=Object.keys(ha),ze.util.assert(typeof $=="number",function(){return"got multiplier type of "+typeof $+" when it should be a number."}),ze.util.assert(M.indexOf($.toString())>=0,function(){return"invalid multiplier value of "+$+".  No checkpoint exists for that multiplier. Must be one of "+M.join(",")+"."}),[4,Cd.load($)];case 1:return T=O.sent(),[2,new mc(T)]}})})}var Cd={load:function($){return Fl(void 0,void 0,void 0,function(){var M,T,O,L;return il(this,function(J){switch(J.label){case 0:return M=ha[$],T=M.url,[4,Object(Ot.loadGraphModel)(T+"model.json")];case 1:return O=J.sent(),L=new Xi(O),[2,new Zg(L,M.architecture)]}})})}};function Rl($,M){M===void 0&&(M=!0);for(var T=$.width,O=$.height,L=$.data,J=new Uint8ClampedArray(T*O*4),ie=0;ie<O*T;++ie){var ge=255*(M?1-L[ie]:L[ie]),Ae=4*ie;J[Ae+0]=0,J[Ae+1]=0,J[Ae+2]=0,J[Ae+3]=Math.round(ge)}return new ImageData(J,T,O)}function tm($,M){for(var T=$.width,O=$.height,L=$.data,J=new Uint8ClampedArray(T*O*4),ie=0;ie<O*T;++ie){var ge=Math.round(L[ie]),Ae=4*ie;if(ge===-1)J[Ae+0]=255,J[Ae+1]=255,J[Ae+2]=255,J[Ae+3]=255;else{var Ie=M[ge];if(!Ie)throw new Error("No color could be found for part id "+ge);J[Ae+0]=Ie[0],J[Ae+1]=Ie[1],J[Ae+2]=Ie[2],J[Ae+3]=255}}return new ImageData(J,T,O)}var gc={multiplier:.75,outputStride:16,segmentationThreshold:.5,palette:{leftFace:{id:0,color:[110,64,170]},rightFace:{id:1,color:[106,72,183]},rightUpperLegFront:{id:2,color:[100,81,196]},rightLowerLegBack:{id:3,color:[92,91,206]},rightUpperLegBack:{id:4,color:[84,101,214]},leftLowerLegFront:{id:5,color:[75,113,221]},leftUpperLegFront:{id:6,color:[66,125,224]},leftUpperLegBack:{id:7,color:[56,138,226]},leftLowerLegBack:{id:8,color:[48,150,224]},rightFeet:{id:9,color:[40,163,220]},rightLowerLegFront:{id:10,color:[33,176,214]},leftFeet:{id:11,color:[29,188,205]},torsoFront:{id:12,color:[26,199,194]},torsoBack:{id:13,color:[26,210,182]},rightUpperArmFront:{id:14,color:[28,219,169]},rightUpperArmBack:{id:15,color:[33,227,155]},rightLowerArmBack:{id:16,color:[41,234,141]},leftLowerArmFront:{id:17,color:[51,240,128]},leftUpperArmFront:{id:18,color:[64,243,116]},leftUpperArmBack:{id:19,color:[79,246,105]},leftLowerArmBack:{id:20,color:[96,247,97]},rightHand:{id:21,color:[115,246,91]},rightLowerArmFront:{id:22,color:[134,245,88]},leftHand:{id:23,color:[155,243,88]}},returnTensors:!1},e0=function(){function $(M,T,O){oe()(this,$),this.video=M,this.model=null,this.modelReady=!1,this.modelPath="",this.config={multiplier:T.multiplier||gc.multiplier,outputStride:T.outputStride||gc.outputStride,segmentationThreshold:T.segmentationThreshold||gc.segmentationThreshold,palette:T.palette||gc.palette,returnTensors:T.returnTensors||gc.returnTensors},this.ready=Ge(this.loadModel(),O)}return _e()($,[{key:"loadModel",value:function(){var M=q()(me.a.mark(function T(){return me.a.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,Sd(this.config.multiplier);case 2:return this.model=O.sent,this.modelReady=!0,O.abrupt("return",this);case 5:case"end":return O.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"p5Color2RGB",value:function(M){var T=/\(([^)]+)\)/.exec(M.toString("rgb"))[1].split(","),O=Pn()(T,3);return[O[0],O[1],O[2]]}},{key:"convertToP5Image",value:function(){var M=q()(me.a.mark(function T(O,L,J){var ie,ge;return me.a.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:return Ae.next=2,Gt.rawToBlob(O,L,J);case 2:return ie=Ae.sent,Ae.next=5,Gt.blobToP5Image(ie);case 5:return ge=Ae.sent,Ae.abrupt("return",ge);case 7:case"end":return Ae.stop()}},T)}));return function(T,O,L){return M.apply(this,arguments)}}()},{key:"bodyPartsSpec",value:function(M){var T=this,O=M!==void 0||Object.keys(M).length>=24?M:this.config.palette,L=Gt.p5Instance;return L&&O!==void 0&&Object.keys(O).length>=24&&Object.keys(O).forEach(function(J){O[J].color instanceof L.Color&&(O[J].color=T.p5Color2RGB(O[J].color))}),O}},{key:"segmentWithPartsInternal",value:function(){var M=q()(me.a.mark(function T(O,L){var J,ie,ge,Ae,Ie,De,et,ot,zt,Ht,xn,En=this;return me.a.wrap(function(Fn){for(;;)switch(Fn.prev=Fn.next){case 0:return Fn.next=2,this.ready;case 2:return Fn.next=4,I.nextFrame();case 4:if(!this.video||this.video.readyState!==0){Fn.next=7;break}return Fn.next=7,new Promise(function(Rn){En.video.onloadeddata=function(){return Rn()}});case 7:return this.config.palette=L.palette||this.config.palette,this.config.outputStride=L.outputStride||this.config.outputStride,this.config.segmentationThreshold=L.segmentationThreshold||this.config.segmentationThreshold,Fn.next=12,this.model.estimatePartSegmentation(O,this.config.outputStride,this.config.segmentationThreshold);case 12:return J=Fn.sent,ie=this.bodyPartsSpec(this.config.palette),ge=Object.keys(ie).map(function(Rn){return ie[Rn].color}),(Ae={segmentation:J,raw:{personMask:null,backgroundMask:null,partMask:null},tensor:{personMask:null,backgroundMask:null,partMask:null},personMask:null,backgroundMask:null,partMask:null,bodyParts:ie}).raw.backgroundMask=Rl(J,!0),Ae.raw.personMask=Rl(J,!1),Ae.raw.partMask=tm(J,ge),Ie=I.tidy(function(){var Rn=I.browser.fromPixels(O),Wn=I.ones([J.height,J.width,1]).tile([1,1,1]).mul(255);Rn=Rn.concat(Wn,2);var Jn=I.tensor(J.data,[J.height,J.width,1]),Tn=I.tensor(J.data,[J.height,J.width,1]),_r=I.tensor(Xo()(Ae.raw.partMask.data),[J.height,J.width,4]);return{personMask:Jn=I.cast(Jn.add(.2).sign().relu().mul(Rn),"int32"),backgroundMask:Tn=I.cast(Tn.add(.2).sign().neg().relu().mul(Rn),"int32"),partMask:_r=I.cast(_r,"int32")}}),De=Ie.personMask,et=Ie.backgroundMask,ot=Ie.partMask,Fn.next=22,I.browser.toPixels(De);case 22:return zt=Fn.sent,Fn.next=25,I.browser.toPixels(et);case 25:return Ht=Fn.sent,Fn.next=28,I.browser.toPixels(ot);case 28:if(xn=Fn.sent,Ae.personMask=zt,Ae.backgroundMask=Ht,Ae.partMask=xn,!Gt.checkP5()){Fn.next=42;break}return Fn.next=35,this.convertToP5Image(zt,J.width,J.height);case 35:return Ae.personMask=Fn.sent,Fn.next=38,this.convertToP5Image(Ht,J.width,J.height);case 38:return Ae.backgroundMask=Fn.sent,Fn.next=41,this.convertToP5Image(xn,J.width,J.height);case 41:Ae.partMask=Fn.sent;case 42:return this.config.returnTensors?(Ae.tensor.personMask=De,Ae.tensor.backgroundMask=et,Ae.tensor.partMask=ot):(De.dispose(),et.dispose(),ot.dispose()),Fn.abrupt("return",Ae);case 44:case"end":return Fn.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()},{key:"segmentWithParts",value:function(){var M=q()(me.a.mark(function T(O,L,J){var ie,ge,Ae;return me.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:if(ie=this.video,Ae=this.config,typeof O!="function"){Ie.next=7;break}ie=this.video,ge=O,Ie.next=25;break;case 7:if(!(O instanceof HTMLImageElement||O instanceof HTMLCanvasElement||O instanceof HTMLVideoElement||O instanceof ImageData)){Ie.next=11;break}ie=O,Ie.next=25;break;case 11:if(we()(O)!=="object"||!(O.elt instanceof HTMLImageElement||O.elt instanceof HTMLCanvasElement||O.elt instanceof ImageData)){Ie.next=15;break}ie=O.elt,Ie.next=25;break;case 15:if(!(we()(O)==="object"&&O.canvas instanceof HTMLCanvasElement)){Ie.next=19;break}ie=O.canvas,Ie.next=25;break;case 19:if(!(we()(O)==="object"&&O.elt instanceof HTMLVideoElement)){Ie.next=23;break}ie=O.elt,Ie.next=25;break;case 23:if(this.video instanceof HTMLVideoElement){Ie.next=25;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 25:return we()(L)==="object"?Ae=L:typeof L=="function"&&(ge=L),typeof J=="function"&&(ge=J),Ie.abrupt("return",Ge(this.segmentWithPartsInternal(ie,Ae),ge));case 28:case"end":return Ie.stop()}},T,this)}));return function(T,O,L){return M.apply(this,arguments)}}()},{key:"segmentInternal",value:function(){var M=q()(me.a.mark(function T(O,L){var J,ie,ge,Ae,Ie,De,et,ot=this;return me.a.wrap(function(zt){for(;;)switch(zt.prev=zt.next){case 0:return zt.next=2,this.ready;case 2:return zt.next=4,I.nextFrame();case 4:if(!this.video||this.video.readyState!==0){zt.next=7;break}return zt.next=7,new Promise(function(Ht){ot.video.onloadeddata=function(){return Ht()}});case 7:return this.config.outputStride=L.outputStride||this.config.outputStride,this.config.segmentationThreshold=L.segmentationThreshold||this.config.segmentationThreshold,zt.next=11,this.model.estimatePersonSegmentation(O,this.config.outputStride,this.config.segmentationThreshold);case 11:return J=zt.sent,(ie={segmentation:J,raw:{personMask:null,backgroundMask:null},tensor:{personMask:null,backgroundMask:null},personMask:null,backgroundMask:null}).raw.backgroundMask=Rl(J,!0),ie.raw.personMask=Rl(J,!1),ge=I.tidy(function(){var Ht=I.browser.fromPixels(O),xn=I.ones([J.height,J.width,1]).tile([1,1,1]).mul(255);Ht=Ht.concat(xn,2);var En=I.tensor(J.data,[J.height,J.width,1]),Fn=I.tensor(J.data,[J.height,J.width,1]);return{personMask:En=I.cast(En.neg().add(1).mul(Ht),"int32"),backgroundMask:Fn=I.cast(Fn.mul(Ht),"int32")}}),Ae=ge.personMask,Ie=ge.backgroundMask,zt.next=18,I.browser.toPixels(Ae);case 18:return De=zt.sent,zt.next=21,I.browser.toPixels(Ie);case 21:if(et=zt.sent,!Gt.checkP5()){zt.next=31;break}return zt.next=25,this.convertToP5Image(De,J.width,J.height);case 25:return ie.personMask=zt.sent,zt.next=28,this.convertToP5Image(et,J.width,J.height);case 28:ie.backgroundMask=zt.sent,zt.next=33;break;case 31:ie.personMask=De,ie.backgroundMask=et;case 33:return this.config.returnTensors?(ie.tensor.personMask=Ae,ie.tensor.backgroundMask=Ie):(Ae.dispose(),Ie.dispose()),zt.abrupt("return",ie);case 35:case"end":return zt.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()},{key:"segment",value:function(){var M=q()(me.a.mark(function T(O,L,J){var ie,ge,Ae;return me.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:if(ie=this.video,Ae=this.config,typeof O!="function"){Ie.next=7;break}ie=this.video,ge=O,Ie.next=25;break;case 7:if(!(O instanceof HTMLImageElement||O instanceof HTMLCanvasElement||O instanceof HTMLVideoElement||O instanceof ImageData)){Ie.next=11;break}ie=O,Ie.next=25;break;case 11:if(we()(O)!=="object"||!(O.elt instanceof HTMLImageElement||O.elt instanceof HTMLCanvasElement||O.elt instanceof ImageData)){Ie.next=15;break}ie=O.elt,Ie.next=25;break;case 15:if(!(we()(O)==="object"&&O.canvas instanceof HTMLCanvasElement)){Ie.next=19;break}ie=O.canvas,Ie.next=25;break;case 19:if(!(we()(O)==="object"&&O.elt instanceof HTMLVideoElement)){Ie.next=23;break}ie=O.elt,Ie.next=25;break;case 23:if(this.video instanceof HTMLVideoElement){Ie.next=25;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 25:return we()(L)==="object"?Ae=L:typeof L=="function"&&(ge=L),typeof J=="function"&&(ge=J),Ie.abrupt("return",Ge(this.segmentInternal(ie,Ae),ge));case 28:case"end":return Ie.stop()}},T,this)}));return function(T,O,L){return M.apply(this,arguments)}}()}]),$}(),nm=function($,M,T){var O,L={},J=T;$ instanceof HTMLVideoElement?O=$:we()($)==="object"&&$.elt instanceof HTMLVideoElement?O=$.elt:we()($)==="object"?L=$:typeof $=="function"&&(J=$),we()(M)==="object"?L=M:typeof M=="function"&&(J=M);var ie=new e0(O,L,J);return J?ie:ie.ready},Ef=function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return Math.random()*(M-$)+$},ig=function(){var $,M,T,O,L,J,ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,ge=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(J)$=M,J=!1;else{do L=(T=Ef(0,2)-1)*T+(O=Ef(0,2)-1)*O;while(L>=1);$=T*(L=Math.sqrt(-2*Math.log(L)/L)),M=O*L,J=!0}return $*ge+ie},kd=function($,M){var T;if((arguments.length>2&&arguments[2]!==void 0&&arguments[2])===!0)T=Array.from({length:M},function(){return $[Math.floor(Math.random()*$.length)]});else{if(M>$.length)throw new RangeError("Sample size must be less than or equal to array length when sampling without replacement.");T=$.map(function(O){return[O,Math.random()]}).sort(function(O,L){return O[1]<L[1]?-1:1}).slice(0,M).map(function(O){return O[0]})}return T},Pl=function(){function $(){oe()(this,$),this.isTrained=!1,this.isCompiled=!1,this.isLayered=!1,this.model=null,this.init=this.init.bind(this),this.createModel=this.createModel.bind(this),this.addLayer=this.addLayer.bind(this),this.compile=this.compile.bind(this),this.setOptimizerFunction=this.setOptimizerFunction.bind(this),this.train=this.train.bind(this),this.trainInternal=this.trainInternal.bind(this),this.predict=this.predict.bind(this),this.classify=this.classify.bind(this),this.save=this.save.bind(this),this.load=this.load.bind(this),this.init()}return _e()($,[{key:"init",value:function(){this.createModel()}},{key:"createModel",value:function(){switch((arguments.length>0&&arguments[0]!==void 0?arguments[0]:"sequential").toLowerCase()){case"sequential":default:return this.model=I.sequential(),this.model}}},{key:"addLayer",value:function(M){var T=M||{};this.model.add(T),this.model.layers.length>=2&&(this.isLayered=!0)}},{key:"compile",value:function(M){this.model.compile(M),this.isCompiled=!0}},{key:"setOptimizerFunction",value:function(M,T){return T.call(this,M)}},{key:"train",value:function(M,T){return Ge(this.trainInternal(M),T)}},{key:"trainInternal",value:function(){var M=q()(me.a.mark(function T(O){var L,J,ie,ge,Ae,Ie,De,et;return me.a.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:return J=(L=O).inputs,ie=L.outputs,ge=L.batchSize,Ae=L.epochs,Ie=L.shuffle,De=L.validationSplit,et=L.whileTraining,ot.next=6,this.model.fit(J,ie,{batchSize:ge,epochs:Ae,shuffle:Ie,validationSplit:De,callbacks:et});case 6:J.dispose(),ie.dispose(),this.isTrained=!0;case 9:case"end":return ot.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"predictSync",value:function(M){var T=this,O=I.tidy(function(){return T.model.predict(M)}),L=O.arraySync();return O.dispose(),M.dispose(),L}},{key:"predict",value:function(){var M=q()(me.a.mark(function T(O){var L,J,ie=this;return me.a.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return L=I.tidy(function(){return ie.model.predict(O)}),ge.next=3,L.array();case 3:return J=ge.sent,L.dispose(),O.dispose(),ge.abrupt("return",J);case 7:case"end":return ge.stop()}},T)}));return function(T){return M.apply(this,arguments)}}()},{key:"classify",value:function(){var M=q()(me.a.mark(function T(O){return me.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.abrupt("return",this.predict(O));case 1:case"end":return L.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"classifySync",value:function(M){return this.predictSync(M)}},{key:"save",value:function(){var M=q()(me.a.mark(function T(O,L){var J,ie,ge=this;return me.a.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:typeof O=="function"?(J="model",ie=O):typeof O=="string"?(J=O,typeof L=="function"&&(ie=L)):J="model",this.model.save(I.io.withSaveHandler(function(){var Ie=q()(me.a.mark(function De(et){return me.a.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:return ge.weightsManifest={modelTopology:et.modelTopology,weightsManifest:[{paths:["./".concat(J,".weights.bin")],weights:et.weightSpecs}]},ot.next=3,Jr(et.weightData,"".concat(J,".weights.bin"),"application/octet-stream");case 3:return ot.next=5,Jr(JSON.stringify(ge.weightsManifest),"".concat(J,".json"),"text/plain");case 5:ie&&ie();case 6:case"end":return ot.stop()}},De)}));return function(De){return Ie.apply(this,arguments)}}()));case 2:case"end":return Ae.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()},{key:"load",value:function(){var M=q()(me.a.mark(function T(){var O,L,J,ie,ge,Ae,Ie,De,et,ot,zt,Ht=arguments;return me.a.wrap(function(xn){for(;;)switch(xn.prev=xn.next){case 0:if(O=Ht.length>0&&Ht[0]!==void 0?Ht[0]:null,L=Ht.length>1?Ht[1]:void 0,!(O instanceof FileList)){xn.next=13;break}return xn.next=5,Promise.all(Array.from(O).map(function(){var En=q()(me.a.mark(function Fn(Rn){var Wn;return me.a.wrap(function(Jn){for(;;)switch(Jn.prev=Jn.next){case 0:if(!Rn.name.includes(".json")||Rn.name.includes("_meta")){Jn.next=4;break}return Jn.abrupt("return",{name:"model",file:Rn});case 4:if(!Rn.name.includes(".json")||!Rn.name.includes("_meta.json")){Jn.next=11;break}return Jn.next=7,Rn.text();case 7:return Wn=Jn.sent,Jn.abrupt("return",{name:"metadata",file:Wn});case 11:if(!Rn.name.includes(".bin")){Jn.next=13;break}return Jn.abrupt("return",{name:"weights",file:Rn});case 13:return Jn.abrupt("return",{name:null,file:null});case 14:case"end":return Jn.stop()}},Fn)}));return function(Fn){return En.apply(this,arguments)}}()));case 5:return J=xn.sent,ie=J.find(function(En){return En.name==="model"}).file,ge=J.find(function(En){return En.name==="weights"}).file,xn.next=10,I.loadLayersModel(I.io.browserFiles([ie,ge]));case 10:this.model=xn.sent,xn.next=32;break;case 13:if(!(O instanceof Object)){xn.next=29;break}return xn.next=16,Bt.a.get(O.model,{responseType:"text"});case 16:return Ae=xn.sent,Ie=JSON.stringify(Ae.data),De=new File([Ie],"model.json",{type:"application/json"}),xn.next=21,Bt.a.get(O.weights,{responseType:"blob"});case 21:return et=xn.sent,ot=et.data,zt=new File([ot],"model.weights.bin",{type:"application/macbinary"}),xn.next=26,I.loadLayersModel(I.io.browserFiles([De,zt]));case 26:this.model=xn.sent,xn.next=32;break;case 29:return xn.next=31,I.loadLayersModel(O);case 31:this.model=xn.sent;case 32:return this.isCompiled=!0,this.isLayered=!0,this.isTrained=!0,L&&L(),xn.abrupt("return",this.model);case 37:case"end":return xn.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"dispose",value:function(){this.model.dispose()}},{key:"mutate",value:function(){var M=this,T=arguments.length>0&&arguments[0]!==void 0?arguments[0]:.1,O=arguments.length>1?arguments[1]:void 0;I.tidy(function(){for(var L=M.model.getWeights(),J=[],ie=0;ie<L.length;ie+=1){for(var ge=L[ie],Ae=L[ie].shape,Ie=ge.dataSync().slice(),De=0;De<Ie.length;De+=1)Math.random()<T&&(Ie[De]=O?O(Ie[De]):Math.min(Math.max(Ie[De]+ig(),-1),1));var et=I.tensor(Ie,Ae);J[ie]=et}M.model.setWeights(J)})}},{key:"crossover",value:function(M){var T=this;return I.tidy(function(){for(var O=T.model.getWeights(),L=M.model.getWeights(),J=[],ie=0;ie<O.length;ie+=1){for(var ge=O[ie],Ae=L[ie],Ie=O[ie].shape,De=ge.dataSync().slice(),et=Ae.dataSync().slice(),ot=0;ot<De.length;ot+=1)Math.random()<.5&&(De[ot]=et[ot]);var zt=I.tensor(De,Ie);J[ie]=zt}T.model.setWeights(J)})}}]),$}();function rm($,M){var T=Object.keys($);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols($);M&&(O=O.filter(function(L){return Object.getOwnPropertyDescriptor($,L).enumerable})),T.push.apply(T,O)}return T}function Wh($){for(var M=1;M<arguments.length;M++){var T=arguments[M]!=null?arguments[M]:{};M%2?rm(Object(T),!0).forEach(function(O){H()($,O,T[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(T)):rm(Object(T)).forEach(function(O){Object.defineProperty($,O,Object.getOwnPropertyDescriptor(T,O))})}return $}var Da=new(function(){function $(M){oe()(this,$),this.options=M||{}}return _e()($,[{key:"normalizeValue",value:function(M,T,O){return(M-T)/(O-T)}},{key:"unnormalizeValue",value:function(M,T,O){return M*(O-T)+T}},{key:"getMin",value:function(M){return M.reduce(function(T,O){return Math.min(T,O)})}},{key:"getMax",value:function(M){return M.reduce(function(T,O){return Math.max(T,O)})}},{key:"isJsonOrString",value:function(M){try{JSON.parse(M)}catch{return!1}return!0}},{key:"zipArrays",value:function(M,T){return M.length!==T.length?(console.error("arrays do not have the same length"),[]):Xo()(new Array(M.length).fill(null)).map(function(O,L){return Wh(Wh({},M[L]),T[L])})}},{key:"createLabelsFromArrayValues",value:function(M,T){var O;return Array.isArray(M)&&(O=M.map(function(L,J){return"".concat(T,"_").concat(J)})),O}},{key:"formatDataAsObject",value:function(M,T){var O={};if(Array.isArray(M))return M.forEach(function(L,J){var ie=T[J];O[ie]=L}),O;if(we()(M)==="object")return O=M;throw new Error("input provided is not supported or does not match your output label specifications")}},{key:"getDataType",value:function(M){var T=we()(M);return T==="object"&&Array.isArray(M)&&(T="array"),T}}]),$}());function Sf($,M){var T=Object.keys($);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols($);M&&(O=O.filter(function(L){return Object.getOwnPropertyDescriptor($,L).enumerable})),T.push.apply(T,O)}return T}function Bs($){for(var M=1;M<arguments.length;M++){var T=arguments[M]!=null?arguments[M]:{};M%2?Sf(Object(T),!0).forEach(function(O){H()($,O,T[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(T)):Sf(Object(T)).forEach(function(O){Object.defineProperty($,O,Object.getOwnPropertyDescriptor(T,O))})}return $}var Cf=function(){function $(){oe()(this,$),this.meta={inputUnits:null,outputUnits:null,inputs:{},outputs:{},isNormalized:!1},this.isMetadataReady=!1,this.isWarmedUp=!1,this.data={raw:[]},this.createMetadata=this.createMetadata.bind(this),this.getDataStats=this.getDataStats.bind(this),this.getInputMetaStats=this.getInputMetaStats.bind(this),this.getDataUnits=this.getDataUnits.bind(this),this.getInputMetaUnits=this.getInputMetaUnits.bind(this),this.getDTypesFromData=this.getDTypesFromData.bind(this),this.addData=this.addData.bind(this),this.convertRawToTensors=this.convertRawToTensors.bind(this),this.normalizeDataRaw=this.normalizeDataRaw.bind(this),this.normalizeInputData=this.normalizeInputData.bind(this),this.normalizeArray=this.normalizeArray.bind(this),this.unnormalizeArray=this.unnormalizeArray.bind(this),this.applyOneHotEncodingsToDataRaw=this.applyOneHotEncodingsToDataRaw.bind(this),this.getDataOneHot=this.getDataOneHot.bind(this),this.getInputMetaOneHot=this.getInputMetaOneHot.bind(this),this.createOneHotEncodings=this.createOneHotEncodings.bind(this),this.loadDataFromUrl=this.loadDataFromUrl.bind(this),this.loadJSON=this.loadJSON.bind(this),this.loadCSV=this.loadCSV.bind(this),this.loadBlob=this.loadBlob.bind(this),this.loadData=this.loadData.bind(this),this.saveData=this.saveData.bind(this),this.saveMeta=this.saveMeta.bind(this),this.loadMeta=this.loadMeta.bind(this),this.findEntries=this.findEntries.bind(this),this.formatRawData=this.formatRawData.bind(this),this.csvToJSON=this.csvToJSON.bind(this)}return _e()($,[{key:"createMetadata",value:function(M){var T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return this.getDTypesFromData(M),this.getDataStats(M),this.getDataOneHot(M),this.getDataUnits(M,T),this.isMetadataReady=!0,Bs({},this.meta)}},{key:"getDataStats",value:function(M){var T=Object.assign({},this.meta),O=this.getInputMetaStats(M,T.inputs,"xs"),L=this.getInputMetaStats(M,T.outputs,"ys");return T.inputs=O,T.outputs=L,this.meta=Bs(Bs({},this.meta),T),T}},{key:"getInputMetaStats",value:function(M,T,O){var L=Object.assign({},T);return Object.keys(L).forEach(function(J){if(L[J].dtype==="string")L[J].min=0,L[J].max=1;else if(L[J].dtype==="number"){var ie=M.map(function(Ae){return Ae[O][J]});L[J].min=Da.getMin(ie),L[J].max=Da.getMax(ie)}else if(L[J].dtype==="array"){var ge=M.map(function(Ae){return Ae[O][J]}).flat();L[J].min=Da.getMin(ge),L[J].max=Da.getMax(ge)}}),L}},{key:"getDataUnits",value:function(M){var T,O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,L=O!==null?O:void 0,J=Object.assign({},this.meta);T=L||[this.getInputMetaUnits(M,J.inputs)].flat();var ie=this.getInputMetaUnits(M,J.outputs);return J.inputUnits=T,J.outputUnits=ie,this.meta=Bs(Bs({},this.meta),J),J}},{key:"getInputMetaUnits",value:function(M,T){var O=0,L=Object.assign({},T);return Object.entries(L).forEach(function(J){var ie=J[1].dtype;if(ie==="number")O+=1;else if(ie==="string"){var ge=J[1].uniqueValues.length;O+=ge}else ie==="array"&&(O=[])}),O}},{key:"getDTypesFromData",value:function(M){var T=Bs(Bs({},this.meta),{},{inputs:{},outputs:{}}),O=M[0],L=Object.keys(O.xs),J=Object.keys(O.ys);return L.forEach(function(ie){T.inputs[ie]={dtype:Da.getDataType(O.xs[ie])}}),J.forEach(function(ie){T.outputs[ie]={dtype:Da.getDataType(O.ys[ie])}}),this.meta=T,T}},{key:"addData",value:function(M,T){this.data.raw.push({xs:M,ys:T})}},{key:"convertRawToTensors",value:function(M){var T=Object.assign({},this.meta),O=M.length;return I.tidy(function(){var L=[],J=[];return M.forEach(function(ie){var ge=Object.keys(T.inputs).map(function(Ie){return ie.xs[Ie]}).flat();L.push(ge);var Ae=Object.keys(T.outputs).map(function(Ie){return ie.ys[Ie]}).flat();J.push(Ae)}),{inputs:I.tensor(L.flat(),[O].concat(Xo()(T.inputUnits))),outputs:I.tensor(J.flat(),[O,T.outputUnits])}})}},{key:"normalizeDataRaw",value:function(M){var T=Object.assign({},this.meta),O=this.normalizeInputData(M,T.inputs,"xs"),L=this.normalizeInputData(M,T.outputs,"ys");return Da.zipArrays(O,L)}},{key:"normalizeInputData",value:function(M,T,O){var L=this,J=M.length,ie=Object.assign({},T),ge={};return Object.keys(ie).forEach(function(Ae){var Ie={min:ie[Ae].min,max:ie[Ae].max},De=M.map(function(et){return et[O][Ae]});ie[Ae].dtype==="string"?(Ie.legend=ie[Ae].legend,ge[Ae]=L.normalizeArray(De,Ie)):ie[Ae].dtype==="number"?ge[Ae]=L.normalizeArray(De,Ie):ie[Ae].dtype==="array"&&(ge[Ae]=De.map(function(et){return L.normalizeArray(et,Ie)}))}),Xo()(new Array(J).fill(null)).map(function(Ae,Ie){var De=H()({},O,{});return Object.keys(ie).forEach(function(et){De[O][et]=ge[et][Ie]}),De})}},{key:"normalizeArray",value:function(M,T){var O=T.min,L=T.max;if(T.legend)return M.map(function(J){return T.legend[J]?T.legend[J]:J});if(M.every(function(J){return typeof J=="number"}))return M.map(function(J){return Da.normalizeValue(J,O,L)});throw new Error("error in inputArray of normalizeArray() function")}},{key:"unnormalizeArray",value:function(M,T){var O=T.min,L=T.max;if(T.legend)return M.map(function(J){var ie;return Object.entries(T.legend).forEach(function(ge){var Ae=ge[0],Ie=ge[1];J.map(function(De,et){return De===Ie[et]}).every(function(De){return De===!0})&&(ie=Ae)}),ie});if(M.every(function(J){return typeof J=="number"}))return M.map(function(J){return Da.unnormalizeValue(J,O,L)});throw new Error("error in inputArray of normalizeArray() function")}},{key:"applyOneHotEncodingsToDataRaw",value:function(M){var T=Object.assign({},this.meta);return M.map(function(O){var L=Bs({},O.xs),J=Bs({},O.ys);return Object.keys(T.inputs).forEach(function(ie){T.inputs[ie].legend&&(L[ie]=T.inputs[ie].legend[O.xs[ie]])}),Object.keys(T.outputs).forEach(function(ie){T.outputs[ie].legend&&(J[ie]=T.outputs[ie].legend[O.ys[ie]])}),{xs:L,ys:J}})}},{key:"getDataOneHot",value:function(M){var T=Object.assign({},this.meta),O=this.getInputMetaOneHot(M,T.inputs,"xs"),L=this.getInputMetaOneHot(M,T.outputs,"ys");return T.inputs=O,T.outputs=L,this.meta=Bs(Bs({},this.meta),T),T}},{key:"getInputMetaOneHot",value:function(M,T,O){var L=this,J=Object.assign({},T);return Object.entries(J).forEach(function(ie){var ge=ie[0];if(ie[1].dtype==="string"){var Ae=Xo()(new Set(M.map(function(De){return De[O][ge]}))),Ie=L.createOneHotEncodings(Ae);J[ge]=Bs(Bs({},J[ge]),Ie)}}),J}},{key:"createOneHotEncodings",value:function(M){return I.tidy(function(){var T={uniqueValues:M,legend:{}},O=M,L=O.map(function(ie,ge){return ge}),J=I.oneHot(I.tensor1d(L,"int32"),O.length).arraySync();return O.forEach(function(ie,ge){T.legend[ie]=J[ge]}),T})}},{key:"loadDataFromUrl",value:function(){var M=q()(me.a.mark(function T(O,L,J){var ie;return me.a.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:if(ge.prev=0,!O.endsWith(".csv")){ge.next=7;break}return ge.next=4,this.loadCSV(O,L,J);case 4:ie=ge.sent,ge.next=20;break;case 7:if(!O.endsWith(".json")){ge.next=13;break}return ge.next=10,this.loadJSON(O,L,J);case 10:ie=ge.sent,ge.next=20;break;case 13:if(!O.includes("blob")){ge.next=19;break}return ge.next=16,this.loadBlob(O,L,J);case 16:ie=ge.sent,ge.next=20;break;case 19:throw new Error("Not a valid data format. Must be csv or json");case 20:return ge.abrupt("return",ie);case 23:throw ge.prev=23,ge.t0=ge.catch(0),console.error(ge.t0),new Error(ge.t0);case 27:case"end":return ge.stop()}},T,this,[[0,23]])}));return function(T,O,L){return M.apply(this,arguments)}}()},{key:"loadJSON",value:function(){var M=q()(me.a.mark(function T(O,L,J){var ie,ge,Ae,Ie;return me.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(De.prev=0,!(O instanceof Object)){De.next=5;break}ie=Object.assign({},O),De.next=10;break;case 5:return De.next=7,Bt.a.get(O);case 7:ge=De.sent,Ae=ge.data,ie=Ae;case 10:return Ie=this.formatRawData(ie,L,J),De.abrupt("return",Ie);case 14:throw De.prev=14,De.t0=De.catch(0),console.error("error loading json"),new Error(De.t0);case 18:case"end":return De.stop()}},T,this,[[0,14]])}));return function(T,O,L){return M.apply(this,arguments)}}()},{key:"loadCSV",value:function(){var M=q()(me.a.mark(function T(O,L,J){var ie,ge,Ae,Ie;return me.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return De.prev=0,ie=I.data.csv(O),De.next=4,ie.toArray();case 4:return ge=De.sent,Ae={entries:ge},Ie=this.formatRawData(Ae,L,J),De.abrupt("return",Ie);case 10:throw De.prev=10,De.t0=De.catch(0),console.error("error loading csv",De.t0),new Error(De.t0);case 14:case"end":return De.stop()}},T,this,[[0,10]])}));return function(T,O,L){return M.apply(this,arguments)}}()},{key:"loadBlob",value:function(){var M=q()(me.a.mark(function T(O,L,J){var ie,ge,Ae,Ie,De,et;return me.a.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:return ot.prev=0,ot.next=3,Bt.a.get(O);case 3:if(ie=ot.sent,ge=ie.data,Ae=ge,!Da.isJsonOrString(Ae)){ot.next=13;break}return De=JSON.parse(Ae),ot.next=10,this.loadJSON(De,L,J);case 10:Ie=ot.sent,ot.next=17;break;case 13:return et=this.csvToJSON(Ae),ot.next=16,this.loadJSON(et,L,J);case 16:Ie=ot.sent;case 17:return ot.abrupt("return",Ie);case 20:throw ot.prev=20,ot.t0=ot.catch(0),console.log("mmm might be passing in a string or something!",ot.t0),new Error(ot.t0);case 24:case"end":return ot.stop()}},T,this,[[0,20]])}));return function(T,O,L){return M.apply(this,arguments)}}()},{key:"loadData",value:function(){var M=q()(me.a.mark(function T(){var O,L,J,ie,ge,Ae,Ie=arguments;return me.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(O=Ie.length>0&&Ie[0]!==void 0?Ie[0]:null,L=Ie.length>1?Ie[1]:void 0,De.prev=2,typeof O=="string"){De.next=17;break}if(ie=O[0],new FileReader().readAsText(ie),!ie.name.includes(".json")){De.next=14;break}return De.next=10,ie.text();case 10:ge=De.sent,J=JSON.parse(ge),De.next=15;break;case 14:console.log('data must be a json object containing an array called "data" or "entries');case 15:De.next=22;break;case 17:return De.next=19,Bt.a.get(O,{responseType:"text"});case 19:J=De.sent,Ae=JSON.stringify(J.data),Da.isJsonOrString(Ae)?J=JSON.parse(Ae):console.log("Whoops! something went wrong. Either this kind of data is not supported yet or there is an issue with .loadData");case 22:this.data.raw=this.findEntries(J),!this.data.raw.length>0&&console.log('data must be a json object containing an array called "data" '),L&&L(),De.next=30;break;case 27:throw De.prev=27,De.t0=De.catch(2),new Error(De.t0);case 30:case"end":return De.stop()}},T,this,[[2,27]])}));return function(){return M.apply(this,arguments)}}()},{key:"saveData",value:function(){var M=q()(me.a.mark(function T(O){var L,J,ie,ge,Ae,Ie;return me.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return L=new Date,J="".concat(String(L.getFullYear()),"-").concat(String(L.getMonth()+1),"-").concat(String(L.getDate())),ie="".concat(String(L.getHours()),"-").concat(String(L.getMinutes()),"-").concat(String(L.getSeconds())),ge="".concat(J,"_").concat(ie),Ae=ge,O&&(Ae=O),Ie={data:this.data.raw},De.next=9,Jr(JSON.stringify(Ie),"".concat(Ae,".json"),"text/plain");case 9:case"end":return De.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"saveMeta",value:function(){var M=q()(me.a.mark(function T(O,L){var J,ie;return me.a.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return typeof O=="function"?(J="model",ie=O):typeof O=="string"?(J=O,typeof L=="function"&&(ie=L)):J="model",ge.next=3,Jr(JSON.stringify(this.meta),"".concat(J,"_meta.json"),"text/plain");case 3:ie&&ie();case 4:case"end":return ge.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()},{key:"loadMeta",value:function(){var M=q()(me.a.mark(function T(){var O,L,J,ie,ge,Ae,Ie,De=arguments;return me.a.wrap(function(et){for(;;)switch(et.prev=et.next){case 0:if(O=De.length>0&&De[0]!==void 0?De[0]:null,L=De.length>1?De[1]:void 0,!(O instanceof FileList)){et.next=10;break}return et.next=5,Promise.all(Array.from(O).map(function(){var ot=q()(me.a.mark(function zt(Ht){var xn;return me.a.wrap(function(En){for(;;)switch(En.prev=En.next){case 0:if(!Ht.name.includes(".json")||Ht.name.includes("_meta")){En.next=4;break}return En.abrupt("return",{name:"model",file:Ht});case 4:if(!Ht.name.includes(".json")||!Ht.name.includes("_meta.json")){En.next=11;break}return En.next=7,Ht.text();case 7:return xn=En.sent,En.abrupt("return",{name:"metadata",file:xn});case 11:if(!Ht.name.includes(".bin")){En.next=13;break}return En.abrupt("return",{name:"weights",file:Ht});case 13:return En.abrupt("return",{name:null,file:null});case 14:case"end":return En.stop()}},zt)}));return function(zt){return ot.apply(this,arguments)}}()));case 5:J=et.sent,ie=JSON.parse(J.find(function(ot){return ot.name==="metadata"}).file),this.meta=ie,et.next=25;break;case 10:if(!(O instanceof Object)){et.next=19;break}return et.next=13,Bt.a.get(O.metadata,{responseType:"text"});case 13:ge=et.sent,ge=JSON.stringify(ge.data),ge=JSON.parse(ge),this.meta=ge,et.next=25;break;case 19:return Ae="".concat(O.substring(0,O.lastIndexOf("/")),"/model_meta.json"),et.next=22,Bt.a.get(Ae);case 22:Ie=(Ie=et.sent).data,this.meta=Ie;case 25:return this.isMetadataReady=!0,this.isWarmedUp=!0,L&&L(),et.abrupt("return",this.meta);case 29:case"end":return et.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"formatRawData",value:function(M,T,O){var L=this.findEntries(M);!L.length>0&&console.log(`your data must be contained in an array in 

        a property called 'entries' or 'data' of your json object`);var J=L.map(function(ie,ge){var Ae={xs:{},ys:{}};return T.forEach(function(Ie){ie[Ie]!==void 0?Ae.xs[Ie]=ie[Ie]:console.error("the input label ".concat(Ie," does not exist at row ").concat(ge))}),O.forEach(function(Ie){ie[Ie]!==void 0?Ae.ys[Ie]=ie[Ie]:console.error("the output label ".concat(Ie," does not exist at row ").concat(ge))}),Ae});return this.data.raw=J,J}},{key:"csvToJSON",value:function(M){for(var T=M.split(`
`),O=[],L=T[0].split(","),J=function(ge){var Ae={},Ie=T[ge].split(",");L.forEach(function(De,et){Ae[De]=Ie[et]}),O.push(Ae)},ie=1;ie<T.length;ie+=1)J(ie);return{entries:O}}},{key:"findEntries",value:function(M){var T=this,O=Object.assign({},M);return O.entries&&O.entries instanceof Array?O.entries:O.data&&O.data instanceof Array?O.data:(Object.keys(O).forEach(function(L){if(we()(O[L])==="object")return T.findEntries(O[L])}),O)}},{key:"getData",value:function(){return this.data.raw}}]),$}();function Ad($,M){var T=Object.keys($);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols($);M&&(O=O.filter(function(L){return Object.getOwnPropertyDescriptor($,L).enumerable})),T.push.apply(T,O)}return T}var Vh=function(){function $(){oe()(this,$),this.config={height:300}}return _e()($,[{key:"modelSummary",value:function(M,T){var O=function(L){for(var J=1;J<arguments.length;J++){var ie=arguments[J]!=null?arguments[J]:{};J%2?Ad(Object(ie),!0).forEach(function(ge){H()(L,ge,ie[ge])}):Object.getOwnPropertyDescriptors?Object.defineProperties(L,Object.getOwnPropertyDescriptors(ie)):Ad(Object(ie)).forEach(function(ge){Object.defineProperty(L,ge,Object.getOwnPropertyDescriptor(ie,ge))})}return L}({},M);Q.show.modelSummary(O,T)}},{key:"scatterplot",value:function(M,T,O){var L=O.map(function(ie){return{x:ie.xs[M],y:ie.ys[T]}}),J={xLabel:"X",yLabel:"Y",height:this.config.height};Q.render.scatterplot({name:"debug mode"},L,J)}},{key:"scatterplotAll",value:function(M,T,O){var L=[];M.forEach(function(ie){T.forEach(function(ge){var Ae=O.map(function(Ie){return{x:Ie.xs[ie],y:Ie.ys[ge]}});L=[].concat(Xo()(L),Xo()(Ae))})});var J={xLabel:"X",yLabel:"Y",height:this.config.height};Q.render.scatterplot({name:"debug mode"},L,J)}},{key:"barchart",value:function(M,T,O){var L=O.map(function(ie){return{value:ie.xs[M],index:ie.ys[T]}}),J={xLabel:"label",yLabel:"value",height:this.config.height};console.log(J),Q.render.barchart({name:"Bar chart"},L)}},{key:"trainingVis",value:function(){return Q.show.fitCallbacks({name:"Training Performance"},["loss","accuracy"],{height:this.config.height,callbacks:["onEpochEnd"]})}}]),$}();function im($,M){var T=Object.keys($);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols($);M&&(O=O.filter(function(L){return Object.getOwnPropertyDescriptor($,L).enumerable})),T.push.apply(T,O)}return T}function Od($){for(var M=1;M<arguments.length;M++){var T=arguments[M]!=null?arguments[M]:{};M%2?im(Object(T),!0).forEach(function(O){H()($,O,T[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(T)):im(Object(T)).forEach(function(O){Object.defineProperty($,O,Object.getOwnPropertyDescriptor(T,O))})}return $}var kf={inputs:[],outputs:[],dataUrl:null,modelUrl:null,layers:[],task:null,debug:!1,learningRate:.2,hiddenUnits:16,noTraining:!1},om=function(){function $(M,T){oe()(this,$),this.callback=T,M.task==="imageClassification"&&(kf.learningRate=.02),this.options=Od(Od({},kf),M)||kf,this.neuralNetwork=new Pl,this.neuralNetworkData=new Cf,this.neuralNetworkVis=new Vh,this.data={training:[]},this.ready=!1,this.init=this.init.bind(this),this.addData=this.addData.bind(this),this.loadDataFromUrl=this.loadDataFromUrl.bind(this),this.loadDataInternal=this.loadDataInternal.bind(this),this.createMetaData=this.createMetaData.bind(this),this.prepareForTraining=this.prepareForTraining.bind(this),this.normalizeData=this.normalizeData.bind(this),this.normalizeInput=this.normalizeInput.bind(this),this.searchAndFormat=this.searchAndFormat.bind(this),this.formatInputItem=this.formatInputItem.bind(this),this.convertTrainingDataToTensors=this.convertTrainingDataToTensors.bind(this),this.formatInputsForPrediction=this.formatInputsForPrediction.bind(this),this.formatInputsForPredictionAll=this.formatInputsForPredictionAll.bind(this),this.isOneHotEncodedOrNormalized=this.isOneHotEncodedOrNormalized.bind(this),this.train=this.train.bind(this),this.trainInternal=this.trainInternal.bind(this),this.addLayer=this.addLayer.bind(this),this.createNetworkLayers=this.createNetworkLayers.bind(this),this.addDefaultLayers=this.addDefaultLayers.bind(this),this.compile=this.compile.bind(this),this.predict=this.predict.bind(this),this.predictMultiple=this.predictMultiple.bind(this),this.classify=this.classify.bind(this),this.classifyMultiple=this.classifyMultiple.bind(this),this.predictInternal=this.predictInternal.bind(this),this.classifyInternal=this.classifyInternal.bind(this),this.saveData=this.saveData.bind(this),this.loadData=this.loadData.bind(this),this.save=this.save.bind(this),this.load=this.load.bind(this),this.dispose=this.dispose.bind(this),this.mutate=this.mutate.bind(this),this.crossover=this.crossover.bind(this),this.init(this.callback)}return _e()($,[{key:"init",value:function(M){this.options.noTraining===!0&&this.createLayersNoTraining(),this.options.dataUrl!==null?this.ready=this.loadDataFromUrl(this.options,M):this.options.modelUrl!==null?this.ready=this.load(this.options.modelUrl,M):this.ready=!0}},{key:"createLayersNoTraining",value:function(){var M=this.options,T=M.inputs,O=M.outputs;if(M.task==="classification")for(var L=0;L<O.length;L+=1){var J=new Array(T).fill(0);this.addData(J,[O[L]])}else{var ie=new Array(T).fill(0),ge=new Array(O).fill(0);this.addData(ie,ge)}this.neuralNetworkData.createMetadata(this.neuralNetworkData.data.raw),this.addDefaultLayers(this.options.task,this.neuralNetworkData.meta)}},{key:"copy",value:function(){var M=this,T=new $(this.options);return I.tidy(function(){for(var O=M.neuralNetwork.model.getWeights(),L=[],J=0;J<O.length;J+=1)L[J]=O[J].clone();return T.neuralNetwork.model.setWeights(L),T})}},{key:"addData",value:function(M,T){var O,L,J=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,ie=this.options,ge=ie.inputs,Ae=ie.outputs;if(J!==null?(O=J.inputLabels,L=J.outputLabels):ge.length>0&&Ae.length>0?(ge.every(function(ot){return typeof ot=="string"})&&(O=ge),Ae.every(function(ot){return typeof ot=="string"})&&(L=Ae)):we()(M)==="object"&&we()(T)==="object"?(O=Object.keys(M),L=Object.keys(T)):(O=Da.createLabelsFromArrayValues(M,"input"),L=Da.createLabelsFromArrayValues(T,"output")),!(O instanceof Array))throw new Error("inputLabels must be an array");if(!(L instanceof Array))throw new Error("outputLabels must be an array");var Ie=this.searchAndFormat(M),De=Da.formatDataAsObject(Ie,O),et=Da.formatDataAsObject(T,L);this.neuralNetworkData.addData(De,et)}},{key:"loadDataFromUrl",value:function(M,T){return Ge(this.loadDataInternal(M),T)}},{key:"loadDataInternal",value:function(){var M=q()(me.a.mark(function T(O){var L,J,ie,ge;return me.a.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:return L=O.dataUrl,J=O.inputs,ie=O.outputs,Ae.next=3,this.neuralNetworkData.loadDataFromUrl(L,J,ie);case 3:ge=Ae.sent,this.createMetadata(ge),this.prepareForTraining(ge);case 6:case"end":return Ae.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"createMetaData",value:function(M){var T,O=this.options.inputs;Array.isArray(O)&&O.length>0&&(T=O.every(function(L){return typeof L=="number"})&&O.length>0?O:null),this.neuralNetworkData.createMetadata(M,T)}},{key:"prepareForTraining",value:function(){var M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,T=M===null?this.neuralNetworkData.data.raw:M,O=this.neuralNetworkData.applyOneHotEncodingsToDataRaw(T);return this.data.training=O,this.neuralNetworkData.isWarmedUp=!0,O}},{key:"normalizeData",value:function(){var M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,T=M===null?this.neuralNetworkData.data.raw:M;this.neuralNetworkData.isMetadataReady||this.createMetaData(T),this.neuralNetworkData.isWarmedUp||this.prepareForTraining(T);var O=this.neuralNetworkData.normalizeDataRaw(T);return this.data.training=O,this.neuralNetworkData.meta.isNormalized=!0,O}},{key:"normalizeInput",value:function(M,T,O){var L=O[T],J=L.min,ie=L.max;return Da.normalizeValue(M,J,ie)}},{key:"searchAndFormat",value:function(M){var T,O=this;if(Array.isArray(M))T=M.map(function(J){return O.formatInputItem(J)});else if(we()(M)==="object"){var L=Object.assign({},M);Object.keys(M).forEach(function(J){var ie=M[J];L[J]=O.formatInputItem(ie)}),T=L}return T}},{key:"formatInputItem",value:function(M){var T;return Dt(M)?T=M:we()(M)==="object"&&Dt(M.elt)?T=M.elt:we()(M)==="object"&&Dt(M.canvas)&&(T=M.canvas),T?On(T):M}},{key:"convertTrainingDataToTensors",value:function(){var M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,O=M===null?this.data.training:M,L=T===null?this.neuralNetworkData.meta:T;return this.neuralNetworkData.convertRawToTensors(O,L)}},{key:"formatInputsForPrediction",value:function(M,T,O){var L=this,J=[];return M instanceof Array?J=O.map(function(ie,ge){return L.isOneHotEncodedOrNormalized(M[ge],ie,T.inputs)}):M instanceof Object&&(J=O.map(function(ie){return L.isOneHotEncodedOrNormalized(M[ie],ie,T.inputs)})),J=J.flat()}},{key:"formatInputsForPredictionAll",value:function(M,T,O){var L,J=this;return M instanceof Array&&M.every(function(ie){return Array.isArray(ie)})?(L=M.map(function(ie){return J.formatInputsForPrediction(ie,T,O)}),I.tensor(L,[M.length,O.length])):(L=this.formatInputsForPrediction(M,T,O),I.tensor([L]))}},{key:"isOneHotEncodedOrNormalized",value:function(M,T,O){var L,J=M,ie=T;return typeof M!="number"?L=O[ie].legend[J]:(L=M,this.neuralNetworkData.meta.isNormalized&&(L=this.normalizeInput(M,ie,O))),L}},{key:"train",value:function(M,T,O){var L,J,ie;we()(M)==="object"&&typeof T=="function"&&typeof O=="function"?(L=M,J=T,ie=O):we()(M)==="object"&&typeof T=="function"?(L=M,J=null,ie=T):typeof M=="function"&&typeof T=="function"?(L={},J=M,ie=T):(L={},J=null,ie=M),this.trainInternal(L,J,ie)}},{key:"trainInternal",value:function(M,T,O){var L=Od({epochs:10,batchSize:32,validationSplit:.1,whileTraining:null},M);if(this.options.debug===!0||this.options.debug==="true"?L.whileTraining=[this.neuralNetworkVis.trainingVis(),{onEpochEnd:T}]:L.whileTraining=[{onEpochEnd:T}],this.neuralNetworkData.isMetadataReady||this.createMetaData(this.neuralNetworkData.data.raw),this.neuralNetworkData.isWarmedUp||this.prepareForTraining(this.neuralNetworkData.data.raw),!L.inputs&&!L.outputs){var J=this.convertTrainingDataToTensors(),ie=J.inputs,ge=J.outputs;L.inputs=ie,L.outputs=ge}this.neuralNetwork.isLayered||(this.options.layers=this.createNetworkLayers(this.options.layers,this.neuralNetworkData.meta)),this.neuralNetwork.isLayered||(this.options.layers=this.addDefaultLayers(this.options.task,this.neuralNetworkData.meta)),this.neuralNetwork.isCompiled||this.compile(),this.neuralNetwork.train(L,O)}},{key:"addLayer",value:function(M){this.neuralNetwork.addLayer(M)}},{key:"createNetworkLayers",value:function(M,T){var O=this,L=Xo()(M),J=Object.assign({},T),ie=J.inputUnits,ge=J.outputUnits,Ae=L.length;if(!(L.length>=2))return!1;L[0].inputShape=L[0].inputShape?L[0].inputShape:ie;var Ie=L[Ae-1];return Ie.units=Ie.units?Ie.units:ge,L.forEach(function(De){O.addLayer(I.layers[De.type](De))}),L}},{key:"addDefaultLayers",value:function(M,T){var O;switch(M.toLowerCase()){case"classification":return O=[{type:"dense",units:this.options.hiddenUnits,activation:"relu"},{type:"dense",activation:"softmax"}],this.createNetworkLayers(O,T);case"regression":return O=[{type:"dense",units:this.options.hiddenUnits,activation:"relu"},{type:"dense",activation:"sigmoid"}],this.createNetworkLayers(O,T);case"imageclassification":return O=[{type:"conv2d",filters:8,kernelSize:5,strides:1,activation:"relu",kernelInitializer:"varianceScaling"},{type:"maxPooling2d",poolSize:[2,2],strides:[2,2]},{type:"conv2d",filters:16,kernelSize:5,strides:1,activation:"relu",kernelInitializer:"varianceScaling"},{type:"maxPooling2d",poolSize:[2,2],strides:[2,2]},{type:"flatten"},{type:"dense",kernelInitializer:"varianceScaling",activation:"softmax"}],this.createNetworkLayers(O,T);default:return console.log("no imputUnits or outputUnits defined"),O=[{type:"dense",units:this.options.hiddenUnits,activation:"relu"},{type:"dense",activation:"sigmoid"}],this.createNetworkLayers(O,T)}}},{key:"compile",value:function(){var M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,O=T===null?this.options.learningRate:T,L={};M!==null?L=Od({},M):this.options.task==="classification"||this.options.task==="imageClassification"?L={loss:"categoricalCrossentropy",optimizer:I.train.sgd,metrics:["accuracy"]}:this.options.task==="regression"&&(L={loss:"meanSquaredError",optimizer:I.train.adam,metrics:["accuracy"]}),L.optimizer=L.optimizer?this.neuralNetwork.setOptimizerFunction(O,L.optimizer):this.neuralNetwork.setOptimizerFunction(O,I.train.sgd),this.neuralNetwork.compile(L),this.options.debug&&this.neuralNetworkVis.modelSummary({name:"Model Summary"},this.neuralNetwork.model)}},{key:"predictSync",value:function(M){return this.predictSyncInternal(M)}},{key:"predict",value:function(M,T){return Ge(this.predictInternal(M),T)}},{key:"predictMultiple",value:function(M,T){return Ge(this.predictInternal(M),T)}},{key:"classifySync",value:function(M){return this.classifySyncInternal(M)}},{key:"classify",value:function(M,T){return Ge(this.classifyInternal(M),T)}},{key:"classifyMultiple",value:function(M,T){return Ge(this.classifyInternal(M),T)}},{key:"predictSyncInternal",value:function(M){var T=this.neuralNetworkData.meta,O=Object.keys(T.inputs),L=this.formatInputsForPredictionAll(M,T,O),J=this.neuralNetwork.predictSync(L);if(L.dispose(),T!==null){var ie=Object.keys(T.outputs),ge=J.map(function(Ae){return ie.map(function(Ie,De){var et,ot,zt;if(T.isNormalized){var Ht=T.outputs[Ie],xn=Ht.min,En=Ht.max;ot=Da.unnormalizeValue(Ae[De],xn,En),zt=Ae[De]}else ot=Ae[De];var Fn=(et={},H()(et,ie[De],ot),H()(et,"label",Ie),H()(et,"value",ot),et);return zt&&(Fn.unNormalizedValue=zt),Fn})});return ge.length<2?ge[0]:ge}return J}},{key:"predictInternal",value:function(){var M=q()(me.a.mark(function T(O){var L,J,ie,ge,Ae,Ie;return me.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return L=this.neuralNetworkData.meta,J=Object.keys(L.inputs),ie=this.formatInputsForPredictionAll(O,L,J),De.next=5,this.neuralNetwork.predict(ie);case 5:if(ge=De.sent,ie.dispose(),L===null){De.next=13;break}if(Ae=Object.keys(L.outputs),!((Ie=ge.map(function(et){return Ae.map(function(ot,zt){var Ht,xn,En;if(L.isNormalized){var Fn=L.outputs[ot],Rn=Fn.min,Wn=Fn.max;xn=Da.unnormalizeValue(et[zt],Rn,Wn),En=et[zt]}else xn=et[zt];var Jn=(Ht={},H()(Ht,Ae[zt],xn),H()(Ht,"label",ot),H()(Ht,"value",xn),Ht);return En&&(Jn.unNormalizedValue=En),Jn})})).length<2)){De.next=12;break}return De.abrupt("return",Ie[0]);case 12:return De.abrupt("return",Ie);case 13:return De.abrupt("return",ge);case 14:case"end":return De.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"classifySyncInternal",value:function(M){var T,O=this.neuralNetworkData.meta,L=Object.keys(O.inputs);if(this.options.task==="imageClassification"){if(T=this.searchAndFormat(M),T=Array.isArray(T)?T.flat():T[L[0]],O.isNormalized){var J=O.inputs[L[0]],ie=J.min,ge=J.max;T=this.neuralNetworkData.normalizeArray(Array.from(T),{min:ie,max:ge})}else T=Array.from(T);T=I.tensor([T],[1].concat(Xo()(O.inputUnits)))}else T=this.formatInputsForPredictionAll(M,O,L);var Ae=this.neuralNetwork.classifySync(T);if(T.dispose(),O!==null){var Ie=Object.keys(O.outputs)[0],De=Object.entries(O.outputs[Ie].legend),et=Ae.map(function(ot){return De.map(function(zt,Ht){var xn;return xn={},H()(xn,zt[0],ot[Ht]),H()(xn,"label",zt[0]),H()(xn,"confidence",ot[Ht]),xn}).sort(function(zt,Ht){return Ht.confidence-zt.confidence})});return et.length<2?et[0]:et}return Ae}},{key:"classifyInternal",value:function(){var M=q()(me.a.mark(function T(O){var L,J,ie,ge,Ae,Ie,De,et,ot,zt;return me.a.wrap(function(Ht){for(;;)switch(Ht.prev=Ht.next){case 0:return L=this.neuralNetworkData.meta,J=Object.keys(L.inputs),this.options.task==="imageClassification"?(ie=this.searchAndFormat(O),ie=Array.isArray(ie)?ie.flat():ie[J[0]],L.isNormalized?(ge=L.inputs[J[0]],Ae=ge.min,Ie=ge.max,ie=this.neuralNetworkData.normalizeArray(Array.from(ie),{min:Ae,max:Ie})):ie=Array.from(ie),ie=I.tensor([ie],[1].concat(Xo()(L.inputUnits)))):ie=this.formatInputsForPredictionAll(O,L,J),Ht.next=5,this.neuralNetwork.classify(ie);case 5:if(De=Ht.sent,ie.dispose(),L===null){Ht.next=14;break}if(et=Object.keys(L.outputs)[0],ot=Object.entries(L.outputs[et].legend),!((zt=De.map(function(xn){return ot.map(function(En,Fn){var Rn;return Rn={},H()(Rn,En[0],xn[Fn]),H()(Rn,"label",En[0]),H()(Rn,"confidence",xn[Fn]),Rn}).sort(function(En,Fn){return Fn.confidence-En.confidence})})).length<2)){Ht.next=13;break}return Ht.abrupt("return",zt[0]);case 13:return Ht.abrupt("return",zt);case 14:return Ht.abrupt("return",De);case 15:case"end":return Ht.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"saveData",value:function(M){this.neuralNetworkData.saveData(M)}},{key:"loadData",value:function(){var M=q()(me.a.mark(function T(){var O,L,J=arguments;return me.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:O=J.length>0&&J[0]!==void 0?J[0]:null,L=J.length>1?J[1]:void 0,this.neuralNetworkData.loadData(O,L);case 3:case"end":return ie.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"save",value:function(M,T){var O,L,J=this;typeof M=="function"?(O="model",L=M):typeof M=="string"?(O=M,typeof T=="function"&&(L=T)):O="model",this.neuralNetwork.save(O,function(){J.neuralNetworkData.saveMeta(O,L)})}},{key:"load",value:function(){var M=q()(me.a.mark(function T(){var O,L,J,ie=this,ge=arguments;return me.a.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:O=ge.length>0&&ge[0]!==void 0?ge[0]:null,(L=ge.length>1?ge[1]:void 0)&&(J=L),this.neuralNetwork.load(O,function(){return ie.neuralNetworkData.loadMeta(O,J),ie.neuralNetwork.model});case 4:case"end":return Ae.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"dispose",value:function(){this.neuralNetwork.dispose()}},{key:"mutate",value:function(M,T){this.neuralNetwork.mutate(M,T)}},{key:"crossover",value:function(M){var T=this.copy();return T.neuralNetwork.crossover(M.neuralNetwork),T}}]),$}(),am=function($,M,T){var O,L;return $ instanceof Object?(O=$,L=M):(O={inputs:$,outputs:M},L=T),new om(O,L)},bn=r(3);function uu($,M,T){if(T===void 0&&(T=!1),$.beginPath(),M.slice(1).forEach(function(J,ie){var ge=J.x,Ae=J.y,Ie=M[ie];$.moveTo(Ie.x,Ie.y),$.lineTo(ge,Ae)}),T){var O=M[M.length-1],L=M[0];if(!O||!L)return;$.moveTo(O.x,O.y),$.lineTo(L.x,L.y)}$.stroke()}var tr=r(5),js=function(){function $(M,T){if(!vc(M)||!vc(T))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:M,height:T}));this._width=M,this._height=T}return Object.defineProperty($.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),$.prototype.reverse=function(){return new $(1/this.width,1/this.height)},$}();function vo($,M){return $ instanceof bn.Tensor&&$.shape.length===M}function Af($){return vo($,1)}function Td($){return vo($,2)}function mr($){return vo($,3)}function is($){return vo($,4)}function Na($){return $%1!=0}function io($){return $%2==0}function Xu($,M){M===void 0&&(M=2);var T=Math.pow(10,M);return Math.floor($*T)/T}function Pc($){return $&&$.width&&$.height}function cu($,M){var T=$.width,O=$.height,L=M/Math.max(O,T);return new js(Math.round(T*L),Math.round(O*L))}function Lc($){return $.reduce(function(M,T){return M.add(T)},new bo(0,0)).div(new bo($.length,$.length))}function oa($,M,T){return Array($).fill(0).map(function(O,L){return M+L*T})}function vc($){return!!$&&$!==1/0&&$!==-1/0&&!isNaN($)||$===0}function lu($){return vc($)&&0<=$&&$<=1}var bo=function(){function $(M,T){this._x=M,this._y=T}return Object.defineProperty($.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),$.prototype.add=function(M){return new $(this.x+M.x,this.y+M.y)},$.prototype.sub=function(M){return new $(this.x-M.x,this.y-M.y)},$.prototype.mul=function(M){return new $(this.x*M.x,this.y*M.y)},$.prototype.div=function(M){return new $(this.x/M.x,this.y/M.y)},$.prototype.abs=function(){return new $(Math.abs(this.x),Math.abs(this.y))},$.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},$.prototype.floor=function(){return new $(Math.floor(this.x),Math.floor(this.y))},$}(),Es=function(){function $(M,T){T===void 0&&(T=!0);var O=M||{},L=[O.left,O.top,O.right,O.bottom].every(vc),J=[O.x,O.y,O.width,O.height].every(vc);if(!J&&!L)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(O));var ie=J?[O.x,O.y,O.width,O.height]:[O.left,O.top,O.right-O.left,O.bottom-O.top],ge=ie[0],Ae=ie[1],Ie=ie[2],De=ie[3];$.assertIsValidBox({x:ge,y:Ae,width:Ie,height:De},"Box.constructor",T),this._x=ge,this._y=Ae,this._width=Ie,this._height=De}return $.isRect=function(M){return!!M&&[M.x,M.y,M.width,M.height].every(vc)},$.assertIsValidBox=function(M,T,O){if(O===void 0&&(O=!1),!$.isRect(M))throw new Error(T+" - invalid box: "+JSON.stringify(M)+", expected object with properties x, y, width, height");if(!O&&(M.width<0||M.height<0))throw new Error(T+" - width ("+M.width+") and height ("+M.height+") must be positive numbers")},Object.defineProperty($.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"topLeft",{get:function(){return new bo(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"topRight",{get:function(){return new bo(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"bottomLeft",{get:function(){return new bo(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"bottomRight",{get:function(){return new bo(this.right,this.bottom)},enumerable:!0,configurable:!0}),$.prototype.round=function(){var M=[this.x,this.y,this.width,this.height].map(function(T){return Math.round(T)});return new $({x:M[0],y:M[1],width:M[2],height:M[3]})},$.prototype.floor=function(){var M=[this.x,this.y,this.width,this.height].map(function(T){return Math.floor(T)});return new $({x:M[0],y:M[1],width:M[2],height:M[3]})},$.prototype.toSquare=function(){var M=this.x,T=this.y,O=this.width,L=this.height,J=Math.abs(O-L);return O<L&&(M-=J/2,O+=J),L<O&&(T-=J/2,L+=J),new $({x:M,y:T,width:O,height:L})},$.prototype.rescale=function(M){var T=Pc(M)?M.width:M,O=Pc(M)?M.height:M;return new $({x:this.x*T,y:this.y*O,width:this.width*T,height:this.height*O})},$.prototype.pad=function(M,T){var O=[this.x-M/2,this.y-T/2,this.width+M,this.height+T];return new $({x:O[0],y:O[1],width:O[2],height:O[3]})},$.prototype.clipAtImageBorders=function(M,T){var O=this.x,L=this.y,J=this.right,ie=this.bottom,ge=Math.max(O,0),Ae=Math.max(L,0),Ie=J-ge,De=ie-Ae;return new $({x:ge,y:Ae,width:Math.min(Ie,M-ge),height:Math.min(De,T-Ae)}).floor()},$.prototype.shift=function(M,T){var O=this.width,L=this.height;return new $({x:this.x+M,y:this.y+T,width:O,height:L})},$.prototype.padAtBorders=function(M,T){var O=this.width+1,L=this.height+1,J=O,ie=L,ge=this.left,Ae=this.top,Ie=this.right,De=this.bottom;return Ie>T&&(J=-Ie+T+O,Ie=T),De>M&&(ie=-De+M+L,De=M),ge<1&&(ie=2-ge,ge=1),Ae<1&&(ie=2-Ae,Ae=1),{dy:1,edy:ie,dx:1,edx:J,y:Ae,ey:De,x:ge,ex:Ie,w:O,h:L}},$.prototype.calibrate=function(M){return new $({left:this.left+M.left*this.width,top:this.top+M.top*this.height,right:this.right+M.right*this.width,bottom:this.bottom+M.bottom*this.height}).toSquare().round()},$}(),Ua=function($){function M(T,O,L,J,ie){return ie===void 0&&(ie=!1),$.call(this,{left:T,top:O,right:L,bottom:J},ie)||this}return Object(tr.c)(M,$),M}(Es),Ss=function(){function $(M,T,O,L,J){this._imageDims=new js(J.width,J.height),this._score=M,this._classScore=T,this._className=O,this._box=new Es(L).rescale(this._imageDims)}return Object.defineProperty($.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"relativeBox",{get:function(){return new Es(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),$.prototype.forSize=function(M,T){return new $(this.score,this.classScore,this.className,this.relativeBox,{width:M,height:T})},$}(),aa=function($){function M(T,O,L){return $.call(this,T,T,"",O,L)||this}return Object(tr.c)(M,$),M.prototype.forSize=function(T,O){var L=$.prototype.forSize.call(this,T,O);return new M(L.score,L.relativeBox,L.imageDims)},M}(Ss);function fu($,M,T){T===void 0&&(T=!0);var O=Math.max(0,Math.min($.right,M.right)-Math.max($.left,M.left))*Math.max(0,Math.min($.bottom,M.bottom)-Math.max($.top,M.top));return T?O/($.area+M.area-O):O/Math.min($.area,M.area)}function Ku($){var M=$.map(function(ge){return ge.x}),T=$.map(function(ge){return ge.y}),O=M.reduce(function(ge,Ae){return Ae<ge?Ae:ge},1/0),L=T.reduce(function(ge,Ae){return Ae<ge?Ae:ge},1/0),J=M.reduce(function(ge,Ae){return ge<Ae?Ae:ge},0),ie=T.reduce(function(ge,Ae){return ge<Ae?Ae:ge},0);return new Ua(O,L,J,ie)}function yc($,M,T,O){O===void 0&&(O=!0);for(var L=M.map(function(ge,Ae){return{score:ge,boxIndex:Ae}}).sort(function(ge,Ae){return ge.score-Ae.score}).map(function(ge){return ge.boxIndex}),J=[],ie=function(){var ge=L.pop();J.push(ge);for(var Ae=L,Ie=[],De=0;De<Ae.length;De++){var et=Ae[De],ot=$[ge],zt=$[et];Ie.push(fu(ot,zt,O))}L=L.filter(function(Ht,xn){return Ie[xn]<=T})};L.length>0;)ie();return J}function Bc($,M){return bn.tidy(function(){var T=M[0],O=M[1],L=M[2],J=bn.fill(Object(tr.e)($.shape.slice(0,3),[1]),T),ie=bn.fill(Object(tr.e)($.shape.slice(0,3),[1]),O),ge=bn.fill(Object(tr.e)($.shape.slice(0,3),[1]),L),Ae=bn.concat([J,ie,ge],3);return bn.sub($,Ae)})}function Yu($,M){return M===void 0&&(M=!1),bn.tidy(function(){var T=$.shape.slice(1),O=T[0],L=T[1];if(O===L)return $;var J=Math.abs(O-L),ie=Math.round(J*(M?.5:1)),ge=O>L?2:1,Ae=function(ot){var zt=$.shape.slice();return zt[ge]=ot,bn.fill(zt,0)},Ie=Ae(ie),De=J-Ie.shape[ge],et=[M&&De?Ae(De):null,$,Ie].filter(function(ot){return!!ot}).map(function(ot){return ot.toFloat()});return bn.concat(et,ge)})}function Ll($){for(var M=$.slice(),T=M.length-1;T>0;T--){var O=Math.floor(Math.random()*(T+1)),L=M[T];M[T]=M[O],M[O]=L}return M}function Bl($){return 1/(1+Math.exp(-$))}function Hh($){return Math.log($/(1-$))}var jl=function($){function M(T,O,L,J,ie){return ie===void 0&&(ie=!1),$.call(this,{x:T,y:O,width:L,height:J},ie)||this}return Object(tr.c)(M,$),M}(Es),du=function(){function $(M,T,O){O===void 0&&(O=new bo(0,0));var L=T.width,J=T.height;this._imgDims=new js(L,J),this._shift=O,this._positions=M.map(function(ie){return ie.mul(new bo(L,J)).add(O)})}return Object.defineProperty($.prototype,"shift",{get:function(){return new bo(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"relativePositions",{get:function(){var M=this;return this._positions.map(function(T){return T.sub(M._shift).div(new bo(M.imageWidth,M.imageHeight))})},enumerable:!0,configurable:!0}),$.prototype.forSize=function(M,T){return new this.constructor(this.relativePositions,{width:M,height:T})},$.prototype.shiftBy=function(M,T){return new this.constructor(this.relativePositions,this._imgDims,new bo(M,T))},$.prototype.shiftByPoint=function(M){return this.shiftBy(M.x,M.y)},$.prototype.align=function(M,T){if(T===void 0&&(T={}),M){var O=M instanceof aa?M.box.floor():new Es(M);return this.shiftBy(O.x,O.y).align(null,T)}var L=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},T),J=L.useDlibAlignment,ie=L.minBoxPadding;return J?this.alignDlib():this.alignMinBbox(ie)},$.prototype.alignDlib=function(){var M=this.getRefPointsForAlignment(),T=M[0],O=M[1],L=M[2],J=function(et){return L.sub(et).magnitude()},ie=(J(T)+J(O))/2,ge=Math.floor(ie/.45),Ae=Lc(M),Ie=Math.floor(Math.max(0,Ae.x-.5*ge)),De=Math.floor(Math.max(0,Ae.y-.43*ge));return new jl(Ie,De,Math.min(ge,this.imageWidth+Ie),Math.min(ge,this.imageHeight+De))},$.prototype.alignMinBbox=function(M){var T=Ku(this.positions);return T.pad(T.width*M,T.height*M)},$.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},$}(),Ju=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.getRefPointsForAlignment=function(){var T=this.positions;return[T[0],T[1],Lc([T[3],T[4]])]},M}(du),Qu=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.getJawOutline=function(){return this.positions.slice(0,17)},M.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},M.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},M.prototype.getNose=function(){return this.positions.slice(27,36)},M.prototype.getLeftEye=function(){return this.positions.slice(36,42)},M.prototype.getRightEye=function(){return this.positions.slice(42,48)},M.prototype.getMouth=function(){return this.positions.slice(48,68)},M.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Lc)},M}(du),Cu=function(){function $(M,T){this._label=M,this._distance=T}return Object.defineProperty($.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),$.prototype.toString=function(M){return M===void 0&&(M=!0),this.label+(M?" ("+Xu(this.distance)+")":"")},$}(),Gh=function($){function M(T,O){var L=$.call(this,T)||this;return L._label=O,L}return Object(tr.c)(M,$),M.assertIsValidLabeledBox=function(T,O){if(Es.assertIsValidBox(T,O),!vc(T.label))throw new Error(O+" - expected property label ("+T.label+") to be a number")},Object.defineProperty(M.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),M}(Es),Md=function(){function $(M,T){if(typeof M!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(T)||T.some(function(O){return!(O instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=M,this._descriptors=T}return Object.defineProperty($.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),$.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(M){return Array.from(M)})}},$.fromJSON=function(M){var T=M.descriptors.map(function(O){return new Float32Array(O)});return new $(M.label,T)},$}(),Dd=function($){function M(T,O,L,J){var ie=$.call(this,T,O)||this;return ie._score=L,ie._classScore=J,ie}return Object(tr.c)(M,$),M.assertIsValidPredictedBox=function(T,O){if(Gh.assertIsValidLabeledBox(T,O),!lu(T.score)||!lu(T.classScore))throw new Error(O+" - expected properties score ("+T.score+") and ("+T.classScore+") to be a number between [0, 1]")},Object.defineProperty(M.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),M}(Gh);function Of($){return $.detection instanceof aa}function Nd($,M){var T={detection:M};return Object.assign({},$,T)}function se(){var $=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:$,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}var ne=r(131),N=r(178);function G(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}var ce,je=r(177);function Qe($){ce=$}function bt(){G()&&Qe(se()),Object(je.a)()&&Qe(Object(N.a)())}var qt,un={getEnv:function(){if(!ce)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return ce},setEnv:Qe,initialize:bt,createBrowserEnv:se,createFileSystem:ne.a,createNodejsEnv:N.a,monkeyPatch:function($){if(ce||bt(),!ce)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var M=$.Canvas,T=M===void 0?ce.Canvas:M,O=$.Image,L=O===void 0?ce.Image:O;ce.Canvas=T,ce.Image=L,ce.createCanvasElement=$.createCanvasElement||function(){return new T},ce.createImageElement=$.createImageElement||function(){return new L},ce.ImageData=$.ImageData||ce.ImageData,ce.Video=$.Video||ce.Video,ce.fetch=$.fetch||ce.fetch,ce.readFile=$.readFile||ce.readFile},isBrowser:G,isNodejs:je.a};function ht($){return un.isNodejs()||typeof $!="string"?$:document.getElementById($)}function In($){var M=un.getEnv(),T=M.Canvas;if($ instanceof M.CanvasRenderingContext2D)return $;var O=ht($);if(!(O instanceof T))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var L=O.getContext("2d");if(!L)throw new Error("resolveContext2d - canvas 2d context is null");return L}bt(),function($){$.TOP_LEFT="TOP_LEFT",$.TOP_RIGHT="TOP_RIGHT",$.BOTTOM_LEFT="BOTTOM_LEFT",$.BOTTOM_RIGHT="BOTTOM_RIGHT"}(qt||(qt={}));var Un=function(){return function($){$===void 0&&($={});var M=$.anchorPosition,T=$.backgroundColor,O=$.fontColor,L=$.fontSize,J=$.fontStyle,ie=$.padding;this.anchorPosition=M||qt.TOP_LEFT,this.backgroundColor=T||"rgba(0, 0, 0, 0.5)",this.fontColor=O||"rgba(255, 255, 255, 1)",this.fontSize=L||14,this.fontStyle=J||"Georgia",this.padding=ie||4}}(),Gn=function(){function $(M,T,O){O===void 0&&(O={}),this.text=typeof M=="string"?[M]:M instanceof $?M.text:M,this.anchor=T,this.options=new Un(O)}return $.prototype.measureWidth=function(M){var T=this.options.padding;return this.text.map(function(O){return M.measureText(O).width}).reduce(function(O,L){return O<L?L:O},0)+2*T},$.prototype.measureHeight=function(){var M=this.options,T=M.fontSize,O=M.padding;return this.text.length*T+2*O},$.prototype.getUpperLeft=function(M,T){var O=this.options.anchorPosition,L=O===qt.BOTTOM_RIGHT||O===qt.TOP_RIGHT,J=O===qt.BOTTOM_LEFT||O===qt.BOTTOM_RIGHT,ie=this.measureWidth(M),ge=this.measureHeight(),Ae=L?this.anchor.x-ie:this.anchor.x,Ie=J?this.anchor.y-ge:this.anchor.y;if(T){var De=T.width,et=T.height;return{x:Math.max(Math.min(Ae,De-ie),0),y:Math.max(Math.min(Ie,et-ge),0)}}return{x:Ae,y:Ie}},$.prototype.draw=function(M){var T=ht(M),O=In(T),L=this.options,J=L.backgroundColor,ie=L.fontColor,ge=L.fontSize,Ae=L.fontStyle,Ie=L.padding;O.font=ge+"px "+Ae;var De=this.measureWidth(O),et=this.measureHeight();O.fillStyle=J;var ot=this.getUpperLeft(O,T);O.fillRect(ot.x,ot.y,De,et),O.fillStyle=ie,this.text.forEach(function(zt,Ht){var xn=Ie+ot.x,En=Ie+ot.y+(Ht+1)*ge;O.fillText(zt,xn,En)})},$}(),nr=function(){return function($){$===void 0&&($={});var M=$.boxColor,T=$.lineWidth,O=$.label,L=$.drawLabelOptions;this.boxColor=M||"rgba(0, 0, 255, 1)",this.lineWidth=T||2,this.label=O;var J={anchorPosition:qt.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new Un(Object.assign({},J,L))}}(),Yn=function(){function $(M,T){T===void 0&&(T={}),this.box=new Es(M),this.options=new nr(T)}return $.prototype.draw=function(M){var T=In(M),O=this.options,L=O.boxColor,J=O.lineWidth,ie=this.box,ge=ie.x,Ae=ie.y,Ie=ie.width,De=ie.height;T.strokeStyle=L,T.lineWidth=J,T.strokeRect(ge,Ae,Ie,De);var et=this.options.label;et&&new Gn([et],{x:ge-J/2,y:Ae},this.options.drawLabelOptions).draw(M)},$}();function pr($,M){(Array.isArray(M)?M:[M]).forEach(function(T){var O=T instanceof aa?T.score:Of(T)?T.detection.score:void 0,L=T instanceof aa?T.box:Of(T)?T.detection.box:new Es(T),J=O?""+Xu(O):void 0;new Yn(L,{label:J}).draw($)})}function gr($){var M=un.getEnv(),T=M.Image,O=M.Video;return $ instanceof T&&$.complete||$ instanceof O&&$.readyState>=3}function Tr($){return new Promise(function(M,T){if($ instanceof un.getEnv().Canvas||gr($))return M();function O(J){J.currentTarget&&(J.currentTarget.removeEventListener("load",O),J.currentTarget.removeEventListener("error",L),M(J))}function L(J){J.currentTarget&&(J.currentTarget.removeEventListener("load",O),J.currentTarget.removeEventListener("error",L),T(J))}$.addEventListener("load",O),$.addEventListener("error",L)})}function $r($){return new Promise(function(M,T){if(!($ instanceof Blob))return T("bufferToImage - expected buf to be of type: Blob");var O=new FileReader;O.onload=function(){if(typeof O.result!="string")return T("bufferToImage - expected reader.result to be a string, in onload");var L=un.getEnv().createImageElement();L.onload=function(){return M(L)},L.onerror=T,L.src=O.result},O.onerror=T,O.readAsDataURL($)})}function ai($){var M=un.getEnv(),T=M.Image,O=M.Video;return $ instanceof T?new js($.naturalWidth,$.naturalHeight):$ instanceof O?new js($.videoWidth,$.videoHeight):new js($.width,$.height)}function Fr($){var M=$.width,T=$.height,O=(0,un.getEnv().createCanvasElement)();return O.width=M,O.height=T,O}function ui($,M){var T=un.getEnv().ImageData;if(!($ instanceof T||gr($)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var O=M||ai($),L=O.width,J=O.height,ie=Fr({width:L,height:J});return $ instanceof T?In(ie).putImageData($,0,0):In(ie).drawImage($,0,0,L,J),ie}function ii($,M){return Object(tr.b)(this,void 0,void 0,function(){var T,O,L,J,ie,ge;return Object(tr.d)(this,function(Ae){switch(Ae.label){case 0:return T=M||un.getEnv().createCanvasElement(),O=$.shape.slice(is($)?1:0),L=O[0],J=O[1],ie=O[2],ge=bn.tidy(function(){return $.as3D(L,J,ie).toInt()}),[4,bn.browser.toPixels(ge,T)];case 1:return Ae.sent(),ge.dispose(),[2,T]}})})}function wi($){var M=un.getEnv(),T=M.Image,O=M.Canvas,L=M.Video;return $ instanceof T||$ instanceof O||$ instanceof L}function Si($,M,T){T===void 0&&(T=!1);var O=un.getEnv(),L=O.Image,J=O.Canvas;if(!($ instanceof L||$ instanceof J))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var ie=ai($),ge=M/Math.max(ie.height,ie.width),Ae=ge*ie.width,Ie=ge*ie.height,De=Fr({width:M,height:M}),et=$ instanceof J?$:ui($),ot=Math.abs(Ae-Ie)/2,zt=T&&Ae<Ie?ot:0,Ht=T&&Ie<Ae?ot:0;return In(De).drawImage(et,zt,Ht,Ae,Ie),De}var si=function(){function $(M,T){var O=this;if(T===void 0&&(T=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(M))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+M);this._treatAsBatchInput=T,this._batchSize=M.length,M.forEach(function(L,J){if(mr(L))return O._imageTensors[J]=L,void(O._inputDimensions[J]=L.shape);if(is(L)){var ie=L.shape[0];if(ie!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+ie+" passed, but not supported in input array");return O._imageTensors[J]=L,void(O._inputDimensions[J]=L.shape.slice(1))}var ge=L instanceof un.getEnv().Canvas?L:ui(L);O._canvases[J]=ge,O._inputDimensions[J]=[ge.height,ge.width,3]})}return Object.defineProperty($.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"reshapedInputDimensions",{get:function(){var M=this;return oa(this.batchSize,0,1).map(function(T,O){return M.getReshapedInputDimensions(O)})},enumerable:!0,configurable:!0}),$.prototype.getInput=function(M){return this.canvases[M]||this.imageTensors[M]},$.prototype.getInputDimensions=function(M){return this._inputDimensions[M]},$.prototype.getInputHeight=function(M){return this._inputDimensions[M][0]},$.prototype.getInputWidth=function(M){return this._inputDimensions[M][1]},$.prototype.getReshapedInputDimensions=function(M){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return cu({width:this.getInputWidth(M),height:this.getInputHeight(M)},this.inputSize)},$.prototype.toBatchTensor=function(M,T){var O=this;return T===void 0&&(T=!0),this._inputSize=M,bn.tidy(function(){var L=oa(O.batchSize,0,1).map(function(J){var ie=O.getInput(J);if(ie instanceof bn.Tensor){var ge=is(ie)?ie:ie.expandDims();return(ge=Yu(ge,T)).shape[1]===M&&ge.shape[2]===M||(ge=bn.image.resizeBilinear(ge,[M,M])),ge.as3D(M,M,3)}if(ie instanceof un.getEnv().Canvas)return bn.browser.fromPixels(Si(ie,M,T));throw new Error("toBatchTensor - at batchIdx "+J+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+ie)});return bn.stack(L.map(function(J){return J.toFloat()})).as4D(O.batchSize,M,M,3)})},$}();function gi($){return Object(tr.b)(this,void 0,void 0,function(){var M,T,O;return Object(tr.d)(this,function(L){switch(L.label){case 0:if($ instanceof si)return[2,$];if(!(M=Array.isArray($)?$:[$]).length)throw new Error("toNetInput - empty array passed as input");return T=function(J){return Array.isArray($)?" at input index "+J+":":""},(O=M.map(ht)).forEach(function(J,ie){if(!wi(J)&&!mr(J)&&!is(J))throw typeof M[ie]=="string"?new Error("toNetInput -"+T(ie)+" string passed, but could not resolve HTMLElement for element id "+M[ie]):new Error("toNetInput -"+T(ie)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(is(J)){var ge=J.shape[0];if(ge!==1)throw new Error("toNetInput -"+T(ie)+" tf.Tensor4D with batchSize "+ge+" passed, but not supported in input array")}}),[4,Promise.all(O.map(function(J){return wi(J)&&Tr(J)}))];case 1:return L.sent(),[2,new si(O,Array.isArray($))]}})})}function po($,M){return Object(tr.b)(this,void 0,void 0,function(){var T,O,L,J,ie,ge;return Object(tr.d)(this,function(Ae){switch(Ae.label){case 0:return T=un.getEnv().Canvas,O=$,$ instanceof T?[3,5]:[4,gi($)];case 1:if((L=Ae.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(J=L.getInput(0))instanceof T?(ie=J,[3,4]):[3,2];case 2:return[4,ii(J)];case 3:ie=Ae.sent(),Ae.label=4;case 4:O=ie,Ae.label=5;case 5:return ge=In(O),[2,M.map(function(Ie){return Ie instanceof aa?Ie.forSize(O.width,O.height).box.floor():Ie}).map(function(Ie){return Ie.clipAtImageBorders(O.width,O.height)}).map(function(Ie){var De=Ie.x,et=Ie.y,ot=Ie.width,zt=Ie.height,Ht=Fr({width:ot,height:zt});return In(Ht).putImageData(ge.getImageData(De,et,ot,zt),0,0),Ht})]}})})}function ho($,M){return Object(tr.b)(this,void 0,void 0,function(){return Object(tr.d)(this,function(T){if(!mr($)&&!is($))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(is($)&&$.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,bn.tidy(function(){var O=$.shape.slice(is($)?1:0),L=O[0],J=O[1],ie=O[2];return M.map(function(ge){return ge instanceof aa?ge.forSize(J,L).box:ge}).map(function(ge){return ge.clipAtImageBorders(J,L)}).map(function(ge){var Ae=ge.x,Ie=ge.y,De=ge.width,et=ge.height;return bn.slice3d($.as3D(L,J,ie),[Ie,Ae,0],[et,De,ie])})})]})})}function Ko($,M){return Object(tr.b)(this,void 0,void 0,function(){var T;return Object(tr.d)(this,function(O){switch(O.label){case 0:return[4,(0,un.getEnv().fetch)($,M)];case 1:if(!((T=O.sent()).status<400))throw new Error("failed to fetch: ("+T.status+") "+T.statusText+", from url: "+T.url);return[2,T]}})})}function Ki($){return Object(tr.b)(this,void 0,void 0,function(){var M,T;return Object(tr.d)(this,function(O){switch(O.label){case 0:return[4,Ko($)];case 1:return[4,(M=O.sent()).blob()];case 2:if(!(T=O.sent()).type.startsWith("image/"))throw new Error("fetchImage - expected blob type to be of type image/*, instead have: "+T.type+", for url: "+M.url);return[2,$r(T)]}})})}function mo($){return Object(tr.b)(this,void 0,void 0,function(){return Object(tr.d)(this,function(M){switch(M.label){case 0:return[4,Ko($)];case 1:return[2,M.sent().json()]}})})}function pa($){return Object(tr.b)(this,void 0,void 0,function(){var M;return Object(tr.d)(this,function(T){switch(T.label){case 0:return M=Float32Array.bind,[4,Ko($)];case 1:return[4,T.sent().arrayBuffer()];case 2:return[2,new(M.apply(Float32Array,[void 0,T.sent()]))]}})})}function Go($,M){var T=M+"-weights_manifest.json";if(!$)return{modelBaseUri:"",manifestUri:T};if($==="/")return{modelBaseUri:"/",manifestUri:"/"+T};var O=$.startsWith("http://")?"http://":$.startsWith("https://")?"https://":"",L=($=$.replace(O,"")).split("/").filter(function(ge){return ge}),J=$.endsWith(".json")?L[L.length-1]:T,ie=O+($.endsWith(".json")?L.slice(0,L.length-1):L).join("/");return{modelBaseUri:ie=$.startsWith("/")?"/"+ie:ie,manifestUri:ie==="/"?"/"+J:ie+"/"+J}}function sa($,M){return Object(tr.b)(this,void 0,void 0,function(){var T,O,L,J;return Object(tr.d)(this,function(ie){switch(ie.label){case 0:return T=Go($,M),O=T.manifestUri,L=T.modelBaseUri,[4,mo(O)];case 1:return J=ie.sent(),[2,bn.io.loadWeights(J,L)]}})})}function Gi($,M,T){T===void 0&&(T=!1);var O=T?ai(M):M,L=O.width,J=O.height;return $.width=L,$.height=J,{width:L,height:J}}var Vi=function(){function $(M){this._name=M,this._params=void 0,this._paramMappings=[]}return Object.defineProperty($.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),$.prototype.getParamFromPath=function(M){var T=this.traversePropertyPath(M);return T.obj[T.objProp]},$.prototype.reassignParamFromPath=function(M,T){var O=this.traversePropertyPath(M),L=O.obj,J=O.objProp;L[J].dispose(),L[J]=T},$.prototype.getParamList=function(){var M=this;return this._paramMappings.map(function(T){var O=T.paramPath;return{path:O,tensor:M.getParamFromPath(O)}})},$.prototype.getTrainableParams=function(){return this.getParamList().filter(function(M){return M.tensor instanceof bn.Variable})},$.prototype.getFrozenParams=function(){return this.getParamList().filter(function(M){return!(M.tensor instanceof bn.Variable)})},$.prototype.variable=function(){var M=this;this.getFrozenParams().forEach(function(T){var O=T.path,L=T.tensor;M.reassignParamFromPath(O,L.variable())})},$.prototype.freeze=function(){var M=this;this.getTrainableParams().forEach(function(T){var O=T.path,L=T.tensor,J=bn.tensor(L.dataSync());L.dispose(),M.reassignParamFromPath(O,J)})},$.prototype.dispose=function(M){M===void 0&&(M=!0),this.getParamList().forEach(function(T){if(M&&T.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+T.path);T.tensor.dispose()}),this._params=void 0},$.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(M){var T=M.tensor;return Array.from(T.dataSync())}).reduce(function(M,T){return M.concat(T)}))},$.prototype.load=function(M){return Object(tr.b)(this,void 0,void 0,function(){return Object(tr.d)(this,function(T){switch(T.label){case 0:return M instanceof Float32Array?(this.extractWeights(M),[2]):[4,this.loadFromUri(M)];case 1:return T.sent(),[2]}})})},$.prototype.loadFromUri=function(M){return Object(tr.b)(this,void 0,void 0,function(){var T;return Object(tr.d)(this,function(O){switch(O.label){case 0:if(M&&typeof M!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,sa(M,this.getDefaultModelName())];case 1:return T=O.sent(),this.loadFromWeightMap(T),[2]}})})},$.prototype.loadFromDisk=function(M){return Object(tr.b)(this,void 0,void 0,function(){var T,O,L,J,ie,ge,Ae,Ie,De,et;return Object(tr.d)(this,function(ot){switch(ot.label){case 0:if(M&&typeof M!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return T=un.getEnv().readFile,O=Go(M,this.getDefaultModelName()),L=O.manifestUri,J=O.modelBaseUri,ie=function(zt){return Promise.all(zt.map(function(Ht){return T(Ht).then(function(xn){return xn.buffer})}))},ge=bn.io.weightsLoaderFactory(ie),De=(Ie=JSON).parse,[4,T(L)];case 1:return Ae=De.apply(Ie,[ot.sent().toString()]),[4,ge(Ae,J)];case 2:return et=ot.sent(),this.loadFromWeightMap(et),[2]}})})},$.prototype.loadFromWeightMap=function(M){var T=this.extractParamsFromWeigthMap(M),O=T.paramMappings,L=T.params;this._paramMappings=O,this._params=L},$.prototype.extractWeights=function(M){var T=this.extractParams(M),O=T.paramMappings,L=T.params;this._paramMappings=O,this._params=L},$.prototype.traversePropertyPath=function(M){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var T=M.split("/").reduce(function(J,ie){if(!J.nextObj.hasOwnProperty(ie))throw new Error("traversePropertyPath - object does not have property "+ie+", for path "+M);return{obj:J.nextObj,objProp:ie,nextObj:J.nextObj[ie]}},{nextObj:this.params}),O=T.obj,L=T.objProp;if(!(O&&L&&O[L]instanceof bn.Tensor))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+M);return{obj:O,objProp:L}},$}();function Ao($,M,T){return bn.tidy(function(){var O=bn.separableConv2d($,M.depthwise_filter,M.pointwise_filter,T,"same");return O=bn.add(O,M.bias)})}function wa($,M,T){return T===void 0&&(T=!1),bn.tidy(function(){var O=bn.relu(T?bn.add(bn.conv2d($,M.conv0.filters,[2,2],"same"),M.conv0.bias):Ao($,M.conv0,[2,2])),L=Ao(O,M.conv1,[1,1]),J=Ao(bn.relu(bn.add(O,L)),M.conv2,[1,1]);return bn.relu(bn.add(O,bn.add(L,J)))})}function Sa($,M,T,O){return T===void 0&&(T=!1),O===void 0&&(O=!0),bn.tidy(function(){var L=bn.relu(T?bn.add(bn.conv2d($,M.conv0.filters,O?[2,2]:[1,1],"same"),M.conv0.bias):Ao($,M.conv0,O?[2,2]:[1,1])),J=Ao(L,M.conv1,[1,1]),ie=Ao(bn.relu(bn.add(L,J)),M.conv2,[1,1]),ge=Ao(bn.relu(bn.add(L,bn.add(J,ie))),M.conv3,[1,1]);return bn.relu(bn.add(L,bn.add(J,bn.add(ie,ge))))})}function ga($,M,T,O){return T===void 0&&(T="same"),O===void 0&&(O=!1),bn.tidy(function(){var L=bn.add(bn.conv2d($,M.filters,[1,1],T),M.bias);return O?bn.relu(L):L})}function ua($,M){Object.keys($).forEach(function(T){M.some(function(O){return O.originalPath===T})||$[T].dispose()})}function ds($,M){return function(T,O,L,J){var ie=bn.tensor4d($(T*O*L*L),[L,L,T,O]),ge=bn.tensor1d($(O));return M.push({paramPath:J+"/filters"},{paramPath:J+"/bias"}),{filters:ie,bias:ge}}}function Ca($,M){return function(T,O,L){var J=bn.tensor2d($(T*O),[T,O]),ie=bn.tensor1d($(O));return M.push({paramPath:L+"/weights"},{paramPath:L+"/bias"}),{weights:J,bias:ie}}}var Oo=function(){return function($,M,T){this.depthwise_filter=$,this.pointwise_filter=M,this.bias=T}}();function Ia($,M){return function(T,O,L){var J=bn.tensor4d($(9*T),[3,3,T,1]),ie=bn.tensor4d($(T*O),[1,1,T,O]),ge=bn.tensor1d($(O));return M.push({paramPath:L+"/depthwise_filter"},{paramPath:L+"/pointwise_filter"},{paramPath:L+"/bias"}),new Oo(J,ie,ge)}}function Zu($){return function(M){var T=$(M+"/depthwise_filter",4),O=$(M+"/pointwise_filter",4),L=$(M+"/bias",1);return new Oo(T,O,L)}}function Cs($,M){return function(T,O,L){var J=$[T];if(!vo(J,O))throw new Error("expected weightMap["+T+"] to be a Tensor"+O+"D, instead have "+J);return M.push({originalPath:T,paramPath:L||T}),J}}function $a($){var M=$;return{extractWeights:function(T){var O=M.slice(0,T);return M=M.slice(T),O},getRemainingWeights:function(){return M}}}function Uo($,M){var T=ds($,M),O=Ia($,M);function L(J,ie,ge,Ae){return Ae===void 0&&(Ae=!1),{conv0:Ae?T(J,ie,3,ge+"/conv0"):O(J,ie,ge+"/conv0"),conv1:O(ie,ie,ge+"/conv1"),conv2:O(ie,ie,ge+"/conv2")}}return{extractDenseBlock3Params:L,extractDenseBlock4Params:function(J,ie,ge,Ae){Ae===void 0&&(Ae=!1);var Ie=L(J,ie,ge,Ae);return{conv0:Ie.conv0,conv1:Ie.conv1,conv2:Ie.conv2,conv3:O(ie,ie,ge+"/conv3")}}}}function jc($){return function(M){return{filters:$(M+"/filters",4),bias:$(M+"/bias",1)}}}function hu($,M){var T=Cs($,M),O=jc(T),L=Zu(T);return{extractDenseBlock3Params:function(J,ie){return ie===void 0&&(ie=!1),{conv0:ie?O(J+"/conv0"):L(J+"/conv0"),conv1:L(J+"/conv1"),conv2:L(J+"/conv2")}},extractDenseBlock4Params:function(J,ie){return ie===void 0&&(ie=!1),{conv0:ie?O(J+"/conv0"):L(J+"/conv0"),conv1:L(J+"/conv1"),conv2:L(J+"/conv2"),conv3:L(J+"/conv3")}}}}var Ys=function($){function M(){return $.call(this,"FaceFeatureExtractor")||this}return Object(tr.c)(M,$),M.prototype.forwardInput=function(T){var O=this.params;if(!O)throw new Error("FaceFeatureExtractor - load model before inference");return bn.tidy(function(){var L=Sa(Bc(T.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(bn.scalar(255)),O.dense0,!0);return L=Sa(L=Sa(L=Sa(L,O.dense1),O.dense2),O.dense3),L=bn.avgPool(L,[7,7],[2,2],"valid")})},M.prototype.forward=function(T){return Object(tr.b)(this,void 0,void 0,function(){var O;return Object(tr.d)(this,function(L){switch(L.label){case 0:return O=this.forwardInput,[4,gi(T)];case 1:return[2,O.apply(this,[L.sent()])]}})})},M.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},M.prototype.extractParamsFromWeigthMap=function(T){return function(O){var L=[],J=hu(O,L).extractDenseBlock4Params,ie={dense0:J("dense0",!0),dense1:J("dense1"),dense2:J("dense2"),dense3:J("dense3")};return ua(O,L),{params:ie,paramMappings:L}}(T)},M.prototype.extractParams=function(T){return function(O){var L=[],J=$a(O),ie=J.extractWeights,ge=J.getRemainingWeights,Ae=Uo(ie,L).extractDenseBlock4Params,Ie=Ae(3,32,"dense0",!0),De=Ae(32,64,"dense1"),et=Ae(64,128,"dense2"),ot=Ae(128,256,"dense3");if(ge().length!==0)throw new Error("weights remaing after extract: "+ge().length);return{paramMappings:L,params:{dense0:Ie,dense1:De,dense2:et,dense3:ot}}}(T)},M}(Vi);function ca($,M){return bn.tidy(function(){return bn.add(bn.matMul($,M.weights),M.bias)})}function Js($){var M={},T={};return Object.keys($).forEach(function(O){(O.startsWith("fc")?T:M)[O]=$[O]}),{featureExtractorMap:M,classifierMap:T}}var Wo=function($){function M(T,O){var L=$.call(this,T)||this;return L._faceFeatureExtractor=O,L}return Object(tr.c)(M,$),Object.defineProperty(M.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),M.prototype.runNet=function(T){var O=this,L=this.params;if(!L)throw new Error(this._name+" - load model before inference");return bn.tidy(function(){var J=T instanceof si?O.faceFeatureExtractor.forwardInput(T):T;return ca(J.as2D(J.shape[0],-1),L.fc)})},M.prototype.dispose=function(T){T===void 0&&(T=!0),this.faceFeatureExtractor.dispose(T),$.prototype.dispose.call(this,T)},M.prototype.loadClassifierParams=function(T){var O=this.extractClassifierParams(T),L=O.params,J=O.paramMappings;this._params=L,this._paramMappings=J},M.prototype.extractClassifierParams=function(T){return function(O,L,J){var ie=[],ge=$a(O),Ae=ge.extractWeights,Ie=ge.getRemainingWeights,De=Ca(Ae,ie)(L,J,"fc");if(Ie().length!==0)throw new Error("weights remaing after extract: "+Ie().length);return{paramMappings:ie,params:{fc:De}}}(T,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},M.prototype.extractParamsFromWeigthMap=function(T){var O=Js(T),L=O.featureExtractorMap,J=O.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(L),function(ie){var ge=[],Ae=Cs(ie,ge),Ie={fc:function(De){return{weights:Ae(De+"/weights",2),bias:Ae(De+"/bias",1)}}("fc")};return ua(ie,ge),{params:Ie,paramMappings:ge}}(J)},M.prototype.extractParams=function(T){var O=this.getClassifierChannelsIn(),L=this.getClassifierChannelsOut(),J=L*O+L,ie=T.slice(0,T.length-J),ge=T.slice(T.length-J);return this.faceFeatureExtractor.extractWeights(ie),this.extractClassifierParams(ge)},M}(Vi),zs=["neutral","happy","sad","angry","fearful","disgusted","surprised"],ks=function(){function $(M){var T=this;if(M.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+M.length);zs.forEach(function(O,L){T[O]=M[L]})}return $.prototype.asSortedArray=function(){var M=this;return zs.map(function(T){return{expression:T,probability:M[T]}}).sort(function(T,O){return O.probability-T.probability})},$}(),yo=function($){function M(T){return T===void 0&&(T=new Ys),$.call(this,"FaceExpressionNet",T)||this}return Object(tr.c)(M,$),M.prototype.forwardInput=function(T){var O=this;return bn.tidy(function(){return bn.softmax(O.runNet(T))})},M.prototype.forward=function(T){return Object(tr.b)(this,void 0,void 0,function(){var O;return Object(tr.d)(this,function(L){switch(L.label){case 0:return O=this.forwardInput,[4,gi(T)];case 1:return[2,O.apply(this,[L.sent()])]}})})},M.prototype.predictExpressions=function(T){return Object(tr.b)(this,void 0,void 0,function(){var O,L,J,ie,ge=this;return Object(tr.d)(this,function(Ae){switch(Ae.label){case 0:return[4,gi(T)];case 1:return O=Ae.sent(),[4,this.forwardInput(O)];case 2:return L=Ae.sent(),[4,Promise.all(bn.unstack(L).map(function(Ie){return Object(tr.b)(ge,void 0,void 0,function(){var De;return Object(tr.d)(this,function(et){switch(et.label){case 0:return[4,Ie.data()];case 1:return De=et.sent(),Ie.dispose(),[2,De]}})})}))];case 3:return J=Ae.sent(),L.dispose(),ie=J.map(function(Ie){return new ks(Ie)}),[2,O.isBatchInput?ie:ie[0]]}})})},M.prototype.getDefaultModelName=function(){return"face_expression_model"},M.prototype.getClassifierChannelsIn=function(){return 256},M.prototype.getClassifierChannelsOut=function(){return 7},M}(Wo);function Us($){return $.expressions instanceof ks}function os($,M){var T={expressions:M};return Object.assign({},$,T)}function pu($,M,T,O){T===void 0&&(T=.1),(Array.isArray(M)?M:[M]).forEach(function(L){var J=L instanceof ks?L:Us(L)?L.expressions:void 0;if(!J)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var ie=J.asSortedArray().filter(function(Ae){return Ae.probability>T}),ge=Of(L)?L.detection.box.bottomLeft:O||new bo(0,0);new Gn(ie.map(function(Ae){return Ae.expression+" ("+Xu(Ae.probability)+")"}),ge).draw($)})}function ul($){return Of($)&&$.landmarks instanceof du&&$.unshiftedLandmarks instanceof du&&$.alignedRect instanceof aa}function Yo($,M){var T=$.detection.box,O=M.shiftBy(T.x,T.y),L=O.align(),J=$.detection.imageDims,ie={landmarks:O,unshiftedLandmarks:M,alignedRect:new aa($.detection.score,L.rescale(J.reverse()),J)};return Object.assign({},$,ie)}var hs=function(){return function($){$===void 0&&($={});var M=$.drawLines,T=M===void 0||M,O=$.drawPoints,L=O===void 0||O,J=$.lineWidth,ie=$.lineColor,ge=$.pointSize,Ae=$.pointColor;this.drawLines=T,this.drawPoints=L,this.lineWidth=J||1,this.pointSize=ge||2,this.lineColor=ie||"rgba(0, 255, 255, 1)",this.pointColor=Ae||"rgba(255, 0, 255, 1)"}}(),Xa=function(){function $(M,T){T===void 0&&(T={}),this.faceLandmarks=M,this.options=new hs(T)}return $.prototype.draw=function(M){var T=In(M),O=this.options,L=O.drawLines,J=O.drawPoints,ie=O.lineWidth,ge=O.lineColor,Ae=O.pointSize,Ie=O.pointColor;L&&this.faceLandmarks instanceof Qu&&(T.strokeStyle=ge,T.lineWidth=ie,uu(T,this.faceLandmarks.getJawOutline()),uu(T,this.faceLandmarks.getLeftEyeBrow()),uu(T,this.faceLandmarks.getRightEyeBrow()),uu(T,this.faceLandmarks.getNose()),uu(T,this.faceLandmarks.getLeftEye(),!0),uu(T,this.faceLandmarks.getRightEye(),!0),uu(T,this.faceLandmarks.getMouth(),!0)),J&&(T.strokeStyle=Ie,T.fillStyle=Ie,this.faceLandmarks.positions.forEach(function(De){T.beginPath(),T.arc(De.x,De.y,Ae,0,2*Math.PI),T.fill()}))},$}();function zc($,M){(Array.isArray(M)?M:[M]).forEach(function(T){var O=T instanceof du?T:ul(T)?T.landmarks:void 0;if(!O)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new Xa(O).draw($)})}function zl($,M){var T=[],O=$a($),L=O.extractWeights,J=O.getRemainingWeights,ie=function(Ht,xn){var En=ds(Ht,xn),Fn=Ia(Ht,xn);return{extractConvParams:En,extractSeparableConvParams:Fn,extractReductionBlockParams:function(Rn,Wn,Jn){return{separable_conv0:Fn(Rn,Wn,Jn+"/separable_conv0"),separable_conv1:Fn(Wn,Wn,Jn+"/separable_conv1"),expansion_conv:En(Rn,Wn,1,Jn+"/expansion_conv")}},extractMainBlockParams:function(Rn,Wn){return{separable_conv0:Fn(Rn,Rn,Wn+"/separable_conv0"),separable_conv1:Fn(Rn,Rn,Wn+"/separable_conv1"),separable_conv2:Fn(Rn,Rn,Wn+"/separable_conv2")}}}}(L,T),ge=ie.extractConvParams,Ae=ie.extractSeparableConvParams,Ie=ie.extractReductionBlockParams,De=ie.extractMainBlockParams,et={conv_in:ge(3,32,3,"entry_flow/conv_in"),reduction_block_0:Ie(32,64,"entry_flow/reduction_block_0"),reduction_block_1:Ie(64,128,"entry_flow/reduction_block_1")},ot={};oa(M,0,1).forEach(function(Ht){ot["main_block_"+Ht]=De(128,"middle_flow/main_block_"+Ht)});var zt={reduction_block:Ie(128,256,"exit_flow/reduction_block"),separable_conv:Ae(256,512,"exit_flow/separable_conv")};if(J().length!==0)throw new Error("weights remaing after extract: "+J().length);return{paramMappings:T,params:{entry_flow:et,middle_flow:ot,exit_flow:zt}}}function Ei($,M){var T=[],O=function(et,ot){var zt=Cs(et,ot),Ht=jc(zt),xn=Zu(zt);return{extractConvParams:Ht,extractSeparableConvParams:xn,extractReductionBlockParams:function(En){return{separable_conv0:xn(En+"/separable_conv0"),separable_conv1:xn(En+"/separable_conv1"),expansion_conv:Ht(En+"/expansion_conv")}},extractMainBlockParams:function(En){return{separable_conv0:xn(En+"/separable_conv0"),separable_conv1:xn(En+"/separable_conv1"),separable_conv2:xn(En+"/separable_conv2")}}}}($,T),L=O.extractConvParams,J=O.extractSeparableConvParams,ie=O.extractReductionBlockParams,ge=O.extractMainBlockParams,Ae={conv_in:L("entry_flow/conv_in"),reduction_block_0:ie("entry_flow/reduction_block_0"),reduction_block_1:ie("entry_flow/reduction_block_1")},Ie={};oa(M,0,1).forEach(function(et){Ie["main_block_"+et]=ge("middle_flow/main_block_"+et)});var De={reduction_block:ie("exit_flow/reduction_block"),separable_conv:J("exit_flow/separable_conv")};return ua($,T),{params:{entry_flow:Ae,middle_flow:Ie,exit_flow:De},paramMappings:T}}function sm($,M,T){return bn.add(bn.conv2d($,M.filters,T,"same"),M.bias)}function Ul($,M,T){T===void 0&&(T=!0);var O=T?bn.relu($):$;return O=Ao(O,M.separable_conv0,[1,1]),O=Ao(bn.relu(O),M.separable_conv1,[1,1]),O=bn.maxPool(O,[3,3],[2,2],"same"),O=bn.add(O,sm($,M.expansion_conv,[2,2]))}var Tf,uv=function($){function M(T){var O=$.call(this,"TinyXception")||this;return O._numMainBlocks=T,O}return Object(tr.c)(M,$),M.prototype.forwardInput=function(T){var O=this,L=this.params;if(!L)throw new Error("TinyXception - load model before inference");return bn.tidy(function(){var J=Bc(T.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(bn.scalar(256)),ie=bn.relu(sm(J,L.entry_flow.conv_in,[2,2]));return ie=Ul(ie=Ul(ie,L.entry_flow.reduction_block_0,!1),L.entry_flow.reduction_block_1),oa(O._numMainBlocks,0,1).forEach(function(ge){ie=function(Ae,Ie){var De=Ao(bn.relu(Ae),Ie.separable_conv0,[1,1]);return De=Ao(bn.relu(De),Ie.separable_conv1,[1,1]),De=Ao(bn.relu(De),Ie.separable_conv2,[1,1]),De=bn.add(De,Ae)}(ie,L.middle_flow["main_block_"+ge])}),ie=Ul(ie,L.exit_flow.reduction_block),ie=bn.relu(Ao(ie,L.exit_flow.separable_conv,[1,1]))})},M.prototype.forward=function(T){return Object(tr.b)(this,void 0,void 0,function(){var O;return Object(tr.d)(this,function(L){switch(L.label){case 0:return O=this.forwardInput,[4,gi(T)];case 1:return[2,O.apply(this,[L.sent()])]}})})},M.prototype.getDefaultModelName=function(){return"tiny_xception_model"},M.prototype.extractParamsFromWeigthMap=function(T){return Ei(T,this._numMainBlocks)},M.prototype.extractParams=function(T){return zl(T,this._numMainBlocks)},M}(Vi);(function($){$.FEMALE="female",$.MALE="male"})(Tf||(Tf={}));var cv=function($){function M(T){T===void 0&&(T=new uv(2));var O=$.call(this,"AgeGenderNet")||this;return O._faceFeatureExtractor=T,O}return Object(tr.c)(M,$),Object.defineProperty(M.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),M.prototype.runNet=function(T){var O=this,L=this.params;if(!L)throw new Error(this._name+" - load model before inference");return bn.tidy(function(){var J=T instanceof si?O.faceFeatureExtractor.forwardInput(T):T,ie=bn.avgPool(J,[7,7],[2,2],"valid").as2D(J.shape[0],-1);return{age:ca(ie,L.fc.age).as1D(),gender:ca(ie,L.fc.gender)}})},M.prototype.forwardInput=function(T){var O=this;return bn.tidy(function(){var L=O.runNet(T),J=L.age,ie=L.gender;return{age:J,gender:bn.softmax(ie)}})},M.prototype.forward=function(T){return Object(tr.b)(this,void 0,void 0,function(){var O;return Object(tr.d)(this,function(L){switch(L.label){case 0:return O=this.forwardInput,[4,gi(T)];case 1:return[2,O.apply(this,[L.sent()])]}})})},M.prototype.predictAgeAndGender=function(T){return Object(tr.b)(this,void 0,void 0,function(){var O,L,J,ie,ge,Ae,Ie=this;return Object(tr.d)(this,function(De){switch(De.label){case 0:return[4,gi(T)];case 1:return O=De.sent(),[4,this.forwardInput(O)];case 2:return L=De.sent(),J=bn.unstack(L.age),ie=bn.unstack(L.gender),ge=J.map(function(et,ot){return{ageTensor:et,genderTensor:ie[ot]}}),[4,Promise.all(ge.map(function(et){var ot=et.ageTensor,zt=et.genderTensor;return Object(tr.b)(Ie,void 0,void 0,function(){var Ht,xn,En,Fn,Rn;return Object(tr.d)(this,function(Wn){switch(Wn.label){case 0:return[4,ot.data()];case 1:return Ht=Wn.sent()[0],[4,zt.data()];case 2:return xn=Wn.sent()[0],Fn=(En=xn>.5)?Tf.MALE:Tf.FEMALE,Rn=En?xn:1-xn,ot.dispose(),zt.dispose(),[2,{age:Ht,gender:Fn,genderProbability:Rn}]}})})}))];case 3:return Ae=De.sent(),L.age.dispose(),L.gender.dispose(),[2,O.isBatchInput?Ae:Ae[0]]}})})},M.prototype.getDefaultModelName=function(){return"age_gender_model"},M.prototype.dispose=function(T){T===void 0&&(T=!0),this.faceFeatureExtractor.dispose(T),$.prototype.dispose.call(this,T)},M.prototype.loadClassifierParams=function(T){var O=this.extractClassifierParams(T),L=O.params,J=O.paramMappings;this._params=L,this._paramMappings=J},M.prototype.extractClassifierParams=function(T){return function(O){var L=[],J=$a(O),ie=J.extractWeights,ge=J.getRemainingWeights,Ae=Ca(ie,L),Ie=Ae(512,1,"fc/age"),De=Ae(512,2,"fc/gender");if(ge().length!==0)throw new Error("weights remaing after extract: "+ge().length);return{paramMappings:L,params:{fc:{age:Ie,gender:De}}}}(T)},M.prototype.extractParamsFromWeigthMap=function(T){var O=Js(T),L=O.featureExtractorMap,J=O.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(L),function(ie){var ge=[],Ae=Cs(ie,ge);function Ie(et){return{weights:Ae(et+"/weights",2),bias:Ae(et+"/bias",1)}}var De={fc:{age:Ie("fc/age"),gender:Ie("fc/gender")}};return ua(ie,ge),{params:De,paramMappings:ge}}(J)},M.prototype.extractParams=function(T){var O=T.slice(0,T.length-1539),L=T.slice(T.length-1539);return this.faceFeatureExtractor.extractWeights(O),this.extractClassifierParams(L)},M}(Vi),t0=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.postProcess=function(T,O,L){var J=L.map(function(ge){var Ae=ge.width,Ie=ge.height,De=O/Math.max(Ie,Ae);return{width:Ae*De,height:Ie*De}}),ie=J.length;return bn.tidy(function(){var ge=function(Ie,De){return bn.stack([bn.fill([68],Ie),bn.fill([68],De)],1).as2D(1,136).as1D()},Ae=function(Ie,De){var et=J[Ie],ot=et.width,zt=et.height;return De(ot,zt)?Math.abs(ot-zt)/2:0};return T.mul(bn.fill([ie,136],O)).sub(bn.stack(Array.from(Array(ie),function(Ie,De){return ge(function(et){return Ae(et,function(ot,zt){return ot<zt})}(De),function(et){return Ae(et,function(ot,zt){return zt<ot})}(De))}))).div(bn.stack(Array.from(Array(ie),function(Ie,De){return ge(J[De].width,J[De].height)})))})},M.prototype.forwardInput=function(T){var O=this;return bn.tidy(function(){var L=O.runNet(T);return O.postProcess(L,T.inputSize,T.inputDimensions.map(function(J){return{height:J[0],width:J[1]}}))})},M.prototype.forward=function(T){return Object(tr.b)(this,void 0,void 0,function(){var O;return Object(tr.d)(this,function(L){switch(L.label){case 0:return O=this.forwardInput,[4,gi(T)];case 1:return[2,O.apply(this,[L.sent()])]}})})},M.prototype.detectLandmarks=function(T){return Object(tr.b)(this,void 0,void 0,function(){var O,L,J,ie=this;return Object(tr.d)(this,function(ge){switch(ge.label){case 0:return[4,gi(T)];case 1:return O=ge.sent(),L=bn.tidy(function(){return bn.unstack(ie.forwardInput(O))}),[4,Promise.all(L.map(function(Ae,Ie){return Object(tr.b)(ie,void 0,void 0,function(){var De,et,ot,zt,Ht;return Object(tr.d)(this,function(xn){switch(xn.label){case 0:return ot=(et=Array).from,[4,Ae.data()];case 1:return De=ot.apply(et,[xn.sent()]),zt=De.filter(function(En,Fn){return io(Fn)}),Ht=De.filter(function(En,Fn){return!io(Fn)}),[2,new Qu(Array(68).fill(0).map(function(En,Fn){return new bo(zt[Fn],Ht[Fn])}),{height:O.getInputHeight(Ie),width:O.getInputWidth(Ie)})]}})})}))];case 2:return J=ge.sent(),L.forEach(function(Ae){return Ae.dispose()}),[2,O.isBatchInput?J:J[0]]}})})},M.prototype.getClassifierChannelsOut=function(){return 136},M}(Wo),n0=function($){function M(T){return T===void 0&&(T=new Ys),$.call(this,"FaceLandmark68Net",T)||this}return Object(tr.c)(M,$),M.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},M.prototype.getClassifierChannelsIn=function(){return 256},M}(t0),lv=function($){function M(){return $.call(this,"TinyFaceFeatureExtractor")||this}return Object(tr.c)(M,$),M.prototype.forwardInput=function(T){var O=this.params;if(!O)throw new Error("TinyFaceFeatureExtractor - load model before inference");return bn.tidy(function(){var L=wa(Bc(T.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(bn.scalar(255)),O.dense0,!0);return L=wa(L=wa(L,O.dense1),O.dense2),L=bn.avgPool(L,[14,14],[2,2],"valid")})},M.prototype.forward=function(T){return Object(tr.b)(this,void 0,void 0,function(){var O;return Object(tr.d)(this,function(L){switch(L.label){case 0:return O=this.forwardInput,[4,gi(T)];case 1:return[2,O.apply(this,[L.sent()])]}})})},M.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},M.prototype.extractParamsFromWeigthMap=function(T){return function(O){var L=[],J=hu(O,L).extractDenseBlock3Params,ie={dense0:J("dense0",!0),dense1:J("dense1"),dense2:J("dense2")};return ua(O,L),{params:ie,paramMappings:L}}(T)},M.prototype.extractParams=function(T){return function(O){var L=[],J=$a(O),ie=J.extractWeights,ge=J.getRemainingWeights,Ae=Uo(ie,L).extractDenseBlock3Params,Ie=Ae(3,32,"dense0",!0),De=Ae(32,64,"dense1"),et=Ae(64,128,"dense2");if(ge().length!==0)throw new Error("weights remaing after extract: "+ge().length);return{paramMappings:L,params:{dense0:Ie,dense1:De,dense2:et}}}(T)},M}(Vi),r0=function($){function M(T){return T===void 0&&(T=new lv),$.call(this,"FaceLandmark68TinyNet",T)||this}return Object(tr.c)(M,$),M.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},M.prototype.getClassifierChannelsIn=function(){return 128},M}(t0),fv=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M}(n0);function Id($,M,T,O,L){L===void 0&&(L="same");var J=M.conv,ie=J.filters,ge=J.bias,Ae=bn.conv2d($,ie,T,L);return Ae=function(Ie,De){return bn.add(bn.mul(Ie,De.weights),De.biases)}(Ae=bn.add(Ae,ge),M.scale),O?bn.relu(Ae):Ae}function um($,M){return Id($,M,[1,1],!1)}function dv($,M){return Id($,M,[2,2],!0,"valid")}function hv($,M){function T(L,J,ie,ge){var Ae=function(De,et,ot){var zt=$(De),Ht=zt.length/(et*ot*ot);if(Na(Ht))throw new Error("depth has to be an integer: "+Ht+", weights.length: "+zt.length+", numFilters: "+et+", filterSize: "+ot);return bn.tidy(function(){return bn.transpose(bn.tensor4d(zt,[et,Ht,ot,ot]),[2,3,1,0])})}(L,J,ie),Ie=bn.tensor1d($(J));return M.push({paramPath:ge+"/filters"},{paramPath:ge+"/bias"}),{filters:Ae,bias:Ie}}function O(L,J,ie,ge){return{conv:T(L,J,ie,ge+"/conv"),scale:function(Ae,Ie){var De=bn.tensor1d($(Ae)),et=bn.tensor1d($(Ae));return M.push({paramPath:Ie+"/weights"},{paramPath:Ie+"/biases"}),{weights:De,biases:et}}(J,ge+"/scale")}}return{extractConvLayerParams:O,extractResidualLayerParams:function(L,J,ie,ge,Ae){return Ae===void 0&&(Ae=!1),{conv1:O((Ae?.5:1)*L,J,ie,ge+"/conv1"),conv2:O(L,J,ie,ge+"/conv2")}}}}function pv($,M){var T=Cs($,M);function O(L){return{conv:{filters:T(L+"/conv/filters",4),bias:T(L+"/conv/bias",1)},scale:function(J){return{weights:T(J+"/scale/weights",1),biases:T(J+"/scale/biases",1)}}(L)}}return{extractConvLayerParams:O,extractResidualLayerParams:function(L){return{conv1:O(L+"/conv1"),conv2:O(L+"/conv2")}}}}function cl($,M){var T=function(O,L){return Id(O,L,[1,1],!0)}($,M.conv1);return T=um(T,M.conv2),T=bn.add(T,$),T=bn.relu(T)}function Fd($,M){var T=dv($,M.conv1);T=um(T,M.conv2);var O=bn.avgPool($,2,2,"valid"),L=bn.zeros(O.shape),J=O.shape[3]!==T.shape[3];if(O.shape[1]!==T.shape[1]||O.shape[2]!==T.shape[2]){var ie=Object(tr.e)(T.shape);ie[1]=1;var ge=bn.zeros(ie);T=bn.concat([T,ge],1);var Ae=Object(tr.e)(T.shape);Ae[2]=1;var Ie=bn.zeros(Ae);T=bn.concat([T,Ie],2)}return O=J?bn.concat([O,L],3):O,T=bn.add(O,T),T=bn.relu(T)}var cm=function($){function M(){return $.call(this,"FaceRecognitionNet")||this}return Object(tr.c)(M,$),M.prototype.forwardInput=function(T){var O=this.params;if(!O)throw new Error("FaceRecognitionNet - load model before inference");return bn.tidy(function(){var L=dv(Bc(T.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(bn.scalar(256)),O.conv32_down),J=(L=Fd(L=cl(L=cl(L=Fd(L=cl(L=cl(L=Fd(L=cl(L=cl(L=cl(L=Fd(L=cl(L=cl(L=cl(L=bn.maxPool(L,3,2,"valid"),O.conv32_1),O.conv32_2),O.conv32_3),O.conv64_down),O.conv64_1),O.conv64_2),O.conv64_3),O.conv128_down),O.conv128_1),O.conv128_2),O.conv256_down),O.conv256_1),O.conv256_2),O.conv256_down_out)).mean([1,2]);return bn.matMul(J,O.fc)})},M.prototype.forward=function(T){return Object(tr.b)(this,void 0,void 0,function(){var O;return Object(tr.d)(this,function(L){switch(L.label){case 0:return O=this.forwardInput,[4,gi(T)];case 1:return[2,O.apply(this,[L.sent()])]}})})},M.prototype.computeFaceDescriptor=function(T){return Object(tr.b)(this,void 0,void 0,function(){var O,L,J,ie=this;return Object(tr.d)(this,function(ge){switch(ge.label){case 0:return[4,gi(T)];case 1:return O=ge.sent(),L=bn.tidy(function(){return bn.unstack(ie.forwardInput(O))}),[4,Promise.all(L.map(function(Ae){return Ae.data()}))];case 2:return J=ge.sent(),L.forEach(function(Ae){return Ae.dispose()}),[2,O.isBatchInput?J:J[0]]}})})},M.prototype.getDefaultModelName=function(){return"face_recognition_model"},M.prototype.extractParamsFromWeigthMap=function(T){return function(O){var L=[],J=pv(O,L),ie=J.extractConvLayerParams,ge=J.extractResidualLayerParams,Ae=ie("conv32_down"),Ie=ge("conv32_1"),De=ge("conv32_2"),et=ge("conv32_3"),ot=ge("conv64_down"),zt=ge("conv64_1"),Ht=ge("conv64_2"),xn=ge("conv64_3"),En=ge("conv128_down"),Fn=ge("conv128_1"),Rn=ge("conv128_2"),Wn=ge("conv256_down"),Jn=ge("conv256_1"),Tn=ge("conv256_2"),_r=ge("conv256_down_out"),Nr=O.fc;if(L.push({originalPath:"fc",paramPath:"fc"}),!Td(Nr))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+Nr);var Ir={conv32_down:Ae,conv32_1:Ie,conv32_2:De,conv32_3:et,conv64_down:ot,conv64_1:zt,conv64_2:Ht,conv64_3:xn,conv128_down:En,conv128_1:Fn,conv128_2:Rn,conv256_down:Wn,conv256_1:Jn,conv256_2:Tn,conv256_down_out:_r,fc:Nr};return ua(O,L),{params:Ir,paramMappings:L}}(T)},M.prototype.extractParams=function(T){return function(O){var L=$a(O),J=L.extractWeights,ie=L.getRemainingWeights,ge=[],Ae=hv(J,ge),Ie=Ae.extractConvLayerParams,De=Ae.extractResidualLayerParams,et=Ie(4704,32,7,"conv32_down"),ot=De(9216,32,3,"conv32_1"),zt=De(9216,32,3,"conv32_2"),Ht=De(9216,32,3,"conv32_3"),xn=De(36864,64,3,"conv64_down",!0),En=De(36864,64,3,"conv64_1"),Fn=De(36864,64,3,"conv64_2"),Rn=De(36864,64,3,"conv64_3"),Wn=De(147456,128,3,"conv128_down",!0),Jn=De(147456,128,3,"conv128_1"),Tn=De(147456,128,3,"conv128_2"),_r=De(589824,256,3,"conv256_down",!0),Nr=De(589824,256,3,"conv256_1"),Ir=De(589824,256,3,"conv256_2"),Qr=De(589824,256,3,"conv256_down_out"),zr=bn.tidy(function(){return bn.transpose(bn.tensor2d(J(32768),[128,256]),[1,0])});if(ge.push({paramPath:"fc"}),ie().length!==0)throw new Error("weights remaing after extract: "+ie().length);return{params:{conv32_down:et,conv32_1:ot,conv32_2:zt,conv32_3:Ht,conv64_down:xn,conv64_1:En,conv64_2:Fn,conv64_3:Rn,conv128_down:Wn,conv128_1:Jn,conv128_2:Tn,conv256_down:_r,conv256_1:Nr,conv256_2:Ir,conv256_down_out:Qr,fc:zr},paramMappings:ge}}(T)},M}(Vi);function i0($){var M=new cm;return M.extractWeights($),M}function o0($,M){var T={descriptor:M};return Object.assign({},$,T)}function Ny($){return typeof $.age=="number"}function a0($,M){var T={age:M};return Object.assign({},$,T)}function qh($){return($.gender===Tf.MALE||$.gender===Tf.FEMALE)&&lu($.genderProbability)}function Rd($,M,T){var O={gender:M,genderProbability:T};return Object.assign({},$,O)}var ll=function(){function $(M){var T=M===void 0?{}:M,O=T.minFaceSize,L=T.scaleFactor,J=T.maxNumScales,ie=T.scoreThresholds,ge=T.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=O||20,this._scaleFactor=L||.709,this._maxNumScales=J||10,this._scoreThresholds=ie||[.6,.7,.7],this._scaleSteps=ge,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(Ae){return typeof Ae!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(Ae){return typeof Ae!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty($.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),$}();function s0($,M){function T(J,ie,ge,Ae,Ie){var De=bn.tensor4d($(J*ie*ge*ge),[ge,ge,J,ie]),et=bn.tensor1d($(ie));return M.push({paramPath:Ae+"/filters"},{paramPath:Ae+"/"+(Ie?"batch_norm_offset":"bias")}),{filters:De,bias:et}}function O(J,ie,ge,Ae){var Ie=T(J,ie,ge,Ae,!0);return{filters:Ie.filters,batch_norm_offset:Ie.bias}}function L(J,ie,ge){return{depthwise_conv:function(Ae,Ie){var De=bn.tensor4d($(9*Ae),[3,3,Ae,1]),et=bn.tensor1d($(Ae)),ot=bn.tensor1d($(Ae)),zt=bn.tensor1d($(Ae)),Ht=bn.tensor1d($(Ae));return M.push({paramPath:Ie+"/filters"},{paramPath:Ie+"/batch_norm_scale"},{paramPath:Ie+"/batch_norm_offset"},{paramPath:Ie+"/batch_norm_mean"},{paramPath:Ie+"/batch_norm_variance"}),{filters:De,batch_norm_scale:et,batch_norm_offset:ot,batch_norm_mean:zt,batch_norm_variance:Ht}}(J,ge+"/depthwise_conv"),pointwise_conv:O(J,ie,1,ge+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:O(3,32,3,"mobilenetv1/conv_0"),conv_1:L(32,64,"mobilenetv1/conv_1"),conv_2:L(64,128,"mobilenetv1/conv_2"),conv_3:L(128,128,"mobilenetv1/conv_3"),conv_4:L(128,256,"mobilenetv1/conv_4"),conv_5:L(256,256,"mobilenetv1/conv_5"),conv_6:L(256,512,"mobilenetv1/conv_6"),conv_7:L(512,512,"mobilenetv1/conv_7"),conv_8:L(512,512,"mobilenetv1/conv_8"),conv_9:L(512,512,"mobilenetv1/conv_9"),conv_10:L(512,512,"mobilenetv1/conv_10"),conv_11:L(512,512,"mobilenetv1/conv_11"),conv_12:L(512,1024,"mobilenetv1/conv_12"),conv_13:L(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:O(1024,256,1,"prediction_layer/conv_0"),conv_1:O(256,512,3,"prediction_layer/conv_1"),conv_2:O(512,128,1,"prediction_layer/conv_2"),conv_3:O(128,256,3,"prediction_layer/conv_3"),conv_4:O(256,128,1,"prediction_layer/conv_4"),conv_5:O(128,256,3,"prediction_layer/conv_5"),conv_6:O(256,64,1,"prediction_layer/conv_6"),conv_7:O(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:T(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:T(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:T(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:T(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:T(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:T(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:T(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:T(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:T(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:T(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:T(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:T(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function u0($){var M=[],T=function(ge,Ae){var Ie=Cs(ge,Ae);function De(Ht,xn,En){return{filters:Ie(Ht+"/Conv2d_"+xn+"_pointwise/weights",4,En+"/filters"),batch_norm_offset:Ie(Ht+"/Conv2d_"+xn+"_pointwise/convolution_bn_offset",1,En+"/batch_norm_offset")}}function et(Ht){var xn="mobilenetv1/conv_"+Ht,En="MobilenetV1/Conv2d_"+Ht+"_depthwise",Fn=xn+"/depthwise_conv",Rn=xn+"/pointwise_conv";return{depthwise_conv:{filters:Ie(En+"/depthwise_weights",4,Fn+"/filters"),batch_norm_scale:Ie(En+"/BatchNorm/gamma",1,Fn+"/batch_norm_scale"),batch_norm_offset:Ie(En+"/BatchNorm/beta",1,Fn+"/batch_norm_offset"),batch_norm_mean:Ie(En+"/BatchNorm/moving_mean",1,Fn+"/batch_norm_mean"),batch_norm_variance:Ie(En+"/BatchNorm/moving_variance",1,Fn+"/batch_norm_variance")},pointwise_conv:De("MobilenetV1",Ht,Rn)}}function ot(Ht,xn){return{filters:Ie(Ht+"/weights",4,xn+"/filters"),bias:Ie(Ht+"/biases",1,xn+"/bias")}}function zt(Ht){return{box_encoding_predictor:ot("Prediction/BoxPredictor_"+Ht+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+Ht+"/box_encoding_predictor"),class_predictor:ot("Prediction/BoxPredictor_"+Ht+"/ClassPredictor","prediction_layer/box_predictor_"+Ht+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:De("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:et(1),conv_2:et(2),conv_3:et(3),conv_4:et(4),conv_5:et(5),conv_6:et(6),conv_7:et(7),conv_8:et(8),conv_9:et(9),conv_10:et(10),conv_11:et(11),conv_12:et(12),conv_13:et(13)}},extractPredictionLayerParams:function(){return{conv_0:De("Prediction",0,"prediction_layer/conv_0"),conv_1:De("Prediction",1,"prediction_layer/conv_1"),conv_2:De("Prediction",2,"prediction_layer/conv_2"),conv_3:De("Prediction",3,"prediction_layer/conv_3"),conv_4:De("Prediction",4,"prediction_layer/conv_4"),conv_5:De("Prediction",5,"prediction_layer/conv_5"),conv_6:De("Prediction",6,"prediction_layer/conv_6"),conv_7:De("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:zt(0),box_predictor_1:zt(1),box_predictor_2:zt(2),box_predictor_3:zt(3),box_predictor_4:zt(4),box_predictor_5:zt(5)}}}}($,M),O=T.extractMobilenetV1Params,L=T.extractPredictionLayerParams,J=$["Output/extra_dim"];if(M.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!mr(J))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+J);var ie={mobilenetv1:O(),prediction_layer:L(),output_layer:{extra_dim:J}};return ua($,M),{params:ie,paramMappings:M}}function ec($,M,T){return bn.tidy(function(){var O=bn.conv2d($,M.filters,T,"same");return O=bn.add(O,M.batch_norm_offset),bn.clipByValue(O,0,6)})}var c0=.0010000000474974513;function $h($,M){return bn.tidy(function(){var T=null,O=ec($,M.conv_0,[2,2]);if([M.conv_1,M.conv_2,M.conv_3,M.conv_4,M.conv_5,M.conv_6,M.conv_7,M.conv_8,M.conv_9,M.conv_10,M.conv_11,M.conv_12,M.conv_13].forEach(function(L,J){var ie=J+1,ge=function(Ae){return[2,4,6,12].some(function(Ie){return Ie===Ae})?[2,2]:[1,1]}(ie);O=ec(O=function(Ae,Ie,De){return bn.tidy(function(){var et=bn.depthwiseConv2d(Ae,Ie.filters,De,"same");return et=bn.batchNorm(et,Ie.batch_norm_mean,Ie.batch_norm_variance,Ie.batch_norm_offset,Ie.batch_norm_scale,c0),bn.clipByValue(et,0,6)})}(O,L.depthwise_conv,ge),L.pointwise_conv,[1,1]),ie===11&&(T=O)}),T===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:O,conv11:T}})}function lm($,M,T){var O=$.arraySync(),L=Math.min(O[M][0],O[M][2]),J=Math.min(O[M][1],O[M][3]),ie=Math.max(O[M][0],O[M][2]),ge=Math.max(O[M][1],O[M][3]),Ae=Math.min(O[T][0],O[T][2]),Ie=Math.min(O[T][1],O[T][3]),De=Math.max(O[T][0],O[T][2]),et=Math.max(O[T][1],O[T][3]),ot=(ie-L)*(ge-J),zt=(De-Ae)*(et-Ie);if(ot<=0||zt<=0)return 0;var Ht=Math.max(L,Ae),xn=Math.max(J,Ie),En=Math.min(ie,De),Fn=Math.min(ge,et),Rn=Math.max(En-Ht,0)*Math.max(Fn-xn,0);return Rn/(ot+zt-Rn)}function Iy($,M){var T=function(De){var et=bn.unstack(bn.transpose(De,[1,0])),ot=[bn.sub(et[2],et[0]),bn.sub(et[3],et[1])];return{sizes:ot,centers:[bn.add(et[0],bn.div(ot[0],bn.scalar(2))),bn.add(et[1],bn.div(ot[1],bn.scalar(2)))]}}($),O=T.sizes,L=T.centers,J=bn.unstack(bn.transpose(M,[1,0])),ie=bn.div(bn.mul(bn.exp(bn.div(J[2],bn.scalar(5))),O[0]),bn.scalar(2)),ge=bn.add(bn.mul(bn.div(J[0],bn.scalar(10)),O[0]),L[0]),Ae=bn.div(bn.mul(bn.exp(bn.div(J[3],bn.scalar(5))),O[1]),bn.scalar(2)),Ie=bn.add(bn.mul(bn.div(J[1],bn.scalar(10)),O[1]),L[1]);return bn.transpose(bn.stack([bn.sub(ge,ie),bn.sub(Ie,Ae),bn.add(ge,ie),bn.add(Ie,Ae)]),[1,0])}function fm($,M){return bn.tidy(function(){var T=$.shape[0];return{boxPredictionEncoding:bn.reshape(ga($,M.box_encoding_predictor),[T,-1,1,4]),classPrediction:bn.reshape(ga($,M.class_predictor),[T,-1,3])}})}var fl=function(){function $(M){var T=M===void 0?{}:M,O=T.minConfidence,L=T.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=O||.5,this._maxResults=L||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty($.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),$}(),dm=function($){function M(){return $.call(this,"SsdMobilenetv1")||this}return Object(tr.c)(M,$),M.prototype.forwardInput=function(T){var O=this.params;if(!O)throw new Error("SsdMobilenetv1 - load model before inference");return bn.tidy(function(){var L=T.toBatchTensor(512,!1).toFloat(),J=$h(bn.sub(bn.mul(L,bn.scalar(.007843137718737125)),bn.scalar(1)),O.mobilenetv1),ie=function(ge,Ae,Ie){return bn.tidy(function(){var De=ec(ec(ge,Ie.conv_0,[1,1]),Ie.conv_1,[2,2]),et=ec(ec(De,Ie.conv_2,[1,1]),Ie.conv_3,[2,2]),ot=ec(ec(et,Ie.conv_4,[1,1]),Ie.conv_5,[2,2]),zt=ec(ec(ot,Ie.conv_6,[1,1]),Ie.conv_7,[2,2]),Ht=fm(Ae,Ie.box_predictor_0),xn=fm(ge,Ie.box_predictor_1),En=fm(De,Ie.box_predictor_2),Fn=fm(et,Ie.box_predictor_3),Rn=fm(ot,Ie.box_predictor_4),Wn=fm(zt,Ie.box_predictor_5);return{boxPredictions:bn.concat([Ht.boxPredictionEncoding,xn.boxPredictionEncoding,En.boxPredictionEncoding,Fn.boxPredictionEncoding,Rn.boxPredictionEncoding,Wn.boxPredictionEncoding],1),classPredictions:bn.concat([Ht.classPrediction,xn.classPrediction,En.classPrediction,Fn.classPrediction,Rn.classPrediction,Wn.classPrediction],1)}})}(J.out,J.conv11,O.prediction_layer);return function(ge,Ae,Ie){return bn.tidy(function(){var De=ge.shape[0],et=Iy(bn.reshape(bn.tile(Ie.extra_dim,[De,1,1]),[-1,4]),bn.reshape(ge,[-1,4]));et=bn.reshape(et,[De,et.shape[0]/De,4]);var ot=bn.sigmoid(bn.slice(Ae,[0,0,1],[-1,-1,-1])),zt=bn.slice(ot,[0,0,0],[-1,-1,1]);return zt=bn.reshape(zt,[De,zt.shape[1]]),{boxes:bn.unstack(et),scores:bn.unstack(zt)}})}(ie.boxPredictions,ie.classPredictions,O.output_layer)})},M.prototype.forward=function(T){return Object(tr.b)(this,void 0,void 0,function(){var O;return Object(tr.d)(this,function(L){switch(L.label){case 0:return O=this.forwardInput,[4,gi(T)];case 1:return[2,O.apply(this,[L.sent()])]}})})},M.prototype.locateFaces=function(T,O){return O===void 0&&(O={}),Object(tr.b)(this,void 0,void 0,function(){var L,J,ie,ge,Ae,Ie,De,et,ot,zt,Ht,xn,En,Fn,Rn,Wn,Jn,Tn,_r,Nr;return Object(tr.d)(this,function(Ir){switch(Ir.label){case 0:return L=new fl(O),J=L.maxResults,ie=L.minConfidence,[4,gi(T)];case 1:for(ge=Ir.sent(),Ae=this.forwardInput(ge),Ie=Ae.boxes,De=Ae.scores,et=Ie[0],ot=De[0],zt=1;zt<Ie.length;zt++)Ie[zt].dispose(),De[zt].dispose();return En=(xn=Array).from,[4,ot.data()];case 2:return Ht=En.apply(xn,[Ir.sent()]),Fn=function(Qr,zr,ki,Pi,Fi){var Mo=Qr.shape[0],Jo=Math.min(ki,Mo),jo=function(Ho){return Ho<=Pi?1:0},Bo=[];return zr.map(function(Ho,la){return{score:Ho,boxIndex:la}}).filter(function(Ho){return Ho.score>Fi}).sort(function(Ho,la){return la.score-Ho.score}).forEach(function(Ho){if(!(Bo.length>=Jo)){for(var la=Ho.score,va=Bo.length-1;va>=0;--va){var Fa=lm(Qr,Ho.boxIndex,Bo[va]);if(Fa!==0&&(Ho.score*=jo(Fa),Ho.score<=Fi))break}la===Ho.score&&Bo.push(Ho.boxIndex)}}),Bo}(et,Ht,J,.5,ie),Rn=ge.getReshapedInputDimensions(0),Wn=ge.inputSize,Jn=Wn/Rn.width,Tn=Wn/Rn.height,_r=et.arraySync(),Nr=Fn.map(function(Qr){var zr=[Math.max(0,_r[Qr][0]),Math.min(1,_r[Qr][2])].map(function(jo){return jo*Tn}),ki=zr[0],Pi=zr[1],Fi=[Math.max(0,_r[Qr][1]),Math.min(1,_r[Qr][3])].map(function(jo){return jo*Jn}),Mo=Fi[0],Jo=Fi[1];return new aa(Ht[Qr],new jl(Mo,ki,Jo-Mo,Pi-ki),{height:ge.getInputHeight(0),width:ge.getInputWidth(0)})}),et.dispose(),ot.dispose(),[2,Nr]}})})},M.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},M.prototype.extractParamsFromWeigthMap=function(T){return u0(T)},M.prototype.extractParams=function(T){return function(O){var L=[],J=$a(O),ie=J.extractWeights,ge=J.getRemainingWeights,Ae=s0(ie,L),Ie=Ae.extractMobilenetV1Params,De=Ae.extractPredictionLayerParams,et=Ie(),ot=De(),zt={extra_dim:bn.tensor3d(ie(20472),[1,5118,4])};if(L.push({paramPath:"output_layer/extra_dim"}),ge().length!==0)throw new Error("weights remaing after extract: "+ge().length);return{params:{mobilenetv1:et,prediction_layer:ot,output_layer:zt},paramMappings:L}}(T)},M}(Vi);function mv($){var M=new dm;return M.extractWeights($),M}function gv($){return mv($)}var l0,j1=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M}(dm),z1=.4,xo=[new bo(.738768,.874946),new bo(2.42204,2.65704),new bo(4.30971,7.04493),new bo(10.246,4.59428),new bo(12.6868,11.8741)],vv=[new bo(1.603231,2.094468),new bo(6.041143,7.080126),new bo(2.882459,3.518061),new bo(4.266906,5.178857),new bo(9.041765,10.66308)],yv=[117.001,114.697,97.404],og=function($){return typeof $=="number"};function bv($){if(!$)throw new Error("invalid config: "+$);if(typeof $.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+$.withSeparableConvs);if(!og($.iouThreshold)||$.iouThreshold<0||$.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+$.iouThreshold);if(!Array.isArray($.classes)||!$.classes.length||!$.classes.every(function(M){return typeof M=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify($.classes));if(!Array.isArray($.anchors)||!$.anchors.length||!$.anchors.map(function(M){return M||{}}).every(function(M){return og(M.x)&&og(M.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify($.anchors));if($.meanRgb&&(!Array.isArray($.meanRgb)||$.meanRgb.length!==3||!$.meanRgb.every(og)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify($.meanRgb))}function hm($){return bn.tidy(function(){var M=bn.mul($,bn.scalar(.10000000149011612));return bn.add(bn.relu(bn.sub($,M)),M)})}function Wl($,M){return bn.tidy(function(){var T=bn.pad($,[[0,0],[1,1],[1,1],[0,0]]);return T=bn.conv2d(T,M.conv.filters,[1,1],"valid"),T=bn.sub(T,M.bn.sub),T=bn.mul(T,M.bn.truediv),hm(T=bn.add(T,M.conv.bias))})}function Vl($,M){return bn.tidy(function(){var T=bn.pad($,[[0,0],[1,1],[1,1],[0,0]]);return T=bn.separableConv2d(T,M.depthwise_filter,M.pointwise_filter,[1,1],"valid"),hm(T=bn.add(T,M.bias))})}function xv($,M){var T=ds($,M),O=Ia($,M);return{extractConvParams:T,extractConvWithBatchNormParams:function(L,J,ie){return{conv:T(L,J,3,ie+"/conv"),bn:function(ge,Ae){var Ie=bn.tensor1d($(ge)),De=bn.tensor1d($(ge));return M.push({paramPath:Ae+"/sub"},{paramPath:Ae+"/truediv"}),{sub:Ie,truediv:De}}(J,ie+"/bn")}},extractSeparableConvParams:O}}function wv($,M){var T=Cs($,M);function O(L){return{filters:T(L+"/filters",4),bias:T(L+"/bias",1)}}return{extractConvParams:O,extractConvWithBatchNormParams:function(L){return{conv:O(L+"/conv"),bn:function(J){return{sub:T(J+"/sub",1),truediv:T(J+"/truediv",1)}}(L+"/bn")}},extractSeparableConvParams:Zu(T)}}(function($){$[$.XS=224]="XS",$[$.SM=320]="SM",$[$.MD=416]="MD",$[$.LG=608]="LG"})(l0||(l0={}));var Xh=function(){function $(M){var T=M===void 0?{}:M,O=T.inputSize,L=T.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=O||416,this._scoreThreshold=L||.5,typeof this._inputSize!="number"||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty($.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),$}(),Pd=function($){function M(T){var O=$.call(this,"TinyYolov2")||this;return bv(T),O._config=T,O}return Object(tr.c)(M,$),Object.defineProperty(M.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),M.prototype.runTinyYolov2=function(T,O){var L=Wl(T,O.conv0);return L=Wl(L=bn.maxPool(L,[2,2],[2,2],"same"),O.conv1),L=Wl(L=bn.maxPool(L,[2,2],[2,2],"same"),O.conv2),L=Wl(L=bn.maxPool(L,[2,2],[2,2],"same"),O.conv3),L=Wl(L=bn.maxPool(L,[2,2],[2,2],"same"),O.conv4),L=Wl(L=bn.maxPool(L,[2,2],[2,2],"same"),O.conv5),ga(L=Wl(L=Wl(L=bn.maxPool(L,[2,2],[1,1],"same"),O.conv6),O.conv7),O.conv8,"valid",!1)},M.prototype.runMobilenet=function(T,O){var L=this.config.isFirstLayerConv2d?hm(ga(T,O.conv0,"valid",!1)):Vl(T,O.conv0);return L=Vl(L=bn.maxPool(L,[2,2],[2,2],"same"),O.conv1),L=Vl(L=bn.maxPool(L,[2,2],[2,2],"same"),O.conv2),L=Vl(L=bn.maxPool(L,[2,2],[2,2],"same"),O.conv3),L=Vl(L=bn.maxPool(L,[2,2],[2,2],"same"),O.conv4),L=Vl(L=bn.maxPool(L,[2,2],[2,2],"same"),O.conv5),L=bn.maxPool(L,[2,2],[1,1],"same"),L=O.conv6?Vl(L,O.conv6):L,ga(L=O.conv7?Vl(L,O.conv7):L,O.conv8,"valid",!1)},M.prototype.forwardInput=function(T,O){var L=this,J=this.params;if(!J)throw new Error("TinyYolov2 - load model before inference");return bn.tidy(function(){var ie=T.toBatchTensor(O,!1).toFloat();return ie=(ie=L.config.meanRgb?Bc(ie,L.config.meanRgb):ie).div(bn.scalar(256)),L.config.withSeparableConvs?L.runMobilenet(ie,J):L.runTinyYolov2(ie,J)})},M.prototype.forward=function(T,O){return Object(tr.b)(this,void 0,void 0,function(){var L;return Object(tr.d)(this,function(J){switch(J.label){case 0:return L=this.forwardInput,[4,gi(T)];case 1:return[4,L.apply(this,[J.sent(),O])];case 2:return[2,J.sent()]}})})},M.prototype.detect=function(T,O){return O===void 0&&(O={}),Object(tr.b)(this,void 0,void 0,function(){var L,J,ie,ge,Ae,Ie,De,et,ot,zt,Ht,xn,En,Fn=this;return Object(tr.d)(this,function(Rn){switch(Rn.label){case 0:return L=new Xh(O),J=L.inputSize,ie=L.scoreThreshold,[4,gi(T)];case 1:return ge=Rn.sent(),[4,this.forwardInput(ge,J)];case 2:return Ae=Rn.sent(),Ie=bn.tidy(function(){return bn.unstack(Ae)[0].expandDims()}),De={width:ge.getInputWidth(0),height:ge.getInputHeight(0)},[4,this.extractBoxes(Ie,ge.getReshapedInputDimensions(0),ie)];case 3:return et=Rn.sent(),Ae.dispose(),Ie.dispose(),ot=et.map(function(Wn){return Wn.box}),zt=et.map(function(Wn){return Wn.score}),Ht=et.map(function(Wn){return Wn.classScore}),xn=et.map(function(Wn){return Fn.config.classes[Wn.label]}),En=yc(ot.map(function(Wn){return Wn.rescale(J)}),zt,this.config.iouThreshold,!0),[2,En.map(function(Wn){return new Ss(zt[Wn],Ht[Wn],xn[Wn],ot[Wn],De)})]}})})},M.prototype.getDefaultModelName=function(){return""},M.prototype.extractParamsFromWeigthMap=function(T){return function(O,L){var J,ie=[],ge=wv(O,ie),Ae=ge.extractConvParams,Ie=ge.extractConvWithBatchNormParams,De=ge.extractSeparableConvParams;if(L.withSeparableConvs){var et=L.filterSizes&&L.filterSizes.length||9;J={conv0:L.isFirstLayerConv2d?Ae("conv0"):De("conv0"),conv1:De("conv1"),conv2:De("conv2"),conv3:De("conv3"),conv4:De("conv4"),conv5:De("conv5"),conv6:et>7?De("conv6"):void 0,conv7:et>8?De("conv7"):void 0,conv8:Ae("conv8")}}else J={conv0:Ie("conv0"),conv1:Ie("conv1"),conv2:Ie("conv2"),conv3:Ie("conv3"),conv4:Ie("conv4"),conv5:Ie("conv5"),conv6:Ie("conv6"),conv7:Ie("conv7"),conv8:Ae("conv8")};return ua(O,ie),{params:J,paramMappings:ie}}(T,this.config)},M.prototype.extractParams=function(T){var O=this.config.filterSizes||M.DEFAULT_FILTER_SIZES,L=O?O.length:void 0;if(L!==7&&L!==8&&L!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+L+" filterSizes in config");return function(J,ie,ge,Ae){var Ie,De=$a(J),et=De.extractWeights,ot=De.getRemainingWeights,zt=[],Ht=xv(et,zt),xn=Ht.extractConvParams,En=Ht.extractConvWithBatchNormParams,Fn=Ht.extractSeparableConvParams;if(ie.withSeparableConvs){var Rn=Ae[0],Wn=Ae[1],Jn=Ae[2],Tn=Ae[3],_r=Ae[4],Nr=Ae[5],Ir=Ae[6],Qr=Ae[7],zr=Ae[8];Ie={conv0:ie.isFirstLayerConv2d?xn(Rn,Wn,3,"conv0"):Fn(Rn,Wn,"conv0"),conv1:Fn(Wn,Jn,"conv1"),conv2:Fn(Jn,Tn,"conv2"),conv3:Fn(Tn,_r,"conv3"),conv4:Fn(_r,Nr,"conv4"),conv5:Fn(Nr,Ir,"conv5"),conv6:Qr?Fn(Ir,Qr,"conv6"):void 0,conv7:zr?Fn(Qr,zr,"conv7"):void 0,conv8:xn(zr||Qr||Ir,5*ge,1,"conv8")}}else Rn=Ae[0],Wn=Ae[1],Jn=Ae[2],Tn=Ae[3],_r=Ae[4],Nr=Ae[5],Ir=Ae[6],Qr=Ae[7],zr=Ae[8],Ie={conv0:En(Rn,Wn,"conv0"),conv1:En(Wn,Jn,"conv1"),conv2:En(Jn,Tn,"conv2"),conv3:En(Tn,_r,"conv3"),conv4:En(_r,Nr,"conv4"),conv5:En(Nr,Ir,"conv5"),conv6:En(Ir,Qr,"conv6"),conv7:En(Qr,zr,"conv7"),conv8:xn(zr,5*ge,1,"conv8")};if(ot().length!==0)throw new Error("weights remaing after extract: "+ot().length);return{params:Ie,paramMappings:zt}}(T,this.config,this.boxEncodingSize,O)},M.prototype.extractBoxes=function(T,O,L){return Object(tr.b)(this,void 0,void 0,function(){var J,ie,ge,Ae,Ie,De,et,ot,zt,Ht,xn,En,Fn,Rn,Wn,Jn,Tn,_r,Nr,Ir,Qr,zr,ki,Pi,Fi,Mo,Jo,jo,Bo,Ho=this;return Object(tr.d)(this,function(la){switch(la.label){case 0:return J=O.width,ie=O.height,ge=Math.max(J,ie),Ae=ge/J,Ie=ge/ie,De=T.shape[1],et=this.config.anchors.length,ot=bn.tidy(function(){var va=T.reshape([De,De,et,Ho.boxEncodingSize]);return[va.slice([0,0,0,0],[De,De,et,4]),va.slice([0,0,0,4],[De,De,et,1]),Ho.withClassScores?bn.softmax(va.slice([0,0,0,5],[De,De,et,Ho.config.classes.length]),3):bn.scalar(0)]}),zt=ot[0],Ht=ot[1],xn=ot[2],En=[],[4,Ht.array()];case 1:return Fn=la.sent(),[4,zt.array()];case 2:Rn=la.sent(),Wn=0,la.label=3;case 3:if(!(Wn<De))return[3,12];Jn=0,la.label=4;case 4:if(!(Jn<De))return[3,11];Tn=0,la.label=5;case 5:return Tn<et?(_r=Bl(Fn[Wn][Jn][Tn][0]),!L||_r>L?(Nr=(Jn+Bl(Rn[Wn][Jn][Tn][0]))/De*Ae,Ir=(Wn+Bl(Rn[Wn][Jn][Tn][1]))/De*Ie,Qr=Math.exp(Rn[Wn][Jn][Tn][2])*this.config.anchors[Tn].x/De*Ae,zr=Math.exp(Rn[Wn][Jn][Tn][3])*this.config.anchors[Tn].y/De*Ie,ki=Nr-Qr/2,Pi=Ir-zr/2,Fi={row:Wn,col:Jn,anchor:Tn},this.withClassScores?[4,this.extractPredictedClass(xn,Fi)]:[3,7]):[3,9]):[3,10];case 6:return Bo=la.sent(),[3,8];case 7:Bo={classScore:1,label:0},la.label=8;case 8:Jo=(Mo=Bo).classScore,jo=Mo.label,En.push(Object(tr.a)({box:new Ua(ki,Pi,ki+Qr,Pi+zr),score:_r,classScore:_r*Jo,label:jo},Fi)),la.label=9;case 9:return Tn++,[3,5];case 10:return Jn++,[3,4];case 11:return Wn++,[3,3];case 12:return zt.dispose(),Ht.dispose(),xn.dispose(),[2,En]}})})},M.prototype.extractPredictedClass=function(T,O){return Object(tr.b)(this,void 0,void 0,function(){var L,J,ie,ge;return Object(tr.d)(this,function(Ae){switch(Ae.label){case 0:return L=O.row,J=O.col,ie=O.anchor,[4,T.array()];case 1:return ge=Ae.sent(),[2,Array(this.config.classes.length).fill(0).map(function(Ie,De){return ge[L][J][ie][De]}).map(function(Ie,De){return{classScore:Ie,label:De}}).reduce(function(Ie,De){return Ie.classScore>De.classScore?Ie:De})]}})})},M.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],M}(Vi),Kh=function($){function M(T){T===void 0&&(T=!0);var O=Object.assign({},{withSeparableConvs:T,iouThreshold:z1,classes:["face"]},T?{anchors:vv,meanRgb:yv}:{anchors:xo,withClassScores:!0});return $.call(this,O)||this}return Object(tr.c)(M,$),Object.defineProperty(M.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),M.prototype.locateFaces=function(T,O){return Object(tr.b)(this,void 0,void 0,function(){return Object(tr.d)(this,function(L){switch(L.label){case 0:return[4,this.detect(T,O)];case 1:return[2,L.sent().map(function(J){return new aa(J.score,J.relativeBox,{width:J.imageWidth,height:J.imageHeight})})]}})})},M.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},M.prototype.extractParamsFromWeigthMap=function(T){return $.prototype.extractParamsFromWeigthMap.call(this,T)},M}(Pd);function U1($,M){M===void 0&&(M=!0);var T=new Kh(M);return T.extractWeights($),T}var ag=function($){function M(){var T=$!==null&&$.apply(this,arguments)||this;return T._name="TinyFaceDetectorOptions",T}return Object(tr.c)(M,$),M}(Xh),Hl=function(){function $(){}return $.prototype.then=function(M){return Object(tr.b)(this,void 0,void 0,function(){var T;return Object(tr.d)(this,function(O){switch(O.label){case 0:return T=M,[4,this.run()];case 1:return[2,T.apply(void 0,[O.sent()])]}})})},$.prototype.run=function(){return Object(tr.b)(this,void 0,void 0,function(){return Object(tr.d)(this,function(M){throw new Error("ComposableTask - run is not implemented")})})},$}();function tc($,M,T,O,L){return L===void 0&&(L=function(J){return J.alignedRect}),Object(tr.b)(this,void 0,void 0,function(){var J,ie,ge,Ae,Ie;return Object(tr.d)(this,function(De){switch(De.label){case 0:return J=$.map(function(et){return ul(et)?L(et):et.detection}),(ge=O)?[3,5]:M instanceof bn.Tensor?[4,ho(M,J)]:[3,2];case 1:return Ae=De.sent(),[3,4];case 2:return[4,po(M,J)];case 3:Ae=De.sent(),De.label=4;case 4:ge=Ae,De.label=5;case 5:return[4,T(ie=ge)];case 6:return Ie=De.sent(),ie.forEach(function(et){return et instanceof bn.Tensor&&et.dispose()}),[2,Ie]}})})}function Mf($,M,T,O,L){return Object(tr.b)(this,void 0,void 0,function(){var J=this;return Object(tr.d)(this,function(ie){return[2,tc([$],M,function(ge){return Object(tr.b)(J,void 0,void 0,function(){return Object(tr.d)(this,function(Ae){return[2,T(ge[0])]})})},O,L)]})})}var Df=2,Nf=12;function _v($){var M=$a($),T=M.extractWeights,O=M.getRemainingWeights,L=[],J=function(ot,zt){var Ht=ds(ot,zt),xn=Ca(ot,zt);function En(Rn,Wn){var Jn=bn.tensor1d(ot(Rn));return zt.push({paramPath:Wn}),Jn}function Fn(Rn,Wn,Jn){return Jn===void 0&&(Jn=!1),{conv1:Ht(Rn[0],Rn[1],3,Wn+"/conv1"),prelu1_alpha:En(Rn[1],Wn+"/prelu1_alpha"),conv2:Ht(Rn[1],Rn[2],3,Wn+"/conv2"),prelu2_alpha:En(Rn[2],Wn+"/prelu2_alpha"),conv3:Ht(Rn[2],Rn[3],Jn?2:3,Wn+"/conv3"),prelu3_alpha:En(Rn[3],Wn+"/prelu3_alpha")}}return{extractPNetParams:function(){var Rn=Fn([3,10,16,32],"pnet"),Wn=Ht(32,2,1,"pnet/conv4_1"),Jn=Ht(32,4,1,"pnet/conv4_2");return Object(tr.a)(Object(tr.a)({},Rn),{conv4_1:Wn,conv4_2:Jn})},extractRNetParams:function(){var Rn=Fn([3,28,48,64],"rnet",!0),Wn=xn(576,128,"rnet/fc1"),Jn=En(128,"rnet/prelu4_alpha"),Tn=xn(128,2,"rnet/fc2_1"),_r=xn(128,4,"rnet/fc2_2");return Object(tr.a)(Object(tr.a)({},Rn),{fc1:Wn,prelu4_alpha:Jn,fc2_1:Tn,fc2_2:_r})},extractONetParams:function(){var Rn=Fn([3,32,64,64],"onet"),Wn=Ht(64,128,2,"onet/conv4"),Jn=En(128,"onet/prelu4_alpha"),Tn=xn(1152,256,"onet/fc1"),_r=En(256,"onet/prelu5_alpha"),Nr=xn(256,2,"onet/fc2_1"),Ir=xn(256,4,"onet/fc2_2"),Qr=xn(256,10,"onet/fc2_3");return Object(tr.a)(Object(tr.a)({},Rn),{conv4:Wn,prelu4_alpha:Jn,fc1:Tn,prelu5_alpha:_r,fc2_1:Nr,fc2_2:Ir,fc2_3:Qr})}}}(T,L),ie=J.extractPNetParams,ge=J.extractRNetParams,Ae=J.extractONetParams,Ie=ie(),De=ge(),et=Ae();if(O().length!==0)throw new Error("weights remaing after extract: "+O().length);return{params:{pnet:Ie,rnet:De,onet:et},paramMappings:L}}function sg($){var M=[],T=function(Ie,De){var et=Cs(Ie,De);function ot(En){return{filters:et(En+"/weights",4,En+"/filters"),bias:et(En+"/bias",1)}}function zt(En){return{weights:et(En+"/weights",2),bias:et(En+"/bias",1)}}function Ht(En){return et(En,1)}function xn(En){return{conv1:ot(En+"/conv1"),prelu1_alpha:Ht(En+"/prelu1_alpha"),conv2:ot(En+"/conv2"),prelu2_alpha:Ht(En+"/prelu2_alpha"),conv3:ot(En+"/conv3"),prelu3_alpha:Ht(En+"/prelu3_alpha")}}return{extractPNetParams:function(){var En=xn("pnet"),Fn=ot("pnet/conv4_1"),Rn=ot("pnet/conv4_2");return Object(tr.a)(Object(tr.a)({},En),{conv4_1:Fn,conv4_2:Rn})},extractRNetParams:function(){var En=xn("rnet"),Fn=zt("rnet/fc1"),Rn=Ht("rnet/prelu4_alpha"),Wn=zt("rnet/fc2_1"),Jn=zt("rnet/fc2_2");return Object(tr.a)(Object(tr.a)({},En),{fc1:Fn,prelu4_alpha:Rn,fc2_1:Wn,fc2_2:Jn})},extractONetParams:function(){var En=xn("onet"),Fn=ot("onet/conv4"),Rn=Ht("onet/prelu4_alpha"),Wn=zt("onet/fc1"),Jn=Ht("onet/prelu5_alpha"),Tn=zt("onet/fc2_1"),_r=zt("onet/fc2_2"),Nr=zt("onet/fc2_3");return Object(tr.a)(Object(tr.a)({},En),{conv4:Fn,prelu4_alpha:Rn,fc1:Wn,prelu5_alpha:Jn,fc2_1:Tn,fc2_2:_r,fc2_3:Nr})}}}($,M),O=T.extractPNetParams,L=T.extractRNetParams,J=T.extractONetParams,ie=O(),ge=L(),Ae=J();return ua($,M),{params:{pnet:ie,rnet:ge,onet:Ae},paramMappings:M}}function nc($,M){var T=M[0],O=M[1];return{height:Math.floor(T*$),width:Math.floor(O*$)}}var bc=function($){function M(T,O,L,J){return $.call(this,{left:T,top:O,right:L,bottom:J},!0)||this}return Object(tr.c)(M,$),M}(Es);function Ev($){return bn.tidy(function(){return bn.mul(bn.sub($,bn.scalar(127.5)),bn.scalar(.0078125))})}function pm($,M){return bn.tidy(function(){return bn.add(bn.relu($),bn.mul(M,bn.neg(bn.relu(bn.neg($)))))})}function f0($,M,T){return T===void 0&&(T=!1),bn.tidy(function(){var O=ga($,M.conv1,"valid");return O=pm(O,M.prelu1_alpha),O=pm(O=ga(O=bn.maxPool(O,T?[2,2]:[3,3],[2,2],"same"),M.conv2,"valid"),M.prelu2_alpha),O=pm(O=ga(O=T?O:bn.maxPool(O,[3,3],[2,2],"valid"),M.conv3,"valid"),M.prelu3_alpha)})}function W1($,M,T,O,L){L.stage1=[];var J=M.map(function(De){return bn.tidy(function(){var et={scale:De},ot=function(Fn,Rn){return bn.tidy(function(){var Wn=nc(Rn,Fn.shape.slice(1)),Jn=Wn.height,Tn=Wn.width,_r=Ev(bn.image.resizeBilinear(Fn,[Jn,Tn]));return bn.transpose(_r,[0,2,1,3])})}($,De),zt=Date.now(),Ht=function(Fn,Rn){return bn.tidy(function(){var Wn=f0(Fn,Rn,!0),Jn=ga(Wn,Rn.conv4_1,"valid"),Tn=bn.expandDims(bn.max(Jn,3),3);return{prob:bn.softmax(bn.sub(Jn,Tn),3),regions:ga(Wn,Rn.conv4_2,"valid")}})}(ot,O),xn=Ht.prob,En=Ht.regions;return et.pnet=Date.now()-zt,{scoresTensor:bn.unstack(bn.unstack(xn,3)[1])[0],regionsTensor:bn.unstack(En)[0],scale:De,statsForScale:et}})}).map(function(De){var et=De.scoresTensor,ot=De.regionsTensor,zt=De.scale,Ht=De.statsForScale,xn=function(Rn,Wn,Jn,Tn){for(var _r=[],Nr=Rn.arraySync(),Ir=0;Ir<Rn.shape[0];Ir++)for(var Qr=0;Qr<Rn.shape[1];Qr++)Nr[Ir][Qr]>=Tn&&_r.push(new bo(Qr,Ir));return _r.map(function(zr){var ki=new Ua(Math.round((zr.y*Df+1)/Jn),Math.round((zr.x*Df+1)/Jn),Math.round((zr.y*Df+Nf)/Jn),Math.round((zr.x*Df+Nf)/Jn)),Pi=Nr[zr.y][zr.x],Fi=Wn.arraySync();return{cell:ki,score:Pi,region:new bc(Fi[zr.y][zr.x][0],Fi[zr.y][zr.x][1],Fi[zr.y][zr.x][2],Fi[zr.y][zr.x][3])}})}(et,ot,zt,T);if(et.dispose(),ot.dispose(),!xn.length)return L.stage1.push(Ht),[];var En=Date.now(),Fn=yc(xn.map(function(Rn){return Rn.cell}),xn.map(function(Rn){return Rn.score}),.5);return Ht.nms=Date.now()-En,Ht.numBoxes=Fn.length,L.stage1.push(Ht),Fn.map(function(Rn){return xn[Rn]})}).reduce(function(De,et){return De.concat(et)},[]),ie=[],ge=[];if(J.length>0){var Ae=Date.now(),Ie=yc(J.map(function(De){return De.cell}),J.map(function(De){return De.score}),.7);L.stage1_nms=Date.now()-Ae,ge=Ie.map(function(De){return J[De].score}),ie=Ie.map(function(De){return J[De]}).map(function(De){var et=De.cell,ot=De.region;return new Ua(et.left+ot.left*et.width,et.top+ot.top*et.height,et.right+ot.right*et.width,et.bottom+ot.bottom*et.height).toSquare().round()})}return{boxes:ie,scores:ge}}function Fy($,M,T){var O=T.width,L=T.height;return Object(tr.b)(this,void 0,void 0,function(){var J,ie,ge,Ae=this;return Object(tr.d)(this,function(Ie){switch(Ie.label){case 0:return J=In($),[4,Promise.all(M.map(function(De){return Object(tr.b)(Ae,void 0,void 0,function(){var et,ot,zt,Ht,xn,En,Fn,Rn;return Object(tr.d)(this,function(Wn){return et=De.padAtBorders($.height,$.width),ot=et.y,zt=et.ey,Ht=et.x,xn=et.ex,En=Ht-1,Fn=ot-1,Rn=J.getImageData(En,Fn,xn-En,zt-Fn),[2,un.isNodejs()?ui(Rn):createImageBitmap(Rn)]})})}))];case 1:return ie=Ie.sent(),ge=[],ie.forEach(function(De){var et=In(Fr({width:O,height:L}));et.drawImage(De,0,0,O,L);for(var ot=et.getImageData(0,0,O,L).data,zt=[],Ht=0;Ht<ot.length;Ht+=4)zt.push(ot[Ht+2]),zt.push(ot[Ht+1]),zt.push(ot[Ht]);ge.push(zt)}),[2,ge.map(function(De){return bn.tidy(function(){return Ev(bn.transpose(bn.tensor4d(De,[1,O,L,3]),[0,2,1,3]).toFloat())})})]}})})}function If($,M,T,O,L){return Object(tr.b)(this,void 0,void 0,function(){var J,ie,ge,Ae,Ie,De,et,ot,zt,Ht,xn,En,Fn,Rn;return Object(tr.d)(this,function(Wn){switch(Wn.label){case 0:return J=Date.now(),[4,Fy($,M,{width:24,height:24})];case 1:return ie=Wn.sent(),L.stage2_extractImagePatches=Date.now()-J,J=Date.now(),ge=ie.map(function(Jn){var Tn=function(_r,Nr){return bn.tidy(function(){var Ir=f0(_r,Nr),Qr=pm(ca(bn.reshape(Ir,[Ir.shape[0],Nr.fc1.weights.shape[0]]),Nr.fc1),Nr.prelu4_alpha),zr=ca(Qr,Nr.fc2_1),ki=bn.expandDims(bn.max(zr,1),1),Pi=bn.softmax(bn.sub(zr,ki),1),Fi=ca(Qr,Nr.fc2_2);return{scores:bn.unstack(Pi,1)[1],regions:Fi}})}(Jn,O);return Jn.dispose(),Tn}),L.stage2_rnet=Date.now()-J,Ae=ge.length>1?bn.concat(ge.map(function(Jn){return Jn.scores})):ge[0].scores,et=(De=Array).from,[4,Ae.data()];case 2:return Ie=et.apply(De,[Wn.sent()]),Ae.dispose(),ot=Ie.map(function(Jn,Tn){return{score:Jn,idx:Tn}}).filter(function(Jn){return Jn.score>T}).map(function(Jn){return Jn.idx}),zt=ot.map(function(Jn){return M[Jn]}),Ht=ot.map(function(Jn){return Ie[Jn]}),xn=[],En=[],zt.length>0&&(J=Date.now(),Fn=yc(zt,Ht,.7),L.stage2_nms=Date.now()-J,Rn=Fn.map(function(Jn){var Tn=ge[ot[Jn]].regions.arraySync();return new bc(Tn[0][0],Tn[0][1],Tn[0][2],Tn[0][3])}),En=Fn.map(function(Jn){return Ht[Jn]}),xn=Fn.map(function(Jn,Tn){return zt[Jn].calibrate(Rn[Tn])})),ge.forEach(function(Jn){Jn.regions.dispose(),Jn.scores.dispose()}),[2,{boxes:xn,scores:En}]}})})}function Yh($,M,T,O,L){return Object(tr.b)(this,void 0,void 0,function(){var J,ie,ge,Ae,Ie,De,et,ot,zt,Ht,xn,En,Fn,Rn,Wn;return Object(tr.d)(this,function(Jn){switch(Jn.label){case 0:return J=Date.now(),[4,Fy($,M,{width:48,height:48})];case 1:return ie=Jn.sent(),L.stage3_extractImagePatches=Date.now()-J,J=Date.now(),ge=ie.map(function(Tn){var _r=function(Nr,Ir){return bn.tidy(function(){var Qr=f0(Nr,Ir);Qr=pm(Qr=ga(Qr=bn.maxPool(Qr,[2,2],[2,2],"same"),Ir.conv4,"valid"),Ir.prelu4_alpha);var zr=pm(ca(bn.reshape(Qr,[Qr.shape[0],Ir.fc1.weights.shape[0]]),Ir.fc1),Ir.prelu5_alpha),ki=ca(zr,Ir.fc2_1),Pi=bn.expandDims(bn.max(ki,1),1),Fi=bn.softmax(bn.sub(ki,Pi),1),Mo=ca(zr,Ir.fc2_2),Jo=ca(zr,Ir.fc2_3);return{scores:bn.unstack(Fi,1)[1],regions:Mo,points:Jo}})}(Tn,O);return Tn.dispose(),_r}),L.stage3_onet=Date.now()-J,Ae=ge.length>1?bn.concat(ge.map(function(Tn){return Tn.scores})):ge[0].scores,et=(De=Array).from,[4,Ae.data()];case 2:return Ie=et.apply(De,[Jn.sent()]),Ae.dispose(),ot=Ie.map(function(Tn,_r){return{score:Tn,idx:_r}}).filter(function(Tn){return Tn.score>T}).map(function(Tn){return Tn.idx}),zt=ot.map(function(Tn){var _r=ge[Tn].regions.arraySync();return new bc(_r[0][0],_r[0][1],_r[0][2],_r[0][3])}),Ht=ot.map(function(Tn,_r){return M[Tn].calibrate(zt[_r])}),xn=ot.map(function(Tn){return Ie[Tn]}),En=[],Fn=[],Rn=[],Ht.length>0&&(J=Date.now(),Wn=yc(Ht,xn,.7,!1),L.stage3_nms=Date.now()-J,En=Wn.map(function(Tn){return Ht[Tn]}),Fn=Wn.map(function(Tn){return xn[Tn]}),Rn=Wn.map(function(Tn,_r){return Array(5).fill(0).map(function(Nr,Ir){var Qr=ge[Tn].points.arraySync();return new bo(Qr[0][Ir]*(En[_r].width+1)+En[_r].left,Qr[0][Ir+5]*(En[_r].height+1)+En[_r].top)})})),ge.forEach(function(Tn){Tn.regions.dispose(),Tn.scores.dispose(),Tn.points.dispose()}),[2,{boxes:En,scores:Fn,points:Rn}]}})})}var Ld=function($){function M(){return $.call(this,"Mtcnn")||this}return Object(tr.c)(M,$),M.prototype.load=function(T){return Object(tr.b)(this,void 0,void 0,function(){return Object(tr.d)(this,function(O){return console.warn("mtcnn is deprecated and will be removed soon"),[2,$.prototype.load.call(this,T)]})})},M.prototype.loadFromDisk=function(T){return Object(tr.b)(this,void 0,void 0,function(){return Object(tr.d)(this,function(O){return console.warn("mtcnn is deprecated and will be removed soon"),[2,$.prototype.loadFromDisk.call(this,T)]})})},M.prototype.forwardInput=function(T,O){return O===void 0&&(O={}),Object(tr.b)(this,void 0,void 0,function(){var L,J,ie,ge,Ae,Ie,De,et,ot,zt,Ht,xn,En,Fn,Rn,Wn,Jn,Tn,_r,Nr,Ir;return Object(tr.d)(this,function(Qr){switch(Qr.label){case 0:if(!(L=this.params))throw new Error("Mtcnn - load model before inference");if(!(J=T.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return ie={},ge=Date.now(),Ae=bn.tidy(function(){return function(zr){return bn.tidy(function(){return bn.stack(bn.unstack(zr,3).reverse(),3)})}(bn.expandDims(bn.browser.fromPixels(J)).toFloat())}),Ie=function(zr){return Ae.dispose(),ie.total=Date.now()-ge,zr},De=Ae.shape.slice(1),et=De[0],ot=De[1],zt=new ll(O),Ht=zt.minFaceSize,xn=zt.scaleFactor,En=zt.maxNumScales,Fn=zt.scoreThresholds,Rn=zt.scaleSteps,Wn=(Rn||function(zr,ki,Pi){for(var Fi=Pi[0],Mo=Pi[1],Jo=Nf/zr,jo=[],Bo=Math.min(Fi,Mo)*Jo,Ho=0;Bo>=12;)jo.push(Jo*Math.pow(ki,Ho)),Bo*=ki,Ho+=1;return jo}(Ht,xn,[et,ot])).filter(function(zr){var ki=nc(zr,[et,ot]);return Math.min(ki.width,ki.height)>Nf}).slice(0,En),ie.scales=Wn,ie.pyramid=Wn.map(function(zr){return nc(zr,[et,ot])}),Jn=Date.now(),[4,W1(Ae,Wn,Fn[0],L.pnet,ie)];case 1:return Tn=Qr.sent(),ie.total_stage1=Date.now()-Jn,Tn.boxes.length?(ie.stage2_numInputBoxes=Tn.boxes.length,Jn=Date.now(),[4,If(J,Tn.boxes,Fn[1],L.rnet,ie)]):[2,Ie({results:[],stats:ie})];case 2:return _r=Qr.sent(),ie.total_stage2=Date.now()-Jn,_r.boxes.length?(ie.stage3_numInputBoxes=_r.boxes.length,Jn=Date.now(),[4,Yh(J,_r.boxes,Fn[2],L.onet,ie)]):[2,Ie({results:[],stats:ie})];case 3:return Nr=Qr.sent(),ie.total_stage3=Date.now()-Jn,Ir=Nr.boxes.map(function(zr,ki){return Yo(Nd({},new aa(Nr.scores[ki],new jl(zr.left/ot,zr.top/et,zr.width/ot,zr.height/et),{height:et,width:ot})),new Ju(Nr.points[ki].map(function(Pi){return Pi.sub(new bo(zr.left,zr.top)).div(new bo(zr.width,zr.height))}),{width:zr.width,height:zr.height}))}),[2,Ie({results:Ir,stats:ie})]}})})},M.prototype.forward=function(T,O){return O===void 0&&(O={}),Object(tr.b)(this,void 0,void 0,function(){var L;return Object(tr.d)(this,function(J){switch(J.label){case 0:return L=this.forwardInput,[4,gi(T)];case 1:return[4,L.apply(this,[J.sent(),O])];case 2:return[2,J.sent().results]}})})},M.prototype.forwardWithStats=function(T,O){return O===void 0&&(O={}),Object(tr.b)(this,void 0,void 0,function(){var L;return Object(tr.d)(this,function(J){switch(J.label){case 0:return L=this.forwardInput,[4,gi(T)];case 1:return[2,L.apply(this,[J.sent(),O])]}})})},M.prototype.getDefaultModelName=function(){return"mtcnn_model"},M.prototype.extractParamsFromWeigthMap=function(T){return sg(T)},M.prototype.extractParams=function(T){return _v(T)},M}(Vi),Bd=.4,Sv=[new bo(1.603231,2.094468),new bo(6.041143,7.080126),new bo(2.882459,3.518061),new bo(4.266906,5.178857),new bo(9.041765,10.66308)],d0=[117.001,114.697,97.404],jd=function($){function M(){var T={withSeparableConvs:!0,iouThreshold:Bd,classes:["face"],anchors:Sv,meanRgb:d0,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return $.call(this,T)||this}return Object(tr.c)(M,$),Object.defineProperty(M.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),M.prototype.locateFaces=function(T,O){return Object(tr.b)(this,void 0,void 0,function(){return Object(tr.d)(this,function(L){switch(L.label){case 0:return[4,this.detect(T,O)];case 1:return[2,L.sent().map(function(J){return new aa(J.score,J.relativeBox,{width:J.imageWidth,height:J.imageHeight})})]}})})},M.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},M.prototype.extractParamsFromWeigthMap=function(T){return $.prototype.extractParamsFromWeigthMap.call(this,T)},M}(Pd),go={ssdMobilenetv1:new dm,tinyFaceDetector:new jd,tinyYolov2:new Kh,mtcnn:new Ld,faceLandmark68Net:new n0,faceLandmark68TinyNet:new r0,faceRecognitionNet:new cm,faceExpressionNet:new yo,ageGenderNet:new cv},Ff=function($,M){return go.ssdMobilenetv1.locateFaces($,M)},Jh=function($,M){return go.tinyFaceDetector.locateFaces($,M)},Ry=function($,M){return go.tinyYolov2.locateFaces($,M)},Py=function($,M){return go.mtcnn.forward($,M)},ug=function($){return go.faceLandmark68Net.detectLandmarks($)},Rf=function($){return go.faceLandmark68TinyNet.detectLandmarks($)},Gl=function($){return go.faceRecognitionNet.computeFaceDescriptor($)},mm=function($){return go.faceExpressionNet.predictExpressions($)},Qh=function($){return go.ageGenderNet.predictAgeAndGender($)},zd=function($){return go.ssdMobilenetv1.load($)},Pf=function($){return go.tinyFaceDetector.load($)},Lf=function($){return go.mtcnn.load($)},rc=function($){return go.tinyYolov2.load($)},Zh=function($){return go.faceLandmark68Net.load($)},Ud=function($){return go.faceLandmark68TinyNet.load($)},ql=function($){return go.faceRecognitionNet.load($)},dl=function($){return go.faceExpressionNet.load($)},Wd=function($){return go.ageGenderNet.load($)},cg=zd,Vd=Ff,hl=ug,ps=function($){function M(T,O,L){var J=$.call(this)||this;return J.parentTask=T,J.input=O,J.extractedFaces=L,J}return Object(tr.c)(M,$),M}(Hl),Uc=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.run=function(){return Object(tr.b)(this,void 0,void 0,function(){var T,O,L=this;return Object(tr.d)(this,function(J){switch(J.label){case 0:return[4,this.parentTask];case 1:return[4,tc(T=J.sent(),this.input,function(ie){return Object(tr.b)(L,void 0,void 0,function(){return Object(tr.d)(this,function(ge){switch(ge.label){case 0:return[4,Promise.all(ie.map(function(Ae){return go.faceExpressionNet.predictExpressions(Ae)}))];case 1:return[2,ge.sent()]}})})},this.extractedFaces)];case 2:return O=J.sent(),[2,T.map(function(ie,ge){return os(ie,O[ge])})]}})})},M.prototype.withAgeAndGender=function(){return new h0(this,this.input)},M}(ps),ic=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.run=function(){return Object(tr.b)(this,void 0,void 0,function(){var T,O;return Object(tr.d)(this,function(L){switch(L.label){case 0:return[4,this.parentTask];case 1:return(T=L.sent())?[4,Mf(T,this.input,function(J){return go.faceExpressionNet.predictExpressions(J)},this.extractedFaces)]:[2];case 2:return O=L.sent(),[2,os(T,O)]}})})},M.prototype.withAgeAndGender=function(){return new p0(this,this.input)},M}(ps),Ru=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.withAgeAndGender=function(){return new gm(this,this.input)},M.prototype.withFaceDescriptors=function(){return new Wc(this,this.input)},M}(Uc),ep=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.withAgeAndGender=function(){return new Vo(this,this.input)},M.prototype.withFaceDescriptor=function(){return new Hd(this,this.input)},M}(ic),lg=function($){function M(T,O,L){var J=$.call(this)||this;return J.parentTask=T,J.input=O,J.extractedFaces=L,J}return Object(tr.c)(M,$),M}(Hl),h0=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.run=function(){return Object(tr.b)(this,void 0,void 0,function(){var T,O,L=this;return Object(tr.d)(this,function(J){switch(J.label){case 0:return[4,this.parentTask];case 1:return[4,tc(T=J.sent(),this.input,function(ie){return Object(tr.b)(L,void 0,void 0,function(){return Object(tr.d)(this,function(ge){switch(ge.label){case 0:return[4,Promise.all(ie.map(function(Ae){return go.ageGenderNet.predictAgeAndGender(Ae)}))];case 1:return[2,ge.sent()]}})})},this.extractedFaces)];case 2:return O=J.sent(),[2,T.map(function(ie,ge){var Ae=O[ge],Ie=Ae.age;return a0(Rd(ie,Ae.gender,Ae.genderProbability),Ie)})]}})})},M.prototype.withFaceExpressions=function(){return new Uc(this,this.input)},M}(lg),p0=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.run=function(){return Object(tr.b)(this,void 0,void 0,function(){var T,O,L,J,ie;return Object(tr.d)(this,function(ge){switch(ge.label){case 0:return[4,this.parentTask];case 1:return(T=ge.sent())?[4,Mf(T,this.input,function(Ae){return go.ageGenderNet.predictAgeAndGender(Ae)},this.extractedFaces)]:[2];case 2:return O=ge.sent(),L=O.age,J=O.gender,ie=O.genderProbability,[2,a0(Rd(T,J,ie),L)]}})})},M.prototype.withFaceExpressions=function(){return new ic(this,this.input)},M}(lg),gm=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.withFaceExpressions=function(){return new Ru(this,this.input)},M.prototype.withFaceDescriptors=function(){return new Wc(this,this.input)},M}(h0),Vo=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.withFaceExpressions=function(){return new ep(this,this.input)},M.prototype.withFaceDescriptor=function(){return new Hd(this,this.input)},M}(p0),vm=function($){function M(T,O){var L=$.call(this)||this;return L.parentTask=T,L.input=O,L}return Object(tr.c)(M,$),M}(Hl),Wc=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.run=function(){return Object(tr.b)(this,void 0,void 0,function(){var T;return Object(tr.d)(this,function(O){switch(O.label){case 0:return[4,this.parentTask];case 1:return[4,tc(T=O.sent(),this.input,function(L){return Promise.all(L.map(function(J){return go.faceRecognitionNet.computeFaceDescriptor(J)}))},null,function(L){return L.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,O.sent().map(function(L,J){return o0(T[J],L)})]}})})},M.prototype.withFaceExpressions=function(){return new Ru(this,this.input)},M.prototype.withAgeAndGender=function(){return new gm(this,this.input)},M}(vm),Hd=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.run=function(){return Object(tr.b)(this,void 0,void 0,function(){var T,O;return Object(tr.d)(this,function(L){switch(L.label){case 0:return[4,this.parentTask];case 1:return(T=L.sent())?[4,Mf(T,this.input,function(J){return go.faceRecognitionNet.computeFaceDescriptor(J)},null,function(J){return J.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return O=L.sent(),[2,o0(T,O)]}})})},M.prototype.withFaceExpressions=function(){return new ep(this,this.input)},M.prototype.withAgeAndGender=function(){return new Vo(this,this.input)},M}(vm),Gd=function($){function M(T,O,L){var J=$.call(this)||this;return J.parentTask=T,J.input=O,J.useTinyLandmarkNet=L,J}return Object(tr.c)(M,$),Object.defineProperty(M.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?go.faceLandmark68TinyNet:go.faceLandmark68Net},enumerable:!0,configurable:!0}),M}(Hl),ym=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.run=function(){return Object(tr.b)(this,void 0,void 0,function(){var T,O,L,J,ie,ge=this;return Object(tr.d)(this,function(Ae){switch(Ae.label){case 0:return[4,this.parentTask];case 1:return T=Ae.sent(),O=T.map(function(Ie){return Ie.detection}),this.input instanceof bn.Tensor?[4,ho(this.input,O)]:[3,3];case 2:return J=Ae.sent(),[3,5];case 3:return[4,po(this.input,O)];case 4:J=Ae.sent(),Ae.label=5;case 5:return L=J,[4,Promise.all(L.map(function(Ie){return ge.landmarkNet.detectLandmarks(Ie)}))];case 6:return ie=Ae.sent(),L.forEach(function(Ie){return Ie instanceof bn.Tensor&&Ie.dispose()}),[2,T.map(function(Ie,De){return Yo(Ie,ie[De])})]}})})},M.prototype.withFaceExpressions=function(){return new Ru(this,this.input)},M.prototype.withAgeAndGender=function(){return new gm(this,this.input)},M.prototype.withFaceDescriptors=function(){return new Wc(this,this.input)},M}(Gd),fg=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.run=function(){return Object(tr.b)(this,void 0,void 0,function(){var T,O,L,J,ie;return Object(tr.d)(this,function(ge){switch(ge.label){case 0:return[4,this.parentTask];case 1:return(T=ge.sent())?(O=T.detection,this.input instanceof bn.Tensor?[4,ho(this.input,[O])]:[3,3]):[2];case 2:return J=ge.sent(),[3,5];case 3:return[4,po(this.input,[O])];case 4:J=ge.sent(),ge.label=5;case 5:return L=J,[4,this.landmarkNet.detectLandmarks(L[0])];case 6:return ie=ge.sent(),L.forEach(function(Ae){return Ae instanceof bn.Tensor&&Ae.dispose()}),[2,Yo(T,ie)]}})})},M.prototype.withFaceExpressions=function(){return new ep(this,this.input)},M.prototype.withAgeAndGender=function(){return new Vo(this,this.input)},M.prototype.withFaceDescriptor=function(){return new Hd(this,this.input)},M}(Gd),dg=function($){function M(T,O){O===void 0&&(O=new fl);var L=$.call(this)||this;return L.input=T,L.options=O,L}return Object(tr.c)(M,$),M}(Hl),hg=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.run=function(){return Object(tr.b)(this,void 0,void 0,function(){var T,O,L,J;return Object(tr.d)(this,function(ie){switch(ie.label){case 0:return O=(T=this).input,(L=T.options)instanceof ll?[4,go.mtcnn.forward(O,L)]:[3,2];case 1:return[2,ie.sent().map(function(ge){return ge.detection})];case 2:if(!(J=L instanceof ag?function(ge){return go.tinyFaceDetector.locateFaces(ge,L)}:L instanceof fl?function(ge){return go.ssdMobilenetv1.locateFaces(ge,L)}:L instanceof Xh?function(ge){return go.tinyYolov2.locateFaces(ge,L)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,J(O)]}})})},M.prototype.runAndExtendWithFaceDetections=function(){var T=this;return new Promise(function(O){return Object(tr.b)(T,void 0,void 0,function(){var L;return Object(tr.d)(this,function(J){switch(J.label){case 0:return[4,this.run()];case 1:return L=J.sent(),[2,O(L.map(function(ie){return Nd({},ie)}))]}})})})},M.prototype.withFaceLandmarks=function(T){return T===void 0&&(T=!1),new ym(this.runAndExtendWithFaceDetections(),this.input,T)},M.prototype.withFaceExpressions=function(){return new Uc(this.runAndExtendWithFaceDetections(),this.input)},M.prototype.withAgeAndGender=function(){return new h0(this.runAndExtendWithFaceDetections(),this.input)},M}(dg),Cv=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.run=function(){return Object(tr.b)(this,void 0,void 0,function(){var T,O;return Object(tr.d)(this,function(L){switch(L.label){case 0:return[4,new hg(this.input,this.options)];case 1:return T=L.sent(),O=T[0],T.forEach(function(J){J.score>O.score&&(O=J)}),[2,O]}})})},M.prototype.runAndExtendWithFaceDetection=function(){var T=this;return new Promise(function(O){return Object(tr.b)(T,void 0,void 0,function(){var L;return Object(tr.d)(this,function(J){switch(J.label){case 0:return[4,this.run()];case 1:return L=J.sent(),[2,O(L?Nd({},L):void 0)]}})})})},M.prototype.withFaceLandmarks=function(T){return T===void 0&&(T=!1),new fg(this.runAndExtendWithFaceDetection(),this.input,T)},M.prototype.withFaceExpressions=function(){return new ic(this.runAndExtendWithFaceDetection(),this.input)},M.prototype.withAgeAndGender=function(){return new p0(this.runAndExtendWithFaceDetection(),this.input)},M}(dg);function pg($,M){return M===void 0&&(M=new fl),new Cv($,M)}function Bf($,M){return M===void 0&&(M=new fl),new hg($,M)}function mg($,M){return Object(tr.b)(this,void 0,void 0,function(){return Object(tr.d)(this,function(T){switch(T.label){case 0:return console.warn("allFacesSsdMobilenetv1 is deprecated and will be removed soon, use the high level api instead"),[4,Bf($,new fl(M?{minConfidence:M}:{})).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,T.sent()]}})})}function tp($,M){return M===void 0&&(M={}),Object(tr.b)(this,void 0,void 0,function(){return Object(tr.d)(this,function(T){switch(T.label){case 0:return console.warn("allFacesTinyYolov2 is deprecated and will be removed soon, use the high level api instead"),[4,Bf($,new Xh(M)).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,T.sent()]}})})}function gg($,M){return M===void 0&&(M={}),Object(tr.b)(this,void 0,void 0,function(){return Object(tr.d)(this,function(T){switch(T.label){case 0:return console.warn("allFacesMtcnn is deprecated and will be removed soon, use the high level api instead"),[4,Bf($,new ll(M)).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,T.sent()]}})})}var m0=mg;function g0($,M){if($.length!==M.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var T=Array.from($),O=Array.from(M);return Math.sqrt(T.map(function(L,J){return L-O[J]}).reduce(function(L,J){return L+Math.pow(J,2)},0))}var bm=function(){function $(M,T){T===void 0&&(T=.6),this._distanceThreshold=T;var O=Array.isArray(M)?M:[M];if(!O.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var L=1,J=function(){return"person "+L++};this._labeledDescriptors=O.map(function(ie){if(ie instanceof Md)return ie;if(ie instanceof Float32Array)return new Md(J(),[ie]);if(ie.descriptor&&ie.descriptor instanceof Float32Array)return new Md(J(),[ie.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty($.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),$.prototype.computeMeanDistance=function(M,T){return T.map(function(O){return g0(O,M)}).reduce(function(O,L){return O+L},0)/(T.length||1)},$.prototype.matchDescriptor=function(M){var T=this;return this.labeledDescriptors.map(function(O){var L=O.descriptors,J=O.label;return new Cu(J,T.computeMeanDistance(M,L))}).reduce(function(O,L){return O.distance<L.distance?O:L})},$.prototype.findBestMatch=function(M){var T=this.matchDescriptor(M);return T.distance<this.distanceThreshold?T:new Cu("unknown",T.distance)},$.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(M){return M.toJSON()})}},$.fromJSON=function(M){return new $(M.labeledDescriptors.map(function(T){return Md.fromJSON(T)}),M.distanceThreshold)},$}();function v0($){var M=new Ld;return M.extractWeights($),M}function vg($){var M=new jd;return M.extractWeights($),M}function kv($,M){var T=new js(M.width,M.height),O=T.width,L=T.height;if(O<=0||L<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:O,height:L}));if(Array.isArray($))return $.map(function(ge){return kv(ge,{width:O,height:L})});if(ul($)){var J=$.detection.forSize(O,L),ie=$.unshiftedLandmarks.forSize(J.box.width,J.box.height);return Yo(Nd($,J),ie)}return Of($)?Nd($,$.detection.forSize(O,L)):$ instanceof du||$ instanceof aa?$.forSize(O,L):$}var $l={withLandmarks:!0,withDescriptors:!0,minConfidence:.5,withTinyNet:!0,MODEL_URLS:{Mobilenetv1Model:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/ssd_mobilenetv1_model-weights_manifest.json",TinyFaceDetectorModel:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/tiny_face_detector_model-weights_manifest.json",FaceLandmarkModel:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/face_landmark_68_model-weights_manifest.json",FaceLandmark68TinyNet:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/face_landmark_68_tiny_model-weights_manifest.json",FaceRecognitionModel:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/face_recognition_model-weights_manifest.json"}},Ly=function(){function $(M,T,O){oe()(this,$),this.video=M,this.model=null,this.modelReady=!1,this.detectorOptions=null,this.config={minConfidence:this.checkUndefined(T.minConfidence,$l.minConfidence),withLandmarks:this.checkUndefined(T.withLandmarks,$l.withLandmarks),withDescriptors:this.checkUndefined(T.withDescriptors,$l.withDescriptors),withTinyNet:this.checkUndefined(T.withTinyNet,$l.withTinyNet),MODEL_URLS:{Mobilenetv1Model:this.checkUndefined(T.Mobilenetv1Model,$l.MODEL_URLS.Mobilenetv1Model),TinyFaceDetectorModel:this.checkUndefined(T.TinyFaceDetectorModel,$l.MODEL_URLS.TinyFaceDetectorModel),FaceLandmarkModel:this.checkUndefined(T.FaceLandmarkModel,$l.MODEL_URLS.FaceLandmarkModel),FaceLandmark68TinyNet:this.checkUndefined(T.FaceLandmark68TinyNet,$l.MODEL_URLS.FaceLandmark68TinyNet),FaceRecognitionModel:this.checkUndefined(T.FaceRecognitionModel,$l.MODEL_URLS.FaceRecognitionModel)}},this.ready=Ge(this.loadModel(),O)}return _e()($,[{key:"loadModel",value:function(){var M=q()(me.a.mark(function T(){var O,L,J,ie,ge,Ae,Ie,De=this;return me.a.wrap(function(et){for(;;)switch(et.prev=et.next){case 0:if(O=["Mobilenetv1Model","TinyFaceDetectorModel","FaceLandmarkModel","FaceLandmark68TinyNet","FaceRecognitionModel"],Object.keys(this.config.MODEL_URLS).forEach(function(ot){O.includes(ot)&&(De.config.MODEL_URLS[ot]=dc.getModelPath(De.config.MODEL_URLS[ot]))}),L=this.config.MODEL_URLS,J=L.Mobilenetv1Model,ie=L.TinyFaceDetectorModel,ge=L.FaceLandmarkModel,Ae=L.FaceRecognitionModel,Ie=L.FaceLandmark68TinyNet,this.model=R,this.config.withTinyNet===!0?this.detectorOptions=new ag({minConfidence:this.minConfidence,inputSize:512}):this.detectorOptions=new fl({minConfidence:this.minConfidence}),this.config.withTinyNet!==!0){et.next=12;break}return et.next=8,this.model.loadFaceLandmarkTinyModel(Ie);case 8:return et.next=10,this.model.loadTinyFaceDetectorModel(ie);case 10:et.next=16;break;case 12:return et.next=14,this.model.loadFaceLandmarkModel(ge);case 14:return et.next=16,this.model.loadSsdMobilenetv1Model(J);case 16:return et.next=18,this.model.loadFaceRecognitionModel(Ae);case 18:return this.modelReady=!0,et.abrupt("return",this);case 20:case"end":return et.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"detect",value:function(){var M=q()(me.a.mark(function T(O,L,J){var ie,ge,Ae;return me.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:if(ie=this.video,Ae=this.config,typeof O!="function"){Ie.next=7;break}ie=this.video,ge=O,Ie.next=21;break;case 7:if(!(O instanceof HTMLImageElement||O instanceof HTMLCanvasElement||O instanceof HTMLVideoElement||O instanceof ImageData)){Ie.next=11;break}ie=O,Ie.next=21;break;case 11:if(we()(O)!=="object"||!(O.elt instanceof HTMLImageElement||O.elt instanceof HTMLCanvasElement||O.elt instanceof HTMLVideoElement||O.elt instanceof ImageData)){Ie.next=15;break}ie=O.elt,Ie.next=21;break;case 15:if(!(we()(O)==="object"&&O.canvas instanceof HTMLCanvasElement)){Ie.next=19;break}ie=O.canvas,Ie.next=21;break;case 19:if(this.video instanceof HTMLVideoElement){Ie.next=21;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 21:return we()(L)==="object"?Ae=L:typeof L=="function"&&(ge=L),typeof J=="function"&&(ge=J),Ie.abrupt("return",Ge(this.detectInternal(ie,Ae),ge));case 24:case"end":return Ie.stop()}},T,this)}));return function(T,O,L){return M.apply(this,arguments)}}()},{key:"detectInternal",value:function(){var M=q()(me.a.mark(function T(O,L){var J,ie,ge,Ae,Ie=this;return me.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return De.next=2,this.ready;case 2:return De.next=4,I.nextFrame();case 4:if(!this.video||this.video.readyState!==0){De.next=7;break}return De.next=7,new Promise(function(et){Ie.video.onloadeddata=function(){return et()}});case 7:if(this.config=this.setReturnOptions(L),J=this.config,ie=J.withLandmarks,ge=J.withDescriptors,!ie){De.next=21;break}if(!ge){De.next=16;break}return De.next=13,this.model.detectAllFaces(O,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptors();case 13:Ae=De.sent,De.next=19;break;case 16:return De.next=18,this.model.detectAllFaces(O,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet);case 18:Ae=De.sent;case 19:De.next=30;break;case 21:if(ie){De.next=27;break}return De.next=24,this.model.detectAllFaces(O);case 24:Ae=De.sent,De.next=30;break;case 27:return De.next=29,this.model.detectAllFaces(O,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptors();case 29:Ae=De.sent;case 30:return Ae=this.resizeResults(Ae,O.width,O.height),Ae=this.landmarkParts(Ae),De.abrupt("return",Ae);case 33:case"end":return De.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()},{key:"detectSingle",value:function(){var M=q()(me.a.mark(function T(O,L,J){var ie,ge,Ae;return me.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:if(ie=this.video,Ae=this.config,typeof O!="function"){Ie.next=7;break}ie=this.video,ge=O,Ie.next=21;break;case 7:if(!(O instanceof HTMLImageElement||O instanceof HTMLCanvasElement||O instanceof HTMLVideoElement||O instanceof ImageData)){Ie.next=11;break}ie=O,Ie.next=21;break;case 11:if(we()(O)!=="object"||!(O.elt instanceof HTMLImageElement||O.elt instanceof HTMLCanvasElement||O.elt instanceof HTMLVideoElement||O.elt instanceof ImageData)){Ie.next=15;break}ie=O.elt,Ie.next=21;break;case 15:if(!(we()(O)==="object"&&O.canvas instanceof HTMLCanvasElement)){Ie.next=19;break}ie=O.canvas,Ie.next=21;break;case 19:if(this.video instanceof HTMLVideoElement){Ie.next=21;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 21:return we()(L)==="object"?Ae=L:typeof L=="function"&&(ge=L),typeof J=="function"&&(ge=J),Ie.abrupt("return",Ge(this.detectSingleInternal(ie,Ae),ge));case 24:case"end":return Ie.stop()}},T,this)}));return function(T,O,L){return M.apply(this,arguments)}}()},{key:"detectSingleInternal",value:function(){var M=q()(me.a.mark(function T(O,L){var J,ie,ge,Ae,Ie=this;return me.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return De.next=2,this.ready;case 2:return De.next=4,I.nextFrame();case 4:if(!this.video||this.video.readyState!==0){De.next=7;break}return De.next=7,new Promise(function(et){Ie.video.onloadeddata=function(){return et()}});case 7:if(this.config=this.setReturnOptions(L),J=this.config,ie=J.withLandmarks,ge=J.withDescriptors,!ie){De.next=21;break}if(!ge){De.next=16;break}return De.next=13,this.model.detectSingleFace(O,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptor();case 13:Ae=De.sent,De.next=19;break;case 16:return De.next=18,this.model.detectSingleFace(O,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet);case 18:Ae=De.sent;case 19:De.next=30;break;case 21:if(ie){De.next=27;break}return De.next=24,this.model.detectSingleFace(O);case 24:Ae=De.sent,De.next=30;break;case 27:return De.next=29,this.model.detectSingleFace(O,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptor();case 29:Ae=De.sent;case 30:return Ae=this.resizeResults(Ae,O.width,O.height),Ae=this.landmarkParts(Ae),De.abrupt("return",Ae);case 33:case"end":return De.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()},{key:"checkUndefined",value:function(M,T){return M!==void 0?M:T}},{key:"setReturnOptions",value:function(M){var T=this,O=Object.assign({},this.config);return["withLandmarks","withDescriptors"].forEach(function(L){M[L]!==void 0?T.config[L]=M[L]:O[L]=T.config[L]}),O}},{key:"resizeResults",value:function(M,T,O){if(T===void 0||O===void 0)throw new Error("width and height must be defined");return this.model.resizeResults(M,{width:T,height:O})}},{key:"landmarkParts",value:function(M){var T;if(Array.isArray(M)===!0)T=M.map(function(L){var J=Object.assign({},L);if(J.landmarks){var ie=J.landmarks;J.parts={mouth:ie.getMouth(),nose:ie.getNose(),leftEye:ie.getLeftEye(),leftEyeBrow:ie.getLeftEyeBrow(),rightEye:ie.getRightEye(),rightEyeBrow:ie.getRightEyeBrow(),jawOutline:ie.getJawOutline()}}else J.parts={mouth:[],nose:[],leftEye:[],leftEyeBrow:[],rightEye:[],rightEyeBrow:[],jawOutline:[]};return J});else if((T=Object.assign({},M)).landmarks){var O=M.landmarks;T.parts={mouth:O.getMouth(),nose:O.getNose(),leftEye:O.getLeftEye(),leftEyeBrow:O.getLeftEyeBrow(),rightEye:O.getRightEye(),rightEyeBrow:O.getRightEyeBrow()}}else T.parts={mouth:[],nose:[],leftEye:[],leftEyeBrow:[],rightEye:[],rightEyeBrow:[]};return T}}]),$}(),Av=function($,M,T){var O,L={},J=T;$ instanceof HTMLVideoElement?O=$:we()($)==="object"&&$.elt instanceof HTMLVideoElement?O=$.elt:we()($)==="object"?L=$:typeof $=="function"&&(J=$),we()(M)==="object"?(L=M,console.log(L)):typeof M=="function"&&(J=M);var ie=new Ly(O,L,J);return J?ie:ie.ready},xm={k:3,maxIter:5,threshold:.5};function Ov($){return jf.apply(this,arguments)}function jf(){return(jf=q()(me.a.mark(function $(M){var T,O;return me.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return T=I.data.csv(M),L.next=3,T.toArray();case 3:return O=L.sent,L.abrupt("return",O);case 5:case"end":return L.stop()}},$)}))).apply(this,arguments)}function Tv($){return wm.apply(this,arguments)}function wm(){return(wm=q()(me.a.mark(function $(M){var T,O;return me.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(typeof M!="string"){L.next=6;break}return L.next=3,Ov(M);case 3:T=L.sent,L.next=7;break;case 6:T=M;case 7:return O=T.map(function(J){return Object.values(J)}),L.abrupt("return",O);case 9:case"end":return L.stop()}},$)}))).apply(this,arguments)}var yg=function(){function $(M,T,O){oe()(this,$),this.config={k:T.k||xm.k,maxIter:T.maxIter||xm.maxIter,threshold:T.threshold||xm.threshold},this.ready=Ge(this.load(M),O)}return _e()($,[{key:"load",value:function(){var M=q()(me.a.mark(function T(O){var L=this;return me.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,Tv(O);case 2:return this.dataset=J.sent,I.tidy(function(){L.dataTensor=I.tensor2d(L.dataset),L.dataset.forEach(function(ie){var ge=I.tensor1d(Object.values(ie));ie.tensor=ge}),L.centroids=I.tensor2d(kd(L.dataset,L.config.k,!1)),L.fit()}),J.abrupt("return",this);case 5:case"end":return J.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"fit",value:function(){this.getClosestCentroids(),this.recenterCentroids();for(var M=$.getEuclidianDistance(this.centroids,this.centroidsOld),T=0;M>this.config.threshold&&T<this.config.maxIter;)this.getClosestCentroids(),this.recenterCentroids(),M=$.getEuclidianDistance(this.centroids,this.centroidsOld),T+=1}},{key:"getClosestCentroids",value:function(){var M=this;this.dataset.forEach(function(T){var O=M.closestCentroid(T.tensor);T.centroid=O})}},{key:"closestCentroid",value:function(M){var T=this;return I.tidy(function(){return T.centroids.squaredDifference(M).sum(1).sqrt().argMin().arraySync()})}},{key:"classify",value:function(M){var T=this;return I.tidy(function(){var O=I.tensor1d(Object.values(M));return T.closestCentroid(O)})}},{key:"recenterCentroids",value:function(){var M=this,T=I.tidy(function(){return M.centroidsOld=M.centroids,I.stack(M.centroids.unstack().map(function(O,L){var J=M.dataset.filter(function(ie){return ie.centroid===L}).map(function(ie){return ie.tensor});return J.length===0?O:J.length===1?J[0]:I.tidy(function(){return I.stack(J).mean(0)})}))});this.centroids=T}}],[{key:"getEuclidianDistance",value:function(M,T){return I.tidy(function(){return I.squaredDifference(M,T).sum().sqrt().dataSync()})[0]}}]),$}(),Mv=function($,M,T){return new yg($,M,T)};function Dv($){return y0.apply(this,arguments)}function y0(){return(y0=q()(me.a.mark(function $(M){var T,O;return me.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return T=I.data.csv(M),L.next=3,T.toArray();case 3:return O=L.sent,L.abrupt("return",O);case 5:case"end":return L.stop()}},$)}))).apply(this,arguments)}function Nv($){return Iv.apply(this,arguments)}function Iv(){return(Iv=q()(me.a.mark(function $(M){var T,O;return me.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(typeof M!="string"){L.next=6;break}return L.next=3,Dv(M);case 3:T=L.sent,L.next=7;break;case 6:T=M;case 7:return O=T.map(function(J){return Object.values(J)}),L.abrupt("return",O);case 9:case"end":return L.stop()}},$)}))).apply(this,arguments)}var qd={eps:50,minPts:3},By=function(){function $(M,T,O){oe()(this,$),this.config={eps:T.eps||qd.eps,minPts:T.minPts||qd.minPts},this.lastClusterId=0,this.status=[],this.ready=Ge(this.load(M),O)}return _e()($,[{key:"load",value:function(){var M=q()(me.a.mark(function T(O){var L=this;return me.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,Nv(O);case 2:return this.dataset=J.sent,I.tidy(function(){L.dataTensor=I.tensor2d(L.dataset),L.dataset.forEach(function(ie){var ge=I.tensor1d(Object.values(ie));ie.tensor=ge}),L.fit()}),J.abrupt("return",this);case 5:case"end":return J.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"fit",value:function(){var M=this;this.dataset.forEach(function(T,O){if(T.status===void 0){T.status=0;var L=M.getNeighboursIndices(T);L.length<M.config.minPts?T.status=0:(M.incrementClusterId(),M.extend(O,L))}})}},{key:"extend",value:function(M,T){var O=this;this.dataset[M].clusterid=this.getClusterId(),this.dataset[M].status=this.dataset[M].clusterid,T.forEach(function(L){if(O.dataset[L].status===void 0){O.dataset[L].status=0;var J=O.getNeighboursIndices(O.dataset[L]);J.length>=O.config.minPts&&O.extend(L,J)}O.dataset[L].status<1&&(O.dataset[L].status=O.dataset[M].clusterid,O.dataset[L].clusterid=O.dataset[M].clusterid)})}},{key:"getClusterId",value:function(){return this.lastClusterId}},{key:"incrementClusterId",value:function(){this.lastClusterId+=1}},{key:"getNeighboursIndices",value:function(M){var T=this;try{return I.tidy(function(){var O=I.squaredDifference(M.tensor,T.dataTensor).sum(1).sqrt().topk(T.dataTensor.shape[0],!0),L=O.values,J=O.indices;return I.stack([L.asType("float32"),J.asType("float32")],1).arraySync().filter(function(ie){return ie[0]<=T.config.eps}).reduce(function(ie,ge){return ie.push(ge[1]),ie},[])})||[]}catch(O){console.log("error ".concat(O))}return[]}}]),$}(),Fv=function($,M,T){return new By($,M,T)},Xl={hosoda:"https://raw.githubusercontent.com/leemengtaiwan/tfjs-models/master/cartoongan/tfjs_json_models/hosoda/model.json",miyazaki:"https://raw.githubusercontent.com/Derek-Wds/training_CartoonGAN/master/tfModels/Miyazaki/model.json"},b0=function(){function $(M,T){oe()(this,$),this.config={modelUrl:M.modelUrl?M.modelUrl:Xl.miyazaki,returnTensors:!!M.returnTensors&&M.returnTensors},this.model={},this.ready=!1,this.ready=Ge(this.loadModel(this.config.modelUrl),T)}return _e()($,[{key:"loadModel",value:function(){var M=q()(me.a.mark(function T(O){return me.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,I.loadGraphModel(O);case 2:return this.model=L.sent,L.abrupt("return",this);case 4:case"end":return L.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"generate",value:function(){var M=q()(me.a.mark(function T(O,L){var J,ie;return me.a.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:if(ie=L,!Dt(O)){ge.next=5;break}J=O,ge.next=19;break;case 5:if(we()(O)!=="object"||!Dt(O.elt)){ge.next=9;break}J=O.elt,ge.next=19;break;case 9:if(we()(O)!=="object"||!Dt(O.canvas)){ge.next=13;break}J=O.canvas,ge.next=19;break;case 13:if(typeof O!="function"){ge.next=18;break}J=this.video,ie=O,ge.next=19;break;case 18:throw new Error("Detection subject not supported");case 19:return ge.abrupt("return",Ge(this.generateInternal(J),ie));case 20:case"end":return ge.stop()}},T,this)}));return function(T,O){return M.apply(this,arguments)}}()},{key:"generateInternal",value:function(){var M=q()(me.a.mark(function T(O){var L,J,ie,ge;return me.a.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:return Ae.next=2,this.ready;case 2:return Ae.next=4,I.nextFrame();case 4:if((L=I.browser.fromPixels(O).resizeBilinear([256,256])).shape[0]===256&&L.shape[1]===256){Ae.next=9;break}throw new Error("Input size should be ".concat(256,"*").concat(256," but ").concat(L.shape," is found"));case 9:if(L.shape[2]===3){Ae.next=11;break}throw new Error("Input color channel number should be 3 but ".concat(L.shape[2]," is found"));case 11:if(L=L.sub(127.5).div(127.5).reshape([1,256,256,3]),J=I.ones([256,256,1]).tile([1,1,1]).mul(255),ie=(ie=(ie=this.model.predict(L)).add(1).mul(127.5).reshape([256,256,3]).floor()).concat(J,2),ge=this.resultFinalize(ie),!this.config.returnTensors){Ae.next=19;break}return Ae.abrupt("return",ge);case 19:return L.dispose(),ie.dispose(),Ae.abrupt("return",ge);case 22:case"end":return Ae.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"resultFinalize",value:function(){var M=q()(me.a.mark(function T(O){var L,J,ie,ge;return me.a.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:return L=O,Ae.next=3,O.data();case 3:return J=Ae.sent,Ae.next=6,Gt.rawToBlob(J,O.shape[0],O.shape[1]);case 6:return ie=Ae.sent,Ae.next=9,Gt.blobToP5Image(ie);case 9:if(ge=Ae.sent,!this.config.returnTensors){Ae.next=12;break}return Ae.abrupt("return",{tensor:L,raw:J,blob:ie,image:ge});case 12:return Ae.abrupt("return",{raw:J,blob:ie,image:ge});case 13:case"end":return Ae.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()}]),$}(),Rv=function($,M){var T=we()($)==="object"?$:{},O=typeof $=="function"?$:M;return typeof $=="string"&&(T.modelUrl=$),new b0(T,O)};function $d($,M,T,O){return new(T||(T=Promise))(function(L,J){function ie(Ie){try{Ae(O.next(Ie))}catch(De){J(De)}}function ge(Ie){try{Ae(O.throw(Ie))}catch(De){J(De)}}function Ae(Ie){var De;Ie.done?L(Ie.value):(De=Ie.value,De instanceof T?De:new T(function(et){et(De)})).then(ie,ge)}Ae((O=O.apply($,M||[])).next())})}function Kl($,M){var T,O,L,J,ie={label:0,sent:function(){if(1&L[0])throw L[1];return L[1]},trys:[],ops:[]};return J={next:ge(0),throw:ge(1),return:ge(2)},typeof Symbol=="function"&&(J[Symbol.iterator]=function(){return this}),J;function ge(Ae){return function(Ie){return function(De){if(T)throw new TypeError("Generator is already executing.");for(;ie;)try{if(T=1,O&&(L=2&De[0]?O.return:De[0]?O.throw||((L=O.return)&&L.call(O),0):O.next)&&!(L=L.call(O,De[1])).done)return L;switch(O=0,L&&(De=[2&De[0],L.value]),De[0]){case 0:case 1:L=De;break;case 4:return ie.label++,{value:De[1],done:!1};case 5:ie.label++,O=De[1],De=[0];continue;case 7:De=ie.ops.pop(),ie.trys.pop();continue;default:if(!(L=(L=ie.trys).length>0&&L[L.length-1])&&(De[0]===6||De[0]===2)){ie=0;continue}if(De[0]===3&&(!L||De[1]>L[0]&&De[1]<L[3])){ie.label=De[1];break}if(De[0]===6&&ie.label<L[1]){ie.label=L[1],L=De;break}if(L&&ie.label<L[2]){ie.label=L[2],ie.ops.push(De);break}L[2]&&ie.ops.pop(),ie.trys.pop();continue}De=M.call($,ie)}catch(et){De=[6,et],O=0}finally{T=L=0}if(5&De[0])throw De[1];return{value:De[0]?De[1]:void 0,done:!0}}([Ae,Ie])}}}var bg=function($){for(var M=[],T=0,O=$;T<O.length;T++){var L=O[T];M.push(L)}return M},x0=function(){this.parent=null,this.children={},this.end=!1,this.word=[[],0,0]},Vc=function(){function $(){this.root=new x0}return $.prototype.insert=function(M,T,O){for(var L=this.root,J=bg(M),ie=0;ie<J.length;ie++)L.children[J[ie]]||(L.children[J[ie]]=new x0,L.children[J[ie]].parent=L,L.children[J[ie]].word[0]=L.word[0].concat(J[ie])),L=L.children[J[ie]],ie===J.length-1&&(L.end=!0,L.word[1]=T,L.word[2]=O)},$.prototype.commonPrefixSearch=function(M){for(var T=[],O=this.root.children[M[0]],L=0;L<M.length&&O;L++)O.end&&T.push(O.word),O=O.children[M[L+1]];return T.length||T.push([[M[0]],0,0]),T},$}(),w0="",Pv=6,zf=function(){function $(M,T){T===void 0&&(T=Pv),this.vocabulary=M,this.reservedSymbolsCount=T,this.trie=new Vc;for(var O=this.reservedSymbolsCount;O<this.vocabulary.length;O++)this.trie.insert(this.vocabulary[O][0],this.vocabulary[O][1],O)}return $.prototype.encode=function(M){var T=[],O=[],L=[];M=function(Tn){var _r=Tn.normalize("NFKC");return _r.length>0?w0+_r.replace(/ /g,w0):_r}(M);for(var J=bg(M),ie=0;ie<=J.length;ie++)T.push({}),O.push(0),L.push(0);for(ie=0;ie<J.length;ie++)for(var ge=this.trie.commonPrefixSearch(J.slice(ie)),Ae=0;Ae<ge.length;Ae++){var Ie=ge[Ae],De={key:Ie[0],score:Ie[1],index:Ie[2]};T[ie+(et=Ie[0].length)][ie]==null&&(T[ie+et][ie]=[]),T[ie+et][ie].push(De)}for(var et=0;et<=J.length;et++)for(var ot in T[et]){var zt=T[et][ot];for(Ae=0;Ae<zt.length;Ae++){var Ht=zt[Ae],xn=Ht.score+L[et-Ht.key.length];(L[et]===0||xn>=L[et])&&(L[et]=xn,O[et]=zt[Ae].index)}}for(var En=[],Fn=O.length-1;Fn>0;)En.push(O[Fn]),Fn-=this.vocabulary[O[Fn]][0].length;var Rn=[],Wn=!1;for(ie=0;ie<En.length;ie++){var Jn=En[ie];Wn&&Jn===0||Rn.push(Jn),Wn=Jn===0}return Rn.reverse()},$}();function jy($){return $d(this,void 0,void 0,function(){var M;return Kl(this,function(T){switch(T.label){case 0:return[4,np($)];case 1:return M=T.sent(),[2,new zf(M)]}})})}function np($){return $d(this,void 0,void 0,function(){return Kl(this,function(M){switch(M.label){case 0:return[4,ze.util.fetch($)];case 1:return[2,M.sent().json()]}})})}function rp($){return $d(this,void 0,void 0,function(){var M;return Kl(this,function(T){switch(T.label){case 0:return[4,(M=new Uf).load($)];case 1:return T.sent(),[2,M]}})})}var Uf=function(){function $(){}return $.prototype.loadModel=function(M){return $d(this,void 0,void 0,function(){return Kl(this,function(T){return[2,M?Object(Ot.loadGraphModel)(M):Object(Ot.loadGraphModel)("https://tfhub.dev/tensorflow/tfjs-model/universal-sentence-encoder-lite/1/default/1",{fromTFHub:!0})]})})},$.prototype.load=function(M){return M===void 0&&(M={}),$d(this,void 0,void 0,function(){var T,O,L;return Kl(this,function(J){switch(J.label){case 0:return[4,Promise.all([this.loadModel(M.modelUrl),np(M.vocabUrl||"https://storage.googleapis.com/tfjs-models/savedmodel/universal_sentence_encoder/vocab.json")])];case 1:return T=J.sent(),O=T[0],L=T[1],this.model=O,this.tokenizer=new zf(L),[2]}})})},$.prototype.embed=function(M){return $d(this,void 0,void 0,function(){var T,O,L,J,ie,ge,Ae,Ie,De=this;return Kl(this,function(et){switch(et.label){case 0:for(typeof M=="string"&&(M=[M]),T=M.map(function(ot){return De.tokenizer.encode(ot)}),O=T.map(function(ot,zt){return ot.map(function(Ht,xn){return[zt,xn]})}),L=[],J=0;J<O.length;J++)L=L.concat(O[J]);return ie=Object(ze.tensor2d)(L,[L.length,2],"int32"),ge=Object(ze.tensor1d)(ze.util.flatten(T),"int32"),Ae={indices:ie,values:ge},[4,this.model.executeAsync(Ae)];case 1:return Ie=et.sent(),ie.dispose(),ge.dispose(),[2,Ie]}})})},$}(),Lv={withTokenizer:!1},Xd=function(){function $(M,T){oe()(this,$),this.model=null,this.tokenizer=null,this.config={withTokenizer:M.withTokenizer||Lv.withTokenizer},Ge(this.loadModel(),T)}return _e()($,[{key:"loadModel",value:function(){var M=q()(me.a.mark(function T(){return me.a.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(this.config.withTokenizer!==!0){O.next=4;break}return O.next=3,jy();case 3:this.tokenizer=O.sent;case 4:return O.next=6,rp();case 6:return this.model=O.sent,O.abrupt("return",this);case 8:case"end":return O.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"predict",value:function(M,T){return Ge(this.predictInternal(M),T)}},{key:"predictInternal",value:function(){var M=q()(me.a.mark(function T(O){var L,J;return me.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.prev=0,ie.next=3,this.model.embed(O);case 3:return L=ie.sent,ie.next=6,L.array();case 6:return J=ie.sent,L.dispose(),ie.abrupt("return",J);case 11:return ie.prev=11,ie.t0=ie.catch(0),console.error(ie.t0),ie.abrupt("return",ie.t0);case 15:case"end":return ie.stop()}},T,this,[[0,11]])}));return function(T){return M.apply(this,arguments)}}()},{key:"encode",value:function(M,T){return Ge(this.encodeInternal(M),T)}},{key:"encodeInternal",value:function(){var M=q()(me.a.mark(function T(O){return me.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(this.config.withTokenizer!==!0){L.next=2;break}return L.abrupt("return",this.tokenizer.encode(O));case 2:return console.error('withTokenizer must be set to true - please pass "withTokenizer:true" as an option in the constructor'),L.abrupt("return",!1);case 4:case"end":return L.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()}]),$}(),Hc=function($,M){var T=we()($)==="object"?$:{};return new Xd(T,typeof $=="function"?$:M)};const ip=$=>{$.startEndTensor.dispose(),$.startPoint.dispose(),$.endPoint.dispose()},_m=$=>({startEndTensor:$,startPoint:Object(ze.slice)($,[0,0],[-1,2]),endPoint:Object(ze.slice)($,[0,2],[-1,2])}),xg=($,M)=>{const T=Object(ze.mul)($.startPoint,M),O=Object(ze.mul)($.endPoint,M),L=Object(ze.concat2d)([T,O],1);return _m(L)},_0={strides:[8,16],anchors:[2,6]},Bv=6;function ms($,M){let T,O,L;if($.topLeft instanceof ze.Tensor&&$.bottomRight instanceof ze.Tensor){const[ie,ge]=Object(ze.tidy)(()=>[Object(ze.concat)([Object(ze.sub)(M-1,$.topLeft.slice(0,1)),$.topLeft.slice(1,1)]),Object(ze.concat)([Object(ze.sub)(M-1,$.bottomRight.slice(0,1)),$.bottomRight.slice(1,1)])]);T=ie,O=ge,$.landmarks!=null&&(L=Object(ze.tidy)(()=>{const Ae=Object(ze.sub)(Object(ze.tensor1d)([M-1,0]),$.landmarks),Ie=Object(ze.tensor1d)([1,-1]);return Object(ze.mul)(Ae,Ie)}))}else{const[ie,ge]=$.topLeft,[Ae,Ie]=$.bottomRight;T=[M-1-ie,ge],O=[M-1-Ae,Ie],$.landmarks!=null&&(L=$.landmarks.map(De=>[M-1-De[0],De[1]]))}const J={topLeft:T,bottomRight:O};return L!=null&&(J.landmarks=L),$.probability!=null&&(J.probability=$.probability instanceof ze.Tensor?$.probability.clone():$.probability),J}function jv($,M){return Object(ze.tidy)(()=>{let T;return T=$.hasOwnProperty("box")?$.box:$,xg(T,M).startEndTensor.squeeze()})}class op{constructor(M,T,O,L,J,ie){this.blazeFaceModel=M,this.width=T,this.height=O,this.maxFaces=L,this.anchorsData=function(ge,Ae,Ie){const De=[];for(let et=0;et<Ie.strides.length;et++){const ot=Ie.strides[et],zt=Math.floor((Ae+ot-1)/ot),Ht=Math.floor((ge+ot-1)/ot),xn=Ie.anchors[et];for(let En=0;En<zt;En++){const Fn=ot*(En+.5);for(let Rn=0;Rn<Ht;Rn++){const Wn=ot*(Rn+.5);for(let Jn=0;Jn<xn;Jn++)De.push([Wn,Fn])}}}return De}(T,O,_0),this.anchors=Object(ze.tensor2d)(this.anchorsData),this.inputSizeData=[T,O],this.inputSize=Object(ze.tensor1d)([T,O]),this.iouThreshold=J,this.scoreThreshold=ie}async getBoundingBoxes(M,T,O=!0){const[L,J,ie]=Object(ze.tidy)(()=>{const xn=M.resizeBilinear([this.width,this.height]),En=Object(ze.mul)(Object(ze.sub)(xn.div(255),.5),2),Fn=this.blazeFaceModel.predict(En).squeeze(),Rn=function(Jn,Tn,_r){const Nr=Object(ze.slice)(Jn,[0,1],[-1,2]),Ir=Object(ze.add)(Nr,Tn),Qr=Object(ze.slice)(Jn,[0,3],[-1,2]),zr=Object(ze.div)(Qr,_r),ki=Object(ze.div)(Ir,_r),Pi=Object(ze.div)(zr,2),Fi=Object(ze.sub)(ki,Pi),Mo=Object(ze.add)(ki,Pi),Jo=Object(ze.mul)(Fi,_r),jo=Object(ze.mul)(Mo,_r);return Object(ze.concat2d)([Jo,jo],1)}(Fn,this.anchors,this.inputSize),Wn=Object(ze.slice)(Fn,[0,0],[-1,1]);return[Fn,Rn,Object(ze.sigmoid)(Wn).squeeze()]}),ge=console.warn;console.warn=()=>{};const Ae=ze.image.nonMaxSuppression(J,ie,this.maxFaces,this.iouThreshold,this.scoreThreshold);console.warn=ge;const Ie=await Ae.array();Ae.dispose();let De=Ie.map(xn=>Object(ze.slice)(J,[xn,0],[1,-1]));T||(De=await Promise.all(De.map(async xn=>{const En=await xn.array();return xn.dispose(),En})));const et=M.shape[1],ot=M.shape[2];let zt;zt=T?Object(ze.div)([ot,et],this.inputSize):[ot/this.inputSizeData[0],et/this.inputSizeData[1]];const Ht=[];for(let xn=0;xn<De.length;xn++){const En=De[xn],Fn=Object(ze.tidy)(()=>{const Rn=_m(En instanceof ze.Tensor?En:Object(ze.tensor2d)(En));if(!O)return Rn;const Wn=Ie[xn];let Jn;return Jn=T?this.anchors.slice([Wn,0],[1,2]):this.anchorsData[Wn],{box:Rn,landmarks:Object(ze.slice)(L,[Wn,Bv-1],[1,-1]).squeeze().reshape([Bv,-1]),probability:Object(ze.slice)(ie,[Wn],[1]),anchor:Jn}});Ht.push(Fn)}return J.dispose(),ie.dispose(),L.dispose(),{boxes:Ht,scaleFactor:zt}}async estimateFaces(M,T=!1,O=!1,L=!0){const[,J]=function(Ie){return Ie instanceof ze.Tensor?[Ie.shape[0],Ie.shape[1]]:[Ie.height,Ie.width]}(M),ie=Object(ze.tidy)(()=>(M instanceof ze.Tensor||(M=ze.browser.fromPixels(M)),M.toFloat().expandDims(0))),{boxes:ge,scaleFactor:Ae}=await this.getBoundingBoxes(ie,T,L);return ie.dispose(),T?ge.map(Ie=>{const De=jv(Ie,Ae);let et={topLeft:De.slice([0],[2]),bottomRight:De.slice([2],[2])};if(L){const{landmarks:ot,probability:zt,anchor:Ht}=Ie,xn=ot.add(Ht).mul(Ae);et.landmarks=xn,et.probability=zt}return O&&(et=ms(et,J)),et}):Promise.all(ge.map(async Ie=>{const De=jv(Ie,Ae);let et;if(L){const[ot,zt,Ht]=await Promise.all([Ie.landmarks,De,Ie.probability].map(async Wn=>Wn.array())),xn=Ie.anchor,[En,Fn]=Ae,Rn=ot.map(Wn=>[(Wn[0]+xn[0])*En,(Wn[1]+xn[1])*Fn]);et={topLeft:zt.slice(0,2),bottomRight:zt.slice(2),landmarks:Rn,probability:Ht},ip(Ie.box),Ie.landmarks.dispose(),Ie.probability.dispose()}else{const ot=await De.array();et={topLeft:ot.slice(0,2),bottomRight:ot.slice(2)}}return De.dispose(),O&&(et=ms(et,J)),et}))}}const zv="https://tfhub.dev/tensorflow/tfjs-model/blazeface/1/default/1",wg={silhouette:[10,338,297,332,284,251,389,356,454,323,361,288,397,365,379,378,400,377,152,148,176,149,150,136,172,58,132,93,234,127,162,21,54,103,67,109],lipsUpperOuter:[61,185,40,39,37,0,267,269,270,409,291],lipsLowerOuter:[146,91,181,84,17,314,405,321,375,291],lipsUpperInner:[78,191,80,81,82,13,312,311,310,415,308],lipsLowerInner:[78,95,88,178,87,14,317,402,318,324,308],rightEyeUpper0:[246,161,160,159,158,157,173],rightEyeLower0:[33,7,163,144,145,153,154,155,133],rightEyeUpper1:[247,30,29,27,28,56,190],rightEyeLower1:[130,25,110,24,23,22,26,112,243],rightEyeUpper2:[113,225,224,223,222,221,189],rightEyeLower2:[226,31,228,229,230,231,232,233,244],rightEyeLower3:[143,111,117,118,119,120,121,128,245],rightEyebrowUpper:[156,70,63,105,66,107,55,193],rightEyebrowLower:[35,124,46,53,52,65],leftEyeUpper0:[466,388,387,386,385,384,398],leftEyeLower0:[263,249,390,373,374,380,381,382,362],leftEyeUpper1:[467,260,259,257,258,286,414],leftEyeLower1:[359,255,339,254,253,252,256,341,463],leftEyeUpper2:[342,445,444,443,442,441,413],leftEyeLower2:[446,261,448,449,450,451,452,453,464],leftEyeLower3:[372,340,346,347,348,349,350,357,465],leftEyebrowUpper:[383,300,293,334,296,336,285,417],leftEyebrowLower:[265,353,276,283,282,295],midwayBetweenEyes:[168],noseTip:[1],noseBottom:[2],noseRightCorner:[98],noseLeftCorner:[327],rightCheek:[205],leftCheek:[425]};function Wf($){$!=null&&$.startPoint!=null&&($.startEndTensor.dispose(),$.startPoint.dispose(),$.endPoint.dispose())}function Em($,M,T){return{startEndTensor:$,startPoint:M??Object(ze.slice)($,[0,0],[-1,2]),endPoint:T??Object(ze.slice)($,[0,2],[-1,2])}}function Yl($){return Object(ze.tidy)(()=>{const M=Object(ze.sub)($.endPoint,$.startPoint);return Object(ze.abs)(M)})}function Uv($,M=1.5){return Object(ze.tidy)(()=>{const T=function(ge){return Object(ze.tidy)(()=>{const Ae=Object(ze.div)(Object(ze.sub)(ge.endPoint,ge.startPoint),2);return Object(ze.add)(ge.startPoint,Ae)})}($),O=Yl($),L=Object(ze.mul)(Object(ze.div)(O,2),M),J=Object(ze.sub)(T,L),ie=Object(ze.add)(T,L);return Em(Object(ze.concat2d)([J,ie],1),J,ie)})}const _g=468,Eg=.25;class E0{constructor(M,T,O,L,J,ie){this.regionsOfInterest=[],this.runsWithoutFaceDetector=0,this.boundingBoxDetector=M,this.meshDetector=T,this.meshWidth=O,this.meshHeight=L,this.maxContinuousChecks=J,this.maxFaces=ie}async predict(M){if(this.shouldUpdateRegionsOfInterest()){const{boxes:L,scaleFactor:J}=await this.boundingBoxDetector.getBoundingBoxes(M,!0,!1);if(L.length===0)return J.dispose(),this.clearAllRegionsOfInterest(),null;const ie=L.map(ge=>Uv(function(Ae,Ie){const De=Object(ze.mul)(Ae.startPoint,Ie),et=Object(ze.mul)(Ae.endPoint,Ie);return Em(Object(ze.concat2d)([De,et],1))}(ge,J)));L.forEach(Wf),this.updateRegionsOfInterest(ie),this.runsWithoutFaceDetector=0}else this.runsWithoutFaceDetector++;return Object(ze.tidy)(()=>this.regionsOfInterest.map((T,O)=>{const L=function(et,ot,zt){const Ht=ot.shape[1],xn=ot.shape[2],En=et.startEndTensor;return Object(ze.tidy)(()=>{const Fn=Object(ze.concat2d)([En.slice([0,1],[-1,1]),En.slice([0,0],[-1,1]),En.slice([0,3],[-1,1]),En.slice([0,2],[-1,1])],0),Rn=Object(ze.div)(Fn.transpose(),[Ht,xn,Ht,xn]);return ze.image.cropAndResize(ot,Rn,[0],zt)})}(T,M,[this.meshHeight,this.meshWidth]).div(255),[,J,ie]=this.meshDetector.predict(L),ge=Object(ze.reshape)(ie,[-1,3]),Ae=Object(ze.div)(Yl(T),[this.meshWidth,this.meshHeight]),Ie=Object(ze.mul)(ge,Ae.concat(Object(ze.tensor2d)([1],[1,1]),1)).add(T.startPoint.concat(Object(ze.tensor2d)([0],[1,1]),1)),De=this.calculateLandmarksBoundingBox(Ie);return Wf(this.regionsOfInterest[O]),this.regionsOfInterest[O]=De,{coords:ge,scaledCoords:Ie,box:De,flag:J.squeeze()}}))}updateRegionsOfInterest(M){for(let T=0;T<M.length;T++){const O=M[T],L=this.regionsOfInterest[T];let J=0;if(L&&L.startPoint){const[ie,ge,Ae,Ie]=O.startEndTensor.arraySync()[0],[De,et,ot,zt]=L.startEndTensor.arraySync()[0],Ht=Math.max(ie,De),xn=Math.max(ge,et),En=(Math.min(Ae,ot)-Ht)*(Math.min(Ie,zt)-xn);J=En/((Ae-ie)*(Ie-ge)+(ot-De)*(zt-ge)-En)}J>Eg?Wf(O):(this.regionsOfInterest[T]=O,Wf(L))}for(let T=M.length;T<this.regionsOfInterest.length;T++)Wf(this.regionsOfInterest[T]);this.regionsOfInterest=this.regionsOfInterest.slice(0,M.length)}clearRegionOfInterest(M){this.regionsOfInterest[M]!=null&&(Wf(this.regionsOfInterest[M]),this.regionsOfInterest=[...this.regionsOfInterest.slice(0,M),...this.regionsOfInterest.slice(M+1)])}clearAllRegionsOfInterest(){for(let M=0;M<this.regionsOfInterest.length;M++)Wf(this.regionsOfInterest[M]);this.regionsOfInterest=[]}shouldUpdateRegionsOfInterest(){const M=this.regionsOfInterest.length,T=M===0;return this.maxFaces===1||T?T:M!==this.maxFaces&&this.runsWithoutFaceDetector>=this.maxContinuousChecks}calculateLandmarksBoundingBox(M){const T=M.slice([0,0],[_g,1]),O=M.slice([0,1],[_g,1]);return Uv(Em(Object(ze.stack)([T.min(),O.min(),T.max(),O.max()]).expandDims(0)))}}const pl=[[.499976992607117,.652534008026123],[.500025987625122,.547487020492554],[.499974012374878,.602371990680695],[.482113003730774,.471979022026062],[.500150978565216,.527155995368958],[.499909996986389,.498252987861633],[.499523013830185,.40106201171875],[.289712011814117,.380764007568359],[.499954998493195,.312398016452789],[.499987006187439,.269918978214264],[.500023007392883,.107050001621246],[.500023007392883,.666234016418457],[.5000159740448,.679224014282227],[.500023007392883,.692348003387451],[.499976992607117,.695277988910675],[.499976992607117,.70593398809433],[.499976992607117,.719385027885437],[.499976992607117,.737019002437592],[.499967992305756,.781370997428894],[.499816000461578,.562981009483337],[.473773002624512,.573909997940063],[.104906998574734,.254140973091125],[.365929991006851,.409575998783112],[.338757991790771,.41302502155304],[.311120003461838,.409460008144379],[.274657994508743,.389131009578705],[.393361985683441,.403706014156342],[.345234006643295,.344011008739471],[.370094001293182,.346076011657715],[.319321990013123,.347265005111694],[.297903001308441,.353591024875641],[.24779200553894,.410809993743896],[.396889001131058,.842755019664764],[.280097991228104,.375599980354309],[.106310002505779,.399955987930298],[.2099249958992,.391353011131287],[.355807989835739,.534406006336212],[.471751004457474,.65040397644043],[.474155008792877,.680191993713379],[.439785003662109,.657229006290436],[.414617002010345,.66654098033905],[.450374007225037,.680860996246338],[.428770989179611,.682690978050232],[.374971002340317,.727805018424988],[.486716985702515,.547628998756409],[.485300987958908,.527395009994507],[.257764995098114,.314490020275116],[.401223003864288,.455172002315521],[.429818987846375,.548614978790283],[.421351999044418,.533740997314453],[.276895999908447,.532056987285614],[.483370006084442,.499586999416351],[.33721199631691,.282882988452911],[.296391993761063,.293242990970612],[.169294998049736,.193813979625702],[.447580009698868,.302609980106354],[.392390012741089,.353887975215912],[.354490011930466,.696784019470215],[.067304998636246,.730105042457581],[.442739009857178,.572826027870178],[.457098007202148,.584792017936707],[.381974011659622,.694710969924927],[.392388999462128,.694203019142151],[.277076005935669,.271932005882263],[.422551989555359,.563233017921448],[.385919004678726,.281364023685455],[.383103013038635,.255840003490448],[.331431001424789,.119714021682739],[.229923993349075,.232002973556519],[.364500999450684,.189113974571228],[.229622006416321,.299540996551514],[.173287004232407,.278747975826263],[.472878992557526,.666198015213013],[.446828007698059,.668527007102966],[.422762006521225,.673889994621277],[.445307999849319,.580065965652466],[.388103008270264,.693961024284363],[.403039008378983,.706539988517761],[.403629004955292,.693953037261963],[.460041999816895,.557139039039612],[.431158006191254,.692366003990173],[.452181994915009,.692366003990173],[.475387006998062,.692366003990173],[.465828001499176,.779190003871918],[.472328990697861,.736225962638855],[.473087012767792,.717857003211975],[.473122000694275,.704625964164734],[.473033010959625,.695277988910675],[.427942007780075,.695277988910675],[.426479011774063,.703539967536926],[.423162013292313,.711845993995667],[.4183090031147,.720062971115112],[.390094995498657,.639572978019714],[.013953999616206,.560034036636353],[.499913990497589,.58014702796936],[.413199990987778,.69539999961853],[.409626007080078,.701822996139526],[.468080013990402,.601534962654114],[.422728985548019,.585985004901886],[.463079988956451,.593783974647522],[.37211999297142,.47341400384903],[.334562003612518,.496073007583618],[.411671012639999,.546965003013611],[.242175996303558,.14767599105835],[.290776997804642,.201445996761322],[.327338010072708,.256527006626129],[.399509996175766,.748921036720276],[.441727995872498,.261676013469696],[.429764986038208,.187834024429321],[.412198007106781,.108901023864746],[.288955003023148,.398952007293701],[.218936994671822,.435410976409912],[.41278201341629,.398970007896423],[.257135003805161,.355440020561218],[.427684992551804,.437960982322693],[.448339998722076,.536936044692993],[.178560003638268,.45755398273468],[.247308000922203,.457193970680237],[.286267012357712,.467674970626831],[.332827985286713,.460712015628815],[.368755996227264,.447206974029541],[.398963987827301,.432654976844788],[.476410001516342,.405806005001068],[.189241006970406,.523923993110657],[.228962004184723,.348950982093811],[.490725994110107,.562400996685028],[.404670000076294,.485132992267609],[.019469000399113,.401564002037048],[.426243007183075,.420431017875671],[.396993011236191,.548797011375427],[.266469985246658,.376977026462555],[.439121007919312,.51895797252655],[.032313998788595,.644356966018677],[.419054001569748,.387154996395111],[.462783008813858,.505746960639954],[.238978996872902,.779744982719421],[.198220998048782,.831938028335571],[.107550002634525,.540755033493042],[.183610007166862,.740257024765015],[.134409993886948,.333683013916016],[.385764002799988,.883153975009918],[.490967005491257,.579378008842468],[.382384985685349,.508572995662689],[.174399003386497,.397670984268188],[.318785011768341,.39623498916626],[.343364000320435,.400596976280212],[.396100014448166,.710216999053955],[.187885001301765,.588537991046906],[.430987000465393,.944064974784851],[.318993002176285,.898285031318665],[.266247987747192,.869701027870178],[.500023007392883,.190576016902924],[.499976992607117,.954452991485596],[.366169989109039,.398822009563446],[.393207013607025,.39553701877594],[.410373002290726,.391080021858215],[.194993004202843,.342101991176605],[.388664990663528,.362284004688263],[.365961998701096,.355970978736877],[.343364000320435,.355356991291046],[.318785011768341,.35834002494812],[.301414996385574,.363156020641327],[.058132998645306,.319076001644135],[.301414996385574,.387449026107788],[.499987989664078,.618434011936188],[.415838003158569,.624195992946625],[.445681989192963,.566076993942261],[.465844005346298,.620640993118286],[.49992299079895,.351523995399475],[.288718998432159,.819945991039276],[.335278987884521,.852819979190826],[.440512001514435,.902418971061707],[.128294005990028,.791940987110138],[.408771991729736,.373893976211548],[.455606997013092,.451801002025604],[.499877005815506,.908990025520325],[.375436991453171,.924192011356354],[.11421000212431,.615022003650665],[.448662012815475,.695277988910675],[.4480200111866,.704632043838501],[.447111994028091,.715808033943176],[.444831997156143,.730794012546539],[.430011987686157,.766808986663818],[.406787008047104,.685672998428345],[.400738000869751,.681069016456604],[.392399996519089,.677703022956848],[.367855995893478,.663918972015381],[.247923001646996,.601333022117615],[.452769994735718,.420849978923798],[.43639200925827,.359887003898621],[.416164010763168,.368713974952698],[.413385987281799,.692366003990173],[.228018000721931,.683571994304657],[.468268007040024,.352671027183533],[.411361992359161,.804327011108398],[.499989002943039,.469825029373169],[.479153990745544,.442654013633728],[.499974012374878,.439637005329132],[.432112008333206,.493588984012604],[.499886006116867,.866917014122009],[.49991300702095,.821729004383087],[.456548988819122,.819200992584229],[.344549000263214,.745438992977142],[.37890899181366,.574010014533997],[.374292999505997,.780184984207153],[.319687992334366,.570737957954407],[.357154995203018,.604269981384277],[.295284003019333,.621580958366394],[.447750002145767,.862477004528046],[.410986006259918,.508723020553589],[.31395098567009,.775308012962341],[.354128003120422,.812552988529205],[.324548006057739,.703992962837219],[.189096003770828,.646299958229065],[.279776990413666,.71465802192688],[.1338230073452,.682700991630554],[.336768001317978,.644733011722565],[.429883986711502,.466521978378296],[.455527991056442,.548622965812683],[.437114000320435,.558896005153656],[.467287987470627,.529924988746643],[.414712011814117,.335219979286194],[.37704598903656,.322777986526489],[.344107985496521,.320150971412659],[.312875986099243,.32233202457428],[.283526003360748,.333190023899078],[.241245999932289,.382785975933075],[.102986000478268,.468762993812561],[.267612010240555,.424560010433197],[.297879010438919,.433175981044769],[.333433985710144,.433878004550934],[.366427004337311,.426115989685059],[.396012008190155,.416696012020111],[.420121014118195,.41022801399231],[.007561000064015,.480777025222778],[.432949006557465,.569517970085144],[.458638995885849,.479089021682739],[.473466008901596,.545744001865387],[.476087987422943,.563830018043518],[.468472003936768,.555056989192963],[.433990985155106,.582361996173859],[.483518004417419,.562983989715576],[.482482999563217,.57784903049469],[.42645001411438,.389798998832703],[.438998997211456,.39649498462677],[.450067013502121,.400434017181396],[.289712011814117,.368252992630005],[.276670008897781,.363372981548309],[.517862021923065,.471948027610779],[.710287988185883,.380764007568359],[.526226997375488,.573909997940063],[.895093023777008,.254140973091125],[.634069979190826,.409575998783112],[.661242008209229,.41302502155304],[.688880026340485,.409460008144379],[.725341975688934,.389131009578705],[.606630027294159,.40370500087738],[.654766023159027,.344011008739471],[.629905998706818,.346076011657715],[.680678009986877,.347265005111694],[.702096998691559,.353591024875641],[.75221198797226,.410804986953735],[.602918028831482,.842862963676453],[.719901978969574,.375599980354309],[.893692970275879,.399959981441498],[.790081977844238,.391354024410248],[.643998026847839,.534487962722778],[.528249025344849,.65040397644043],[.525849997997284,.680191040039062],[.560214996337891,.657229006290436],[.585384011268616,.66654098033905],[.549625992774963,.680860996246338],[.57122802734375,.682691991329193],[.624852001667023,.72809898853302],[.513050019741058,.547281980514526],[.51509702205658,.527251958847046],[.742246985435486,.314507007598877],[.598631024360657,.454979002475739],[.570338010787964,.548575043678284],[.578631997108459,.533622980117798],[.723087012767792,.532054007053375],[.516445994377136,.499638974666595],[.662801027297974,.282917976379395],[.70362401008606,.293271005153656],[.830704987049103,.193813979625702],[.552385985851288,.302568018436432],[.607609987258911,.353887975215912],[.645429015159607,.696707010269165],[.932694971561432,.730105042457581],[.557260990142822,.572826027870178],[.542901992797852,.584792017936707],[.6180260181427,.694710969924927],[.607590973377228,.694203019142151],[.722943007946014,.271963000297546],[.577413976192474,.563166975975037],[.614082992076874,.281386971473694],[.616907000541687,.255886018276215],[.668509006500244,.119913995265961],[.770092010498047,.232020974159241],[.635536015033722,.189248979091644],[.77039098739624,.299556016921997],[.826722025871277,.278755009174347],[.527121007442474,.666198015213013],[.553171992301941,.668527007102966],[.577238023281097,.673889994621277],[.554691970348358,.580065965652466],[.611896991729736,.693961024284363],[.59696102142334,.706539988517761],[.596370995044708,.693953037261963],[.539958000183105,.557139039039612],[.568841993808746,.692366003990173],[.547818005084991,.692366003990173],[.52461302280426,.692366003990173],[.534089982509613,.779141008853912],[.527670979499817,.736225962638855],[.526912987232208,.717857003211975],[.526877999305725,.704625964164734],[.526966989040375,.695277988910675],[.572058022022247,.695277988910675],[.573521018028259,.703539967536926],[.57683801651001,.711845993995667],[.581691026687622,.720062971115112],[.609944999217987,.639909982681274],[.986046016216278,.560034036636353],[.5867999792099,.69539999961853],[.590372025966644,.701822996139526],[.531915009021759,.601536989212036],[.577268004417419,.585934996604919],[.536915004253387,.593786001205444],[.627542972564697,.473352015018463],[.665585994720459,.495950996875763],[.588353991508484,.546862006187439],[.757824003696442,.14767599105835],[.709249973297119,.201507985591888],[.672684013843536,.256581008434296],[.600408971309662,.74900496006012],[.55826598405838,.261672019958496],[.570303976535797,.187870979309082],[.588165998458862,.109044015407562],[.711045026779175,.398952007293701],[.781069993972778,.435405015945435],[.587247014045715,.398931980133057],[.742869973182678,.355445981025696],[.572156012058258,.437651991844177],[.55186802148819,.536570012569427],[.821442008018494,.457556009292603],[.752701997756958,.457181990146637],[.71375697851181,.467626988887787],[.66711300611496,.460672974586487],[.631101012229919,.447153985500336],[.6008620262146,.432473003864288],[.523481011390686,.405627012252808],[.810747981071472,.523926019668579],[.771045982837677,.348959028720856],[.509127020835876,.562718033790588],[.595292985439301,.485023975372314],[.980530977249146,.401564002037048],[.573499977588654,.420000016689301],[.602994978427887,.548687994480133],[.733529984951019,.376977026462555],[.560611009597778,.519016981124878],[.967685997486115,.644356966018677],[.580985009670258,.387160003185272],[.537728011608124,.505385041236877],[.760966002941132,.779752969741821],[.801778972148895,.831938028335571],[.892440974712372,.54076099395752],[.816350996494293,.740260004997253],[.865594983100891,.333687007427216],[.614073991775513,.883246004581451],[.508952975273132,.579437971115112],[.617941975593567,.508316040039062],[.825608015060425,.397674977779388],[.681214988231659,.39623498916626],[.656635999679565,.400596976280212],[.603900015354156,.710216999053955],[.81208598613739,.588539004325867],[.56801301240921,.944564998149872],[.681007981300354,.898285031318665],[.733752012252808,.869701027870178],[.633830010890961,.398822009563446],[.606792986392975,.39553701877594],[.589659988880157,.391062021255493],[.805015981197357,.342108011245728],[.611334979534149,.362284004688263],[.634037971496582,.355970978736877],[.656635999679565,.355356991291046],[.681214988231659,.35834002494812],[.698584973812103,.363156020641327],[.941866993904114,.319076001644135],[.698584973812103,.387449026107788],[.584177017211914,.624107003211975],[.554318010807037,.566076993942261],[.534153997898102,.62064003944397],[.711217999458313,.819975018501282],[.664629995822906,.852871000766754],[.559099972248077,.902631998062134],[.871706008911133,.791940987110138],[.591234028339386,.373893976211548],[.544341027736664,.451583981513977],[.624562978744507,.924192011356354],[.88577002286911,.615028977394104],[.551338016986847,.695277988910675],[.551980018615723,.704632043838501],[.552887976169586,.715808033943176],[.555167973041534,.730794012546539],[.569944024085999,.767035007476807],[.593203008174896,.685675978660583],[.599261999130249,.681069016456604],[.607599973678589,.677703022956848],[.631937980651855,.663500010967255],[.752032995223999,.601315021514893],[.547226011753082,.420395016670227],[.563543975353241,.359827995300293],[.583841025829315,.368713974952698],[.586614012718201,.692366003990173],[.771915018558502,.683578014373779],[.531597018241882,.352482974529266],[.588370978832245,.804440975189209],[.52079701423645,.442565023899078],[.567984998226166,.493479013442993],[.543282985687256,.819254994392395],[.655317008495331,.745514988899231],[.621008992195129,.574018001556396],[.625559985637665,.78031200170517],[.680198013782501,.570719003677368],[.64276397228241,.604337990283966],[.704662978649139,.621529996395111],[.552012026309967,.862591981887817],[.589071989059448,.508637011051178],[.685944974422455,.775357007980347],[.645735025405884,.812640011310577],[.675342977046967,.703978002071381],[.810858011245728,.646304965019226],[.72012197971344,.714666962623596],[.866151988506317,.682704985141754],[.663187026977539,.644596993923187],[.570082008838654,.466325998306274],[.544561982154846,.548375964164734],[.562758982181549,.558784961700439],[.531987011432648,.530140042304993],[.585271000862122,.335177004337311],[.622952997684479,.32277899980545],[.655896008014679,.320163011550903],[.687132000923157,.322345972061157],[.716481983661652,.333200991153717],[.758756995201111,.382786989212036],[.897013008594513,.468769013881683],[.732392013072968,.424547016620636],[.70211398601532,.433162987232208],[.66652500629425,.433866024017334],[.633504986763,.426087975502014],[.603875994682312,.416586995124817],[.579657971858978,.409945011138916],[.992439985275269,.480777025222778],[.567192018032074,.569419980049133],[.54136598110199,.478899002075195],[.526564002037048,.546118021011353],[.523913025856018,.563830018043518],[.531529009342194,.555056989192963],[.566035985946655,.582329034805298],[.51631098985672,.563053965568542],[.5174720287323,.577877044677734],[.573594987392426,.389806985855103],[.560697972774506,.395331978797913],[.549755990505219,.399751007556915],[.710287988185883,.368252992630005],[.723330020904541,.363372981548309]],Sg="https://tfhub.dev/mediapipe/tfjs-model/facemesh/1/default/1",Wv=192,Jl=192;async function Sm({maxContinuousChecks:$=5,detectionConfidence:M=.9,maxFaces:T=10,iouThreshold:O=.3,scoreThreshold:L=.75}={}){const[J,ie]=await Promise.all([async function(ge,Ae,Ie){return async function({maxFaces:De=10,inputWidth:et=128,inputHeight:ot=128,iouThreshold:zt=.3,scoreThreshold:Ht=.75}={}){const xn=await Object(Ot.loadGraphModel)(zv,{fromTFHub:!0});return new op(xn,et,ot,De,zt,Ht)}({maxFaces:ge,iouThreshold:Ae,scoreThreshold:Ie})}(T,O,L),async function(){return Object(Ot.loadGraphModel)(Sg,{fromTFHub:!0})}()]);return new Cm(J,ie,$,M,T)}function Kd($,M){if($.mesh instanceof ze.Tensor){const[T,O,L,J]=Object(ze.tidy)(()=>{const ie=Object(ze.tensor1d)([M-1,0,0]),ge=Object(ze.tensor1d)([1,-1,1]);return Object(ze.tidy)(()=>[Object(ze.concat)([Object(ze.sub)(M-1,$.boundingBox.topLeft.slice(0,1)),$.boundingBox.topLeft.slice(1,1)]),Object(ze.concat)([Object(ze.sub)(M-1,$.boundingBox.bottomRight.slice(0,1)),$.boundingBox.bottomRight.slice(1,1)]),Object(ze.sub)(ie,$.mesh).mul(ge),Object(ze.sub)(ie,$.scaledMesh).mul(ge)])});return Object.assign({},$,{boundingBox:{topLeft:T,bottomRight:O},mesh:L,scaledMesh:J})}return Object.assign({},$,{boundingBox:{topLeft:[M-1-$.boundingBox.topLeft[0],$.boundingBox.topLeft[1]],bottomRight:[M-1-$.boundingBox.bottomRight[0],$.boundingBox.bottomRight[1]]},mesh:$.mesh.map(T=>{const O=T.slice(0);return O[0]=M-1-T[0],O}),scaledMesh:$.scaledMesh.map(T=>{const O=T.slice(0);return O[0]=M-1-T[0],O})})}class Cm{constructor(M,T,O,L,J){this.pipeline=new E0(M,T,Wv,Jl,O,J),this.detectionConfidence=L}static getAnnotations(){return wg}static getUVCoords(){return pl}async estimateFaces(M,T=!1,O=!1){const[,L]=function(Ae){return Ae instanceof ze.Tensor?[Ae.shape[0],Ae.shape[1]]:[Ae.height,Ae.width]}(M),J=Object(ze.tidy)(()=>(M instanceof ze.Tensor||(M=ze.browser.fromPixels(M)),M.toFloat().expandDims(0))),ie=Object(ze.env)().get("WEBGL_PACK_DEPTHWISECONV");Object(ze.env)().set("WEBGL_PACK_DEPTHWISECONV",!0);const ge=await this.pipeline.predict(J);return Object(ze.env)().set("WEBGL_PACK_DEPTHWISECONV",ie),J.dispose(),ge!=null&&ge.length>0?Promise.all(ge.map(async(Ae,Ie)=>{const{coords:De,scaledCoords:et,box:ot,flag:zt}=Ae;let Ht=[zt];T||(Ht=Ht.concat([De,et,ot.startPoint,ot.endPoint]));const xn=await Promise.all(Ht.map(async Nr=>Nr.array())),En=xn[0];if(zt.dispose(),En<this.detectionConfidence&&this.pipeline.clearRegionOfInterest(Ie),T){const Nr={faceInViewConfidence:En,mesh:De,scaledMesh:et,boundingBox:{topLeft:ot.startPoint.squeeze(),bottomRight:ot.endPoint.squeeze()}};return O?Kd(Nr,L):Nr}const[Fn,Rn,Wn,Jn]=xn.slice(1);et.dispose(),De.dispose();let Tn={faceInViewConfidence:En,boundingBox:{topLeft:Wn,bottomRight:Jn},mesh:Fn,scaledMesh:Rn};O&&(Tn=Kd(Tn,L));const _r={};for(const Nr in wg)_r[Nr]=wg[Nr].map(Ir=>Tn.scaledMesh[Ir]);return Tn.annotations=_r,Tn})):[]}}function gs($){var M=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var T,O=xs()($);if(M){var L=xs()(this).constructor;T=Reflect.construct(O,arguments,L)}else T=O.apply(this,arguments);return tl()(this,T)}}var Cg=function($){el()(T,$);var M=gs(T);function T(O,L,J){var ie;return oe()(this,T),(ie=M.call(this)).video=O,ie.model=null,ie.modelReady=!1,ie.config=L,ie.ready=Ge(ie.loadModel(),J),ie}return _e()(T,[{key:"loadModel",value:function(){var O=q()(me.a.mark(function L(){var J=this;return me.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.next=2,Sm(this.config);case 2:if(this.model=ie.sent,this.modelReady=!0,!this.video||this.video.readyState!==0){ie.next=7;break}return ie.next=7,new Promise(function(ge){J.video.onloadeddata=function(){ge()}});case 7:return this.video&&this.predict(),ie.abrupt("return",this);case 9:case"end":return ie.stop()}},L,this)}));return function(){return O.apply(this,arguments)}}()},{key:"predict",value:function(){var O=q()(me.a.mark(function L(J,ie){var ge,Ae,Ie,De,et=this;return me.a.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:if(ge=this.getInput(J)){ot.next=3;break}throw new Error("No input image found.");case 3:return Ae=this.config.flipHorizontal,ot.next=6,this.model.estimateFaces(ge,Ae);case 6:if(Ie=ot.sent,De=Ie,this.emit("predict",De),this.emit("face",De),!this.video){ot.next=12;break}return ot.abrupt("return",I.nextFrame().then(function(){return et.predict()}));case 12:return typeof ie=="function"&&ie(De),ot.abrupt("return",De);case 14:case"end":return ot.stop()}},L,this)}));return function(L,J){return O.apply(this,arguments)}}()},{key:"getInput",value:function(O){return O instanceof HTMLImageElement||O instanceof HTMLVideoElement||O instanceof HTMLCanvasElement||O instanceof ImageData?O:we()(O)==="object"&&(O.elt instanceof HTMLImageElement||O.elt instanceof HTMLVideoElement||O.elt instanceof ImageData)?O.elt:we()(O)==="object"&&O.canvas instanceof HTMLCanvasElement?O.canvas:this.video}}]),T}(Vp.EventEmitter),S0=function($,M,T){var O,L={},J=T;$ instanceof HTMLVideoElement?O=$:we()($)==="object"&&$.elt instanceof HTMLVideoElement?O=$.elt:we()($)==="object"?L=$:typeof $=="function"&&(J=$),we()(M)==="object"?L=M:typeof M=="function"&&(J=M);var ie=new Cg(O,L,J);return J?ie:ie.ready};function km($){return[Math.abs($.endPoint[0]-$.startPoint[0]),Math.abs($.endPoint[1]-$.startPoint[1])]}function Am($){return[$.startPoint[0]+($.endPoint[0]-$.startPoint[0])/2,$.startPoint[1]+($.endPoint[1]-$.startPoint[1])/2]}function C0($,M=1.5){const T=Am($),O=km($),L=[M*O[0]/2,M*O[1]/2];return{startPoint:[T[0]-L[0],T[1]-L[1]],endPoint:[T[0]+L[0],T[1]+L[1]],palmLandmarks:$.palmLandmarks}}function Vv($){const M=Am($),T=km($),O=Math.max(...T)/2;return{startPoint:[M[0]-O,M[1]-O],endPoint:[M[0]+O,M[1]+O],palmLandmarks:$.palmLandmarks}}function zy($,M){const T=[$.endPoint[0]-$.startPoint[0],$.endPoint[1]-$.startPoint[1]],O=[T[0]*M[0],T[1]*M[1]];return{startPoint:[$.startPoint[0]+O[0],$.startPoint[1]+O[1]],endPoint:[$.endPoint[0]+O[0],$.endPoint[1]+O[1]],palmLandmarks:$.palmLandmarks}}class ml{constructor(M,T,O,L,J,ie){this.model=M,this.width=T,this.height=O,this.iouThreshold=J,this.scoreThreshold=ie,this.anchors=L.map(ge=>[ge.x_center,ge.y_center]),this.anchorsTensor=Object(ze.tensor2d)(this.anchors),this.inputSizeTensor=Object(ze.tensor1d)([T,O]),this.doubleInputSizeTensor=Object(ze.tensor1d)([2*T,2*O])}normalizeBoxes(M){return Object(ze.tidy)(()=>{const T=Object(ze.slice)(M,[0,0],[-1,2]),O=Object(ze.slice)(M,[0,2],[-1,2]),L=Object(ze.add)(Object(ze.div)(T,this.inputSizeTensor),this.anchorsTensor),J=Object(ze.div)(O,this.doubleInputSizeTensor),ie=Object(ze.mul)(Object(ze.sub)(L,J),this.inputSizeTensor),ge=Object(ze.mul)(Object(ze.add)(L,J),this.inputSizeTensor);return Object(ze.concat2d)([ie,ge],1)})}normalizeLandmarks(M,T){return Object(ze.tidy)(()=>{const O=Object(ze.add)(Object(ze.div)(M.reshape([-1,7,2]),this.inputSizeTensor),this.anchors[T]);return Object(ze.mul)(O,this.inputSizeTensor)})}getBoundingBoxes(M){return Object(ze.tidy)(()=>{const T=Object(ze.mul)(Object(ze.sub)(M,.5),2),O=Object(ze.env)().get("WEBGL_PACK_DEPTHWISECONV");Object(ze.env)().set("WEBGL_PACK_DEPTHWISECONV",!0);const L=this.model.predict(T).squeeze();Object(ze.env)().set("WEBGL_PACK_DEPTHWISECONV",O);const J=Object(ze.sigmoid)(Object(ze.slice)(L,[0,0],[-1,1])).squeeze(),ie=Object(ze.slice)(L,[0,1],[-1,4]),ge=this.normalizeBoxes(ie),Ae=console.warn;console.warn=()=>{};const Ie=ze.image.nonMaxSuppression(ge,J,1,this.iouThreshold,this.scoreThreshold).arraySync();if(console.warn=Ae,Ie.length===0)return null;const De=Ie[0],et=Object(ze.slice)(ge,[De,0],[1,-1]),ot=Object(ze.slice)(L,[De,5],[1,14]);return{boxes:et,palmLandmarks:this.normalizeLandmarks(ot,De).reshape([-1,2])}})}estimateHandBounds(M){const T=M.shape[1],O=M.shape[2],L=Object(ze.tidy)(()=>M.resizeBilinear([this.width,this.height]).div(255)),J=this.getBoundingBoxes(L);if(J===null)return L.dispose(),null;const ie=J.boxes.arraySync(),ge=ie[0].slice(0,2),Ae=ie[0].slice(2,4),Ie=J.palmLandmarks.arraySync();return L.dispose(),J.boxes.dispose(),J.palmLandmarks.dispose(),function(De,et){return{startPoint:[De.startPoint[0]*et[0],De.startPoint[1]*et[1]],endPoint:[De.endPoint[0]*et[0],De.endPoint[1]*et[1]],palmLandmarks:De.palmLandmarks.map(ot=>[ot[0]*et[0],ot[1]*et[1]])}}({startPoint:ge,endPoint:Ae,palmLandmarks:Ie},[O/this.width,T/this.height])}}const Yd={thumb:[1,2,3,4],indexFinger:[5,6,7,8],middleFinger:[9,10,11,12],ringFinger:[13,14,15,16],pinky:[17,18,19,20],palmBase:[0]};function Uy($,M){return function(T){return T-2*Math.PI*Math.floor((T+Math.PI)/(2*Math.PI))}(Math.PI/2-Math.atan2(-(M[1]-$[1]),M[0]-$[0]))}const Hv=($,M)=>[[1,0,$],[0,1,M],[0,0,1]];function gl($,M){let T=0;for(let O=0;O<$.length;O++)T+=$[O]*M[O];return T}function as($,M){const T=[];for(let O=0;O<$.length;O++)T.push($[O][M]);return T}function ap($,M){const T=[],O=$.length;for(let L=0;L<O;L++){T.push([]);for(let J=0;J<O;J++)T[L].push(gl($[L],as(M,J)))}return T}function Om($,M){const T=Math.cos($),O=Math.sin($),L=[[T,-O,0],[O,T,0],[0,0,1]];return ap(ap(Hv(M[0],M[1]),L),Hv(-M[0],-M[1]))}function kg($,M){return[gl($,M[0]),gl($,M[1])]}const Gv=.8,Ag=[0,-.4],Vf=3,V1=[0,-.1],Og=1.65,es=[0,5,9,13,17,1,2],Tm=0,Jd=2;class Tg{constructor(M,T,O,L,J,ie){this.regionsOfInterest=[],this.runsWithoutHandDetector=0,this.boundingBoxDetector=M,this.meshDetector=T,this.maxContinuousChecks=J,this.detectionConfidence=ie,this.meshWidth=O,this.meshHeight=L,this.maxHandsNumber=1}getBoxForPalmLandmarks(M,T){const O=M.map(L=>kg([...L,1],T));return C0(Vv(zy(this.calculateLandmarksBoundingBox(O),Ag)),Vf)}getBoxForHandLandmarks(M){const T=C0(Vv(zy(this.calculateLandmarksBoundingBox(M),V1)),Og),O=[];for(let L=0;L<es.length;L++)O.push(M[es[L]].slice(0,2));return T.palmLandmarks=O,T}transformRawCoords(M,T,O,L){const J=km(T),ie=[J[0]/this.meshWidth,J[1]/this.meshHeight],ge=M.map(zt=>[ie[0]*(zt[0]-this.meshWidth/2),ie[1]*(zt[1]-this.meshHeight/2),zt[2]]),Ae=Om(O,[0,0]),Ie=ge.map(zt=>[...kg(zt,Ae),zt[2]]),De=function(zt){const Ht=[[zt[0][0],zt[1][0]],[zt[0][1],zt[1][1]]],xn=[zt[0][2],zt[1][2]],En=[-gl(Ht[0],xn),-gl(Ht[1],xn)];return[Ht[0].concat(En[0]),Ht[1].concat(En[1]),[0,0,1]]}(L),et=[...Am(T),1],ot=[gl(et,De[0]),gl(et,De[1])];return Ie.map(zt=>[zt[0]+ot[0],zt[1]+ot[1],zt[2]])}async estimateHand(M){const T=this.shouldUpdateRegionsOfInterest();if(T===!0){const Tn=this.boundingBoxDetector.estimateHandBounds(M);if(Tn===null)return M.dispose(),this.regionsOfInterest=[],null;this.updateRegionsOfInterest(Tn,!0),this.runsWithoutHandDetector=0}else this.runsWithoutHandDetector++;const O=this.regionsOfInterest[0],L=Uy(O.palmLandmarks[Tm],O.palmLandmarks[Jd]),J=Am(O),ie=[J[0]/M.shape[2],J[1]/M.shape[1]];let ge;const Ae=Object(ze.getBackend)();if(Ae==="webgl")ge=function(Tn,_r,Nr,Ir){const Qr=Tn.shape,zr=Qr[1],ki=Qr[2],Pi=Math.sin(_r),Fi=Math.cos(_r),Mo=Math.floor(ki*(typeof Ir=="number"?Ir:Ir[0])),Jo=Math.floor(zr*(typeof Ir=="number"?Ir:Ir[1])),jo={variableNames:["Image"],outputShape:Qr,userCode:`
      void main() {
        ivec4 coords = getOutputCoords();
        int x = coords[2];
        int y = coords[1];
        int coordX = int(float(x - ${Mo}) * ${Fi} -
          float(y - ${Jo}) * ${Pi});
        int coordY = int(float(x - ${Mo}) * ${Pi} +
          float(y - ${Jo}) * ${Fi});
        coordX = int(coordX + ${Mo});
        coordY = int(coordY + ${Jo});

        ${typeof Nr=="number"?`float outputValue = ${Nr.toFixed(2)};`:`
      vec3 fill = vec3(${Nr.join(",")});
      float outputValue = fill[coords[3]];`}

        if(coordX > 0 && coordX < ${ki} && coordY > 0 && coordY < ${zr}) {
          outputValue = getImage(coords[0], coordY, coordX, coords[3]);
        }

      setOutput(outputValue);
    }`};return Object(ze.backend)().compileAndRun(jo,[Tn])}(M,L,0,ie);else{if(Ae!=="cpu")throw new Error(`Handpose is not yet supported by the ${Ae} backend - rotation kernel is not defined.`);ge=function(Tn,_r,Nr,Ir){const Qr=Object(ze.backend)(),zr=Object(ze.buffer)(Tn.shape,Tn.dtype),[ki,Pi,Fi,Mo]=Tn.shape,Jo=Fi*(typeof Ir=="number"?Ir:Ir[0]),jo=Pi*(typeof Ir=="number"?Ir:Ir[1]),Bo=Math.sin(-_r),Ho=Math.cos(-_r),la=Qr.readSync(Tn.dataId);for(let va=0;va<ki;va++)for(let Fa=0;Fa<Pi;Fa++)for(let mu=0;mu<Fi;mu++)for(let Li=0;Li<Mo;Li++){const ts=[ki,Fa,mu,Li],ss=ts[2],gu=ts[1];let Ws=(ss-Jo)*Ho-(gu-jo)*Bo,Pu=(ss-Jo)*Bo+(gu-jo)*Ho;Ws=Math.round(Ws+Jo),Pu=Math.round(Pu+jo);let Lu=Nr;typeof Nr!="number"&&(Lu=Li===3?255:Nr[Li]),Ws>=0&&Ws<Fi&&Pu>=0&&Pu<Pi&&(Lu=la[va*Fi*Pi*Mo+Pu*(Fi*Mo)+Ws*Mo+Li]);const Bu=va*Fi*Pi*Mo+Fa*(Fi*Mo)+mu*Mo+Li;zr.values[Bu]=Lu}return zr.toTensor()}(M,L,0,ie)}const Ie=Om(-L,J);let De;const et=function(Tn,_r,Nr){const Ir=_r.shape[1],Qr=_r.shape[2],zr=[[Tn.startPoint[1]/Ir,Tn.startPoint[0]/Qr,Tn.endPoint[1]/Ir,Tn.endPoint[0]/Qr]];return ze.image.cropAndResize(_r,zr,[0],Nr)}(De=T===!0?this.getBoxForPalmLandmarks(O.palmLandmarks,Ie):O,ge,[this.meshWidth,this.meshHeight]),ot=et.div(255);et.dispose(),ge.dispose();const zt=Object(ze.env)().get("WEBGL_PACK_DEPTHWISECONV");Object(ze.env)().set("WEBGL_PACK_DEPTHWISECONV",!0);const[Ht,xn]=this.meshDetector.predict(ot);Object(ze.env)().set("WEBGL_PACK_DEPTHWISECONV",zt),ot.dispose();const En=Ht.dataSync()[0];if(Ht.dispose(),En<this.detectionConfidence)return xn.dispose(),this.regionsOfInterest=[],null;const Fn=Object(ze.reshape)(xn,[-1,3]),Rn=Fn.arraySync();xn.dispose(),Fn.dispose();const Wn=this.transformRawCoords(Rn,De,L,Ie),Jn=this.getBoxForHandLandmarks(Wn);return this.updateRegionsOfInterest(Jn,!1),{landmarks:Wn,handInViewConfidence:En,boundingBox:{topLeft:Jn.startPoint,bottomRight:Jn.endPoint}}}calculateLandmarksBoundingBox(M){const T=M.map(L=>L[0]),O=M.map(L=>L[1]);return{startPoint:[Math.min(...T),Math.min(...O)],endPoint:[Math.max(...T),Math.max(...O)]}}updateRegionsOfInterest(M,T){if(T)this.regionsOfInterest=[M];else{const O=this.regionsOfInterest[0];let L=0;if(O!=null&&O.startPoint!=null){const[J,ie]=M.startPoint,[ge,Ae]=M.endPoint,[Ie,De]=O.startPoint,[et,ot]=O.endPoint,zt=Math.max(J,Ie),Ht=Math.max(ie,De),xn=(Math.min(ge,et)-zt)*(Math.min(Ae,ot)-Ht);L=xn/((ge-J)*(Ae-ie)+(et-Ie)*(ot-ie)-xn)}this.regionsOfInterest[0]=L>Gv?O:M}}shouldUpdateRegionsOfInterest(){return this.regionsOfInterest.length!==this.maxHandsNumber||this.runsWithoutHandDetector>=this.maxContinuousChecks}}const Mm=256,k0=256;async function A0({maxContinuousChecks:$=1/0,detectionConfidence:M=.8,iouThreshold:T=.3,scoreThreshold:O=.5}={}){const[L,J,ie]=await Promise.all([async function(){return ze.util.fetch("https://tfhub.dev/mediapipe/tfjs-model/handskeleton/1/default/1/anchors.json?tfjs-format=file").then(Ie=>Ie.json())}(),async function(){return Object(Ot.loadGraphModel)("https://tfhub.dev/mediapipe/tfjs-model/handdetector/1/default/1",{fromTFHub:!0})}(),async function(){return Object(Ot.loadGraphModel)("https://tfhub.dev/mediapipe/tfjs-model/handskeleton/1/default/1",{fromTFHub:!0})}()]),ge=new ml(J,Mm,k0,L,T,O),Ae=new Tg(ge,ie,Mm,k0,$,M);return new Hf(Ae)}class Hf{constructor(M){this.pipeline=M}static getAnnotations(){return Yd}async estimateHands(M,T=!1){const[,O]=function(Ae){return Ae instanceof ze.Tensor?[Ae.shape[0],Ae.shape[1]]:[Ae.height,Ae.width]}(M),L=Object(ze.tidy)(()=>(M instanceof ze.Tensor||(M=ze.browser.fromPixels(M)),M.toFloat().expandDims(0))),J=await this.pipeline.estimateHand(L);if(L.dispose(),J===null)return[];let ie=J;T===!0&&(ie=function(Ae,Ie){const{handInViewConfidence:De,landmarks:et,boundingBox:ot}=Ae;return{handInViewConfidence:De,landmarks:et.map(zt=>[Ie-1-zt[0],zt[1],zt[2]]),boundingBox:{topLeft:[Ie-1-ot.topLeft[0],ot.topLeft[1]],bottomRight:[Ie-1-ot.bottomRight[0],ot.bottomRight[1]]}}}(J,O));const ge={};for(const Ae of Object.keys(Yd))ge[Ae]=Yd[Ae].map(Ie=>ie.landmarks[Ie]);return[{handInViewConfidence:ie.handInViewConfidence,boundingBox:ie.boundingBox,landmarks:ie.landmarks,annotations:ge}]}}function xc($){var M=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var T,O=xs()($);if(M){var L=xs()(this).constructor;T=Reflect.construct(O,arguments,L)}else T=O.apply(this,arguments);return tl()(this,T)}}var qv=function($){el()(T,$);var M=xc(T);function T(O,L,J){var ie;return oe()(this,T),(ie=M.call(this)).video=O,ie.model=null,ie.modelReady=!1,ie.config=L,ie.ready=Ge(ie.loadModel(),J),ie}return _e()(T,[{key:"loadModel",value:function(){var O=q()(me.a.mark(function L(){var J=this;return me.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.next=2,A0(this.config);case 2:if(this.model=ie.sent,this.modelReady=!0,!this.video||this.video.readyState!==0){ie.next=7;break}return ie.next=7,new Promise(function(ge){J.video.onloadeddata=function(){ge()}});case 7:return this.video&&this.predict(),ie.abrupt("return",this);case 9:case"end":return ie.stop()}},L,this)}));return function(){return O.apply(this,arguments)}}()},{key:"predict",value:function(){var O=q()(me.a.mark(function L(J,ie){var ge,Ae,Ie,De,et=this;return me.a.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:if(ge=this.getInput(J)){ot.next=3;break}throw new Error("No input image found.");case 3:return Ae=this.config.flipHorizontal,ot.next=6,this.model.estimateHands(ge,Ae);case 6:if(Ie=ot.sent,De=Ie,this.emit("predict",De),this.emit("hand",De),!this.video){ot.next=12;break}return ot.abrupt("return",I.nextFrame().then(function(){return et.predict()}));case 12:return typeof ie=="function"&&ie(De),ot.abrupt("return",De);case 14:case"end":return ot.stop()}},L,this)}));return function(L,J){return O.apply(this,arguments)}}()},{key:"getInput",value:function(O){return O instanceof HTMLImageElement||O instanceof HTMLVideoElement||O instanceof HTMLCanvasElement||O instanceof ImageData?O:we()(O)==="object"&&(O.elt instanceof HTMLImageElement||O.elt instanceof HTMLVideoElement||O.elt instanceof ImageData)?O.elt:we()(O)==="object"&&O.canvas instanceof HTMLCanvasElement?O.canvas:this.video}}]),T}(Vp.EventEmitter),$v=function($,M,T){var O,L={},J=T;$ instanceof HTMLVideoElement?O=$:we()($)==="object"&&$.elt instanceof HTMLVideoElement?O=$.elt:we()($)==="object"?L=$:typeof $=="function"&&(J=$),we()(M)==="object"?L=M:typeof M=="function"&&(J=M);var ie=new qv(O,L,J);return J?ie:ie.ready},sp=function(){console.log(`

 Thank you for using ml5.js v`.concat(jh.a,` 

Please read our community statement to ensure 
that the use of this software reflects the values 
of the ml5.js community:
 https://ml5js.org/about

Reporting: 
 https://github.com/ml5js/ml5-library/issues
 Email: info@ml5js.org 
`))},Dm=function(){var $=q()(me.a.mark(function M(){var T;return me.a.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return(T=new Image).crossOrigin="",T.src="https://cdn.jsdelivr.net/gh/ml5js/ml5-library@main/assets/bird.jpg",O.next=5,new Promise(function(L){T.onload=L});case 5:return O.abrupt("return",T);case 6:case"end":return O.stop()}},M)}));return function(){return $.apply(this,arguments)}}(),Wy=function(){var $=q()(me.a.mark(function M(){var T,O,L;return me.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:for(T=new Uint8ClampedArray(2e4),O=0;O<T.length;O+=4)T[O+0]=0,T[O+1]=190,T[O+2]=0,T[O+3]=255;return L=new ImageData(T,200),J.abrupt("return",L);case 4:case"end":return J.stop()}},M)}));return function(){return $.apply(this,arguments)}}();function O0($,M){var T=Object.keys($);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols($);M&&(O=O.filter(function(L){return Object.getOwnPropertyDescriptor($,L).enumerable})),T.push.apply(T,O)}return T}function Mg($){for(var M=1;M<arguments.length;M++){var T=arguments[M]!=null?arguments[M]:{};M%2?O0(Object(T),!0).forEach(function(O){H()($,O,T[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(T)):O0(Object(T)).forEach(function(O){Object.defineProperty($,O,Object.getOwnPropertyDescriptor(T,O))})}return $}var Yr={charRNN:Qp,CVAE:em,cartoon:Rv,DCGAN:yf,featureExtractor:ro,imageClassifier:kr,kmeans:Mv,dbscan:Fv,soundClassifier:ni,pitchDetection:It,pix2pix:pc,poseNet:Rc,sketchRNN:Lh,styleTransfer:gf,word2vec:Mc,YOLO:pf,CocoSsd:pd,objectDetector:Oh,uNet:Il,sentiment:xf,bodyPix:nm,faceApi:Av,universalSentenceEncoder:Hc,facemesh:S0,handpose:$v};sp(),a.default=Object.assign({p5Utils:Gt},function($){if(typeof window>"u"||window.p5===void 0||window.p5.prototype===void 0||window.p5.prototype.registerPreloadMethod===void 0)return $;var M=$;return Object.keys($).forEach(function(T){var O=$[T];M[T]=function(){for(var L=null,J=arguments.length,ie=new Array(J),ge=0;ge<J;ge++)ie[ge]=arguments[ge];var Ae=ie.length;return typeof ie[Ae-1]=="function"&&(L=ie[Ae-1],Ae-=1),O.apply($,[].concat(Xo()(ie.slice(0,Ae)),[function(){try{L&&L()}catch(Ie){console.error(Ie)}return window._decrementPreload?window._decrementPreload():null}]))},window.p5.prototype.registerPreloadMethod("".concat(T),$)}),$}(Yr),Mg(Mg({KNNClassifier:Ci,communityStatement:sp},A),{},{tf:I,tfvis:Q,version:jh.a,neuralNetwork:am,testingUtils:W}))},function(s,a){},function(s,a){},function(s,a){},function(s,a){s.exports=function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)},s.exports.__esModule=!0,s.exports.default=s.exports},function(s,a){s.exports=function(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)},s.exports.__esModule=!0,s.exports.default=s.exports},function(s,a,r){var c=r(186);s.exports=function(S){if(Array.isArray(S))return c(S)},s.exports.__esModule=!0,s.exports.default=s.exports},function(s,a,r){function c(R){return new Uint8Array(atob(R).split("").map(function(W){return W.charCodeAt(0)}))}Object.defineProperty(a,"__esModule",{value:!0}),a.stringToUint8array=c,a.stringToArray=function(R){var W=c(R);return new Int16Array(W.buffer)};var S=!1,E=0;function A(){if(S)return S=!1,E;var R=2*Math.random()-1,W=2*Math.random()-1,j=R*R+W*W;if(j===0||j>1)return A();var H=Math.sqrt(-2*Math.log(j)/j);return E=W*H,S=!0,R*H}function U(R,W){return Math.random()*(W-R)+R}function B(R,W){return R+A()*W}function D(R,W){W===void 0&&(W=2);var j=W;function H(It,wt){return[It[0]-wt[0],It[1]-wt[1]]}function I(It,wt){return It[0]*wt[0]+It[1]*wt[1]}function Q(It){return It[0]*It[0]+It[1]*It[1]}function Y(It,wt){return Q(H(It,wt))}var q,ae,oe,ye,_e=R.length,pe=[],me=j*j,Ge=[],lt=[];for(Ge[0]=R[0],q=ae=1,ye=0;q<_e;q++)Y(R[q],R[ye])<me||(Ge[ae++]=R[q],ye=q);for(ye<_e-1&&(Ge[ae++]=R[_e-1]),lt[0]=lt[ae-1]=1,function It(wt,we,yt,Bt,Ot){if(!(Bt<=yt+1)){for(var ze,Ut,Ft,pt,vt=yt,rn=0,xt=wt*wt,_t=[we[yt],we[Bt]],Xt=H(_t[1],_t[0]),sn=Q(Xt),kn=yt+1;kn<Bt;kn++)(Ft=I(H(we[kn],_t[0]),Xt))<=0?pt=Y(we[kn],_t[0]):sn<=Ft?pt=Y(we[kn],_t[1]):(Ut=Ft/sn,ze=[_t[0][0]+Ut*Xt[0],_t[0][1]+Ut*Xt[1]],pt=Y(we[kn],ze)),pt<=rn||(vt=kn,rn=pt);rn>xt&&(Ot[vt]=1,It(wt,we,yt,vt,Ot),It(wt,we,vt,Bt,Ot))}}(j,Ge,0,ae-1,lt),q=oe=0;q<ae;q++)lt[q]&&(pe[oe++]=Ge[q]);return pe}a.gaussRandom=A,a.randf=U,a.randi=function(R,W){return Math.floor(Math.random()*(W-R)+R)},a.randn=B,a.birandn=function(R,W,j,H,I){var Q=B(0,1),Y=B(0,1);return[Math.sqrt(1-I*I)*j*Q+I*j*Y+R,H*Y+W]},a.sampleSoftmax=function(R){var W,j=U(0,1),H=R.length,I=0;for(W=0;W<H;W++)if((I+=R[W])>=j)return W;return console.log("error sampling pi index"),-1},a.simplifyLine=D,a.simplifyLines=function(R,W){var j=[],H=2;W&&(H=W);for(var I=0;I<R.length;I++)j.push(D(R[I],H));return j},a.linesToStrokes=function(R){var W,j,H,I,Q,Y,q,ae,oe,ye,_e=0,pe=0,me=[];for(q=0;q<R.length;q++)if((oe=R[q].length)>1)for(ae=0;ae<oe;ae++)W=(ye=R[q][ae])[0],j=ye[1],ae===oe-1?(Y=1,Q=0):(Y=0,Q=1),H=W-_e,I=j-pe,_e=W,pe=j,me.push([H,I,Q,Y,0]);return me.push([0,0,0,0,1]),me.slice(1)},a.lineToStroke=function(R,W){var j,H,I,Q,Y,q,ae,oe,ye,_e,pe,me=[];if(ye=W[0],_e=W[1],(I=R.length)>1)for(pe=0;pe<I;pe++)ae=(Q=R[pe])[0],oe=Q[1],pe===I-1?(H=1,j=0):(H=0,j=1),Y=ae-ye,q=oe-_e,ye=ae,_e=oe,me.push([Y,q,j,H,0]);return me}},function(s,a,r){var c=this&&this.__awaiter||function(B,D,R,W){return new(R||(R=Promise))(function(j,H){function I(q){try{Y(W.next(q))}catch(ae){H(ae)}}function Q(q){try{Y(W.throw(q))}catch(ae){H(ae)}}function Y(q){q.done?j(q.value):new R(function(ae){ae(q.value)}).then(I,Q)}Y((W=W.apply(B,D||[])).next())})},S=this&&this.__generator||function(B,D){var R,W,j,H,I={label:0,sent:function(){if(1&j[0])throw j[1];return j[1]},trys:[],ops:[]};return H={next:Q(0),throw:Q(1),return:Q(2)},typeof Symbol=="function"&&(H[Symbol.iterator]=function(){return this}),H;function Q(Y){return function(q){return function(ae){if(R)throw new TypeError("Generator is already executing.");for(;I;)try{if(R=1,W&&(j=2&ae[0]?W.return:ae[0]?W.throw||((j=W.return)&&j.call(W),0):W.next)&&!(j=j.call(W,ae[1])).done)return j;switch(W=0,j&&(ae=[2&ae[0],j.value]),ae[0]){case 0:case 1:j=ae;break;case 4:return I.label++,{value:ae[1],done:!1};case 5:I.label++,W=ae[1],ae=[0];continue;case 7:ae=I.ops.pop(),I.trys.pop();continue;default:if(!(j=(j=I.trys).length>0&&j[j.length-1])&&(ae[0]===6||ae[0]===2)){I=0;continue}if(ae[0]===3&&(!j||ae[1]>j[0]&&ae[1]<j[3])){I.label=ae[1];break}if(ae[0]===6&&I.label<j[1]){I.label=j[1],j=ae;break}if(j&&I.label<j[2]){I.label=j[2],I.ops.push(ae);break}j[2]&&I.ops.pop(),I.trys.pop();continue}ae=D.call(B,I)}catch(oe){ae=[6,oe],W=0}finally{R=j=0}if(5&ae[0])throw ae[1];return{value:ae[0]?ae[1]:void 0,done:!0}}([Y,q])}}};Object.defineProperty(a,"__esModule",{value:!0});var E=r(0),A=r(255),U=function(){function B(D){this.NMIXTURE=20,this.checkpointURL=D,this.initialized=!1}return B.prototype.isInitialized=function(){return this.initialized},B.prototype.instantiateFromJSON=function(D,R,W){var j;this.forgetBias=E.scalar(1),this.info=D,this.setPixelFactor(2),this.weightDims=R,this.numUnits=this.weightDims[0][0],this.weights=[];for(var H=0;H<W.length;H++){for(var I=(j=new Float32Array(A.stringToArray(W[H]))).length,Q=0;Q<I;Q++)j[Q]=10*j[Q]/32767;this.weights.push(j)}this.outputKernel=E.tensor2d(this.weights[0],[this.weightDims[0][0],this.weightDims[0][1]]),this.outputBias=E.tensor1d(this.weights[1]);var Y=E.tensor2d(this.weights[2],[this.weightDims[2][0],this.weightDims[2][1]]),q=E.tensor2d(this.weights[3],[this.weightDims[3][0],this.weightDims[3][1]]);this.lstmKernel=E.concat2d([Y,q],0),this.lstmBias=E.tensor1d(this.weights[4]),this.rawVars=[this.outputKernel,this.outputBias,this.lstmKernel,this.lstmBias]},B.prototype.initialize=function(){return c(this,void 0,void 0,function(){var D;return S(this,function(R){switch(R.label){case 0:return this.dispose(),[4,fetch(this.checkpointURL).then(function(W){return W.json()})];case 1:return D=R.sent(),this.instantiateFromJSON(D[0],D[1],D[2]),this.initialized=!0,console.log("Initialized SketchRNN."),[2]}})})},B.prototype.dispose=function(){if(this.rawVars){for(var D=0;D<this.rawVars.length;D++)this.rawVars[D].dispose();this.rawVars=void 0}this.forgetBias&&(this.forgetBias.dispose(),this.forgetBias=void 0),this.initialized=!1},B.prototype.setPixelFactor=function(D){this.pixelFactor=D,this.scaleFactor=this.info.scale_factor/this.pixelFactor},B.prototype.update=function(D,R){var W=this,j=E.tidy(function(){var Y=W.numUnits,q=W.scaleFactor,ae=[D[0]/q,D[1]/q,D[2],D[3],D[4]],oe=E.tensor2d(ae,[1,5]),ye=E.tensor2d(R.c,[1,Y]),_e=E.tensor2d(R.h,[1,Y]),pe=E.basicLSTMCell(W.forgetBias,W.lstmKernel,W.lstmBias,oe,ye,_e);return E.concat(pe,1)}),H=j.dataSync();j.dispose();var I=H.slice(0,this.numUnits),Q=H.slice(this.numUnits,2*this.numUnits);return{c:new Float32Array(I),h:new Float32Array(Q)}},B.prototype.updateStrokes=function(D,R,W){var j=this,H=E.tidy(function(){var q,ae,oe,ye,_e,pe=j.numUnits,me=j.scaleFactor,Ge=D.length;W&&(Ge=W),oe=E.tensor2d(R.c,[1,pe]),ye=E.tensor2d(R.h,[1,pe]);for(var lt=0;lt<Ge;lt++)q=[D[lt][0]/me,D[lt][1]/me,D[lt][2],D[lt][3],D[lt][4]],ae=E.tensor2d(q,[1,5]),oe=(_e=E.basicLSTMCell(j.forgetBias,j.lstmKernel,j.lstmBias,ae,oe,ye))[0],ye=_e[1];return E.concat(_e,1)}),I=H.dataSync();H.dispose();var Q=I.slice(0,this.numUnits),Y=I.slice(this.numUnits,2*this.numUnits);return{c:new Float32Array(Q),h:new Float32Array(Y)}},B.prototype.getPDF=function(D,R,W){var j=this;R===void 0&&(R=.65);var H=R,I=.5+.5*H;W&&(I=W);var Q=this.NMIXTURE,Y=E.tidy(function(){var ae=j.numUnits,oe=E.tensor2d(D.h,[1,ae]),ye=E.scalar(Math.sqrt(H)),_e=E.scalar(I),pe=E.add(E.matMul(oe,j.outputKernel),j.outputBias).squeeze(),me=E.split(pe,[3,6*Q]),Ge=me[0],lt=me[1],It=E.split(lt,6),wt=It[0],we=It[1],yt=It[2],Bt=It[3],Ot=It[4],ze=It[5],Ut=E.softmax(Ge.div(_e)),Ft=[E.softmax(wt.div(_e)),we,yt,E.exp(Bt).mul(ye),E.exp(Ot).mul(ye),E.tanh(ze),Ut];return E.concat(Ft)}),q=Y.dataSync();return Y.dispose(),{pi:new Float32Array(q.slice(0,Q)),muX:new Float32Array(q.slice(1*Q,2*Q)),muY:new Float32Array(q.slice(2*Q,3*Q)),sigmaX:new Float32Array(q.slice(3*Q,4*Q)),sigmaY:new Float32Array(q.slice(4*Q,15*Q)),corr:new Float32Array(q.slice(5*Q,6*Q)),pen:new Float32Array(q.slice(6*Q,6*Q+3))}},B.prototype.zeroState=function(){return{c:new Float32Array(this.numUnits),h:new Float32Array(this.numUnits)}},B.prototype.copyState=function(D){return{c:new Float32Array(D.c),h:new Float32Array(D.h)}},B.prototype.zeroInput=function(){return[0,0,1,0,0]},B.prototype.sample=function(D){var R=A.sampleSoftmax(D.pi),W=D.muX[R],j=D.muY[R],H=D.sigmaX[R],I=D.sigmaY[R],Q=D.corr[R],Y=[0,0,0];Y[A.sampleSoftmax(D.pen)]=1;var q=A.birandn(W,j,H,I,Q);return[q[0]*this.scaleFactor,q[1]*this.scaleFactor,Y[0],Y[1],Y[2]]},B.prototype.simplifyLine=function(D,R){return A.simplifyLine(D,R)},B.prototype.simplifyLines=function(D,R){return A.simplifyLines(D,R)},B.prototype.linesToStroke=function(D){return A.linesToStrokes(D)},B.prototype.lineToStroke=function(D,R){return A.lineToStroke(D,R)},B}();a.SketchRNN=U},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(256);a.SketchRNN=c.SketchRNN},function(s,a){s.exports=function(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r},s.exports.__esModule=!0,s.exports.default=s.exports},function(s,a){function r(c,S){return s.exports=r=Object.setPrototypeOf||function(E,A){return E.__proto__=A,E},s.exports.__esModule=!0,s.exports.default=s.exports,r(c,S)}s.exports=r,s.exports.__esModule=!0,s.exports.default=s.exports},function(s,a){s.exports=function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)},s.exports.__esModule=!0,s.exports.default=s.exports},function(s,a){s.exports=function(r,c){var S=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(S!=null){var E,A,U=[],B=!0,D=!1;try{for(S=S.call(r);!(B=(E=S.next()).done)&&(U.push(E.value),!c||U.length!==c);B=!0);}catch(R){D=!0,A=R}finally{try{B||S.return==null||S.return()}finally{if(D)throw A}}return U}},s.exports.__esModule=!0,s.exports.default=s.exports},function(s,a){s.exports=function(r){if(Array.isArray(r))return r},s.exports.__esModule=!0,s.exports.default=s.exports},function(s,a,r){s.exports=function(c){return typeof c=="object"&&c.isAxiosError===!0}},function(s,a,r){s.exports=function(c){return function(S){return c.apply(null,S)}}},function(s,a,r){var c=r(188);function S(E){if(typeof E!="function")throw new TypeError("executor must be a function.");var A;this.promise=new Promise(function(B){A=B});var U=this;E(function(B){U.reason||(U.reason=new c(B),A(U.reason))})}S.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},S.source=function(){var E;return{token:new S(function(A){E=A}),cancel:E}},s.exports=S},function(s){s.exports={name:"axios",version:"0.21.4",description:"Promise based HTTP client for the browser and node.js",main:"index.js",scripts:{test:"grunt test",start:"node ./sandbox/server.js",build:"NODE_ENV=production grunt build",preversion:"npm test",version:"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json",postversion:"git push && git push --tags",examples:"node ./examples/server.js",coveralls:"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js",fix:"eslint --fix lib/**/*.js"},repository:{type:"git",url:"https://github.com/axios/axios.git"},keywords:["xhr","http","ajax","promise","node"],author:"Matt Zabriskie",license:"MIT",bugs:{url:"https://github.com/axios/axios/issues"},homepage:"https://axios-http.com",devDependencies:{coveralls:"^3.0.0","es6-promise":"^4.2.4",grunt:"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1",karma:"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2",minimist:"^1.2.0",mocha:"^8.2.1",sinon:"^4.5.0","terser-webpack-plugin":"^4.2.3",typescript:"^4.0.5","url-search-params":"^0.10.0",webpack:"^4.44.2","webpack-dev-server":"^3.11.0"},browser:{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},jsdelivr:"dist/axios.min.js",unpkg:"dist/axios.min.js",typings:"./index.d.ts",dependencies:{"follow-redirects":"^1.14.0"},bundlesize:[{path:"./dist/axios.min.js",threshold:"5kB"}],_resolved:"https://registry.npmjs.org/axios/-/axios-0.21.4.tgz",_integrity:"sha512-ut5vewkiu8jjGBdqpM44XxjuCjq9LAKeHVmoVfHVzy8eHgxxq8SbAVQNovDA8mVi05kP0Ea/n/UzcSHcTJQfNg==",_from:"axios@0.21.4"}},function(s,a,r){var c=r(266),S={};["object","boolean","number","function","string","symbol"].forEach(function(B,D){S[B]=function(R){return typeof R===B||"a"+(D<1?"n ":" ")+B}});var E={},A=c.version.split(".");function U(B,D){for(var R=D?D.split("."):A,W=B.split("."),j=0;j<3;j++){if(R[j]>W[j])return!0;if(R[j]<W[j])return!1}return!1}S.transitional=function(B,D,R){var W=D&&U(D);function j(H,I){return"[Axios v"+c.version+"] Transitional option '"+H+"'"+I+(R?". "+R:"")}return function(H,I,Q){if(B===!1)throw new Error(j(I," has been removed in "+D));return W&&!E[I]&&(E[I]=!0,console.warn(j(I," has been deprecated since v"+D+" and will be removed in the near future"))),!B||B(H,I,Q)}},s.exports={isOlderVersion:U,assertOptions:function(B,D,R){if(typeof B!="object")throw new TypeError("options must be an object");for(var W=Object.keys(B),j=W.length;j-- >0;){var H=W[j],I=D[H];if(I){var Q=B[H],Y=Q===void 0||I(Q,H,B);if(Y!==!0)throw new TypeError("option "+H+" must be "+Y)}else if(R!==!0)throw Error("Unknown option "+H)}},validators:S}},function(s,a,r){var c=r(36);s.exports=c.isStandardBrowserEnv()?function(){var S,E=/(msie|trident)/i.test(navigator.userAgent),A=document.createElement("a");function U(B){var D=B;return E&&(A.setAttribute("href",D),D=A.href),A.setAttribute("href",D),{href:A.href,protocol:A.protocol?A.protocol.replace(/:$/,""):"",host:A.host,search:A.search?A.search.replace(/^\?/,""):"",hash:A.hash?A.hash.replace(/^#/,""):"",hostname:A.hostname,port:A.port,pathname:A.pathname.charAt(0)==="/"?A.pathname:"/"+A.pathname}}return S=U(window.location.href),function(B){var D=c.isString(B)?U(B):B;return D.protocol===S.protocol&&D.host===S.host}}():function(){return!0}},function(s,a,r){var c=r(36),S=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];s.exports=function(E){var A,U,B,D={};return E&&c.forEach(E.split(`
`),function(R){if(B=R.indexOf(":"),A=c.trim(R.substr(0,B)).toLowerCase(),U=c.trim(R.substr(B+1)),A){if(D[A]&&S.indexOf(A)>=0)return;D[A]=A==="set-cookie"?(D[A]?D[A]:[]).concat([U]):D[A]?D[A]+", "+U:U}}),D}},function(s,a,r){s.exports=function(c,S){return S?c.replace(/\/+$/,"")+"/"+S.replace(/^\/+/,""):c}},function(s,a,r){s.exports=function(c){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(c)}},function(s,a,r){var c=r(271),S=r(270);s.exports=function(E,A){return E&&!c(A)?S(E,A):A}},function(s,a,r){var c=r(36);s.exports=c.isStandardBrowserEnv()?{write:function(S,E,A,U,B,D){var R=[];R.push(S+"="+encodeURIComponent(E)),c.isNumber(A)&&R.push("expires="+new Date(A).toGMTString()),c.isString(U)&&R.push("path="+U),c.isString(B)&&R.push("domain="+B),D===!0&&R.push("secure"),document.cookie=R.join("; ")},read:function(S){var E=document.cookie.match(new RegExp("(^|;\\s*)("+S+")=([^;]*)"));return E?decodeURIComponent(E[3]):null},remove:function(S){this.write(S,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(s,a,r){var c=r(191);s.exports=function(S,E,A){var U=A.config.validateStatus;A.status&&U&&!U(A.status)?E(c("Request failed with status code "+A.status,A.config,null,A.request,A)):S(A)}},function(s,a,r){var c=r(36);s.exports=function(S,E){c.forEach(S,function(A,U){U!==E&&U.toUpperCase()===E.toUpperCase()&&(S[E]=A,delete S[U])})}},function(s,a,r){var c=r(36),S=r(136);s.exports=function(E,A,U){var B=this||S;return c.forEach(U,function(D){E=D.call(B,E,A)}),E}},function(s,a,r){var c=r(36),S=r(276),E=r(190),A=r(136);function U(B){B.cancelToken&&B.cancelToken.throwIfRequested()}s.exports=function(B){return U(B),B.headers=B.headers||{},B.data=S.call(B,B.data,B.headers,B.transformRequest),B.headers=c.merge(B.headers.common||{},B.headers[B.method]||{},B.headers),c.forEach(["delete","get","head","post","put","patch","common"],function(D){delete B.headers[D]}),(B.adapter||A.adapter)(B).then(function(D){return U(B),D.data=S.call(B,D.data,D.headers,B.transformResponse),D},function(D){return E(D)||(U(B),D&&D.response&&(D.response.data=S.call(B,D.response.data,D.response.headers,B.transformResponse))),Promise.reject(D)})}},function(s,a,r){var c=r(36);function S(){this.handlers=[]}S.prototype.use=function(E,A,U){return this.handlers.push({fulfilled:E,rejected:A,synchronous:!!U&&U.synchronous,runWhen:U?U.runWhen:null}),this.handlers.length-1},S.prototype.eject=function(E){this.handlers[E]&&(this.handlers[E]=null)},S.prototype.forEach=function(E){c.forEach(this.handlers,function(A){A!==null&&E(A)})},s.exports=S},function(s,a,r){var c=r(36),S=r(194),E=r(278),A=r(277),U=r(189),B=r(267),D=B.validators;function R(W){this.defaults=W,this.interceptors={request:new E,response:new E}}R.prototype.request=function(W){typeof W=="string"?(W=arguments[1]||{}).url=arguments[0]:W=W||{},(W=U(this.defaults,W)).method?W.method=W.method.toLowerCase():this.defaults.method?W.method=this.defaults.method.toLowerCase():W.method="get";var j=W.transitional;j!==void 0&&B.assertOptions(j,{silentJSONParsing:D.transitional(D.boolean,"1.0.0"),forcedJSONParsing:D.transitional(D.boolean,"1.0.0"),clarifyTimeoutError:D.transitional(D.boolean,"1.0.0")},!1);var H=[],I=!0;this.interceptors.request.forEach(function(_e){typeof _e.runWhen=="function"&&_e.runWhen(W)===!1||(I=I&&_e.synchronous,H.unshift(_e.fulfilled,_e.rejected))});var Q,Y=[];if(this.interceptors.response.forEach(function(_e){Y.push(_e.fulfilled,_e.rejected)}),!I){var q=[A,void 0];for(Array.prototype.unshift.apply(q,H),q=q.concat(Y),Q=Promise.resolve(W);q.length;)Q=Q.then(q.shift(),q.shift());return Q}for(var ae=W;H.length;){var oe=H.shift(),ye=H.shift();try{ae=oe(ae)}catch(_e){ye(_e);break}}try{Q=A(ae)}catch(_e){return Promise.reject(_e)}for(;Y.length;)Q=Q.then(Y.shift(),Y.shift());return Q},R.prototype.getUri=function(W){return W=U(this.defaults,W),S(W.url,W.params,W.paramsSerializer).replace(/^\?/,"")},c.forEach(["delete","get","head","options"],function(W){R.prototype[W]=function(j,H){return this.request(U(H||{},{method:W,url:j,data:(H||{}).data}))}}),c.forEach(["post","put","patch"],function(W){R.prototype[W]=function(j,H,I){return this.request(U(I||{},{method:W,url:j,data:H}))}}),s.exports=R},function(s,a,r){var c=r(36),S=r(195),E=r(279),A=r(189);function U(D){var R=new E(D),W=S(E.prototype.request,R);return c.extend(W,E.prototype,R),c.extend(W,R),W}var B=U(r(136));B.Axios=E,B.create=function(D){return U(A(B.defaults,D))},B.Cancel=r(188),B.CancelToken=r(265),B.isCancel=r(190),B.all=function(D){return Promise.all(D)},B.spread=r(264),B.isAxiosError=r(263),s.exports=B,s.exports.default=B},function(s,a,r){var c=function(S){var E,A=Object.prototype,U=A.hasOwnProperty,B=typeof Symbol=="function"?Symbol:{},D=B.iterator||"@@iterator",R=B.asyncIterator||"@@asyncIterator",W=B.toStringTag||"@@toStringTag";function j(pt,vt,rn){return Object.defineProperty(pt,vt,{value:rn,enumerable:!0,configurable:!0,writable:!0}),pt[vt]}try{j({},"")}catch{j=function(vt,rn,xt){return vt[rn]=xt}}function H(pt,vt,rn,xt){var _t=vt&&vt.prototype instanceof ye?vt:ye,Xt=Object.create(_t.prototype),sn=new ze(xt||[]);return Xt._invoke=function(kn,an,Ve){var Ye=Q;return function($e,ft){if(Ye===q)throw new Error("Generator is already running");if(Ye===ae){if($e==="throw")throw ft;return Ft()}for(Ve.method=$e,Ve.arg=ft;;){var $t=Ve.delegate;if($t){var Jt=yt($t,Ve);if(Jt){if(Jt===oe)continue;return Jt}}if(Ve.method==="next")Ve.sent=Ve._sent=Ve.arg;else if(Ve.method==="throw"){if(Ye===Q)throw Ye=ae,Ve.arg;Ve.dispatchException(Ve.arg)}else Ve.method==="return"&&Ve.abrupt("return",Ve.arg);Ye=q;var Pn=I(kn,an,Ve);if(Pn.type==="normal"){if(Ye=Ve.done?ae:Y,Pn.arg===oe)continue;return{value:Pn.arg,done:Ve.done}}Pn.type==="throw"&&(Ye=ae,Ve.method="throw",Ve.arg=Pn.arg)}}}(pt,rn,sn),Xt}function I(pt,vt,rn){try{return{type:"normal",arg:pt.call(vt,rn)}}catch(xt){return{type:"throw",arg:xt}}}S.wrap=H;var Q="suspendedStart",Y="suspendedYield",q="executing",ae="completed",oe={};function ye(){}function _e(){}function pe(){}var me={};j(me,D,function(){return this});var Ge=Object.getPrototypeOf,lt=Ge&&Ge(Ge(Ut([])));lt&&lt!==A&&U.call(lt,D)&&(me=lt);var It=pe.prototype=ye.prototype=Object.create(me);function wt(pt){["next","throw","return"].forEach(function(vt){j(pt,vt,function(rn){return this._invoke(vt,rn)})})}function we(pt,vt){var rn;this._invoke=function(xt,_t){function Xt(){return new vt(function(sn,kn){(function an(Ve,Ye,$e,ft){var $t=I(pt[Ve],pt,Ye);if($t.type!=="throw"){var Jt=$t.arg,Pn=Jt.value;return Pn&&typeof Pn=="object"&&U.call(Pn,"__await")?vt.resolve(Pn.__await).then(function(An){an("next",An,$e,ft)},function(An){an("throw",An,$e,ft)}):vt.resolve(Pn).then(function(An){Jt.value=An,$e(Jt)},function(An){return an("throw",An,$e,ft)})}ft($t.arg)})(xt,_t,sn,kn)})}return rn=rn?rn.then(Xt,Xt):Xt()}}function yt(pt,vt){var rn=pt.iterator[vt.method];if(rn===E){if(vt.delegate=null,vt.method==="throw"){if(pt.iterator.return&&(vt.method="return",vt.arg=E,yt(pt,vt),vt.method==="throw"))return oe;vt.method="throw",vt.arg=new TypeError("The iterator does not provide a 'throw' method")}return oe}var xt=I(rn,pt.iterator,vt.arg);if(xt.type==="throw")return vt.method="throw",vt.arg=xt.arg,vt.delegate=null,oe;var _t=xt.arg;return _t?_t.done?(vt[pt.resultName]=_t.value,vt.next=pt.nextLoc,vt.method!=="return"&&(vt.method="next",vt.arg=E),vt.delegate=null,oe):_t:(vt.method="throw",vt.arg=new TypeError("iterator result is not an object"),vt.delegate=null,oe)}function Bt(pt){var vt={tryLoc:pt[0]};1 in pt&&(vt.catchLoc=pt[1]),2 in pt&&(vt.finallyLoc=pt[2],vt.afterLoc=pt[3]),this.tryEntries.push(vt)}function Ot(pt){var vt=pt.completion||{};vt.type="normal",delete vt.arg,pt.completion=vt}function ze(pt){this.tryEntries=[{tryLoc:"root"}],pt.forEach(Bt,this),this.reset(!0)}function Ut(pt){if(pt){var vt=pt[D];if(vt)return vt.call(pt);if(typeof pt.next=="function")return pt;if(!isNaN(pt.length)){var rn=-1,xt=function _t(){for(;++rn<pt.length;)if(U.call(pt,rn))return _t.value=pt[rn],_t.done=!1,_t;return _t.value=E,_t.done=!0,_t};return xt.next=xt}}return{next:Ft}}function Ft(){return{value:E,done:!0}}return _e.prototype=pe,j(It,"constructor",pe),j(pe,"constructor",_e),_e.displayName=j(pe,W,"GeneratorFunction"),S.isGeneratorFunction=function(pt){var vt=typeof pt=="function"&&pt.constructor;return!!vt&&(vt===_e||(vt.displayName||vt.name)==="GeneratorFunction")},S.mark=function(pt){return Object.setPrototypeOf?Object.setPrototypeOf(pt,pe):(pt.__proto__=pe,j(pt,W,"GeneratorFunction")),pt.prototype=Object.create(It),pt},S.awrap=function(pt){return{__await:pt}},wt(we.prototype),j(we.prototype,R,function(){return this}),S.AsyncIterator=we,S.async=function(pt,vt,rn,xt,_t){_t===void 0&&(_t=Promise);var Xt=new we(H(pt,vt,rn,xt),_t);return S.isGeneratorFunction(vt)?Xt:Xt.next().then(function(sn){return sn.done?sn.value:Xt.next()})},wt(It),j(It,W,"Generator"),j(It,D,function(){return this}),j(It,"toString",function(){return"[object Generator]"}),S.keys=function(pt){var vt=[];for(var rn in pt)vt.push(rn);return vt.reverse(),function xt(){for(;vt.length;){var _t=vt.pop();if(_t in pt)return xt.value=_t,xt.done=!1,xt}return xt.done=!0,xt}},S.values=Ut,ze.prototype={constructor:ze,reset:function(pt){if(this.prev=0,this.next=0,this.sent=this._sent=E,this.done=!1,this.delegate=null,this.method="next",this.arg=E,this.tryEntries.forEach(Ot),!pt)for(var vt in this)vt.charAt(0)==="t"&&U.call(this,vt)&&!isNaN(+vt.slice(1))&&(this[vt]=E)},stop:function(){this.done=!0;var pt=this.tryEntries[0].completion;if(pt.type==="throw")throw pt.arg;return this.rval},dispatchException:function(pt){if(this.done)throw pt;var vt=this;function rn(an,Ve){return Xt.type="throw",Xt.arg=pt,vt.next=an,Ve&&(vt.method="next",vt.arg=E),!!Ve}for(var xt=this.tryEntries.length-1;xt>=0;--xt){var _t=this.tryEntries[xt],Xt=_t.completion;if(_t.tryLoc==="root")return rn("end");if(_t.tryLoc<=this.prev){var sn=U.call(_t,"catchLoc"),kn=U.call(_t,"finallyLoc");if(sn&&kn){if(this.prev<_t.catchLoc)return rn(_t.catchLoc,!0);if(this.prev<_t.finallyLoc)return rn(_t.finallyLoc)}else if(sn){if(this.prev<_t.catchLoc)return rn(_t.catchLoc,!0)}else{if(!kn)throw new Error("try statement without catch or finally");if(this.prev<_t.finallyLoc)return rn(_t.finallyLoc)}}}},abrupt:function(pt,vt){for(var rn=this.tryEntries.length-1;rn>=0;--rn){var xt=this.tryEntries[rn];if(xt.tryLoc<=this.prev&&U.call(xt,"finallyLoc")&&this.prev<xt.finallyLoc){var _t=xt;break}}_t&&(pt==="break"||pt==="continue")&&_t.tryLoc<=vt&&vt<=_t.finallyLoc&&(_t=null);var Xt=_t?_t.completion:{};return Xt.type=pt,Xt.arg=vt,_t?(this.method="next",this.next=_t.finallyLoc,oe):this.complete(Xt)},complete:function(pt,vt){if(pt.type==="throw")throw pt.arg;return pt.type==="break"||pt.type==="continue"?this.next=pt.arg:pt.type==="return"?(this.rval=this.arg=pt.arg,this.method="return",this.next="end"):pt.type==="normal"&&vt&&(this.next=vt),oe},finish:function(pt){for(var vt=this.tryEntries.length-1;vt>=0;--vt){var rn=this.tryEntries[vt];if(rn.finallyLoc===pt)return this.complete(rn.completion,rn.afterLoc),Ot(rn),oe}},catch:function(pt){for(var vt=this.tryEntries.length-1;vt>=0;--vt){var rn=this.tryEntries[vt];if(rn.tryLoc===pt){var xt=rn.completion;if(xt.type==="throw"){var _t=xt.arg;Ot(rn)}return _t}}throw new Error("illegal catch attempt")},delegateYield:function(pt,vt,rn){return this.delegate={iterator:Ut(pt),resultName:vt,nextLoc:rn},this.method==="next"&&(this.arg=E),oe}},S}(s.exports);try{regeneratorRuntime=c}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=c:Function("r","regeneratorRuntime = r")(c)}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.version="1.5.1"},function(s,a,r){var c=this&&this.__awaiter||function(U,B,D,R){return new(D||(D=Promise))(function(W,j){function H(Y){try{Q(R.next(Y))}catch(q){j(q)}}function I(Y){try{Q(R.throw(Y))}catch(q){j(q)}}function Q(Y){Y.done?W(Y.value):new D(function(q){q(Y.value)}).then(H,I)}Q((R=R.apply(U,B||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0});const S=r(137),E=r(46),A=r(110);a.valuesDistribution=function(U,B){return c(this,void 0,void 0,function*(){const D=E.getDrawArea(U),R=yield A.tensorStats(B),W=yield B.data();S.histogram(D,W,{height:150,stats:R})})}},function(s,a,r){var c=this&&this.__awaiter||function(A,U,B,D){return new(B||(B=Promise))(function(R,W){function j(Q){try{I(D.next(Q))}catch(Y){W(Y)}}function H(Q){try{I(D.throw(Q))}catch(Y){W(Y)}}function I(Q){Q.done?R(Q.value):new B(function(Y){Y(Q.value)}).then(j,H)}I((D=D.apply(A,U||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0});const S=r(46),E=r(109);a.perClassAccuracy=function(A,U,B){return c(this,void 0,void 0,function*(){const D=S.getDrawArea(A),R=[];for(let W=0;W<U.length;W++){const j=B?B[W]:W.toString(),H=U[W];R.push([j,H.accuracy,H.count])}return E.table(D,{headers:["Class","Accuracy","# Samples"],values:R})})}},function(s,a,r){var c=this&&this.__awaiter||function(W,j,H,I){return new(H||(H=Promise))(function(Q,Y){function q(ye){try{oe(I.next(ye))}catch(_e){Y(_e)}}function ae(ye){try{oe(I.throw(ye))}catch(_e){Y(_e)}}function oe(ye){ye.done?Q(ye.value):new H(function(_e){_e(ye.value)}).then(q,ae)}oe((I=I.apply(W,j||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0});const S=r(137),E=r(46),A=r(109),U=r(64),B=r(110);function D(W){let j;return Array.isArray(W.outputShape[0])?j=`[${W.outputShape.map(H=>R(H)).join(", ")}]`:j=R(W.outputShape),{name:W.name,trainable:W.trainable,parameters:W.countParams(),outputShape:j}}function R(W){const j=W.slice();return j.length===0?"Scalar":(j[0]===null&&(j[0]="batch"),`[${j.join(",")}]`)}a.modelSummary=function(W,j){return c(this,void 0,void 0,function*(){const H=E.getDrawArea(W),I=function(Q){return{layers:Q.layers.map(D)}}(j).layers.map(Q=>[Q.name,Q.outputShape,Q.parameters,Q.trainable]);A.table(H,{headers:["Layer Name","Output Shape","# Of Params","Trainable"],values:I})})},a.layer=function(W,j){return c(this,void 0,void 0,function*(){const H=E.getDrawArea(W),I=yield function(oe){return c(this,void 0,void 0,function*(){const ye=oe.getWeights(),_e=oe.weights,pe=ye.map(B.tensorStats),me=yield Promise.all(pe),Ge=ye.map(lt=>lt.shape);return ye.map((lt,It)=>({name:_e[It].name,stats:me[It],shape:R(Ge[It]),weight:lt}))})}(j),Q=U.subSurface(H,"layer-weights-info"),Y=I.map(oe=>[oe.name,oe.shape,oe.stats.min,oe.stats.max,oe.weight.size,oe.stats.numZeros,oe.stats.numNans,oe.stats.numInfs]);A.table(Q,{headers:["Weight Name","Shape","Min","Max","# Params","# Zeros","# NaNs","# Infinity"],values:Y});const q=U.subSurface(H,"select-layer"),ae=U.subSurface(H,"param-distribution");(function(oe,ye,_e){const pe=`<div><button>Show Values Distribution for:</button>${`
    <select>
      ${oe.map(lt=>`<option value=${lt}>${lt}</option>`)}
    </select>
  `}</div>`;ye.innerHTML=pe;const me=ye.querySelector("button"),Ge=ye.querySelector("select");me.addEventListener("click",()=>{_e(Ge.selectedOptions[0].label)})})(I.map(oe=>oe.name),q,oe=>c(this,void 0,void 0,function*(){const ye=yield I.filter(_e=>_e.name===oe)[0].weight.data();S.histogram(ae,ye,{height:150,width:460,stats:!1})}))})}},function(s,a,r){var c=this&&this.__awaiter||function(W,j,H,I){return new(H||(H=Promise))(function(Q,Y){function q(ye){try{oe(I.next(ye))}catch(_e){Y(_e)}}function ae(ye){try{oe(I.throw(ye))}catch(_e){Y(_e)}}function oe(ye){ye.done?Q(ye.value):new H(function(_e){_e(ye.value)}).then(q,ae)}oe((I=I.apply(W,j||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0});const S=r(196),E=r(46),A=r(64);function U(W,j,H,I={}){return c(this,void 0,void 0,function*(){const Q=E.getDrawArea(W),Y={};for(const ye of H)if(/val_/.test(ye)){const _e=ye.replace("val_","");B(Y,_e);const pe=D(j,ye,H.indexOf(ye));Y[_e].series.push(ye),Y[_e].values.push(pe)}else{const _e=D(j,ye,H.indexOf(ye));B(Y,ye),Y[ye].series.push(ye),Y[ye].values.push(_e)}const q=Object.keys(Y),ae=Object.assign({},{xLabel:"Iteration",yLabel:"Value"},I),oe=[];for(const ye of q){const _e=A.subSurface(Q,ye),pe=Y[ye].series,me=Y[ye].values;pe.every(lt=>Boolean(lt.match("acc")))&&(ae.zoomToFitAccuracy?ae.zoomToFit=!0:(ae.yAxisDomain=[0,1],delete ae.zoomToFit));const Ge=S.linechart(_e,{values:me,series:pe},ae);oe.push(Ge)}yield Promise.all(oe)})}function B(W,j){W[j]==null&&(W[j]={series:[],values:[]})}function D(W,j,H){if(Array.isArray(W)){const I=Array.isArray(W[0])?W[H]:W,Q=[];for(let Y=0;Y<I.length;Y++){const q=I[Y];Q.push({x:Y,y:q[j]})}return Q}return W.history[j].map((I,Q)=>({x:Q,y:I}))}function R(W,j,H){return W[j]==null&&(W[j]={}),W[j][H]==null&&(W[j][H]=[]),W[j][H]}a.history=U,a.fitCallbacks=function(W,j,H={}){const I={},Q=H.callbacks||["onEpochEnd","onBatchEnd"],Y=E.getDrawArea(W),q=Object.assign({},H);delete q.callbacks;const ae={};return Q.forEach(oe=>{ae[oe]=function(ye){return(_e,pe)=>c(this,void 0,void 0,function*(){/batch/i.test(ye)?q.xLabel="Batch":/epoch/i.test(ye)&&(q.xLabel="Epoch");const me=[],Ge=[];for(const lt of j)if(pe[lt]!=null){Ge.push(lt);const It=R(I,ye,lt);It.push({[lt]:pe[lt]}),me.push(It)}U(A.subSurface(Y,ye,{title:ye}),me,Ge,q),yield E.nextFrame()})}(oe)}),ae}},function(s,a,r){var c=this&&this.__awaiter||function(R,W,j,H){return new(j||(j=Promise))(function(I,Q){function Y(oe){try{ae(H.next(oe))}catch(ye){Q(ye)}}function q(oe){try{ae(H.throw(oe))}catch(ye){Q(ye)}}function ae(oe){oe.done?I(oe.value):new j(function(ye){ye(oe.value)}).then(Y,q)}ae((H=H.apply(R,W||[])).next())})},S=this&&this.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};Object.defineProperty(a,"__esModule",{value:!0});const E=S(r(88)),A=r(64),U=r(111),B=r(46);a.scatterplot=function(R,W,j={}){return c(this,void 0,void 0,function*(){let H=W.values;const I=W.series==null?[]:W.series,Q=[];(H=Array.isArray(H[0])?H:[H]).forEach((oe,ye)=>{const _e=I[ye]!=null?I[ye]:`Series ${ye+1}`,pe=oe.map(me=>Object.assign({},me,{series:_e}));Q.push(...pe)}),j.seriesColors!=null&&U.assert(j.seriesColors.length===H.length,"Must have an equal number of series colors as there are data series");const Y=B.getDrawArea(R),q=Object.assign({},D,j),ae={width:q.width||A.getDefaultWidth(Y),height:q.height||A.getDefaultHeight(Y),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:q.fontSize,titleFontSize:q.fontSize},text:{fontSize:q.fontSize},legend:{labelFontSize:q.fontSize,titleFontSize:q.fontSize}},data:{values:Q},mark:{type:"point",clip:!0,tooltip:{content:"data"}},encoding:{x:{field:"x",type:q.xType,title:q.xLabel,scale:q.zoomToFit?{zero:!1}:q.xAxisDomain!=null?{domain:q.xAxisDomain}:void 0},y:{field:"y",type:q.yType,title:q.yLabel,scale:q.zoomToFit?{zero:!1}:q.yAxisDomain!=null?{domain:q.yAxisDomain}:void 0},color:{field:"series",type:"nominal",scale:{range:q.seriesColors}},shape:{field:"series",type:"nominal"}}};return yield E.default(Y,ae,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()})};const D={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},function(s,a,r){var c=this&&this.__awaiter||function(H,I,Q,Y){return new(Q||(Q=Promise))(function(q,ae){function oe(pe){try{_e(Y.next(pe))}catch(me){ae(me)}}function ye(pe){try{_e(Y.throw(pe))}catch(me){ae(me)}}function _e(pe){pe.done?q(pe.value):new Q(function(me){me(pe.value)}).then(oe,ye)}_e((Y=Y.apply(H,I||[])).next())})},S=this&&this.__importStar||function(H){if(H&&H.__esModule)return H;var I={};if(H!=null)for(var Q in H)Object.hasOwnProperty.call(H,Q)&&(I[Q]=H[Q]);return I.default=H,I},E=this&&this.__importDefault||function(H){return H&&H.__esModule?H:{default:H}};Object.defineProperty(a,"__esModule",{value:!0});const A=S(r(0)),U=E(r(88)),B=r(64),D=r(111),R=r(46);function W(H,I,Q){const Y=H instanceof A.Tensor?H.shape:[H.length,H[0].length];Q===0?D.assert(Y[0]===I.length,`Length of xTickLabels (${I.length}) must match number of rows (${Y[0]})`):Q===1&&D.assert(Y[1]===I.length,`Length of yTickLabels (${I.length}) must match number of columns (${Y[1]})`)}a.heatmap=function(H,I,Q={}){return c(this,void 0,void 0,function*(){const Y=Object.assign({},j,Q),q=R.getDrawArea(H);let ae=I.values;Y.rowMajor&&(ae=yield function(It){return c(this,void 0,void 0,function*(){let wt,we;It instanceof A.Tensor?(wt=It.shape,we=It.transpose()):(wt=[It.length,It[0].length],we=A.tidy(()=>A.tensor2d(It).transpose())),D.assert(we.rank===2,"Input to renderHeatmap must be a 2d array or Tensor2d");const yt=yield we.array();we.dispose();const Bt=[yt.length,yt[0].length];return D.assert(wt[0]===Bt[1]&&wt[1]===Bt[0],`Unexpected transposed shape. Original ${wt} : Transposed ${Bt}`),yt})}(I.values));const{xTickLabels:oe,yTickLabels:ye}=I;oe!=null&&W(ae,oe,0),ye!=null&&W(ae,ye,1);const _e=[];if(ae instanceof A.Tensor){D.assert(ae.rank===2,"Input to renderHeatmap must be a 2d array or Tensor2d");const It=yield ae.data(),[wt,we]=ae.shape;for(let yt=0;yt<wt;yt++){const Bt=oe?`${oe[yt]}@tfidx@${yt}`:yt;for(let Ot=0;Ot<we;Ot++){const ze=ye?`${ye[Ot]}@tfidx@${Ot}`:Ot,Ut=It[yt*we+Ot];_e.push({x:Bt,y:ze,value:Ut})}}}else{const It=ae;for(let wt=0;wt<It.length;wt++){const we=oe?`${oe[wt]}@tfidx@${wt}`:wt;for(let yt=0;yt<It[wt].length;yt++){const Bt=ye?`${ye[yt]}@tfidx@${yt}`:yt,Ot=It[wt][yt];_e.push({x:we,y:Bt,value:Ot})}}}const pe={actions:!1,mode:"vega-lite",defaultStyle:!1},me={width:Y.width||B.getDefaultWidth(q),height:Y.height||B.getDefaultHeight(q),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:Y.fontSize,titleFontSize:Y.fontSize},text:{fontSize:Y.fontSize},legend:{labelFontSize:Y.fontSize,titleFontSize:Y.fontSize},scale:{bandPaddingInner:0,bandPaddingOuter:0}},data:{values:_e},mark:{type:"rect",tooltip:!0},encoding:{x:{field:"x",type:Y.xType,title:Y.xLabel,sort:!1},y:{field:"y",type:Y.yType,title:Y.yLabel,sort:!1},fill:{field:"value",type:"quantitative"}}},Ge=new RegExp("@tfidx@\\d+$");let lt;switch(oe&&(me.encoding.x.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),ye&&(me.encoding.y.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),(oe||ye)&&(pe.tooltip={sanitize:It=>String(It).replace(Ge,"")}),Y.colorMap){case"blues":lt=["#f7fbff","#4292c6"];break;case"greyscale":lt=["#000000","#ffffff"];break;case"viridis":default:lt="viridis"}if(lt!=="viridis"&&(me.encoding.fill.scale={range:lt}),Y.domain){const It=me.encoding.fill;It.scale!=null?It.scale=Object.assign({},It.scale,{domain:Y.domain}):It.scale={domain:Y.domain}}yield U.default(q,me,pe)})};const j={xLabel:null,yLabel:null,xType:"ordinal",yType:"ordinal",colorMap:"viridis",fontSize:12,domain:null,rowMajor:!1}},function(s,a,r){var c=this&&this.__awaiter||function(D,R,W,j){return new(W||(W=Promise))(function(H,I){function Q(ae){try{q(j.next(ae))}catch(oe){I(oe)}}function Y(ae){try{q(j.throw(ae))}catch(oe){I(oe)}}function q(ae){ae.done?H(ae.value):new W(function(oe){oe(ae.value)}).then(Q,Y)}q((j=j.apply(D,R||[])).next())})},S=this&&this.__importDefault||function(D){return D&&D.__esModule?D:{default:D}};Object.defineProperty(a,"__esModule",{value:!0});const E=S(r(88)),A=r(64),U=r(46);a.confusionMatrix=function(D,R,W={}){return c(this,void 0,void 0,function*(){const j=Object.assign({},B,W),H=U.getDrawArea(D),I=[],Q=R.values,Y=R.tickLabels||[],q=Y.length===0;let ae=!0;for(let _e=0;_e<Q.length;_e++){const pe=q?`Class ${_e}`:Y[_e];q&&Y.push(pe);for(let me=0;me<Q[_e].length;me++){const Ge=q?`Class ${me}`:Y[me],lt=Q[_e][me];_e!==me||j.shadeDiagonal?(I.push({label:pe,prediction:Ge,count:lt,scaleCount:lt}),lt!==0&&(ae=!1)):I.push({label:pe,prediction:Ge,count:lt,noFill:!0})}}if(!j.shadeDiagonal&&ae)for(const _e of I)_e.noFill===!0&&(_e.noFill=!1,_e.scaleCount=_e.count);const oe={width:j.width||A.getDefaultWidth(H),height:j.height||A.getDefaultHeight(H),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:j.fontSize,titleFontSize:j.fontSize},text:{fontSize:j.fontSize},legend:{labelFontSize:j.fontSize,titleFontSize:j.fontSize}},data:{values:I},encoding:{x:{field:"prediction",type:"ordinal",title:j.xLabel||"prediction",scale:{domain:Y}},y:{field:"label",type:"ordinal",title:j.yLabel||"label",scale:{domain:Y}}},layer:[{transform:[{filter:"datum.noFill != true"}],mark:{type:"rect"},encoding:{color:{field:"scaleCount",type:"quantitative",scale:{range:j.colorMap}},tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}]};j.shadeDiagonal===!1&&oe.layer.push({transform:[{filter:"datum.noFill == true"}],mark:{type:"rect",fill:"white"},encoding:{tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}),j.showTextOverlay&&oe.layer.push({mark:{type:"text",baseline:"middle"},encoding:{text:{field:"count",type:"nominal"}}});const ye=typeof j.colorMap=="string"?{scheme:j.colorMap}:j.colorMap;oe.layer[0].encoding.color.scale.range=ye,yield E.default(H,oe,{actions:!1,mode:"vega-lite",defaultStyle:!1})})};const B={xLabel:null,yLabel:null,xType:"nominal",yType:"nominal",shadeDiagonal:!0,fontSize:12,showTextOverlay:!0,height:400,colorMap:["#f7fbff","#4292c6"]}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});const c=r(138),S=r(102);a.Tabs=class extends c.Component{render(){const{tabNames:A,activeTab:U,handleClick:B}=this.props,D=A.length>0?A.map(W=>c.h(E,{key:W,id:W,handleClick:B,isActive:W===U},W)):null,R=S.css({overflowX:"scroll",overflowY:"hidden",whiteSpace:"nowrap",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"#eee",paddingBottom:"1rem",marginTop:"1rem"});return c.h("div",{className:`${R} visor-tabs`},D)}};class E extends c.Component{render(){const{children:U,isActive:B,handleClick:D,id:R}=this.props,W=S.css({borderBottomColor:B?"#357EDD":"#AAAAAA",borderBottomWidth:"1px",borderBottomStyle:"solid",cursor:"pointer",":hover":{color:"#357EDD"},display:"inline-block",marginRight:"1rem",padding:".5rem",fontSize:"1rem",fontWeight:"bold"});return c.h("a",{className:`${W} tf-tab`,"data-isactive":B,onClick:()=>D(R)},U)}}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});const c=r(138),S=r(102);class E extends c.Component{componentDidMount(){const{name:U,tab:B}=this.props;this.props.registerSurface(U,B,this)}componentDidUpdate(){return!1}render(){const{name:U,visible:B,styles:D}=this.props,R=Object.assign({},E.defaultStyles,D),{width:W,height:j}=R;let{maxHeight:H,maxWidth:I}=R;H=j===E.defaultStyles.height?H:j,I=W===E.defaultStyles.width?I:W;const Q=S.css({display:B?"block":"none",backgroundColor:"white",marginTop:"10px",marginBottom:"10px",boxShadow:"0 0 6px -3px #777",padding:"10px !important",height:j,width:W,maxHeight:H,maxWidth:I,overflow:"auto"}),Y=S.css({backgroundColor:"white",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",marginBottom:"20px",fontWeight:"600",textAlign:"center"}),q=S.css({boxSizing:"border-box"});return c.h("div",{className:`${Q} tf-surface`,ref:ae=>this.container=ae,"data-visible":B},c.h("div",{className:`${Y} tf-label`,ref:ae=>this.label=ae},U),c.h("div",{className:`${q} tf-draw-area`,ref:ae=>this.drawArea=ae}))}}E.defaultStyles={maxWidth:"550px",maxHeight:"580px",height:"auto",width:"auto"},a.SurfaceComponent=E},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});const c=r(138),S=r(102),E=r(291),A=r(290);class U extends c.Component{static render(R,W,j){return c.render(c.h(U,Object.assign({},j)),R,W)}constructor(R){super(R),this.surfaces=new Map;const W=R.startOpen==null||R.startOpen;this.state={isOpen:W,isFullscreen:!1,activeTab:null,tabs:new Set},this.keyHandler=this.keyHandler.bind(this)}close(){this.setState({isOpen:!1})}open(){this.setState({isOpen:!0})}toggle(){this.setState({isOpen:!this.state.isOpen})}toggleFullScreen(){this.setState({isFullscreen:!this.state.isFullscreen})}isOpen(){return this.state.isOpen}isFullscreen(){return this.state.isFullscreen}getSurface(R,W){const j=this.surfaceId(R,W);let H;if(!this.surfaces.has(j))throw Error(`Surface not found with id: ${j}`);return{container:(H=this.surfaces.get(j)).container,label:H.label,drawArea:H.drawArea}}bindKeys(){document.addEventListener("keydown",this.keyHandler,!1)}unbindKeys(){document.removeEventListener("keydown",this.keyHandler)}surfaceId(R,W){return R+W}setTabs(R){const W=R.map(I=>I.tab),j=this.state.tabs;let H;for(const I of W)j.has(I)||(j.add(I),H=I);H!=null&&this.setState({tabs:j,activeTab:H})}getTabs(){return this.state.tabs}registerSurface(R,W,j){const H=this.surfaceId(R,W);this.surfaces.set(H,j)}keyHandler(R){R.keyCode===192&&(R.shiftKey?this.toggleFullScreen():this.toggle())}setActiveTab(R){this.setState({activeTab:R})}componentDidMount(){this.bindKeys()}componentWillMount(){this.setTabs(this.props.surfaceList)}componentWillReceiveProps(R){this.setTabs(R.surfaceList)}render(){const{isOpen:R,isFullscreen:W,activeTab:j}=this.state,{surfaceList:H}=this.props,I=Array.from(this.getTabs().values()),Q=W?"90vw":"550px",Y=S.css({width:Q,height:"100%",backgroundColor:"#fafafa",boxSizing:"border-box",padding:"10px",position:"fixed",top:"0px",transition:"right 0.5s cubic-bezier(0.645, 0.045, 0.355, 1), width 0.5s cubic-bezier(0.645, 0.045, 0.355, 1)",boxShadow:"0 2px 5px rgba(0, 0, 0, 0.12), 0 2px 5px rgba(0, 0, 0, 0.24)",overflow:"auto",fontFamily:"sans-serif",fontSize:"14px",zIndex:1e3}),q=S.css({right:"0"}),ae=S.css({right:`calc(-${Q} - 10px)`}),oe=R?q:ae,ye=S.css({});return c.h("div",{className:`${Y} ${oe} visor`,"data-isopen":R,"data-isfullscreen":W},c.h(B,{fullScreenHandler:this.toggleFullScreen.bind(this),closeHandler:this.close.bind(this),isFullScreen:W}),c.h(A.Tabs,{tabNames:I,activeTab:j,handleClick:this.setActiveTab.bind(this)}),c.h("div",{className:`${ye} visor-surfaces`},H.map(_e=>c.h(E.SurfaceComponent,{key:_e.name+_e.tab,name:_e.name,tab:_e.tab,styles:_e.styles,registerSurface:this.registerSurface.bind(this),visible:j===_e.tab}))))}}function B(D){const{isFullScreen:R,fullScreenHandler:W,closeHandler:j}=D,H=S.css({display:"flex",backgroundColor:"white",border:"1px solid white",padding:"6px",paddingTop:"10px",marginBottom:"10px",borderRadius:"6px",marginTop:"-16px"}),I=S.css({fontSize:".875rem",borderRadius:".25rem",paddingLeft:"1rem",paddingRight:"1rem",paddingTop:".5rem",paddingBottom:".5rem",textDecoration:"none",transition:"color .15s ease-in",color:"#111"}),Q=S.css({marginLeft:"auto"});return c.h("div",{className:`${H} visor-controls`},c.h("button",{className:`${I}`,onClick:W},R?"Minimize":"Maximize"),c.h("button",{className:`${I} ${Q}`,onClick:j},"Hide"))}a.VisorComponent=U},function(s,a,r){function c(A,U){return A.charCodeAt(U++)+(A.charCodeAt(U++)<<8)+(A.charCodeAt(U++)<<16)+(A.charCodeAt(U)<<24)}function S(A,U){return A.charCodeAt(U++)+(A.charCodeAt(U++)<<8)}function E(A,U){return(65535&(A|=0))*(U|=0)+(((A>>>16)*U&65535)<<16)|0}Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(A,U){for(var B=1540483477,D=U^A.length,R=A.length,W=0;R>=4;){var j=c(A,W);j=E(j,B),j=E(j^=j>>>24,B),D=E(D,B),D^=j,W+=4,R-=4}switch(R){case 3:D^=S(A,W),D=E(D^=A.charCodeAt(W+2)<<16,B);break;case 2:D=E(D^=S(A,W),B);break;case 1:D=E(D^=A.charCodeAt(W),B)}return D=E(D^=D>>>13,B),(D^=D>>>15)>>>0}},function(s,a,r){r.r(a);var c=/[A-Z]/g,S=/^ms-/,E={};function A(U){return"-"+U.toLowerCase()}a.default=function(U){if(E.hasOwnProperty(U))return E[U];var B=U.replace(c,A);return E[U]=S.test(B)?"-"+B:B}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(S){return(0,c.default)(S)};var c=function(S){return S&&S.__esModule?S:{default:S}}(r(294));s.exports=a.default},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(D,R,W,j){if(typeof R=="string"&&U.hasOwnProperty(D)){var H=function(Y,q){if((0,S.default)(Y))return Y;for(var ae=Y.split(/,(?![^()]*(?:\([^()]*\))?\))/g),oe=0,ye=ae.length;oe<ye;++oe){var _e=ae[oe],pe=[_e];for(var me in q){var Ge=(0,c.default)(me);if(_e.indexOf(Ge)>-1&&Ge!=="order")for(var lt=q[me],It=0,wt=lt.length;It<wt;++It)pe.unshift(_e.replace(Ge,B[lt[It]]+Ge))}ae[oe]=pe.join(",")}return ae.join(",")}(R,j),I=H.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter(function(Y){return!/-moz-|-ms-/.test(Y)}).join(",");if(D.indexOf("Webkit")>-1)return I;var Q=H.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter(function(Y){return!/-webkit-|-ms-/.test(Y)}).join(",");return D.indexOf("Moz")>-1?Q:(W["Webkit"+(0,E.default)(D)]=I,W["Moz"+(0,E.default)(D)]=Q,H)}};var c=A(r(295)),S=A(r(101)),E=A(r(199));function A(D){return D&&D.__esModule?D:{default:D}}var U={transition:!0,transitionProperty:!0,WebkitTransition:!0,WebkitTransitionProperty:!0,MozTransition:!0,MozTransitionProperty:!0},B={Webkit:"-webkit-",Moz:"-moz-",ms:"-ms-"};s.exports=a.default},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(A,U){if(S.hasOwnProperty(A)&&E.hasOwnProperty(U))return c.map(function(B){return B+U})};var c=["-webkit-","-moz-",""],S={maxHeight:!0,maxWidth:!0,width:!0,height:!0,columnWidth:!0,minWidth:!0,minHeight:!0},E={"min-content":!0,"max-content":!0,"fill-available":!0,"fit-content":!0,"contain-floats":!0};s.exports=a.default},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(c,S){if(c==="position"&&S==="sticky")return["-webkit-sticky","sticky"]},s.exports=a.default},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(E,A){if(typeof A=="string"&&!(0,c.default)(A)&&A.indexOf("image-set(")>-1)return S.map(function(U){return A.replace(/image-set\(/g,U+"image-set(")})};var c=function(E){return E&&E.__esModule?E:{default:E}}(r(101)),S=["-webkit-",""];s.exports=a.default},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(A,U){if(typeof U=="string"&&!(0,c.default)(U)&&E.test(U))return S.map(function(B){return B+U})};var c=function(A){return A&&A.__esModule?A:{default:A}}(r(101)),S=["-webkit-","-moz-",""],E=/linear-gradient|radial-gradient|repeating-linear-gradient|repeating-radial-gradient/;s.exports=a.default},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(E,A,U){E==="flexDirection"&&typeof A=="string"&&(A.indexOf("column")>-1?U.WebkitBoxOrient="vertical":U.WebkitBoxOrient="horizontal",A.indexOf("reverse")>-1?U.WebkitBoxDirection="reverse":U.WebkitBoxDirection="normal"),S.hasOwnProperty(E)&&(U[S[E]]=c[A]||A)};var c={"space-around":"justify","space-between":"justify","flex-start":"start","flex-end":"end","wrap-reverse":"multiple",wrap:"multiple"},S={alignItems:"WebkitBoxAlign",justifyContent:"WebkitBoxPack",flexWrap:"WebkitBoxLines"};s.exports=a.default},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(S,E){if(S==="display"&&c.hasOwnProperty(E))return c[E]};var c={flex:["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex","flex"],"inline-flex":["-webkit-inline-box","-moz-inline-box","-ms-inline-flexbox","-webkit-inline-flex","inline-flex"]};s.exports=a.default},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(E,A){if(typeof A=="string"&&!(0,c.default)(A)&&A.indexOf("filter(")>-1)return S.map(function(U){return A.replace(/filter\(/g,U+"filter(")})};var c=function(E){return E&&E.__esModule?E:{default:E}}(r(101)),S=["-webkit-",""];s.exports=a.default},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(E,A){if(typeof A=="string"&&!(0,c.default)(A)&&A.indexOf("cross-fade(")>-1)return S.map(function(U){return A.replace(/cross-fade\(/g,U+"cross-fade(")})};var c=function(E){return E&&E.__esModule?E:{default:E}}(r(101)),S=["-webkit-",""];s.exports=a.default},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(E,A){if(E==="cursor"&&S.hasOwnProperty(A))return c.map(function(U){return U+A})};var c=["-webkit-","-moz-",""],S={"zoom-in":!0,"zoom-out":!0,grab:!0,grabbing:!0};s.exports=a.default},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(c,S,E,A,U){for(var B=0,D=c.length;B<D;++B){var R=c[B](S,E,A,U);if(R)return R}},s.exports=a.default},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(S,E,A){if(S.hasOwnProperty(E))for(var U=S[E],B=0,D=U.length;B<D;++B)A[U[B]+(0,c.default)(E)]=A[E]};var c=function(S){return S&&S.__esModule?S:{default:S}}(r(199));s.exports=a.default},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=["Webkit"],S=["Moz"],E=["ms"],A=["Webkit","Moz"],U=["Webkit","ms"],B=["Webkit","Moz","ms"];a.default={plugins:[],prefixMap:{appearance:A,userSelect:B,textEmphasisPosition:c,textEmphasis:c,textEmphasisStyle:c,textEmphasisColor:c,boxDecorationBreak:c,clipPath:c,maskImage:c,maskMode:c,maskRepeat:c,maskPosition:c,maskClip:c,maskOrigin:c,maskSize:c,maskComposite:c,mask:c,maskBorderSource:c,maskBorderMode:c,maskBorderSlice:c,maskBorderWidth:c,maskBorderOutset:c,maskBorderRepeat:c,maskBorder:c,maskType:c,textDecorationStyle:c,textDecorationSkip:c,textDecorationLine:c,textDecorationColor:c,filter:c,fontFeatureSettings:c,breakAfter:B,breakBefore:B,breakInside:B,columnCount:A,columnFill:A,columnGap:A,columnRule:A,columnRuleColor:A,columnRuleStyle:A,columnRuleWidth:A,columns:A,columnSpan:A,columnWidth:A,writingMode:U,flex:c,flexBasis:c,flexDirection:c,flexGrow:c,flexFlow:c,flexShrink:c,flexWrap:c,alignContent:c,alignItems:c,alignSelf:c,justifyContent:c,order:c,transform:c,transformOrigin:c,transformOriginX:c,transformOriginY:c,backfaceVisibility:c,perspective:c,perspectiveOrigin:c,transformStyle:c,transformOriginZ:c,animation:c,animationDelay:c,animationDirection:c,animationFillMode:c,animationDuration:c,animationIterationCount:c,animationName:c,animationPlayState:c,animationTimingFunction:c,backdropFilter:c,fontKerning:c,scrollSnapType:U,scrollSnapPointsX:U,scrollSnapPointsY:U,scrollSnapDestination:U,scrollSnapCoordinate:U,shapeImageThreshold:c,shapeImageMargin:c,shapeImageOutside:c,hyphens:B,flowInto:U,flowFrom:U,regionFragment:U,textAlignLast:S,tabSize:S,wrapFlow:E,wrapThrough:E,wrapMargin:E,gridTemplateColumns:E,gridTemplateRows:E,gridTemplateAreas:E,gridTemplate:E,gridAutoColumns:E,gridAutoRows:E,gridAutoFlow:E,grid:E,gridRowStart:E,gridColumnStart:E,gridRowEnd:E,gridRow:E,gridColumn:E,gridColumnEnd:E,gridColumnGap:E,gridRowGap:E,gridArea:E,gridGap:E,textSizeAdjust:U,borderImage:c,borderImageOutset:c,borderImageRepeat:c,borderImageSlice:c,borderImageSource:c,borderImageWidth:c,transitionDelay:c,transitionDuration:c,transitionProperty:c,transitionTimingFunction:c}},s.exports=a.default},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(oe){for(var ye in oe){var _e=oe[ye],pe=(0,E.default)(q,ye,_e,oe,ae);pe&&(oe[ye]=pe),(0,S.default)(ae,ye,oe)}return oe};var c=Y(r(308)),S=Y(r(307)),E=Y(r(306)),A=Y(r(305)),U=Y(r(304)),B=Y(r(303)),D=Y(r(302)),R=Y(r(301)),W=Y(r(300)),j=Y(r(299)),H=Y(r(298)),I=Y(r(297)),Q=Y(r(296));function Y(oe){return oe&&oe.__esModule?oe:{default:oe}}var q=[U.default,A.default,B.default,R.default,W.default,j.default,H.default,I.default,Q.default,D.default],ae=c.default.prefixMap},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=Object.assign||function(R){for(var W=1;W<arguments.length;W++){var j=arguments[W];for(var H in j)Object.prototype.hasOwnProperty.call(j,H)&&(R[H]=j[H])}return R};a.PluginSet=B,a.fallbacks=function(R){if(Object.keys(R.style).map(function(H){return Array.isArray(R.style[H])}).indexOf(!0)>=0){var W=R.style,j=Object.keys(W).reduce(function(H,I){return H[I]=Array.isArray(W[I])?W[I].join("; "+(0,E.processStyleName)(I)+": "):W[I],H},{});return(0,S.default)({},R,{style:j})}return R},a.contentWrap=function(R){if(R.style.content){var W=R.style.content;return D.indexOf(W)>=0||/^(attr|calc|counters?|url)\(/.test(W)?R:W.charAt(0)!==W.charAt(W.length-1)||W.charAt(0)!=='"'&&W.charAt(0)!=="'"?c({},R,{style:c({},R.style,{content:'"'+W+'"'})}):R}return R},a.prefixes=function(R){return(0,S.default)({},R,{style:(0,A.default)(c({},R.style))})};var S=U(r(139)),E=r(201),A=U(r(309));function U(R){return R&&R.__esModule?R:{default:R}}function B(R){this.fns=R||[]}(0,S.default)(B.prototype,{add:function(){for(var R=this,W=arguments.length,j=Array(W),H=0;H<W;H++)j[H]=arguments[H];j.forEach(function(I){R.fns.indexOf(I)>=0||(R.fns=[I].concat(R.fns))})},remove:function(R){this.fns=this.fns.filter(function(W){return W!==R})},clear:function(){this.fns=[]},transform:function(R){return this.fns.reduce(function(W,j){return j(W)},R)}});var D=["normal","none","counter","open-quote","close-quote","no-open-quote","no-close-quote","initial","inherit"]},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A};function S(A){if(function(H){return H==null||H===!1||(H===void 0?"undefined":c(H))==="object"&&Object.keys(H).length===0}(A))return null;if((A===void 0?"undefined":c(A))!=="object")return A;for(var U={},B=Object.keys(A),D=!1,R=0;R<B.length;R++){var W=A[B[R]],j=E(W);j!==null&&j===W||(D=!0),j!==null&&(U[B[R]]=j)}return Object.keys(U).length===0?null:D?U:A}function E(A){return Array.isArray(A)?function(U){var B=!1,D=[];return U.forEach(function(R){var W=E(R);W!==null&&W===R||(B=!0),W!==null&&D.push(W)}),D.length==0?null:B?D:U}(A):S(A)}a.default=E},function(s,a,r){s.exports=function(c){var S={};return function(E){return S.hasOwnProperty(E)||(S[E]=c.call(this,E)),S[E]}}},function(s,a,r){var c=/([A-Z])/g;s.exports=function(S){return S.replace(c,"-$1").toLowerCase()}},function(s,a,r){var c=r(313),S=/^ms-/;s.exports=function(E){return c(E).replace(S,"-ms-")}},function(s,a,r){function c(E){return function(){return E}}var S=function(){};S.thatReturns=c,S.thatReturnsFalse=c(!1),S.thatReturnsTrue=c(!0),S.thatReturnsNull=c(null),S.thatReturnsThis=function(){return this},S.thatReturnsArgument=function(E){return E},s.exports=S},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowStart:!0,gridRowEnd:!0,gridColumn:!0,gridColumnStart:!0,gridColumnEnd:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},S=["Webkit","ms","Moz","O"];Object.keys(c).forEach(function(A){S.forEach(function(U){c[function(B,D){return B+D.charAt(0).toUpperCase()+D.substring(1)}(U,A)]=c[A]})});var E={isUnitlessNumber:c,shorthandPropertyExpansions:{background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}}};a.default=E},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=S(r(316));S(r(200));function S(A){return A&&A.__esModule?A:{default:A}}var E=c.default.isUnitlessNumber;a.default=function(A,U,B){return U==null||typeof U=="boolean"||U===""?"":isNaN(U)||U===0||E.hasOwnProperty(A)&&E[A]?""+U:(typeof U=="string"&&(U=U.trim()),U+"px")}},function(s,a,r){var c=/-(.)/g;s.exports=function(S){return S.replace(c,function(E,A){return A.toUpperCase()})}},function(s,a,r){var c=r(318),S=/^-ms-/;s.exports=function(E){return c(E.replace(S,"ms-"))}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),a.StyleSheet=R;var c=function(W){return W&&W.__esModule?W:{default:W}}(r(139));function S(W){return W[W.length-1]}function E(W){if(W.sheet)return W.sheet;for(var j=0;j<document.styleSheets.length;j++)if(document.styleSheets[j].ownerNode===W)return document.styleSheets[j]}var A=typeof window<"u",U=!1,B=function(){if(A){var W=document.createElement("div");return W.innerHTML="<!--[if lt IE 10]><i></i><![endif]-->",W.getElementsByTagName("i").length===1}}();function D(){var W=document.createElement("style");return W.type="text/css",W.setAttribute("data-glamor",""),W.appendChild(document.createTextNode("")),(document.head||document.getElementsByTagName("head")[0]).appendChild(W),W}function R(){var W=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},j=W.speedy,H=j===void 0?!U:j,I=W.maxLength,Q=I===void 0?A&&B?4e3:65e3:I;this.isSpeedy=H,this.sheet=void 0,this.tags=[],this.maxLength=Q,this.ctr=0}(0,c.default)(R.prototype,{getSheet:function(){return E(S(this.tags))},inject:function(){var W=this;if(this.injected)throw new Error("already injected stylesheet!");A?this.tags[0]=D():this.sheet={cssRules:[],insertRule:function(j){W.sheet.cssRules.push({cssText:j})}},this.injected=!0},speedy:function(W){if(this.ctr!==0)throw new Error("cannot change speedy mode after inserting any rule to sheet. Either call speedy("+W+") earlier in your app, or call flush() before speedy("+W+")");this.isSpeedy=!!W},_insert:function(W){try{var j=this.getSheet();j.insertRule(W,W.indexOf("@import")!==-1?0:j.cssRules.length)}catch{}},insert:function(W){if(A)if(this.isSpeedy&&this.getSheet().insertRule)this._insert(W);else if(W.indexOf("@import")!==-1){var j=S(this.tags);j.insertBefore(document.createTextNode(W),j.firstChild)}else S(this.tags).appendChild(document.createTextNode(W));else this.sheet.insertRule(W,W.indexOf("@import")!==-1?0:this.sheet.cssRules.length);return this.ctr++,A&&this.ctr%this.maxLength==0&&this.tags.push(D()),this.ctr-1},delete:function(W){return this.replace(W,"")},flush:function(){A?(this.tags.forEach(function(W){return W.parentNode.removeChild(W)}),this.tags=[],this.sheet=null,this.ctr=0):this.sheet.cssRules=[],this.injected=!1},rules:function(){if(!A)return this.sheet.cssRules;var W=[];return this.tags.forEach(function(j){return W.splice.apply(W,[W.length,0].concat(function(H){if(Array.isArray(H)){for(var I=0,Q=Array(H.length);I<H.length;I++)Q[I]=H[I];return Q}return Array.from(H)}(Array.from(E(j).cssRules))))}),W}})},function(s,a,r){r.r(a),r.d(a,"default",function(){return B});var c=r(null),S=r(87),E=r(null),A=r(null),U=r(null);function B(){var D=[],R=A.c;function W(j){if(j!=null&&!isNaN(j=+j))return R((Object(c.c)(D,j,1)-1)/(D.length-1))}return W.domain=function(j){if(!arguments.length)return D.slice();D=[];for(let H of j)H==null||isNaN(H=+H)||D.push(H);return D.sort(S.a),W},W.interpolator=function(j){return arguments.length?(R=j,W):R},W.range=function(){return D.map((j,H)=>R(H/(D.length-1)))},W.quantiles=function(j){return Array.from({length:j+1},(H,I)=>Object(E.b)(D,I/j))},W.copy=function(){return B(R).domain(D)},U.b.apply(W,arguments)}},function(s,a,r){r.r(a),r.d(a,"default",function(){return B});var c=r(null),S=r(null),E=r(null),A=r(null);function U(D){return Math.sign(D)*D*D}function B(){var D,R=Object(c.a)(),W=[0,1],j=!1;function H(I){var Q=function(Y){return Math.sign(Y)*Math.sqrt(Math.abs(Y))}(R(I));return isNaN(Q)?D:j?Math.round(Q):Q}return H.invert=function(I){return R.invert(U(I))},H.domain=function(I){return arguments.length?(R.domain(I),H):R.domain()},H.range=function(I){return arguments.length?(R.range((W=Array.from(I,A.a)).map(U)),H):W.slice()},H.rangeRound=function(I){return H.range(I).round(!0)},H.round=function(I){return arguments.length?(j=!!I,H):j},H.clamp=function(I){return arguments.length?(R.clamp(I),H):R.clamp()},H.unknown=function(I){return arguments.length?(D=I,H):D},H.copy=function(){return B(R.domain(),W).round(j).clamp(R.clamp()).unknown(D)},S.a.apply(H,arguments),Object(E.b)(H)}},function(s,a,r){const c=r(47),S=r(113),{ANY:E}=S,A=r(112),U=r(48),B=(W,j,H)=>{if(W===j)return!0;if(W.length===1&&W[0].semver===E){if(j.length===1&&j[0].semver===E)return!0;W=H.includePrerelease?[new S(">=0.0.0-0")]:[new S(">=0.0.0")]}if(j.length===1&&j[0].semver===E){if(H.includePrerelease)return!0;j=[new S(">=0.0.0")]}const I=new Set;let Q,Y,q,ae,oe,ye,_e;for(const Ge of W)Ge.operator===">"||Ge.operator===">="?Q=D(Q,Ge,H):Ge.operator==="<"||Ge.operator==="<="?Y=R(Y,Ge,H):I.add(Ge.semver);if(I.size>1||Q&&Y&&((q=U(Q.semver,Y.semver,H))>0||q===0&&(Q.operator!==">="||Y.operator!=="<=")))return null;for(const Ge of I){if(Q&&!A(Ge,String(Q),H)||Y&&!A(Ge,String(Y),H))return null;for(const lt of j)if(!A(Ge,String(lt),H))return!1;return!0}let pe=!(!Y||H.includePrerelease||!Y.semver.prerelease.length)&&Y.semver,me=!(!Q||H.includePrerelease||!Q.semver.prerelease.length)&&Q.semver;pe&&pe.prerelease.length===1&&Y.operator==="<"&&pe.prerelease[0]===0&&(pe=!1);for(const Ge of j){if(_e=_e||Ge.operator===">"||Ge.operator===">=",ye=ye||Ge.operator==="<"||Ge.operator==="<=",Q){if(me&&Ge.semver.prerelease&&Ge.semver.prerelease.length&&Ge.semver.major===me.major&&Ge.semver.minor===me.minor&&Ge.semver.patch===me.patch&&(me=!1),Ge.operator===">"||Ge.operator===">="){if((ae=D(Q,Ge,H))===Ge&&ae!==Q)return!1}else if(Q.operator===">="&&!A(Q.semver,String(Ge),H))return!1}if(Y){if(pe&&Ge.semver.prerelease&&Ge.semver.prerelease.length&&Ge.semver.major===pe.major&&Ge.semver.minor===pe.minor&&Ge.semver.patch===pe.patch&&(pe=!1),Ge.operator==="<"||Ge.operator==="<="){if((oe=R(Y,Ge,H))===Ge&&oe!==Y)return!1}else if(Y.operator==="<="&&!A(Y.semver,String(Ge),H))return!1}if(!Ge.operator&&(Y||Q)&&q!==0)return!1}return!(Q&&ye&&!Y&&q!==0)&&!(Y&&_e&&!Q&&q!==0)&&!me&&!pe},D=(W,j,H)=>{if(!W)return j;const I=U(W.semver,j.semver,H);return I>0?W:I<0||j.operator===">"&&W.operator===">="?j:W},R=(W,j,H)=>{if(!W)return j;const I=U(W.semver,j.semver,H);return I<0?W:I>0||j.operator==="<"&&W.operator==="<="?j:W};s.exports=(W,j,H={})=>{if(W===j)return!0;W=new c(W,H),j=new c(j,H);let I=!1;e:for(const Q of W.set){for(const Y of j.set){const q=B(Q,Y,H);if(I=I||q!==null,q)continue e}if(I)return!1}return!0}},function(s,a,r){const c=r(112),S=r(48);s.exports=(E,A,U)=>{const B=[];let D=null,R=null;const W=E.sort((Q,Y)=>S(Q,Y,U));for(const Q of W)c(Q,A,U)?(R=Q,D||(D=Q)):(R&&B.push([D,R]),R=null,D=null);D&&B.push([D,null]);const j=[];for(const[Q,Y]of B)Q===Y?j.push(Q):Y||Q!==W[0]?Y?Q===W[0]?j.push(`<=${Y}`):j.push(`${Q} - ${Y}`):j.push(`>=${Q}`):j.push("*");const H=j.join(" || "),I=typeof A.raw=="string"?A.raw:String(A);return H.length<I.length?H:A}},function(s,a,r){const c=r(47);s.exports=(S,E,A)=>(S=new c(S,A),E=new c(E,A),S.intersects(E))},function(s,a,r){const c=r(140);s.exports=(S,E,A)=>c(S,E,"<",A)},function(s,a,r){const c=r(140);s.exports=(S,E,A)=>c(S,E,">",A)},function(s,a,r){const c=r(47);s.exports=(S,E)=>{try{return new c(S,E).range||"*"}catch{return null}}},function(s,a,r){const c=r(32),S=r(47),E=r(114);s.exports=(A,U)=>{A=new S(A,U);let B=new c("0.0.0");if(A.test(B)||(B=new c("0.0.0-0"),A.test(B)))return B;B=null;for(let D=0;D<A.set.length;++D){let R=null;A.set[D].forEach(W=>{const j=new c(W.semver.version);switch(W.operator){case">":j.prerelease.length===0?j.patch++:j.prerelease.push(0),j.raw=j.format();case"":case">=":R&&!E(j,R)||(R=j);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${W.operator}`)}}),!R||B&&!E(B,R)||(B=R)}return B&&A.test(B)?B:null}},function(s,a,r){const c=r(32),S=r(47);s.exports=(E,A,U)=>{let B=null,D=null,R=null;try{R=new S(A,U)}catch{return null}return E.forEach(W=>{R.test(W)&&(B&&D.compare(W)!==1||(D=new c(B=W,U)))}),B}},function(s,a,r){const c=r(32),S=r(47);s.exports=(E,A,U)=>{let B=null,D=null,R=null;try{R=new S(A,U)}catch{return null}return E.forEach(W=>{R.test(W)&&(B&&D.compare(W)!==-1||(D=new c(B=W,U)))}),B}},function(s,a,r){const c=r(47);s.exports=(S,E)=>new c(S,E).set.map(A=>A.map(U=>U.value).join(" ").trim().split(" "))},function(s,a,r){s.exports=function(c){c.prototype[Symbol.iterator]=function*(){for(let S=this.head;S;S=S.next)yield S.value}}},function(s,a,r){function c(B){var D=this;if(D instanceof c||(D=new c),D.tail=null,D.head=null,D.length=0,B&&typeof B.forEach=="function")B.forEach(function(j){D.push(j)});else if(arguments.length>0)for(var R=0,W=arguments.length;R<W;R++)D.push(arguments[R]);return D}function S(B,D,R){var W=D===B.head?new U(R,null,D,B):new U(R,D,D.next,B);return W.next===null&&(B.tail=W),W.prev===null&&(B.head=W),B.length++,W}function E(B,D){B.tail=new U(D,B.tail,null,B),B.head||(B.head=B.tail),B.length++}function A(B,D){B.head=new U(D,null,B.head,B),B.tail||(B.tail=B.head),B.length++}function U(B,D,R,W){if(!(this instanceof U))return new U(B,D,R,W);this.list=W,this.value=B,D?(D.next=this,this.prev=D):this.prev=null,R?(R.prev=this,this.next=R):this.next=null}s.exports=c,c.Node=U,c.create=c,c.prototype.removeNode=function(B){if(B.list!==this)throw new Error("removing node which does not belong to this list");var D=B.next,R=B.prev;return D&&(D.prev=R),R&&(R.next=D),B===this.head&&(this.head=D),B===this.tail&&(this.tail=R),B.list.length--,B.next=null,B.prev=null,B.list=null,D},c.prototype.unshiftNode=function(B){if(B!==this.head){B.list&&B.list.removeNode(B);var D=this.head;B.list=this,B.next=D,D&&(D.prev=B),this.head=B,this.tail||(this.tail=B),this.length++}},c.prototype.pushNode=function(B){if(B!==this.tail){B.list&&B.list.removeNode(B);var D=this.tail;B.list=this,B.prev=D,D&&(D.next=B),this.tail=B,this.head||(this.head=B),this.length++}},c.prototype.push=function(){for(var B=0,D=arguments.length;B<D;B++)E(this,arguments[B]);return this.length},c.prototype.unshift=function(){for(var B=0,D=arguments.length;B<D;B++)A(this,arguments[B]);return this.length},c.prototype.pop=function(){if(this.tail){var B=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,B}},c.prototype.shift=function(){if(this.head){var B=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,B}},c.prototype.forEach=function(B,D){D=D||this;for(var R=this.head,W=0;R!==null;W++)B.call(D,R.value,W,this),R=R.next},c.prototype.forEachReverse=function(B,D){D=D||this;for(var R=this.tail,W=this.length-1;R!==null;W--)B.call(D,R.value,W,this),R=R.prev},c.prototype.get=function(B){for(var D=0,R=this.head;R!==null&&D<B;D++)R=R.next;if(D===B&&R!==null)return R.value},c.prototype.getReverse=function(B){for(var D=0,R=this.tail;R!==null&&D<B;D++)R=R.prev;if(D===B&&R!==null)return R.value},c.prototype.map=function(B,D){D=D||this;for(var R=new c,W=this.head;W!==null;)R.push(B.call(D,W.value,this)),W=W.next;return R},c.prototype.mapReverse=function(B,D){D=D||this;for(var R=new c,W=this.tail;W!==null;)R.push(B.call(D,W.value,this)),W=W.prev;return R},c.prototype.reduce=function(B,D){var R,W=this.head;if(arguments.length>1)R=D;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");W=this.head.next,R=this.head.value}for(var j=0;W!==null;j++)R=B(R,W.value,j),W=W.next;return R},c.prototype.reduceReverse=function(B,D){var R,W=this.tail;if(arguments.length>1)R=D;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");W=this.tail.prev,R=this.tail.value}for(var j=this.length-1;W!==null;j--)R=B(R,W.value,j),W=W.prev;return R},c.prototype.toArray=function(){for(var B=new Array(this.length),D=0,R=this.head;R!==null;D++)B[D]=R.value,R=R.next;return B},c.prototype.toArrayReverse=function(){for(var B=new Array(this.length),D=0,R=this.tail;R!==null;D++)B[D]=R.value,R=R.prev;return B},c.prototype.slice=function(B,D){(D=D||this.length)<0&&(D+=this.length),(B=B||0)<0&&(B+=this.length);var R=new c;if(D<B||D<0)return R;B<0&&(B=0),D>this.length&&(D=this.length);for(var W=0,j=this.head;j!==null&&W<B;W++)j=j.next;for(;j!==null&&W<D;W++,j=j.next)R.push(j.value);return R},c.prototype.sliceReverse=function(B,D){(D=D||this.length)<0&&(D+=this.length),(B=B||0)<0&&(B+=this.length);var R=new c;if(D<B||D<0)return R;B<0&&(B=0),D>this.length&&(D=this.length);for(var W=this.length,j=this.tail;j!==null&&W>D;W--)j=j.prev;for(;j!==null&&W>B;W--,j=j.prev)R.push(j.value);return R},c.prototype.splice=function(B,D,...R){B>this.length&&(B=this.length-1),B<0&&(B=this.length+B);for(var W=0,j=this.head;j!==null&&W<B;W++)j=j.next;var H=[];for(W=0;j&&W<D;W++)H.push(j.value),j=this.removeNode(j);for(j===null&&(j=this.tail),j!==this.head&&j!==this.tail&&(j=j.prev),W=0;W<R.length;W++)j=S(this,j,R[W]);return H},c.prototype.reverse=function(){for(var B=this.head,D=this.tail,R=B;R!==null;R=R.prev){var W=R.prev;R.prev=R.next,R.next=W}return this.head=D,this.tail=B,this};try{r(333)(c)}catch{}},function(s,a,r){const c=r(334),S=Symbol("max"),E=Symbol("length"),A=Symbol("lengthCalculator"),U=Symbol("allowStale"),B=Symbol("maxAge"),D=Symbol("dispose"),R=Symbol("noDisposeOnSet"),W=Symbol("lruList"),j=Symbol("cache"),H=Symbol("updateAgeOnGet"),I=()=>1,Q=(_e,pe,me)=>{const Ge=_e[j].get(pe);if(Ge){const lt=Ge.value;if(Y(_e,lt)){if(ae(_e,Ge),!_e[U])return}else me&&(_e[H]&&(Ge.value.now=Date.now()),_e[W].unshiftNode(Ge));return lt.value}},Y=(_e,pe)=>{if(!pe||!pe.maxAge&&!_e[B])return!1;const me=Date.now()-pe.now;return pe.maxAge?me>pe.maxAge:_e[B]&&me>_e[B]},q=_e=>{if(_e[E]>_e[S])for(let pe=_e[W].tail;_e[E]>_e[S]&&pe!==null;){const me=pe.prev;ae(_e,pe),pe=me}},ae=(_e,pe)=>{if(pe){const me=pe.value;_e[D]&&_e[D](me.key,me.value),_e[E]-=me.length,_e[j].delete(me.key),_e[W].removeNode(pe)}};class oe{constructor(pe,me,Ge,lt,It){this.key=pe,this.value=me,this.length=Ge,this.now=lt,this.maxAge=It||0}}const ye=(_e,pe,me,Ge)=>{let lt=me.value;Y(_e,lt)&&(ae(_e,me),_e[U]||(lt=void 0)),lt&&pe.call(Ge,lt.value,lt.key,_e)};s.exports=class{constructor(_e){if(typeof _e=="number"&&(_e={max:_e}),_e||(_e={}),_e.max&&(typeof _e.max!="number"||_e.max<0))throw new TypeError("max must be a non-negative number");this[S]=_e.max||1/0;const pe=_e.length||I;if(this[A]=typeof pe!="function"?I:pe,this[U]=_e.stale||!1,_e.maxAge&&typeof _e.maxAge!="number")throw new TypeError("maxAge must be a number");this[B]=_e.maxAge||0,this[D]=_e.dispose,this[R]=_e.noDisposeOnSet||!1,this[H]=_e.updateAgeOnGet||!1,this.reset()}set max(_e){if(typeof _e!="number"||_e<0)throw new TypeError("max must be a non-negative number");this[S]=_e||1/0,q(this)}get max(){return this[S]}set allowStale(_e){this[U]=!!_e}get allowStale(){return this[U]}set maxAge(_e){if(typeof _e!="number")throw new TypeError("maxAge must be a non-negative number");this[B]=_e,q(this)}get maxAge(){return this[B]}set lengthCalculator(_e){typeof _e!="function"&&(_e=I),_e!==this[A]&&(this[A]=_e,this[E]=0,this[W].forEach(pe=>{pe.length=this[A](pe.value,pe.key),this[E]+=pe.length})),q(this)}get lengthCalculator(){return this[A]}get length(){return this[E]}get itemCount(){return this[W].length}rforEach(_e,pe){pe=pe||this;for(let me=this[W].tail;me!==null;){const Ge=me.prev;ye(this,_e,me,pe),me=Ge}}forEach(_e,pe){pe=pe||this;for(let me=this[W].head;me!==null;){const Ge=me.next;ye(this,_e,me,pe),me=Ge}}keys(){return this[W].toArray().map(_e=>_e.key)}values(){return this[W].toArray().map(_e=>_e.value)}reset(){this[D]&&this[W]&&this[W].length&&this[W].forEach(_e=>this[D](_e.key,_e.value)),this[j]=new Map,this[W]=new c,this[E]=0}dump(){return this[W].map(_e=>!Y(this,_e)&&{k:_e.key,v:_e.value,e:_e.now+(_e.maxAge||0)}).toArray().filter(_e=>_e)}dumpLru(){return this[W]}set(_e,pe,me){if((me=me||this[B])&&typeof me!="number")throw new TypeError("maxAge must be a number");const Ge=me?Date.now():0,lt=this[A](pe,_e);if(this[j].has(_e)){if(lt>this[S])return ae(this,this[j].get(_e)),!1;const wt=this[j].get(_e).value;return this[D]&&(this[R]||this[D](_e,wt.value)),wt.now=Ge,wt.maxAge=me,wt.value=pe,this[E]+=lt-wt.length,wt.length=lt,this.get(_e),q(this),!0}const It=new oe(_e,pe,lt,Ge,me);return It.length>this[S]?(this[D]&&this[D](_e,pe),!1):(this[E]+=It.length,this[W].unshift(It),this[j].set(_e,this[W].head),q(this),!0)}has(_e){if(!this[j].has(_e))return!1;const pe=this[j].get(_e).value;return!Y(this,pe)}get(_e){return Q(this,_e,!0)}peek(_e){return Q(this,_e,!1)}pop(){const _e=this[W].tail;return _e?(ae(this,_e),_e.value):null}del(_e){ae(this,this[j].get(_e))}load(_e){this.reset();const pe=Date.now();for(let me=_e.length-1;me>=0;me--){const Ge=_e[me],lt=Ge.e||0;if(lt===0)this.set(Ge.k,Ge.v);else{const It=lt-pe;It>0&&this.set(Ge.k,Ge.v,It)}}}prune(){this[j].forEach((_e,pe)=>Q(this,pe,!1))}}},function(s,a,r){const c=r(32),S=r(89),{re:E,t:A}=r(90);s.exports=(U,B)=>{if(U instanceof c)return U;if(typeof U=="number"&&(U=String(U)),typeof U!="string")return null;let D=null;if((B=B||{}).rtl){let R;for(;(R=E[A.COERCERTL].exec(U))&&(!D||D.index+D[0].length!==U.length);)D&&R.index+R[0].length===D.index+D[0].length||(D=R),E[A.COERCERTL].lastIndex=R.index+R[1].length+R[2].length;E[A.COERCERTL].lastIndex=-1}else D=U.match(E[A.COERCE]);return D===null?null:S(`${D[2]}.${D[3]||"0"}.${D[4]||"0"}`,B)}},function(s,a,r){const c=r(144);s.exports=(S,E)=>S.sort((A,U)=>c(U,A,E))},function(s,a,r){const c=r(144);s.exports=(S,E)=>S.sort((A,U)=>c(A,U,E))},function(s,a,r){const c=r(48);s.exports=(S,E)=>c(S,E,!0)},function(s,a,r){const c=r(48);s.exports=(S,E,A)=>c(E,S,A)},function(s,a,r){const c=r(89);s.exports=(S,E)=>{const A=c(S,E);return A&&A.prerelease.length?A.prerelease:null}},function(s,a,r){const c=r(32);s.exports=(S,E)=>new c(S,E).patch},function(s,a,r){const c=r(32);s.exports=(S,E)=>new c(S,E).minor},function(s,a,r){const c=r(32);s.exports=(S,E)=>new c(S,E).major},function(s,a,r){const c=r(89),S=r(145);s.exports=(E,A)=>{if(S(E,A))return null;{const U=c(E),B=c(A),D=U.prerelease.length||B.prerelease.length,R=D?"pre":"",W=D?"prerelease":"";for(const j in U)if((j==="major"||j==="minor"||j==="patch")&&U[j]!==B[j])return R+j;return W}}},function(s,a,r){const c=r(32);s.exports=(S,E,A,U)=>{typeof A=="string"&&(U=A,A=void 0);try{return new c(S,A).inc(E,U).version}catch{return null}}},function(s,a,r){const c=r(89);s.exports=(S,E)=>{const A=c(S.trim().replace(/^[=v]+/,""),E);return A?A.version:null}},function(s,a,r){const c=r(89);s.exports=(S,E)=>{const A=c(S,E);return A?A.version:null}},function(s,a,r){var c=this&&this.__awaiter||function(R,W,j,H){return new(j||(j=Promise))(function(I,Q){function Y(oe){try{ae(H.next(oe))}catch(ye){Q(ye)}}function q(oe){try{ae(H.throw(oe))}catch(ye){Q(ye)}}function ae(oe){oe.done?I(oe.value):new j(function(ye){ye(oe.value)}).then(Y,q)}ae((H=H.apply(R,W||[])).next())})},S=this&&this.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};Object.defineProperty(a,"__esModule",{value:!0});const E=S(r(88)),A=r(64),U=r(46);a.barchart=function(R,W,j={}){return c(this,void 0,void 0,function*(){const H=U.getDrawArea(R),I=W,Q=Object.assign({},B,j);if(D.has(H)){const lt=D.get(H);if(U.shallowEquals(Q,lt.lastOptions)){yield U.nextFrame();const It=lt.view,wt=It.changeset().remove(()=>!0).insert(I);return void(yield It.change("values",wt).runAsync())}}const{xLabel:Y,yLabel:q,xType:ae,yType:oe}=Q;let ye=null;Y!=null&&(ye={title:Y});let _e,pe=null;q!=null&&(pe={title:q}),_e=Q.color!=null?Array.isArray(Q.color)?{field:"index",type:"nominal",scale:{range:Q.color}}:{value:Q.color}:{value:"#4C78A0"};const me={width:Q.width||A.getDefaultWidth(H),height:Q.height||A.getDefaultHeight(H),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:Q.fontSize,titleFontSize:Q.fontSize},text:{fontSize:Q.fontSize},legend:{labelFontSize:Q.fontSize,titleFontSize:Q.fontSize}},data:{values:I,name:"values"},mark:{type:"bar",tooltip:!0},encoding:{x:{field:"index",type:ae,axis:ye},y:{field:"value",type:oe,axis:pe},color:_e}};yield U.nextFrame();const Ge=yield E.default(H,me,{actions:!1,mode:"vega-lite",defaultStyle:!1});D.set(H,{view:Ge.view,lastOptions:Q})})};const B={xLabel:"",yLabel:"",xType:"ordinal",yType:"quantitative",fontSize:11},D=new Map},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(25),S=r(103),E=r(33),A=r(74);function U(B){S.env().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(B+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}a.enableProdMode=function(){S.env().set("PROD",!0)},a.enableDebugMode=function(){S.env().set("DEBUG",!0)},a.disableDeprecationWarnings=function(){S.env().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},a.deprecationWarn=U,E.setDeprecationWarningFn(U),a.disposeVariables=function(){c.ENGINE.disposeVariables()},a.engine=function(){return c.ENGINE},a.memory=function(){return c.ENGINE.memory()},a.profile=function(B){return c.ENGINE.profile(B)},a.tidy=function(B,D){return c.ENGINE.tidy(B,D)},a.dispose=function(B){A.getTensorsInContainer(B).forEach(function(D){return D.dispose()})},a.keep=function(B){return c.ENGINE.keep(B)},a.time=function(B){return c.ENGINE.time(B)},a.setBackend=function(B){return c.ENGINE.setBackend(B)},a.ready=function(){return c.ENGINE.ready()},a.getBackend=function(){return c.ENGINE.backendName},a.removeBackend=function(B){c.ENGINE.removeBackend(B)},a.findBackend=function(B){return c.ENGINE.findBackend(B)},a.findBackendFactory=function(B){return c.ENGINE.findBackendFactory(B)},a.registerBackend=function(B,D,R){return R===void 0&&(R=1),c.ENGINE.registerBackend(B,D,R)},a.backend=function(){return c.ENGINE.backend},a.setPlatform=function(B,D){S.env().setPlatform(B,D)}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(350);a.warnDeprecation=function(){c.deprecationWarn("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")},a.xAs4D=function(S){return S.rank===0||S.rank===1?S.as4D(1,1,1,S.size):S.rank===2?S.as4D(1,1,S.shape[0],S.shape[1]):S.rank===3?S.as4D(1,S.shape[0],S.shape[1],S.shape[2]):S}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(25),S=r(29),E=r(21),A=r(351),U=r(28);function B(R,W,j,H,I,Q){Q==null&&(Q=.001);var Y,q,ae=S.convertToTensor(R,"x","batchNorm"),oe=S.convertToTensor(W,"mean","batchNorm"),ye=S.convertToTensor(j,"variance","batchNorm");I!=null&&(Y=S.convertToTensor(I,"scale","batchNorm")),H!=null&&(q=S.convertToTensor(H,"offset","batchNorm")),E.assert(oe.rank===ye.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),E.assert(q==null||oe.rank===q.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),E.assert(Y==null||oe.rank===Y.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var _e={x:ae,scale:Y,offset:q,mean:oe,variance:ye},pe={varianceEpsilon:Q};return c.ENGINE.runKernelFunc(function(me,Ge){var lt=A.xAs4D(ae),It=me.batchNormalization(lt,D(oe),D(ye),Q,D(Y),D(q));return Ge([ae,oe,ye,Y]),It},_e,null,"FusedBatchNorm",pe).reshape(ae.shape)}function D(R){return R==null?null:R.rank===0?R.as1D():R.rank===1?R:R.rank===2?R.as4D(1,1,R.shape[0],R.shape[1]):R.rank===3?R.as4D(1,R.shape[0],R.shape[1],R.shape[2]):R}a.batchNormalization=U.op({batchNormalization_:function(R,W,j,H,I,Q){return H===void 0&&(H=.001),A.warnDeprecation(),B(R,W,j,Q,I,H)}}),a.batchNorm=U.op({batchNorm_:B})},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(352);r(33).Tensor.prototype.batchNorm=function(S,E,A,U,B){return c.batchNorm(this,S,E,A,U,B)}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(25),S=r(73),E=r(29),A=r(28);a.pad=A.op({pad_:function(U,B,D){D===void 0&&(D=0);var R=E.convertToTensor(U,"x","pad");if(R.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var W={paddings:B,constantValue:D},j={x:R};return c.ENGINE.runKernelFunc(function(H,I){return I([R]),H.pad(R,B,D)},j,null,S.PadV2,W)}})},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(354);r(33).Tensor.prototype.pad=function(S,E){return c.pad(this,S,E)}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(25),S=r(29),E=r(21),A=r(28);a.transpose=A.op({transpose_:function(U,B){var D=S.convertToTensor(U,"x","transpose");if(B==null&&(B=D.shape.map(function(W,j){return j}).reverse()),E.assert(D.rank===B.length,function(){return"Error in transpose: rank of input "+D.rank+" must match length of perm "+B+"."}),B.forEach(function(W){E.assert(W>=0&&W<D.rank,function(){return"All entries in 'perm' must be between 0 and "+(D.rank-1)+" but got "+B})}),D.rank<=1)return D.clone();var R={perm:B};return c.ENGINE.runKernelFunc(function(W){return W.transpose(D,B)},{x:D},null,"Transpose",R)}})},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(356);r(33).Tensor.prototype.transpose=function(S){return c.transpose(this,S)}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(25),S=r(73),E=r(29),A=r(28);a.oneHot=A.op({oneHot_:function(U,B,D,R){if(D===void 0&&(D=1),R===void 0&&(R=0),B<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+B);var W=E.convertToTensor(U,"indices","oneHot","int32"),j=W.shape.concat([B]),H={indices:W=W.flatten()},I={depth:B,onValue:D,offValue:R};return c.ENGINE.runKernelFunc(function(Q,Y){return Y([W]),Q.oneHot(W,B,D,R)},H,null,S.OneHot,I).reshape(j)}})},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(358);r(33).Tensor.prototype.oneHot=function(S,E,A){return E===void 0&&(E=1),A===void 0&&(A=0),c.oneHot(this,S,E,A)}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(25),S=r(73),E=r(29),A=r(21),U=r(28);a.tile=U.op({tile_:function(B,D){var R=E.convertToTensor(B,"x","tile",null);A.assert(R.rank===D.length,function(){return"Error in transpose: rank of input "+R.rank+" must match length of reps "+D+"."});var W=[R],j={x:R},H={reps:D};return c.ENGINE.runKernelFunc(function(I,Q){var Y=I.tile(R,D);return Q([R]),Y},j,null,S.Tile,H,W)}})},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(360);r(33).Tensor.prototype.tile=function(S){return c.tile(this,S)}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(25),S=r(73),E=r(74),A=r(29),U=r(147),B=r(28),D=r(91);a.squaredDifference=B.op({squaredDifference_:function(R,W){var j,H=A.convertToTensor(R,"a","squaredDifference"),I=A.convertToTensor(W,"b","squaredDifference");j=E.makeTypesMatch(H,I),H=j[0],I=j[1],U.assertAndGetBroadcastShape(H.shape,I.shape);var Q={a:H,b:I},Y=[H,I];return c.ENGINE.runKernelFunc(function(q,ae){var oe=q.squaredDifference(H,I);return ae([H,I]),oe},Q,function(q,ae){var oe=ae[0],ye=ae[1],_e=D.scalar(2);return{a:function(){return q.mul(oe.sub(ye).mul(_e))},b:function(){return q.mul(ye.sub(oe).mul(_e))}}},S.SquaredDifference,{},Y,[])}})},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(362);r(33).Tensor.prototype.squaredDifference=function(S){return c.squaredDifference(this,S)}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(21);a.assertParamsConsistent=function(S,E){var A=S[0].length;S.forEach(function(B,D){c.assert(B.length===A,function(){return"Error in concat"+A+"D: rank of tensors["+D+"] must be the same as the rank of the rest ("+A+")"})}),c.assert(E>=0&&E<A,function(){return"Error in concat"+A+"D: axis must be between 0 and "+(A-1)+"."});var U=S[0];S.forEach(function(B,D){for(var R=0;R<A;R++)c.assert(R===E||B[R]===U[R],function(){return"Error in concat"+A+"D: Shape of tensors["+D+"] ("+B+") does not match the shape of the rest ("+U+") along the non-concatenated axis "+D+"."})})},a.computeOutShape=function(S,E){for(var A=S[0].slice(),U=1;U<S.length;U++)A[E]+=S[U][E];return A}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(25),S=r(29),E=r(21),A=r(21),U=r(364),B=r(28),D=r(91);a.concat=B.op({concat_:function(R,W){W===void 0&&(W=0),E.assert(R.length>=1,function(){return"Pass at least one tensor to concat"});var j=S.convertToTensorArray(R,"tensors","concat");j[0].dtype==="complex64"&&j.forEach(function(q){if(q.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+q.dtype+". ")}),W=A.parseAxisParam(W,j[0].shape)[0];var H=U.computeOutShape(j.map(function(q){return q.shape}),W);if(E.sizeFromShape(H)===0)return D.tensor([],H);if((j=j.filter(function(q){return q.size>0})).length===1)return j[0];var I=j.map(function(q){return q.shape});U.assertParamsConsistent(I,W);var Q=j,Y={axis:W};return c.ENGINE.runKernelFunc(function(q){return q.concat(j,W)},Q,function(q){var ae=I.map(function(oe){return oe[W]});return a.split(q,ae,W).map(function(oe){return function(){return oe}})},"Concat",Y)}}),a.concat1d=B.op({concat1d_:function(R){return a.concat(R,0)}}),a.concat2d=B.op({concat2d_:function(R,W){return a.concat(R,W)}}),a.concat3d=B.op({concat3d_:function(R,W){return a.concat(R,W)}}),a.concat4d=B.op({concat4d_:function(R,W){return a.concat(R,W)}}),a.split=B.op({split_:function(R,W,j){j===void 0&&(j=0);var H,I=S.convertToTensor(R,"x","split");return j=A.parseAxisParam(j,I.shape)[0],typeof W=="number"?(E.assert(I.shape[j]%W==0,function(){return"Number of splits must evenly divide the axis."}),H=new Array(W).fill(I.shape[j]/W)):(E.assert(I.shape[j]===W.reduce(function(Q,Y){return Q+Y}),function(){return"The sum of sizes must match the size of the axis dimension."}),H=W),c.ENGINE.runKernelFunc(function(Q){return Q.split(I,H,j)},{$x:I},function(Q){return{$x:function(){return a.concat(Q,j)}}})}})},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(21);function S(A,U){for(var B=0;B<A.length;++B)if(A[A.length-B-1]!==U-1-B)return!1;return!0}function E(A,U,B){for(var D=A.length+U.length,R=[],W=0,j=0,H=0;H<D;H++)B.indexOf(H)===-1?R.push(A[W++]):R.push(U[j++]);return R}a.axesAreInnerMostDims=S,a.combineLocations=E,a.computeOutAndReduceShapes=function(A,U){for(var B=[],D=A.length,R=0;R<D;R++)U.indexOf(R)===-1&&B.push(A[R]);return[B,U.map(function(W){return A[W]})]},a.expandShapeToKeepDim=function(A,U){return E(A,U.map(function(B){return 1}),U)},a.assertAxesAreInnerMostDims=function(A,U,B){c.assert(S(U,B),function(){return A+" supports only inner-most axes for now. Got axes "+U+" and rank-"+B+" input."})},a.getAxesPermutation=function(A,U){if(S(A,U))return null;for(var B=[],D=0;D<U;++D)A.indexOf(D)===-1&&B.push(D);return A.forEach(function(R){return B.push(R)}),B},a.getUndoAxesPermutation=function(A){return A.map(function(U,B){return[B,U]}).sort(function(U,B){return U[1]-B[1]}).map(function(U){return U[0]})},a.getInnerMostAxes=function(A,U){for(var B=[],D=U-A;D<U;++D)B.push(D);return B}},function(s,a,r){var c=this&&this.__awaiter||function(j,H,I,Q){return new(I||(I=Promise))(function(Y,q){function ae(_e){try{ye(Q.next(_e))}catch(pe){q(pe)}}function oe(_e){try{ye(Q.throw(_e))}catch(pe){q(pe)}}function ye(_e){_e.done?Y(_e.value):new I(function(pe){pe(_e.value)}).then(ae,oe)}ye((Q=Q.apply(j,H||[])).next())})},S=this&&this.__generator||function(j,H){var I,Q,Y,q,ae={label:0,sent:function(){if(1&Y[0])throw Y[1];return Y[1]},trys:[],ops:[]};return q={next:oe(0),throw:oe(1),return:oe(2)},typeof Symbol=="function"&&(q[Symbol.iterator]=function(){return this}),q;function oe(ye){return function(_e){return function(pe){if(I)throw new TypeError("Generator is already executing.");for(;ae;)try{if(I=1,Q&&(Y=2&pe[0]?Q.return:pe[0]?Q.throw||((Y=Q.return)&&Y.call(Q),0):Q.next)&&!(Y=Y.call(Q,pe[1])).done)return Y;switch(Q=0,Y&&(pe=[2&pe[0],Y.value]),pe[0]){case 0:case 1:Y=pe;break;case 4:return ae.label++,{value:pe[1],done:!1};case 5:ae.label++,Q=pe[1],pe=[0];continue;case 7:pe=ae.ops.pop(),ae.trys.pop();continue;default:if(!(Y=(Y=ae.trys).length>0&&Y[Y.length-1])&&(pe[0]===6||pe[0]===2)){ae=0;continue}if(pe[0]===3&&(!Y||pe[1]>Y[0]&&pe[1]<Y[3])){ae.label=pe[1];break}if(pe[0]===6&&ae.label<Y[1]){ae.label=Y[1],Y=pe;break}if(Y&&ae.label<Y[2]){ae.label=Y[2],ae.ops.push(pe);break}Y[2]&&ae.ops.pop(),ae.trys.pop();continue}pe=H.call(j,ae)}catch(me){pe=[6,me],Q=0}finally{I=Y=0}if(5&pe[0])throw pe[1];return{value:pe[0]?pe[1]:void 0,done:!0}}([ye,_e])}}};Object.defineProperty(a,"__esModule",{value:!0});var E=r(25),A=r(33),U=r(29),B=r(21),D=r(366),R=r(365),W=r(28);a.buffer=function(j,H,I){return H===void 0&&(H="float32"),H=H||"float32",B.assertNonNegativeIntegerDimensions(j),new A.TensorBuffer(j,H,I)},a.print=function(j,H){H===void 0&&(H=!1),console.log(j.toString(H))},a.batchToSpaceND=W.op({batchToSpaceND_:function(j,H,I){var Q=U.convertToTensor(j,"x","batchToSpaceND"),Y=H.reduce(function(q,ae){return q*ae});return B.assert(Q.rank>=1+H.length,function(){return"input rank is "+Q.rank+" but should be > than blockShape.length "+H.length}),B.assert(I.length===H.length,function(){return"crops.length is "+I.length+" but should be equal to blockShape.length  "+H.length}),B.assert(Q.shape[0]%Y==0,function(){return"input tensor batch is "+Q.shape[0]+" but is not divisible by the product of the elements of blockShape "+H.join(" * ")+" === "+Y}),E.ENGINE.runKernelFunc(function(q){return q.batchToSpaceND(Q,H,I)},{$x:Q},function(q){return{$x:function(){return q.spaceToBatchND(H,I)}}})}}),a.cast=W.op({cast_:function(j,H){var I=U.convertToTensor(j,"x","cast");if(!B.isValidDtype(H))throw new Error("Failed to cast to unknown dtype "+H);if(H==="string"&&I.dtype!=="string"||H!=="string"&&I.dtype==="string")throw new Error("Only strings can be casted to strings");var Q={dtype:H};return E.ENGINE.runKernelFunc(function(Y){return Y.cast(I,H)},{x:I},function(Y){return{x:function(){return Y.clone()}}},"Cast",Q)}}),a.cumsum=W.op({cumsum_:function(j,H,I,Q){H===void 0&&(H=0),I===void 0&&(I=!1),Q===void 0&&(Q=!1);var Y=U.convertToTensor(j,"x","cumsum");H|=0;var q=D.getAxesPermutation([H],Y.rank),ae=Y;q!=null&&(ae=Y.transpose(q));var oe=D.getInnerMostAxes(1,Y.rank)[0],ye=E.ENGINE.runKernelFunc(function(_e){return _e.cumsum(ae,oe,I,Q)},{permutedX:ae},function(_e){return{permutedX:function(){return _e.cumsum(H,I,!Q)}}});return q!=null&&(ye=ye.transpose(q)),ye}}),a.depthToSpace=W.op({depthToSpace_:function(j,H,I){I===void 0&&(I="NHWC");var Q=U.convertToTensor(j,"x","depthToSpace"),Y=I==="NHWC"?Q.shape[1]:Q.shape[2],q=I==="NHWC"?Q.shape[2]:Q.shape[3],ae=I==="NHWC"?Q.shape[3]:Q.shape[1];return B.assert(Y*H>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+Y+" and "+H+`  for depthToSpace with input shape
      `+Q.shape}),B.assert(q*H>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+q+" and "+H+` for depthToSpace with input shape
          `+Q.shape}),B.assert(ae%(H*H)==0,function(){return"Dimension size must be evenly divisible by "+H*H+" but is "+ae+" for depthToSpace with input shape "+Q.shape}),E.ENGINE.runKernelFunc(function(oe){return oe.depthToSpace(Q,H,I)},{$x:Q})}}),a.expandDims=W.op({expandDims_:function(j,H){H===void 0&&(H=0);var I=U.convertToTensor(j,"x","expandDims",null);B.assert(H<=I.rank,function(){return"Axis must be <= rank of the tensor"});var Q=I.shape.slice();return H<0&&(B.assert(-(I.rank+1)<=H,function(){return"Axis must be in the interval ["+-(I.rank+1)+", "+I.rank+"]"}),H=I.rank+H+1),Q.splice(H,0,1),a.reshape(I,Q)}}),a.reshape=W.op({reshape_:function(j,H){var I=U.convertToTensor(j,"x","reshape",null);H=B.inferFromImplicitShape(H,I.size),B.assert(I.size===B.sizeFromShape(H),function(){return"new shape and old shape must have the same number of elements."});var Q={shape:H};return E.ENGINE.runKernelFunc(function(Y){return Y.reshape(I,H)},{x:I},function(Y){return{x:function(){return Y.reshape(I.shape)}}},"Reshape",Q)}}),a.spaceToBatchND=W.op({spaceToBatchND_:function(j,H,I){var Q=U.convertToTensor(j,"x","spaceToBatchND");return B.assert(Q.rank>=1+H.length,function(){return"input rank "+Q.rank+" should be > than [blockShape] "+H.length}),B.assert(I.length===H.length,function(){return"paddings.shape[0] "+I.length+" must be equal to [blockShape] "+H.length}),B.assert(Q.shape.reduce(function(Y,q,ae){return ae>0&&ae<=H.length?Y&&(q+I[ae-1][0]+I[ae-1][1])%H[ae-1]==0:Y},!0),function(){return"input spatial dimensions "+Q.shape.slice(1)+" with paddings "+I.toString()+" must be divisible by blockShapes "+H.toString()}),E.ENGINE.runKernelFunc(function(Y){return Y.spaceToBatchND(Q,H,I)},{$x:Q},function(Y){return{$x:function(){return Y.batchToSpaceND(H,I)}}})}}),a.squeeze=W.op({squeeze_:function(j,H){var I=U.convertToTensor(j,"x","squeeze");return a.reshape(I,B.squeezeShape(I.shape,H).newShape)}}),a.stack=W.op({stack_:function(j,H){H===void 0&&(H=0);var I=U.convertToTensorArray(j,"tensors","stack");if(B.assert(I.length>=1,function(){return"Pass at least one tensor to tf.stack"}),I.length===1)return I[0].expandDims(H);var Q=I[0].rank,Y=I[0].shape,q=I[0].dtype;B.assert(H<=Q,function(){return"Axis must be <= rank of the tensor"}),I.forEach(function(oe){B.assertShapesMatch(Y,oe.shape,"All tensors passed to stack must have matching shapes")}),I.forEach(function(oe){B.assert(q===oe.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var ae=I.map(function(oe){return oe.expandDims(H)});return R.concat(ae,H)}}),a.unstack=W.op({unstack_:function(j,H){H===void 0&&(H=0),H=H||0;var I=U.convertToTensor(j,"x","unstack");B.assert(H>=-I.shape.length&&H<I.shape.length,function(){return"Axis = "+H+" is not in [-"+I.shape.length+", "+I.shape.length+")"}),H<0&&(H+=I.shape.length);var Q={axis:H};return E.ENGINE.runKernelFunc(function(Y){return Y.unstack(I,H)},{x:I},function(Y){return{x:function(){return a.stack(Y,H)}}},"Unpack",Q)}}),a.setdiff1dAsync=function(j,H){return c(this,void 0,void 0,function(){var I,Q,Y,q,ae,oe,ye,_e,pe,me;return S(this,function(Ge){switch(Ge.label){case 0:return I=U.convertToTensor(j,"x","setdiff1d"),Q=U.convertToTensor(H,"y","setdiff1d"),B.assert(I.dtype===Q.dtype,function(){return"x and y should have the same dtype, but got x ("+I.dtype+") and y ("+Q.dtype+")."}),B.assert(I.rank===1,function(){return"x should be 1D tensor, but got x ("+I.shape+")."}),B.assert(Q.rank===1,function(){return"y should be 1D tensor, but got y ("+Q.shape+")."}),[4,I.data()];case 1:return Y=Ge.sent(),[4,Q.data()];case 2:for(q=Ge.sent(),ae=new Set(q),oe=0,pe=0;pe<Y.length;pe++)ae.has(Y[pe])||oe++;for(ye=new A.TensorBuffer([oe],I.dtype),_e=new A.TensorBuffer([oe],"int32"),pe=0,me=0;pe<Y.length;pe++)ae.has(Y[pe])||(ye.values[me]=Y[pe],_e.values[me]=pe,me++);return[2,[ye.toTensor(),_e.toTensor()]]}})})}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(367);a.whereImpl=function(S,E){for(var A=[],U=0;U<E.length;U++)E[U]&&A.push(U);var B=c.buffer(S,"int32"),D=c.buffer([A.length,S.length],"int32");for(U=0;U<A.length;U++){var R=B.indexToLoc(A[U]),W=U*S.length;D.values.set(R,W)}return D.toTensor()}},function(s,a,r){var c=this&&this.__awaiter||function(j,H,I,Q){return new(I||(I=Promise))(function(Y,q){function ae(_e){try{ye(Q.next(_e))}catch(pe){q(pe)}}function oe(_e){try{ye(Q.throw(_e))}catch(pe){q(pe)}}function ye(_e){_e.done?Y(_e.value):new I(function(pe){pe(_e.value)}).then(ae,oe)}ye((Q=Q.apply(j,H||[])).next())})},S=this&&this.__generator||function(j,H){var I,Q,Y,q,ae={label:0,sent:function(){if(1&Y[0])throw Y[1];return Y[1]},trys:[],ops:[]};return q={next:oe(0),throw:oe(1),return:oe(2)},typeof Symbol=="function"&&(q[Symbol.iterator]=function(){return this}),q;function oe(ye){return function(_e){return function(pe){if(I)throw new TypeError("Generator is already executing.");for(;ae;)try{if(I=1,Q&&(Y=2&pe[0]?Q.return:pe[0]?Q.throw||((Y=Q.return)&&Y.call(Q),0):Q.next)&&!(Y=Y.call(Q,pe[1])).done)return Y;switch(Q=0,Y&&(pe=[2&pe[0],Y.value]),pe[0]){case 0:case 1:Y=pe;break;case 4:return ae.label++,{value:pe[1],done:!1};case 5:ae.label++,Q=pe[1],pe=[0];continue;case 7:pe=ae.ops.pop(),ae.trys.pop();continue;default:if(!(Y=(Y=ae.trys).length>0&&Y[Y.length-1])&&(pe[0]===6||pe[0]===2)){ae=0;continue}if(pe[0]===3&&(!Y||pe[1]>Y[0]&&pe[1]<Y[3])){ae.label=pe[1];break}if(pe[0]===6&&ae.label<Y[1]){ae.label=Y[1],Y=pe;break}if(Y&&ae.label<Y[2]){ae.label=Y[2],ae.ops.push(pe);break}Y[2]&&ae.ops.pop(),ae.trys.pop();continue}pe=H.call(j,ae)}catch(me){pe=[6,me],Q=0}finally{I=Y=0}if(5&pe[0])throw pe[1];return{value:pe[0]?pe[1]:void 0,done:!0}}([ye,_e])}}};Object.defineProperty(a,"__esModule",{value:!0});var E=r(368),A=r(25),U=r(29),B=r(21),D=r(147),R=r(28),W=r(91);a.logicalAnd=R.op({logicalAnd_:function(j,H){var I=U.convertToTensor(j,"a","logicalAnd","bool"),Q=U.convertToTensor(H,"b","logicalAnd","bool");return D.assertAndGetBroadcastShape(I.shape,Q.shape),A.ENGINE.runKernelFunc(function(Y){return Y.logicalAnd(I,Q)},{a:I,b:Q},null,"LogicalAnd")}}),a.logicalNot=R.op({logicalNot_:function(j){var H=U.convertToTensor(j,"x","logicalNot","bool");return A.ENGINE.runKernelFunc(function(I){return I.logicalNot(H)},{$x:H})}}),a.logicalOr=R.op({logicalOr_:function(j,H){var I=U.convertToTensor(j,"a","logicalOr","bool"),Q=U.convertToTensor(H,"b","logicalOr","bool");return D.assertAndGetBroadcastShape(I.shape,Q.shape),A.ENGINE.runKernelFunc(function(Y){return Y.logicalOr(I,Q)},{$a:I,$b:Q})}}),a.logicalXor=R.op({logicalXor_:function(j,H){var I=U.convertToTensor(j,"a","logicalXor","bool"),Q=U.convertToTensor(H,"b","logicalXor","bool");return D.assertAndGetBroadcastShape(I.shape,Q.shape),a.logicalOr(j,H).logicalAnd(a.logicalAnd(j,H).logicalNot())}}),a.where=R.op({where_:function(j,H,I){var Q=U.convertToTensor(H,"a","where"),Y=U.convertToTensor(I,"b","where"),q=U.convertToTensor(j,"condition","where","bool");return B.assertShapesMatch(Q.shape,Y.shape,"Error in where: "),q.rank===1?B.assert(q.shape[0]===Q.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):B.assertShapesMatch(q.shape,Y.shape,"Error in where: "),A.ENGINE.runKernelFunc(function(ae,oe){var ye=ae.select(q,Q,Y);return oe([q]),ye},{$condition:q,$a:Q,$b:Y},function(ae,oe){var ye=oe[0];return{$condition:function(){return W.zerosLike(ye).toFloat()},$a:function(){return ae.mul(ye.cast(ae.dtype))},$b:function(){return ae.mul(ye.logicalNot().cast(ae.dtype))}}})}}),a.whereAsync=function(j){return c(this,void 0,void 0,function(){var H,I,Q;return S(this,function(Y){switch(Y.label){case 0:return[4,(H=U.convertToTensor(j,"condition","whereAsync","bool")).data()];case 1:return I=Y.sent(),Q=E.whereImpl(H.shape,I),j!==H&&H.dispose(),[2,Q]}})})}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(74),S=r(29),E=r(205),A=r(369),U=r(28),B=r(91);a.divNoNan=U.op({divNoNan_:function(D,R){var W,j=S.convertToTensor(D,"a","div"),H=S.convertToTensor(R,"b","div");j=(W=c.makeTypesMatch(j,H))[0],H=W[1];var I=E.div(j,H),Q=B.zerosLike(I),Y=H.equal(Q);return A.where(Y,Q,I)}})},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(370);r(33).Tensor.prototype.divNoNan=function(S){return c.divNoNan(this,S)}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(25),S=r(29),E=r(21),A=r(28),U=r(91);a.abs=A.op({abs_:function(B){var D=S.convertToTensor(B,"x","abs");return D.dtype==="complex64"?c.ENGINE.runKernelFunc(function(R){return R.complexAbs(D)},{$x:D}):c.ENGINE.runKernelFunc(function(R,W){var j=R.abs(D);return W([D]),j},{x:D},function(R,W){var j=W[0];return{x:function(){return R.mul(j.toFloat().step(-1))}}},"Abs")}}),a.acos=A.op({acos_:function(B){var D=S.convertToTensor(B,"x","acos");return c.ENGINE.runKernelFunc(function(R,W){var j=R.acos(D);return W([D]),j},{$x:D},function(R,W){var j=W[0];return{$x:function(){return R.divStrict(U.scalar(1).sub(j.toFloat().square()).sqrt()).neg()}}})}}),a.acosh=A.op({acosh_:function(B){var D=S.convertToTensor(B,"x","acosh");return c.ENGINE.runKernelFunc(function(R,W){var j=R.acosh(D);return W([D]),j},{$x:D},function(R,W){var j=W[0];return{$x:function(){return R.divStrict(j.toFloat().square().sub(1).sqrt())}}})}}),a.asin=A.op({asin_:function(B){var D=S.convertToTensor(B,"x","asin");return c.ENGINE.runKernelFunc(function(R,W){var j=R.asin(D);return W([D]),j},{$x:D},function(R,W){var j=W[0];return{$x:function(){return R.divStrict(U.scalar(1).sub(j.toFloat().square()).sqrt())}}})}}),a.asinh=A.op({asinh_:function(B){var D=S.convertToTensor(B,"x","asinh");return c.ENGINE.runKernelFunc(function(R,W){var j=R.asinh(D);return W([D]),j},{$x:D},function(R,W){var j=W[0];return{$x:function(){return R.divStrict(U.scalar(1).add(j.toFloat().square()).sqrt())}}})}}),a.atan=A.op({atan_:function(B){var D=S.convertToTensor(B,"x","atan");return c.ENGINE.runKernelFunc(function(R,W){var j=R.atan(D);return W([D]),j},{$x:D},function(R,W){var j=W[0];return{$x:function(){return R.div(j.toFloat().square().add(1))}}})}}),a.atanh=A.op({atanh_:function(B){var D=S.convertToTensor(B,"x","atanh");return c.ENGINE.runKernelFunc(function(R,W){var j=R.atanh(D);return W([D]),j},{$x:D},function(R,W){var j=W[0];return{$x:function(){return R.div(U.scalar(1).sub(j.toFloat().square()))}}})}}),a.ceil=A.op({ceil_:function(B){var D=S.convertToTensor(B,"x","ceil");return c.ENGINE.runKernelFunc(function(R){return R.ceil(D)},{$x:D},function(R){return{$x:function(){return U.zerosLike(R)}}})}}),a.clipByValue=A.op({clipByValue_:function(B,D,R){var W=S.convertToTensor(B,"x","clipByValue");E.assert(D<=R,function(){return"Error in clip: min ("+D+") must be less than or equal to max ("+R+")."});var j=[W],H={min:D,max:R};return c.ENGINE.runKernelFunc(function(I,Q){var Y=I.clip(W,D,R);return Q([W]),Y},{x:W},function(I,Q){var Y=Q[0];return{x:function(){return I.where(Y.greaterEqual(D).logicalAnd(Y.lessEqual(R)),U.zerosLike(I))}}},"ClipByValue",H,j)}}),a.cos=A.op({cos_:function(B){var D=S.convertToTensor(B,"x","cos"),R=[D];return c.ENGINE.runKernelFunc(function(W,j){var H=W.cos(D);return j([D]),H},{x:D},function(W,j){var H=j[0];return{x:function(){return H.toFloat().sin().neg().mul(W)}}},"Cos",{},R)}}),a.cosh=A.op({cosh_:function(B){var D=S.convertToTensor(B,"x","cosh");return c.ENGINE.runKernelFunc(function(R,W){var j=R.cosh(D);return W([D]),j},{$x:D},function(R,W){var j=W[0];return{$x:function(){return j.toFloat().sinh().mulStrict(R)}}})}}),a.erf=A.op({erf_:function(B){var D=S.convertToTensor(B,"x","erf");return E.assert(D.dtype==="int32"||D.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),D.dtype==="int32"&&(D=D.toFloat()),c.ENGINE.runKernelFunc(function(R,W){var j=R.erf(D);return W([D]),j},{$x:D},function(R,W){var j=W[0];return{$x:function(){return R.mul(j.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),a.exp=A.op({exp_:function(B){var D=S.convertToTensor(B,"x","exp");return c.ENGINE.runKernelFunc(function(R,W){var j=R.exp(D);return W([j]),j},{x:D},function(R,W){return{x:function(){return R.mulStrict(W[0])}}},"Exp",{},[],[!0])}}),a.expm1=A.op({expm1_:function(B){var D=S.convertToTensor(B,"x","expm1");return c.ENGINE.runKernelFunc(function(R,W){var j=R.expm1(D);return W([D]),j},{$x:D},function(R,W){var j=W[0];return{$x:function(){return R.mul(j.exp())}}})}}),a.floor=A.op({floor_:function(B){var D=S.convertToTensor(B,"x","floor");return c.ENGINE.runKernelFunc(function(R){return R.floor(D)},{$x:D},function(R){return{$x:function(){return U.zerosLike(R)}}})}}),a.log=A.op({log_:function(B){var D=S.convertToTensor(B,"x","log"),R=[D];return c.ENGINE.runKernelFunc(function(W,j){var H=W.log(D);return j([D]),H},{x:D},function(W,j){var H=j[0];return{x:function(){return W.div(H.toFloat())}}},"Log",{},R)}}),a.log1p=A.op({log1p_:function(B){var D=S.convertToTensor(B,"x","log1p");return c.ENGINE.runKernelFunc(function(R,W){var j=R.log1p(D);return W([D]),j},{$x:D},function(R,W){var j=W[0];return{$x:function(){return R.div(j.add(1))}}})}}),a.logSigmoid=A.op({logSigmoid_:function(B){var D=S.convertToTensor(B,"x","logSigmoid");return c.ENGINE.runKernelFunc(function(R,W){var j=R.softplus(D.neg()).neg();return W([D]),j},{$x:D},function(R,W){var j=W[0];return{$x:function(){return R.mul(j.neg().sigmoid())}}})}}),a.neg=A.op({neg_:function(B){var D=S.convertToTensor(B,"x","neg"),R=[D];return c.ENGINE.runKernelFunc(function(W){return W.neg(D)},{x:D},function(W){return{x:function(){return W.neg()}}},"Neg",{},R)}}),a.reciprocal=A.op({reciprocal_:function(B){var D=S.convertToTensor(B,"x","reciprocal");return c.ENGINE.runKernelFunc(function(R,W){var j=R.reciprocal(D);return W([D]),j},{$x:D},function(R,W){var j=W[0];return{$x:function(){return R.div(j.square().neg())}}})}}),a.round=A.op({round_:function(B){var D=S.convertToTensor(B,"x","round");return c.ENGINE.runKernelFunc(function(R){return R.round(D)},{$x:D},function(R){return{$x:function(){return U.zerosLike(R)}}})}}),a.rsqrt=A.op({rsqrt_:function(B){var D=S.convertToTensor(B,"x","rsqrt"),R=[D];return c.ENGINE.runKernelFunc(function(W,j){var H=W.rsqrt(D);return j([D]),H},{x:D},function(W,j){var H=j[0];return{x:function(){return W.div(H.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},R)}}),a.sigmoid=A.op({sigmoid_:function(B){var D=S.convertToTensor(B,"x","sigmoid");return c.ENGINE.runKernelFunc(function(R,W){var j=R.sigmoid(D);return W([j]),j},{x:D},function(R,W){var j=W[0];return{x:function(){return R.mul(j.mul(U.scalar(1).sub(j)))}}},"Sigmoid")}}),a.sign=A.op({sign_:function(B){var D=S.convertToTensor(B,"x","sign");return c.ENGINE.runKernelFunc(function(R){return R.sign(D)},{$x:D},function(R){return{$x:function(){return U.zerosLike(R)}}})}}),a.isNaN=A.op({isNaN_:function(B){var D=S.convertToTensor(B,"x","isNaN");return c.ENGINE.runKernelFunc(function(R){return R.isNaN(D)},{$x:D},function(R){return{$x:function(){return U.zerosLike(R)}}})}}),a.isInf=A.op({isInf_:function(B){var D=S.convertToTensor(B,"x","isInf");return c.ENGINE.runKernelFunc(function(R){return R.isInf(D)},{$x:D},function(R){return{$x:function(){return U.zerosLike(R)}}})}}),a.isFinite=A.op({isFinite_:function(B){var D=S.convertToTensor(B,"x","isFinite");return c.ENGINE.runKernelFunc(function(R){return R.isFinite(D)},{$x:D},function(R){return{$x:function(){return U.zerosLike(R)}}})}}),a.sin=A.op({sin_:function(B){var D=S.convertToTensor(B,"x","sin"),R=[D];return c.ENGINE.runKernelFunc(function(W,j){var H=W.sin(D);return j([D]),H},{x:D},function(W,j){var H=j[0];return{x:function(){return H.toFloat().cos().mul(W)}}},"Sin",{},R)}}),a.sinh=A.op({sinh_:function(B){var D=S.convertToTensor(B,"x","sinh");return c.ENGINE.runKernelFunc(function(R,W){var j=R.sinh(D);return W([D]),j},{$x:D},function(R,W){var j=W[0];return{$x:function(){return j.toFloat().cosh().mulStrict(R)}}})}}),a.softplus=A.op({softplus_:function(B){var D=S.convertToTensor(B,"x","softplus");return c.ENGINE.runKernelFunc(function(R,W){var j=R.softplus(D);return W([D]),j},{$x:D},function(R,W){var j=W[0];return{$x:function(){return R.mul(j.sigmoid())}}})}}),a.sqrt=A.op({sqrt_:function(B){var D=S.convertToTensor(B,"x","sqrt");return c.ENGINE.runKernelFunc(function(R,W){var j=R.sqrt(D);return W([D]),j},{$x:D},function(R,W){var j=W[0];return{$x:function(){return R.div(j.toFloat().sqrt().mul(2))}}})}}),a.step=A.op({step_:function(B,D){D===void 0&&(D=0);var R=S.convertToTensor(B,"x","step");return c.ENGINE.runKernelFunc(function(W){return W.step(R,D)},{$x:R},function(W){return{$x:function(){return U.zerosLike(W)}}})}}),a.tan=A.op({tan_:function(B){var D=S.convertToTensor(B,"x","tan");return c.ENGINE.runKernelFunc(function(R,W){var j=R.tan(D);return W([D]),j},{$x:D},function(R,W){var j=W[0];return{$x:function(){return R.div(j.cos().square())}}})}}),a.tanh=A.op({tanh_:function(B){var D=S.convertToTensor(B,"x","tanh");return c.ENGINE.runKernelFunc(function(R,W){var j=R.tanh(D);return W([j]),j},{x:D},function(R,W){var j=W[0];return{x:function(){return U.scalar(1).sub(j.square()).mulStrict(R)}}},"Tanh",{},null,[!0])}})},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(25),S=r(29),E=r(21),A=r(28);a.complex=A.op({complex_:function(U,B){var D=S.convertToTensor(U,"real","complex"),R=S.convertToTensor(B,"imag","complex");return E.assertShapesMatch(D.shape,R.shape,"real and imag shapes, "+D.shape+" and "+R.shape+", must match in call to tf.complex()."),c.ENGINE.runKernelFunc(function(W){return W.complex(D,R)},{$real:D,$imag:R})}}),a.real=A.op({real_:function(U){var B=S.convertToTensor(U,"input","real");return c.ENGINE.runKernelFunc(function(D){return D.real(B)},{$input:B})}}),a.imag=A.op({imag_:function(U){var B=S.convertToTensor(U,"input","imag");return c.ENGINE.runKernelFunc(function(D){return D.imag(B)},{$input:B})}})},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(25),S=r(74),E=r(29),A=r(21),U=r(206),B=r(147),D=r(28),R=r(91),W=r(372);a.addStrict=D.op({addStrict_:function(j,H){var I=E.convertToTensor(j,"a","addStrict"),Q=E.convertToTensor(H,"b","addStrict");return A.assertShapesMatch(I.shape,Q.shape,"Error in addStrict: "),I.add(Q)}}),a.atan2=D.op({atan2_:function(j,H){var I,Q=E.convertToTensor(j,"a","atan2"),Y=E.convertToTensor(H,"b","atan2");I=S.makeTypesMatch(Q,Y),Q=I[0],Y=I[1];var q=B.assertAndGetBroadcastShape(Q.shape,Y.shape);return c.ENGINE.runKernelFunc(function(ae,oe){var ye=ae.atan2(Q,Y);return oe([Q,Y]),ye},{$a:Q,$b:Y},function(ae,oe){var ye=oe[0],_e=oe[1];return{$a:function(){var pe=U.add(ye.square(),_e.square()),me=ae.mul(_e.div(pe)),Ge=B.getReductionAxes(ye.shape,q);return Ge.length>0&&(me=me.sum(Ge)),me.reshape(ye.shape)},$b:function(){var pe=U.add(ye.square(),_e.square()),me=W.neg(ae.mul(ye.div(pe))),Ge=B.getReductionAxes(_e.shape,q);return Ge.length>0&&(me=me.sum(Ge)),me.reshape(_e.shape)}}})}}),a.divStrict=D.op({divStrict_:function(j,H){var I=E.convertToTensor(j,"a","div"),Q=E.convertToTensor(H,"b","div");return A.assertShapesMatch(I.shape,Q.shape,"Error in divideStrict: "),I.div(Q)}}),a.floorDiv=D.op({floorDiv_:function(j,H){var I,Q=E.convertToTensor(j,"a","floorDiv"),Y=E.convertToTensor(H,"b","floorDiv");I=S.makeTypesMatch(Q,Y),Q=I[0],Y=I[1];var q=B.assertAndGetBroadcastShape(Q.shape,Y.shape);return c.ENGINE.runKernelFunc(function(ae,oe){var ye=ae.floorDiv(Q,Y);return oe([Q,Y]),ye},{a:Q,b:Y},function(ae,oe){var ye=oe[0],_e=oe[1];return{a:function(){var pe=ae.div(_e.toFloat()),me=B.getReductionAxes(ye.shape,q);return me.length>0?pe.sum(me).reshape(ye.shape):pe},b:function(){var pe=ae.mul(ye.toFloat()),me=B.getReductionAxes(_e.shape,q);me.length>0&&(pe=pe.sum(me).reshape(_e.shape));var Ge=_e.square();return pe.div(Ge.toFloat()).neg()}}},"FloorDiv")}}),a.maximum=D.op({maximum_:function(j,H){var I,Q=E.convertToTensor(j,"a","maximum"),Y=E.convertToTensor(H,"b","maximum");return I=S.makeTypesMatch(Q,Y),Q=I[0],Y=I[1],Q.dtype==="bool"&&(Q=Q.toInt(),Y=Y.toInt()),B.assertAndGetBroadcastShape(Q.shape,Y.shape),c.ENGINE.runKernelFunc(function(q,ae){var oe=q.maximum(Q,Y);return ae([Q,Y]),oe},{a:Q,b:Y},function(q,ae){var oe=ae[0],ye=ae[1];return{a:function(){return q.mul(oe.greaterEqual(ye).toFloat())},b:function(){return q.mul(oe.less(ye).toFloat())}}},"Maximum")}}),a.maximumStrict=D.op({maximumStrict_:function(j,H){var I=E.convertToTensor(j,"a","maximumStrict"),Q=E.convertToTensor(H,"b","maximumStrict");return A.assertShapesMatch(I.shape,Q.shape,"Error in maximumStrict: "),I.maximum(Q)}}),a.minimum=D.op({minimum_:function(j,H){var I,Q=E.convertToTensor(j,"a","minimum"),Y=E.convertToTensor(H,"b","minimum");return I=S.makeTypesMatch(Q,Y),Q=I[0],Y=I[1],Q.dtype==="bool"&&(Q=Q.toInt(),Y=Y.toInt()),B.assertAndGetBroadcastShape(Q.shape,Y.shape),c.ENGINE.runKernelFunc(function(q,ae){var oe=q.minimum(Q,Y);return ae([Q,Y]),oe},{a:Q,b:Y},function(q,ae){var oe=ae[0],ye=ae[1];return{a:function(){return q.mul(oe.lessEqual(ye).toFloat())},b:function(){return q.mul(oe.greater(ye).toFloat())}}},"Minimum")}}),a.minimumStrict=D.op({minimumStrict_:function(j,H){var I=E.convertToTensor(j,"a","minimumStrict"),Q=E.convertToTensor(H,"b","minimumStrict");return A.assertShapesMatch(I.shape,Q.shape,"Error in minimumStrict: "),I.minimum(Q)}}),a.mod=D.op({mod_:function(j,H){var I,Q=E.convertToTensor(j,"a","mod"),Y=E.convertToTensor(H,"b","mod");I=S.makeTypesMatch(Q,Y),Q=I[0],Y=I[1];var q=B.assertAndGetBroadcastShape(Q.shape,Y.shape);return c.ENGINE.runKernelFunc(function(ae,oe){var ye=ae.mod(Q,Y);return oe([Q,Y]),ye},{$a:Q,$b:Y},function(ae,oe){var ye=oe[0],_e=oe[1];return{$a:function(){var pe=B.getReductionAxes(ye.shape,q);return pe.length>0?ae.sum(pe).reshape(ye.shape):ae},$b:function(){var pe=ae.mul(ye.div(_e).floor().neg()),me=B.getReductionAxes(_e.shape,q);return me.length>0?pe.sum(me).reshape(_e.shape):pe}}})}}),a.modStrict=D.op({modStrict_:function(j,H){var I=E.convertToTensor(j,"a","modStrict"),Q=E.convertToTensor(H,"b","modStrict");return A.assertShapesMatch(I.shape,Q.shape,"Error in modStrict: "),I.mod(Q)}}),a.mul=D.op({mul_:function(j,H){var I,Q=E.convertToTensor(j,"a","mul"),Y=E.convertToTensor(H,"b","mul");I=S.makeTypesMatch(Q,Y),Q=I[0],Y=I[1];var q=B.assertAndGetBroadcastShape(Q.shape,Y.shape);return c.ENGINE.runKernelFunc(function(ae,oe){var ye=ae.multiply(Q,Y);return oe([Q,Y]),ye},{a:Q,b:Y},function(ae,oe){var ye=oe[0],_e=oe[1];return{a:function(){var pe=ae.mul(_e.toFloat()),me=B.getReductionAxes(ye.shape,q);return me.length>0?pe.sum(me).reshape(ye.shape):pe},b:function(){var pe=ae.mul(ye.toFloat()),me=B.getReductionAxes(_e.shape,q);return me.length>0?pe.sum(me).reshape(_e.shape):pe}}},"Mul")}}),a.mulStrict=D.op({mulStrict_:function(j,H){var I=E.convertToTensor(j,"a","mul"),Q=E.convertToTensor(H,"b","mul");return A.assertShapesMatch(I.shape,Q.shape,"Error in multiplyStrict: "),I.mul(Q)}}),a.pow=D.op({pow_:function(j,H){var I,Q=E.convertToTensor(j,"base","pow"),Y=E.convertToTensor(H,"exp","pow");I=S.makeTypesMatch(Q,Y),Q=I[0],Y=I[1];var q=B.assertAndGetBroadcastShape(Q.shape,Y.shape),ae=[Q,Y];return c.ENGINE.runKernelFunc(function(oe,ye){var _e=oe.pow(Q,Y);return ye([Q,Y,_e]),_e},{a:Q,b:Y},function(oe,ye){var _e=ye[0],pe=ye[1],me=ye[2];return{a:function(){var Ge=pe.toFloat(),lt=oe.mul(Ge.mul(_e.pow(Ge.sub(R.scalar(1))))),It=B.getReductionAxes(_e.shape,q);return It.length>0&&(lt=lt.sum(It)),lt.reshape(_e.shape)},b:function(){var Ge=_e.greater(0),lt=_e.log().where(Ge,R.zerosLike(_e)),It=oe.mul(me.mul(lt)),wt=B.getReductionAxes(pe.shape,q);return wt.length>0&&(It=It.sum(wt)),It.reshape(pe.shape)}}},"Pow",{},ae,[!0])}}),a.powStrict=D.op({powStrict_:function(j,H){return A.assertShapesMatch(j.shape,H.shape,"Error in powStrict: "),j.pow(H)}}),a.squaredDifferenceStrict=D.op({squaredDifferenceStrict_:function(j,H){var I=E.convertToTensor(j,"a","squaredDifferenceStrict"),Q=E.convertToTensor(H,"b","squaredDifferenceStrict");return A.assertShapesMatch(I.shape,Q.shape,"Error in squaredDifferenceStrict: "),I.squaredDifference(Q)}}),a.sub=D.op({sub_:function(j,H){var I,Q=E.convertToTensor(j,"a","sub"),Y=E.convertToTensor(H,"b","sub");I=S.makeTypesMatch(Q,Y),Q=I[0],Y=I[1];var q=B.assertAndGetBroadcastShape(Q.shape,Y.shape);return c.ENGINE.runKernelFunc(function(ae){return ae.subtract(Q,Y)},{a:Q,b:Y},function(ae){return{a:function(){var oe=ae,ye=B.getReductionAxes(Q.shape,q);return ye.length>0&&(oe=oe.sum(ye)),oe.reshape(Q.shape)},b:function(){var oe=ae,ye=B.getReductionAxes(Y.shape,q);return ye.length>0&&(oe=oe.sum(ye)),oe.neg().reshape(Y.shape)}}},"Sub")}}),a.subStrict=D.op({subStrict_:function(j,H){var I=E.convertToTensor(j,"a","subStrict"),Q=E.convertToTensor(H,"b","subStrict");return A.assertShapesMatch(I.shape,Q.shape,"Error in subStrict: "),I.sub(Q)}})},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(205);r(33).Tensor.prototype.div=function(S){return c.div(this,S)}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(25),S=r(73),E=r(29),A=r(28);a.broadcastTo=A.op({broadcastTo_:function(U,B){var D=E.convertToTensor(U,"broadcastTo","x"),R=D.shape;if(B.some(function(ae){return!(ae>0)||ae%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+B+"].");if(B.length<D.rank)throw new Error("broadcastTo(): shape.length="+B.length+" < input.rank="+D.rank+".");if(B.length>D.rank){for(var W=D.shape.slice();W.length<B.length;)W.unshift(1);D=D.reshape(W)}for(var j=D.shape,H=Array.from(B),I=B.length-1;I>=0;I--)if(j[I]===B[I])H[I]=1;else if(D.shape[I]!==1)throw new Error("broadcastTo(): ["+R+"] cannot be broadcast to ["+B+"].");var Q=H.map(function(ae,oe){return ae>1?oe:-1}).filter(function(ae){return ae>=0});if(Q.length===0)return D.clone();var Y={x:D},q={shape:B,inputShape:j};return c.ENGINE.runKernelFunc(function(ae){return ae.tile(D,H)},Y,function(ae){return{x:function(){return ae.sum(Q,!0)}}},S.BroadcastTo,q)}})},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(376);r(33).Tensor.prototype.broadcastTo=function(S){return c.broadcastTo(this,S)}},function(s,a,r){var c,S,E,A;Object.defineProperty(a,"__esModule",{value:!0}),function(D){D.R0="R0",D.R1="R1",D.R2="R2",D.R3="R3",D.R4="R4",D.R5="R5",D.R6="R6"}(a.Rank||(a.Rank={})),function(D){D.float32="float32",D.int32="int32",D.bool="int32",D.complex64="complex64"}(c||(c={})),function(D){D.float32="float32",D.int32="int32",D.bool="bool",D.complex64="complex64"}(S||(S={})),function(D){D.float32="float32",D.int32="float32",D.bool="float32",D.complex64="complex64"}(E||(E={})),function(D){D.float32="complex64",D.int32="complex64",D.bool="complex64",D.complex64="complex64"}(A||(A={}));var U={float32:E,int32:c,bool:S,complex64:A};function B(D,R){if(D==="string"||R==="string"){if(D==="string"&&R==="string")return"string";throw new Error("Can not upcast "+D+" with "+R)}return U[D][R]}a.upcastType=B,a.sumOutType=function(D){return B(D,"int32")}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(21),S=20,E=3,A=7;function U(R,W,j){var H;return H=Array.isArray(R)?parseFloat(R[0].toFixed(A))+" + "+parseFloat(R[1].toFixed(A))+"j":c.isString(R)?"'"+R+"'":j==="bool"?B(R):parseFloat(R.toFixed(A)).toString(),c.rightPad(H,W)}function B(R){return R===0?"false":"true"}function D(R){for(var W=[],j=0;j<R.length;j+=2)W.push([R[j],R[j+1]]);return W}a.tensorToString=function(R,W,j,H){var I=c.computeStrides(W),Q=function(oe,ye,_e,pe){var me=c.sizeFromShape(ye),Ge=pe[pe.length-1],lt=new Array(Ge).fill(0),It=ye.length,wt=_e==="complex64"?D(oe):oe;if(It>1)for(var we=0;we<me/Ge;we++)for(var yt=we*Ge,Bt=0;Bt<Ge;Bt++)lt[Bt]=Math.max(lt[Bt],U(wt[yt+Bt],0,_e).length);return lt}(R,W,j,I),Y=W.length,q=function oe(ye,_e,pe,me,Ge,lt){lt===void 0&&(lt=!0);var It=pe==="complex64"?2:1,wt=_e[0],we=_e.length;if(we===0){if(pe==="complex64"){var yt=D(ye);return[U(yt[0],0,pe)]}return pe==="bool"?[B(ye[0])]:[ye[0].toString()]}if(we===1){if(wt>S){var Bt=E*It,Ot=Array.from(ye.slice(0,Bt)),ze=Array.from(ye.slice((wt-E)*It,wt*It));return pe==="complex64"&&(Ot=D(Ot),ze=D(ze)),["["+Ot.map(function(an,Ve){return U(an,Ge[Ve],pe)}).join(", ")+", ..., "+ze.map(function(an,Ve){return U(an,Ge[wt-E+Ve],pe)}).join(", ")+"]"]}var Ut=pe==="complex64"?D(ye):Array.from(ye);return["["+Ut.map(function(an,Ve){return U(an,Ge[Ve],pe)}).join(", ")+"]"]}var Ft=_e.slice(1),pt=me.slice(1),vt=me[0]*It,rn=[];if(wt>S){for(var xt=0;xt<E;xt++){var _t=xt*vt,Xt=_t+vt;rn.push.apply(rn,oe(ye.slice(_t,Xt),Ft,pe,pt,Ge,!1))}rn.push("...");for(var xt=wt-E;xt<wt;xt++){var _t=xt*vt,Xt=_t+vt;rn.push.apply(rn,oe(ye.slice(_t,Xt),Ft,pe,pt,Ge,xt===wt-1))}}else for(var xt=0;xt<wt;xt++){var _t=xt*vt,Xt=_t+vt;rn.push.apply(rn,oe(ye.slice(_t,Xt),Ft,pe,pt,Ge,xt===wt-1))}var sn=we===2?",":"";rn[0]="["+rn[0]+sn;for(var xt=1;xt<rn.length-1;xt++)rn[xt]=" "+rn[xt]+sn;for(var kn=`,
`,xt=2;xt<we;xt++)kn+=`
`;return rn[rn.length-1]=" "+rn[rn.length-1]+"]"+(lt?"":kn),rn}(R,W,j,I,Q),ae=["Tensor"];return H&&(ae.push("  dtype: "+j),ae.push("  rank: "+Y),ae.push("  shape: ["+W+"]"),ae.push("  values:")),ae.push(q.map(function(oe){return"    "+oe}).join(`
`)),ae.join(`
`)}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(21);a.getFilteredNodesXToY=function(S,E,A){for(var U={},B={},D=0;D<E.length;D++)U[E[D].id]=!0;for(D=0;D<S.length;D++){var R=(ae=S[D]).inputs;for(var W in R){for(var j=R[W],H=!1,I=0;I<E.length;I++)if(U[j.id]){ae.outputs.forEach(function(pe){return U[pe.id]=!0}),H=!0,B[ae.id]=!0;break}if(H)break}}var Q={};Q[A.id]=!0;var Y={};for(D=S.length-1;D>=0;D--)for(R=(ae=S[D]).inputs,I=0;I<ae.outputs.length;I++)if(Q[ae.outputs[I].id]){for(var W in R)Q[R[W].id]=!0,Y[ae.id]=!0;break}var q=[];for(D=0;D<S.length;D++){var ae;if(B[(ae=S[D]).id]&&Y[ae.id]){var oe={};for(var W in ae.inputs){var ye=ae.inputs[W];U[ye.id]&&(oe[W]=ye)}var _e=Object.assign({},ae);_e.inputs=oe,_e.outputs=ae.outputs,q.push(_e)}}return q},a.backpropagateGradients=function(S,E,A){for(var U=function(D){var R=E[D],W=[];if(R.outputs.forEach(function(Q){var Y=S[Q.id];Y!=null?W.push(Y):W.push(null)}),R.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+R.kernelName+".");var j=R.gradient(W),H=function(Q){if(!(Q in j))throw new Error("Cannot backprop through input "+Q+". Available gradients found: "+Object.keys(j)+".");var Y=A(function(){return j[Q]()});if(Y.dtype!=="float32")throw new Error("Error in gradient for op "+R.kernelName+". The gradient of input "+Q+" must have 'float32' dtype, but has '"+Y.dtype+"'");var q=R.inputs[Q];if(!c.arraysEqual(Y.shape,q.shape))throw new Error("Error in gradient for op "+R.kernelName+". The gradient of input '"+Q+"' has shape '"+Y.shape+"', which does not match the shape of the input '"+q.shape+"'");if(S[q.id]==null)S[q.id]=Y;else{var ae=S[q.id];S[q.id]=ae.add(Y),ae.dispose()}};for(var I in R.inputs)H(I)},B=E.length-1;B>=0;B--)U(B)}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(21),S=function(){function U(B,D){this.backendTimer=B,this.logger=D,D==null&&(this.logger=new A)}return U.prototype.profileKernel=function(B,D,R){var W,j=this,H=this.backendTimer.time(function(){W=R()});return W.forEach(function(I){I.data().then(function(Q){E(Q,I.dtype,B),H.then(function(Y){var q="";Y.getExtraProfileInfo!=null&&(q=Y.getExtraProfileInfo()),j.logger.logKernelProfile(B,I,Q,Y.kernelMs,D,q)})})}),W},U}();function E(U,B,D){if(B!=="float32")return!1;for(var R=0;R<U.length;R++){var W=U[R];if(isNaN(W)||!isFinite(W))return console.warn("Found "+W+" in the result of '"+D+"'"),!0}return!1}a.Profiler=S,a.checkComputationForErrors=E;var A=function(){function U(){}return U.prototype.logKernelProfile=function(B,D,R,W,j,H){var I=typeof W=="number"?c.rightPad(W+"ms",9):W.error,Q=c.rightPad(B,25),Y=D.rank,q=D.size,ae=c.rightPad(D.shape.toString(),14),oe="";for(var ye in j){var _e=j[ye].shape||D.shape,pe=_e.length;oe+=ye+": "+pe+"D "+(pe>0?_e:"")+" "}console.log("%c"+Q+"	%c"+I+"	%c"+Y+"D "+ae+"	%c"+q+"	%c"+oe+"	%c"+H,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},U}();a.Logger=A},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=new Map,S=new Map;function E(A,U){return U+"_"+A}a.getKernel=function(A,U){var B=E(A,U);return c.get(B)},a.getGradient=function(A){return S.get(A)},a.getKernelsForBackend=function(A){for(var U=c.entries(),B=[];;){var D=U.next(),R=D.done,W=D.value;if(R)break;var j=W[0],H=W[1];j.split("_")[0]===A&&B.push(H)}return B},a.registerKernel=function(A){var U=A.kernelName,B=A.backendName,D=E(U,B);if(c.has(D))throw new Error("The kernel '"+U+"' for backend '"+B+"' is already registered");c.set(D,A)},a.registerGradient=function(A){var U=A.kernelName;S.has(U)&&console.warn("Overriding the gradient for '"+U+"'"),S.set(U,A)},a.unregisterKernel=function(A,U){var B=E(A,U);if(!c.has(B))throw new Error("The kernel '"+A+"' for backend '"+U+"' is not registered");c.delete(B)},a.unregisterGradient=function(A){if(!S.has(A))throw new Error("The gradient '"+A+"' for backend is not registered");S.delete(A)}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0});var c=r(206);r(33).Tensor.prototype.add=function(S){return c.add(this,S)}},function(s,a,r){Object.defineProperty(a,"__esModule",{value:!0}),r(383),r(377),r(375),r(371),r(363),r(361),r(359),r(357),r(355),r(353)},function(s,a){},function(s,a){},function(s,a){},function(s,a){},function(s,a){},function(s,a){},function(s,a,r){(function(c,S){(function(E,A){if(!E.setImmediate){var U,B=1,D={},R=!1,W=E.document,j=Object.getPrototypeOf&&Object.getPrototypeOf(E);j=j&&j.setTimeout?j:E,{}.toString.call(E.process)==="[object process]"?U=function(Q){S.nextTick(function(){I(Q)})}:function(){if(E.postMessage&&!E.importScripts){var Q=!0,Y=E.onmessage;return E.onmessage=function(){Q=!1},E.postMessage("","*"),E.onmessage=Y,Q}}()?function(){var Q="setImmediate$"+Math.random()+"$",Y=function(q){q.source===E&&typeof q.data=="string"&&q.data.indexOf(Q)===0&&I(+q.data.slice(Q.length))};E.addEventListener?E.addEventListener("message",Y,!1):E.attachEvent("onmessage",Y),U=function(q){E.postMessage(Q+q,"*")}}():E.MessageChannel?function(){var Q=new MessageChannel;Q.port1.onmessage=function(Y){I(Y.data)},U=function(Y){Q.port2.postMessage(Y)}}():W&&"onreadystatechange"in W.createElement("script")?function(){var Q=W.documentElement;U=function(Y){var q=W.createElement("script");q.onreadystatechange=function(){I(Y),q.onreadystatechange=null,Q.removeChild(q),q=null},Q.appendChild(q)}}():U=function(Q){setTimeout(I,0,Q)},j.setImmediate=function(Q){typeof Q!="function"&&(Q=new Function(""+Q));for(var Y=new Array(arguments.length-1),q=0;q<Y.length;q++)Y[q]=arguments[q+1];var ae={callback:Q,args:Y};return D[B]=ae,U(B),B++},j.clearImmediate=H}function H(Q){delete D[Q]}function I(Q){if(R)setTimeout(I,0,Q);else{var Y=D[Q];if(Y){R=!0;try{(function(q){var ae=q.callback,oe=q.args;switch(oe.length){case 0:ae();break;case 1:ae(oe[0]);break;case 2:ae(oe[0],oe[1]);break;case 3:ae(oe[0],oe[1],oe[2]);break;default:ae.apply(A,oe)}})(Y)}finally{H(Q),R=!1}}}}})(typeof self>"u"?c===void 0?this:c:self)}).call(this,r(59),r(75))},function(s,a){var r={}.toString;s.exports=Array.isArray||function(c){return r.call(c)=="[object Array]"}},function(s,a){a.read=function(r,c,S,E,A){var U,B,D=8*A-E-1,R=(1<<D)-1,W=R>>1,j=-7,H=S?A-1:0,I=S?-1:1,Q=r[c+H];for(H+=I,U=Q&(1<<-j)-1,Q>>=-j,j+=D;j>0;U=256*U+r[c+H],H+=I,j-=8);for(B=U&(1<<-j)-1,U>>=-j,j+=E;j>0;B=256*B+r[c+H],H+=I,j-=8);if(U===0)U=1-W;else{if(U===R)return B?NaN:1/0*(Q?-1:1);B+=Math.pow(2,E),U-=W}return(Q?-1:1)*B*Math.pow(2,U-E)},a.write=function(r,c,S,E,A,U){var B,D,R,W=8*U-A-1,j=(1<<W)-1,H=j>>1,I=A===23?Math.pow(2,-24)-Math.pow(2,-77):0,Q=E?0:U-1,Y=E?1:-1,q=c<0||c===0&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(D=isNaN(c)?1:0,B=j):(B=Math.floor(Math.log(c)/Math.LN2),c*(R=Math.pow(2,-B))<1&&(B--,R*=2),(c+=B+H>=1?I/R:I*Math.pow(2,1-H))*R>=2&&(B++,R/=2),B+H>=j?(D=0,B=j):B+H>=1?(D=(c*R-1)*Math.pow(2,A),B+=H):(D=c*Math.pow(2,H-1)*Math.pow(2,A),B=0));A>=8;r[S+Q]=255&D,Q+=Y,D/=256,A-=8);for(B=B<<A|D,W+=A;W>0;r[S+Q]=255&B,Q+=Y,B/=256,W-=8);r[S+Q-Y]|=128*q}},function(s,a,r){a.byteLength=function(j){var H=D(j),I=H[0],Q=H[1];return 3*(I+Q)/4-Q},a.toByteArray=function(j){var H,I,Q=D(j),Y=Q[0],q=Q[1],ae=new E(function(_e,pe,me){return 3*(pe+me)/4-me}(0,Y,q)),oe=0,ye=q>0?Y-4:Y;for(I=0;I<ye;I+=4)H=S[j.charCodeAt(I)]<<18|S[j.charCodeAt(I+1)]<<12|S[j.charCodeAt(I+2)]<<6|S[j.charCodeAt(I+3)],ae[oe++]=H>>16&255,ae[oe++]=H>>8&255,ae[oe++]=255&H;return q===2&&(H=S[j.charCodeAt(I)]<<2|S[j.charCodeAt(I+1)]>>4,ae[oe++]=255&H),q===1&&(H=S[j.charCodeAt(I)]<<10|S[j.charCodeAt(I+1)]<<4|S[j.charCodeAt(I+2)]>>2,ae[oe++]=H>>8&255,ae[oe++]=255&H),ae},a.fromByteArray=function(j){for(var H,I=j.length,Q=I%3,Y=[],q=0,ae=I-Q;q<ae;q+=16383)Y.push(W(j,q,q+16383>ae?ae:q+16383));return Q===1?(H=j[I-1],Y.push(c[H>>2]+c[H<<4&63]+"==")):Q===2&&(H=(j[I-2]<<8)+j[I-1],Y.push(c[H>>10]+c[H>>4&63]+c[H<<2&63]+"=")),Y.join("")};for(var c=[],S=[],E=typeof Uint8Array<"u"?Uint8Array:Array,A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",U=0,B=A.length;U<B;++U)c[U]=A[U],S[A.charCodeAt(U)]=U;function D(j){var H=j.length;if(H%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var I=j.indexOf("=");return I===-1&&(I=H),[I,I===H?0:4-I%4]}function R(j){return c[j>>18&63]+c[j>>12&63]+c[j>>6&63]+c[63&j]}function W(j,H,I){for(var Q,Y=[],q=H;q<I;q+=3)Q=(j[q]<<16&16711680)+(j[q+1]<<8&65280)+(255&j[q+2]),Y.push(R(Q));return Y.join("")}S["-".charCodeAt(0)]=62,S["_".charCodeAt(0)]=63},function(s,a){var r={}.hasOwnProperty;s.exports=function(c,S){return r.call(c,S)}},function(s,a){s.exports=function(r,c){return{enumerable:!(1&r),configurable:!(2&r),writable:!(4&r),value:c}}},function(s,a,r){var c=r(149);s.exports=function(S,E){if(!c(S))return S;var A,U;if(E&&typeof(A=S.toString)=="function"&&!c(U=A.call(S))||typeof(A=S.valueOf)=="function"&&!c(U=A.call(S))||!E&&typeof(A=S.toString)=="function"&&!c(U=A.call(S)))return U;throw TypeError("Can't convert object to primitive value")}},function(s,a,r){var c=r(149),S=r(150).document,E=c(S)&&c(S.createElement);s.exports=function(A){return E?S.createElement(A):{}}},function(s,a,r){s.exports=!r(148)&&!r(208)(function(){return Object.defineProperty(r(398)("div"),"a",{get:function(){return 7}}).a!=7})},function(s,a,r){var c=r(149);s.exports=function(S){if(!c(S))throw TypeError(S+" is not an object!");return S}},function(s,a,r){var c=r(400),S=r(399),E=r(397),A=Object.defineProperty;a.f=r(148)?Object.defineProperty:function(U,B,D){if(c(U),B=E(B,!0),c(D),S)try{return A(U,B,D)}catch{}if("get"in D||"set"in D)throw TypeError("Accessors not supported!");return"value"in D&&(U[B]=D.value),U}},function(s,a,r){var c=r(401),S=r(396);s.exports=r(148)?function(E,A,U){return c.f(E,A,S(1,U))}:function(E,A,U){return E[A]=U,E}},function(s,a){s.exports=function(r){if(typeof r!="function")throw TypeError(r+" is not a function!");return r}},function(s,a,r){var c=r(403);s.exports=function(S,E,A){if(c(S),E===void 0)return S;switch(A){case 1:return function(U){return S.call(E,U)};case 2:return function(U,B){return S.call(E,U,B)};case 3:return function(U,B,D){return S.call(E,U,B,D)}}return function(){return S.apply(E,arguments)}}},function(s,a,r){var c=r(150),S=r(209),E=r(404),A=r(402),U=r(395),B=function(D,R,W){var j,H,I,Q=D&B.F,Y=D&B.G,q=D&B.S,ae=D&B.P,oe=D&B.B,ye=D&B.W,_e=Y?S:S[R]||(S[R]={}),pe=_e.prototype,me=Y?c:q?c[R]:(c[R]||{}).prototype;for(j in Y&&(W=R),W)(H=!Q&&me&&me[j]!==void 0)&&U(_e,j)||(I=H?me[j]:W[j],_e[j]=Y&&typeof me[j]!="function"?W[j]:oe&&H?E(I,c):ye&&me[j]==I?function(Ge){var lt=function(It,wt,we){if(this instanceof Ge){switch(arguments.length){case 0:return new Ge;case 1:return new Ge(It);case 2:return new Ge(It,wt)}return new Ge(It,wt,we)}return Ge.apply(this,arguments)};return lt.prototype=Ge.prototype,lt}(I):ae&&typeof I=="function"?E(Function.call,I):I,ae&&((_e.virtual||(_e.virtual={}))[j]=I,D&B.R&&pe&&!pe[j]&&A(pe,j,I)))};B.F=1,B.G=2,B.S=4,B.P=8,B.B=16,B.W=32,B.U=64,B.R=128,s.exports=B},function(s,a,r){var c=r(405);c(c.G,{global:r(150)})},function(s,a,r){r(406),s.exports=r(209).global},function(s,a,r){var c=function(S){var E,A=Object.prototype,U=A.hasOwnProperty,B=typeof Symbol=="function"?Symbol:{},D=B.iterator||"@@iterator",R=B.asyncIterator||"@@asyncIterator",W=B.toStringTag||"@@toStringTag";function j(pt,vt,rn){return Object.defineProperty(pt,vt,{value:rn,enumerable:!0,configurable:!0,writable:!0}),pt[vt]}try{j({},"")}catch{j=function(vt,rn,xt){return vt[rn]=xt}}function H(pt,vt,rn,xt){var _t=vt&&vt.prototype instanceof ye?vt:ye,Xt=Object.create(_t.prototype),sn=new ze(xt||[]);return Xt._invoke=function(kn,an,Ve){var Ye=Q;return function($e,ft){if(Ye===q)throw new Error("Generator is already running");if(Ye===ae){if($e==="throw")throw ft;return Ft()}for(Ve.method=$e,Ve.arg=ft;;){var $t=Ve.delegate;if($t){var Jt=yt($t,Ve);if(Jt){if(Jt===oe)continue;return Jt}}if(Ve.method==="next")Ve.sent=Ve._sent=Ve.arg;else if(Ve.method==="throw"){if(Ye===Q)throw Ye=ae,Ve.arg;Ve.dispatchException(Ve.arg)}else Ve.method==="return"&&Ve.abrupt("return",Ve.arg);Ye=q;var Pn=I(kn,an,Ve);if(Pn.type==="normal"){if(Ye=Ve.done?ae:Y,Pn.arg===oe)continue;return{value:Pn.arg,done:Ve.done}}Pn.type==="throw"&&(Ye=ae,Ve.method="throw",Ve.arg=Pn.arg)}}}(pt,rn,sn),Xt}function I(pt,vt,rn){try{return{type:"normal",arg:pt.call(vt,rn)}}catch(xt){return{type:"throw",arg:xt}}}S.wrap=H;var Q="suspendedStart",Y="suspendedYield",q="executing",ae="completed",oe={};function ye(){}function _e(){}function pe(){}var me={};j(me,D,function(){return this});var Ge=Object.getPrototypeOf,lt=Ge&&Ge(Ge(Ut([])));lt&&lt!==A&&U.call(lt,D)&&(me=lt);var It=pe.prototype=ye.prototype=Object.create(me);function wt(pt){["next","throw","return"].forEach(function(vt){j(pt,vt,function(rn){return this._invoke(vt,rn)})})}function we(pt,vt){var rn;this._invoke=function(xt,_t){function Xt(){return new vt(function(sn,kn){(function an(Ve,Ye,$e,ft){var $t=I(pt[Ve],pt,Ye);if($t.type!=="throw"){var Jt=$t.arg,Pn=Jt.value;return Pn&&typeof Pn=="object"&&U.call(Pn,"__await")?vt.resolve(Pn.__await).then(function(An){an("next",An,$e,ft)},function(An){an("throw",An,$e,ft)}):vt.resolve(Pn).then(function(An){Jt.value=An,$e(Jt)},function(An){return an("throw",An,$e,ft)})}ft($t.arg)})(xt,_t,sn,kn)})}return rn=rn?rn.then(Xt,Xt):Xt()}}function yt(pt,vt){var rn=pt.iterator[vt.method];if(rn===E){if(vt.delegate=null,vt.method==="throw"){if(pt.iterator.return&&(vt.method="return",vt.arg=E,yt(pt,vt),vt.method==="throw"))return oe;vt.method="throw",vt.arg=new TypeError("The iterator does not provide a 'throw' method")}return oe}var xt=I(rn,pt.iterator,vt.arg);if(xt.type==="throw")return vt.method="throw",vt.arg=xt.arg,vt.delegate=null,oe;var _t=xt.arg;return _t?_t.done?(vt[pt.resultName]=_t.value,vt.next=pt.nextLoc,vt.method!=="return"&&(vt.method="next",vt.arg=E),vt.delegate=null,oe):_t:(vt.method="throw",vt.arg=new TypeError("iterator result is not an object"),vt.delegate=null,oe)}function Bt(pt){var vt={tryLoc:pt[0]};1 in pt&&(vt.catchLoc=pt[1]),2 in pt&&(vt.finallyLoc=pt[2],vt.afterLoc=pt[3]),this.tryEntries.push(vt)}function Ot(pt){var vt=pt.completion||{};vt.type="normal",delete vt.arg,pt.completion=vt}function ze(pt){this.tryEntries=[{tryLoc:"root"}],pt.forEach(Bt,this),this.reset(!0)}function Ut(pt){if(pt){var vt=pt[D];if(vt)return vt.call(pt);if(typeof pt.next=="function")return pt;if(!isNaN(pt.length)){var rn=-1,xt=function _t(){for(;++rn<pt.length;)if(U.call(pt,rn))return _t.value=pt[rn],_t.done=!1,_t;return _t.value=E,_t.done=!0,_t};return xt.next=xt}}return{next:Ft}}function Ft(){return{value:E,done:!0}}return _e.prototype=pe,j(It,"constructor",pe),j(pe,"constructor",_e),_e.displayName=j(pe,W,"GeneratorFunction"),S.isGeneratorFunction=function(pt){var vt=typeof pt=="function"&&pt.constructor;return!!vt&&(vt===_e||(vt.displayName||vt.name)==="GeneratorFunction")},S.mark=function(pt){return Object.setPrototypeOf?Object.setPrototypeOf(pt,pe):(pt.__proto__=pe,j(pt,W,"GeneratorFunction")),pt.prototype=Object.create(It),pt},S.awrap=function(pt){return{__await:pt}},wt(we.prototype),j(we.prototype,R,function(){return this}),S.AsyncIterator=we,S.async=function(pt,vt,rn,xt,_t){_t===void 0&&(_t=Promise);var Xt=new we(H(pt,vt,rn,xt),_t);return S.isGeneratorFunction(vt)?Xt:Xt.next().then(function(sn){return sn.done?sn.value:Xt.next()})},wt(It),j(It,W,"Generator"),j(It,D,function(){return this}),j(It,"toString",function(){return"[object Generator]"}),S.keys=function(pt){var vt=[];for(var rn in pt)vt.push(rn);return vt.reverse(),function xt(){for(;vt.length;){var _t=vt.pop();if(_t in pt)return xt.value=_t,xt.done=!1,xt}return xt.done=!0,xt}},S.values=Ut,ze.prototype={constructor:ze,reset:function(pt){if(this.prev=0,this.next=0,this.sent=this._sent=E,this.done=!1,this.delegate=null,this.method="next",this.arg=E,this.tryEntries.forEach(Ot),!pt)for(var vt in this)vt.charAt(0)==="t"&&U.call(this,vt)&&!isNaN(+vt.slice(1))&&(this[vt]=E)},stop:function(){this.done=!0;var pt=this.tryEntries[0].completion;if(pt.type==="throw")throw pt.arg;return this.rval},dispatchException:function(pt){if(this.done)throw pt;var vt=this;function rn(an,Ve){return Xt.type="throw",Xt.arg=pt,vt.next=an,Ve&&(vt.method="next",vt.arg=E),!!Ve}for(var xt=this.tryEntries.length-1;xt>=0;--xt){var _t=this.tryEntries[xt],Xt=_t.completion;if(_t.tryLoc==="root")return rn("end");if(_t.tryLoc<=this.prev){var sn=U.call(_t,"catchLoc"),kn=U.call(_t,"finallyLoc");if(sn&&kn){if(this.prev<_t.catchLoc)return rn(_t.catchLoc,!0);if(this.prev<_t.finallyLoc)return rn(_t.finallyLoc)}else if(sn){if(this.prev<_t.catchLoc)return rn(_t.catchLoc,!0)}else{if(!kn)throw new Error("try statement without catch or finally");if(this.prev<_t.finallyLoc)return rn(_t.finallyLoc)}}}},abrupt:function(pt,vt){for(var rn=this.tryEntries.length-1;rn>=0;--rn){var xt=this.tryEntries[rn];if(xt.tryLoc<=this.prev&&U.call(xt,"finallyLoc")&&this.prev<xt.finallyLoc){var _t=xt;break}}_t&&(pt==="break"||pt==="continue")&&_t.tryLoc<=vt&&vt<=_t.finallyLoc&&(_t=null);var Xt=_t?_t.completion:{};return Xt.type=pt,Xt.arg=vt,_t?(this.method="next",this.next=_t.finallyLoc,oe):this.complete(Xt)},complete:function(pt,vt){if(pt.type==="throw")throw pt.arg;return pt.type==="break"||pt.type==="continue"?this.next=pt.arg:pt.type==="return"?(this.rval=this.arg=pt.arg,this.method="return",this.next="end"):pt.type==="normal"&&vt&&(this.next=vt),oe},finish:function(pt){for(var vt=this.tryEntries.length-1;vt>=0;--vt){var rn=this.tryEntries[vt];if(rn.finallyLoc===pt)return this.complete(rn.completion,rn.afterLoc),Ot(rn),oe}},catch:function(pt){for(var vt=this.tryEntries.length-1;vt>=0;--vt){var rn=this.tryEntries[vt];if(rn.tryLoc===pt){var xt=rn.completion;if(xt.type==="throw"){var _t=xt.arg;Ot(rn)}return _t}}throw new Error("illegal catch attempt")},delegateYield:function(pt,vt,rn){return this.delegate={iterator:Ut(pt),resultName:vt,nextLoc:rn},this.method==="next"&&(this.arg=E),oe}},S}(s.exports);try{regeneratorRuntime=c}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=c:Function("r","regeneratorRuntime = r")(c)}},function(s,a,r){for(var c=r(155),S=r(82),E=r(38),A=r(16),U=r(42),B=r(96),D=r(19),R=D("iterator"),W=D("toStringTag"),j=B.Array,H={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},I=S(H),Q=0;Q<I.length;Q++){var Y,q=I[Q],ae=H[q],oe=A[q],ye=oe&&oe.prototype;if(ye&&(ye[R]||U(ye,R,j),ye[W]||U(ye,W,q),B[q]=j,ae))for(Y in c)ye[Y]||E(ye,Y,c[Y],!0)}},function(s,a,r){var c=r(8),S=r(152);c(c.G+c.B,{setImmediate:S.set,clearImmediate:S.clear})},function(s,a,r){var c=r(16),S=r(8),E=r(120),A=[].slice,U=/MSIE .\./.test(E),B=function(D){return function(R,W){var j=arguments.length>2,H=!!j&&A.call(arguments,2);return D(j?function(){(typeof R=="function"?R:Function(R)).apply(this,H)}:R,W)}};S(S.G+S.B+S.F*U,{setTimeout:B(c.setTimeout),setInterval:B(c.setInterval)})},function(s,a,r){r(411),r(410),r(409),s.exports=r(24)},function(s,a,r){var c=r(8),S=r(24),E=r(16),A=r(104),U=r(216);c(c.P+c.R,"Promise",{finally:function(B){var D=A(this,S.Promise||E.Promise),R=typeof B=="function";return this.then(R?function(W){return U(D,B()).then(function(){return W})}:B,R?function(W){return U(D,B()).then(function(){throw W})}:B)}})},function(s,a,r){r(218),r(413),s.exports=r(24).Promise.finally},function(s,a,r){var c=r(8),S=r(210)(!0);c(c.S,"Object",{entries:function(E){return S(E)}})},function(s,a,r){r(415),s.exports=r(24).Object.entries},function(s,a,r){var c=r(8),S=r(210)(!1);c(c.S,"Object",{values:function(E){return S(E)}})},function(s,a,r){r(417),s.exports=r(24).Object.values},function(s,a,r){var c=r(8),S=r(212),E=r(41),A=r(53),U=r(158);c(c.S,"Object",{getOwnPropertyDescriptors:function(B){for(var D,R,W=E(B),j=A.f,H=S(W),I={},Q=0;H.length>Q;)(R=j(W,D=H[Q++]))!==void 0&&U(I,D,R);return I}})},function(s,a,r){r(419),s.exports=r(24).Object.getOwnPropertyDescriptors},function(s,a,r){r(239)("asyncIterator")},function(s,a,r){r(421),s.exports=r(174).f("asyncIterator")},function(s,a,r){r(97)("trimRight",function(c){return function(){return c(this,2)}},"trimEnd")},function(s,a,r){r(423),s.exports=r(24).String.trimRight},function(s,a,r){r(97)("trimLeft",function(c){return function(){return c(this,1)}},"trimStart")},function(s,a,r){r(425),s.exports=r(24).String.trimLeft},function(s,a,r){var c=r(8),S=r(211),E=r(120),A=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(E);c(c.P+c.F*A,"String",{padEnd:function(U){return S(this,U,arguments.length>1?arguments[1]:void 0,!1)}})},function(s,a,r){r(427),s.exports=r(24).String.padEnd},function(s,a,r){var c=r(8),S=r(211),E=r(120),A=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(E);c(c.P+c.F*A,"String",{padStart:function(U){return S(this,U,arguments.length>1?arguments[1]:void 0,!0)}})},function(s,a,r){r(429),s.exports=r(24).String.padStart},function(s,a,r){var c=r(126),S=r(13),E=r(22),A=r(56),U=r(19)("isConcatSpreadable");s.exports=function B(D,R,W,j,H,I,Q,Y){for(var q,ae,oe=H,ye=0,_e=!!Q&&A(Q,Y,3);ye<j;){if(ye in W){if(q=_e?_e(W[ye],ye,R):W[ye],ae=!1,S(q)&&(ae=(ae=q[U])!==void 0?!!ae:c(q)),ae&&I>0)oe=B(D,R,q,E(q.length),oe,I-1)-1;else{if(oe>=9007199254740991)throw TypeError();D[oe]=q}oe++}ye++}return oe}},function(s,a,r){var c=r(8),S=r(431),E=r(34),A=r(22),U=r(55),B=r(224);c(c.P,"Array",{flatMap:function(D){var R,W,j=E(this);return U(D),R=A(j.length),W=B(j,0),S(W,j,j,R,0,1,D,arguments[1]),W}}),r(77)("flatMap")},function(s,a,r){r(432),s.exports=r(24).Array.flatMap},function(s,a,r){var c=r(8),S=r(128)(!0);c(c.P,"Array",{includes:function(E){return S(this,E,arguments.length>1?arguments[1]:void 0)}}),r(77)("includes")},function(s,a,r){r(434),s.exports=r(24).Array.includes},function(s,a,r){var c=r(8),S=r(170);S&&c(c.S,"Reflect",{setPrototypeOf:function(E,A){S.check(E,A);try{return S.set(E,A),!0}catch{return!1}}})},function(s,a,r){var c=r(26),S=r(53),E=r(78),A=r(43),U=r(8),B=r(85),D=r(14),R=r(13);U(U.S,"Reflect",{set:function W(j,H,I){var Q,Y,q=arguments.length<4?j:arguments[3],ae=S.f(D(j),H);if(!ae){if(R(Y=E(j)))return W(Y,H,I,q);ae=B(0)}if(A(ae,"value")){if(ae.writable===!1||!R(q))return!1;if(Q=S.f(q,H)){if(Q.get||Q.set||Q.writable===!1)return!1;Q.value=I,c.f(q,H,Q)}else c.f(q,H,B(0,I));return!0}return ae.set!==void 0&&(ae.set.call(q,I),!0)}})},function(s,a,r){var c=r(8),S=r(14),E=Object.preventExtensions;c(c.S,"Reflect",{preventExtensions:function(A){S(A);try{return E&&E(A),!0}catch{return!1}}})},function(s,a,r){var c=r(8);c(c.S,"Reflect",{ownKeys:r(212)})},function(s,a,r){var c=r(8),S=r(14),E=Object.isExtensible;c(c.S,"Reflect",{isExtensible:function(A){return S(A),!E||E(A)}})},function(s,a,r){var c=r(8);c(c.S,"Reflect",{has:function(S,E){return E in S}})},function(s,a,r){var c=r(8),S=r(78),E=r(14);c(c.S,"Reflect",{getPrototypeOf:function(A){return S(E(A))}})},function(s,a,r){var c=r(53),S=r(8),E=r(14);S(S.S,"Reflect",{getOwnPropertyDescriptor:function(A,U){return c.f(E(A),U)}})},function(s,a,r){var c=r(53),S=r(78),E=r(43),A=r(8),U=r(13),B=r(14);A(A.S,"Reflect",{get:function D(R,W){var j,H,I=arguments.length<3?R:arguments[2];return B(R)===I?R[W]:(j=c.f(R,W))?E(j,"value")?j.value:j.get!==void 0?j.get.call(I):void 0:U(H=S(R))?D(H,W,I):void 0}})},function(s,a,r){var c=r(8),S=r(14),E=function(A){this._t=S(A),this._i=0;var U,B=this._k=[];for(U in A)B.push(U)};r(226)(E,"Object",function(){var A,U=this._k;do if(this._i>=U.length)return{value:void 0,done:!0};while(!((A=U[this._i++])in this._t));return{value:A,done:!1}}),c(c.S,"Reflect",{enumerate:function(A){return new E(A)}})},function(s,a,r){var c=r(8),S=r(53).f,E=r(14);c(c.S,"Reflect",{deleteProperty:function(A,U){var B=S(E(A),U);return!(B&&!B.configurable)&&delete A[U]}})},function(s,a,r){var c=r(26),S=r(8),E=r(14),A=r(66);S(S.S+S.F*r(15)(function(){Reflect.defineProperty(c.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(U,B,D){E(U),B=A(B,!0),E(D);try{return c.f(U,B,D),!0}catch{return!1}}})},function(s,a,r){var c=r(8),S=r(80),E=r(55),A=r(14),U=r(13),B=r(15),D=r(233),R=(r(16).Reflect||{}).construct,W=B(function(){function H(){}return!(R(function(){},[],H)instanceof H)}),j=!B(function(){R(function(){})});c(c.S+c.F*(W||j),"Reflect",{construct:function(H,I){E(H),A(I);var Q=arguments.length<3?H:E(arguments[2]);if(j&&!W)return R(H,I,Q);if(H==Q){switch(I.length){case 0:return new H;case 1:return new H(I[0]);case 2:return new H(I[0],I[1]);case 3:return new H(I[0],I[1],I[2]);case 4:return new H(I[0],I[1],I[2],I[3])}var Y=[null];return Y.push.apply(Y,I),new(D.apply(H,Y))}var q=Q.prototype,ae=S(U(q)?q:Object.prototype),oe=Function.apply.call(H,ae,I);return U(oe)?oe:ae}})},function(s,a,r){var c=r(8),S=r(55),E=r(14),A=(r(16).Reflect||{}).apply,U=Function.apply;c(c.S+c.F*!r(15)(function(){A(function(){})}),"Reflect",{apply:function(B,D,R){var W=S(B),j=E(R);return A?A(W,D,j):U.call(W,D,j)}})},function(s,a,r){r(60)("Float64",8,function(c){return function(S,E,A){return c(this,S,E,A)}})},function(s,a,r){r(60)("Float32",4,function(c){return function(S,E,A){return c(this,S,E,A)}})},function(s,a,r){r(60)("Uint32",4,function(c){return function(S,E,A){return c(this,S,E,A)}})},function(s,a,r){r(60)("Int32",4,function(c){return function(S,E,A){return c(this,S,E,A)}})},function(s,a,r){r(60)("Uint16",2,function(c){return function(S,E,A){return c(this,S,E,A)}})},function(s,a,r){r(60)("Int16",2,function(c){return function(S,E,A){return c(this,S,E,A)}})},function(s,a,r){r(60)("Uint8",1,function(c){return function(S,E,A){return c(this,S,E,A)}},!0)},function(s,a,r){r(60)("Uint8",1,function(c){return function(S,E,A){return c(this,S,E,A)}})},function(s,a,r){r(60)("Int8",1,function(c){return function(S,E,A){return c(this,S,E,A)}})},function(s,a,r){var c=r(8);c(c.G+c.W+c.F*!r(118).ABV,{DataView:r(151).DataView})},function(s,a,r){var c=r(8),S=r(118),E=r(151),A=r(14),U=r(81),B=r(22),D=r(13),R=r(16).ArrayBuffer,W=r(104),j=E.ArrayBuffer,H=E.DataView,I=S.ABV&&R.isView,Q=j.prototype.slice,Y=S.VIEW;c(c.G+c.W+c.F*(R!==j),{ArrayBuffer:j}),c(c.S+c.F*!S.CONSTR,"ArrayBuffer",{isView:function(q){return I&&I(q)||D(q)&&Y in q}}),c(c.P+c.U+c.F*r(15)(function(){return!new j(2).slice(1,void 0).byteLength}),"ArrayBuffer",{slice:function(q,ae){if(Q!==void 0&&ae===void 0)return Q.call(A(this),q);for(var oe=A(this).byteLength,ye=U(q,oe),_e=U(ae===void 0?oe:ae,oe),pe=new(W(this,j))(B(_e-ye)),me=new H(this),Ge=new H(pe),lt=0;ye<_e;)Ge.setUint8(lt++,me.getUint8(ye++));return pe}}),r(95)("ArrayBuffer")},function(s,a,r){var c=r(214),S=r(76);r(119)("WeakSet",function(E){return function(){return E(this,arguments.length>0?arguments[0]:void 0)}},{add:function(E){return c.def(S(this,"WeakSet"),E,!0)}},c,!1,!0)},function(s,a,r){var c,S=r(16),E=r(51)(0),A=r(38),U=r(65),B=r(235),D=r(214),R=r(13),W=r(76),j=r(76),H=!S.ActiveXObject&&"ActiveXObject"in S,I=U.getWeak,Q=Object.isExtensible,Y=D.ufstore,q=function(ye){return function(){return ye(this,arguments.length>0?arguments[0]:void 0)}},ae={get:function(ye){if(R(ye)){var _e=I(ye);return _e===!0?Y(W(this,"WeakMap")).get(ye):_e?_e[this._i]:void 0}},set:function(ye,_e){return D.def(W(this,"WeakMap"),ye,_e)}},oe=s.exports=r(119)("WeakMap",q,ae,D,!0,!0);j&&H&&(B((c=D.getConstructor(q,"WeakMap")).prototype,ae),U.NEED=!0,E(["delete","has","get","set"],function(ye){var _e=oe.prototype,pe=_e[ye];A(_e,ye,function(me,Ge){if(R(me)&&!Q(me)){this._f||(this._f=new c);var lt=this._f[ye](me,Ge);return ye=="set"?this:lt}return pe.call(this,me,Ge)})}))},function(s,a,r){var c=r(215),S=r(76);s.exports=r(119)("Set",function(E){return function(){return E(this,arguments.length>0?arguments[0]:void 0)}},{add:function(E){return c.def(S(this,"Set"),E=E===0?0:E,E)}},c)},function(s,a,r){var c=r(215),S=r(76);s.exports=r(119)("Map",function(E){return function(){return E(this,arguments.length>0?arguments[0]:void 0)}},{get:function(E){var A=c.getEntry(S(this,"Map"),E);return A&&A.v},set:function(E,A){return c.def(S(this,"Map"),E===0?0:E,A)}},c,!0)},function(s,a){s.exports=function(r){try{return{e:!1,v:r()}}catch(c){return{e:!0,v:c}}}},function(s,a,r){var c=r(16),S=r(152).set,E=c.MutationObserver||c.WebKitMutationObserver,A=c.process,U=c.Promise,B=r(62)(A)=="process";s.exports=function(){var D,R,W,j=function(){var Y,q;for(B&&(Y=A.domain)&&Y.exit();D;){q=D.fn,D=D.next;try{q()}catch(ae){throw D?W():R=void 0,ae}}R=void 0,Y&&Y.enter()};if(B)W=function(){A.nextTick(j)};else if(!E||c.navigator&&c.navigator.standalone)if(U&&U.resolve){var H=U.resolve(void 0);W=function(){H.then(j)}}else W=function(){S.call(c,j)};else{var I=!0,Q=document.createTextNode("");new E(j).observe(Q,{characterData:!0}),W=function(){Q.data=I=!I}}return function(Y){var q={fn:Y,next:void 0};R&&(R.next=q),D||(D=q,W()),R=q}}},function(s,a,r){var c=r(161),S=r(14),E=r(104),A=r(153),U=r(22),B=r(123),D=r(154),R=r(15),W=Math.min,j=[].push,H=!R(function(){});r(122)("split",2,function(I,Q,Y,q){var ae;return ae="abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||".".split(/()()/).length>1||"".split(/.?/).length?function(oe,ye){var _e=String(this);if(oe===void 0&&ye===0)return[];if(!c(oe))return Y.call(_e,oe,ye);for(var pe,me,Ge,lt=[],It=(oe.ignoreCase?"i":"")+(oe.multiline?"m":"")+(oe.unicode?"u":"")+(oe.sticky?"y":""),wt=0,we=ye===void 0?4294967295:ye>>>0,yt=new RegExp(oe.source,It+"g");(pe=D.call(yt,_e))&&!((me=yt.lastIndex)>wt&&(lt.push(_e.slice(wt,pe.index)),pe.length>1&&pe.index<_e.length&&j.apply(lt,pe.slice(1)),Ge=pe[0].length,wt=me,lt.length>=we));)yt.lastIndex===pe.index&&yt.lastIndex++;return wt===_e.length?!Ge&&yt.test("")||lt.push(""):lt.push(_e.slice(wt)),lt.length>we?lt.slice(0,we):lt}:"0".split(void 0,0).length?function(oe,ye){return oe===void 0&&ye===0?[]:Y.call(this,oe,ye)}:Y,[function(oe,ye){var _e=I(this),pe=oe==null?void 0:oe[Q];return pe!==void 0?pe.call(oe,_e,ye):ae.call(String(_e),oe,ye)},function(oe,ye){var _e=q(ae,oe,this,ye,ae!==Y);if(_e.done)return _e.value;var pe=S(oe),me=String(this),Ge=E(pe,RegExp),lt=pe.unicode,It=(pe.ignoreCase?"i":"")+(pe.multiline?"m":"")+(pe.unicode?"u":"")+(H?"y":"g"),wt=new Ge(H?pe:"^(?:"+pe.source+")",It),we=ye===void 0?4294967295:ye>>>0;if(we===0)return[];if(me.length===0)return B(wt,me)===null?[me]:[];for(var yt=0,Bt=0,Ot=[];Bt<me.length;){wt.lastIndex=H?Bt:0;var ze,Ut=B(wt,H?me:me.slice(Bt));if(Ut===null||(ze=W(U(wt.lastIndex+(H?0:Bt)),me.length))===yt)Bt=A(me,Bt,lt);else{if(Ot.push(me.slice(yt,Bt)),Ot.length===we)return Ot;for(var Ft=1;Ft<=Ut.length-1;Ft++)if(Ot.push(Ut[Ft]),Ot.length===we)return Ot;Bt=yt=ze}}return Ot.push(me.slice(yt)),Ot}]})},function(s,a,r){var c=r(14),S=r(234),E=r(123);r(122)("search",1,function(A,U,B,D){return[function(R){var W=A(this),j=R==null?void 0:R[U];return j!==void 0?j.call(R,W):new RegExp(R)[U](String(W))},function(R){var W=D(B,R,this);if(W.done)return W.value;var j=c(R),H=String(this),I=j.lastIndex;S(I,0)||(j.lastIndex=0);var Q=E(j,H);return S(j.lastIndex,I)||(j.lastIndex=I),Q===null?-1:Q.index}]})},function(s,a,r){var c=r(14),S=r(34),E=r(22),A=r(54),U=r(153),B=r(123),D=Math.max,R=Math.min,W=Math.floor,j=/\$([$&`']|\d\d?|<[^>]*>)/g,H=/\$([$&`']|\d\d?)/g,I=function(Q){return Q===void 0?Q:String(Q)};r(122)("replace",2,function(Q,Y,q,ae){return[function(ye,_e){var pe=Q(this),me=ye==null?void 0:ye[Y];return me!==void 0?me.call(ye,pe,_e):q.call(String(pe),ye,_e)},function(ye,_e){var pe=ae(q,ye,this,_e);if(pe.done)return pe.value;var me=c(ye),Ge=String(this),lt=typeof _e=="function";lt||(_e=String(_e));var It=me.global;if(It){var wt=me.unicode;me.lastIndex=0}for(var we=[];;){var yt=B(me,Ge);if(yt===null||(we.push(yt),!It))break;String(yt[0])===""&&(me.lastIndex=U(Ge,E(me.lastIndex),wt))}for(var Bt="",Ot=0,ze=0;ze<we.length;ze++){yt=we[ze];for(var Ut=String(yt[0]),Ft=D(R(A(yt.index),Ge.length),0),pt=[],vt=1;vt<yt.length;vt++)pt.push(I(yt[vt]));var rn=yt.groups;if(lt){var xt=[Ut].concat(pt,Ft,Ge);rn!==void 0&&xt.push(rn);var _t=String(_e.apply(void 0,xt))}else _t=oe(Ut,Ge,Ft,pt,rn,_e);Ft>=Ot&&(Bt+=Ge.slice(Ot,Ft)+_t,Ot=Ft+Ut.length)}return Bt+Ge.slice(Ot)}];function oe(ye,_e,pe,me,Ge,lt){var It=pe+ye.length,wt=me.length,we=H;return Ge!==void 0&&(Ge=S(Ge),we=j),q.call(lt,we,function(yt,Bt){var Ot;switch(Bt.charAt(0)){case"$":return"$";case"&":return ye;case"`":return _e.slice(0,pe);case"'":return _e.slice(It);case"<":Ot=Ge[Bt.slice(1,-1)];break;default:var ze=+Bt;if(ze===0)return yt;if(ze>wt){var Ut=W(ze/10);return Ut===0?yt:Ut<=wt?me[Ut-1]===void 0?Bt.charAt(1):me[Ut-1]+Bt.charAt(1):yt}Ot=me[ze-1]}return Ot===void 0?"":Ot})}})},function(s,a,r){var c=r(14),S=r(22),E=r(153),A=r(123);r(122)("match",1,function(U,B,D,R){return[function(W){var j=U(this),H=W==null?void 0:W[B];return H!==void 0?H.call(W,j):new RegExp(W)[B](String(j))},function(W){var j=R(D,W,this);if(j.done)return j.value;var H=c(W),I=String(this);if(!H.global)return A(H,I);var Q=H.unicode;H.lastIndex=0;for(var Y,q=[],ae=0;(Y=A(H,I))!==null;){var oe=String(Y[0]);q[ae]=oe,oe===""&&(H.lastIndex=E(I,S(H.lastIndex),Q)),ae++}return ae===0?null:q}]})},function(s,a,r){r(219);var c=r(14),S=r(124),E=r(27),A=/./.toString,U=function(B){r(38)(RegExp.prototype,"toString",B,!0)};r(15)(function(){return A.call({source:"a",flags:"b"})!="/a/b"})?U(function(){var B=c(this);return"/".concat(B.source,"/","flags"in B?B.flags:!E&&B instanceof RegExp?S.call(B):void 0)}):A.name!="toString"&&U(function(){return A.call(this)})},function(s,a,r){var c=r(16),S=r(168),E=r(26).f,A=r(79).f,U=r(161),B=r(124),D=c.RegExp,R=D,W=D.prototype,j=/a/g,H=/a/g,I=new D(j)!==j;if(r(27)&&(!I||r(15)(function(){return H[r(19)("match")]=!1,D(j)!=j||D(H)==H||D(j,"i")!="/a/i"}))){D=function(ae,oe){var ye=this instanceof D,_e=U(ae),pe=oe===void 0;return!ye&&_e&&ae.constructor===D&&pe?ae:S(I?new R(_e&&!pe?ae.source:ae,oe):R((_e=ae instanceof D)?ae.source:ae,_e&&pe?B.call(ae):oe),ye?this:W,D)};for(var Q=function(ae){ae in D||E(D,ae,{configurable:!0,get:function(){return R[ae]},set:function(oe){R[ae]=oe}})},Y=A(R),q=0;Y.length>q;)Q(Y[q++]);W.constructor=D,D.prototype=W,r(38)(c,"RegExp",D)}r(95)("RegExp")},function(s,a,r){r(95)("Array")},function(s,a,r){var c=r(8),S=r(51)(6),E="findIndex",A=!0;E in[]&&Array(1)[E](function(){A=!1}),c(c.P+c.F*A,"Array",{findIndex:function(U){return S(this,U,arguments.length>1?arguments[1]:void 0)}}),r(77)(E)},function(s,a,r){var c=r(8),S=r(51)(5),E=!0;"find"in[]&&Array(1).find(function(){E=!1}),c(c.P+c.F*E,"Array",{find:function(A){return S(this,A,arguments.length>1?arguments[1]:void 0)}}),r(77)("find")},function(s,a,r){var c=r(8);c(c.P,"Array",{fill:r(156)}),r(77)("fill")},function(s,a,r){var c=r(8);c(c.P,"Array",{copyWithin:r(222)}),r(77)("copyWithin")},function(s,a,r){var c=r(8),S=r(41),E=r(54),A=r(22),U=[].lastIndexOf,B=!!U&&1/[1].lastIndexOf(1,-0)<0;c(c.P+c.F*(B||!r(49)(U)),"Array",{lastIndexOf:function(D){if(B)return U.apply(this,arguments)||0;var R=S(this),W=A(R.length),j=W-1;for(arguments.length>1&&(j=Math.min(j,E(arguments[1]))),j<0&&(j=W+j);j>=0;j--)if(j in R&&R[j]===D)return j||0;return-1}})},function(s,a,r){var c=r(8),S=r(128)(!1),E=[].indexOf,A=!!E&&1/[1].indexOf(1,-0)<0;c(c.P+c.F*(A||!r(49)(E)),"Array",{indexOf:function(U){return A?E.apply(this,arguments)||0:S(this,U,arguments[1])}})},function(s,a,r){var c=r(8),S=r(223);c(c.P+c.F*!r(49)([].reduceRight,!0),"Array",{reduceRight:function(E){return S(this,E,arguments.length,arguments[1],!0)}})},function(s,a,r){var c=r(8),S=r(223);c(c.P+c.F*!r(49)([].reduce,!0),"Array",{reduce:function(E){return S(this,E,arguments.length,arguments[1],!1)}})},function(s,a,r){var c=r(8),S=r(51)(4);c(c.P+c.F*!r(49)([].every,!0),"Array",{every:function(E){return S(this,E,arguments[1])}})},function(s,a,r){var c=r(8),S=r(51)(3);c(c.P+c.F*!r(49)([].some,!0),"Array",{some:function(E){return S(this,E,arguments[1])}})},function(s,a,r){var c=r(8),S=r(51)(2);c(c.P+c.F*!r(49)([].filter,!0),"Array",{filter:function(E){return S(this,E,arguments[1])}})},function(s,a,r){var c=r(8),S=r(51)(1);c(c.P+c.F*!r(49)([].map,!0),"Array",{map:function(E){return S(this,E,arguments[1])}})},function(s,a,r){var c=r(13),S=r(126),E=r(19)("species");s.exports=function(A){var U;return S(A)&&(typeof(U=A.constructor)!="function"||U!==Array&&!S(U.prototype)||(U=void 0),c(U)&&(U=U[E])===null&&(U=void 0)),U===void 0?Array:U}},function(s,a,r){var c=r(8),S=r(51)(0),E=r(49)([].forEach,!0);c(c.P+c.F*!E,"Array",{forEach:function(A){return S(this,A,arguments[1])}})},function(s,a,r){var c=r(8),S=r(55),E=r(34),A=r(15),U=[].sort,B=[1,2,3];c(c.P+c.F*(A(function(){B.sort(void 0)})||!A(function(){B.sort(null)})||!r(49)(U)),"Array",{sort:function(D){return D===void 0?U.call(E(this)):U.call(E(this),S(D))}})},function(s,a,r){var c=r(8),S=r(171),E=r(62),A=r(81),U=r(22),B=[].slice;c(c.P+c.F*r(15)(function(){S&&B.call(S)}),"Array",{slice:function(D,R){var W=U(this.length),j=E(this);if(R=R===void 0?W:R,j=="Array")return B.call(this,D,R);for(var H=A(D,W),I=A(R,W),Q=U(I-H),Y=new Array(Q),q=0;q<Q;q++)Y[q]=j=="String"?this.charAt(H+q):this[H+q];return Y}})},function(s,a,r){var c=r(8),S=r(41),E=[].join;c(c.P+c.F*(r(107)!=Object||!r(49)(E)),"Array",{join:function(A){return E.call(S(this),A===void 0?",":A)}})},function(s,a,r){var c=r(8),S=r(158);c(c.S+c.F*r(15)(function(){function E(){}return!(Array.of.call(E)instanceof E)}),"Array",{of:function(){for(var E=0,A=arguments.length,U=new(typeof this=="function"?this:Array)(A);A>E;)S(U,E,arguments[E++]);return U.length=A,U}})},function(s,a,r){var c=r(56),S=r(8),E=r(34),A=r(225),U=r(159),B=r(22),D=r(158),R=r(157);S(S.S+S.F*!r(125)(function(W){Array.from(W)}),"Array",{from:function(W){var j,H,I,Q,Y=E(W),q=typeof this=="function"?this:Array,ae=arguments.length,oe=ae>1?arguments[1]:void 0,ye=oe!==void 0,_e=0,pe=R(Y);if(ye&&(oe=c(oe,ae>2?arguments[2]:void 0,2)),pe==null||q==Array&&U(pe))for(H=new q(j=B(Y.length));j>_e;_e++)D(H,_e,ye?oe(Y[_e],_e):Y[_e]);else for(Q=pe.call(Y),H=new q;!(I=Q.next()).done;_e++)D(H,_e,ye?A(Q,oe,[I.value,_e],!0):I.value);return H.length=_e,H}})},function(s,a,r){var c=r(8);c(c.S,"Array",{isArray:r(126)})},function(s,a,r){var c=r(14),S=r(66);s.exports=function(E){if(E!=="string"&&E!=="number"&&E!=="default")throw TypeError("Incorrect hint");return S(c(this),E!="number")}},function(s,a,r){var c=r(19)("toPrimitive"),S=Date.prototype;c in S||r(42)(S,c,r(494))},function(s,a,r){var c=Date.prototype,S=c.toString,E=c.getTime;new Date(NaN)+""!="Invalid Date"&&r(38)(c,"toString",function(){var A=E.call(this);return A==A?S.call(this):"Invalid Date"})},function(s,a,r){var c=r(15),S=Date.prototype.getTime,E=Date.prototype.toISOString,A=function(U){return U>9?U:"0"+U};s.exports=c(function(){return E.call(new Date(-5e13-1))!="0385-07-25T07:06:39.999Z"})||!c(function(){E.call(new Date(NaN))})?function(){if(!isFinite(S.call(this)))throw RangeError("Invalid time value");var U=this,B=U.getUTCFullYear(),D=U.getUTCMilliseconds(),R=B<0?"-":B>9999?"+":"";return R+("00000"+Math.abs(B)).slice(R?-6:-4)+"-"+A(U.getUTCMonth()+1)+"-"+A(U.getUTCDate())+"T"+A(U.getUTCHours())+":"+A(U.getUTCMinutes())+":"+A(U.getUTCSeconds())+"."+(D>99?D:"0"+A(D))+"Z"}:E},function(s,a,r){var c=r(8),S=r(497);c(c.P+c.F*(Date.prototype.toISOString!==S),"Date",{toISOString:S})},function(s,a,r){var c=r(8),S=r(34),E=r(66);c(c.P+c.F*r(15)(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1}),"Date",{toJSON:function(A){var U=S(this),B=E(U);return typeof B!="number"||isFinite(B)?U.toISOString():null}})},function(s,a,r){var c=r(8);c(c.S,"Date",{now:function(){return new Date().getTime()}})},function(s,a,r){r(37)("sup",function(c){return function(){return c(this,"sup","","")}})},function(s,a,r){r(37)("sub",function(c){return function(){return c(this,"sub","","")}})},function(s,a,r){r(37)("strike",function(c){return function(){return c(this,"strike","","")}})},function(s,a,r){r(37)("small",function(c){return function(){return c(this,"small","","")}})},function(s,a,r){r(37)("link",function(c){return function(S){return c(this,"a","href",S)}})},function(s,a,r){r(37)("italics",function(c){return function(){return c(this,"i","","")}})},function(s,a,r){r(37)("fontsize",function(c){return function(S){return c(this,"font","size",S)}})},function(s,a,r){r(37)("fontcolor",function(c){return function(S){return c(this,"font","color",S)}})},function(s,a,r){r(37)("fixed",function(c){return function(){return c(this,"tt","","")}})},function(s,a,r){r(37)("bold",function(c){return function(){return c(this,"b","","")}})},function(s,a,r){r(37)("blink",function(c){return function(){return c(this,"blink","","")}})},function(s,a,r){r(37)("big",function(c){return function(){return c(this,"big","","")}})},function(s,a,r){r(37)("anchor",function(c){return function(S){return c(this,"a","name",S)}})},function(s,a,r){var c=r(8),S=r(22),E=r(162),A="".startsWith;c(c.P+c.F*r(160)("startsWith"),"String",{startsWith:function(U){var B=E(this,U,"startsWith"),D=S(Math.min(arguments.length>1?arguments[1]:void 0,B.length)),R=String(U);return A?A.call(B,R,D):B.slice(D,D+R.length)===R}})},function(s,a,r){var c=r(8);c(c.P,"String",{repeat:r(167)})},function(s,a,r){var c=r(8),S=r(162);c(c.P+c.F*r(160)("includes"),"String",{includes:function(E){return!!~S(this,E,"includes").indexOf(E,arguments.length>1?arguments[1]:void 0)}})},function(s,a,r){var c=r(8),S=r(22),E=r(162),A="".endsWith;c(c.P+c.F*r(160)("endsWith"),"String",{endsWith:function(U){var B=E(this,U,"endsWith"),D=arguments.length>1?arguments[1]:void 0,R=S(B.length),W=D===void 0?R:Math.min(S(D),R),j=String(U);return A?A.call(B,j,W):B.slice(W-j.length,W)===j}})},function(s,a,r){var c=r(8),S=r(164)(!1);c(c.P,"String",{codePointAt:function(E){return S(this,E)}})},function(s,a,r){var c=r(164)(!0);r(163)(String,"String",function(S){this._t=String(S),this._i=0},function(){var S,E=this._t,A=this._i;return A>=E.length?{value:void 0,done:!0}:(S=c(E,A),this._i+=S.length,{value:S,done:!1})})},function(s,a,r){r(97)("trim",function(c){return function(){return c(this,3)}})},function(s,a,r){var c=r(8),S=r(41),E=r(22);c(c.S,"String",{raw:function(A){for(var U=S(A.raw),B=E(U.length),D=arguments.length,R=[],W=0;B>W;)R.push(String(U[W++])),W<D&&R.push(String(arguments[W]));return R.join("")}})},function(s,a,r){var c=r(8),S=r(81),E=String.fromCharCode,A=String.fromCodePoint;c(c.S+c.F*(!!A&&A.length!=1),"String",{fromCodePoint:function(U){for(var B,D=[],R=arguments.length,W=0;R>W;){if(B=+arguments[W++],S(B,1114111)!==B)throw RangeError(B+" is not a valid code point");D.push(B<65536?E(B):E(55296+((B-=65536)>>10),B%1024+56320))}return D.join("")}})},function(s,a,r){var c=r(8);c(c.S,"Math",{trunc:function(S){return(S>0?Math.floor:Math.ceil)(S)}})},function(s,a,r){var c=r(8),S=r(165),E=Math.exp;c(c.S,"Math",{tanh:function(A){var U=S(A=+A),B=S(-A);return U==1/0?1:B==1/0?-1:(U-B)/(E(A)+E(-A))}})},function(s,a,r){var c=r(8),S=r(165),E=Math.exp;c(c.S+c.F*r(15)(function(){return!Math.sinh(-2e-17)!=-2e-17}),"Math",{sinh:function(A){return Math.abs(A=+A)<1?(S(A)-S(-A))/2:(E(A-1)-E(-A-1))*(Math.E/2)}})},function(s,a,r){var c=r(8);c(c.S,"Math",{sign:r(166)})},function(s,a,r){var c=r(8);c(c.S,"Math",{log2:function(S){return Math.log(S)/Math.LN2}})},function(s,a,r){var c=r(8);c(c.S,"Math",{log1p:r(227)})},function(s,a,r){var c=r(8);c(c.S,"Math",{log10:function(S){return Math.log(S)*Math.LOG10E}})},function(s,a,r){var c=r(8),S=Math.imul;c(c.S+c.F*r(15)(function(){return S(4294967295,5)!=-5||S.length!=2}),"Math",{imul:function(E,A){var U=+E,B=+A,D=65535&U,R=65535&B;return 0|D*R+((65535&U>>>16)*R+D*(65535&B>>>16)<<16>>>0)}})},function(s,a,r){var c=r(8),S=Math.abs;c(c.S,"Math",{hypot:function(E,A){for(var U,B,D=0,R=0,W=arguments.length,j=0;R<W;)j<(U=S(arguments[R++]))?(D=D*(B=j/U)*B+1,j=U):D+=U>0?(B=U/j)*B:U;return j===1/0?1/0:j*Math.sqrt(D)}})},function(s,a,r){var c=r(166),S=Math.pow,E=S(2,-52),A=S(2,-23),U=S(2,127)*(2-A),B=S(2,-126);s.exports=Math.fround||function(D){var R,W,j=Math.abs(D),H=c(D);return j<B?H*function(I){return I+1/E-1/E}(j/B/A)*B*A:(W=(R=(1+A/E)*j)-(R-j))>U||W!=W?H*(1/0):H*W}},function(s,a,r){var c=r(8);c(c.S,"Math",{fround:r(532)})},function(s,a,r){var c=r(8),S=r(165);c(c.S+c.F*(S!=Math.expm1),"Math",{expm1:S})},function(s,a,r){var c=r(8),S=Math.exp;c(c.S,"Math",{cosh:function(E){return(S(E=+E)+S(-E))/2}})},function(s,a,r){var c=r(8);c(c.S,"Math",{clz32:function(S){return(S>>>=0)?31-Math.floor(Math.log(S+.5)*Math.LOG2E):32}})},function(s,a,r){var c=r(8),S=r(166);c(c.S,"Math",{cbrt:function(E){return S(E=+E)*Math.pow(Math.abs(E),1/3)}})},function(s,a,r){var c=r(8),S=Math.atanh;c(c.S+c.F*!(S&&1/S(-0)<0),"Math",{atanh:function(E){return(E=+E)==0?E:Math.log((1+E)/(1-E))/2}})},function(s,a,r){var c=r(8),S=Math.asinh;c(c.S+c.F*!(S&&1/S(0)>0),"Math",{asinh:function E(A){return isFinite(A=+A)&&A!=0?A<0?-E(-A):Math.log(A+Math.sqrt(A*A+1)):A}})},function(s,a,r){var c=r(8),S=r(227),E=Math.sqrt,A=Math.acosh;c(c.S+c.F*!(A&&Math.floor(A(Number.MAX_VALUE))==710&&A(1/0)==1/0),"Math",{acosh:function(U){return(U=+U)<1?NaN:U>9490626562425156e-8?Math.log(U)+Math.LN2:S(U-1+E(U-1)*E(U+1))}})},function(s,a,r){var c=r(8),S=r(231);c(c.S+c.F*(Number.parseInt!=S),"Number",{parseInt:S})},function(s,a,r){var c=r(8),S=r(230);c(c.S+c.F*(Number.parseFloat!=S),"Number",{parseFloat:S})},function(s,a,r){var c=r(8);c(c.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(s,a,r){var c=r(8);c(c.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(s,a,r){var c=r(8),S=r(228),E=Math.abs;c(c.S,"Number",{isSafeInteger:function(A){return S(A)&&E(A)<=9007199254740991}})},function(s,a,r){var c=r(8);c(c.S,"Number",{isNaN:function(S){return S!=S}})},function(s,a,r){var c=r(8);c(c.S,"Number",{isInteger:r(228)})},function(s,a,r){var c=r(8),S=r(16).isFinite;c(c.S,"Number",{isFinite:function(E){return typeof E=="number"&&S(E)}})},function(s,a,r){var c=r(8);c(c.S,"Number",{EPSILON:Math.pow(2,-52)})},function(s,a,r){var c=r(8),S=r(15),E=r(229),A=1 .toPrecision;c(c.P+c.F*(S(function(){return A.call(1,void 0)!=="1"})||!S(function(){A.call({})})),"Number",{toPrecision:function(U){var B=E(this,"Number#toPrecision: incorrect invocation!");return U===void 0?A.call(B):A.call(B,U)}})},function(s,a,r){var c=r(8),S=r(54),E=r(229),A=r(167),U=1 .toFixed,B=Math.floor,D=[0,0,0,0,0,0],R="Number.toFixed: incorrect invocation!",W=function(Q,Y){for(var q=-1,ae=Y;++q<6;)ae+=Q*D[q],D[q]=ae%1e7,ae=B(ae/1e7)},j=function(Q){for(var Y=6,q=0;--Y>=0;)q+=D[Y],D[Y]=B(q/Q),q=q%Q*1e7},H=function(){for(var Q=6,Y="";--Q>=0;)if(Y!==""||Q===0||D[Q]!==0){var q=String(D[Q]);Y=Y===""?q:Y+A.call("0",7-q.length)+q}return Y},I=function(Q,Y,q){return Y===0?q:Y%2==1?I(Q,Y-1,q*Q):I(Q*Q,Y/2,q)};c(c.P+c.F*(!!U&&(8e-5 .toFixed(3)!=="0.000"||.9 .toFixed(0)!=="1"||1.255 .toFixed(2)!=="1.25"||0xde0b6b3a7640080 .toFixed(0)!=="1000000000000000128")||!r(15)(function(){U.call({})})),"Number",{toFixed:function(Q){var Y,q,ae,oe,ye=E(this,R),_e=S(Q),pe="",me="0";if(_e<0||_e>20)throw RangeError(R);if(ye!=ye)return"NaN";if(ye<=-1e21||ye>=1e21)return String(ye);if(ye<0&&(pe="-",ye=-ye),ye>1e-21)if(q=(Y=function(Ge){for(var lt=0,It=Ge;It>=4096;)lt+=12,It/=4096;for(;It>=2;)lt+=1,It/=2;return lt}(ye*I(2,69,1))-69)<0?ye*I(2,-Y,1):ye/I(2,Y,1),q*=4503599627370496,(Y=52-Y)>0){for(W(0,q),ae=_e;ae>=7;)W(1e7,0),ae-=7;for(W(I(10,ae,1),0),ae=Y-1;ae>=23;)j(1<<23),ae-=23;j(1<<ae),W(1,1),j(2),me=H()}else W(0,q),W(1<<-Y,0),me=H()+A.call("0",_e);return me=_e>0?pe+((oe=me.length)<=_e?"0."+A.call("0",_e-oe)+me:me.slice(0,oe-_e)+"."+me.slice(oe-_e)):pe+me}})},function(s,a,r){var c=r(16),S=r(43),E=r(62),A=r(168),U=r(66),B=r(15),D=r(79).f,R=r(53).f,W=r(26).f,j=r(97).trim,H=c.Number,I=H,Q=H.prototype,Y=E(r(80)(Q))=="Number",q="trim"in String.prototype,ae=function(pe){var me=U(pe,!1);if(typeof me=="string"&&me.length>2){var Ge,lt,It,wt=(me=q?me.trim():j(me,3)).charCodeAt(0);if(wt===43||wt===45){if((Ge=me.charCodeAt(2))===88||Ge===120)return NaN}else if(wt===48){switch(me.charCodeAt(1)){case 66:case 98:lt=2,It=49;break;case 79:case 111:lt=8,It=55;break;default:return+me}for(var we,yt=me.slice(2),Bt=0,Ot=yt.length;Bt<Ot;Bt++)if((we=yt.charCodeAt(Bt))<48||we>It)return NaN;return parseInt(yt,lt)}}return+me};if(!H(" 0o1")||!H("0b1")||H("+0x1")){H=function(pe){var me=arguments.length<1?0:pe,Ge=this;return Ge instanceof H&&(Y?B(function(){Q.valueOf.call(Ge)}):E(Ge)!="Number")?A(new I(ae(me)),Ge,H):ae(me)};for(var oe,ye=r(27)?D(I):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),_e=0;ye.length>_e;_e++)S(I,oe=ye[_e])&&!S(H,oe)&&W(H,oe,R(I,oe));H.prototype=Q,Q.constructor=H,r(38)(c,"Number",H)}},function(s,a,r){var c=r(8),S=r(230);c(c.G+c.F*(parseFloat!=S),{parseFloat:S})},function(s,a,r){var c=r(8),S=r(231);c(c.G+c.F*(parseInt!=S),{parseInt:S})},function(s,a,r){var c=r(13),S=r(78),E=r(19)("hasInstance"),A=Function.prototype;E in A||r(26).f(A,E,{value:function(U){if(typeof this!="function"||!c(U))return!1;if(!c(this.prototype))return U instanceof this;for(;U=S(U);)if(this.prototype===U)return!0;return!1}})},function(s,a,r){var c=r(26).f,S=Function.prototype,E=/^\s*function ([^ (]*)/;"name"in S||r(27)&&c(S,"name",{configurable:!0,get:function(){try{return(""+this).match(E)[1]}catch{return""}}})},function(s,a,r){var c=r(8);c(c.P,"Function",{bind:r(233)})},function(s,a,r){var c=r(105),S={};S[r(19)("toStringTag")]="z",S+""!="[object z]"&&r(38)(Object.prototype,"toString",function(){return"[object "+c(this)+"]"},!0)},function(s,a,r){var c=r(8);c(c.S,"Object",{setPrototypeOf:r(170).set})},function(s,a,r){var c=r(8);c(c.S,"Object",{is:r(234)})},function(s,a,r){var c=r(8);c(c.S+c.F,"Object",{assign:r(235)})},function(s,a,r){var c=r(13);r(52)("isExtensible",function(S){return function(E){return!!c(E)&&(!S||S(E))}})},function(s,a,r){var c=r(13);r(52)("isSealed",function(S){return function(E){return!c(E)||!!S&&S(E)}})},function(s,a,r){var c=r(13);r(52)("isFrozen",function(S){return function(E){return!c(E)||!!S&&S(E)}})},function(s,a,r){var c=r(13),S=r(65).onFreeze;r(52)("preventExtensions",function(E){return function(A){return E&&c(A)?E(S(A)):A}})},function(s,a,r){var c=r(13),S=r(65).onFreeze;r(52)("seal",function(E){return function(A){return E&&c(A)?E(S(A)):A}})},function(s,a,r){var c=r(13),S=r(65).onFreeze;r(52)("freeze",function(E){return function(A){return E&&c(A)?E(S(A)):A}})},function(s,a,r){r(52)("getOwnPropertyNames",function(){return r(236).f})},function(s,a,r){var c=r(34),S=r(82);r(52)("keys",function(){return function(E){return S(c(E))}})},function(s,a,r){var c=r(34),S=r(78);r(52)("getPrototypeOf",function(){return function(E){return S(c(E))}})},function(s,a,r){var c=r(41),S=r(53).f;r(52)("getOwnPropertyDescriptor",function(){return function(E,A){return S(c(E),A)}})},function(s,a,r){var c=r(8);c(c.S+c.F*!r(27),"Object",{defineProperties:r(237)})},function(s,a,r){var c=r(8);c(c.S+c.F*!r(27),"Object",{defineProperty:r(26).f})},function(s,a,r){var c=r(8);c(c.S,"Object",{create:r(80)})},function(s,a,r){var c=r(82),S=r(127),E=r(106);s.exports=function(A){var U=c(A),B=S.f;if(B)for(var D,R=B(A),W=E.f,j=0;R.length>j;)W.call(A,D=R[j++])&&U.push(D);return U}},function(s,a,r){s.exports=r(129)("native-function-to-string",Function.toString)},function(s,a,r){var c=r(16),S=r(43),E=r(27),A=r(8),U=r(38),B=r(65).KEY,D=r(15),R=r(129),W=r(98),j=r(84),H=r(19),I=r(174),Q=r(239),Y=r(575),q=r(126),ae=r(14),oe=r(13),ye=r(34),_e=r(41),pe=r(66),me=r(85),Ge=r(80),lt=r(236),It=r(53),wt=r(127),we=r(26),yt=r(82),Bt=It.f,Ot=we.f,ze=lt.f,Ut=c.Symbol,Ft=c.JSON,pt=Ft&&Ft.stringify,vt=H("_hidden"),rn=H("toPrimitive"),xt={}.propertyIsEnumerable,_t=R("symbol-registry"),Xt=R("symbols"),sn=R("op-symbols"),kn=Object.prototype,an=typeof Ut=="function"&&!!wt.f,Ve=c.QObject,Ye=!Ve||!Ve.prototype||!Ve.prototype.findChild,$e=E&&D(function(){return Ge(Ot({},"a",{get:function(){return Ot(this,"a",{value:7}).a}})).a!=7})?function(Vt,en,Vn){var Dt=Bt(kn,en);Dt&&delete kn[en],Ot(Vt,en,Vn),Dt&&Vt!==kn&&Ot(kn,en,Dt)}:Ot,ft=function(Vt){var en=Xt[Vt]=Ge(Ut.prototype);return en._k=Vt,en},$t=an&&typeof Ut.iterator=="symbol"?function(Vt){return typeof Vt=="symbol"}:function(Vt){return Vt instanceof Ut},Jt=function(Vt,en,Vn){return Vt===kn&&Jt(sn,en,Vn),ae(Vt),en=pe(en,!0),ae(Vn),S(Xt,en)?(Vn.enumerable?(S(Vt,vt)&&Vt[vt][en]&&(Vt[vt][en]=!1),Vn=Ge(Vn,{enumerable:me(0,!1)})):(S(Vt,vt)||Ot(Vt,vt,me(1,{})),Vt[vt][en]=!0),$e(Vt,en,Vn)):Ot(Vt,en,Vn)},Pn=function(Vt,en){ae(Vt);for(var Vn,Dt=Y(en=_e(en)),On=0,or=Dt.length;or>On;)Jt(Vt,Vn=Dt[On++],en[Vn]);return Vt},An=function(Vt){var en=xt.call(this,Vt=pe(Vt,!0));return!(this===kn&&S(Xt,Vt)&&!S(sn,Vt))&&(!(en||!S(this,Vt)||!S(Xt,Vt)||S(this,vt)&&this[vt][Vt])||en)},Qn=function(Vt,en){if(Vt=_e(Vt),en=pe(en,!0),Vt!==kn||!S(Xt,en)||S(sn,en)){var Vn=Bt(Vt,en);return!Vn||!S(Xt,en)||S(Vt,vt)&&Vt[vt][en]||(Vn.enumerable=!0),Vn}},Ce=function(Vt){for(var en,Vn=ze(_e(Vt)),Dt=[],On=0;Vn.length>On;)S(Xt,en=Vn[On++])||en==vt||en==B||Dt.push(en);return Dt},sr=function(Vt){for(var en,Vn=Vt===kn,Dt=ze(Vn?sn:_e(Vt)),On=[],or=0;Dt.length>or;)!S(Xt,en=Dt[or++])||Vn&&!S(kn,en)||On.push(Xt[en]);return On};an||(U((Ut=function(){if(this instanceof Ut)throw TypeError("Symbol is not a constructor!");var Vt=j(arguments.length>0?arguments[0]:void 0),en=function(Vn){this===kn&&en.call(sn,Vn),S(this,vt)&&S(this[vt],Vt)&&(this[vt][Vt]=!1),$e(this,Vt,me(1,Vn))};return E&&Ye&&$e(kn,Vt,{configurable:!0,set:en}),ft(Vt)}).prototype,"toString",function(){return this._k}),It.f=Qn,we.f=Jt,r(79).f=lt.f=Ce,r(106).f=An,wt.f=sr,E&&!r(83)&&U(kn,"propertyIsEnumerable",An,!0),I.f=function(Vt){return ft(H(Vt))}),A(A.G+A.W+A.F*!an,{Symbol:Ut});for(var Mr="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),on=0;Mr.length>on;)H(Mr[on++]);for(var Gt=yt(H.store),Hn=0;Gt.length>Hn;)Q(Gt[Hn++]);A(A.S+A.F*!an,"Symbol",{for:function(Vt){return S(_t,Vt+="")?_t[Vt]:_t[Vt]=Ut(Vt)},keyFor:function(Vt){if(!$t(Vt))throw TypeError(Vt+" is not a symbol!");for(var en in _t)if(_t[en]===Vt)return en},useSetter:function(){Ye=!0},useSimple:function(){Ye=!1}}),A(A.S+A.F*!an,"Object",{create:function(Vt,en){return en===void 0?Ge(Vt):Pn(Ge(Vt),en)},defineProperty:Jt,defineProperties:Pn,getOwnPropertyDescriptor:Qn,getOwnPropertyNames:Ce,getOwnPropertySymbols:sr});var Kt=D(function(){wt.f(1)});A(A.S+A.F*Kt,"Object",{getOwnPropertySymbols:function(Vt){return wt.f(ye(Vt))}}),Ft&&A(A.S+A.F*(!an||D(function(){var Vt=Ut();return pt([Vt])!="[null]"||pt({a:Vt})!="{}"||pt(Object(Vt))!="{}"})),"JSON",{stringify:function(Vt){for(var en,Vn,Dt=[Vt],On=1;arguments.length>On;)Dt.push(arguments[On++]);if(Vn=en=Dt[1],(oe(en)||Vt!==void 0)&&!$t(Vt))return q(en)||(en=function(or,ar){if(typeof Vn=="function"&&(ar=Vn.call(this,or,ar)),!$t(ar))return ar}),Dt[1]=en,pt.apply(Ft,Dt)}}),Ut.prototype[rn]||r(42)(Ut.prototype,rn,Ut.prototype.valueOf),W(Ut,"Symbol"),W(Math,"Math",!0),W(c.JSON,"JSON",!0)},function(s,a,r){r(577),r(574),r(573),r(572),r(571),r(570),r(569),r(568),r(567),r(566),r(565),r(564),r(563),r(562),r(561),r(560),r(559),r(558),r(557),r(556),r(555),r(554),r(553),r(552),r(551),r(550),r(549),r(548),r(547),r(546),r(545),r(544),r(543),r(542),r(541),r(540),r(539),r(538),r(537),r(536),r(535),r(534),r(533),r(531),r(530),r(529),r(528),r(527),r(526),r(525),r(524),r(523),r(522),r(521),r(520),r(519),r(518),r(517),r(516),r(515),r(514),r(513),r(512),r(511),r(510),r(509),r(508),r(507),r(506),r(505),r(504),r(503),r(502),r(501),r(500),r(499),r(498),r(496),r(495),r(493),r(492),r(491),r(490),r(489),r(488),r(487),r(485),r(484),r(483),r(482),r(481),r(480),r(479),r(478),r(477),r(476),r(475),r(474),r(473),r(155),r(472),r(220),r(471),r(219),r(470),r(469),r(468),r(467),r(218),r(464),r(463),r(462),r(461),r(460),r(459),r(458),r(457),r(456),r(455),r(454),r(453),r(452),r(451),r(450),r(449),r(448),r(447),r(446),r(445),r(444),r(443),r(442),r(441),r(440),r(439),r(438),r(437),r(436),s.exports=r(24)},function(s,a,r){r(578),r(435),r(433),r(430),r(428),r(426),r(424),r(422),r(420),r(418),r(416),r(414),r(412),r(408)},function(s,a,r){r(579);var c=function(S){return S&&S.__esModule?S:{default:S}}(r(407));c.default._babelPolyfill&&typeof console<"u"&&console.warn&&console.warn("@babel/polyfill is loaded more than once on this page. This is probably not desirable/intended and may have consequences if different versions of the polyfills are applied sequentially. If you do need to load the polyfill more than once, use @babel/polyfill/noConflict instead to bypass the warning."),c.default._babelPolyfill=!0},function(s,a,r){r(580),s.exports=r(248)},function(s,a,r){var c={},S={},E=34,A=10,U=13;function B(j){return new Function("d","return {"+j.map(function(H,I){return JSON.stringify(H)+": d["+I+'] || ""'}).join(",")+"}")}function D(j){var H=Object.create(null),I=[];return j.forEach(function(Q){for(var Y in Q)Y in H||I.push(H[Y]=Y)}),I}function R(j,H){var I=j+"",Q=I.length;return Q<H?new Array(H-Q+1).join(0)+I:I}function W(j){var H=j.getUTCHours(),I=j.getUTCMinutes(),Q=j.getUTCSeconds(),Y=j.getUTCMilliseconds();return isNaN(j)?"Invalid Date":function(q){return q<0?"-"+R(-q,6):q>9999?"+"+R(q,6):R(q,4)}(j.getUTCFullYear())+"-"+R(j.getUTCMonth()+1,2)+"-"+R(j.getUTCDate(),2)+(Y?"T"+R(H,2)+":"+R(I,2)+":"+R(Q,2)+"."+R(Y,3)+"Z":Q?"T"+R(H,2)+":"+R(I,2)+":"+R(Q,2)+"Z":I||H?"T"+R(H,2)+":"+R(I,2)+"Z":"")}a.a=function(j){var H=new RegExp('["'+j+`
\r]`),I=j.charCodeAt(0);function Q(oe,ye){var _e,pe=[],me=oe.length,Ge=0,lt=0,It=me<=0,wt=!1;function we(){if(It)return S;if(wt)return wt=!1,c;var Bt,Ot,ze=Ge;if(oe.charCodeAt(ze)===E){for(;Ge++<me&&oe.charCodeAt(Ge)!==E||oe.charCodeAt(++Ge)===E;);return(Bt=Ge)>=me?It=!0:(Ot=oe.charCodeAt(Ge++))===A?wt=!0:Ot===U&&(wt=!0,oe.charCodeAt(Ge)===A&&++Ge),oe.slice(ze+1,Bt-1).replace(/""/g,'"')}for(;Ge<me;){if((Ot=oe.charCodeAt(Bt=Ge++))===A)wt=!0;else if(Ot===U)wt=!0,oe.charCodeAt(Ge)===A&&++Ge;else if(Ot!==I)continue;return oe.slice(ze,Bt)}return It=!0,oe.slice(ze,me)}for(oe.charCodeAt(me-1)===A&&--me,oe.charCodeAt(me-1)===U&&--me;(_e=we())!==S;){for(var yt=[];_e!==c&&_e!==S;)yt.push(_e),_e=we();ye&&(yt=ye(yt,lt++))==null||pe.push(yt)}return pe}function Y(oe,ye){return oe.map(function(_e){return ye.map(function(pe){return ae(_e[pe])}).join(j)})}function q(oe){return oe.map(ae).join(j)}function ae(oe){return oe==null?"":oe instanceof Date?W(oe):H.test(oe+="")?'"'+oe.replace(/"/g,'""')+'"':oe}return{parse:function(oe,ye){var _e,pe,me=Q(oe,function(Ge,lt){if(_e)return _e(Ge,lt-1);pe=Ge,_e=ye?function(It,wt){var we=B(It);return function(yt,Bt){return wt(we(yt),Bt,It)}}(Ge,ye):B(Ge)});return me.columns=pe||[],me},parseRows:Q,format:function(oe,ye){return ye==null&&(ye=D(oe)),[ye.map(ae).join(j)].concat(Y(oe,ye)).join(`
`)},formatBody:function(oe,ye){return ye==null&&(ye=D(oe)),Y(oe,ye).join(`
`)},formatRows:function(oe){return oe.map(q).join(`
`)},formatRow:q,formatValue:ae}}}]).default})})(hq);const xue=tH(hq.exports),wue="_facemesh_152oh_1",_ue="_video_152oh_7",xW={facemesh:wue,video:_ue},ST=kl.exports.createContext({facemeshOptions:{flipHorizontal:!1,maxContinuousChecks:5,detectionConfidence:.9,maxFaces:1,scoreThreshold:.75,iouThreshold:.3},setFacemeshOptions:null,video:null,setVideo:null,predictions:[],setPredictions:null,loadingMask:!1,setLoadingMask:null});function Eue(){const h=kl.exports.useRef(void 0),{facemeshOptions:i,setVideo:s,setPredictions:a,setLoadingMask:r}=kl.exports.useContext(ST),c=async()=>{const A=h.current;if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){const U=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});return A.srcObject=U,new Promise(B=>{A.onloadedmetadata=()=>{A.play(),B()}})}},S=A=>new Promise((U,B)=>{xue.facemesh(h.current,i,U).on("face",A)}),E=async()=>{r(!0),await c();const A=h.current;await S(U=>{s(A),a(U)}),r(!1)};return kl.exports.useEffect(()=>{h&&E()},[h]),Rp(qR,{children:Rp("div",{className:xW.facemesh,children:Rp("video",{className:xW.video,autoPlay:!0,ref:h})})})}const L5="148",O1={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},b2={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Sue=0,wW=1,Cue=2,pq=1,kue=2,MS=3,vw=0,$g=1,B5=2,KA=3,Kb=0,r_=1,_W=2,EW=3,SW=4,Aue=5,F2=100,Oue=101,Tue=102,CW=103,kW=104,Mue=200,Due=201,Nue=202,Iue=203,mq=204,gq=205,Fue=206,Rue=207,Pue=208,Lue=209,Bue=210,jue=0,zue=1,Uue=2,OR=3,Wue=4,Vue=5,Hue=6,Gue=7,vq=0,que=1,$ue=2,I1=0,Xue=1,Kue=2,Yue=3,Jue=4,Que=5,yq=300,d_=301,h_=302,TR=303,MR=304,CT=306,rT=1e3,tv=1001,DR=1002,wh=1003,AW=1004,XI=1005,Np=1006,Zue=1007,sC=1008,yw=1009,ece=1010,tce=1011,bq=1012,nce=1013,aw=1014,sw=1015,uC=1016,rce=1017,ice=1018,i_=1020,oce=1021,ace=1022,nv=1023,sce=1024,uce=1025,lw=1026,p_=1027,cce=1028,lce=1029,fce=1030,dce=1031,hce=1033,KI=33776,YI=33777,JI=33778,QI=33779,OW=35840,TW=35841,MW=35842,DW=35843,pce=36196,NW=37492,IW=37496,FW=37808,RW=37809,PW=37810,LW=37811,BW=37812,jW=37813,zW=37814,UW=37815,WW=37816,VW=37817,HW=37818,GW=37819,qW=37820,$W=37821,XW=36492,bw=3e3,iu=3001,mce=3200,gce=3201,vce=0,yce=1,Sy="srgb",cC="srgb-linear",ZI=7680,bce=519,KW=35044,YW="300 es",NR=1035;class rx{addEventListener(i,s){this._listeners===void 0&&(this._listeners={});const a=this._listeners;a[i]===void 0&&(a[i]=[]),a[i].indexOf(s)===-1&&a[i].push(s)}hasEventListener(i,s){if(this._listeners===void 0)return!1;const a=this._listeners;return a[i]!==void 0&&a[i].indexOf(s)!==-1}removeEventListener(i,s){if(this._listeners===void 0)return;const r=this._listeners[i];if(r!==void 0){const c=r.indexOf(s);c!==-1&&r.splice(c,1)}}dispatchEvent(i){if(this._listeners===void 0)return;const a=this._listeners[i.type];if(a!==void 0){i.target=this;const r=a.slice(0);for(let c=0,S=r.length;c<S;c++)r[c].call(this,i);i.target=null}}}const ud=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],eF=Math.PI/180,JW=180/Math.PI;function gC(){const h=Math.random()*4294967295|0,i=Math.random()*4294967295|0,s=Math.random()*4294967295|0,a=Math.random()*4294967295|0;return(ud[h&255]+ud[h>>8&255]+ud[h>>16&255]+ud[h>>24&255]+"-"+ud[i&255]+ud[i>>8&255]+"-"+ud[i>>16&15|64]+ud[i>>24&255]+"-"+ud[s&63|128]+ud[s>>8&255]+"-"+ud[s>>16&255]+ud[s>>24&255]+ud[a&255]+ud[a>>8&255]+ud[a>>16&255]+ud[a>>24&255]).toLowerCase()}function Ip(h,i,s){return Math.max(i,Math.min(s,h))}function xce(h,i){return(h%i+i)%i}function tF(h,i,s){return(1-s)*h+s*i}function QW(h){return(h&h-1)===0&&h!==0}function IR(h){return Math.pow(2,Math.floor(Math.log(h)/Math.LN2))}function YA(h,i){switch(i.constructor){case Float32Array:return h;case Uint16Array:return h/65535;case Uint8Array:return h/255;case Int16Array:return Math.max(h/32767,-1);case Int8Array:return Math.max(h/127,-1);default:throw new Error("Invalid component type.")}}function Wm(h,i){switch(i.constructor){case Float32Array:return h;case Uint16Array:return Math.round(h*65535);case Uint8Array:return Math.round(h*255);case Int16Array:return Math.round(h*32767);case Int8Array:return Math.round(h*127);default:throw new Error("Invalid component type.")}}class Eo{constructor(i=0,s=0){Eo.prototype.isVector2=!0,this.x=i,this.y=s}get width(){return this.x}set width(i){this.x=i}get height(){return this.y}set height(i){this.y=i}set(i,s){return this.x=i,this.y=s,this}setScalar(i){return this.x=i,this.y=i,this}setX(i){return this.x=i,this}setY(i){return this.y=i,this}setComponent(i,s){switch(i){case 0:this.x=s;break;case 1:this.y=s;break;default:throw new Error("index is out of range: "+i)}return this}getComponent(i){switch(i){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+i)}}clone(){return new this.constructor(this.x,this.y)}copy(i){return this.x=i.x,this.y=i.y,this}add(i){return this.x+=i.x,this.y+=i.y,this}addScalar(i){return this.x+=i,this.y+=i,this}addVectors(i,s){return this.x=i.x+s.x,this.y=i.y+s.y,this}addScaledVector(i,s){return this.x+=i.x*s,this.y+=i.y*s,this}sub(i){return this.x-=i.x,this.y-=i.y,this}subScalar(i){return this.x-=i,this.y-=i,this}subVectors(i,s){return this.x=i.x-s.x,this.y=i.y-s.y,this}multiply(i){return this.x*=i.x,this.y*=i.y,this}multiplyScalar(i){return this.x*=i,this.y*=i,this}divide(i){return this.x/=i.x,this.y/=i.y,this}divideScalar(i){return this.multiplyScalar(1/i)}applyMatrix3(i){const s=this.x,a=this.y,r=i.elements;return this.x=r[0]*s+r[3]*a+r[6],this.y=r[1]*s+r[4]*a+r[7],this}min(i){return this.x=Math.min(this.x,i.x),this.y=Math.min(this.y,i.y),this}max(i){return this.x=Math.max(this.x,i.x),this.y=Math.max(this.y,i.y),this}clamp(i,s){return this.x=Math.max(i.x,Math.min(s.x,this.x)),this.y=Math.max(i.y,Math.min(s.y,this.y)),this}clampScalar(i,s){return this.x=Math.max(i,Math.min(s,this.x)),this.y=Math.max(i,Math.min(s,this.y)),this}clampLength(i,s){const a=this.length();return this.divideScalar(a||1).multiplyScalar(Math.max(i,Math.min(s,a)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(i){return this.x*i.x+this.y*i.y}cross(i){return this.x*i.y-this.y*i.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(i){return Math.sqrt(this.distanceToSquared(i))}distanceToSquared(i){const s=this.x-i.x,a=this.y-i.y;return s*s+a*a}manhattanDistanceTo(i){return Math.abs(this.x-i.x)+Math.abs(this.y-i.y)}setLength(i){return this.normalize().multiplyScalar(i)}lerp(i,s){return this.x+=(i.x-this.x)*s,this.y+=(i.y-this.y)*s,this}lerpVectors(i,s,a){return this.x=i.x+(s.x-i.x)*a,this.y=i.y+(s.y-i.y)*a,this}equals(i){return i.x===this.x&&i.y===this.y}fromArray(i,s=0){return this.x=i[s],this.y=i[s+1],this}toArray(i=[],s=0){return i[s]=this.x,i[s+1]=this.y,i}fromBufferAttribute(i,s){return this.x=i.getX(s),this.y=i.getY(s),this}rotateAround(i,s){const a=Math.cos(s),r=Math.sin(s),c=this.x-i.x,S=this.y-i.y;return this.x=c*a-S*r+i.x,this.y=c*r+S*a+i.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class $m{constructor(){$m.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(i,s,a,r,c,S,E,A,U){const B=this.elements;return B[0]=i,B[1]=r,B[2]=E,B[3]=s,B[4]=c,B[5]=A,B[6]=a,B[7]=S,B[8]=U,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(i){const s=this.elements,a=i.elements;return s[0]=a[0],s[1]=a[1],s[2]=a[2],s[3]=a[3],s[4]=a[4],s[5]=a[5],s[6]=a[6],s[7]=a[7],s[8]=a[8],this}extractBasis(i,s,a){return i.setFromMatrix3Column(this,0),s.setFromMatrix3Column(this,1),a.setFromMatrix3Column(this,2),this}setFromMatrix4(i){const s=i.elements;return this.set(s[0],s[4],s[8],s[1],s[5],s[9],s[2],s[6],s[10]),this}multiply(i){return this.multiplyMatrices(this,i)}premultiply(i){return this.multiplyMatrices(i,this)}multiplyMatrices(i,s){const a=i.elements,r=s.elements,c=this.elements,S=a[0],E=a[3],A=a[6],U=a[1],B=a[4],D=a[7],R=a[2],W=a[5],j=a[8],H=r[0],I=r[3],Q=r[6],Y=r[1],q=r[4],ae=r[7],oe=r[2],ye=r[5],_e=r[8];return c[0]=S*H+E*Y+A*oe,c[3]=S*I+E*q+A*ye,c[6]=S*Q+E*ae+A*_e,c[1]=U*H+B*Y+D*oe,c[4]=U*I+B*q+D*ye,c[7]=U*Q+B*ae+D*_e,c[2]=R*H+W*Y+j*oe,c[5]=R*I+W*q+j*ye,c[8]=R*Q+W*ae+j*_e,this}multiplyScalar(i){const s=this.elements;return s[0]*=i,s[3]*=i,s[6]*=i,s[1]*=i,s[4]*=i,s[7]*=i,s[2]*=i,s[5]*=i,s[8]*=i,this}determinant(){const i=this.elements,s=i[0],a=i[1],r=i[2],c=i[3],S=i[4],E=i[5],A=i[6],U=i[7],B=i[8];return s*S*B-s*E*U-a*c*B+a*E*A+r*c*U-r*S*A}invert(){const i=this.elements,s=i[0],a=i[1],r=i[2],c=i[3],S=i[4],E=i[5],A=i[6],U=i[7],B=i[8],D=B*S-E*U,R=E*A-B*c,W=U*c-S*A,j=s*D+a*R+r*W;if(j===0)return this.set(0,0,0,0,0,0,0,0,0);const H=1/j;return i[0]=D*H,i[1]=(r*U-B*a)*H,i[2]=(E*a-r*S)*H,i[3]=R*H,i[4]=(B*s-r*A)*H,i[5]=(r*c-E*s)*H,i[6]=W*H,i[7]=(a*A-U*s)*H,i[8]=(S*s-a*c)*H,this}transpose(){let i;const s=this.elements;return i=s[1],s[1]=s[3],s[3]=i,i=s[2],s[2]=s[6],s[6]=i,i=s[5],s[5]=s[7],s[7]=i,this}getNormalMatrix(i){return this.setFromMatrix4(i).invert().transpose()}transposeIntoArray(i){const s=this.elements;return i[0]=s[0],i[1]=s[3],i[2]=s[6],i[3]=s[1],i[4]=s[4],i[5]=s[7],i[6]=s[2],i[7]=s[5],i[8]=s[8],this}setUvTransform(i,s,a,r,c,S,E){const A=Math.cos(c),U=Math.sin(c);return this.set(a*A,a*U,-a*(A*S+U*E)+S+i,-r*U,r*A,-r*(-U*S+A*E)+E+s,0,0,1),this}scale(i,s){return this.premultiply(nF.makeScale(i,s)),this}rotate(i){return this.premultiply(nF.makeRotation(-i)),this}translate(i,s){return this.premultiply(nF.makeTranslation(i,s)),this}makeTranslation(i,s){return this.set(1,0,i,0,1,s,0,0,1),this}makeRotation(i){const s=Math.cos(i),a=Math.sin(i);return this.set(s,-a,0,a,s,0,0,0,1),this}makeScale(i,s){return this.set(i,0,0,0,s,0,0,0,1),this}equals(i){const s=this.elements,a=i.elements;for(let r=0;r<9;r++)if(s[r]!==a[r])return!1;return!0}fromArray(i,s=0){for(let a=0;a<9;a++)this.elements[a]=i[a+s];return this}toArray(i=[],s=0){const a=this.elements;return i[s]=a[0],i[s+1]=a[1],i[s+2]=a[2],i[s+3]=a[3],i[s+4]=a[4],i[s+5]=a[5],i[s+6]=a[6],i[s+7]=a[7],i[s+8]=a[8],i}clone(){return new this.constructor().fromArray(this.elements)}}const nF=new $m;function xq(h){for(let i=h.length-1;i>=0;--i)if(h[i]>=65535)return!0;return!1}function iT(h){return document.createElementNS("http://www.w3.org/1999/xhtml",h)}function fw(h){return h<.04045?h*.0773993808:Math.pow(h*.9478672986+.0521327014,2.4)}function DO(h){return h<.0031308?h*12.92:1.055*Math.pow(h,.41666)-.055}const rF={[Sy]:{[cC]:fw},[cC]:{[Sy]:DO}},yh={legacyMode:!0,get workingColorSpace(){return cC},set workingColorSpace(h){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(h,i,s){if(this.legacyMode||i===s||!i||!s)return h;if(rF[i]&&rF[i][s]!==void 0){const a=rF[i][s];return h.r=a(h.r),h.g=a(h.g),h.b=a(h.b),h}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(h,i){return this.convert(h,this.workingColorSpace,i)},toWorkingColorSpace:function(h,i){return this.convert(h,i,this.workingColorSpace)}},wq={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Kc={r:0,g:0,b:0},K0={h:0,s:0,l:0},JA={h:0,s:0,l:0};function iF(h,i,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?h+(i-h)*6*s:s<1/2?i:s<2/3?h+(i-h)*6*(2/3-s):h}function QA(h,i){return i.r=h.r,i.g=h.g,i.b=h.b,i}let bs=class{constructor(i,s,a){return this.isColor=!0,this.r=1,this.g=1,this.b=1,s===void 0&&a===void 0?this.set(i):this.setRGB(i,s,a)}set(i){return i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i),this}setScalar(i){return this.r=i,this.g=i,this.b=i,this}setHex(i,s=Sy){return i=Math.floor(i),this.r=(i>>16&255)/255,this.g=(i>>8&255)/255,this.b=(i&255)/255,yh.toWorkingColorSpace(this,s),this}setRGB(i,s,a,r=yh.workingColorSpace){return this.r=i,this.g=s,this.b=a,yh.toWorkingColorSpace(this,r),this}setHSL(i,s,a,r=yh.workingColorSpace){if(i=xce(i,1),s=Ip(s,0,1),a=Ip(a,0,1),s===0)this.r=this.g=this.b=a;else{const c=a<=.5?a*(1+s):a+s-a*s,S=2*a-c;this.r=iF(S,c,i+1/3),this.g=iF(S,c,i),this.b=iF(S,c,i-1/3)}return yh.toWorkingColorSpace(this,r),this}setStyle(i,s=Sy){function a(c){c!==void 0&&parseFloat(c)<1&&console.warn("THREE.Color: Alpha component of "+i+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(i)){let c;const S=r[1],E=r[2];switch(S){case"rgb":case"rgba":if(c=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(E))return this.r=Math.min(255,parseInt(c[1],10))/255,this.g=Math.min(255,parseInt(c[2],10))/255,this.b=Math.min(255,parseInt(c[3],10))/255,yh.toWorkingColorSpace(this,s),a(c[4]),this;if(c=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(E))return this.r=Math.min(100,parseInt(c[1],10))/100,this.g=Math.min(100,parseInt(c[2],10))/100,this.b=Math.min(100,parseInt(c[3],10))/100,yh.toWorkingColorSpace(this,s),a(c[4]),this;break;case"hsl":case"hsla":if(c=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(E)){const A=parseFloat(c[1])/360,U=parseFloat(c[2])/100,B=parseFloat(c[3])/100;return a(c[4]),this.setHSL(A,U,B,s)}break}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(i)){const c=r[1],S=c.length;if(S===3)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,yh.toWorkingColorSpace(this,s),this;if(S===6)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,yh.toWorkingColorSpace(this,s),this}return i&&i.length>0?this.setColorName(i,s):this}setColorName(i,s=Sy){const a=wq[i.toLowerCase()];return a!==void 0?this.setHex(a,s):console.warn("THREE.Color: Unknown color "+i),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(i){return this.r=i.r,this.g=i.g,this.b=i.b,this}copySRGBToLinear(i){return this.r=fw(i.r),this.g=fw(i.g),this.b=fw(i.b),this}copyLinearToSRGB(i){return this.r=DO(i.r),this.g=DO(i.g),this.b=DO(i.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(i=Sy){return yh.fromWorkingColorSpace(QA(this,Kc),i),Ip(Kc.r*255,0,255)<<16^Ip(Kc.g*255,0,255)<<8^Ip(Kc.b*255,0,255)<<0}getHexString(i=Sy){return("000000"+this.getHex(i).toString(16)).slice(-6)}getHSL(i,s=yh.workingColorSpace){yh.fromWorkingColorSpace(QA(this,Kc),s);const a=Kc.r,r=Kc.g,c=Kc.b,S=Math.max(a,r,c),E=Math.min(a,r,c);let A,U;const B=(E+S)/2;if(E===S)A=0,U=0;else{const D=S-E;switch(U=B<=.5?D/(S+E):D/(2-S-E),S){case a:A=(r-c)/D+(r<c?6:0);break;case r:A=(c-a)/D+2;break;case c:A=(a-r)/D+4;break}A/=6}return i.h=A,i.s=U,i.l=B,i}getRGB(i,s=yh.workingColorSpace){return yh.fromWorkingColorSpace(QA(this,Kc),s),i.r=Kc.r,i.g=Kc.g,i.b=Kc.b,i}getStyle(i=Sy){return yh.fromWorkingColorSpace(QA(this,Kc),i),i!==Sy?`color(${i} ${Kc.r} ${Kc.g} ${Kc.b})`:`rgb(${Kc.r*255|0},${Kc.g*255|0},${Kc.b*255|0})`}offsetHSL(i,s,a){return this.getHSL(K0),K0.h+=i,K0.s+=s,K0.l+=a,this.setHSL(K0.h,K0.s,K0.l),this}add(i){return this.r+=i.r,this.g+=i.g,this.b+=i.b,this}addColors(i,s){return this.r=i.r+s.r,this.g=i.g+s.g,this.b=i.b+s.b,this}addScalar(i){return this.r+=i,this.g+=i,this.b+=i,this}sub(i){return this.r=Math.max(0,this.r-i.r),this.g=Math.max(0,this.g-i.g),this.b=Math.max(0,this.b-i.b),this}multiply(i){return this.r*=i.r,this.g*=i.g,this.b*=i.b,this}multiplyScalar(i){return this.r*=i,this.g*=i,this.b*=i,this}lerp(i,s){return this.r+=(i.r-this.r)*s,this.g+=(i.g-this.g)*s,this.b+=(i.b-this.b)*s,this}lerpColors(i,s,a){return this.r=i.r+(s.r-i.r)*a,this.g=i.g+(s.g-i.g)*a,this.b=i.b+(s.b-i.b)*a,this}lerpHSL(i,s){this.getHSL(K0),i.getHSL(JA);const a=tF(K0.h,JA.h,s),r=tF(K0.s,JA.s,s),c=tF(K0.l,JA.l,s);return this.setHSL(a,r,c),this}equals(i){return i.r===this.r&&i.g===this.g&&i.b===this.b}fromArray(i,s=0){return this.r=i[s],this.g=i[s+1],this.b=i[s+2],this}toArray(i=[],s=0){return i[s]=this.r,i[s+1]=this.g,i[s+2]=this.b,i}fromBufferAttribute(i,s){return this.r=i.getX(s),this.g=i.getY(s),this.b=i.getZ(s),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};bs.NAMES=wq;let x2;class _q{static getDataURL(i){if(/^data:/i.test(i.src)||typeof HTMLCanvasElement>"u")return i.src;let s;if(i instanceof HTMLCanvasElement)s=i;else{x2===void 0&&(x2=iT("canvas")),x2.width=i.width,x2.height=i.height;const a=x2.getContext("2d");i instanceof ImageData?a.putImageData(i,0,0):a.drawImage(i,0,0,i.width,i.height),s=x2}return s.width>2048||s.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",i),s.toDataURL("image/jpeg",.6)):s.toDataURL("image/png")}static sRGBToLinear(i){if(typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap){const s=iT("canvas");s.width=i.width,s.height=i.height;const a=s.getContext("2d");a.drawImage(i,0,0,i.width,i.height);const r=a.getImageData(0,0,i.width,i.height),c=r.data;for(let S=0;S<c.length;S++)c[S]=fw(c[S]/255)*255;return a.putImageData(r,0,0),s}else if(i.data){const s=i.data.slice(0);for(let a=0;a<s.length;a++)s instanceof Uint8Array||s instanceof Uint8ClampedArray?s[a]=Math.floor(fw(s[a]/255)*255):s[a]=fw(s[a]);return{data:s,width:i.width,height:i.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),i}}class Eq{constructor(i=null){this.isSource=!0,this.uuid=gC(),this.data=i,this.version=0}set needsUpdate(i){i===!0&&this.version++}toJSON(i){const s=i===void 0||typeof i=="string";if(!s&&i.images[this.uuid]!==void 0)return i.images[this.uuid];const a={uuid:this.uuid,url:""},r=this.data;if(r!==null){let c;if(Array.isArray(r)){c=[];for(let S=0,E=r.length;S<E;S++)r[S].isDataTexture?c.push(oF(r[S].image)):c.push(oF(r[S]))}else c=oF(r);a.url=c}return s||(i.images[this.uuid]=a),a}}function oF(h){return typeof HTMLImageElement<"u"&&h instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&h instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&h instanceof ImageBitmap?_q.getDataURL(h):h.data?{data:Array.from(h.data),width:h.width,height:h.height,type:h.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let wce=0;class jp extends rx{constructor(i=jp.DEFAULT_IMAGE,s=jp.DEFAULT_MAPPING,a=tv,r=tv,c=Np,S=sC,E=nv,A=yw,U=jp.DEFAULT_ANISOTROPY,B=bw){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:wce++}),this.uuid=gC(),this.name="",this.source=new Eq(i),this.mipmaps=[],this.mapping=s,this.wrapS=a,this.wrapT=r,this.magFilter=c,this.minFilter=S,this.anisotropy=U,this.format=E,this.internalFormat=null,this.type=A,this.offset=new Eo(0,0),this.repeat=new Eo(1,1),this.center=new Eo(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new $m,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=B,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(i){this.source.data=i}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(i){return this.name=i.name,this.source=i.source,this.mipmaps=i.mipmaps.slice(0),this.mapping=i.mapping,this.wrapS=i.wrapS,this.wrapT=i.wrapT,this.magFilter=i.magFilter,this.minFilter=i.minFilter,this.anisotropy=i.anisotropy,this.format=i.format,this.internalFormat=i.internalFormat,this.type=i.type,this.offset.copy(i.offset),this.repeat.copy(i.repeat),this.center.copy(i.center),this.rotation=i.rotation,this.matrixAutoUpdate=i.matrixAutoUpdate,this.matrix.copy(i.matrix),this.generateMipmaps=i.generateMipmaps,this.premultiplyAlpha=i.premultiplyAlpha,this.flipY=i.flipY,this.unpackAlignment=i.unpackAlignment,this.encoding=i.encoding,this.userData=JSON.parse(JSON.stringify(i.userData)),this.needsUpdate=!0,this}toJSON(i){const s=i===void 0||typeof i=="string";if(!s&&i.textures[this.uuid]!==void 0)return i.textures[this.uuid];const a={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(i).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(a.userData=this.userData),s||(i.textures[this.uuid]=a),a}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(i){if(this.mapping!==yq)return i;if(i.applyMatrix3(this.matrix),i.x<0||i.x>1)switch(this.wrapS){case rT:i.x=i.x-Math.floor(i.x);break;case tv:i.x=i.x<0?0:1;break;case DR:Math.abs(Math.floor(i.x)%2)===1?i.x=Math.ceil(i.x)-i.x:i.x=i.x-Math.floor(i.x);break}if(i.y<0||i.y>1)switch(this.wrapT){case rT:i.y=i.y-Math.floor(i.y);break;case tv:i.y=i.y<0?0:1;break;case DR:Math.abs(Math.floor(i.y)%2)===1?i.y=Math.ceil(i.y)-i.y:i.y=i.y-Math.floor(i.y);break}return this.flipY&&(i.y=1-i.y),i}set needsUpdate(i){i===!0&&(this.version++,this.source.needsUpdate=!0)}}jp.DEFAULT_IMAGE=null;jp.DEFAULT_MAPPING=yq;jp.DEFAULT_ANISOTROPY=1;class wu{constructor(i=0,s=0,a=0,r=1){wu.prototype.isVector4=!0,this.x=i,this.y=s,this.z=a,this.w=r}get width(){return this.z}set width(i){this.z=i}get height(){return this.w}set height(i){this.w=i}set(i,s,a,r){return this.x=i,this.y=s,this.z=a,this.w=r,this}setScalar(i){return this.x=i,this.y=i,this.z=i,this.w=i,this}setX(i){return this.x=i,this}setY(i){return this.y=i,this}setZ(i){return this.z=i,this}setW(i){return this.w=i,this}setComponent(i,s){switch(i){case 0:this.x=s;break;case 1:this.y=s;break;case 2:this.z=s;break;case 3:this.w=s;break;default:throw new Error("index is out of range: "+i)}return this}getComponent(i){switch(i){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+i)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(i){return this.x=i.x,this.y=i.y,this.z=i.z,this.w=i.w!==void 0?i.w:1,this}add(i){return this.x+=i.x,this.y+=i.y,this.z+=i.z,this.w+=i.w,this}addScalar(i){return this.x+=i,this.y+=i,this.z+=i,this.w+=i,this}addVectors(i,s){return this.x=i.x+s.x,this.y=i.y+s.y,this.z=i.z+s.z,this.w=i.w+s.w,this}addScaledVector(i,s){return this.x+=i.x*s,this.y+=i.y*s,this.z+=i.z*s,this.w+=i.w*s,this}sub(i){return this.x-=i.x,this.y-=i.y,this.z-=i.z,this.w-=i.w,this}subScalar(i){return this.x-=i,this.y-=i,this.z-=i,this.w-=i,this}subVectors(i,s){return this.x=i.x-s.x,this.y=i.y-s.y,this.z=i.z-s.z,this.w=i.w-s.w,this}multiply(i){return this.x*=i.x,this.y*=i.y,this.z*=i.z,this.w*=i.w,this}multiplyScalar(i){return this.x*=i,this.y*=i,this.z*=i,this.w*=i,this}applyMatrix4(i){const s=this.x,a=this.y,r=this.z,c=this.w,S=i.elements;return this.x=S[0]*s+S[4]*a+S[8]*r+S[12]*c,this.y=S[1]*s+S[5]*a+S[9]*r+S[13]*c,this.z=S[2]*s+S[6]*a+S[10]*r+S[14]*c,this.w=S[3]*s+S[7]*a+S[11]*r+S[15]*c,this}divideScalar(i){return this.multiplyScalar(1/i)}setAxisAngleFromQuaternion(i){this.w=2*Math.acos(i.w);const s=Math.sqrt(1-i.w*i.w);return s<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=i.x/s,this.y=i.y/s,this.z=i.z/s),this}setAxisAngleFromRotationMatrix(i){let s,a,r,c;const A=i.elements,U=A[0],B=A[4],D=A[8],R=A[1],W=A[5],j=A[9],H=A[2],I=A[6],Q=A[10];if(Math.abs(B-R)<.01&&Math.abs(D-H)<.01&&Math.abs(j-I)<.01){if(Math.abs(B+R)<.1&&Math.abs(D+H)<.1&&Math.abs(j+I)<.1&&Math.abs(U+W+Q-3)<.1)return this.set(1,0,0,0),this;s=Math.PI;const q=(U+1)/2,ae=(W+1)/2,oe=(Q+1)/2,ye=(B+R)/4,_e=(D+H)/4,pe=(j+I)/4;return q>ae&&q>oe?q<.01?(a=0,r=.707106781,c=.707106781):(a=Math.sqrt(q),r=ye/a,c=_e/a):ae>oe?ae<.01?(a=.707106781,r=0,c=.707106781):(r=Math.sqrt(ae),a=ye/r,c=pe/r):oe<.01?(a=.707106781,r=.707106781,c=0):(c=Math.sqrt(oe),a=_e/c,r=pe/c),this.set(a,r,c,s),this}let Y=Math.sqrt((I-j)*(I-j)+(D-H)*(D-H)+(R-B)*(R-B));return Math.abs(Y)<.001&&(Y=1),this.x=(I-j)/Y,this.y=(D-H)/Y,this.z=(R-B)/Y,this.w=Math.acos((U+W+Q-1)/2),this}min(i){return this.x=Math.min(this.x,i.x),this.y=Math.min(this.y,i.y),this.z=Math.min(this.z,i.z),this.w=Math.min(this.w,i.w),this}max(i){return this.x=Math.max(this.x,i.x),this.y=Math.max(this.y,i.y),this.z=Math.max(this.z,i.z),this.w=Math.max(this.w,i.w),this}clamp(i,s){return this.x=Math.max(i.x,Math.min(s.x,this.x)),this.y=Math.max(i.y,Math.min(s.y,this.y)),this.z=Math.max(i.z,Math.min(s.z,this.z)),this.w=Math.max(i.w,Math.min(s.w,this.w)),this}clampScalar(i,s){return this.x=Math.max(i,Math.min(s,this.x)),this.y=Math.max(i,Math.min(s,this.y)),this.z=Math.max(i,Math.min(s,this.z)),this.w=Math.max(i,Math.min(s,this.w)),this}clampLength(i,s){const a=this.length();return this.divideScalar(a||1).multiplyScalar(Math.max(i,Math.min(s,a)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(i){return this.x*i.x+this.y*i.y+this.z*i.z+this.w*i.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(i){return this.normalize().multiplyScalar(i)}lerp(i,s){return this.x+=(i.x-this.x)*s,this.y+=(i.y-this.y)*s,this.z+=(i.z-this.z)*s,this.w+=(i.w-this.w)*s,this}lerpVectors(i,s,a){return this.x=i.x+(s.x-i.x)*a,this.y=i.y+(s.y-i.y)*a,this.z=i.z+(s.z-i.z)*a,this.w=i.w+(s.w-i.w)*a,this}equals(i){return i.x===this.x&&i.y===this.y&&i.z===this.z&&i.w===this.w}fromArray(i,s=0){return this.x=i[s],this.y=i[s+1],this.z=i[s+2],this.w=i[s+3],this}toArray(i=[],s=0){return i[s]=this.x,i[s+1]=this.y,i[s+2]=this.z,i[s+3]=this.w,i}fromBufferAttribute(i,s){return this.x=i.getX(s),this.y=i.getY(s),this.z=i.getZ(s),this.w=i.getW(s),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class xw extends rx{constructor(i=1,s=1,a={}){super(),this.isWebGLRenderTarget=!0,this.width=i,this.height=s,this.depth=1,this.scissor=new wu(0,0,i,s),this.scissorTest=!1,this.viewport=new wu(0,0,i,s);const r={width:i,height:s,depth:1};this.texture=new jp(r,a.mapping,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=a.generateMipmaps!==void 0?a.generateMipmaps:!1,this.texture.internalFormat=a.internalFormat!==void 0?a.internalFormat:null,this.texture.minFilter=a.minFilter!==void 0?a.minFilter:Np,this.depthBuffer=a.depthBuffer!==void 0?a.depthBuffer:!0,this.stencilBuffer=a.stencilBuffer!==void 0?a.stencilBuffer:!1,this.depthTexture=a.depthTexture!==void 0?a.depthTexture:null,this.samples=a.samples!==void 0?a.samples:0}setSize(i,s,a=1){(this.width!==i||this.height!==s||this.depth!==a)&&(this.width=i,this.height=s,this.depth=a,this.texture.image.width=i,this.texture.image.height=s,this.texture.image.depth=a,this.dispose()),this.viewport.set(0,0,i,s),this.scissor.set(0,0,i,s)}clone(){return new this.constructor().copy(this)}copy(i){this.width=i.width,this.height=i.height,this.depth=i.depth,this.viewport.copy(i.viewport),this.texture=i.texture.clone(),this.texture.isRenderTargetTexture=!0;const s=Object.assign({},i.texture.image);return this.texture.source=new Eq(s),this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,i.depthTexture!==null&&(this.depthTexture=i.depthTexture.clone()),this.samples=i.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Sq extends jp{constructor(i=null,s=1,a=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:i,width:s,height:a,depth:r},this.magFilter=wh,this.minFilter=wh,this.wrapR=tv,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class _ce extends jp{constructor(i=null,s=1,a=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:i,width:s,height:a,depth:r},this.magFilter=wh,this.minFilter=wh,this.wrapR=tv,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Qb{constructor(i=0,s=0,a=0,r=1){this.isQuaternion=!0,this._x=i,this._y=s,this._z=a,this._w=r}static slerpFlat(i,s,a,r,c,S,E){let A=a[r+0],U=a[r+1],B=a[r+2],D=a[r+3];const R=c[S+0],W=c[S+1],j=c[S+2],H=c[S+3];if(E===0){i[s+0]=A,i[s+1]=U,i[s+2]=B,i[s+3]=D;return}if(E===1){i[s+0]=R,i[s+1]=W,i[s+2]=j,i[s+3]=H;return}if(D!==H||A!==R||U!==W||B!==j){let I=1-E;const Q=A*R+U*W+B*j+D*H,Y=Q>=0?1:-1,q=1-Q*Q;if(q>Number.EPSILON){const oe=Math.sqrt(q),ye=Math.atan2(oe,Q*Y);I=Math.sin(I*ye)/oe,E=Math.sin(E*ye)/oe}const ae=E*Y;if(A=A*I+R*ae,U=U*I+W*ae,B=B*I+j*ae,D=D*I+H*ae,I===1-E){const oe=1/Math.sqrt(A*A+U*U+B*B+D*D);A*=oe,U*=oe,B*=oe,D*=oe}}i[s]=A,i[s+1]=U,i[s+2]=B,i[s+3]=D}static multiplyQuaternionsFlat(i,s,a,r,c,S){const E=a[r],A=a[r+1],U=a[r+2],B=a[r+3],D=c[S],R=c[S+1],W=c[S+2],j=c[S+3];return i[s]=E*j+B*D+A*W-U*R,i[s+1]=A*j+B*R+U*D-E*W,i[s+2]=U*j+B*W+E*R-A*D,i[s+3]=B*j-E*D-A*R-U*W,i}get x(){return this._x}set x(i){this._x=i,this._onChangeCallback()}get y(){return this._y}set y(i){this._y=i,this._onChangeCallback()}get z(){return this._z}set z(i){this._z=i,this._onChangeCallback()}get w(){return this._w}set w(i){this._w=i,this._onChangeCallback()}set(i,s,a,r){return this._x=i,this._y=s,this._z=a,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(i){return this._x=i.x,this._y=i.y,this._z=i.z,this._w=i.w,this._onChangeCallback(),this}setFromEuler(i,s){const a=i._x,r=i._y,c=i._z,S=i._order,E=Math.cos,A=Math.sin,U=E(a/2),B=E(r/2),D=E(c/2),R=A(a/2),W=A(r/2),j=A(c/2);switch(S){case"XYZ":this._x=R*B*D+U*W*j,this._y=U*W*D-R*B*j,this._z=U*B*j+R*W*D,this._w=U*B*D-R*W*j;break;case"YXZ":this._x=R*B*D+U*W*j,this._y=U*W*D-R*B*j,this._z=U*B*j-R*W*D,this._w=U*B*D+R*W*j;break;case"ZXY":this._x=R*B*D-U*W*j,this._y=U*W*D+R*B*j,this._z=U*B*j+R*W*D,this._w=U*B*D-R*W*j;break;case"ZYX":this._x=R*B*D-U*W*j,this._y=U*W*D+R*B*j,this._z=U*B*j-R*W*D,this._w=U*B*D+R*W*j;break;case"YZX":this._x=R*B*D+U*W*j,this._y=U*W*D+R*B*j,this._z=U*B*j-R*W*D,this._w=U*B*D-R*W*j;break;case"XZY":this._x=R*B*D-U*W*j,this._y=U*W*D-R*B*j,this._z=U*B*j+R*W*D,this._w=U*B*D+R*W*j;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+S)}return s!==!1&&this._onChangeCallback(),this}setFromAxisAngle(i,s){const a=s/2,r=Math.sin(a);return this._x=i.x*r,this._y=i.y*r,this._z=i.z*r,this._w=Math.cos(a),this._onChangeCallback(),this}setFromRotationMatrix(i){const s=i.elements,a=s[0],r=s[4],c=s[8],S=s[1],E=s[5],A=s[9],U=s[2],B=s[6],D=s[10],R=a+E+D;if(R>0){const W=.5/Math.sqrt(R+1);this._w=.25/W,this._x=(B-A)*W,this._y=(c-U)*W,this._z=(S-r)*W}else if(a>E&&a>D){const W=2*Math.sqrt(1+a-E-D);this._w=(B-A)/W,this._x=.25*W,this._y=(r+S)/W,this._z=(c+U)/W}else if(E>D){const W=2*Math.sqrt(1+E-a-D);this._w=(c-U)/W,this._x=(r+S)/W,this._y=.25*W,this._z=(A+B)/W}else{const W=2*Math.sqrt(1+D-a-E);this._w=(S-r)/W,this._x=(c+U)/W,this._y=(A+B)/W,this._z=.25*W}return this._onChangeCallback(),this}setFromUnitVectors(i,s){let a=i.dot(s)+1;return a<Number.EPSILON?(a=0,Math.abs(i.x)>Math.abs(i.z)?(this._x=-i.y,this._y=i.x,this._z=0,this._w=a):(this._x=0,this._y=-i.z,this._z=i.y,this._w=a)):(this._x=i.y*s.z-i.z*s.y,this._y=i.z*s.x-i.x*s.z,this._z=i.x*s.y-i.y*s.x,this._w=a),this.normalize()}angleTo(i){return 2*Math.acos(Math.abs(Ip(this.dot(i),-1,1)))}rotateTowards(i,s){const a=this.angleTo(i);if(a===0)return this;const r=Math.min(1,s/a);return this.slerp(i,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(i){return this._x*i._x+this._y*i._y+this._z*i._z+this._w*i._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let i=this.length();return i===0?(this._x=0,this._y=0,this._z=0,this._w=1):(i=1/i,this._x=this._x*i,this._y=this._y*i,this._z=this._z*i,this._w=this._w*i),this._onChangeCallback(),this}multiply(i){return this.multiplyQuaternions(this,i)}premultiply(i){return this.multiplyQuaternions(i,this)}multiplyQuaternions(i,s){const a=i._x,r=i._y,c=i._z,S=i._w,E=s._x,A=s._y,U=s._z,B=s._w;return this._x=a*B+S*E+r*U-c*A,this._y=r*B+S*A+c*E-a*U,this._z=c*B+S*U+a*A-r*E,this._w=S*B-a*E-r*A-c*U,this._onChangeCallback(),this}slerp(i,s){if(s===0)return this;if(s===1)return this.copy(i);const a=this._x,r=this._y,c=this._z,S=this._w;let E=S*i._w+a*i._x+r*i._y+c*i._z;if(E<0?(this._w=-i._w,this._x=-i._x,this._y=-i._y,this._z=-i._z,E=-E):this.copy(i),E>=1)return this._w=S,this._x=a,this._y=r,this._z=c,this;const A=1-E*E;if(A<=Number.EPSILON){const W=1-s;return this._w=W*S+s*this._w,this._x=W*a+s*this._x,this._y=W*r+s*this._y,this._z=W*c+s*this._z,this.normalize(),this._onChangeCallback(),this}const U=Math.sqrt(A),B=Math.atan2(U,E),D=Math.sin((1-s)*B)/U,R=Math.sin(s*B)/U;return this._w=S*D+this._w*R,this._x=a*D+this._x*R,this._y=r*D+this._y*R,this._z=c*D+this._z*R,this._onChangeCallback(),this}slerpQuaternions(i,s,a){return this.copy(i).slerp(s,a)}random(){const i=Math.random(),s=Math.sqrt(1-i),a=Math.sqrt(i),r=2*Math.PI*Math.random(),c=2*Math.PI*Math.random();return this.set(s*Math.cos(r),a*Math.sin(c),a*Math.cos(c),s*Math.sin(r))}equals(i){return i._x===this._x&&i._y===this._y&&i._z===this._z&&i._w===this._w}fromArray(i,s=0){return this._x=i[s],this._y=i[s+1],this._z=i[s+2],this._w=i[s+3],this._onChangeCallback(),this}toArray(i=[],s=0){return i[s]=this._x,i[s+1]=this._y,i[s+2]=this._z,i[s+3]=this._w,i}fromBufferAttribute(i,s){return this._x=i.getX(s),this._y=i.getY(s),this._z=i.getZ(s),this._w=i.getW(s),this}_onChange(i){return this._onChangeCallback=i,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class cr{constructor(i=0,s=0,a=0){cr.prototype.isVector3=!0,this.x=i,this.y=s,this.z=a}set(i,s,a){return a===void 0&&(a=this.z),this.x=i,this.y=s,this.z=a,this}setScalar(i){return this.x=i,this.y=i,this.z=i,this}setX(i){return this.x=i,this}setY(i){return this.y=i,this}setZ(i){return this.z=i,this}setComponent(i,s){switch(i){case 0:this.x=s;break;case 1:this.y=s;break;case 2:this.z=s;break;default:throw new Error("index is out of range: "+i)}return this}getComponent(i){switch(i){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+i)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(i){return this.x=i.x,this.y=i.y,this.z=i.z,this}add(i){return this.x+=i.x,this.y+=i.y,this.z+=i.z,this}addScalar(i){return this.x+=i,this.y+=i,this.z+=i,this}addVectors(i,s){return this.x=i.x+s.x,this.y=i.y+s.y,this.z=i.z+s.z,this}addScaledVector(i,s){return this.x+=i.x*s,this.y+=i.y*s,this.z+=i.z*s,this}sub(i){return this.x-=i.x,this.y-=i.y,this.z-=i.z,this}subScalar(i){return this.x-=i,this.y-=i,this.z-=i,this}subVectors(i,s){return this.x=i.x-s.x,this.y=i.y-s.y,this.z=i.z-s.z,this}multiply(i){return this.x*=i.x,this.y*=i.y,this.z*=i.z,this}multiplyScalar(i){return this.x*=i,this.y*=i,this.z*=i,this}multiplyVectors(i,s){return this.x=i.x*s.x,this.y=i.y*s.y,this.z=i.z*s.z,this}applyEuler(i){return this.applyQuaternion(ZW.setFromEuler(i))}applyAxisAngle(i,s){return this.applyQuaternion(ZW.setFromAxisAngle(i,s))}applyMatrix3(i){const s=this.x,a=this.y,r=this.z,c=i.elements;return this.x=c[0]*s+c[3]*a+c[6]*r,this.y=c[1]*s+c[4]*a+c[7]*r,this.z=c[2]*s+c[5]*a+c[8]*r,this}applyNormalMatrix(i){return this.applyMatrix3(i).normalize()}applyMatrix4(i){const s=this.x,a=this.y,r=this.z,c=i.elements,S=1/(c[3]*s+c[7]*a+c[11]*r+c[15]);return this.x=(c[0]*s+c[4]*a+c[8]*r+c[12])*S,this.y=(c[1]*s+c[5]*a+c[9]*r+c[13])*S,this.z=(c[2]*s+c[6]*a+c[10]*r+c[14])*S,this}applyQuaternion(i){const s=this.x,a=this.y,r=this.z,c=i.x,S=i.y,E=i.z,A=i.w,U=A*s+S*r-E*a,B=A*a+E*s-c*r,D=A*r+c*a-S*s,R=-c*s-S*a-E*r;return this.x=U*A+R*-c+B*-E-D*-S,this.y=B*A+R*-S+D*-c-U*-E,this.z=D*A+R*-E+U*-S-B*-c,this}project(i){return this.applyMatrix4(i.matrixWorldInverse).applyMatrix4(i.projectionMatrix)}unproject(i){return this.applyMatrix4(i.projectionMatrixInverse).applyMatrix4(i.matrixWorld)}transformDirection(i){const s=this.x,a=this.y,r=this.z,c=i.elements;return this.x=c[0]*s+c[4]*a+c[8]*r,this.y=c[1]*s+c[5]*a+c[9]*r,this.z=c[2]*s+c[6]*a+c[10]*r,this.normalize()}divide(i){return this.x/=i.x,this.y/=i.y,this.z/=i.z,this}divideScalar(i){return this.multiplyScalar(1/i)}min(i){return this.x=Math.min(this.x,i.x),this.y=Math.min(this.y,i.y),this.z=Math.min(this.z,i.z),this}max(i){return this.x=Math.max(this.x,i.x),this.y=Math.max(this.y,i.y),this.z=Math.max(this.z,i.z),this}clamp(i,s){return this.x=Math.max(i.x,Math.min(s.x,this.x)),this.y=Math.max(i.y,Math.min(s.y,this.y)),this.z=Math.max(i.z,Math.min(s.z,this.z)),this}clampScalar(i,s){return this.x=Math.max(i,Math.min(s,this.x)),this.y=Math.max(i,Math.min(s,this.y)),this.z=Math.max(i,Math.min(s,this.z)),this}clampLength(i,s){const a=this.length();return this.divideScalar(a||1).multiplyScalar(Math.max(i,Math.min(s,a)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(i){return this.x*i.x+this.y*i.y+this.z*i.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(i){return this.normalize().multiplyScalar(i)}lerp(i,s){return this.x+=(i.x-this.x)*s,this.y+=(i.y-this.y)*s,this.z+=(i.z-this.z)*s,this}lerpVectors(i,s,a){return this.x=i.x+(s.x-i.x)*a,this.y=i.y+(s.y-i.y)*a,this.z=i.z+(s.z-i.z)*a,this}cross(i){return this.crossVectors(this,i)}crossVectors(i,s){const a=i.x,r=i.y,c=i.z,S=s.x,E=s.y,A=s.z;return this.x=r*A-c*E,this.y=c*S-a*A,this.z=a*E-r*S,this}projectOnVector(i){const s=i.lengthSq();if(s===0)return this.set(0,0,0);const a=i.dot(this)/s;return this.copy(i).multiplyScalar(a)}projectOnPlane(i){return aF.copy(this).projectOnVector(i),this.sub(aF)}reflect(i){return this.sub(aF.copy(i).multiplyScalar(2*this.dot(i)))}angleTo(i){const s=Math.sqrt(this.lengthSq()*i.lengthSq());if(s===0)return Math.PI/2;const a=this.dot(i)/s;return Math.acos(Ip(a,-1,1))}distanceTo(i){return Math.sqrt(this.distanceToSquared(i))}distanceToSquared(i){const s=this.x-i.x,a=this.y-i.y,r=this.z-i.z;return s*s+a*a+r*r}manhattanDistanceTo(i){return Math.abs(this.x-i.x)+Math.abs(this.y-i.y)+Math.abs(this.z-i.z)}setFromSpherical(i){return this.setFromSphericalCoords(i.radius,i.phi,i.theta)}setFromSphericalCoords(i,s,a){const r=Math.sin(s)*i;return this.x=r*Math.sin(a),this.y=Math.cos(s)*i,this.z=r*Math.cos(a),this}setFromCylindrical(i){return this.setFromCylindricalCoords(i.radius,i.theta,i.y)}setFromCylindricalCoords(i,s,a){return this.x=i*Math.sin(s),this.y=a,this.z=i*Math.cos(s),this}setFromMatrixPosition(i){const s=i.elements;return this.x=s[12],this.y=s[13],this.z=s[14],this}setFromMatrixScale(i){const s=this.setFromMatrixColumn(i,0).length(),a=this.setFromMatrixColumn(i,1).length(),r=this.setFromMatrixColumn(i,2).length();return this.x=s,this.y=a,this.z=r,this}setFromMatrixColumn(i,s){return this.fromArray(i.elements,s*4)}setFromMatrix3Column(i,s){return this.fromArray(i.elements,s*3)}setFromEuler(i){return this.x=i._x,this.y=i._y,this.z=i._z,this}equals(i){return i.x===this.x&&i.y===this.y&&i.z===this.z}fromArray(i,s=0){return this.x=i[s],this.y=i[s+1],this.z=i[s+2],this}toArray(i=[],s=0){return i[s]=this.x,i[s+1]=this.y,i[s+2]=this.z,i}fromBufferAttribute(i,s){return this.x=i.getX(s),this.y=i.getY(s),this.z=i.getZ(s),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const i=(Math.random()-.5)*2,s=Math.random()*Math.PI*2,a=Math.sqrt(1-i**2);return this.x=a*Math.cos(s),this.y=a*Math.sin(s),this.z=i,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const aF=new cr,ZW=new Qb;class vC{constructor(i=new cr(1/0,1/0,1/0),s=new cr(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=i,this.max=s}set(i,s){return this.min.copy(i),this.max.copy(s),this}setFromArray(i){let s=1/0,a=1/0,r=1/0,c=-1/0,S=-1/0,E=-1/0;for(let A=0,U=i.length;A<U;A+=3){const B=i[A],D=i[A+1],R=i[A+2];B<s&&(s=B),D<a&&(a=D),R<r&&(r=R),B>c&&(c=B),D>S&&(S=D),R>E&&(E=R)}return this.min.set(s,a,r),this.max.set(c,S,E),this}setFromBufferAttribute(i){let s=1/0,a=1/0,r=1/0,c=-1/0,S=-1/0,E=-1/0;for(let A=0,U=i.count;A<U;A++){const B=i.getX(A),D=i.getY(A),R=i.getZ(A);B<s&&(s=B),D<a&&(a=D),R<r&&(r=R),B>c&&(c=B),D>S&&(S=D),R>E&&(E=R)}return this.min.set(s,a,r),this.max.set(c,S,E),this}setFromPoints(i){this.makeEmpty();for(let s=0,a=i.length;s<a;s++)this.expandByPoint(i[s]);return this}setFromCenterAndSize(i,s){const a=Kx.copy(s).multiplyScalar(.5);return this.min.copy(i).sub(a),this.max.copy(i).add(a),this}setFromObject(i,s=!1){return this.makeEmpty(),this.expandByObject(i,s)}clone(){return new this.constructor().copy(this)}copy(i){return this.min.copy(i.min),this.max.copy(i.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(i){return this.isEmpty()?i.set(0,0,0):i.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(i){return this.isEmpty()?i.set(0,0,0):i.subVectors(this.max,this.min)}expandByPoint(i){return this.min.min(i),this.max.max(i),this}expandByVector(i){return this.min.sub(i),this.max.add(i),this}expandByScalar(i){return this.min.addScalar(-i),this.max.addScalar(i),this}expandByObject(i,s=!1){i.updateWorldMatrix(!1,!1);const a=i.geometry;if(a!==void 0)if(s&&a.attributes!=null&&a.attributes.position!==void 0){const c=a.attributes.position;for(let S=0,E=c.count;S<E;S++)Kx.fromBufferAttribute(c,S).applyMatrix4(i.matrixWorld),this.expandByPoint(Kx)}else a.boundingBox===null&&a.computeBoundingBox(),sF.copy(a.boundingBox),sF.applyMatrix4(i.matrixWorld),this.union(sF);const r=i.children;for(let c=0,S=r.length;c<S;c++)this.expandByObject(r[c],s);return this}containsPoint(i){return!(i.x<this.min.x||i.x>this.max.x||i.y<this.min.y||i.y>this.max.y||i.z<this.min.z||i.z>this.max.z)}containsBox(i){return this.min.x<=i.min.x&&i.max.x<=this.max.x&&this.min.y<=i.min.y&&i.max.y<=this.max.y&&this.min.z<=i.min.z&&i.max.z<=this.max.z}getParameter(i,s){return s.set((i.x-this.min.x)/(this.max.x-this.min.x),(i.y-this.min.y)/(this.max.y-this.min.y),(i.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(i){return!(i.max.x<this.min.x||i.min.x>this.max.x||i.max.y<this.min.y||i.min.y>this.max.y||i.max.z<this.min.z||i.min.z>this.max.z)}intersectsSphere(i){return this.clampPoint(i.center,Kx),Kx.distanceToSquared(i.center)<=i.radius*i.radius}intersectsPlane(i){let s,a;return i.normal.x>0?(s=i.normal.x*this.min.x,a=i.normal.x*this.max.x):(s=i.normal.x*this.max.x,a=i.normal.x*this.min.x),i.normal.y>0?(s+=i.normal.y*this.min.y,a+=i.normal.y*this.max.y):(s+=i.normal.y*this.max.y,a+=i.normal.y*this.min.y),i.normal.z>0?(s+=i.normal.z*this.min.z,a+=i.normal.z*this.max.z):(s+=i.normal.z*this.max.z,a+=i.normal.z*this.min.z),s<=-i.constant&&a>=-i.constant}intersectsTriangle(i){if(this.isEmpty())return!1;this.getCenter(mS),ZA.subVectors(this.max,mS),w2.subVectors(i.a,mS),_2.subVectors(i.b,mS),E2.subVectors(i.c,mS),Db.subVectors(_2,w2),Nb.subVectors(E2,_2),Yx.subVectors(w2,E2);let s=[0,-Db.z,Db.y,0,-Nb.z,Nb.y,0,-Yx.z,Yx.y,Db.z,0,-Db.x,Nb.z,0,-Nb.x,Yx.z,0,-Yx.x,-Db.y,Db.x,0,-Nb.y,Nb.x,0,-Yx.y,Yx.x,0];return!uF(s,w2,_2,E2,ZA)||(s=[1,0,0,0,1,0,0,0,1],!uF(s,w2,_2,E2,ZA))?!1:(eO.crossVectors(Db,Nb),s=[eO.x,eO.y,eO.z],uF(s,w2,_2,E2,ZA))}clampPoint(i,s){return s.copy(i).clamp(this.min,this.max)}distanceToPoint(i){return Kx.copy(i).clamp(this.min,this.max).sub(i).length()}getBoundingSphere(i){return this.getCenter(i.center),i.radius=this.getSize(Kx).length()*.5,i}intersect(i){return this.min.max(i.min),this.max.min(i.max),this.isEmpty()&&this.makeEmpty(),this}union(i){return this.min.min(i.min),this.max.max(i.max),this}applyMatrix4(i){return this.isEmpty()?this:(w1[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(i),w1[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(i),w1[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(i),w1[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(i),w1[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(i),w1[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(i),w1[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(i),w1[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(i),this.setFromPoints(w1),this)}translate(i){return this.min.add(i),this.max.add(i),this}equals(i){return i.min.equals(this.min)&&i.max.equals(this.max)}}const w1=[new cr,new cr,new cr,new cr,new cr,new cr,new cr,new cr],Kx=new cr,sF=new vC,w2=new cr,_2=new cr,E2=new cr,Db=new cr,Nb=new cr,Yx=new cr,mS=new cr,ZA=new cr,eO=new cr,Jx=new cr;function uF(h,i,s,a,r){for(let c=0,S=h.length-3;c<=S;c+=3){Jx.fromArray(h,c);const E=r.x*Math.abs(Jx.x)+r.y*Math.abs(Jx.y)+r.z*Math.abs(Jx.z),A=i.dot(Jx),U=s.dot(Jx),B=a.dot(Jx);if(Math.max(-Math.max(A,U,B),Math.min(A,U,B))>E)return!1}return!0}const Ece=new vC,gS=new cr,cF=new cr;class kT{constructor(i=new cr,s=-1){this.center=i,this.radius=s}set(i,s){return this.center.copy(i),this.radius=s,this}setFromPoints(i,s){const a=this.center;s!==void 0?a.copy(s):Ece.setFromPoints(i).getCenter(a);let r=0;for(let c=0,S=i.length;c<S;c++)r=Math.max(r,a.distanceToSquared(i[c]));return this.radius=Math.sqrt(r),this}copy(i){return this.center.copy(i.center),this.radius=i.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(i){return i.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(i){return i.distanceTo(this.center)-this.radius}intersectsSphere(i){const s=this.radius+i.radius;return i.center.distanceToSquared(this.center)<=s*s}intersectsBox(i){return i.intersectsSphere(this)}intersectsPlane(i){return Math.abs(i.distanceToPoint(this.center))<=this.radius}clampPoint(i,s){const a=this.center.distanceToSquared(i);return s.copy(i),a>this.radius*this.radius&&(s.sub(this.center).normalize(),s.multiplyScalar(this.radius).add(this.center)),s}getBoundingBox(i){return this.isEmpty()?(i.makeEmpty(),i):(i.set(this.center,this.center),i.expandByScalar(this.radius),i)}applyMatrix4(i){return this.center.applyMatrix4(i),this.radius=this.radius*i.getMaxScaleOnAxis(),this}translate(i){return this.center.add(i),this}expandByPoint(i){if(this.isEmpty())return this.center.copy(i),this.radius=0,this;gS.subVectors(i,this.center);const s=gS.lengthSq();if(s>this.radius*this.radius){const a=Math.sqrt(s),r=(a-this.radius)*.5;this.center.addScaledVector(gS,r/a),this.radius+=r}return this}union(i){return i.isEmpty()?this:this.isEmpty()?(this.copy(i),this):(this.center.equals(i.center)===!0?this.radius=Math.max(this.radius,i.radius):(cF.subVectors(i.center,this.center).setLength(i.radius),this.expandByPoint(gS.copy(i.center).add(cF)),this.expandByPoint(gS.copy(i.center).sub(cF))),this)}equals(i){return i.center.equals(this.center)&&i.radius===this.radius}clone(){return new this.constructor().copy(this)}}const _1=new cr,lF=new cr,tO=new cr,Ib=new cr,fF=new cr,nO=new cr,dF=new cr;class Cq{constructor(i=new cr,s=new cr(0,0,-1)){this.origin=i,this.direction=s}set(i,s){return this.origin.copy(i),this.direction.copy(s),this}copy(i){return this.origin.copy(i.origin),this.direction.copy(i.direction),this}at(i,s){return s.copy(this.direction).multiplyScalar(i).add(this.origin)}lookAt(i){return this.direction.copy(i).sub(this.origin).normalize(),this}recast(i){return this.origin.copy(this.at(i,_1)),this}closestPointToPoint(i,s){s.subVectors(i,this.origin);const a=s.dot(this.direction);return a<0?s.copy(this.origin):s.copy(this.direction).multiplyScalar(a).add(this.origin)}distanceToPoint(i){return Math.sqrt(this.distanceSqToPoint(i))}distanceSqToPoint(i){const s=_1.subVectors(i,this.origin).dot(this.direction);return s<0?this.origin.distanceToSquared(i):(_1.copy(this.direction).multiplyScalar(s).add(this.origin),_1.distanceToSquared(i))}distanceSqToSegment(i,s,a,r){lF.copy(i).add(s).multiplyScalar(.5),tO.copy(s).sub(i).normalize(),Ib.copy(this.origin).sub(lF);const c=i.distanceTo(s)*.5,S=-this.direction.dot(tO),E=Ib.dot(this.direction),A=-Ib.dot(tO),U=Ib.lengthSq(),B=Math.abs(1-S*S);let D,R,W,j;if(B>0)if(D=S*A-E,R=S*E-A,j=c*B,D>=0)if(R>=-j)if(R<=j){const H=1/B;D*=H,R*=H,W=D*(D+S*R+2*E)+R*(S*D+R+2*A)+U}else R=c,D=Math.max(0,-(S*R+E)),W=-D*D+R*(R+2*A)+U;else R=-c,D=Math.max(0,-(S*R+E)),W=-D*D+R*(R+2*A)+U;else R<=-j?(D=Math.max(0,-(-S*c+E)),R=D>0?-c:Math.min(Math.max(-c,-A),c),W=-D*D+R*(R+2*A)+U):R<=j?(D=0,R=Math.min(Math.max(-c,-A),c),W=R*(R+2*A)+U):(D=Math.max(0,-(S*c+E)),R=D>0?c:Math.min(Math.max(-c,-A),c),W=-D*D+R*(R+2*A)+U);else R=S>0?-c:c,D=Math.max(0,-(S*R+E)),W=-D*D+R*(R+2*A)+U;return a&&a.copy(this.direction).multiplyScalar(D).add(this.origin),r&&r.copy(tO).multiplyScalar(R).add(lF),W}intersectSphere(i,s){_1.subVectors(i.center,this.origin);const a=_1.dot(this.direction),r=_1.dot(_1)-a*a,c=i.radius*i.radius;if(r>c)return null;const S=Math.sqrt(c-r),E=a-S,A=a+S;return E<0&&A<0?null:E<0?this.at(A,s):this.at(E,s)}intersectsSphere(i){return this.distanceSqToPoint(i.center)<=i.radius*i.radius}distanceToPlane(i){const s=i.normal.dot(this.direction);if(s===0)return i.distanceToPoint(this.origin)===0?0:null;const a=-(this.origin.dot(i.normal)+i.constant)/s;return a>=0?a:null}intersectPlane(i,s){const a=this.distanceToPlane(i);return a===null?null:this.at(a,s)}intersectsPlane(i){const s=i.distanceToPoint(this.origin);return s===0||i.normal.dot(this.direction)*s<0}intersectBox(i,s){let a,r,c,S,E,A;const U=1/this.direction.x,B=1/this.direction.y,D=1/this.direction.z,R=this.origin;return U>=0?(a=(i.min.x-R.x)*U,r=(i.max.x-R.x)*U):(a=(i.max.x-R.x)*U,r=(i.min.x-R.x)*U),B>=0?(c=(i.min.y-R.y)*B,S=(i.max.y-R.y)*B):(c=(i.max.y-R.y)*B,S=(i.min.y-R.y)*B),a>S||c>r||((c>a||isNaN(a))&&(a=c),(S<r||isNaN(r))&&(r=S),D>=0?(E=(i.min.z-R.z)*D,A=(i.max.z-R.z)*D):(E=(i.max.z-R.z)*D,A=(i.min.z-R.z)*D),a>A||E>r)||((E>a||a!==a)&&(a=E),(A<r||r!==r)&&(r=A),r<0)?null:this.at(a>=0?a:r,s)}intersectsBox(i){return this.intersectBox(i,_1)!==null}intersectTriangle(i,s,a,r,c){fF.subVectors(s,i),nO.subVectors(a,i),dF.crossVectors(fF,nO);let S=this.direction.dot(dF),E;if(S>0){if(r)return null;E=1}else if(S<0)E=-1,S=-S;else return null;Ib.subVectors(this.origin,i);const A=E*this.direction.dot(nO.crossVectors(Ib,nO));if(A<0)return null;const U=E*this.direction.dot(fF.cross(Ib));if(U<0||A+U>S)return null;const B=-E*Ib.dot(dF);return B<0?null:this.at(B/S,c)}applyMatrix4(i){return this.origin.applyMatrix4(i),this.direction.transformDirection(i),this}equals(i){return i.origin.equals(this.origin)&&i.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class lc{constructor(){lc.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(i,s,a,r,c,S,E,A,U,B,D,R,W,j,H,I){const Q=this.elements;return Q[0]=i,Q[4]=s,Q[8]=a,Q[12]=r,Q[1]=c,Q[5]=S,Q[9]=E,Q[13]=A,Q[2]=U,Q[6]=B,Q[10]=D,Q[14]=R,Q[3]=W,Q[7]=j,Q[11]=H,Q[15]=I,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new lc().fromArray(this.elements)}copy(i){const s=this.elements,a=i.elements;return s[0]=a[0],s[1]=a[1],s[2]=a[2],s[3]=a[3],s[4]=a[4],s[5]=a[5],s[6]=a[6],s[7]=a[7],s[8]=a[8],s[9]=a[9],s[10]=a[10],s[11]=a[11],s[12]=a[12],s[13]=a[13],s[14]=a[14],s[15]=a[15],this}copyPosition(i){const s=this.elements,a=i.elements;return s[12]=a[12],s[13]=a[13],s[14]=a[14],this}setFromMatrix3(i){const s=i.elements;return this.set(s[0],s[3],s[6],0,s[1],s[4],s[7],0,s[2],s[5],s[8],0,0,0,0,1),this}extractBasis(i,s,a){return i.setFromMatrixColumn(this,0),s.setFromMatrixColumn(this,1),a.setFromMatrixColumn(this,2),this}makeBasis(i,s,a){return this.set(i.x,s.x,a.x,0,i.y,s.y,a.y,0,i.z,s.z,a.z,0,0,0,0,1),this}extractRotation(i){const s=this.elements,a=i.elements,r=1/S2.setFromMatrixColumn(i,0).length(),c=1/S2.setFromMatrixColumn(i,1).length(),S=1/S2.setFromMatrixColumn(i,2).length();return s[0]=a[0]*r,s[1]=a[1]*r,s[2]=a[2]*r,s[3]=0,s[4]=a[4]*c,s[5]=a[5]*c,s[6]=a[6]*c,s[7]=0,s[8]=a[8]*S,s[9]=a[9]*S,s[10]=a[10]*S,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,this}makeRotationFromEuler(i){const s=this.elements,a=i.x,r=i.y,c=i.z,S=Math.cos(a),E=Math.sin(a),A=Math.cos(r),U=Math.sin(r),B=Math.cos(c),D=Math.sin(c);if(i.order==="XYZ"){const R=S*B,W=S*D,j=E*B,H=E*D;s[0]=A*B,s[4]=-A*D,s[8]=U,s[1]=W+j*U,s[5]=R-H*U,s[9]=-E*A,s[2]=H-R*U,s[6]=j+W*U,s[10]=S*A}else if(i.order==="YXZ"){const R=A*B,W=A*D,j=U*B,H=U*D;s[0]=R+H*E,s[4]=j*E-W,s[8]=S*U,s[1]=S*D,s[5]=S*B,s[9]=-E,s[2]=W*E-j,s[6]=H+R*E,s[10]=S*A}else if(i.order==="ZXY"){const R=A*B,W=A*D,j=U*B,H=U*D;s[0]=R-H*E,s[4]=-S*D,s[8]=j+W*E,s[1]=W+j*E,s[5]=S*B,s[9]=H-R*E,s[2]=-S*U,s[6]=E,s[10]=S*A}else if(i.order==="ZYX"){const R=S*B,W=S*D,j=E*B,H=E*D;s[0]=A*B,s[4]=j*U-W,s[8]=R*U+H,s[1]=A*D,s[5]=H*U+R,s[9]=W*U-j,s[2]=-U,s[6]=E*A,s[10]=S*A}else if(i.order==="YZX"){const R=S*A,W=S*U,j=E*A,H=E*U;s[0]=A*B,s[4]=H-R*D,s[8]=j*D+W,s[1]=D,s[5]=S*B,s[9]=-E*B,s[2]=-U*B,s[6]=W*D+j,s[10]=R-H*D}else if(i.order==="XZY"){const R=S*A,W=S*U,j=E*A,H=E*U;s[0]=A*B,s[4]=-D,s[8]=U*B,s[1]=R*D+H,s[5]=S*B,s[9]=W*D-j,s[2]=j*D-W,s[6]=E*B,s[10]=H*D+R}return s[3]=0,s[7]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,this}makeRotationFromQuaternion(i){return this.compose(Sce,i,Cce)}lookAt(i,s,a){const r=this.elements;return Vm.subVectors(i,s),Vm.lengthSq()===0&&(Vm.z=1),Vm.normalize(),Fb.crossVectors(a,Vm),Fb.lengthSq()===0&&(Math.abs(a.z)===1?Vm.x+=1e-4:Vm.z+=1e-4,Vm.normalize(),Fb.crossVectors(a,Vm)),Fb.normalize(),rO.crossVectors(Vm,Fb),r[0]=Fb.x,r[4]=rO.x,r[8]=Vm.x,r[1]=Fb.y,r[5]=rO.y,r[9]=Vm.y,r[2]=Fb.z,r[6]=rO.z,r[10]=Vm.z,this}multiply(i){return this.multiplyMatrices(this,i)}premultiply(i){return this.multiplyMatrices(i,this)}multiplyMatrices(i,s){const a=i.elements,r=s.elements,c=this.elements,S=a[0],E=a[4],A=a[8],U=a[12],B=a[1],D=a[5],R=a[9],W=a[13],j=a[2],H=a[6],I=a[10],Q=a[14],Y=a[3],q=a[7],ae=a[11],oe=a[15],ye=r[0],_e=r[4],pe=r[8],me=r[12],Ge=r[1],lt=r[5],It=r[9],wt=r[13],we=r[2],yt=r[6],Bt=r[10],Ot=r[14],ze=r[3],Ut=r[7],Ft=r[11],pt=r[15];return c[0]=S*ye+E*Ge+A*we+U*ze,c[4]=S*_e+E*lt+A*yt+U*Ut,c[8]=S*pe+E*It+A*Bt+U*Ft,c[12]=S*me+E*wt+A*Ot+U*pt,c[1]=B*ye+D*Ge+R*we+W*ze,c[5]=B*_e+D*lt+R*yt+W*Ut,c[9]=B*pe+D*It+R*Bt+W*Ft,c[13]=B*me+D*wt+R*Ot+W*pt,c[2]=j*ye+H*Ge+I*we+Q*ze,c[6]=j*_e+H*lt+I*yt+Q*Ut,c[10]=j*pe+H*It+I*Bt+Q*Ft,c[14]=j*me+H*wt+I*Ot+Q*pt,c[3]=Y*ye+q*Ge+ae*we+oe*ze,c[7]=Y*_e+q*lt+ae*yt+oe*Ut,c[11]=Y*pe+q*It+ae*Bt+oe*Ft,c[15]=Y*me+q*wt+ae*Ot+oe*pt,this}multiplyScalar(i){const s=this.elements;return s[0]*=i,s[4]*=i,s[8]*=i,s[12]*=i,s[1]*=i,s[5]*=i,s[9]*=i,s[13]*=i,s[2]*=i,s[6]*=i,s[10]*=i,s[14]*=i,s[3]*=i,s[7]*=i,s[11]*=i,s[15]*=i,this}determinant(){const i=this.elements,s=i[0],a=i[4],r=i[8],c=i[12],S=i[1],E=i[5],A=i[9],U=i[13],B=i[2],D=i[6],R=i[10],W=i[14],j=i[3],H=i[7],I=i[11],Q=i[15];return j*(+c*A*D-r*U*D-c*E*R+a*U*R+r*E*W-a*A*W)+H*(+s*A*W-s*U*R+c*S*R-r*S*W+r*U*B-c*A*B)+I*(+s*U*D-s*E*W-c*S*D+a*S*W+c*E*B-a*U*B)+Q*(-r*E*B-s*A*D+s*E*R+r*S*D-a*S*R+a*A*B)}transpose(){const i=this.elements;let s;return s=i[1],i[1]=i[4],i[4]=s,s=i[2],i[2]=i[8],i[8]=s,s=i[6],i[6]=i[9],i[9]=s,s=i[3],i[3]=i[12],i[12]=s,s=i[7],i[7]=i[13],i[13]=s,s=i[11],i[11]=i[14],i[14]=s,this}setPosition(i,s,a){const r=this.elements;return i.isVector3?(r[12]=i.x,r[13]=i.y,r[14]=i.z):(r[12]=i,r[13]=s,r[14]=a),this}invert(){const i=this.elements,s=i[0],a=i[1],r=i[2],c=i[3],S=i[4],E=i[5],A=i[6],U=i[7],B=i[8],D=i[9],R=i[10],W=i[11],j=i[12],H=i[13],I=i[14],Q=i[15],Y=D*I*U-H*R*U+H*A*W-E*I*W-D*A*Q+E*R*Q,q=j*R*U-B*I*U-j*A*W+S*I*W+B*A*Q-S*R*Q,ae=B*H*U-j*D*U+j*E*W-S*H*W-B*E*Q+S*D*Q,oe=j*D*A-B*H*A-j*E*R+S*H*R+B*E*I-S*D*I,ye=s*Y+a*q+r*ae+c*oe;if(ye===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const _e=1/ye;return i[0]=Y*_e,i[1]=(H*R*c-D*I*c-H*r*W+a*I*W+D*r*Q-a*R*Q)*_e,i[2]=(E*I*c-H*A*c+H*r*U-a*I*U-E*r*Q+a*A*Q)*_e,i[3]=(D*A*c-E*R*c-D*r*U+a*R*U+E*r*W-a*A*W)*_e,i[4]=q*_e,i[5]=(B*I*c-j*R*c+j*r*W-s*I*W-B*r*Q+s*R*Q)*_e,i[6]=(j*A*c-S*I*c-j*r*U+s*I*U+S*r*Q-s*A*Q)*_e,i[7]=(S*R*c-B*A*c+B*r*U-s*R*U-S*r*W+s*A*W)*_e,i[8]=ae*_e,i[9]=(j*D*c-B*H*c-j*a*W+s*H*W+B*a*Q-s*D*Q)*_e,i[10]=(S*H*c-j*E*c+j*a*U-s*H*U-S*a*Q+s*E*Q)*_e,i[11]=(B*E*c-S*D*c-B*a*U+s*D*U+S*a*W-s*E*W)*_e,i[12]=oe*_e,i[13]=(B*H*r-j*D*r+j*a*R-s*H*R-B*a*I+s*D*I)*_e,i[14]=(j*E*r-S*H*r-j*a*A+s*H*A+S*a*I-s*E*I)*_e,i[15]=(S*D*r-B*E*r+B*a*A-s*D*A-S*a*R+s*E*R)*_e,this}scale(i){const s=this.elements,a=i.x,r=i.y,c=i.z;return s[0]*=a,s[4]*=r,s[8]*=c,s[1]*=a,s[5]*=r,s[9]*=c,s[2]*=a,s[6]*=r,s[10]*=c,s[3]*=a,s[7]*=r,s[11]*=c,this}getMaxScaleOnAxis(){const i=this.elements,s=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],a=i[4]*i[4]+i[5]*i[5]+i[6]*i[6],r=i[8]*i[8]+i[9]*i[9]+i[10]*i[10];return Math.sqrt(Math.max(s,a,r))}makeTranslation(i,s,a){return this.set(1,0,0,i,0,1,0,s,0,0,1,a,0,0,0,1),this}makeRotationX(i){const s=Math.cos(i),a=Math.sin(i);return this.set(1,0,0,0,0,s,-a,0,0,a,s,0,0,0,0,1),this}makeRotationY(i){const s=Math.cos(i),a=Math.sin(i);return this.set(s,0,a,0,0,1,0,0,-a,0,s,0,0,0,0,1),this}makeRotationZ(i){const s=Math.cos(i),a=Math.sin(i);return this.set(s,-a,0,0,a,s,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(i,s){const a=Math.cos(s),r=Math.sin(s),c=1-a,S=i.x,E=i.y,A=i.z,U=c*S,B=c*E;return this.set(U*S+a,U*E-r*A,U*A+r*E,0,U*E+r*A,B*E+a,B*A-r*S,0,U*A-r*E,B*A+r*S,c*A*A+a,0,0,0,0,1),this}makeScale(i,s,a){return this.set(i,0,0,0,0,s,0,0,0,0,a,0,0,0,0,1),this}makeShear(i,s,a,r,c,S){return this.set(1,a,c,0,i,1,S,0,s,r,1,0,0,0,0,1),this}compose(i,s,a){const r=this.elements,c=s._x,S=s._y,E=s._z,A=s._w,U=c+c,B=S+S,D=E+E,R=c*U,W=c*B,j=c*D,H=S*B,I=S*D,Q=E*D,Y=A*U,q=A*B,ae=A*D,oe=a.x,ye=a.y,_e=a.z;return r[0]=(1-(H+Q))*oe,r[1]=(W+ae)*oe,r[2]=(j-q)*oe,r[3]=0,r[4]=(W-ae)*ye,r[5]=(1-(R+Q))*ye,r[6]=(I+Y)*ye,r[7]=0,r[8]=(j+q)*_e,r[9]=(I-Y)*_e,r[10]=(1-(R+H))*_e,r[11]=0,r[12]=i.x,r[13]=i.y,r[14]=i.z,r[15]=1,this}decompose(i,s,a){const r=this.elements;let c=S2.set(r[0],r[1],r[2]).length();const S=S2.set(r[4],r[5],r[6]).length(),E=S2.set(r[8],r[9],r[10]).length();this.determinant()<0&&(c=-c),i.x=r[12],i.y=r[13],i.z=r[14],Y0.copy(this);const U=1/c,B=1/S,D=1/E;return Y0.elements[0]*=U,Y0.elements[1]*=U,Y0.elements[2]*=U,Y0.elements[4]*=B,Y0.elements[5]*=B,Y0.elements[6]*=B,Y0.elements[8]*=D,Y0.elements[9]*=D,Y0.elements[10]*=D,s.setFromRotationMatrix(Y0),a.x=c,a.y=S,a.z=E,this}makePerspective(i,s,a,r,c,S){const E=this.elements,A=2*c/(s-i),U=2*c/(a-r),B=(s+i)/(s-i),D=(a+r)/(a-r),R=-(S+c)/(S-c),W=-2*S*c/(S-c);return E[0]=A,E[4]=0,E[8]=B,E[12]=0,E[1]=0,E[5]=U,E[9]=D,E[13]=0,E[2]=0,E[6]=0,E[10]=R,E[14]=W,E[3]=0,E[7]=0,E[11]=-1,E[15]=0,this}makeOrthographic(i,s,a,r,c,S){const E=this.elements,A=1/(s-i),U=1/(a-r),B=1/(S-c),D=(s+i)*A,R=(a+r)*U,W=(S+c)*B;return E[0]=2*A,E[4]=0,E[8]=0,E[12]=-D,E[1]=0,E[5]=2*U,E[9]=0,E[13]=-R,E[2]=0,E[6]=0,E[10]=-2*B,E[14]=-W,E[3]=0,E[7]=0,E[11]=0,E[15]=1,this}equals(i){const s=this.elements,a=i.elements;for(let r=0;r<16;r++)if(s[r]!==a[r])return!1;return!0}fromArray(i,s=0){for(let a=0;a<16;a++)this.elements[a]=i[a+s];return this}toArray(i=[],s=0){const a=this.elements;return i[s]=a[0],i[s+1]=a[1],i[s+2]=a[2],i[s+3]=a[3],i[s+4]=a[4],i[s+5]=a[5],i[s+6]=a[6],i[s+7]=a[7],i[s+8]=a[8],i[s+9]=a[9],i[s+10]=a[10],i[s+11]=a[11],i[s+12]=a[12],i[s+13]=a[13],i[s+14]=a[14],i[s+15]=a[15],i}}const S2=new cr,Y0=new lc,Sce=new cr(0,0,0),Cce=new cr(1,1,1),Fb=new cr,rO=new cr,Vm=new cr,eV=new lc,tV=new Qb;class yC{constructor(i=0,s=0,a=0,r=yC.DefaultOrder){this.isEuler=!0,this._x=i,this._y=s,this._z=a,this._order=r}get x(){return this._x}set x(i){this._x=i,this._onChangeCallback()}get y(){return this._y}set y(i){this._y=i,this._onChangeCallback()}get z(){return this._z}set z(i){this._z=i,this._onChangeCallback()}get order(){return this._order}set order(i){this._order=i,this._onChangeCallback()}set(i,s,a,r=this._order){return this._x=i,this._y=s,this._z=a,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(i){return this._x=i._x,this._y=i._y,this._z=i._z,this._order=i._order,this._onChangeCallback(),this}setFromRotationMatrix(i,s=this._order,a=!0){const r=i.elements,c=r[0],S=r[4],E=r[8],A=r[1],U=r[5],B=r[9],D=r[2],R=r[6],W=r[10];switch(s){case"XYZ":this._y=Math.asin(Ip(E,-1,1)),Math.abs(E)<.9999999?(this._x=Math.atan2(-B,W),this._z=Math.atan2(-S,c)):(this._x=Math.atan2(R,U),this._z=0);break;case"YXZ":this._x=Math.asin(-Ip(B,-1,1)),Math.abs(B)<.9999999?(this._y=Math.atan2(E,W),this._z=Math.atan2(A,U)):(this._y=Math.atan2(-D,c),this._z=0);break;case"ZXY":this._x=Math.asin(Ip(R,-1,1)),Math.abs(R)<.9999999?(this._y=Math.atan2(-D,W),this._z=Math.atan2(-S,U)):(this._y=0,this._z=Math.atan2(A,c));break;case"ZYX":this._y=Math.asin(-Ip(D,-1,1)),Math.abs(D)<.9999999?(this._x=Math.atan2(R,W),this._z=Math.atan2(A,c)):(this._x=0,this._z=Math.atan2(-S,U));break;case"YZX":this._z=Math.asin(Ip(A,-1,1)),Math.abs(A)<.9999999?(this._x=Math.atan2(-B,U),this._y=Math.atan2(-D,c)):(this._x=0,this._y=Math.atan2(E,W));break;case"XZY":this._z=Math.asin(-Ip(S,-1,1)),Math.abs(S)<.9999999?(this._x=Math.atan2(R,U),this._y=Math.atan2(E,c)):(this._x=Math.atan2(-B,W),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+s)}return this._order=s,a===!0&&this._onChangeCallback(),this}setFromQuaternion(i,s,a){return eV.makeRotationFromQuaternion(i),this.setFromRotationMatrix(eV,s,a)}setFromVector3(i,s=this._order){return this.set(i.x,i.y,i.z,s)}reorder(i){return tV.setFromEuler(this),this.setFromQuaternion(tV,i)}equals(i){return i._x===this._x&&i._y===this._y&&i._z===this._z&&i._order===this._order}fromArray(i){return this._x=i[0],this._y=i[1],this._z=i[2],i[3]!==void 0&&(this._order=i[3]),this._onChangeCallback(),this}toArray(i=[],s=0){return i[s]=this._x,i[s+1]=this._y,i[s+2]=this._z,i[s+3]=this._order,i}_onChange(i){return this._onChangeCallback=i,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}yC.DefaultOrder="XYZ";yC.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class kq{constructor(){this.mask=1}set(i){this.mask=(1<<i|0)>>>0}enable(i){this.mask|=1<<i|0}enableAll(){this.mask=-1}toggle(i){this.mask^=1<<i|0}disable(i){this.mask&=~(1<<i|0)}disableAll(){this.mask=0}test(i){return(this.mask&i.mask)!==0}isEnabled(i){return(this.mask&(1<<i|0))!==0}}let kce=0;const nV=new cr,C2=new Qb,E1=new lc,iO=new cr,vS=new cr,Ace=new cr,Oce=new Qb,rV=new cr(1,0,0),iV=new cr(0,1,0),oV=new cr(0,0,1),Tce={type:"added"},aV={type:"removed"};class ld extends rx{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:kce++}),this.uuid=gC(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ld.DefaultUp.clone();const i=new cr,s=new yC,a=new Qb,r=new cr(1,1,1);function c(){a.setFromEuler(s,!1)}function S(){s.setFromQuaternion(a,void 0,!1)}s._onChange(c),a._onChange(S),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:i},rotation:{configurable:!0,enumerable:!0,value:s},quaternion:{configurable:!0,enumerable:!0,value:a},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new lc},normalMatrix:{value:new $m}}),this.matrix=new lc,this.matrixWorld=new lc,this.matrixAutoUpdate=ld.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=ld.DefaultMatrixWorldAutoUpdate,this.layers=new kq,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(i){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(i),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(i){return this.quaternion.premultiply(i),this}setRotationFromAxisAngle(i,s){this.quaternion.setFromAxisAngle(i,s)}setRotationFromEuler(i){this.quaternion.setFromEuler(i,!0)}setRotationFromMatrix(i){this.quaternion.setFromRotationMatrix(i)}setRotationFromQuaternion(i){this.quaternion.copy(i)}rotateOnAxis(i,s){return C2.setFromAxisAngle(i,s),this.quaternion.multiply(C2),this}rotateOnWorldAxis(i,s){return C2.setFromAxisAngle(i,s),this.quaternion.premultiply(C2),this}rotateX(i){return this.rotateOnAxis(rV,i)}rotateY(i){return this.rotateOnAxis(iV,i)}rotateZ(i){return this.rotateOnAxis(oV,i)}translateOnAxis(i,s){return nV.copy(i).applyQuaternion(this.quaternion),this.position.add(nV.multiplyScalar(s)),this}translateX(i){return this.translateOnAxis(rV,i)}translateY(i){return this.translateOnAxis(iV,i)}translateZ(i){return this.translateOnAxis(oV,i)}localToWorld(i){return this.updateWorldMatrix(!0,!1),i.applyMatrix4(this.matrixWorld)}worldToLocal(i){return this.updateWorldMatrix(!0,!1),i.applyMatrix4(E1.copy(this.matrixWorld).invert())}lookAt(i,s,a){i.isVector3?iO.copy(i):iO.set(i,s,a);const r=this.parent;this.updateWorldMatrix(!0,!1),vS.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?E1.lookAt(vS,iO,this.up):E1.lookAt(iO,vS,this.up),this.quaternion.setFromRotationMatrix(E1),r&&(E1.extractRotation(r.matrixWorld),C2.setFromRotationMatrix(E1),this.quaternion.premultiply(C2.invert()))}add(i){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.add(arguments[s]);return this}return i===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",i),this):(i&&i.isObject3D?(i.parent!==null&&i.parent.remove(i),i.parent=this,this.children.push(i),i.dispatchEvent(Tce)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",i),this)}remove(i){if(arguments.length>1){for(let a=0;a<arguments.length;a++)this.remove(arguments[a]);return this}const s=this.children.indexOf(i);return s!==-1&&(i.parent=null,this.children.splice(s,1),i.dispatchEvent(aV)),this}removeFromParent(){const i=this.parent;return i!==null&&i.remove(this),this}clear(){for(let i=0;i<this.children.length;i++){const s=this.children[i];s.parent=null,s.dispatchEvent(aV)}return this.children.length=0,this}attach(i){return this.updateWorldMatrix(!0,!1),E1.copy(this.matrixWorld).invert(),i.parent!==null&&(i.parent.updateWorldMatrix(!0,!1),E1.multiply(i.parent.matrixWorld)),i.applyMatrix4(E1),this.add(i),i.updateWorldMatrix(!1,!0),this}getObjectById(i){return this.getObjectByProperty("id",i)}getObjectByName(i){return this.getObjectByProperty("name",i)}getObjectByProperty(i,s){if(this[i]===s)return this;for(let a=0,r=this.children.length;a<r;a++){const S=this.children[a].getObjectByProperty(i,s);if(S!==void 0)return S}}getObjectsByProperty(i,s){let a=[];this[i]===s&&a.push(this);for(let r=0,c=this.children.length;r<c;r++){const S=this.children[r].getObjectsByProperty(i,s);S.length>0&&(a=a.concat(S))}return a}getWorldPosition(i){return this.updateWorldMatrix(!0,!1),i.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(i){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(vS,i,Ace),i}getWorldScale(i){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(vS,Oce,i),i}getWorldDirection(i){this.updateWorldMatrix(!0,!1);const s=this.matrixWorld.elements;return i.set(s[8],s[9],s[10]).normalize()}raycast(){}traverse(i){i(this);const s=this.children;for(let a=0,r=s.length;a<r;a++)s[a].traverse(i)}traverseVisible(i){if(this.visible===!1)return;i(this);const s=this.children;for(let a=0,r=s.length;a<r;a++)s[a].traverseVisible(i)}traverseAncestors(i){const s=this.parent;s!==null&&(i(s),s.traverseAncestors(i))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(i){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||i)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,i=!0);const s=this.children;for(let a=0,r=s.length;a<r;a++){const c=s[a];(c.matrixWorldAutoUpdate===!0||i===!0)&&c.updateMatrixWorld(i)}}updateWorldMatrix(i,s){const a=this.parent;if(i===!0&&a!==null&&a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),s===!0){const r=this.children;for(let c=0,S=r.length;c<S;c++){const E=r[c];E.matrixWorldAutoUpdate===!0&&E.updateWorldMatrix(!1,!0)}}}toJSON(i){const s=i===void 0||typeof i=="string",a={};s&&(i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},a.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function c(E,A){return E[A.uuid]===void 0&&(E[A.uuid]=A.toJSON(i)),A.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(i).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(i).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=c(i.geometries,this.geometry);const E=this.geometry.parameters;if(E!==void 0&&E.shapes!==void 0){const A=E.shapes;if(Array.isArray(A))for(let U=0,B=A.length;U<B;U++){const D=A[U];c(i.shapes,D)}else c(i.shapes,A)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(c(i.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const E=[];for(let A=0,U=this.material.length;A<U;A++)E.push(c(i.materials,this.material[A]));r.material=E}else r.material=c(i.materials,this.material);if(this.children.length>0){r.children=[];for(let E=0;E<this.children.length;E++)r.children.push(this.children[E].toJSON(i).object)}if(this.animations.length>0){r.animations=[];for(let E=0;E<this.animations.length;E++){const A=this.animations[E];r.animations.push(c(i.animations,A))}}if(s){const E=S(i.geometries),A=S(i.materials),U=S(i.textures),B=S(i.images),D=S(i.shapes),R=S(i.skeletons),W=S(i.animations),j=S(i.nodes);E.length>0&&(a.geometries=E),A.length>0&&(a.materials=A),U.length>0&&(a.textures=U),B.length>0&&(a.images=B),D.length>0&&(a.shapes=D),R.length>0&&(a.skeletons=R),W.length>0&&(a.animations=W),j.length>0&&(a.nodes=j)}return a.object=r,a;function S(E){const A=[];for(const U in E){const B=E[U];delete B.metadata,A.push(B)}return A}}clone(i){return new this.constructor().copy(this,i)}copy(i,s=!0){if(this.name=i.name,this.up.copy(i.up),this.position.copy(i.position),this.rotation.order=i.rotation.order,this.quaternion.copy(i.quaternion),this.scale.copy(i.scale),this.matrix.copy(i.matrix),this.matrixWorld.copy(i.matrixWorld),this.matrixAutoUpdate=i.matrixAutoUpdate,this.matrixWorldNeedsUpdate=i.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=i.matrixWorldAutoUpdate,this.layers.mask=i.layers.mask,this.visible=i.visible,this.castShadow=i.castShadow,this.receiveShadow=i.receiveShadow,this.frustumCulled=i.frustumCulled,this.renderOrder=i.renderOrder,this.userData=JSON.parse(JSON.stringify(i.userData)),s===!0)for(let a=0;a<i.children.length;a++){const r=i.children[a];this.add(r.clone())}return this}}ld.DefaultUp=new cr(0,1,0);ld.DefaultMatrixAutoUpdate=!0;ld.DefaultMatrixWorldAutoUpdate=!0;const J0=new cr,S1=new cr,hF=new cr,C1=new cr,k2=new cr,A2=new cr,sV=new cr,pF=new cr,mF=new cr,gF=new cr;class T1{constructor(i=new cr,s=new cr,a=new cr){this.a=i,this.b=s,this.c=a}static getNormal(i,s,a,r){r.subVectors(a,s),J0.subVectors(i,s),r.cross(J0);const c=r.lengthSq();return c>0?r.multiplyScalar(1/Math.sqrt(c)):r.set(0,0,0)}static getBarycoord(i,s,a,r,c){J0.subVectors(r,s),S1.subVectors(a,s),hF.subVectors(i,s);const S=J0.dot(J0),E=J0.dot(S1),A=J0.dot(hF),U=S1.dot(S1),B=S1.dot(hF),D=S*U-E*E;if(D===0)return c.set(-2,-1,-1);const R=1/D,W=(U*A-E*B)*R,j=(S*B-E*A)*R;return c.set(1-W-j,j,W)}static containsPoint(i,s,a,r){return this.getBarycoord(i,s,a,r,C1),C1.x>=0&&C1.y>=0&&C1.x+C1.y<=1}static getUV(i,s,a,r,c,S,E,A){return this.getBarycoord(i,s,a,r,C1),A.set(0,0),A.addScaledVector(c,C1.x),A.addScaledVector(S,C1.y),A.addScaledVector(E,C1.z),A}static isFrontFacing(i,s,a,r){return J0.subVectors(a,s),S1.subVectors(i,s),J0.cross(S1).dot(r)<0}set(i,s,a){return this.a.copy(i),this.b.copy(s),this.c.copy(a),this}setFromPointsAndIndices(i,s,a,r){return this.a.copy(i[s]),this.b.copy(i[a]),this.c.copy(i[r]),this}setFromAttributeAndIndices(i,s,a,r){return this.a.fromBufferAttribute(i,s),this.b.fromBufferAttribute(i,a),this.c.fromBufferAttribute(i,r),this}clone(){return new this.constructor().copy(this)}copy(i){return this.a.copy(i.a),this.b.copy(i.b),this.c.copy(i.c),this}getArea(){return J0.subVectors(this.c,this.b),S1.subVectors(this.a,this.b),J0.cross(S1).length()*.5}getMidpoint(i){return i.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(i){return T1.getNormal(this.a,this.b,this.c,i)}getPlane(i){return i.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(i,s){return T1.getBarycoord(i,this.a,this.b,this.c,s)}getUV(i,s,a,r,c){return T1.getUV(i,this.a,this.b,this.c,s,a,r,c)}containsPoint(i){return T1.containsPoint(i,this.a,this.b,this.c)}isFrontFacing(i){return T1.isFrontFacing(this.a,this.b,this.c,i)}intersectsBox(i){return i.intersectsTriangle(this)}closestPointToPoint(i,s){const a=this.a,r=this.b,c=this.c;let S,E;k2.subVectors(r,a),A2.subVectors(c,a),pF.subVectors(i,a);const A=k2.dot(pF),U=A2.dot(pF);if(A<=0&&U<=0)return s.copy(a);mF.subVectors(i,r);const B=k2.dot(mF),D=A2.dot(mF);if(B>=0&&D<=B)return s.copy(r);const R=A*D-B*U;if(R<=0&&A>=0&&B<=0)return S=A/(A-B),s.copy(a).addScaledVector(k2,S);gF.subVectors(i,c);const W=k2.dot(gF),j=A2.dot(gF);if(j>=0&&W<=j)return s.copy(c);const H=W*U-A*j;if(H<=0&&U>=0&&j<=0)return E=U/(U-j),s.copy(a).addScaledVector(A2,E);const I=B*j-W*D;if(I<=0&&D-B>=0&&W-j>=0)return sV.subVectors(c,r),E=(D-B)/(D-B+(W-j)),s.copy(r).addScaledVector(sV,E);const Q=1/(I+H+R);return S=H*Q,E=R*Q,s.copy(a).addScaledVector(k2,S).addScaledVector(A2,E)}equals(i){return i.a.equals(this.a)&&i.b.equals(this.b)&&i.c.equals(this.c)}}let Mce=0;class bC extends rx{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Mce++}),this.uuid=gC(),this.name="",this.type="Material",this.blending=r_,this.side=vw,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=mq,this.blendDst=gq,this.blendEquation=F2,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=OR,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=bce,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ZI,this.stencilZFail=ZI,this.stencilZPass=ZI,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(i){this._alphaTest>0!=i>0&&this.version++,this._alphaTest=i}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(i){if(i!==void 0)for(const s in i){const a=i[s];if(a===void 0){console.warn("THREE.Material: '"+s+"' parameter is undefined.");continue}const r=this[s];if(r===void 0){console.warn("THREE."+this.type+": '"+s+"' is not a property of this material.");continue}r&&r.isColor?r.set(a):r&&r.isVector3&&a&&a.isVector3?r.copy(a):this[s]=a}}toJSON(i){const s=i===void 0||typeof i=="string";s&&(i={textures:{},images:{}});const a={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};a.uuid=this.uuid,a.type=this.type,this.name!==""&&(a.name=this.name),this.color&&this.color.isColor&&(a.color=this.color.getHex()),this.roughness!==void 0&&(a.roughness=this.roughness),this.metalness!==void 0&&(a.metalness=this.metalness),this.sheen!==void 0&&(a.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(a.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(a.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(a.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(a.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(a.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(a.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(a.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(a.shininess=this.shininess),this.clearcoat!==void 0&&(a.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(a.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(a.clearcoatMap=this.clearcoatMap.toJSON(i).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(a.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(i).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(a.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(i).uuid,a.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(a.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(a.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(a.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(a.iridescenceMap=this.iridescenceMap.toJSON(i).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(a.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(i).uuid),this.map&&this.map.isTexture&&(a.map=this.map.toJSON(i).uuid),this.matcap&&this.matcap.isTexture&&(a.matcap=this.matcap.toJSON(i).uuid),this.alphaMap&&this.alphaMap.isTexture&&(a.alphaMap=this.alphaMap.toJSON(i).uuid),this.lightMap&&this.lightMap.isTexture&&(a.lightMap=this.lightMap.toJSON(i).uuid,a.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(a.aoMap=this.aoMap.toJSON(i).uuid,a.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(a.bumpMap=this.bumpMap.toJSON(i).uuid,a.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(a.normalMap=this.normalMap.toJSON(i).uuid,a.normalMapType=this.normalMapType,a.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(a.displacementMap=this.displacementMap.toJSON(i).uuid,a.displacementScale=this.displacementScale,a.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(a.roughnessMap=this.roughnessMap.toJSON(i).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(a.metalnessMap=this.metalnessMap.toJSON(i).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(a.emissiveMap=this.emissiveMap.toJSON(i).uuid),this.specularMap&&this.specularMap.isTexture&&(a.specularMap=this.specularMap.toJSON(i).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(a.specularIntensityMap=this.specularIntensityMap.toJSON(i).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(a.specularColorMap=this.specularColorMap.toJSON(i).uuid),this.envMap&&this.envMap.isTexture&&(a.envMap=this.envMap.toJSON(i).uuid,this.combine!==void 0&&(a.combine=this.combine)),this.envMapIntensity!==void 0&&(a.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(a.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(a.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(a.gradientMap=this.gradientMap.toJSON(i).uuid),this.transmission!==void 0&&(a.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(a.transmissionMap=this.transmissionMap.toJSON(i).uuid),this.thickness!==void 0&&(a.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(a.thicknessMap=this.thicknessMap.toJSON(i).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(a.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(a.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(a.size=this.size),this.shadowSide!==null&&(a.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(a.sizeAttenuation=this.sizeAttenuation),this.blending!==r_&&(a.blending=this.blending),this.side!==vw&&(a.side=this.side),this.vertexColors&&(a.vertexColors=!0),this.opacity<1&&(a.opacity=this.opacity),this.transparent===!0&&(a.transparent=this.transparent),a.depthFunc=this.depthFunc,a.depthTest=this.depthTest,a.depthWrite=this.depthWrite,a.colorWrite=this.colorWrite,a.stencilWrite=this.stencilWrite,a.stencilWriteMask=this.stencilWriteMask,a.stencilFunc=this.stencilFunc,a.stencilRef=this.stencilRef,a.stencilFuncMask=this.stencilFuncMask,a.stencilFail=this.stencilFail,a.stencilZFail=this.stencilZFail,a.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(a.rotation=this.rotation),this.polygonOffset===!0&&(a.polygonOffset=!0),this.polygonOffsetFactor!==0&&(a.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(a.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(a.linewidth=this.linewidth),this.dashSize!==void 0&&(a.dashSize=this.dashSize),this.gapSize!==void 0&&(a.gapSize=this.gapSize),this.scale!==void 0&&(a.scale=this.scale),this.dithering===!0&&(a.dithering=!0),this.alphaTest>0&&(a.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(a.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(a.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(a.wireframe=this.wireframe),this.wireframeLinewidth>1&&(a.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(a.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(a.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(a.flatShading=this.flatShading),this.visible===!1&&(a.visible=!1),this.toneMapped===!1&&(a.toneMapped=!1),this.fog===!1&&(a.fog=!1),Object.keys(this.userData).length>0&&(a.userData=this.userData);function r(c){const S=[];for(const E in c){const A=c[E];delete A.metadata,S.push(A)}return S}if(s){const c=r(i.textures),S=r(i.images);c.length>0&&(a.textures=c),S.length>0&&(a.images=S)}return a}clone(){return new this.constructor().copy(this)}copy(i){this.name=i.name,this.blending=i.blending,this.side=i.side,this.vertexColors=i.vertexColors,this.opacity=i.opacity,this.transparent=i.transparent,this.blendSrc=i.blendSrc,this.blendDst=i.blendDst,this.blendEquation=i.blendEquation,this.blendSrcAlpha=i.blendSrcAlpha,this.blendDstAlpha=i.blendDstAlpha,this.blendEquationAlpha=i.blendEquationAlpha,this.depthFunc=i.depthFunc,this.depthTest=i.depthTest,this.depthWrite=i.depthWrite,this.stencilWriteMask=i.stencilWriteMask,this.stencilFunc=i.stencilFunc,this.stencilRef=i.stencilRef,this.stencilFuncMask=i.stencilFuncMask,this.stencilFail=i.stencilFail,this.stencilZFail=i.stencilZFail,this.stencilZPass=i.stencilZPass,this.stencilWrite=i.stencilWrite;const s=i.clippingPlanes;let a=null;if(s!==null){const r=s.length;a=new Array(r);for(let c=0;c!==r;++c)a[c]=s[c].clone()}return this.clippingPlanes=a,this.clipIntersection=i.clipIntersection,this.clipShadows=i.clipShadows,this.shadowSide=i.shadowSide,this.colorWrite=i.colorWrite,this.precision=i.precision,this.polygonOffset=i.polygonOffset,this.polygonOffsetFactor=i.polygonOffsetFactor,this.polygonOffsetUnits=i.polygonOffsetUnits,this.dithering=i.dithering,this.alphaTest=i.alphaTest,this.alphaToCoverage=i.alphaToCoverage,this.premultipliedAlpha=i.premultipliedAlpha,this.visible=i.visible,this.toneMapped=i.toneMapped,this.userData=JSON.parse(JSON.stringify(i.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(i){i===!0&&this.version++}}class AT extends bC{constructor(i){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new bs(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=vq,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.color.copy(i.color),this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.specularMap=i.specularMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.combine=i.combine,this.reflectivity=i.reflectivity,this.refractionRatio=i.refractionRatio,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.fog=i.fog,this}}const Oc=new cr,oO=new Eo;class My{constructor(i,s,a=!1){if(Array.isArray(i))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=i,this.itemSize=s,this.count=i!==void 0?i.length/s:0,this.normalized=a,this.usage=KW,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(i){i===!0&&this.version++}setUsage(i){return this.usage=i,this}copy(i){return this.name=i.name,this.array=new i.array.constructor(i.array),this.itemSize=i.itemSize,this.count=i.count,this.normalized=i.normalized,this.usage=i.usage,this}copyAt(i,s,a){i*=this.itemSize,a*=s.itemSize;for(let r=0,c=this.itemSize;r<c;r++)this.array[i+r]=s.array[a+r];return this}copyArray(i){return this.array.set(i),this}applyMatrix3(i){if(this.itemSize===2)for(let s=0,a=this.count;s<a;s++)oO.fromBufferAttribute(this,s),oO.applyMatrix3(i),this.setXY(s,oO.x,oO.y);else if(this.itemSize===3)for(let s=0,a=this.count;s<a;s++)Oc.fromBufferAttribute(this,s),Oc.applyMatrix3(i),this.setXYZ(s,Oc.x,Oc.y,Oc.z);return this}applyMatrix4(i){for(let s=0,a=this.count;s<a;s++)Oc.fromBufferAttribute(this,s),Oc.applyMatrix4(i),this.setXYZ(s,Oc.x,Oc.y,Oc.z);return this}applyNormalMatrix(i){for(let s=0,a=this.count;s<a;s++)Oc.fromBufferAttribute(this,s),Oc.applyNormalMatrix(i),this.setXYZ(s,Oc.x,Oc.y,Oc.z);return this}transformDirection(i){for(let s=0,a=this.count;s<a;s++)Oc.fromBufferAttribute(this,s),Oc.transformDirection(i),this.setXYZ(s,Oc.x,Oc.y,Oc.z);return this}set(i,s=0){return this.array.set(i,s),this}getX(i){let s=this.array[i*this.itemSize];return this.normalized&&(s=YA(s,this.array)),s}setX(i,s){return this.normalized&&(s=Wm(s,this.array)),this.array[i*this.itemSize]=s,this}getY(i){let s=this.array[i*this.itemSize+1];return this.normalized&&(s=YA(s,this.array)),s}setY(i,s){return this.normalized&&(s=Wm(s,this.array)),this.array[i*this.itemSize+1]=s,this}getZ(i){let s=this.array[i*this.itemSize+2];return this.normalized&&(s=YA(s,this.array)),s}setZ(i,s){return this.normalized&&(s=Wm(s,this.array)),this.array[i*this.itemSize+2]=s,this}getW(i){let s=this.array[i*this.itemSize+3];return this.normalized&&(s=YA(s,this.array)),s}setW(i,s){return this.normalized&&(s=Wm(s,this.array)),this.array[i*this.itemSize+3]=s,this}setXY(i,s,a){return i*=this.itemSize,this.normalized&&(s=Wm(s,this.array),a=Wm(a,this.array)),this.array[i+0]=s,this.array[i+1]=a,this}setXYZ(i,s,a,r){return i*=this.itemSize,this.normalized&&(s=Wm(s,this.array),a=Wm(a,this.array),r=Wm(r,this.array)),this.array[i+0]=s,this.array[i+1]=a,this.array[i+2]=r,this}setXYZW(i,s,a,r,c){return i*=this.itemSize,this.normalized&&(s=Wm(s,this.array),a=Wm(a,this.array),r=Wm(r,this.array),c=Wm(c,this.array)),this.array[i+0]=s,this.array[i+1]=a,this.array[i+2]=r,this.array[i+3]=c,this}onUpload(i){return this.onUploadCallback=i,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const i={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(i.name=this.name),this.usage!==KW&&(i.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(i.updateRange=this.updateRange),i}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class Aq extends My{constructor(i,s,a){super(new Uint16Array(i),s,a)}}class Oq extends My{constructor(i,s,a){super(new Uint32Array(i),s,a)}}class zp extends My{constructor(i,s,a){super(new Float32Array(i),s,a)}}let Dce=0;const Ug=new lc,vF=new ld,O2=new cr,Hm=new vC,yS=new vC,Sl=new cr;class Dy extends rx{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Dce++}),this.uuid=gC(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(i){return Array.isArray(i)?this.index=new(xq(i)?Oq:Aq)(i,1):this.index=i,this}getAttribute(i){return this.attributes[i]}setAttribute(i,s){return this.attributes[i]=s,this}deleteAttribute(i){return delete this.attributes[i],this}hasAttribute(i){return this.attributes[i]!==void 0}addGroup(i,s,a=0){this.groups.push({start:i,count:s,materialIndex:a})}clearGroups(){this.groups=[]}setDrawRange(i,s){this.drawRange.start=i,this.drawRange.count=s}applyMatrix4(i){const s=this.attributes.position;s!==void 0&&(s.applyMatrix4(i),s.needsUpdate=!0);const a=this.attributes.normal;if(a!==void 0){const c=new $m().getNormalMatrix(i);a.applyNormalMatrix(c),a.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(i),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(i){return Ug.makeRotationFromQuaternion(i),this.applyMatrix4(Ug),this}rotateX(i){return Ug.makeRotationX(i),this.applyMatrix4(Ug),this}rotateY(i){return Ug.makeRotationY(i),this.applyMatrix4(Ug),this}rotateZ(i){return Ug.makeRotationZ(i),this.applyMatrix4(Ug),this}translate(i,s,a){return Ug.makeTranslation(i,s,a),this.applyMatrix4(Ug),this}scale(i,s,a){return Ug.makeScale(i,s,a),this.applyMatrix4(Ug),this}lookAt(i){return vF.lookAt(i),vF.updateMatrix(),this.applyMatrix4(vF.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(O2).negate(),this.translate(O2.x,O2.y,O2.z),this}setFromPoints(i){const s=[];for(let a=0,r=i.length;a<r;a++){const c=i[a];s.push(c.x,c.y,c.z||0)}return this.setAttribute("position",new zp(s,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new vC);const i=this.attributes.position,s=this.morphAttributes.position;if(i&&i.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new cr(-1/0,-1/0,-1/0),new cr(1/0,1/0,1/0));return}if(i!==void 0){if(this.boundingBox.setFromBufferAttribute(i),s)for(let a=0,r=s.length;a<r;a++){const c=s[a];Hm.setFromBufferAttribute(c),this.morphTargetsRelative?(Sl.addVectors(this.boundingBox.min,Hm.min),this.boundingBox.expandByPoint(Sl),Sl.addVectors(this.boundingBox.max,Hm.max),this.boundingBox.expandByPoint(Sl)):(this.boundingBox.expandByPoint(Hm.min),this.boundingBox.expandByPoint(Hm.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new kT);const i=this.attributes.position,s=this.morphAttributes.position;if(i&&i.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new cr,1/0);return}if(i){const a=this.boundingSphere.center;if(Hm.setFromBufferAttribute(i),s)for(let c=0,S=s.length;c<S;c++){const E=s[c];yS.setFromBufferAttribute(E),this.morphTargetsRelative?(Sl.addVectors(Hm.min,yS.min),Hm.expandByPoint(Sl),Sl.addVectors(Hm.max,yS.max),Hm.expandByPoint(Sl)):(Hm.expandByPoint(yS.min),Hm.expandByPoint(yS.max))}Hm.getCenter(a);let r=0;for(let c=0,S=i.count;c<S;c++)Sl.fromBufferAttribute(i,c),r=Math.max(r,a.distanceToSquared(Sl));if(s)for(let c=0,S=s.length;c<S;c++){const E=s[c],A=this.morphTargetsRelative;for(let U=0,B=E.count;U<B;U++)Sl.fromBufferAttribute(E,U),A&&(O2.fromBufferAttribute(i,U),Sl.add(O2)),r=Math.max(r,a.distanceToSquared(Sl))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const i=this.index,s=this.attributes;if(i===null||s.position===void 0||s.normal===void 0||s.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const a=i.array,r=s.position.array,c=s.normal.array,S=s.uv.array,E=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new My(new Float32Array(4*E),4));const A=this.getAttribute("tangent").array,U=[],B=[];for(let Ge=0;Ge<E;Ge++)U[Ge]=new cr,B[Ge]=new cr;const D=new cr,R=new cr,W=new cr,j=new Eo,H=new Eo,I=new Eo,Q=new cr,Y=new cr;function q(Ge,lt,It){D.fromArray(r,Ge*3),R.fromArray(r,lt*3),W.fromArray(r,It*3),j.fromArray(S,Ge*2),H.fromArray(S,lt*2),I.fromArray(S,It*2),R.sub(D),W.sub(D),H.sub(j),I.sub(j);const wt=1/(H.x*I.y-I.x*H.y);isFinite(wt)&&(Q.copy(R).multiplyScalar(I.y).addScaledVector(W,-H.y).multiplyScalar(wt),Y.copy(W).multiplyScalar(H.x).addScaledVector(R,-I.x).multiplyScalar(wt),U[Ge].add(Q),U[lt].add(Q),U[It].add(Q),B[Ge].add(Y),B[lt].add(Y),B[It].add(Y))}let ae=this.groups;ae.length===0&&(ae=[{start:0,count:a.length}]);for(let Ge=0,lt=ae.length;Ge<lt;++Ge){const It=ae[Ge],wt=It.start,we=It.count;for(let yt=wt,Bt=wt+we;yt<Bt;yt+=3)q(a[yt+0],a[yt+1],a[yt+2])}const oe=new cr,ye=new cr,_e=new cr,pe=new cr;function me(Ge){_e.fromArray(c,Ge*3),pe.copy(_e);const lt=U[Ge];oe.copy(lt),oe.sub(_e.multiplyScalar(_e.dot(lt))).normalize(),ye.crossVectors(pe,lt);const wt=ye.dot(B[Ge])<0?-1:1;A[Ge*4]=oe.x,A[Ge*4+1]=oe.y,A[Ge*4+2]=oe.z,A[Ge*4+3]=wt}for(let Ge=0,lt=ae.length;Ge<lt;++Ge){const It=ae[Ge],wt=It.start,we=It.count;for(let yt=wt,Bt=wt+we;yt<Bt;yt+=3)me(a[yt+0]),me(a[yt+1]),me(a[yt+2])}}computeVertexNormals(){const i=this.index,s=this.getAttribute("position");if(s!==void 0){let a=this.getAttribute("normal");if(a===void 0)a=new My(new Float32Array(s.count*3),3),this.setAttribute("normal",a);else for(let R=0,W=a.count;R<W;R++)a.setXYZ(R,0,0,0);const r=new cr,c=new cr,S=new cr,E=new cr,A=new cr,U=new cr,B=new cr,D=new cr;if(i)for(let R=0,W=i.count;R<W;R+=3){const j=i.getX(R+0),H=i.getX(R+1),I=i.getX(R+2);r.fromBufferAttribute(s,j),c.fromBufferAttribute(s,H),S.fromBufferAttribute(s,I),B.subVectors(S,c),D.subVectors(r,c),B.cross(D),E.fromBufferAttribute(a,j),A.fromBufferAttribute(a,H),U.fromBufferAttribute(a,I),E.add(B),A.add(B),U.add(B),a.setXYZ(j,E.x,E.y,E.z),a.setXYZ(H,A.x,A.y,A.z),a.setXYZ(I,U.x,U.y,U.z)}else for(let R=0,W=s.count;R<W;R+=3)r.fromBufferAttribute(s,R+0),c.fromBufferAttribute(s,R+1),S.fromBufferAttribute(s,R+2),B.subVectors(S,c),D.subVectors(r,c),B.cross(D),a.setXYZ(R+0,B.x,B.y,B.z),a.setXYZ(R+1,B.x,B.y,B.z),a.setXYZ(R+2,B.x,B.y,B.z);this.normalizeNormals(),a.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const i=this.attributes.normal;for(let s=0,a=i.count;s<a;s++)Sl.fromBufferAttribute(i,s),Sl.normalize(),i.setXYZ(s,Sl.x,Sl.y,Sl.z)}toNonIndexed(){function i(E,A){const U=E.array,B=E.itemSize,D=E.normalized,R=new U.constructor(A.length*B);let W=0,j=0;for(let H=0,I=A.length;H<I;H++){E.isInterleavedBufferAttribute?W=A[H]*E.data.stride+E.offset:W=A[H]*B;for(let Q=0;Q<B;Q++)R[j++]=U[W++]}return new My(R,B,D)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const s=new Dy,a=this.index.array,r=this.attributes;for(const E in r){const A=r[E],U=i(A,a);s.setAttribute(E,U)}const c=this.morphAttributes;for(const E in c){const A=[],U=c[E];for(let B=0,D=U.length;B<D;B++){const R=U[B],W=i(R,a);A.push(W)}s.morphAttributes[E]=A}s.morphTargetsRelative=this.morphTargetsRelative;const S=this.groups;for(let E=0,A=S.length;E<A;E++){const U=S[E];s.addGroup(U.start,U.count,U.materialIndex)}return s}toJSON(){const i={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),Object.keys(this.userData).length>0&&(i.userData=this.userData),this.parameters!==void 0){const A=this.parameters;for(const U in A)A[U]!==void 0&&(i[U]=A[U]);return i}i.data={attributes:{}};const s=this.index;s!==null&&(i.data.index={type:s.array.constructor.name,array:Array.prototype.slice.call(s.array)});const a=this.attributes;for(const A in a){const U=a[A];i.data.attributes[A]=U.toJSON(i.data)}const r={};let c=!1;for(const A in this.morphAttributes){const U=this.morphAttributes[A],B=[];for(let D=0,R=U.length;D<R;D++){const W=U[D];B.push(W.toJSON(i.data))}B.length>0&&(r[A]=B,c=!0)}c&&(i.data.morphAttributes=r,i.data.morphTargetsRelative=this.morphTargetsRelative);const S=this.groups;S.length>0&&(i.data.groups=JSON.parse(JSON.stringify(S)));const E=this.boundingSphere;return E!==null&&(i.data.boundingSphere={center:E.center.toArray(),radius:E.radius}),i}clone(){return new this.constructor().copy(this)}copy(i){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const s={};this.name=i.name;const a=i.index;a!==null&&this.setIndex(a.clone(s));const r=i.attributes;for(const U in r){const B=r[U];this.setAttribute(U,B.clone(s))}const c=i.morphAttributes;for(const U in c){const B=[],D=c[U];for(let R=0,W=D.length;R<W;R++)B.push(D[R].clone(s));this.morphAttributes[U]=B}this.morphTargetsRelative=i.morphTargetsRelative;const S=i.groups;for(let U=0,B=S.length;U<B;U++){const D=S[U];this.addGroup(D.start,D.count,D.materialIndex)}const E=i.boundingBox;E!==null&&(this.boundingBox=E.clone());const A=i.boundingSphere;return A!==null&&(this.boundingSphere=A.clone()),this.drawRange.start=i.drawRange.start,this.drawRange.count=i.drawRange.count,this.userData=i.userData,i.parameters!==void 0&&(this.parameters=Object.assign({},i.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const uV=new lc,T2=new Cq,yF=new kT,bS=new cr,xS=new cr,wS=new cr,bF=new cr,aO=new cr,sO=new Eo,uO=new Eo,cO=new Eo,xF=new cr,lO=new cr;class Ay extends ld{constructor(i=new Dy,s=new AT){super(),this.isMesh=!0,this.type="Mesh",this.geometry=i,this.material=s,this.updateMorphTargets()}copy(i,s){return super.copy(i,s),i.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=i.morphTargetInfluences.slice()),i.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},i.morphTargetDictionary)),this.material=i.material,this.geometry=i.geometry,this}updateMorphTargets(){const s=this.geometry.morphAttributes,a=Object.keys(s);if(a.length>0){const r=s[a[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let c=0,S=r.length;c<S;c++){const E=r[c].name||String(c);this.morphTargetInfluences.push(0),this.morphTargetDictionary[E]=c}}}}getVertexPosition(i,s){const a=this.geometry,r=a.attributes.position,c=a.morphAttributes.position,S=a.morphTargetsRelative;s.fromBufferAttribute(r,i);const E=this.morphTargetInfluences;if(c&&E){aO.set(0,0,0);for(let A=0,U=c.length;A<U;A++){const B=E[A],D=c[A];B!==0&&(bF.fromBufferAttribute(D,i),S?aO.addScaledVector(bF,B):aO.addScaledVector(bF.sub(s),B))}s.add(aO)}return this.isSkinnedMesh&&this.boneTransform(i,s),s}raycast(i,s){const a=this.geometry,r=this.material,c=this.matrixWorld;if(r===void 0||(a.boundingSphere===null&&a.computeBoundingSphere(),yF.copy(a.boundingSphere),yF.applyMatrix4(c),i.ray.intersectsSphere(yF)===!1)||(uV.copy(c).invert(),T2.copy(i.ray).applyMatrix4(uV),a.boundingBox!==null&&T2.intersectsBox(a.boundingBox)===!1))return;let S;const E=a.index,A=a.attributes.position,U=a.attributes.uv,B=a.attributes.uv2,D=a.groups,R=a.drawRange;if(E!==null)if(Array.isArray(r))for(let W=0,j=D.length;W<j;W++){const H=D[W],I=r[H.materialIndex],Q=Math.max(H.start,R.start),Y=Math.min(E.count,Math.min(H.start+H.count,R.start+R.count));for(let q=Q,ae=Y;q<ae;q+=3){const oe=E.getX(q),ye=E.getX(q+1),_e=E.getX(q+2);S=fO(this,I,i,T2,U,B,oe,ye,_e),S&&(S.faceIndex=Math.floor(q/3),S.face.materialIndex=H.materialIndex,s.push(S))}}else{const W=Math.max(0,R.start),j=Math.min(E.count,R.start+R.count);for(let H=W,I=j;H<I;H+=3){const Q=E.getX(H),Y=E.getX(H+1),q=E.getX(H+2);S=fO(this,r,i,T2,U,B,Q,Y,q),S&&(S.faceIndex=Math.floor(H/3),s.push(S))}}else if(A!==void 0)if(Array.isArray(r))for(let W=0,j=D.length;W<j;W++){const H=D[W],I=r[H.materialIndex],Q=Math.max(H.start,R.start),Y=Math.min(A.count,Math.min(H.start+H.count,R.start+R.count));for(let q=Q,ae=Y;q<ae;q+=3){const oe=q,ye=q+1,_e=q+2;S=fO(this,I,i,T2,U,B,oe,ye,_e),S&&(S.faceIndex=Math.floor(q/3),S.face.materialIndex=H.materialIndex,s.push(S))}}else{const W=Math.max(0,R.start),j=Math.min(A.count,R.start+R.count);for(let H=W,I=j;H<I;H+=3){const Q=H,Y=H+1,q=H+2;S=fO(this,r,i,T2,U,B,Q,Y,q),S&&(S.faceIndex=Math.floor(H/3),s.push(S))}}}}function Nce(h,i,s,a,r,c,S,E){let A;if(i.side===$g?A=a.intersectTriangle(S,c,r,!0,E):A=a.intersectTriangle(r,c,S,i.side===vw,E),A===null)return null;lO.copy(E),lO.applyMatrix4(h.matrixWorld);const U=s.ray.origin.distanceTo(lO);return U<s.near||U>s.far?null:{distance:U,point:lO.clone(),object:h}}function fO(h,i,s,a,r,c,S,E,A){h.getVertexPosition(S,bS),h.getVertexPosition(E,xS),h.getVertexPosition(A,wS);const U=Nce(h,i,s,a,bS,xS,wS,xF);if(U){r&&(sO.fromBufferAttribute(r,S),uO.fromBufferAttribute(r,E),cO.fromBufferAttribute(r,A),U.uv=T1.getUV(xF,bS,xS,wS,sO,uO,cO,new Eo)),c&&(sO.fromBufferAttribute(c,S),uO.fromBufferAttribute(c,E),cO.fromBufferAttribute(c,A),U.uv2=T1.getUV(xF,bS,xS,wS,sO,uO,cO,new Eo));const B={a:S,b:E,c:A,normal:new cr,materialIndex:0};T1.getNormal(bS,xS,wS,B.normal),U.face=B}return U}class xC extends Dy{constructor(i=1,s=1,a=1,r=1,c=1,S=1){super(),this.type="BoxGeometry",this.parameters={width:i,height:s,depth:a,widthSegments:r,heightSegments:c,depthSegments:S};const E=this;r=Math.floor(r),c=Math.floor(c),S=Math.floor(S);const A=[],U=[],B=[],D=[];let R=0,W=0;j("z","y","x",-1,-1,a,s,i,S,c,0),j("z","y","x",1,-1,a,s,-i,S,c,1),j("x","z","y",1,1,i,a,s,r,S,2),j("x","z","y",1,-1,i,a,-s,r,S,3),j("x","y","z",1,-1,i,s,a,r,c,4),j("x","y","z",-1,-1,i,s,-a,r,c,5),this.setIndex(A),this.setAttribute("position",new zp(U,3)),this.setAttribute("normal",new zp(B,3)),this.setAttribute("uv",new zp(D,2));function j(H,I,Q,Y,q,ae,oe,ye,_e,pe,me){const Ge=ae/_e,lt=oe/pe,It=ae/2,wt=oe/2,we=ye/2,yt=_e+1,Bt=pe+1;let Ot=0,ze=0;const Ut=new cr;for(let Ft=0;Ft<Bt;Ft++){const pt=Ft*lt-wt;for(let vt=0;vt<yt;vt++){const rn=vt*Ge-It;Ut[H]=rn*Y,Ut[I]=pt*q,Ut[Q]=we,U.push(Ut.x,Ut.y,Ut.z),Ut[H]=0,Ut[I]=0,Ut[Q]=ye>0?1:-1,B.push(Ut.x,Ut.y,Ut.z),D.push(vt/_e),D.push(1-Ft/pe),Ot+=1}}for(let Ft=0;Ft<pe;Ft++)for(let pt=0;pt<_e;pt++){const vt=R+pt+yt*Ft,rn=R+pt+yt*(Ft+1),xt=R+(pt+1)+yt*(Ft+1),_t=R+(pt+1)+yt*Ft;A.push(vt,rn,_t),A.push(rn,xt,_t),ze+=6}E.addGroup(W,ze,me),W+=ze,R+=Ot}}static fromJSON(i){return new xC(i.width,i.height,i.depth,i.widthSegments,i.heightSegments,i.depthSegments)}}function m_(h){const i={};for(const s in h){i[s]={};for(const a in h[s]){const r=h[s][a];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?i[s][a]=r.clone():Array.isArray(r)?i[s][a]=r.slice():i[s][a]=r}}return i}function bh(h){const i={};for(let s=0;s<h.length;s++){const a=m_(h[s]);for(const r in a)i[r]=a[r]}return i}function Ice(h){const i=[];for(let s=0;s<h.length;s++)i.push(h[s].clone());return i}function Tq(h){return h.getRenderTarget()===null&&h.outputEncoding===iu?Sy:cC}const Fce={clone:m_,merge:bh};var Rce=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Pce=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ww extends bC{constructor(i){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Rce,this.fragmentShader=Pce,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,i!==void 0&&this.setValues(i)}copy(i){return super.copy(i),this.fragmentShader=i.fragmentShader,this.vertexShader=i.vertexShader,this.uniforms=m_(i.uniforms),this.uniformsGroups=Ice(i.uniformsGroups),this.defines=Object.assign({},i.defines),this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.fog=i.fog,this.lights=i.lights,this.clipping=i.clipping,this.extensions=Object.assign({},i.extensions),this.glslVersion=i.glslVersion,this}toJSON(i){const s=super.toJSON(i);s.glslVersion=this.glslVersion,s.uniforms={};for(const r in this.uniforms){const S=this.uniforms[r].value;S&&S.isTexture?s.uniforms[r]={type:"t",value:S.toJSON(i).uuid}:S&&S.isColor?s.uniforms[r]={type:"c",value:S.getHex()}:S&&S.isVector2?s.uniforms[r]={type:"v2",value:S.toArray()}:S&&S.isVector3?s.uniforms[r]={type:"v3",value:S.toArray()}:S&&S.isVector4?s.uniforms[r]={type:"v4",value:S.toArray()}:S&&S.isMatrix3?s.uniforms[r]={type:"m3",value:S.toArray()}:S&&S.isMatrix4?s.uniforms[r]={type:"m4",value:S.toArray()}:s.uniforms[r]={value:S}}Object.keys(this.defines).length>0&&(s.defines=this.defines),s.vertexShader=this.vertexShader,s.fragmentShader=this.fragmentShader;const a={};for(const r in this.extensions)this.extensions[r]===!0&&(a[r]=!0);return Object.keys(a).length>0&&(s.extensions=a),s}}class Mq extends ld{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new lc,this.projectionMatrix=new lc,this.projectionMatrixInverse=new lc}copy(i,s){return super.copy(i,s),this.matrixWorldInverse.copy(i.matrixWorldInverse),this.projectionMatrix.copy(i.projectionMatrix),this.projectionMatrixInverse.copy(i.projectionMatrixInverse),this}getWorldDirection(i){this.updateWorldMatrix(!0,!1);const s=this.matrixWorld.elements;return i.set(-s[8],-s[9],-s[10]).normalize()}updateMatrixWorld(i){super.updateMatrixWorld(i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(i,s){super.updateWorldMatrix(i,s),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class Hg extends Mq{constructor(i=50,s=1,a=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=i,this.zoom=1,this.near=a,this.far=r,this.focus=10,this.aspect=s,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(i,s){return super.copy(i,s),this.fov=i.fov,this.zoom=i.zoom,this.near=i.near,this.far=i.far,this.focus=i.focus,this.aspect=i.aspect,this.view=i.view===null?null:Object.assign({},i.view),this.filmGauge=i.filmGauge,this.filmOffset=i.filmOffset,this}setFocalLength(i){const s=.5*this.getFilmHeight()/i;this.fov=JW*2*Math.atan(s),this.updateProjectionMatrix()}getFocalLength(){const i=Math.tan(eF*.5*this.fov);return .5*this.getFilmHeight()/i}getEffectiveFOV(){return JW*2*Math.atan(Math.tan(eF*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(i,s,a,r,c,S){this.aspect=i/s,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=i,this.view.fullHeight=s,this.view.offsetX=a,this.view.offsetY=r,this.view.width=c,this.view.height=S,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const i=this.near;let s=i*Math.tan(eF*.5*this.fov)/this.zoom,a=2*s,r=this.aspect*a,c=-.5*r;const S=this.view;if(this.view!==null&&this.view.enabled){const A=S.fullWidth,U=S.fullHeight;c+=S.offsetX*r/A,s-=S.offsetY*a/U,r*=S.width/A,a*=S.height/U}const E=this.filmOffset;E!==0&&(c+=i*E/this.getFilmWidth()),this.projectionMatrix.makePerspective(c,c+r,s,s-a,i,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(i){const s=super.toJSON(i);return s.object.fov=this.fov,s.object.zoom=this.zoom,s.object.near=this.near,s.object.far=this.far,s.object.focus=this.focus,s.object.aspect=this.aspect,this.view!==null&&(s.object.view=Object.assign({},this.view)),s.object.filmGauge=this.filmGauge,s.object.filmOffset=this.filmOffset,s}}const M2=-90,D2=1;class Lce extends ld{constructor(i,s,a){super(),this.type="CubeCamera",this.renderTarget=a;const r=new Hg(M2,D2,i,s);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);const c=new Hg(M2,D2,i,s);c.layers=this.layers,c.up.set(0,1,0),c.lookAt(-1,0,0),this.add(c);const S=new Hg(M2,D2,i,s);S.layers=this.layers,S.up.set(0,0,-1),S.lookAt(0,1,0),this.add(S);const E=new Hg(M2,D2,i,s);E.layers=this.layers,E.up.set(0,0,1),E.lookAt(0,-1,0),this.add(E);const A=new Hg(M2,D2,i,s);A.layers=this.layers,A.up.set(0,1,0),A.lookAt(0,0,1),this.add(A);const U=new Hg(M2,D2,i,s);U.layers=this.layers,U.up.set(0,1,0),U.lookAt(0,0,-1),this.add(U)}update(i,s){this.parent===null&&this.updateMatrixWorld();const a=this.renderTarget,[r,c,S,E,A,U]=this.children,B=i.getRenderTarget(),D=i.toneMapping,R=i.xr.enabled;i.toneMapping=I1,i.xr.enabled=!1;const W=a.texture.generateMipmaps;a.texture.generateMipmaps=!1,i.setRenderTarget(a,0),i.render(s,r),i.setRenderTarget(a,1),i.render(s,c),i.setRenderTarget(a,2),i.render(s,S),i.setRenderTarget(a,3),i.render(s,E),i.setRenderTarget(a,4),i.render(s,A),a.texture.generateMipmaps=W,i.setRenderTarget(a,5),i.render(s,U),i.setRenderTarget(B),i.toneMapping=D,i.xr.enabled=R,a.texture.needsPMREMUpdate=!0}}class Dq extends jp{constructor(i,s,a,r,c,S,E,A,U,B){i=i!==void 0?i:[],s=s!==void 0?s:d_,super(i,s,a,r,c,S,E,A,U,B),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(i){this.image=i}}class Bce extends xw{constructor(i=1,s={}){super(i,i,s),this.isWebGLCubeRenderTarget=!0;const a={width:i,height:i,depth:1},r=[a,a,a,a,a,a];this.texture=new Dq(r,s.mapping,s.wrapS,s.wrapT,s.magFilter,s.minFilter,s.format,s.type,s.anisotropy,s.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=s.generateMipmaps!==void 0?s.generateMipmaps:!1,this.texture.minFilter=s.minFilter!==void 0?s.minFilter:Np}fromEquirectangularTexture(i,s){this.texture.type=s.type,this.texture.encoding=s.encoding,this.texture.generateMipmaps=s.generateMipmaps,this.texture.minFilter=s.minFilter,this.texture.magFilter=s.magFilter;const a={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new xC(5,5,5),c=new ww({name:"CubemapFromEquirect",uniforms:m_(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,side:$g,blending:Kb});c.uniforms.tEquirect.value=s;const S=new Ay(r,c),E=s.minFilter;return s.minFilter===sC&&(s.minFilter=Np),new Lce(1,10,this).update(i,S),s.minFilter=E,S.geometry.dispose(),S.material.dispose(),this}clear(i,s,a,r){const c=i.getRenderTarget();for(let S=0;S<6;S++)i.setRenderTarget(this,S),i.clear(s,a,r);i.setRenderTarget(c)}}const wF=new cr,jce=new cr,zce=new $m;class ew{constructor(i=new cr(1,0,0),s=0){this.isPlane=!0,this.normal=i,this.constant=s}set(i,s){return this.normal.copy(i),this.constant=s,this}setComponents(i,s,a,r){return this.normal.set(i,s,a),this.constant=r,this}setFromNormalAndCoplanarPoint(i,s){return this.normal.copy(i),this.constant=-s.dot(this.normal),this}setFromCoplanarPoints(i,s,a){const r=wF.subVectors(a,s).cross(jce.subVectors(i,s)).normalize();return this.setFromNormalAndCoplanarPoint(r,i),this}copy(i){return this.normal.copy(i.normal),this.constant=i.constant,this}normalize(){const i=1/this.normal.length();return this.normal.multiplyScalar(i),this.constant*=i,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(i){return this.normal.dot(i)+this.constant}distanceToSphere(i){return this.distanceToPoint(i.center)-i.radius}projectPoint(i,s){return s.copy(this.normal).multiplyScalar(-this.distanceToPoint(i)).add(i)}intersectLine(i,s){const a=i.delta(wF),r=this.normal.dot(a);if(r===0)return this.distanceToPoint(i.start)===0?s.copy(i.start):null;const c=-(i.start.dot(this.normal)+this.constant)/r;return c<0||c>1?null:s.copy(a).multiplyScalar(c).add(i.start)}intersectsLine(i){const s=this.distanceToPoint(i.start),a=this.distanceToPoint(i.end);return s<0&&a>0||a<0&&s>0}intersectsBox(i){return i.intersectsPlane(this)}intersectsSphere(i){return i.intersectsPlane(this)}coplanarPoint(i){return i.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(i,s){const a=s||zce.getNormalMatrix(i),r=this.coplanarPoint(wF).applyMatrix4(i),c=this.normal.applyMatrix3(a).normalize();return this.constant=-r.dot(c),this}translate(i){return this.constant-=i.dot(this.normal),this}equals(i){return i.normal.equals(this.normal)&&i.constant===this.constant}clone(){return new this.constructor().copy(this)}}const N2=new kT,dO=new cr;class j5{constructor(i=new ew,s=new ew,a=new ew,r=new ew,c=new ew,S=new ew){this.planes=[i,s,a,r,c,S]}set(i,s,a,r,c,S){const E=this.planes;return E[0].copy(i),E[1].copy(s),E[2].copy(a),E[3].copy(r),E[4].copy(c),E[5].copy(S),this}copy(i){const s=this.planes;for(let a=0;a<6;a++)s[a].copy(i.planes[a]);return this}setFromProjectionMatrix(i){const s=this.planes,a=i.elements,r=a[0],c=a[1],S=a[2],E=a[3],A=a[4],U=a[5],B=a[6],D=a[7],R=a[8],W=a[9],j=a[10],H=a[11],I=a[12],Q=a[13],Y=a[14],q=a[15];return s[0].setComponents(E-r,D-A,H-R,q-I).normalize(),s[1].setComponents(E+r,D+A,H+R,q+I).normalize(),s[2].setComponents(E+c,D+U,H+W,q+Q).normalize(),s[3].setComponents(E-c,D-U,H-W,q-Q).normalize(),s[4].setComponents(E-S,D-B,H-j,q-Y).normalize(),s[5].setComponents(E+S,D+B,H+j,q+Y).normalize(),this}intersectsObject(i){const s=i.geometry;return s.boundingSphere===null&&s.computeBoundingSphere(),N2.copy(s.boundingSphere).applyMatrix4(i.matrixWorld),this.intersectsSphere(N2)}intersectsSprite(i){return N2.center.set(0,0,0),N2.radius=.7071067811865476,N2.applyMatrix4(i.matrixWorld),this.intersectsSphere(N2)}intersectsSphere(i){const s=this.planes,a=i.center,r=-i.radius;for(let c=0;c<6;c++)if(s[c].distanceToPoint(a)<r)return!1;return!0}intersectsBox(i){const s=this.planes;for(let a=0;a<6;a++){const r=s[a];if(dO.x=r.normal.x>0?i.max.x:i.min.x,dO.y=r.normal.y>0?i.max.y:i.min.y,dO.z=r.normal.z>0?i.max.z:i.min.z,r.distanceToPoint(dO)<0)return!1}return!0}containsPoint(i){const s=this.planes;for(let a=0;a<6;a++)if(s[a].distanceToPoint(i)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Nq(){let h=null,i=!1,s=null,a=null;function r(c,S){s(c,S),a=h.requestAnimationFrame(r)}return{start:function(){i!==!0&&s!==null&&(a=h.requestAnimationFrame(r),i=!0)},stop:function(){h.cancelAnimationFrame(a),i=!1},setAnimationLoop:function(c){s=c},setContext:function(c){h=c}}}function Uce(h,i){const s=i.isWebGL2,a=new WeakMap;function r(U,B){const D=U.array,R=U.usage,W=h.createBuffer();h.bindBuffer(B,W),h.bufferData(B,D,R),U.onUploadCallback();let j;if(D instanceof Float32Array)j=5126;else if(D instanceof Uint16Array)if(U.isFloat16BufferAttribute)if(s)j=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else j=5123;else if(D instanceof Int16Array)j=5122;else if(D instanceof Uint32Array)j=5125;else if(D instanceof Int32Array)j=5124;else if(D instanceof Int8Array)j=5120;else if(D instanceof Uint8Array)j=5121;else if(D instanceof Uint8ClampedArray)j=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+D);return{buffer:W,type:j,bytesPerElement:D.BYTES_PER_ELEMENT,version:U.version}}function c(U,B,D){const R=B.array,W=B.updateRange;h.bindBuffer(D,U),W.count===-1?h.bufferSubData(D,0,R):(s?h.bufferSubData(D,W.offset*R.BYTES_PER_ELEMENT,R,W.offset,W.count):h.bufferSubData(D,W.offset*R.BYTES_PER_ELEMENT,R.subarray(W.offset,W.offset+W.count)),W.count=-1),B.onUploadCallback()}function S(U){return U.isInterleavedBufferAttribute&&(U=U.data),a.get(U)}function E(U){U.isInterleavedBufferAttribute&&(U=U.data);const B=a.get(U);B&&(h.deleteBuffer(B.buffer),a.delete(U))}function A(U,B){if(U.isGLBufferAttribute){const R=a.get(U);(!R||R.version<U.version)&&a.set(U,{buffer:U.buffer,type:U.type,bytesPerElement:U.elementSize,version:U.version});return}U.isInterleavedBufferAttribute&&(U=U.data);const D=a.get(U);D===void 0?a.set(U,r(U,B)):D.version<U.version&&(c(D.buffer,U,B),D.version=U.version)}return{get:S,remove:E,update:A}}class OT extends Dy{constructor(i=1,s=1,a=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:i,height:s,widthSegments:a,heightSegments:r};const c=i/2,S=s/2,E=Math.floor(a),A=Math.floor(r),U=E+1,B=A+1,D=i/E,R=s/A,W=[],j=[],H=[],I=[];for(let Q=0;Q<B;Q++){const Y=Q*R-S;for(let q=0;q<U;q++){const ae=q*D-c;j.push(ae,-Y,0),H.push(0,0,1),I.push(q/E),I.push(1-Q/A)}}for(let Q=0;Q<A;Q++)for(let Y=0;Y<E;Y++){const q=Y+U*Q,ae=Y+U*(Q+1),oe=Y+1+U*(Q+1),ye=Y+1+U*Q;W.push(q,ae,ye),W.push(ae,oe,ye)}this.setIndex(W),this.setAttribute("position",new zp(j,3)),this.setAttribute("normal",new zp(H,3)),this.setAttribute("uv",new zp(I,2))}static fromJSON(i){return new OT(i.width,i.height,i.widthSegments,i.heightSegments)}}var Wce=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,Vce=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Hce=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,Gce=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,qce=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,$ce=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Xce="vec3 transformed = vec3( position );",Kce=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Yce=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,Jce=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Qce=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Zce=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,ele=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,tle=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,nle=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,rle=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,ile=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,ole=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,ale=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,sle=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,ule=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,cle=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,lle=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,fle=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,dle=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,hle=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,ple="gl_FragColor = linearToOutputTexel( gl_FragColor );",mle=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,gle=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,vle=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,yle=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,ble=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,xle=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,wle=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,_le=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Ele=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Sle=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Cle=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,kle=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Ale=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Ole=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Tle=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Mle=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Dle=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,Nle=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Ile=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Fle=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Rle=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Ple=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,Lle=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Ble=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,jle=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,zle=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,Ule=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Wle=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Vle=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,Hle=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,Gle=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,qle=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,$le=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Xle=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Kle=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Yle=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Jle=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Qle=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,Zle=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,efe=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,tfe=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,nfe=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,rfe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,ife=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,ofe=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,afe=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,sfe=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,ufe=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,cfe=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,lfe=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,ffe=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,dfe=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,hfe=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,pfe=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,mfe=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,gfe=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,vfe=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,yfe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,bfe=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,xfe=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,wfe=`#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,_fe=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Efe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Sfe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,Cfe=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,kfe=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Afe=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Ofe=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Tfe=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Mfe=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Dfe=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,Nfe=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,Ife=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,Ffe=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,Rfe=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,Pfe=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,Lfe=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,Bfe=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,jfe=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const zfe=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Ufe=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Wfe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Vfe=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Hfe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Gfe=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,qfe=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,$fe=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,Xfe=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,Kfe=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Yfe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Jfe=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Qfe=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Zfe=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,ede=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,tde=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,nde=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,rde=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ide=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,ode=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ade=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,sde=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,ude=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,cde=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,lde=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,fde=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,dde=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,hde=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,pde=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,mde=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,gde=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,vde=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,yde=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,bde=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,ra={alphamap_fragment:Wce,alphamap_pars_fragment:Vce,alphatest_fragment:Hce,alphatest_pars_fragment:Gce,aomap_fragment:qce,aomap_pars_fragment:$ce,begin_vertex:Xce,beginnormal_vertex:Kce,bsdfs:Yce,iridescence_fragment:Jce,bumpmap_pars_fragment:Qce,clipping_planes_fragment:Zce,clipping_planes_pars_fragment:ele,clipping_planes_pars_vertex:tle,clipping_planes_vertex:nle,color_fragment:rle,color_pars_fragment:ile,color_pars_vertex:ole,color_vertex:ale,common:sle,cube_uv_reflection_fragment:ule,defaultnormal_vertex:cle,displacementmap_pars_vertex:lle,displacementmap_vertex:fle,emissivemap_fragment:dle,emissivemap_pars_fragment:hle,encodings_fragment:ple,encodings_pars_fragment:mle,envmap_fragment:gle,envmap_common_pars_fragment:vle,envmap_pars_fragment:yle,envmap_pars_vertex:ble,envmap_physical_pars_fragment:Dle,envmap_vertex:xle,fog_vertex:wle,fog_pars_vertex:_le,fog_fragment:Ele,fog_pars_fragment:Sle,gradientmap_pars_fragment:Cle,lightmap_fragment:kle,lightmap_pars_fragment:Ale,lights_lambert_fragment:Ole,lights_lambert_pars_fragment:Tle,lights_pars_begin:Mle,lights_toon_fragment:Nle,lights_toon_pars_fragment:Ile,lights_phong_fragment:Fle,lights_phong_pars_fragment:Rle,lights_physical_fragment:Ple,lights_physical_pars_fragment:Lle,lights_fragment_begin:Ble,lights_fragment_maps:jle,lights_fragment_end:zle,logdepthbuf_fragment:Ule,logdepthbuf_pars_fragment:Wle,logdepthbuf_pars_vertex:Vle,logdepthbuf_vertex:Hle,map_fragment:Gle,map_pars_fragment:qle,map_particle_fragment:$le,map_particle_pars_fragment:Xle,metalnessmap_fragment:Kle,metalnessmap_pars_fragment:Yle,morphcolor_vertex:Jle,morphnormal_vertex:Qle,morphtarget_pars_vertex:Zle,morphtarget_vertex:efe,normal_fragment_begin:tfe,normal_fragment_maps:nfe,normal_pars_fragment:rfe,normal_pars_vertex:ife,normal_vertex:ofe,normalmap_pars_fragment:afe,clearcoat_normal_fragment_begin:sfe,clearcoat_normal_fragment_maps:ufe,clearcoat_pars_fragment:cfe,iridescence_pars_fragment:lfe,output_fragment:ffe,packing:dfe,premultiplied_alpha_fragment:hfe,project_vertex:pfe,dithering_fragment:mfe,dithering_pars_fragment:gfe,roughnessmap_fragment:vfe,roughnessmap_pars_fragment:yfe,shadowmap_pars_fragment:bfe,shadowmap_pars_vertex:xfe,shadowmap_vertex:wfe,shadowmask_pars_fragment:_fe,skinbase_vertex:Efe,skinning_pars_vertex:Sfe,skinning_vertex:Cfe,skinnormal_vertex:kfe,specularmap_fragment:Afe,specularmap_pars_fragment:Ofe,tonemapping_fragment:Tfe,tonemapping_pars_fragment:Mfe,transmission_fragment:Dfe,transmission_pars_fragment:Nfe,uv_pars_fragment:Ife,uv_pars_vertex:Ffe,uv_vertex:Rfe,uv2_pars_fragment:Pfe,uv2_pars_vertex:Lfe,uv2_vertex:Bfe,worldpos_vertex:jfe,background_vert:zfe,background_frag:Ufe,backgroundCube_vert:Wfe,backgroundCube_frag:Vfe,cube_vert:Hfe,cube_frag:Gfe,depth_vert:qfe,depth_frag:$fe,distanceRGBA_vert:Xfe,distanceRGBA_frag:Kfe,equirect_vert:Yfe,equirect_frag:Jfe,linedashed_vert:Qfe,linedashed_frag:Zfe,meshbasic_vert:ede,meshbasic_frag:tde,meshlambert_vert:nde,meshlambert_frag:rde,meshmatcap_vert:ide,meshmatcap_frag:ode,meshnormal_vert:ade,meshnormal_frag:sde,meshphong_vert:ude,meshphong_frag:cde,meshphysical_vert:lde,meshphysical_frag:fde,meshtoon_vert:dde,meshtoon_frag:hde,points_vert:pde,points_frag:mde,shadow_vert:gde,shadow_frag:vde,sprite_vert:yde,sprite_frag:bde},bi={common:{diffuse:{value:new bs(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new $m},uv2Transform:{value:new $m},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Eo(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new bs(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new bs(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new $m}},sprite:{diffuse:{value:new bs(16777215)},opacity:{value:1},center:{value:new Eo(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new $m}}},Cy={basic:{uniforms:bh([bi.common,bi.specularmap,bi.envmap,bi.aomap,bi.lightmap,bi.fog]),vertexShader:ra.meshbasic_vert,fragmentShader:ra.meshbasic_frag},lambert:{uniforms:bh([bi.common,bi.specularmap,bi.envmap,bi.aomap,bi.lightmap,bi.emissivemap,bi.bumpmap,bi.normalmap,bi.displacementmap,bi.fog,bi.lights,{emissive:{value:new bs(0)}}]),vertexShader:ra.meshlambert_vert,fragmentShader:ra.meshlambert_frag},phong:{uniforms:bh([bi.common,bi.specularmap,bi.envmap,bi.aomap,bi.lightmap,bi.emissivemap,bi.bumpmap,bi.normalmap,bi.displacementmap,bi.fog,bi.lights,{emissive:{value:new bs(0)},specular:{value:new bs(1118481)},shininess:{value:30}}]),vertexShader:ra.meshphong_vert,fragmentShader:ra.meshphong_frag},standard:{uniforms:bh([bi.common,bi.envmap,bi.aomap,bi.lightmap,bi.emissivemap,bi.bumpmap,bi.normalmap,bi.displacementmap,bi.roughnessmap,bi.metalnessmap,bi.fog,bi.lights,{emissive:{value:new bs(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ra.meshphysical_vert,fragmentShader:ra.meshphysical_frag},toon:{uniforms:bh([bi.common,bi.aomap,bi.lightmap,bi.emissivemap,bi.bumpmap,bi.normalmap,bi.displacementmap,bi.gradientmap,bi.fog,bi.lights,{emissive:{value:new bs(0)}}]),vertexShader:ra.meshtoon_vert,fragmentShader:ra.meshtoon_frag},matcap:{uniforms:bh([bi.common,bi.bumpmap,bi.normalmap,bi.displacementmap,bi.fog,{matcap:{value:null}}]),vertexShader:ra.meshmatcap_vert,fragmentShader:ra.meshmatcap_frag},points:{uniforms:bh([bi.points,bi.fog]),vertexShader:ra.points_vert,fragmentShader:ra.points_frag},dashed:{uniforms:bh([bi.common,bi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ra.linedashed_vert,fragmentShader:ra.linedashed_frag},depth:{uniforms:bh([bi.common,bi.displacementmap]),vertexShader:ra.depth_vert,fragmentShader:ra.depth_frag},normal:{uniforms:bh([bi.common,bi.bumpmap,bi.normalmap,bi.displacementmap,{opacity:{value:1}}]),vertexShader:ra.meshnormal_vert,fragmentShader:ra.meshnormal_frag},sprite:{uniforms:bh([bi.sprite,bi.fog]),vertexShader:ra.sprite_vert,fragmentShader:ra.sprite_frag},background:{uniforms:{uvTransform:{value:new $m},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ra.background_vert,fragmentShader:ra.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:ra.backgroundCube_vert,fragmentShader:ra.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ra.cube_vert,fragmentShader:ra.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ra.equirect_vert,fragmentShader:ra.equirect_frag},distanceRGBA:{uniforms:bh([bi.common,bi.displacementmap,{referencePosition:{value:new cr},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ra.distanceRGBA_vert,fragmentShader:ra.distanceRGBA_frag},shadow:{uniforms:bh([bi.lights,bi.fog,{color:{value:new bs(0)},opacity:{value:1}}]),vertexShader:ra.shadow_vert,fragmentShader:ra.shadow_frag}};Cy.physical={uniforms:bh([Cy.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Eo(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new bs(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Eo},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new bs(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new bs(1,1,1)},specularColorMap:{value:null}}]),vertexShader:ra.meshphysical_vert,fragmentShader:ra.meshphysical_frag};const hO={r:0,b:0,g:0};function xde(h,i,s,a,r,c,S){const E=new bs(0);let A=c===!0?0:1,U,B,D=null,R=0,W=null;function j(I,Q){let Y=!1,q=Q.isScene===!0?Q.background:null;q&&q.isTexture&&(q=(Q.backgroundBlurriness>0?s:i).get(q));const ae=h.xr,oe=ae.getSession&&ae.getSession();oe&&oe.environmentBlendMode==="additive"&&(q=null),q===null?H(E,A):q&&q.isColor&&(H(q,1),Y=!0),(h.autoClear||Y)&&h.clear(h.autoClearColor,h.autoClearDepth,h.autoClearStencil),q&&(q.isCubeTexture||q.mapping===CT)?(B===void 0&&(B=new Ay(new xC(1,1,1),new ww({name:"BackgroundCubeMaterial",uniforms:m_(Cy.backgroundCube.uniforms),vertexShader:Cy.backgroundCube.vertexShader,fragmentShader:Cy.backgroundCube.fragmentShader,side:$g,depthTest:!1,depthWrite:!1,fog:!1})),B.geometry.deleteAttribute("normal"),B.geometry.deleteAttribute("uv"),B.onBeforeRender=function(ye,_e,pe){this.matrixWorld.copyPosition(pe.matrixWorld)},Object.defineProperty(B.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(B)),B.material.uniforms.envMap.value=q,B.material.uniforms.flipEnvMap.value=q.isCubeTexture&&q.isRenderTargetTexture===!1?-1:1,B.material.uniforms.backgroundBlurriness.value=Q.backgroundBlurriness,B.material.uniforms.backgroundIntensity.value=Q.backgroundIntensity,B.material.toneMapped=q.encoding!==iu,(D!==q||R!==q.version||W!==h.toneMapping)&&(B.material.needsUpdate=!0,D=q,R=q.version,W=h.toneMapping),B.layers.enableAll(),I.unshift(B,B.geometry,B.material,0,0,null)):q&&q.isTexture&&(U===void 0&&(U=new Ay(new OT(2,2),new ww({name:"BackgroundMaterial",uniforms:m_(Cy.background.uniforms),vertexShader:Cy.background.vertexShader,fragmentShader:Cy.background.fragmentShader,side:vw,depthTest:!1,depthWrite:!1,fog:!1})),U.geometry.deleteAttribute("normal"),Object.defineProperty(U.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(U)),U.material.uniforms.t2D.value=q,U.material.uniforms.backgroundIntensity.value=Q.backgroundIntensity,U.material.toneMapped=q.encoding!==iu,q.matrixAutoUpdate===!0&&q.updateMatrix(),U.material.uniforms.uvTransform.value.copy(q.matrix),(D!==q||R!==q.version||W!==h.toneMapping)&&(U.material.needsUpdate=!0,D=q,R=q.version,W=h.toneMapping),U.layers.enableAll(),I.unshift(U,U.geometry,U.material,0,0,null))}function H(I,Q){I.getRGB(hO,Tq(h)),a.buffers.color.setClear(hO.r,hO.g,hO.b,Q,S)}return{getClearColor:function(){return E},setClearColor:function(I,Q=1){E.set(I),A=Q,H(E,A)},getClearAlpha:function(){return A},setClearAlpha:function(I){A=I,H(E,A)},render:j}}function wde(h,i,s,a){const r=h.getParameter(34921),c=a.isWebGL2?null:i.get("OES_vertex_array_object"),S=a.isWebGL2||c!==null,E={},A=I(null);let U=A,B=!1;function D(we,yt,Bt,Ot,ze){let Ut=!1;if(S){const Ft=H(Ot,Bt,yt);U!==Ft&&(U=Ft,W(U.object)),Ut=Q(we,Ot,Bt,ze),Ut&&Y(we,Ot,Bt,ze)}else{const Ft=yt.wireframe===!0;(U.geometry!==Ot.id||U.program!==Bt.id||U.wireframe!==Ft)&&(U.geometry=Ot.id,U.program=Bt.id,U.wireframe=Ft,Ut=!0)}ze!==null&&s.update(ze,34963),(Ut||B)&&(B=!1,pe(we,yt,Bt,Ot),ze!==null&&h.bindBuffer(34963,s.get(ze).buffer))}function R(){return a.isWebGL2?h.createVertexArray():c.createVertexArrayOES()}function W(we){return a.isWebGL2?h.bindVertexArray(we):c.bindVertexArrayOES(we)}function j(we){return a.isWebGL2?h.deleteVertexArray(we):c.deleteVertexArrayOES(we)}function H(we,yt,Bt){const Ot=Bt.wireframe===!0;let ze=E[we.id];ze===void 0&&(ze={},E[we.id]=ze);let Ut=ze[yt.id];Ut===void 0&&(Ut={},ze[yt.id]=Ut);let Ft=Ut[Ot];return Ft===void 0&&(Ft=I(R()),Ut[Ot]=Ft),Ft}function I(we){const yt=[],Bt=[],Ot=[];for(let ze=0;ze<r;ze++)yt[ze]=0,Bt[ze]=0,Ot[ze]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:yt,enabledAttributes:Bt,attributeDivisors:Ot,object:we,attributes:{},index:null}}function Q(we,yt,Bt,Ot){const ze=U.attributes,Ut=yt.attributes;let Ft=0;const pt=Bt.getAttributes();for(const vt in pt)if(pt[vt].location>=0){const xt=ze[vt];let _t=Ut[vt];if(_t===void 0&&(vt==="instanceMatrix"&&we.instanceMatrix&&(_t=we.instanceMatrix),vt==="instanceColor"&&we.instanceColor&&(_t=we.instanceColor)),xt===void 0||xt.attribute!==_t||_t&&xt.data!==_t.data)return!0;Ft++}return U.attributesNum!==Ft||U.index!==Ot}function Y(we,yt,Bt,Ot){const ze={},Ut=yt.attributes;let Ft=0;const pt=Bt.getAttributes();for(const vt in pt)if(pt[vt].location>=0){let xt=Ut[vt];xt===void 0&&(vt==="instanceMatrix"&&we.instanceMatrix&&(xt=we.instanceMatrix),vt==="instanceColor"&&we.instanceColor&&(xt=we.instanceColor));const _t={};_t.attribute=xt,xt&&xt.data&&(_t.data=xt.data),ze[vt]=_t,Ft++}U.attributes=ze,U.attributesNum=Ft,U.index=Ot}function q(){const we=U.newAttributes;for(let yt=0,Bt=we.length;yt<Bt;yt++)we[yt]=0}function ae(we){oe(we,0)}function oe(we,yt){const Bt=U.newAttributes,Ot=U.enabledAttributes,ze=U.attributeDivisors;Bt[we]=1,Ot[we]===0&&(h.enableVertexAttribArray(we),Ot[we]=1),ze[we]!==yt&&((a.isWebGL2?h:i.get("ANGLE_instanced_arrays"))[a.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](we,yt),ze[we]=yt)}function ye(){const we=U.newAttributes,yt=U.enabledAttributes;for(let Bt=0,Ot=yt.length;Bt<Ot;Bt++)yt[Bt]!==we[Bt]&&(h.disableVertexAttribArray(Bt),yt[Bt]=0)}function _e(we,yt,Bt,Ot,ze,Ut){a.isWebGL2===!0&&(Bt===5124||Bt===5125)?h.vertexAttribIPointer(we,yt,Bt,ze,Ut):h.vertexAttribPointer(we,yt,Bt,Ot,ze,Ut)}function pe(we,yt,Bt,Ot){if(a.isWebGL2===!1&&(we.isInstancedMesh||Ot.isInstancedBufferGeometry)&&i.get("ANGLE_instanced_arrays")===null)return;q();const ze=Ot.attributes,Ut=Bt.getAttributes(),Ft=yt.defaultAttributeValues;for(const pt in Ut){const vt=Ut[pt];if(vt.location>=0){let rn=ze[pt];if(rn===void 0&&(pt==="instanceMatrix"&&we.instanceMatrix&&(rn=we.instanceMatrix),pt==="instanceColor"&&we.instanceColor&&(rn=we.instanceColor)),rn!==void 0){const xt=rn.normalized,_t=rn.itemSize,Xt=s.get(rn);if(Xt===void 0)continue;const sn=Xt.buffer,kn=Xt.type,an=Xt.bytesPerElement;if(rn.isInterleavedBufferAttribute){const Ve=rn.data,Ye=Ve.stride,$e=rn.offset;if(Ve.isInstancedInterleavedBuffer){for(let ft=0;ft<vt.locationSize;ft++)oe(vt.location+ft,Ve.meshPerAttribute);we.isInstancedMesh!==!0&&Ot._maxInstanceCount===void 0&&(Ot._maxInstanceCount=Ve.meshPerAttribute*Ve.count)}else for(let ft=0;ft<vt.locationSize;ft++)ae(vt.location+ft);h.bindBuffer(34962,sn);for(let ft=0;ft<vt.locationSize;ft++)_e(vt.location+ft,_t/vt.locationSize,kn,xt,Ye*an,($e+_t/vt.locationSize*ft)*an)}else{if(rn.isInstancedBufferAttribute){for(let Ve=0;Ve<vt.locationSize;Ve++)oe(vt.location+Ve,rn.meshPerAttribute);we.isInstancedMesh!==!0&&Ot._maxInstanceCount===void 0&&(Ot._maxInstanceCount=rn.meshPerAttribute*rn.count)}else for(let Ve=0;Ve<vt.locationSize;Ve++)ae(vt.location+Ve);h.bindBuffer(34962,sn);for(let Ve=0;Ve<vt.locationSize;Ve++)_e(vt.location+Ve,_t/vt.locationSize,kn,xt,_t*an,_t/vt.locationSize*Ve*an)}}else if(Ft!==void 0){const xt=Ft[pt];if(xt!==void 0)switch(xt.length){case 2:h.vertexAttrib2fv(vt.location,xt);break;case 3:h.vertexAttrib3fv(vt.location,xt);break;case 4:h.vertexAttrib4fv(vt.location,xt);break;default:h.vertexAttrib1fv(vt.location,xt)}}}}ye()}function me(){It();for(const we in E){const yt=E[we];for(const Bt in yt){const Ot=yt[Bt];for(const ze in Ot)j(Ot[ze].object),delete Ot[ze];delete yt[Bt]}delete E[we]}}function Ge(we){if(E[we.id]===void 0)return;const yt=E[we.id];for(const Bt in yt){const Ot=yt[Bt];for(const ze in Ot)j(Ot[ze].object),delete Ot[ze];delete yt[Bt]}delete E[we.id]}function lt(we){for(const yt in E){const Bt=E[yt];if(Bt[we.id]===void 0)continue;const Ot=Bt[we.id];for(const ze in Ot)j(Ot[ze].object),delete Ot[ze];delete Bt[we.id]}}function It(){wt(),B=!0,U!==A&&(U=A,W(U.object))}function wt(){A.geometry=null,A.program=null,A.wireframe=!1}return{setup:D,reset:It,resetDefaultState:wt,dispose:me,releaseStatesOfGeometry:Ge,releaseStatesOfProgram:lt,initAttributes:q,enableAttribute:ae,disableUnusedAttributes:ye}}function _de(h,i,s,a){const r=a.isWebGL2;let c;function S(U){c=U}function E(U,B){h.drawArrays(c,U,B),s.update(B,c,1)}function A(U,B,D){if(D===0)return;let R,W;if(r)R=h,W="drawArraysInstanced";else if(R=i.get("ANGLE_instanced_arrays"),W="drawArraysInstancedANGLE",R===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}R[W](c,U,B,D),s.update(B,c,D)}this.setMode=S,this.render=E,this.renderInstances=A}function Ede(h,i,s){let a;function r(){if(a!==void 0)return a;if(i.has("EXT_texture_filter_anisotropic")===!0){const _e=i.get("EXT_texture_filter_anisotropic");a=h.getParameter(_e.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else a=0;return a}function c(_e){if(_e==="highp"){if(h.getShaderPrecisionFormat(35633,36338).precision>0&&h.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";_e="mediump"}return _e==="mediump"&&h.getShaderPrecisionFormat(35633,36337).precision>0&&h.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const S=typeof WebGL2RenderingContext<"u"&&h instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&h instanceof WebGL2ComputeRenderingContext;let E=s.precision!==void 0?s.precision:"highp";const A=c(E);A!==E&&(console.warn("THREE.WebGLRenderer:",E,"not supported, using",A,"instead."),E=A);const U=S||i.has("WEBGL_draw_buffers"),B=s.logarithmicDepthBuffer===!0,D=h.getParameter(34930),R=h.getParameter(35660),W=h.getParameter(3379),j=h.getParameter(34076),H=h.getParameter(34921),I=h.getParameter(36347),Q=h.getParameter(36348),Y=h.getParameter(36349),q=R>0,ae=S||i.has("OES_texture_float"),oe=q&&ae,ye=S?h.getParameter(36183):0;return{isWebGL2:S,drawBuffers:U,getMaxAnisotropy:r,getMaxPrecision:c,precision:E,logarithmicDepthBuffer:B,maxTextures:D,maxVertexTextures:R,maxTextureSize:W,maxCubemapSize:j,maxAttributes:H,maxVertexUniforms:I,maxVaryings:Q,maxFragmentUniforms:Y,vertexTextures:q,floatFragmentTextures:ae,floatVertexTextures:oe,maxSamples:ye}}function Sde(h){const i=this;let s=null,a=0,r=!1,c=!1;const S=new ew,E=new $m,A={value:null,needsUpdate:!1};this.uniform=A,this.numPlanes=0,this.numIntersection=0,this.init=function(D,R,W){const j=D.length!==0||R||a!==0||r;return r=R,s=B(D,W,0),a=D.length,j},this.beginShadows=function(){c=!0,B(null)},this.endShadows=function(){c=!1,U()},this.setState=function(D,R,W){const j=D.clippingPlanes,H=D.clipIntersection,I=D.clipShadows,Q=h.get(D);if(!r||j===null||j.length===0||c&&!I)c?B(null):U();else{const Y=c?0:a,q=Y*4;let ae=Q.clippingState||null;A.value=ae,ae=B(j,R,q,W);for(let oe=0;oe!==q;++oe)ae[oe]=s[oe];Q.clippingState=ae,this.numIntersection=H?this.numPlanes:0,this.numPlanes+=Y}};function U(){A.value!==s&&(A.value=s,A.needsUpdate=a>0),i.numPlanes=a,i.numIntersection=0}function B(D,R,W,j){const H=D!==null?D.length:0;let I=null;if(H!==0){if(I=A.value,j!==!0||I===null){const Q=W+H*4,Y=R.matrixWorldInverse;E.getNormalMatrix(Y),(I===null||I.length<Q)&&(I=new Float32Array(Q));for(let q=0,ae=W;q!==H;++q,ae+=4)S.copy(D[q]).applyMatrix4(Y,E),S.normal.toArray(I,ae),I[ae+3]=S.constant}A.value=I,A.needsUpdate=!0}return i.numPlanes=H,i.numIntersection=0,I}}function Cde(h){let i=new WeakMap;function s(S,E){return E===TR?S.mapping=d_:E===MR&&(S.mapping=h_),S}function a(S){if(S&&S.isTexture&&S.isRenderTargetTexture===!1){const E=S.mapping;if(E===TR||E===MR)if(i.has(S)){const A=i.get(S).texture;return s(A,S.mapping)}else{const A=S.image;if(A&&A.height>0){const U=new Bce(A.height/2);return U.fromEquirectangularTexture(h,S),i.set(S,U),S.addEventListener("dispose",r),s(U.texture,S.mapping)}else return null}}return S}function r(S){const E=S.target;E.removeEventListener("dispose",r);const A=i.get(E);A!==void 0&&(i.delete(E),A.dispose())}function c(){i=new WeakMap}return{get:a,dispose:c}}class FR extends Mq{constructor(i=-1,s=1,a=1,r=-1,c=.1,S=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=i,this.right=s,this.top=a,this.bottom=r,this.near=c,this.far=S,this.updateProjectionMatrix()}copy(i,s){return super.copy(i,s),this.left=i.left,this.right=i.right,this.top=i.top,this.bottom=i.bottom,this.near=i.near,this.far=i.far,this.zoom=i.zoom,this.view=i.view===null?null:Object.assign({},i.view),this}setViewOffset(i,s,a,r,c,S){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=i,this.view.fullHeight=s,this.view.offsetX=a,this.view.offsetY=r,this.view.width=c,this.view.height=S,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const i=(this.right-this.left)/(2*this.zoom),s=(this.top-this.bottom)/(2*this.zoom),a=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let c=a-i,S=a+i,E=r+s,A=r-s;if(this.view!==null&&this.view.enabled){const U=(this.right-this.left)/this.view.fullWidth/this.zoom,B=(this.top-this.bottom)/this.view.fullHeight/this.zoom;c+=U*this.view.offsetX,S=c+U*this.view.width,E-=B*this.view.offsetY,A=E-B*this.view.height}this.projectionMatrix.makeOrthographic(c,S,E,A,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(i){const s=super.toJSON(i);return s.object.zoom=this.zoom,s.object.left=this.left,s.object.right=this.right,s.object.top=this.top,s.object.bottom=this.bottom,s.object.near=this.near,s.object.far=this.far,this.view!==null&&(s.object.view=Object.assign({},this.view)),s}}const K2=4,cV=[.125,.215,.35,.446,.526,.582],nw=20,_F=new FR,lV=new bs;let EF=null;const tw=(1+Math.sqrt(5))/2,I2=1/tw,fV=[new cr(1,1,1),new cr(-1,1,1),new cr(1,1,-1),new cr(-1,1,-1),new cr(0,tw,I2),new cr(0,tw,-I2),new cr(I2,0,tw),new cr(-I2,0,tw),new cr(tw,I2,0),new cr(-tw,I2,0)];class dV{constructor(i){this._renderer=i,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(i,s=0,a=.1,r=100){EF=this._renderer.getRenderTarget(),this._setSize(256);const c=this._allocateTargets();return c.depthBuffer=!0,this._sceneToCubeUV(i,a,r,c),s>0&&this._blur(c,0,0,s),this._applyPMREM(c),this._cleanup(c),c}fromEquirectangular(i,s=null){return this._fromTexture(i,s)}fromCubemap(i,s=null){return this._fromTexture(i,s)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=mV(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=pV(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(i){this._lodMax=Math.floor(Math.log2(i)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let i=0;i<this._lodPlanes.length;i++)this._lodPlanes[i].dispose()}_cleanup(i){this._renderer.setRenderTarget(EF),i.scissorTest=!1,pO(i,0,0,i.width,i.height)}_fromTexture(i,s){i.mapping===d_||i.mapping===h_?this._setSize(i.image.length===0?16:i.image[0].width||i.image[0].image.width):this._setSize(i.image.width/4),EF=this._renderer.getRenderTarget();const a=s||this._allocateTargets();return this._textureToCubeUV(i,a),this._applyPMREM(a),this._cleanup(a),a}_allocateTargets(){const i=3*Math.max(this._cubeSize,112),s=4*this._cubeSize,a={magFilter:Np,minFilter:Np,generateMipmaps:!1,type:uC,format:nv,encoding:bw,depthBuffer:!1},r=hV(i,s,a);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=hV(i,s,a);const{_lodMax:c}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=kde(c)),this._blurMaterial=Ade(c,i,s)}return r}_compileMaterial(i){const s=new Ay(this._lodPlanes[0],i);this._renderer.compile(s,_F)}_sceneToCubeUV(i,s,a,r){const E=new Hg(90,1,s,a),A=[1,-1,1,1,1,1],U=[1,1,1,-1,-1,-1],B=this._renderer,D=B.autoClear,R=B.toneMapping;B.getClearColor(lV),B.toneMapping=I1,B.autoClear=!1;const W=new AT({name:"PMREM.Background",side:$g,depthWrite:!1,depthTest:!1}),j=new Ay(new xC,W);let H=!1;const I=i.background;I?I.isColor&&(W.color.copy(I),i.background=null,H=!0):(W.color.copy(lV),H=!0);for(let Q=0;Q<6;Q++){const Y=Q%3;Y===0?(E.up.set(0,A[Q],0),E.lookAt(U[Q],0,0)):Y===1?(E.up.set(0,0,A[Q]),E.lookAt(0,U[Q],0)):(E.up.set(0,A[Q],0),E.lookAt(0,0,U[Q]));const q=this._cubeSize;pO(r,Y*q,Q>2?q:0,q,q),B.setRenderTarget(r),H&&B.render(j,E),B.render(i,E)}j.geometry.dispose(),j.material.dispose(),B.toneMapping=R,B.autoClear=D,i.background=I}_textureToCubeUV(i,s){const a=this._renderer,r=i.mapping===d_||i.mapping===h_;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=mV()),this._cubemapMaterial.uniforms.flipEnvMap.value=i.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=pV());const c=r?this._cubemapMaterial:this._equirectMaterial,S=new Ay(this._lodPlanes[0],c),E=c.uniforms;E.envMap.value=i;const A=this._cubeSize;pO(s,0,0,3*A,2*A),a.setRenderTarget(s),a.render(S,_F)}_applyPMREM(i){const s=this._renderer,a=s.autoClear;s.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const c=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),S=fV[(r-1)%fV.length];this._blur(i,r-1,r,c,S)}s.autoClear=a}_blur(i,s,a,r,c){const S=this._pingPongRenderTarget;this._halfBlur(i,S,s,a,r,"latitudinal",c),this._halfBlur(S,i,a,a,r,"longitudinal",c)}_halfBlur(i,s,a,r,c,S,E){const A=this._renderer,U=this._blurMaterial;S!=="latitudinal"&&S!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const B=3,D=new Ay(this._lodPlanes[r],U),R=U.uniforms,W=this._sizeLods[a]-1,j=isFinite(c)?Math.PI/(2*W):2*Math.PI/(2*nw-1),H=c/j,I=isFinite(c)?1+Math.floor(B*H):nw;I>nw&&console.warn(`sigmaRadians, ${c}, is too large and will clip, as it requested ${I} samples when the maximum is set to ${nw}`);const Q=[];let Y=0;for(let _e=0;_e<nw;++_e){const pe=_e/H,me=Math.exp(-pe*pe/2);Q.push(me),_e===0?Y+=me:_e<I&&(Y+=2*me)}for(let _e=0;_e<Q.length;_e++)Q[_e]=Q[_e]/Y;R.envMap.value=i.texture,R.samples.value=I,R.weights.value=Q,R.latitudinal.value=S==="latitudinal",E&&(R.poleAxis.value=E);const{_lodMax:q}=this;R.dTheta.value=j,R.mipInt.value=q-a;const ae=this._sizeLods[r],oe=3*ae*(r>q-K2?r-q+K2:0),ye=4*(this._cubeSize-ae);pO(s,oe,ye,3*ae,2*ae),A.setRenderTarget(s),A.render(D,_F)}}function kde(h){const i=[],s=[],a=[];let r=h;const c=h-K2+1+cV.length;for(let S=0;S<c;S++){const E=Math.pow(2,r);s.push(E);let A=1/E;S>h-K2?A=cV[S-h+K2-1]:S===0&&(A=0),a.push(A);const U=1/(E-2),B=-U,D=1+U,R=[B,B,D,B,D,D,B,B,D,D,B,D],W=6,j=6,H=3,I=2,Q=1,Y=new Float32Array(H*j*W),q=new Float32Array(I*j*W),ae=new Float32Array(Q*j*W);for(let ye=0;ye<W;ye++){const _e=ye%3*2/3-1,pe=ye>2?0:-1,me=[_e,pe,0,_e+2/3,pe,0,_e+2/3,pe+1,0,_e,pe,0,_e+2/3,pe+1,0,_e,pe+1,0];Y.set(me,H*j*ye),q.set(R,I*j*ye);const Ge=[ye,ye,ye,ye,ye,ye];ae.set(Ge,Q*j*ye)}const oe=new Dy;oe.setAttribute("position",new My(Y,H)),oe.setAttribute("uv",new My(q,I)),oe.setAttribute("faceIndex",new My(ae,Q)),i.push(oe),r>K2&&r--}return{lodPlanes:i,sizeLods:s,sigmas:a}}function hV(h,i,s){const a=new xw(h,i,s);return a.texture.mapping=CT,a.texture.name="PMREM.cubeUv",a.scissorTest=!0,a}function pO(h,i,s,a,r){h.viewport.set(i,s,a,r),h.scissor.set(i,s,a,r)}function Ade(h,i,s){const a=new Float32Array(nw),r=new cr(0,1,0);return new ww({name:"SphericalGaussianBlur",defines:{n:nw,CUBEUV_TEXEL_WIDTH:1/i,CUBEUV_TEXEL_HEIGHT:1/s,CUBEUV_MAX_MIP:`${h}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:a},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:z5(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Kb,depthTest:!1,depthWrite:!1})}function pV(){return new ww({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:z5(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Kb,depthTest:!1,depthWrite:!1})}function mV(){return new ww({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:z5(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Kb,depthTest:!1,depthWrite:!1})}function z5(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Ode(h){let i=new WeakMap,s=null;function a(E){if(E&&E.isTexture){const A=E.mapping,U=A===TR||A===MR,B=A===d_||A===h_;if(U||B)if(E.isRenderTargetTexture&&E.needsPMREMUpdate===!0){E.needsPMREMUpdate=!1;let D=i.get(E);return s===null&&(s=new dV(h)),D=U?s.fromEquirectangular(E,D):s.fromCubemap(E,D),i.set(E,D),D.texture}else{if(i.has(E))return i.get(E).texture;{const D=E.image;if(U&&D&&D.height>0||B&&D&&r(D)){s===null&&(s=new dV(h));const R=U?s.fromEquirectangular(E):s.fromCubemap(E);return i.set(E,R),E.addEventListener("dispose",c),R.texture}else return null}}}return E}function r(E){let A=0;const U=6;for(let B=0;B<U;B++)E[B]!==void 0&&A++;return A===U}function c(E){const A=E.target;A.removeEventListener("dispose",c);const U=i.get(A);U!==void 0&&(i.delete(A),U.dispose())}function S(){i=new WeakMap,s!==null&&(s.dispose(),s=null)}return{get:a,dispose:S}}function Tde(h){const i={};function s(a){if(i[a]!==void 0)return i[a];let r;switch(a){case"WEBGL_depth_texture":r=h.getExtension("WEBGL_depth_texture")||h.getExtension("MOZ_WEBGL_depth_texture")||h.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=h.getExtension("EXT_texture_filter_anisotropic")||h.getExtension("MOZ_EXT_texture_filter_anisotropic")||h.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=h.getExtension("WEBGL_compressed_texture_s3tc")||h.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||h.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=h.getExtension("WEBGL_compressed_texture_pvrtc")||h.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=h.getExtension(a)}return i[a]=r,r}return{has:function(a){return s(a)!==null},init:function(a){a.isWebGL2?s("EXT_color_buffer_float"):(s("WEBGL_depth_texture"),s("OES_texture_float"),s("OES_texture_half_float"),s("OES_texture_half_float_linear"),s("OES_standard_derivatives"),s("OES_element_index_uint"),s("OES_vertex_array_object"),s("ANGLE_instanced_arrays")),s("OES_texture_float_linear"),s("EXT_color_buffer_half_float"),s("WEBGL_multisampled_render_to_texture")},get:function(a){const r=s(a);return r===null&&console.warn("THREE.WebGLRenderer: "+a+" extension not supported."),r}}}function Mde(h,i,s,a){const r={},c=new WeakMap;function S(D){const R=D.target;R.index!==null&&i.remove(R.index);for(const j in R.attributes)i.remove(R.attributes[j]);R.removeEventListener("dispose",S),delete r[R.id];const W=c.get(R);W&&(i.remove(W),c.delete(R)),a.releaseStatesOfGeometry(R),R.isInstancedBufferGeometry===!0&&delete R._maxInstanceCount,s.memory.geometries--}function E(D,R){return r[R.id]===!0||(R.addEventListener("dispose",S),r[R.id]=!0,s.memory.geometries++),R}function A(D){const R=D.attributes;for(const j in R)i.update(R[j],34962);const W=D.morphAttributes;for(const j in W){const H=W[j];for(let I=0,Q=H.length;I<Q;I++)i.update(H[I],34962)}}function U(D){const R=[],W=D.index,j=D.attributes.position;let H=0;if(W!==null){const Y=W.array;H=W.version;for(let q=0,ae=Y.length;q<ae;q+=3){const oe=Y[q+0],ye=Y[q+1],_e=Y[q+2];R.push(oe,ye,ye,_e,_e,oe)}}else{const Y=j.array;H=j.version;for(let q=0,ae=Y.length/3-1;q<ae;q+=3){const oe=q+0,ye=q+1,_e=q+2;R.push(oe,ye,ye,_e,_e,oe)}}const I=new(xq(R)?Oq:Aq)(R,1);I.version=H;const Q=c.get(D);Q&&i.remove(Q),c.set(D,I)}function B(D){const R=c.get(D);if(R){const W=D.index;W!==null&&R.version<W.version&&U(D)}else U(D);return c.get(D)}return{get:E,update:A,getWireframeAttribute:B}}function Dde(h,i,s,a){const r=a.isWebGL2;let c;function S(R){c=R}let E,A;function U(R){E=R.type,A=R.bytesPerElement}function B(R,W){h.drawElements(c,W,E,R*A),s.update(W,c,1)}function D(R,W,j){if(j===0)return;let H,I;if(r)H=h,I="drawElementsInstanced";else if(H=i.get("ANGLE_instanced_arrays"),I="drawElementsInstancedANGLE",H===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}H[I](c,W,E,R*A,j),s.update(W,c,j)}this.setMode=S,this.setIndex=U,this.render=B,this.renderInstances=D}function Nde(h){const i={geometries:0,textures:0},s={frame:0,calls:0,triangles:0,points:0,lines:0};function a(c,S,E){switch(s.calls++,S){case 4:s.triangles+=E*(c/3);break;case 1:s.lines+=E*(c/2);break;case 3:s.lines+=E*(c-1);break;case 2:s.lines+=E*c;break;case 0:s.points+=E*c;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",S);break}}function r(){s.frame++,s.calls=0,s.triangles=0,s.points=0,s.lines=0}return{memory:i,render:s,programs:null,autoReset:!0,reset:r,update:a}}function Ide(h,i){return h[0]-i[0]}function Fde(h,i){return Math.abs(i[1])-Math.abs(h[1])}function Rde(h,i,s){const a={},r=new Float32Array(8),c=new WeakMap,S=new wu,E=[];for(let U=0;U<8;U++)E[U]=[U,0];function A(U,B,D,R){const W=U.morphTargetInfluences;if(i.isWebGL2===!0){const H=B.morphAttributes.position||B.morphAttributes.normal||B.morphAttributes.color,I=H!==void 0?H.length:0;let Q=c.get(B);if(Q===void 0||Q.count!==I){let Bt=function(){we.dispose(),c.delete(B),B.removeEventListener("dispose",Bt)};var j=Bt;Q!==void 0&&Q.texture.dispose();const ae=B.morphAttributes.position!==void 0,oe=B.morphAttributes.normal!==void 0,ye=B.morphAttributes.color!==void 0,_e=B.morphAttributes.position||[],pe=B.morphAttributes.normal||[],me=B.morphAttributes.color||[];let Ge=0;ae===!0&&(Ge=1),oe===!0&&(Ge=2),ye===!0&&(Ge=3);let lt=B.attributes.position.count*Ge,It=1;lt>i.maxTextureSize&&(It=Math.ceil(lt/i.maxTextureSize),lt=i.maxTextureSize);const wt=new Float32Array(lt*It*4*I),we=new Sq(wt,lt,It,I);we.type=sw,we.needsUpdate=!0;const yt=Ge*4;for(let Ot=0;Ot<I;Ot++){const ze=_e[Ot],Ut=pe[Ot],Ft=me[Ot],pt=lt*It*4*Ot;for(let vt=0;vt<ze.count;vt++){const rn=vt*yt;ae===!0&&(S.fromBufferAttribute(ze,vt),wt[pt+rn+0]=S.x,wt[pt+rn+1]=S.y,wt[pt+rn+2]=S.z,wt[pt+rn+3]=0),oe===!0&&(S.fromBufferAttribute(Ut,vt),wt[pt+rn+4]=S.x,wt[pt+rn+5]=S.y,wt[pt+rn+6]=S.z,wt[pt+rn+7]=0),ye===!0&&(S.fromBufferAttribute(Ft,vt),wt[pt+rn+8]=S.x,wt[pt+rn+9]=S.y,wt[pt+rn+10]=S.z,wt[pt+rn+11]=Ft.itemSize===4?S.w:1)}}Q={count:I,texture:we,size:new Eo(lt,It)},c.set(B,Q),B.addEventListener("dispose",Bt)}let Y=0;for(let ae=0;ae<W.length;ae++)Y+=W[ae];const q=B.morphTargetsRelative?1:1-Y;R.getUniforms().setValue(h,"morphTargetBaseInfluence",q),R.getUniforms().setValue(h,"morphTargetInfluences",W),R.getUniforms().setValue(h,"morphTargetsTexture",Q.texture,s),R.getUniforms().setValue(h,"morphTargetsTextureSize",Q.size)}else{const H=W===void 0?0:W.length;let I=a[B.id];if(I===void 0||I.length!==H){I=[];for(let oe=0;oe<H;oe++)I[oe]=[oe,0];a[B.id]=I}for(let oe=0;oe<H;oe++){const ye=I[oe];ye[0]=oe,ye[1]=W[oe]}I.sort(Fde);for(let oe=0;oe<8;oe++)oe<H&&I[oe][1]?(E[oe][0]=I[oe][0],E[oe][1]=I[oe][1]):(E[oe][0]=Number.MAX_SAFE_INTEGER,E[oe][1]=0);E.sort(Ide);const Q=B.morphAttributes.position,Y=B.morphAttributes.normal;let q=0;for(let oe=0;oe<8;oe++){const ye=E[oe],_e=ye[0],pe=ye[1];_e!==Number.MAX_SAFE_INTEGER&&pe?(Q&&B.getAttribute("morphTarget"+oe)!==Q[_e]&&B.setAttribute("morphTarget"+oe,Q[_e]),Y&&B.getAttribute("morphNormal"+oe)!==Y[_e]&&B.setAttribute("morphNormal"+oe,Y[_e]),r[oe]=pe,q+=pe):(Q&&B.hasAttribute("morphTarget"+oe)===!0&&B.deleteAttribute("morphTarget"+oe),Y&&B.hasAttribute("morphNormal"+oe)===!0&&B.deleteAttribute("morphNormal"+oe),r[oe]=0)}const ae=B.morphTargetsRelative?1:1-q;R.getUniforms().setValue(h,"morphTargetBaseInfluence",ae),R.getUniforms().setValue(h,"morphTargetInfluences",r)}}return{update:A}}function Pde(h,i,s,a){let r=new WeakMap;function c(A){const U=a.render.frame,B=A.geometry,D=i.get(A,B);return r.get(D)!==U&&(i.update(D),r.set(D,U)),A.isInstancedMesh&&(A.hasEventListener("dispose",E)===!1&&A.addEventListener("dispose",E),s.update(A.instanceMatrix,34962),A.instanceColor!==null&&s.update(A.instanceColor,34962)),D}function S(){r=new WeakMap}function E(A){const U=A.target;U.removeEventListener("dispose",E),s.remove(U.instanceMatrix),U.instanceColor!==null&&s.remove(U.instanceColor)}return{update:c,dispose:S}}const Iq=new jp,Fq=new Sq,Rq=new _ce,Pq=new Dq,gV=[],vV=[],yV=new Float32Array(16),bV=new Float32Array(9),xV=new Float32Array(4);function b_(h,i,s){const a=h[0];if(a<=0||a>0)return h;const r=i*s;let c=gV[r];if(c===void 0&&(c=new Float32Array(r),gV[r]=c),i!==0){a.toArray(c,0);for(let S=1,E=0;S!==i;++S)E+=s,h[S].toArray(c,E)}return c}function Qc(h,i){if(h.length!==i.length)return!1;for(let s=0,a=h.length;s<a;s++)if(h[s]!==i[s])return!1;return!0}function Zc(h,i){for(let s=0,a=i.length;s<a;s++)h[s]=i[s]}function TT(h,i){let s=vV[i];s===void 0&&(s=new Int32Array(i),vV[i]=s);for(let a=0;a!==i;++a)s[a]=h.allocateTextureUnit();return s}function Lde(h,i){const s=this.cache;s[0]!==i&&(h.uniform1f(this.addr,i),s[0]=i)}function Bde(h,i){const s=this.cache;if(i.x!==void 0)(s[0]!==i.x||s[1]!==i.y)&&(h.uniform2f(this.addr,i.x,i.y),s[0]=i.x,s[1]=i.y);else{if(Qc(s,i))return;h.uniform2fv(this.addr,i),Zc(s,i)}}function jde(h,i){const s=this.cache;if(i.x!==void 0)(s[0]!==i.x||s[1]!==i.y||s[2]!==i.z)&&(h.uniform3f(this.addr,i.x,i.y,i.z),s[0]=i.x,s[1]=i.y,s[2]=i.z);else if(i.r!==void 0)(s[0]!==i.r||s[1]!==i.g||s[2]!==i.b)&&(h.uniform3f(this.addr,i.r,i.g,i.b),s[0]=i.r,s[1]=i.g,s[2]=i.b);else{if(Qc(s,i))return;h.uniform3fv(this.addr,i),Zc(s,i)}}function zde(h,i){const s=this.cache;if(i.x!==void 0)(s[0]!==i.x||s[1]!==i.y||s[2]!==i.z||s[3]!==i.w)&&(h.uniform4f(this.addr,i.x,i.y,i.z,i.w),s[0]=i.x,s[1]=i.y,s[2]=i.z,s[3]=i.w);else{if(Qc(s,i))return;h.uniform4fv(this.addr,i),Zc(s,i)}}function Ude(h,i){const s=this.cache,a=i.elements;if(a===void 0){if(Qc(s,i))return;h.uniformMatrix2fv(this.addr,!1,i),Zc(s,i)}else{if(Qc(s,a))return;xV.set(a),h.uniformMatrix2fv(this.addr,!1,xV),Zc(s,a)}}function Wde(h,i){const s=this.cache,a=i.elements;if(a===void 0){if(Qc(s,i))return;h.uniformMatrix3fv(this.addr,!1,i),Zc(s,i)}else{if(Qc(s,a))return;bV.set(a),h.uniformMatrix3fv(this.addr,!1,bV),Zc(s,a)}}function Vde(h,i){const s=this.cache,a=i.elements;if(a===void 0){if(Qc(s,i))return;h.uniformMatrix4fv(this.addr,!1,i),Zc(s,i)}else{if(Qc(s,a))return;yV.set(a),h.uniformMatrix4fv(this.addr,!1,yV),Zc(s,a)}}function Hde(h,i){const s=this.cache;s[0]!==i&&(h.uniform1i(this.addr,i),s[0]=i)}function Gde(h,i){const s=this.cache;if(i.x!==void 0)(s[0]!==i.x||s[1]!==i.y)&&(h.uniform2i(this.addr,i.x,i.y),s[0]=i.x,s[1]=i.y);else{if(Qc(s,i))return;h.uniform2iv(this.addr,i),Zc(s,i)}}function qde(h,i){const s=this.cache;if(i.x!==void 0)(s[0]!==i.x||s[1]!==i.y||s[2]!==i.z)&&(h.uniform3i(this.addr,i.x,i.y,i.z),s[0]=i.x,s[1]=i.y,s[2]=i.z);else{if(Qc(s,i))return;h.uniform3iv(this.addr,i),Zc(s,i)}}function $de(h,i){const s=this.cache;if(i.x!==void 0)(s[0]!==i.x||s[1]!==i.y||s[2]!==i.z||s[3]!==i.w)&&(h.uniform4i(this.addr,i.x,i.y,i.z,i.w),s[0]=i.x,s[1]=i.y,s[2]=i.z,s[3]=i.w);else{if(Qc(s,i))return;h.uniform4iv(this.addr,i),Zc(s,i)}}function Xde(h,i){const s=this.cache;s[0]!==i&&(h.uniform1ui(this.addr,i),s[0]=i)}function Kde(h,i){const s=this.cache;if(i.x!==void 0)(s[0]!==i.x||s[1]!==i.y)&&(h.uniform2ui(this.addr,i.x,i.y),s[0]=i.x,s[1]=i.y);else{if(Qc(s,i))return;h.uniform2uiv(this.addr,i),Zc(s,i)}}function Yde(h,i){const s=this.cache;if(i.x!==void 0)(s[0]!==i.x||s[1]!==i.y||s[2]!==i.z)&&(h.uniform3ui(this.addr,i.x,i.y,i.z),s[0]=i.x,s[1]=i.y,s[2]=i.z);else{if(Qc(s,i))return;h.uniform3uiv(this.addr,i),Zc(s,i)}}function Jde(h,i){const s=this.cache;if(i.x!==void 0)(s[0]!==i.x||s[1]!==i.y||s[2]!==i.z||s[3]!==i.w)&&(h.uniform4ui(this.addr,i.x,i.y,i.z,i.w),s[0]=i.x,s[1]=i.y,s[2]=i.z,s[3]=i.w);else{if(Qc(s,i))return;h.uniform4uiv(this.addr,i),Zc(s,i)}}function Qde(h,i,s){const a=this.cache,r=s.allocateTextureUnit();a[0]!==r&&(h.uniform1i(this.addr,r),a[0]=r),s.setTexture2D(i||Iq,r)}function Zde(h,i,s){const a=this.cache,r=s.allocateTextureUnit();a[0]!==r&&(h.uniform1i(this.addr,r),a[0]=r),s.setTexture3D(i||Rq,r)}function ehe(h,i,s){const a=this.cache,r=s.allocateTextureUnit();a[0]!==r&&(h.uniform1i(this.addr,r),a[0]=r),s.setTextureCube(i||Pq,r)}function the(h,i,s){const a=this.cache,r=s.allocateTextureUnit();a[0]!==r&&(h.uniform1i(this.addr,r),a[0]=r),s.setTexture2DArray(i||Fq,r)}function nhe(h){switch(h){case 5126:return Lde;case 35664:return Bde;case 35665:return jde;case 35666:return zde;case 35674:return Ude;case 35675:return Wde;case 35676:return Vde;case 5124:case 35670:return Hde;case 35667:case 35671:return Gde;case 35668:case 35672:return qde;case 35669:case 35673:return $de;case 5125:return Xde;case 36294:return Kde;case 36295:return Yde;case 36296:return Jde;case 35678:case 36198:case 36298:case 36306:case 35682:return Qde;case 35679:case 36299:case 36307:return Zde;case 35680:case 36300:case 36308:case 36293:return ehe;case 36289:case 36303:case 36311:case 36292:return the}}function rhe(h,i){h.uniform1fv(this.addr,i)}function ihe(h,i){const s=b_(i,this.size,2);h.uniform2fv(this.addr,s)}function ohe(h,i){const s=b_(i,this.size,3);h.uniform3fv(this.addr,s)}function ahe(h,i){const s=b_(i,this.size,4);h.uniform4fv(this.addr,s)}function she(h,i){const s=b_(i,this.size,4);h.uniformMatrix2fv(this.addr,!1,s)}function uhe(h,i){const s=b_(i,this.size,9);h.uniformMatrix3fv(this.addr,!1,s)}function che(h,i){const s=b_(i,this.size,16);h.uniformMatrix4fv(this.addr,!1,s)}function lhe(h,i){h.uniform1iv(this.addr,i)}function fhe(h,i){h.uniform2iv(this.addr,i)}function dhe(h,i){h.uniform3iv(this.addr,i)}function hhe(h,i){h.uniform4iv(this.addr,i)}function phe(h,i){h.uniform1uiv(this.addr,i)}function mhe(h,i){h.uniform2uiv(this.addr,i)}function ghe(h,i){h.uniform3uiv(this.addr,i)}function vhe(h,i){h.uniform4uiv(this.addr,i)}function yhe(h,i,s){const a=this.cache,r=i.length,c=TT(s,r);Qc(a,c)||(h.uniform1iv(this.addr,c),Zc(a,c));for(let S=0;S!==r;++S)s.setTexture2D(i[S]||Iq,c[S])}function bhe(h,i,s){const a=this.cache,r=i.length,c=TT(s,r);Qc(a,c)||(h.uniform1iv(this.addr,c),Zc(a,c));for(let S=0;S!==r;++S)s.setTexture3D(i[S]||Rq,c[S])}function xhe(h,i,s){const a=this.cache,r=i.length,c=TT(s,r);Qc(a,c)||(h.uniform1iv(this.addr,c),Zc(a,c));for(let S=0;S!==r;++S)s.setTextureCube(i[S]||Pq,c[S])}function whe(h,i,s){const a=this.cache,r=i.length,c=TT(s,r);Qc(a,c)||(h.uniform1iv(this.addr,c),Zc(a,c));for(let S=0;S!==r;++S)s.setTexture2DArray(i[S]||Fq,c[S])}function _he(h){switch(h){case 5126:return rhe;case 35664:return ihe;case 35665:return ohe;case 35666:return ahe;case 35674:return she;case 35675:return uhe;case 35676:return che;case 5124:case 35670:return lhe;case 35667:case 35671:return fhe;case 35668:case 35672:return dhe;case 35669:case 35673:return hhe;case 5125:return phe;case 36294:return mhe;case 36295:return ghe;case 36296:return vhe;case 35678:case 36198:case 36298:case 36306:case 35682:return yhe;case 35679:case 36299:case 36307:return bhe;case 35680:case 36300:case 36308:case 36293:return xhe;case 36289:case 36303:case 36311:case 36292:return whe}}class Ehe{constructor(i,s,a){this.id=i,this.addr=a,this.cache=[],this.setValue=nhe(s.type)}}class She{constructor(i,s,a){this.id=i,this.addr=a,this.cache=[],this.size=s.size,this.setValue=_he(s.type)}}class Che{constructor(i){this.id=i,this.seq=[],this.map={}}setValue(i,s,a){const r=this.seq;for(let c=0,S=r.length;c!==S;++c){const E=r[c];E.setValue(i,s[E.id],a)}}}const SF=/(\w+)(\])?(\[|\.)?/g;function wV(h,i){h.seq.push(i),h.map[i.id]=i}function khe(h,i,s){const a=h.name,r=a.length;for(SF.lastIndex=0;;){const c=SF.exec(a),S=SF.lastIndex;let E=c[1];const A=c[2]==="]",U=c[3];if(A&&(E=E|0),U===void 0||U==="["&&S+2===r){wV(s,U===void 0?new Ehe(E,h,i):new She(E,h,i));break}else{let D=s.map[E];D===void 0&&(D=new Che(E),wV(s,D)),s=D}}}class NO{constructor(i,s){this.seq=[],this.map={};const a=i.getProgramParameter(s,35718);for(let r=0;r<a;++r){const c=i.getActiveUniform(s,r),S=i.getUniformLocation(s,c.name);khe(c,S,this)}}setValue(i,s,a,r){const c=this.map[s];c!==void 0&&c.setValue(i,a,r)}setOptional(i,s,a){const r=s[a];r!==void 0&&this.setValue(i,a,r)}static upload(i,s,a,r){for(let c=0,S=s.length;c!==S;++c){const E=s[c],A=a[E.id];A.needsUpdate!==!1&&E.setValue(i,A.value,r)}}static seqWithValue(i,s){const a=[];for(let r=0,c=i.length;r!==c;++r){const S=i[r];S.id in s&&a.push(S)}return a}}function _V(h,i,s){const a=h.createShader(i);return h.shaderSource(a,s),h.compileShader(a),a}let Ahe=0;function Ohe(h,i){const s=h.split(`
`),a=[],r=Math.max(i-6,0),c=Math.min(i+6,s.length);for(let S=r;S<c;S++){const E=S+1;a.push(`${E===i?">":" "} ${E}: ${s[S]}`)}return a.join(`
`)}function The(h){switch(h){case bw:return["Linear","( value )"];case iu:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",h),["Linear","( value )"]}}function EV(h,i,s){const a=h.getShaderParameter(i,35713),r=h.getShaderInfoLog(i).trim();if(a&&r==="")return"";const c=/ERROR: 0:(\d+)/.exec(r);if(c){const S=parseInt(c[1]);return s.toUpperCase()+`

`+r+`

`+Ohe(h.getShaderSource(i),S)}else return r}function Mhe(h,i){const s=The(i);return"vec4 "+h+"( vec4 value ) { return LinearTo"+s[0]+s[1]+"; }"}function Dhe(h,i){let s;switch(i){case Xue:s="Linear";break;case Kue:s="Reinhard";break;case Yue:s="OptimizedCineon";break;case Jue:s="ACESFilmic";break;case Que:s="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",i),s="Linear"}return"vec3 "+h+"( vec3 color ) { return "+s+"ToneMapping( color ); }"}function Nhe(h){return[h.extensionDerivatives||h.envMapCubeUVHeight||h.bumpMap||h.tangentSpaceNormalMap||h.clearcoatNormalMap||h.flatShading||h.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(h.extensionFragDepth||h.logarithmicDepthBuffer)&&h.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",h.extensionDrawBuffers&&h.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(h.extensionShaderTextureLOD||h.envMap||h.transmission)&&h.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(DS).join(`
`)}function Ihe(h){const i=[];for(const s in h){const a=h[s];a!==!1&&i.push("#define "+s+" "+a)}return i.join(`
`)}function Fhe(h,i){const s={},a=h.getProgramParameter(i,35721);for(let r=0;r<a;r++){const c=h.getActiveAttrib(i,r),S=c.name;let E=1;c.type===35674&&(E=2),c.type===35675&&(E=3),c.type===35676&&(E=4),s[S]={type:c.type,location:h.getAttribLocation(i,S),locationSize:E}}return s}function DS(h){return h!==""}function SV(h,i){const s=i.numSpotLightShadows+i.numSpotLightMaps-i.numSpotLightShadowsWithMaps;return h.replace(/NUM_DIR_LIGHTS/g,i.numDirLights).replace(/NUM_SPOT_LIGHTS/g,i.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,i.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,s).replace(/NUM_RECT_AREA_LIGHTS/g,i.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,i.numPointLights).replace(/NUM_HEMI_LIGHTS/g,i.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,i.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,i.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,i.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,i.numPointLightShadows)}function CV(h,i){return h.replace(/NUM_CLIPPING_PLANES/g,i.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,i.numClippingPlanes-i.numClipIntersection)}const Rhe=/^[ \t]*#include +<([\w\d./]+)>/gm;function RR(h){return h.replace(Rhe,Phe)}function Phe(h,i){const s=ra[i];if(s===void 0)throw new Error("Can not resolve #include <"+i+">");return RR(s)}const Lhe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function kV(h){return h.replace(Lhe,Bhe)}function Bhe(h,i,s,a){let r="";for(let c=parseInt(i);c<parseInt(s);c++)r+=a.replace(/\[\s*i\s*\]/g,"[ "+c+" ]").replace(/UNROLLED_LOOP_INDEX/g,c);return r}function AV(h){let i="precision "+h.precision+` float;
precision `+h.precision+" int;";return h.precision==="highp"?i+=`
#define HIGH_PRECISION`:h.precision==="mediump"?i+=`
#define MEDIUM_PRECISION`:h.precision==="lowp"&&(i+=`
#define LOW_PRECISION`),i}function jhe(h){let i="SHADOWMAP_TYPE_BASIC";return h.shadowMapType===pq?i="SHADOWMAP_TYPE_PCF":h.shadowMapType===kue?i="SHADOWMAP_TYPE_PCF_SOFT":h.shadowMapType===MS&&(i="SHADOWMAP_TYPE_VSM"),i}function zhe(h){let i="ENVMAP_TYPE_CUBE";if(h.envMap)switch(h.envMapMode){case d_:case h_:i="ENVMAP_TYPE_CUBE";break;case CT:i="ENVMAP_TYPE_CUBE_UV";break}return i}function Uhe(h){let i="ENVMAP_MODE_REFLECTION";if(h.envMap)switch(h.envMapMode){case h_:i="ENVMAP_MODE_REFRACTION";break}return i}function Whe(h){let i="ENVMAP_BLENDING_NONE";if(h.envMap)switch(h.combine){case vq:i="ENVMAP_BLENDING_MULTIPLY";break;case que:i="ENVMAP_BLENDING_MIX";break;case $ue:i="ENVMAP_BLENDING_ADD";break}return i}function Vhe(h){const i=h.envMapCubeUVHeight;if(i===null)return null;const s=Math.log2(i)-2,a=1/i;return{texelWidth:1/(3*Math.max(Math.pow(2,s),7*16)),texelHeight:a,maxMip:s}}function Hhe(h,i,s,a){const r=h.getContext(),c=s.defines;let S=s.vertexShader,E=s.fragmentShader;const A=jhe(s),U=zhe(s),B=Uhe(s),D=Whe(s),R=Vhe(s),W=s.isWebGL2?"":Nhe(s),j=Ihe(c),H=r.createProgram();let I,Q,Y=s.glslVersion?"#version "+s.glslVersion+`
`:"";s.isRawShaderMaterial?(I=[j].filter(DS).join(`
`),I.length>0&&(I+=`
`),Q=[W,j].filter(DS).join(`
`),Q.length>0&&(Q+=`
`)):(I=[AV(s),"#define SHADER_NAME "+s.shaderName,j,s.instancing?"#define USE_INSTANCING":"",s.instancingColor?"#define USE_INSTANCING_COLOR":"",s.supportsVertexTextures?"#define VERTEX_TEXTURES":"",s.useFog&&s.fog?"#define USE_FOG":"",s.useFog&&s.fogExp2?"#define FOG_EXP2":"",s.map?"#define USE_MAP":"",s.envMap?"#define USE_ENVMAP":"",s.envMap?"#define "+B:"",s.lightMap?"#define USE_LIGHTMAP":"",s.aoMap?"#define USE_AOMAP":"",s.emissiveMap?"#define USE_EMISSIVEMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.normalMap&&s.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",s.normalMap&&s.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",s.clearcoatMap?"#define USE_CLEARCOATMAP":"",s.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",s.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",s.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",s.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",s.displacementMap&&s.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",s.specularColorMap?"#define USE_SPECULARCOLORMAP":"",s.roughnessMap?"#define USE_ROUGHNESSMAP":"",s.metalnessMap?"#define USE_METALNESSMAP":"",s.alphaMap?"#define USE_ALPHAMAP":"",s.transmission?"#define USE_TRANSMISSION":"",s.transmissionMap?"#define USE_TRANSMISSIONMAP":"",s.thicknessMap?"#define USE_THICKNESSMAP":"",s.sheenColorMap?"#define USE_SHEENCOLORMAP":"",s.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",s.vertexTangents?"#define USE_TANGENT":"",s.vertexColors?"#define USE_COLOR":"",s.vertexAlphas?"#define USE_COLOR_ALPHA":"",s.vertexUvs?"#define USE_UV":"",s.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",s.flatShading?"#define FLAT_SHADED":"",s.skinning?"#define USE_SKINNING":"",s.morphTargets?"#define USE_MORPHTARGETS":"",s.morphNormals&&s.flatShading===!1?"#define USE_MORPHNORMALS":"",s.morphColors&&s.isWebGL2?"#define USE_MORPHCOLORS":"",s.morphTargetsCount>0&&s.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",s.morphTargetsCount>0&&s.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+s.morphTextureStride:"",s.morphTargetsCount>0&&s.isWebGL2?"#define MORPHTARGETS_COUNT "+s.morphTargetsCount:"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+A:"",s.sizeAttenuation?"#define USE_SIZEATTENUATION":"",s.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",s.logarithmicDepthBuffer&&s.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(DS).join(`
`),Q=[W,AV(s),"#define SHADER_NAME "+s.shaderName,j,s.useFog&&s.fog?"#define USE_FOG":"",s.useFog&&s.fogExp2?"#define FOG_EXP2":"",s.map?"#define USE_MAP":"",s.matcap?"#define USE_MATCAP":"",s.envMap?"#define USE_ENVMAP":"",s.envMap?"#define "+U:"",s.envMap?"#define "+B:"",s.envMap?"#define "+D:"",R?"#define CUBEUV_TEXEL_WIDTH "+R.texelWidth:"",R?"#define CUBEUV_TEXEL_HEIGHT "+R.texelHeight:"",R?"#define CUBEUV_MAX_MIP "+R.maxMip+".0":"",s.lightMap?"#define USE_LIGHTMAP":"",s.aoMap?"#define USE_AOMAP":"",s.emissiveMap?"#define USE_EMISSIVEMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.normalMap&&s.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",s.normalMap&&s.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",s.clearcoat?"#define USE_CLEARCOAT":"",s.clearcoatMap?"#define USE_CLEARCOATMAP":"",s.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",s.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",s.iridescence?"#define USE_IRIDESCENCE":"",s.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",s.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",s.specularColorMap?"#define USE_SPECULARCOLORMAP":"",s.roughnessMap?"#define USE_ROUGHNESSMAP":"",s.metalnessMap?"#define USE_METALNESSMAP":"",s.alphaMap?"#define USE_ALPHAMAP":"",s.alphaTest?"#define USE_ALPHATEST":"",s.sheen?"#define USE_SHEEN":"",s.sheenColorMap?"#define USE_SHEENCOLORMAP":"",s.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",s.transmission?"#define USE_TRANSMISSION":"",s.transmissionMap?"#define USE_TRANSMISSIONMAP":"",s.thicknessMap?"#define USE_THICKNESSMAP":"",s.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",s.vertexTangents?"#define USE_TANGENT":"",s.vertexColors||s.instancingColor?"#define USE_COLOR":"",s.vertexAlphas?"#define USE_COLOR_ALPHA":"",s.vertexUvs?"#define USE_UV":"",s.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",s.gradientMap?"#define USE_GRADIENTMAP":"",s.flatShading?"#define FLAT_SHADED":"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+A:"",s.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",s.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",s.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",s.logarithmicDepthBuffer&&s.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",s.toneMapping!==I1?"#define TONE_MAPPING":"",s.toneMapping!==I1?ra.tonemapping_pars_fragment:"",s.toneMapping!==I1?Dhe("toneMapping",s.toneMapping):"",s.dithering?"#define DITHERING":"",s.opaque?"#define OPAQUE":"",ra.encodings_pars_fragment,Mhe("linearToOutputTexel",s.outputEncoding),s.useDepthPacking?"#define DEPTH_PACKING "+s.depthPacking:"",`
`].filter(DS).join(`
`)),S=RR(S),S=SV(S,s),S=CV(S,s),E=RR(E),E=SV(E,s),E=CV(E,s),S=kV(S),E=kV(E),s.isWebGL2&&s.isRawShaderMaterial!==!0&&(Y=`#version 300 es
`,I=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+I,Q=["#define varying in",s.glslVersion===YW?"":"layout(location = 0) out highp vec4 pc_fragColor;",s.glslVersion===YW?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+Q);const q=Y+I+S,ae=Y+Q+E,oe=_V(r,35633,q),ye=_V(r,35632,ae);if(r.attachShader(H,oe),r.attachShader(H,ye),s.index0AttributeName!==void 0?r.bindAttribLocation(H,0,s.index0AttributeName):s.morphTargets===!0&&r.bindAttribLocation(H,0,"position"),r.linkProgram(H),h.debug.checkShaderErrors){const me=r.getProgramInfoLog(H).trim(),Ge=r.getShaderInfoLog(oe).trim(),lt=r.getShaderInfoLog(ye).trim();let It=!0,wt=!0;if(r.getProgramParameter(H,35714)===!1){It=!1;const we=EV(r,oe,"vertex"),yt=EV(r,ye,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(H,35715)+`

Program Info Log: `+me+`
`+we+`
`+yt)}else me!==""?console.warn("THREE.WebGLProgram: Program Info Log:",me):(Ge===""||lt==="")&&(wt=!1);wt&&(this.diagnostics={runnable:It,programLog:me,vertexShader:{log:Ge,prefix:I},fragmentShader:{log:lt,prefix:Q}})}r.deleteShader(oe),r.deleteShader(ye);let _e;this.getUniforms=function(){return _e===void 0&&(_e=new NO(r,H)),_e};let pe;return this.getAttributes=function(){return pe===void 0&&(pe=Fhe(r,H)),pe},this.destroy=function(){a.releaseStatesOfProgram(this),r.deleteProgram(H),this.program=void 0},this.name=s.shaderName,this.id=Ahe++,this.cacheKey=i,this.usedTimes=1,this.program=H,this.vertexShader=oe,this.fragmentShader=ye,this}let Ghe=0;class qhe{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(i){const s=i.vertexShader,a=i.fragmentShader,r=this._getShaderStage(s),c=this._getShaderStage(a),S=this._getShaderCacheForMaterial(i);return S.has(r)===!1&&(S.add(r),r.usedTimes++),S.has(c)===!1&&(S.add(c),c.usedTimes++),this}remove(i){const s=this.materialCache.get(i);for(const a of s)a.usedTimes--,a.usedTimes===0&&this.shaderCache.delete(a.code);return this.materialCache.delete(i),this}getVertexShaderID(i){return this._getShaderStage(i.vertexShader).id}getFragmentShaderID(i){return this._getShaderStage(i.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(i){const s=this.materialCache;let a=s.get(i);return a===void 0&&(a=new Set,s.set(i,a)),a}_getShaderStage(i){const s=this.shaderCache;let a=s.get(i);return a===void 0&&(a=new $he(i),s.set(i,a)),a}}class $he{constructor(i){this.id=Ghe++,this.code=i,this.usedTimes=0}}function Xhe(h,i,s,a,r,c,S){const E=new kq,A=new qhe,U=[],B=r.isWebGL2,D=r.logarithmicDepthBuffer,R=r.vertexTextures;let W=r.precision;const j={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function H(pe,me,Ge,lt,It){const wt=lt.fog,we=It.geometry,yt=pe.isMeshStandardMaterial?lt.environment:null,Bt=(pe.isMeshStandardMaterial?s:i).get(pe.envMap||yt),Ot=Bt&&Bt.mapping===CT?Bt.image.height:null,ze=j[pe.type];pe.precision!==null&&(W=r.getMaxPrecision(pe.precision),W!==pe.precision&&console.warn("THREE.WebGLProgram.getParameters:",pe.precision,"not supported, using",W,"instead."));const Ut=we.morphAttributes.position||we.morphAttributes.normal||we.morphAttributes.color,Ft=Ut!==void 0?Ut.length:0;let pt=0;we.morphAttributes.position!==void 0&&(pt=1),we.morphAttributes.normal!==void 0&&(pt=2),we.morphAttributes.color!==void 0&&(pt=3);let vt,rn,xt,_t;if(ze){const Ye=Cy[ze];vt=Ye.vertexShader,rn=Ye.fragmentShader}else vt=pe.vertexShader,rn=pe.fragmentShader,A.update(pe),xt=A.getVertexShaderID(pe),_t=A.getFragmentShaderID(pe);const Xt=h.getRenderTarget(),sn=pe.alphaTest>0,kn=pe.clearcoat>0,an=pe.iridescence>0;return{isWebGL2:B,shaderID:ze,shaderName:pe.type,vertexShader:vt,fragmentShader:rn,defines:pe.defines,customVertexShaderID:xt,customFragmentShaderID:_t,isRawShaderMaterial:pe.isRawShaderMaterial===!0,glslVersion:pe.glslVersion,precision:W,instancing:It.isInstancedMesh===!0,instancingColor:It.isInstancedMesh===!0&&It.instanceColor!==null,supportsVertexTextures:R,outputEncoding:Xt===null?h.outputEncoding:Xt.isXRRenderTarget===!0?Xt.texture.encoding:bw,map:!!pe.map,matcap:!!pe.matcap,envMap:!!Bt,envMapMode:Bt&&Bt.mapping,envMapCubeUVHeight:Ot,lightMap:!!pe.lightMap,aoMap:!!pe.aoMap,emissiveMap:!!pe.emissiveMap,bumpMap:!!pe.bumpMap,normalMap:!!pe.normalMap,objectSpaceNormalMap:pe.normalMapType===yce,tangentSpaceNormalMap:pe.normalMapType===vce,decodeVideoTexture:!!pe.map&&pe.map.isVideoTexture===!0&&pe.map.encoding===iu,clearcoat:kn,clearcoatMap:kn&&!!pe.clearcoatMap,clearcoatRoughnessMap:kn&&!!pe.clearcoatRoughnessMap,clearcoatNormalMap:kn&&!!pe.clearcoatNormalMap,iridescence:an,iridescenceMap:an&&!!pe.iridescenceMap,iridescenceThicknessMap:an&&!!pe.iridescenceThicknessMap,displacementMap:!!pe.displacementMap,roughnessMap:!!pe.roughnessMap,metalnessMap:!!pe.metalnessMap,specularMap:!!pe.specularMap,specularIntensityMap:!!pe.specularIntensityMap,specularColorMap:!!pe.specularColorMap,opaque:pe.transparent===!1&&pe.blending===r_,alphaMap:!!pe.alphaMap,alphaTest:sn,gradientMap:!!pe.gradientMap,sheen:pe.sheen>0,sheenColorMap:!!pe.sheenColorMap,sheenRoughnessMap:!!pe.sheenRoughnessMap,transmission:pe.transmission>0,transmissionMap:!!pe.transmissionMap,thicknessMap:!!pe.thicknessMap,combine:pe.combine,vertexTangents:!!pe.normalMap&&!!we.attributes.tangent,vertexColors:pe.vertexColors,vertexAlphas:pe.vertexColors===!0&&!!we.attributes.color&&we.attributes.color.itemSize===4,vertexUvs:!!pe.map||!!pe.bumpMap||!!pe.normalMap||!!pe.specularMap||!!pe.alphaMap||!!pe.emissiveMap||!!pe.roughnessMap||!!pe.metalnessMap||!!pe.clearcoatMap||!!pe.clearcoatRoughnessMap||!!pe.clearcoatNormalMap||!!pe.iridescenceMap||!!pe.iridescenceThicknessMap||!!pe.displacementMap||!!pe.transmissionMap||!!pe.thicknessMap||!!pe.specularIntensityMap||!!pe.specularColorMap||!!pe.sheenColorMap||!!pe.sheenRoughnessMap,uvsVertexOnly:!(pe.map||pe.bumpMap||pe.normalMap||pe.specularMap||pe.alphaMap||pe.emissiveMap||pe.roughnessMap||pe.metalnessMap||pe.clearcoatNormalMap||pe.iridescenceMap||pe.iridescenceThicknessMap||pe.transmission>0||pe.transmissionMap||pe.thicknessMap||pe.specularIntensityMap||pe.specularColorMap||pe.sheen>0||pe.sheenColorMap||pe.sheenRoughnessMap)&&!!pe.displacementMap,fog:!!wt,useFog:pe.fog===!0,fogExp2:wt&&wt.isFogExp2,flatShading:!!pe.flatShading,sizeAttenuation:pe.sizeAttenuation,logarithmicDepthBuffer:D,skinning:It.isSkinnedMesh===!0,morphTargets:we.morphAttributes.position!==void 0,morphNormals:we.morphAttributes.normal!==void 0,morphColors:we.morphAttributes.color!==void 0,morphTargetsCount:Ft,morphTextureStride:pt,numDirLights:me.directional.length,numPointLights:me.point.length,numSpotLights:me.spot.length,numSpotLightMaps:me.spotLightMap.length,numRectAreaLights:me.rectArea.length,numHemiLights:me.hemi.length,numDirLightShadows:me.directionalShadowMap.length,numPointLightShadows:me.pointShadowMap.length,numSpotLightShadows:me.spotShadowMap.length,numSpotLightShadowsWithMaps:me.numSpotLightShadowsWithMaps,numClippingPlanes:S.numPlanes,numClipIntersection:S.numIntersection,dithering:pe.dithering,shadowMapEnabled:h.shadowMap.enabled&&Ge.length>0,shadowMapType:h.shadowMap.type,toneMapping:pe.toneMapped?h.toneMapping:I1,physicallyCorrectLights:h.physicallyCorrectLights,premultipliedAlpha:pe.premultipliedAlpha,doubleSided:pe.side===B5,flipSided:pe.side===$g,useDepthPacking:!!pe.depthPacking,depthPacking:pe.depthPacking||0,index0AttributeName:pe.index0AttributeName,extensionDerivatives:pe.extensions&&pe.extensions.derivatives,extensionFragDepth:pe.extensions&&pe.extensions.fragDepth,extensionDrawBuffers:pe.extensions&&pe.extensions.drawBuffers,extensionShaderTextureLOD:pe.extensions&&pe.extensions.shaderTextureLOD,rendererExtensionFragDepth:B||a.has("EXT_frag_depth"),rendererExtensionDrawBuffers:B||a.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:B||a.has("EXT_shader_texture_lod"),customProgramCacheKey:pe.customProgramCacheKey()}}function I(pe){const me=[];if(pe.shaderID?me.push(pe.shaderID):(me.push(pe.customVertexShaderID),me.push(pe.customFragmentShaderID)),pe.defines!==void 0)for(const Ge in pe.defines)me.push(Ge),me.push(pe.defines[Ge]);return pe.isRawShaderMaterial===!1&&(Q(me,pe),Y(me,pe),me.push(h.outputEncoding)),me.push(pe.customProgramCacheKey),me.join()}function Q(pe,me){pe.push(me.precision),pe.push(me.outputEncoding),pe.push(me.envMapMode),pe.push(me.envMapCubeUVHeight),pe.push(me.combine),pe.push(me.vertexUvs),pe.push(me.fogExp2),pe.push(me.sizeAttenuation),pe.push(me.morphTargetsCount),pe.push(me.morphAttributeCount),pe.push(me.numDirLights),pe.push(me.numPointLights),pe.push(me.numSpotLights),pe.push(me.numSpotLightMaps),pe.push(me.numHemiLights),pe.push(me.numRectAreaLights),pe.push(me.numDirLightShadows),pe.push(me.numPointLightShadows),pe.push(me.numSpotLightShadows),pe.push(me.numSpotLightShadowsWithMaps),pe.push(me.shadowMapType),pe.push(me.toneMapping),pe.push(me.numClippingPlanes),pe.push(me.numClipIntersection),pe.push(me.depthPacking)}function Y(pe,me){E.disableAll(),me.isWebGL2&&E.enable(0),me.supportsVertexTextures&&E.enable(1),me.instancing&&E.enable(2),me.instancingColor&&E.enable(3),me.map&&E.enable(4),me.matcap&&E.enable(5),me.envMap&&E.enable(6),me.lightMap&&E.enable(7),me.aoMap&&E.enable(8),me.emissiveMap&&E.enable(9),me.bumpMap&&E.enable(10),me.normalMap&&E.enable(11),me.objectSpaceNormalMap&&E.enable(12),me.tangentSpaceNormalMap&&E.enable(13),me.clearcoat&&E.enable(14),me.clearcoatMap&&E.enable(15),me.clearcoatRoughnessMap&&E.enable(16),me.clearcoatNormalMap&&E.enable(17),me.iridescence&&E.enable(18),me.iridescenceMap&&E.enable(19),me.iridescenceThicknessMap&&E.enable(20),me.displacementMap&&E.enable(21),me.specularMap&&E.enable(22),me.roughnessMap&&E.enable(23),me.metalnessMap&&E.enable(24),me.gradientMap&&E.enable(25),me.alphaMap&&E.enable(26),me.alphaTest&&E.enable(27),me.vertexColors&&E.enable(28),me.vertexAlphas&&E.enable(29),me.vertexUvs&&E.enable(30),me.vertexTangents&&E.enable(31),me.uvsVertexOnly&&E.enable(32),pe.push(E.mask),E.disableAll(),me.fog&&E.enable(0),me.useFog&&E.enable(1),me.flatShading&&E.enable(2),me.logarithmicDepthBuffer&&E.enable(3),me.skinning&&E.enable(4),me.morphTargets&&E.enable(5),me.morphNormals&&E.enable(6),me.morphColors&&E.enable(7),me.premultipliedAlpha&&E.enable(8),me.shadowMapEnabled&&E.enable(9),me.physicallyCorrectLights&&E.enable(10),me.doubleSided&&E.enable(11),me.flipSided&&E.enable(12),me.useDepthPacking&&E.enable(13),me.dithering&&E.enable(14),me.specularIntensityMap&&E.enable(15),me.specularColorMap&&E.enable(16),me.transmission&&E.enable(17),me.transmissionMap&&E.enable(18),me.thicknessMap&&E.enable(19),me.sheen&&E.enable(20),me.sheenColorMap&&E.enable(21),me.sheenRoughnessMap&&E.enable(22),me.decodeVideoTexture&&E.enable(23),me.opaque&&E.enable(24),pe.push(E.mask)}function q(pe){const me=j[pe.type];let Ge;if(me){const lt=Cy[me];Ge=Fce.clone(lt.uniforms)}else Ge=pe.uniforms;return Ge}function ae(pe,me){let Ge;for(let lt=0,It=U.length;lt<It;lt++){const wt=U[lt];if(wt.cacheKey===me){Ge=wt,++Ge.usedTimes;break}}return Ge===void 0&&(Ge=new Hhe(h,me,pe,c),U.push(Ge)),Ge}function oe(pe){if(--pe.usedTimes===0){const me=U.indexOf(pe);U[me]=U[U.length-1],U.pop(),pe.destroy()}}function ye(pe){A.remove(pe)}function _e(){A.dispose()}return{getParameters:H,getProgramCacheKey:I,getUniforms:q,acquireProgram:ae,releaseProgram:oe,releaseShaderCache:ye,programs:U,dispose:_e}}function Khe(){let h=new WeakMap;function i(c){let S=h.get(c);return S===void 0&&(S={},h.set(c,S)),S}function s(c){h.delete(c)}function a(c,S,E){h.get(c)[S]=E}function r(){h=new WeakMap}return{get:i,remove:s,update:a,dispose:r}}function Yhe(h,i){return h.groupOrder!==i.groupOrder?h.groupOrder-i.groupOrder:h.renderOrder!==i.renderOrder?h.renderOrder-i.renderOrder:h.material.id!==i.material.id?h.material.id-i.material.id:h.z!==i.z?h.z-i.z:h.id-i.id}function OV(h,i){return h.groupOrder!==i.groupOrder?h.groupOrder-i.groupOrder:h.renderOrder!==i.renderOrder?h.renderOrder-i.renderOrder:h.z!==i.z?i.z-h.z:h.id-i.id}function TV(){const h=[];let i=0;const s=[],a=[],r=[];function c(){i=0,s.length=0,a.length=0,r.length=0}function S(D,R,W,j,H,I){let Q=h[i];return Q===void 0?(Q={id:D.id,object:D,geometry:R,material:W,groupOrder:j,renderOrder:D.renderOrder,z:H,group:I},h[i]=Q):(Q.id=D.id,Q.object=D,Q.geometry=R,Q.material=W,Q.groupOrder=j,Q.renderOrder=D.renderOrder,Q.z=H,Q.group=I),i++,Q}function E(D,R,W,j,H,I){const Q=S(D,R,W,j,H,I);W.transmission>0?a.push(Q):W.transparent===!0?r.push(Q):s.push(Q)}function A(D,R,W,j,H,I){const Q=S(D,R,W,j,H,I);W.transmission>0?a.unshift(Q):W.transparent===!0?r.unshift(Q):s.unshift(Q)}function U(D,R){s.length>1&&s.sort(D||Yhe),a.length>1&&a.sort(R||OV),r.length>1&&r.sort(R||OV)}function B(){for(let D=i,R=h.length;D<R;D++){const W=h[D];if(W.id===null)break;W.id=null,W.object=null,W.geometry=null,W.material=null,W.group=null}}return{opaque:s,transmissive:a,transparent:r,init:c,push:E,unshift:A,finish:B,sort:U}}function Jhe(){let h=new WeakMap;function i(a,r){const c=h.get(a);let S;return c===void 0?(S=new TV,h.set(a,[S])):r>=c.length?(S=new TV,c.push(S)):S=c[r],S}function s(){h=new WeakMap}return{get:i,dispose:s}}function Qhe(){const h={};return{get:function(i){if(h[i.id]!==void 0)return h[i.id];let s;switch(i.type){case"DirectionalLight":s={direction:new cr,color:new bs};break;case"SpotLight":s={position:new cr,direction:new cr,color:new bs,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":s={position:new cr,color:new bs,distance:0,decay:0};break;case"HemisphereLight":s={direction:new cr,skyColor:new bs,groundColor:new bs};break;case"RectAreaLight":s={color:new bs,position:new cr,halfWidth:new cr,halfHeight:new cr};break}return h[i.id]=s,s}}}function Zhe(){const h={};return{get:function(i){if(h[i.id]!==void 0)return h[i.id];let s;switch(i.type){case"DirectionalLight":s={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Eo};break;case"SpotLight":s={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Eo};break;case"PointLight":s={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Eo,shadowCameraNear:1,shadowCameraFar:1e3};break}return h[i.id]=s,s}}}let epe=0;function tpe(h,i){return(i.castShadow?2:0)-(h.castShadow?2:0)+(i.map?1:0)-(h.map?1:0)}function npe(h,i){const s=new Qhe,a=Zhe(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let B=0;B<9;B++)r.probe.push(new cr);const c=new cr,S=new lc,E=new lc;function A(B,D){let R=0,W=0,j=0;for(let lt=0;lt<9;lt++)r.probe[lt].set(0,0,0);let H=0,I=0,Q=0,Y=0,q=0,ae=0,oe=0,ye=0,_e=0,pe=0;B.sort(tpe);const me=D!==!0?Math.PI:1;for(let lt=0,It=B.length;lt<It;lt++){const wt=B[lt],we=wt.color,yt=wt.intensity,Bt=wt.distance,Ot=wt.shadow&&wt.shadow.map?wt.shadow.map.texture:null;if(wt.isAmbientLight)R+=we.r*yt*me,W+=we.g*yt*me,j+=we.b*yt*me;else if(wt.isLightProbe)for(let ze=0;ze<9;ze++)r.probe[ze].addScaledVector(wt.sh.coefficients[ze],yt);else if(wt.isDirectionalLight){const ze=s.get(wt);if(ze.color.copy(wt.color).multiplyScalar(wt.intensity*me),wt.castShadow){const Ut=wt.shadow,Ft=a.get(wt);Ft.shadowBias=Ut.bias,Ft.shadowNormalBias=Ut.normalBias,Ft.shadowRadius=Ut.radius,Ft.shadowMapSize=Ut.mapSize,r.directionalShadow[H]=Ft,r.directionalShadowMap[H]=Ot,r.directionalShadowMatrix[H]=wt.shadow.matrix,ae++}r.directional[H]=ze,H++}else if(wt.isSpotLight){const ze=s.get(wt);ze.position.setFromMatrixPosition(wt.matrixWorld),ze.color.copy(we).multiplyScalar(yt*me),ze.distance=Bt,ze.coneCos=Math.cos(wt.angle),ze.penumbraCos=Math.cos(wt.angle*(1-wt.penumbra)),ze.decay=wt.decay,r.spot[Q]=ze;const Ut=wt.shadow;if(wt.map&&(r.spotLightMap[_e]=wt.map,_e++,Ut.updateMatrices(wt),wt.castShadow&&pe++),r.spotLightMatrix[Q]=Ut.matrix,wt.castShadow){const Ft=a.get(wt);Ft.shadowBias=Ut.bias,Ft.shadowNormalBias=Ut.normalBias,Ft.shadowRadius=Ut.radius,Ft.shadowMapSize=Ut.mapSize,r.spotShadow[Q]=Ft,r.spotShadowMap[Q]=Ot,ye++}Q++}else if(wt.isRectAreaLight){const ze=s.get(wt);ze.color.copy(we).multiplyScalar(yt),ze.halfWidth.set(wt.width*.5,0,0),ze.halfHeight.set(0,wt.height*.5,0),r.rectArea[Y]=ze,Y++}else if(wt.isPointLight){const ze=s.get(wt);if(ze.color.copy(wt.color).multiplyScalar(wt.intensity*me),ze.distance=wt.distance,ze.decay=wt.decay,wt.castShadow){const Ut=wt.shadow,Ft=a.get(wt);Ft.shadowBias=Ut.bias,Ft.shadowNormalBias=Ut.normalBias,Ft.shadowRadius=Ut.radius,Ft.shadowMapSize=Ut.mapSize,Ft.shadowCameraNear=Ut.camera.near,Ft.shadowCameraFar=Ut.camera.far,r.pointShadow[I]=Ft,r.pointShadowMap[I]=Ot,r.pointShadowMatrix[I]=wt.shadow.matrix,oe++}r.point[I]=ze,I++}else if(wt.isHemisphereLight){const ze=s.get(wt);ze.skyColor.copy(wt.color).multiplyScalar(yt*me),ze.groundColor.copy(wt.groundColor).multiplyScalar(yt*me),r.hemi[q]=ze,q++}}Y>0&&(i.isWebGL2||h.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=bi.LTC_FLOAT_1,r.rectAreaLTC2=bi.LTC_FLOAT_2):h.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=bi.LTC_HALF_1,r.rectAreaLTC2=bi.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=R,r.ambient[1]=W,r.ambient[2]=j;const Ge=r.hash;(Ge.directionalLength!==H||Ge.pointLength!==I||Ge.spotLength!==Q||Ge.rectAreaLength!==Y||Ge.hemiLength!==q||Ge.numDirectionalShadows!==ae||Ge.numPointShadows!==oe||Ge.numSpotShadows!==ye||Ge.numSpotMaps!==_e)&&(r.directional.length=H,r.spot.length=Q,r.rectArea.length=Y,r.point.length=I,r.hemi.length=q,r.directionalShadow.length=ae,r.directionalShadowMap.length=ae,r.pointShadow.length=oe,r.pointShadowMap.length=oe,r.spotShadow.length=ye,r.spotShadowMap.length=ye,r.directionalShadowMatrix.length=ae,r.pointShadowMatrix.length=oe,r.spotLightMatrix.length=ye+_e-pe,r.spotLightMap.length=_e,r.numSpotLightShadowsWithMaps=pe,Ge.directionalLength=H,Ge.pointLength=I,Ge.spotLength=Q,Ge.rectAreaLength=Y,Ge.hemiLength=q,Ge.numDirectionalShadows=ae,Ge.numPointShadows=oe,Ge.numSpotShadows=ye,Ge.numSpotMaps=_e,r.version=epe++)}function U(B,D){let R=0,W=0,j=0,H=0,I=0;const Q=D.matrixWorldInverse;for(let Y=0,q=B.length;Y<q;Y++){const ae=B[Y];if(ae.isDirectionalLight){const oe=r.directional[R];oe.direction.setFromMatrixPosition(ae.matrixWorld),c.setFromMatrixPosition(ae.target.matrixWorld),oe.direction.sub(c),oe.direction.transformDirection(Q),R++}else if(ae.isSpotLight){const oe=r.spot[j];oe.position.setFromMatrixPosition(ae.matrixWorld),oe.position.applyMatrix4(Q),oe.direction.setFromMatrixPosition(ae.matrixWorld),c.setFromMatrixPosition(ae.target.matrixWorld),oe.direction.sub(c),oe.direction.transformDirection(Q),j++}else if(ae.isRectAreaLight){const oe=r.rectArea[H];oe.position.setFromMatrixPosition(ae.matrixWorld),oe.position.applyMatrix4(Q),E.identity(),S.copy(ae.matrixWorld),S.premultiply(Q),E.extractRotation(S),oe.halfWidth.set(ae.width*.5,0,0),oe.halfHeight.set(0,ae.height*.5,0),oe.halfWidth.applyMatrix4(E),oe.halfHeight.applyMatrix4(E),H++}else if(ae.isPointLight){const oe=r.point[W];oe.position.setFromMatrixPosition(ae.matrixWorld),oe.position.applyMatrix4(Q),W++}else if(ae.isHemisphereLight){const oe=r.hemi[I];oe.direction.setFromMatrixPosition(ae.matrixWorld),oe.direction.transformDirection(Q),I++}}}return{setup:A,setupView:U,state:r}}function MV(h,i){const s=new npe(h,i),a=[],r=[];function c(){a.length=0,r.length=0}function S(D){a.push(D)}function E(D){r.push(D)}function A(D){s.setup(a,D)}function U(D){s.setupView(a,D)}return{init:c,state:{lightsArray:a,shadowsArray:r,lights:s},setupLights:A,setupLightsView:U,pushLight:S,pushShadow:E}}function rpe(h,i){let s=new WeakMap;function a(c,S=0){const E=s.get(c);let A;return E===void 0?(A=new MV(h,i),s.set(c,[A])):S>=E.length?(A=new MV(h,i),E.push(A)):A=E[S],A}function r(){s=new WeakMap}return{get:a,dispose:r}}class ipe extends bC{constructor(i){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=mce,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(i)}copy(i){return super.copy(i),this.depthPacking=i.depthPacking,this.map=i.map,this.alphaMap=i.alphaMap,this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this}}class ope extends bC{constructor(i){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new cr,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(i)}copy(i){return super.copy(i),this.referencePosition.copy(i.referencePosition),this.nearDistance=i.nearDistance,this.farDistance=i.farDistance,this.map=i.map,this.alphaMap=i.alphaMap,this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this}}const ape=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,spe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function upe(h,i,s){let a=new j5;const r=new Eo,c=new Eo,S=new wu,E=new ipe({depthPacking:gce}),A=new ope,U={},B=s.maxTextureSize,D={0:$g,1:vw,2:B5},R=new ww({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Eo},radius:{value:4}},vertexShader:ape,fragmentShader:spe}),W=R.clone();W.defines.HORIZONTAL_PASS=1;const j=new Dy;j.setAttribute("position",new My(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const H=new Ay(j,R),I=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=pq,this.render=function(ae,oe,ye){if(I.enabled===!1||I.autoUpdate===!1&&I.needsUpdate===!1||ae.length===0)return;const _e=h.getRenderTarget(),pe=h.getActiveCubeFace(),me=h.getActiveMipmapLevel(),Ge=h.state;Ge.setBlending(Kb),Ge.buffers.color.setClear(1,1,1,1),Ge.buffers.depth.setTest(!0),Ge.setScissorTest(!1);for(let lt=0,It=ae.length;lt<It;lt++){const wt=ae[lt],we=wt.shadow;if(we===void 0){console.warn("THREE.WebGLShadowMap:",wt,"has no shadow.");continue}if(we.autoUpdate===!1&&we.needsUpdate===!1)continue;r.copy(we.mapSize);const yt=we.getFrameExtents();if(r.multiply(yt),c.copy(we.mapSize),(r.x>B||r.y>B)&&(r.x>B&&(c.x=Math.floor(B/yt.x),r.x=c.x*yt.x,we.mapSize.x=c.x),r.y>B&&(c.y=Math.floor(B/yt.y),r.y=c.y*yt.y,we.mapSize.y=c.y)),we.map===null){const Ot=this.type!==MS?{minFilter:wh,magFilter:wh}:{};we.map=new xw(r.x,r.y,Ot),we.map.texture.name=wt.name+".shadowMap",we.camera.updateProjectionMatrix()}h.setRenderTarget(we.map),h.clear();const Bt=we.getViewportCount();for(let Ot=0;Ot<Bt;Ot++){const ze=we.getViewport(Ot);S.set(c.x*ze.x,c.y*ze.y,c.x*ze.z,c.y*ze.w),Ge.viewport(S),we.updateMatrices(wt,Ot),a=we.getFrustum(),q(oe,ye,we.camera,wt,this.type)}we.isPointLightShadow!==!0&&this.type===MS&&Q(we,ye),we.needsUpdate=!1}I.needsUpdate=!1,h.setRenderTarget(_e,pe,me)};function Q(ae,oe){const ye=i.update(H);R.defines.VSM_SAMPLES!==ae.blurSamples&&(R.defines.VSM_SAMPLES=ae.blurSamples,W.defines.VSM_SAMPLES=ae.blurSamples,R.needsUpdate=!0,W.needsUpdate=!0),ae.mapPass===null&&(ae.mapPass=new xw(r.x,r.y)),R.uniforms.shadow_pass.value=ae.map.texture,R.uniforms.resolution.value=ae.mapSize,R.uniforms.radius.value=ae.radius,h.setRenderTarget(ae.mapPass),h.clear(),h.renderBufferDirect(oe,null,ye,R,H,null),W.uniforms.shadow_pass.value=ae.mapPass.texture,W.uniforms.resolution.value=ae.mapSize,W.uniforms.radius.value=ae.radius,h.setRenderTarget(ae.map),h.clear(),h.renderBufferDirect(oe,null,ye,W,H,null)}function Y(ae,oe,ye,_e,pe,me){let Ge=null;const lt=ye.isPointLight===!0?ae.customDistanceMaterial:ae.customDepthMaterial;if(lt!==void 0)Ge=lt;else if(Ge=ye.isPointLight===!0?A:E,h.localClippingEnabled&&oe.clipShadows===!0&&Array.isArray(oe.clippingPlanes)&&oe.clippingPlanes.length!==0||oe.displacementMap&&oe.displacementScale!==0||oe.alphaMap&&oe.alphaTest>0||oe.map&&oe.alphaTest>0){const It=Ge.uuid,wt=oe.uuid;let we=U[It];we===void 0&&(we={},U[It]=we);let yt=we[wt];yt===void 0&&(yt=Ge.clone(),we[wt]=yt),Ge=yt}return Ge.visible=oe.visible,Ge.wireframe=oe.wireframe,me===MS?Ge.side=oe.shadowSide!==null?oe.shadowSide:oe.side:Ge.side=oe.shadowSide!==null?oe.shadowSide:D[oe.side],Ge.alphaMap=oe.alphaMap,Ge.alphaTest=oe.alphaTest,Ge.map=oe.map,Ge.clipShadows=oe.clipShadows,Ge.clippingPlanes=oe.clippingPlanes,Ge.clipIntersection=oe.clipIntersection,Ge.displacementMap=oe.displacementMap,Ge.displacementScale=oe.displacementScale,Ge.displacementBias=oe.displacementBias,Ge.wireframeLinewidth=oe.wireframeLinewidth,Ge.linewidth=oe.linewidth,ye.isPointLight===!0&&Ge.isMeshDistanceMaterial===!0&&(Ge.referencePosition.setFromMatrixPosition(ye.matrixWorld),Ge.nearDistance=_e,Ge.farDistance=pe),Ge}function q(ae,oe,ye,_e,pe){if(ae.visible===!1)return;if(ae.layers.test(oe.layers)&&(ae.isMesh||ae.isLine||ae.isPoints)&&(ae.castShadow||ae.receiveShadow&&pe===MS)&&(!ae.frustumCulled||a.intersectsObject(ae))){ae.modelViewMatrix.multiplyMatrices(ye.matrixWorldInverse,ae.matrixWorld);const lt=i.update(ae),It=ae.material;if(Array.isArray(It)){const wt=lt.groups;for(let we=0,yt=wt.length;we<yt;we++){const Bt=wt[we],Ot=It[Bt.materialIndex];if(Ot&&Ot.visible){const ze=Y(ae,Ot,_e,ye.near,ye.far,pe);h.renderBufferDirect(ye,null,lt,ze,ae,Bt)}}}else if(It.visible){const wt=Y(ae,It,_e,ye.near,ye.far,pe);h.renderBufferDirect(ye,null,lt,wt,ae,null)}}const Ge=ae.children;for(let lt=0,It=Ge.length;lt<It;lt++)q(Ge[lt],oe,ye,_e,pe)}}function cpe(h,i,s){const a=s.isWebGL2;function r(){let zn=!1;const ir=new wu;let Or=null;const qr=new wu(0,0,0,0);return{setMask:function(Kr){Or!==Kr&&!zn&&(h.colorMask(Kr,Kr,Kr,Kr),Or=Kr)},setLocked:function(Kr){zn=Kr},setClear:function(Kr,Tt,Rr,Qt,Se){Se===!0&&(Kr*=Qt,Tt*=Qt,Rr*=Qt),ir.set(Kr,Tt,Rr,Qt),qr.equals(ir)===!1&&(h.clearColor(Kr,Tt,Rr,Qt),qr.copy(ir))},reset:function(){zn=!1,Or=null,qr.set(-1,0,0,0)}}}function c(){let zn=!1,ir=null,Or=null,qr=null;return{setTest:function(Kr){Kr?sn(2929):kn(2929)},setMask:function(Kr){ir!==Kr&&!zn&&(h.depthMask(Kr),ir=Kr)},setFunc:function(Kr){if(Or!==Kr){switch(Kr){case jue:h.depthFunc(512);break;case zue:h.depthFunc(519);break;case Uue:h.depthFunc(513);break;case OR:h.depthFunc(515);break;case Wue:h.depthFunc(514);break;case Vue:h.depthFunc(518);break;case Hue:h.depthFunc(516);break;case Gue:h.depthFunc(517);break;default:h.depthFunc(515)}Or=Kr}},setLocked:function(Kr){zn=Kr},setClear:function(Kr){qr!==Kr&&(h.clearDepth(Kr),qr=Kr)},reset:function(){zn=!1,ir=null,Or=null,qr=null}}}function S(){let zn=!1,ir=null,Or=null,qr=null,Kr=null,Tt=null,Rr=null,Qt=null,Se=null;return{setTest:function(ve){zn||(ve?sn(2960):kn(2960))},setMask:function(ve){ir!==ve&&!zn&&(h.stencilMask(ve),ir=ve)},setFunc:function(ve,ke,Me){(Or!==ve||qr!==ke||Kr!==Me)&&(h.stencilFunc(ve,ke,Me),Or=ve,qr=ke,Kr=Me)},setOp:function(ve,ke,Me){(Tt!==ve||Rr!==ke||Qt!==Me)&&(h.stencilOp(ve,ke,Me),Tt=ve,Rr=ke,Qt=Me)},setLocked:function(ve){zn=ve},setClear:function(ve){Se!==ve&&(h.clearStencil(ve),Se=ve)},reset:function(){zn=!1,ir=null,Or=null,qr=null,Kr=null,Tt=null,Rr=null,Qt=null,Se=null}}}const E=new r,A=new c,U=new S,B=new WeakMap,D=new WeakMap;let R={},W={},j=new WeakMap,H=[],I=null,Q=!1,Y=null,q=null,ae=null,oe=null,ye=null,_e=null,pe=null,me=!1,Ge=null,lt=null,It=null,wt=null,we=null;const yt=h.getParameter(35661);let Bt=!1,Ot=0;const ze=h.getParameter(7938);ze.indexOf("WebGL")!==-1?(Ot=parseFloat(/^WebGL (\d)/.exec(ze)[1]),Bt=Ot>=1):ze.indexOf("OpenGL ES")!==-1&&(Ot=parseFloat(/^OpenGL ES (\d)/.exec(ze)[1]),Bt=Ot>=2);let Ut=null,Ft={};const pt=h.getParameter(3088),vt=h.getParameter(2978),rn=new wu().fromArray(pt),xt=new wu().fromArray(vt);function _t(zn,ir,Or){const qr=new Uint8Array(4),Kr=h.createTexture();h.bindTexture(zn,Kr),h.texParameteri(zn,10241,9728),h.texParameteri(zn,10240,9728);for(let Tt=0;Tt<Or;Tt++)h.texImage2D(ir+Tt,0,6408,1,1,0,6408,5121,qr);return Kr}const Xt={};Xt[3553]=_t(3553,3553,1),Xt[34067]=_t(34067,34069,6),E.setClear(0,0,0,1),A.setClear(1),U.setClear(0),sn(2929),A.setFunc(OR),Pn(!1),An(wW),sn(2884),$t(Kb);function sn(zn){R[zn]!==!0&&(h.enable(zn),R[zn]=!0)}function kn(zn){R[zn]!==!1&&(h.disable(zn),R[zn]=!1)}function an(zn,ir){return W[zn]!==ir?(h.bindFramebuffer(zn,ir),W[zn]=ir,a&&(zn===36009&&(W[36160]=ir),zn===36160&&(W[36009]=ir)),!0):!1}function Ve(zn,ir){let Or=H,qr=!1;if(zn)if(Or=j.get(ir),Or===void 0&&(Or=[],j.set(ir,Or)),zn.isWebGLMultipleRenderTargets){const Kr=zn.texture;if(Or.length!==Kr.length||Or[0]!==36064){for(let Tt=0,Rr=Kr.length;Tt<Rr;Tt++)Or[Tt]=36064+Tt;Or.length=Kr.length,qr=!0}}else Or[0]!==36064&&(Or[0]=36064,qr=!0);else Or[0]!==1029&&(Or[0]=1029,qr=!0);qr&&(s.isWebGL2?h.drawBuffers(Or):i.get("WEBGL_draw_buffers").drawBuffersWEBGL(Or))}function Ye(zn){return I!==zn?(h.useProgram(zn),I=zn,!0):!1}const $e={[F2]:32774,[Oue]:32778,[Tue]:32779};if(a)$e[CW]=32775,$e[kW]=32776;else{const zn=i.get("EXT_blend_minmax");zn!==null&&($e[CW]=zn.MIN_EXT,$e[kW]=zn.MAX_EXT)}const ft={[Mue]:0,[Due]:1,[Nue]:768,[mq]:770,[Bue]:776,[Pue]:774,[Fue]:772,[Iue]:769,[gq]:771,[Lue]:775,[Rue]:773};function $t(zn,ir,Or,qr,Kr,Tt,Rr,Qt){if(zn===Kb){Q===!0&&(kn(3042),Q=!1);return}if(Q===!1&&(sn(3042),Q=!0),zn!==Aue){if(zn!==Y||Qt!==me){if((q!==F2||ye!==F2)&&(h.blendEquation(32774),q=F2,ye=F2),Qt)switch(zn){case r_:h.blendFuncSeparate(1,771,1,771);break;case _W:h.blendFunc(1,1);break;case EW:h.blendFuncSeparate(0,769,0,1);break;case SW:h.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",zn);break}else switch(zn){case r_:h.blendFuncSeparate(770,771,1,771);break;case _W:h.blendFunc(770,1);break;case EW:h.blendFuncSeparate(0,769,0,1);break;case SW:h.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",zn);break}ae=null,oe=null,_e=null,pe=null,Y=zn,me=Qt}return}Kr=Kr||ir,Tt=Tt||Or,Rr=Rr||qr,(ir!==q||Kr!==ye)&&(h.blendEquationSeparate($e[ir],$e[Kr]),q=ir,ye=Kr),(Or!==ae||qr!==oe||Tt!==_e||Rr!==pe)&&(h.blendFuncSeparate(ft[Or],ft[qr],ft[Tt],ft[Rr]),ae=Or,oe=qr,_e=Tt,pe=Rr),Y=zn,me=!1}function Jt(zn,ir){zn.side===B5?kn(2884):sn(2884);let Or=zn.side===$g;ir&&(Or=!Or),Pn(Or),zn.blending===r_&&zn.transparent===!1?$t(Kb):$t(zn.blending,zn.blendEquation,zn.blendSrc,zn.blendDst,zn.blendEquationAlpha,zn.blendSrcAlpha,zn.blendDstAlpha,zn.premultipliedAlpha),A.setFunc(zn.depthFunc),A.setTest(zn.depthTest),A.setMask(zn.depthWrite),E.setMask(zn.colorWrite);const qr=zn.stencilWrite;U.setTest(qr),qr&&(U.setMask(zn.stencilWriteMask),U.setFunc(zn.stencilFunc,zn.stencilRef,zn.stencilFuncMask),U.setOp(zn.stencilFail,zn.stencilZFail,zn.stencilZPass)),Ce(zn.polygonOffset,zn.polygonOffsetFactor,zn.polygonOffsetUnits),zn.alphaToCoverage===!0?sn(32926):kn(32926)}function Pn(zn){Ge!==zn&&(zn?h.frontFace(2304):h.frontFace(2305),Ge=zn)}function An(zn){zn!==Sue?(sn(2884),zn!==lt&&(zn===wW?h.cullFace(1029):zn===Cue?h.cullFace(1028):h.cullFace(1032))):kn(2884),lt=zn}function Qn(zn){zn!==It&&(Bt&&h.lineWidth(zn),It=zn)}function Ce(zn,ir,Or){zn?(sn(32823),(wt!==ir||we!==Or)&&(h.polygonOffset(ir,Or),wt=ir,we=Or)):kn(32823)}function sr(zn){zn?sn(3089):kn(3089)}function Mr(zn){zn===void 0&&(zn=33984+yt-1),Ut!==zn&&(h.activeTexture(zn),Ut=zn)}function on(zn,ir,Or){Or===void 0&&(Ut===null?Or=33984+yt-1:Or=Ut);let qr=Ft[Or];qr===void 0&&(qr={type:void 0,texture:void 0},Ft[Or]=qr),(qr.type!==zn||qr.texture!==ir)&&(Ut!==Or&&(h.activeTexture(Or),Ut=Or),h.bindTexture(zn,ir||Xt[zn]),qr.type=zn,qr.texture=ir)}function Gt(){const zn=Ft[Ut];zn!==void 0&&zn.type!==void 0&&(h.bindTexture(zn.type,null),zn.type=void 0,zn.texture=void 0)}function Hn(){try{h.compressedTexImage2D.apply(h,arguments)}catch(zn){console.error("THREE.WebGLState:",zn)}}function Kt(){try{h.compressedTexImage3D.apply(h,arguments)}catch(zn){console.error("THREE.WebGLState:",zn)}}function Vt(){try{h.texSubImage2D.apply(h,arguments)}catch(zn){console.error("THREE.WebGLState:",zn)}}function en(){try{h.texSubImage3D.apply(h,arguments)}catch(zn){console.error("THREE.WebGLState:",zn)}}function Vn(){try{h.compressedTexSubImage2D.apply(h,arguments)}catch(zn){console.error("THREE.WebGLState:",zn)}}function Dt(){try{h.compressedTexSubImage3D.apply(h,arguments)}catch(zn){console.error("THREE.WebGLState:",zn)}}function On(){try{h.texStorage2D.apply(h,arguments)}catch(zn){console.error("THREE.WebGLState:",zn)}}function or(){try{h.texStorage3D.apply(h,arguments)}catch(zn){console.error("THREE.WebGLState:",zn)}}function ar(){try{h.texImage2D.apply(h,arguments)}catch(zn){console.error("THREE.WebGLState:",zn)}}function yr(){try{h.texImage3D.apply(h,arguments)}catch(zn){console.error("THREE.WebGLState:",zn)}}function kr(zn){rn.equals(zn)===!1&&(h.scissor(zn.x,zn.y,zn.z,zn.w),rn.copy(zn))}function dr(zn){xt.equals(zn)===!1&&(h.viewport(zn.x,zn.y,zn.z,zn.w),xt.copy(zn))}function oi(zn,ir){let Or=D.get(ir);Or===void 0&&(Or=new WeakMap,D.set(ir,Or));let qr=Or.get(zn);qr===void 0&&(qr=h.getUniformBlockIndex(ir,zn.name),Or.set(zn,qr))}function Ur(zn,ir){const qr=D.get(ir).get(zn);B.get(ir)!==qr&&(h.uniformBlockBinding(ir,qr,zn.__bindingPointIndex),B.set(ir,qr))}function Xr(){h.disable(3042),h.disable(2884),h.disable(2929),h.disable(32823),h.disable(3089),h.disable(2960),h.disable(32926),h.blendEquation(32774),h.blendFunc(1,0),h.blendFuncSeparate(1,0,1,0),h.colorMask(!0,!0,!0,!0),h.clearColor(0,0,0,0),h.depthMask(!0),h.depthFunc(513),h.clearDepth(1),h.stencilMask(4294967295),h.stencilFunc(519,0,4294967295),h.stencilOp(7680,7680,7680),h.clearStencil(0),h.cullFace(1029),h.frontFace(2305),h.polygonOffset(0,0),h.activeTexture(33984),h.bindFramebuffer(36160,null),a===!0&&(h.bindFramebuffer(36009,null),h.bindFramebuffer(36008,null)),h.useProgram(null),h.lineWidth(1),h.scissor(0,0,h.canvas.width,h.canvas.height),h.viewport(0,0,h.canvas.width,h.canvas.height),R={},Ut=null,Ft={},W={},j=new WeakMap,H=[],I=null,Q=!1,Y=null,q=null,ae=null,oe=null,ye=null,_e=null,pe=null,me=!1,Ge=null,lt=null,It=null,wt=null,we=null,rn.set(0,0,h.canvas.width,h.canvas.height),xt.set(0,0,h.canvas.width,h.canvas.height),E.reset(),A.reset(),U.reset()}return{buffers:{color:E,depth:A,stencil:U},enable:sn,disable:kn,bindFramebuffer:an,drawBuffers:Ve,useProgram:Ye,setBlending:$t,setMaterial:Jt,setFlipSided:Pn,setCullFace:An,setLineWidth:Qn,setPolygonOffset:Ce,setScissorTest:sr,activeTexture:Mr,bindTexture:on,unbindTexture:Gt,compressedTexImage2D:Hn,compressedTexImage3D:Kt,texImage2D:ar,texImage3D:yr,updateUBOMapping:oi,uniformBlockBinding:Ur,texStorage2D:On,texStorage3D:or,texSubImage2D:Vt,texSubImage3D:en,compressedTexSubImage2D:Vn,compressedTexSubImage3D:Dt,scissor:kr,viewport:dr,reset:Xr}}function lpe(h,i,s,a,r,c,S){const E=r.isWebGL2,A=r.maxTextures,U=r.maxCubemapSize,B=r.maxTextureSize,D=r.maxSamples,R=i.has("WEBGL_multisampled_render_to_texture")?i.get("WEBGL_multisampled_render_to_texture"):null,W=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),j=new WeakMap;let H;const I=new WeakMap;let Q=!1;try{Q=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function Y(on,Gt){return Q?new OffscreenCanvas(on,Gt):iT("canvas")}function q(on,Gt,Hn,Kt){let Vt=1;if((on.width>Kt||on.height>Kt)&&(Vt=Kt/Math.max(on.width,on.height)),Vt<1||Gt===!0)if(typeof HTMLImageElement<"u"&&on instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&on instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&on instanceof ImageBitmap){const en=Gt?IR:Math.floor,Vn=en(Vt*on.width),Dt=en(Vt*on.height);H===void 0&&(H=Y(Vn,Dt));const On=Hn?Y(Vn,Dt):H;return On.width=Vn,On.height=Dt,On.getContext("2d").drawImage(on,0,0,Vn,Dt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+on.width+"x"+on.height+") to ("+Vn+"x"+Dt+")."),On}else return"data"in on&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+on.width+"x"+on.height+")."),on;return on}function ae(on){return QW(on.width)&&QW(on.height)}function oe(on){return E?!1:on.wrapS!==tv||on.wrapT!==tv||on.minFilter!==wh&&on.minFilter!==Np}function ye(on,Gt){return on.generateMipmaps&&Gt&&on.minFilter!==wh&&on.minFilter!==Np}function _e(on){h.generateMipmap(on)}function pe(on,Gt,Hn,Kt,Vt=!1){if(E===!1)return Gt;if(on!==null){if(h[on]!==void 0)return h[on];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+on+"'")}let en=Gt;return Gt===6403&&(Hn===5126&&(en=33326),Hn===5131&&(en=33325),Hn===5121&&(en=33321)),Gt===33319&&(Hn===5126&&(en=33328),Hn===5131&&(en=33327),Hn===5121&&(en=33323)),Gt===6408&&(Hn===5126&&(en=34836),Hn===5131&&(en=34842),Hn===5121&&(en=Kt===iu&&Vt===!1?35907:32856),Hn===32819&&(en=32854),Hn===32820&&(en=32855)),(en===33325||en===33326||en===33327||en===33328||en===34842||en===34836)&&i.get("EXT_color_buffer_float"),en}function me(on,Gt,Hn){return ye(on,Hn)===!0||on.isFramebufferTexture&&on.minFilter!==wh&&on.minFilter!==Np?Math.log2(Math.max(Gt.width,Gt.height))+1:on.mipmaps!==void 0&&on.mipmaps.length>0?on.mipmaps.length:on.isCompressedTexture&&Array.isArray(on.image)?Gt.mipmaps.length:1}function Ge(on){return on===wh||on===AW||on===XI?9728:9729}function lt(on){const Gt=on.target;Gt.removeEventListener("dispose",lt),wt(Gt),Gt.isVideoTexture&&j.delete(Gt)}function It(on){const Gt=on.target;Gt.removeEventListener("dispose",It),yt(Gt)}function wt(on){const Gt=a.get(on);if(Gt.__webglInit===void 0)return;const Hn=on.source,Kt=I.get(Hn);if(Kt){const Vt=Kt[Gt.__cacheKey];Vt.usedTimes--,Vt.usedTimes===0&&we(on),Object.keys(Kt).length===0&&I.delete(Hn)}a.remove(on)}function we(on){const Gt=a.get(on);h.deleteTexture(Gt.__webglTexture);const Hn=on.source,Kt=I.get(Hn);delete Kt[Gt.__cacheKey],S.memory.textures--}function yt(on){const Gt=on.texture,Hn=a.get(on),Kt=a.get(Gt);if(Kt.__webglTexture!==void 0&&(h.deleteTexture(Kt.__webglTexture),S.memory.textures--),on.depthTexture&&on.depthTexture.dispose(),on.isWebGLCubeRenderTarget)for(let Vt=0;Vt<6;Vt++)h.deleteFramebuffer(Hn.__webglFramebuffer[Vt]),Hn.__webglDepthbuffer&&h.deleteRenderbuffer(Hn.__webglDepthbuffer[Vt]);else{if(h.deleteFramebuffer(Hn.__webglFramebuffer),Hn.__webglDepthbuffer&&h.deleteRenderbuffer(Hn.__webglDepthbuffer),Hn.__webglMultisampledFramebuffer&&h.deleteFramebuffer(Hn.__webglMultisampledFramebuffer),Hn.__webglColorRenderbuffer)for(let Vt=0;Vt<Hn.__webglColorRenderbuffer.length;Vt++)Hn.__webglColorRenderbuffer[Vt]&&h.deleteRenderbuffer(Hn.__webglColorRenderbuffer[Vt]);Hn.__webglDepthRenderbuffer&&h.deleteRenderbuffer(Hn.__webglDepthRenderbuffer)}if(on.isWebGLMultipleRenderTargets)for(let Vt=0,en=Gt.length;Vt<en;Vt++){const Vn=a.get(Gt[Vt]);Vn.__webglTexture&&(h.deleteTexture(Vn.__webglTexture),S.memory.textures--),a.remove(Gt[Vt])}a.remove(Gt),a.remove(on)}let Bt=0;function Ot(){Bt=0}function ze(){const on=Bt;return on>=A&&console.warn("THREE.WebGLTextures: Trying to use "+on+" texture units while this GPU supports only "+A),Bt+=1,on}function Ut(on){const Gt=[];return Gt.push(on.wrapS),Gt.push(on.wrapT),Gt.push(on.wrapR||0),Gt.push(on.magFilter),Gt.push(on.minFilter),Gt.push(on.anisotropy),Gt.push(on.internalFormat),Gt.push(on.format),Gt.push(on.type),Gt.push(on.generateMipmaps),Gt.push(on.premultiplyAlpha),Gt.push(on.flipY),Gt.push(on.unpackAlignment),Gt.push(on.encoding),Gt.join()}function Ft(on,Gt){const Hn=a.get(on);if(on.isVideoTexture&&sr(on),on.isRenderTargetTexture===!1&&on.version>0&&Hn.__version!==on.version){const Kt=on.image;if(Kt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Kt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{kn(Hn,on,Gt);return}}s.bindTexture(3553,Hn.__webglTexture,33984+Gt)}function pt(on,Gt){const Hn=a.get(on);if(on.version>0&&Hn.__version!==on.version){kn(Hn,on,Gt);return}s.bindTexture(35866,Hn.__webglTexture,33984+Gt)}function vt(on,Gt){const Hn=a.get(on);if(on.version>0&&Hn.__version!==on.version){kn(Hn,on,Gt);return}s.bindTexture(32879,Hn.__webglTexture,33984+Gt)}function rn(on,Gt){const Hn=a.get(on);if(on.version>0&&Hn.__version!==on.version){an(Hn,on,Gt);return}s.bindTexture(34067,Hn.__webglTexture,33984+Gt)}const xt={[rT]:10497,[tv]:33071,[DR]:33648},_t={[wh]:9728,[AW]:9984,[XI]:9986,[Np]:9729,[Zue]:9985,[sC]:9987};function Xt(on,Gt,Hn){if(Hn?(h.texParameteri(on,10242,xt[Gt.wrapS]),h.texParameteri(on,10243,xt[Gt.wrapT]),(on===32879||on===35866)&&h.texParameteri(on,32882,xt[Gt.wrapR]),h.texParameteri(on,10240,_t[Gt.magFilter]),h.texParameteri(on,10241,_t[Gt.minFilter])):(h.texParameteri(on,10242,33071),h.texParameteri(on,10243,33071),(on===32879||on===35866)&&h.texParameteri(on,32882,33071),(Gt.wrapS!==tv||Gt.wrapT!==tv)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),h.texParameteri(on,10240,Ge(Gt.magFilter)),h.texParameteri(on,10241,Ge(Gt.minFilter)),Gt.minFilter!==wh&&Gt.minFilter!==Np&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),i.has("EXT_texture_filter_anisotropic")===!0){const Kt=i.get("EXT_texture_filter_anisotropic");if(Gt.magFilter===wh||Gt.minFilter!==XI&&Gt.minFilter!==sC||Gt.type===sw&&i.has("OES_texture_float_linear")===!1||E===!1&&Gt.type===uC&&i.has("OES_texture_half_float_linear")===!1)return;(Gt.anisotropy>1||a.get(Gt).__currentAnisotropy)&&(h.texParameterf(on,Kt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Gt.anisotropy,r.getMaxAnisotropy())),a.get(Gt).__currentAnisotropy=Gt.anisotropy)}}function sn(on,Gt){let Hn=!1;on.__webglInit===void 0&&(on.__webglInit=!0,Gt.addEventListener("dispose",lt));const Kt=Gt.source;let Vt=I.get(Kt);Vt===void 0&&(Vt={},I.set(Kt,Vt));const en=Ut(Gt);if(en!==on.__cacheKey){Vt[en]===void 0&&(Vt[en]={texture:h.createTexture(),usedTimes:0},S.memory.textures++,Hn=!0),Vt[en].usedTimes++;const Vn=Vt[on.__cacheKey];Vn!==void 0&&(Vt[on.__cacheKey].usedTimes--,Vn.usedTimes===0&&we(Gt)),on.__cacheKey=en,on.__webglTexture=Vt[en].texture}return Hn}function kn(on,Gt,Hn){let Kt=3553;(Gt.isDataArrayTexture||Gt.isCompressedArrayTexture)&&(Kt=35866),Gt.isData3DTexture&&(Kt=32879);const Vt=sn(on,Gt),en=Gt.source;s.bindTexture(Kt,on.__webglTexture,33984+Hn);const Vn=a.get(en);if(en.version!==Vn.__version||Vt===!0){s.activeTexture(33984+Hn),h.pixelStorei(37440,Gt.flipY),h.pixelStorei(37441,Gt.premultiplyAlpha),h.pixelStorei(3317,Gt.unpackAlignment),h.pixelStorei(37443,0);const Dt=oe(Gt)&&ae(Gt.image)===!1;let On=q(Gt.image,Dt,!1,B);On=Mr(Gt,On);const or=ae(On)||E,ar=c.convert(Gt.format,Gt.encoding);let yr=c.convert(Gt.type),kr=pe(Gt.internalFormat,ar,yr,Gt.encoding,Gt.isVideoTexture);Xt(Kt,Gt,or);let dr;const oi=Gt.mipmaps,Ur=E&&Gt.isVideoTexture!==!0,Xr=Vn.__version===void 0||Vt===!0,zn=me(Gt,On,or);if(Gt.isDepthTexture)kr=6402,E?Gt.type===sw?kr=36012:Gt.type===aw?kr=33190:Gt.type===i_?kr=35056:kr=33189:Gt.type===sw&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Gt.format===lw&&kr===6402&&Gt.type!==bq&&Gt.type!==aw&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Gt.type=aw,yr=c.convert(Gt.type)),Gt.format===p_&&kr===6402&&(kr=34041,Gt.type!==i_&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Gt.type=i_,yr=c.convert(Gt.type))),Xr&&(Ur?s.texStorage2D(3553,1,kr,On.width,On.height):s.texImage2D(3553,0,kr,On.width,On.height,0,ar,yr,null));else if(Gt.isDataTexture)if(oi.length>0&&or){Ur&&Xr&&s.texStorage2D(3553,zn,kr,oi[0].width,oi[0].height);for(let ir=0,Or=oi.length;ir<Or;ir++)dr=oi[ir],Ur?s.texSubImage2D(3553,ir,0,0,dr.width,dr.height,ar,yr,dr.data):s.texImage2D(3553,ir,kr,dr.width,dr.height,0,ar,yr,dr.data);Gt.generateMipmaps=!1}else Ur?(Xr&&s.texStorage2D(3553,zn,kr,On.width,On.height),s.texSubImage2D(3553,0,0,0,On.width,On.height,ar,yr,On.data)):s.texImage2D(3553,0,kr,On.width,On.height,0,ar,yr,On.data);else if(Gt.isCompressedTexture)if(Gt.isCompressedArrayTexture){Ur&&Xr&&s.texStorage3D(35866,zn,kr,oi[0].width,oi[0].height,On.depth);for(let ir=0,Or=oi.length;ir<Or;ir++)dr=oi[ir],Gt.format!==nv?ar!==null?Ur?s.compressedTexSubImage3D(35866,ir,0,0,0,dr.width,dr.height,On.depth,ar,dr.data,0,0):s.compressedTexImage3D(35866,ir,kr,dr.width,dr.height,On.depth,0,dr.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ur?s.texSubImage3D(35866,ir,0,0,0,dr.width,dr.height,On.depth,ar,yr,dr.data):s.texImage3D(35866,ir,kr,dr.width,dr.height,On.depth,0,ar,yr,dr.data)}else{Ur&&Xr&&s.texStorage2D(3553,zn,kr,oi[0].width,oi[0].height);for(let ir=0,Or=oi.length;ir<Or;ir++)dr=oi[ir],Gt.format!==nv?ar!==null?Ur?s.compressedTexSubImage2D(3553,ir,0,0,dr.width,dr.height,ar,dr.data):s.compressedTexImage2D(3553,ir,kr,dr.width,dr.height,0,dr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ur?s.texSubImage2D(3553,ir,0,0,dr.width,dr.height,ar,yr,dr.data):s.texImage2D(3553,ir,kr,dr.width,dr.height,0,ar,yr,dr.data)}else if(Gt.isDataArrayTexture)Ur?(Xr&&s.texStorage3D(35866,zn,kr,On.width,On.height,On.depth),s.texSubImage3D(35866,0,0,0,0,On.width,On.height,On.depth,ar,yr,On.data)):s.texImage3D(35866,0,kr,On.width,On.height,On.depth,0,ar,yr,On.data);else if(Gt.isData3DTexture)Ur?(Xr&&s.texStorage3D(32879,zn,kr,On.width,On.height,On.depth),s.texSubImage3D(32879,0,0,0,0,On.width,On.height,On.depth,ar,yr,On.data)):s.texImage3D(32879,0,kr,On.width,On.height,On.depth,0,ar,yr,On.data);else if(Gt.isFramebufferTexture){if(Xr)if(Ur)s.texStorage2D(3553,zn,kr,On.width,On.height);else{let ir=On.width,Or=On.height;for(let qr=0;qr<zn;qr++)s.texImage2D(3553,qr,kr,ir,Or,0,ar,yr,null),ir>>=1,Or>>=1}}else if(oi.length>0&&or){Ur&&Xr&&s.texStorage2D(3553,zn,kr,oi[0].width,oi[0].height);for(let ir=0,Or=oi.length;ir<Or;ir++)dr=oi[ir],Ur?s.texSubImage2D(3553,ir,0,0,ar,yr,dr):s.texImage2D(3553,ir,kr,ar,yr,dr);Gt.generateMipmaps=!1}else Ur?(Xr&&s.texStorage2D(3553,zn,kr,On.width,On.height),s.texSubImage2D(3553,0,0,0,ar,yr,On)):s.texImage2D(3553,0,kr,ar,yr,On);ye(Gt,or)&&_e(Kt),Vn.__version=en.version,Gt.onUpdate&&Gt.onUpdate(Gt)}on.__version=Gt.version}function an(on,Gt,Hn){if(Gt.image.length!==6)return;const Kt=sn(on,Gt),Vt=Gt.source;s.bindTexture(34067,on.__webglTexture,33984+Hn);const en=a.get(Vt);if(Vt.version!==en.__version||Kt===!0){s.activeTexture(33984+Hn),h.pixelStorei(37440,Gt.flipY),h.pixelStorei(37441,Gt.premultiplyAlpha),h.pixelStorei(3317,Gt.unpackAlignment),h.pixelStorei(37443,0);const Vn=Gt.isCompressedTexture||Gt.image[0].isCompressedTexture,Dt=Gt.image[0]&&Gt.image[0].isDataTexture,On=[];for(let ir=0;ir<6;ir++)!Vn&&!Dt?On[ir]=q(Gt.image[ir],!1,!0,U):On[ir]=Dt?Gt.image[ir].image:Gt.image[ir],On[ir]=Mr(Gt,On[ir]);const or=On[0],ar=ae(or)||E,yr=c.convert(Gt.format,Gt.encoding),kr=c.convert(Gt.type),dr=pe(Gt.internalFormat,yr,kr,Gt.encoding),oi=E&&Gt.isVideoTexture!==!0,Ur=en.__version===void 0||Kt===!0;let Xr=me(Gt,or,ar);Xt(34067,Gt,ar);let zn;if(Vn){oi&&Ur&&s.texStorage2D(34067,Xr,dr,or.width,or.height);for(let ir=0;ir<6;ir++){zn=On[ir].mipmaps;for(let Or=0;Or<zn.length;Or++){const qr=zn[Or];Gt.format!==nv?yr!==null?oi?s.compressedTexSubImage2D(34069+ir,Or,0,0,qr.width,qr.height,yr,qr.data):s.compressedTexImage2D(34069+ir,Or,dr,qr.width,qr.height,0,qr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):oi?s.texSubImage2D(34069+ir,Or,0,0,qr.width,qr.height,yr,kr,qr.data):s.texImage2D(34069+ir,Or,dr,qr.width,qr.height,0,yr,kr,qr.data)}}}else{zn=Gt.mipmaps,oi&&Ur&&(zn.length>0&&Xr++,s.texStorage2D(34067,Xr,dr,On[0].width,On[0].height));for(let ir=0;ir<6;ir++)if(Dt){oi?s.texSubImage2D(34069+ir,0,0,0,On[ir].width,On[ir].height,yr,kr,On[ir].data):s.texImage2D(34069+ir,0,dr,On[ir].width,On[ir].height,0,yr,kr,On[ir].data);for(let Or=0;Or<zn.length;Or++){const Kr=zn[Or].image[ir].image;oi?s.texSubImage2D(34069+ir,Or+1,0,0,Kr.width,Kr.height,yr,kr,Kr.data):s.texImage2D(34069+ir,Or+1,dr,Kr.width,Kr.height,0,yr,kr,Kr.data)}}else{oi?s.texSubImage2D(34069+ir,0,0,0,yr,kr,On[ir]):s.texImage2D(34069+ir,0,dr,yr,kr,On[ir]);for(let Or=0;Or<zn.length;Or++){const qr=zn[Or];oi?s.texSubImage2D(34069+ir,Or+1,0,0,yr,kr,qr.image[ir]):s.texImage2D(34069+ir,Or+1,dr,yr,kr,qr.image[ir])}}}ye(Gt,ar)&&_e(34067),en.__version=Vt.version,Gt.onUpdate&&Gt.onUpdate(Gt)}on.__version=Gt.version}function Ve(on,Gt,Hn,Kt,Vt){const en=c.convert(Hn.format,Hn.encoding),Vn=c.convert(Hn.type),Dt=pe(Hn.internalFormat,en,Vn,Hn.encoding);a.get(Gt).__hasExternalTextures||(Vt===32879||Vt===35866?s.texImage3D(Vt,0,Dt,Gt.width,Gt.height,Gt.depth,0,en,Vn,null):s.texImage2D(Vt,0,Dt,Gt.width,Gt.height,0,en,Vn,null)),s.bindFramebuffer(36160,on),Ce(Gt)?R.framebufferTexture2DMultisampleEXT(36160,Kt,Vt,a.get(Hn).__webglTexture,0,Qn(Gt)):(Vt===3553||Vt>=34069&&Vt<=34074)&&h.framebufferTexture2D(36160,Kt,Vt,a.get(Hn).__webglTexture,0),s.bindFramebuffer(36160,null)}function Ye(on,Gt,Hn){if(h.bindRenderbuffer(36161,on),Gt.depthBuffer&&!Gt.stencilBuffer){let Kt=33189;if(Hn||Ce(Gt)){const Vt=Gt.depthTexture;Vt&&Vt.isDepthTexture&&(Vt.type===sw?Kt=36012:Vt.type===aw&&(Kt=33190));const en=Qn(Gt);Ce(Gt)?R.renderbufferStorageMultisampleEXT(36161,en,Kt,Gt.width,Gt.height):h.renderbufferStorageMultisample(36161,en,Kt,Gt.width,Gt.height)}else h.renderbufferStorage(36161,Kt,Gt.width,Gt.height);h.framebufferRenderbuffer(36160,36096,36161,on)}else if(Gt.depthBuffer&&Gt.stencilBuffer){const Kt=Qn(Gt);Hn&&Ce(Gt)===!1?h.renderbufferStorageMultisample(36161,Kt,35056,Gt.width,Gt.height):Ce(Gt)?R.renderbufferStorageMultisampleEXT(36161,Kt,35056,Gt.width,Gt.height):h.renderbufferStorage(36161,34041,Gt.width,Gt.height),h.framebufferRenderbuffer(36160,33306,36161,on)}else{const Kt=Gt.isWebGLMultipleRenderTargets===!0?Gt.texture:[Gt.texture];for(let Vt=0;Vt<Kt.length;Vt++){const en=Kt[Vt],Vn=c.convert(en.format,en.encoding),Dt=c.convert(en.type),On=pe(en.internalFormat,Vn,Dt,en.encoding),or=Qn(Gt);Hn&&Ce(Gt)===!1?h.renderbufferStorageMultisample(36161,or,On,Gt.width,Gt.height):Ce(Gt)?R.renderbufferStorageMultisampleEXT(36161,or,On,Gt.width,Gt.height):h.renderbufferStorage(36161,On,Gt.width,Gt.height)}}h.bindRenderbuffer(36161,null)}function $e(on,Gt){if(Gt&&Gt.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(s.bindFramebuffer(36160,on),!(Gt.depthTexture&&Gt.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!a.get(Gt.depthTexture).__webglTexture||Gt.depthTexture.image.width!==Gt.width||Gt.depthTexture.image.height!==Gt.height)&&(Gt.depthTexture.image.width=Gt.width,Gt.depthTexture.image.height=Gt.height,Gt.depthTexture.needsUpdate=!0),Ft(Gt.depthTexture,0);const Kt=a.get(Gt.depthTexture).__webglTexture,Vt=Qn(Gt);if(Gt.depthTexture.format===lw)Ce(Gt)?R.framebufferTexture2DMultisampleEXT(36160,36096,3553,Kt,0,Vt):h.framebufferTexture2D(36160,36096,3553,Kt,0);else if(Gt.depthTexture.format===p_)Ce(Gt)?R.framebufferTexture2DMultisampleEXT(36160,33306,3553,Kt,0,Vt):h.framebufferTexture2D(36160,33306,3553,Kt,0);else throw new Error("Unknown depthTexture format")}function ft(on){const Gt=a.get(on),Hn=on.isWebGLCubeRenderTarget===!0;if(on.depthTexture&&!Gt.__autoAllocateDepthBuffer){if(Hn)throw new Error("target.depthTexture not supported in Cube render targets");$e(Gt.__webglFramebuffer,on)}else if(Hn){Gt.__webglDepthbuffer=[];for(let Kt=0;Kt<6;Kt++)s.bindFramebuffer(36160,Gt.__webglFramebuffer[Kt]),Gt.__webglDepthbuffer[Kt]=h.createRenderbuffer(),Ye(Gt.__webglDepthbuffer[Kt],on,!1)}else s.bindFramebuffer(36160,Gt.__webglFramebuffer),Gt.__webglDepthbuffer=h.createRenderbuffer(),Ye(Gt.__webglDepthbuffer,on,!1);s.bindFramebuffer(36160,null)}function $t(on,Gt,Hn){const Kt=a.get(on);Gt!==void 0&&Ve(Kt.__webglFramebuffer,on,on.texture,36064,3553),Hn!==void 0&&ft(on)}function Jt(on){const Gt=on.texture,Hn=a.get(on),Kt=a.get(Gt);on.addEventListener("dispose",It),on.isWebGLMultipleRenderTargets!==!0&&(Kt.__webglTexture===void 0&&(Kt.__webglTexture=h.createTexture()),Kt.__version=Gt.version,S.memory.textures++);const Vt=on.isWebGLCubeRenderTarget===!0,en=on.isWebGLMultipleRenderTargets===!0,Vn=ae(on)||E;if(Vt){Hn.__webglFramebuffer=[];for(let Dt=0;Dt<6;Dt++)Hn.__webglFramebuffer[Dt]=h.createFramebuffer()}else{if(Hn.__webglFramebuffer=h.createFramebuffer(),en)if(r.drawBuffers){const Dt=on.texture;for(let On=0,or=Dt.length;On<or;On++){const ar=a.get(Dt[On]);ar.__webglTexture===void 0&&(ar.__webglTexture=h.createTexture(),S.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(E&&on.samples>0&&Ce(on)===!1){const Dt=en?Gt:[Gt];Hn.__webglMultisampledFramebuffer=h.createFramebuffer(),Hn.__webglColorRenderbuffer=[],s.bindFramebuffer(36160,Hn.__webglMultisampledFramebuffer);for(let On=0;On<Dt.length;On++){const or=Dt[On];Hn.__webglColorRenderbuffer[On]=h.createRenderbuffer(),h.bindRenderbuffer(36161,Hn.__webglColorRenderbuffer[On]);const ar=c.convert(or.format,or.encoding),yr=c.convert(or.type),kr=pe(or.internalFormat,ar,yr,or.encoding,on.isXRRenderTarget===!0),dr=Qn(on);h.renderbufferStorageMultisample(36161,dr,kr,on.width,on.height),h.framebufferRenderbuffer(36160,36064+On,36161,Hn.__webglColorRenderbuffer[On])}h.bindRenderbuffer(36161,null),on.depthBuffer&&(Hn.__webglDepthRenderbuffer=h.createRenderbuffer(),Ye(Hn.__webglDepthRenderbuffer,on,!0)),s.bindFramebuffer(36160,null)}}if(Vt){s.bindTexture(34067,Kt.__webglTexture),Xt(34067,Gt,Vn);for(let Dt=0;Dt<6;Dt++)Ve(Hn.__webglFramebuffer[Dt],on,Gt,36064,34069+Dt);ye(Gt,Vn)&&_e(34067),s.unbindTexture()}else if(en){const Dt=on.texture;for(let On=0,or=Dt.length;On<or;On++){const ar=Dt[On],yr=a.get(ar);s.bindTexture(3553,yr.__webglTexture),Xt(3553,ar,Vn),Ve(Hn.__webglFramebuffer,on,ar,36064+On,3553),ye(ar,Vn)&&_e(3553)}s.unbindTexture()}else{let Dt=3553;(on.isWebGL3DRenderTarget||on.isWebGLArrayRenderTarget)&&(E?Dt=on.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),s.bindTexture(Dt,Kt.__webglTexture),Xt(Dt,Gt,Vn),Ve(Hn.__webglFramebuffer,on,Gt,36064,Dt),ye(Gt,Vn)&&_e(Dt),s.unbindTexture()}on.depthBuffer&&ft(on)}function Pn(on){const Gt=ae(on)||E,Hn=on.isWebGLMultipleRenderTargets===!0?on.texture:[on.texture];for(let Kt=0,Vt=Hn.length;Kt<Vt;Kt++){const en=Hn[Kt];if(ye(en,Gt)){const Vn=on.isWebGLCubeRenderTarget?34067:3553,Dt=a.get(en).__webglTexture;s.bindTexture(Vn,Dt),_e(Vn),s.unbindTexture()}}}function An(on){if(E&&on.samples>0&&Ce(on)===!1){const Gt=on.isWebGLMultipleRenderTargets?on.texture:[on.texture],Hn=on.width,Kt=on.height;let Vt=16384;const en=[],Vn=on.stencilBuffer?33306:36096,Dt=a.get(on),On=on.isWebGLMultipleRenderTargets===!0;if(On)for(let or=0;or<Gt.length;or++)s.bindFramebuffer(36160,Dt.__webglMultisampledFramebuffer),h.framebufferRenderbuffer(36160,36064+or,36161,null),s.bindFramebuffer(36160,Dt.__webglFramebuffer),h.framebufferTexture2D(36009,36064+or,3553,null,0);s.bindFramebuffer(36008,Dt.__webglMultisampledFramebuffer),s.bindFramebuffer(36009,Dt.__webglFramebuffer);for(let or=0;or<Gt.length;or++){en.push(36064+or),on.depthBuffer&&en.push(Vn);const ar=Dt.__ignoreDepthValues!==void 0?Dt.__ignoreDepthValues:!1;if(ar===!1&&(on.depthBuffer&&(Vt|=256),on.stencilBuffer&&(Vt|=1024)),On&&h.framebufferRenderbuffer(36008,36064,36161,Dt.__webglColorRenderbuffer[or]),ar===!0&&(h.invalidateFramebuffer(36008,[Vn]),h.invalidateFramebuffer(36009,[Vn])),On){const yr=a.get(Gt[or]).__webglTexture;h.framebufferTexture2D(36009,36064,3553,yr,0)}h.blitFramebuffer(0,0,Hn,Kt,0,0,Hn,Kt,Vt,9728),W&&h.invalidateFramebuffer(36008,en)}if(s.bindFramebuffer(36008,null),s.bindFramebuffer(36009,null),On)for(let or=0;or<Gt.length;or++){s.bindFramebuffer(36160,Dt.__webglMultisampledFramebuffer),h.framebufferRenderbuffer(36160,36064+or,36161,Dt.__webglColorRenderbuffer[or]);const ar=a.get(Gt[or]).__webglTexture;s.bindFramebuffer(36160,Dt.__webglFramebuffer),h.framebufferTexture2D(36009,36064+or,3553,ar,0)}s.bindFramebuffer(36009,Dt.__webglMultisampledFramebuffer)}}function Qn(on){return Math.min(D,on.samples)}function Ce(on){const Gt=a.get(on);return E&&on.samples>0&&i.has("WEBGL_multisampled_render_to_texture")===!0&&Gt.__useRenderToTexture!==!1}function sr(on){const Gt=S.render.frame;j.get(on)!==Gt&&(j.set(on,Gt),on.update())}function Mr(on,Gt){const Hn=on.encoding,Kt=on.format,Vt=on.type;return on.isCompressedTexture===!0||on.isVideoTexture===!0||on.format===NR||Hn!==bw&&(Hn===iu?E===!1?i.has("EXT_sRGB")===!0&&Kt===nv?(on.format=NR,on.minFilter=Np,on.generateMipmaps=!1):Gt=_q.sRGBToLinear(Gt):(Kt!==nv||Vt!==yw)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",Hn)),Gt}this.allocateTextureUnit=ze,this.resetTextureUnits=Ot,this.setTexture2D=Ft,this.setTexture2DArray=pt,this.setTexture3D=vt,this.setTextureCube=rn,this.rebindTextures=$t,this.setupRenderTarget=Jt,this.updateRenderTargetMipmap=Pn,this.updateMultisampleRenderTarget=An,this.setupDepthRenderbuffer=ft,this.setupFrameBufferTexture=Ve,this.useMultisampledRTT=Ce}function fpe(h,i,s){const a=s.isWebGL2;function r(c,S=null){let E;if(c===yw)return 5121;if(c===rce)return 32819;if(c===ice)return 32820;if(c===ece)return 5120;if(c===tce)return 5122;if(c===bq)return 5123;if(c===nce)return 5124;if(c===aw)return 5125;if(c===sw)return 5126;if(c===uC)return a?5131:(E=i.get("OES_texture_half_float"),E!==null?E.HALF_FLOAT_OES:null);if(c===oce)return 6406;if(c===nv)return 6408;if(c===sce)return 6409;if(c===uce)return 6410;if(c===lw)return 6402;if(c===p_)return 34041;if(c===ace)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(c===NR)return E=i.get("EXT_sRGB"),E!==null?E.SRGB_ALPHA_EXT:null;if(c===cce)return 6403;if(c===lce)return 36244;if(c===fce)return 33319;if(c===dce)return 33320;if(c===hce)return 36249;if(c===KI||c===YI||c===JI||c===QI)if(S===iu)if(E=i.get("WEBGL_compressed_texture_s3tc_srgb"),E!==null){if(c===KI)return E.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(c===YI)return E.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(c===JI)return E.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(c===QI)return E.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(E=i.get("WEBGL_compressed_texture_s3tc"),E!==null){if(c===KI)return E.COMPRESSED_RGB_S3TC_DXT1_EXT;if(c===YI)return E.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(c===JI)return E.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(c===QI)return E.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(c===OW||c===TW||c===MW||c===DW)if(E=i.get("WEBGL_compressed_texture_pvrtc"),E!==null){if(c===OW)return E.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(c===TW)return E.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(c===MW)return E.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(c===DW)return E.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(c===pce)return E=i.get("WEBGL_compressed_texture_etc1"),E!==null?E.COMPRESSED_RGB_ETC1_WEBGL:null;if(c===NW||c===IW)if(E=i.get("WEBGL_compressed_texture_etc"),E!==null){if(c===NW)return S===iu?E.COMPRESSED_SRGB8_ETC2:E.COMPRESSED_RGB8_ETC2;if(c===IW)return S===iu?E.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:E.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(c===FW||c===RW||c===PW||c===LW||c===BW||c===jW||c===zW||c===UW||c===WW||c===VW||c===HW||c===GW||c===qW||c===$W)if(E=i.get("WEBGL_compressed_texture_astc"),E!==null){if(c===FW)return S===iu?E.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:E.COMPRESSED_RGBA_ASTC_4x4_KHR;if(c===RW)return S===iu?E.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:E.COMPRESSED_RGBA_ASTC_5x4_KHR;if(c===PW)return S===iu?E.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:E.COMPRESSED_RGBA_ASTC_5x5_KHR;if(c===LW)return S===iu?E.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:E.COMPRESSED_RGBA_ASTC_6x5_KHR;if(c===BW)return S===iu?E.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:E.COMPRESSED_RGBA_ASTC_6x6_KHR;if(c===jW)return S===iu?E.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:E.COMPRESSED_RGBA_ASTC_8x5_KHR;if(c===zW)return S===iu?E.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:E.COMPRESSED_RGBA_ASTC_8x6_KHR;if(c===UW)return S===iu?E.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:E.COMPRESSED_RGBA_ASTC_8x8_KHR;if(c===WW)return S===iu?E.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:E.COMPRESSED_RGBA_ASTC_10x5_KHR;if(c===VW)return S===iu?E.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:E.COMPRESSED_RGBA_ASTC_10x6_KHR;if(c===HW)return S===iu?E.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:E.COMPRESSED_RGBA_ASTC_10x8_KHR;if(c===GW)return S===iu?E.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:E.COMPRESSED_RGBA_ASTC_10x10_KHR;if(c===qW)return S===iu?E.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:E.COMPRESSED_RGBA_ASTC_12x10_KHR;if(c===$W)return S===iu?E.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:E.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(c===XW)if(E=i.get("EXT_texture_compression_bptc"),E!==null){if(c===XW)return S===iu?E.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:E.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return c===i_?a?34042:(E=i.get("WEBGL_depth_texture"),E!==null?E.UNSIGNED_INT_24_8_WEBGL:null):h[c]!==void 0?h[c]:null}return{convert:r}}class dpe extends Hg{constructor(i=[]){super(),this.isArrayCamera=!0,this.cameras=i}}class mO extends ld{constructor(){super(),this.isGroup=!0,this.type="Group"}}const hpe={type:"move"};class CF{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new mO,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new mO,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new cr,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new cr),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new mO,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new cr,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new cr),this._grip}dispatchEvent(i){return this._targetRay!==null&&this._targetRay.dispatchEvent(i),this._grip!==null&&this._grip.dispatchEvent(i),this._hand!==null&&this._hand.dispatchEvent(i),this}connect(i){if(i&&i.hand){const s=this._hand;if(s)for(const a of i.hand.values())this._getHandJoint(s,a)}return this.dispatchEvent({type:"connected",data:i}),this}disconnect(i){return this.dispatchEvent({type:"disconnected",data:i}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(i,s,a){let r=null,c=null,S=null;const E=this._targetRay,A=this._grip,U=this._hand;if(i&&s.session.visibilityState!=="visible-blurred"){if(U&&i.hand){S=!0;for(const H of i.hand.values()){const I=s.getJointPose(H,a),Q=this._getHandJoint(U,H);I!==null&&(Q.matrix.fromArray(I.transform.matrix),Q.matrix.decompose(Q.position,Q.rotation,Q.scale),Q.jointRadius=I.radius),Q.visible=I!==null}const B=U.joints["index-finger-tip"],D=U.joints["thumb-tip"],R=B.position.distanceTo(D.position),W=.02,j=.005;U.inputState.pinching&&R>W+j?(U.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:i.handedness,target:this})):!U.inputState.pinching&&R<=W-j&&(U.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:i.handedness,target:this}))}else A!==null&&i.gripSpace&&(c=s.getPose(i.gripSpace,a),c!==null&&(A.matrix.fromArray(c.transform.matrix),A.matrix.decompose(A.position,A.rotation,A.scale),c.linearVelocity?(A.hasLinearVelocity=!0,A.linearVelocity.copy(c.linearVelocity)):A.hasLinearVelocity=!1,c.angularVelocity?(A.hasAngularVelocity=!0,A.angularVelocity.copy(c.angularVelocity)):A.hasAngularVelocity=!1));E!==null&&(r=s.getPose(i.targetRaySpace,a),r===null&&c!==null&&(r=c),r!==null&&(E.matrix.fromArray(r.transform.matrix),E.matrix.decompose(E.position,E.rotation,E.scale),r.linearVelocity?(E.hasLinearVelocity=!0,E.linearVelocity.copy(r.linearVelocity)):E.hasLinearVelocity=!1,r.angularVelocity?(E.hasAngularVelocity=!0,E.angularVelocity.copy(r.angularVelocity)):E.hasAngularVelocity=!1,this.dispatchEvent(hpe)))}return E!==null&&(E.visible=r!==null),A!==null&&(A.visible=c!==null),U!==null&&(U.visible=S!==null),this}_getHandJoint(i,s){if(i.joints[s.jointName]===void 0){const a=new mO;a.matrixAutoUpdate=!1,a.visible=!1,i.joints[s.jointName]=a,i.add(a)}return i.joints[s.jointName]}}class ppe extends jp{constructor(i,s,a,r,c,S,E,A,U,B){if(B=B!==void 0?B:lw,B!==lw&&B!==p_)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");a===void 0&&B===lw&&(a=aw),a===void 0&&B===p_&&(a=i_),super(null,r,c,S,E,A,B,a,U),this.isDepthTexture=!0,this.image={width:i,height:s},this.magFilter=E!==void 0?E:wh,this.minFilter=A!==void 0?A:wh,this.flipY=!1,this.generateMipmaps=!1}}class mpe extends rx{constructor(i,s){super();const a=this;let r=null,c=1,S=null,E="local-floor",A=null,U=null,B=null,D=null,R=null,W=null;const j=s.getContextAttributes();let H=null,I=null;const Q=[],Y=[],q=new Set,ae=new Map,oe=new Hg;oe.layers.enable(1),oe.viewport=new wu;const ye=new Hg;ye.layers.enable(2),ye.viewport=new wu;const _e=[oe,ye],pe=new dpe;pe.layers.enable(1),pe.layers.enable(2);let me=null,Ge=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(pt){let vt=Q[pt];return vt===void 0&&(vt=new CF,Q[pt]=vt),vt.getTargetRaySpace()},this.getControllerGrip=function(pt){let vt=Q[pt];return vt===void 0&&(vt=new CF,Q[pt]=vt),vt.getGripSpace()},this.getHand=function(pt){let vt=Q[pt];return vt===void 0&&(vt=new CF,Q[pt]=vt),vt.getHandSpace()};function lt(pt){const vt=Y.indexOf(pt.inputSource);if(vt===-1)return;const rn=Q[vt];rn!==void 0&&rn.dispatchEvent({type:pt.type,data:pt.inputSource})}function It(){r.removeEventListener("select",lt),r.removeEventListener("selectstart",lt),r.removeEventListener("selectend",lt),r.removeEventListener("squeeze",lt),r.removeEventListener("squeezestart",lt),r.removeEventListener("squeezeend",lt),r.removeEventListener("end",It),r.removeEventListener("inputsourceschange",wt);for(let pt=0;pt<Q.length;pt++){const vt=Y[pt];vt!==null&&(Y[pt]=null,Q[pt].disconnect(vt))}me=null,Ge=null,i.setRenderTarget(H),R=null,D=null,B=null,r=null,I=null,Ft.stop(),a.isPresenting=!1,a.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(pt){c=pt,a.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(pt){E=pt,a.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return A||S},this.setReferenceSpace=function(pt){A=pt},this.getBaseLayer=function(){return D!==null?D:R},this.getBinding=function(){return B},this.getFrame=function(){return W},this.getSession=function(){return r},this.setSession=async function(pt){if(r=pt,r!==null){if(H=i.getRenderTarget(),r.addEventListener("select",lt),r.addEventListener("selectstart",lt),r.addEventListener("selectend",lt),r.addEventListener("squeeze",lt),r.addEventListener("squeezestart",lt),r.addEventListener("squeezeend",lt),r.addEventListener("end",It),r.addEventListener("inputsourceschange",wt),j.xrCompatible!==!0&&await s.makeXRCompatible(),r.renderState.layers===void 0||i.capabilities.isWebGL2===!1){const vt={antialias:r.renderState.layers===void 0?j.antialias:!0,alpha:j.alpha,depth:j.depth,stencil:j.stencil,framebufferScaleFactor:c};R=new XRWebGLLayer(r,s,vt),r.updateRenderState({baseLayer:R}),I=new xw(R.framebufferWidth,R.framebufferHeight,{format:nv,type:yw,encoding:i.outputEncoding,stencilBuffer:j.stencil})}else{let vt=null,rn=null,xt=null;j.depth&&(xt=j.stencil?35056:33190,vt=j.stencil?p_:lw,rn=j.stencil?i_:aw);const _t={colorFormat:32856,depthFormat:xt,scaleFactor:c};B=new XRWebGLBinding(r,s),D=B.createProjectionLayer(_t),r.updateRenderState({layers:[D]}),I=new xw(D.textureWidth,D.textureHeight,{format:nv,type:yw,depthTexture:new ppe(D.textureWidth,D.textureHeight,rn,void 0,void 0,void 0,void 0,void 0,void 0,vt),stencilBuffer:j.stencil,encoding:i.outputEncoding,samples:j.antialias?4:0});const Xt=i.properties.get(I);Xt.__ignoreDepthValues=D.ignoreDepthValues}I.isXRRenderTarget=!0,this.setFoveation(1),A=null,S=await r.requestReferenceSpace(E),Ft.setContext(r),Ft.start(),a.isPresenting=!0,a.dispatchEvent({type:"sessionstart"})}};function wt(pt){for(let vt=0;vt<pt.removed.length;vt++){const rn=pt.removed[vt],xt=Y.indexOf(rn);xt>=0&&(Y[xt]=null,Q[xt].disconnect(rn))}for(let vt=0;vt<pt.added.length;vt++){const rn=pt.added[vt];let xt=Y.indexOf(rn);if(xt===-1){for(let Xt=0;Xt<Q.length;Xt++)if(Xt>=Y.length){Y.push(rn),xt=Xt;break}else if(Y[Xt]===null){Y[Xt]=rn,xt=Xt;break}if(xt===-1)break}const _t=Q[xt];_t&&_t.connect(rn)}}const we=new cr,yt=new cr;function Bt(pt,vt,rn){we.setFromMatrixPosition(vt.matrixWorld),yt.setFromMatrixPosition(rn.matrixWorld);const xt=we.distanceTo(yt),_t=vt.projectionMatrix.elements,Xt=rn.projectionMatrix.elements,sn=_t[14]/(_t[10]-1),kn=_t[14]/(_t[10]+1),an=(_t[9]+1)/_t[5],Ve=(_t[9]-1)/_t[5],Ye=(_t[8]-1)/_t[0],$e=(Xt[8]+1)/Xt[0],ft=sn*Ye,$t=sn*$e,Jt=xt/(-Ye+$e),Pn=Jt*-Ye;vt.matrixWorld.decompose(pt.position,pt.quaternion,pt.scale),pt.translateX(Pn),pt.translateZ(Jt),pt.matrixWorld.compose(pt.position,pt.quaternion,pt.scale),pt.matrixWorldInverse.copy(pt.matrixWorld).invert();const An=sn+Jt,Qn=kn+Jt,Ce=ft-Pn,sr=$t+(xt-Pn),Mr=an*kn/Qn*An,on=Ve*kn/Qn*An;pt.projectionMatrix.makePerspective(Ce,sr,Mr,on,An,Qn)}function Ot(pt,vt){vt===null?pt.matrixWorld.copy(pt.matrix):pt.matrixWorld.multiplyMatrices(vt.matrixWorld,pt.matrix),pt.matrixWorldInverse.copy(pt.matrixWorld).invert()}this.updateCamera=function(pt){if(r===null)return;pe.near=ye.near=oe.near=pt.near,pe.far=ye.far=oe.far=pt.far,(me!==pe.near||Ge!==pe.far)&&(r.updateRenderState({depthNear:pe.near,depthFar:pe.far}),me=pe.near,Ge=pe.far);const vt=pt.parent,rn=pe.cameras;Ot(pe,vt);for(let _t=0;_t<rn.length;_t++)Ot(rn[_t],vt);pe.matrixWorld.decompose(pe.position,pe.quaternion,pe.scale),pt.matrix.copy(pe.matrix),pt.matrix.decompose(pt.position,pt.quaternion,pt.scale);const xt=pt.children;for(let _t=0,Xt=xt.length;_t<Xt;_t++)xt[_t].updateMatrixWorld(!0);rn.length===2?Bt(pe,oe,ye):pe.projectionMatrix.copy(oe.projectionMatrix)},this.getCamera=function(){return pe},this.getFoveation=function(){if(D!==null)return D.fixedFoveation;if(R!==null)return R.fixedFoveation},this.setFoveation=function(pt){D!==null&&(D.fixedFoveation=pt),R!==null&&R.fixedFoveation!==void 0&&(R.fixedFoveation=pt)},this.getPlanes=function(){return q};let ze=null;function Ut(pt,vt){if(U=vt.getViewerPose(A||S),W=vt,U!==null){const rn=U.views;R!==null&&(i.setRenderTargetFramebuffer(I,R.framebuffer),i.setRenderTarget(I));let xt=!1;rn.length!==pe.cameras.length&&(pe.cameras.length=0,xt=!0);for(let _t=0;_t<rn.length;_t++){const Xt=rn[_t];let sn=null;if(R!==null)sn=R.getViewport(Xt);else{const an=B.getViewSubImage(D,Xt);sn=an.viewport,_t===0&&(i.setRenderTargetTextures(I,an.colorTexture,D.ignoreDepthValues?void 0:an.depthStencilTexture),i.setRenderTarget(I))}let kn=_e[_t];kn===void 0&&(kn=new Hg,kn.layers.enable(_t),kn.viewport=new wu,_e[_t]=kn),kn.matrix.fromArray(Xt.transform.matrix),kn.projectionMatrix.fromArray(Xt.projectionMatrix),kn.viewport.set(sn.x,sn.y,sn.width,sn.height),_t===0&&pe.matrix.copy(kn.matrix),xt===!0&&pe.cameras.push(kn)}}for(let rn=0;rn<Q.length;rn++){const xt=Y[rn],_t=Q[rn];xt!==null&&_t!==void 0&&_t.update(xt,vt,A||S)}if(ze&&ze(pt,vt),vt.detectedPlanes){a.dispatchEvent({type:"planesdetected",data:vt.detectedPlanes});let rn=null;for(const xt of q)vt.detectedPlanes.has(xt)||(rn===null&&(rn=[]),rn.push(xt));if(rn!==null)for(const xt of rn)q.delete(xt),ae.delete(xt),a.dispatchEvent({type:"planeremoved",data:xt});for(const xt of vt.detectedPlanes)if(!q.has(xt))q.add(xt),ae.set(xt,vt.lastChangedTime),a.dispatchEvent({type:"planeadded",data:xt});else{const _t=ae.get(xt);xt.lastChangedTime>_t&&(ae.set(xt,xt.lastChangedTime),a.dispatchEvent({type:"planechanged",data:xt}))}}W=null}const Ft=new Nq;Ft.setAnimationLoop(Ut),this.setAnimationLoop=function(pt){ze=pt},this.dispose=function(){}}}function gpe(h,i){function s(H,I){I.color.getRGB(H.fogColor.value,Tq(h)),I.isFog?(H.fogNear.value=I.near,H.fogFar.value=I.far):I.isFogExp2&&(H.fogDensity.value=I.density)}function a(H,I,Q,Y,q){I.isMeshBasicMaterial||I.isMeshLambertMaterial?r(H,I):I.isMeshToonMaterial?(r(H,I),B(H,I)):I.isMeshPhongMaterial?(r(H,I),U(H,I)):I.isMeshStandardMaterial?(r(H,I),D(H,I),I.isMeshPhysicalMaterial&&R(H,I,q)):I.isMeshMatcapMaterial?(r(H,I),W(H,I)):I.isMeshDepthMaterial?r(H,I):I.isMeshDistanceMaterial?(r(H,I),j(H,I)):I.isMeshNormalMaterial?r(H,I):I.isLineBasicMaterial?(c(H,I),I.isLineDashedMaterial&&S(H,I)):I.isPointsMaterial?E(H,I,Q,Y):I.isSpriteMaterial?A(H,I):I.isShadowMaterial?(H.color.value.copy(I.color),H.opacity.value=I.opacity):I.isShaderMaterial&&(I.uniformsNeedUpdate=!1)}function r(H,I){H.opacity.value=I.opacity,I.color&&H.diffuse.value.copy(I.color),I.emissive&&H.emissive.value.copy(I.emissive).multiplyScalar(I.emissiveIntensity),I.map&&(H.map.value=I.map),I.alphaMap&&(H.alphaMap.value=I.alphaMap),I.bumpMap&&(H.bumpMap.value=I.bumpMap,H.bumpScale.value=I.bumpScale,I.side===$g&&(H.bumpScale.value*=-1)),I.displacementMap&&(H.displacementMap.value=I.displacementMap,H.displacementScale.value=I.displacementScale,H.displacementBias.value=I.displacementBias),I.emissiveMap&&(H.emissiveMap.value=I.emissiveMap),I.normalMap&&(H.normalMap.value=I.normalMap,H.normalScale.value.copy(I.normalScale),I.side===$g&&H.normalScale.value.negate()),I.specularMap&&(H.specularMap.value=I.specularMap),I.alphaTest>0&&(H.alphaTest.value=I.alphaTest);const Q=i.get(I).envMap;if(Q&&(H.envMap.value=Q,H.flipEnvMap.value=Q.isCubeTexture&&Q.isRenderTargetTexture===!1?-1:1,H.reflectivity.value=I.reflectivity,H.ior.value=I.ior,H.refractionRatio.value=I.refractionRatio),I.lightMap){H.lightMap.value=I.lightMap;const ae=h.physicallyCorrectLights!==!0?Math.PI:1;H.lightMapIntensity.value=I.lightMapIntensity*ae}I.aoMap&&(H.aoMap.value=I.aoMap,H.aoMapIntensity.value=I.aoMapIntensity);let Y;I.map?Y=I.map:I.specularMap?Y=I.specularMap:I.displacementMap?Y=I.displacementMap:I.normalMap?Y=I.normalMap:I.bumpMap?Y=I.bumpMap:I.roughnessMap?Y=I.roughnessMap:I.metalnessMap?Y=I.metalnessMap:I.alphaMap?Y=I.alphaMap:I.emissiveMap?Y=I.emissiveMap:I.clearcoatMap?Y=I.clearcoatMap:I.clearcoatNormalMap?Y=I.clearcoatNormalMap:I.clearcoatRoughnessMap?Y=I.clearcoatRoughnessMap:I.iridescenceMap?Y=I.iridescenceMap:I.iridescenceThicknessMap?Y=I.iridescenceThicknessMap:I.specularIntensityMap?Y=I.specularIntensityMap:I.specularColorMap?Y=I.specularColorMap:I.transmissionMap?Y=I.transmissionMap:I.thicknessMap?Y=I.thicknessMap:I.sheenColorMap?Y=I.sheenColorMap:I.sheenRoughnessMap&&(Y=I.sheenRoughnessMap),Y!==void 0&&(Y.isWebGLRenderTarget&&(Y=Y.texture),Y.matrixAutoUpdate===!0&&Y.updateMatrix(),H.uvTransform.value.copy(Y.matrix));let q;I.aoMap?q=I.aoMap:I.lightMap&&(q=I.lightMap),q!==void 0&&(q.isWebGLRenderTarget&&(q=q.texture),q.matrixAutoUpdate===!0&&q.updateMatrix(),H.uv2Transform.value.copy(q.matrix))}function c(H,I){H.diffuse.value.copy(I.color),H.opacity.value=I.opacity}function S(H,I){H.dashSize.value=I.dashSize,H.totalSize.value=I.dashSize+I.gapSize,H.scale.value=I.scale}function E(H,I,Q,Y){H.diffuse.value.copy(I.color),H.opacity.value=I.opacity,H.size.value=I.size*Q,H.scale.value=Y*.5,I.map&&(H.map.value=I.map),I.alphaMap&&(H.alphaMap.value=I.alphaMap),I.alphaTest>0&&(H.alphaTest.value=I.alphaTest);let q;I.map?q=I.map:I.alphaMap&&(q=I.alphaMap),q!==void 0&&(q.matrixAutoUpdate===!0&&q.updateMatrix(),H.uvTransform.value.copy(q.matrix))}function A(H,I){H.diffuse.value.copy(I.color),H.opacity.value=I.opacity,H.rotation.value=I.rotation,I.map&&(H.map.value=I.map),I.alphaMap&&(H.alphaMap.value=I.alphaMap),I.alphaTest>0&&(H.alphaTest.value=I.alphaTest);let Q;I.map?Q=I.map:I.alphaMap&&(Q=I.alphaMap),Q!==void 0&&(Q.matrixAutoUpdate===!0&&Q.updateMatrix(),H.uvTransform.value.copy(Q.matrix))}function U(H,I){H.specular.value.copy(I.specular),H.shininess.value=Math.max(I.shininess,1e-4)}function B(H,I){I.gradientMap&&(H.gradientMap.value=I.gradientMap)}function D(H,I){H.roughness.value=I.roughness,H.metalness.value=I.metalness,I.roughnessMap&&(H.roughnessMap.value=I.roughnessMap),I.metalnessMap&&(H.metalnessMap.value=I.metalnessMap),i.get(I).envMap&&(H.envMapIntensity.value=I.envMapIntensity)}function R(H,I,Q){H.ior.value=I.ior,I.sheen>0&&(H.sheenColor.value.copy(I.sheenColor).multiplyScalar(I.sheen),H.sheenRoughness.value=I.sheenRoughness,I.sheenColorMap&&(H.sheenColorMap.value=I.sheenColorMap),I.sheenRoughnessMap&&(H.sheenRoughnessMap.value=I.sheenRoughnessMap)),I.clearcoat>0&&(H.clearcoat.value=I.clearcoat,H.clearcoatRoughness.value=I.clearcoatRoughness,I.clearcoatMap&&(H.clearcoatMap.value=I.clearcoatMap),I.clearcoatRoughnessMap&&(H.clearcoatRoughnessMap.value=I.clearcoatRoughnessMap),I.clearcoatNormalMap&&(H.clearcoatNormalScale.value.copy(I.clearcoatNormalScale),H.clearcoatNormalMap.value=I.clearcoatNormalMap,I.side===$g&&H.clearcoatNormalScale.value.negate())),I.iridescence>0&&(H.iridescence.value=I.iridescence,H.iridescenceIOR.value=I.iridescenceIOR,H.iridescenceThicknessMinimum.value=I.iridescenceThicknessRange[0],H.iridescenceThicknessMaximum.value=I.iridescenceThicknessRange[1],I.iridescenceMap&&(H.iridescenceMap.value=I.iridescenceMap),I.iridescenceThicknessMap&&(H.iridescenceThicknessMap.value=I.iridescenceThicknessMap)),I.transmission>0&&(H.transmission.value=I.transmission,H.transmissionSamplerMap.value=Q.texture,H.transmissionSamplerSize.value.set(Q.width,Q.height),I.transmissionMap&&(H.transmissionMap.value=I.transmissionMap),H.thickness.value=I.thickness,I.thicknessMap&&(H.thicknessMap.value=I.thicknessMap),H.attenuationDistance.value=I.attenuationDistance,H.attenuationColor.value.copy(I.attenuationColor)),H.specularIntensity.value=I.specularIntensity,H.specularColor.value.copy(I.specularColor),I.specularIntensityMap&&(H.specularIntensityMap.value=I.specularIntensityMap),I.specularColorMap&&(H.specularColorMap.value=I.specularColorMap)}function W(H,I){I.matcap&&(H.matcap.value=I.matcap)}function j(H,I){H.referencePosition.value.copy(I.referencePosition),H.nearDistance.value=I.nearDistance,H.farDistance.value=I.farDistance}return{refreshFogUniforms:s,refreshMaterialUniforms:a}}function vpe(h,i,s,a){let r={},c={},S=[];const E=s.isWebGL2?h.getParameter(35375):0;function A(Y,q){const ae=q.program;a.uniformBlockBinding(Y,ae)}function U(Y,q){let ae=r[Y.id];ae===void 0&&(j(Y),ae=B(Y),r[Y.id]=ae,Y.addEventListener("dispose",I));const oe=q.program;a.updateUBOMapping(Y,oe);const ye=i.render.frame;c[Y.id]!==ye&&(R(Y),c[Y.id]=ye)}function B(Y){const q=D();Y.__bindingPointIndex=q;const ae=h.createBuffer(),oe=Y.__size,ye=Y.usage;return h.bindBuffer(35345,ae),h.bufferData(35345,oe,ye),h.bindBuffer(35345,null),h.bindBufferBase(35345,q,ae),ae}function D(){for(let Y=0;Y<E;Y++)if(S.indexOf(Y)===-1)return S.push(Y),Y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function R(Y){const q=r[Y.id],ae=Y.uniforms,oe=Y.__cache;h.bindBuffer(35345,q);for(let ye=0,_e=ae.length;ye<_e;ye++){const pe=ae[ye];if(W(pe,ye,oe)===!0){const me=pe.__offset,Ge=Array.isArray(pe.value)?pe.value:[pe.value];let lt=0;for(let It=0;It<Ge.length;It++){const wt=Ge[It],we=H(wt);typeof wt=="number"?(pe.__data[0]=wt,h.bufferSubData(35345,me+lt,pe.__data)):wt.isMatrix3?(pe.__data[0]=wt.elements[0],pe.__data[1]=wt.elements[1],pe.__data[2]=wt.elements[2],pe.__data[3]=wt.elements[0],pe.__data[4]=wt.elements[3],pe.__data[5]=wt.elements[4],pe.__data[6]=wt.elements[5],pe.__data[7]=wt.elements[0],pe.__data[8]=wt.elements[6],pe.__data[9]=wt.elements[7],pe.__data[10]=wt.elements[8],pe.__data[11]=wt.elements[0]):(wt.toArray(pe.__data,lt),lt+=we.storage/Float32Array.BYTES_PER_ELEMENT)}h.bufferSubData(35345,me,pe.__data)}}h.bindBuffer(35345,null)}function W(Y,q,ae){const oe=Y.value;if(ae[q]===void 0){if(typeof oe=="number")ae[q]=oe;else{const ye=Array.isArray(oe)?oe:[oe],_e=[];for(let pe=0;pe<ye.length;pe++)_e.push(ye[pe].clone());ae[q]=_e}return!0}else if(typeof oe=="number"){if(ae[q]!==oe)return ae[q]=oe,!0}else{const ye=Array.isArray(ae[q])?ae[q]:[ae[q]],_e=Array.isArray(oe)?oe:[oe];for(let pe=0;pe<ye.length;pe++){const me=ye[pe];if(me.equals(_e[pe])===!1)return me.copy(_e[pe]),!0}}return!1}function j(Y){const q=Y.uniforms;let ae=0;const oe=16;let ye=0;for(let _e=0,pe=q.length;_e<pe;_e++){const me=q[_e],Ge={boundary:0,storage:0},lt=Array.isArray(me.value)?me.value:[me.value];for(let It=0,wt=lt.length;It<wt;It++){const we=lt[It],yt=H(we);Ge.boundary+=yt.boundary,Ge.storage+=yt.storage}if(me.__data=new Float32Array(Ge.storage/Float32Array.BYTES_PER_ELEMENT),me.__offset=ae,_e>0){ye=ae%oe;const It=oe-ye;ye!==0&&It-Ge.boundary<0&&(ae+=oe-ye,me.__offset=ae)}ae+=Ge.storage}return ye=ae%oe,ye>0&&(ae+=oe-ye),Y.__size=ae,Y.__cache={},this}function H(Y){const q={boundary:0,storage:0};return typeof Y=="number"?(q.boundary=4,q.storage=4):Y.isVector2?(q.boundary=8,q.storage=8):Y.isVector3||Y.isColor?(q.boundary=16,q.storage=12):Y.isVector4?(q.boundary=16,q.storage=16):Y.isMatrix3?(q.boundary=48,q.storage=48):Y.isMatrix4?(q.boundary=64,q.storage=64):Y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",Y),q}function I(Y){const q=Y.target;q.removeEventListener("dispose",I);const ae=S.indexOf(q.__bindingPointIndex);S.splice(ae,1),h.deleteBuffer(r[q.id]),delete r[q.id],delete c[q.id]}function Q(){for(const Y in r)h.deleteBuffer(r[Y]);S=[],r={},c={}}return{bind:A,update:U,dispose:Q}}function ype(){const h=iT("canvas");return h.style.display="block",h}function Lq(h={}){this.isWebGLRenderer=!0;const i=h.canvas!==void 0?h.canvas:ype(),s=h.context!==void 0?h.context:null,a=h.depth!==void 0?h.depth:!0,r=h.stencil!==void 0?h.stencil:!0,c=h.antialias!==void 0?h.antialias:!1,S=h.premultipliedAlpha!==void 0?h.premultipliedAlpha:!0,E=h.preserveDrawingBuffer!==void 0?h.preserveDrawingBuffer:!1,A=h.powerPreference!==void 0?h.powerPreference:"default",U=h.failIfMajorPerformanceCaveat!==void 0?h.failIfMajorPerformanceCaveat:!1;let B;s!==null?B=s.getContextAttributes().alpha:B=h.alpha!==void 0?h.alpha:!1;let D=null,R=null;const W=[],j=[];this.domElement=i,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=bw,this.physicallyCorrectLights=!1,this.toneMapping=I1,this.toneMappingExposure=1;const H=this;let I=!1,Q=0,Y=0,q=null,ae=-1,oe=null;const ye=new wu,_e=new wu;let pe=null,me=i.width,Ge=i.height,lt=1,It=null,wt=null;const we=new wu(0,0,me,Ge),yt=new wu(0,0,me,Ge);let Bt=!1;const Ot=new j5;let ze=!1,Ut=!1,Ft=null;const pt=new lc,vt=new Eo,rn=new cr,xt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function _t(){return q===null?lt:1}let Xt=s;function sn(Rt,Zt){for(let mn=0;mn<Rt.length;mn++){const fn=Rt[mn],mt=i.getContext(fn,Zt);if(mt!==null)return mt}return null}try{const Rt={alpha:!0,depth:a,stencil:r,antialias:c,premultipliedAlpha:S,preserveDrawingBuffer:E,powerPreference:A,failIfMajorPerformanceCaveat:U};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${L5}`),i.addEventListener("webglcontextlost",kr,!1),i.addEventListener("webglcontextrestored",dr,!1),i.addEventListener("webglcontextcreationerror",oi,!1),Xt===null){const Zt=["webgl2","webgl","experimental-webgl"];if(H.isWebGL1Renderer===!0&&Zt.shift(),Xt=sn(Zt,Rt),Xt===null)throw sn(Zt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Xt.getShaderPrecisionFormat===void 0&&(Xt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Rt){throw console.error("THREE.WebGLRenderer: "+Rt.message),Rt}let kn,an,Ve,Ye,$e,ft,$t,Jt,Pn,An,Qn,Ce,sr,Mr,on,Gt,Hn,Kt,Vt,en,Vn,Dt,On,or;function ar(){kn=new Tde(Xt),an=new Ede(Xt,kn,h),kn.init(an),Dt=new fpe(Xt,kn,an),Ve=new cpe(Xt,kn,an),Ye=new Nde,$e=new Khe,ft=new lpe(Xt,kn,Ve,$e,an,Dt,Ye),$t=new Cde(H),Jt=new Ode(H),Pn=new Uce(Xt,an),On=new wde(Xt,kn,Pn,an),An=new Mde(Xt,Pn,Ye,On),Qn=new Pde(Xt,An,Pn,Ye),Vt=new Rde(Xt,an,ft),Gt=new Sde($e),Ce=new Xhe(H,$t,Jt,kn,an,On,Gt),sr=new gpe(H,$e),Mr=new Jhe,on=new rpe(kn,an),Kt=new xde(H,$t,Jt,Ve,Qn,B,S),Hn=new upe(H,Qn,an),or=new vpe(Xt,Ye,an,Ve),en=new _de(Xt,kn,Ye,an),Vn=new Dde(Xt,kn,Ye,an),Ye.programs=Ce.programs,H.capabilities=an,H.extensions=kn,H.properties=$e,H.renderLists=Mr,H.shadowMap=Hn,H.state=Ve,H.info=Ye}ar();const yr=new mpe(H,Xt);this.xr=yr,this.getContext=function(){return Xt},this.getContextAttributes=function(){return Xt.getContextAttributes()},this.forceContextLoss=function(){const Rt=kn.get("WEBGL_lose_context");Rt&&Rt.loseContext()},this.forceContextRestore=function(){const Rt=kn.get("WEBGL_lose_context");Rt&&Rt.restoreContext()},this.getPixelRatio=function(){return lt},this.setPixelRatio=function(Rt){Rt!==void 0&&(lt=Rt,this.setSize(me,Ge,!1))},this.getSize=function(Rt){return Rt.set(me,Ge)},this.setSize=function(Rt,Zt,mn){if(yr.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}me=Rt,Ge=Zt,i.width=Math.floor(Rt*lt),i.height=Math.floor(Zt*lt),mn!==!1&&(i.style.width=Rt+"px",i.style.height=Zt+"px"),this.setViewport(0,0,Rt,Zt)},this.getDrawingBufferSize=function(Rt){return Rt.set(me*lt,Ge*lt).floor()},this.setDrawingBufferSize=function(Rt,Zt,mn){me=Rt,Ge=Zt,lt=mn,i.width=Math.floor(Rt*mn),i.height=Math.floor(Zt*mn),this.setViewport(0,0,Rt,Zt)},this.getCurrentViewport=function(Rt){return Rt.copy(ye)},this.getViewport=function(Rt){return Rt.copy(we)},this.setViewport=function(Rt,Zt,mn,fn){Rt.isVector4?we.set(Rt.x,Rt.y,Rt.z,Rt.w):we.set(Rt,Zt,mn,fn),Ve.viewport(ye.copy(we).multiplyScalar(lt).floor())},this.getScissor=function(Rt){return Rt.copy(yt)},this.setScissor=function(Rt,Zt,mn,fn){Rt.isVector4?yt.set(Rt.x,Rt.y,Rt.z,Rt.w):yt.set(Rt,Zt,mn,fn),Ve.scissor(_e.copy(yt).multiplyScalar(lt).floor())},this.getScissorTest=function(){return Bt},this.setScissorTest=function(Rt){Ve.setScissorTest(Bt=Rt)},this.setOpaqueSort=function(Rt){It=Rt},this.setTransparentSort=function(Rt){wt=Rt},this.getClearColor=function(Rt){return Rt.copy(Kt.getClearColor())},this.setClearColor=function(){Kt.setClearColor.apply(Kt,arguments)},this.getClearAlpha=function(){return Kt.getClearAlpha()},this.setClearAlpha=function(){Kt.setClearAlpha.apply(Kt,arguments)},this.clear=function(Rt=!0,Zt=!0,mn=!0){let fn=0;Rt&&(fn|=16384),Zt&&(fn|=256),mn&&(fn|=1024),Xt.clear(fn)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",kr,!1),i.removeEventListener("webglcontextrestored",dr,!1),i.removeEventListener("webglcontextcreationerror",oi,!1),Mr.dispose(),on.dispose(),$e.dispose(),$t.dispose(),Jt.dispose(),Qn.dispose(),On.dispose(),or.dispose(),Ce.dispose(),yr.dispose(),yr.removeEventListener("sessionstart",qr),yr.removeEventListener("sessionend",Kr),Ft&&(Ft.dispose(),Ft=null),Tt.stop()};function kr(Rt){Rt.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),I=!0}function dr(){console.log("THREE.WebGLRenderer: Context Restored."),I=!1;const Rt=Ye.autoReset,Zt=Hn.enabled,mn=Hn.autoUpdate,fn=Hn.needsUpdate,mt=Hn.type;ar(),Ye.autoReset=Rt,Hn.enabled=Zt,Hn.autoUpdate=mn,Hn.needsUpdate=fn,Hn.type=mt}function oi(Rt){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Rt.statusMessage)}function Ur(Rt){const Zt=Rt.target;Zt.removeEventListener("dispose",Ur),Xr(Zt)}function Xr(Rt){zn(Rt),$e.remove(Rt)}function zn(Rt){const Zt=$e.get(Rt).programs;Zt!==void 0&&(Zt.forEach(function(mn){Ce.releaseProgram(mn)}),Rt.isShaderMaterial&&Ce.releaseShaderCache(Rt))}this.renderBufferDirect=function(Rt,Zt,mn,fn,mt,Mt){Zt===null&&(Zt=xt);const hn=mt.isMesh&&mt.matrixWorld.determinant()<0,nn=Ct(Rt,Zt,mn,fn,mt);Ve.setMaterial(fn,hn);let He=mn.index,Bn=1;fn.wireframe===!0&&(He=An.getWireframeAttribute(mn),Bn=2);const Xn=mn.drawRange,Zn=mn.attributes.position;let lr=Xn.start*Bn,jr=(Xn.start+Xn.count)*Bn;Mt!==null&&(lr=Math.max(lr,Mt.start*Bn),jr=Math.min(jr,(Mt.start+Mt.count)*Bn)),He!==null?(lr=Math.max(lr,0),jr=Math.min(jr,He.count)):Zn!=null&&(lr=Math.max(lr,0),jr=Math.min(jr,Zn.count));const Cr=jr-lr;if(Cr<0||Cr===1/0)return;On.setup(mt,fn,nn,mn,He);let xi,Ai=en;if(He!==null&&(xi=Pn.get(He),Ai=Vn,Ai.setIndex(xi)),mt.isMesh)fn.wireframe===!0?(Ve.setLineWidth(fn.wireframeLinewidth*_t()),Ai.setMode(1)):Ai.setMode(4);else if(mt.isLine){let ni=fn.linewidth;ni===void 0&&(ni=1),Ve.setLineWidth(ni*_t()),mt.isLineSegments?Ai.setMode(1):mt.isLineLoop?Ai.setMode(2):Ai.setMode(3)}else mt.isPoints?Ai.setMode(0):mt.isSprite&&Ai.setMode(4);if(mt.isInstancedMesh)Ai.renderInstances(lr,Cr,mt.count);else if(mn.isInstancedBufferGeometry){const ni=mn._maxInstanceCount!==void 0?mn._maxInstanceCount:1/0,to=Math.min(mn.instanceCount,ni);Ai.renderInstances(lr,Cr,to)}else Ai.render(lr,Cr)},this.compile=function(Rt,Zt){function mn(fn,mt,Mt){fn.transparent===!0&&fn.side===KA?(fn.side=$g,fn.needsUpdate=!0,Me(fn,mt,Mt),fn.side=vw,fn.needsUpdate=!0,Me(fn,mt,Mt),fn.side=KA):Me(fn,mt,Mt)}R=on.get(Rt),R.init(),j.push(R),Rt.traverseVisible(function(fn){fn.isLight&&fn.layers.test(Zt.layers)&&(R.pushLight(fn),fn.castShadow&&R.pushShadow(fn))}),R.setupLights(H.physicallyCorrectLights),Rt.traverse(function(fn){const mt=fn.material;if(mt)if(Array.isArray(mt))for(let Mt=0;Mt<mt.length;Mt++){const hn=mt[Mt];mn(hn,Rt,fn)}else mn(mt,Rt,fn)}),j.pop(),R=null};let ir=null;function Or(Rt){ir&&ir(Rt)}function qr(){Tt.stop()}function Kr(){Tt.start()}const Tt=new Nq;Tt.setAnimationLoop(Or),typeof self<"u"&&Tt.setContext(self),this.setAnimationLoop=function(Rt){ir=Rt,yr.setAnimationLoop(Rt),Rt===null?Tt.stop():Tt.start()},yr.addEventListener("sessionstart",qr),yr.addEventListener("sessionend",Kr),this.render=function(Rt,Zt){if(Zt!==void 0&&Zt.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(I===!0)return;Rt.matrixWorldAutoUpdate===!0&&Rt.updateMatrixWorld(),Zt.parent===null&&Zt.matrixWorldAutoUpdate===!0&&Zt.updateMatrixWorld(),yr.enabled===!0&&yr.isPresenting===!0&&(yr.cameraAutoUpdate===!0&&yr.updateCamera(Zt),Zt=yr.getCamera()),Rt.isScene===!0&&Rt.onBeforeRender(H,Rt,Zt,q),R=on.get(Rt,j.length),R.init(),j.push(R),pt.multiplyMatrices(Zt.projectionMatrix,Zt.matrixWorldInverse),Ot.setFromProjectionMatrix(pt),Ut=this.localClippingEnabled,ze=Gt.init(this.clippingPlanes,Ut,Zt),D=Mr.get(Rt,W.length),D.init(),W.push(D),Rr(Rt,Zt,0,H.sortObjects),D.finish(),H.sortObjects===!0&&D.sort(It,wt),ze===!0&&Gt.beginShadows();const mn=R.state.shadowsArray;if(Hn.render(mn,Rt,Zt),ze===!0&&Gt.endShadows(),this.info.autoReset===!0&&this.info.reset(),Kt.render(D,Rt),R.setupLights(H.physicallyCorrectLights),Zt.isArrayCamera){const fn=Zt.cameras;for(let mt=0,Mt=fn.length;mt<Mt;mt++){const hn=fn[mt];Qt(D,Rt,hn,hn.viewport)}}else Qt(D,Rt,Zt);q!==null&&(ft.updateMultisampleRenderTarget(q),ft.updateRenderTargetMipmap(q)),Rt.isScene===!0&&Rt.onAfterRender(H,Rt,Zt),On.resetDefaultState(),ae=-1,oe=null,j.pop(),j.length>0?R=j[j.length-1]:R=null,W.pop(),W.length>0?D=W[W.length-1]:D=null};function Rr(Rt,Zt,mn,fn){if(Rt.visible===!1)return;if(Rt.layers.test(Zt.layers)){if(Rt.isGroup)mn=Rt.renderOrder;else if(Rt.isLOD)Rt.autoUpdate===!0&&Rt.update(Zt);else if(Rt.isLight)R.pushLight(Rt),Rt.castShadow&&R.pushShadow(Rt);else if(Rt.isSprite){if(!Rt.frustumCulled||Ot.intersectsSprite(Rt)){fn&&rn.setFromMatrixPosition(Rt.matrixWorld).applyMatrix4(pt);const hn=Qn.update(Rt),nn=Rt.material;nn.visible&&D.push(Rt,hn,nn,mn,rn.z,null)}}else if((Rt.isMesh||Rt.isLine||Rt.isPoints)&&(Rt.isSkinnedMesh&&Rt.skeleton.frame!==Ye.render.frame&&(Rt.skeleton.update(),Rt.skeleton.frame=Ye.render.frame),!Rt.frustumCulled||Ot.intersectsObject(Rt))){fn&&rn.setFromMatrixPosition(Rt.matrixWorld).applyMatrix4(pt);const hn=Qn.update(Rt),nn=Rt.material;if(Array.isArray(nn)){const He=hn.groups;for(let Bn=0,Xn=He.length;Bn<Xn;Bn++){const Zn=He[Bn],lr=nn[Zn.materialIndex];lr&&lr.visible&&D.push(Rt,hn,lr,mn,rn.z,Zn)}}else nn.visible&&D.push(Rt,hn,nn,mn,rn.z,null)}}const Mt=Rt.children;for(let hn=0,nn=Mt.length;hn<nn;hn++)Rr(Mt[hn],Zt,mn,fn)}function Qt(Rt,Zt,mn,fn){const mt=Rt.opaque,Mt=Rt.transmissive,hn=Rt.transparent;R.setupLightsView(mn),Mt.length>0&&Se(mt,Zt,mn),fn&&Ve.viewport(ye.copy(fn)),mt.length>0&&ve(mt,Zt,mn),Mt.length>0&&ve(Mt,Zt,mn),hn.length>0&&ve(hn,Zt,mn),Ve.buffers.depth.setTest(!0),Ve.buffers.depth.setMask(!0),Ve.buffers.color.setMask(!0),Ve.setPolygonOffset(!1)}function Se(Rt,Zt,mn){const fn=an.isWebGL2;Ft===null&&(Ft=new xw(1,1,{generateMipmaps:!0,type:kn.has("EXT_color_buffer_half_float")?uC:yw,minFilter:sC,samples:fn&&c===!0?4:0})),H.getDrawingBufferSize(vt),fn?Ft.setSize(vt.x,vt.y):Ft.setSize(IR(vt.x),IR(vt.y));const mt=H.getRenderTarget();H.setRenderTarget(Ft),H.clear();const Mt=H.toneMapping;H.toneMapping=I1,ve(Rt,Zt,mn),H.toneMapping=Mt,ft.updateMultisampleRenderTarget(Ft),ft.updateRenderTargetMipmap(Ft),H.setRenderTarget(mt)}function ve(Rt,Zt,mn){const fn=Zt.isScene===!0?Zt.overrideMaterial:null;for(let mt=0,Mt=Rt.length;mt<Mt;mt++){const hn=Rt[mt],nn=hn.object,He=hn.geometry,Bn=fn===null?hn.material:fn,Xn=hn.group;nn.layers.test(mn.layers)&&ke(nn,Zt,mn,He,Bn,Xn)}}function ke(Rt,Zt,mn,fn,mt,Mt){Rt.onBeforeRender(H,Zt,mn,fn,mt,Mt),Rt.modelViewMatrix.multiplyMatrices(mn.matrixWorldInverse,Rt.matrixWorld),Rt.normalMatrix.getNormalMatrix(Rt.modelViewMatrix),mt.onBeforeRender(H,Zt,mn,fn,Rt,Mt),mt.transparent===!0&&mt.side===KA?(mt.side=$g,mt.needsUpdate=!0,H.renderBufferDirect(mn,Zt,fn,mt,Rt,Mt),mt.side=vw,mt.needsUpdate=!0,H.renderBufferDirect(mn,Zt,fn,mt,Rt,Mt),mt.side=KA):H.renderBufferDirect(mn,Zt,fn,mt,Rt,Mt),Rt.onAfterRender(H,Zt,mn,fn,mt,Mt)}function Me(Rt,Zt,mn){Zt.isScene!==!0&&(Zt=xt);const fn=$e.get(Rt),mt=R.state.lights,Mt=R.state.shadowsArray,hn=mt.state.version,nn=Ce.getParameters(Rt,mt.state,Mt,Zt,mn),He=Ce.getProgramCacheKey(nn);let Bn=fn.programs;fn.environment=Rt.isMeshStandardMaterial?Zt.environment:null,fn.fog=Zt.fog,fn.envMap=(Rt.isMeshStandardMaterial?Jt:$t).get(Rt.envMap||fn.environment),Bn===void 0&&(Rt.addEventListener("dispose",Ur),Bn=new Map,fn.programs=Bn);let Xn=Bn.get(He);if(Xn!==void 0){if(fn.currentProgram===Xn&&fn.lightsStateVersion===hn)return rt(Rt,nn),Xn}else nn.uniforms=Ce.getUniforms(Rt),Rt.onBuild(mn,nn,H),Rt.onBeforeCompile(nn,H),Xn=Ce.acquireProgram(nn,He),Bn.set(He,Xn),fn.uniforms=nn.uniforms;const Zn=fn.uniforms;(!Rt.isShaderMaterial&&!Rt.isRawShaderMaterial||Rt.clipping===!0)&&(Zn.clippingPlanes=Gt.uniform),rt(Rt,nn),fn.needsLights=Sn(Rt),fn.lightsStateVersion=hn,fn.needsLights&&(Zn.ambientLightColor.value=mt.state.ambient,Zn.lightProbe.value=mt.state.probe,Zn.directionalLights.value=mt.state.directional,Zn.directionalLightShadows.value=mt.state.directionalShadow,Zn.spotLights.value=mt.state.spot,Zn.spotLightShadows.value=mt.state.spotShadow,Zn.rectAreaLights.value=mt.state.rectArea,Zn.ltc_1.value=mt.state.rectAreaLTC1,Zn.ltc_2.value=mt.state.rectAreaLTC2,Zn.pointLights.value=mt.state.point,Zn.pointLightShadows.value=mt.state.pointShadow,Zn.hemisphereLights.value=mt.state.hemi,Zn.directionalShadowMap.value=mt.state.directionalShadowMap,Zn.directionalShadowMatrix.value=mt.state.directionalShadowMatrix,Zn.spotShadowMap.value=mt.state.spotShadowMap,Zn.spotLightMatrix.value=mt.state.spotLightMatrix,Zn.spotLightMap.value=mt.state.spotLightMap,Zn.pointShadowMap.value=mt.state.pointShadowMap,Zn.pointShadowMatrix.value=mt.state.pointShadowMatrix);const lr=Xn.getUniforms(),jr=NO.seqWithValue(lr.seq,Zn);return fn.currentProgram=Xn,fn.uniformsList=jr,Xn}function rt(Rt,Zt){const mn=$e.get(Rt);mn.outputEncoding=Zt.outputEncoding,mn.instancing=Zt.instancing,mn.skinning=Zt.skinning,mn.morphTargets=Zt.morphTargets,mn.morphNormals=Zt.morphNormals,mn.morphColors=Zt.morphColors,mn.morphTargetsCount=Zt.morphTargetsCount,mn.numClippingPlanes=Zt.numClippingPlanes,mn.numIntersection=Zt.numClipIntersection,mn.vertexAlphas=Zt.vertexAlphas,mn.vertexTangents=Zt.vertexTangents,mn.toneMapping=Zt.toneMapping}function Ct(Rt,Zt,mn,fn,mt){Zt.isScene!==!0&&(Zt=xt),ft.resetTextureUnits();const Mt=Zt.fog,hn=fn.isMeshStandardMaterial?Zt.environment:null,nn=q===null?H.outputEncoding:q.isXRRenderTarget===!0?q.texture.encoding:bw,He=(fn.isMeshStandardMaterial?Jt:$t).get(fn.envMap||hn),Bn=fn.vertexColors===!0&&!!mn.attributes.color&&mn.attributes.color.itemSize===4,Xn=!!fn.normalMap&&!!mn.attributes.tangent,Zn=!!mn.morphAttributes.position,lr=!!mn.morphAttributes.normal,jr=!!mn.morphAttributes.color,Cr=fn.toneMapped?H.toneMapping:I1,xi=mn.morphAttributes.position||mn.morphAttributes.normal||mn.morphAttributes.color,Ai=xi!==void 0?xi.length:0,ni=$e.get(fn),to=R.state.lights;if(ze===!0&&(Ut===!0||Rt!==oe)){const Wi=Rt===oe&&fn.id===ae;Gt.setState(fn,Rt,Wi)}let yi=!1;fn.version===ni.__version?(ni.needsLights&&ni.lightsStateVersion!==to.state.version||ni.outputEncoding!==nn||mt.isInstancedMesh&&ni.instancing===!1||!mt.isInstancedMesh&&ni.instancing===!0||mt.isSkinnedMesh&&ni.skinning===!1||!mt.isSkinnedMesh&&ni.skinning===!0||ni.envMap!==He||fn.fog===!0&&ni.fog!==Mt||ni.numClippingPlanes!==void 0&&(ni.numClippingPlanes!==Gt.numPlanes||ni.numIntersection!==Gt.numIntersection)||ni.vertexAlphas!==Bn||ni.vertexTangents!==Xn||ni.morphTargets!==Zn||ni.morphNormals!==lr||ni.morphColors!==jr||ni.toneMapping!==Cr||an.isWebGL2===!0&&ni.morphTargetsCount!==Ai)&&(yi=!0):(yi=!0,ni.__version=fn.version);let ri=ni.currentProgram;yi===!0&&(ri=Me(fn,Zt,mt));let Jr=!1,Kn=!1,pi=!1;const Ci=ri.getUniforms(),Wr=ni.uniforms;if(Ve.useProgram(ri.program)&&(Jr=!0,Kn=!0,pi=!0),fn.id!==ae&&(ae=fn.id,Kn=!0),Jr||oe!==Rt){if(Ci.setValue(Xt,"projectionMatrix",Rt.projectionMatrix),an.logarithmicDepthBuffer&&Ci.setValue(Xt,"logDepthBufFC",2/(Math.log(Rt.far+1)/Math.LN2)),oe!==Rt&&(oe=Rt,Kn=!0,pi=!0),fn.isShaderMaterial||fn.isMeshPhongMaterial||fn.isMeshToonMaterial||fn.isMeshStandardMaterial||fn.envMap){const Wi=Ci.map.cameraPosition;Wi!==void 0&&Wi.setValue(Xt,rn.setFromMatrixPosition(Rt.matrixWorld))}(fn.isMeshPhongMaterial||fn.isMeshToonMaterial||fn.isMeshLambertMaterial||fn.isMeshBasicMaterial||fn.isMeshStandardMaterial||fn.isShaderMaterial)&&Ci.setValue(Xt,"isOrthographic",Rt.isOrthographicCamera===!0),(fn.isMeshPhongMaterial||fn.isMeshToonMaterial||fn.isMeshLambertMaterial||fn.isMeshBasicMaterial||fn.isMeshStandardMaterial||fn.isShaderMaterial||fn.isShadowMaterial||mt.isSkinnedMesh)&&Ci.setValue(Xt,"viewMatrix",Rt.matrixWorldInverse)}if(mt.isSkinnedMesh){Ci.setOptional(Xt,mt,"bindMatrix"),Ci.setOptional(Xt,mt,"bindMatrixInverse");const Wi=mt.skeleton;Wi&&(an.floatVertexTextures?(Wi.boneTexture===null&&Wi.computeBoneTexture(),Ci.setValue(Xt,"boneTexture",Wi.boneTexture,ft),Ci.setValue(Xt,"boneTextureSize",Wi.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const so=mn.morphAttributes;if((so.position!==void 0||so.normal!==void 0||so.color!==void 0&&an.isWebGL2===!0)&&Vt.update(mt,mn,fn,ri),(Kn||ni.receiveShadow!==mt.receiveShadow)&&(ni.receiveShadow=mt.receiveShadow,Ci.setValue(Xt,"receiveShadow",mt.receiveShadow)),fn.isMeshGouraudMaterial&&fn.envMap!==null&&(Wr.envMap.value=He,Wr.flipEnvMap.value=He.isCubeTexture&&He.isRenderTargetTexture===!1?-1:1),Kn&&(Ci.setValue(Xt,"toneMappingExposure",H.toneMappingExposure),ni.needsLights&&tn(Wr,pi),Mt&&fn.fog===!0&&sr.refreshFogUniforms(Wr,Mt),sr.refreshMaterialUniforms(Wr,fn,lt,Ge,Ft),NO.upload(Xt,ni.uniformsList,Wr,ft)),fn.isShaderMaterial&&fn.uniformsNeedUpdate===!0&&(NO.upload(Xt,ni.uniformsList,Wr,ft),fn.uniformsNeedUpdate=!1),fn.isSpriteMaterial&&Ci.setValue(Xt,"center",mt.center),Ci.setValue(Xt,"modelViewMatrix",mt.modelViewMatrix),Ci.setValue(Xt,"normalMatrix",mt.normalMatrix),Ci.setValue(Xt,"modelMatrix",mt.matrixWorld),fn.isShaderMaterial||fn.isRawShaderMaterial){const Wi=fn.uniformsGroups;for(let no=0,So=Wi.length;no<So;no++)if(an.isWebGL2){const _a=Wi[no];or.update(_a,ri),or.bind(_a,ri)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return ri}function tn(Rt,Zt){Rt.ambientLightColor.needsUpdate=Zt,Rt.lightProbe.needsUpdate=Zt,Rt.directionalLights.needsUpdate=Zt,Rt.directionalLightShadows.needsUpdate=Zt,Rt.pointLights.needsUpdate=Zt,Rt.pointLightShadows.needsUpdate=Zt,Rt.spotLights.needsUpdate=Zt,Rt.spotLightShadows.needsUpdate=Zt,Rt.rectAreaLights.needsUpdate=Zt,Rt.hemisphereLights.needsUpdate=Zt}function Sn(Rt){return Rt.isMeshLambertMaterial||Rt.isMeshToonMaterial||Rt.isMeshPhongMaterial||Rt.isMeshStandardMaterial||Rt.isShadowMaterial||Rt.isShaderMaterial&&Rt.lights===!0}this.getActiveCubeFace=function(){return Q},this.getActiveMipmapLevel=function(){return Y},this.getRenderTarget=function(){return q},this.setRenderTargetTextures=function(Rt,Zt,mn){$e.get(Rt.texture).__webglTexture=Zt,$e.get(Rt.depthTexture).__webglTexture=mn;const fn=$e.get(Rt);fn.__hasExternalTextures=!0,fn.__hasExternalTextures&&(fn.__autoAllocateDepthBuffer=mn===void 0,fn.__autoAllocateDepthBuffer||kn.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),fn.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Rt,Zt){const mn=$e.get(Rt);mn.__webglFramebuffer=Zt,mn.__useDefaultFramebuffer=Zt===void 0},this.setRenderTarget=function(Rt,Zt=0,mn=0){q=Rt,Q=Zt,Y=mn;let fn=!0,mt=null,Mt=!1,hn=!1;if(Rt){const He=$e.get(Rt);He.__useDefaultFramebuffer!==void 0?(Ve.bindFramebuffer(36160,null),fn=!1):He.__webglFramebuffer===void 0?ft.setupRenderTarget(Rt):He.__hasExternalTextures&&ft.rebindTextures(Rt,$e.get(Rt.texture).__webglTexture,$e.get(Rt.depthTexture).__webglTexture);const Bn=Rt.texture;(Bn.isData3DTexture||Bn.isDataArrayTexture||Bn.isCompressedArrayTexture)&&(hn=!0);const Xn=$e.get(Rt).__webglFramebuffer;Rt.isWebGLCubeRenderTarget?(mt=Xn[Zt],Mt=!0):an.isWebGL2&&Rt.samples>0&&ft.useMultisampledRTT(Rt)===!1?mt=$e.get(Rt).__webglMultisampledFramebuffer:mt=Xn,ye.copy(Rt.viewport),_e.copy(Rt.scissor),pe=Rt.scissorTest}else ye.copy(we).multiplyScalar(lt).floor(),_e.copy(yt).multiplyScalar(lt).floor(),pe=Bt;if(Ve.bindFramebuffer(36160,mt)&&an.drawBuffers&&fn&&Ve.drawBuffers(Rt,mt),Ve.viewport(ye),Ve.scissor(_e),Ve.setScissorTest(pe),Mt){const He=$e.get(Rt.texture);Xt.framebufferTexture2D(36160,36064,34069+Zt,He.__webglTexture,mn)}else if(hn){const He=$e.get(Rt.texture),Bn=Zt||0;Xt.framebufferTextureLayer(36160,36064,He.__webglTexture,mn||0,Bn)}ae=-1},this.readRenderTargetPixels=function(Rt,Zt,mn,fn,mt,Mt,hn){if(!(Rt&&Rt.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let nn=$e.get(Rt).__webglFramebuffer;if(Rt.isWebGLCubeRenderTarget&&hn!==void 0&&(nn=nn[hn]),nn){Ve.bindFramebuffer(36160,nn);try{const He=Rt.texture,Bn=He.format,Xn=He.type;if(Bn!==nv&&Dt.convert(Bn)!==Xt.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Zn=Xn===uC&&(kn.has("EXT_color_buffer_half_float")||an.isWebGL2&&kn.has("EXT_color_buffer_float"));if(Xn!==yw&&Dt.convert(Xn)!==Xt.getParameter(35738)&&!(Xn===sw&&(an.isWebGL2||kn.has("OES_texture_float")||kn.has("WEBGL_color_buffer_float")))&&!Zn){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Zt>=0&&Zt<=Rt.width-fn&&mn>=0&&mn<=Rt.height-mt&&Xt.readPixels(Zt,mn,fn,mt,Dt.convert(Bn),Dt.convert(Xn),Mt)}finally{const He=q!==null?$e.get(q).__webglFramebuffer:null;Ve.bindFramebuffer(36160,He)}}},this.copyFramebufferToTexture=function(Rt,Zt,mn=0){const fn=Math.pow(2,-mn),mt=Math.floor(Zt.image.width*fn),Mt=Math.floor(Zt.image.height*fn);ft.setTexture2D(Zt,0),Xt.copyTexSubImage2D(3553,mn,0,0,Rt.x,Rt.y,mt,Mt),Ve.unbindTexture()},this.copyTextureToTexture=function(Rt,Zt,mn,fn=0){const mt=Zt.image.width,Mt=Zt.image.height,hn=Dt.convert(mn.format),nn=Dt.convert(mn.type);ft.setTexture2D(mn,0),Xt.pixelStorei(37440,mn.flipY),Xt.pixelStorei(37441,mn.premultiplyAlpha),Xt.pixelStorei(3317,mn.unpackAlignment),Zt.isDataTexture?Xt.texSubImage2D(3553,fn,Rt.x,Rt.y,mt,Mt,hn,nn,Zt.image.data):Zt.isCompressedTexture?Xt.compressedTexSubImage2D(3553,fn,Rt.x,Rt.y,Zt.mipmaps[0].width,Zt.mipmaps[0].height,hn,Zt.mipmaps[0].data):Xt.texSubImage2D(3553,fn,Rt.x,Rt.y,hn,nn,Zt.image),fn===0&&mn.generateMipmaps&&Xt.generateMipmap(3553),Ve.unbindTexture()},this.copyTextureToTexture3D=function(Rt,Zt,mn,fn,mt=0){if(H.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Mt=Rt.max.x-Rt.min.x+1,hn=Rt.max.y-Rt.min.y+1,nn=Rt.max.z-Rt.min.z+1,He=Dt.convert(fn.format),Bn=Dt.convert(fn.type);let Xn;if(fn.isData3DTexture)ft.setTexture3D(fn,0),Xn=32879;else if(fn.isDataArrayTexture)ft.setTexture2DArray(fn,0),Xn=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Xt.pixelStorei(37440,fn.flipY),Xt.pixelStorei(37441,fn.premultiplyAlpha),Xt.pixelStorei(3317,fn.unpackAlignment);const Zn=Xt.getParameter(3314),lr=Xt.getParameter(32878),jr=Xt.getParameter(3316),Cr=Xt.getParameter(3315),xi=Xt.getParameter(32877),Ai=mn.isCompressedTexture?mn.mipmaps[0]:mn.image;Xt.pixelStorei(3314,Ai.width),Xt.pixelStorei(32878,Ai.height),Xt.pixelStorei(3316,Rt.min.x),Xt.pixelStorei(3315,Rt.min.y),Xt.pixelStorei(32877,Rt.min.z),mn.isDataTexture||mn.isData3DTexture?Xt.texSubImage3D(Xn,mt,Zt.x,Zt.y,Zt.z,Mt,hn,nn,He,Bn,Ai.data):mn.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Xt.compressedTexSubImage3D(Xn,mt,Zt.x,Zt.y,Zt.z,Mt,hn,nn,He,Ai.data)):Xt.texSubImage3D(Xn,mt,Zt.x,Zt.y,Zt.z,Mt,hn,nn,He,Bn,Ai),Xt.pixelStorei(3314,Zn),Xt.pixelStorei(32878,lr),Xt.pixelStorei(3316,jr),Xt.pixelStorei(3315,Cr),Xt.pixelStorei(32877,xi),mt===0&&fn.generateMipmaps&&Xt.generateMipmap(Xn),Ve.unbindTexture()},this.initTexture=function(Rt){Rt.isCubeTexture?ft.setTextureCube(Rt,0):Rt.isData3DTexture?ft.setTexture3D(Rt,0):Rt.isDataArrayTexture||Rt.isCompressedArrayTexture?ft.setTexture2DArray(Rt,0):ft.setTexture2D(Rt,0),Ve.unbindTexture()},this.resetState=function(){Q=0,Y=0,q=null,Ve.reset(),On.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class bpe extends Lq{}bpe.prototype.isWebGL1Renderer=!0;class xpe extends ld{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(i,s){return super.copy(i,s),i.background!==null&&(this.background=i.background.clone()),i.environment!==null&&(this.environment=i.environment.clone()),i.fog!==null&&(this.fog=i.fog.clone()),this.backgroundBlurriness=i.backgroundBlurriness,this.backgroundIntensity=i.backgroundIntensity,i.overrideMaterial!==null&&(this.overrideMaterial=i.overrideMaterial.clone()),this.matrixAutoUpdate=i.matrixAutoUpdate,this}toJSON(i){const s=super.toJSON(i);return this.fog!==null&&(s.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(s.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(s.backgroundIntensity=this.backgroundIntensity),s}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(i){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=i}}class Bq extends bC{constructor(i){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new bs(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.color.copy(i.color),this.linewidth=i.linewidth,this.linecap=i.linecap,this.linejoin=i.linejoin,this.fog=i.fog,this}}const DV=new cr,NV=new cr,IV=new lc,kF=new Cq,gO=new kT;class wpe extends ld{constructor(i=new Dy,s=new Bq){super(),this.isLine=!0,this.type="Line",this.geometry=i,this.material=s,this.updateMorphTargets()}copy(i,s){return super.copy(i,s),this.material=i.material,this.geometry=i.geometry,this}computeLineDistances(){const i=this.geometry;if(i.index===null){const s=i.attributes.position,a=[0];for(let r=1,c=s.count;r<c;r++)DV.fromBufferAttribute(s,r-1),NV.fromBufferAttribute(s,r),a[r]=a[r-1],a[r]+=DV.distanceTo(NV);i.setAttribute("lineDistance",new zp(a,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(i,s){const a=this.geometry,r=this.matrixWorld,c=i.params.Line.threshold,S=a.drawRange;if(a.boundingSphere===null&&a.computeBoundingSphere(),gO.copy(a.boundingSphere),gO.applyMatrix4(r),gO.radius+=c,i.ray.intersectsSphere(gO)===!1)return;IV.copy(r).invert(),kF.copy(i.ray).applyMatrix4(IV);const E=c/((this.scale.x+this.scale.y+this.scale.z)/3),A=E*E,U=new cr,B=new cr,D=new cr,R=new cr,W=this.isLineSegments?2:1,j=a.index,I=a.attributes.position;if(j!==null){const Q=Math.max(0,S.start),Y=Math.min(j.count,S.start+S.count);for(let q=Q,ae=Y-1;q<ae;q+=W){const oe=j.getX(q),ye=j.getX(q+1);if(U.fromBufferAttribute(I,oe),B.fromBufferAttribute(I,ye),kF.distanceSqToSegment(U,B,R,D)>A)continue;R.applyMatrix4(this.matrixWorld);const pe=i.ray.origin.distanceTo(R);pe<i.near||pe>i.far||s.push({distance:pe,point:D.clone().applyMatrix4(this.matrixWorld),index:q,face:null,faceIndex:null,object:this})}}else{const Q=Math.max(0,S.start),Y=Math.min(I.count,S.start+S.count);for(let q=Q,ae=Y-1;q<ae;q+=W){if(U.fromBufferAttribute(I,q),B.fromBufferAttribute(I,q+1),kF.distanceSqToSegment(U,B,R,D)>A)continue;R.applyMatrix4(this.matrixWorld);const ye=i.ray.origin.distanceTo(R);ye<i.near||ye>i.far||s.push({distance:ye,point:D.clone().applyMatrix4(this.matrixWorld),index:q,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const s=this.geometry.morphAttributes,a=Object.keys(s);if(a.length>0){const r=s[a[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let c=0,S=r.length;c<S;c++){const E=r[c].name||String(c);this.morphTargetInfluences.push(0),this.morphTargetDictionary[E]=c}}}}}const FV=new cr,RV=new cr;class _pe extends wpe{constructor(i,s){super(i,s),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const i=this.geometry;if(i.index===null){const s=i.attributes.position,a=[];for(let r=0,c=s.count;r<c;r+=2)FV.fromBufferAttribute(s,r),RV.fromBufferAttribute(s,r+1),a[r]=r===0?0:a[r-1],a[r+1]=a[r]+FV.distanceTo(RV);i.setAttribute("lineDistance",new zp(a,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Epe extends jp{constructor(i,s,a,r,c,S,E,A,U){super(i,s,a,r,c,S,E,A,U),this.isVideoTexture=!0,this.minFilter=S!==void 0?S:Np,this.magFilter=c!==void 0?c:Np,this.generateMipmaps=!1;const B=this;function D(){B.needsUpdate=!0,i.requestVideoFrameCallback(D)}"requestVideoFrameCallback"in i&&i.requestVideoFrameCallback(D)}clone(){return new this.constructor(this.image).copy(this)}update(){const i=this.image;"requestVideoFrameCallback"in i===!1&&i.readyState>=i.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class U5 extends Dy{constructor(i=1,s=32,a=16,r=0,c=Math.PI*2,S=0,E=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:i,widthSegments:s,heightSegments:a,phiStart:r,phiLength:c,thetaStart:S,thetaLength:E},s=Math.max(3,Math.floor(s)),a=Math.max(2,Math.floor(a));const A=Math.min(S+E,Math.PI);let U=0;const B=[],D=new cr,R=new cr,W=[],j=[],H=[],I=[];for(let Q=0;Q<=a;Q++){const Y=[],q=Q/a;let ae=0;Q==0&&S==0?ae=.5/s:Q==a&&A==Math.PI&&(ae=-.5/s);for(let oe=0;oe<=s;oe++){const ye=oe/s;D.x=-i*Math.cos(r+ye*c)*Math.sin(S+q*E),D.y=i*Math.cos(S+q*E),D.z=i*Math.sin(r+ye*c)*Math.sin(S+q*E),j.push(D.x,D.y,D.z),R.copy(D).normalize(),H.push(R.x,R.y,R.z),I.push(ye+ae,1-q),Y.push(U++)}B.push(Y)}for(let Q=0;Q<a;Q++)for(let Y=0;Y<s;Y++){const q=B[Q][Y+1],ae=B[Q][Y],oe=B[Q+1][Y],ye=B[Q+1][Y+1];(Q!==0||S>0)&&W.push(q,ae,ye),(Q!==a-1||A<Math.PI)&&W.push(ae,oe,ye)}this.setIndex(W),this.setAttribute("position",new zp(j,3)),this.setAttribute("normal",new zp(H,3)),this.setAttribute("uv",new zp(I,2))}static fromJSON(i){return new U5(i.radius,i.widthSegments,i.heightSegments,i.phiStart,i.phiLength,i.thetaStart,i.thetaLength)}}class W5 extends ld{constructor(i,s=1){super(),this.isLight=!0,this.type="Light",this.color=new bs(i),this.intensity=s}dispose(){}copy(i,s){return super.copy(i,s),this.color.copy(i.color),this.intensity=i.intensity,this}toJSON(i){const s=super.toJSON(i);return s.object.color=this.color.getHex(),s.object.intensity=this.intensity,this.groundColor!==void 0&&(s.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(s.object.distance=this.distance),this.angle!==void 0&&(s.object.angle=this.angle),this.decay!==void 0&&(s.object.decay=this.decay),this.penumbra!==void 0&&(s.object.penumbra=this.penumbra),this.shadow!==void 0&&(s.object.shadow=this.shadow.toJSON()),s}}class Spe extends W5{constructor(i,s,a){super(i,a),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(ld.DefaultUp),this.updateMatrix(),this.groundColor=new bs(s)}copy(i,s){return super.copy(i,s),this.groundColor.copy(i.groundColor),this}}const AF=new lc,PV=new cr,LV=new cr;class Cpe{constructor(i){this.camera=i,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Eo(512,512),this.map=null,this.mapPass=null,this.matrix=new lc,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new j5,this._frameExtents=new Eo(1,1),this._viewportCount=1,this._viewports=[new wu(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(i){const s=this.camera,a=this.matrix;PV.setFromMatrixPosition(i.matrixWorld),s.position.copy(PV),LV.setFromMatrixPosition(i.target.matrixWorld),s.lookAt(LV),s.updateMatrixWorld(),AF.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),this._frustum.setFromProjectionMatrix(AF),a.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),a.multiply(AF)}getViewport(i){return this._viewports[i]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(i){return this.camera=i.camera.clone(),this.bias=i.bias,this.radius=i.radius,this.mapSize.copy(i.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const i={};return this.bias!==0&&(i.bias=this.bias),this.normalBias!==0&&(i.normalBias=this.normalBias),this.radius!==1&&(i.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(i.mapSize=this.mapSize.toArray()),i.camera=this.camera.toJSON(!1).object,delete i.camera.matrix,i}}const BV=new lc,_S=new cr,OF=new cr;class kpe extends Cpe{constructor(){super(new Hg(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Eo(4,2),this._viewportCount=6,this._viewports=[new wu(2,1,1,1),new wu(0,1,1,1),new wu(3,1,1,1),new wu(1,1,1,1),new wu(3,0,1,1),new wu(1,0,1,1)],this._cubeDirections=[new cr(1,0,0),new cr(-1,0,0),new cr(0,0,1),new cr(0,0,-1),new cr(0,1,0),new cr(0,-1,0)],this._cubeUps=[new cr(0,1,0),new cr(0,1,0),new cr(0,1,0),new cr(0,1,0),new cr(0,0,1),new cr(0,0,-1)]}updateMatrices(i,s=0){const a=this.camera,r=this.matrix,c=i.distance||a.far;c!==a.far&&(a.far=c,a.updateProjectionMatrix()),_S.setFromMatrixPosition(i.matrixWorld),a.position.copy(_S),OF.copy(a.position),OF.add(this._cubeDirections[s]),a.up.copy(this._cubeUps[s]),a.lookAt(OF),a.updateMatrixWorld(),r.makeTranslation(-_S.x,-_S.y,-_S.z),BV.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse),this._frustum.setFromProjectionMatrix(BV)}}class ES extends W5{constructor(i,s,a=0,r=2){super(i,s),this.isPointLight=!0,this.type="PointLight",this.distance=a,this.decay=r,this.shadow=new kpe}get power(){return this.intensity*4*Math.PI}set power(i){this.intensity=i/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(i,s){return super.copy(i,s),this.distance=i.distance,this.decay=i.decay,this.shadow=i.shadow.clone(),this}}class Ape extends W5{constructor(i,s){super(i,s),this.isAmbientLight=!0,this.type="AmbientLight"}}class jV{constructor(i=1,s=0,a=0){return this.radius=i,this.phi=s,this.theta=a,this}set(i,s,a){return this.radius=i,this.phi=s,this.theta=a,this}copy(i){return this.radius=i.radius,this.phi=i.phi,this.theta=i.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(i){return this.setFromCartesianCoords(i.x,i.y,i.z)}setFromCartesianCoords(i,s,a){return this.radius=Math.sqrt(i*i+s*s+a*a),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(i,a),this.phi=Math.acos(Ip(s/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Ope extends _pe{constructor(i=1){const s=[0,0,0,i,0,0,0,0,0,0,i,0,0,0,0,0,0,i],a=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new Dy;r.setAttribute("position",new zp(s,3)),r.setAttribute("color",new zp(a,3));const c=new Bq({vertexColors:!0,toneMapped:!1});super(r,c),this.type="AxesHelper"}setColors(i,s,a){const r=new bs,c=this.geometry.attributes.color.array;return r.set(i),r.toArray(c,0),r.toArray(c,3),r.set(s),r.toArray(c,6),r.toArray(c,9),r.set(a),r.toArray(c,12),r.toArray(c,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:L5}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=L5);class Tpe{constructor(){this.DEFAULT_CAMERA=new FR(-50,50,50,-50,-1500,1500),this.DEFAULT_CAMERA.name="CameraBoxy",this.DEFAULT_CAMERA.position.set(0,0,1e3),this.container=null,this.width=100,this.height=100,this.scene=null,this.camera=this.DEFAULT_CAMERA.clone(),this.renderer=null,this.light=null,this.objects=[],this.timer=null,this.video=null,this.videoScale=null,this.scale=1,this.predictions=[]}init(i){const s=this;this.container=i,this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.scene=new xpe,this.scene.background=new bs("#ffffff"),this.renderer=new Lq({}),this.renderer.setClearColor(0,0),this.renderer.setSize(this.width,this.height),this.container.appendChild(this.renderer.domElement),this.renderer.domElement.style.position="absolute",this.setCamera(),window.addEventListener("resize",function(){clearTimeout(s.timer),s.timer=setTimeout(function(){s.width=s.container.offsetWidth,s.height=s.container.offsetHeight,s.camera.left=-s.width*.5,s.camera.right=s.width*.5,s.camera.top=s.height*.5,s.camera.bottom=-s.height*.5,s.camera.updateProjectionMatrix(),s.renderer.setSize(s.width,s.height),s.videoScale={width:s.width/s.video.videoWidth,height:s.height/s.video.videoHeight}},500)})}setCamera(){const{width:i,height:s}=this;this.camera=new FR(-i*.5,i*.5,s*.5,-s*.5,-1500,1500),this.camera.position.copy(new cr(0,0,1e3)),this.camera.zoom=1,this.camera.updateProjectionMatrix(),this.scene.add(this.camera)}setLight(){const i=new Ape(16777215,.3);this.scene.add(i);const s=new ES(16777215,.1,0),a=new ES(16777215,.1,0),r=new ES(16777215,.1,0),c=new ES(16777215,.1,0),S=new ES(16777215,.3,0);s.position.set(1e3,1e3,1e3),a.position.set(-1e3,1e3,1e3),r.position.set(1e3,-1e3,1e3),c.position.set(-1e3,-1e3,1e3),S.position.set(0,0,1e3),this.camera.add(s),this.camera.add(a),this.camera.add(r),this.camera.add(c),this.camera.add(S);const E=new Spe(7693392,4547202,.1);this.scene.add(E)}animate(){window.requestAnimationFrame(this.animate.bind(this)),qq.update(),this.render()}render(){this.renderer.render(this.scene,this.camera)}addMesh(i){return this.scene.add(i),i}getMesh(i){const s=this.scene.getObjectByName(i);return s||null}}const zV={type:"change"},TF={type:"start"},UV={type:"end"};class Mpe extends rx{constructor(i,s){super(),this.object=i,this.domElement=s,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new cr,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:O1.ROTATE,MIDDLE:O1.DOLLY,RIGHT:O1.PAN},this.touches={ONE:b2.ROTATE,TWO:b2.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return E.phi},this.getAzimuthalAngle=function(){return E.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(Dt){Dt.addEventListener("keydown",Mr),this._domElementKeyEvents=Dt},this.saveState=function(){a.target0.copy(a.target),a.position0.copy(a.object.position),a.zoom0=a.object.zoom},this.reset=function(){a.target.copy(a.target0),a.object.position.copy(a.position0),a.object.zoom=a.zoom0,a.object.updateProjectionMatrix(),a.dispatchEvent(zV),a.update(),c=r.NONE},this.update=function(){const Dt=new cr,On=new Qb().setFromUnitVectors(i.up,new cr(0,1,0)),or=On.clone().invert(),ar=new cr,yr=new Qb,kr=2*Math.PI;return function(){const oi=a.object.position;Dt.copy(oi).sub(a.target),Dt.applyQuaternion(On),E.setFromVector3(Dt),a.autoRotate&&c===r.NONE&&me(_e()),a.enableDamping?(E.theta+=A.theta*a.dampingFactor,E.phi+=A.phi*a.dampingFactor):(E.theta+=A.theta,E.phi+=A.phi);let Ur=a.minAzimuthAngle,Xr=a.maxAzimuthAngle;return isFinite(Ur)&&isFinite(Xr)&&(Ur<-Math.PI?Ur+=kr:Ur>Math.PI&&(Ur-=kr),Xr<-Math.PI?Xr+=kr:Xr>Math.PI&&(Xr-=kr),Ur<=Xr?E.theta=Math.max(Ur,Math.min(Xr,E.theta)):E.theta=E.theta>(Ur+Xr)/2?Math.max(Ur,E.theta):Math.min(Xr,E.theta)),E.phi=Math.max(a.minPolarAngle,Math.min(a.maxPolarAngle,E.phi)),E.makeSafe(),E.radius*=U,E.radius=Math.max(a.minDistance,Math.min(a.maxDistance,E.radius)),a.enableDamping===!0?a.target.addScaledVector(B,a.dampingFactor):a.target.add(B),Dt.setFromSpherical(E),Dt.applyQuaternion(or),oi.copy(a.target).add(Dt),a.object.lookAt(a.target),a.enableDamping===!0?(A.theta*=1-a.dampingFactor,A.phi*=1-a.dampingFactor,B.multiplyScalar(1-a.dampingFactor)):(A.set(0,0,0),B.set(0,0,0)),U=1,D||ar.distanceToSquared(a.object.position)>S||8*(1-yr.dot(a.object.quaternion))>S?(a.dispatchEvent(zV),ar.copy(a.object.position),yr.copy(a.object.quaternion),D=!1,!0):!1}}(),this.dispose=function(){a.domElement.removeEventListener("contextmenu",Hn),a.domElement.removeEventListener("pointerdown",$t),a.domElement.removeEventListener("pointercancel",An),a.domElement.removeEventListener("wheel",sr),a.domElement.removeEventListener("pointermove",Jt),a.domElement.removeEventListener("pointerup",Pn),a._domElementKeyEvents!==null&&a._domElementKeyEvents.removeEventListener("keydown",Mr)};const a=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let c=r.NONE;const S=1e-6,E=new jV,A=new jV;let U=1;const B=new cr;let D=!1;const R=new Eo,W=new Eo,j=new Eo,H=new Eo,I=new Eo,Q=new Eo,Y=new Eo,q=new Eo,ae=new Eo,oe=[],ye={};function _e(){return 2*Math.PI/60/60*a.autoRotateSpeed}function pe(){return Math.pow(.95,a.zoomSpeed)}function me(Dt){A.theta-=Dt}function Ge(Dt){A.phi-=Dt}const lt=function(){const Dt=new cr;return function(or,ar){Dt.setFromMatrixColumn(ar,0),Dt.multiplyScalar(-or),B.add(Dt)}}(),It=function(){const Dt=new cr;return function(or,ar){a.screenSpacePanning===!0?Dt.setFromMatrixColumn(ar,1):(Dt.setFromMatrixColumn(ar,0),Dt.crossVectors(a.object.up,Dt)),Dt.multiplyScalar(or),B.add(Dt)}}(),wt=function(){const Dt=new cr;return function(or,ar){const yr=a.domElement;if(a.object.isPerspectiveCamera){const kr=a.object.position;Dt.copy(kr).sub(a.target);let dr=Dt.length();dr*=Math.tan(a.object.fov/2*Math.PI/180),lt(2*or*dr/yr.clientHeight,a.object.matrix),It(2*ar*dr/yr.clientHeight,a.object.matrix)}else a.object.isOrthographicCamera?(lt(or*(a.object.right-a.object.left)/a.object.zoom/yr.clientWidth,a.object.matrix),It(ar*(a.object.top-a.object.bottom)/a.object.zoom/yr.clientHeight,a.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),a.enablePan=!1)}}();function we(Dt){a.object.isPerspectiveCamera?U/=Dt:a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom*Dt)),a.object.updateProjectionMatrix(),D=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function yt(Dt){a.object.isPerspectiveCamera?U*=Dt:a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom/Dt)),a.object.updateProjectionMatrix(),D=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function Bt(Dt){R.set(Dt.clientX,Dt.clientY)}function Ot(Dt){Y.set(Dt.clientX,Dt.clientY)}function ze(Dt){H.set(Dt.clientX,Dt.clientY)}function Ut(Dt){W.set(Dt.clientX,Dt.clientY),j.subVectors(W,R).multiplyScalar(a.rotateSpeed);const On=a.domElement;me(2*Math.PI*j.x/On.clientHeight),Ge(2*Math.PI*j.y/On.clientHeight),R.copy(W),a.update()}function Ft(Dt){q.set(Dt.clientX,Dt.clientY),ae.subVectors(q,Y),ae.y>0?we(pe()):ae.y<0&&yt(pe()),Y.copy(q),a.update()}function pt(Dt){I.set(Dt.clientX,Dt.clientY),Q.subVectors(I,H).multiplyScalar(a.panSpeed),wt(Q.x,Q.y),H.copy(I),a.update()}function vt(Dt){Dt.deltaY<0?yt(pe()):Dt.deltaY>0&&we(pe()),a.update()}function rn(Dt){let On=!1;switch(Dt.code){case a.keys.UP:Dt.ctrlKey||Dt.metaKey||Dt.shiftKey?Ge(2*Math.PI*a.rotateSpeed/a.domElement.clientHeight):wt(0,a.keyPanSpeed),On=!0;break;case a.keys.BOTTOM:Dt.ctrlKey||Dt.metaKey||Dt.shiftKey?Ge(-2*Math.PI*a.rotateSpeed/a.domElement.clientHeight):wt(0,-a.keyPanSpeed),On=!0;break;case a.keys.LEFT:Dt.ctrlKey||Dt.metaKey||Dt.shiftKey?me(2*Math.PI*a.rotateSpeed/a.domElement.clientHeight):wt(a.keyPanSpeed,0),On=!0;break;case a.keys.RIGHT:Dt.ctrlKey||Dt.metaKey||Dt.shiftKey?me(-2*Math.PI*a.rotateSpeed/a.domElement.clientHeight):wt(-a.keyPanSpeed,0),On=!0;break}On&&(Dt.preventDefault(),a.update())}function xt(){if(oe.length===1)R.set(oe[0].pageX,oe[0].pageY);else{const Dt=.5*(oe[0].pageX+oe[1].pageX),On=.5*(oe[0].pageY+oe[1].pageY);R.set(Dt,On)}}function _t(){if(oe.length===1)H.set(oe[0].pageX,oe[0].pageY);else{const Dt=.5*(oe[0].pageX+oe[1].pageX),On=.5*(oe[0].pageY+oe[1].pageY);H.set(Dt,On)}}function Xt(){const Dt=oe[0].pageX-oe[1].pageX,On=oe[0].pageY-oe[1].pageY,or=Math.sqrt(Dt*Dt+On*On);Y.set(0,or)}function sn(){a.enableZoom&&Xt(),a.enablePan&&_t()}function kn(){a.enableZoom&&Xt(),a.enableRotate&&xt()}function an(Dt){if(oe.length==1)W.set(Dt.pageX,Dt.pageY);else{const or=Vn(Dt),ar=.5*(Dt.pageX+or.x),yr=.5*(Dt.pageY+or.y);W.set(ar,yr)}j.subVectors(W,R).multiplyScalar(a.rotateSpeed);const On=a.domElement;me(2*Math.PI*j.x/On.clientHeight),Ge(2*Math.PI*j.y/On.clientHeight),R.copy(W)}function Ve(Dt){if(oe.length===1)I.set(Dt.pageX,Dt.pageY);else{const On=Vn(Dt),or=.5*(Dt.pageX+On.x),ar=.5*(Dt.pageY+On.y);I.set(or,ar)}Q.subVectors(I,H).multiplyScalar(a.panSpeed),wt(Q.x,Q.y),H.copy(I)}function Ye(Dt){const On=Vn(Dt),or=Dt.pageX-On.x,ar=Dt.pageY-On.y,yr=Math.sqrt(or*or+ar*ar);q.set(0,yr),ae.set(0,Math.pow(q.y/Y.y,a.zoomSpeed)),we(ae.y),Y.copy(q)}function $e(Dt){a.enableZoom&&Ye(Dt),a.enablePan&&Ve(Dt)}function ft(Dt){a.enableZoom&&Ye(Dt),a.enableRotate&&an(Dt)}function $t(Dt){a.enabled!==!1&&(oe.length===0&&(a.domElement.setPointerCapture(Dt.pointerId),a.domElement.addEventListener("pointermove",Jt),a.domElement.addEventListener("pointerup",Pn)),Kt(Dt),Dt.pointerType==="touch"?on(Dt):Qn(Dt))}function Jt(Dt){a.enabled!==!1&&(Dt.pointerType==="touch"?Gt(Dt):Ce(Dt))}function Pn(Dt){Vt(Dt),oe.length===0&&(a.domElement.releasePointerCapture(Dt.pointerId),a.domElement.removeEventListener("pointermove",Jt),a.domElement.removeEventListener("pointerup",Pn)),a.dispatchEvent(UV),c=r.NONE}function An(Dt){Vt(Dt)}function Qn(Dt){let On;switch(Dt.button){case 0:On=a.mouseButtons.LEFT;break;case 1:On=a.mouseButtons.MIDDLE;break;case 2:On=a.mouseButtons.RIGHT;break;default:On=-1}switch(On){case O1.DOLLY:if(a.enableZoom===!1)return;Ot(Dt),c=r.DOLLY;break;case O1.ROTATE:if(Dt.ctrlKey||Dt.metaKey||Dt.shiftKey){if(a.enablePan===!1)return;ze(Dt),c=r.PAN}else{if(a.enableRotate===!1)return;Bt(Dt),c=r.ROTATE}break;case O1.PAN:if(Dt.ctrlKey||Dt.metaKey||Dt.shiftKey){if(a.enableRotate===!1)return;Bt(Dt),c=r.ROTATE}else{if(a.enablePan===!1)return;ze(Dt),c=r.PAN}break;default:c=r.NONE}c!==r.NONE&&a.dispatchEvent(TF)}function Ce(Dt){switch(c){case r.ROTATE:if(a.enableRotate===!1)return;Ut(Dt);break;case r.DOLLY:if(a.enableZoom===!1)return;Ft(Dt);break;case r.PAN:if(a.enablePan===!1)return;pt(Dt);break}}function sr(Dt){a.enabled===!1||a.enableZoom===!1||c!==r.NONE||(Dt.preventDefault(),a.dispatchEvent(TF),vt(Dt),a.dispatchEvent(UV))}function Mr(Dt){a.enabled===!1||a.enablePan===!1||rn(Dt)}function on(Dt){switch(en(Dt),oe.length){case 1:switch(a.touches.ONE){case b2.ROTATE:if(a.enableRotate===!1)return;xt(),c=r.TOUCH_ROTATE;break;case b2.PAN:if(a.enablePan===!1)return;_t(),c=r.TOUCH_PAN;break;default:c=r.NONE}break;case 2:switch(a.touches.TWO){case b2.DOLLY_PAN:if(a.enableZoom===!1&&a.enablePan===!1)return;sn(),c=r.TOUCH_DOLLY_PAN;break;case b2.DOLLY_ROTATE:if(a.enableZoom===!1&&a.enableRotate===!1)return;kn(),c=r.TOUCH_DOLLY_ROTATE;break;default:c=r.NONE}break;default:c=r.NONE}c!==r.NONE&&a.dispatchEvent(TF)}function Gt(Dt){switch(en(Dt),c){case r.TOUCH_ROTATE:if(a.enableRotate===!1)return;an(Dt),a.update();break;case r.TOUCH_PAN:if(a.enablePan===!1)return;Ve(Dt),a.update();break;case r.TOUCH_DOLLY_PAN:if(a.enableZoom===!1&&a.enablePan===!1)return;$e(Dt),a.update();break;case r.TOUCH_DOLLY_ROTATE:if(a.enableZoom===!1&&a.enableRotate===!1)return;ft(Dt),a.update();break;default:c=r.NONE}}function Hn(Dt){a.enabled!==!1&&Dt.preventDefault()}function Kt(Dt){oe.push(Dt)}function Vt(Dt){delete ye[Dt.pointerId];for(let On=0;On<oe.length;On++)if(oe[On].pointerId==Dt.pointerId){oe.splice(On,1);return}}function en(Dt){let On=ye[Dt.pointerId];On===void 0&&(On=new Eo,ye[Dt.pointerId]=On),On.set(Dt.pageX,Dt.pageY)}function Vn(Dt){const On=Dt.pointerId===oe[0].pointerId?oe[1]:oe[0];return ye[On.pointerId]}a.domElement.addEventListener("contextmenu",Hn),a.domElement.addEventListener("pointerdown",$t),a.domElement.addEventListener("pointercancel",An),a.domElement.addEventListener("wheel",sr,{passive:!1}),this.update()}}const MF={type:"change"},DF={type:"start"},NF={type:"end"};class Dpe extends rx{constructor(i,s){super();const a=this,r={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=i,this.domElement=s,this.domElement.style.touchAction="none",this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:O1.ROTATE,MIDDLE:O1.DOLLY,RIGHT:O1.PAN},this.target=new cr;const c=1e-6,S=new cr;let E=1,A=r.NONE,U=r.NONE,B=0,D=0,R=0;const W=new cr,j=new Eo,H=new Eo,I=new cr,Q=new Eo,Y=new Eo,q=new Eo,ae=new Eo,oe=[],ye={};this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,this.handleResize=function(){const sn=a.domElement.getBoundingClientRect(),kn=a.domElement.ownerDocument.documentElement;a.screen.left=sn.left+window.pageXOffset-kn.clientLeft,a.screen.top=sn.top+window.pageYOffset-kn.clientTop,a.screen.width=sn.width,a.screen.height=sn.height};const _e=function(){const sn=new Eo;return function(an,Ve){return sn.set((an-a.screen.left)/a.screen.width,(Ve-a.screen.top)/a.screen.height),sn}}(),pe=function(){const sn=new Eo;return function(an,Ve){return sn.set((an-a.screen.width*.5-a.screen.left)/(a.screen.width*.5),(a.screen.height+2*(a.screen.top-Ve))/a.screen.width),sn}}();this.rotateCamera=function(){const sn=new cr,kn=new Qb,an=new cr,Ve=new cr,Ye=new cr,$e=new cr;return function(){$e.set(H.x-j.x,H.y-j.y,0);let $t=$e.length();$t?(W.copy(a.object.position).sub(a.target),an.copy(W).normalize(),Ve.copy(a.object.up).normalize(),Ye.crossVectors(Ve,an).normalize(),Ve.setLength(H.y-j.y),Ye.setLength(H.x-j.x),$e.copy(Ve.add(Ye)),sn.crossVectors($e,W).normalize(),$t*=a.rotateSpeed,kn.setFromAxisAngle(sn,$t),W.applyQuaternion(kn),a.object.up.applyQuaternion(kn),I.copy(sn),R=$t):!a.staticMoving&&R&&(R*=Math.sqrt(1-a.dynamicDampingFactor),W.copy(a.object.position).sub(a.target),kn.setFromAxisAngle(I,R),W.applyQuaternion(kn),a.object.up.applyQuaternion(kn)),j.copy(H)}}(),this.zoomCamera=function(){let sn;A===r.TOUCH_ZOOM_PAN?(sn=B/D,B=D,a.object.isPerspectiveCamera?W.multiplyScalar(sn):a.object.isOrthographicCamera?(a.object.zoom/=sn,a.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(sn=1+(Y.y-Q.y)*a.zoomSpeed,sn!==1&&sn>0&&(a.object.isPerspectiveCamera?W.multiplyScalar(sn):a.object.isOrthographicCamera?(a.object.zoom/=sn,a.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),a.staticMoving?Q.copy(Y):Q.y+=(Y.y-Q.y)*this.dynamicDampingFactor)},this.panCamera=function(){const sn=new Eo,kn=new cr,an=new cr;return function(){if(sn.copy(ae).sub(q),sn.lengthSq()){if(a.object.isOrthographicCamera){const Ye=(a.object.right-a.object.left)/a.object.zoom/a.domElement.clientWidth,$e=(a.object.top-a.object.bottom)/a.object.zoom/a.domElement.clientWidth;sn.x*=Ye,sn.y*=$e}sn.multiplyScalar(W.length()*a.panSpeed),an.copy(W).cross(a.object.up).setLength(sn.x),an.add(kn.copy(a.object.up).setLength(sn.y)),a.object.position.add(an),a.target.add(an),a.staticMoving?q.copy(ae):q.add(sn.subVectors(ae,q).multiplyScalar(a.dynamicDampingFactor))}}}(),this.checkDistances=function(){(!a.noZoom||!a.noPan)&&(W.lengthSq()>a.maxDistance*a.maxDistance&&(a.object.position.addVectors(a.target,W.setLength(a.maxDistance)),Q.copy(Y)),W.lengthSq()<a.minDistance*a.minDistance&&(a.object.position.addVectors(a.target,W.setLength(a.minDistance)),Q.copy(Y)))},this.update=function(){W.subVectors(a.object.position,a.target),a.noRotate||a.rotateCamera(),a.noZoom||a.zoomCamera(),a.noPan||a.panCamera(),a.object.position.addVectors(a.target,W),a.object.isPerspectiveCamera?(a.checkDistances(),a.object.lookAt(a.target),S.distanceToSquared(a.object.position)>c&&(a.dispatchEvent(MF),S.copy(a.object.position))):a.object.isOrthographicCamera?(a.object.lookAt(a.target),(S.distanceToSquared(a.object.position)>c||E!==a.object.zoom)&&(a.dispatchEvent(MF),S.copy(a.object.position),E=a.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){A=r.NONE,U=r.NONE,a.target.copy(a.target0),a.object.position.copy(a.position0),a.object.up.copy(a.up0),a.object.zoom=a.zoom0,a.object.updateProjectionMatrix(),W.subVectors(a.object.position,a.target),a.object.lookAt(a.target),a.dispatchEvent(MF),S.copy(a.object.position),E=a.object.zoom};function me(sn){a.enabled!==!1&&(oe.length===0&&(a.domElement.setPointerCapture(sn.pointerId),a.domElement.addEventListener("pointermove",Ge),a.domElement.addEventListener("pointerup",lt)),rn(sn),sn.pointerType==="touch"?Ut(sn):yt(sn))}function Ge(sn){a.enabled!==!1&&(sn.pointerType==="touch"?Ft(sn):Bt(sn))}function lt(sn){a.enabled!==!1&&(sn.pointerType==="touch"?pt(sn):Ot(),xt(sn),oe.length===0&&(a.domElement.releasePointerCapture(sn.pointerId),a.domElement.removeEventListener("pointermove",Ge),a.domElement.removeEventListener("pointerup",lt)))}function It(sn){xt(sn)}function wt(sn){a.enabled!==!1&&(window.removeEventListener("keydown",wt),U===r.NONE&&(sn.code===a.keys[r.ROTATE]&&!a.noRotate?U=r.ROTATE:sn.code===a.keys[r.ZOOM]&&!a.noZoom?U=r.ZOOM:sn.code===a.keys[r.PAN]&&!a.noPan&&(U=r.PAN)))}function we(){a.enabled!==!1&&(U=r.NONE,window.addEventListener("keydown",wt))}function yt(sn){if(A===r.NONE)switch(sn.button){case a.mouseButtons.LEFT:A=r.ROTATE;break;case a.mouseButtons.MIDDLE:A=r.ZOOM;break;case a.mouseButtons.RIGHT:A=r.PAN;break}const kn=U!==r.NONE?U:A;kn===r.ROTATE&&!a.noRotate?(H.copy(pe(sn.pageX,sn.pageY)),j.copy(H)):kn===r.ZOOM&&!a.noZoom?(Q.copy(_e(sn.pageX,sn.pageY)),Y.copy(Q)):kn===r.PAN&&!a.noPan&&(q.copy(_e(sn.pageX,sn.pageY)),ae.copy(q)),a.dispatchEvent(DF)}function Bt(sn){const kn=U!==r.NONE?U:A;kn===r.ROTATE&&!a.noRotate?(j.copy(H),H.copy(pe(sn.pageX,sn.pageY))):kn===r.ZOOM&&!a.noZoom?Y.copy(_e(sn.pageX,sn.pageY)):kn===r.PAN&&!a.noPan&&ae.copy(_e(sn.pageX,sn.pageY))}function Ot(){A=r.NONE,a.dispatchEvent(NF)}function ze(sn){if(a.enabled!==!1&&a.noZoom!==!0){switch(sn.preventDefault(),sn.deltaMode){case 2:Q.y-=sn.deltaY*.025;break;case 1:Q.y-=sn.deltaY*.01;break;default:Q.y-=sn.deltaY*25e-5;break}a.dispatchEvent(DF),a.dispatchEvent(NF)}}function Ut(sn){switch(_t(sn),oe.length){case 1:A=r.TOUCH_ROTATE,H.copy(pe(oe[0].pageX,oe[0].pageY)),j.copy(H);break;default:A=r.TOUCH_ZOOM_PAN;const kn=oe[0].pageX-oe[1].pageX,an=oe[0].pageY-oe[1].pageY;D=B=Math.sqrt(kn*kn+an*an);const Ve=(oe[0].pageX+oe[1].pageX)/2,Ye=(oe[0].pageY+oe[1].pageY)/2;q.copy(_e(Ve,Ye)),ae.copy(q);break}a.dispatchEvent(DF)}function Ft(sn){switch(_t(sn),oe.length){case 1:j.copy(H),H.copy(pe(sn.pageX,sn.pageY));break;default:const kn=Xt(sn),an=sn.pageX-kn.x,Ve=sn.pageY-kn.y;D=Math.sqrt(an*an+Ve*Ve);const Ye=(sn.pageX+kn.x)/2,$e=(sn.pageY+kn.y)/2;ae.copy(_e(Ye,$e));break}}function pt(sn){switch(oe.length){case 0:A=r.NONE;break;case 1:A=r.TOUCH_ROTATE,H.copy(pe(sn.pageX,sn.pageY)),j.copy(H);break;case 2:A=r.TOUCH_ZOOM_PAN;for(let kn=0;kn<oe.length;kn++)if(oe[kn].pointerId!==sn.pointerId){const an=ye[oe[kn].pointerId];H.copy(pe(an.x,an.y)),j.copy(H);break}break}a.dispatchEvent(NF)}function vt(sn){a.enabled!==!1&&sn.preventDefault()}function rn(sn){oe.push(sn)}function xt(sn){delete ye[sn.pointerId];for(let kn=0;kn<oe.length;kn++)if(oe[kn].pointerId==sn.pointerId){oe.splice(kn,1);return}}function _t(sn){let kn=ye[sn.pointerId];kn===void 0&&(kn=new Eo,ye[sn.pointerId]=kn),kn.set(sn.pageX,sn.pageY)}function Xt(sn){const kn=sn.pointerId===oe[0].pointerId?oe[1]:oe[0];return ye[kn.pointerId]}this.dispose=function(){a.domElement.removeEventListener("contextmenu",vt),a.domElement.removeEventListener("pointerdown",me),a.domElement.removeEventListener("pointercancel",It),a.domElement.removeEventListener("wheel",ze),a.domElement.removeEventListener("pointermove",Ge),a.domElement.removeEventListener("pointerup",lt),window.removeEventListener("keydown",wt),window.removeEventListener("keyup",we)},this.domElement.addEventListener("contextmenu",vt),this.domElement.addEventListener("pointerdown",me),this.domElement.addEventListener("pointercancel",It),this.domElement.addEventListener("wheel",ze,{passive:!1}),window.addEventListener("keydown",wt),window.addEventListener("keyup",we),this.handleResize(),this.update()}}class Npe{constructor(){this.orbitControl=null,this.trackballControl=null}update(){this.orbitControl&&this.orbitControl.update(),this.trackballControl&&this.trackballControl.update()}setOrbitControl(){this.orbitControl=new Mpe(Hu.camera,Hu.renderer.domElement),this.orbitControl.update()}setTrackballControl(){this.trackballControl=new Dpe(Hu.camera,Hu.renderer.domElement),this.trackballControl.update()}}class Ipe{constructor(){}addMultiSphere(i,s){for(let a=0;a<s;a++){const r=new U5(2,8,8),c=new AT({color:255}),S=new Ay(r,c);S.name=`${i}_${a}`,Hu.addMesh(S)}}updateMultiSphere(i,s){for(let a=0;a<s;a++){const r=Hu.predictions[0].scaledMesh[a],c=Hu.getMesh(`${i}_${a}`);c&&Hu.video&&(c.position.x=Hu.video.videoWidth*.5-r[0],c.position.y=Hu.video.videoHeight*.5-r[1])}}}function Fpe(h){if(h&&!(typeof window>"u")){var i=document.createElement("style");return i.setAttribute("type","text/css"),i.innerHTML=h,document.head.appendChild(i),h}}function Y2(h,i){var s=h.__state.conversionName.toString(),a=Math.round(h.r),r=Math.round(h.g),c=Math.round(h.b),S=h.a,E=Math.round(h.h),A=h.s.toFixed(1),U=h.v.toFixed(1);if(i||s==="THREE_CHAR_HEX"||s==="SIX_CHAR_HEX"){for(var B=h.hex.toString(16);B.length<6;)B="0"+B;return"#"+B}else{if(s==="CSS_RGB")return"rgb("+a+","+r+","+c+")";if(s==="CSS_RGBA")return"rgba("+a+","+r+","+c+","+S+")";if(s==="HEX")return"0x"+h.hex.toString(16);if(s==="RGB_ARRAY")return"["+a+","+r+","+c+"]";if(s==="RGBA_ARRAY")return"["+a+","+r+","+c+","+S+"]";if(s==="RGB_OBJ")return"{r:"+a+",g:"+r+",b:"+c+"}";if(s==="RGBA_OBJ")return"{r:"+a+",g:"+r+",b:"+c+",a:"+S+"}";if(s==="HSV_OBJ")return"{h:"+E+",s:"+A+",v:"+U+"}";if(s==="HSVA_OBJ")return"{h:"+E+",s:"+A+",v:"+U+",a:"+S+"}"}return"unknown format"}var WV=Array.prototype.forEach,SS=Array.prototype.slice,ti={BREAK:{},extend:function(i){return this.each(SS.call(arguments,1),function(s){var a=this.isObject(s)?Object.keys(s):[];a.forEach(function(r){this.isUndefined(s[r])||(i[r]=s[r])}.bind(this))},this),i},defaults:function(i){return this.each(SS.call(arguments,1),function(s){var a=this.isObject(s)?Object.keys(s):[];a.forEach(function(r){this.isUndefined(i[r])&&(i[r]=s[r])}.bind(this))},this),i},compose:function(){var i=SS.call(arguments);return function(){for(var s=SS.call(arguments),a=i.length-1;a>=0;a--)s=[i[a].apply(this,s)];return s[0]}},each:function(i,s,a){if(i){if(WV&&i.forEach&&i.forEach===WV)i.forEach(s,a);else if(i.length===i.length+0){var r=void 0,c=void 0;for(r=0,c=i.length;r<c;r++)if(r in i&&s.call(a,i[r],r)===this.BREAK)return}else for(var S in i)if(s.call(a,i[S],S)===this.BREAK)return}},defer:function(i){setTimeout(i,0)},debounce:function(i,s,a){var r=void 0;return function(){var c=this,S=arguments;function E(){r=null,a||i.apply(c,S)}var A=a||!r;clearTimeout(r),r=setTimeout(E,s),A&&i.apply(c,S)}},toArray:function(i){return i.toArray?i.toArray():SS.call(i)},isUndefined:function(i){return i===void 0},isNull:function(i){return i===null},isNaN:function(h){function i(s){return h.apply(this,arguments)}return i.toString=function(){return h.toString()},i}(function(h){return isNaN(h)}),isArray:Array.isArray||function(h){return h.constructor===Array},isObject:function(i){return i===Object(i)},isNumber:function(i){return i===i+0},isString:function(i){return i===i+""},isBoolean:function(i){return i===!1||i===!0},isFunction:function(i){return i instanceof Function}},Rpe=[{litmus:ti.isString,conversions:{THREE_CHAR_HEX:{read:function(i){var s=i.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return s===null?!1:{space:"HEX",hex:parseInt("0x"+s[1].toString()+s[1].toString()+s[2].toString()+s[2].toString()+s[3].toString()+s[3].toString(),0)}},write:Y2},SIX_CHAR_HEX:{read:function(i){var s=i.match(/^#([A-F0-9]{6})$/i);return s===null?!1:{space:"HEX",hex:parseInt("0x"+s[1].toString(),0)}},write:Y2},CSS_RGB:{read:function(i){var s=i.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return s===null?!1:{space:"RGB",r:parseFloat(s[1]),g:parseFloat(s[2]),b:parseFloat(s[3])}},write:Y2},CSS_RGBA:{read:function(i){var s=i.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return s===null?!1:{space:"RGB",r:parseFloat(s[1]),g:parseFloat(s[2]),b:parseFloat(s[3]),a:parseFloat(s[4])}},write:Y2}}},{litmus:ti.isNumber,conversions:{HEX:{read:function(i){return{space:"HEX",hex:i,conversionName:"HEX"}},write:function(i){return i.hex}}}},{litmus:ti.isArray,conversions:{RGB_ARRAY:{read:function(i){return i.length!==3?!1:{space:"RGB",r:i[0],g:i[1],b:i[2]}},write:function(i){return[i.r,i.g,i.b]}},RGBA_ARRAY:{read:function(i){return i.length!==4?!1:{space:"RGB",r:i[0],g:i[1],b:i[2],a:i[3]}},write:function(i){return[i.r,i.g,i.b,i.a]}}}},{litmus:ti.isObject,conversions:{RGBA_OBJ:{read:function(i){return ti.isNumber(i.r)&&ti.isNumber(i.g)&&ti.isNumber(i.b)&&ti.isNumber(i.a)?{space:"RGB",r:i.r,g:i.g,b:i.b,a:i.a}:!1},write:function(i){return{r:i.r,g:i.g,b:i.b,a:i.a}}},RGB_OBJ:{read:function(i){return ti.isNumber(i.r)&&ti.isNumber(i.g)&&ti.isNumber(i.b)?{space:"RGB",r:i.r,g:i.g,b:i.b}:!1},write:function(i){return{r:i.r,g:i.g,b:i.b}}},HSVA_OBJ:{read:function(i){return ti.isNumber(i.h)&&ti.isNumber(i.s)&&ti.isNumber(i.v)&&ti.isNumber(i.a)?{space:"HSV",h:i.h,s:i.s,v:i.v,a:i.a}:!1},write:function(i){return{h:i.h,s:i.s,v:i.v,a:i.a}}},HSV_OBJ:{read:function(i){return ti.isNumber(i.h)&&ti.isNumber(i.s)&&ti.isNumber(i.v)?{space:"HSV",h:i.h,s:i.s,v:i.v}:!1},write:function(i){return{h:i.h,s:i.s,v:i.v}}}}}],CS=void 0,vO=void 0,PR=function(){vO=!1;var i=arguments.length>1?ti.toArray(arguments):arguments[0];return ti.each(Rpe,function(s){if(s.litmus(i))return ti.each(s.conversions,function(a,r){if(CS=a.read(i),vO===!1&&CS!==!1)return vO=CS,CS.conversionName=r,CS.conversion=a,ti.BREAK}),ti.BREAK}),vO},VV=void 0,oT={hsv_to_rgb:function(i,s,a){var r=Math.floor(i/60)%6,c=i/60-Math.floor(i/60),S=a*(1-s),E=a*(1-c*s),A=a*(1-(1-c)*s),U=[[a,A,S],[E,a,S],[S,a,A],[S,E,a],[A,S,a],[a,S,E]][r];return{r:U[0]*255,g:U[1]*255,b:U[2]*255}},rgb_to_hsv:function(i,s,a){var r=Math.min(i,s,a),c=Math.max(i,s,a),S=c-r,E=void 0,A=void 0;if(c!==0)A=S/c;else return{h:NaN,s:0,v:0};return i===c?E=(s-a)/S:s===c?E=2+(a-i)/S:E=4+(i-s)/S,E/=6,E<0&&(E+=1),{h:E*360,s:A,v:c/255}},rgb_to_hex:function(i,s,a){var r=this.hex_with_component(0,2,i);return r=this.hex_with_component(r,1,s),r=this.hex_with_component(r,0,a),r},component_from_hex:function(i,s){return i>>s*8&255},hex_with_component:function(i,s,a){return a<<(VV=s*8)|i&~(255<<VV)}},Ppe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},av=function(h,i){if(!(h instanceof i))throw new TypeError("Cannot call a class as a function")},sv=function(){function h(i,s){for(var a=0;a<s.length;a++){var r=s[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(i,r.key,r)}}return function(i,s,a){return s&&h(i.prototype,s),a&&h(i,a),i}}(),Zb=function h(i,s,a){i===null&&(i=Function.prototype);var r=Object.getOwnPropertyDescriptor(i,s);if(r===void 0){var c=Object.getPrototypeOf(i);return c===null?void 0:h(c,s,a)}else{if("value"in r)return r.value;var S=r.get;return S===void 0?void 0:S.call(a)}},ix=function(h,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof i);h.prototype=Object.create(i&&i.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(h,i):h.__proto__=i)},ox=function(h,i){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i&&(typeof i=="object"||typeof i=="function")?i:h},Ol=function(){function h(){if(av(this,h),this.__state=PR.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return sv(h,[{key:"toString",value:function(){return Y2(this)}},{key:"toHexString",value:function(){return Y2(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),h}();function V5(h,i,s){Object.defineProperty(h,i,{get:function(){return this.__state.space==="RGB"?this.__state[i]:(Ol.recalculateRGB(this,i,s),this.__state[i])},set:function(r){this.__state.space!=="RGB"&&(Ol.recalculateRGB(this,i,s),this.__state.space="RGB"),this.__state[i]=r}})}function H5(h,i){Object.defineProperty(h,i,{get:function(){return this.__state.space==="HSV"?this.__state[i]:(Ol.recalculateHSV(this),this.__state[i])},set:function(a){this.__state.space!=="HSV"&&(Ol.recalculateHSV(this),this.__state.space="HSV"),this.__state[i]=a}})}Ol.recalculateRGB=function(h,i,s){if(h.__state.space==="HEX")h.__state[i]=oT.component_from_hex(h.__state.hex,s);else if(h.__state.space==="HSV")ti.extend(h.__state,oT.hsv_to_rgb(h.__state.h,h.__state.s,h.__state.v));else throw new Error("Corrupted color state")};Ol.recalculateHSV=function(h){var i=oT.rgb_to_hsv(h.r,h.g,h.b);ti.extend(h.__state,{s:i.s,v:i.v}),ti.isNaN(i.h)?ti.isUndefined(h.__state.h)&&(h.__state.h=0):h.__state.h=i.h};Ol.COMPONENTS=["r","g","b","h","s","v","hex","a"];V5(Ol.prototype,"r",2);V5(Ol.prototype,"g",1);V5(Ol.prototype,"b",0);H5(Ol.prototype,"h");H5(Ol.prototype,"s");H5(Ol.prototype,"v");Object.defineProperty(Ol.prototype,"a",{get:function(){return this.__state.a},set:function(i){this.__state.a=i}});Object.defineProperty(Ol.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=oT.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(i){this.__state.space="HEX",this.__state.hex=i}});var Sw=function(){function h(i,s){av(this,h),this.initialValue=i[s],this.domElement=document.createElement("div"),this.object=i,this.property=s,this.__onChange=void 0,this.__onFinishChange=void 0}return sv(h,[{key:"onChange",value:function(s){return this.__onChange=s,this}},{key:"onFinishChange",value:function(s){return this.__onFinishChange=s,this}},{key:"setValue",value:function(s){return this.object[this.property]=s,this.__onChange&&this.__onChange.call(this,s),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),h}(),Lpe={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},jq={};ti.each(Lpe,function(h,i){ti.each(h,function(s){jq[s]=i})});var Bpe=/(\d+(\.\d+)?)px/;function _y(h){if(h==="0"||ti.isUndefined(h))return 0;var i=h.match(Bpe);return ti.isNull(i)?0:parseFloat(i[1])}var Sr={makeSelectable:function(i,s){i===void 0||i.style===void 0||(i.onselectstart=s?function(){return!1}:function(){},i.style.MozUserSelect=s?"auto":"none",i.style.KhtmlUserSelect=s?"auto":"none",i.unselectable=s?"on":"off")},makeFullscreen:function(i,s,a){var r=a,c=s;ti.isUndefined(c)&&(c=!0),ti.isUndefined(r)&&(r=!0),i.style.position="absolute",c&&(i.style.left=0,i.style.right=0),r&&(i.style.top=0,i.style.bottom=0)},fakeEvent:function(i,s,a,r){var c=a||{},S=jq[s];if(!S)throw new Error("Event type "+s+" not supported.");var E=document.createEvent(S);switch(S){case"MouseEvents":{var A=c.x||c.clientX||0,U=c.y||c.clientY||0;E.initMouseEvent(s,c.bubbles||!1,c.cancelable||!0,window,c.clickCount||1,0,0,A,U,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var B=E.initKeyboardEvent||E.initKeyEvent;ti.defaults(c,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),B(s,c.bubbles||!1,c.cancelable,window,c.ctrlKey,c.altKey,c.shiftKey,c.metaKey,c.keyCode,c.charCode);break}default:{E.initEvent(s,c.bubbles||!1,c.cancelable||!0);break}}ti.defaults(E,r),i.dispatchEvent(E)},bind:function(i,s,a,r){var c=r||!1;return i.addEventListener?i.addEventListener(s,a,c):i.attachEvent&&i.attachEvent("on"+s,a),Sr},unbind:function(i,s,a,r){var c=r||!1;return i.removeEventListener?i.removeEventListener(s,a,c):i.detachEvent&&i.detachEvent("on"+s,a),Sr},addClass:function(i,s){if(i.className===void 0)i.className=s;else if(i.className!==s){var a=i.className.split(/ +/);a.indexOf(s)===-1&&(a.push(s),i.className=a.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return Sr},removeClass:function(i,s){if(s)if(i.className===s)i.removeAttribute("class");else{var a=i.className.split(/ +/),r=a.indexOf(s);r!==-1&&(a.splice(r,1),i.className=a.join(" "))}else i.className=void 0;return Sr},hasClass:function(i,s){return new RegExp("(?:^|\\s+)"+s+"(?:\\s+|$)").test(i.className)||!1},getWidth:function(i){var s=getComputedStyle(i);return _y(s["border-left-width"])+_y(s["border-right-width"])+_y(s["padding-left"])+_y(s["padding-right"])+_y(s.width)},getHeight:function(i){var s=getComputedStyle(i);return _y(s["border-top-width"])+_y(s["border-bottom-width"])+_y(s["padding-top"])+_y(s["padding-bottom"])+_y(s.height)},getOffset:function(i){var s=i,a={left:0,top:0};if(s.offsetParent)do a.left+=s.offsetLeft,a.top+=s.offsetTop,s=s.offsetParent;while(s);return a},isActive:function(i){return i===document.activeElement&&(i.type||i.href)}},zq=function(h){ix(i,h);function i(s,a){av(this,i);var r=ox(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,s,a)),c=r;r.__prev=r.getValue(),r.__checkbox=document.createElement("input"),r.__checkbox.setAttribute("type","checkbox");function S(){c.setValue(!c.__prev)}return Sr.bind(r.__checkbox,"change",S,!1),r.domElement.appendChild(r.__checkbox),r.updateDisplay(),r}return sv(i,[{key:"setValue",value:function(a){var r=Zb(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"setValue",this).call(this,a);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),r}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Zb(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"updateDisplay",this).call(this)}}]),i}(Sw),jpe=function(h){ix(i,h);function i(s,a,r){av(this,i);var c=ox(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,s,a)),S=r,E=c;if(c.__select=document.createElement("select"),ti.isArray(S)){var A={};ti.each(S,function(U){A[U]=U}),S=A}return ti.each(S,function(U,B){var D=document.createElement("option");D.innerHTML=B,D.setAttribute("value",U),E.__select.appendChild(D)}),c.updateDisplay(),Sr.bind(c.__select,"change",function(){var U=this.options[this.selectedIndex].value;E.setValue(U)}),c.domElement.appendChild(c.__select),c}return sv(i,[{key:"setValue",value:function(a){var r=Zb(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"setValue",this).call(this,a);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),r}},{key:"updateDisplay",value:function(){return Sr.isActive(this.__select)?this:(this.__select.value=this.getValue(),Zb(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"updateDisplay",this).call(this))}}]),i}(Sw),zpe=function(h){ix(i,h);function i(s,a){av(this,i);var r=ox(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,s,a)),c=r;function S(){c.setValue(c.__input.value)}function E(){c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),Sr.bind(r.__input,"keyup",S),Sr.bind(r.__input,"change",S),Sr.bind(r.__input,"blur",E),Sr.bind(r.__input,"keydown",function(A){A.keyCode===13&&this.blur()}),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return sv(i,[{key:"updateDisplay",value:function(){return Sr.isActive(this.__input)||(this.__input.value=this.getValue()),Zb(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"updateDisplay",this).call(this)}}]),i}(Sw);function HV(h){var i=h.toString();return i.indexOf(".")>-1?i.length-i.indexOf(".")-1:0}var Uq=function(h){ix(i,h);function i(s,a,r){av(this,i);var c=ox(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,s,a)),S=r||{};return c.__min=S.min,c.__max=S.max,c.__step=S.step,ti.isUndefined(c.__step)?c.initialValue===0?c.__impliedStep=1:c.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(c.initialValue))/Math.LN10))/10:c.__impliedStep=c.__step,c.__precision=HV(c.__impliedStep),c}return sv(i,[{key:"setValue",value:function(a){var r=a;return this.__min!==void 0&&r<this.__min?r=this.__min:this.__max!==void 0&&r>this.__max&&(r=this.__max),this.__step!==void 0&&r%this.__step!==0&&(r=Math.round(r/this.__step)*this.__step),Zb(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"setValue",this).call(this,r)}},{key:"min",value:function(a){return this.__min=a,this}},{key:"max",value:function(a){return this.__max=a,this}},{key:"step",value:function(a){return this.__step=a,this.__impliedStep=a,this.__precision=HV(a),this}}]),i}(Sw);function Upe(h,i){var s=Math.pow(10,i);return Math.round(h*s)/s}var aT=function(h){ix(i,h);function i(s,a,r){av(this,i);var c=ox(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,s,a,r));c.__truncationSuspended=!1;var S=c,E=void 0;function A(){var j=parseFloat(S.__input.value);ti.isNaN(j)||S.setValue(j)}function U(){S.__onFinishChange&&S.__onFinishChange.call(S,S.getValue())}function B(){U()}function D(j){var H=E-j.clientY;S.setValue(S.getValue()+H*S.__impliedStep),E=j.clientY}function R(){Sr.unbind(window,"mousemove",D),Sr.unbind(window,"mouseup",R),U()}function W(j){Sr.bind(window,"mousemove",D),Sr.bind(window,"mouseup",R),E=j.clientY}return c.__input=document.createElement("input"),c.__input.setAttribute("type","text"),Sr.bind(c.__input,"change",A),Sr.bind(c.__input,"blur",B),Sr.bind(c.__input,"mousedown",W),Sr.bind(c.__input,"keydown",function(j){j.keyCode===13&&(S.__truncationSuspended=!0,this.blur(),S.__truncationSuspended=!1,U())}),c.updateDisplay(),c.domElement.appendChild(c.__input),c}return sv(i,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():Upe(this.getValue(),this.__precision),Zb(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"updateDisplay",this).call(this)}}]),i}(Uq);function GV(h,i,s,a,r){return a+(r-a)*((h-i)/(s-i))}var LR=function(h){ix(i,h);function i(s,a,r,c,S){av(this,i);var E=ox(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,s,a,{min:r,max:c,step:S})),A=E;E.__background=document.createElement("div"),E.__foreground=document.createElement("div"),Sr.bind(E.__background,"mousedown",U),Sr.bind(E.__background,"touchstart",R),Sr.addClass(E.__background,"slider"),Sr.addClass(E.__foreground,"slider-fg");function U(H){document.activeElement.blur(),Sr.bind(window,"mousemove",B),Sr.bind(window,"mouseup",D),B(H)}function B(H){H.preventDefault();var I=A.__background.getBoundingClientRect();return A.setValue(GV(H.clientX,I.left,I.right,A.__min,A.__max)),!1}function D(){Sr.unbind(window,"mousemove",B),Sr.unbind(window,"mouseup",D),A.__onFinishChange&&A.__onFinishChange.call(A,A.getValue())}function R(H){H.touches.length===1&&(Sr.bind(window,"touchmove",W),Sr.bind(window,"touchend",j),W(H))}function W(H){var I=H.touches[0].clientX,Q=A.__background.getBoundingClientRect();A.setValue(GV(I,Q.left,Q.right,A.__min,A.__max))}function j(){Sr.unbind(window,"touchmove",W),Sr.unbind(window,"touchend",j),A.__onFinishChange&&A.__onFinishChange.call(A,A.getValue())}return E.updateDisplay(),E.__background.appendChild(E.__foreground),E.domElement.appendChild(E.__background),E}return sv(i,[{key:"updateDisplay",value:function(){var a=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=a*100+"%",Zb(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"updateDisplay",this).call(this)}}]),i}(Uq),Wq=function(h){ix(i,h);function i(s,a,r){av(this,i);var c=ox(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,s,a)),S=c;return c.__button=document.createElement("div"),c.__button.innerHTML=r===void 0?"Fire":r,Sr.bind(c.__button,"click",function(E){return E.preventDefault(),S.fire(),!1}),Sr.addClass(c.__button,"button"),c.domElement.appendChild(c.__button),c}return sv(i,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),i}(Sw),BR=function(h){ix(i,h);function i(s,a){av(this,i);var r=ox(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,s,a));r.__color=new Ol(r.getValue()),r.__temp=new Ol(0);var c=r;r.domElement=document.createElement("div"),Sr.makeSelectable(r.domElement,!1),r.__selector=document.createElement("div"),r.__selector.className="selector",r.__saturation_field=document.createElement("div"),r.__saturation_field.className="saturation-field",r.__field_knob=document.createElement("div"),r.__field_knob.className="field-knob",r.__field_knob_border="2px solid ",r.__hue_knob=document.createElement("div"),r.__hue_knob.className="hue-knob",r.__hue_field=document.createElement("div"),r.__hue_field.className="hue-field",r.__input=document.createElement("input"),r.__input.type="text",r.__input_textShadow="0 1px 1px ",Sr.bind(r.__input,"keydown",function(H){H.keyCode===13&&D.call(this)}),Sr.bind(r.__input,"blur",D),Sr.bind(r.__selector,"mousedown",function(){Sr.addClass(this,"drag").bind(window,"mouseup",function(){Sr.removeClass(c.__selector,"drag")})}),Sr.bind(r.__selector,"touchstart",function(){Sr.addClass(this,"drag").bind(window,"touchend",function(){Sr.removeClass(c.__selector,"drag")})});var S=document.createElement("div");ti.extend(r.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),ti.extend(r.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:r.__field_knob_border+(r.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),ti.extend(r.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),ti.extend(r.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),ti.extend(S.style,{width:"100%",height:"100%",background:"none"}),qV(S,"top","rgba(0,0,0,0)","#000"),ti.extend(r.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),Vpe(r.__hue_field),ti.extend(r.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:r.__input_textShadow+"rgba(0,0,0,0.7)"}),Sr.bind(r.__saturation_field,"mousedown",E),Sr.bind(r.__saturation_field,"touchstart",E),Sr.bind(r.__field_knob,"mousedown",E),Sr.bind(r.__field_knob,"touchstart",E),Sr.bind(r.__hue_field,"mousedown",A),Sr.bind(r.__hue_field,"touchstart",A);function E(H){W(H),Sr.bind(window,"mousemove",W),Sr.bind(window,"touchmove",W),Sr.bind(window,"mouseup",U),Sr.bind(window,"touchend",U)}function A(H){j(H),Sr.bind(window,"mousemove",j),Sr.bind(window,"touchmove",j),Sr.bind(window,"mouseup",B),Sr.bind(window,"touchend",B)}function U(){Sr.unbind(window,"mousemove",W),Sr.unbind(window,"touchmove",W),Sr.unbind(window,"mouseup",U),Sr.unbind(window,"touchend",U),R()}function B(){Sr.unbind(window,"mousemove",j),Sr.unbind(window,"touchmove",j),Sr.unbind(window,"mouseup",B),Sr.unbind(window,"touchend",B),R()}function D(){var H=PR(this.value);H!==!1?(c.__color.__state=H,c.setValue(c.__color.toOriginal())):this.value=c.__color.toString()}function R(){c.__onFinishChange&&c.__onFinishChange.call(c,c.__color.toOriginal())}r.__saturation_field.appendChild(S),r.__selector.appendChild(r.__field_knob),r.__selector.appendChild(r.__saturation_field),r.__selector.appendChild(r.__hue_field),r.__hue_field.appendChild(r.__hue_knob),r.domElement.appendChild(r.__input),r.domElement.appendChild(r.__selector),r.updateDisplay();function W(H){H.type.indexOf("touch")===-1&&H.preventDefault();var I=c.__saturation_field.getBoundingClientRect(),Q=H.touches&&H.touches[0]||H,Y=Q.clientX,q=Q.clientY,ae=(Y-I.left)/(I.right-I.left),oe=1-(q-I.top)/(I.bottom-I.top);return oe>1?oe=1:oe<0&&(oe=0),ae>1?ae=1:ae<0&&(ae=0),c.__color.v=oe,c.__color.s=ae,c.setValue(c.__color.toOriginal()),!1}function j(H){H.type.indexOf("touch")===-1&&H.preventDefault();var I=c.__hue_field.getBoundingClientRect(),Q=H.touches&&H.touches[0]||H,Y=Q.clientY,q=1-(Y-I.top)/(I.bottom-I.top);return q>1?q=1:q<0&&(q=0),c.__color.h=q*360,c.setValue(c.__color.toOriginal()),!1}return r}return sv(i,[{key:"updateDisplay",value:function(){var a=PR(this.getValue());if(a!==!1){var r=!1;ti.each(Ol.COMPONENTS,function(E){if(!ti.isUndefined(a[E])&&!ti.isUndefined(this.__color.__state[E])&&a[E]!==this.__color.__state[E])return r=!0,{}},this),r&&ti.extend(this.__color.__state,a)}ti.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var c=this.__color.v<.5||this.__color.s>.5?255:0,S=255-c;ti.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+c+","+c+","+c+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,qV(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),ti.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+c+","+c+","+c+")",textShadow:this.__input_textShadow+"rgba("+S+","+S+","+S+",.7)"})}}]),i}(Sw),Wpe=["-moz-","-o-","-webkit-","-ms-",""];function qV(h,i,s,a){h.style.background="",ti.each(Wpe,function(r){h.style.cssText+="background: "+r+"linear-gradient("+i+", "+s+" 0%, "+a+" 100%); "})}function Vpe(h){h.style.background="",h.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",h.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",h.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",h.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",h.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var Hpe={load:function(i,s){var a=s||document,r=a.createElement("link");r.type="text/css",r.rel="stylesheet",r.href=i,a.getElementsByTagName("head")[0].appendChild(r)},inject:function(i,s){var a=s||document,r=document.createElement("style");r.type="text/css",r.innerHTML=i;var c=a.getElementsByTagName("head")[0];try{c.appendChild(r)}catch{}}},Gpe=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,qpe=function(i,s){var a=i[s];return ti.isArray(arguments[2])||ti.isObject(arguments[2])?new jpe(i,s,arguments[2]):ti.isNumber(a)?ti.isNumber(arguments[2])&&ti.isNumber(arguments[3])?ti.isNumber(arguments[4])?new LR(i,s,arguments[2],arguments[3],arguments[4]):new LR(i,s,arguments[2],arguments[3]):ti.isNumber(arguments[4])?new aT(i,s,{min:arguments[2],max:arguments[3],step:arguments[4]}):new aT(i,s,{min:arguments[2],max:arguments[3]}):ti.isString(a)?new zpe(i,s):ti.isFunction(a)?new Wq(i,s,""):ti.isBoolean(a)?new zq(i,s):null};function $pe(h){setTimeout(h,1e3/60)}var Xpe=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||$pe,Kpe=function(){function h(){av(this,h),this.backgroundElement=document.createElement("div"),ti.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),Sr.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),ti.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var i=this;Sr.bind(this.backgroundElement,"click",function(){i.hide()})}return sv(h,[{key:"show",value:function(){var s=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),ti.defer(function(){s.backgroundElement.style.opacity=1,s.domElement.style.opacity=1,s.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var s=this,a=function r(){s.domElement.style.display="none",s.backgroundElement.style.display="none",Sr.unbind(s.domElement,"webkitTransitionEnd",r),Sr.unbind(s.domElement,"transitionend",r),Sr.unbind(s.domElement,"oTransitionEnd",r)};Sr.bind(this.domElement,"webkitTransitionEnd",a),Sr.bind(this.domElement,"transitionend",a),Sr.bind(this.domElement,"oTransitionEnd",a),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-Sr.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-Sr.getHeight(this.domElement)/2+"px"}}]),h}(),Ype=Fpe(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);Hpe.inject(Ype);var $V="dg",XV=72,KV=20,lC="Default",NS=function(){try{return!!window.localStorage}catch{return!1}}(),WS=void 0,YV=!0,R2=void 0,IF=!1,Vq=[],Xs=function h(i){var s=this,a=i||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),Sr.addClass(this.domElement,$V),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],a=ti.defaults(a,{closeOnTop:!1,autoPlace:!0,width:h.DEFAULT_WIDTH}),a=ti.defaults(a,{resizable:a.autoPlace,hideable:a.autoPlace}),ti.isUndefined(a.load)?a.load={preset:lC}:a.preset&&(a.load.preset=a.preset),ti.isUndefined(a.parent)&&a.hideable&&Vq.push(this),a.resizable=ti.isUndefined(a.parent)&&a.resizable,a.autoPlace&&ti.isUndefined(a.scrollable)&&(a.scrollable=!0);var r=NS&&localStorage.getItem(P2(this,"isLocal"))==="true",c=void 0,S=void 0;if(Object.defineProperties(this,{parent:{get:function(){return a.parent}},scrollable:{get:function(){return a.scrollable}},autoPlace:{get:function(){return a.autoPlace}},closeOnTop:{get:function(){return a.closeOnTop}},preset:{get:function(){return s.parent?s.getRoot().preset:a.load.preset},set:function(R){s.parent?s.getRoot().preset=R:a.load.preset=R,eme(this),s.revert()}},width:{get:function(){return a.width},set:function(R){a.width=R,UR(s,R)}},name:{get:function(){return a.name},set:function(R){a.name=R,S&&(S.innerHTML=a.name)}},closed:{get:function(){return a.closed},set:function(R){a.closed=R,a.closed?Sr.addClass(s.__ul,h.CLASS_CLOSED):Sr.removeClass(s.__ul,h.CLASS_CLOSED),this.onResize(),s.__closeButton&&(s.__closeButton.innerHTML=R?h.TEXT_OPEN:h.TEXT_CLOSED)}},load:{get:function(){return a.load}},useLocalStorage:{get:function(){return r},set:function(R){NS&&(r=R,R?Sr.bind(window,"unload",c):Sr.unbind(window,"unload",c),localStorage.setItem(P2(s,"isLocal"),R))}}}),ti.isUndefined(a.parent)){if(this.closed=a.closed||!1,Sr.addClass(this.domElement,h.CLASS_MAIN),Sr.makeSelectable(this.domElement,!1),NS&&r){s.useLocalStorage=!0;var E=localStorage.getItem(P2(this,"gui"));E&&(a.load=JSON.parse(E))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=h.TEXT_CLOSED,Sr.addClass(this.__closeButton,h.CLASS_CLOSE_BUTTON),a.closeOnTop?(Sr.addClass(this.__closeButton,h.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(Sr.addClass(this.__closeButton,h.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),Sr.bind(this.__closeButton,"click",function(){s.closed=!s.closed})}else{a.closed===void 0&&(a.closed=!0);var A=document.createTextNode(a.name);Sr.addClass(A,"controller-name"),S=G5(s,A);var U=function(R){return R.preventDefault(),s.closed=!s.closed,!1};Sr.addClass(this.__ul,h.CLASS_CLOSED),Sr.addClass(S,"title"),Sr.bind(S,"click",U),a.closed||(this.closed=!1)}a.autoPlace&&(ti.isUndefined(a.parent)&&(YV&&(R2=document.createElement("div"),Sr.addClass(R2,$V),Sr.addClass(R2,h.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(R2),YV=!1),R2.appendChild(this.domElement),Sr.addClass(this.domElement,h.CLASS_AUTO_PLACE)),this.parent||UR(s,a.width)),this.__resizeHandler=function(){s.onResizeDebounced()},Sr.bind(window,"resize",this.__resizeHandler),Sr.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),Sr.bind(this.__ul,"transitionend",this.__resizeHandler),Sr.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),a.resizable&&Zpe(this),c=function(){NS&&localStorage.getItem(P2(s,"isLocal"))==="true"&&localStorage.setItem(P2(s,"gui"),JSON.stringify(s.getSaveObject()))},this.saveToLocalStorageIfPossible=c;function B(){var D=s.getRoot();D.width+=1,ti.defer(function(){D.width-=1})}a.parent||B()};Xs.toggleHide=function(){IF=!IF,ti.each(Vq,function(h){h.domElement.style.display=IF?"none":""})};Xs.CLASS_AUTO_PLACE="a";Xs.CLASS_AUTO_PLACE_CONTAINER="ac";Xs.CLASS_MAIN="main";Xs.CLASS_CONTROLLER_ROW="cr";Xs.CLASS_TOO_TALL="taller-than-window";Xs.CLASS_CLOSED="closed";Xs.CLASS_CLOSE_BUTTON="close-button";Xs.CLASS_CLOSE_TOP="close-top";Xs.CLASS_CLOSE_BOTTOM="close-bottom";Xs.CLASS_DRAG="drag";Xs.DEFAULT_WIDTH=245;Xs.TEXT_CLOSED="Close Controls";Xs.TEXT_OPEN="Open Controls";Xs._keydownHandler=function(h){document.activeElement.type!=="text"&&(h.which===XV||h.keyCode===XV)&&Xs.toggleHide()};Sr.bind(window,"keydown",Xs._keydownHandler,!1);ti.extend(Xs.prototype,{add:function(i,s){return VS(this,i,s,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(i,s){return VS(this,i,s,{color:!0})},remove:function(i){this.__ul.removeChild(i.__li),this.__controllers.splice(this.__controllers.indexOf(i),1);var s=this;ti.defer(function(){s.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&R2.removeChild(this.domElement);var i=this;ti.each(this.__folders,function(s){i.removeFolder(s)}),Sr.unbind(window,"keydown",Xs._keydownHandler,!1),JV(this)},addFolder:function(i){if(this.__folders[i]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+i+'"');var s={name:i,parent:this};s.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[i]&&(s.closed=this.load.folders[i].closed,s.load=this.load.folders[i]);var a=new Xs(s);this.__folders[i]=a;var r=G5(this,a.domElement);return Sr.addClass(r,"folder"),a},removeFolder:function(i){this.__ul.removeChild(i.domElement.parentElement),delete this.__folders[i.name],this.load&&this.load.folders&&this.load.folders[i.name]&&delete this.load.folders[i.name],JV(i);var s=this;ti.each(i.__folders,function(a){i.removeFolder(a)}),ti.defer(function(){s.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var i=this.getRoot();if(i.scrollable){var s=Sr.getOffset(i.__ul).top,a=0;ti.each(i.__ul.childNodes,function(r){i.autoPlace&&r===i.__save_row||(a+=Sr.getHeight(r))}),window.innerHeight-s-KV<a?(Sr.addClass(i.domElement,Xs.CLASS_TOO_TALL),i.__ul.style.height=window.innerHeight-s-KV+"px"):(Sr.removeClass(i.domElement,Xs.CLASS_TOO_TALL),i.__ul.style.height="auto")}i.__resize_handle&&ti.defer(function(){i.__resize_handle.style.height=i.__ul.offsetHeight+"px"}),i.__closeButton&&(i.__closeButton.style.width=i.width+"px")},onResizeDebounced:ti.debounce(function(){this.onResize()},50),remember:function(){if(ti.isUndefined(WS)&&(WS=new Kpe,WS.domElement.innerHTML=Gpe),this.parent)throw new Error("You can only call remember on a top level GUI.");var i=this;ti.each(Array.prototype.slice.call(arguments),function(s){i.__rememberedObjects.length===0&&Qpe(i),i.__rememberedObjects.indexOf(s)===-1&&i.__rememberedObjects.push(s)}),this.autoPlace&&UR(this,this.width)},getRoot:function(){for(var i=this;i.parent;)i=i.parent;return i},getSaveObject:function(){var i=this.load;return i.closed=this.closed,this.__rememberedObjects.length>0&&(i.preset=this.preset,i.remembered||(i.remembered={}),i.remembered[this.preset]=yO(this)),i.folders={},ti.each(this.__folders,function(s,a){i.folders[a]=s.getSaveObject()}),i},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=yO(this),jR(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(i){this.load.remembered||(this.load.remembered={},this.load.remembered[lC]=yO(this,!0)),this.load.remembered[i]=yO(this),this.preset=i,zR(this,i,!0),this.saveToLocalStorageIfPossible()},revert:function(i){ti.each(this.__controllers,function(s){this.getRoot().load.remembered?Hq(i||this.getRoot(),s):s.setValue(s.initialValue),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())},this),ti.each(this.__folders,function(s){s.revert(s)}),i||jR(this.getRoot(),!1)},listen:function(i){var s=this.__listening.length===0;this.__listening.push(i),s&&Gq(this.__listening)},updateDisplay:function(){ti.each(this.__controllers,function(i){i.updateDisplay()}),ti.each(this.__folders,function(i){i.updateDisplay()})}});function G5(h,i,s){var a=document.createElement("li");return i&&a.appendChild(i),s?h.__ul.insertBefore(a,s):h.__ul.appendChild(a),h.onResize(),a}function JV(h){Sr.unbind(window,"resize",h.__resizeHandler),h.saveToLocalStorageIfPossible&&Sr.unbind(window,"unload",h.saveToLocalStorageIfPossible)}function jR(h,i){var s=h.__preset_select[h.__preset_select.selectedIndex];i?s.innerHTML=s.value+"*":s.innerHTML=s.value}function Jpe(h,i,s){if(s.__li=i,s.__gui=h,ti.extend(s,{options:function(S){if(arguments.length>1){var E=s.__li.nextElementSibling;return s.remove(),VS(h,s.object,s.property,{before:E,factoryArgs:[ti.toArray(arguments)]})}if(ti.isArray(S)||ti.isObject(S)){var A=s.__li.nextElementSibling;return s.remove(),VS(h,s.object,s.property,{before:A,factoryArgs:[S]})}},name:function(S){return s.__li.firstElementChild.firstElementChild.innerHTML=S,s},listen:function(){return s.__gui.listen(s),s},remove:function(){return s.__gui.remove(s),s}}),s instanceof LR){var a=new aT(s.object,s.property,{min:s.__min,max:s.__max,step:s.__step});ti.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(c){var S=s[c],E=a[c];s[c]=a[c]=function(){var A=Array.prototype.slice.call(arguments);return E.apply(a,A),S.apply(s,A)}}),Sr.addClass(i,"has-slider"),s.domElement.insertBefore(a.domElement,s.domElement.firstElementChild)}else if(s instanceof aT){var r=function(S){if(ti.isNumber(s.__min)&&ti.isNumber(s.__max)){var E=s.__li.firstElementChild.firstElementChild.innerHTML,A=s.__gui.__listening.indexOf(s)>-1;s.remove();var U=VS(h,s.object,s.property,{before:s.__li.nextElementSibling,factoryArgs:[s.__min,s.__max,s.__step]});return U.name(E),A&&U.listen(),U}return S};s.min=ti.compose(r,s.min),s.max=ti.compose(r,s.max)}else s instanceof zq?(Sr.bind(i,"click",function(){Sr.fakeEvent(s.__checkbox,"click")}),Sr.bind(s.__checkbox,"click",function(c){c.stopPropagation()})):s instanceof Wq?(Sr.bind(i,"click",function(){Sr.fakeEvent(s.__button,"click")}),Sr.bind(i,"mouseover",function(){Sr.addClass(s.__button,"hover")}),Sr.bind(i,"mouseout",function(){Sr.removeClass(s.__button,"hover")})):s instanceof BR&&(Sr.addClass(i,"color"),s.updateDisplay=ti.compose(function(c){return i.style.borderLeftColor=s.__color.toString(),c},s.updateDisplay),s.updateDisplay());s.setValue=ti.compose(function(c){return h.getRoot().__preset_select&&s.isModified()&&jR(h.getRoot(),!0),c},s.setValue)}function Hq(h,i){var s=h.getRoot(),a=s.__rememberedObjects.indexOf(i.object);if(a!==-1){var r=s.__rememberedObjectIndecesToControllers[a];if(r===void 0&&(r={},s.__rememberedObjectIndecesToControllers[a]=r),r[i.property]=i,s.load&&s.load.remembered){var c=s.load.remembered,S=void 0;if(c[h.preset])S=c[h.preset];else if(c[lC])S=c[lC];else return;if(S[a]&&S[a][i.property]!==void 0){var E=S[a][i.property];i.initialValue=E,i.setValue(E)}}}}function VS(h,i,s,a){if(i[s]===void 0)throw new Error('Object "'+i+'" has no property "'+s+'"');var r=void 0;if(a.color)r=new BR(i,s);else{var c=[i,s].concat(a.factoryArgs);r=qpe.apply(h,c)}a.before instanceof Sw&&(a.before=a.before.__li),Hq(h,r),Sr.addClass(r.domElement,"c");var S=document.createElement("span");Sr.addClass(S,"property-name"),S.innerHTML=r.property;var E=document.createElement("div");E.appendChild(S),E.appendChild(r.domElement);var A=G5(h,E,a.before);return Sr.addClass(A,Xs.CLASS_CONTROLLER_ROW),r instanceof BR?Sr.addClass(A,"color"):Sr.addClass(A,Ppe(r.getValue())),Jpe(h,A,r),h.__controllers.push(r),r}function P2(h,i){return document.location.href+"."+i}function zR(h,i,s){var a=document.createElement("option");a.innerHTML=i,a.value=i,h.__preset_select.appendChild(a),s&&(h.__preset_select.selectedIndex=h.__preset_select.length-1)}function QV(h,i){i.style.display=h.useLocalStorage?"block":"none"}function Qpe(h){var i=h.__save_row=document.createElement("li");Sr.addClass(h.domElement,"has-save"),h.__ul.insertBefore(i,h.__ul.firstChild),Sr.addClass(i,"save-row");var s=document.createElement("span");s.innerHTML="&nbsp;",Sr.addClass(s,"button gears");var a=document.createElement("span");a.innerHTML="Save",Sr.addClass(a,"button"),Sr.addClass(a,"save");var r=document.createElement("span");r.innerHTML="New",Sr.addClass(r,"button"),Sr.addClass(r,"save-as");var c=document.createElement("span");c.innerHTML="Revert",Sr.addClass(c,"button"),Sr.addClass(c,"revert");var S=h.__preset_select=document.createElement("select");if(h.load&&h.load.remembered?ti.each(h.load.remembered,function(D,R){zR(h,R,R===h.preset)}):zR(h,lC,!1),Sr.bind(S,"change",function(){for(var D=0;D<h.__preset_select.length;D++)h.__preset_select[D].innerHTML=h.__preset_select[D].value;h.preset=this.value}),i.appendChild(S),i.appendChild(s),i.appendChild(a),i.appendChild(r),i.appendChild(c),NS){var E=document.getElementById("dg-local-explain"),A=document.getElementById("dg-local-storage"),U=document.getElementById("dg-save-locally");U.style.display="block",localStorage.getItem(P2(h,"isLocal"))==="true"&&A.setAttribute("checked","checked"),QV(h,E),Sr.bind(A,"change",function(){h.useLocalStorage=!h.useLocalStorage,QV(h,E)})}var B=document.getElementById("dg-new-constructor");Sr.bind(B,"keydown",function(D){D.metaKey&&(D.which===67||D.keyCode===67)&&WS.hide()}),Sr.bind(s,"click",function(){B.innerHTML=JSON.stringify(h.getSaveObject(),void 0,2),WS.show(),B.focus(),B.select()}),Sr.bind(a,"click",function(){h.save()}),Sr.bind(r,"click",function(){var D=prompt("Enter a new preset name.");D&&h.saveAs(D)}),Sr.bind(c,"click",function(){h.revert()})}function Zpe(h){var i=void 0;h.__resize_handle=document.createElement("div"),ti.extend(h.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function s(c){return c.preventDefault(),h.width+=i-c.clientX,h.onResize(),i=c.clientX,!1}function a(){Sr.removeClass(h.__closeButton,Xs.CLASS_DRAG),Sr.unbind(window,"mousemove",s),Sr.unbind(window,"mouseup",a)}function r(c){return c.preventDefault(),i=c.clientX,Sr.addClass(h.__closeButton,Xs.CLASS_DRAG),Sr.bind(window,"mousemove",s),Sr.bind(window,"mouseup",a),!1}Sr.bind(h.__resize_handle,"mousedown",r),Sr.bind(h.__closeButton,"mousedown",r),h.domElement.insertBefore(h.__resize_handle,h.domElement.firstElementChild)}function UR(h,i){h.domElement.style.width=i+"px",h.__save_row&&h.autoPlace&&(h.__save_row.style.width=i+"px"),h.__closeButton&&(h.__closeButton.style.width=i+"px")}function yO(h,i){var s={};return ti.each(h.__rememberedObjects,function(a,r){var c={},S=h.__rememberedObjectIndecesToControllers[r];ti.each(S,function(E,A){c[A]=i?E.initialValue:E.getValue()}),s[r]=c}),s}function eme(h){for(var i=0;i<h.__preset_select.length;i++)h.__preset_select[i].value===h.preset&&(h.__preset_select.selectedIndex=i)}function Gq(h){h.length!==0&&Xpe.call(window,function(){Gq(h)}),ti.each(h,function(i){i.updateDisplay()})}var tme=Xs;class nme{constructor(){this.gui=null,this.data={width:0,height:0,videoWidth:0,videoHeight:0}}addAxesHelper(){const i=new Ope(100);i.position.z=1,Hu.addMesh(i)}addDatGUI(){this.gui=new tme,this.gui.add(this.data,"width").listen(),this.gui.add(this.data,"height").listen(),this.gui.add(this.data,"videoWidth").listen(),this.gui.add(this.data,"videoHeight").listen()}}class rme{constructor(){}addVideo(i,s){if(!s)return;const a=new OT(s.videoWidth,s.videoHeight),r=new Epe(s);r.wrapS=rT,r.repeat.x=-1;const c=new AT({map:r}),S=new Ay(a,c);return S.name=i,Hu.addMesh(S),S}updateVideo(i){const s=Hu.getMesh(i);return s||null}updateVideoSize(i){Hu.video=i,Hu.videoScale={width:Hu.width/i.videoWidth,height:Hu.height/i.videoHeight}}updatePredictions(i){Hu.predictions=i}}const ime=new Tpe,ome=new Npe,ame=new Ipe,sme=new nme,ume=new rme,Hu=ime,qq=ome,ZV=ame,cme=sme,FF=ume,lme="_container_1shhc_1",fme={container:lme};function dme(){const h=kl.exports.useRef(void 0),{video:i,predictions:s}=kl.exports.useContext(ST);return kl.exports.useEffect(()=>{if(h){if(Hu.container)return;Hu.init(h.current),qq.setOrbitControl(),ZV.addMultiSphere("sphere",468),cme.addAxesHelper(),Hu.animate()}},[h]),kl.exports.useEffect(()=>{s&&s.length>0&&(FF.updatePredictions(s),ZV.updateMultiSphere("sphere",468))},[s]),kl.exports.useEffect(()=>{if(i){if(Hu.video)return;FF.addVideo("video",i),FF.updateVideoSize(i)}},[i]),Rp(qR,{children:Rp("div",{ref:h,id:"container",className:fme.container})})}const hme="_loadingMask_1bktm_1",pme="_loader_1bktm_13",mme="_rotate_1bktm_1",gme="_prixClipFix_1bktm_1",eH={loadingMask:hme,loader:pme,rotate:mme,prixClipFix:gme};function $q(){const{loadingMask:h}=kl.exports.useContext(ST);return Rp(qR,{children:h&&Rp("div",{className:eH.loadingMask,children:Rp("span",{className:eH.loader})})})}$q.defaultProps={visible:!1};const Xq=({children:h})=>{const[i,s]=kl.exports.useState({flipHorizontal:!1,maxContinuousChecks:5,detectionConfidence:.9,maxFaces:1,scoreThreshold:.75,iouThreshold:.3}),[a,r]=kl.exports.useState(null),[c,S]=kl.exports.useState([]),[E,A]=kl.exports.useState(!1),U={video:a,setVideo:r,facemeshOptions:i,setFacemeshOptions:s,predictions:c,setPredictions:S,loadingMask:E,setLoadingMask:A};return Rp(ST.Provider,{value:U,children:h})};Xq.propTypes={children:cH.Node};function vme(){return vae(Xq,{children:[Rp(Eue,{}),Rp(dme,{}),Rp($q,{})]})}RF.createRoot(document.getElementById("root")).render(Rp(cH.StrictMode,{children:Rp(vme,{})}));
