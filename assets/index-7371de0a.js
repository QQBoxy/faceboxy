(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const C of l.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&s(C)}).observe(document,{childList:!0,subtree:!0});function u(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerpolicy&&(l.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?l.credentials="include":r.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(r){if(r.ep)return;r.ep=!0;const l=u(r);fetch(r.href,l)}})();function eV(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var LO={exports:{}},BO={},_l={exports:{}},ma={};var VS=Symbol.for("react.element"),Uie=Symbol.for("react.portal"),Wie=Symbol.for("react.fragment"),Vie=Symbol.for("react.strict_mode"),Hie=Symbol.for("react.profiler"),Gie=Symbol.for("react.provider"),qie=Symbol.for("react.context"),$ie=Symbol.for("react.forward_ref"),Xie=Symbol.for("react.suspense"),Kie=Symbol.for("react.memo"),Yie=Symbol.for("react.lazy"),k7=Symbol.iterator;function Jie(p){return p===null||typeof p!="object"?null:(p=k7&&p[k7]||p["@@iterator"],typeof p=="function"?p:null)}var tV={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},nV=Object.assign,rV={};function Q2(p,o,u){this.props=p,this.context=o,this.refs=rV,this.updater=u||tV}Q2.prototype.isReactComponent={};Q2.prototype.setState=function(p,o){if(typeof p!="object"&&typeof p!="function"&&p!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,p,o,"setState")};Q2.prototype.forceUpdate=function(p){this.updater.enqueueForceUpdate(this,p,"forceUpdate")};function iV(){}iV.prototype=Q2.prototype;function oR(p,o,u){this.props=p,this.context=o,this.refs=rV,this.updater=u||tV}var aR=oR.prototype=new iV;aR.constructor=oR;nV(aR,Q2.prototype);aR.isPureReactComponent=!0;var C7=Array.isArray,oV=Object.prototype.hasOwnProperty,sR={current:null},aV={key:!0,ref:!0,__self:!0,__source:!0};function sV(p,o,u){var s,r={},l=null,C=null;if(o!=null)for(s in o.ref!==void 0&&(C=o.ref),o.key!==void 0&&(l=""+o.key),o)oV.call(o,s)&&!aV.hasOwnProperty(s)&&(r[s]=o[s]);var S=arguments.length-2;if(S===1)r.children=u;else if(1<S){for(var O=Array(S),U=0;U<S;U++)O[U]=arguments[U+2];r.children=O}if(p&&p.defaultProps)for(s in S=p.defaultProps,S)r[s]===void 0&&(r[s]=S[s]);return{$$typeof:VS,type:p,key:l,ref:C,props:r,_owner:sR.current}}function Qie(p,o){return{$$typeof:VS,type:p.type,key:o,ref:p.ref,props:p.props,_owner:p._owner}}function uR(p){return typeof p=="object"&&p!==null&&p.$$typeof===VS}function Zie(p){var o={"=":"=0",":":"=2"};return"$"+p.replace(/[=:]/g,function(u){return o[u]})}var A7=/\/+/g;function JN(p,o){return typeof p=="object"&&p!==null&&p.key!=null?Zie(""+p.key):o.toString(36)}function YA(p,o,u,s,r){var l=typeof p;(l==="undefined"||l==="boolean")&&(p=null);var C=!1;if(p===null)C=!0;else switch(l){case"string":case"number":C=!0;break;case"object":switch(p.$$typeof){case VS:case Uie:C=!0}}if(C)return C=p,r=r(C),p=s===""?"."+JN(C,0):s,C7(r)?(u="",p!=null&&(u=p.replace(A7,"$&/")+"/"),YA(r,o,u,"",function(U){return U})):r!=null&&(uR(r)&&(r=Qie(r,u+(!r.key||C&&C.key===r.key?"":(""+r.key).replace(A7,"$&/")+"/")+p)),o.push(r)),1;if(C=0,s=s===""?".":s+":",C7(p))for(var S=0;S<p.length;S++){l=p[S];var O=s+JN(l,S);C+=YA(l,o,u,O,r)}else if(O=Jie(p),typeof O=="function")for(p=O.call(p),S=0;!(l=p.next()).done;)l=l.value,O=s+JN(l,S++),C+=YA(l,o,u,O,r);else if(l==="object")throw o=String(p),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(p).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return C}function fA(p,o,u){if(p==null)return p;var s=[],r=0;return YA(p,s,"","",function(l){return o.call(u,l,r++)}),s}function eoe(p){if(p._status===-1){var o=p._result;o=o(),o.then(function(u){(p._status===0||p._status===-1)&&(p._status=1,p._result=u)},function(u){(p._status===0||p._status===-1)&&(p._status=2,p._result=u)}),p._status===-1&&(p._status=0,p._result=o)}if(p._status===1)return p._result.default;throw p._result}var yh={current:null},JA={transition:null},toe={ReactCurrentDispatcher:yh,ReactCurrentBatchConfig:JA,ReactCurrentOwner:sR};ma.Children={map:fA,forEach:function(p,o,u){fA(p,function(){o.apply(this,arguments)},u)},count:function(p){var o=0;return fA(p,function(){o++}),o},toArray:function(p){return fA(p,function(o){return o})||[]},only:function(p){if(!uR(p))throw Error("React.Children.only expected to receive a single React element child.");return p}};ma.Component=Q2;ma.Fragment=Wie;ma.Profiler=Hie;ma.PureComponent=oR;ma.StrictMode=Vie;ma.Suspense=Xie;ma.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=toe;ma.cloneElement=function(p,o,u){if(p==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+p+".");var s=nV({},p.props),r=p.key,l=p.ref,C=p._owner;if(o!=null){if(o.ref!==void 0&&(l=o.ref,C=sR.current),o.key!==void 0&&(r=""+o.key),p.type&&p.type.defaultProps)var S=p.type.defaultProps;for(O in o)oV.call(o,O)&&!aV.hasOwnProperty(O)&&(s[O]=o[O]===void 0&&S!==void 0?S[O]:o[O])}var O=arguments.length-2;if(O===1)s.children=u;else if(1<O){S=Array(O);for(var U=0;U<O;U++)S[U]=arguments[U+2];s.children=S}return{$$typeof:VS,type:p.type,key:r,ref:l,props:s,_owner:C}};ma.createContext=function(p){return p={$$typeof:qie,_currentValue:p,_currentValue2:p,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},p.Provider={$$typeof:Gie,_context:p},p.Consumer=p};ma.createElement=sV;ma.createFactory=function(p){var o=sV.bind(null,p);return o.type=p,o};ma.createRef=function(){return{current:null}};ma.forwardRef=function(p){return{$$typeof:$ie,render:p}};ma.isValidElement=uR;ma.lazy=function(p){return{$$typeof:Yie,_payload:{_status:-1,_result:p},_init:eoe}};ma.memo=function(p,o){return{$$typeof:Kie,type:p,compare:o===void 0?null:o}};ma.startTransition=function(p){var o=JA.transition;JA.transition={};try{p()}finally{JA.transition=o}};ma.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};ma.useCallback=function(p,o){return yh.current.useCallback(p,o)};ma.useContext=function(p){return yh.current.useContext(p)};ma.useDebugValue=function(){};ma.useDeferredValue=function(p){return yh.current.useDeferredValue(p)};ma.useEffect=function(p,o){return yh.current.useEffect(p,o)};ma.useId=function(){return yh.current.useId()};ma.useImperativeHandle=function(p,o,u){return yh.current.useImperativeHandle(p,o,u)};ma.useInsertionEffect=function(p,o){return yh.current.useInsertionEffect(p,o)};ma.useLayoutEffect=function(p,o){return yh.current.useLayoutEffect(p,o)};ma.useMemo=function(p,o){return yh.current.useMemo(p,o)};ma.useReducer=function(p,o,u){return yh.current.useReducer(p,o,u)};ma.useRef=function(p){return yh.current.useRef(p)};ma.useState=function(p){return yh.current.useState(p)};ma.useSyncExternalStore=function(p,o,u){return yh.current.useSyncExternalStore(p,o,u)};ma.useTransition=function(){return yh.current.useTransition()};ma.version="18.2.0";(function(p){p.exports=ma})(_l);const uV=eV(_l.exports);var noe=_l.exports,roe=Symbol.for("react.element"),ioe=Symbol.for("react.fragment"),ooe=Object.prototype.hasOwnProperty,aoe=noe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,soe={key:!0,ref:!0,__self:!0,__source:!0};function cV(p,o,u){var s,r={},l=null,C=null;u!==void 0&&(l=""+u),o.key!==void 0&&(l=""+o.key),o.ref!==void 0&&(C=o.ref);for(s in o)ooe.call(o,s)&&!soe.hasOwnProperty(s)&&(r[s]=o[s]);if(p&&p.defaultProps)for(s in o=p.defaultProps,o)r[s]===void 0&&(r[s]=o[s]);return{$$typeof:roe,type:p,key:l,ref:C,props:r,_owner:aoe.current}}BO.Fragment=ioe;BO.jsx=cV;BO.jsxs=cV;(function(p){p.exports=BO})(LO);const cR=LO.exports.Fragment,Tp=LO.exports.jsx,uoe=LO.exports.jsxs;var iF={},lV={exports:{}},Gm={},fV={exports:{}},dV={};(function(p){function o(ze,Ut){var Ft=ze.length;ze.push(Ut);e:for(;0<Ft;){var pt=Ft-1>>>1,yt=ze[pt];if(0<r(yt,Ut))ze[pt]=Ut,ze[Ft]=yt,Ft=pt;else break e}}function u(ze){return ze.length===0?null:ze[0]}function s(ze){if(ze.length===0)return null;var Ut=ze[0],Ft=ze.pop();if(Ft!==Ut){ze[0]=Ft;e:for(var pt=0,yt=ze.length,nn=yt>>>1;pt<nn;){var xt=2*(pt+1)-1,_t=ze[xt],Yt=xt+1,Fn=ze[Yt];if(0>r(_t,Ft))Yt<yt&&0>r(Fn,_t)?(ze[pt]=Fn,ze[Yt]=Ft,pt=Yt):(ze[pt]=_t,ze[xt]=Ft,pt=xt);else if(Yt<yt&&0>r(Fn,Ft))ze[pt]=Fn,ze[Yt]=Ft,pt=Yt;else break e}}return Ut}function r(ze,Ut){var Ft=ze.sortIndex-Ut.sortIndex;return Ft!==0?Ft:ze.id-Ut.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;p.unstable_now=function(){return l.now()}}else{var C=Date,S=C.now();p.unstable_now=function(){return C.now()-S}}var O=[],U=[],j=1,N=null,L=3,W=!1,z=!1,q=!1,I=typeof setTimeout=="function"?setTimeout:null,Z=typeof clearTimeout=="function"?clearTimeout:null,Y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function G(ze){for(var Ut=u(U);Ut!==null;){if(Ut.callback===null)s(U);else if(Ut.startTime<=ze)s(U),Ut.sortIndex=Ut.expirationTime,o(O,Ut);else break;Ut=u(U)}}function oe(ze){if(q=!1,G(ze),!z)if(u(O)!==null)z=!0,jt(ce);else{var Ut=u(U);Ut!==null&&Mt(oe,Ut.startTime-ze)}}function ce(ze,Ut){z=!1,q&&(q=!1,Z(ve),ve=-1),W=!0;var Ft=L;try{for(G(Ut),N=u(O);N!==null&&(!(N.expirationTime>Ut)||ze&&!ht());){var pt=N.callback;if(typeof pt=="function"){N.callback=null,L=N.priorityLevel;var yt=pt(N.expirationTime<=Ut);Ut=p.unstable_now(),typeof yt=="function"?N.callback=yt:N===u(O)&&s(O),G(Ut)}else s(O);N=u(O)}if(N!==null)var nn=!0;else{var xt=u(U);xt!==null&&Mt(oe,xt.startTime-Ut),nn=!1}return nn}finally{N=null,L=Ft,W=!1}}var be=!1,Ee=null,ve=-1,ge=5,Ge=-1;function ht(){return!(p.unstable_now()-Ge<ge)}function It(){if(Ee!==null){var ze=p.unstable_now();Ge=ze;var Ut=!0;try{Ut=Ee(!0,ze)}finally{Ut?St():(be=!1,Ee=null)}}else be=!1}var St;if(typeof Y=="function")St=function(){Y(It)};else if(typeof MessageChannel<"u"){var we=new MessageChannel,bt=we.port2;we.port1.onmessage=It,St=function(){bt.postMessage(null)}}else St=function(){I(It,0)};function jt(ze){Ee=ze,be||(be=!0,St())}function Mt(ze,Ut){ve=I(function(){ze(p.unstable_now())},Ut)}p.unstable_IdlePriority=5,p.unstable_ImmediatePriority=1,p.unstable_LowPriority=4,p.unstable_NormalPriority=3,p.unstable_Profiling=null,p.unstable_UserBlockingPriority=2,p.unstable_cancelCallback=function(ze){ze.callback=null},p.unstable_continueExecution=function(){z||W||(z=!0,jt(ce))},p.unstable_forceFrameRate=function(ze){0>ze||125<ze?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ge=0<ze?Math.floor(1e3/ze):5},p.unstable_getCurrentPriorityLevel=function(){return L},p.unstable_getFirstCallbackNode=function(){return u(O)},p.unstable_next=function(ze){switch(L){case 1:case 2:case 3:var Ut=3;break;default:Ut=L}var Ft=L;L=Ut;try{return ze()}finally{L=Ft}},p.unstable_pauseExecution=function(){},p.unstable_requestPaint=function(){},p.unstable_runWithPriority=function(ze,Ut){switch(ze){case 1:case 2:case 3:case 4:case 5:break;default:ze=3}var Ft=L;L=ze;try{return Ut()}finally{L=Ft}},p.unstable_scheduleCallback=function(ze,Ut,Ft){var pt=p.unstable_now();switch(typeof Ft=="object"&&Ft!==null?(Ft=Ft.delay,Ft=typeof Ft=="number"&&0<Ft?pt+Ft:pt):Ft=pt,ze){case 1:var yt=-1;break;case 2:yt=250;break;case 5:yt=1073741823;break;case 4:yt=1e4;break;default:yt=5e3}return yt=Ft+yt,ze={id:j++,callback:Ut,priorityLevel:ze,startTime:Ft,expirationTime:yt,sortIndex:-1},Ft>pt?(ze.sortIndex=Ft,o(U,ze),u(O)===null&&ze===u(U)&&(q?(Z(ve),ve=-1):q=!0,Mt(oe,Ft-pt))):(ze.sortIndex=yt,o(O,ze),z||W||(z=!0,jt(ce))),ze},p.unstable_shouldYield=ht,p.unstable_wrapCallback=function(ze){var Ut=L;return function(){var Ft=L;L=Ut;try{return ze.apply(this,arguments)}finally{L=Ft}}}})(dV);(function(p){p.exports=dV})(fV);var hV=_l.exports,Hm=fV.exports;function ui(p){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+p,u=1;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u]);return"Minified React error #"+p+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var pV=new Set,ES={};function cw(p,o){U2(p,o),U2(p+"Capture",o)}function U2(p,o){for(ES[p]=o,p=0;p<o.length;p++)pV.add(o[p])}var C1=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),oF=Object.prototype.hasOwnProperty,coe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,O7={},T7={};function loe(p){return oF.call(T7,p)?!0:oF.call(O7,p)?!1:coe.test(p)?T7[p]=!0:(O7[p]=!0,!1)}function foe(p,o,u,s){if(u!==null&&u.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return s?!1:u!==null?!u.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function doe(p,o,u,s){if(o===null||typeof o>"u"||foe(p,o,u,s))return!0;if(s)return!1;if(u!==null)switch(u.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function bh(p,o,u,s,r,l,C){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=u,this.propertyName=p,this.type=o,this.sanitizeURL=l,this.removeEmptyString=C}var sf={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){sf[p]=new bh(p,0,!1,p,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var o=p[0];sf[o]=new bh(o,1,!1,p[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(p){sf[p]=new bh(p,2,!1,p.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){sf[p]=new bh(p,2,!1,p,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){sf[p]=new bh(p,3,!1,p.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(p){sf[p]=new bh(p,3,!0,p,null,!1,!1)});["capture","download"].forEach(function(p){sf[p]=new bh(p,4,!1,p,null,!1,!1)});["cols","rows","size","span"].forEach(function(p){sf[p]=new bh(p,6,!1,p,null,!1,!1)});["rowSpan","start"].forEach(function(p){sf[p]=new bh(p,5,!1,p.toLowerCase(),null,!1,!1)});var lR=/[\-:]([a-z])/g;function fR(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var o=p.replace(lR,fR);sf[o]=new bh(o,1,!1,p,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var o=p.replace(lR,fR);sf[o]=new bh(o,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(p){var o=p.replace(lR,fR);sf[o]=new bh(o,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(p){sf[p]=new bh(p,1,!1,p.toLowerCase(),null,!1,!1)});sf.xlinkHref=new bh("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(p){sf[p]=new bh(p,1,!1,p.toLowerCase(),null,!0,!0)});function dR(p,o,u,s){var r=sf.hasOwnProperty(o)?sf[o]:null;(r!==null?r.type!==0:s||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(doe(o,u,r,s)&&(u=null),s||r===null?loe(o)&&(u===null?p.removeAttribute(o):p.setAttribute(o,""+u)):r.mustUseProperty?p[r.propertyName]=u===null?r.type===3?!1:"":u:(o=r.attributeName,s=r.attributeNamespace,u===null?p.removeAttribute(o):(r=r.type,u=r===3||r===4&&u===!0?"":""+u,s?p.setAttributeNS(s,o,u):p.setAttribute(o,u))))}var M1=hV.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,dA=Symbol.for("react.element"),x2=Symbol.for("react.portal"),w2=Symbol.for("react.fragment"),hR=Symbol.for("react.strict_mode"),aF=Symbol.for("react.profiler"),mV=Symbol.for("react.provider"),gV=Symbol.for("react.context"),pR=Symbol.for("react.forward_ref"),sF=Symbol.for("react.suspense"),uF=Symbol.for("react.suspense_list"),mR=Symbol.for("react.memo"),Ab=Symbol.for("react.lazy"),vV=Symbol.for("react.offscreen"),M7=Symbol.iterator;function HE(p){return p===null||typeof p!="object"?null:(p=M7&&p[M7]||p["@@iterator"],typeof p=="function"?p:null)}var Tu=Object.assign,QN;function sS(p){if(QN===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);QN=o&&o[1]||""}return`
`+QN+p}var ZN=!1;function eI(p,o){if(!p||ZN)return"";ZN=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(U){var s=U}Reflect.construct(p,[],o)}else{try{o.call()}catch(U){s=U}p.call(o.prototype)}else{try{throw Error()}catch(U){s=U}p()}}catch(U){if(U&&s&&typeof U.stack=="string"){for(var r=U.stack.split(`
`),l=s.stack.split(`
`),C=r.length-1,S=l.length-1;1<=C&&0<=S&&r[C]!==l[S];)S--;for(;1<=C&&0<=S;C--,S--)if(r[C]!==l[S]){if(C!==1||S!==1)do if(C--,S--,0>S||r[C]!==l[S]){var O=`
`+r[C].replace(" at new "," at ");return p.displayName&&O.includes("<anonymous>")&&(O=O.replace("<anonymous>",p.displayName)),O}while(1<=C&&0<=S);break}}}finally{ZN=!1,Error.prepareStackTrace=u}return(p=p?p.displayName||p.name:"")?sS(p):""}function hoe(p){switch(p.tag){case 5:return sS(p.type);case 16:return sS("Lazy");case 13:return sS("Suspense");case 19:return sS("SuspenseList");case 0:case 2:case 15:return p=eI(p.type,!1),p;case 11:return p=eI(p.type.render,!1),p;case 1:return p=eI(p.type,!0),p;default:return""}}function cF(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case w2:return"Fragment";case x2:return"Portal";case aF:return"Profiler";case hR:return"StrictMode";case sF:return"Suspense";case uF:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case gV:return(p.displayName||"Context")+".Consumer";case mV:return(p._context.displayName||"Context")+".Provider";case pR:var o=p.render;return p=p.displayName,p||(p=o.displayName||o.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case mR:return o=p.displayName||null,o!==null?o:cF(p.type)||"Memo";case Ab:o=p._payload,p=p._init;try{return cF(p(o))}catch{}}return null}function poe(p){var o=p.type;switch(p.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=o.render,p=p.displayName||p.name||"",o.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return cF(o);case 8:return o===hR?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function Wb(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function yV(p){var o=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function moe(p){var o=yV(p)?"checked":"value",u=Object.getOwnPropertyDescriptor(p.constructor.prototype,o),s=""+p[o];if(!p.hasOwnProperty(o)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var r=u.get,l=u.set;return Object.defineProperty(p,o,{configurable:!0,get:function(){return r.call(this)},set:function(C){s=""+C,l.call(this,C)}}),Object.defineProperty(p,o,{enumerable:u.enumerable}),{getValue:function(){return s},setValue:function(C){s=""+C},stopTracking:function(){p._valueTracker=null,delete p[o]}}}}function hA(p){p._valueTracker||(p._valueTracker=moe(p))}function bV(p){if(!p)return!1;var o=p._valueTracker;if(!o)return!0;var u=o.getValue(),s="";return p&&(s=yV(p)?p.checked?"true":"false":p.value),p=s,p!==u?(o.setValue(p),!0):!1}function lO(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function lF(p,o){var u=o.checked;return Tu({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:u??p._wrapperState.initialChecked})}function D7(p,o){var u=o.defaultValue==null?"":o.defaultValue,s=o.checked!=null?o.checked:o.defaultChecked;u=Wb(o.value!=null?o.value:u),p._wrapperState={initialChecked:s,initialValue:u,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function xV(p,o){o=o.checked,o!=null&&dR(p,"checked",o,!1)}function fF(p,o){xV(p,o);var u=Wb(o.value),s=o.type;if(u!=null)s==="number"?(u===0&&p.value===""||p.value!=u)&&(p.value=""+u):p.value!==""+u&&(p.value=""+u);else if(s==="submit"||s==="reset"){p.removeAttribute("value");return}o.hasOwnProperty("value")?dF(p,o.type,u):o.hasOwnProperty("defaultValue")&&dF(p,o.type,Wb(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(p.defaultChecked=!!o.defaultChecked)}function N7(p,o,u){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var s=o.type;if(!(s!=="submit"&&s!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+p._wrapperState.initialValue,u||o===p.value||(p.value=o),p.defaultValue=o}u=p.name,u!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,u!==""&&(p.name=u)}function dF(p,o,u){(o!=="number"||lO(p.ownerDocument)!==p)&&(u==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+u&&(p.defaultValue=""+u))}var uS=Array.isArray;function I2(p,o,u,s){if(p=p.options,o){o={};for(var r=0;r<u.length;r++)o["$"+u[r]]=!0;for(u=0;u<p.length;u++)r=o.hasOwnProperty("$"+p[u].value),p[u].selected!==r&&(p[u].selected=r),r&&s&&(p[u].defaultSelected=!0)}else{for(u=""+Wb(u),o=null,r=0;r<p.length;r++){if(p[r].value===u){p[r].selected=!0,s&&(p[r].defaultSelected=!0);return}o!==null||p[r].disabled||(o=p[r])}o!==null&&(o.selected=!0)}}function hF(p,o){if(o.dangerouslySetInnerHTML!=null)throw Error(ui(91));return Tu({},o,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function I7(p,o){var u=o.value;if(u==null){if(u=o.children,o=o.defaultValue,u!=null){if(o!=null)throw Error(ui(92));if(uS(u)){if(1<u.length)throw Error(ui(93));u=u[0]}o=u}o==null&&(o=""),u=o}p._wrapperState={initialValue:Wb(u)}}function wV(p,o){var u=Wb(o.value),s=Wb(o.defaultValue);u!=null&&(u=""+u,u!==p.value&&(p.value=u),o.defaultValue==null&&p.defaultValue!==u&&(p.defaultValue=u)),s!=null&&(p.defaultValue=""+s)}function F7(p){var o=p.textContent;o===p._wrapperState.initialValue&&o!==""&&o!==null&&(p.value=o)}function _V(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function pF(p,o){return p==null||p==="http://www.w3.org/1999/xhtml"?_V(o):p==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var pA,EV=function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,u,s,r){MSApp.execUnsafeLocalFunction(function(){return p(o,u,s,r)})}:p}(function(p,o){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=o;else{for(pA=pA||document.createElement("div"),pA.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=pA.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;o.firstChild;)p.appendChild(o.firstChild)}});function SS(p,o){if(o){var u=p.firstChild;if(u&&u===p.lastChild&&u.nodeType===3){u.nodeValue=o;return}}p.textContent=o}var hS={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},goe=["Webkit","ms","Moz","O"];Object.keys(hS).forEach(function(p){goe.forEach(function(o){o=o+p.charAt(0).toUpperCase()+p.substring(1),hS[o]=hS[p]})});function SV(p,o,u){return o==null||typeof o=="boolean"||o===""?"":u||typeof o!="number"||o===0||hS.hasOwnProperty(p)&&hS[p]?(""+o).trim():o+"px"}function kV(p,o){p=p.style;for(var u in o)if(o.hasOwnProperty(u)){var s=u.indexOf("--")===0,r=SV(u,o[u],s);u==="float"&&(u="cssFloat"),s?p.setProperty(u,r):p[u]=r}}var voe=Tu({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function mF(p,o){if(o){if(voe[p]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(ui(137,p));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(ui(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(ui(61))}if(o.style!=null&&typeof o.style!="object")throw Error(ui(62))}}function gF(p,o){if(p.indexOf("-")===-1)return typeof o.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var vF=null;function gR(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var yF=null,F2=null,R2=null;function R7(p){if(p=qS(p)){if(typeof yF!="function")throw Error(ui(280));var o=p.stateNode;o&&(o=VO(o),yF(p.stateNode,p.type,o))}}function CV(p){F2?R2?R2.push(p):R2=[p]:F2=p}function AV(){if(F2){var p=F2,o=R2;if(R2=F2=null,R7(p),o)for(p=0;p<o.length;p++)R7(o[p])}}function OV(p,o){return p(o)}function TV(){}var tI=!1;function MV(p,o,u){if(tI)return p(o,u);tI=!0;try{return OV(p,o,u)}finally{tI=!1,(F2!==null||R2!==null)&&(TV(),AV())}}function kS(p,o){var u=p.stateNode;if(u===null)return null;var s=VO(u);if(s===null)return null;u=s[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(p=p.type,s=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!s;break e;default:p=!1}if(p)return null;if(u&&typeof u!="function")throw Error(ui(231,o,typeof u));return u}var bF=!1;if(C1)try{var GE={};Object.defineProperty(GE,"passive",{get:function(){bF=!0}}),window.addEventListener("test",GE,GE),window.removeEventListener("test",GE,GE)}catch{bF=!1}function yoe(p,o,u,s,r,l,C,S,O){var U=Array.prototype.slice.call(arguments,3);try{o.apply(u,U)}catch(j){this.onError(j)}}var pS=!1,fO=null,dO=!1,xF=null,boe={onError:function(p){pS=!0,fO=p}};function xoe(p,o,u,s,r,l,C,S,O){pS=!1,fO=null,yoe.apply(boe,arguments)}function woe(p,o,u,s,r,l,C,S,O){if(xoe.apply(this,arguments),pS){if(pS){var U=fO;pS=!1,fO=null}else throw Error(ui(198));dO||(dO=!0,xF=U)}}function lw(p){var o=p,u=p;if(p.alternate)for(;o.return;)o=o.return;else{p=o;do o=p,o.flags&4098&&(u=o.return),p=o.return;while(p)}return o.tag===3?u:null}function DV(p){if(p.tag===13){var o=p.memoizedState;if(o===null&&(p=p.alternate,p!==null&&(o=p.memoizedState)),o!==null)return o.dehydrated}return null}function P7(p){if(lw(p)!==p)throw Error(ui(188))}function _oe(p){var o=p.alternate;if(!o){if(o=lw(p),o===null)throw Error(ui(188));return o!==p?null:p}for(var u=p,s=o;;){var r=u.return;if(r===null)break;var l=r.alternate;if(l===null){if(s=r.return,s!==null){u=s;continue}break}if(r.child===l.child){for(l=r.child;l;){if(l===u)return P7(r),p;if(l===s)return P7(r),o;l=l.sibling}throw Error(ui(188))}if(u.return!==s.return)u=r,s=l;else{for(var C=!1,S=r.child;S;){if(S===u){C=!0,u=r,s=l;break}if(S===s){C=!0,s=r,u=l;break}S=S.sibling}if(!C){for(S=l.child;S;){if(S===u){C=!0,u=l,s=r;break}if(S===s){C=!0,s=l,u=r;break}S=S.sibling}if(!C)throw Error(ui(189))}}if(u.alternate!==s)throw Error(ui(190))}if(u.tag!==3)throw Error(ui(188));return u.stateNode.current===u?p:o}function NV(p){return p=_oe(p),p!==null?IV(p):null}function IV(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var o=IV(p);if(o!==null)return o;p=p.sibling}return null}var FV=Hm.unstable_scheduleCallback,L7=Hm.unstable_cancelCallback,Eoe=Hm.unstable_shouldYield,Soe=Hm.unstable_requestPaint,oc=Hm.unstable_now,koe=Hm.unstable_getCurrentPriorityLevel,vR=Hm.unstable_ImmediatePriority,RV=Hm.unstable_UserBlockingPriority,hO=Hm.unstable_NormalPriority,Coe=Hm.unstable_LowPriority,PV=Hm.unstable_IdlePriority,jO=null,wy=null;function Aoe(p){if(wy&&typeof wy.onCommitFiberRoot=="function")try{wy.onCommitFiberRoot(jO,p,void 0,(p.current.flags&128)===128)}catch{}}var Z0=Math.clz32?Math.clz32:Moe,Ooe=Math.log,Toe=Math.LN2;function Moe(p){return p>>>=0,p===0?32:31-(Ooe(p)/Toe|0)|0}var mA=64,gA=4194304;function cS(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function pO(p,o){var u=p.pendingLanes;if(u===0)return 0;var s=0,r=p.suspendedLanes,l=p.pingedLanes,C=u&268435455;if(C!==0){var S=C&~r;S!==0?s=cS(S):(l&=C,l!==0&&(s=cS(l)))}else C=u&~r,C!==0?s=cS(C):l!==0&&(s=cS(l));if(s===0)return 0;if(o!==0&&o!==s&&!(o&r)&&(r=s&-s,l=o&-o,r>=l||r===16&&(l&4194240)!==0))return o;if(s&4&&(s|=u&16),o=p.entangledLanes,o!==0)for(p=p.entanglements,o&=s;0<o;)u=31-Z0(o),r=1<<u,s|=p[u],o&=~r;return s}function Doe(p,o){switch(p){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Noe(p,o){for(var u=p.suspendedLanes,s=p.pingedLanes,r=p.expirationTimes,l=p.pendingLanes;0<l;){var C=31-Z0(l),S=1<<C,O=r[C];O===-1?(!(S&u)||S&s)&&(r[C]=Doe(S,o)):O<=o&&(p.expiredLanes|=S),l&=~S}}function wF(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function LV(){var p=mA;return mA<<=1,!(mA&4194240)&&(mA=64),p}function nI(p){for(var o=[],u=0;31>u;u++)o.push(p);return o}function HS(p,o,u){p.pendingLanes|=o,o!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,o=31-Z0(o),p[o]=u}function Ioe(p,o){var u=p.pendingLanes&~o;p.pendingLanes=o,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=o,p.mutableReadLanes&=o,p.entangledLanes&=o,o=p.entanglements;var s=p.eventTimes;for(p=p.expirationTimes;0<u;){var r=31-Z0(u),l=1<<r;o[r]=0,s[r]=-1,p[r]=-1,u&=~l}}function yR(p,o){var u=p.entangledLanes|=o;for(p=p.entanglements;u;){var s=31-Z0(u),r=1<<s;r&o|p[s]&o&&(p[s]|=o),u&=~r}}var us=0;function BV(p){return p&=-p,1<p?4<p?p&268435455?16:536870912:4:1}var jV,bR,zV,UV,WV,_F=!1,vA=[],Ib=null,Fb=null,Rb=null,CS=new Map,AS=new Map,Tb=[],Foe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function B7(p,o){switch(p){case"focusin":case"focusout":Ib=null;break;case"dragenter":case"dragleave":Fb=null;break;case"mouseover":case"mouseout":Rb=null;break;case"pointerover":case"pointerout":CS.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":AS.delete(o.pointerId)}}function qE(p,o,u,s,r,l){return p===null||p.nativeEvent!==l?(p={blockedOn:o,domEventName:u,eventSystemFlags:s,nativeEvent:l,targetContainers:[r]},o!==null&&(o=qS(o),o!==null&&bR(o)),p):(p.eventSystemFlags|=s,o=p.targetContainers,r!==null&&o.indexOf(r)===-1&&o.push(r),p)}function Roe(p,o,u,s,r){switch(o){case"focusin":return Ib=qE(Ib,p,o,u,s,r),!0;case"dragenter":return Fb=qE(Fb,p,o,u,s,r),!0;case"mouseover":return Rb=qE(Rb,p,o,u,s,r),!0;case"pointerover":var l=r.pointerId;return CS.set(l,qE(CS.get(l)||null,p,o,u,s,r)),!0;case"gotpointercapture":return l=r.pointerId,AS.set(l,qE(AS.get(l)||null,p,o,u,s,r)),!0}return!1}function VV(p){var o=Hx(p.target);if(o!==null){var u=lw(o);if(u!==null){if(o=u.tag,o===13){if(o=DV(u),o!==null){p.blockedOn=o,WV(p.priority,function(){zV(u)});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){p.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}p.blockedOn=null}function QA(p){if(p.blockedOn!==null)return!1;for(var o=p.targetContainers;0<o.length;){var u=EF(p.domEventName,p.eventSystemFlags,o[0],p.nativeEvent);if(u===null){u=p.nativeEvent;var s=new u.constructor(u.type,u);vF=s,u.target.dispatchEvent(s),vF=null}else return o=qS(u),o!==null&&bR(o),p.blockedOn=u,!1;o.shift()}return!0}function j7(p,o,u){QA(p)&&u.delete(o)}function Poe(){_F=!1,Ib!==null&&QA(Ib)&&(Ib=null),Fb!==null&&QA(Fb)&&(Fb=null),Rb!==null&&QA(Rb)&&(Rb=null),CS.forEach(j7),AS.forEach(j7)}function $E(p,o){p.blockedOn===o&&(p.blockedOn=null,_F||(_F=!0,Hm.unstable_scheduleCallback(Hm.unstable_NormalPriority,Poe)))}function OS(p){function o(r){return $E(r,p)}if(0<vA.length){$E(vA[0],p);for(var u=1;u<vA.length;u++){var s=vA[u];s.blockedOn===p&&(s.blockedOn=null)}}for(Ib!==null&&$E(Ib,p),Fb!==null&&$E(Fb,p),Rb!==null&&$E(Rb,p),CS.forEach(o),AS.forEach(o),u=0;u<Tb.length;u++)s=Tb[u],s.blockedOn===p&&(s.blockedOn=null);for(;0<Tb.length&&(u=Tb[0],u.blockedOn===null);)VV(u),u.blockedOn===null&&Tb.shift()}var P2=M1.ReactCurrentBatchConfig,mO=!0;function Loe(p,o,u,s){var r=us,l=P2.transition;P2.transition=null;try{us=1,xR(p,o,u,s)}finally{us=r,P2.transition=l}}function Boe(p,o,u,s){var r=us,l=P2.transition;P2.transition=null;try{us=4,xR(p,o,u,s)}finally{us=r,P2.transition=l}}function xR(p,o,u,s){if(mO){var r=EF(p,o,u,s);if(r===null)dI(p,o,s,gO,u),B7(p,s);else if(Roe(r,p,o,u,s))s.stopPropagation();else if(B7(p,s),o&4&&-1<Foe.indexOf(p)){for(;r!==null;){var l=qS(r);if(l!==null&&jV(l),l=EF(p,o,u,s),l===null&&dI(p,o,s,gO,u),l===r)break;r=l}r!==null&&s.stopPropagation()}else dI(p,o,s,null,u)}}var gO=null;function EF(p,o,u,s){if(gO=null,p=gR(s),p=Hx(p),p!==null)if(o=lw(p),o===null)p=null;else if(u=o.tag,u===13){if(p=DV(o),p!==null)return p;p=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;p=null}else o!==p&&(p=null);return gO=p,null}function HV(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(koe()){case vR:return 1;case RV:return 4;case hO:case Coe:return 16;case PV:return 536870912;default:return 16}default:return 16}}var Db=null,wR=null,ZA=null;function GV(){if(ZA)return ZA;var p,o=wR,u=o.length,s,r="value"in Db?Db.value:Db.textContent,l=r.length;for(p=0;p<u&&o[p]===r[p];p++);var C=u-p;for(s=1;s<=C&&o[u-s]===r[l-s];s++);return ZA=r.slice(p,1<s?1-s:void 0)}function eO(p){var o=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&o===13&&(p=13)):p=o,p===10&&(p=13),32<=p||p===13?p:0}function yA(){return!0}function z7(){return!1}function qm(p){function o(u,s,r,l,C){this._reactName=u,this._targetInst=r,this.type=s,this.nativeEvent=l,this.target=C,this.currentTarget=null;for(var S in p)p.hasOwnProperty(S)&&(u=p[S],this[S]=u?u(l):l[S]);return this.isDefaultPrevented=(l.defaultPrevented!=null?l.defaultPrevented:l.returnValue===!1)?yA:z7,this.isPropagationStopped=z7,this}return Tu(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=yA)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=yA)},persist:function(){},isPersistent:yA}),o}var Z2={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},_R=qm(Z2),GS=Tu({},Z2,{view:0,detail:0}),joe=qm(GS),rI,iI,XE,zO=Tu({},GS,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ER,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==XE&&(XE&&p.type==="mousemove"?(rI=p.screenX-XE.screenX,iI=p.screenY-XE.screenY):iI=rI=0,XE=p),rI)},movementY:function(p){return"movementY"in p?p.movementY:iI}}),U7=qm(zO),zoe=Tu({},zO,{dataTransfer:0}),Uoe=qm(zoe),Woe=Tu({},GS,{relatedTarget:0}),oI=qm(Woe),Voe=Tu({},Z2,{animationName:0,elapsedTime:0,pseudoElement:0}),Hoe=qm(Voe),Goe=Tu({},Z2,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),qoe=qm(Goe),$oe=Tu({},Z2,{data:0}),W7=qm($oe),Xoe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Koe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Yoe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Joe(p){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(p):(p=Yoe[p])?!!o[p]:!1}function ER(){return Joe}var Qoe=Tu({},GS,{key:function(p){if(p.key){var o=Xoe[p.key]||p.key;if(o!=="Unidentified")return o}return p.type==="keypress"?(p=eO(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?Koe[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ER,charCode:function(p){return p.type==="keypress"?eO(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?eO(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),Zoe=qm(Qoe),eae=Tu({},zO,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),V7=qm(eae),tae=Tu({},GS,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ER}),nae=qm(tae),rae=Tu({},Z2,{propertyName:0,elapsedTime:0,pseudoElement:0}),iae=qm(rae),oae=Tu({},zO,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),aae=qm(oae),sae=[9,13,27,32],SR=C1&&"CompositionEvent"in window,mS=null;C1&&"documentMode"in document&&(mS=document.documentMode);var uae=C1&&"TextEvent"in window&&!mS,qV=C1&&(!SR||mS&&8<mS&&11>=mS),H7=String.fromCharCode(32),G7=!1;function $V(p,o){switch(p){case"keyup":return sae.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function XV(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var _2=!1;function cae(p,o){switch(p){case"compositionend":return XV(o);case"keypress":return o.which!==32?null:(G7=!0,H7);case"textInput":return p=o.data,p===H7&&G7?null:p;default:return null}}function lae(p,o){if(_2)return p==="compositionend"||!SR&&$V(p,o)?(p=GV(),ZA=wR=Db=null,_2=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return qV&&o.locale!=="ko"?null:o.data;default:return null}}var fae={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function q7(p){var o=p&&p.nodeName&&p.nodeName.toLowerCase();return o==="input"?!!fae[p.type]:o==="textarea"}function KV(p,o,u,s){CV(s),o=vO(o,"onChange"),0<o.length&&(u=new _R("onChange","change",null,u,s),p.push({event:u,listeners:o}))}var gS=null,TS=null;function dae(p){aH(p,0)}function UO(p){var o=k2(p);if(bV(o))return p}function hae(p,o){if(p==="change")return o}var YV=!1;if(C1){var aI;if(C1){var sI="oninput"in document;if(!sI){var $7=document.createElement("div");$7.setAttribute("oninput","return;"),sI=typeof $7.oninput=="function"}aI=sI}else aI=!1;YV=aI&&(!document.documentMode||9<document.documentMode)}function X7(){gS&&(gS.detachEvent("onpropertychange",JV),TS=gS=null)}function JV(p){if(p.propertyName==="value"&&UO(TS)){var o=[];KV(o,TS,p,gR(p)),MV(dae,o)}}function pae(p,o,u){p==="focusin"?(X7(),gS=o,TS=u,gS.attachEvent("onpropertychange",JV)):p==="focusout"&&X7()}function mae(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return UO(TS)}function gae(p,o){if(p==="click")return UO(o)}function vae(p,o){if(p==="input"||p==="change")return UO(o)}function yae(p,o){return p===o&&(p!==0||1/p===1/o)||p!==p&&o!==o}var tv=typeof Object.is=="function"?Object.is:yae;function MS(p,o){if(tv(p,o))return!0;if(typeof p!="object"||p===null||typeof o!="object"||o===null)return!1;var u=Object.keys(p),s=Object.keys(o);if(u.length!==s.length)return!1;for(s=0;s<u.length;s++){var r=u[s];if(!oF.call(o,r)||!tv(p[r],o[r]))return!1}return!0}function K7(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function Y7(p,o){var u=K7(p);p=0;for(var s;u;){if(u.nodeType===3){if(s=p+u.textContent.length,p<=o&&s>=o)return{node:u,offset:o-p};p=s}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=K7(u)}}function QV(p,o){return p&&o?p===o?!0:p&&p.nodeType===3?!1:o&&o.nodeType===3?QV(p,o.parentNode):"contains"in p?p.contains(o):p.compareDocumentPosition?!!(p.compareDocumentPosition(o)&16):!1:!1}function ZV(){for(var p=window,o=lO();o instanceof p.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)p=o.contentWindow;else break;o=lO(p.document)}return o}function kR(p){var o=p&&p.nodeName&&p.nodeName.toLowerCase();return o&&(o==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||o==="textarea"||p.contentEditable==="true")}function bae(p){var o=ZV(),u=p.focusedElem,s=p.selectionRange;if(o!==u&&u&&u.ownerDocument&&QV(u.ownerDocument.documentElement,u)){if(s!==null&&kR(u)){if(o=s.start,p=s.end,p===void 0&&(p=o),"selectionStart"in u)u.selectionStart=o,u.selectionEnd=Math.min(p,u.value.length);else if(p=(o=u.ownerDocument||document)&&o.defaultView||window,p.getSelection){p=p.getSelection();var r=u.textContent.length,l=Math.min(s.start,r);s=s.end===void 0?l:Math.min(s.end,r),!p.extend&&l>s&&(r=s,s=l,l=r),r=Y7(u,l);var C=Y7(u,s);r&&C&&(p.rangeCount!==1||p.anchorNode!==r.node||p.anchorOffset!==r.offset||p.focusNode!==C.node||p.focusOffset!==C.offset)&&(o=o.createRange(),o.setStart(r.node,r.offset),p.removeAllRanges(),l>s?(p.addRange(o),p.extend(C.node,C.offset)):(o.setEnd(C.node,C.offset),p.addRange(o)))}}for(o=[],p=u;p=p.parentNode;)p.nodeType===1&&o.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof u.focus=="function"&&u.focus(),u=0;u<o.length;u++)p=o[u],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var xae=C1&&"documentMode"in document&&11>=document.documentMode,E2=null,SF=null,vS=null,kF=!1;function J7(p,o,u){var s=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;kF||E2==null||E2!==lO(s)||(s=E2,"selectionStart"in s&&kR(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),vS&&MS(vS,s)||(vS=s,s=vO(SF,"onSelect"),0<s.length&&(o=new _R("onSelect","select",null,o,u),p.push({event:o,listeners:s}),o.target=E2)))}function bA(p,o){var u={};return u[p.toLowerCase()]=o.toLowerCase(),u["Webkit"+p]="webkit"+o,u["Moz"+p]="moz"+o,u}var S2={animationend:bA("Animation","AnimationEnd"),animationiteration:bA("Animation","AnimationIteration"),animationstart:bA("Animation","AnimationStart"),transitionend:bA("Transition","TransitionEnd")},uI={},eH={};C1&&(eH=document.createElement("div").style,"AnimationEvent"in window||(delete S2.animationend.animation,delete S2.animationiteration.animation,delete S2.animationstart.animation),"TransitionEvent"in window||delete S2.transitionend.transition);function WO(p){if(uI[p])return uI[p];if(!S2[p])return p;var o=S2[p],u;for(u in o)if(o.hasOwnProperty(u)&&u in eH)return uI[p]=o[u];return p}var tH=WO("animationend"),nH=WO("animationiteration"),rH=WO("animationstart"),iH=WO("transitionend"),oH=new Map,Q7="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Hb(p,o){oH.set(p,o),cw(o,[p])}for(var cI=0;cI<Q7.length;cI++){var lI=Q7[cI],wae=lI.toLowerCase(),_ae=lI[0].toUpperCase()+lI.slice(1);Hb(wae,"on"+_ae)}Hb(tH,"onAnimationEnd");Hb(nH,"onAnimationIteration");Hb(rH,"onAnimationStart");Hb("dblclick","onDoubleClick");Hb("focusin","onFocus");Hb("focusout","onBlur");Hb(iH,"onTransitionEnd");U2("onMouseEnter",["mouseout","mouseover"]);U2("onMouseLeave",["mouseout","mouseover"]);U2("onPointerEnter",["pointerout","pointerover"]);U2("onPointerLeave",["pointerout","pointerover"]);cw("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));cw("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));cw("onBeforeInput",["compositionend","keypress","textInput","paste"]);cw("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));cw("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));cw("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lS="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Eae=new Set("cancel close invalid load scroll toggle".split(" ").concat(lS));function Z7(p,o,u){var s=p.type||"unknown-event";p.currentTarget=u,woe(s,o,void 0,p),p.currentTarget=null}function aH(p,o){o=(o&4)!==0;for(var u=0;u<p.length;u++){var s=p[u],r=s.event;s=s.listeners;e:{var l=void 0;if(o)for(var C=s.length-1;0<=C;C--){var S=s[C],O=S.instance,U=S.currentTarget;if(S=S.listener,O!==l&&r.isPropagationStopped())break e;Z7(r,S,U),l=O}else for(C=0;C<s.length;C++){if(S=s[C],O=S.instance,U=S.currentTarget,S=S.listener,O!==l&&r.isPropagationStopped())break e;Z7(r,S,U),l=O}}}if(dO)throw p=xF,dO=!1,xF=null,p}function eu(p,o){var u=o[MF];u===void 0&&(u=o[MF]=new Set);var s=p+"__bubble";u.has(s)||(sH(o,p,2,!1),u.add(s))}function fI(p,o,u){var s=0;o&&(s|=4),sH(u,p,s,o)}var xA="_reactListening"+Math.random().toString(36).slice(2);function DS(p){if(!p[xA]){p[xA]=!0,pV.forEach(function(u){u!=="selectionchange"&&(Eae.has(u)||fI(u,!1,p),fI(u,!0,p))});var o=p.nodeType===9?p:p.ownerDocument;o===null||o[xA]||(o[xA]=!0,fI("selectionchange",!1,o))}}function sH(p,o,u,s){switch(HV(o)){case 1:var r=Loe;break;case 4:r=Boe;break;default:r=xR}u=r.bind(null,o,u,p),r=void 0,!bF||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(r=!0),s?r!==void 0?p.addEventListener(o,u,{capture:!0,passive:r}):p.addEventListener(o,u,!0):r!==void 0?p.addEventListener(o,u,{passive:r}):p.addEventListener(o,u,!1)}function dI(p,o,u,s,r){var l=s;if(!(o&1)&&!(o&2)&&s!==null)e:for(;;){if(s===null)return;var C=s.tag;if(C===3||C===4){var S=s.stateNode.containerInfo;if(S===r||S.nodeType===8&&S.parentNode===r)break;if(C===4)for(C=s.return;C!==null;){var O=C.tag;if((O===3||O===4)&&(O=C.stateNode.containerInfo,O===r||O.nodeType===8&&O.parentNode===r))return;C=C.return}for(;S!==null;){if(C=Hx(S),C===null)return;if(O=C.tag,O===5||O===6){s=l=C;continue e}S=S.parentNode}}s=s.return}MV(function(){var U=l,j=gR(u),N=[];e:{var L=oH.get(p);if(L!==void 0){var W=_R,z=p;switch(p){case"keypress":if(eO(u)===0)break e;case"keydown":case"keyup":W=Zoe;break;case"focusin":z="focus",W=oI;break;case"focusout":z="blur",W=oI;break;case"beforeblur":case"afterblur":W=oI;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":W=U7;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":W=Uoe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":W=nae;break;case tH:case nH:case rH:W=Hoe;break;case iH:W=iae;break;case"scroll":W=joe;break;case"wheel":W=aae;break;case"copy":case"cut":case"paste":W=qoe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":W=V7}var q=(o&4)!==0,I=!q&&p==="scroll",Z=q?L!==null?L+"Capture":null:L;q=[];for(var Y=U,G;Y!==null;){G=Y;var oe=G.stateNode;if(G.tag===5&&oe!==null&&(G=oe,Z!==null&&(oe=kS(Y,Z),oe!=null&&q.push(NS(Y,oe,G)))),I)break;Y=Y.return}0<q.length&&(L=new W(L,z,null,u,j),N.push({event:L,listeners:q}))}}if(!(o&7)){e:{if(L=p==="mouseover"||p==="pointerover",W=p==="mouseout"||p==="pointerout",L&&u!==vF&&(z=u.relatedTarget||u.fromElement)&&(Hx(z)||z[A1]))break e;if((W||L)&&(L=j.window===j?j:(L=j.ownerDocument)?L.defaultView||L.parentWindow:window,W?(z=u.relatedTarget||u.toElement,W=U,z=z?Hx(z):null,z!==null&&(I=lw(z),z!==I||z.tag!==5&&z.tag!==6)&&(z=null)):(W=null,z=U),W!==z)){if(q=U7,oe="onMouseLeave",Z="onMouseEnter",Y="mouse",(p==="pointerout"||p==="pointerover")&&(q=V7,oe="onPointerLeave",Z="onPointerEnter",Y="pointer"),I=W==null?L:k2(W),G=z==null?L:k2(z),L=new q(oe,Y+"leave",W,u,j),L.target=I,L.relatedTarget=G,oe=null,Hx(j)===U&&(q=new q(Z,Y+"enter",z,u,j),q.target=G,q.relatedTarget=I,oe=q),I=oe,W&&z)t:{for(q=W,Z=z,Y=0,G=q;G;G=i2(G))Y++;for(G=0,oe=Z;oe;oe=i2(oe))G++;for(;0<Y-G;)q=i2(q),Y--;for(;0<G-Y;)Z=i2(Z),G--;for(;Y--;){if(q===Z||Z!==null&&q===Z.alternate)break t;q=i2(q),Z=i2(Z)}q=null}else q=null;W!==null&&eU(N,L,W,q,!1),z!==null&&I!==null&&eU(N,I,z,q,!0)}}e:{if(L=U?k2(U):window,W=L.nodeName&&L.nodeName.toLowerCase(),W==="select"||W==="input"&&L.type==="file")var ce=hae;else if(q7(L))if(YV)ce=vae;else{ce=mae;var be=pae}else(W=L.nodeName)&&W.toLowerCase()==="input"&&(L.type==="checkbox"||L.type==="radio")&&(ce=gae);if(ce&&(ce=ce(p,U))){KV(N,ce,u,j);break e}be&&be(p,L,U),p==="focusout"&&(be=L._wrapperState)&&be.controlled&&L.type==="number"&&dF(L,"number",L.value)}switch(be=U?k2(U):window,p){case"focusin":(q7(be)||be.contentEditable==="true")&&(E2=be,SF=U,vS=null);break;case"focusout":vS=SF=E2=null;break;case"mousedown":kF=!0;break;case"contextmenu":case"mouseup":case"dragend":kF=!1,J7(N,u,j);break;case"selectionchange":if(xae)break;case"keydown":case"keyup":J7(N,u,j)}var Ee;if(SR)e:{switch(p){case"compositionstart":var ve="onCompositionStart";break e;case"compositionend":ve="onCompositionEnd";break e;case"compositionupdate":ve="onCompositionUpdate";break e}ve=void 0}else _2?$V(p,u)&&(ve="onCompositionEnd"):p==="keydown"&&u.keyCode===229&&(ve="onCompositionStart");ve&&(qV&&u.locale!=="ko"&&(_2||ve!=="onCompositionStart"?ve==="onCompositionEnd"&&_2&&(Ee=GV()):(Db=j,wR="value"in Db?Db.value:Db.textContent,_2=!0)),be=vO(U,ve),0<be.length&&(ve=new W7(ve,p,null,u,j),N.push({event:ve,listeners:be}),Ee?ve.data=Ee:(Ee=XV(u),Ee!==null&&(ve.data=Ee)))),(Ee=uae?cae(p,u):lae(p,u))&&(U=vO(U,"onBeforeInput"),0<U.length&&(j=new W7("onBeforeInput","beforeinput",null,u,j),N.push({event:j,listeners:U}),j.data=Ee))}aH(N,o)})}function NS(p,o,u){return{instance:p,listener:o,currentTarget:u}}function vO(p,o){for(var u=o+"Capture",s=[];p!==null;){var r=p,l=r.stateNode;r.tag===5&&l!==null&&(r=l,l=kS(p,u),l!=null&&s.unshift(NS(p,l,r)),l=kS(p,o),l!=null&&s.push(NS(p,l,r))),p=p.return}return s}function i2(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function eU(p,o,u,s,r){for(var l=o._reactName,C=[];u!==null&&u!==s;){var S=u,O=S.alternate,U=S.stateNode;if(O!==null&&O===s)break;S.tag===5&&U!==null&&(S=U,r?(O=kS(u,l),O!=null&&C.unshift(NS(u,O,S))):r||(O=kS(u,l),O!=null&&C.push(NS(u,O,S)))),u=u.return}C.length!==0&&p.push({event:o,listeners:C})}var Sae=/\r\n?/g,kae=/\u0000|\uFFFD/g;function tU(p){return(typeof p=="string"?p:""+p).replace(Sae,`
`).replace(kae,"")}function wA(p,o,u){if(o=tU(o),tU(p)!==o&&u)throw Error(ui(425))}function yO(){}var CF=null,AF=null;function OF(p,o){return p==="textarea"||p==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var TF=typeof setTimeout=="function"?setTimeout:void 0,Cae=typeof clearTimeout=="function"?clearTimeout:void 0,nU=typeof Promise=="function"?Promise:void 0,Aae=typeof queueMicrotask=="function"?queueMicrotask:typeof nU<"u"?function(p){return nU.resolve(null).then(p).catch(Oae)}:TF;function Oae(p){setTimeout(function(){throw p})}function hI(p,o){var u=o,s=0;do{var r=u.nextSibling;if(p.removeChild(u),r&&r.nodeType===8)if(u=r.data,u==="/$"){if(s===0){p.removeChild(r),OS(o);return}s--}else u!=="$"&&u!=="$?"&&u!=="$!"||s++;u=r}while(u);OS(o)}function Pb(p){for(;p!=null;p=p.nextSibling){var o=p.nodeType;if(o===1||o===3)break;if(o===8){if(o=p.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return p}function rU(p){p=p.previousSibling;for(var o=0;p;){if(p.nodeType===8){var u=p.data;if(u==="$"||u==="$!"||u==="$?"){if(o===0)return p;o--}else u==="/$"&&o++}p=p.previousSibling}return null}var e_=Math.random().toString(36).slice(2),xy="__reactFiber$"+e_,IS="__reactProps$"+e_,A1="__reactContainer$"+e_,MF="__reactEvents$"+e_,Tae="__reactListeners$"+e_,Mae="__reactHandles$"+e_;function Hx(p){var o=p[xy];if(o)return o;for(var u=p.parentNode;u;){if(o=u[A1]||u[xy]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(p=rU(p);p!==null;){if(u=p[xy])return u;p=rU(p)}return o}p=u,u=p.parentNode}return null}function qS(p){return p=p[xy]||p[A1],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function k2(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(ui(33))}function VO(p){return p[IS]||null}var DF=[],C2=-1;function Gb(p){return{current:p}}function nu(p){0>C2||(p.current=DF[C2],DF[C2]=null,C2--)}function Gs(p,o){C2++,DF[C2]=p.current,p.current=o}var Vb={},ad=Gb(Vb),Mp=Gb(!1),Zx=Vb;function W2(p,o){var u=p.type.contextTypes;if(!u)return Vb;var s=p.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===o)return s.__reactInternalMemoizedMaskedChildContext;var r={},l;for(l in u)r[l]=o[l];return s&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=o,p.__reactInternalMemoizedMaskedChildContext=r),r}function Dp(p){return p=p.childContextTypes,p!=null}function bO(){nu(Mp),nu(ad)}function iU(p,o,u){if(ad.current!==Vb)throw Error(ui(168));Gs(ad,o),Gs(Mp,u)}function uH(p,o,u){var s=p.stateNode;if(o=o.childContextTypes,typeof s.getChildContext!="function")return u;s=s.getChildContext();for(var r in s)if(!(r in o))throw Error(ui(108,poe(p)||"Unknown",r));return Tu({},u,s)}function xO(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||Vb,Zx=ad.current,Gs(ad,p),Gs(Mp,Mp.current),!0}function oU(p,o,u){var s=p.stateNode;if(!s)throw Error(ui(169));u?(p=uH(p,o,Zx),s.__reactInternalMemoizedMergedChildContext=p,nu(Mp),nu(ad),Gs(ad,p)):nu(Mp),Gs(Mp,u)}var x1=null,HO=!1,pI=!1;function cH(p){x1===null?x1=[p]:x1.push(p)}function Dae(p){HO=!0,cH(p)}function qb(){if(!pI&&x1!==null){pI=!0;var p=0,o=us;try{var u=x1;for(us=1;p<u.length;p++){var s=u[p];do s=s(!0);while(s!==null)}x1=null,HO=!1}catch(r){throw x1!==null&&(x1=x1.slice(p+1)),FV(vR,qb),r}finally{us=o,pI=!1}}return null}var A2=[],O2=0,wO=null,_O=0,Lg=[],Bg=0,ew=null,_1=1,E1="";function jx(p,o){A2[O2++]=_O,A2[O2++]=wO,wO=p,_O=o}function lH(p,o,u){Lg[Bg++]=_1,Lg[Bg++]=E1,Lg[Bg++]=ew,ew=p;var s=_1;p=E1;var r=32-Z0(s)-1;s&=~(1<<r),u+=1;var l=32-Z0(o)+r;if(30<l){var C=r-r%5;l=(s&(1<<C)-1).toString(32),s>>=C,r-=C,_1=1<<32-Z0(o)+r|u<<r|s,E1=l+p}else _1=1<<l|u<<r|s,E1=p}function CR(p){p.return!==null&&(jx(p,1),lH(p,1,0))}function AR(p){for(;p===wO;)wO=A2[--O2],A2[O2]=null,_O=A2[--O2],A2[O2]=null;for(;p===ew;)ew=Lg[--Bg],Lg[Bg]=null,E1=Lg[--Bg],Lg[Bg]=null,_1=Lg[--Bg],Lg[Bg]=null}var Vm=null,Um=null,vu=!1,K0=null;function fH(p,o){var u=zg(5,null,null,0);u.elementType="DELETED",u.stateNode=o,u.return=p,o=p.deletions,o===null?(p.deletions=[u],p.flags|=16):o.push(u)}function aU(p,o){switch(p.tag){case 5:var u=p.type;return o=o.nodeType!==1||u.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(p.stateNode=o,Vm=p,Um=Pb(o.firstChild),!0):!1;case 6:return o=p.pendingProps===""||o.nodeType!==3?null:o,o!==null?(p.stateNode=o,Vm=p,Um=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(u=ew!==null?{id:_1,overflow:E1}:null,p.memoizedState={dehydrated:o,treeContext:u,retryLane:1073741824},u=zg(18,null,null,0),u.stateNode=o,u.return=p,p.child=u,Vm=p,Um=null,!0):!1;default:return!1}}function NF(p){return(p.mode&1)!==0&&(p.flags&128)===0}function IF(p){if(vu){var o=Um;if(o){var u=o;if(!aU(p,o)){if(NF(p))throw Error(ui(418));o=Pb(u.nextSibling);var s=Vm;o&&aU(p,o)?fH(s,u):(p.flags=p.flags&-4097|2,vu=!1,Vm=p)}}else{if(NF(p))throw Error(ui(418));p.flags=p.flags&-4097|2,vu=!1,Vm=p}}}function sU(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;Vm=p}function _A(p){if(p!==Vm)return!1;if(!vu)return sU(p),vu=!0,!1;var o;if((o=p.tag!==3)&&!(o=p.tag!==5)&&(o=p.type,o=o!=="head"&&o!=="body"&&!OF(p.type,p.memoizedProps)),o&&(o=Um)){if(NF(p))throw dH(),Error(ui(418));for(;o;)fH(p,o),o=Pb(o.nextSibling)}if(sU(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(ui(317));e:{for(p=p.nextSibling,o=0;p;){if(p.nodeType===8){var u=p.data;if(u==="/$"){if(o===0){Um=Pb(p.nextSibling);break e}o--}else u!=="$"&&u!=="$!"&&u!=="$?"||o++}p=p.nextSibling}Um=null}}else Um=Vm?Pb(p.stateNode.nextSibling):null;return!0}function dH(){for(var p=Um;p;)p=Pb(p.nextSibling)}function V2(){Um=Vm=null,vu=!1}function OR(p){K0===null?K0=[p]:K0.push(p)}var Nae=M1.ReactCurrentBatchConfig;function $0(p,o){if(p&&p.defaultProps){o=Tu({},o),p=p.defaultProps;for(var u in p)o[u]===void 0&&(o[u]=p[u]);return o}return o}var EO=Gb(null),SO=null,T2=null,TR=null;function MR(){TR=T2=SO=null}function DR(p){var o=EO.current;nu(EO),p._currentValue=o}function FF(p,o,u){for(;p!==null;){var s=p.alternate;if((p.childLanes&o)!==o?(p.childLanes|=o,s!==null&&(s.childLanes|=o)):s!==null&&(s.childLanes&o)!==o&&(s.childLanes|=o),p===u)break;p=p.return}}function L2(p,o){SO=p,TR=T2=null,p=p.dependencies,p!==null&&p.firstContext!==null&&(p.lanes&o&&(Op=!0),p.firstContext=null)}function Vg(p){var o=p._currentValue;if(TR!==p)if(p={context:p,memoizedValue:o,next:null},T2===null){if(SO===null)throw Error(ui(308));T2=p,SO.dependencies={lanes:0,firstContext:p}}else T2=T2.next=p;return o}var Gx=null;function NR(p){Gx===null?Gx=[p]:Gx.push(p)}function hH(p,o,u,s){var r=o.interleaved;return r===null?(u.next=u,NR(o)):(u.next=r.next,r.next=u),o.interleaved=u,O1(p,s)}function O1(p,o){p.lanes|=o;var u=p.alternate;for(u!==null&&(u.lanes|=o),u=p,p=p.return;p!==null;)p.childLanes|=o,u=p.alternate,u!==null&&(u.childLanes|=o),u=p,p=p.return;return u.tag===3?u.stateNode:null}var Ob=!1;function IR(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function pH(p,o){p=p.updateQueue,o.updateQueue===p&&(o.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function S1(p,o){return{eventTime:p,lane:o,tag:0,payload:null,callback:null,next:null}}function Lb(p,o,u){var s=p.updateQueue;if(s===null)return null;if(s=s.shared,Ia&2){var r=s.pending;return r===null?o.next=o:(o.next=r.next,r.next=o),s.pending=o,O1(p,u)}return r=s.interleaved,r===null?(o.next=o,NR(s)):(o.next=r.next,r.next=o),s.interleaved=o,O1(p,u)}function tO(p,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194240)!==0)){var s=o.lanes;s&=p.pendingLanes,u|=s,o.lanes=u,yR(p,u)}}function uU(p,o){var u=p.updateQueue,s=p.alternate;if(s!==null&&(s=s.updateQueue,u===s)){var r=null,l=null;if(u=u.firstBaseUpdate,u!==null){do{var C={eventTime:u.eventTime,lane:u.lane,tag:u.tag,payload:u.payload,callback:u.callback,next:null};l===null?r=l=C:l=l.next=C,u=u.next}while(u!==null);l===null?r=l=o:l=l.next=o}else r=l=o;u={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:l,shared:s.shared,effects:s.effects},p.updateQueue=u;return}p=u.lastBaseUpdate,p===null?u.firstBaseUpdate=o:p.next=o,u.lastBaseUpdate=o}function kO(p,o,u,s){var r=p.updateQueue;Ob=!1;var l=r.firstBaseUpdate,C=r.lastBaseUpdate,S=r.shared.pending;if(S!==null){r.shared.pending=null;var O=S,U=O.next;O.next=null,C===null?l=U:C.next=U,C=O;var j=p.alternate;j!==null&&(j=j.updateQueue,S=j.lastBaseUpdate,S!==C&&(S===null?j.firstBaseUpdate=U:S.next=U,j.lastBaseUpdate=O))}if(l!==null){var N=r.baseState;C=0,j=U=O=null,S=l;do{var L=S.lane,W=S.eventTime;if((s&L)===L){j!==null&&(j=j.next={eventTime:W,lane:0,tag:S.tag,payload:S.payload,callback:S.callback,next:null});e:{var z=p,q=S;switch(L=o,W=u,q.tag){case 1:if(z=q.payload,typeof z=="function"){N=z.call(W,N,L);break e}N=z;break e;case 3:z.flags=z.flags&-65537|128;case 0:if(z=q.payload,L=typeof z=="function"?z.call(W,N,L):z,L==null)break e;N=Tu({},N,L);break e;case 2:Ob=!0}}S.callback!==null&&S.lane!==0&&(p.flags|=64,L=r.effects,L===null?r.effects=[S]:L.push(S))}else W={eventTime:W,lane:L,tag:S.tag,payload:S.payload,callback:S.callback,next:null},j===null?(U=j=W,O=N):j=j.next=W,C|=L;if(S=S.next,S===null){if(S=r.shared.pending,S===null)break;L=S,S=L.next,L.next=null,r.lastBaseUpdate=L,r.shared.pending=null}}while(1);if(j===null&&(O=N),r.baseState=O,r.firstBaseUpdate=U,r.lastBaseUpdate=j,o=r.shared.interleaved,o!==null){r=o;do C|=r.lane,r=r.next;while(r!==o)}else l===null&&(r.shared.lanes=0);nw|=C,p.lanes=C,p.memoizedState=N}}function cU(p,o,u){if(p=o.effects,o.effects=null,p!==null)for(o=0;o<p.length;o++){var s=p[o],r=s.callback;if(r!==null){if(s.callback=null,s=u,typeof r!="function")throw Error(ui(191,r));r.call(s)}}}var mH=new hV.Component().refs;function RF(p,o,u,s){o=p.memoizedState,u=u(s,o),u=u==null?o:Tu({},o,u),p.memoizedState=u,p.lanes===0&&(p.updateQueue.baseState=u)}var GO={isMounted:function(p){return(p=p._reactInternals)?lw(p)===p:!1},enqueueSetState:function(p,o,u){p=p._reactInternals;var s=vh(),r=jb(p),l=S1(s,r);l.payload=o,u!=null&&(l.callback=u),o=Lb(p,l,r),o!==null&&(ev(o,p,r,s),tO(o,p,r))},enqueueReplaceState:function(p,o,u){p=p._reactInternals;var s=vh(),r=jb(p),l=S1(s,r);l.tag=1,l.payload=o,u!=null&&(l.callback=u),o=Lb(p,l,r),o!==null&&(ev(o,p,r,s),tO(o,p,r))},enqueueForceUpdate:function(p,o){p=p._reactInternals;var u=vh(),s=jb(p),r=S1(u,s);r.tag=2,o!=null&&(r.callback=o),o=Lb(p,r,s),o!==null&&(ev(o,p,s,u),tO(o,p,s))}};function lU(p,o,u,s,r,l,C){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(s,l,C):o.prototype&&o.prototype.isPureReactComponent?!MS(u,s)||!MS(r,l):!0}function gH(p,o,u){var s=!1,r=Vb,l=o.contextType;return typeof l=="object"&&l!==null?l=Vg(l):(r=Dp(o)?Zx:ad.current,s=o.contextTypes,l=(s=s!=null)?W2(p,r):Vb),o=new o(u,l),p.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=GO,p.stateNode=o,o._reactInternals=p,s&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=r,p.__reactInternalMemoizedMaskedChildContext=l),o}function fU(p,o,u,s){p=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,s),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,s),o.state!==p&&GO.enqueueReplaceState(o,o.state,null)}function PF(p,o,u,s){var r=p.stateNode;r.props=u,r.state=p.memoizedState,r.refs=mH,IR(p);var l=o.contextType;typeof l=="object"&&l!==null?r.context=Vg(l):(l=Dp(o)?Zx:ad.current,r.context=W2(p,l)),r.state=p.memoizedState,l=o.getDerivedStateFromProps,typeof l=="function"&&(RF(p,o,l,u),r.state=p.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(o=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),o!==r.state&&GO.enqueueReplaceState(r,r.state,null),kO(p,u,r,s),r.state=p.memoizedState),typeof r.componentDidMount=="function"&&(p.flags|=4194308)}function KE(p,o,u){if(p=u.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(u._owner){if(u=u._owner,u){if(u.tag!==1)throw Error(ui(309));var s=u.stateNode}if(!s)throw Error(ui(147,p));var r=s,l=""+p;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===l?o.ref:(o=function(C){var S=r.refs;S===mH&&(S=r.refs={}),C===null?delete S[l]:S[l]=C},o._stringRef=l,o)}if(typeof p!="string")throw Error(ui(284));if(!u._owner)throw Error(ui(290,p))}return p}function EA(p,o){throw p=Object.prototype.toString.call(o),Error(ui(31,p==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":p))}function dU(p){var o=p._init;return o(p._payload)}function vH(p){function o(Z,Y){if(p){var G=Z.deletions;G===null?(Z.deletions=[Y],Z.flags|=16):G.push(Y)}}function u(Z,Y){if(!p)return null;for(;Y!==null;)o(Z,Y),Y=Y.sibling;return null}function s(Z,Y){for(Z=new Map;Y!==null;)Y.key!==null?Z.set(Y.key,Y):Z.set(Y.index,Y),Y=Y.sibling;return Z}function r(Z,Y){return Z=zb(Z,Y),Z.index=0,Z.sibling=null,Z}function l(Z,Y,G){return Z.index=G,p?(G=Z.alternate,G!==null?(G=G.index,G<Y?(Z.flags|=2,Y):G):(Z.flags|=2,Y)):(Z.flags|=1048576,Y)}function C(Z){return p&&Z.alternate===null&&(Z.flags|=2),Z}function S(Z,Y,G,oe){return Y===null||Y.tag!==6?(Y=wI(G,Z.mode,oe),Y.return=Z,Y):(Y=r(Y,G),Y.return=Z,Y)}function O(Z,Y,G,oe){var ce=G.type;return ce===w2?j(Z,Y,G.props.children,oe,G.key):Y!==null&&(Y.elementType===ce||typeof ce=="object"&&ce!==null&&ce.$$typeof===Ab&&dU(ce)===Y.type)?(oe=r(Y,G.props),oe.ref=KE(Z,Y,G),oe.return=Z,oe):(oe=sO(G.type,G.key,G.props,null,Z.mode,oe),oe.ref=KE(Z,Y,G),oe.return=Z,oe)}function U(Z,Y,G,oe){return Y===null||Y.tag!==4||Y.stateNode.containerInfo!==G.containerInfo||Y.stateNode.implementation!==G.implementation?(Y=_I(G,Z.mode,oe),Y.return=Z,Y):(Y=r(Y,G.children||[]),Y.return=Z,Y)}function j(Z,Y,G,oe,ce){return Y===null||Y.tag!==7?(Y=Yx(G,Z.mode,oe,ce),Y.return=Z,Y):(Y=r(Y,G),Y.return=Z,Y)}function N(Z,Y,G){if(typeof Y=="string"&&Y!==""||typeof Y=="number")return Y=wI(""+Y,Z.mode,G),Y.return=Z,Y;if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case dA:return G=sO(Y.type,Y.key,Y.props,null,Z.mode,G),G.ref=KE(Z,null,Y),G.return=Z,G;case x2:return Y=_I(Y,Z.mode,G),Y.return=Z,Y;case Ab:var oe=Y._init;return N(Z,oe(Y._payload),G)}if(uS(Y)||HE(Y))return Y=Yx(Y,Z.mode,G,null),Y.return=Z,Y;EA(Z,Y)}return null}function L(Z,Y,G,oe){var ce=Y!==null?Y.key:null;if(typeof G=="string"&&G!==""||typeof G=="number")return ce!==null?null:S(Z,Y,""+G,oe);if(typeof G=="object"&&G!==null){switch(G.$$typeof){case dA:return G.key===ce?O(Z,Y,G,oe):null;case x2:return G.key===ce?U(Z,Y,G,oe):null;case Ab:return ce=G._init,L(Z,Y,ce(G._payload),oe)}if(uS(G)||HE(G))return ce!==null?null:j(Z,Y,G,oe,null);EA(Z,G)}return null}function W(Z,Y,G,oe,ce){if(typeof oe=="string"&&oe!==""||typeof oe=="number")return Z=Z.get(G)||null,S(Y,Z,""+oe,ce);if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case dA:return Z=Z.get(oe.key===null?G:oe.key)||null,O(Y,Z,oe,ce);case x2:return Z=Z.get(oe.key===null?G:oe.key)||null,U(Y,Z,oe,ce);case Ab:var be=oe._init;return W(Z,Y,G,be(oe._payload),ce)}if(uS(oe)||HE(oe))return Z=Z.get(G)||null,j(Y,Z,oe,ce,null);EA(Y,oe)}return null}function z(Z,Y,G,oe){for(var ce=null,be=null,Ee=Y,ve=Y=0,ge=null;Ee!==null&&ve<G.length;ve++){Ee.index>ve?(ge=Ee,Ee=null):ge=Ee.sibling;var Ge=L(Z,Ee,G[ve],oe);if(Ge===null){Ee===null&&(Ee=ge);break}p&&Ee&&Ge.alternate===null&&o(Z,Ee),Y=l(Ge,Y,ve),be===null?ce=Ge:be.sibling=Ge,be=Ge,Ee=ge}if(ve===G.length)return u(Z,Ee),vu&&jx(Z,ve),ce;if(Ee===null){for(;ve<G.length;ve++)Ee=N(Z,G[ve],oe),Ee!==null&&(Y=l(Ee,Y,ve),be===null?ce=Ee:be.sibling=Ee,be=Ee);return vu&&jx(Z,ve),ce}for(Ee=s(Z,Ee);ve<G.length;ve++)ge=W(Ee,Z,ve,G[ve],oe),ge!==null&&(p&&ge.alternate!==null&&Ee.delete(ge.key===null?ve:ge.key),Y=l(ge,Y,ve),be===null?ce=ge:be.sibling=ge,be=ge);return p&&Ee.forEach(function(ht){return o(Z,ht)}),vu&&jx(Z,ve),ce}function q(Z,Y,G,oe){var ce=HE(G);if(typeof ce!="function")throw Error(ui(150));if(G=ce.call(G),G==null)throw Error(ui(151));for(var be=ce=null,Ee=Y,ve=Y=0,ge=null,Ge=G.next();Ee!==null&&!Ge.done;ve++,Ge=G.next()){Ee.index>ve?(ge=Ee,Ee=null):ge=Ee.sibling;var ht=L(Z,Ee,Ge.value,oe);if(ht===null){Ee===null&&(Ee=ge);break}p&&Ee&&ht.alternate===null&&o(Z,Ee),Y=l(ht,Y,ve),be===null?ce=ht:be.sibling=ht,be=ht,Ee=ge}if(Ge.done)return u(Z,Ee),vu&&jx(Z,ve),ce;if(Ee===null){for(;!Ge.done;ve++,Ge=G.next())Ge=N(Z,Ge.value,oe),Ge!==null&&(Y=l(Ge,Y,ve),be===null?ce=Ge:be.sibling=Ge,be=Ge);return vu&&jx(Z,ve),ce}for(Ee=s(Z,Ee);!Ge.done;ve++,Ge=G.next())Ge=W(Ee,Z,ve,Ge.value,oe),Ge!==null&&(p&&Ge.alternate!==null&&Ee.delete(Ge.key===null?ve:Ge.key),Y=l(Ge,Y,ve),be===null?ce=Ge:be.sibling=Ge,be=Ge);return p&&Ee.forEach(function(It){return o(Z,It)}),vu&&jx(Z,ve),ce}function I(Z,Y,G,oe){if(typeof G=="object"&&G!==null&&G.type===w2&&G.key===null&&(G=G.props.children),typeof G=="object"&&G!==null){switch(G.$$typeof){case dA:e:{for(var ce=G.key,be=Y;be!==null;){if(be.key===ce){if(ce=G.type,ce===w2){if(be.tag===7){u(Z,be.sibling),Y=r(be,G.props.children),Y.return=Z,Z=Y;break e}}else if(be.elementType===ce||typeof ce=="object"&&ce!==null&&ce.$$typeof===Ab&&dU(ce)===be.type){u(Z,be.sibling),Y=r(be,G.props),Y.ref=KE(Z,be,G),Y.return=Z,Z=Y;break e}u(Z,be);break}else o(Z,be);be=be.sibling}G.type===w2?(Y=Yx(G.props.children,Z.mode,oe,G.key),Y.return=Z,Z=Y):(oe=sO(G.type,G.key,G.props,null,Z.mode,oe),oe.ref=KE(Z,Y,G),oe.return=Z,Z=oe)}return C(Z);case x2:e:{for(be=G.key;Y!==null;){if(Y.key===be)if(Y.tag===4&&Y.stateNode.containerInfo===G.containerInfo&&Y.stateNode.implementation===G.implementation){u(Z,Y.sibling),Y=r(Y,G.children||[]),Y.return=Z,Z=Y;break e}else{u(Z,Y);break}else o(Z,Y);Y=Y.sibling}Y=_I(G,Z.mode,oe),Y.return=Z,Z=Y}return C(Z);case Ab:return be=G._init,I(Z,Y,be(G._payload),oe)}if(uS(G))return z(Z,Y,G,oe);if(HE(G))return q(Z,Y,G,oe);EA(Z,G)}return typeof G=="string"&&G!==""||typeof G=="number"?(G=""+G,Y!==null&&Y.tag===6?(u(Z,Y.sibling),Y=r(Y,G),Y.return=Z,Z=Y):(u(Z,Y),Y=wI(G,Z.mode,oe),Y.return=Z,Z=Y),C(Z)):u(Z,Y)}return I}var H2=vH(!0),yH=vH(!1),$S={},_y=Gb($S),FS=Gb($S),RS=Gb($S);function qx(p){if(p===$S)throw Error(ui(174));return p}function FR(p,o){switch(Gs(RS,o),Gs(FS,p),Gs(_y,$S),p=o.nodeType,p){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:pF(null,"");break;default:p=p===8?o.parentNode:o,o=p.namespaceURI||null,p=p.tagName,o=pF(o,p)}nu(_y),Gs(_y,o)}function G2(){nu(_y),nu(FS),nu(RS)}function bH(p){qx(RS.current);var o=qx(_y.current),u=pF(o,p.type);o!==u&&(Gs(FS,p),Gs(_y,u))}function RR(p){FS.current===p&&(nu(_y),nu(FS))}var Au=Gb(0);function CO(p){for(var o=p;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||u.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===p)break;for(;o.sibling===null;){if(o.return===null||o.return===p)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var mI=[];function PR(){for(var p=0;p<mI.length;p++)mI[p]._workInProgressVersionPrimary=null;mI.length=0}var nO=M1.ReactCurrentDispatcher,gI=M1.ReactCurrentBatchConfig,tw=0,Ou=null,qc=null,wl=null,AO=!1,yS=!1,PS=0,Iae=0;function td(){throw Error(ui(321))}function LR(p,o){if(o===null)return!1;for(var u=0;u<o.length&&u<p.length;u++)if(!tv(p[u],o[u]))return!1;return!0}function BR(p,o,u,s,r,l){if(tw=l,Ou=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,nO.current=p===null||p.memoizedState===null?Lae:Bae,p=u(s,r),yS){l=0;do{if(yS=!1,PS=0,25<=l)throw Error(ui(301));l+=1,wl=qc=null,o.updateQueue=null,nO.current=jae,p=u(s,r)}while(yS)}if(nO.current=OO,o=qc!==null&&qc.next!==null,tw=0,wl=qc=Ou=null,AO=!1,o)throw Error(ui(300));return p}function jR(){var p=PS!==0;return PS=0,p}function vy(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return wl===null?Ou.memoizedState=wl=p:wl=wl.next=p,wl}function Hg(){if(qc===null){var p=Ou.alternate;p=p!==null?p.memoizedState:null}else p=qc.next;var o=wl===null?Ou.memoizedState:wl.next;if(o!==null)wl=o,qc=p;else{if(p===null)throw Error(ui(310));qc=p,p={memoizedState:qc.memoizedState,baseState:qc.baseState,baseQueue:qc.baseQueue,queue:qc.queue,next:null},wl===null?Ou.memoizedState=wl=p:wl=wl.next=p}return wl}function LS(p,o){return typeof o=="function"?o(p):o}function vI(p){var o=Hg(),u=o.queue;if(u===null)throw Error(ui(311));u.lastRenderedReducer=p;var s=qc,r=s.baseQueue,l=u.pending;if(l!==null){if(r!==null){var C=r.next;r.next=l.next,l.next=C}s.baseQueue=r=l,u.pending=null}if(r!==null){l=r.next,s=s.baseState;var S=C=null,O=null,U=l;do{var j=U.lane;if((tw&j)===j)O!==null&&(O=O.next={lane:0,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null}),s=U.hasEagerState?U.eagerState:p(s,U.action);else{var N={lane:j,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null};O===null?(S=O=N,C=s):O=O.next=N,Ou.lanes|=j,nw|=j}U=U.next}while(U!==null&&U!==l);O===null?C=s:O.next=S,tv(s,o.memoizedState)||(Op=!0),o.memoizedState=s,o.baseState=C,o.baseQueue=O,u.lastRenderedState=s}if(p=u.interleaved,p!==null){r=p;do l=r.lane,Ou.lanes|=l,nw|=l,r=r.next;while(r!==p)}else r===null&&(u.lanes=0);return[o.memoizedState,u.dispatch]}function yI(p){var o=Hg(),u=o.queue;if(u===null)throw Error(ui(311));u.lastRenderedReducer=p;var s=u.dispatch,r=u.pending,l=o.memoizedState;if(r!==null){u.pending=null;var C=r=r.next;do l=p(l,C.action),C=C.next;while(C!==r);tv(l,o.memoizedState)||(Op=!0),o.memoizedState=l,o.baseQueue===null&&(o.baseState=l),u.lastRenderedState=l}return[l,s]}function xH(){}function wH(p,o){var u=Ou,s=Hg(),r=o(),l=!tv(s.memoizedState,r);if(l&&(s.memoizedState=r,Op=!0),s=s.queue,zR(SH.bind(null,u,s,p),[p]),s.getSnapshot!==o||l||wl!==null&&wl.memoizedState.tag&1){if(u.flags|=2048,BS(9,EH.bind(null,u,s,r,o),void 0,null),El===null)throw Error(ui(349));tw&30||_H(u,o,r)}return r}function _H(p,o,u){p.flags|=16384,p={getSnapshot:o,value:u},o=Ou.updateQueue,o===null?(o={lastEffect:null,stores:null},Ou.updateQueue=o,o.stores=[p]):(u=o.stores,u===null?o.stores=[p]:u.push(p))}function EH(p,o,u,s){o.value=u,o.getSnapshot=s,kH(o)&&CH(p)}function SH(p,o,u){return u(function(){kH(o)&&CH(p)})}function kH(p){var o=p.getSnapshot;p=p.value;try{var u=o();return!tv(p,u)}catch{return!0}}function CH(p){var o=O1(p,1);o!==null&&ev(o,p,1,-1)}function hU(p){var o=vy();return typeof p=="function"&&(p=p()),o.memoizedState=o.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:LS,lastRenderedState:p},o.queue=p,p=p.dispatch=Pae.bind(null,Ou,p),[o.memoizedState,p]}function BS(p,o,u,s){return p={tag:p,create:o,destroy:u,deps:s,next:null},o=Ou.updateQueue,o===null?(o={lastEffect:null,stores:null},Ou.updateQueue=o,o.lastEffect=p.next=p):(u=o.lastEffect,u===null?o.lastEffect=p.next=p:(s=u.next,u.next=p,p.next=s,o.lastEffect=p)),p}function AH(){return Hg().memoizedState}function rO(p,o,u,s){var r=vy();Ou.flags|=p,r.memoizedState=BS(1|o,u,void 0,s===void 0?null:s)}function qO(p,o,u,s){var r=Hg();s=s===void 0?null:s;var l=void 0;if(qc!==null){var C=qc.memoizedState;if(l=C.destroy,s!==null&&LR(s,C.deps)){r.memoizedState=BS(o,u,l,s);return}}Ou.flags|=p,r.memoizedState=BS(1|o,u,l,s)}function pU(p,o){return rO(8390656,8,p,o)}function zR(p,o){return qO(2048,8,p,o)}function OH(p,o){return qO(4,2,p,o)}function TH(p,o){return qO(4,4,p,o)}function MH(p,o){if(typeof o=="function")return p=p(),o(p),function(){o(null)};if(o!=null)return p=p(),o.current=p,function(){o.current=null}}function DH(p,o,u){return u=u!=null?u.concat([p]):null,qO(4,4,MH.bind(null,o,p),u)}function UR(){}function NH(p,o){var u=Hg();o=o===void 0?null:o;var s=u.memoizedState;return s!==null&&o!==null&&LR(o,s[1])?s[0]:(u.memoizedState=[p,o],p)}function IH(p,o){var u=Hg();o=o===void 0?null:o;var s=u.memoizedState;return s!==null&&o!==null&&LR(o,s[1])?s[0]:(p=p(),u.memoizedState=[p,o],p)}function FH(p,o,u){return tw&21?(tv(u,o)||(u=LV(),Ou.lanes|=u,nw|=u,p.baseState=!0),o):(p.baseState&&(p.baseState=!1,Op=!0),p.memoizedState=u)}function Fae(p,o){var u=us;us=u!==0&&4>u?u:4,p(!0);var s=gI.transition;gI.transition={};try{p(!1),o()}finally{us=u,gI.transition=s}}function RH(){return Hg().memoizedState}function Rae(p,o,u){var s=jb(p);if(u={lane:s,action:u,hasEagerState:!1,eagerState:null,next:null},PH(p))LH(o,u);else if(u=hH(p,o,u,s),u!==null){var r=vh();ev(u,p,s,r),BH(u,o,s)}}function Pae(p,o,u){var s=jb(p),r={lane:s,action:u,hasEagerState:!1,eagerState:null,next:null};if(PH(p))LH(o,r);else{var l=p.alternate;if(p.lanes===0&&(l===null||l.lanes===0)&&(l=o.lastRenderedReducer,l!==null))try{var C=o.lastRenderedState,S=l(C,u);if(r.hasEagerState=!0,r.eagerState=S,tv(S,C)){var O=o.interleaved;O===null?(r.next=r,NR(o)):(r.next=O.next,O.next=r),o.interleaved=r;return}}catch{}finally{}u=hH(p,o,r,s),u!==null&&(r=vh(),ev(u,p,s,r),BH(u,o,s))}}function PH(p){var o=p.alternate;return p===Ou||o!==null&&o===Ou}function LH(p,o){yS=AO=!0;var u=p.pending;u===null?o.next=o:(o.next=u.next,u.next=o),p.pending=o}function BH(p,o,u){if(u&4194240){var s=o.lanes;s&=p.pendingLanes,u|=s,o.lanes=u,yR(p,u)}}var OO={readContext:Vg,useCallback:td,useContext:td,useEffect:td,useImperativeHandle:td,useInsertionEffect:td,useLayoutEffect:td,useMemo:td,useReducer:td,useRef:td,useState:td,useDebugValue:td,useDeferredValue:td,useTransition:td,useMutableSource:td,useSyncExternalStore:td,useId:td,unstable_isNewReconciler:!1},Lae={readContext:Vg,useCallback:function(p,o){return vy().memoizedState=[p,o===void 0?null:o],p},useContext:Vg,useEffect:pU,useImperativeHandle:function(p,o,u){return u=u!=null?u.concat([p]):null,rO(4194308,4,MH.bind(null,o,p),u)},useLayoutEffect:function(p,o){return rO(4194308,4,p,o)},useInsertionEffect:function(p,o){return rO(4,2,p,o)},useMemo:function(p,o){var u=vy();return o=o===void 0?null:o,p=p(),u.memoizedState=[p,o],p},useReducer:function(p,o,u){var s=vy();return o=u!==void 0?u(o):o,s.memoizedState=s.baseState=o,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:o},s.queue=p,p=p.dispatch=Rae.bind(null,Ou,p),[s.memoizedState,p]},useRef:function(p){var o=vy();return p={current:p},o.memoizedState=p},useState:hU,useDebugValue:UR,useDeferredValue:function(p){return vy().memoizedState=p},useTransition:function(){var p=hU(!1),o=p[0];return p=Fae.bind(null,p[1]),vy().memoizedState=p,[o,p]},useMutableSource:function(){},useSyncExternalStore:function(p,o,u){var s=Ou,r=vy();if(vu){if(u===void 0)throw Error(ui(407));u=u()}else{if(u=o(),El===null)throw Error(ui(349));tw&30||_H(s,o,u)}r.memoizedState=u;var l={value:u,getSnapshot:o};return r.queue=l,pU(SH.bind(null,s,l,p),[p]),s.flags|=2048,BS(9,EH.bind(null,s,l,u,o),void 0,null),u},useId:function(){var p=vy(),o=El.identifierPrefix;if(vu){var u=E1,s=_1;u=(s&~(1<<32-Z0(s)-1)).toString(32)+u,o=":"+o+"R"+u,u=PS++,0<u&&(o+="H"+u.toString(32)),o+=":"}else u=Iae++,o=":"+o+"r"+u.toString(32)+":";return p.memoizedState=o},unstable_isNewReconciler:!1},Bae={readContext:Vg,useCallback:NH,useContext:Vg,useEffect:zR,useImperativeHandle:DH,useInsertionEffect:OH,useLayoutEffect:TH,useMemo:IH,useReducer:vI,useRef:AH,useState:function(){return vI(LS)},useDebugValue:UR,useDeferredValue:function(p){var o=Hg();return FH(o,qc.memoizedState,p)},useTransition:function(){var p=vI(LS)[0],o=Hg().memoizedState;return[p,o]},useMutableSource:xH,useSyncExternalStore:wH,useId:RH,unstable_isNewReconciler:!1},jae={readContext:Vg,useCallback:NH,useContext:Vg,useEffect:zR,useImperativeHandle:DH,useInsertionEffect:OH,useLayoutEffect:TH,useMemo:IH,useReducer:yI,useRef:AH,useState:function(){return yI(LS)},useDebugValue:UR,useDeferredValue:function(p){var o=Hg();return qc===null?o.memoizedState=p:FH(o,qc.memoizedState,p)},useTransition:function(){var p=yI(LS)[0],o=Hg().memoizedState;return[p,o]},useMutableSource:xH,useSyncExternalStore:wH,useId:RH,unstable_isNewReconciler:!1};function q2(p,o){try{var u="",s=o;do u+=hoe(s),s=s.return;while(s);var r=u}catch(l){r=`
Error generating stack: `+l.message+`
`+l.stack}return{value:p,source:o,stack:r,digest:null}}function bI(p,o,u){return{value:p,source:null,stack:u??null,digest:o??null}}function LF(p,o){try{console.error(o.value)}catch(u){setTimeout(function(){throw u})}}var zae=typeof WeakMap=="function"?WeakMap:Map;function jH(p,o,u){u=S1(-1,u),u.tag=3,u.payload={element:null};var s=o.value;return u.callback=function(){MO||(MO=!0,$F=s),LF(p,o)},u}function zH(p,o,u){u=S1(-1,u),u.tag=3;var s=p.type.getDerivedStateFromError;if(typeof s=="function"){var r=o.value;u.payload=function(){return s(r)},u.callback=function(){LF(p,o)}}var l=p.stateNode;return l!==null&&typeof l.componentDidCatch=="function"&&(u.callback=function(){LF(p,o),typeof s!="function"&&(Bb===null?Bb=new Set([this]):Bb.add(this));var C=o.stack;this.componentDidCatch(o.value,{componentStack:C!==null?C:""})}),u}function mU(p,o,u){var s=p.pingCache;if(s===null){s=p.pingCache=new zae;var r=new Set;s.set(o,r)}else r=s.get(o),r===void 0&&(r=new Set,s.set(o,r));r.has(u)||(r.add(u),p=ese.bind(null,p,o,u),o.then(p,p))}function gU(p){do{var o;if((o=p.tag===13)&&(o=p.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return p;p=p.return}while(p!==null);return null}function vU(p,o,u,s,r){return p.mode&1?(p.flags|=65536,p.lanes=r,p):(p===o?p.flags|=65536:(p.flags|=128,u.flags|=131072,u.flags&=-52805,u.tag===1&&(u.alternate===null?u.tag=17:(o=S1(-1,1),o.tag=2,Lb(u,o,1))),u.lanes|=1),p)}var Uae=M1.ReactCurrentOwner,Op=!1;function mh(p,o,u,s){o.child=p===null?yH(o,null,u,s):H2(o,p.child,u,s)}function yU(p,o,u,s,r){u=u.render;var l=o.ref;return L2(o,r),s=BR(p,o,u,s,l,r),u=jR(),p!==null&&!Op?(o.updateQueue=p.updateQueue,o.flags&=-2053,p.lanes&=~r,T1(p,o,r)):(vu&&u&&CR(o),o.flags|=1,mh(p,o,s,r),o.child)}function bU(p,o,u,s,r){if(p===null){var l=u.type;return typeof l=="function"&&!KR(l)&&l.defaultProps===void 0&&u.compare===null&&u.defaultProps===void 0?(o.tag=15,o.type=l,UH(p,o,l,s,r)):(p=sO(u.type,null,s,o,o.mode,r),p.ref=o.ref,p.return=o,o.child=p)}if(l=p.child,!(p.lanes&r)){var C=l.memoizedProps;if(u=u.compare,u=u!==null?u:MS,u(C,s)&&p.ref===o.ref)return T1(p,o,r)}return o.flags|=1,p=zb(l,s),p.ref=o.ref,p.return=o,o.child=p}function UH(p,o,u,s,r){if(p!==null){var l=p.memoizedProps;if(MS(l,s)&&p.ref===o.ref)if(Op=!1,o.pendingProps=s=l,(p.lanes&r)!==0)p.flags&131072&&(Op=!0);else return o.lanes=p.lanes,T1(p,o,r)}return BF(p,o,u,s,r)}function WH(p,o,u){var s=o.pendingProps,r=s.children,l=p!==null?p.memoizedState:null;if(s.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},Gs(D2,jm),jm|=u;else{if(!(u&1073741824))return p=l!==null?l.baseLanes|u:u,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:p,cachePool:null,transitions:null},o.updateQueue=null,Gs(D2,jm),jm|=p,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=l!==null?l.baseLanes:u,Gs(D2,jm),jm|=s}else l!==null?(s=l.baseLanes|u,o.memoizedState=null):s=u,Gs(D2,jm),jm|=s;return mh(p,o,r,u),o.child}function VH(p,o){var u=o.ref;(p===null&&u!==null||p!==null&&p.ref!==u)&&(o.flags|=512,o.flags|=2097152)}function BF(p,o,u,s,r){var l=Dp(u)?Zx:ad.current;return l=W2(o,l),L2(o,r),u=BR(p,o,u,s,l,r),s=jR(),p!==null&&!Op?(o.updateQueue=p.updateQueue,o.flags&=-2053,p.lanes&=~r,T1(p,o,r)):(vu&&s&&CR(o),o.flags|=1,mh(p,o,u,r),o.child)}function xU(p,o,u,s,r){if(Dp(u)){var l=!0;xO(o)}else l=!1;if(L2(o,r),o.stateNode===null)iO(p,o),gH(o,u,s),PF(o,u,s,r),s=!0;else if(p===null){var C=o.stateNode,S=o.memoizedProps;C.props=S;var O=C.context,U=u.contextType;typeof U=="object"&&U!==null?U=Vg(U):(U=Dp(u)?Zx:ad.current,U=W2(o,U));var j=u.getDerivedStateFromProps,N=typeof j=="function"||typeof C.getSnapshotBeforeUpdate=="function";N||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(S!==s||O!==U)&&fU(o,C,s,U),Ob=!1;var L=o.memoizedState;C.state=L,kO(o,s,C,r),O=o.memoizedState,S!==s||L!==O||Mp.current||Ob?(typeof j=="function"&&(RF(o,u,j,s),O=o.memoizedState),(S=Ob||lU(o,u,S,s,L,O,U))?(N||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(o.flags|=4194308)):(typeof C.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=s,o.memoizedState=O),C.props=s,C.state=O,C.context=U,s=S):(typeof C.componentDidMount=="function"&&(o.flags|=4194308),s=!1)}else{C=o.stateNode,pH(p,o),S=o.memoizedProps,U=o.type===o.elementType?S:$0(o.type,S),C.props=U,N=o.pendingProps,L=C.context,O=u.contextType,typeof O=="object"&&O!==null?O=Vg(O):(O=Dp(u)?Zx:ad.current,O=W2(o,O));var W=u.getDerivedStateFromProps;(j=typeof W=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(S!==N||L!==O)&&fU(o,C,s,O),Ob=!1,L=o.memoizedState,C.state=L,kO(o,s,C,r);var z=o.memoizedState;S!==N||L!==z||Mp.current||Ob?(typeof W=="function"&&(RF(o,u,W,s),z=o.memoizedState),(U=Ob||lU(o,u,U,s,L,z,O)||!1)?(j||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(s,z,O),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(s,z,O)),typeof C.componentDidUpdate=="function"&&(o.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof C.componentDidUpdate!="function"||S===p.memoizedProps&&L===p.memoizedState||(o.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||S===p.memoizedProps&&L===p.memoizedState||(o.flags|=1024),o.memoizedProps=s,o.memoizedState=z),C.props=s,C.state=z,C.context=O,s=U):(typeof C.componentDidUpdate!="function"||S===p.memoizedProps&&L===p.memoizedState||(o.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||S===p.memoizedProps&&L===p.memoizedState||(o.flags|=1024),s=!1)}return jF(p,o,u,s,l,r)}function jF(p,o,u,s,r,l){VH(p,o);var C=(o.flags&128)!==0;if(!s&&!C)return r&&oU(o,u,!1),T1(p,o,l);s=o.stateNode,Uae.current=o;var S=C&&typeof u.getDerivedStateFromError!="function"?null:s.render();return o.flags|=1,p!==null&&C?(o.child=H2(o,p.child,null,l),o.child=H2(o,null,S,l)):mh(p,o,S,l),o.memoizedState=s.state,r&&oU(o,u,!0),o.child}function HH(p){var o=p.stateNode;o.pendingContext?iU(p,o.pendingContext,o.pendingContext!==o.context):o.context&&iU(p,o.context,!1),FR(p,o.containerInfo)}function wU(p,o,u,s,r){return V2(),OR(r),o.flags|=256,mh(p,o,u,s),o.child}var zF={dehydrated:null,treeContext:null,retryLane:0};function UF(p){return{baseLanes:p,cachePool:null,transitions:null}}function GH(p,o,u){var s=o.pendingProps,r=Au.current,l=!1,C=(o.flags&128)!==0,S;if((S=C)||(S=p!==null&&p.memoizedState===null?!1:(r&2)!==0),S?(l=!0,o.flags&=-129):(p===null||p.memoizedState!==null)&&(r|=1),Gs(Au,r&1),p===null)return IF(o),p=o.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?(o.mode&1?p.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(C=s.children,p=s.fallback,l?(s=o.mode,l=o.child,C={mode:"hidden",children:C},!(s&1)&&l!==null?(l.childLanes=0,l.pendingProps=C):l=KO(C,s,0,null),p=Yx(p,s,u,null),l.return=o,p.return=o,l.sibling=p,o.child=l,o.child.memoizedState=UF(u),o.memoizedState=zF,p):WR(o,C));if(r=p.memoizedState,r!==null&&(S=r.dehydrated,S!==null))return Wae(p,o,C,s,S,r,u);if(l){l=s.fallback,C=o.mode,r=p.child,S=r.sibling;var O={mode:"hidden",children:s.children};return!(C&1)&&o.child!==r?(s=o.child,s.childLanes=0,s.pendingProps=O,o.deletions=null):(s=zb(r,O),s.subtreeFlags=r.subtreeFlags&14680064),S!==null?l=zb(S,l):(l=Yx(l,C,u,null),l.flags|=2),l.return=o,s.return=o,s.sibling=l,o.child=s,s=l,l=o.child,C=p.child.memoizedState,C=C===null?UF(u):{baseLanes:C.baseLanes|u,cachePool:null,transitions:C.transitions},l.memoizedState=C,l.childLanes=p.childLanes&~u,o.memoizedState=zF,s}return l=p.child,p=l.sibling,s=zb(l,{mode:"visible",children:s.children}),!(o.mode&1)&&(s.lanes=u),s.return=o,s.sibling=null,p!==null&&(u=o.deletions,u===null?(o.deletions=[p],o.flags|=16):u.push(p)),o.child=s,o.memoizedState=null,s}function WR(p,o){return o=KO({mode:"visible",children:o},p.mode,0,null),o.return=p,p.child=o}function SA(p,o,u,s){return s!==null&&OR(s),H2(o,p.child,null,u),p=WR(o,o.pendingProps.children),p.flags|=2,o.memoizedState=null,p}function Wae(p,o,u,s,r,l,C){if(u)return o.flags&256?(o.flags&=-257,s=bI(Error(ui(422))),SA(p,o,C,s)):o.memoizedState!==null?(o.child=p.child,o.flags|=128,null):(l=s.fallback,r=o.mode,s=KO({mode:"visible",children:s.children},r,0,null),l=Yx(l,r,C,null),l.flags|=2,s.return=o,l.return=o,s.sibling=l,o.child=s,o.mode&1&&H2(o,p.child,null,C),o.child.memoizedState=UF(C),o.memoizedState=zF,l);if(!(o.mode&1))return SA(p,o,C,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var S=s.dgst;return s=S,l=Error(ui(419)),s=bI(l,s,void 0),SA(p,o,C,s)}if(S=(C&p.childLanes)!==0,Op||S){if(s=El,s!==null){switch(C&-C){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|C)?0:r,r!==0&&r!==l.retryLane&&(l.retryLane=r,O1(p,r),ev(s,p,r,-1))}return XR(),s=bI(Error(ui(421))),SA(p,o,C,s)}return r.data==="$?"?(o.flags|=128,o.child=p.child,o=tse.bind(null,p),r._reactRetry=o,null):(p=l.treeContext,Um=Pb(r.nextSibling),Vm=o,vu=!0,K0=null,p!==null&&(Lg[Bg++]=_1,Lg[Bg++]=E1,Lg[Bg++]=ew,_1=p.id,E1=p.overflow,ew=o),o=WR(o,s.children),o.flags|=4096,o)}function _U(p,o,u){p.lanes|=o;var s=p.alternate;s!==null&&(s.lanes|=o),FF(p.return,o,u)}function xI(p,o,u,s,r){var l=p.memoizedState;l===null?p.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:s,tail:u,tailMode:r}:(l.isBackwards=o,l.rendering=null,l.renderingStartTime=0,l.last=s,l.tail=u,l.tailMode=r)}function qH(p,o,u){var s=o.pendingProps,r=s.revealOrder,l=s.tail;if(mh(p,o,s.children,u),s=Au.current,s&2)s=s&1|2,o.flags|=128;else{if(p!==null&&p.flags&128)e:for(p=o.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&_U(p,u,o);else if(p.tag===19)_U(p,u,o);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===o)break e;for(;p.sibling===null;){if(p.return===null||p.return===o)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}s&=1}if(Gs(Au,s),!(o.mode&1))o.memoizedState=null;else switch(r){case"forwards":for(u=o.child,r=null;u!==null;)p=u.alternate,p!==null&&CO(p)===null&&(r=u),u=u.sibling;u=r,u===null?(r=o.child,o.child=null):(r=u.sibling,u.sibling=null),xI(o,!1,r,u,l);break;case"backwards":for(u=null,r=o.child,o.child=null;r!==null;){if(p=r.alternate,p!==null&&CO(p)===null){o.child=r;break}p=r.sibling,r.sibling=u,u=r,r=p}xI(o,!0,u,null,l);break;case"together":xI(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function iO(p,o){!(o.mode&1)&&p!==null&&(p.alternate=null,o.alternate=null,o.flags|=2)}function T1(p,o,u){if(p!==null&&(o.dependencies=p.dependencies),nw|=o.lanes,!(u&o.childLanes))return null;if(p!==null&&o.child!==p.child)throw Error(ui(153));if(o.child!==null){for(p=o.child,u=zb(p,p.pendingProps),o.child=u,u.return=o;p.sibling!==null;)p=p.sibling,u=u.sibling=zb(p,p.pendingProps),u.return=o;u.sibling=null}return o.child}function Vae(p,o,u){switch(o.tag){case 3:HH(o),V2();break;case 5:bH(o);break;case 1:Dp(o.type)&&xO(o);break;case 4:FR(o,o.stateNode.containerInfo);break;case 10:var s=o.type._context,r=o.memoizedProps.value;Gs(EO,s._currentValue),s._currentValue=r;break;case 13:if(s=o.memoizedState,s!==null)return s.dehydrated!==null?(Gs(Au,Au.current&1),o.flags|=128,null):u&o.child.childLanes?GH(p,o,u):(Gs(Au,Au.current&1),p=T1(p,o,u),p!==null?p.sibling:null);Gs(Au,Au.current&1);break;case 19:if(s=(u&o.childLanes)!==0,p.flags&128){if(s)return qH(p,o,u);o.flags|=128}if(r=o.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Gs(Au,Au.current),s)break;return null;case 22:case 23:return o.lanes=0,WH(p,o,u)}return T1(p,o,u)}var $H,WF,XH,KH;$H=function(p,o){for(var u=o.child;u!==null;){if(u.tag===5||u.tag===6)p.appendChild(u.stateNode);else if(u.tag!==4&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===o)break;for(;u.sibling===null;){if(u.return===null||u.return===o)return;u=u.return}u.sibling.return=u.return,u=u.sibling}};WF=function(){};XH=function(p,o,u,s){var r=p.memoizedProps;if(r!==s){p=o.stateNode,qx(_y.current);var l=null;switch(u){case"input":r=lF(p,r),s=lF(p,s),l=[];break;case"select":r=Tu({},r,{value:void 0}),s=Tu({},s,{value:void 0}),l=[];break;case"textarea":r=hF(p,r),s=hF(p,s),l=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(p.onclick=yO)}mF(u,s);var C;u=null;for(U in r)if(!s.hasOwnProperty(U)&&r.hasOwnProperty(U)&&r[U]!=null)if(U==="style"){var S=r[U];for(C in S)S.hasOwnProperty(C)&&(u||(u={}),u[C]="")}else U!=="dangerouslySetInnerHTML"&&U!=="children"&&U!=="suppressContentEditableWarning"&&U!=="suppressHydrationWarning"&&U!=="autoFocus"&&(ES.hasOwnProperty(U)?l||(l=[]):(l=l||[]).push(U,null));for(U in s){var O=s[U];if(S=r!=null?r[U]:void 0,s.hasOwnProperty(U)&&O!==S&&(O!=null||S!=null))if(U==="style")if(S){for(C in S)!S.hasOwnProperty(C)||O&&O.hasOwnProperty(C)||(u||(u={}),u[C]="");for(C in O)O.hasOwnProperty(C)&&S[C]!==O[C]&&(u||(u={}),u[C]=O[C])}else u||(l||(l=[]),l.push(U,u)),u=O;else U==="dangerouslySetInnerHTML"?(O=O?O.__html:void 0,S=S?S.__html:void 0,O!=null&&S!==O&&(l=l||[]).push(U,O)):U==="children"?typeof O!="string"&&typeof O!="number"||(l=l||[]).push(U,""+O):U!=="suppressContentEditableWarning"&&U!=="suppressHydrationWarning"&&(ES.hasOwnProperty(U)?(O!=null&&U==="onScroll"&&eu("scroll",p),l||S===O||(l=[])):(l=l||[]).push(U,O))}u&&(l=l||[]).push("style",u);var U=l;(o.updateQueue=U)&&(o.flags|=4)}};KH=function(p,o,u,s){u!==s&&(o.flags|=4)};function YE(p,o){if(!vu)switch(p.tailMode){case"hidden":o=p.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?p.tail=null:u.sibling=null;break;case"collapsed":u=p.tail;for(var s=null;u!==null;)u.alternate!==null&&(s=u),u=u.sibling;s===null?o||p.tail===null?p.tail=null:p.tail.sibling=null:s.sibling=null}}function nd(p){var o=p.alternate!==null&&p.alternate.child===p.child,u=0,s=0;if(o)for(var r=p.child;r!==null;)u|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=p,r=r.sibling;else for(r=p.child;r!==null;)u|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=p,r=r.sibling;return p.subtreeFlags|=s,p.childLanes=u,o}function Hae(p,o,u){var s=o.pendingProps;switch(AR(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return nd(o),null;case 1:return Dp(o.type)&&bO(),nd(o),null;case 3:return s=o.stateNode,G2(),nu(Mp),nu(ad),PR(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(p===null||p.child===null)&&(_A(o)?o.flags|=4:p===null||p.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,K0!==null&&(YF(K0),K0=null))),WF(p,o),nd(o),null;case 5:RR(o);var r=qx(RS.current);if(u=o.type,p!==null&&o.stateNode!=null)XH(p,o,u,s,r),p.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!s){if(o.stateNode===null)throw Error(ui(166));return nd(o),null}if(p=qx(_y.current),_A(o)){s=o.stateNode,u=o.type;var l=o.memoizedProps;switch(s[xy]=o,s[IS]=l,p=(o.mode&1)!==0,u){case"dialog":eu("cancel",s),eu("close",s);break;case"iframe":case"object":case"embed":eu("load",s);break;case"video":case"audio":for(r=0;r<lS.length;r++)eu(lS[r],s);break;case"source":eu("error",s);break;case"img":case"image":case"link":eu("error",s),eu("load",s);break;case"details":eu("toggle",s);break;case"input":D7(s,l),eu("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!l.multiple},eu("invalid",s);break;case"textarea":I7(s,l),eu("invalid",s)}mF(u,l),r=null;for(var C in l)if(l.hasOwnProperty(C)){var S=l[C];C==="children"?typeof S=="string"?s.textContent!==S&&(l.suppressHydrationWarning!==!0&&wA(s.textContent,S,p),r=["children",S]):typeof S=="number"&&s.textContent!==""+S&&(l.suppressHydrationWarning!==!0&&wA(s.textContent,S,p),r=["children",""+S]):ES.hasOwnProperty(C)&&S!=null&&C==="onScroll"&&eu("scroll",s)}switch(u){case"input":hA(s),N7(s,l,!0);break;case"textarea":hA(s),F7(s);break;case"select":case"option":break;default:typeof l.onClick=="function"&&(s.onclick=yO)}s=r,o.updateQueue=s,s!==null&&(o.flags|=4)}else{C=r.nodeType===9?r:r.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=_V(u)),p==="http://www.w3.org/1999/xhtml"?u==="script"?(p=C.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof s.is=="string"?p=C.createElement(u,{is:s.is}):(p=C.createElement(u),u==="select"&&(C=p,s.multiple?C.multiple=!0:s.size&&(C.size=s.size))):p=C.createElementNS(p,u),p[xy]=o,p[IS]=s,$H(p,o,!1,!1),o.stateNode=p;e:{switch(C=gF(u,s),u){case"dialog":eu("cancel",p),eu("close",p),r=s;break;case"iframe":case"object":case"embed":eu("load",p),r=s;break;case"video":case"audio":for(r=0;r<lS.length;r++)eu(lS[r],p);r=s;break;case"source":eu("error",p),r=s;break;case"img":case"image":case"link":eu("error",p),eu("load",p),r=s;break;case"details":eu("toggle",p),r=s;break;case"input":D7(p,s),r=lF(p,s),eu("invalid",p);break;case"option":r=s;break;case"select":p._wrapperState={wasMultiple:!!s.multiple},r=Tu({},s,{value:void 0}),eu("invalid",p);break;case"textarea":I7(p,s),r=hF(p,s),eu("invalid",p);break;default:r=s}mF(u,r),S=r;for(l in S)if(S.hasOwnProperty(l)){var O=S[l];l==="style"?kV(p,O):l==="dangerouslySetInnerHTML"?(O=O?O.__html:void 0,O!=null&&EV(p,O)):l==="children"?typeof O=="string"?(u!=="textarea"||O!=="")&&SS(p,O):typeof O=="number"&&SS(p,""+O):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(ES.hasOwnProperty(l)?O!=null&&l==="onScroll"&&eu("scroll",p):O!=null&&dR(p,l,O,C))}switch(u){case"input":hA(p),N7(p,s,!1);break;case"textarea":hA(p),F7(p);break;case"option":s.value!=null&&p.setAttribute("value",""+Wb(s.value));break;case"select":p.multiple=!!s.multiple,l=s.value,l!=null?I2(p,!!s.multiple,l,!1):s.defaultValue!=null&&I2(p,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(p.onclick=yO)}switch(u){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return nd(o),null;case 6:if(p&&o.stateNode!=null)KH(p,o,p.memoizedProps,s);else{if(typeof s!="string"&&o.stateNode===null)throw Error(ui(166));if(u=qx(RS.current),qx(_y.current),_A(o)){if(s=o.stateNode,u=o.memoizedProps,s[xy]=o,(l=s.nodeValue!==u)&&(p=Vm,p!==null))switch(p.tag){case 3:wA(s.nodeValue,u,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&wA(s.nodeValue,u,(p.mode&1)!==0)}l&&(o.flags|=4)}else s=(u.nodeType===9?u:u.ownerDocument).createTextNode(s),s[xy]=o,o.stateNode=s}return nd(o),null;case 13:if(nu(Au),s=o.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(vu&&Um!==null&&o.mode&1&&!(o.flags&128))dH(),V2(),o.flags|=98560,l=!1;else if(l=_A(o),s!==null&&s.dehydrated!==null){if(p===null){if(!l)throw Error(ui(318));if(l=o.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(ui(317));l[xy]=o}else V2(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;nd(o),l=!1}else K0!==null&&(YF(K0),K0=null),l=!0;if(!l)return o.flags&65536?o:null}return o.flags&128?(o.lanes=u,o):(s=s!==null,s!==(p!==null&&p.memoizedState!==null)&&s&&(o.child.flags|=8192,o.mode&1&&(p===null||Au.current&1?$c===0&&($c=3):XR())),o.updateQueue!==null&&(o.flags|=4),nd(o),null);case 4:return G2(),WF(p,o),p===null&&DS(o.stateNode.containerInfo),nd(o),null;case 10:return DR(o.type._context),nd(o),null;case 17:return Dp(o.type)&&bO(),nd(o),null;case 19:if(nu(Au),l=o.memoizedState,l===null)return nd(o),null;if(s=(o.flags&128)!==0,C=l.rendering,C===null)if(s)YE(l,!1);else{if($c!==0||p!==null&&p.flags&128)for(p=o.child;p!==null;){if(C=CO(p),C!==null){for(o.flags|=128,YE(l,!1),s=C.updateQueue,s!==null&&(o.updateQueue=s,o.flags|=4),o.subtreeFlags=0,s=u,u=o.child;u!==null;)l=u,p=s,l.flags&=14680066,C=l.alternate,C===null?(l.childLanes=0,l.lanes=p,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=C.childLanes,l.lanes=C.lanes,l.child=C.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=C.memoizedProps,l.memoizedState=C.memoizedState,l.updateQueue=C.updateQueue,l.type=C.type,p=C.dependencies,l.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),u=u.sibling;return Gs(Au,Au.current&1|2),o.child}p=p.sibling}l.tail!==null&&oc()>$2&&(o.flags|=128,s=!0,YE(l,!1),o.lanes=4194304)}else{if(!s)if(p=CO(C),p!==null){if(o.flags|=128,s=!0,u=p.updateQueue,u!==null&&(o.updateQueue=u,o.flags|=4),YE(l,!0),l.tail===null&&l.tailMode==="hidden"&&!C.alternate&&!vu)return nd(o),null}else 2*oc()-l.renderingStartTime>$2&&u!==1073741824&&(o.flags|=128,s=!0,YE(l,!1),o.lanes=4194304);l.isBackwards?(C.sibling=o.child,o.child=C):(u=l.last,u!==null?u.sibling=C:o.child=C,l.last=C)}return l.tail!==null?(o=l.tail,l.rendering=o,l.tail=o.sibling,l.renderingStartTime=oc(),o.sibling=null,u=Au.current,Gs(Au,s?u&1|2:u&1),o):(nd(o),null);case 22:case 23:return $R(),s=o.memoizedState!==null,p!==null&&p.memoizedState!==null!==s&&(o.flags|=8192),s&&o.mode&1?jm&1073741824&&(nd(o),o.subtreeFlags&6&&(o.flags|=8192)):nd(o),null;case 24:return null;case 25:return null}throw Error(ui(156,o.tag))}function Gae(p,o){switch(AR(o),o.tag){case 1:return Dp(o.type)&&bO(),p=o.flags,p&65536?(o.flags=p&-65537|128,o):null;case 3:return G2(),nu(Mp),nu(ad),PR(),p=o.flags,p&65536&&!(p&128)?(o.flags=p&-65537|128,o):null;case 5:return RR(o),null;case 13:if(nu(Au),p=o.memoizedState,p!==null&&p.dehydrated!==null){if(o.alternate===null)throw Error(ui(340));V2()}return p=o.flags,p&65536?(o.flags=p&-65537|128,o):null;case 19:return nu(Au),null;case 4:return G2(),null;case 10:return DR(o.type._context),null;case 22:case 23:return $R(),null;case 24:return null;default:return null}}var kA=!1,id=!1,qae=typeof WeakSet=="function"?WeakSet:Set,Oi=null;function M2(p,o){var u=p.ref;if(u!==null)if(typeof u=="function")try{u(null)}catch(s){zu(p,o,s)}else u.current=null}function VF(p,o,u){try{u()}catch(s){zu(p,o,s)}}var EU=!1;function $ae(p,o){if(CF=mO,p=ZV(),kR(p)){if("selectionStart"in p)var u={start:p.selectionStart,end:p.selectionEnd};else e:{u=(u=p.ownerDocument)&&u.defaultView||window;var s=u.getSelection&&u.getSelection();if(s&&s.rangeCount!==0){u=s.anchorNode;var r=s.anchorOffset,l=s.focusNode;s=s.focusOffset;try{u.nodeType,l.nodeType}catch{u=null;break e}var C=0,S=-1,O=-1,U=0,j=0,N=p,L=null;t:for(;;){for(var W;N!==u||r!==0&&N.nodeType!==3||(S=C+r),N!==l||s!==0&&N.nodeType!==3||(O=C+s),N.nodeType===3&&(C+=N.nodeValue.length),(W=N.firstChild)!==null;)L=N,N=W;for(;;){if(N===p)break t;if(L===u&&++U===r&&(S=C),L===l&&++j===s&&(O=C),(W=N.nextSibling)!==null)break;N=L,L=N.parentNode}N=W}u=S===-1||O===-1?null:{start:S,end:O}}else u=null}u=u||{start:0,end:0}}else u=null;for(AF={focusedElem:p,selectionRange:u},mO=!1,Oi=o;Oi!==null;)if(o=Oi,p=o.child,(o.subtreeFlags&1028)!==0&&p!==null)p.return=o,Oi=p;else for(;Oi!==null;){o=Oi;try{var z=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(z!==null){var q=z.memoizedProps,I=z.memoizedState,Z=o.stateNode,Y=Z.getSnapshotBeforeUpdate(o.elementType===o.type?q:$0(o.type,q),I);Z.__reactInternalSnapshotBeforeUpdate=Y}break;case 3:var G=o.stateNode.containerInfo;G.nodeType===1?G.textContent="":G.nodeType===9&&G.documentElement&&G.removeChild(G.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ui(163))}}catch(oe){zu(o,o.return,oe)}if(p=o.sibling,p!==null){p.return=o.return,Oi=p;break}Oi=o.return}return z=EU,EU=!1,z}function bS(p,o,u){var s=o.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&p)===p){var l=r.destroy;r.destroy=void 0,l!==void 0&&VF(o,u,l)}r=r.next}while(r!==s)}}function $O(p,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var u=o=o.next;do{if((u.tag&p)===p){var s=u.create;u.destroy=s()}u=u.next}while(u!==o)}}function HF(p){var o=p.ref;if(o!==null){var u=p.stateNode;switch(p.tag){case 5:p=u;break;default:p=u}typeof o=="function"?o(p):o.current=p}}function YH(p){var o=p.alternate;o!==null&&(p.alternate=null,YH(o)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(o=p.stateNode,o!==null&&(delete o[xy],delete o[IS],delete o[MF],delete o[Tae],delete o[Mae])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function JH(p){return p.tag===5||p.tag===3||p.tag===4}function SU(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||JH(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function GF(p,o,u){var s=p.tag;if(s===5||s===6)p=p.stateNode,o?u.nodeType===8?u.parentNode.insertBefore(p,o):u.insertBefore(p,o):(u.nodeType===8?(o=u.parentNode,o.insertBefore(p,u)):(o=u,o.appendChild(p)),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=yO));else if(s!==4&&(p=p.child,p!==null))for(GF(p,o,u),p=p.sibling;p!==null;)GF(p,o,u),p=p.sibling}function qF(p,o,u){var s=p.tag;if(s===5||s===6)p=p.stateNode,o?u.insertBefore(p,o):u.appendChild(p);else if(s!==4&&(p=p.child,p!==null))for(qF(p,o,u),p=p.sibling;p!==null;)qF(p,o,u),p=p.sibling}var of=null,X0=!1;function _b(p,o,u){for(u=u.child;u!==null;)QH(p,o,u),u=u.sibling}function QH(p,o,u){if(wy&&typeof wy.onCommitFiberUnmount=="function")try{wy.onCommitFiberUnmount(jO,u)}catch{}switch(u.tag){case 5:id||M2(u,o);case 6:var s=of,r=X0;of=null,_b(p,o,u),of=s,X0=r,of!==null&&(X0?(p=of,u=u.stateNode,p.nodeType===8?p.parentNode.removeChild(u):p.removeChild(u)):of.removeChild(u.stateNode));break;case 18:of!==null&&(X0?(p=of,u=u.stateNode,p.nodeType===8?hI(p.parentNode,u):p.nodeType===1&&hI(p,u),OS(p)):hI(of,u.stateNode));break;case 4:s=of,r=X0,of=u.stateNode.containerInfo,X0=!0,_b(p,o,u),of=s,X0=r;break;case 0:case 11:case 14:case 15:if(!id&&(s=u.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var l=r,C=l.destroy;l=l.tag,C!==void 0&&(l&2||l&4)&&VF(u,o,C),r=r.next}while(r!==s)}_b(p,o,u);break;case 1:if(!id&&(M2(u,o),s=u.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=u.memoizedProps,s.state=u.memoizedState,s.componentWillUnmount()}catch(S){zu(u,o,S)}_b(p,o,u);break;case 21:_b(p,o,u);break;case 22:u.mode&1?(id=(s=id)||u.memoizedState!==null,_b(p,o,u),id=s):_b(p,o,u);break;default:_b(p,o,u)}}function kU(p){var o=p.updateQueue;if(o!==null){p.updateQueue=null;var u=p.stateNode;u===null&&(u=p.stateNode=new qae),o.forEach(function(s){var r=nse.bind(null,p,s);u.has(s)||(u.add(s),s.then(r,r))})}}function V0(p,o){var u=o.deletions;if(u!==null)for(var s=0;s<u.length;s++){var r=u[s];try{var l=p,C=o,S=C;e:for(;S!==null;){switch(S.tag){case 5:of=S.stateNode,X0=!1;break e;case 3:of=S.stateNode.containerInfo,X0=!0;break e;case 4:of=S.stateNode.containerInfo,X0=!0;break e}S=S.return}if(of===null)throw Error(ui(160));QH(l,C,r),of=null,X0=!1;var O=r.alternate;O!==null&&(O.return=null),r.return=null}catch(U){zu(r,o,U)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)ZH(o,p),o=o.sibling}function ZH(p,o){var u=p.alternate,s=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(V0(o,p),gy(p),s&4){try{bS(3,p,p.return),$O(3,p)}catch(q){zu(p,p.return,q)}try{bS(5,p,p.return)}catch(q){zu(p,p.return,q)}}break;case 1:V0(o,p),gy(p),s&512&&u!==null&&M2(u,u.return);break;case 5:if(V0(o,p),gy(p),s&512&&u!==null&&M2(u,u.return),p.flags&32){var r=p.stateNode;try{SS(r,"")}catch(q){zu(p,p.return,q)}}if(s&4&&(r=p.stateNode,r!=null)){var l=p.memoizedProps,C=u!==null?u.memoizedProps:l,S=p.type,O=p.updateQueue;if(p.updateQueue=null,O!==null)try{S==="input"&&l.type==="radio"&&l.name!=null&&xV(r,l),gF(S,C);var U=gF(S,l);for(C=0;C<O.length;C+=2){var j=O[C],N=O[C+1];j==="style"?kV(r,N):j==="dangerouslySetInnerHTML"?EV(r,N):j==="children"?SS(r,N):dR(r,j,N,U)}switch(S){case"input":fF(r,l);break;case"textarea":wV(r,l);break;case"select":var L=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!l.multiple;var W=l.value;W!=null?I2(r,!!l.multiple,W,!1):L!==!!l.multiple&&(l.defaultValue!=null?I2(r,!!l.multiple,l.defaultValue,!0):I2(r,!!l.multiple,l.multiple?[]:"",!1))}r[IS]=l}catch(q){zu(p,p.return,q)}}break;case 6:if(V0(o,p),gy(p),s&4){if(p.stateNode===null)throw Error(ui(162));r=p.stateNode,l=p.memoizedProps;try{r.nodeValue=l}catch(q){zu(p,p.return,q)}}break;case 3:if(V0(o,p),gy(p),s&4&&u!==null&&u.memoizedState.isDehydrated)try{OS(o.containerInfo)}catch(q){zu(p,p.return,q)}break;case 4:V0(o,p),gy(p);break;case 13:V0(o,p),gy(p),r=p.child,r.flags&8192&&(l=r.memoizedState!==null,r.stateNode.isHidden=l,!l||r.alternate!==null&&r.alternate.memoizedState!==null||(GR=oc())),s&4&&kU(p);break;case 22:if(j=u!==null&&u.memoizedState!==null,p.mode&1?(id=(U=id)||j,V0(o,p),id=U):V0(o,p),gy(p),s&8192){if(U=p.memoizedState!==null,(p.stateNode.isHidden=U)&&!j&&p.mode&1)for(Oi=p,j=p.child;j!==null;){for(N=Oi=j;Oi!==null;){switch(L=Oi,W=L.child,L.tag){case 0:case 11:case 14:case 15:bS(4,L,L.return);break;case 1:M2(L,L.return);var z=L.stateNode;if(typeof z.componentWillUnmount=="function"){s=L,u=L.return;try{o=s,z.props=o.memoizedProps,z.state=o.memoizedState,z.componentWillUnmount()}catch(q){zu(s,u,q)}}break;case 5:M2(L,L.return);break;case 22:if(L.memoizedState!==null){AU(N);continue}}W!==null?(W.return=L,Oi=W):AU(N)}j=j.sibling}e:for(j=null,N=p;;){if(N.tag===5){if(j===null){j=N;try{r=N.stateNode,U?(l=r.style,typeof l.setProperty=="function"?l.setProperty("display","none","important"):l.display="none"):(S=N.stateNode,O=N.memoizedProps.style,C=O!=null&&O.hasOwnProperty("display")?O.display:null,S.style.display=SV("display",C))}catch(q){zu(p,p.return,q)}}}else if(N.tag===6){if(j===null)try{N.stateNode.nodeValue=U?"":N.memoizedProps}catch(q){zu(p,p.return,q)}}else if((N.tag!==22&&N.tag!==23||N.memoizedState===null||N===p)&&N.child!==null){N.child.return=N,N=N.child;continue}if(N===p)break e;for(;N.sibling===null;){if(N.return===null||N.return===p)break e;j===N&&(j=null),N=N.return}j===N&&(j=null),N.sibling.return=N.return,N=N.sibling}}break;case 19:V0(o,p),gy(p),s&4&&kU(p);break;case 21:break;default:V0(o,p),gy(p)}}function gy(p){var o=p.flags;if(o&2){try{e:{for(var u=p.return;u!==null;){if(JH(u)){var s=u;break e}u=u.return}throw Error(ui(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(SS(r,""),s.flags&=-33);var l=SU(p);qF(p,l,r);break;case 3:case 4:var C=s.stateNode.containerInfo,S=SU(p);GF(p,S,C);break;default:throw Error(ui(161))}}catch(O){zu(p,p.return,O)}p.flags&=-3}o&4096&&(p.flags&=-4097)}function Xae(p,o,u){Oi=p,eG(p)}function eG(p,o,u){for(var s=(p.mode&1)!==0;Oi!==null;){var r=Oi,l=r.child;if(r.tag===22&&s){var C=r.memoizedState!==null||kA;if(!C){var S=r.alternate,O=S!==null&&S.memoizedState!==null||id;S=kA;var U=id;if(kA=C,(id=O)&&!U)for(Oi=r;Oi!==null;)C=Oi,O=C.child,C.tag===22&&C.memoizedState!==null?OU(r):O!==null?(O.return=C,Oi=O):OU(r);for(;l!==null;)Oi=l,eG(l),l=l.sibling;Oi=r,kA=S,id=U}CU(p)}else r.subtreeFlags&8772&&l!==null?(l.return=r,Oi=l):CU(p)}}function CU(p){for(;Oi!==null;){var o=Oi;if(o.flags&8772){var u=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:id||$O(5,o);break;case 1:var s=o.stateNode;if(o.flags&4&&!id)if(u===null)s.componentDidMount();else{var r=o.elementType===o.type?u.memoizedProps:$0(o.type,u.memoizedProps);s.componentDidUpdate(r,u.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var l=o.updateQueue;l!==null&&cU(o,l,s);break;case 3:var C=o.updateQueue;if(C!==null){if(u=null,o.child!==null)switch(o.child.tag){case 5:u=o.child.stateNode;break;case 1:u=o.child.stateNode}cU(o,C,u)}break;case 5:var S=o.stateNode;if(u===null&&o.flags&4){u=S;var O=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":O.autoFocus&&u.focus();break;case"img":O.src&&(u.src=O.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var U=o.alternate;if(U!==null){var j=U.memoizedState;if(j!==null){var N=j.dehydrated;N!==null&&OS(N)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ui(163))}id||o.flags&512&&HF(o)}catch(L){zu(o,o.return,L)}}if(o===p){Oi=null;break}if(u=o.sibling,u!==null){u.return=o.return,Oi=u;break}Oi=o.return}}function AU(p){for(;Oi!==null;){var o=Oi;if(o===p){Oi=null;break}var u=o.sibling;if(u!==null){u.return=o.return,Oi=u;break}Oi=o.return}}function OU(p){for(;Oi!==null;){var o=Oi;try{switch(o.tag){case 0:case 11:case 15:var u=o.return;try{$O(4,o)}catch(O){zu(o,u,O)}break;case 1:var s=o.stateNode;if(typeof s.componentDidMount=="function"){var r=o.return;try{s.componentDidMount()}catch(O){zu(o,r,O)}}var l=o.return;try{HF(o)}catch(O){zu(o,l,O)}break;case 5:var C=o.return;try{HF(o)}catch(O){zu(o,C,O)}}}catch(O){zu(o,o.return,O)}if(o===p){Oi=null;break}var S=o.sibling;if(S!==null){S.return=o.return,Oi=S;break}Oi=o.return}}var Kae=Math.ceil,TO=M1.ReactCurrentDispatcher,VR=M1.ReactCurrentOwner,Ug=M1.ReactCurrentBatchConfig,Ia=0,El=null,kc=null,af=0,jm=0,D2=Gb(0),$c=0,jS=null,nw=0,XO=0,HR=0,xS=null,Cp=null,GR=0,$2=1/0,b1=null,MO=!1,$F=null,Bb=null,CA=!1,Nb=null,DO=0,wS=0,XF=null,oO=-1,aO=0;function vh(){return Ia&6?oc():oO!==-1?oO:oO=oc()}function jb(p){return p.mode&1?Ia&2&&af!==0?af&-af:Nae.transition!==null?(aO===0&&(aO=LV()),aO):(p=us,p!==0||(p=window.event,p=p===void 0?16:HV(p.type)),p):1}function ev(p,o,u,s){if(50<wS)throw wS=0,XF=null,Error(ui(185));HS(p,u,s),(!(Ia&2)||p!==El)&&(p===El&&(!(Ia&2)&&(XO|=u),$c===4&&Mb(p,af)),Np(p,s),u===1&&Ia===0&&!(o.mode&1)&&($2=oc()+500,HO&&qb()))}function Np(p,o){var u=p.callbackNode;Noe(p,o);var s=pO(p,p===El?af:0);if(s===0)u!==null&&L7(u),p.callbackNode=null,p.callbackPriority=0;else if(o=s&-s,p.callbackPriority!==o){if(u!=null&&L7(u),o===1)p.tag===0?Dae(TU.bind(null,p)):cH(TU.bind(null,p)),Aae(function(){!(Ia&6)&&qb()}),u=null;else{switch(BV(s)){case 1:u=vR;break;case 4:u=RV;break;case 16:u=hO;break;case 536870912:u=PV;break;default:u=hO}u=uG(u,tG.bind(null,p))}p.callbackPriority=o,p.callbackNode=u}}function tG(p,o){if(oO=-1,aO=0,Ia&6)throw Error(ui(327));var u=p.callbackNode;if(B2()&&p.callbackNode!==u)return null;var s=pO(p,p===El?af:0);if(s===0)return null;if(s&30||s&p.expiredLanes||o)o=NO(p,s);else{o=s;var r=Ia;Ia|=2;var l=rG();(El!==p||af!==o)&&(b1=null,$2=oc()+500,Kx(p,o));do try{Qae();break}catch(S){nG(p,S)}while(1);MR(),TO.current=l,Ia=r,kc!==null?o=0:(El=null,af=0,o=$c)}if(o!==0){if(o===2&&(r=wF(p),r!==0&&(s=r,o=KF(p,r))),o===1)throw u=jS,Kx(p,0),Mb(p,s),Np(p,oc()),u;if(o===6)Mb(p,s);else{if(r=p.current.alternate,!(s&30)&&!Yae(r)&&(o=NO(p,s),o===2&&(l=wF(p),l!==0&&(s=l,o=KF(p,l))),o===1))throw u=jS,Kx(p,0),Mb(p,s),Np(p,oc()),u;switch(p.finishedWork=r,p.finishedLanes=s,o){case 0:case 1:throw Error(ui(345));case 2:zx(p,Cp,b1);break;case 3:if(Mb(p,s),(s&130023424)===s&&(o=GR+500-oc(),10<o)){if(pO(p,0)!==0)break;if(r=p.suspendedLanes,(r&s)!==s){vh(),p.pingedLanes|=p.suspendedLanes&r;break}p.timeoutHandle=TF(zx.bind(null,p,Cp,b1),o);break}zx(p,Cp,b1);break;case 4:if(Mb(p,s),(s&4194240)===s)break;for(o=p.eventTimes,r=-1;0<s;){var C=31-Z0(s);l=1<<C,C=o[C],C>r&&(r=C),s&=~l}if(s=r,s=oc()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*Kae(s/1960))-s,10<s){p.timeoutHandle=TF(zx.bind(null,p,Cp,b1),s);break}zx(p,Cp,b1);break;case 5:zx(p,Cp,b1);break;default:throw Error(ui(329))}}}return Np(p,oc()),p.callbackNode===u?tG.bind(null,p):null}function KF(p,o){var u=xS;return p.current.memoizedState.isDehydrated&&(Kx(p,o).flags|=256),p=NO(p,o),p!==2&&(o=Cp,Cp=u,o!==null&&YF(o)),p}function YF(p){Cp===null?Cp=p:Cp.push.apply(Cp,p)}function Yae(p){for(var o=p;;){if(o.flags&16384){var u=o.updateQueue;if(u!==null&&(u=u.stores,u!==null))for(var s=0;s<u.length;s++){var r=u[s],l=r.getSnapshot;r=r.value;try{if(!tv(l(),r))return!1}catch{return!1}}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===p)break;for(;o.sibling===null;){if(o.return===null||o.return===p)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Mb(p,o){for(o&=~HR,o&=~XO,p.suspendedLanes|=o,p.pingedLanes&=~o,p=p.expirationTimes;0<o;){var u=31-Z0(o),s=1<<u;p[u]=-1,o&=~s}}function TU(p){if(Ia&6)throw Error(ui(327));B2();var o=pO(p,0);if(!(o&1))return Np(p,oc()),null;var u=NO(p,o);if(p.tag!==0&&u===2){var s=wF(p);s!==0&&(o=s,u=KF(p,s))}if(u===1)throw u=jS,Kx(p,0),Mb(p,o),Np(p,oc()),u;if(u===6)throw Error(ui(345));return p.finishedWork=p.current.alternate,p.finishedLanes=o,zx(p,Cp,b1),Np(p,oc()),null}function qR(p,o){var u=Ia;Ia|=1;try{return p(o)}finally{Ia=u,Ia===0&&($2=oc()+500,HO&&qb())}}function rw(p){Nb!==null&&Nb.tag===0&&!(Ia&6)&&B2();var o=Ia;Ia|=1;var u=Ug.transition,s=us;try{if(Ug.transition=null,us=1,p)return p()}finally{us=s,Ug.transition=u,Ia=o,!(Ia&6)&&qb()}}function $R(){jm=D2.current,nu(D2)}function Kx(p,o){p.finishedWork=null,p.finishedLanes=0;var u=p.timeoutHandle;if(u!==-1&&(p.timeoutHandle=-1,Cae(u)),kc!==null)for(u=kc.return;u!==null;){var s=u;switch(AR(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&bO();break;case 3:G2(),nu(Mp),nu(ad),PR();break;case 5:RR(s);break;case 4:G2();break;case 13:nu(Au);break;case 19:nu(Au);break;case 10:DR(s.type._context);break;case 22:case 23:$R()}u=u.return}if(El=p,kc=p=zb(p.current,null),af=jm=o,$c=0,jS=null,HR=XO=nw=0,Cp=xS=null,Gx!==null){for(o=0;o<Gx.length;o++)if(u=Gx[o],s=u.interleaved,s!==null){u.interleaved=null;var r=s.next,l=u.pending;if(l!==null){var C=l.next;l.next=r,s.next=C}u.pending=s}Gx=null}return p}function nG(p,o){do{var u=kc;try{if(MR(),nO.current=OO,AO){for(var s=Ou.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}AO=!1}if(tw=0,wl=qc=Ou=null,yS=!1,PS=0,VR.current=null,u===null||u.return===null){$c=1,jS=o,kc=null;break}e:{var l=p,C=u.return,S=u,O=o;if(o=af,S.flags|=32768,O!==null&&typeof O=="object"&&typeof O.then=="function"){var U=O,j=S,N=j.tag;if(!(j.mode&1)&&(N===0||N===11||N===15)){var L=j.alternate;L?(j.updateQueue=L.updateQueue,j.memoizedState=L.memoizedState,j.lanes=L.lanes):(j.updateQueue=null,j.memoizedState=null)}var W=gU(C);if(W!==null){W.flags&=-257,vU(W,C,S,l,o),W.mode&1&&mU(l,U,o),o=W,O=U;var z=o.updateQueue;if(z===null){var q=new Set;q.add(O),o.updateQueue=q}else z.add(O);break e}else{if(!(o&1)){mU(l,U,o),XR();break e}O=Error(ui(426))}}else if(vu&&S.mode&1){var I=gU(C);if(I!==null){!(I.flags&65536)&&(I.flags|=256),vU(I,C,S,l,o),OR(q2(O,S));break e}}l=O=q2(O,S),$c!==4&&($c=2),xS===null?xS=[l]:xS.push(l),l=C;do{switch(l.tag){case 3:l.flags|=65536,o&=-o,l.lanes|=o;var Z=jH(l,O,o);uU(l,Z);break e;case 1:S=O;var Y=l.type,G=l.stateNode;if(!(l.flags&128)&&(typeof Y.getDerivedStateFromError=="function"||G!==null&&typeof G.componentDidCatch=="function"&&(Bb===null||!Bb.has(G)))){l.flags|=65536,o&=-o,l.lanes|=o;var oe=zH(l,S,o);uU(l,oe);break e}}l=l.return}while(l!==null)}oG(u)}catch(ce){o=ce,kc===u&&u!==null&&(kc=u=u.return);continue}break}while(1)}function rG(){var p=TO.current;return TO.current=OO,p===null?OO:p}function XR(){($c===0||$c===3||$c===2)&&($c=4),El===null||!(nw&268435455)&&!(XO&268435455)||Mb(El,af)}function NO(p,o){var u=Ia;Ia|=2;var s=rG();(El!==p||af!==o)&&(b1=null,Kx(p,o));do try{Jae();break}catch(r){nG(p,r)}while(1);if(MR(),Ia=u,TO.current=s,kc!==null)throw Error(ui(261));return El=null,af=0,$c}function Jae(){for(;kc!==null;)iG(kc)}function Qae(){for(;kc!==null&&!Eoe();)iG(kc)}function iG(p){var o=sG(p.alternate,p,jm);p.memoizedProps=p.pendingProps,o===null?oG(p):kc=o,VR.current=null}function oG(p){var o=p;do{var u=o.alternate;if(p=o.return,o.flags&32768){if(u=Gae(u,o),u!==null){u.flags&=32767,kc=u;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{$c=6,kc=null;return}}else if(u=Hae(u,o,jm),u!==null){kc=u;return}if(o=o.sibling,o!==null){kc=o;return}kc=o=p}while(o!==null);$c===0&&($c=5)}function zx(p,o,u){var s=us,r=Ug.transition;try{Ug.transition=null,us=1,Zae(p,o,u,s)}finally{Ug.transition=r,us=s}return null}function Zae(p,o,u,s){do B2();while(Nb!==null);if(Ia&6)throw Error(ui(327));u=p.finishedWork;var r=p.finishedLanes;if(u===null)return null;if(p.finishedWork=null,p.finishedLanes=0,u===p.current)throw Error(ui(177));p.callbackNode=null,p.callbackPriority=0;var l=u.lanes|u.childLanes;if(Ioe(p,l),p===El&&(kc=El=null,af=0),!(u.subtreeFlags&2064)&&!(u.flags&2064)||CA||(CA=!0,uG(hO,function(){return B2(),null})),l=(u.flags&15990)!==0,u.subtreeFlags&15990||l){l=Ug.transition,Ug.transition=null;var C=us;us=1;var S=Ia;Ia|=4,VR.current=null,$ae(p,u),ZH(u,p),bae(AF),mO=!!CF,AF=CF=null,p.current=u,Xae(u),Soe(),Ia=S,us=C,Ug.transition=l}else p.current=u;if(CA&&(CA=!1,Nb=p,DO=r),l=p.pendingLanes,l===0&&(Bb=null),Aoe(u.stateNode),Np(p,oc()),o!==null)for(s=p.onRecoverableError,u=0;u<o.length;u++)r=o[u],s(r.value,{componentStack:r.stack,digest:r.digest});if(MO)throw MO=!1,p=$F,$F=null,p;return DO&1&&p.tag!==0&&B2(),l=p.pendingLanes,l&1?p===XF?wS++:(wS=0,XF=p):wS=0,qb(),null}function B2(){if(Nb!==null){var p=BV(DO),o=Ug.transition,u=us;try{if(Ug.transition=null,us=16>p?16:p,Nb===null)var s=!1;else{if(p=Nb,Nb=null,DO=0,Ia&6)throw Error(ui(331));var r=Ia;for(Ia|=4,Oi=p.current;Oi!==null;){var l=Oi,C=l.child;if(Oi.flags&16){var S=l.deletions;if(S!==null){for(var O=0;O<S.length;O++){var U=S[O];for(Oi=U;Oi!==null;){var j=Oi;switch(j.tag){case 0:case 11:case 15:bS(8,j,l)}var N=j.child;if(N!==null)N.return=j,Oi=N;else for(;Oi!==null;){j=Oi;var L=j.sibling,W=j.return;if(YH(j),j===U){Oi=null;break}if(L!==null){L.return=W,Oi=L;break}Oi=W}}}var z=l.alternate;if(z!==null){var q=z.child;if(q!==null){z.child=null;do{var I=q.sibling;q.sibling=null,q=I}while(q!==null)}}Oi=l}}if(l.subtreeFlags&2064&&C!==null)C.return=l,Oi=C;else e:for(;Oi!==null;){if(l=Oi,l.flags&2048)switch(l.tag){case 0:case 11:case 15:bS(9,l,l.return)}var Z=l.sibling;if(Z!==null){Z.return=l.return,Oi=Z;break e}Oi=l.return}}var Y=p.current;for(Oi=Y;Oi!==null;){C=Oi;var G=C.child;if(C.subtreeFlags&2064&&G!==null)G.return=C,Oi=G;else e:for(C=Y;Oi!==null;){if(S=Oi,S.flags&2048)try{switch(S.tag){case 0:case 11:case 15:$O(9,S)}}catch(ce){zu(S,S.return,ce)}if(S===C){Oi=null;break e}var oe=S.sibling;if(oe!==null){oe.return=S.return,Oi=oe;break e}Oi=S.return}}if(Ia=r,qb(),wy&&typeof wy.onPostCommitFiberRoot=="function")try{wy.onPostCommitFiberRoot(jO,p)}catch{}s=!0}return s}finally{us=u,Ug.transition=o}}return!1}function MU(p,o,u){o=q2(u,o),o=jH(p,o,1),p=Lb(p,o,1),o=vh(),p!==null&&(HS(p,1,o),Np(p,o))}function zu(p,o,u){if(p.tag===3)MU(p,p,u);else for(;o!==null;){if(o.tag===3){MU(o,p,u);break}else if(o.tag===1){var s=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Bb===null||!Bb.has(s))){p=q2(u,p),p=zH(o,p,1),o=Lb(o,p,1),p=vh(),o!==null&&(HS(o,1,p),Np(o,p));break}}o=o.return}}function ese(p,o,u){var s=p.pingCache;s!==null&&s.delete(o),o=vh(),p.pingedLanes|=p.suspendedLanes&u,El===p&&(af&u)===u&&($c===4||$c===3&&(af&130023424)===af&&500>oc()-GR?Kx(p,0):HR|=u),Np(p,o)}function aG(p,o){o===0&&(p.mode&1?(o=gA,gA<<=1,!(gA&130023424)&&(gA=4194304)):o=1);var u=vh();p=O1(p,o),p!==null&&(HS(p,o,u),Np(p,u))}function tse(p){var o=p.memoizedState,u=0;o!==null&&(u=o.retryLane),aG(p,u)}function nse(p,o){var u=0;switch(p.tag){case 13:var s=p.stateNode,r=p.memoizedState;r!==null&&(u=r.retryLane);break;case 19:s=p.stateNode;break;default:throw Error(ui(314))}s!==null&&s.delete(o),aG(p,u)}var sG;sG=function(p,o,u){if(p!==null)if(p.memoizedProps!==o.pendingProps||Mp.current)Op=!0;else{if(!(p.lanes&u)&&!(o.flags&128))return Op=!1,Vae(p,o,u);Op=!!(p.flags&131072)}else Op=!1,vu&&o.flags&1048576&&lH(o,_O,o.index);switch(o.lanes=0,o.tag){case 2:var s=o.type;iO(p,o),p=o.pendingProps;var r=W2(o,ad.current);L2(o,u),r=BR(null,o,s,p,r,u);var l=jR();return o.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,Dp(s)?(l=!0,xO(o)):l=!1,o.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,IR(o),r.updater=GO,o.stateNode=r,r._reactInternals=o,PF(o,s,p,u),o=jF(null,o,s,!0,l,u)):(o.tag=0,vu&&l&&CR(o),mh(null,o,r,u),o=o.child),o;case 16:s=o.elementType;e:{switch(iO(p,o),p=o.pendingProps,r=s._init,s=r(s._payload),o.type=s,r=o.tag=ise(s),p=$0(s,p),r){case 0:o=BF(null,o,s,p,u);break e;case 1:o=xU(null,o,s,p,u);break e;case 11:o=yU(null,o,s,p,u);break e;case 14:o=bU(null,o,s,$0(s.type,p),u);break e}throw Error(ui(306,s,""))}return o;case 0:return s=o.type,r=o.pendingProps,r=o.elementType===s?r:$0(s,r),BF(p,o,s,r,u);case 1:return s=o.type,r=o.pendingProps,r=o.elementType===s?r:$0(s,r),xU(p,o,s,r,u);case 3:e:{if(HH(o),p===null)throw Error(ui(387));s=o.pendingProps,l=o.memoizedState,r=l.element,pH(p,o),kO(o,s,null,u);var C=o.memoizedState;if(s=C.element,l.isDehydrated)if(l={element:s,isDehydrated:!1,cache:C.cache,pendingSuspenseBoundaries:C.pendingSuspenseBoundaries,transitions:C.transitions},o.updateQueue.baseState=l,o.memoizedState=l,o.flags&256){r=q2(Error(ui(423)),o),o=wU(p,o,s,u,r);break e}else if(s!==r){r=q2(Error(ui(424)),o),o=wU(p,o,s,u,r);break e}else for(Um=Pb(o.stateNode.containerInfo.firstChild),Vm=o,vu=!0,K0=null,u=yH(o,null,s,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling;else{if(V2(),s===r){o=T1(p,o,u);break e}mh(p,o,s,u)}o=o.child}return o;case 5:return bH(o),p===null&&IF(o),s=o.type,r=o.pendingProps,l=p!==null?p.memoizedProps:null,C=r.children,OF(s,r)?C=null:l!==null&&OF(s,l)&&(o.flags|=32),VH(p,o),mh(p,o,C,u),o.child;case 6:return p===null&&IF(o),null;case 13:return GH(p,o,u);case 4:return FR(o,o.stateNode.containerInfo),s=o.pendingProps,p===null?o.child=H2(o,null,s,u):mh(p,o,s,u),o.child;case 11:return s=o.type,r=o.pendingProps,r=o.elementType===s?r:$0(s,r),yU(p,o,s,r,u);case 7:return mh(p,o,o.pendingProps,u),o.child;case 8:return mh(p,o,o.pendingProps.children,u),o.child;case 12:return mh(p,o,o.pendingProps.children,u),o.child;case 10:e:{if(s=o.type._context,r=o.pendingProps,l=o.memoizedProps,C=r.value,Gs(EO,s._currentValue),s._currentValue=C,l!==null)if(tv(l.value,C)){if(l.children===r.children&&!Mp.current){o=T1(p,o,u);break e}}else for(l=o.child,l!==null&&(l.return=o);l!==null;){var S=l.dependencies;if(S!==null){C=l.child;for(var O=S.firstContext;O!==null;){if(O.context===s){if(l.tag===1){O=S1(-1,u&-u),O.tag=2;var U=l.updateQueue;if(U!==null){U=U.shared;var j=U.pending;j===null?O.next=O:(O.next=j.next,j.next=O),U.pending=O}}l.lanes|=u,O=l.alternate,O!==null&&(O.lanes|=u),FF(l.return,u,o),S.lanes|=u;break}O=O.next}}else if(l.tag===10)C=l.type===o.type?null:l.child;else if(l.tag===18){if(C=l.return,C===null)throw Error(ui(341));C.lanes|=u,S=C.alternate,S!==null&&(S.lanes|=u),FF(C,u,o),C=l.sibling}else C=l.child;if(C!==null)C.return=l;else for(C=l;C!==null;){if(C===o){C=null;break}if(l=C.sibling,l!==null){l.return=C.return,C=l;break}C=C.return}l=C}mh(p,o,r.children,u),o=o.child}return o;case 9:return r=o.type,s=o.pendingProps.children,L2(o,u),r=Vg(r),s=s(r),o.flags|=1,mh(p,o,s,u),o.child;case 14:return s=o.type,r=$0(s,o.pendingProps),r=$0(s.type,r),bU(p,o,s,r,u);case 15:return UH(p,o,o.type,o.pendingProps,u);case 17:return s=o.type,r=o.pendingProps,r=o.elementType===s?r:$0(s,r),iO(p,o),o.tag=1,Dp(s)?(p=!0,xO(o)):p=!1,L2(o,u),gH(o,s,r),PF(o,s,r,u),jF(null,o,s,!0,p,u);case 19:return qH(p,o,u);case 22:return WH(p,o,u)}throw Error(ui(156,o.tag))};function uG(p,o){return FV(p,o)}function rse(p,o,u,s){this.tag=p,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zg(p,o,u,s){return new rse(p,o,u,s)}function KR(p){return p=p.prototype,!(!p||!p.isReactComponent)}function ise(p){if(typeof p=="function")return KR(p)?1:0;if(p!=null){if(p=p.$$typeof,p===pR)return 11;if(p===mR)return 14}return 2}function zb(p,o){var u=p.alternate;return u===null?(u=zg(p.tag,o,p.key,p.mode),u.elementType=p.elementType,u.type=p.type,u.stateNode=p.stateNode,u.alternate=p,p.alternate=u):(u.pendingProps=o,u.type=p.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=p.flags&14680064,u.childLanes=p.childLanes,u.lanes=p.lanes,u.child=p.child,u.memoizedProps=p.memoizedProps,u.memoizedState=p.memoizedState,u.updateQueue=p.updateQueue,o=p.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=p.sibling,u.index=p.index,u.ref=p.ref,u}function sO(p,o,u,s,r,l){var C=2;if(s=p,typeof p=="function")KR(p)&&(C=1);else if(typeof p=="string")C=5;else e:switch(p){case w2:return Yx(u.children,r,l,o);case hR:C=8,r|=8;break;case aF:return p=zg(12,u,o,r|2),p.elementType=aF,p.lanes=l,p;case sF:return p=zg(13,u,o,r),p.elementType=sF,p.lanes=l,p;case uF:return p=zg(19,u,o,r),p.elementType=uF,p.lanes=l,p;case vV:return KO(u,r,l,o);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case mV:C=10;break e;case gV:C=9;break e;case pR:C=11;break e;case mR:C=14;break e;case Ab:C=16,s=null;break e}throw Error(ui(130,p==null?p:typeof p,""))}return o=zg(C,u,o,r),o.elementType=p,o.type=s,o.lanes=l,o}function Yx(p,o,u,s){return p=zg(7,p,s,o),p.lanes=u,p}function KO(p,o,u,s){return p=zg(22,p,s,o),p.elementType=vV,p.lanes=u,p.stateNode={isHidden:!1},p}function wI(p,o,u){return p=zg(6,p,null,o),p.lanes=u,p}function _I(p,o,u){return o=zg(4,p.children!==null?p.children:[],p.key,o),o.lanes=u,o.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},o}function ose(p,o,u,s,r){this.tag=o,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=nI(0),this.expirationTimes=nI(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=nI(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function YR(p,o,u,s,r,l,C,S,O){return p=new ose(p,o,u,S,O),o===1?(o=1,l===!0&&(o|=8)):o=0,l=zg(3,null,null,o),p.current=l,l.stateNode=p,l.memoizedState={element:s,isDehydrated:u,cache:null,transitions:null,pendingSuspenseBoundaries:null},IR(l),p}function ase(p,o,u){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:x2,key:s==null?null:""+s,children:p,containerInfo:o,implementation:u}}function cG(p){if(!p)return Vb;p=p._reactInternals;e:{if(lw(p)!==p||p.tag!==1)throw Error(ui(170));var o=p;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(Dp(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(ui(171))}if(p.tag===1){var u=p.type;if(Dp(u))return uH(p,u,o)}return o}function lG(p,o,u,s,r,l,C,S,O){return p=YR(u,s,!0,p,r,l,C,S,O),p.context=cG(null),u=p.current,s=vh(),r=jb(u),l=S1(s,r),l.callback=o??null,Lb(u,l,r),p.current.lanes=r,HS(p,r,s),Np(p,s),p}function YO(p,o,u,s){var r=o.current,l=vh(),C=jb(r);return u=cG(u),o.context===null?o.context=u:o.pendingContext=u,o=S1(l,C),o.payload={element:p},s=s===void 0?null:s,s!==null&&(o.callback=s),p=Lb(r,o,C),p!==null&&(ev(p,r,C,l),tO(p,r,C)),C}function IO(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function DU(p,o){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var u=p.retryLane;p.retryLane=u!==0&&u<o?u:o}}function JR(p,o){DU(p,o),(p=p.alternate)&&DU(p,o)}function sse(){return null}var fG=typeof reportError=="function"?reportError:function(p){console.error(p)};function QR(p){this._internalRoot=p}JO.prototype.render=QR.prototype.render=function(p){var o=this._internalRoot;if(o===null)throw Error(ui(409));YO(p,o,null,null)};JO.prototype.unmount=QR.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var o=p.containerInfo;rw(function(){YO(null,p,null,null)}),o[A1]=null}};function JO(p){this._internalRoot=p}JO.prototype.unstable_scheduleHydration=function(p){if(p){var o=UV();p={blockedOn:null,target:p,priority:o};for(var u=0;u<Tb.length&&o!==0&&o<Tb[u].priority;u++);Tb.splice(u,0,p),u===0&&VV(p)}};function ZR(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function QO(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function NU(){}function use(p,o,u,s,r){if(r){if(typeof s=="function"){var l=s;s=function(){var U=IO(C);l.call(U)}}var C=lG(o,s,p,0,null,!1,!1,"",NU);return p._reactRootContainer=C,p[A1]=C.current,DS(p.nodeType===8?p.parentNode:p),rw(),C}for(;r=p.lastChild;)p.removeChild(r);if(typeof s=="function"){var S=s;s=function(){var U=IO(O);S.call(U)}}var O=YR(p,0,!1,null,null,!1,!1,"",NU);return p._reactRootContainer=O,p[A1]=O.current,DS(p.nodeType===8?p.parentNode:p),rw(function(){YO(o,O,u,s)}),O}function ZO(p,o,u,s,r){var l=u._reactRootContainer;if(l){var C=l;if(typeof r=="function"){var S=r;r=function(){var O=IO(C);S.call(O)}}YO(o,C,p,r)}else C=use(u,o,p,r,s);return IO(C)}jV=function(p){switch(p.tag){case 3:var o=p.stateNode;if(o.current.memoizedState.isDehydrated){var u=cS(o.pendingLanes);u!==0&&(yR(o,u|1),Np(o,oc()),!(Ia&6)&&($2=oc()+500,qb()))}break;case 13:rw(function(){var s=O1(p,1);if(s!==null){var r=vh();ev(s,p,1,r)}}),JR(p,1)}};bR=function(p){if(p.tag===13){var o=O1(p,134217728);if(o!==null){var u=vh();ev(o,p,134217728,u)}JR(p,134217728)}};zV=function(p){if(p.tag===13){var o=jb(p),u=O1(p,o);if(u!==null){var s=vh();ev(u,p,o,s)}JR(p,o)}};UV=function(){return us};WV=function(p,o){var u=us;try{return us=p,o()}finally{us=u}};yF=function(p,o,u){switch(o){case"input":if(fF(p,u),o=u.name,u.type==="radio"&&o!=null){for(u=p;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<u.length;o++){var s=u[o];if(s!==p&&s.form===p.form){var r=VO(s);if(!r)throw Error(ui(90));bV(s),fF(s,r)}}}break;case"textarea":wV(p,u);break;case"select":o=u.value,o!=null&&I2(p,!!u.multiple,o,!1)}};OV=qR;TV=rw;var cse={usingClientEntryPoint:!1,Events:[qS,k2,VO,CV,AV,qR]},JE={findFiberByHostInstance:Hx,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},lse={bundleType:JE.bundleType,version:JE.version,rendererPackageName:JE.rendererPackageName,rendererConfig:JE.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:M1.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=NV(p),p===null?null:p.stateNode},findFiberByHostInstance:JE.findFiberByHostInstance||sse,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var AA=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!AA.isDisabled&&AA.supportsFiber)try{jO=AA.inject(lse),wy=AA}catch{}}Gm.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cse;Gm.createPortal=function(p,o){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ZR(o))throw Error(ui(200));return ase(p,o,null,u)};Gm.createRoot=function(p,o){if(!ZR(p))throw Error(ui(299));var u=!1,s="",r=fG;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(s=o.identifierPrefix),o.onRecoverableError!==void 0&&(r=o.onRecoverableError)),o=YR(p,1,!1,null,null,u,!1,s,r),p[A1]=o.current,DS(p.nodeType===8?p.parentNode:p),new QR(o)};Gm.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var o=p._reactInternals;if(o===void 0)throw typeof p.render=="function"?Error(ui(188)):(p=Object.keys(p).join(","),Error(ui(268,p)));return p=NV(o),p=p===null?null:p.stateNode,p};Gm.flushSync=function(p){return rw(p)};Gm.hydrate=function(p,o,u){if(!QO(o))throw Error(ui(200));return ZO(null,p,o,!0,u)};Gm.hydrateRoot=function(p,o,u){if(!ZR(p))throw Error(ui(405));var s=u!=null&&u.hydratedSources||null,r=!1,l="",C=fG;if(u!=null&&(u.unstable_strictMode===!0&&(r=!0),u.identifierPrefix!==void 0&&(l=u.identifierPrefix),u.onRecoverableError!==void 0&&(C=u.onRecoverableError)),o=lG(o,null,p,1,u??null,r,!1,l,C),p[A1]=o.current,DS(p),s)for(p=0;p<s.length;p++)u=s[p],r=u._getVersion,r=r(u._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[u,r]:o.mutableSourceEagerHydrationData.push(u,r);return new JO(o)};Gm.render=function(p,o,u){if(!QO(o))throw Error(ui(200));return ZO(null,p,o,!1,u)};Gm.unmountComponentAtNode=function(p){if(!QO(p))throw Error(ui(40));return p._reactRootContainer?(rw(function(){ZO(null,null,p,!1,function(){p._reactRootContainer=null,p[A1]=null})}),!0):!1};Gm.unstable_batchedUpdates=qR;Gm.unstable_renderSubtreeIntoContainer=function(p,o,u,s){if(!QO(u))throw Error(ui(200));if(p==null||p._reactInternals===void 0)throw Error(ui(38));return ZO(p,o,u,!1,s)};Gm.version="18.2.0-next-9e3b772b8-20220608";(function(p){function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(u){console.error(u)}}o(),p.exports=Gm})(lV);var IU=lV.exports;iF.createRoot=IU.createRoot,iF.hydrateRoot=IU.hydrateRoot;var dG={exports:{}};(function(p,o){(function(u,s){p.exports=s()})(window,function(){return function(u){var s={};function r(l){if(s[l])return s[l].exports;var C=s[l]={i:l,l:!1,exports:{}};return u[l].call(C.exports,C,C.exports,r),C.l=!0,C.exports}return r.m=u,r.c=s,r.d=function(l,C,S){r.o(l,C)||Object.defineProperty(l,C,{configurable:!1,enumerable:!0,get:S})},r.r=function(l){Object.defineProperty(l,"__esModule",{value:!0})},r.n=function(l){var C=l&&l.__esModule?function(){return l.default}:function(){return l};return r.d(C,"a",C),C},r.o=function(l,C){return Object.prototype.hasOwnProperty.call(l,C)},r.p="/",r(r.s=581)}([function(u,s,r){r.r(s),function(l,C,S,O){r.d(s,"AdadeltaOptimizer",function(){return tt}),r.d(s,"AdagradOptimizer",function(){return ut}),r.d(s,"AdamOptimizer",function(){return Dt}),r.d(s,"AdamaxOptimizer",function(){return Rt}),r.d(s,"Add",function(){return hf}),r.d(s,"AddN",function(){return Ih}),r.d(s,"BroadcastTo",function(){return el}),r.d(s,"DataStorage",function(){return Gt}),r.d(s,"Div",function(){return Go}),r.d(s,"ENV",function(){return q}),r.d(s,"Environment",function(){return W}),r.d(s,"FromPixels",function(){return Xg}),r.d(s,"FusedBatchNorm",function(){return Fh}),r.d(s,"Identity",function(){return yd}),r.d(s,"KernelBackend",function(){return on}),r.d(s,"MaxPoolWithArgmax",function(){return vf}),r.d(s,"MomentumOptimizer",function(){return qt}),r.d(s,"NonMaxSuppressionV5",function(){return Tl}),r.d(s,"OneHot",function(){return Ph}),r.d(s,"Optimizer",function(){return nt}),r.d(s,"PadV2",function(){return tl}),r.d(s,"RMSPropOptimizer",function(){return pn}),r.d(s,"Rank",function(){return Se}),r.d(s,"Reduction",function(){return Ja}),r.d(s,"SGDOptimizer",function(){return Lt}),r.d(s,"Square",function(){return Rh}),r.d(s,"SquaredDifference",function(){return pf}),r.d(s,"Tensor",function(){return $t}),r.d(s,"TensorBuffer",function(){return Hr}),r.d(s,"Tile",function(){return gf}),r.d(s,"Transpose",function(){return mf}),r.d(s,"Variable",function(){return kt}),r.d(s,"abs",function(){return Rs}),r.d(s,"acos",function(){return nl}),r.d(s,"acosh",function(){return Va}),r.d(s,"add",function(){return la}),r.d(s,"addN",function(){return Nd}),r.d(s,"addStrict",function(){return _f}),r.d(s,"all",function(){return vm}),r.d(s,"any",function(){return Gl}),r.d(s,"argMax",function(){return Pv}),r.d(s,"argMin",function(){return vg}),r.d(s,"asin",function(){return rl}),r.d(s,"asinh",function(){return fc}),r.d(s,"atan",function(){return bd}),r.d(s,"atan2",function(){return Sd}),r.d(s,"atanh",function(){return xd}),r.d(s,"avgPool",function(){return Zh}),r.d(s,"avgPool3d",function(){return v0}),r.d(s,"backend",function(){return qg}),r.d(s,"backend_util",function(){return oi}),r.d(s,"basicLSTMCell",function(){return Bv}),r.d(s,"batchNorm",function(){return Tf}),r.d(s,"batchNorm2d",function(){return Oy}),r.d(s,"batchNorm3d",function(){return zl}),r.d(s,"batchNorm4d",function(){return Rd}),r.d(s,"batchNormalization",function(){return po}),r.d(s,"batchNormalization2d",function(){return Ay}),r.d(s,"batchNormalization3d",function(){return Mf}),r.d(s,"batchNormalization4d",function(){return $h}),r.d(s,"batchToSpaceND",function(){return Gp}),r.d(s,"booleanMaskAsync",function(){return kv}),r.d(s,"broadcastTo",function(){return Df}),r.d(s,"browser",function(){return fe}),r.d(s,"buffer",function(){return Di}),r.d(s,"cast",function(){return qp}),r.d(s,"ceil",function(){return Ml}),r.d(s,"clipByValue",function(){return Kp}),r.d(s,"clone",function(){return Nf}),r.d(s,"complex",function(){return _o}),r.d(s,"concat",function(){return Ho}),r.d(s,"concat1d",function(){return Mh}),r.d(s,"concat2d",function(){return Hp}),r.d(s,"concat3d",function(){return ff}),r.d(s,"concat4d",function(){return Dh}),r.d(s,"conv1d",function(){return Ov}),r.d(s,"conv2d",function(){return Ud}),r.d(s,"conv2dTranspose",function(){return pg}),r.d(s,"conv3d",function(){return My}),r.d(s,"conv3dTranspose",function(){return m0}),r.d(s,"cos",function(){return dc}),r.d(s,"cosh",function(){return Kg}),r.d(s,"cumsum",function(){return $p}),r.d(s,"customGrad",function(){return H}),r.d(s,"deprecationWarn",function(){return pd}),r.d(s,"depthToSpace",function(){return Jm}),r.d(s,"depthwiseConv2d",function(){return p0}),r.d(s,"diag",function(){return Bf}),r.d(s,"disableDeprecationWarnings",function(){return Xm}),r.d(s,"dispose",function(){return Lo}),r.d(s,"disposeVariables",function(){return lf}),r.d(s,"div",function(){return ra}),r.d(s,"divNoNan",function(){return ig}),r.d(s,"divStrict",function(){return mr}),r.d(s,"dot",function(){return g0}),r.d(s,"dropout",function(){return R1}),r.d(s,"elu",function(){return Hd}),r.d(s,"enableDebugMode",function(){return $m}),r.d(s,"enableProdMode",function(){return Wu}),r.d(s,"engine",function(){return Bp}),r.d(s,"env",function(){return z}),r.d(s,"equal",function(){return fg}),r.d(s,"equalStrict",function(){return l0}),r.d(s,"erf",function(){return Yp}),r.d(s,"exp",function(){return yf}),r.d(s,"expandDims",function(){return lc}),r.d(s,"expm1",function(){return Zm}),r.d(s,"eye",function(){return cl}),r.d(s,"fft",function(){return dl}),r.d(s,"fill",function(){return Is}),r.d(s,"findBackend",function(){return zp}),r.d(s,"findBackendFactory",function(){return Km}),r.d(s,"floor",function(){return wd}),r.d(s,"floorDiv",function(){return ts}),r.d(s,"frame",function(){return Sg}),r.d(s,"fused",function(){return Wn}),r.d(s,"gather",function(){return mm}),r.d(s,"gatherND",function(){return _g}),r.d(s,"gather_util",function(){return Gu}),r.d(s,"getBackend",function(){return Ds}),r.d(s,"getGradient",function(){return G}),r.d(s,"getKernel",function(){return Y}),r.d(s,"getKernelsForBackend",function(){return oe}),r.d(s,"grad",function(){return Ef}),r.d(s,"grads",function(){return Ad}),r.d(s,"greater",function(){return f0}),r.d(s,"greaterEqual",function(){return hm}),r.d(s,"greaterEqualStrict",function(){return d0}),r.d(s,"greaterStrict",function(){return dg}),r.d(s,"hammingWindow",function(){return qd}),r.d(s,"hannWindow",function(){return Em}),r.d(s,"ifft",function(){return rs}),r.d(s,"imag",function(){return Ya}),r.d(s,"image",function(){return et}),r.d(s,"inTopKAsync",function(){return _0}),r.d(s,"io",function(){return E}),r.d(s,"irfft",function(){return _m}),r.d(s,"isFinite",function(){return wf}),r.d(s,"isInf",function(){return Ed}),r.d(s,"isNaN",function(){return Qp}),r.d(s,"keep",function(){return Ch}),r.d(s,"leakyRelu",function(){return bm}),r.d(s,"less",function(){return wv}),r.d(s,"lessEqual",function(){return Wl}),r.d(s,"lessEqualStrict",function(){return Ty}),r.d(s,"lessStrict",function(){return _v}),r.d(s,"linalg",function(){return P}),r.d(s,"linspace",function(){return Th}),r.d(s,"localResponseNormalization",function(){return wm}),r.d(s,"log",function(){return Dl}),r.d(s,"log1p",function(){return Jp}),r.d(s,"logSigmoid",function(){return Lh}),r.d(s,"logSoftmax",function(){return Je}),r.d(s,"logSumExp",function(){return yg}),r.d(s,"logicalAnd",function(){return Zu}),r.d(s,"logicalNot",function(){return Xh}),r.d(s,"logicalOr",function(){return Pd}),r.d(s,"logicalXor",function(){return Ul}),r.d(s,"losses",function(){return $r}),r.d(s,"matMul",function(){return jc}),r.d(s,"math",function(){return Q}),r.d(s,"max",function(){return y0}),r.d(s,"maxPool",function(){return zc}),r.d(s,"maxPool3d",function(){return mg}),r.d(s,"maxPoolWithArgmax",function(){return Iv}),r.d(s,"maximum",function(){return Ta}),r.d(s,"maximumStrict",function(){return no}),r.d(s,"mean",function(){return ll}),r.d(s,"memory",function(){return Sh}),r.d(s,"min",function(){return bg}),r.d(s,"minimum",function(){return Hu}),r.d(s,"minimumStrict",function(){return Nc}),r.d(s,"mod",function(){return au}),r.d(s,"modStrict",function(){return Ic}),r.d(s,"moments",function(){return Lv}),r.d(s,"movingAverage",function(){return fl}),r.d(s,"mul",function(){return na}),r.d(s,"mulStrict",function(){return hc}),r.d(s,"multiRNNCell",function(){return Ny}),r.d(s,"multinomial",function(){return ds}),r.d(s,"neg",function(){return Oa}),r.d(s,"nextFrame",function(){return On}),r.d(s,"norm",function(){return x0}),r.d(s,"notEqual",function(){return pm}),r.d(s,"notEqualStrict",function(){return Ev}),r.d(s,"oneHot",function(){return Lc}),r.d(s,"ones",function(){return Du}),r.d(s,"onesLike",function(){return xs}),r.d(s,"op",function(){return Pt}),r.d(s,"outerProduct",function(){return Dv}),r.d(s,"pad",function(){return ec}),r.d(s,"pad1d",function(){return Nu}),r.d(s,"pad2d",function(){return Kh}),r.d(s,"pad3d",function(){return og}),r.d(s,"pad4d",function(){return u0}),r.d(s,"pool",function(){return gm}),r.d(s,"pow",function(){return su}),r.d(s,"powStrict",function(){return vo}),r.d(s,"prelu",function(){return ps}),r.d(s,"print",function(){return da}),r.d(s,"prod",function(){return ym}),r.d(s,"profile",function(){return kh}),r.d(s,"rand",function(){return c0}),r.d(s,"randomGamma",function(){return ug}),r.d(s,"randomNormal",function(){return xv}),r.d(s,"randomUniform",function(){return cg}),r.d(s,"range",function(){return Dc}),r.d(s,"ready",function(){return jp}),r.d(s,"real",function(){return va}),r.d(s,"reciprocal",function(){return bf}),r.d(s,"registerBackend",function(){return Ym}),r.d(s,"registerGradient",function(){return be}),r.d(s,"registerKernel",function(){return ce}),r.d(s,"relu",function(){return xg}),r.d(s,"relu6",function(){return b0}),r.d(s,"removeBackend",function(){return Mc}),r.d(s,"reshape",function(){return Fs}),r.d(s,"reverse",function(){return Rf}),r.d(s,"reverse1d",function(){return Dy}),r.d(s,"reverse2d",function(){return Jh}),r.d(s,"reverse3d",function(){return Qh}),r.d(s,"reverse4d",function(){return Pf}),r.d(s,"rfft",function(){return tp}),r.d(s,"round",function(){return Ps}),r.d(s,"rsqrt",function(){return xf}),r.d(s,"scalar",function(){return kr}),r.d(s,"scatterND",function(){return jv}),r.d(s,"scatter_util",function(){return jh}),r.d(s,"selu",function(){return xm}),r.d(s,"separableConv2d",function(){return Hl}),r.d(s,"serialization",function(){return Le}),r.d(s,"setBackend",function(){return md}),r.d(s,"setPlatform",function(){return $g}),r.d(s,"setdiff1dAsync",function(){return Wi}),r.d(s,"sigmoid",function(){return _d}),r.d(s,"sign",function(){return Bh}),r.d(s,"signal",function(){return w0}),r.d(s,"sin",function(){return Zp}),r.d(s,"sinh",function(){return em}),r.d(s,"slice",function(){return hs}),r.d(s,"slice1d",function(){return Fv}),r.d(s,"slice2d",function(){return ep}),r.d(s,"slice3d",function(){return Rv}),r.d(s,"slice4d",function(){return gg}),r.d(s,"slice_util",function(){return Cd}),r.d(s,"softmax",function(){return je}),r.d(s,"softplus",function(){return vn}),r.d(s,"spaceToBatchND",function(){return Al}),r.d(s,"sparseToDense",function(){return zv}),r.d(s,"spectral",function(){return wg}),r.d(s,"split",function(){return Gi}),r.d(s,"sqrt",function(){return ou}),r.d(s,"square",function(){return If}),r.d(s,"squaredDifference",function(){return lg}),r.d(s,"squaredDifferenceStrict",function(){return ws}),r.d(s,"squeeze",function(){return qs}),r.d(s,"stack",function(){return wu}),r.d(s,"step",function(){return tr}),r.d(s,"stft",function(){return Sm}),r.d(s,"stridedSlice",function(){return Gd}),r.d(s,"sub",function(){return Ba}),r.d(s,"subStrict",function(){return _s}),r.d(s,"sum",function(){return ql}),r.d(s,"sumOutType",function(){return Nt}),r.d(s,"tan",function(){return Ls}),r.d(s,"tanh",function(){return mo}),r.d(s,"tensor",function(){return To}),r.d(s,"tensor1d",function(){return ru}),r.d(s,"tensor2d",function(){return xu}),r.d(s,"tensor3d",function(){return Cl}),r.d(s,"tensor4d",function(){return iu}),r.d(s,"tensor5d",function(){return Oh}),r.d(s,"tensor6d",function(){return Wp}),r.d(s,"tensor_util",function(){return Tt}),r.d(s,"test_util",function(){return zd}),r.d(s,"tidy",function(){return Hi}),r.d(s,"tile",function(){return Bd}),r.d(s,"time",function(){return Gg}),r.d(s,"topk",function(){return Iy}),r.d(s,"train",function(){return mn}),r.d(s,"transpose",function(){return vt}),r.d(s,"truncatedNormal",function(){return Yh}),r.d(s,"unregisterGradient",function(){return ve}),r.d(s,"unregisterKernel",function(){return Ee}),r.d(s,"unsortedSegmentSum",function(){return hg}),r.d(s,"unstack",function(){return Nh}),r.d(s,"util",function(){return Er}),r.d(s,"valueAndGrad",function(){return ae}),r.d(s,"valueAndGrads",function(){return ne}),r.d(s,"variable",function(){return Vp}),r.d(s,"variableGrads",function(){return D}),r.d(s,"version_core",function(){return Be}),r.d(s,"webgl",function(){return Xe}),r.d(s,"where",function(){return ul}),r.d(s,"whereAsync",function(){return Ld}),r.d(s,"zeros",function(){return ao}),r.d(s,"zerosLike",function(){return mi});var U=function(b,h){return(U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,m){c.__proto__=m}||function(c,m){for(var w in m)m.hasOwnProperty(w)&&(c[w]=m[w])})(b,h)};function j(b,h){function c(){this.constructor=b}U(b,h),b.prototype=h===null?Object.create(h):(c.prototype=h.prototype,new c)}function N(b,h,c,m){return new(c||(c=Promise))(function(w,R){function K(de){try{le(m.next(de))}catch(_e){R(_e)}}function ee(de){try{le(m.throw(de))}catch(_e){R(_e)}}function le(de){de.done?w(de.value):new c(function(_e){_e(de.value)}).then(K,ee)}le((m=m.apply(b,h||[])).next())})}function L(b,h){var c,m,w,R,K={label:0,sent:function(){if(1&w[0])throw w[1];return w[1]},trys:[],ops:[]};return R={next:ee(0),throw:ee(1),return:ee(2)},typeof Symbol=="function"&&(R[Symbol.iterator]=function(){return this}),R;function ee(le){return function(de){return function(_e){if(c)throw new TypeError("Generator is already executing.");for(;K;)try{if(c=1,m&&(w=2&_e[0]?m.return:_e[0]?m.throw||((w=m.return)&&w.call(m),0):m.next)&&!(w=w.call(m,_e[1])).done)return w;switch(m=0,w&&(_e=[2&_e[0],w.value]),_e[0]){case 0:case 1:w=_e;break;case 4:return K.label++,{value:_e[1],done:!1};case 5:K.label++,m=_e[1],_e=[0];continue;case 7:_e=K.ops.pop(),K.trys.pop();continue;default:if(!(w=(w=K.trys).length>0&&w[w.length-1])&&(_e[0]===6||_e[0]===2)){K=0;continue}if(_e[0]===3&&(!w||_e[1]>w[0]&&_e[1]<w[3])){K.label=_e[1];break}if(_e[0]===6&&K.label<w[1]){K.label=w[1],w=_e;break}if(w&&K.label<w[2]){K.label=w[2],K.ops.push(_e);break}w[2]&&K.ops.pop(),K.trys.pop();continue}_e=h.call(b,K)}catch(Te){_e=[6,Te],m=0}finally{c=w=0}if(5&_e[0])throw _e[1];return{value:_e[0]?_e[1]:void 0,done:!0}}([le,de])}}}var W=function(){function b(h){this.global=h,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return b.prototype.setPlatform=function(h,c){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+c+"."),this.platformName=h,this.platform=c},b.prototype.registerFlag=function(h,c,m){if(this.flagRegistry[h]={evaluationFn:c,setHook:m},this.urlFlags[h]!=null){var w=this.urlFlags[h];console.warn("Setting feature override from URL "+h+": "+w+"."),this.set(h,w)}},b.prototype.get=function(h){return h in this.flags?this.flags[h]:(this.flags[h]=this.evaluateFlag(h),this.flags[h])},b.prototype.getNumber=function(h){return this.get(h)},b.prototype.getBool=function(h){return this.get(h)},b.prototype.getFlags=function(){return this.flags},Object.defineProperty(b.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),b.prototype.set=function(h,c){if(this.flagRegistry[h]==null)throw new Error("Cannot set flag "+h+" as it has not been registered.");this.flags[h]=c,this.flagRegistry[h].setHook!=null&&this.flagRegistry[h].setHook(c)},b.prototype.evaluateFlag=function(h){if(this.flagRegistry[h]==null)throw new Error("Cannot evaluate flag '"+h+"': no evaluation function found.");return this.flagRegistry[h].evaluationFn()},b.prototype.setFlags=function(h){this.flags=Object.assign({},h)},b.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},b.prototype.populateURLFlags=function(){var h=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var c,m,w=(c=this.global.location.search,m={},c.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(R){for(var K=[],ee=1;ee<arguments.length;ee++)K[ee-1]=arguments[ee];return function(le,de,_e){le[decodeURIComponent(de)]=decodeURIComponent(_e||"")}(m,K[0],K[1]),K.join("=")}),m);"tfjsflags"in w&&w.tfjsflags.split(",").forEach(function(R){var K=R.split(":"),ee=K[0],le=K[1];h.urlFlags[ee]=function(de,_e){if((_e=_e.toLowerCase())==="true"||_e==="false")return _e==="true";if(""+ +_e===_e)return+_e;throw new Error("Could not parse value flag value "+_e+" for flag "+de+".")}(ee,le)})}},b}();function z(){return q}var q=null,I=new Map,Z=new Map;function Y(b,h){var c=ge(b,h);return I.get(c)}function G(b){return Z.get(b)}function oe(b){for(var h=I.entries(),c=[];;){var m=h.next(),w=m.done,R=m.value;if(w)break;var K=R[0],ee=R[1];K.split("_")[0]===b&&c.push(ee)}return c}function ce(b){var h=b.kernelName,c=b.backendName,m=ge(h,c);if(I.has(m))throw new Error("The kernel '"+h+"' for backend '"+c+"' is already registered");I.set(m,b)}function be(b){var h=b.kernelName;Z.has(h)&&console.warn("Overriding the gradient for '"+h+"'"),Z.set(h,b)}function Ee(b,h){var c=ge(b,h);if(!I.has(c))throw new Error("The kernel '"+b+"' for backend '"+h+"' is not registered");I.delete(c)}function ve(b){if(!Z.has(b))throw new Error("The gradient '"+b+"' for backend is not registered");Z.delete(b)}function ge(b,h){return h+"_"+b}function Ge(b){for(var h=b.length,c=0,m=0;h>0;)m=Math.random()*h|0,c=b[--h],b[h]=b[m],b[m]=c}function ht(b,h,c){return Math.max(b,Math.min(h,c))}function It(b){return b%2==0?b:b+1}function St(b){for(var h=0,c=0;c<b.length;c++)h+=b[c];return h}function we(b,h){if(!b)throw new Error(typeof h=="string"?h:h())}function bt(b,h,c){c===void 0&&(c=""),we(Ut(b,h),function(){return c+" Shapes "+b+" and "+h+" must match"})}function jt(b){we(b!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Mt(b,h,c){if(h===void 0&&(h=[]),c===void 0&&(c=!1),h==null&&(h=[]),Array.isArray(b)||ft(b)&&!c)for(var m=0;m<b.length;++m)Mt(b[m],h,c);else h.push(b);return h}function ze(b){if(b.length===0)return 1;for(var h=b[0],c=1;c<b.length;c++)h*=b[c];return h}function Ut(b,h){if(b===h)return!0;if(b==null||h==null||b.length!==h.length)return!1;for(var c=0;c<b.length;c++)if(b[c]!==h[c])return!1;return!0}function Ft(b){return b%1==0}function pt(b){if(Math.tanh!=null)return Math.tanh(b);if(b===1/0)return 1;if(b===-1/0)return-1;var h=Math.exp(2*b);return(h-1)/(h+1)}function yt(b){var h=Math.ceil(Math.sqrt(b));return[h,Math.ceil(b/h)]}function nn(b,h){return h<=b.length?b:b+" ".repeat(h-b.length)}function xt(b,h,c){return h===void 0&&(h=function(m){return 0}),new Promise(function(m,w){var R=0,K=function(){if(b())m();else{var ee=h(++R);c!=null&&R>=c?w():setTimeout(K,ee)}};K()})}function _t(b,h){for(var c=1,m=-1,w=0;w<b.length;++w)if(b[w]>=0)c*=b[w];else if(b[w]===-1){if(m!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+m+" and dim "+w);m=w}else if(b[w]<0)throw Error("Shapes can not be < 0. Found "+b[w]+" at dim "+w);if(m===-1){if(h>0&&h!==c)throw Error("Size("+h+") must match the product of shape "+b);return b}if(c===0)throw Error("Cannot infer the missing size in ["+b+"] when there are 0 elements");if(h%c!=0)throw Error("The implicit shape can't be a fractional number. Got "+h+" / "+c);var R=b.slice();return R[m]=h/c,R}function Yt(b,h){var c=h.length;return we((b=b==null?h.map(function(m,w){return w}):[].concat(b)).every(function(m){return m>=-c&&m<c}),function(){return"All values in axis param must be in range [-"+c+", "+c+") but got axis "+b}),we(b.every(function(m){return Ft(m)}),function(){return"All values in axis param must be integers but got axis "+b}),b.map(function(m){return m<0?c+m:m})}function Fn(b,h){for(var c=[],m=[],w=h!=null&&Array.isArray(h)&&h.length===0,R=h==null||w?null:Yt(h,b).sort(),K=0,ee=0;ee<b.length;++ee){if(R!=null){if(R[K]===ee&&b[ee]!==1)throw new Error("Can't squeeze axis "+ee+" since its dim '"+b[ee]+"' is not 1");(R[K]==null||R[K]>ee)&&b[ee]===1&&(c.push(b[ee]),m.push(ee)),R[K]<=ee&&K++}b[ee]!==1&&(c.push(b[ee]),m.push(ee))}return{newShape:c,keptDims:m}}function Rn(b,h){var c=null;if(b==null||b==="float32")c=new Float32Array(h);else if(b==="int32")c=new Int32Array(h);else{if(b!=="bool")throw new Error("Unknown data type "+b);c=new Uint8Array(h)}return c}function cn(b,h){var c=null;if(b==null||b==="float32")c=new Float32Array(h);else if(b==="int32")c=new Int32Array(h);else if(b==="bool")c=new Uint8Array(h);else{if(b!=="string")throw new Error("Unknown data type "+b);c=new Array(h)}return c}function qe(b,h){for(var c=0;c<b.length;c++){var m=b[c];if(isNaN(m)||!isFinite(m))throw Error("A tensor of type "+h+" being uploaded contains "+m+".")}}function Qe(b){return b==="bool"||b==="complex64"||b==="float32"||b==="int32"||b==="string"}function $e(b,h){return!(h==="complex64"||h==="float32"&&b!=="complex64"||h==="int32"&&b!=="float32"&&b!=="complex64"||h==="bool"&&b==="bool")}function ft(b){return b instanceof Float32Array||b instanceof Int32Array||b instanceof Uint8Array}function Jt(b){if(b==="float32"||b==="int32")return 4;if(b==="complex64")return 8;if(b==="bool")return 1;throw new Error("Unknown dtype "+b)}function Qt(b){if(b==null)return 0;var h=0;return b.forEach(function(c){return h+=c.length}),h}function Pn(b){return typeof b=="string"||b instanceof String}function kn(b){return typeof b=="boolean"}function Qn(b){return typeof b=="number"}function ke(b){return Array.isArray(b)?ke(b[0]):b instanceof Float32Array?"float32":b instanceof Int32Array||b instanceof Uint8Array?"int32":Qn(b)?"float32":Pn(b)?"string":kn(b)?"bool":"float32"}function ar(b){return!!(b&&b.constructor&&b.call&&b.apply)}function Tr(b,h){for(var c=h;c<b;++c)if(b%c==0)return c;return b}function rn(b){var h=b.length;if(h<2)return[];var c=new Array(h-1);c[h-2]=b[h-1];for(var m=h-3;m>=0;--m)c[m]=c[m+1]*b[m+1];return c}function Ht(b,h,c){if(h==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(b)&&(b=Mt(b)),c&&qe(b,h),function(R,K){return R instanceof Float32Array&&K==="float32"||R instanceof Int32Array&&K==="int32"||R instanceof Uint8Array&&K==="bool"}(b,h))return b;if(h==null||h==="float32"||h==="complex64")return new Float32Array(b);if(h==="int32")return new Int32Array(b);if(h==="bool"){for(var m=new Uint8Array(b.length),w=0;w<m.length;++w)Math.round(b[w])!==0&&(m[w]=1);return m}throw new Error("Unknown data type "+h)}function Gn(b,h){if(b.length===0)return h[0];var c=b.reduce(function(m,w){return m*w});if(c===0)return[];if(c!==h.length)throw new Error("["+b+"] does not match the input size.");return function m(w,R,K){var ee=new Array;if(R.length===1)for(var le=R[0],de=0;de<le;de++)ee[de]=K[w+de];else{le=R[0];var _e=R.slice(1),Te=_e.reduce(function(Ne,Fe){return Ne*Fe});for(de=0;de<le;de++)ee[de]=m(w+de*Te,_e,K)}return ee}(0,b,h)}function Xt(b,h){for(var c=Wt(b,h),m=0;m<c.length;m++)c[m]=1;return c}function Wt(b,h){if(h==null||h==="float32"||h==="complex64")return new Float32Array(b);if(h==="int32")return new Int32Array(b);if(h==="bool")return new Uint8Array(b);throw new Error("Unknown data type "+h)}function Zt(){return z().platform.now()}function Vn(b){b.forEach(function(h){we(Number.isInteger(h)&&h>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+b+"]."})})}function xn(b,h){return h===void 0&&(h="utf-8"),h=h||"utf-8",z().platform.encode(b,h)}function Un(b,h){return h===void 0&&(h="utf-8"),h=h||"utf-8",z().platform.decode(b,h)}function ur(b,h,c){if(h===0)return 0;if(h===1)return b[0];for(var m=b[b.length-1],w=0;w<b.length-1;++w)m+=c[w]*b[w];return m}function sr(b,h,c){if(h===0)return[];if(h===1)return[b];for(var m=new Array(h),w=0;w<m.length-1;++w)m[w]=Math.floor(b/c[w]),b-=m[w]*c[w];return m[m.length-1]=b,m}var Er=Object.freeze({shuffle:Ge,clamp:ht,nearestLargerEven:It,sum:St,randUniform:function(b,h){var c=Math.random();return h*c+(1-c)*b},distSquared:function(b,h){for(var c=0,m=0;m<b.length;m++){var w=Number(b[m])-Number(h[m]);c+=w*w}return c},assert:we,assertShapesMatch:bt,assertNonNull:jt,flatten:Mt,sizeFromShape:ze,isScalarShape:function(b){return b.length===0},arraysEqual:Ut,isInt:Ft,tanh:pt,sizeToSquarishShape:yt,createShuffledIndices:function(b){for(var h=new Uint32Array(b),c=0;c<b;++c)h[c]=c;return Ge(h),h},rightPad:nn,repeatedTry:xt,inferFromImplicitShape:_t,parseAxisParam:Yt,squeezeShape:Fn,getTypedArrayFromDType:Rn,getArrayFromDType:cn,checkConversionForErrors:qe,isValidDtype:Qe,hasEncodingLoss:$e,isTypedArray:ft,bytesPerElement:Jt,bytesFromStringArray:Qt,isString:Pn,isBoolean:kn,isNumber:Qn,inferDtype:ke,isFunction:ar,nearestDivisor:Tr,computeStrides:rn,toTypedArray:Ht,toNestedArray:Gn,makeOnesTypedArray:Xt,makeZerosTypedArray:Wt,now:Zt,assertNonNegativeIntegerDimensions:Vn,fetch:function(b,h){return z().platform.fetch(b,h)},encodeString:xn,decodeString:Un,locToIndex:ur,indexToLoc:sr}),Mr=function(){function b(h,c){this.backendTimer=h,this.logger=c,c==null&&(this.logger=new pr)}return b.prototype.profileKernel=function(h,c,m){var w,R=this,K=this.backendTimer.time(function(){w=m()});return w.forEach(function(ee){ee.data().then(function(le){(function(de,_e,Te){if(_e!=="float32")return!1;for(var Ne=0;Ne<de.length;Ne++){var Fe=de[Ne];if(isNaN(Fe)||!isFinite(Fe))return console.warn("Found "+Fe+" in the result of '"+Te+"'"),!0}})(le,ee.dtype,h),K.then(function(de){var _e="";de.getExtraProfileInfo!=null&&(_e=de.getExtraProfileInfo()),R.logger.logKernelProfile(h,ee,le,de.kernelMs,c,_e)})})}),w},b}(),pr=function(){function b(){}return b.prototype.logKernelProfile=function(h,c,m,w,R,K){var ee=typeof w=="number"?nn(w+"ms",9):w.error,le=nn(h,25),de=c.rank,_e=c.size,Te=nn(c.shape.toString(),14),Ne="";for(var Fe in R){var He=R[Fe].shape||c.shape,Ye=He.length;Ne+=Fe+": "+Ye+"D "+(Ye>0?He:"")+" "}console.log("%c"+le+"	%c"+ee+"	%c"+de+"D "+Te+"	%c"+_e+"	%c"+Ne+"	%c"+K,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},b}(),ri=20,Kr=3,ti=7;function jn(b,h,c){return nn(Array.isArray(b)?parseFloat(b[0].toFixed(ti))+" + "+parseFloat(b[1].toFixed(ti))+"j":Pn(b)?"'"+b+"'":c==="bool"?ir(b):parseFloat(b.toFixed(ti)).toString(),h)}function ir(b){return b===0?"false":"true"}function Cr(b){for(var h=[],c=0;c<b.length;c+=2)h.push([b[c],b[c+1]]);return h}var Hr=function(){function b(h,c,m){var w=this;if(this.dtype=c,this.shape=h.slice(),this.size=ze(h),m!=null){var R=m.length;we(R===this.size,function(){return"Length of values '"+R+"' does not match the size inferred by the shape '"+w.size+"'."})}if(c==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=m||cn(c,this.size),this.strides=rn(h)}return b.prototype.set=function(h){for(var c=this,m=[],w=1;w<arguments.length;w++)m[w-1]=arguments[w];m.length===0&&(m=[0]),we(m.length===this.rank,function(){return"The number of provided coordinates ("+m.length+") must match the rank ("+c.rank+")"});var R=this.locToIndex(m);this.values[R]=h},b.prototype.get=function(){for(var h=[],c=0;c<arguments.length;c++)h[c]=arguments[c];h.length===0&&(h=[0]);for(var m=0,w=0,R=h;w<R.length;w++){var K=R[w];if(K<0||K>=this.shape[m]){var ee="Requested out of range element at "+h+".   Buffer shape="+this.shape;throw new Error(ee)}m++}for(var le=h[h.length-1],de=0;de<h.length-1;++de)le+=this.strides[de]*h[de];return this.values[le]},b.prototype.locToIndex=function(h){if(this.rank===0)return 0;if(this.rank===1)return h[0];for(var c=h[h.length-1],m=0;m<h.length-1;++m)c+=this.strides[m]*h[m];return c},b.prototype.indexToLoc=function(h){if(this.rank===0)return[];if(this.rank===1)return[h];for(var c=new Array(this.shape.length),m=0;m<c.length-1;++m)c[m]=Math.floor(h/this.strides[m]),h-=c[m]*this.strides[m];return c[c.length-1]=h,c},Object.defineProperty(b.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),b.prototype.toTensor=function(){return qr().makeTensor(this.values,this.shape,this.dtype)},b}(),qr=null,Ot=null,Fr=null,$t=function(){function b(h,c,m,w){this.kept=!1,this.isDisposedInternal=!1,this.shape=h.slice(),this.dtype=c||"float32",this.size=ze(h),this.strides=rn(h),this.dataId=m,this.id=w,this.rankType=this.rank<5?this.rank.toString():"higher"}return b.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},b.prototype.asScalar=function(){return this.throwIfDisposed(),we(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},b.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},b.prototype.as2D=function(h,c){return this.throwIfDisposed(),this.reshape([h,c])},b.prototype.as3D=function(h,c,m){return this.throwIfDisposed(),this.reshape([h,c,m])},b.prototype.as4D=function(h,c,m,w){return this.throwIfDisposed(),this.reshape([h,c,m,w])},b.prototype.as5D=function(h,c,m,w,R){return this.throwIfDisposed(),this.reshape([h,c,m,w,R])},b.prototype.asType=function(h){return this.throwIfDisposed(),Ot.cast(this,h)},Object.defineProperty(b.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),b.prototype.buffer=function(){return N(this,void 0,void 0,function(){var h;return L(this,function(c){switch(c.label){case 0:return[4,this.data()];case 1:return h=c.sent(),[2,Ot.buffer(this.shape,this.dtype,h)]}})})},b.prototype.bufferSync=function(){return Ot.buffer(this.shape,this.dtype,this.dataSync())},b.prototype.array=function(){return N(this,void 0,void 0,function(){var h;return L(this,function(c){switch(c.label){case 0:return[4,this.data()];case 1:return h=c.sent(),[2,Gn(this.shape,h)]}})})},b.prototype.arraySync=function(){return Gn(this.shape,this.dataSync())},b.prototype.data=function(){return N(this,void 0,void 0,function(){var h,c;return L(this,function(m){switch(m.label){case 0:return this.throwIfDisposed(),h=qr().read(this.dataId),this.dtype!=="string"?[3,2]:[4,h];case 1:c=m.sent();try{return[2,c.map(function(w){return Un(w)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}m.label=2;case 2:return[2,h]}})})},b.prototype.dataSync=function(){this.throwIfDisposed();var h=qr().readSync(this.dataId);if(this.dtype==="string")try{return h.map(function(c){return Un(c)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return h},b.prototype.bytes=function(){return N(this,void 0,void 0,function(){var h;return L(this,function(c){switch(c.label){case 0:return this.throwIfDisposed(),[4,qr().read(this.dataId)];case 1:return h=c.sent(),this.dtype==="string"?[2,h]:[2,new Uint8Array(h.buffer)]}})})},b.prototype.dispose=function(){this.isDisposed||(qr().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(b.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),b.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},b.prototype.toFloat=function(){return this.asType("float32")},b.prototype.toInt=function(){return this.asType("int32")},b.prototype.toBool=function(){return this.asType("bool")},b.prototype.print=function(h){return h===void 0&&(h=!1),Ot.print(this,h)},b.prototype.reshape=function(h){return this.throwIfDisposed(),Ot.reshape(this,h)},b.prototype.reshapeAs=function(h){return this.throwIfDisposed(),this.reshape(h.shape)},b.prototype.expandDims=function(h){return h===void 0&&(h=0),Ot.expandDims(this,h)},b.prototype.cumsum=function(h,c,m){return h===void 0&&(h=0),c===void 0&&(c=!1),m===void 0&&(m=!1),Ot.cumsum(this,h,c,m)},b.prototype.squeeze=function(h){return this.throwIfDisposed(),Ot.squeeze(this,h)},b.prototype.clone=function(){return this.throwIfDisposed(),Ot.clone(this)},b.prototype.toString=function(h){return h===void 0&&(h=!1),function(c,m,w,R){var K=rn(m),ee=function(Te,Ne,Fe,He){var Ye=ze(Ne),Ke=He[He.length-1],it=new Array(Ke).fill(0),gt=Ne.length,wt=Fe==="complex64"?Cr(Te):Te;if(gt>1)for(var At=0;At<Ye/Ke;At++)for(var zt=At*Ke,an=0;an<Ke;an++)it[an]=Math.max(it[an],jn(wt[zt+an],0,Fe).length);return it}(c,m,w,K),le=m.length,de=function Te(Ne,Fe,He,Ye,Ke,it){it===void 0&&(it=!0);var gt=He==="complex64"?2:1,wt=Fe[0],At=Fe.length;if(At===0)return He==="complex64"?[jn(Cr(Ne)[0],0,He)]:He==="bool"?[ir(Ne[0])]:[Ne[0].toString()];if(At===1){if(wt>ri){var zt=Kr*gt,an=Array.from(Ne.slice(0,zt)),dn=Array.from(Ne.slice((wt-Kr)*gt,wt*gt));return He==="complex64"&&(an=Cr(an),dn=Cr(dn)),["["+an.map(function(xr,vr){return jn(xr,Ke[vr],He)}).join(", ")+", ..., "+dn.map(function(xr,vr){return jn(xr,Ke[wt-Kr+vr],He)}).join(", ")+"]"]}return["["+(He==="complex64"?Cr(Ne):Array.from(Ne)).map(function(xr,vr){return jn(xr,Ke[vr],He)}).join(", ")+"]"]}var sn=Fe.slice(1),ln=Ye.slice(1),Tn=Ye[0]*gt,Bn=[];if(wt>ri){for(var In=0;In<Kr;In++){var or=(fr=In*Tn)+Tn;Bn.push.apply(Bn,Te(Ne.slice(fr,or),sn,He,ln,Ke,!1))}for(Bn.push("..."),In=wt-Kr;In<wt;In++)or=(fr=In*Tn)+Tn,Bn.push.apply(Bn,Te(Ne.slice(fr,or),sn,He,ln,Ke,In===wt-1))}else for(In=0;In<wt;In++){var fr;or=(fr=In*Tn)+Tn,Bn.push.apply(Bn,Te(Ne.slice(fr,or),sn,He,ln,Ke,In===wt-1))}var br=At===2?",":"";for(Bn[0]="["+Bn[0]+br,In=1;In<Bn.length-1;In++)Bn[In]=" "+Bn[In]+br;var _r=`,
`;for(In=2;In<At;In++)_r+=`
`;return Bn[Bn.length-1]=" "+Bn[Bn.length-1]+"]"+(it?"":_r),Bn}(c,m,w,K,ee),_e=["Tensor"];return R&&(_e.push("  dtype: "+w),_e.push("  rank: "+le),_e.push("  shape: ["+m+"]"),_e.push("  values:")),_e.push(de.map(function(Te){return"    "+Te}).join(`
`)),_e.join(`
`)}(this.dataSync(),this.shape,this.dtype,h)},b.prototype.gather=function(h,c){return c===void 0&&(c=0),this.throwIfDisposed(),Ot.gather(this,h,c)},b.prototype.matMul=function(h,c,m){return c===void 0&&(c=!1),m===void 0&&(m=!1),this.throwIfDisposed(),Ot.matMul(this,h,c,m)},b.prototype.dot=function(h){return this.throwIfDisposed(),Ot.dot(this,h)},b.prototype.norm=function(h,c,m){return h===void 0&&(h="euclidean"),c===void 0&&(c=null),m===void 0&&(m=!1),this.throwIfDisposed(),Ot.norm(this,h,c,m)},b.prototype.slice=function(h,c){return this.throwIfDisposed(),Ot.slice(this,h,c)},b.prototype.reverse=function(h){return this.throwIfDisposed(),Ot.reverse(this,h)},b.prototype.concat=function(h,c){return c===void 0&&(c=0),this.throwIfDisposed(),h instanceof b&&(h=[h]),Ot.concat([this].concat(h),c)},b.prototype.split=function(h,c){return c===void 0&&(c=0),this.throwIfDisposed(),Ot.split(this,h,c)},b.prototype.stack=function(h,c){return c===void 0&&(c=0),Ot.stack([this,h],c)},b.prototype.unstack=function(h){return h===void 0&&(h=0),Ot.unstack(this,h)},b.prototype.batchNormalization=function(h,c,m,w,R){return m===void 0&&(m=.001),Fr("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(h,c,R,w,m)},b.prototype.all=function(h,c){return h===void 0&&(h=null),c===void 0&&(c=!1),this.throwIfDisposed(),Ot.all(this,h,c)},b.prototype.any=function(h,c){return h===void 0&&(h=null),c===void 0&&(c=!1),this.throwIfDisposed(),Ot.any(this,h,c)},b.prototype.logSumExp=function(h,c){return h===void 0&&(h=null),c===void 0&&(c=!1),this.throwIfDisposed(),Ot.logSumExp(this,h,c)},b.prototype.sum=function(h,c){return h===void 0&&(h=null),c===void 0&&(c=!1),this.throwIfDisposed(),Ot.sum(this,h,c)},b.prototype.prod=function(h,c){return h===void 0&&(h=null),c===void 0&&(c=!1),this.throwIfDisposed(),Ot.prod(this,h,c)},b.prototype.mean=function(h,c){return h===void 0&&(h=null),c===void 0&&(c=!1),this.throwIfDisposed(),Ot.mean(this,h,c)},b.prototype.min=function(h,c){return h===void 0&&(h=null),c===void 0&&(c=!1),this.throwIfDisposed(),Ot.min(this,h,c)},b.prototype.max=function(h,c){return h===void 0&&(h=null),c===void 0&&(c=!1),this.throwIfDisposed(),Ot.max(this,h,c)},b.prototype.argMin=function(h){return h===void 0&&(h=null),this.throwIfDisposed(),Ot.argMin(this,h)},b.prototype.argMax=function(h){return h===void 0&&(h=null),this.throwIfDisposed(),Ot.argMax(this,h)},b.prototype.cast=function(h){return this.throwIfDisposed(),Ot.cast(this,h)},b.prototype.addStrict=function(h){return this.throwIfDisposed(),Ot.addStrict(this,h)},b.prototype.atan2=function(h){return this.throwIfDisposed(),Ot.atan2(this,h)},b.prototype.sub=function(h){return this.throwIfDisposed(),Ot.sub(this,h)},b.prototype.subStrict=function(h){return this.throwIfDisposed(),Ot.subStrict(this,h)},b.prototype.pow=function(h){return this.throwIfDisposed(),Ot.pow(this,h)},b.prototype.powStrict=function(h){return this.throwIfDisposed(),Ot.powStrict(this,h)},b.prototype.mul=function(h){return this.throwIfDisposed(),Ot.mul(this,h)},b.prototype.mulStrict=function(h){return this.throwIfDisposed(),Ot.mulStrict(this,h)},b.prototype.floorDiv=function(h){return this.throwIfDisposed(),Ot.floorDiv(this,h)},b.prototype.divStrict=function(h){return this.throwIfDisposed(),Ot.divStrict(this,h)},b.prototype.minimum=function(h){return this.throwIfDisposed(),Ot.minimum(this,h)},b.prototype.minimumStrict=function(h){return this.throwIfDisposed(),Ot.minimumStrict(this,h)},b.prototype.maximum=function(h){return this.throwIfDisposed(),Ot.maximum(this,h)},b.prototype.maximumStrict=function(h){return this.throwIfDisposed(),Ot.maximumStrict(this,h)},b.prototype.mod=function(h){return this.throwIfDisposed(),Ot.mod(this,h)},b.prototype.modStrict=function(h){return this.throwIfDisposed(),Ot.modStrict(this,h)},b.prototype.squaredDifferenceStrict=function(h){return this.throwIfDisposed(),Ot.squaredDifferenceStrict(this,h)},b.prototype.notEqual=function(h){return this.throwIfDisposed(),Ot.notEqual(this,h)},b.prototype.notEqualStrict=function(h){return this.throwIfDisposed(),Ot.notEqualStrict(this,h)},b.prototype.less=function(h){return this.throwIfDisposed(),Ot.less(this,h)},b.prototype.lessStrict=function(h){return this.throwIfDisposed(),Ot.lessStrict(this,h)},b.prototype.equal=function(h){return this.throwIfDisposed(),Ot.equal(this,h)},b.prototype.equalStrict=function(h){return this.throwIfDisposed(),Ot.equalStrict(this,h)},b.prototype.lessEqual=function(h){return this.throwIfDisposed(),Ot.lessEqual(this,h)},b.prototype.lessEqualStrict=function(h){return this.throwIfDisposed(),Ot.lessEqualStrict(this,h)},b.prototype.greater=function(h){return this.throwIfDisposed(),Ot.greater(this,h)},b.prototype.greaterStrict=function(h){return this.throwIfDisposed(),Ot.greaterStrict(this,h)},b.prototype.greaterEqual=function(h){return this.throwIfDisposed(),Ot.greaterEqual(this,h)},b.prototype.greaterEqualStrict=function(h){return this.throwIfDisposed(),Ot.greaterEqualStrict(this,h)},b.prototype.logicalAnd=function(h){return this.throwIfDisposed(),Ot.logicalAnd(this,h)},b.prototype.logicalOr=function(h){return this.throwIfDisposed(),Ot.logicalOr(this,h)},b.prototype.logicalNot=function(){return this.throwIfDisposed(),Ot.logicalNot(this)},b.prototype.logicalXor=function(h){return this.throwIfDisposed(),Ot.logicalXor(this,h)},b.prototype.where=function(h,c){return this.throwIfDisposed(),Ot.where(h,this,c)},b.prototype.neg=function(){return this.throwIfDisposed(),Ot.neg(this)},b.prototype.ceil=function(){return this.throwIfDisposed(),Ot.ceil(this)},b.prototype.floor=function(){return this.throwIfDisposed(),Ot.floor(this)},b.prototype.sign=function(){return this.throwIfDisposed(),Ot.sign(this)},b.prototype.isNaN=function(){return this.throwIfDisposed(),Ot.isNaN(this)},b.prototype.isInf=function(){return this.throwIfDisposed(),Ot.isInf(this)},b.prototype.isFinite=function(){return this.throwIfDisposed(),Ot.isFinite(this)},b.prototype.exp=function(){return this.throwIfDisposed(),Ot.exp(this)},b.prototype.expm1=function(){return this.throwIfDisposed(),Ot.expm1(this)},b.prototype.log=function(){return this.throwIfDisposed(),Ot.log(this)},b.prototype.log1p=function(){return this.throwIfDisposed(),Ot.log1p(this)},b.prototype.sqrt=function(){return this.throwIfDisposed(),Ot.sqrt(this)},b.prototype.rsqrt=function(){return this.throwIfDisposed(),Ot.rsqrt(this)},b.prototype.square=function(){return this.throwIfDisposed(),Ot.square(this)},b.prototype.reciprocal=function(){return this.throwIfDisposed(),Ot.reciprocal(this)},b.prototype.abs=function(){return this.throwIfDisposed(),Ot.abs(this)},b.prototype.clipByValue=function(h,c){return this.throwIfDisposed(),Ot.clipByValue(this,h,c)},b.prototype.relu=function(){return this.throwIfDisposed(),Ot.relu(this)},b.prototype.relu6=function(){return this.throwIfDisposed(),Ot.relu6(this)},b.prototype.elu=function(){return this.throwIfDisposed(),Ot.elu(this)},b.prototype.selu=function(){return this.throwIfDisposed(),Ot.selu(this)},b.prototype.leakyRelu=function(h){return h===void 0&&(h=.2),this.throwIfDisposed(),Ot.leakyRelu(this,h)},b.prototype.prelu=function(h){return this.throwIfDisposed(),Ot.prelu(this,h)},b.prototype.sigmoid=function(){return this.throwIfDisposed(),Ot.sigmoid(this)},b.prototype.logSigmoid=function(){return this.throwIfDisposed(),Ot.logSigmoid(this)},b.prototype.softplus=function(){return this.throwIfDisposed(),Ot.softplus(this)},b.prototype.zerosLike=function(){return this.throwIfDisposed(),Ot.zerosLike(this)},b.prototype.onesLike=function(){return this.throwIfDisposed(),Ot.onesLike(this)},b.prototype.sin=function(){return this.throwIfDisposed(),Ot.sin(this)},b.prototype.cos=function(){return this.throwIfDisposed(),Ot.cos(this)},b.prototype.tan=function(){return this.throwIfDisposed(),Ot.tan(this)},b.prototype.asin=function(){return this.throwIfDisposed(),Ot.asin(this)},b.prototype.acos=function(){return this.throwIfDisposed(),Ot.acos(this)},b.prototype.atan=function(){return this.throwIfDisposed(),Ot.atan(this)},b.prototype.sinh=function(){return this.throwIfDisposed(),Ot.sinh(this)},b.prototype.cosh=function(){return this.throwIfDisposed(),Ot.cosh(this)},b.prototype.tanh=function(){return this.throwIfDisposed(),Ot.tanh(this)},b.prototype.asinh=function(){return this.throwIfDisposed(),Ot.asinh(this)},b.prototype.acosh=function(){return this.throwIfDisposed(),Ot.acosh(this)},b.prototype.atanh=function(){return this.throwIfDisposed(),Ot.atanh(this)},b.prototype.erf=function(){return this.throwIfDisposed(),Ot.erf(this)},b.prototype.round=function(){return this.throwIfDisposed(),Ot.round(this)},b.prototype.step=function(h){return h===void 0&&(h=0),this.throwIfDisposed(),Ot.step(this,h)},b.prototype.softmax=function(h){return h===void 0&&(h=-1),this.throwIfDisposed(),Ot.softmax(this,h)},b.prototype.logSoftmax=function(h){return h===void 0&&(h=-1),this.throwIfDisposed(),Ot.logSoftmax(this,h)},b.prototype.resizeBilinear=function(h,c){return c===void 0&&(c=!1),this.throwIfDisposed(),Ot.image.resizeBilinear(this,h,c)},b.prototype.resizeNearestNeighbor=function(h,c){return c===void 0&&(c=!1),this.throwIfDisposed(),Ot.image.resizeNearestNeighbor(this,h,c)},b.prototype.conv1d=function(h,c,m,w,R,K){return w===void 0&&(w="NWC"),R===void 0&&(R=1),this.throwIfDisposed(),Ot.conv1d(this,h,c,m,w,R,K)},b.prototype.conv2d=function(h,c,m,w,R,K){return w===void 0&&(w="NHWC"),R===void 0&&(R=[1,1]),this.throwIfDisposed(),Ot.conv2d(this,h,c,m,w,R,K)},b.prototype.conv2dTranspose=function(h,c,m,w,R){return this.throwIfDisposed(),Ot.conv2dTranspose(this,h,c,m,w,R)},b.prototype.depthwiseConv2D=function(h,c,m,w,R,K){return w===void 0&&(w="NHWC"),R===void 0&&(R=[1,1]),this.throwIfDisposed(),Ot.depthwiseConv2d(this,h,c,m,w,R,K)},b.prototype.separableConv2d=function(h,c,m,w,R,K){return R===void 0&&(R=[1,1]),K===void 0&&(K="NHWC"),this.throwIfDisposed(),Ot.separableConv2d(this,h,c,m,w,R,K)},b.prototype.avgPool=function(h,c,m,w){return this.throwIfDisposed(),Ot.avgPool(this,h,c,m,w)},b.prototype.maxPool=function(h,c,m,w){return this.throwIfDisposed(),Ot.maxPool(this,h,c,m,w)},b.prototype.localResponseNormalization=function(h,c,m,w){return h===void 0&&(h=5),c===void 0&&(c=1),m===void 0&&(m=1),w===void 0&&(w=.5),Ot.localResponseNormalization(this,h,c,m,w)},b.prototype.pool=function(h,c,m,w,R){return this.throwIfDisposed(),Ot.pool(this,h,c,m,w,R)},b.prototype.variable=function(h,c,m){return h===void 0&&(h=!0),this.throwIfDisposed(),qr().makeVariable(this,h,c,m)},b.prototype.unsortedSegmentSum=function(h,c){return this.throwIfDisposed(),Ot.unsortedSegmentSum(this,h,c)},b.prototype.batchToSpaceND=function(h,c){return this.throwIfDisposed(),Ot.batchToSpaceND(this,h,c)},b.prototype.spaceToBatchND=function(h,c){return this.throwIfDisposed(),Ot.spaceToBatchND(this,h,c)},b.prototype.topk=function(h,c){return h===void 0&&(h=1),c===void 0&&(c=!0),this.throwIfDisposed(),Ot.topk(this,h,c)},b.prototype.stridedSlice=function(h,c,m,w,R,K,ee,le){return w===void 0&&(w=0),R===void 0&&(R=0),K===void 0&&(K=0),ee===void 0&&(ee=0),le===void 0&&(le=0),this.throwIfDisposed(),Ot.stridedSlice(this,h,c,m,w,R,K,ee,le)},b.prototype.depthToSpace=function(h,c){return this.throwIfDisposed(),Ot.depthToSpace(this,h,c)},b.prototype.fft=function(){return this.throwIfDisposed(),Ot.spectral.fft(this)},b.prototype.ifft=function(){return this.throwIfDisposed(),Ot.spectral.ifft(this)},b.prototype.rfft=function(){return this.throwIfDisposed(),Ot.spectral.rfft(this)},b.prototype.irfft=function(){return this.throwIfDisposed(),Ot.spectral.irfft(this)},b}();Object.defineProperty($t,Symbol.hasInstance,{value:function(b){return!!b&&b.dataId!=null&&b.shape!=null&&b.dtype!=null}});var Se,me,Ce,Me,rt,kt=function(b){function h(c,m,w,R){var K=b.call(this,c.shape,c.dtype,c.dataId,R)||this;return K.trainable=m,K.name=w,K}return j(h,b),h.prototype.assign=function(c){if(c.dtype!==this.dtype)throw new Error("dtype of the new value ("+c.dtype+") and previous value ("+this.dtype+") must match");if(!Ut(c.shape,this.shape))throw new Error("shape of the new value ("+c.shape+") and previous value ("+this.shape+") must match");qr().disposeTensor(this),this.dataId=c.dataId,qr().incRef(this,null)},h.prototype.dispose=function(){qr().disposeVariable(this),this.isDisposedInternal=!0},h}($t);Object.defineProperty(kt,Symbol.hasInstance,{value:function(b){return b instanceof $t&&b.assign!=null&&b.assign instanceof Function}}),function(b){b.R0="R0",b.R1="R1",b.R2="R2",b.R3="R3",b.R4="R4",b.R5="R5",b.R6="R6"}(Se||(Se={})),function(b){b.float32="float32",b.int32="int32",b.bool="int32",b.complex64="complex64"}(me||(me={})),function(b){b.float32="float32",b.int32="int32",b.bool="bool",b.complex64="complex64"}(Ce||(Ce={})),function(b){b.float32="float32",b.int32="float32",b.bool="float32",b.complex64="complex64"}(Me||(Me={})),function(b){b.float32="complex64",b.int32="complex64",b.bool="complex64",b.complex64="complex64"}(rt||(rt={}));var en={float32:Me,int32:me,bool:Ce,complex64:rt};function En(b,h){if(b==="string"||h==="string"){if(b==="string"&&h==="string")return"string";throw new Error("Can not upcast "+b+" with "+h)}return en[b][h]}function Nt(b){return En(b,"int32")}function Kt(b,h){if(b.dtype===h.dtype)return[b,h];var c=En(b.dtype,h.dtype);return[b.cast(c),h.cast(c)]}function hn(b,h){we(b.dtype===h.dtype,function(){return"The dtypes of the first("+b.dtype+") and second("+h.dtype+") input must match"})}function un(b){var h=[];return function c(m,w,R){if(m!=null){if(m instanceof $t)w.push(m);else if(K=m,Array.isArray(K)||typeof K=="object"){var K,ee=m;for(var le in ee){var de=ee[le];R.has(de)||(R.add(de),c(de,w,R))}}}}(b,h,new Set),h}var mt,Tt=Object.freeze({makeTypesMatch:Kt,assertTypesMatch:hn,isTensorInList:function(b,h){return h.some(function(c){return c.id===b.id})},getTensorsInContainer:un}),fn=function(){function b(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return b.prototype.dispose=function(){for(var h in this.registeredVariables)this.registeredVariables[h].dispose()},b}(),tn=function(){function b(h){this.ENV=h,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new fn}return b.prototype.ready=function(){return N(this,void 0,void 0,function(){var h,c,m;return L(this,function(w){switch(w.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];h=this.getSortedBackends(),c=0,w.label=1;case 1:return c<h.length?(m=h[c],[4,this.initializeBackend(m).success]):[3,5];case 2:return w.sent()?[4,this.setBackend(m)]:[3,4];case 3:return w.sent(),[2];case 4:return c++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(b.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var h=this.initializeBackendsAndReturnBest(),c=h.name;if(h.asyncInit)throw new Error("The highest priority backend '"+c+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(c)}return this.backendInstance},enumerable:!0,configurable:!0}),b.prototype.backendNames=function(){return Object.keys(this.registryFactory)},b.prototype.findBackend=function(h){return!(h in this.registry)&&(!(h in this.registryFactory)||this.initializeBackend(h).asyncInit)?null:this.registry[h]},b.prototype.findBackendFactory=function(h){return h in this.registryFactory?this.registryFactory[h].factory:null},b.prototype.registerBackend=function(h,c,m){return m===void 0&&(m=1),h in this.registryFactory?(console.warn(h+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[h]={factory:c,priority:m},!0)},b.prototype.setBackend=function(h){return N(this,void 0,void 0,function(){var c,m,w;return L(this,function(R){switch(R.label){case 0:if(this.registryFactory[h]==null)throw new Error("Backend name '"+h+"' not found in registry");return this.backendName=h,this.registry[h]!=null?[3,4]:(this.backendInstance=null,c=this.initializeBackend(h),m=c.success,c.asyncInit?[4,m]:[3,2]);case 1:return w=R.sent(),[3,3];case 2:w=m,R.label=3;case 3:if(!w)return[2,!1];R.label=4;case 4:return this.backendInstance=this.registry[h],this.setupRegisteredKernels(),this.profiler=new Mr(this.backendInstance),[2,!0]}})})},b.prototype.setupRegisteredKernels=function(){var h=this;oe(this.backendName).forEach(function(c){c.setupFunc!=null&&c.setupFunc(h.backendInstance)})},b.prototype.disposeRegisteredKernels=function(h){var c=this;oe(h).forEach(function(m){m.disposeFunc!=null&&m.disposeFunc(c.registry[h])})},b.prototype.initializeBackend=function(h){var c=this,m=this.registryFactory[h];if(m==null)throw new Error("Cannot initialize backend "+h+", no registration found.");try{var w=m.factory();if(Promise.resolve(w)===w){var R=++this.pendingBackendInitId,K=w.then(function(ee){return!(R<c.pendingBackendInitId||(c.registry[h]=ee,c.pendingBackendInit=null,0))}).catch(function(ee){return!(R<c.pendingBackendInitId||(c.pendingBackendInit=null,console.warn("Initialization of backend "+h+" failed"),console.warn(ee.stack||ee.message),1))});return this.pendingBackendInit=K,{success:K,asyncInit:!0}}return this.registry[h]=w,{success:!0,asyncInit:!1}}catch(ee){return console.warn("Initialization of backend "+h+" failed"),console.warn(ee.stack||ee.message),{success:!1,asyncInit:!1}}},b.prototype.removeBackend=function(h){if(!(h in this.registryFactory))throw new Error(h+" backend not found in registry");this.backendName===h&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,h in this.registry&&(this.disposeRegisteredKernels(h),this.registry[h].dispose(),delete this.registry[h]),delete this.registryFactory[h],this.backendName===h&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},b.prototype.getSortedBackends=function(){var h=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(c,m){return h.registryFactory[m].priority-h.registryFactory[c].priority})},b.prototype.initializeBackendsAndReturnBest=function(){for(var h=this.getSortedBackends(),c=0;c<h.length;c++){var m=h[c],w=this.initializeBackend(m),R=w.success,K=w.asyncInit;if(K||R)return{name:m,asyncInit:K}}throw new Error("Could not initialize any backends, all backend initializations failed.")},b.prototype.moveData=function(h,c){var m=this.state.tensorInfo.get(c),w=m.backend,R=this.readSync(c);w.disposeData(c),m.backend=h,h.move(c,R,m.shape,m.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},b.prototype.tidy=function(h,c){var m,w=this,R=null;if(c==null){if(typeof h!="function")throw new Error("Please provide a function to tidy()");c=h}else{if(typeof h!="string"&&!(h instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof c!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");R=h}return this.scopedRun(function(){return w.startScope(R)},function(){return w.endScope(m)},function(){return(m=c())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),m})},b.prototype.scopedRun=function(h,c,m){h();try{var w=m();return c(),w}catch(R){throw c(),R}},b.prototype.nextTensorId=function(){return b.nextTensorId++},b.prototype.nextVariableId=function(){return b.nextVariableId++},b.prototype.clone=function(h){var c=this.makeTensorFromDataId(h.dataId,h.shape,h.dtype),m={x:h};return this.addTapeNode(this.state.activeScope.name,m,[c],function(w){return{x:function(){return w.toFloat()}}},[],{}),c},b.prototype.runKernel=function(h,c,m,w,R){return this.runKernelFunc(null,c,null,h,m,w,R)},b.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},b.prototype.checkKernelForMemLeak=function(h,c,m){var w=this.backend.numDataIds(),R=0;m.forEach(function(le){R+=le.dtype==="complex64"?3:1});var K=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],ee=w-c-R-K;if(ee>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+ee+" data ids) after running '"+h+"'")},b.prototype.runKernelFunc=function(h,c,m,w,R,K,ee){var le,de=this,_e=[],Te=this.isTapeOn();w==null&&(w=this.state.activeScope!=null?this.state.activeScope.name:"");var Ne,Fe=this.state.numBytes,He=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var Ye,Ke=Y(w,this.backendName);if(Ke!=null)Ne=function(){var gt=de.backend.numDataIds();Ye=Ke.kernelFunc({inputs:c,attrs:R,backend:de.backend});var wt=Array.isArray(Ye)?Ye:[Ye];de.shouldCheckForMemLeaks()&&de.checkKernelForMemLeak(w,gt,wt);var At=wt.map(function(dn){var sn=dn.dataId,ln=dn.shape,Tn=dn.dtype;return de.makeTensorFromDataId(sn,ln,Tn)});if(Te){var zt=de.getTensorsForGradient(w,c,At);if(zt==null){ee==null&&(ee=[]);var an=At.filter(function(dn,sn){return ee[sn]});zt=(K||[]).slice().concat(an)}_e=de.saveTensorsForBackwardMode(zt)}return At};else{var it=function(gt){Te&&(_e=gt.map(function(wt){return de.keep(de.clone(wt))}))};Ne=function(){var gt=de.backend.numDataIds();Ye=de.tidy(function(){return h(de.backend,it)});var wt=Array.isArray(Ye)?Ye:[Ye];return de.shouldCheckForMemLeaks()&&de.checkKernelForMemLeak(w,gt,wt),wt}}return this.scopedRun(function(){return de.state.kernelDepth++},function(){return de.state.kernelDepth--},function(){le=de.ENV.getBool("DEBUG")?de.profiler.profileKernel(w,c,function(){return Ne()}):Ne()}),Te&&this.addTapeNode(w,c,le,m,_e,R),this.state.profiling&&this.state.activeProfile.kernels.push({name:w,bytesAdded:this.state.numBytes-Fe,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-He,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(function(gt){return c[gt].shape}),outputShapes:le.map(function(gt){return gt.shape})}),Array.isArray(Ye)?le:le[0]},b.prototype.saveTensorsForBackwardMode=function(h){var c=this;return h.map(function(m){return c.keep(c.clone(m))})},b.prototype.getTensorsForGradient=function(h,c,m){var w=G(h);if(w!=null){var R=w.inputsToSave||[],K=w.outputsToSave||[],ee=void 0;w.saveAllInputs?(we(Array.isArray(c),function(){return"saveAllInputs is true, expected inputs to be an array."}),ee=Object.keys(c).map(function(de){return c[de]})):ee=R.map(function(de){return c[de]});var le=m.filter(function(de,_e){return K[_e]});return ee.concat(le)}return null},b.prototype.makeTensor=function(h,c,m,w){if(h==null)throw new Error("Values passed to engine.makeTensor() are null");m=m||"float32",w=w||this.backend;var R=h;m==="string"&&Pn(h[0])&&(R=h.map(function(_e){return xn(_e)}));var K=w.write(R,c,m),ee=new $t(c,m,K,this.nextTensorId());if(this.incRef(ee,w),m==="string"){var le=this.state.tensorInfo.get(K),de=Qt(R);this.state.numBytes+=de-le.bytes,le.bytes=de}return ee},b.prototype.makeTensorFromDataId=function(h,c,m,w){var R=new $t(c,m=m||"float32",h,this.nextTensorId());return this.incRef(R,w),R},b.prototype.makeVariable=function(h,c,m,w){c===void 0&&(c=!0),m=m||this.nextVariableId().toString(),w!=null&&w!==h.dtype&&(h=h.asType(w));var R=new kt(h,c,m,this.nextTensorId());if(this.state.registeredVariables[R.name]!=null)throw new Error("Variable with name "+R.name+" was already registered");return this.state.registeredVariables[R.name]=R,this.incRef(R,this.backend),R},b.prototype.incRef=function(h,c){var m=this.state.tensorInfo.has(h.dataId)?this.state.tensorInfo.get(h.dataId).refCount:0;if(this.state.numTensors++,h.dtype==="string"&&this.state.numStringTensors++,m===0){this.state.numDataBuffers++;var w=0;h.dtype!=="complex64"&&h.dtype!=="string"&&(w=h.size*Jt(h.dtype)),this.state.tensorInfo.set(h.dataId,{backend:c||this.backend,dtype:h.dtype,shape:h.shape,bytes:w,refCount:0}),this.state.numBytes+=w}this.state.tensorInfo.get(h.dataId).refCount++,h instanceof kt||this.track(h)},b.prototype.disposeTensor=function(h){if(this.state.tensorInfo.has(h.dataId)){this.state.numTensors--,h.dtype==="string"&&this.state.numStringTensors--;var c=this.state.tensorInfo.get(h.dataId);c.refCount<=1?(h.dtype!=="complex64"&&(this.state.numBytes-=c.bytes),this.state.numDataBuffers--,c.backend.disposeData(h.dataId),this.state.tensorInfo.delete(h.dataId)):this.state.tensorInfo.get(h.dataId).refCount--}},b.prototype.disposeVariables=function(){for(var h in this.state.registeredVariables){var c=this.state.registeredVariables[h];this.disposeVariable(c)}},b.prototype.disposeVariable=function(h){this.disposeTensor(h),this.state.registeredVariables[h.name]!=null&&delete this.state.registeredVariables[h.name]},b.prototype.memory=function(){var h=this.backend.memory();return h.numTensors=this.state.numTensors,h.numDataBuffers=this.state.numDataBuffers,h.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(h.unreliable=!0,h.reasons==null&&(h.reasons=[]),h.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),h},b.prototype.profile=function(h){return N(this,void 0,void 0,function(){var c,m;return L(this,function(w){return this.state.profiling=!0,c=this.state.numBytes,m=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=h(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(R){return R.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-c,this.state.activeProfile.newTensors=this.state.numTensors-m,[2,this.state.activeProfile]})})},b.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},b.prototype.addTapeNode=function(h,c,m,w,R,K){var ee=this,le={id:this.state.nextTapeNodeId++,kernelName:h,inputs:c,outputs:m,saved:R},de=G(h);de!=null&&(w=de.gradFunc),w!=null&&(le.gradient=function(_e){return _e=_e.map(function(Te,Ne){if(Te==null){var Fe=m[Ne],He=Wt(Fe.size,Fe.dtype);return ee.makeTensor(He,Fe.shape,Fe.dtype)}return Te}),w(_e.length>1?_e:_e[0],R,K)}),this.state.activeTape.push(le)},b.prototype.keep=function(h){return h.kept=!0,h},b.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},b.prototype.endTape=function(){this.state.gradientDepth--},b.prototype.startScope=function(h){var c={track:[],name:"unnamed scope",id:this.state.nextScopeId++};h&&(c.name=h),this.state.scopeStack.push(c),this.state.activeScope=c},b.prototype.endScope=function(h){for(var c=this,m=un(h),w=new Set(m.map(function(le){return le.id})),R=0;R<this.state.activeScope.track.length;R++){var K=this.state.activeScope.track[R];K.kept||w.has(K.id)||K.dispose()}var ee=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],m.forEach(function(le){le.kept||le.scopeId!==ee.id||c.track(le)})},b.prototype.gradients=function(h,c,m,w){var R=this;if(w===void 0&&(w=!1),we(c.length>0,function(){return"gradients() received an empty list of xs."}),m!=null&&m.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+m.dtype+"'");var K=this.scopedRun(function(){return R.startTape()},function(){return R.endTape()},function(){return R.tidy("forward",h)});we(K instanceof $t,function(){return"The result y returned by f() must be a tensor."});var ee=function(le,de,_e){for(var Te={},Ne={},Fe=0;Fe<de.length;Fe++)Te[de[Fe].id]=!0;for(Fe=0;Fe<le.length;Fe++){var He=(an=le[Fe]).inputs;for(var Ye in He){for(var Ke=He[Ye],it=!1,gt=0;gt<de.length;gt++)if(Te[Ke.id]){an.outputs.forEach(function(Tn){return Te[Tn.id]=!0}),it=!0,Ne[an.id]=!0;break}if(it)break}}var wt={};wt[_e.id]=!0;var At={};for(Fe=le.length-1;Fe>=0;Fe--)for(He=(an=le[Fe]).inputs,gt=0;gt<an.outputs.length;gt++)if(wt[an.outputs[gt].id]){for(var Ye in He)wt[He[Ye].id]=!0,At[an.id]=!0;break}var zt=[];for(Fe=0;Fe<le.length;Fe++){var an;if(Ne[(an=le[Fe]).id]&&At[an.id]){var dn={};for(var Ye in an.inputs){var sn=an.inputs[Ye];Te[sn.id]&&(dn[Ye]=sn)}var ln=Object.assign({},an);ln.inputs=dn,ln.outputs=an.outputs,zt.push(ln)}}return zt}(this.state.activeTape,c,K);if(!w&&ee.length===0&&c.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var le,de,_e={};_e[K.id]=m??(de=Xt(ze(le=K.shape),"float32"),Ve.makeTensor(de,le,"float32")),function(Ne,Fe,He){for(var Ye=function(it){var gt=Fe[it],wt=[];if(gt.outputs.forEach(function(dn){var sn=Ne[dn.id];sn!=null?wt.push(sn):wt.push(null)}),gt.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+gt.kernelName+".");var At=gt.gradient(wt),zt=function(dn){if(!(dn in At))throw new Error("Cannot backprop through input "+dn+". Available gradients found: "+Object.keys(At)+".");var sn=He(function(){return At[dn]()});if(sn.dtype!=="float32")throw new Error("Error in gradient for op "+gt.kernelName+". The gradient of input "+dn+" must have 'float32' dtype, but has '"+sn.dtype+"'");var ln=gt.inputs[dn];if(!Ut(sn.shape,ln.shape))throw new Error("Error in gradient for op "+gt.kernelName+". The gradient of input '"+dn+"' has shape '"+sn.shape+"', which does not match the shape of the input '"+ln.shape+"'");if(Ne[ln.id]==null)Ne[ln.id]=sn;else{var Tn=Ne[ln.id];Ne[ln.id]=Tn.add(sn),Tn.dispose()}};for(var an in gt.inputs)zt(an)},Ke=Fe.length-1;Ke>=0;Ke--)Ye(Ke)}(_e,ee,function(Ne){return R.tidy(Ne)});var Te=c.map(function(Ne){return _e[Ne.id]});return R.state.gradientDepth===0&&(R.state.activeTape.forEach(function(Ne){for(var Fe=0,He=Ne.saved;Fe<He.length;Fe++)He[Fe].dispose()}),R.state.activeTape=null),{value:K,grads:Te}})},b.prototype.customGrad=function(h){var c=this;return we(ar(h),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var m,w=[],R=0;R<arguments.length;R++)w[R]=arguments[R];we(w.every(function(ee){return ee instanceof $t}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var K={};return w.forEach(function(ee,le){K[le]=ee}),c.runKernelFunc(function(ee,le){return we((m=h.apply(void 0,w.concat([le]))).value instanceof $t,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),we(ar(m.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),m.value},K,function(ee,le){var de=m.gradFunc(ee,le),_e=Array.isArray(de)?de:[de];we(_e.length===w.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),we(_e.every(function(Ne){return Ne instanceof $t}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var Te={};return _e.forEach(function(Ne,Fe){Te[Fe]=function(){return Ne}}),Te})}},b.prototype.readSync=function(h){return this.state.tensorInfo.get(h).backend.readSync(h)},b.prototype.read=function(h){return this.state.tensorInfo.get(h).backend.read(h)},b.prototype.time=function(h){return N(this,void 0,void 0,function(){var c,m;return L(this,function(w){switch(w.label){case 0:return c=Zt(),[4,this.backend.time(h)];case 1:return(m=w.sent()).wallMs=Zt()-c,[2,m]}})})},b.prototype.track=function(h){return this.state.activeScope!=null&&(h.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(h)),h},Object.defineProperty(b.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),b.prototype.reset=function(){for(var h in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new fn,this.registry)this.disposeRegisteredKernels(h),this.registry[h].dispose(),delete this.registry[h];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},b.nextTensorId=0,b.nextVariableId=0,b}(),Ve=function(){var b=function(){if(mt==null){var c=void 0;if(typeof window<"u")c=window;else if(l!==void 0)c=l;else if(C!==void 0)c=C;else{if(typeof self>"u")throw new Error("Could not find a global object");c=self}mt=c}return mt}();if(b._tfengine==null){var h=new W(b);b._tfengine=new tn(h)}return function(c){q=c}(b._tfengine.ENV),qr=function(){return b._tfengine},b._tfengine}();function Ln(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Xn=z();Xn.registerFlag("DEBUG",function(){return!1},function(b){b&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Xn.registerFlag("IS_BROWSER",function(){return Ln()}),Xn.registerFlag("IS_NODE",function(){return C!==void 0&&C.versions!==void 0&&C.versions.node!==void 0}),Xn.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Xn.registerFlag("PROD",function(){return!1}),Xn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Xn.getBool("DEBUG")}),Xn.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Xn.registerFlag("IS_TEST",function(){return!1});var Zn,cr,Br,Sr={},yi={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function ki(b,h){Sr[b]=h}function Zr(b){b in Sr||(Sr[b]=function(c){if(c!==1&&c!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var m=function(w){if(typeof OffscreenCanvas<"u"&&w===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(c);return m.addEventListener("webglcontextlost",function(w){w.preventDefault(),delete Sr[c]},!1),c===1?m.getContext("webgl",yi)||m.getContext("experimental-webgl",yi):m.getContext("webgl2",yi)}(b));var h=Sr[b];return h.isContextLost()?(delete Sr[b],Zr(b)):(h.disable(h.DEPTH_TEST),h.disable(h.STENCIL_TEST),h.disable(h.BLEND),h.disable(h.DITHER),h.disable(h.POLYGON_OFFSET_FILL),h.disable(h.SAMPLE_COVERAGE),h.enable(h.SCISSOR_TEST),h.enable(h.CULL_FACE),h.cullFace(h.BACK),Sr[b])}function Zi(b,h){return[h,b]}function gi(b){var h=ze(b);return yt(Math.ceil(h/4))}function ei(b,h){return[Math.max(1,Math.ceil(h/2)),Math.max(1,Math.ceil(b/2))]}function Xr(b,h){var c,m,w,R,K,ee,le,de,_e,Te=b;return z().getNumber("WEBGL_VERSION")===2?(c=Te.R32F,m=Te.R16F,w=Te.RGBA16F,R=Te.RGBA32F,K=Te.RED,ee=4,le=1,de=Te.HALF_FLOAT,_e=Te.FLOAT):(c=b.RGBA,m=b.RGBA,w=b.RGBA,R=Te.RGBA,K=b.RGBA,ee=4,le=4,de=h!=null?h.HALF_FLOAT_OES:null,_e=b.FLOAT),{internalFormatFloat:c,internalFormatHalfFloat:m,internalFormatPackedHalfFloat:w,internalFormatPackedFloat:R,textureFormatFloat:K,downloadTextureFormat:b.RGBA,downloadUnpackNumChannels:ee,defaultNumChannels:le,textureTypeHalfFloat:de,textureTypeFloat:_e}}function Kn(b,h,c){var m=c();return h&&function(w){var R=w.getError();if(R!==w.NO_ERROR)throw new Error("WebGL Error: "+oo(w,R))}(b),m}(function(b){b[b.DENSE=0]="DENSE",b[b.SHARED_BATCH=1]="SHARED_BATCH"})(Zn||(Zn={})),function(b){b[b.RENDER=0]="RENDER",b[b.UPLOAD=1]="UPLOAD",b[b.PIXELS=2]="PIXELS",b[b.DOWNLOAD=3]="DOWNLOAD"}(cr||(cr={})),function(b){b[b.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",b[b.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",b[b.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",b[b.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",b[b.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Br||(Br={}));var di=596e-10,Ei=65504;function zr(b){return!!(z().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||b===0||di<Math.abs(b)&&Math.abs(b)<Ei)}function oo(b,h){switch(h){case b.NO_ERROR:return"NO_ERROR";case b.INVALID_ENUM:return"INVALID_ENUM";case b.INVALID_VALUE:return"INVALID_VALUE";case b.INVALID_OPERATION:return"INVALID_OPERATION";case b.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case b.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case b.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+h}}function zi(b,h,c){return ga(b,h,function(){return b.getExtension(c)},'Extension "'+c+'" not supported on this browser.')}function eo(b,h,c){var m=ga(b,h,function(){return b.createShader(b.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Kn(b,h,function(){return b.shaderSource(m,c)}),Kn(b,h,function(){return b.compileShader(m)}),b.getShaderParameter(m,b.COMPILE_STATUS)===!1)throw console.log(b.getShaderInfoLog(m)),new Error("Failed to compile vertex shader.");return m}function wo(b,h,c){var m=ga(b,h,function(){return b.createShader(b.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Kn(b,h,function(){return b.shaderSource(m,c)}),Kn(b,h,function(){return b.compileShader(m)}),b.getShaderParameter(m,b.COMPILE_STATUS)===!1)throw function(w,R){var K=xh.exec(R);if(K==null)return console.log("Couldn't parse line number in error: "+R),void console.log(w);for(var ee=+K[1],le=w.split(`
`),de=le.length.toString().length+2,_e=le.map(function(Ke,it){return nn((it+1).toString(),de)+Ke}),Te=0,Ne=0;Ne<_e.length;Ne++)Te=Math.max(_e[Ne].length,Te);var Fe=_e.slice(0,ee-1),He=_e.slice(ee-1,ee),Ye=_e.slice(ee);console.log(Fe.join(`
`)),console.log(R.split(`
`)[0]),console.log("%c "+nn(He[0],Te),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(Ye.join(`
`))}(c,b.getShaderInfoLog(m)),new Error("Failed to compile fragment shader.");return m}var ba,Ts,xh=/ERROR: [0-9]+:([0-9]+):/g;function to(b,h){return ga(b,h,function(){return b.createProgram()},"Unable to create WebGLProgram.")}function Cc(b,h,c){if(Kn(b,h,function(){return b.linkProgram(c)}),b.getProgramParameter(c,b.LINK_STATUS)===!1)throw console.log(b.getProgramInfoLog(c)),new Error("Failed to link vertex and fragment shaders.")}function Uu(b,h,c){if(Kn(b,h,function(){return b.validateProgram(c)}),b.getProgramParameter(c,b.VALIDATE_STATUS)===!1)throw console.log(b.getProgramInfoLog(c)),new Error("Shader program validation failed.")}function Yc(b,h,c){var m=ga(b,h,function(){return b.createBuffer()},"Unable to create WebGLBuffer");return Kn(b,h,function(){return b.bindBuffer(b.ARRAY_BUFFER,m)}),Kn(b,h,function(){return b.bufferData(b.ARRAY_BUFFER,c,b.STATIC_DRAW)}),m}function sc(b,h,c){var m=ga(b,h,function(){return b.createBuffer()},"Unable to create WebGLBuffer");return Kn(b,h,function(){return b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,m)}),Kn(b,h,function(){return b.bufferData(b.ELEMENT_ARRAY_BUFFER,c,b.STATIC_DRAW)}),m}function Jc(b,h){return ga(b,h,function(){return b.createTexture()},"Unable to create WebGLTexture.")}function Rp(b,h){var c=z().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(b<=0||h<=0){var m="["+b+"x"+h+"]";throw new Error("Requested texture size "+m+" is invalid.")}if(b>c||h>c)throw m="["+b+"x"+h+"]",new Error("Requested texture size "+m+" greater than WebGL maximum on this browser / GPU ["+c+"x"+c+"].")}function ys(b,h){return ga(b,h,function(){return b.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function sd(b,h,c,m,w,R,K,ee){var le=b.getAttribLocation(c,m);return le!==-1&&(Kn(b,h,function(){return b.bindBuffer(b.ARRAY_BUFFER,w)}),Kn(b,h,function(){return b.vertexAttribPointer(le,R,b.FLOAT,!1,K,ee)}),Kn(b,h,function(){return b.enableVertexAttribArray(le)}),!0)}function Pp(b,h,c,m){Ac(b,m),Kn(b,h,function(){return b.activeTexture(b.TEXTURE0+m)}),Kn(b,h,function(){return b.bindTexture(b.TEXTURE_2D,c)})}function uc(b,h,c,m){return ga(b,h,function(){return b.getUniformLocation(c,m)},'uniform "'+m+'" not present in program.')}function ud(b,h,c){return b.getUniformLocation(h,c)}function wh(b,h,c,m,w,R){Kn(b,h,function(){return Pp(b,h,m,R)}),Kn(b,h,function(){return b.uniform1i(w,R)})}function Qc(b,h,c,m){Kn(b,h,function(){return b.bindFramebuffer(b.FRAMEBUFFER,m)}),Kn(b,h,function(){return b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,c,0)})}function uf(b,h,c){Kn(b,h,function(){return b.bindFramebuffer(b.FRAMEBUFFER,c)}),Kn(b,h,function(){return b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0)})}function Ua(b){var h=b.checkFramebufferStatus(b.FRAMEBUFFER);if(h!==b.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Sl(b,h))}function Sl(b,h){switch(h){case b.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case b.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case b.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case b.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+h}}function ga(b,h,c,m){var w=Kn(b,h,function(){return c()});if(w==null)throw new Error(m);return w}function Ac(b,h){var c=b.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,m=h+b.TEXTURE0;if(m<b.TEXTURE0||m>c)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+c+"].")}function bs(b,h){return h===void 0&&(h=2),ze(b.slice(0,b.length-h))}function Fa(b){if(b.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[b.length>1?b[b.length-2]:1,b[b.length-1]]}function Oc(b){var h=[1,1,1];return b.length===0||b.length===1&&b[0]===1||(h=[bs(b)].concat(Fa(b))),h}function cf(b,h){var c;h===void 0&&(h=!1);var m=z().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(h&&(m*=2,(b=b.map(function(de,_e){return _e>=b.length-2?It(b[_e]):b[_e]})).length===1&&(b=[2,b[0]])),b.length!==2){var w=Fn(b);b=w.newShape}var R=ze(b);if(b.length<=1&&R<=m)return[1,R];if(b.length===2&&b[0]<=m&&b[1]<=m)return b;if(b.length===3&&b[0]*b[1]<=m&&b[2]<=m)return[b[0]*b[1],b[2]];if(b.length===3&&b[0]<=m&&b[1]*b[2]<=m)return[b[0],b[1]*b[2]];if(b.length===4&&b[0]*b[1]*b[2]<=m&&b[3]<=m)return[b[0]*b[1]*b[2],b[3]];if(b.length===4&&b[0]<=m&&b[1]*b[2]*b[3]<=m)return[b[0],b[1]*b[2]*b[3]];if(h){var K=bs(b),ee=2,le=2;return b.length&&(ee=(c=Fa(b))[0],le=c[1]),yt(R=K*(ee/2)*(le/2)).map(function(de){return 2*de})}return yt(R)}function Tc(b){return b%2==0}function Mu(b,h){if(Ut(b=b.slice(-2),h=h.slice(-2))||!b.length||!h.length||b[0]===0||b[1]===0||h[0]===0||h[1]===0)return!0;if(b.length!==h.length){var c=b.slice(-1)[0],m=h.slice(-1)[0];if(c===m||Tc(c)&&Tc(m)&&(b[0]===1||h[0]===1))return!0}return b[1]===h[1]&&Tc(b[0])&&Tc(h[0])}function _h(b){if(ba==null){var h=Zr(b);ba=h.getParameter(h.MAX_TEXTURE_SIZE)}return ba}function cd(b){if(Ts==null){var h=Zr(b);Ts=h.getParameter(h.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Ts)}function ld(b){if(b===0)return 0;var h=Zr(b);return xa(h,"EXT_disjoint_timer_query_webgl2")&&b===2?2:xa(h,"EXT_disjoint_timer_query")?1:0}function xa(b,h){return b.getExtension(h)!=null}function Eh(b){try{if(Zr(b)!=null)return!0}catch{return!1}return!1}function Lp(b){if(b===0)return!1;var h=Zr(b);if(b===1){if(!xa(h,"OES_texture_float"))return!1}else if(!xa(h,"EXT_color_buffer_float"))return!1;return dd(h)}function fd(b){if(b===0)return!1;var h=Zr(b);return b!==1?xa(h,"EXT_color_buffer_float")?dd(h):!!xa(h,"EXT_color_buffer_half_float")&&function(c,m){var w=Xr(c,m),R=c.createTexture();c.bindTexture(c.TEXTURE_2D,R),c.texImage2D(c.TEXTURE_2D,0,w.internalFormatHalfFloat,1,1,0,w.textureFormatFloat,w.textureTypeHalfFloat,null);var K=c.createFramebuffer();c.bindFramebuffer(c.FRAMEBUFFER,K),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,R,0);var ee=c.checkFramebufferStatus(c.FRAMEBUFFER)===c.FRAMEBUFFER_COMPLETE;return c.bindTexture(c.TEXTURE_2D,null),c.bindFramebuffer(c.FRAMEBUFFER,null),c.deleteTexture(R),c.deleteFramebuffer(K),ee}(h,h.getExtension("EXT_color_buffer_half_float")):!!xa(h,"OES_texture_float")&&!!xa(h,"WEBGL_color_buffer_float")&&dd(h)}function dd(b){var h=Xr(b),c=b.createTexture();b.bindTexture(b.TEXTURE_2D,c),b.texImage2D(b.TEXTURE_2D,0,h.internalFormatFloat,1,1,0,h.textureFormatFloat,h.textureTypeFloat,null);var m=b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,m),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,c,0);var w=b.checkFramebufferStatus(b.FRAMEBUFFER)===b.FRAMEBUFFER_COMPLETE;return b.bindTexture(b.TEXTURE_2D,null),b.bindFramebuffer(b.FRAMEBUFFER,null),b.deleteTexture(c),b.deleteFramebuffer(m),w}function Ms(b){return b===2&&Zr(b).fenceSync!=null}var hd=Object.freeze({callAndCheck:Kn,canBeRepresented:zr,getWebGLErrorMessage:oo,getExtensionOrThrow:zi,createVertexShader:eo,createFragmentShader:wo,createProgram:to,linkProgram:Cc,validateProgram:Uu,createStaticVertexBuffer:Yc,createStaticIndexBuffer:sc,getNumChannels:function(){return z().getNumber("WEBGL_VERSION")===2?1:4},createTexture:Jc,validateTextureSize:Rp,createFramebuffer:ys,bindVertexBufferToProgramAttribute:sd,bindTextureUnit:Pp,unbindTextureUnit:function(b,h,c){Ac(b,c),Kn(b,h,function(){return b.activeTexture(b.TEXTURE0+c)}),Kn(b,h,function(){return b.bindTexture(b.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:uc,getProgramUniformLocation:ud,bindTextureToProgramUniformSampler:wh,bindCanvasToFramebuffer:function(b,h){Kn(b,h,function(){return b.bindFramebuffer(b.FRAMEBUFFER,null)}),Kn(b,h,function(){return b.viewport(0,0,b.canvas.width,b.canvas.height)}),Kn(b,h,function(){return b.scissor(0,0,b.canvas.width,b.canvas.height)})},bindColorTextureToFramebuffer:Qc,unbindColorTextureFromFramebuffer:uf,validateFramebuffer:Ua,getFramebufferErrorMessage:Sl,getBatchDim:bs,getRowsCols:Fa,getShapeAs3D:Oc,getTextureShapeFromLogicalShape:cf,isReshapeFree:Mu,getWebGLMaxTextureSize:_h,resetMaxTextureSize:function(){ba=null},resetMaxTexturesInShader:function(){Ts=null},getMaxTexturesInShader:cd,getWebGLDisjointQueryTimerVersion:ld,hasExtension:xa,isWebGLVersionEnabled:Eh,isCapableOfRenderingToFloatTexture:Lp,isDownloadFloatTextureEnabled:fd,isWebGLFenceEnabled:Ms}),yr=z();function Wu(){z().set("PROD",!0)}function $m(){z().set("DEBUG",!0)}function Xm(){z().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function pd(b){z().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(b+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function lf(){Ve.disposeVariables()}function Bp(){return Ve}function Sh(){return Ve.memory()}function kh(b){return Ve.profile(b)}function Hi(b,h){return Ve.tidy(b,h)}function Lo(b){un(b).forEach(function(h){return h.dispose()})}function Ch(b){return Ve.keep(b)}function Gg(b){return Ve.time(b)}function md(b){return Ve.setBackend(b)}function jp(){return Ve.ready()}function Ds(){return Ve.backendName}function Mc(b){Ve.removeBackend(b)}function zp(b){return Ve.findBackend(b)}function Km(b){return Ve.findBackendFactory(b)}function Ym(b,h,c){return c===void 0&&(c=1),Ve.registerBackend(b,h,c)}function qg(){return Ve.backend}function $g(b,h){z().setPlatform(b,h)}function kl(){for(var b=[],h=0;h<arguments.length;h++)b[h]=arguments[h];z().getBool("IS_TEST")||console.warn.apply(console,b)}function Ka(b,h){var c=b;if(ft(b))return h==="string"?[]:[b.length];if(!Array.isArray(b))return[];for(var m=[];Array.isArray(c)||ft(c)&&h!=="string";)m.push(c.length),c=c[0];return Array.isArray(b)&&z().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function w(R,K,ee){if(ee=ee||[],Array.isArray(R)||ft(R)){we(K.length>0,function(){return"Element arr["+ee.join("][")+"] should be a primitive, but is an array of "+R.length+" elements"}),we(R.length===K[0],function(){return"Element arr["+ee.join("][")+"] should have "+K[0]+" elements, but has "+R.length+" elements"});for(var le=K.slice(1),de=0;de<R.length;++de)w(R[de],le,ee.concat(de))}else we(K.length===0,function(){return"Element arr["+ee.join("][")+"] is a primitive, but should be an array/TypedArray of "+K[0]+" elements"})}(b,m,[]),m}function Ah(b,h,c,m){if(b!=null&&(b!=="numeric"&&b!==h||b==="numeric"&&h==="string"))throw new Error("Argument '"+c+"' passed to '"+m+"' must be "+b+" tensor, but got "+h+" tensor")}function Ze(b,h,c,m){if(m===void 0&&(m="numeric"),b instanceof $t)return Ah(m,b.dtype,h,c),b;var w=ke(b);if(w!=="string"&&["bool","int32","float32"].indexOf(m)>=0&&(w=m),Ah(m,w,h,c),b==null||!ft(b)&&!Array.isArray(b)&&typeof b!="number"&&typeof b!="boolean"&&typeof b!="string"){var R=b==null?"null":b.constructor.name;throw new Error("Argument '"+h+"' passed to '"+c+"' must be a Tensor or TensorLike, but got '"+R+"'")}var K=Ka(b,w);ft(b)||Array.isArray(b)||(b=[b]);var ee=w!=="string"?Ht(b,w,z().getBool("DEBUG")):Mt(b,[],!0);return Ve.makeTensor(ee,K,w)}function cc(b,h,c,m){if(m===void 0&&(m="numeric"),!Array.isArray(b))throw new Error("Argument "+h+" passed to "+c+" must be a `Tensor[]` or `TensorLike[]`");return b.map(function(w,R){return Ze(w,h+"["+R+"]",c)},m)}function gd(b,h){for(var c=0;c<b.length;++c)if(b[b.length-c-1]!==h-1-c)return!1;return!0}function Up(b,h,c){for(var m=b.length+h.length,w=[],R=0,K=0,ee=0;ee<m;ee++)c.indexOf(ee)===-1?w.push(b[R++]):w.push(h[K++]);return w}function Io(b,h){for(var c=[],m=b.length,w=0;w<m;w++)h.indexOf(w)===-1&&c.push(b[w]);return[c,h.map(function(R){return b[R]})]}function Fo(b,h){return Up(b,h.map(function(c){return 1}),h)}function ta(b,h,c){we(gd(h,c),function(){return b+" supports only inner-most axes for now. Got axes "+h+" and rank-"+c+" input."})}function Ra(b,h){if(gd(b,h))return null;for(var c=[],m=0;m<h;++m)b.indexOf(m)===-1&&c.push(m);return b.forEach(function(w){return c.push(w)}),c}function Vu(b){return b.map(function(h,c){return[c,h]}).sort(function(h,c){return h[1]-c[1]}).map(function(h){return h[0]})}function Pa(b,h){for(var c=[],m=h-b;m<h;++m)c.push(m);return c}function Zc(b,h){var c=b[0].length;b.forEach(function(w,R){we(w.length===c,function(){return"Error in concat"+c+"D: rank of tensors["+R+"] must be the same as the rank of the rest ("+c+")"})}),we(h>=0&&h<c,function(){return"Error in concat"+c+"D: axis must be between 0 and "+(c-1)+"."});var m=b[0];b.forEach(function(w,R){for(var K=0;K<c;K++)we(K===h||w[K]===m[K],function(){return"Error in concat"+c+"D: Shape of tensors["+R+"] ("+w+") does not match the shape of the rest ("+m+") along the non-concatenated axis "+R+"."})})}function bu(b,h){for(var c=b[0].slice(),m=1;m<b.length;m++)c[h]+=b[m][h];return c}function Pt(b){var h=Object.keys(b);if(h.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+h.length+" keys.");var c=h[0],m=b[c];c.endsWith("_")&&(c=c.substring(0,c.length-1));var w=function(){for(var R=[],K=0;K<arguments.length;K++)R[K]=arguments[K];Ve.startScope(c);try{var ee=m.apply(void 0,R);return ee instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Ve.endScope(ee),ee}catch(le){throw Ve.endScope(null),le}};return Object.defineProperty(w,"name",{value:c,configurable:!0}),w}yr.registerFlag("HAS_WEBGL",function(){return yr.getNumber("WEBGL_VERSION")>0}),yr.registerFlag("WEBGL_VERSION",function(){return Eh(2)?2:Eh(1)?1:0}),yr.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return yr.get("WEBGL_VERSION")===2}),yr.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),yr.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),yr.registerFlag("WEBGL_PACK",function(){return yr.getBool("HAS_WEBGL")}),yr.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return yr.getBool("WEBGL_PACK")}),yr.registerFlag("WEBGL_PACK_CLIP",function(){return yr.getBool("WEBGL_PACK")}),yr.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),yr.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return yr.getBool("WEBGL_PACK")}),yr.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return yr.getBool("WEBGL_PACK")}),yr.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return yr.getBool("WEBGL_PACK")}),yr.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return yr.getBool("WEBGL_PACK")}),yr.registerFlag("WEBGL_PACK_REDUCE",function(){return yr.getBool("WEBGL_PACK")}),yr.registerFlag("WEBGL_LAZILY_UNPACK",function(){return yr.getBool("WEBGL_PACK")}),yr.registerFlag("WEBGL_CONV_IM2COL",function(){return yr.getBool("WEBGL_PACK")}),yr.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return _h(yr.getNumber("WEBGL_VERSION"))}),yr.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return cd(yr.getNumber("WEBGL_VERSION"))}),yr.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var b=yr.getNumber("WEBGL_VERSION");return b===0?0:ld(b)}),yr.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return yr.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(b=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4))));var b}),yr.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return Lp(yr.getNumber("WEBGL_VERSION"))}),yr.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!yr.getBool("WEBGL_FORCE_F16_TEXTURES")&&yr.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),yr.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return fd(yr.getNumber("WEBGL_VERSION"))}),yr.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return Ms(yr.getNumber("WEBGL_VERSION"))}),yr.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return yr.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),Fr=pd;var _o=Pt({complex_:function(b,h){var c=Ze(b,"real","complex"),m=Ze(h,"imag","complex");return bt(c.shape,m.shape,"real and imag shapes, "+c.shape+" and "+m.shape+", must match in call to tf.complex()."),Ve.runKernelFunc(function(w){return w.complex(c,m)},{$real:c,$imag:m})}}),va=Pt({real_:function(b){var h=Ze(b,"input","real");return Ve.runKernelFunc(function(c){return c.real(h)},{$input:h})}}),Ya=Pt({imag_:function(b){var h=Ze(b,"input","imag");return Ve.runKernelFunc(function(c){return c.imag(h)},{$input:h})}});function To(b,h,c){return Ns(b,h,Ka(b,c),c)}function Ns(b,h,c,m){if(m==null&&(m=ke(b)),m==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!ft(b)&&!Array.isArray(b)&&typeof b!="number"&&typeof b!="boolean"&&typeof b!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(h!=null){Vn(h);var w=ze(h),R=ze(c);we(w===R,function(){return"Based on the provided shape, ["+h+"], the tensor should have "+w+" values but has "+R});for(var K=0;K<c.length;++K){var ee=c[K],le=K!==c.length-1||ee!==ze(h.slice(K));we(c[K]===h[K]||!le,function(){return"Error creating a new Tensor. Inferred shape ("+c+") does not match the provided shape ("+h+"). "})}}return ft(b)||Array.isArray(b)||(b=[b]),h=h||c,b=m!=="string"?Ht(b,m,z().getBool("DEBUG")):Mt(b,[],!0),Ve.makeTensor(b,h,m)}function kr(b,h){if((ft(b)&&h!=="string"||Array.isArray(b))&&h!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(h==="string"&&ft(b)&&!(b instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Ns(b,[],[],h)}function ru(b,h){jt(b);var c=Ka(b,h);if(c.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Ns(b,null,c,h)}function xu(b,h,c){if(jt(b),h!=null&&h.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var m=Ka(b,c);if(m.length!==2&&m.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(m.length===1&&h==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Ns(b,h,m,c)}function Cl(b,h,c){if(jt(b),h!=null&&h.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var m=Ka(b,c);if(m.length!==3&&m.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(m.length===1&&h==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Ns(b,h,m,c)}function iu(b,h,c){if(jt(b),h!=null&&h.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var m=Ka(b,c);if(m.length!==4&&m.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(m.length===1&&h==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Ns(b,h,m,c)}function Oh(b,h,c){if(jt(b),h!=null&&h.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var m=Ka(b,c);if(m.length!==5&&m.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(m.length===1&&h==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Ns(b,h,m,c)}function Wp(b,h,c){if(jt(b),h!=null&&h.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var m=Ka(b,c);if(m.length!==6&&m.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(m.length===1&&h==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Ns(b,h=h||m,m,c)}function Vp(b,h,c,m){return h===void 0&&(h=!0),Ve.makeVariable(b,h,c,m)}function Du(b,h){if(h===void 0&&(h="float32"),h==="complex64"){var c=Du(b,"float32"),m=ao(b,"float32");return _o(c,m)}var w=Xt(ze(b),h);return Ve.makeTensor(w,b,h)}function ao(b,h){if(h===void 0&&(h="float32"),h==="complex64"){var c=ao(b,"float32"),m=ao(b,"float32");return _o(c,m)}var w=Wt(ze(b),h);return Ve.makeTensor(w,b,h)}function Is(b,h,c){return Ve.runKernelFunc(function(m){return m.fill(b,h,c)},{})}function Th(b,h,c){if(c<=0)throw new Error("The number of values should be positive.");return Ve.runKernelFunc(function(m){return m.linspace(b,h,c)},{})}function Dc(b,h,c,m){if(c===void 0&&(c=1),m===void 0&&(m="float32"),c===0)throw new Error("Cannot have a step of zero");if(b===h||b<h&&c<0||h<b&&c>1)return ao([0],m);var w=Wt(Math.abs(Math.ceil((h-b)/c)),m);h<b&&c===1&&(c=-1),w[0]=b;for(var R=1;R<w.length;R++)w[R]=w[R-1]+c;return ru(w,m)}var xs=Pt({onesLike_:function(b){var h=Ze(b,"x","onesLike");if(h.dtype==="complex64"){var c=xs(va(h)),m=mi(Ya(h));return _o(c,m)}return Ve.runKernelFunc(function(w){return w.onesLike(h)},{x:h},function(w,R){return{x:function(){return mi(w)}}},"OnesLike")}}),mi=Pt({zerosLike_:function(b){var h=Ze(b,"x","zerosLike");return Ve.runKernelFunc(function(c){return c.zerosLike(h)},{x:h},function(c,m){return{x:function(){return mi(c)}}},"ZerosLike")}}),Ho=Pt({concat_:function(b,h){h===void 0&&(h=0),we(b.length>=1,function(){return"Pass at least one tensor to concat"});var c=cc(b,"tensors","concat");c[0].dtype==="complex64"&&c.forEach(function(ee){if(ee.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+ee.dtype+". ")}),h=Yt(h,c[0].shape)[0];var m=bu(c.map(function(ee){return ee.shape}),h);if(ze(m)===0)return To([],m);if((c=c.filter(function(ee){return ee.size>0})).length===1)return c[0];var w=c.map(function(ee){return ee.shape});Zc(w,h);var R=c,K={axis:h};return Ve.runKernelFunc(function(ee){return ee.concat(c,h)},R,function(ee){var le=w.map(function(de){return de[h]});return Gi(ee,le,h).map(function(de){return function(){return de}})},"Concat",K)}}),Mh=Pt({concat1d_:function(b){return Ho(b,0)}}),Hp=Pt({concat2d_:function(b,h){return Ho(b,h)}}),ff=Pt({concat3d_:function(b,h){return Ho(b,h)}}),Dh=Pt({concat4d_:function(b,h){return Ho(b,h)}}),Gi=Pt({split_:function(b,h,c){c===void 0&&(c=0);var m,w=Ze(b,"x","split");return c=Yt(c,w.shape)[0],typeof h=="number"?(we(w.shape[c]%h==0,function(){return"Number of splits must evenly divide the axis."}),m=new Array(h).fill(w.shape[c]/h)):(we(w.shape[c]===h.reduce(function(R,K){return R+K}),function(){return"The sum of sizes must match the size of the axis dimension."}),m=h),Ve.runKernelFunc(function(R){return R.split(w,m,c)},{$x:w},function(R){return{$x:function(){return Ho(R,c)}}})}});function Di(b,h,c){return h===void 0&&(h="float32"),h=h||"float32",Vn(b),new Hr(b,h,c)}function da(b,h){h===void 0&&(h=!1),console.log(b.toString(h))}var Gp=Pt({batchToSpaceND_:function(b,h,c){var m=Ze(b,"x","batchToSpaceND"),w=h.reduce(function(R,K){return R*K});return we(m.rank>=1+h.length,function(){return"input rank is "+m.rank+" but should be > than blockShape.length "+h.length}),we(c.length===h.length,function(){return"crops.length is "+c.length+" but should be equal to blockShape.length  "+h.length}),we(m.shape[0]%w==0,function(){return"input tensor batch is "+m.shape[0]+" but is not divisible by the product of the elements of blockShape "+h.join(" * ")+" === "+w}),Ve.runKernelFunc(function(R){return R.batchToSpaceND(m,h,c)},{$x:m},function(R){return{$x:function(){return R.spaceToBatchND(h,c)}}})}}),qp=Pt({cast_:function(b,h){var c=Ze(b,"x","cast");if(!Qe(h))throw new Error("Failed to cast to unknown dtype "+h);if(h==="string"&&c.dtype!=="string"||h!=="string"&&c.dtype==="string")throw new Error("Only strings can be casted to strings");var m={dtype:h};return Ve.runKernelFunc(function(w){return w.cast(c,h)},{x:c},function(w){return{x:function(){return w.clone()}}},"Cast",m)}}),$p=Pt({cumsum_:function(b,h,c,m){h===void 0&&(h=0),c===void 0&&(c=!1),m===void 0&&(m=!1);var w=Ze(b,"x","cumsum"),R=Ra([h|=0],w.rank),K=w;R!=null&&(K=w.transpose(R));var ee=Pa(1,w.rank)[0],le=Ve.runKernelFunc(function(de){return de.cumsum(K,ee,c,m)},{permutedX:K},function(de){return{permutedX:function(){return de.cumsum(h,c,!m)}}});return R!=null&&(le=le.transpose(R)),le}}),Jm=Pt({depthToSpace_:function(b,h,c){c===void 0&&(c="NHWC");var m=Ze(b,"x","depthToSpace"),w=c==="NHWC"?m.shape[1]:m.shape[2],R=c==="NHWC"?m.shape[2]:m.shape[3],K=c==="NHWC"?m.shape[3]:m.shape[1];return we(w*h>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+w+" and "+h+`  for depthToSpace with input shape
      `+m.shape}),we(R*h>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+R+" and "+h+` for depthToSpace with input shape
          `+m.shape}),we(K%(h*h)==0,function(){return"Dimension size must be evenly divisible by "+h*h+" but is "+K+" for depthToSpace with input shape "+m.shape}),Ve.runKernelFunc(function(ee){return ee.depthToSpace(m,h,c)},{$x:m})}}),lc=Pt({expandDims_:function(b,h){h===void 0&&(h=0);var c=Ze(b,"x","expandDims",null);we(h<=c.rank,function(){return"Axis must be <= rank of the tensor"});var m=c.shape.slice();return h<0&&(we(-(c.rank+1)<=h,function(){return"Axis must be in the interval ["+-(c.rank+1)+", "+c.rank+"]"}),h=c.rank+h+1),m.splice(h,0,1),Fs(c,m)}}),Fs=Pt({reshape_:function(b,h){var c=Ze(b,"x","reshape",null);h=_t(h,c.size),we(c.size===ze(h),function(){return"new shape and old shape must have the same number of elements."});var m={shape:h};return Ve.runKernelFunc(function(w){return w.reshape(c,h)},{x:c},function(w){return{x:function(){return w.reshape(c.shape)}}},"Reshape",m)}}),Al=Pt({spaceToBatchND_:function(b,h,c){var m=Ze(b,"x","spaceToBatchND");return we(m.rank>=1+h.length,function(){return"input rank "+m.rank+" should be > than [blockShape] "+h.length}),we(c.length===h.length,function(){return"paddings.shape[0] "+c.length+" must be equal to [blockShape] "+h.length}),we(m.shape.reduce(function(w,R,K){return K>0&&K<=h.length?w&&(R+c[K-1][0]+c[K-1][1])%h[K-1]==0:w},!0),function(){return"input spatial dimensions "+m.shape.slice(1)+" with paddings "+c.toString()+" must be divisible by blockShapes "+h.toString()}),Ve.runKernelFunc(function(w){return w.spaceToBatchND(m,h,c)},{$x:m},function(w){return{$x:function(){return w.batchToSpaceND(h,c)}}})}}),qs=Pt({squeeze_:function(b,h){var c=Ze(b,"x","squeeze");return Fs(c,Fn(c.shape,h).newShape)}}),wu=Pt({stack_:function(b,h){h===void 0&&(h=0);var c=cc(b,"tensors","stack");if(we(c.length>=1,function(){return"Pass at least one tensor to tf.stack"}),c.length===1)return c[0].expandDims(h);var m=c[0].rank,w=c[0].shape,R=c[0].dtype;we(h<=m,function(){return"Axis must be <= rank of the tensor"}),c.forEach(function(ee){bt(w,ee.shape,"All tensors passed to stack must have matching shapes")}),c.forEach(function(ee){we(R===ee.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var K=c.map(function(ee){return ee.expandDims(h)});return Ho(K,h)}}),Nh=Pt({unstack_:function(b,h){h===void 0&&(h=0),h=h||0;var c=Ze(b,"x","unstack");we(h>=-c.shape.length&&h<c.shape.length,function(){return"Axis = "+h+" is not in [-"+c.shape.length+", "+c.shape.length+")"}),h<0&&(h+=c.shape.length);var m={axis:h};return Ve.runKernelFunc(function(w){return w.unstack(c,h)},{x:c},function(w){return{x:function(){return wu(w,h)}}},"Unpack",m)}}),Wi=function(b,h){return N(this,void 0,void 0,function(){var c,m,w,R,K,ee,le,de,_e,Te;return L(this,function(Ne){switch(Ne.label){case 0:return c=Ze(b,"x","setdiff1d"),m=Ze(h,"y","setdiff1d"),we(c.dtype===m.dtype,function(){return"x and y should have the same dtype, but got x ("+c.dtype+") and y ("+m.dtype+")."}),we(c.rank===1,function(){return"x should be 1D tensor, but got x ("+c.shape+")."}),we(m.rank===1,function(){return"y should be 1D tensor, but got y ("+m.shape+")."}),[4,c.data()];case 1:return w=Ne.sent(),[4,m.data()];case 2:for(R=Ne.sent(),K=new Set(R),ee=0,_e=0;_e<w.length;_e++)K.has(w[_e])||ee++;for(le=new Hr([ee],c.dtype),de=new Hr([ee],"int32"),_e=0,Te=0;_e<w.length;_e++)K.has(w[_e])||(le.values[Te]=w[_e],de.values[Te]=_e,Te++);return[2,[le.toTensor(),de.toTensor()]]}})})};function vd(b,h,c,m){m===void 0&&(m=!0);var w=[];if(m)(w=w.concat(h.slice(0))).push(b[0]/c),w=w.concat(b.slice(1));else{w=w.concat(b[0]);for(var R=h.length,K=0;K<R;++K)w=w.concat([b[K+1]/h[K],h[K]]);w=w.concat(b.slice(R+1))}return w}function Ol(b,h,c){c===void 0&&(c=!0);var m=[];if(c){m.push(h);for(var w=h+1;w<b;++w)w<=2*h?(m.push(w),m.push(w-(h+1))):m.push(w)}else{var R=[],K=[];for(w=1;w<b;++w)w>=2*h+1||w%2==1?K.push(w):R.push(w);m.push.apply(m,R),m.push(0),m.push.apply(m,K)}return m}function df(b,h,c,m){m===void 0&&(m=!0);var w=[];m?w.push(b[0]/c):w.push(b[0]*c);for(var R=1;R<b.length;++R)R<=h.length?m?w.push(h[R-1]*b[R]):w.push(b[R]/h[R-1]):w.push(b[R]);return w}function Xp(b,h){for(var c=[0],m=0;m<h;++m)c.push(b[m][0]);return c}function Qm(b,h,c){for(var m=b.slice(0,1),w=0;w<c;++w)m.push(b[w+1]-h[w][0]-h[w][1]);return m}var hf="Add",Ih="AddN",Go="Div",Fh="FusedBatchNorm",pf="SquaredDifference",Rh="Square",mf="Transpose",Tl="NonMaxSuppressionV5",el="BroadcastTo",Ph="OneHot",yd="Identity",gf="Tile",tl="PadV2",Xg="FromPixels",vf="MaxPoolWithArgmax",la=Pt({add_:function(b,h){var c,m=Ze(b,"a","add"),w=Ze(h,"b","add");c=Kt(m,w),m=c[0],w=c[1];var R={a:m,b:w};return Ve.runKernelFunc(function(K,ee){var le=K.add(m,w);return ee([m,w]),le},R,null,hf)}});function La(b,h){for(var c=b.length,m=[],w=0;w<c;w++){var R=c-1-w,K=b[R]||1;(h[h.length-1-w]||1)>1&&K===1&&m.unshift(R)}return m}function Wa(b,h){for(var c=[],m=0;m<h.length;m++){var w=b[b.length-m-1],R=h.length-m-1,K=h[R];(w==null||w===1&&K>1)&&c.unshift(R)}return c}function qi(b,h){for(var c=[],m=Math.max(b.length,h.length),w=0;w<m;w++){var R=b[b.length-w-1];R==null&&(R=1);var K=h[h.length-w-1];if(K==null&&(K=1),R===1)c.unshift(K);else if(K===1)c.unshift(R);else{if(R!==K)throw Error("Operands could not be broadcast together with shapes "+b+" and "+h+".");c.unshift(R)}}return c}var Rs=Pt({abs_:function(b){var h=Ze(b,"x","abs");return h.dtype==="complex64"?Ve.runKernelFunc(function(c){return c.complexAbs(h)},{$x:h}):Ve.runKernelFunc(function(c,m){var w=c.abs(h);return m([h]),w},{x:h},function(c,m){var w=m[0];return{x:function(){return c.mul(w.toFloat().step(-1))}}},"Abs")}}),nl=Pt({acos_:function(b){var h=Ze(b,"x","acos");return Ve.runKernelFunc(function(c,m){var w=c.acos(h);return m([h]),w},{$x:h},function(c,m){var w=m[0];return{$x:function(){return c.divStrict(kr(1).sub(w.toFloat().square()).sqrt()).neg()}}})}}),Va=Pt({acosh_:function(b){var h=Ze(b,"x","acosh");return Ve.runKernelFunc(function(c,m){var w=c.acosh(h);return m([h]),w},{$x:h},function(c,m){var w=m[0];return{$x:function(){return c.divStrict(w.toFloat().square().sub(1).sqrt())}}})}}),rl=Pt({asin_:function(b){var h=Ze(b,"x","asin");return Ve.runKernelFunc(function(c,m){var w=c.asin(h);return m([h]),w},{$x:h},function(c,m){var w=m[0];return{$x:function(){return c.divStrict(kr(1).sub(w.toFloat().square()).sqrt())}}})}}),fc=Pt({asinh_:function(b){var h=Ze(b,"x","asinh");return Ve.runKernelFunc(function(c,m){var w=c.asinh(h);return m([h]),w},{$x:h},function(c,m){var w=m[0];return{$x:function(){return c.divStrict(kr(1).add(w.toFloat().square()).sqrt())}}})}}),bd=Pt({atan_:function(b){var h=Ze(b,"x","atan");return Ve.runKernelFunc(function(c,m){var w=c.atan(h);return m([h]),w},{$x:h},function(c,m){var w=m[0];return{$x:function(){return c.div(w.toFloat().square().add(1))}}})}}),xd=Pt({atanh_:function(b){var h=Ze(b,"x","atanh");return Ve.runKernelFunc(function(c,m){var w=c.atanh(h);return m([h]),w},{$x:h},function(c,m){var w=m[0];return{$x:function(){return c.div(kr(1).sub(w.toFloat().square()))}}})}}),Ml=Pt({ceil_:function(b){var h=Ze(b,"x","ceil");return Ve.runKernelFunc(function(c){return c.ceil(h)},{$x:h},function(c){return{$x:function(){return mi(c)}}})}}),Kp=Pt({clipByValue_:function(b,h,c){var m=Ze(b,"x","clipByValue");we(h<=c,function(){return"Error in clip: min ("+h+") must be less than or equal to max ("+c+")."});var w=[m],R={min:h,max:c};return Ve.runKernelFunc(function(K,ee){var le=K.clip(m,h,c);return ee([m]),le},{x:m},function(K,ee){var le=ee[0];return{x:function(){return K.where(le.greaterEqual(h).logicalAnd(le.lessEqual(c)),mi(K))}}},"ClipByValue",R,w)}}),dc=Pt({cos_:function(b){var h=Ze(b,"x","cos"),c=[h];return Ve.runKernelFunc(function(m,w){var R=m.cos(h);return w([h]),R},{x:h},function(m,w){var R=w[0];return{x:function(){return R.toFloat().sin().neg().mul(m)}}},"Cos",{},c)}}),Kg=Pt({cosh_:function(b){var h=Ze(b,"x","cosh");return Ve.runKernelFunc(function(c,m){var w=c.cosh(h);return m([h]),w},{$x:h},function(c,m){var w=m[0];return{$x:function(){return w.toFloat().sinh().mulStrict(c)}}})}}),Yp=Pt({erf_:function(b){var h=Ze(b,"x","erf");return we(h.dtype==="int32"||h.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),h.dtype==="int32"&&(h=h.toFloat()),Ve.runKernelFunc(function(c,m){var w=c.erf(h);return m([h]),w},{$x:h},function(c,m){var w=m[0];return{$x:function(){return c.mul(w.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),yf=Pt({exp_:function(b){var h=Ze(b,"x","exp");return Ve.runKernelFunc(function(c,m){var w=c.exp(h);return m([w]),w},{x:h},function(c,m){return{x:function(){return c.mulStrict(m[0])}}},"Exp",{},[],[!0])}}),Zm=Pt({expm1_:function(b){var h=Ze(b,"x","expm1");return Ve.runKernelFunc(function(c,m){var w=c.expm1(h);return m([h]),w},{$x:h},function(c,m){var w=m[0];return{$x:function(){return c.mul(w.exp())}}})}}),wd=Pt({floor_:function(b){var h=Ze(b,"x","floor");return Ve.runKernelFunc(function(c){return c.floor(h)},{$x:h},function(c){return{$x:function(){return mi(c)}}})}}),Dl=Pt({log_:function(b){var h=Ze(b,"x","log"),c=[h];return Ve.runKernelFunc(function(m,w){var R=m.log(h);return w([h]),R},{x:h},function(m,w){var R=w[0];return{x:function(){return m.div(R.toFloat())}}},"Log",{},c)}}),Jp=Pt({log1p_:function(b){var h=Ze(b,"x","log1p");return Ve.runKernelFunc(function(c,m){var w=c.log1p(h);return m([h]),w},{$x:h},function(c,m){var w=m[0];return{$x:function(){return c.div(w.add(1))}}})}}),Lh=Pt({logSigmoid_:function(b){var h=Ze(b,"x","logSigmoid");return Ve.runKernelFunc(function(c,m){var w=c.softplus(h.neg()).neg();return m([h]),w},{$x:h},function(c,m){var w=m[0];return{$x:function(){return c.mul(w.neg().sigmoid())}}})}}),Oa=Pt({neg_:function(b){var h=Ze(b,"x","neg"),c=[h];return Ve.runKernelFunc(function(m){return m.neg(h)},{x:h},function(m){return{x:function(){return m.neg()}}},"Neg",{},c)}}),bf=Pt({reciprocal_:function(b){var h=Ze(b,"x","reciprocal");return Ve.runKernelFunc(function(c,m){var w=c.reciprocal(h);return m([h]),w},{$x:h},function(c,m){var w=m[0];return{$x:function(){return c.div(w.square().neg())}}})}}),Ps=Pt({round_:function(b){var h=Ze(b,"x","round");return Ve.runKernelFunc(function(c){return c.round(h)},{$x:h},function(c){return{$x:function(){return mi(c)}}})}}),xf=Pt({rsqrt_:function(b){var h=Ze(b,"x","rsqrt"),c=[h];return Ve.runKernelFunc(function(m,w){var R=m.rsqrt(h);return w([h]),R},{x:h},function(m,w){var R=w[0];return{x:function(){return m.div(R.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},c)}}),_d=Pt({sigmoid_:function(b){var h=Ze(b,"x","sigmoid");return Ve.runKernelFunc(function(c,m){var w=c.sigmoid(h);return m([w]),w},{x:h},function(c,m){var w=m[0];return{x:function(){return c.mul(w.mul(kr(1).sub(w)))}}},"Sigmoid")}}),Bh=Pt({sign_:function(b){var h=Ze(b,"x","sign");return Ve.runKernelFunc(function(c){return c.sign(h)},{$x:h},function(c){return{$x:function(){return mi(c)}}})}}),Qp=Pt({isNaN_:function(b){var h=Ze(b,"x","isNaN");return Ve.runKernelFunc(function(c){return c.isNaN(h)},{$x:h},function(c){return{$x:function(){return mi(c)}}})}}),Ed=Pt({isInf_:function(b){var h=Ze(b,"x","isInf");return Ve.runKernelFunc(function(c){return c.isInf(h)},{$x:h},function(c){return{$x:function(){return mi(c)}}})}}),wf=Pt({isFinite_:function(b){var h=Ze(b,"x","isFinite");return Ve.runKernelFunc(function(c){return c.isFinite(h)},{$x:h},function(c){return{$x:function(){return mi(c)}}})}}),Zp=Pt({sin_:function(b){var h=Ze(b,"x","sin"),c=[h];return Ve.runKernelFunc(function(m,w){var R=m.sin(h);return w([h]),R},{x:h},function(m,w){var R=w[0];return{x:function(){return R.toFloat().cos().mul(m)}}},"Sin",{},c)}}),em=Pt({sinh_:function(b){var h=Ze(b,"x","sinh");return Ve.runKernelFunc(function(c,m){var w=c.sinh(h);return m([h]),w},{$x:h},function(c,m){var w=m[0];return{$x:function(){return w.toFloat().cosh().mulStrict(c)}}})}}),vn=Pt({softplus_:function(b){var h=Ze(b,"x","softplus");return Ve.runKernelFunc(function(c,m){var w=c.softplus(h);return m([h]),w},{$x:h},function(c,m){var w=m[0];return{$x:function(){return c.mul(w.sigmoid())}}})}}),ou=Pt({sqrt_:function(b){var h=Ze(b,"x","sqrt");return Ve.runKernelFunc(function(c,m){var w=c.sqrt(h);return m([h]),w},{$x:h},function(c,m){var w=m[0];return{$x:function(){return c.div(w.toFloat().sqrt().mul(2))}}})}}),tr=Pt({step_:function(b,h){h===void 0&&(h=0);var c=Ze(b,"x","step");return Ve.runKernelFunc(function(m){return m.step(c,h)},{$x:c},function(m){return{$x:function(){return mi(m)}}})}}),Ls=Pt({tan_:function(b){var h=Ze(b,"x","tan");return Ve.runKernelFunc(function(c,m){var w=c.tan(h);return m([h]),w},{$x:h},function(c,m){var w=m[0];return{$x:function(){return c.div(w.cos().square())}}})}}),mo=Pt({tanh_:function(b){var h=Ze(b,"x","tanh");return Ve.runKernelFunc(function(c,m){var w=c.tanh(h);return m([w]),w},{x:h},function(c,m){var w=m[0];return{x:function(){return kr(1).sub(w.square()).mulStrict(c)}}},"Tanh",{},null,[!0])}}),_f=Pt({addStrict_:function(b,h){var c=Ze(b,"a","addStrict"),m=Ze(h,"b","addStrict");return bt(c.shape,m.shape,"Error in addStrict: "),c.add(m)}}),Sd=Pt({atan2_:function(b,h){var c,m=Ze(b,"a","atan2"),w=Ze(h,"b","atan2");c=Kt(m,w),m=c[0],w=c[1];var R=qi(m.shape,w.shape);return Ve.runKernelFunc(function(K,ee){var le=K.atan2(m,w);return ee([m,w]),le},{$a:m,$b:w},function(K,ee){var le=ee[0],de=ee[1];return{$a:function(){var _e=la(le.square(),de.square()),Te=K.mul(de.div(_e)),Ne=Wa(le.shape,R);return Ne.length>0&&(Te=Te.sum(Ne)),Te.reshape(le.shape)},$b:function(){var _e=la(le.square(),de.square()),Te=Oa(K.mul(le.div(_e))),Ne=Wa(de.shape,R);return Ne.length>0&&(Te=Te.sum(Ne)),Te.reshape(de.shape)}}})}}),mr=Pt({divStrict_:function(b,h){var c=Ze(b,"a","div"),m=Ze(h,"b","div");return bt(c.shape,m.shape,"Error in divideStrict: "),c.div(m)}}),ts=Pt({floorDiv_:function(b,h){var c,m=Ze(b,"a","floorDiv"),w=Ze(h,"b","floorDiv");c=Kt(m,w),m=c[0],w=c[1];var R=qi(m.shape,w.shape);return Ve.runKernelFunc(function(K,ee){var le=K.floorDiv(m,w);return ee([m,w]),le},{a:m,b:w},function(K,ee){var le=ee[0],de=ee[1];return{a:function(){var _e=K.div(de.toFloat()),Te=Wa(le.shape,R);return Te.length>0?_e.sum(Te).reshape(le.shape):_e},b:function(){var _e=K.mul(le.toFloat()),Te=Wa(de.shape,R);Te.length>0&&(_e=_e.sum(Te).reshape(de.shape));var Ne=de.square();return _e.div(Ne.toFloat()).neg()}}},"FloorDiv")}}),Ta=Pt({maximum_:function(b,h){var c,m=Ze(b,"a","maximum"),w=Ze(h,"b","maximum");return c=Kt(m,w),m=c[0],w=c[1],m.dtype==="bool"&&(m=m.toInt(),w=w.toInt()),qi(m.shape,w.shape),Ve.runKernelFunc(function(R,K){var ee=R.maximum(m,w);return K([m,w]),ee},{a:m,b:w},function(R,K){var ee=K[0],le=K[1];return{a:function(){return R.mul(ee.greaterEqual(le).toFloat())},b:function(){return R.mul(ee.less(le).toFloat())}}},"Maximum")}}),no=Pt({maximumStrict_:function(b,h){var c=Ze(b,"a","maximumStrict"),m=Ze(h,"b","maximumStrict");return bt(c.shape,m.shape,"Error in maximumStrict: "),c.maximum(m)}}),Hu=Pt({minimum_:function(b,h){var c,m=Ze(b,"a","minimum"),w=Ze(h,"b","minimum");return c=Kt(m,w),m=c[0],w=c[1],m.dtype==="bool"&&(m=m.toInt(),w=w.toInt()),qi(m.shape,w.shape),Ve.runKernelFunc(function(R,K){var ee=R.minimum(m,w);return K([m,w]),ee},{a:m,b:w},function(R,K){var ee=K[0],le=K[1];return{a:function(){return R.mul(ee.lessEqual(le).toFloat())},b:function(){return R.mul(ee.greater(le).toFloat())}}},"Minimum")}}),Nc=Pt({minimumStrict_:function(b,h){var c=Ze(b,"a","minimumStrict"),m=Ze(h,"b","minimumStrict");return bt(c.shape,m.shape,"Error in minimumStrict: "),c.minimum(m)}}),au=Pt({mod_:function(b,h){var c,m=Ze(b,"a","mod"),w=Ze(h,"b","mod");c=Kt(m,w),m=c[0],w=c[1];var R=qi(m.shape,w.shape);return Ve.runKernelFunc(function(K,ee){var le=K.mod(m,w);return ee([m,w]),le},{$a:m,$b:w},function(K,ee){var le=ee[0],de=ee[1];return{$a:function(){var _e=Wa(le.shape,R);return _e.length>0?K.sum(_e).reshape(le.shape):K},$b:function(){var _e=K.mul(le.div(de).floor().neg()),Te=Wa(de.shape,R);return Te.length>0?_e.sum(Te).reshape(de.shape):_e}}})}}),Ic=Pt({modStrict_:function(b,h){var c=Ze(b,"a","modStrict"),m=Ze(h,"b","modStrict");return bt(c.shape,m.shape,"Error in modStrict: "),c.mod(m)}}),na=Pt({mul_:function(b,h){var c,m=Ze(b,"a","mul"),w=Ze(h,"b","mul");c=Kt(m,w),m=c[0],w=c[1];var R=qi(m.shape,w.shape);return Ve.runKernelFunc(function(K,ee){var le=K.multiply(m,w);return ee([m,w]),le},{a:m,b:w},function(K,ee){var le=ee[0],de=ee[1];return{a:function(){var _e=K.mul(de.toFloat()),Te=Wa(le.shape,R);return Te.length>0?_e.sum(Te).reshape(le.shape):_e},b:function(){var _e=K.mul(le.toFloat()),Te=Wa(de.shape,R);return Te.length>0?_e.sum(Te).reshape(de.shape):_e}}},"Mul")}}),hc=Pt({mulStrict_:function(b,h){var c=Ze(b,"a","mul"),m=Ze(h,"b","mul");return bt(c.shape,m.shape,"Error in multiplyStrict: "),c.mul(m)}}),su=Pt({pow_:function(b,h){var c,m=Ze(b,"base","pow"),w=Ze(h,"exp","pow");c=Kt(m,w),m=c[0],w=c[1];var R=qi(m.shape,w.shape),K=[m,w];return Ve.runKernelFunc(function(ee,le){var de=ee.pow(m,w);return le([m,w,de]),de},{a:m,b:w},function(ee,le){var de=le[0],_e=le[1],Te=le[2];return{a:function(){var Ne=_e.toFloat(),Fe=ee.mul(Ne.mul(de.pow(Ne.sub(kr(1))))),He=Wa(de.shape,R);return He.length>0&&(Fe=Fe.sum(He)),Fe.reshape(de.shape)},b:function(){var Ne=de.greater(0),Fe=de.log().where(Ne,mi(de)),He=ee.mul(Te.mul(Fe)),Ye=Wa(_e.shape,R);return Ye.length>0&&(He=He.sum(Ye)),He.reshape(_e.shape)}}},"Pow",{},K,[!0])}}),vo=Pt({powStrict_:function(b,h){return bt(b.shape,h.shape,"Error in powStrict: "),b.pow(h)}}),ws=Pt({squaredDifferenceStrict_:function(b,h){var c=Ze(b,"a","squaredDifferenceStrict"),m=Ze(h,"b","squaredDifferenceStrict");return bt(c.shape,m.shape,"Error in squaredDifferenceStrict: "),c.squaredDifference(m)}}),Ba=Pt({sub_:function(b,h){var c,m=Ze(b,"a","sub"),w=Ze(h,"b","sub");c=Kt(m,w),m=c[0],w=c[1];var R=qi(m.shape,w.shape);return Ve.runKernelFunc(function(K){return K.subtract(m,w)},{a:m,b:w},function(K){return{a:function(){var ee=K,le=Wa(m.shape,R);return le.length>0&&(ee=ee.sum(le)),ee.reshape(m.shape)},b:function(){var ee=K,le=Wa(w.shape,R);return le.length>0&&(ee=ee.sum(le)),ee.neg().reshape(w.shape)}}},"Sub")}}),_s=Pt({subStrict_:function(b,h){var c=Ze(b,"a","subStrict"),m=Ze(h,"b","subStrict");return bt(c.shape,m.shape,"Error in subStrict: "),c.sub(m)}}),ra=Pt({div_:function(b,h){var c,m=Ze(b,"a","div"),w=Ze(h,"b","div");if(c=Kt(m,w),m=c[0],w=c[1],m.dtype==="int32"&&w.dtype==="int32")return ts(m,w);var R={a:m,b:w};return Ve.runKernelFunc(function(K,ee){var le=K.realDivide(m,w);return ee([m,w]),le},R,null,Go,{})}});function uu(b,h){if(b.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+b.rank+".");if(h.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+h.rank+".");if(h.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+h.dtype+".");if(h.shape[h.rank-1]>b.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+h.shape[h.rank-1]+" vs. "+b.rank);if(b.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+b.shape+".");for(var c=h.shape,m=c[c.length-1],w=1,R=0;R<c.length-1;++R)w*=c[R];var K=b.shape,ee=c.slice();ee.pop();var le=1;for(R=m;R<b.rank;++R)le*=K[R],ee.push(K[R]);var de=rn(b.shape).map(function(_e){return _e/le}).concat([1]).slice(0,m);return[ee,w,le,de]}var Gu=Object.freeze({prepareAndValidate:uu}),pc=30;function Fc(b){return b<=pc?b:Tr(b,Math.floor(Math.sqrt(b)))}function qu(b,h,c){var m=h.rank>1?h.shape[h.rank-1]:1,w=h.rank>1?h.rank-1:1,R="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+c.shape+", indices.shape: "+h.shape+", shape: "+b+", sliceDim: "+m+", and batchDim: "+w+".";if(c.rank<w)throw new Error(R+" update.rank < "+w+". ");if(b.length<m+(c.rank-w))throw new Error(R+" Output shape length < "+(m+(c.rank-w)));if(c.rank!==w+b.length-m)throw new Error(R+" update.rank != "+(w+b.length-m));for(var K=0;K<w;++K)if(c.shape[K]!==h.shape[K])throw new Error(R+" updates.shape["+K+"] ("+c.shape[K]+") != indices.shape["+K+"] ("+h.shape[K]+").");for(K=0;K<c.rank-w;++K)if(c.shape[K+w]!==b[K+m])throw new Error(R+" updates.shape["+(K+w)+"] ("+c.shape[K+w]+") != shape["+(K+w)+"] ("+b[K+w]+")")}function Nl(b,h,c){if(h.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+h.rank+".");if(b.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+b.rank+".");if(h.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+h.dtype);if(c.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+c);if(c.length===0){if(h.size===0)throw new Error("Indices specified for empty output. indices shape: "+h.shape);if(b.size===0)throw new Error("Updates specified for empty output. updates shape: "+b.shape)}qu(c,h,b)}function Il(b,h,c){for(var m=h.shape.length,w=m>1?h.shape[m-1]:1,R=c.length,K=1,ee=w;ee<R;++ee)K*=c[ee];var le=w<1?1:w;return{sliceRank:w,numUpdates:ze(h.shape)/le,sliceSize:K,strides:rn(c.slice(0,w)).concat([1]),outputSize:ze(c)}}var jh=Object.freeze({validateUpdateShape:qu,validateInput:Nl,calculateShapes:Il});function Fl(b,h,c){we(b.rank===h.length,function(){return"Error in slice"+b.rank+"D: Length of begin "+h+" must match the rank of the array ("+b.rank+")."}),we(b.rank===c.length,function(){return"Error in slice"+b.rank+"D: Length of size "+c+" must match the rank of the array ("+b.rank+")."});for(var m=function(R){we(h[R]+c[R]<=b.shape[R],function(){return"Error in slice"+b.rank+"D: begin["+R+"] + size["+R+"] ("+(h[R]+c[R])+") would overflow input.shape["+R+"] ("+b.shape[R]+")"})},w=0;w<b.rank;++w)m(w)}function cu(b){for(var h=[],c=0;b>0;)1&b&&h.push(c),b/=2,c++;return h}function $u(b,h,c){for(var m=[],w=0;w<b.length;w++)m[w]=Math.ceil((h[w]-b[w])/c[w]);return m}function Xu(b,h,c,m,w){var R=h[w],K=c[w]||1;(b&1<<w||R==null)&&(R=K>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var ee=m[w];return R<0&&(R+=ee),ht(0,R,ee-1)}function _u(b,h,c,m,w){var R=h[w],K=c[w]||1;(b&1<<w||R==null)&&(R=K>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var ee=m[w];return R<0&&(R+=ee),K>0?ht(0,R,ee):ht(-1,R,ee-1)}function zh(b,h,c){for(var m=c.length,w=0;w<c.length;w++)if(c[w]>1){m=w;break}for(w=m+1;w<c.length;w++)if(h[w]>0||c[w]!==b[w])return!1;return!0}function kd(b,h){for(var c=b.length>0?b[b.length-1]:1,m=0;m<b.length-1;m++)c+=b[m]*h[m];return c}var Cd=Object.freeze({assertParamsValid:Fl,maskToAxes:cu,computeOutShape:$u,startForAxis:Xu,stopForAxis:_u,isSliceContinous:zh,computeFlatOffset:kd});function Ef(b){return we(ar(b),function(){return"The f passed in grad(f) must be a function"}),function(h,c){var m=Ze(h,"x","tf.grad",null),w=c!=null?Ze(c,"dy","tf.grad"):null;return Ve.tidy(function(){var R=Ve.gradients(function(){return b(m)},[m],w),K=R.value,ee=R.grads;return w!=null&&bt(K.shape,w.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),ue(ee),ee[0]})}}function Ad(b){return we(ar(b),function(){return"The f passed in grads(f) must be a function"}),function(h,c){we(Array.isArray(h),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var m=cc(h,"args","tf.grads",null),w=c!=null?Ze(c,"dy","tf.grads"):null;return Ve.tidy(function(){var R=Ve.gradients(function(){return b.apply(void 0,m)},m,w),K=R.value,ee=R.grads;return w!=null&&bt(K.shape,w.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),ue(ee),ee})}}function ae(b){return we(ar(b),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(h,c){we(h instanceof $t,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),we(c==null||c instanceof $t,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var m=Ve.gradients(function(){return b(h)},[h],c),w=m.grads,R=m.value;return ue(w),{grad:w[0],value:R}}}function ne(b){return we(ar(b),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(h,c){we(Array.isArray(h)&&h.every(function(w){return w instanceof $t}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),we(c==null||c instanceof $t,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var m=Ve.gradients(function(){return b.apply(void 0,h)},h,c);return c!=null&&bt(m.value.shape,c.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),ue(m.grads),m}}function D(b,h){we(ar(b),function(){return"The f passed in variableGrads(f) must be a function"}),we(h==null||Array.isArray(h)&&h.every(function(_e){return _e instanceof kt}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var c=h!=null;if(!c)for(var m in h=[],Ve.registeredVariables)h.push(Ve.registeredVariables[m]);var w=c?h.filter(function(_e){return!_e.trainable}):null,R=h.length;we((h=h.filter(function(_e){return _e.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+R+" variables is trainable."});var K=Ve.gradients(b,h,null,!0),ee=K.value,le=K.grads;we(le.some(function(_e){return _e!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),we(ee.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+ee.rank+" tensor"});var de={};return h.forEach(function(_e,Te){le[Te]!=null&&(de[_e.name]=le[Te])}),w!=null&&w.forEach(function(_e){return de[_e.name]=null}),{value:ee,grads:de}}function H(b){return Ve.customGrad(b)}function ue(b){if(b.filter(function(h){return h==null}).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}var je=Pt({softmax_:function(b,h){h===void 0&&(h=-1);var c=Ze(b,"logits","softmax","float32");if(h===-1&&(h=c.rank-1),h!==c.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+c.rank+" and dim was "+h);return Ve.runKernelFunc(function(m,w){var R=m.softmax(c,h);return w([R]),R},{logits:c},function(m,w){var R=w[0],K=m.mul(R);return{logits:function(){return K.sub(K.sum([h],!0).mul(R))}}},"Softmax",{dim:h},[],[!0])}}),Je=Pt({logSoftmax_:function(b,h){h===void 0&&(h=-1);var c=Ze(b,"logits","logSoftmax");if(h===-1&&(h=c.rank-1),h!==c.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+c.rank+" and axis was "+h);return H(function(m,w){var R=m.max(h,!0),K=m.sub(R),ee=K.toFloat().sub(K.exp().sum(h,!0).log());return w([ee]),{value:ee,gradFunc:function(le,de){var _e=de[0].exp();return le.sub(le.sum(h,!0).mul(_e))}}})(c)}}),vt=Pt({transpose_:function(b,h){var c=Ze(b,"x","transpose");if(h==null&&(h=c.shape.map(function(w,R){return R}).reverse()),we(c.rank===h.length,function(){return"Error in transpose: rank of input "+c.rank+" must match length of perm "+h+"."}),h.forEach(function(w){we(w>=0&&w<c.rank,function(){return"All entries in 'perm' must be between 0 and "+(c.rank-1)+" but got "+h})}),c.rank<=1)return c.clone();var m={perm:h};return Ve.runKernelFunc(function(w){return w.transpose(c,h)},{x:c},null,"Transpose",m)}}),Gt=function(){function b(h,c){this.backend=h,this.dataMover=c,this.data=new WeakMap,this.dataIdsCount=0}return b.prototype.get=function(h){return this.data.has(h)||this.dataMover.moveData(this.backend,h),this.data.get(h)},b.prototype.set=function(h,c){this.dataIdsCount++,this.data.set(h,c)},b.prototype.has=function(h){return this.data.has(h)},b.prototype.delete=function(h){return this.dataIdsCount--,this.data.delete(h)},b.prototype.numDataIds=function(){return this.dataIdsCount},b}(),on=function(){function b(){}return b.prototype.time=function(h){return dt("time")},b.prototype.read=function(h){return dt("read")},b.prototype.readSync=function(h){return dt("readSync")},b.prototype.numDataIds=function(){return dt("numDataIds")},b.prototype.disposeData=function(h){return dt("disposeData")},b.prototype.write=function(h,c,m){return dt("write")},b.prototype.move=function(h,c,m,w){return dt("move")},b.prototype.memory=function(){return dt("memory")},b.prototype.floatPrecision=function(){return dt("floatPrecision")},b.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},b.prototype.batchMatMul=function(h,c,m,w){return dt("batchMatMul")},b.prototype.fusedBatchMatMul=function(h){return h.a,h.b,h.transposeA,h.transposeB,h.bias,h.activation,h.preluActivationWeights,dt("fusedBatchMatMul")},b.prototype.slice=function(h,c,m){return dt("slice")},b.prototype.stridedSlice=function(h,c,m,w){return dt("stridedSlice")},b.prototype.unstack=function(h,c){return dt("unstack")},b.prototype.reverse=function(h,c){return dt("reverse")},b.prototype.concat=function(h,c){return dt("concat")},b.prototype.neg=function(h){return dt("neg")},b.prototype.add=function(h,c){return dt("add")},b.prototype.addN=function(h){return dt("addN")},b.prototype.subtract=function(h,c){return dt("subtract")},b.prototype.multiply=function(h,c){return dt("multiply")},b.prototype.realDivide=function(h,c){return dt("realDivide")},b.prototype.floorDiv=function(h,c){return dt("floorDiv")},b.prototype.sum=function(h,c){return dt("sum")},b.prototype.prod=function(h,c){return dt("prod")},b.prototype.unsortedSegmentSum=function(h,c,m){return dt("unsortedSegmentSum")},b.prototype.argMin=function(h,c){return dt("argMin")},b.prototype.argMax=function(h,c){return dt("argMax")},b.prototype.equal=function(h,c){return dt("equal")},b.prototype.notEqual=function(h,c){return dt("notEqual")},b.prototype.less=function(h,c){return dt("less")},b.prototype.lessEqual=function(h,c){return dt("lessEqual")},b.prototype.greater=function(h,c){return dt("greater")},b.prototype.greaterEqual=function(h,c){return dt("greaterEqual")},b.prototype.logicalNot=function(h){return dt("logicalNot")},b.prototype.logicalAnd=function(h,c){return dt("logicalAnd")},b.prototype.logicalOr=function(h,c){return dt("logicalOr")},b.prototype.where=function(h){return dt("where")},b.prototype.select=function(h,c,m){return dt("select")},b.prototype.topk=function(h,c,m){return dt("topk")},b.prototype.min=function(h,c){return dt("min")},b.prototype.minimum=function(h,c){return dt("minimum")},b.prototype.mod=function(h,c){return dt("mod")},b.prototype.max=function(h,c){return dt("max")},b.prototype.maximum=function(h,c){return dt("maximum")},b.prototype.all=function(h,c){return dt("all")},b.prototype.any=function(h,c){return dt("any")},b.prototype.squaredDifference=function(h,c){return dt("squaredDifference")},b.prototype.ceil=function(h){return dt("ceil")},b.prototype.floor=function(h){return dt("floor")},b.prototype.round=function(h){return dt("round")},b.prototype.sign=function(h){return dt("sign")},b.prototype.isNaN=function(h){return dt("isNaN")},b.prototype.isInf=function(h){return dt("isInf")},b.prototype.isFinite=function(h){return dt("isFinite")},b.prototype.pow=function(h,c){return dt("pow")},b.prototype.exp=function(h){return dt("exp")},b.prototype.expm1=function(h){return dt("expm1")},b.prototype.softmax=function(h,c){return dt("softmax")},b.prototype.log=function(h){return dt("log")},b.prototype.log1p=function(h){return dt("log1p")},b.prototype.sqrt=function(h){return dt("sqrt")},b.prototype.rsqrt=function(h){return dt("rsqrt")},b.prototype.square=function(h){return dt("square")},b.prototype.reciprocal=function(h){return dt("reciprocal")},b.prototype.relu=function(h){return dt("relu")},b.prototype.relu6=function(h){return dt("relu6")},b.prototype.prelu=function(h,c){return dt("prelu")},b.prototype.elu=function(h){return dt("elu")},b.prototype.eluDer=function(h,c){return dt("eluDer")},b.prototype.selu=function(h){return dt("selu")},b.prototype.int=function(h){return dt("int")},b.prototype.clip=function(h,c,m){return dt("clip")},b.prototype.abs=function(h){return dt("abs")},b.prototype.complexAbs=function(h){return dt("complexAbs")},b.prototype.sigmoid=function(h){return dt("sigmoid")},b.prototype.softplus=function(h){return dt("softplus")},b.prototype.sin=function(h){return dt("sin")},b.prototype.cos=function(h){return dt("cos")},b.prototype.tan=function(h){return dt("tan")},b.prototype.asin=function(h){return dt("asin")},b.prototype.acos=function(h){return dt("acos")},b.prototype.atan=function(h){return dt("atan")},b.prototype.atan2=function(h,c){return dt("atan2")},b.prototype.sinh=function(h){return dt("sinh")},b.prototype.cosh=function(h){return dt("cosh")},b.prototype.tanh=function(h){return dt("tanh")},b.prototype.asinh=function(h){return dt("asinh")},b.prototype.acosh=function(h){return dt("acosh")},b.prototype.atanh=function(h){return dt("atanh")},b.prototype.erf=function(h){return dt("erf")},b.prototype.step=function(h,c){return dt("step")},b.prototype.fusedConv2d=function(h){return h.input,h.filter,h.convInfo,h.bias,h.activation,h.preluActivationWeights,dt("fusedConv2d")},b.prototype.conv2d=function(h,c,m){return dt("conv2d")},b.prototype.conv2dDerInput=function(h,c,m){return dt("conv2dDerInput")},b.prototype.conv2dDerFilter=function(h,c,m){return dt("conv2dDerFilter")},b.prototype.fusedDepthwiseConv2D=function(h){return h.input,h.filter,h.convInfo,h.bias,h.activation,h.preluActivationWeights,dt("fusedDepthwiseConv2D")},b.prototype.depthwiseConv2D=function(h,c,m){return dt("depthwiseConv2D")},b.prototype.depthwiseConv2DDerInput=function(h,c,m){return dt("depthwiseConv2DDerInput")},b.prototype.depthwiseConv2DDerFilter=function(h,c,m){return dt("depthwiseConv2DDerFilter")},b.prototype.conv3d=function(h,c,m){return dt("conv3d")},b.prototype.conv3dDerInput=function(h,c,m){return dt("conv3dDerInput")},b.prototype.conv3dDerFilter=function(h,c,m){return dt("conv3dDerFilter")},b.prototype.maxPool=function(h,c){return dt("maxPool")},b.prototype.maxPoolBackprop=function(h,c,m,w){return dt("maxPoolBackprop")},b.prototype.avgPool=function(h,c){return dt("avgPool")},b.prototype.avgPoolBackprop=function(h,c,m){return dt("avgPoolBackprop")},b.prototype.avgPool3d=function(h,c){return dt("avgPool3d")},b.prototype.avgPool3dBackprop=function(h,c,m){return dt("avgPool3dBackprop")},b.prototype.maxPool3d=function(h,c){return dt("maxPool3d")},b.prototype.maxPool3dBackprop=function(h,c,m,w){return dt("maxPool3dBackprop")},b.prototype.reshape=function(h,c){return dt("reshape")},b.prototype.cast=function(h,c){return dt("cast")},b.prototype.tile=function(h,c){return dt("tile")},b.prototype.pad=function(h,c,m){return dt("pad")},b.prototype.transpose=function(h,c){return dt("transpose")},b.prototype.gather=function(h,c,m){return dt("gather")},b.prototype.gatherND=function(h,c){return dt("gatherND")},b.prototype.scatterND=function(h,c,m){return dt("scatterND")},b.prototype.batchToSpaceND=function(h,c,m){return dt("batchToSpaceND")},b.prototype.spaceToBatchND=function(h,c,m){return dt("spaceToBatchND")},b.prototype.resizeBilinear=function(h,c,m,w){return dt("resizeBilinear")},b.prototype.resizeBilinearBackprop=function(h,c,m){return dt("resizeBilinearBackprop")},b.prototype.resizeNearestNeighbor=function(h,c,m,w){return dt("resizeNearestNeighbor")},b.prototype.resizeNearestNeighborBackprop=function(h,c,m){return dt("resizeNearestNeighborBackprop")},b.prototype.batchNormalization=function(h,c,m,w,R,K){return dt("batchNormalization")},b.prototype.localResponseNormalization4D=function(h,c,m,w,R){return dt("localResponseNormalization4D")},b.prototype.LRNGrad=function(h,c,m,w,R,K,ee){return dt("LRNGrad")},b.prototype.multinomial=function(h,c,m,w){return dt("multinomial")},b.prototype.oneHot=function(h,c,m,w){return dt("oneHot")},b.prototype.cumsum=function(h,c,m,w){return dt("cumsum")},b.prototype.nonMaxSuppression=function(h,c,m,w,R){return dt("nonMaxSuppression")},b.prototype.fft=function(h){return dt("fft")},b.prototype.ifft=function(h){return dt("ifft")},b.prototype.complex=function(h,c){return dt("complex")},b.prototype.real=function(h){return dt("real")},b.prototype.imag=function(h){return dt("imag")},b.prototype.cropAndResize=function(h,c,m,w,R,K){return dt("cropAndResize")},b.prototype.depthToSpace=function(h,c,m){return dt("depthToSpace")},b.prototype.split=function(h,c,m){return dt("split")},b.prototype.sparseToDense=function(h,c,m,w){return dt("sparseToDense")},b.prototype.diag=function(h){return dt("diag")},b.prototype.fill=function(h,c,m){return dt("fill")},b.prototype.onesLike=function(h){return dt("onesLike")},b.prototype.zerosLike=function(h){return dt("zerosLike")},b.prototype.linspace=function(h,c,m){return dt("linspace")},b.prototype.dispose=function(){return dt("dispose")},b}();function dt(b){throw new Error("'"+b+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Mn(b,h,c,m,w,R,K){K===void 0&&(K="channelsLast");var ee,le=dr(h),de=le[0],_e=le[1];if(K==="channelsLast")ee=[de,_e,b[3],b[3]];else{if(K!=="channelsFirst")throw new Error("Unknown dataFormat "+K);ee=[de,_e,b[1],b[1]]}return Hn(b,ee,c,m,w,R,!1,K)}function zn(b,h,c,m,w,R,K){K===void 0&&(K="NDHWC");var ee,le,de=gr(h),_e=de[0],Te=de[1],Ne=de[2];if(K==="NDHWC")le="channelsLast",ee=[_e,Te,Ne,b[4],b[4]];else{if(K!=="NCDHW")throw new Error("Unknown dataFormat "+K);le="channelsFirst",ee=[_e,Te,Ne,b[1],b[1]]}return nr(b,ee,c,m,w,!1,le,R)}function Hn(b,h,c,m,w,R,K,ee){K===void 0&&(K=!1),ee===void 0&&(ee="channelsLast");var le=[-1,-1,-1,-1],de=le[0],_e=le[1],Te=le[2],Ne=le[3];if(ee==="channelsLast")de=b[0],_e=b[1],Te=b[2],Ne=b[3];else{if(ee!=="channelsFirst")throw new Error("Unknown dataFormat "+ee);de=b[0],Ne=b[1],_e=b[2],Te=b[3]}var Fe,He=h[0],Ye=h[1],Ke=h[3],it=dr(c),gt=it[0],wt=it[1],At=dr(m),zt=At[0],an=At[1],dn=Ar(He,zt),sn=Ar(Ye,an),ln=function(fr,br,_r,xr,vr,Pr,Rr,Qr){var fi,Ci,bo;if(typeof fr=="number"){fi={top:fr,bottom:fr,left:fr,right:fr,type:fr===0?"VALID":"NUMBER"};var xo=function(so,Do,Ko,Su,Ks){Su==null&&(Su=Yn(so,Do,Ko));var Ys=so[1],cp=Gr((so[0]-Do+2*Su)/Ko+1,Ks);we(Ft(cp),function(){return"The output # of rows ("+cp+") must be an integer. Change the stride and/or zero pad parameters"});var lp=Gr((Ys-Do+2*Su)/Ko+1,Ks);return we(Ft(lp),function(){return"The output # of columns ("+lp+") must be an integer. Change the stride and/or zero pad parameters"}),[cp,lp]}([br,_r],Pr,xr,fr,Qr);Ci=xo[0],bo=xo[1]}else if(fr==="same"){Ci=Math.ceil(br/xr),bo=Math.ceil(_r/vr);var Mo=Math.max(0,(Ci-1)*xr+Pr-br),Oo=Math.max(0,(bo-1)*vr+Rr-_r),Vo=Math.floor(Mo/2),ua=Mo-Vo,$a=Math.floor(Oo/2);fi={top:Vo,bottom:ua,left:$a,right:Oo-$a,type:"SAME"}}else{if(fr!=="valid")throw Error("Unknown padding parameter: "+fr);fi={top:0,bottom:0,left:0,right:0,type:"VALID"},Ci=Math.ceil((br-Pr+1)/xr),bo=Math.ceil((_r-Rr+1)/vr)}return{padInfo:fi,outHeight:Ci,outWidth:bo}}(w,_e,Te,gt,wt,dn,sn,R),Tn=ln.padInfo,Bn=ln.outHeight,In=ln.outWidth,or=K?Ke*Ne:Ke;return ee==="channelsFirst"?Fe=[de,or,Bn,In]:ee==="channelsLast"&&(Fe=[de,Bn,In,or]),{batchSize:de,dataFormat:ee,inHeight:_e,inWidth:Te,inChannels:Ne,outHeight:Bn,outWidth:In,outChannels:or,padInfo:Tn,strideHeight:gt,strideWidth:wt,filterHeight:He,filterWidth:Ye,effectiveFilterHeight:dn,effectiveFilterWidth:sn,dilationHeight:zt,dilationWidth:an,inShape:b,outShape:Fe,filterShape:h}}function nr(b,h,c,m,w,R,K,ee){R===void 0&&(R=!1),K===void 0&&(K="channelsLast");var le=[-1,-1,-1,-1,-1],de=le[0],_e=le[1],Te=le[2],Ne=le[3],Fe=le[4];if(K==="channelsLast")de=b[0],_e=b[1],Te=b[2],Ne=b[3],Fe=b[4];else{if(K!=="channelsFirst")throw new Error("Unknown dataFormat "+K);de=b[0],Fe=b[1],_e=b[2],Te=b[3],Ne=b[4]}var He,Ye=h[0],Ke=h[1],it=h[2],gt=h[4],wt=gr(c),At=wt[0],zt=wt[1],an=wt[2],dn=gr(m),sn=dn[0],ln=dn[1],Tn=dn[2],Bn=Ar(Ye,sn),In=Ar(Ke,ln),or=Ar(it,Tn),fr=function(Rr,Qr,fi,Ci,bo,xo,Mo,Oo,Vo,ua,$a){var so,Do,Ko,Su;if(typeof Rr=="number"){so={top:Rr,bottom:Rr,left:Rr,right:Rr,front:Rr,back:Rr,type:Rr===0?"VALID":"NUMBER"};var Ks=function(qv,Tm,e3,U1,dp,fw){dp==null&&(dp=Yn(qv,Tm,U1));var t3=qv[1],n3=qv[2],dw=Gr((qv[0]-Tm+2*dp)/U1+1,fw);we(Ft(dw),function(){return"The output # of depths ("+dw+") must be an integer. Change the stride and/or zero pad parameters"});var hw=Gr((t3-Tm+2*dp)/U1+1,fw);we(Ft(hw),function(){return"The output # of rows ("+hw+") must be an integer. Change the stride and/or zero pad parameters"});var pw=Gr((n3-Tm+2*dp)/U1+1,fw);return we(Ft(pw),function(){return"The output # of columns ("+pw+") must be an integer. Change the stride and/or zero pad parameters"}),[dw,hw,pw,1]}([Qr,fi,Ci,1],Oo,0,bo,Rr,$a);Do=Ks[0],Ko=Ks[1],Su=Ks[2]}else if(Rr==="same"){var Ys=((Do=Math.ceil(Qr/bo))-1)*bo+Oo-Qr,cp=((Ko=Math.ceil(fi/xo))-1)*xo+Vo-fi,lp=((Su=Math.ceil(Ci/Mo))-1)*Mo+ua-Ci,Om=Math.floor(Ys/2),Pu=Ys-Om,S0=Math.floor(cp/2),Gv=cp-S0,fp=Math.floor(lp/2);so={top:S0,bottom:Gv,left:fp,right:lp-fp,front:Om,back:Pu,type:"SAME"}}else{if(Rr!=="valid")throw Error("Unknown padding parameter: "+Rr);so={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Do=Math.ceil((Qr-Oo+1)/bo),Ko=Math.ceil((fi-Vo+1)/xo),Su=Math.ceil((Ci-ua+1)/Mo)}return{padInfo:so,outDepth:Do,outHeight:Ko,outWidth:Su}}(w,_e,Te,Ne,At,zt,an,Bn,In,or,ee),br=fr.padInfo,_r=fr.outDepth,xr=fr.outHeight,vr=fr.outWidth,Pr=R?gt*Fe:gt;return K==="channelsFirst"?He=[de,Pr,_r,xr,vr]:K==="channelsLast"&&(He=[de,_r,xr,vr,Pr]),{batchSize:de,dataFormat:K,inDepth:_e,inHeight:Te,inWidth:Ne,inChannels:Fe,outDepth:_r,outHeight:xr,outWidth:vr,outChannels:Pr,padInfo:br,strideDepth:At,strideHeight:zt,strideWidth:an,filterDepth:Ye,filterHeight:Ke,filterWidth:it,effectiveFilterDepth:Bn,effectiveFilterHeight:In,effectiveFilterWidth:or,dilationDepth:sn,dilationHeight:ln,dilationWidth:Tn,inShape:b,outShape:He,filterShape:h}}function Yn(b,h,c,m){m===void 0&&(m=1);var w=Ar(h,m);return Math.floor((b[0]*(c-1)-c+w)/2)}function dr(b){return typeof b=="number"?[b,b,b]:b.length===2?[b[0],b[1],1]:b}function gr(b){return typeof b=="number"?[b,b,b]:b}function Ar(b,h){return h<=1?b:b+(b-1)*(h-1)}function Gr(b,h){if(!h)return b;switch(h){case"round":return Math.round(b);case"ceil":return Math.ceil(b);case"floor":return Math.floor(b);default:throw new Error("Unknown roundingMode "+h)}}function ii(b){var h=dr(b),c=h[0],m=h[1],w=h[2];return c===1&&m===1&&w===1}function Ir(b,h){return ii(b)||ii(h)}function ai(b){if(b==="NHWC")return"channelsLast";if(b==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+b)}function ni(b,h,c){if(h==="complex64"){if(b.dtype==="complex64")return b.clone();var m=ao(b.shape),w=b.toFloat(),R=c.complex(w,m);return m.dispose(),w.dispose(),R}if(!$e(b.dtype,h))return Ve.makeTensorFromDataId(b.dataId,b.shape,h);if(b.dtype==="complex64"){var K=c.real(b);return R=K.cast(h),K.dispose(),R}if(h==="int32")return c.int(b);if(h==="bool"){var ee=kr(0,b.dtype);return R=c.notEqual(b,ee),ee.dispose(),R}throw new Error("Error in Cast: failed to cast "+b.dtype+" to "+h)}function bi(b,h){return Ve.makeTensorFromDataId(b.dataId,h,b.dtype)}function _i(b,h,c){var m=(h-b)/(c-1),w=Wt(c,"float32");w[0]=b;for(var R=1;R<w.length;R++)w[R]=w[R-1]+m;return ru(w,"float32")}var oi=Object.freeze({castTensor:ni,reshapeTensor:bi,linspaceImpl:_i,upcastType:En,axesAreInnerMostDims:gd,combineLocations:Up,computeOutAndReduceShapes:Io,expandShapeToKeepDim:Fo,assertAxesAreInnerMostDims:ta,getAxesPermutation:Ra,getUndoAxesPermutation:Vu,getInnerMostAxes:Pa,getBroadcastDims:La,getReductionAxes:Wa,assertAndGetBroadcastShape:qi,assertParamsConsistent:Zc,computeOutShape:bu,computePool2DInfo:Mn,computePool3DInfo:zn,computeConv2DInfo:Hn,computeConv3DInfo:nr,computeDefaultPad:Yn,tupleValuesAreOne:ii,eitherStridesOrDilationsAreOne:Ir,convertConv2DDataFormat:ai,PARALLELIZE_THRESHOLD:pc,computeOptimalWindowSize:Fc});function pi(b,h){if(b.length!==h.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+b.length+", imag: "+h.length+".");for(var c=new Float32Array(2*b.length),m=0;m<c.length;m+=2)c[m]=b[m/2],c[m+1]=h[m/2];return c}function fo(b,h){return{real:b[2*h],imag:b[2*h+1]}}function lo(b,h,c,m){b[2*m]=h,b[2*m+1]=c}function qo(b,h,c){var m=(c?2:-2)*Math.PI*(b/h);return{real:Math.cos(m),imag:Math.sin(m)}}function $i(b,h,c){var m=function(R,K,ee){return function(le,de,_e){for(var Te=0,Ne=le.length,Fe=0,He=!1;Te<Ne;){var Ye=_e(de,le[Fe=Te+(Ne-Te>>>1)]);Ye>0?Te=Fe+1:(Ne=Fe,He=!Ye)}return He?Te:-Te-1}(R,K,ee||ho)}(b,h,c),w=m<0?-(m+1):m;b.splice(w,0,h)}function ho(b,h){return b>h?1:b<h?-1:0}function fa(b,h,c,m,w){return ia(b,h,c,m,w,0).selectedIndices}function Wo(b,h,c,m,w,R){var K=ia(b,h,c,m,w,R);return K.numValidOutputs.dispose(),{selectedIndices:K.selectedIndices,selectedScores:K.selectedScores}}function ia(b,h,c,m,w,R,K,ee){ee===void 0&&(ee=!1);for(var le=Array.from(h).map(function(At,zt){return{score:At,boxIndex:zt,suppressBeginIndex:0}}).filter(function(At){return At.score>w}).sort(So),de=R>0?-.5/R:0,_e=[],Te=[];_e.length<c&&le.length>0;){var Ne=le.pop(),Fe=Ne.score,He=Ne.boxIndex,Ye=Ne.suppressBeginIndex;if(Fe<w)break;for(var Ke=!1,it=_e.length-1;it>=Ye;--it){var gt=Vi(b,He,_e[it]);if(gt>=m){Ke=!0;break}if(Ne.score=Ne.score*Ui(m,de,gt),Ne.score<=w)break}Ne.suppressBeginIndex=_e.length,Ke||(Ne.score===Fe?(_e.push(He),Te.push(Ne.score)):Ne.score>w&&$i(le,Ne,So))}var wt=_e.length;return ee&&(_e.fill(0,wt),Te.fill(0,wt)),{selectedIndices:ru(_e,"int32"),selectedScores:ru(Te,"float32"),numValidOutputs:kr(wt,"int32")}}function Vi(b,h,c){var m=b.subarray(4*h,4*h+4),w=b.subarray(4*c,4*c+4),R=Math.min(m[0],m[2]),K=Math.min(m[1],m[3]),ee=Math.max(m[0],m[2]),le=Math.max(m[1],m[3]),de=Math.min(w[0],w[2]),_e=Math.min(w[1],w[3]),Te=Math.max(w[0],w[2]),Ne=Math.max(w[1],w[3]),Fe=(ee-R)*(le-K),He=(Te-de)*(Ne-_e);if(Fe<=0||He<=0)return 0;var Ye=Math.max(R,de),Ke=Math.max(K,_e),it=Math.min(ee,Te),gt=Math.min(le,Ne),wt=Math.max(it-Ye,0)*Math.max(gt-Ke,0);return wt/(Fe+He-wt)}function Ui(b,h,c){var m=Math.exp(h*c*c);return c<=b?m:0}function So(b,h){return b.score-h.score||b.score===h.score&&h.boxIndex-b.boxIndex}function ya(b,h,c){var m=new Array(b.rank).fill(0),w=b.shape.slice();return h.map(function(R){w[c]=R;var K=b.slice(m,w);return m[c]+=R,K})}function wa(b,h){for(var c=new Array(b.rank),m=0;m<c.length;m++)c[m]=b.shape[m]*h[m];var w=Di(c,b.dtype);for(m=0;m<w.values.length;++m){for(var R=w.indexToLoc(m),K=new Array(b.rank),ee=0;ee<K.length;ee++)K[ee]=R[ee]%b.shape[ee];var le=b.locToIndex(K);w.values[m]=b.values[le]}return w.toTensor()}function ha(b,h,c,m,w){for(var R=h[h.length-1],K=[b.length/R,R],ee=K[0],le=K[1],de=Rn(c,ee*m),_e=Rn("int32",ee*m),Te=0;Te<ee;Te++){for(var Ne=Te*le,Fe=b.subarray(Ne,Ne+le),He=[],Ye=0;Ye<Fe.length;Ye++)He.push({value:Fe[Ye],index:Ye});He.sort(function(At,zt){return zt.value-At.value});var Ke=Te*m,it=de.subarray(Ke,Ke+m),gt=_e.subarray(Ke,Ke+m);for(Ye=0;Ye<m;Ye++)it[Ye]=He[Ye].value,gt[Ye]=He[Ye].index}var wt=h.slice();return wt[wt.length-1]=m,[To(de,wt,c),To(_e,wt,"int32")]}function oa(b,h){for(var c=[],m=0;m<h.length;m++)h[m]&&c.push(m);var w=Di(b,"int32"),R=Di([c.length,b.length],"int32");for(m=0;m<c.length;m++){var K=w.indexToLoc(c[m]),ee=m*b.length;R.values.set(K,ee)}return R.toTensor()}function ls(b,h){return["x","y","z","w","u","v"].slice(0,h).map(function(c){return b+"."+c})}function _a(b,h){return h===1?[b]:ls(b,h)}function ko(){var b,h,c,m,w,R,K,ee,le,de;return z().getNumber("WEBGL_VERSION")===2?(b="#version 300 es",h="in",c="out",m="in",w="texture",R="outputColor",K="out vec4 outputColor;",ee=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,le="",de=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(b="",h="attribute",c="varying",m="varying",w="texture2D",R="gl_FragColor",K="",ee=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,le=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,de=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:b,attribute:h,varyingVs:c,varyingFs:m,texture2D:w,output:R,defineOutput:K,defineSpecialNaN:ee,defineSpecialInf:le,defineRound:de}}function Ma(b,h,c){c===void 0&&(c="index");var m=rn(h);return m.map(function(w,R){return"int "+b[R]+" = "+c+" / "+w+"; "+(R===m.length-1?"int "+b[R+1]+" = "+c+" - "+b[R]+" * "+w:"index -= "+b[R]+" * "+w)+";"}).join("")}function Ku(b){var h=rn(b).map(function(c){return c.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+h[0]+" + coords.y * "+h[1]+` + coords.z;
  }
`}var Es=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function Ha(b,h,c,m){var w=[];b.forEach(function(Fe){var He=ze(Fe.shapeInfo.logicalShape);Fe.shapeInfo.isUniform?w.push("uniform float "+Fe.name+(He>1?"["+He+"]":"")+";"):(w.push("uniform sampler2D "+Fe.name+";"),w.push("uniform int offset"+Fe.name+";"))});var R,K,ee=w.join(`
`),le=b.map(function(Fe){return function(He,Ye,Ke){Ke===void 0&&(Ke=!1);var it="";it+=Ke?function At(zt){var an,dn,sn;switch(zt.shapeInfo.logicalShape.length){case 0:return an=zt.name,dn="get"+an.charAt(0).toUpperCase()+an.slice(1),sn=ko(),`
    vec4 `+dn+`() {
      return `+sn.texture2D+"("+an+`, halfCR);
    }
  `;case 1:return function(ln){var Tn=ln.name,Bn="get"+Tn.charAt(0).toUpperCase()+Tn.slice(1),In=ln.shapeInfo.texShape,or=[Math.ceil(In[0]/2),Math.ceil(In[1]/2)],fr=ko();return`
    vec4 `+Bn+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+or[0]+", "+or[1]+`, index);
      return `+fr.texture2D+"("+Tn+`, uv);
    }
  `}(zt);case 2:return function(ln){var Tn=ln.shapeInfo.logicalShape,Bn=ln.name,In="get"+Bn.charAt(0).toUpperCase()+Bn.slice(1),or=ln.shapeInfo.texShape,fr=or[0],br=or[1],_r=ko();if(or!=null&&Ut(Tn,or))return`
      vec4 `+In+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+br+".0, "+fr+`.0);

        return `+_r.texture2D+"("+Bn+`, uv);
      }
    `;var xr=[Math.ceil(or[0]/2),Math.ceil(or[1]/2)],vr=Math.ceil(Tn[1]/2);return`
    vec4 `+In+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+vr+", "+xr[0]+", "+xr[1]+`, row, col);
      return `+_r.texture2D+"("+Bn+`, uv);
    }
  `}(zt);case 3:return function(ln){var Tn=ln.shapeInfo.logicalShape,Bn=ln.name,In="get"+Bn.charAt(0).toUpperCase()+Bn.slice(1),or=ln.shapeInfo.texShape,fr=[Math.ceil(or[0]/2),Math.ceil(or[1]/2)];if(Tn[0]===1){var br=Tn.slice(1),_r=Bs(ln,br);return`
        `+At(_r)+`
        vec4 `+In+`(int b, int row, int col) {
          return `+In+"("+Ss(["b","row","col"],[1,2])+`);
        }
      `}var xr=fr[0],vr=fr[1],Pr=Math.ceil(Tn[2]/2),Rr=Pr*Math.ceil(Tn[1]/2),Qr=ko();return`
    vec4 `+In+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+xr+", "+vr+", "+Rr+", "+Pr+`, b, row, col);
      return `+Qr.texture2D+"("+Bn+`, uv);
    }
  `}(zt);default:return function(ln){for(var Tn=ln.shapeInfo.logicalShape,Bn=Tn.length,In=ln.name,or="get"+In.charAt(0).toUpperCase()+In.slice(1),fr=ln.shapeInfo.texShape,br=[Math.ceil(fr[0]/2),Math.ceil(fr[1]/2)],_r=br[0],xr=br[1],vr=Math.ceil(Tn[Bn-1]/2),Pr=vr*Math.ceil(Tn[Bn-2]/2),Rr="int b, int row, int col",Qr="b * "+Pr+" + (row / 2) * "+vr+" + (col / 2)",fi=2;fi<Bn-1;fi++)Rr="int b"+fi+", "+Rr,Pr*=Tn[Bn-fi-1],Qr="b"+fi+" * "+Pr+" + "+Qr;var Ci=ko();return`
    vec4 `+or+"("+Rr+`) {
      int index = `+Qr+`;
      int texR = index / `+xr+`;
      int texC = index - texR * `+xr+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+xr+", "+_r+`);
      return `+Ci.texture2D+"("+In+`, uv);
    }
  `}(zt)}}(He):function At(zt){var an=zt.shapeInfo.logicalShape;switch(an.length){case 0:return function(dn){var sn=dn.name,ln="get"+sn.charAt(0).toUpperCase()+sn.slice(1);if(dn.shapeInfo.isUniform)return"float "+ln+"() {return "+sn+";}";var Tn=dn.shapeInfo.texShape,Bn=Tn[0],In=Tn[1];if(Bn===1&&In===1)return`
      float `+ln+`() {
        return sampleTexture(`+sn+`, halfCR);
      }
    `;var or=dn.shapeInfo.texShape,fr=or[0],br=or[1],_r=aa(sn);return`
    float `+ln+`() {
      vec2 uv = uvFromFlat(`+fr+", "+br+", "+_r+`);
      return sampleTexture(`+sn+`, uv);
    }
  `}(zt);case 1:return function(dn){var sn=dn.name,ln="get"+sn.charAt(0).toUpperCase()+sn.slice(1);if(dn.shapeInfo.isUniform)return`
      float `+ln+`(int index) {
        `+Xs(dn)+`
      }
    `;var Tn=dn.shapeInfo.texShape,Bn=Tn[0],In=Tn[1];if(In===1&&Bn===1)return`
      float `+ln+`(int index) {
        return sampleTexture(`+sn+`, halfCR);
      }
    `;var or=aa(sn);return In===1?`
      float `+ln+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+or+") + 0.5) / "+Bn+`.0);
        return sampleTexture(`+sn+`, uv);
      }
    `:Bn===1?`
      float `+ln+`(int index) {
        vec2 uv = vec2((float(index + `+or+") + 0.5) / "+In+`.0, 0.5);
        return sampleTexture(`+sn+`, uv);
      }
    `:`
    float `+ln+`(int index) {
      vec2 uv = uvFromFlat(`+Bn+", "+In+", index + "+or+`);
      return sampleTexture(`+sn+`, uv);
    }
  `}(zt);case 2:return function(dn){var sn=dn.shapeInfo.logicalShape,ln=dn.name,Tn="get"+ln.charAt(0).toUpperCase()+ln.slice(1),Bn=dn.shapeInfo.texShape;if(Bn!=null&&Ut(sn,Bn)){var In=Bn[0],or=Bn[1];return`
    float `+Tn+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+or+".0, "+In+`.0);
      return sampleTexture(`+ln+`, uv);
    }
  `}var fr=Fn(sn),br=fr.newShape,_r=fr.keptDims,xr=br;if(xr.length<sn.length){var vr=Bs(dn,xr);return`
      `+At(vr)+`
      float `+Tn+`(int row, int col) {
        return `+Tn+"("+Ss(["row","col"],_r)+`);
      }
    `}if(dn.shapeInfo.isUniform)return`
      float `+Tn+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+sn[1]+`, 1)));
        `+Xs(dn)+`
      }
    `;var Pr=Bn[0],Rr=Bn[1],Qr=aa(ln);return Rr===1?`
    float `+Tn+`(int row, int col) {
      float index = dot(vec3(row, col, `+Qr+"), vec3("+sn[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+Pr+`.0);
      return sampleTexture(`+ln+`, uv);
    }
  `:Pr===1?`
    float `+Tn+`(int row, int col) {
      float index = dot(vec3(row, col, `+Qr+"), vec3("+sn[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+Rr+`.0, 0.5);
      return sampleTexture(`+ln+`, uv);
    }
  `:`
  float `+Tn+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+sn[1]+" + col + "+Qr+`;
    vec2 uv = uvFromFlat(`+Pr+", "+Rr+`, index);
    return sampleTexture(`+ln+`, uv);
  }
`}(zt);case 3:return function(dn){var sn=dn.shapeInfo.logicalShape,ln=dn.name,Tn="get"+ln.charAt(0).toUpperCase()+ln.slice(1),Bn=sn[1]*sn[2],In=sn[2],or=Fn(sn),fr=or.newShape,br=or.keptDims,_r=fr;if(_r.length<sn.length){var xr=Bs(dn,_r);return`
        `+At(xr)+`
        float `+Tn+`(int row, int col, int depth) {
          return `+Tn+"("+Ss(["row","col","depth"],br)+`);
        }
      `}if(dn.shapeInfo.isUniform)return`
      float `+Tn+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+Bn+", "+In+`, 1)));
        `+Xs(dn)+`
      }
    `;var vr=dn.shapeInfo.texShape,Pr=vr[0],Rr=vr[1],Qr=dn.shapeInfo.flatOffset;if(Rr===Bn&&Qr==null)return`
        float `+Tn+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+In+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+Rr+".0, "+Pr+`.0);
          return sampleTexture(`+ln+`, uv);
        }
      `;if(Rr===In&&Qr==null)return`
    float `+Tn+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+sn[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+Rr+".0, "+Pr+`.0);
      return sampleTexture(`+ln+`, uv);
    }
  `;var fi=aa(ln);return`
      float `+Tn+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+Bn+" + col * "+In+" + depth + "+fi+`;
        vec2 uv = uvFromFlat(`+Pr+", "+Rr+`, index);
        return sampleTexture(`+ln+`, uv);
      }
  `}(zt);case 4:return function(dn){var sn=dn.shapeInfo.logicalShape,ln=dn.name,Tn="get"+ln.charAt(0).toUpperCase()+ln.slice(1),Bn=sn[3],In=sn[2]*Bn,or=sn[1]*In,fr=Fn(sn),br=fr.newShape,_r=fr.keptDims;if(br.length<sn.length){var xr=Bs(dn,br);return`
      `+At(xr)+`
      float `+Tn+`(int row, int col, int depth, int depth2) {
        return `+Tn+"("+Ss(["row","col","depth","depth2"],_r)+`);
      }
    `}if(dn.shapeInfo.isUniform)return`
      float `+Tn+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+or+", "+In+", "+Bn+`, 1)));
        `+Xs(dn)+`
      }
    `;var vr=dn.shapeInfo.flatOffset,Pr=dn.shapeInfo.texShape,Rr=Pr[0],Qr=Pr[1];if(Qr===or&&vr==null)return`
      float `+Tn+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+In+", "+Bn+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+Qr+".0, "+Rr+`.0);
        return sampleTexture(`+ln+`, uv);
      }
    `;if(Qr===Bn&&vr==null)return`
      float `+Tn+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+sn[1]*sn[2]+", "+sn[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+Qr+".0, "+Rr+`.0);
        return sampleTexture(`+ln+`, uv);
      }
    `;var fi=aa(ln);return`
    float `+Tn+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+or+" + col * "+In+` +
          depth * `+Bn+` + depth2;
      vec2 uv = uvFromFlat(`+Rr+", "+Qr+", index + "+fi+`);
      return sampleTexture(`+ln+`, uv);
    }
  `}(zt);case 5:return function(dn){var sn=dn.shapeInfo.logicalShape,ln=dn.name,Tn="get"+ln.charAt(0).toUpperCase()+ln.slice(1),Bn=sn[4],In=sn[3]*Bn,or=sn[2]*In,fr=sn[1]*or,br=Fn(sn),_r=br.newShape,xr=br.keptDims;if(_r.length<sn.length){var vr=Bs(dn,_r);return`
      `+At(vr)+`
      float `+Tn+`(int row, int col, int depth, int depth2, int depth3) {
        return `+Tn+"("+Ss(["row","col","depth","depth2","depth3"],xr)+`);
      }
    `}if(dn.shapeInfo.isUniform)return`
      float `+Tn+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+fr+", "+or+", "+In+", "+Bn+`)) +
          depth3;
        `+Xs(dn)+`
      }
    `;var Pr=dn.shapeInfo.flatOffset,Rr=dn.shapeInfo.texShape,Qr=Rr[0],fi=Rr[1];if(fi===fr&&Pr==null)return`
      float `+Tn+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+or+", "+In+", "+Bn+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+fi+".0, "+Qr+`.0);
        return sampleTexture(`+ln+`, uv);
      }
    `;if(fi===Bn&&Pr==null)return`
      float `+Tn+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+sn[1]*sn[2]*sn[3]+`,
               `+sn[2]*sn[3]+", "+sn[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+fi+".0, "+Qr+`.0);
        return sampleTexture(`+ln+`, uv);
      }
    `;var Ci=aa(ln);return`
    float `+Tn+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+fr+" + col * "+or+" + depth * "+In+` +
          depth2 * `+Bn+" + depth3 + "+Ci+`;
      vec2 uv = uvFromFlat(`+Qr+", "+fi+`, index);
      return sampleTexture(`+ln+`, uv);
    }
  `}(zt);case 6:return function(dn){var sn=dn.shapeInfo.logicalShape,ln=dn.name,Tn="get"+ln.charAt(0).toUpperCase()+ln.slice(1),Bn=Fn(sn),In=Bn.newShape,or=Bn.keptDims;if(In.length<sn.length){var fr=Bs(dn,In);return`
      `+At(fr)+`
      float `+Tn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+Tn+"("+Ss(["row","col","depth","depth2","depth3","depth4"],or)+`);
      }
    `}var br=sn[5],_r=sn[4]*br,xr=sn[3]*_r,vr=sn[2]*xr,Pr=sn[1]*vr;if(dn.shapeInfo.isUniform)return`
      float `+Tn+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+Pr+", "+vr+", "+xr+", "+_r+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+br+`, 1)));
        `+Xs(dn)+`
      }
    `;var Rr=dn.shapeInfo.flatOffset,Qr=dn.shapeInfo.texShape,fi=Qr[0],Ci=Qr[1];if(Ci===Pr&&Rr==null)return`
      float `+Tn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+vr+", "+xr+", "+_r+", "+br+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+Ci+".0, "+fi+`.0);
        return sampleTexture(`+ln+`, uv);
      }
    `;if(Ci===br&&Rr==null)return`
      float `+Tn+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+sn[1]*sn[2]*sn[3]*sn[4]+`,
               `+sn[2]*sn[3]*sn[4]+`,
               `+sn[3]*sn[4]+`,
               `+sn[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+Ci+".0, "+fi+`.0);
        return sampleTexture(`+ln+`, uv);
      }
    `;var bo=aa(ln);return`
    float `+Tn+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+Pr+" + col * "+vr+" + depth * "+xr+` +
          depth2 * `+_r+" + depth3 * "+br+" + depth4 + "+bo+`;
      vec2 uv = uvFromFlat(`+fi+", "+Ci+`, index);
      return sampleTexture(`+ln+`, uv);
    }
  `}(zt);default:throw new Error(an.length+"-D input sampling is not yet supported")}}(He);var gt=He.shapeInfo.logicalShape,wt=Ye.logicalShape;return gt.length<=wt.length&&(it+=Ke?function(At,zt){var an,dn=At.name,sn=dn.charAt(0).toUpperCase()+dn.slice(1),ln="get"+sn+"AtOutCoords",Tn=At.shapeInfo.logicalShape.length,Bn=zt.logicalShape.length,In=La(At.shapeInfo.logicalShape,zt.logicalShape),or=jo(Bn),fr=Bn-Tn,br=["x","y","z","w","u","v"];an=Tn===0?"":Bn<2&&In.length>=1?"coords = 0;":In.map(function(fi){return"coords."+br[fi+fr]+" = 0;"}).join(`
`);var _r;_r=Bn<2&&Tn>0?"coords":At.shapeInfo.logicalShape.map(function(fi,Ci){return"coords."+br[Ci+fr]}).join(", ");var xr="return outputValue;",vr=ze(At.shapeInfo.logicalShape)===1,Pr=ze(zt.logicalShape)===1;if(Tn!==1||vr||Pr){if(vr&&!Pr)xr=Bn===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(In.length){var Rr=Tn-2,Qr=Tn-1;In.indexOf(Rr)>-1&&In.indexOf(Qr)>-1?xr="return vec4(outputValue.x);":In.indexOf(Rr)>-1?xr="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":In.indexOf(Qr)>-1&&(xr="return vec4(outputValue.xx, outputValue.zz);")}}else xr=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+ln+`() {
      `+or+` coords = getOutputCoords();
      `+an+`
      vec4 outputValue = get`+sn+"("+_r+`);
      `+xr+`
    }
  `}(He,Ye):function(At,zt){var an=At.name,dn=an.charAt(0).toUpperCase()+an.slice(1),sn="get"+dn+"AtOutCoords",ln=zt.texShape,Tn=At.shapeInfo.texShape,Bn=At.shapeInfo.logicalShape.length,In=zt.logicalShape.length;if(!At.shapeInfo.isUniform&&Bn===In&&At.shapeInfo.flatOffset==null&&Ut(Tn,ln))return`
      float `+sn+`() {
        return sampleTexture(`+an+`, resultUV);
      }
    `;var or=jo(In),fr=La(At.shapeInfo.logicalShape,zt.logicalShape),br=In-Bn,_r=["x","y","z","w","u","v"];return`
    float `+sn+`() {
      `+or+` coords = getOutputCoords();
      `+(Bn===0?"":In<2&&fr.length>=1?"coords = 0;":fr.map(function(xr){return"coords."+_r[xr+br]+" = 0;"}).join(`
`))+`
      return get`+dn+"("+(In<2&&Bn>0?"coords":At.shapeInfo.logicalShape.map(function(xr,vr){return"coords."+_r[vr+br]}).join(", "))+`);
    }
  `}(He,Ye)),it}(Fe,h,m)}).join(`
`),de=h.texShape,_e=ko(),Te=`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+_e.texture2D+`(textureSampler, uv).r;
    }
  `,Ne=function(Fe){return Fe.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+Fe.varyingFs+` vec2 resultUV;
    `+Fe.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+Fe.defineSpecialNaN+`
    `+Fe.defineSpecialInf+`
    `+Fe.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+Bo+`
    `+Rc+`
    `+lu+`
  `}(_e);return h.isPacked?(R=function(Fe,He){switch(Fe.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(At,zt){var an=[Math.ceil(zt[0]/2),Math.ceil(zt[1]/2)];return an[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+an[1]+`.0);
      }
    `:an[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+an[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+an[0]+", "+an[1]+`));
      return 2 * (resTexRC.x * `+an[1]+` + resTexRC.y);
    }
  `}(0,He);case 2:return function(At,zt){var an=[Math.ceil(zt[0]/2),Math.ceil(zt[1]/2)];if(Ut(At,zt))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+an[0]+", "+an[1]+`));
      }
    `;var dn=Math.ceil(At[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+an[0]+", "+an[1]+`));

      int index = resTexRC.x * `+an[1]+` + resTexRC.y;
      int r = 2 * (index / `+dn+`);
      int c = imod(index, `+dn+`) * 2;

      return ivec2(r, c);
    }
  `}(Fe,He);case 3:return Ye=Fe,Ke=He,it=[Math.ceil(Ke[0]/2),Math.ceil(Ke[1]/2)],wt=(gt=Math.ceil(Ye[2]/2))*Math.ceil(Ye[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+it[0]+", "+it[1]+`));
      int index = resTexRC.x * `+it[1]+` + resTexRC.y;

      int b = index / `+wt+`;
      index -= b * `+wt+`;

      int r = 2 * (index / `+gt+`);
      int c = imod(index, `+gt+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(At,zt){for(var an=[Math.ceil(zt[0]/2),Math.ceil(zt[1]/2)],dn=Math.ceil(At[At.length-1]/2),sn=dn*Math.ceil(At[At.length-2]/2),ln=sn,Tn="",Bn="b, r, c",In=2;In<At.length-1;In++)Tn=`
      int b`+In+" = index / "+(ln*=At[At.length-In-1])+`;
      index -= b`+In+" * "+ln+`;
    `+Tn,Bn="b"+In+", "+Bn;return`
    ivec`+At.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+an[0]+", "+an[1]+`));
      int index = resTexRC.x * `+an[1]+` + resTexRC.y;

      `+Tn+`

      int b = index / `+sn+`;
      index -= b * `+sn+`;

      int r = 2 * (index / `+dn+`);
      int c = imod(index, `+dn+`) * 2;

      return ivec`+At.length+"("+Bn+`);
    }
  `}(Fe,He)}var Ye,Ke,it,gt,wt}(h.logicalShape,de),K=`
    void setOutput(vec4 val) {
      `+_e.output+` = val;
    }
  `):(R=function(Fe,He){switch(Fe.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(it,gt){return gt[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+gt[1]+`.0);
      }
    `:gt[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+gt[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+gt[0]+", "+gt[1]+`));
      return resTexRC.x * `+gt[1]+` + resTexRC.y;
    }
  `}(0,He);case 2:return function(it,gt){return Ut(it,gt)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+gt[0]+", "+gt[1]+`));
      }
    `:it[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+gt[0]+", "+gt[1]+`));
        int index = resTexRC.x * `+gt[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:it[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+gt[0]+", "+gt[1]+`));
        int index = resTexRC.x * `+gt[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+gt[0]+", "+gt[1]+`));
      int index = resTexRC.x * `+gt[1]+` + resTexRC.y;
      int r = index / `+it[1]+`;
      int c = index - r * `+it[1]+`;
      return ivec2(r, c);
    }
  `}(Fe,He);case 3:return Ye=He,Ke=Ma(["r","c","d"],Fe),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Ye[0]+", "+Ye[1]+`));
      int index = resTexRC.x * `+Ye[1]+` + resTexRC.y;
      `+Ke+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(it,gt){var wt=Ma(["r","c","d","d2"],it);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+gt[0]+", "+gt[1]+`));
      int index = resTexRC.x * `+gt[1]+` + resTexRC.y;
      `+wt+`
      return ivec4(r, c, d, d2);
    }
  `}(Fe,He);case 5:return function(it,gt){var wt=Ma(["r","c","d","d2","d3"],it);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+gt[0]+`,
                             `+gt[1]+`));

      int index = resTexRC.x * `+gt[1]+` + resTexRC.y;

      `+wt+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(Fe,He);case 6:return function(it,gt){var wt=Ma(["r","c","d","d2","d3","d4"],it);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+gt[0]+", "+gt[1]+`));
      int index = resTexRC.x * `+gt[1]+` + resTexRC.y;

      `+wt+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(Fe,He);default:throw new Error(Fe.length+"-D output sampling is not yet supported")}var Ye,Ke}(h.logicalShape,de),K=`
    void setOutput(float val) {
      `+_e.output+` = vec4(val, 0, 0, 0);
    }
  `),m&&(Ne+=$s),[Ne,Te,K,ee,R,le,c].join(`
`)}var Bo=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Rc=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,lu=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,$s=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function aa(b){return"offset"+b}function Xs(b){var h=b.name,c=ze(b.shapeInfo.logicalShape);return c<2?"return "+h+";":`
    for (int i = 0; i < `+c+`; i++) {
      if (i == index) {
        return `+h+`[i];
      }
    }
  `}function jo(b){if(b<=1)return"int";if(b===2)return"ivec2";if(b===3)return"ivec3";if(b===4)return"ivec4";if(b===5)return"ivec5";if(b===6)return"ivec6";throw Error("GPU for rank "+b+" is not yet supported")}function Bs(b,h){var c=JSON.parse(JSON.stringify(b));return c.shapeInfo.logicalShape=h,c}function Ss(b,h){return h.map(function(c){return b[c]}).join(", ")}var go=function(b,h,c){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=qi(h,c),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+b+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},js="return a + b;",ns="return a - b;",fu="return a * b;",il="return (a < 0.) ? b * a : a;",$o=function(b,h,c){this.variableNames=["A","B"],this.outputShape=qi(h,c),this.userCode=`
      float binaryOperation(float a, float b) {
        `+b+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},fs=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Ga=function(b,h,c,m){m===void 0&&(m=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=qi(h,c);var w=this.outputShape.length,R="";if(m)if(w===0||ze(this.outputShape)===1)R=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(R=`
          `+jo(w)+` coords = getOutputCoords();
        `,w===1)R+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var K=_a("coords",w);R+=`
            bool nextRowOutOfBounds =
              (`+K[w-2]+" + 1) >= "+this.outputShape[w-2]+`;
            bool nextColOutOfBounds =
              (`+K[w-1]+" + 1) >= "+this.outputShape[w-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+b+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+R+`

        setOutput(result);
      }
    `},Pc=function(){function b(h){this.variableNames=["A"],this.outputShape=h,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return b.prototype.getCustomSetupFunc=function(h,c){var m=this;return function(w,R){m.minLoc==null&&(m.minLoc=w.getUniformLocationNoThrow(R,"minVal"),m.maxLoc=w.getUniformLocationNoThrow(R,"maxVal")),w.gl.uniform1f(m.minLoc,h),w.gl.uniform1f(m.maxLoc,c)}},b}(),Rl=function(){function b(h){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=h,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return b.prototype.getCustomSetupFunc=function(h,c){var m=this;return function(w,R){m.minLoc==null&&(m.minLoc=w.getUniformLocationNoThrow(R,"minVal"),m.maxLoc=w.getUniformLocationNoThrow(R,"maxVal")),w.gl.uniform1f(m.minLoc,h),w.gl.uniform1f(m.maxLoc,c)}},b}();function wi(b,h,c){var m=b.indexOf(h);return b.map(function(w,R){return R===m?w+" - "+c:w}).join()}var tm=function(b,h,c,m){h===void 0&&(h=!1),c===void 0&&(c=null),m===void 0&&(m=!1),this.variableNames=["x","W"],this.outputShape=b.outShape;var w=b.padInfo.top,R=b.padInfo.left,K=b.strideHeight,ee=b.strideWidth,le=b.dilationHeight,de=b.dilationWidth,_e=b.filterHeight,Te=b.filterWidth,Ne=4*Math.floor(b.inChannels/4),Fe=b.inChannels%4,He=b.dataFormat==="channelsLast",Ye=He?1:2,Ke=He?2:3,it=He?3:1,gt="",wt="";c&&(gt=m?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+c+`
        }`:`
          float activation(float x) {
            `+c+`
          }
        `,wt="result = activation(result);");var At=h?"result += getBiasAtOutCoords();":"";h&&this.variableNames.push("bias"),m&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+gt+`

      const ivec2 strides = ivec2(`+K+", "+ee+`);
      const ivec2 pads = ivec2(`+w+", "+R+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+it+`];

        ivec2 xRCCorner =
            ivec2(coords[`+Ye+"], coords["+Ke+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+_e+`; wR++) {
          int xR = xRCorner + wR * `+le+`;

          if (xR < 0 || xR >= `+b.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+Te+`; wC++) {
            int xC = xCCorner + wC * `+de+`;

            if (xC < 0 || xC >= `+b.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+Ne+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+He+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(Fe===1)+`) {

              if (`+He+`) {
                dotProd +=
                    getX(batch, xR, xC, `+Ne+`) *
                    getW(wR, wC, `+Ne+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+Ne+`, xR, xC) *
                    getW(wR, wC, `+Ne+`, d2);
              }

            } else if (`+(Fe===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+Ne+`, d2),
                getW(wR, wC, `+Ne+` + 1, d2)
              );

              if (`+He+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+Ne+`),
                  getX(batch, xR, xC, `+Ne+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+Ne+`, xR, xC),
                  getX(batch, `+Ne+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(Fe===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+Ne+`, d2),
                getW(wR, wC, `+Ne+` + 1, d2),
                getW(wR, wC, `+Ne+` + 2, d2)
              );

              if (`+He+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+Ne+`),
                  getX(batch, xR, xC, `+Ne+` + 1),
                  getX(batch, xR, xC, `+Ne+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+Ne+`, xR, xC),
                  getX(batch, `+Ne+` + 1, xR, xC),
                  getX(batch, `+Ne+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+At+`
        `+wt+`
        setOutput(result);
      }
    `},Pl=function(b,h,c,m){h===void 0&&(h=!1),c===void 0&&(c=null),m===void 0&&(m=!1),this.variableNames=["x","W"],this.outputShape=b.outShape;var w=b.inHeight,R=b.inWidth,K=b.padInfo.top,ee=b.padInfo.left,le=b.strideHeight,de=b.strideWidth,_e=b.dilationHeight,Te=b.dilationWidth,Ne=b.filterHeight,Fe=b.filterWidth,He=b.outChannels/b.inChannels,Ye="",Ke="";c&&(Ye=m?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+c+`
        }`:`
          float activation(float x) {
            `+c+`
          }
        `,Ke="result = activation(result);");var it=h?"result += getBiasAtOutCoords();":"";h&&this.variableNames.push("bias"),m&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+Ye+`

      const ivec2 strides = ivec2(`+le+", "+de+`);
      const ivec2 pads = ivec2(`+K+", "+ee+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+He+`;
        int q = d2 - d1 * `+He+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+Ne+`; wR++) {
          int xR = xRCorner + wR * `+_e+`;

          if (xR < 0 || xR >= `+w+`) {
            continue;
          }

          for (int wC = 0; wC < `+Fe+`; wC++) {
            int xC = xCCorner + wC * `+Te+`;

            if (xC < 0 || xC >= `+R+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+it+`
        `+Ke+`
        setOutput(result);
      }
    `},Sf=function(b,h,c,m){h===void 0&&(h=!1),c===void 0&&(c=null),m===void 0&&(m=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=b.outShape;for(var w=b.inHeight,R=b.inWidth,K=b.padInfo.top,ee=b.padInfo.left,le=b.strideHeight,de=b.strideWidth,_e=b.dilationHeight,Te=b.dilationWidth,Ne=b.filterHeight,Fe=b.filterWidth,He=Fe,Ye="int xR; int xC; int xCOffset;",Ke=0;Ke<Ne;Ke++)for(var it=0;it<Fe;it++)Ye+=`
          vec4 xTexelR`+Ke+"C"+2*it+` = vec4(0.);
          vec4 wR`+Ke+"C"+it+` = vec4(0.);
          vec4 xR`+Ke+"C"+it+" = vec4(0.);";for(Ke=0;Ke<Ne;Ke++)for(var gt=0;gt<He;gt++){if(Ye+=`
          xR = xRCorner + `+Ke*_e+`;
          xC = xCCorner + `+(it=2*gt)*Te+`;
        `,de===1){if(it<Fe&&(Ye+=ee%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+w+" && xCOffset >= 0 && xCOffset < "+R+`) {
                  xTexelR`+Ke+"C"+it+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+R+`) {
                    xTexelR`+Ke+"C"+it+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+Ke+"C"+it+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+w+" && xCOffset >= 0 && xCOffset < "+R+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+R+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+Ke+"C"+it+" = vec4(previous.zw, xTexelR"+Ke+"C"+it+`.xy);
                } else {
                  xR`+Ke+"C"+it+" = vec4(0, 0, xTexelR"+Ke+"C"+it+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+w+" && xC >= 0 && xC < "+R+`) {
                  xTexelR`+Ke+"C"+it+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+Ke+"C"+it+` = vec4(0.);
                }

                xR`+Ke+"C"+it+" = xTexelR"+Ke+"C"+it+`;
              `,it+1<Fe)){var wt=ee%2==0?It(Te):Te;Te%2==0&&ee%2==1||Te%2!=0&&ee%2!=1?(Ye+=`
                  xCOffset = xC + `+ee%2+" + "+wt+`;

                  if(xR >= 0 && xR < `+w+` &&
                    xCOffset >= 0 && xCOffset < `+R+`) {
                    xTexelR`+Ke+"C"+(it+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,Te>1&&(Ye+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+w+` &&
                      xCOffset >= 0 && xCOffset < `+R+`) {
                      xTexelR`+Ke+"C"+it+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+Ke+"C"+it+` = vec4(0.);
                    }
                  `),Ye+=`
                  xR`+Ke+"C"+(it+1)+` = vec4(
                    xTexelR`+Ke+"C"+it+".zw, xTexelR"+Ke+"C"+(it+2)+`.xy);
                `):Ye+=`
                  xCOffset = xC + `+wt+`;

                  if(xR >= 0 && xR < `+w+` &&
                    xCOffset >= 0 && xCOffset < `+R+`) {
                    xTexelR`+Ke+"C"+(it+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+Ke+"C"+(it+1)+" = xTexelR"+Ke+"C"+(it+2)+`;
                `}}else it<Fe&&(Ye+=`
              if(xR >= 0 && xR < `+w+`) {
            `,ee%2==1?(Ye+=`
                xCOffset = xC + 1 - `+de+`;
                if(xCOffset >= 0 && xCOffset < `+R+`) {
                  xTexelR`+Ke+"C"+it+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+Ke+"C"+it+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+R+`) {
                  xTexelR`+Ke+"C"+(it+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+Ke+"C"+(it+2)+` = vec4(0.);
                }

                xR`+Ke+"C"+it+` = vec4(
                  xTexelR`+Ke+"C"+it+".zw, xTexelR"+Ke+"C"+(it+2)+`.zw);
              `,it+1<Fe&&(Ye+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+de+`;
                  if(xCOffset >= 0 && xCOffset < `+R+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+Ke+"C"+(it+1)+" = vec4(xTexelR"+Ke+"C"+(it+2)+`.xy, final.xy);
                `)):(Ye+=`
                if(xC >= 0 && xC < `+R+`) {
                  xTexelR`+Ke+"C"+it+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+Ke+"C"+it+` = vec4(0.);
                }

                xCOffset = xC + `+de+`;
                if(xCOffset >= 0 && xCOffset < `+R+`) {
                  xTexelR`+Ke+"C"+(it+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+Ke+"C"+(it+2)+` = vec4(0.);
                }

                xR`+Ke+"C"+it+` = vec4(
                  xTexelR`+Ke+"C"+it+".xy, xTexelR"+Ke+"C"+(it+2)+`.xy);
              `,it+1<Fe&&(Ye+=`
                  xR`+Ke+"C"+(it+1)+` = vec4(
                    xTexelR`+Ke+"C"+it+".zw, xTexelR"+Ke+"C"+(it+2)+`.zw);
                `)),Ye+="}");it<Fe&&(Ye+=`
            vec4 wTexelR`+Ke+"C"+it+" = getW("+Ke+", "+it+`, d1, q);
            wR`+Ke+"C"+it+" = vec4(wTexelR"+Ke+"C"+it+".xz, wTexelR"+Ke+"C"+it+`.xz);
          `,it+1<Fe&&(Ye+=`
              vec4 wTexelR`+Ke+"C"+(it+1)+" = getW("+Ke+", "+(it+1)+`, d1, q);
              wR`+Ke+"C"+(it+1)+` =
                vec4(wTexelR`+Ke+"C"+(it+1)+".xz, wTexelR"+Ke+"C"+(it+1)+".xz);"))}for(Ke=0;Ke<Ne;Ke++)for(it=0;it<Fe;it++)Ye+="dotProd += xR"+Ke+"C"+it+" * wR"+Ke+"C"+it+";";var At="",zt="";c&&(At=m?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+c+`
        }`:`vec4 activation(vec4 x) {
          `+c+`
        }`,zt="result = activation(result);");var an=h?"result += getBiasAtOutCoords();":"";h&&this.variableNames.push("bias"),m&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+At+`

      const ivec2 strides = ivec2(`+le+", "+de+`);
      const ivec2 pads = ivec2(`+K+", "+ee+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+Ye+`

        vec4 result = dotProd;
        `+an+`
        `+zt+`
        setOutput(result);
      }
    `};function rv(b,h){if(b===1)return""+h;if(b===2)return h+".y";if(b===3)return h+".z";if(b===4)return h+".w";throw Error("Cumulative sum for rank "+b+" is not yet supported")}var iv=function(){function b(h,c,m){this.variableNames=["x"],this.outputShape=[],this.outputShape=h,this.blockSize=c,this.dataFormat=m,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+c+`;
      int offset_h = imod(h, `+c+`);
      int in_w = w / `+c+`;
      int offset_w = imod(w, `+c+`);
      int offset_d = (offset_h * `+c+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return b.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},b.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},b.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},b.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},b.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},b}(),Yg=function(b,h,c){this.variableNames=["real","imag"];var m=h[1];this.outputShape=h;var w=c?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,R=c?m+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+w+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+b+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+m+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+m+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+R+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},Jg=function(){function b(h,c){this.outputShape=[],this.variableNames=["x"],this.outputShape=h,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return b.prototype.getCustomSetupFunc=function(h){var c=this;return function(m,w){c.valueLoc==null&&(c.valueLoc=m.getUniformLocationNoThrow(w,"value")),m.gl.uniform1f(c.valueLoc,h)}},b}();function ov(b,h){var c=ko();return eo(b,h,c.version+`
    precision highp float;
    `+c.attribute+` vec3 clipSpacePos;
    `+c.attribute+` vec2 uv;
    `+c.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function Qg(b,h){return Yc(b,h,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function av(b,h){return sc(b,h,new Uint16Array([0,1,2,2,1,3]))}function Od(b,h,c,m,w,R,K){Rp(c,m);var ee=Jc(b,h),le=b.TEXTURE_2D;return Kn(b,h,function(){return b.bindTexture(le,ee)}),Kn(b,h,function(){return b.texParameteri(le,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE)}),Kn(b,h,function(){return b.texParameteri(le,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE)}),Kn(b,h,function(){return b.texParameteri(le,b.TEXTURE_MIN_FILTER,b.NEAREST)}),Kn(b,h,function(){return b.texParameteri(le,b.TEXTURE_MAG_FILTER,b.NEAREST)}),Kn(b,h,function(){return b.texImage2D(le,0,w,c,m,0,R,K,null)}),Kn(b,h,function(){return b.bindTexture(b.TEXTURE_2D,null)}),ee}function nm(b,h,c,m,w){var R=Zi(c,m);return Od(b,h,R[0],R[1],w.internalFormatFloat,w.textureFormatFloat,b.FLOAT)}function sv(b,h,c,m,w){var R=Zi(c,m);return Od(b,h,R[0],R[1],w.internalFormatHalfFloat,w.textureFormatFloat,w.textureTypeHalfFloat)}function uv(b,h,c,m,w){var R=Zi(c,m);return Od(b,h,R[0],R[1],b.RGBA,b.RGBA,b.UNSIGNED_BYTE)}function cv(b,h,c,m,w){var R=ei(c,m);return Od(b,h,R[0],R[1],w.internalFormatPackedFloat,b.RGBA,b.FLOAT)}function ol(b,h,c,m,w){var R=ei(c,m);return Od(b,h,R[0],R[1],w.internalFormatPackedHalfFloat,b.RGBA,w.textureTypeHalfFloat)}function Td(b,h,c,m){return Kn(b,h,function(){return b.bindBuffer(b.ARRAY_BUFFER,m)}),sd(b,h,c,"clipSpacePos",m,3,20,0)&&sd(b,h,c,"uv",m,2,20,12)}function rm(b,h,c,m,w,R,K){var ee,le,de;Kn(b,h,function(){return b.bindTexture(b.TEXTURE_2D,c)}),R instanceof Uint8Array?(ee=new Uint8Array(m*w*4),le=b.UNSIGNED_BYTE,de=b.RGBA):(ee=new Float32Array(m*w*4),le=b.FLOAT,de=K.internalFormatPackedFloat),ee.set(R),Kn(b,h,function(){return b.texImage2D(b.TEXTURE_2D,0,de,m,w,0,b.RGBA,le,ee)}),Kn(b,h,function(){return b.bindTexture(b.TEXTURE_2D,null)})}function Zg(b,h,c,m){Kn(b,h,function(){return b.bindTexture(b.TEXTURE_2D,c)}),m.data instanceof Uint8Array?Kn(b,h,function(){return b.texImage2D(b.TEXTURE_2D,0,b.RGBA,m.width,m.height,0,b.RGBA,b.UNSIGNED_BYTE,m.data)}):Kn(b,h,function(){return b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,m)}),Kn(b,h,function(){return b.bindTexture(b.TEXTURE_2D,null)})}function e0(b,h,c,m,w){var R=b.createBuffer();Kn(b,h,function(){return b.bindBuffer(b.PIXEL_PACK_BUFFER,R)});var K=16*c*m;return Kn(b,h,function(){return b.bufferData(b.PIXEL_PACK_BUFFER,K,b.STREAM_READ)}),Kn(b,h,function(){return b.readPixels(0,0,m,c,b.RGBA,b.FLOAT,0)}),Kn(b,h,function(){return b.bindBuffer(b.PIXEL_PACK_BUFFER,null)}),R}function Sy(b,h,c){var m=b,w=new Float32Array(c);return m.bindBuffer(m.PIXEL_PACK_BUFFER,h),m.getBufferSubData(m.PIXEL_PACK_BUFFER,0,w),m.bindBuffer(m.PIXEL_PACK_BUFFER,null),w}function t0(b,h,c,m,w){var R=Zi(c,m),K=R[0],ee=R[1],le=new Uint8Array(c*m*4);return Kn(b,h,function(){return b.readPixels(0,0,K,ee,w.downloadTextureFormat,b.UNSIGNED_BYTE,le)}),new Float32Array(le.buffer)}function Uh(b,h,c,m,w,R,K,ee){var le=b,de=new Float32Array(function(_e,Te){var Ne=ei(R,K);return Ne[0]*Ne[1]*4}());return le.bindBuffer(le.PIXEL_PACK_BUFFER,h),le.getBufferSubData(le.PIXEL_PACK_BUFFER,0,de),le.bindBuffer(le.PIXEL_PACK_BUFFER,null),de}function Md(b,h,c,m){var w=new Float32Array(c*m*4);return Kn(b,h,function(){return b.readPixels(0,0,m,c,b.RGBA,b.FLOAT,w)}),w}var al=Object.freeze({createVertexShader:ov,createVertexBuffer:Qg,createIndexBuffer:av,createFloat32MatrixTexture:nm,createFloat16MatrixTexture:sv,createUnsignedBytesMatrixTexture:uv,createPackedMatrixTexture:cv,createFloat16PackedMatrixTexture:ol,bindVertexProgramAttributeStreams:Td,uploadDenseMatrixToTexture:rm,uploadPixelDataToTexture:Zg,createBufferFromOutputTexture:e0,downloadFloat32MatrixFromBuffer:Sy,downloadByteEncodedFloatMatrixFromOutputTexture:t0,downloadPackedMatrixFromBuffer:Uh,downloadMatrixFromPackedOutputTexture:Md}),n0=function(){function b(h){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var c=z().getNumber("WEBGL_VERSION");h!=null?(this.gl=h,ki(c,h)):this.gl=Zr(c);var m="WEBGL_color_buffer_float";if(z().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=zi(this.gl,this.debug,"OES_texture_float"),xa(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=zi(this.gl,this.debug,"OES_texture_half_float");else if(z().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(m),xa(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=zi(this.gl,this.debug,"EXT_color_buffer_half_float");else if(z().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(m="EXT_color_buffer_float",xa(this.gl,m))this.colorBufferFloatExtension=this.gl.getExtension(m);else{if(!xa(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Qg(this.gl,this.debug),this.indexBuffer=av(this.gl,this.debug),this.framebuffer=ys(this.gl,this.debug),this.textureConfig=Xr(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(b.prototype,"debug",{get:function(){return z().getBool("DEBUG")},enumerable:!0,configurable:!0}),b.prototype.dispose=function(){var h=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var c=this.gl;Kn(c,this.debug,function(){return c.finish()}),Kn(c,this.debug,function(){return c.bindFramebuffer(c.FRAMEBUFFER,null)}),Kn(c,this.debug,function(){return c.deleteFramebuffer(h.framebuffer)}),Kn(c,this.debug,function(){return c.bindBuffer(c.ARRAY_BUFFER,null)}),Kn(c,this.debug,function(){return c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,null)}),Kn(c,this.debug,function(){return c.deleteBuffer(h.indexBuffer)}),this.disposed=!0}},b.prototype.createFloat32MatrixTexture=function(h,c){return this.throwIfDisposed(),nm(this.gl,this.debug,h,c,this.textureConfig)},b.prototype.createFloat16MatrixTexture=function(h,c){return this.throwIfDisposed(),sv(this.gl,this.debug,h,c,this.textureConfig)},b.prototype.createUnsignedBytesMatrixTexture=function(h,c){return this.throwIfDisposed(),uv(this.gl,this.debug,h,c,this.textureConfig)},b.prototype.uploadPixelDataToTexture=function(h,c){this.throwIfDisposed(),Zg(this.gl,this.debug,h,c)},b.prototype.uploadDenseMatrixToTexture=function(h,c,m,w){this.throwIfDisposed(),rm(this.gl,this.debug,h,c,m,w,this.textureConfig)},b.prototype.createFloat16PackedMatrixTexture=function(h,c){return this.throwIfDisposed(),ol(this.gl,this.debug,h,c,this.textureConfig)},b.prototype.createPackedMatrixTexture=function(h,c){return this.throwIfDisposed(),cv(this.gl,this.debug,h,c,this.textureConfig)},b.prototype.deleteMatrixTexture=function(h){var c=this;this.throwIfDisposed(),this.outputTexture===h&&(uf(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Kn(this.gl,this.debug,function(){return c.gl.deleteTexture(h)})},b.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(h,c,m){var w=this;return this.downloadMatrixDriver(h,function(){return t0(w.gl,w.debug,c,m,w.textureConfig)})},b.prototype.downloadPackedMatrixFromBuffer=function(h,c,m,w,R,K){return Uh(this.gl,h,0,0,0,R,K,this.textureConfig)},b.prototype.downloadFloat32MatrixFromBuffer=function(h,c){return Sy(this.gl,h,c)},b.prototype.createBufferFromTexture=function(h,c,m){this.bindTextureToFrameBuffer(h);var w=e0(this.gl,this.debug,c,m,this.textureConfig);return this.unbindTextureToFrameBuffer(),w},b.prototype.createAndWaitForFence=function(){var h=this.createFence(this.gl);return this.pollFence(h)},b.prototype.createFence=function(h){var c,m,w=this;if(z().getBool("WEBGL_FENCE_API_ENABLED")){var R=h,K=R.fenceSync(R.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),m=function(){var ee=R.clientWaitSync(K,0,0);return ee===R.ALREADY_SIGNALED||ee===R.CONDITION_SATISFIED},c=K}else z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(c=this.beginQuery(),this.endQuery(),m=function(){return w.isQueryAvailable(c,z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):m=function(){return!0};return{query:c,isFencePassed:m}},b.prototype.downloadMatrixFromPackedTexture=function(h,c,m){var w=this;return this.downloadMatrixDriver(h,function(){return Md(w.gl,w.debug,c,m)})},b.prototype.createProgram=function(h){this.throwIfDisposed();var c=this.gl,m=wo(c,this.debug,h),w=ov(c,this.debug),R=to(c,this.debug);return Kn(c,this.debug,function(){return c.attachShader(R,w)}),Kn(c,this.debug,function(){return c.attachShader(R,m)}),Cc(c,this.debug,R),this.debug&&Uu(c,this.debug,R),this.vertexAttrsAreBound||(this.setProgram(R),this.vertexAttrsAreBound=Td(c,this.debug,this.program,this.vertexBuffer)),R},b.prototype.deleteProgram=function(h){var c=this;this.throwIfDisposed(),h===this.program&&(this.program=null),h!=null&&Kn(this.gl,this.debug,function(){return c.gl.deleteProgram(h)})},b.prototype.setProgram=function(h){var c=this;this.throwIfDisposed(),this.program=h,this.program!=null&&this.debug&&Uu(this.gl,this.debug,this.program),Kn(this.gl,this.debug,function(){return c.gl.useProgram(h)})},b.prototype.getUniformLocation=function(h,c,m){return m===void 0&&(m=!0),this.throwIfDisposed(),m?uc(this.gl,this.debug,h,c):ud(this.gl,h,c)},b.prototype.getAttributeLocation=function(h,c){var m=this;return this.throwIfDisposed(),Kn(this.gl,this.debug,function(){return m.gl.getAttribLocation(h,c)})},b.prototype.getUniformLocationNoThrow=function(h,c){return this.throwIfDisposed(),this.gl.getUniformLocation(h,c)},b.prototype.setInputMatrixTexture=function(h,c,m){this.throwIfDisposed(),this.throwIfNoProgram(),wh(this.gl,this.debug,this.program,h,c,m)},b.prototype.setOutputMatrixTexture=function(h,c,m){this.setOutputMatrixTextureDriver(h,m,c)},b.prototype.setOutputPackedMatrixTexture=function(h,c,m){this.throwIfDisposed();var w=ei(c,m),R=w[0],K=w[1];this.setOutputMatrixTextureDriver(h,R,K)},b.prototype.setOutputMatrixWriteRegion=function(h,c,m,w){this.setOutputMatrixWriteRegionDriver(m,h,w,c)},b.prototype.setOutputPackedMatrixWriteRegion=function(h,c,m,w){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},b.prototype.debugValidate=function(){this.program!=null&&Uu(this.gl,this.debug,this.program),Ua(this.gl)},b.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var h=this.gl;this.debug&&this.debugValidate(),Kn(h,this.debug,function(){return h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0)})},b.prototype.blockUntilAllProgramsCompleted=function(){var h=this;this.throwIfDisposed(),Kn(this.gl,this.debug,function(){return h.gl.finish()})},b.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=zi(this.gl,this.debug,z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},b.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},b.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},b.prototype.beginQuery=function(){if(z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var h=this.gl,c=this.getQueryTimerExtensionWebGL2(),m=h.createQuery();return h.beginQuery(c.TIME_ELAPSED_EXT,m),m}var w=this.getQueryTimerExtensionWebGL1(),R=w.createQueryEXT();return w.beginQueryEXT(w.TIME_ELAPSED_EXT,R),R},b.prototype.endQuery=function(){if(z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var h=this.getQueryTimerExtensionWebGL1();h.endQueryEXT(h.TIME_ELAPSED_EXT)}else{var c=this.gl,m=this.getQueryTimerExtensionWebGL2();c.endQuery(m.TIME_ELAPSED_EXT)}},b.prototype.waitForQueryAndGetTime=function(h){return N(this,void 0,void 0,function(){var c=this;return L(this,function(m){switch(m.label){case 0:return[4,xt(function(){return c.disposed||c.isQueryAvailable(h,z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return m.sent(),[2,this.getQueryTime(h,z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},b.prototype.getQueryTime=function(h,c){if(c===0)return null;if(c===2){var m=this.gl;return m.getQueryParameter(h,m.QUERY_RESULT)/1e6}var w=this.getQueryTimerExtensionWebGL1();return w.getQueryObjectEXT(h,w.QUERY_RESULT_EXT)/1e6},b.prototype.isQueryAvailable=function(h,c){if(c===0)return!0;if(c===2){var m=this.gl,w=this.getQueryTimerExtensionWebGL2(),R=m.getQueryParameter(h,m.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(w.GPU_DISJOINT_EXT)),R&&!this.disjoint}return R=(w=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(h,w.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(w.GPU_DISJOINT_EXT)),R&&!this.disjoint},b.prototype.pollFence=function(h){var c=this;return new Promise(function(m){c.addItemToPoll(function(){return h.isFencePassed()},function(){return m()})})},b.prototype.pollItems=function(){for(var h=function(m){for(var w=0;w<m.length&&m[w]();++w);return w-1}(this.itemsToPoll.map(function(m){return m.isDoneFn})),c=0;c<=h;++c)(0,this.itemsToPoll[c].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(h+1)},b.prototype.addItemToPoll=function(h,c){var m=this;this.itemsToPoll.push({isDoneFn:h,resolveFn:c}),this.itemsToPoll.length>1||xt(function(){return m.pollItems(),m.itemsToPoll.length===0})},b.prototype.bindTextureToFrameBuffer=function(h){this.throwIfDisposed(),Qc(this.gl,this.debug,h,this.framebuffer),this.debug&&Ua(this.gl)},b.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Qc(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Ua(this.gl)):uf(this.gl,this.debug,this.framebuffer)},b.prototype.downloadMatrixDriver=function(h,c){this.bindTextureToFrameBuffer(h);var m=c();return this.unbindTextureToFrameBuffer(),m},b.prototype.setOutputMatrixTextureDriver=function(h,c,m){this.throwIfDisposed();var w=this.gl;Qc(w,this.debug,h,this.framebuffer),this.debug&&Ua(w),this.outputTexture=h,Kn(w,this.debug,function(){return w.viewport(0,0,c,m)}),Kn(w,this.debug,function(){return w.scissor(0,0,c,m)})},b.prototype.setOutputMatrixWriteRegionDriver=function(h,c,m,w){var R=this;this.throwIfDisposed(),Kn(this.gl,this.debug,function(){return R.gl.scissor(h,c,m,w)})},b.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},b.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},b}();function r0(b,h){if(b.length!==h.length)throw Error("Binary was compiled with "+b.length+" inputs, but was executed with "+h.length+" inputs");b.forEach(function(c,m){var w=c.logicalShape,R=h[m],K=R.shape;if(!Ut(w,K))throw Error("Binary was compiled with different shapes than the current args. Shapes "+w+" and "+K+" must match");if(!c.isUniform||!R.isUniform){var ee=c.texShape,le=R.isUniform?null:R.texData.texShape;if(!Ut(ee,le))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+ee+" and "+le+" must match")}})}var Yu=function(b,h,c,m,w,R,K){c===void 0&&(c=!1),m===void 0&&(m=!1),w===void 0&&(w=!1),R===void 0&&(R=null),K===void 0&&(K=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=h;var ee=c?b[1]:b[2],le=Math.ceil(ee/2),de=c?"i * 2, rc.y":"rc.y, i * 2",_e=m?"rc.z, i * 2":"i * 2, rc.z",Te=c?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],Ne=m?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],Fe="",He="";R&&(Fe=K?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+R+`
        }`:`vec4 activation(vec4 x) {
          `+R+`
        }`,He="result = activation(result);");var Ye=w?"result += getBiasAtOutCoords();":"";w&&this.variableNames.push("bias"),K&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+Fe+`

      const float sharedDimension = `+le+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+le+`; i++) {
          vec4 a = getMatrixA(rc.x, `+de+`);
          vec4 b = getMatrixB(rc.x, `+_e+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+Te[0]+" * "+Ne[0]+`);
          result += (`+Te[1]+" * "+Ne[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+Ye+`

        `+He+`

        setOutput(result);
      }
    `},i0=function(){function b(h,c,m){this.variableNames=["probs"],this.outputShape=[h,m],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(c-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(c-1)+`));
      }
    `}return b.prototype.getCustomSetupFunc=function(h){var c=this;return function(m,w){c.seedLoc==null&&(c.seedLoc=m.getUniformLocation(w,"seed")),m.gl.uniform1f(c.seedLoc,h)}},b}(),Wh=function(b,h,c,m,w){if(m===void 0&&(m=!1),w===void 0&&(w=!1),this.variableNames=["x"],h==="avg"&&c)throw new Error("Cannot compute positions for average pool.");var R=b.filterWidth,K=b.strideHeight,ee=b.strideWidth,le=b.dilationHeight,de=b.dilationWidth,_e=b.effectiveFilterHeight,Te=b.effectiveFilterWidth,Ne=b.padInfo.top,Fe=b.padInfo.left;this.outputShape=b.outShape;var He=h==="avg",Ye="((batch  * "+b.inHeight+" + xR) * "+b.inWidth+" + xC) * "+b.inChannels+" + d",Ke="(xR * "+b.inWidth+" + xC) * "+b.inChannels+" + d",it="0.0";if(He||(it="-1.0 / 1e-20"),c)this.userCode=`
        const ivec2 strides = ivec2(`+K+", "+ee+`);
        const ivec2 pads = ivec2(`+Ne+", "+Fe+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+_e+`;
              wR += `+le+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+b.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+Te+`;
                wC += `+de+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+b.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = `+(m?w?Ye:Ke:"wR * "+Te+" + wC")+`;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var gt=h+"("+h+"("+h+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";h==="avg"&&(gt="avgValue / count");var wt=4*Math.floor(R/4),At=R%4,zt=`
      if (`+He+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+K+", "+ee+`);
      const ivec2 pads = ivec2(`+Ne+", "+Fe+`);
      const float initializationValue = `+it+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+b.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+it+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+_e+`;
            wR += `+le+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+b.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+wt+`; wC += 4) {
            int xC = xCCorner + wC * `+de+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+de+`, d),
              getValue(batch, xR, xC + 2 * `+de+`, d),
              getValue(batch, xR, xC + 3 * `+de+`, d)
            );

            `+zt+`
          }

          int xC = xCCorner + `+wt+`;
          if (`+(At===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+zt+`
          } else if (`+(At===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+de+`, d),
              initializationValue,
              initializationValue
            );

            `+zt+`
          } else if (`+(At===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+de+`, d),
              getValue(batch, xR, xC + 2 * `+de+`, d),
              initializationValue
            );

            `+zt+`
          }
        }
        setOutput(`+gt+`);
      }
    `}},im=function(b,h,c,m,w){if(m===void 0&&(m=!1),w===void 0&&(w=!1),this.variableNames=["x"],h==="avg"&&c)throw new Error("Cannot compute positions for average pool.");var R=b.filterWidth,K=b.strideDepth,ee=b.strideHeight,le=b.strideWidth,de=b.dilationDepth,_e=b.dilationHeight,Te=b.dilationWidth,Ne=b.effectiveFilterDepth,Fe=b.effectiveFilterHeight,He=b.effectiveFilterWidth,Ye=b.padInfo.front,Ke=b.padInfo.top,it=b.padInfo.left;this.outputShape=b.outShape;var gt=h==="avg",wt="0.0";if(gt||(wt="-1.0 / 1e-20"),c)this.userCode=`
        const ivec3 strides =
            ivec3(`+K+", "+ee+", "+le+`);
        const ivec3 pads = ivec3(`+Ye+", "+Ke+", "+it+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+Ne+`;
              wD += `+de+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+b.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+Fe+`;
                wR += `+_e+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+b.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+He+`;
                  wC += `+Te+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+b.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = `+(m?w?"(((batch * "+b.inDepth+" + xD) * "+b.inHeight+" + xR) * "+b.inWidth+" + xC) * "+b.inChannels+" + ch":"((xD * "+b.inHeight+" + xR) * "+b.inWidth+" + xC) * "+b.inChannels+" + ch":"wD * "+Fe+" * "+He+` +
                      wR * `+He+" + wC")+`;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var At=h+"("+h+"("+h+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";h==="avg"&&(At="avgValue / count");var zt=4*Math.floor(R/4),an=R%4,dn=`
      if (`+gt+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+K+", "+ee+", "+le+`);
      const ivec3 pads = ivec3(`+Ye+", "+Ke+", "+it+`);
      const float initializationValue = `+wt+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+b.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+wt+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+Ne+`;
            wD += `+de+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+b.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+Fe+`;
            wR += `+_e+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+b.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+zt+`; wC += 4) {
              int xC = xCCorner + wC * `+Te+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+Te+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+Te+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+Te+`, ch)
              );

              `+dn+`
            }

            int xC = xCCorner + `+zt+`;
            if (`+(an===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+dn+`
            } else if (`+(an===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+Te+`, ch),
                initializationValue,
                initializationValue
              );

              `+dn+`
            } else if (`+(an===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+Te+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+Te+`, ch),
                initializationValue
              );

              `+dn+`
            }
          }
          setOutput(`+At+`);
        }
      }
    `}},ky=function(b,h,c,m,w,R,K){this.variableNames=["updates","indices","defaultValue"],this.outputShape=R;var ee=jo(w.length),le=jo(R.length),de="";c===1?de="i":c===2&&(de="i, j");var _e="getIndices("+de+")",Te="";m===1?Te="i":m===2&&(Te="i, coords[1]");var Ne="getUpdates("+Te+")",Fe=h>1?"strides[j]":"strides";this.userCode=`
        `+ee+" strides = "+ee+"("+w+`);

        void main() {
          `+le+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+b+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+h+`; j++) {
              int index = round(`+_e+`);
              flattenedIndex += index * `+Fe+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+Ne+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},om=function(){function b(h){this.variableNames=["source"],this.outputShape=h,this.rank=h.length;var c,m=jo(this.rank),w="uniform int start["+this.rank+"];",R=function(K){if(K===1)return"sourceLoc";if(K<=6)return sl.slice(0,K).map(function(ee){return"sourceLoc."+ee}).join(",");throw Error("Slicing for rank "+K+" is not yet supported")}(this.rank);c=`
        `+m+` sourceLoc;
        `+m+` coords = getOutputCoords();
        `+h.map(function(K,ee){return"sourceLoc."+sl[ee]+" = start["+ee+"] + coords."+sl[ee]+";"}).join(`
`)+`
      `,this.userCode=`
      `+w+`
      void main() {
        `+c+`
        setOutput(getSource(`+R+`));
      }
    `}return b.prototype.getCustomSetupFunc=function(h){var c=this;if(h.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+h.length+")");return function(m,w){c.startLoc==null&&(c.startLoc=m.getUniformLocationNoThrow(w,"start"),c.startLoc==null)||m.gl.uniform1iv(c.startLoc,h)}},b}(),sl=["x","y","z","w","u","v"],am=function(){function b(h){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=h,this.rank=h.length;var c=jo(this.rank),m=_a("coords",this.rank),w=_a("sourceLoc",this.rank),R=this.rank===1?"sourceLoc":"vec2("+w.slice(-2).join()+")",K="getChannel(getSource("+w.join()+"), "+R+")",ee=`
      result.x = `+K+`;
      if (++`+m[this.rank-1]+" < "+h[this.rank-1]+`) {
        ++`+w[this.rank-1]+`;
        result.y = `+K+`;
        --`+w[this.rank-1]+`;
      }
    `,le=this.rank===1?"":`
      --`+m[this.rank-1]+`;
      if (++`+m[this.rank-2]+" < "+h[this.rank-2]+`) {
        ++`+w[this.rank-2]+`;
        result.z = `+K+`;
        if (++`+m[this.rank-1]+" < "+h[this.rank-1]+`) {
          ++`+w[this.rank-1]+`;
          result.w = `+K+`;
        }
      }
    `,de=this.rank<=4?`sourceLoc = coords +
            `+c+"("+h.map(function(_e,Te){return"start["+Te+"]"}).join()+");":h.map(function(_e,Te){return w[Te]+" = "+m[Te]+" + start["+Te+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+c+` coords = getOutputCoords();
        `+c+` sourceLoc;
        `+de+`
        vec4 result = vec4(0.);
        `+ee+`
        `+le+`
        setOutput(result);
      }
    `}return b.prototype.getCustomSetupFunc=function(h){var c=this;if(h.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+h.length+")");return function(m,w){c.startLoc==null&&(c.startLoc=m.getUniformLocationNoThrow(w,"start"),c.startLoc==null)||m.gl.uniform1iv(c.startLoc,h)}},b}(),lv=function(){function b(h){this.gpgpu=h,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return b.prototype.acquireTexture=function(h,c,m){var w,R=fv(c,m),K=o0(h,R,m);if(K in this.freeTextures||(this.freeTextures[K]=[]),K in this.usedTextures||(this.usedTextures[K]=[]),this.freeTextures[K].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var ee=this.freeTextures[K].shift();return this.usedTextures[K].push(ee),ee}return this.numUsedTextures++,this.log(),R===Br.PACKED_2X2_FLOAT32?w=this.gpgpu.createPackedMatrixTexture(h[0],h[1]):R===Br.PACKED_2X2_FLOAT16?w=this.gpgpu.createFloat16PackedMatrixTexture(h[0],h[1]):R===Br.UNPACKED_FLOAT32?w=this.gpgpu.createFloat32MatrixTexture(h[0],h[1]):R===Br.UNPACKED_FLOAT16?w=this.gpgpu.createFloat16MatrixTexture(h[0],h[1]):R===Br.PACKED_4X1_UNSIGNED_BYTE&&(w=this.gpgpu.createUnsignedBytesMatrixTexture(h[0],h[1])),this.usedTextures[K].push(w),w},b.prototype.releaseTexture=function(h,c,m,w){if(this.freeTextures!=null){var R=o0(c,fv(m,w),w);R in this.freeTextures||(this.freeTextures[R]=[]),this.freeTextures[R].push(h),this.numFreeTextures++,this.numUsedTextures--;var K=this.usedTextures[R],ee=K.indexOf(h);if(ee<0)throw new Error("Cannot release a texture that was never provided by this texture manager");K.splice(ee,1),this.log()}},b.prototype.log=function(){if(this.logEnabled){var h=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+h+")")}},b.prototype.getNumUsedTextures=function(){return this.numUsedTextures},b.prototype.getNumFreeTextures=function(){return this.numFreeTextures},b.prototype.dispose=function(){var h=this;if(this.freeTextures!=null){for(var c in this.freeTextures)this.freeTextures[c].forEach(function(m){h.gpgpu.deleteMatrixTexture(m)});for(var c in this.usedTextures)this.usedTextures[c].forEach(function(w){h.gpgpu.deleteMatrixTexture(w)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},b}();function fv(b,h){if(b===cr.UPLOAD)return Br.PACKED_2X2_FLOAT32;if(b===cr.RENDER||b==null)return function(c){return z().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?c?Br.PACKED_2X2_FLOAT32:Br.UNPACKED_FLOAT32:c?Br.PACKED_2X2_FLOAT16:Br.UNPACKED_FLOAT16}(h);if(b===cr.DOWNLOAD||b===cr.PIXELS)return Br.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+b)}function o0(b,h,c){return b[0]+"_"+b[1]+"_"+h+"_"+c}var D1=1.7580993408473768,N1=1.0507009873554805,yo=function(b,h){this.variableNames=["A"],this.outputShape=b,this.userCode=`
      float unaryOperation(float x) {
        `+h+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},dv="if (isnan(x)) return x;",hv="return x;",eg="return abs(x);",pv=dv+`
  return (x < 0.0) ? 0.0 : x;
`,sm=dv+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Ll="return (x >= 0.0) ? x : (exp(x) - 1.0);",Bl="return -x;",mv="return ceil(x);",gv="return floor(x);",Vh="return exp(x);",Dd="return exp(x) - 1.0;",Hh="return x;",I1="return x;",tg=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,jl=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Ju=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,kf=function(b,h){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=b,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+h+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},Cf={};function Af(b,h){if(h===void 0&&(h=!1),b==="linear")return h?I1:hv;if(b==="relu")return h?tg:pv;if(b==="elu")return h?Ju:Ll;if(b==="relu6")return h?jl:sm;if(b==="prelu")return h?fs:il;throw new Error("Activation "+b+" has not been implemented for the WebGL backend.")}var vv=600,ng=function(b){function h(c){var m,w=b.call(this)||this;if(w.pendingRead=new WeakMap,w.pendingDisposal=new WeakSet,w.dataRefCount=new WeakMap,w.numBytesInGPU=0,w.uploadWaitMs=0,w.downloadWaitMs=0,w.warnedAboutMemory=!1,w.pendingDeletes=0,w.disposed=!1,!z().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(c==null){var R=Zr(z().getNumber("WEBGL_VERSION"));w.binaryCache=((m=z().getNumber("WEBGL_VERSION"))in Cf||(Cf[m]={}),Cf[m]),w.gpgpu=new n0(R),w.canvas=R.canvas,w.gpgpuCreatedLocally=!0}else w.gpgpu=c,w.binaryCache={},w.gpgpuCreatedLocally=!1,w.canvas=c.gl.canvas;return w.textureManager=new lv(w.gpgpu),w.numMBBeforeWarning=z().global.screen==null?1024:z().global.screen.height*z().global.screen.width*window.devicePixelRatio*vv/1024/1024,w.texData=new Gt(w,Ve),w}return j(h,b),h.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},h.prototype.write=function(c,m,w){if(z().getBool("DEBUG")&&this.checkNumericalProblems(c),w==="complex64"&&c!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var R={};return this.texData.set(R,{shape:m,dtype:w,values:c,usage:cr.UPLOAD}),R},h.prototype.move=function(c,m,w,R){if(z().getBool("DEBUG")&&this.checkNumericalProblems(m),R==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(c,{shape:w,dtype:R,values:m,usage:cr.UPLOAD})},h.prototype.readSync=function(c){var m=this.texData.get(c),w=m.values,R=m.dtype,K=m.complexTensors,ee=m.slice,le=m.shape,de=m.isPacked;if(ee!=null){var _e;_e=de?new kf(le,Hh):new yo(le,Hh);var Te=this.runWebGLProgram(_e,[{dataId:c,shape:le,dtype:R}],R),Ne=this.readSync(Te.dataId);return this.disposeData(Te.dataId),Ne}if(w!=null)return this.convertAndCacheOnCPU(c);if(R==="string")return w;var Fe,He,Ye=this.activeTimers!=null;return Ye&&(Fe=Zt()),He=R==="complex64"?pi(K.real.dataSync(),K.imag.dataSync()):this.getValuesFromTexture(c),Ye&&(this.downloadWaitMs+=Zt()-Fe),this.convertAndCacheOnCPU(c,He)},h.prototype.read=function(c){return N(this,void 0,void 0,function(){var m,w,R,K,ee,le,de,_e,Te,Ne,Fe,He,Ye,Ke,it,gt,wt,At,zt,an,dn,sn;return L(this,function(ln){switch(ln.label){case 0:if(this.pendingRead.has(c))return m=this.pendingRead.get(c),[2,new Promise(function(Tn){return m.push(Tn)})];if(w=this.texData.get(c),R=w.values,K=w.shape,ee=w.slice,le=w.dtype,de=w.complexTensors,_e=w.isPacked,ee!=null)return Te=void 0,Te=_e?new kf(K,Hh):new yo(K,Hh),Ne=this.runWebGLProgram(Te,[{dataId:c,shape:K,dtype:le}],le),Fe=this.read(Ne.dataId),this.disposeData(Ne.dataId),[2,Fe];if(R!=null)return[2,this.convertAndCacheOnCPU(c)];if(!z().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&z().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return He=null,le!=="complex64"&&z().get("WEBGL_BUFFER_SUPPORTED")&&(Ye=this.decode(c),Ke=this.texData.get(Ye.dataId),He=(sn=this.gpgpu).createBufferFromTexture.apply(sn,[Ke.texture].concat(gi(K)))),this.pendingRead.set(c,[]),le==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:ln.sent(),ln.label=2;case 2:return le!=="complex64"?[3,4]:[4,Promise.all([de.real.data(),de.imag.data()])];case 3:return gt=ln.sent(),wt=gt[0],At=gt[1],it=pi(wt,At),[3,5];case 4:He==null?it=this.getValuesFromTexture(c):(zt=ze(K),it=this.gpgpu.downloadFloat32MatrixFromBuffer(He,zt)),ln.label=5;case 5:return Ye!=null&&this.disposeData(Ye.dataId),an=this.convertAndCacheOnCPU(c,it),dn=this.pendingRead.get(c),this.pendingRead.delete(c),dn.forEach(function(Tn){return Tn(an)}),this.pendingDisposal.has(c)&&(this.pendingDisposal.delete(c),this.disposeData(c),this.pendingDeletes--),[2,an]}})})},h.prototype.checkNumericalProblems=function(c){if(c!=null)for(var m=0;m<c.length;m++){var w=c[m];if(!zr(w))throw z().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+w+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+w+" cannot be represented on this device.")}},h.prototype.getValuesFromTexture=function(c){var m,w=this.texData.get(c),R=w.shape,K=w.dtype,ee=w.isPacked,le=ze(R);if(z().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var de=this.decode(c),_e=this.texData.get(de.dataId),Te=(m=this.gpgpu).downloadMatrixFromPackedTexture.apply(m,[_e.texture].concat(gi(R))).subarray(0,le);return this.disposeData(de.dataId),Te}var Ne=z().getBool("WEBGL_PACK")&&ee===!0,Fe=Ne?Oc(R):R,He=Ne?new function(gt){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=cr.DOWNLOAD;var wt=ko();this.outputShape=gt,this.userCode=`
      `+Es+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+wt.output+` = encode_float(x);
      }
    `}(Fe):new function(gt){this.variableNames=["A"],this.outTexUsage=cr.DOWNLOAD;var wt=ko();this.outputShape=gt,this.userCode=`
      `+Es+`

      void main() {
        float x = getAAtOutCoords();
        `+wt.output+` = encode_float(x);
      }
    `}(Fe),Ye=this.runWebGLProgram(He,[{shape:Fe,dtype:K,dataId:c}],"float32"),Ke=this.texData.get(Ye.dataId),it=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(Ke.texture,Ke.texShape[0],Ke.texShape[1]).subarray(0,le);return this.disposeData(Ye.dataId),it},h.prototype.time=function(c){return N(this,void 0,void 0,function(){var m,w,R,K,ee,le,de;return L(this,function(_e){switch(_e.label){case 0:return m=this.activeTimers,w=[],R=!1,this.programTimersStack==null?(this.programTimersStack=w,R=!0):this.activeTimers.push(w),this.activeTimers=w,c(),K=Mt(this.activeTimers.map(function(Te){return Te.query})).filter(function(Te){return Te!=null}),ee=Mt(this.activeTimers.map(function(Te){return Te.name})).filter(function(Te){return Te!=null}),this.activeTimers=m,R&&(this.programTimersStack=null),le={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(K)]:[3,2];case 1:return de=_e.sent(),le.kernelMs=St(de),le.getExtraProfileInfo=function(){return de.map(function(Te,Ne){return{name:ee[Ne],ms:Te}}).map(function(Te){return Te.name+": "+Te.ms}).join(", ")},[3,3];case 2:le.kernelMs={error:"WebGL query timers are not supported in this environment."},_e.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,le]}})})},h.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},h.prototype.startTimer=function(){return z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Zt(),endMs:null}},h.prototype.endTimer=function(c){return z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),c):(c.endMs=Zt(),c)},h.prototype.getQueryTime=function(c){return N(this,void 0,void 0,function(){var m;return L(this,function(w){return z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(c)]:[2,(m=c).endMs-m.startMs]})})},h.prototype.disposeData=function(c){if(!this.pendingDisposal.has(c)){if(this.pendingRead.has(c))return this.pendingDisposal.add(c),void this.pendingDeletes++;if(this.texData.has(c)){this.releaseGPUData(c);var m=this.texData.get(c).complexTensors;m!=null&&(m.real.dispose(),m.imag.dispose()),this.texData.delete(c)}}},h.prototype.releaseGPUData=function(c){var m=this.texData.get(c),w=m.texture,R=m.dtype,K=m.texShape,ee=m.usage,le=m.isPacked,de=m.slice,_e=de&&de.origDataId||c,Te=this.dataRefCount.get(_e);Te>1?this.dataRefCount.set(_e,Te-1):(this.dataRefCount.delete(_e),w!=null&&(this.numBytesInGPU-=this.computeBytes(K,R),this.textureManager.releaseTexture(w,K,ee,le)));var Ne=this.texData.get(c);Ne.texture=null,Ne.texShape=null,Ne.isPacked=!1,Ne.slice=null},h.prototype.getTexture=function(c){return this.uploadToGPU(c),this.texData.get(c).texture},h.prototype.getDataInfo=function(c){return this.texData.get(c)},h.prototype.getCPUBackend=function(){return z().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=Ve.findBackend("cpu")),this.cpuBackend):null},h.prototype.shouldExecuteOnCPU=function(c,m){var w=this;return m===void 0&&(m=128),this.getCPUBackend()!=null&&c.every(function(R){return w.texData.get(R.dataId).texture==null&&ze(R.shape)<m})},h.prototype.getGPGPUContext=function(){return this.gpgpu},h.prototype.complex=function(c,m){var w=this.makeOutput(c.shape,"complex64");return this.texData.get(w.dataId).complexTensors={real:Ve.keep(c.clone()),imag:Ve.keep(m.clone())},w},h.prototype.real=function(c){return this.texData.get(c.dataId).complexTensors.real.clone()},h.prototype.imag=function(c){return this.texData.get(c.dataId).complexTensors.imag.clone()},h.prototype.slice=function(c,m,w){if(this.shouldExecuteOnCPU([c]))return this.cpuBackend.slice(c,m,w);if(ze(w)===0)return To([],w,c.dtype);var R=this.texData.get(c.dataId).isPacked,K=zh(c.shape,m,w);if(R||!K){var ee=z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new am(w):new om(w),le=ee.getCustomSetupFunc(m);return this.compileAndRun(ee,[c],null,le)}return this.uploadToGPU(c.dataId),this.shallowSlice(c,m,w)},h.prototype.shallowSlice=function(c,m,w){var R=this.texData.get(c.dataId),K=this.makeOutput(w,c.dtype),ee=this.texData.get(K.dataId);Object.assign(ee,R),ee.shape=w,ee.dtype=c.dtype;var le=kd(m,c.strides);R.slice&&(le+=R.slice.flatOffset),ee.slice={flatOffset:le,origDataId:R.slice&&R.slice.origDataId||c.dataId};var de=this.dataRefCount.get(ee.slice.origDataId)||1;return this.dataRefCount.set(ee.slice.origDataId,de+1),K},h.prototype.stridedSlice=function(c,m,w,R){if(this.shouldExecuteOnCPU([c]))return this.cpuBackend.stridedSlice(c,m,w,R);var K=$u(m,w,R);if(K.some(function(le){return le===0}))return To([],K);var ee=new function(le,de,_e){this.variableNames=["x"],this.outputShape=_e;var Te=_e.length,Ne=jo(_e.length),Fe=jo(_e.length),He="";if(Te===1)He="coords * strides + begin";else{var Ye=0;He=_e.map(function(Ke,it){return Ye++,_e.length===1?"coords * strides["+it+"] + begin["+it+"]":"coords["+(Ye-1)+"] * strides["+it+"] + begin["+it+"]"}).join(",")}this.userCode=`
      `+Ne+" begin = "+Ne+"("+le+`);
      `+Ne+" strides = "+Ne+"("+de+`);

      void main() {
        `+Fe+` coords = getOutputCoords();
        setOutput(getX(`+He+`));
      }
    `}(m,R,K);return this.compileAndRun(ee,[c])},h.prototype.reverse=function(c,m){var w=z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(R,K){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var ee=R.length;if(ee>4)throw new Error("WebGL backend: Reverse of rank-"+ee+" tensor is not yet supported");this.outputShape=R;var le=_a("rc",ee),de=le[ee-1]+" + 1 < "+this.outputShape[ee-1],_e=le[ee-2]+" + 1 < "+this.outputShape[ee-2],Te=jo(ee);function Ne(Fe){var He=R.map(function(Ye,Ke){return function(it,gt){return K.indexOf(it)!==-1&&R[it]!==1?R[it]+" - "+gt[it]+" - 1":""+gt[it]}(Ke,Fe)});return"getChannel(getX("+He.join(",")+"), vec2("+He.slice(-2).join(",")+"))"}this.userCode=ee===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+R[0]+` - rc - 1),
            `+R[0]+` - rc - 1);
          if(`+de+`){
              result.g = getChannel(getX(`+R[0]+` - (rc  + 1) - 1),
                `+R[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+Te+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+Ne(le.slice())+`;
          if(`+de+`){
            result.g = `+function(Fe){return Fe[ee-1]="("+Fe[ee-1]+" + 1)",Ne(Fe)}(le.slice())+`;
          }
          if(`+_e+`) {
            result.b = `+function(Fe){return Fe[ee-2]="("+Fe[ee-2]+" + 1)",Ne(Fe)}(le.slice())+`;
            if(`+de+`) {
              result.a = `+function(Fe){return Fe[ee-1]="("+Fe[ee-1]+" + 1)",Fe[ee-2]="("+Fe[ee-2]+" + 1)",Ne(Fe)}(le.slice())+`;
            }
          }
          setOutput(result);
        }
    `}(c.shape,m):new function(R,K){this.variableNames=["x"];var ee=R.length;if(ee>4)throw new Error("WebGL backend: Reverse of rank-"+ee+" tensor is not yet supported");if(this.outputShape=R,ee!==1){var le=R.map(function(_e,Te){return function(Ne){return K.indexOf(Ne)!==-1&&R[Ne]!==1?R[Ne]+" - coords["+Ne+"] - 1":"coords["+Ne+"]"}(Te)}).join(","),de=jo(ee);this.userCode=`
      void main() {
        `+de+` coords = getOutputCoords();
        setOutput(getX(`+le+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+R[0]+` - coord - 1));
        }
      `}(c.shape,m);return this.compileAndRun(w,[c])},h.prototype.concat=function(c,m){if(c[0].dtype==="complex64"){var w=c.map(function(Fe){return va(Fe)}),R=c.map(function(Fe){return Ya(Fe)});return _o(this.concat(w,m),this.concat(R,m))}if(this.shouldExecuteOnCPU(c))return this.cpuBackend.concat(c,m);if(c.length===1)return c[0];if(c.length>z().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var K=Math.floor(c.length/2),ee=this.concat(c.slice(0,K),m),le=this.concat(c.slice(K),m);return this.concat([ee,le],m)}if(z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&c[0].rank>1){var de=new function(Fe,He){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=bu(Fe,He);var Ye=this.outputShape,Ke=Ye.length,it=jo(Ke),gt=_a("coords",Ke),wt=["x","y","z","w","u","v"].slice(0,Ke);this.variableNames=Fe.map(function(or,fr){return"T"+fr});var At=new Array(Fe.length-1);At[0]=Fe[0][He];for(var zt=1;zt<At.length;zt++)At[zt]=At[zt-1]+Fe[zt][He];var an=wt[He],dn=wt.slice(-2),sn=wt.join(),ln="if ("+an+" < "+At[0]+`) {
        return getChannel(
            getT0(`+sn+"), vec2("+dn.join()+`));
        }`;for(zt=1;zt<At.length;zt++){var Tn=At[zt-1];ln+=`
        if (`+an+" < "+At[zt]+"  && "+an+" >= "+At[zt-1]+`) {
          return getChannel(
            getT`+zt+"("+wi(wt,an,Tn)+`),
            vec2(`+wi(dn,an,Tn)+`));
        }`}var Bn=At.length,In=At[At.length-1];ln+=`
        return getChannel(
          getT`+Bn+"("+wi(wt,an,In)+`),
          vec2(`+wi(dn,an,In)+"));",this.userCode=`
      float getValue(`+wt.map(function(or){return"int "+or})+`) {
        `+ln+`
      }

      void main() {
        `+it+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+gt+`), 0., 0., 0.);

        `+gt[Ke-1]+" = "+gt[Ke-1]+` + 1;
        if (`+gt[Ke-1]+" < "+Ye[Ke-1]+`) {
          result.g = getValue(`+gt+`);
        }

        `+gt[Ke-2]+" = "+gt[Ke-2]+` + 1;
        if (`+gt[Ke-2]+" < "+Ye[Ke-2]+`) {
          result.a = getValue(`+gt+`);
        }

        `+gt[Ke-1]+" = "+gt[Ke-1]+` - 1;
        if (`+gt[Ke-2]+" < "+Ye[Ke-2]+` &&
            `+gt[Ke-1]+" < "+Ye[Ke-1]+`) {
          result.b = getValue(`+gt+`);
        }
        setOutput(result);
      }
    `}(c.map(function(Fe){return Fe.shape}),m);return this.compileAndRun(de,c)}var _e=bu(c.map(function(Fe){return Fe.shape}),m),Te=c.map(function(Fe){return Fe.as2D(-1,ze(Fe.shape.slice(m)))}),Ne=new function(Fe){this.outputShape=[],this.outputShape=bu(Fe,1),this.variableNames=Fe.map(function(At,zt){return"T"+zt});var He=new Array(Fe.length-1);He[0]=Fe[0][1];for(var Ye=1;Ye<He.length;Ye++)He[Ye]=He[Ye-1]+Fe[Ye][1];var Ke=["if (yC < "+He[0]+") setOutput(getT0(yR, yC));"];for(Ye=1;Ye<He.length;Ye++){var it=He[Ye-1];Ke.push("else if (yC < "+He[Ye]+") setOutput(getT"+Ye+"(yR, yC-"+it+"));")}var gt=He.length,wt=He[He.length-1];Ke.push("else setOutput(getT"+gt+"(yR, yC-"+wt+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+Ke.join(`
        `)+`
      }
    `}(Te.map(function(Fe){return Fe.shape}));return this.compileAndRun(Ne,Te).reshape(_e)},h.prototype.neg=function(c){if(this.shouldExecuteOnCPU([c]))return this.cpuBackend.neg(c);if(z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(c,Bl,c.dtype);var m=new yo(c.shape,Bl);return this.compileAndRun(m,[c])},h.prototype.batchMatMul=function(c,m,w,R){var K=w?c.shape[2]:c.shape[1],ee=R?m.shape[1]:m.shape[2],le=w?c.shape[1]:c.shape[2],de=c.shape[0];if((K===1||ee===1)&&le>1e3){w&&(c=vt(c,[0,2,1])),R&&(m=vt(m,[0,2,1]));var _e=ee===1?c:c.as3D(de,le,1),Te=ee===1?2:1,Ne=ee===1?m.as3D(de,1,le):m;return this.multiply(_e,Ne).sum(Te,!0)}var Fe=En(c.dtype,m.dtype),He=new Yu(c.shape,[de,K,ee],w,R);return this.compileAndRun(He,[c,m],Fe)},h.prototype.fusedBatchMatMul=function(c){var m=c.a,w=c.b,R=c.transposeA,K=c.transposeB,ee=c.bias,le=c.activation,de=c.preluActivationWeights,_e=R?m.shape[2]:m.shape[1],Te=K?w.shape[1]:w.shape[2],Ne=m.shape[0],Fe=En(m.dtype,w.dtype),He=ee!=null,Ye=de!=null,Ke=le?Af(le,!0):null,it=new Yu(m.shape,[Ne,_e,Te],R,K,He,Ke,Ye),gt=[m,w];return ee&&gt.push(ee),de&&gt.push(de),this.compileAndRun(it,gt,Fe)},h.prototype.multiply=function(c,m){if(c.dtype==="complex64"){var w=this.texData.get(c.dataId),R=this.texData.get(m.dataId),K=new go("return areal * breal - aimag * bimag;",c.shape,m.shape),ee=new go("return areal * bimag + aimag * breal;",c.shape,m.shape),le=[this.makeComplexComponentTensorInfo(c,w.complexTensors.real),this.makeComplexComponentTensorInfo(c,w.complexTensors.imag),this.makeComplexComponentTensorInfo(m,R.complexTensors.real),this.makeComplexComponentTensorInfo(m,R.complexTensors.imag)],de=this.compileAndRun(K,le),_e=this.compileAndRun(ee,le),Te=this.complex(de,_e);return de.dispose(),_e.dispose(),Te}if(this.shouldExecuteOnCPU([c,m]))return this.cpuBackend.multiply(c,m);if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(c,m,fu,c.dtype);var Ne=new $o(fu,c.shape,m.shape);return this.compileAndRun(Ne,[c,m],c.dtype)},h.prototype.batchNormalization=function(c,m,w,R,K,ee){var le=[c,m,w],de=null;ee!=null&&(de=ee.shape,le.push(ee));var _e=null;if(K!=null&&(_e=K.shape,le.push(K)),z().getBool("WEBGL_PACK_NORMALIZATION")){var Te=new function(Fe,He,Ye,Ke,it,gt){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],qi(Fe,He),qi(Fe,Ye);var wt="vec4(0.0)";Ke!=null&&(qi(Fe,Ke),this.variableNames.push("offset"),wt="getOffsetAtOutCoords()");var At="vec4(1.0)";it!=null&&(qi(Fe,it),this.variableNames.push("scale"),At="getScaleAtOutCoords()"),this.outputShape=Fe,this.userCode=`
      void main() {
        vec4 offset = `+wt+`;
        vec4 scale = `+At+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+gt+`));

        setOutput((x - mean) * inv + offset);
      }
    `}(c.shape,m.shape,w.shape,de,_e,R);return this.compileAndRun(Te,le)}var Ne=new function(Fe,He,Ye,Ke,it,gt){this.outputShape=[],this.variableNames=["x","mean","variance"],qi(Fe,He),qi(Fe,Ye);var wt="0.0";Ke!=null&&(qi(Fe,Ke),this.variableNames.push("offset"),wt="getOffsetAtOutCoords()");var At="1.0";it!=null&&(qi(Fe,it),this.variableNames.push("scale"),At="getScaleAtOutCoords()"),this.outputShape=Fe,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+wt+`;
        float scale = `+At+`;
        float inv = scale * inversesqrt(variance + float(`+gt+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}(c.shape,m.shape,w.shape,de,_e,R);return this.compileAndRun(Ne,le)},h.prototype.localResponseNormalization4D=function(c,m,w,R,K){var ee=z().getBool("WEBGL_PACK_NORMALIZATION")?new function(le,de,_e,Te,Ne){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var Fe,He=de,Ye=le[3]-1;this.outputShape=le;var Ke="float("+_e+") + float("+Te+") * sum";Fe=Ne===.5?"inversesqrt("+Ke+")":Ne===1?"1.0/("+Ke+")":"exp(log("+Ke+") * float(-"+Ne+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+He+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+He+"; j <= "+He+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+Ye+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+Fe+`;
        setOutput(result);
      }
    `}(c.shape,m,w,R,K):new function(le,de,_e,Te,Ne){this.variableNames=["x"],this.outputShape=[];var Fe,He=de,Ye=le[3]-1;this.outputShape=le;var Ke="float("+_e+") + float("+Te+") * sum";Fe=Ne===.5?"inversesqrt("+Ke+")":Ne===1?"1.0/("+Ke+")":"exp(log("+Ke+") * float(-"+Ne+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+He+"; j <= "+He+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+Ye+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+Fe+`;
        setOutput(val);
      }
    `}(c.shape,m,w,R,K);return this.compileAndRun(ee,[c])},h.prototype.LRNGrad=function(c,m,w,R,K,ee,le){var de=new function(_e,Te,Ne,Fe,He){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=_e,this.depth=_e[3],this.depthRadius=Te,this.bias=Ne,this.alpha=Fe,this.beta=He,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+Te+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+Te+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+Fe+") * norm + float("+Ne+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+Fe+`)
                * float(`+He+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+He+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}(m.shape,R,K,ee,le);return this.compileAndRun(de,[m,w,c])},h.prototype.tile=function(c,m){if(c.dtype==="string"){var w=this.readSync(c.dataId).map(function(K){return Un(K)});return wa(Di(c.shape,c.dtype,w),m)}var R=new function(K,ee){this.variableNames=["A"];for(var le=new Array(K.length),de=0;de<le.length;de++)le[de]=K[de]*ee[de];this.outputShape=le,this.rank=le.length;var _e=jo(this.rank),Te=function(Ne){var Fe=Ne.length;if(Fe>5)throw Error("Tile for rank "+Fe+" is not yet supported");if(Fe===1)return"imod(resRC, "+Ne[0]+")";for(var He=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],Ye=[],Ke=0;Ke<Ne.length;Ke++)Ye.push("imod("+He[Ke]+", "+Ne[Ke]+")");return Ye.join()}(K);this.userCode=`
      void main() {
        `+_e+` resRC = getOutputCoords();
        setOutput(getA(`+Te+`));
      }
    `}(c.shape,m);return this.compileAndRun(R,[c])},h.prototype.pad=function(c,m,w){var R=z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(K,ee,le){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ee.map(function(an,dn){return an[0]+K[dn]+an[1]});for(var de=K.length,_e=jo(de),Te=ee.map(function(an){return an[0]}).join(","),Ne=ee.map(function(an,dn){return an[0]+K[dn]}).join(","),Fe=_a("rc",de),He=_a("source",de),Ye=Fe[de-1]+" < "+this.outputShape[de-1],Ke=de===1?"source":"vec2("+He.slice(-2).join()+")",it=[_e+" rc = outputLoc;",Fe[de-1]+` += 1;
       if(`+Ye+`) {
      `,de===1?"":`}
       rc = outputLoc;
       `+Fe[de-2]+` += 1;
       if(`+Fe[de-2]+" < "+this.outputShape[de-2]+") {",de===1?"":"  "+Fe[de-1]+` += 1;
         if(`+Ye+") {"],gt=de===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",wt="",At=0,zt=de===1?2:4;At<zt;At++)wt+=`
        `+it[At]+`
        if (`+gt+`) {
          result[`+At+"] = float("+le+`);
        } else {
          `+_e+` source = rc - start;
          result[`+At+"] = getChannel(getX("+He.join()+"), "+Ke+`);
        }
      `;wt+=de===1?"} ":"}}",this.userCode=`
      const `+_e+" start = "+_e+"("+Te+`);
      const `+_e+" end = "+_e+"("+Ne+`);

      void main() {
        `+_e+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+wt+`
        setOutput(result);
      }
    `}(c.shape,m,w):new function(K,ee,le){this.variableNames=["x"],this.outputShape=ee.map(function(He,Ye){return He[0]+K[Ye]+He[1]});var de=K.length,_e=jo(de),Te=ee.map(function(He){return He[0]}).join(","),Ne=ee.map(function(He,Ye){return He[0]+K[Ye]}).join(","),Fe=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,de);this.userCode=de!==1?`
      `+_e+" start = "+_e+"("+Te+`);
      `+_e+" end = "+_e+"("+Ne+`);

      void main() {
        `+_e+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+le+`));
        } else {
          `+_e+` coords = outC - start;
          setOutput(getX(`+Fe+`));
        }
      }
    `:`
        int start = `+Te+`;
        int end = `+Ne+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+le+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}(c.shape,m,w);return this.compileAndRun(R,[c])},h.prototype.gather=function(c,m,w){if(this.shouldExecuteOnCPU([c,m]))return this.cpuBackend.gather(c,m,w);var R=new function(K,ee,le){this.variableNames=["A","indices"];var de=K.slice();de[le]=ee,this.outputShape=de,this.rank=de.length;var _e=jo(this.rank),Te=function(Ne,Fe){var He=Ne.length;if(He>4)throw Error("Gather for rank "+He+" is not yet supported");if(He===1)return"int(getIndices(resRC))";for(var Ye=["resRC.x","resRC.y","resRC.z","resRC.w"],Ke=[],it=0;it<Ne.length;it++)it===Fe?Ke.push("int(getIndices("+Ye[it]+"))"):Ke.push(""+Ye[it]);return Ke.join()}(K,le);this.userCode=`
      void main() {
        `+_e+` resRC = getOutputCoords();
        setOutput(getA(`+Te+`));
      }
    `}(c.shape,m.size,w);return this.compileAndRun(R,[c,m])},h.prototype.batchToSpaceND=function(c,m,w){we(c.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var R=m.reduce(function(Te,Ne){return Te*Ne}),K=vd(c.shape,m,R),ee=Ol(K.length,m.length),le=df(c.shape,m,R),de=Xp(w,m.length),_e=Qm(le,w,m.length);return vt(c.reshape(K),ee).reshape(le).slice(de,_e)},h.prototype.spaceToBatchND=function(c,m,w){we(c.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var R=m.reduce(function(Ne,Fe){return Ne*Fe}),K=[[0,0]];K.push.apply(K,w);for(var ee=1+m.length;ee<c.shape.length;++ee)K.push([0,0]);var le=c.pad(K),de=vd(le.shape,m,R,!1),_e=Ol(de.length,m.length,!1),Te=df(le.shape,m,R,!1);return vt(le.reshape(de),_e).reshape(Te)},h.prototype.reduce=function(c,m,w){var R=c.shape[0],K=c.shape[1],ee=new function(de,_e){this.variableNames=["x"];var Te=de.windowSize,Ne=de.batchSize,Fe=de.inSize,He=Math.ceil(Fe/Te);this.outputShape=[Ne,He];var Ye="0.0",Ke="";_e==="prod"?Ye="1.0":_e==="min"?(Ye="1.0 / 1e-20",Ke="min"):_e==="max"&&(Ye="-1.0 / 1e-20",Ke="max");var it=_e+"("+_e+"("+_e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";_e==="sum"?it="sumValue":_e==="prod"?it="prodValue":_e==="all"?it="allValue":_e==="any"&&(it="anyValue");var gt=4*Math.floor(Te/4),wt=Te%4,At=`
      if (`+(_e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(_e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+Ke+`(values, minMaxValue);
      }
    `,zt="vec4";_e==="all"?(Ye="1.0",At=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,zt="bvec4"):_e==="any"&&(Ye="0.0",At=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,zt="bvec4");var an="";Fe%Te>0&&(an=`
        if (inIdx < 0 || inIdx >= `+Fe+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+Ye+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+an+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+Te+`;

        vec4 minMaxValue = vec4(`+Ye+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+gt+`; i += 4) {
          int inIdx = inOffset + i;
          `+zt+" values = "+zt+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+At+`
        }

        int inIdx = inOffset + `+gt+`;
        if (`+(wt===1)+`) {
          `+zt+" values = "+zt+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+At+`
        } else if (`+(wt===2)+`) {
          `+zt+" values = "+zt+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+At+`
        } else if (`+(wt===3)+`) {
          `+zt+" values = "+zt+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+At+`
        }
        setOutput(`+it+`);
      }
    `}({windowSize:Fc(K),inSize:K,batchSize:R},m),le=this.compileAndRun(ee,[c],w);return le.shape[1]===1?le:this.reduce(le,m,w)},h.prototype.argReduce=function(c,m,w){w===void 0&&(w=null);var R=c.shape[0],K=c.shape[1];w!=null&&(R=w.shape[0],K=w.shape[1]);var ee=new function(_e,Te,Ne){this.variableNames=["A"];var Fe=_e.windowSize,He=_e.batchSize,Ye=_e.inSize,Ke=Math.ceil(Ye/Fe);Ne||this.variableNames.push("bestIndicesA"),this.outputShape=[He,Ke];var it=Te==="max"?">":"<",gt=Ne?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+Fe+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+Fe+`; i++) {
          int inIdx = `+gt+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+it+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}({windowSize:Fc(K),inSize:K,batchSize:R},m,w==null),le=[c];w!=null&&le.push(w);var de=this.compileAndRun(ee,le,"int32");return de.shape[1]===1?de:this.argReduce(c,m,de)},h.prototype.argReducePacked=function(c,m,w){w===void 0&&(w=null);var R=w!=null?w.shape:c.shape,K=new function(de,_e,Te,Ne){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,we(de.length>2,function(){return"Packed arg"+(Te.charAt(0).toUpperCase()+Te.slice(1))+" supports only inputs with rank above 2."});var Fe=de[de.length-1],He=Math.ceil(Fe/_e);this.outputShape=de.slice(0,-1),He>1&&this.outputShape.push(He),Ne||this.variableNames.push("bestIndicesA");var Ye,Ke,it=this.outputShape,gt=it.length,wt=jo(gt),At=_a("coords",gt);if(He===1){var zt=jo(Ke=gt+1);Ye=`
        `+zt+" sourceLocR = "+zt+"("+At.join()+`, 0);
        ++`+At[gt-1]+`;
        `+zt+" sourceLocG = "+zt+"("+At.join()+`, 0);
        ++`+At[gt-2]+`;
        `+zt+" sourceLocA = "+zt+"("+At.join()+`, 0);
        --`+At[gt-1]+`;
        `+zt+" sourceLocB = "+zt+"("+At.join()+`, 0);
        --`+At[gt-2]+";"}else Ke=gt,Ye=`
        `+wt+` sourceLocR = coords;
        ++`+At[gt-1]+`;
        `+wt+` sourceLocG = coords;
        ++`+At[gt-2]+`;
        `+wt+` sourceLocA = coords;
        --`+At[gt-1]+`;
        `+wt+` sourceLocB = coords;
        --`+At[gt-2]+";";var an=["x","y","z","w","u","v"].slice(0,Ke),dn="."+an[Ke-1],sn=an.map(function(xr){return"int "+xr}),ln=_a("sourceLocR",Ke-1).concat("inIdx.r"),Tn=_a("sourceLocG",Ke-1).concat("inIdx.g"),Bn=_a("sourceLocB",Ke-1).concat("inIdx.b"),In=_a("sourceLocA",Ke-1).concat("inIdx.a"),or=Te==="max"?"greaterThan":"lessThan",fr=Ne?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+ln.join()+`),
                             getBestIndicesAChannel(`+Tn.join()+`),
                             getBestIndicesAChannel(`+Bn.join()+`),
                             getBestIndicesAChannel(`+In.join()+")));",br=`vec4(
            getAChannel(`+ln.join()+`),
            hasNextCol ? getAChannel(`+Tn.join()+`) : 0.,
            hasNextRow ? getAChannel(`+Bn.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+In.join()+") : 0.)",_r=Ne?"":`
      float getBestIndicesAChannel(`+sn.join()+`) {
        return getChannel(getBestIndicesA(`+an.join()+`),
                                          vec2(`+an.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+sn.join()+`) {
        return getChannel(getA(`+an.join()+`),
                               vec2(`+an.slice(-2).join()+`));
      }
      `+_r+`
      void main() {
        `+wt+` coords = getOutputCoords();
        bool hasNextCol = `+At[gt-1]+" < "+(it[gt-1]-1)+`;
        bool hasNextRow = `+At[gt-2]+" < "+(it[gt-2]-1)+`;
        `+Ye+`
        ivec4 srcIdx = ivec4(sourceLocR`+dn+", sourceLocG"+dn+`,
          sourceLocB`+dn+", sourceLocA"+dn+") * "+_e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+br+`;

        for (int i = 0; i < `+_e+`; i++) {
          inIdx = srcIdx;
          `+fr+`
          vec4 candidate = `+br+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+or+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}(R,Fc(R[R.length-1]),m,w==null),ee=w==null?[c]:[c,w],le=this.compileAndRun(K,ee,"int32");return le.rank===c.rank?this.argReducePacked(c,m,le):le},h.prototype.sum=function(c,m){ta("sum",m,c.rank);var w=Io(c.shape,m),R=w[0],K=ze(w[1]),ee=c.as2D(-1,K),le=Nt(c.dtype);return this.reduce(ee,"sum",le).reshape(R)},h.prototype.prod=function(c,m){if(this.shouldExecuteOnCPU([c]))return this.cpuBackend.prod(c,m);var w=Io(c.shape,m),R=w[0],K=ze(w[1]),ee=c.as2D(-1,K),le=Nt(c.dtype);return this.reduce(ee,"prod",le).reshape(R)},h.prototype.unsortedSegmentSum=function(c,m,w){var R=0,K=Ra([R],c.rank),ee=c;K!=null&&(ee=vt(c,K),R=Pa(1,c.rank)[0]);var le=function(Fe,He,Ye){for(var Ke=[],it=Fe.length,gt=0;gt<it;gt++)gt!==He?Ke.push(Fe[gt]):Ke.push(Ye);return Ke}(ee.shape,R,w),de=ze([ee.shape[R]]),_e=ee.as2D(-1,de),Te=Nt(c.dtype),Ne=this.segOpCompute(_e,"unsortedSegmentSum",m,Te,w).reshape(le);return K!=null&&(Ne=vt(Ne,Vu(K))),Ne},h.prototype.segOpCompute=function(c,m,w,R,K){var ee=c.shape[0],le=c.shape[1],de=function(Ne,Fe){var He,Ye=!1;for(Ne<=pc?(He=Ne,Ye=!0):He=Tr(Ne,Math.floor(Math.sqrt(Ne)));!Ye;)He>Fe||He===Ne?Ye=!0:He=Tr(Ne,He+1);return He}(le,K),_e=new function(Ne,Fe){this.variableNames=["x","segmentIds"];var He=Ne.windowSize,Ye=Ne.batchSize,Ke=Ne.inSize,it=Ne.numSegments,gt=it*Math.ceil(Ke/He);this.outputShape=[Ye,gt];var wt=4*Math.floor(He/4),At=He%4,zt=`
        sumValue += dot(values, segFilter);
    `,an="";Ke%He>0&&(an=`
        if (inIdx < 0 || inIdx >= `+Ke+`) {
          return initializationValue;
        }
      `);var dn="";Ke%He>0&&(dn=`
        if (inIdx < 0 || inIdx >= `+Ke+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+an+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+dn+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+it+")) * float("+He+`));
        int currentSeg = int(mod(float(outIdx), float(`+it+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+wt+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+zt+`
        }

        int inIdx = inOffset + `+wt+`;
        if (`+(At===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+zt+`
        } else if (`+(At===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+zt+`
        } else if (`+(At===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+zt+`
        }
        setOutput(sumValue);
      }
    `}({windowSize:de,inSize:le,batchSize:ee,numSegments:K}),Te=this.compileAndRun(_e,[c,w],R);return Te.shape[1]===K?Te:(w=Dc(0,K).tile([le/de]),this.segOpCompute(Te,m,w,R,K))},h.prototype.argMinMaxReduce=function(c,m,w){var R=[m];if(ta("arg"+w.charAt(0).toUpperCase()+w.slice(1),R,c.rank),!z().getBool("WEBGL_PACK_REDUCE")||c.rank<=2){var K=Io(c.shape,R),ee=K[0],le=ze(K[1]),de=c.as2D(-1,le);return this.argReduce(de,w).reshape(ee)}return this.argReducePacked(c,w)},h.prototype.argMin=function(c,m){return this.argMinMaxReduce(c,m,"min")},h.prototype.argMax=function(c,m){return this.argMinMaxReduce(c,m,"max")},h.prototype.cumsum=function(c,m,w,R){if(m!==c.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(c.rank-1)+" but got axis="+m);var K=new function(ee,le,de){this.variableNames=["x"],this.outputShape=ee;var _e=ee.length,Te=ee[ee.length-1],Ne=de?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(de?"return "+Te+" -i - 1;":"return i;")+`
      }

      void main() {
        `+jo(_e)+` coords = getOutputCoords();
        int end = `+rv(_e,"coords")+`;
        float val = 0.0;
        for (int i = `+Te+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+Ne+` end) {
            continue;
          }
          if (idx == end && `+le+`) {
            continue;
          }
          `+rv(_e,"coords")+` = idx;
          val += getX(`+function(Fe,He){if(Fe===1)return""+He;if(Fe===2)return He+".x, "+He+".y";if(Fe===3)return He+".x, "+He+".y, "+He+".z";if(Fe===4)return He+".x, "+He+".y, "+He+".z, "+He+".w";throw Error("Cumulative sum for rank "+Fe+" is not yet supported")}(_e,"coords")+`);
        }
        setOutput(val);
      }
    `}(c.shape,w,R);return this.compileAndRun(K,[c])},h.prototype.equal=function(c,m){if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(c,m,`
  return vec4(equal(a, b));
`,"bool");var w=new $o("return float(a == b);",c.shape,m.shape);return this.compileAndRun(w,[c,m],"bool")},h.prototype.notEqual=function(c,m){if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(c,m,`
  return vec4(notEqual(a, b));
`,"bool");var w=new $o("return float(a != b);",c.shape,m.shape);return this.compileAndRun(w,[c,m],"bool")},h.prototype.less=function(c,m){if(this.shouldExecuteOnCPU([c,m]))return this.cpuBackend.less(c,m);if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(c,m,`
  return vec4(lessThan(a, b));
`,"bool");var w=new $o("return float(a < b);",c.shape,m.shape);return this.compileAndRun(w,[c,m],"bool")},h.prototype.lessEqual=function(c,m){if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(c,m,`
  return vec4(lessThanEqual(a, b));
`,"bool");var w=new $o("return float(a <= b);",c.shape,m.shape);return this.compileAndRun(w,[c,m],"bool")},h.prototype.greater=function(c,m){if(this.shouldExecuteOnCPU([c,m]))return this.cpuBackend.greater(c,m);if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(c,m,`
  return vec4(greaterThan(a, b));
`,"bool");var w=new $o("return float(a > b);",c.shape,m.shape);return this.compileAndRun(w,[c,m],"bool")},h.prototype.greaterEqual=function(c,m){if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(c,m,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var w=new $o("return float(a >= b);",c.shape,m.shape);return this.compileAndRun(w,[c,m],"bool")},h.prototype.logicalNot=function(c){var m=new yo(c.shape,"return float(!(x >= 1.0));");return this.compileAndRun(m,[c])},h.prototype.logicalAnd=function(c,m){if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(c,m,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var w=new $o("return float(a >= 1.0 && b >= 1.0);",c.shape,m.shape);return this.compileAndRun(w,[c,m],"bool")},h.prototype.logicalOr=function(c,m){if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(c,m,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var w=new $o("return float(a >= 1.0 || b >= 1.0);",c.shape,m.shape);return this.compileAndRun(w,[c,m],"bool")},h.prototype.select=function(c,m,w){var R=new function(K,ee,le){var de,_e;if(this.variableNames=["c","a","b"],this.outputShape=ee,le>4)throw Error("Where for rank "+le+" is not yet supported");if(le===1)_e="resRC",de="resRC";else{for(var Te=["resRC.x","resRC.y","resRC.z","resRC.w"],Ne=[],Fe=[],He=0;He<ee.length;He++)Fe.push(""+Te[He]),He<K&&Ne.push(""+Te[He]);de=Ne.join(),_e=Fe.join()}var Ye=jo(le);this.userCode=`
      void main() {
        `+Ye+` resRC = getOutputCoords();
        float cVal = getC(`+de+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+_e+`));
        } else {
          setOutput(getB(`+_e+`));
        }
      }
    `}(c.rank,m.shape,m.rank);return this.compileAndRun(R,[c,m,w],En(m.dtype,w.dtype))},h.prototype.where=function(c){kl("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var m=c.dataSync();return oa(c.shape,m)},h.prototype.topk=function(c,m,w){return ha(c.dataSync(),c.shape,c.dtype,m)},h.prototype.min=function(c,m){ta("min",m,c.rank);var w=Io(c.shape,m),R=w[0],K=ze(w[1]),ee=c.as2D(-1,K);return this.reduce(ee,"min",ee.dtype).reshape(R)},h.prototype.minimum=function(c,m){if(this.shouldExecuteOnCPU([c,m]))return this.cpuBackend.minimum(c,m);var w=z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ga(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,c.shape,m.shape):new $o(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,c.shape,m.shape);return this.compileAndRun(w,[c,m])},h.prototype.mod=function(c,m){var w=z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ga(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,c.shape,m.shape):new $o(`if (b == 0.0) return NAN;
  return mod(a, b);`,c.shape,m.shape);return this.compileAndRun(w,[c,m])},h.prototype.max=function(c,m){if(this.shouldExecuteOnCPU([c]))return this.cpuBackend.max(c,m);ta("max",m,c.rank);var w=Io(c.shape,m),R=w[0],K=ze(w[1]),ee=c.as2D(-1,K);return this.reduce(ee,"max",ee.dtype).reshape(R)},h.prototype.maximum=function(c,m){if(this.shouldExecuteOnCPU([c,m]))return this.cpuBackend.maximum(c,m);var w=z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ga(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,c.shape,m.shape):new $o(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,c.shape,m.shape);return this.compileAndRun(w,[c,m])},h.prototype.all=function(c,m){ta("all",m,c.rank);var w=Io(c.shape,m),R=w[0],K=ze(w[1]),ee=c.as2D(-1,K);return this.reduce(ee,"all",ee.dtype).reshape(R)},h.prototype.any=function(c,m){ta("any",m,c.rank);var w=Io(c.shape,m),R=w[0],K=ze(w[1]),ee=c.as2D(-1,K);return this.reduce(ee,"any",ee.dtype).reshape(R)},h.prototype.floorDiv=function(c,m){if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(c,m,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var w=new $o(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,c.shape,m.shape);return this.compileAndRun(w,[c,m],"int32")},h.prototype.add=function(c,m){if(c.dtype==="complex64"&&m.dtype==="complex64")return this.complexSeparableBinaryOp(c,m,js);if(this.shouldExecuteOnCPU([c,m]))return this.cpuBackend.add(c,m);var w=En(c.dtype,m.dtype);if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(c,m,js,w);var R=new $o(js,c.shape,m.shape);return this.compileAndRun(R,[c,m],w)},h.prototype.packedUnaryOp=function(c,m,w){var R=new kf(c.shape,m);return this.compileAndRun(R,[c],w)},h.prototype.packedBinaryOp=function(c,m,w,R,K){K===void 0&&(K=!1);var ee=new Ga(w,c.shape,m.shape,K);return this.compileAndRun(ee,[c,m],R)},h.prototype.complexSeparableBinaryOp=function(c,m,w){var R=this,K=this.texData.get(c.dataId),ee=this.texData.get(m.dataId),le=[[K.complexTensors.real,ee.complexTensors.real],[K.complexTensors.imag,ee.complexTensors.imag]].map(function(Ne){var Fe=Ne[0],He=Ne[1],Ye=R.makeComplexComponentTensorInfo(c,Fe),Ke=R.makeComplexComponentTensorInfo(m,He),it=new $o(w,c.shape,m.shape);return R.compileAndRun(it,[Ye,Ke],En(Fe.dtype,He.dtype))}),de=le[0],_e=le[1],Te=this.complex(de,_e);return de.dispose(),_e.dispose(),Te},h.prototype.makeComplexComponentTensorInfo=function(c,m){return{dataId:m.dataId,dtype:m.dtype,shape:c.shape}},h.prototype.addN=function(c){if(c.length===1)return c[0];if(c.length>z().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var m=Math.floor(c.length/2),w=this.addN(c.slice(0,m)),R=this.addN(c.slice(m));return this.addN([w,R])}var K=c.map(function(de){return de.dtype}).reduce(function(de,_e){return En(de,_e)}),ee=c.map(function(de){return de.shape}),le=z().getBool("WEBGL_PACK")?new function(de,_e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=de,this.variableNames=_e.map(function(Fe,He){return"T"+He});var Te=[];this.variableNames.forEach(function(Fe){Te.push("vec4 v"+Fe+" = get"+Fe+"AtOutCoords();")});var Ne=this.variableNames.map(function(Fe){return"v"+Fe}).join(" + ");this.userCode=`
      void main() {
        `+Te.join(`
        `)+`

        vec4 result = `+Ne+`;
        setOutput(result);
      }
    `}(c[0].shape,ee):new function(de,_e){this.outputShape=[],this.outputShape=de,this.variableNames=_e.map(function(Fe,He){return"T"+He});var Te=[];this.variableNames.forEach(function(Fe){Te.push("float v"+Fe+" = get"+Fe+"AtOutCoords();")});var Ne=this.variableNames.map(function(Fe){return"v"+Fe}).join(" + ");this.userCode=`
      void main() {
        `+Te.join(`
        `)+`

        float result = `+Ne+`;
        setOutput(result);
      }
    `}(c[0].shape,ee);return this.compileAndRun(le,c,K)},h.prototype.subtract=function(c,m){if(c.dtype==="complex64"&&m.dtype==="complex64")return this.complexSeparableBinaryOp(c,m,ns);if(this.shouldExecuteOnCPU([c,m]))return this.cpuBackend.subtract(c,m);var w=En(c.dtype,m.dtype);if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(c,m,ns,c.dtype);var R=new $o(ns,c.shape,m.shape);return this.compileAndRun(R,[c,m],w)},h.prototype.pow=function(c,m){var w=z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ga(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,c.shape,m.shape):new $o(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,c.shape,m.shape),R=En(c.dtype,m.dtype);return this.compileAndRun(w,[c,m],R)},h.prototype.ceil=function(c){if(this.shouldExecuteOnCPU([c]))return this.cpuBackend.ceil(c);if(z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(c,mv,c.dtype);var m=new yo(c.shape,mv);return this.compileAndRun(m,[c])},h.prototype.floor=function(c){if(this.shouldExecuteOnCPU([c]))return this.cpuBackend.floor(c);if(z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(c,gv,c.dtype);var m=new yo(c.shape,gv);return this.compileAndRun(m,[c])},h.prototype.sign=function(c){var m=new yo(c.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(m,[c])},h.prototype.isNaN=function(c){var m=new yo(c.shape,"return float(isnan(x));");return this.compileAndRun(m,[c],"bool")},h.prototype.isInf=function(c){var m=new yo(c.shape,"return float(isinf(x));");return this.compileAndRun(m,[c],"bool")},h.prototype.isFinite=function(c){var m=new yo(c.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(m,[c],"bool")},h.prototype.round=function(c){var m=new yo(c.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(m,[c])},h.prototype.exp=function(c){if(this.shouldExecuteOnCPU([c]))return this.cpuBackend.exp(c);if(z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(c,Vh,c.dtype);var m=new yo(c.shape,Vh);return this.compileAndRun(m,[c])},h.prototype.expm1=function(c){if(this.shouldExecuteOnCPU([c]))return this.cpuBackend.expm1(c);if(z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(c,Dd,c.dtype);var m=new yo(c.shape,Dd);return this.compileAndRun(m,[c])},h.prototype.softmax=function(c,m){var w=Yt([m],c.shape),R=this.max(c,w),K=Fo(R.shape,w),ee=this.subtract(c,R.reshape(K)),le=this.exp(ee),de=this.sum(le,w).reshape(K);return ra(le,de)},h.prototype.log=function(c){if(this.shouldExecuteOnCPU([c]))return this.cpuBackend.log(c);if(z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(c,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,c.dtype);var m=new yo(c.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(m,[c])},h.prototype.log1p=function(c){var m=new yo(c.shape,"return log(1.0 + x);");return this.compileAndRun(m,[c])},h.prototype.sqrt=function(c){var m=new yo(c.shape,"return sqrt(x);");return this.compileAndRun(m,[c])},h.prototype.rsqrt=function(c){if(this.shouldExecuteOnCPU([c]))return this.cpuBackend.rsqrt(c);var m=new yo(c.shape,"return inversesqrt(x);");return this.compileAndRun(m,[c])},h.prototype.reciprocal=function(c){var m=new yo(c.shape,"return 1.0 / x;");return this.compileAndRun(m,[c])},h.prototype.relu=function(c){var m;return m=z().getBool("WEBGL_PACK")?new kf(c.shape,tg):new yo(c.shape,pv),this.compileAndRun(m,[c])},h.prototype.relu6=function(c){var m;return m=z().getBool("WEBGL_PACK")?new kf(c.shape,jl):new yo(c.shape,sm),this.compileAndRun(m,[c])},h.prototype.prelu=function(c,m){var w=z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ga(fs,c.shape,m.shape):new $o(il,c.shape,m.shape);return this.compileAndRun(w,[c,m])},h.prototype.elu=function(c){if(z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(c,Ju,c.dtype);var m=new yo(c.shape,Ll);return this.compileAndRun(m,[c])},h.prototype.eluDer=function(c,m){var w=z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ga(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,c.shape,m.shape):new $o("return (b >= 1.0) ? a : a * (b + 1.0);",c.shape,m.shape);return this.compileAndRun(w,[c,m])},h.prototype.selu=function(c){var m=new yo(c.shape,`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = 1.7580993408473768;
  float scale = 1.0507009873554805;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`);return this.compileAndRun(m,[c])},h.prototype.int=function(c){var m=new yo(c.shape,"return float(int(x));");return this.compileAndRun(m,[c],"int32")},h.prototype.clip=function(c,m,w){var R,K=(R=z().getBool("WEBGL_PACK_CLIP")?new Rl(c.shape):new Pc(c.shape)).getCustomSetupFunc(m,w);return this.compileAndRun(R,[c],null,K)},h.prototype.abs=function(c){if(this.shouldExecuteOnCPU([c]))return this.cpuBackend.abs(c);if(z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(c,eg,c.dtype);var m=new yo(c.shape,eg);return this.compileAndRun(m,[c])},h.prototype.complexAbs=function(c){var m=this.texData.get(c.dataId),w=new function(K){this.variableNames=["real","imag"],this.outputShape=K,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}(c.shape),R=[this.makeComplexComponentTensorInfo(c,m.complexTensors.real),this.makeComplexComponentTensorInfo(c,m.complexTensors.imag)];return this.compileAndRun(w,R)},h.prototype.sigmoid=function(c){var m=new yo(c.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(m,[c])},h.prototype.softplus=function(c){var m=new yo(c.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(m,[c])},h.prototype.sin=function(c){var m=new yo(c.shape,`if (isnan(x)) return x;
  return sin(x);
`);return this.compileAndRun(m,[c])},h.prototype.cos=function(c){var m=new yo(c.shape,`if (isnan(x)) return x;
  return cos(x);
`);return this.compileAndRun(m,[c])},h.prototype.tan=function(c){var m=new yo(c.shape,"return tan(x);");return this.compileAndRun(m,[c])},h.prototype.asin=function(c){var m=new yo(c.shape,`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`);return this.compileAndRun(m,[c])},h.prototype.acos=function(c){var m=new yo(c.shape,`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`);return this.compileAndRun(m,[c])},h.prototype.atan=function(c){var m=new yo(c.shape,`if (isnan(x)) return x;
  return atan(x);
`);return this.compileAndRun(m,[c])},h.prototype.atan2=function(c,m){var w=z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ga(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,c.shape,m.shape):new $o(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,c.shape,m.shape);return this.compileAndRun(w,[c,m])},h.prototype.sinh=function(c){var m=new yo(c.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(m,[c])},h.prototype.cosh=function(c){var m=new yo(c.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(m,[c])},h.prototype.tanh=function(c){var m=new yo(c.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(m,[c])},h.prototype.asinh=function(c){var m=new yo(c.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(m,[c])},h.prototype.acosh=function(c){var m=new yo(c.shape,`if (isnan(x)) return x;
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`);return this.compileAndRun(m,[c])},h.prototype.atanh=function(c){var m=new yo(c.shape,`if (isnan(x)) return x;
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`);return this.compileAndRun(m,[c])},h.prototype.erf=function(c){var m=new yo(c.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(m,[c])},h.prototype.step=function(c,m){var w=new yo(c.shape,function(R){return R===void 0&&(R=0),dv+`
    return x > 0.0 ? 1.0 : float(`+R+`);
  `}(m));return this.compileAndRun(w,[c])},h.prototype.conv2dByMatMul=function(c,m,w,R,K,ee){var le=c.shape,de=this.texData.get(c.dataId),_e=w.inChannels,Te=le[0]*le[1]*le[2],Ne=w.outChannels,Fe=w.dataFormat==="channelsLast",He=(Te===1||Ne===1)&&_e>1e3,Ye=le[2]%2!=0&&!!de.isPacked;if(He||!z().getBool("WEBGL_LAZILY_UNPACK")||!z().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!Ye){var Ke=Fe?le[0]*le[1]*le[2]:le[0]*le[2]*le[3],it=this.reshape(c,[1,Ke,w.inChannels]),gt=this.reshape(m,[1,w.inChannels,w.outChannels]);return this.reshape(this.fusedBatchMatMul({a:it,b:gt,transposeA:!1,transposeB:!1,bias:R,activation:K,preluActivationWeights:ee}),w.outShape)}var wt=Fe?le[0]*le[1]*(le[2]+1):le[0]*le[2]*(le[3]+1),At={dataId:c.dataId,shape:[1,wt,w.inChannels],dtype:c.dtype},zt=de.shape;de.shape=de.shape.slice(),de.shape[de.shape.length-2]++,we(Mu(de.shape,At.shape),function(){return"packed reshape "+de.shape+" to "+At.shape+" isn't free"});var an=this.reshape(m,[1,w.inChannels,w.outChannels]),dn=this.fusedBatchMatMul({a:At,b:an,transposeA:!1,transposeB:!1,bias:R,activation:K,preluActivationWeights:ee}),sn=this.texData.get(dn.dataId);return we(sn.isPacked,function(){return"batchMatMul result is expected to be packed"}),de.shape=zt,sn.shape=w.outShape,Ve.makeTensorFromDataId(dn.dataId,w.outShape,dn.dtype)},h.prototype.conv2dWithIm2Row=function(c,m,w,R,K,ee){var le=w.filterWidth,de=w.filterHeight,_e=w.inChannels,Te=w.outWidth,Ne=w.outHeight,Fe=w.dataFormat==="channelsLast",He=le*de*_e,Ye=Ne*Te,Ke=[He,Ye],it=c.squeeze([0]),gt=m.reshape([1,He,-1]),wt=new function(Bn,In,or){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Bn;for(var fr=or.filterWidth,br=or.inChannels,_r=or.strideWidth,xr=or.strideHeight,vr=or.padInfo,Pr=or.outWidth,Rr=or.dilationWidth,Qr=or.dilationHeight,fi=or.dataFormat,Ci=vr.left,bo=vr.top,xo=br*fr,Mo=ko(),Oo=fi==="channelsLast",Vo=Oo?0:1,ua=Oo?1:2,$a="",so=0;so<=1;so++)for(var Do=0;Do<=1;Do++)$a+=`
          blockIndex = rc.y + `+Do+`;
          pos = rc.x + `+so+`;

          if(blockIndex < `+Bn[1]+" && pos < "+Bn[0]+`) {
            offsetY = int(blockIndex / (`+Pr+")) * "+xr+" - "+bo+`;
            d0 = offsetY + `+Qr+" * (pos / "+xo+`);

            if(d0 < `+In[Vo]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+Pr+".) * "+_r+". - "+Ci+`.);
              d1 = offsetX + `+Rr+" * (int(mod(float(pos), "+xo+".) / "+br+`.));

              if(d1 < `+In[ua]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+br+`.));

                if (`+Oo+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*so+Do)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*so+Do)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+$a+`

        `+Mo.output+` = result;
      }
    `}(Ke,it.shape,w),At=this.compileAndRun(wt,[it]).reshape([1,Ke[0],Ke[1]]),zt=R!=null,an=ee!=null,dn=K?Af(K,!0):null,sn=new Yu(At.shape,[1,Ye,w.outChannels],!0,!1,zt,dn,an),ln=[At,gt];R&&ln.push(R),an&&ln.push(ee);var Tn=this.compileAndRun(sn,ln);return Fe?Tn.reshape([1,Ne,Te,w.outChannels]):Tn.reshape([1,w.outChannels,Ne,Te])},h.prototype.fusedConv2d=function(c){var m=c.input,w=c.filter,R=c.convInfo,K=c.bias,ee=c.activation,le=c.preluActivationWeights;if(R.filterHeight===1&&R.filterWidth===1&&R.dilationHeight===1&&R.dilationWidth===1&&R.strideHeight===1&&R.strideWidth===1&&(R.padInfo.type==="SAME"||R.padInfo.type==="VALID"))return this.conv2dByMatMul(m,w,R,K,ee,le);if(z().getBool("WEBGL_CONV_IM2COL")&&m.shape[0]===1)return this.conv2dWithIm2Row(m,w,R,K,ee,le);var de=K!=null,_e=le!=null,Te=ee?Af(ee,!1):null,Ne=new tm(R,de,Te,_e),Fe=[m,w];return K&&Fe.push(K),le&&Fe.push(le),this.compileAndRun(Ne,Fe)},h.prototype.conv2d=function(c,m,w){if(w.filterHeight===1&&w.filterWidth===1&&w.dilationHeight===1&&w.dilationWidth===1&&w.strideHeight===1&&w.strideWidth===1&&(w.padInfo.type==="SAME"||w.padInfo.type==="VALID"))return this.conv2dByMatMul(c,m,w);if(z().getBool("WEBGL_CONV_IM2COL")&&c.shape[0]===1)return this.conv2dWithIm2Row(c,m,w);var R=new tm(w);return this.compileAndRun(R,[c,m])},h.prototype.conv2dDerInput=function(c,m,w){var R=new function(K){this.variableNames=["dy","W"],this.outputShape=K.inShape;var ee=K.filterHeight,le=K.filterWidth,de=K.strideHeight,_e=K.strideWidth,Te=K.dataFormat==="channelsLast",Ne=ee-1-K.padInfo.top,Fe=le-1-K.padInfo.left,He=Te?1:2,Ye=Te?2:3,Ke=Te?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+Ne+", "+Fe+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+Ke+`];

        ivec2 dyCorner = ivec2(coords[`+He+"], coords["+Ye+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+ee+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+de+`.0;

          if (dyR < 0.0 || dyR >= `+K.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+ee+` - 1 - wR;

          for (int wC = 0; wC < `+le+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+_e+`.0;

            if (dyC < 0.0 || dyC >= `+K.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+le+` - 1 - wC;

            for (int d2 = 0; d2 < `+K.outChannels+`; d2++) {

              if (`+Te+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}(w);return this.compileAndRun(R,[c,m])},h.prototype.conv2dDerFilter=function(c,m,w){var R=new function(K){this.variableNames=["x","dy"],this.outputShape=K.filterShape;var ee=K.strideHeight,le=K.strideWidth,de=K.padInfo.top,_e=K.padInfo.left,Te=K.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+K.batchSize+`; b++) {
          for (int yR = 0; yR < `+K.outHeight+`; yR++) {
            int xR = wR + yR * `+ee+" - "+de+`;

            if (xR < 0 || xR >= `+K.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+K.outWidth+`; yC++) {
              int xC = wC + yC * `+le+" - "+_e+`;

              if (xC < 0 || xC >= `+K.inWidth+`) {
                continue;
              }

              if (`+Te+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}(w);return this.compileAndRun(R,[c,m])},h.prototype.fusedDepthwiseConv2D=function(c){var m,w=c.input,R=c.filter,K=c.convInfo,ee=c.bias,le=c.activation,de=c.preluActivationWeights,_e=z().getBool("WEBGL_PACK_DEPTHWISECONV")&&K.strideWidth<=2&&K.outChannels/K.inChannels==1,Te=le?Af(le,_e):null,Ne=[w,R],Fe=ee!=null,He=de!=null;return Fe&&Ne.push(ee),He&&Ne.push(de),_e?(m=new Sf(K,Fe,Te,He),this.compileAndRun(m,Ne)):(m=new Pl(K,Fe,Te,He),this.compileAndRun(m,Ne))},h.prototype.depthwiseConv2D=function(c,m,w){var R;return z().getBool("WEBGL_PACK_DEPTHWISECONV")&&w.strideWidth<=2&&w.outChannels/w.inChannels==1?(R=new Sf(w),this.compileAndRun(R,[c,m])):(R=new Pl(w),this.compileAndRun(R,[c,m]))},h.prototype.depthwiseConv2DDerInput=function(c,m,w){var R=new function(K){this.variableNames=["dy","W"],this.outputShape=K.inShape;var ee=K.filterHeight,le=K.filterWidth,de=K.strideHeight,_e=K.strideWidth,Te=ee-1-K.padInfo.top,Ne=le-1-K.padInfo.left,Fe=K.outChannels/K.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+Te+", "+Ne+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+ee+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+de+`.0;

          if (dyR < 0.0 || dyR >= `+K.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+ee+` - 1 - wR;

          for (int wC = 0; wC < `+le+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+_e+`.0;

            if (dyC < 0.0 || dyC >= `+K.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+le+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+Fe+`; dm++) {
              int d2 = d1 * `+Fe+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(w);return this.compileAndRun(R,[c,m])},h.prototype.depthwiseConv2DDerFilter=function(c,m,w){var R=new function(K){this.variableNames=["x","dy"],this.outputShape=K.filterShape;var ee=K.strideHeight,le=K.strideWidth,de=K.padInfo.top,_e=K.padInfo.left,Te=K.outChannels/K.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+Te+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+K.batchSize+`; b++) {
          for (int yR = 0; yR < `+K.outHeight+`; yR++) {
            int xR = wR + yR * `+ee+" - "+de+`;

            if (xR < 0 || xR >= `+K.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+K.outWidth+`; yC++) {
              int xC = wC + yC * `+le+" - "+_e+`;

              if (xC < 0 || xC >= `+K.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}(w);return this.compileAndRun(R,[c,m])},h.prototype.conv3d=function(c,m,w){var R=new function(K){this.variableNames=["x","W"],this.outputShape=K.outShape;var ee=K.padInfo.front,le=K.padInfo.top,de=K.padInfo.left,_e=K.strideDepth,Te=K.strideHeight,Ne=K.strideWidth,Fe=K.dilationDepth,He=K.dilationHeight,Ye=K.dilationWidth,Ke=K.filterDepth,it=K.filterHeight,gt=K.filterWidth,wt=4*Math.floor(K.inChannels/4),At=K.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+_e+", "+Te+", "+Ne+`);
      const ivec3 pads = ivec3(`+ee+", "+le+", "+de+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+Ke+`; wF++) {
          int xF = xFCorner + wF * `+Fe+`;

          if (xF < 0 || xF >= `+K.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+it+`; wR++) {
            int xR = xRCorner + wR * `+He+`;

            if (xR < 0 || xR >= `+K.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+gt+`; wC++) {
              int xC = xCCorner + wC * `+Ye+`;

              if (xC < 0 || xC >= `+K.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+wt+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(At===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+wt+`) *
                  getW(wF, wR, wC, `+wt+`, d2);
              } else if (`+(At===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+wt+`),
                  getX(batch, xF, xR, xC, `+wt+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+wt+`, d2),
                  getW(wF, wR, wC, `+wt+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(At===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+wt+`),
                  getX(batch, xF, xR, xC, `+wt+` + 1),
                  getX(batch, xF, xR, xC, `+wt+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+wt+`, d2),
                  getW(wF, wR, wC, `+wt+` + 1, d2),
                  getW(wF, wR, wC, `+wt+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(w);return this.compileAndRun(R,[c,m])},h.prototype.conv3dDerInput=function(c,m,w){var R=new function(K){this.variableNames=["dy","W"],this.outputShape=K.inShape;var ee=K.filterDepth,le=K.filterHeight,de=K.filterWidth,_e=K.strideDepth,Te=K.strideHeight,Ne=K.strideWidth,Fe=ee-1-K.padInfo.front,He=le-1-K.padInfo.top,Ye=de-1-K.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+Fe+", "+He+", "+Ye+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+ee+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+_e+`.0;

          if (dyF < 0.0 || dyF >= `+K.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+ee+` - 1 - wF;

          for (int wR = 0; wR < `+le+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+Te+`.0;

            if (dyR < 0.0 || dyR >= `+K.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+le+` - 1 - wR;

            for (int wC = 0; wC < `+de+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+Ne+`.0;

              if (dyC < 0.0 || dyC >= `+K.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+de+` - 1 - wC;

              for (int d2 = 0; d2 < `+K.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(w);return this.compileAndRun(R,[c,m])},h.prototype.conv3dDerFilter=function(c,m,w){var R=new function(K){this.variableNames=["x","dy"],this.outputShape=K.filterShape;var ee=K.strideDepth,le=K.strideHeight,de=K.strideWidth,_e=K.padInfo.front,Te=K.padInfo.top,Ne=K.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+K.batchSize+`; b++) {
          for (int yF = 0; yF < `+K.outDepth+`; yF++) {
            int xF = wF + yF * `+ee+" - "+_e+`;

            if (xF < 0 || xF >= `+K.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+K.outHeight+`; yR++) {
              int xR = wR + yR * `+le+" - "+Te+`;

              if (xR < 0 || xR >= `+K.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+K.outWidth+`; yC++) {
                int xC = wC + yC * `+de+" - "+Ne+`;

                if (xC < 0 || xC >= `+K.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(w);return this.compileAndRun(R,[c,m])},h.prototype.maxPool=function(c,m){var w=new Wh(m,"max",!1);return this.compileAndRun(w,[c])},h.prototype.avgPool=function(c,m){var w=new Wh(m,"avg",!1);return this.compileAndRun(w,[c],"float32")},h.prototype.maxPoolBackprop=function(c,m,w,R){var K=new Wh(R,"max",!0),ee=this.compileAndRun(K,[m]),le=new function(_e){this.variableNames=["dy","maxPos"],this.outputShape=_e.inShape;var Te=_e.strideHeight,Ne=_e.strideWidth,Fe=_e.dilationHeight,He=_e.effectiveFilterHeight,Ye=_e.effectiveFilterWidth,Ke=He-1-_e.padInfo.top,it=Ye-1-_e.padInfo.left,gt=He*Ye-1;this.userCode=`
      const ivec2 pads = ivec2(`+Ke+", "+it+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+He+`;
          wR += `+Fe+`) {
          float dyR = float(dyRCorner + wR) / `+Te+`.0;

          if (dyR < 0.0 || dyR >= `+_e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+Ye+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+Ne+`.0;

            if (dyC < 0.0 || dyC >= `+_e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+gt+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+Ye+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}(R),de=this.compileAndRun(le,[c,ee],m.dtype);return ee.dispose(),de},h.prototype.avgPoolBackprop=function(c,m,w){var R=new function(K){this.variableNames=["dy"],this.outputShape=K.inShape;var ee=K.filterHeight,le=K.filterWidth,de=K.strideHeight,_e=K.strideWidth,Te=K.dilationHeight,Ne=K.dilationWidth,Fe=K.effectiveFilterHeight,He=K.effectiveFilterWidth,Ye=Fe-1-K.padInfo.top,Ke=He-1-K.padInfo.left,it=1/(ee*le);this.userCode=`
      const ivec2 pads = ivec2(`+Ye+", "+Ke+`);
      const float avgMultiplier = float(`+it+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+Fe+`;
            wR += `+Te+`) {
          float dyR = float(dyRCorner + wR) / `+de+`.0;

          if (dyR < 0.0 || dyR >= `+K.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+He+`;
            wC+= `+Ne+`) {
            float dyC = float(dyCCorner + wC) / `+_e+`.0;

            if (dyC < 0.0 || dyC >= `+K.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}(w);return this.compileAndRun(R,[c],m.dtype)},h.prototype.cast=function(c,m){return ni(c,m,this)},h.prototype.unstack=function(c,m){for(var w=c.shape[m],R=new Array(c.rank-1),K=0,ee=0;ee<c.rank;ee++)ee!==m&&(R[K++]=c.shape[ee]);var le=new Array(c.rank).fill(0),de=c.shape.slice();de[m]=1;var _e=new Array(w);for(ee=0;ee<_e.length;ee++)le[m]=ee,_e[ee]=this.slice(c,le,de).reshape(R);return _e},h.prototype.avgPool3d=function(c,m){var w=new im(m,"avg",!1);return this.compileAndRun(w,[c],"float32")},h.prototype.avgPool3dBackprop=function(c,m,w){var R=new function(K){this.variableNames=["dy"],this.outputShape=K.inShape;var ee=K.filterDepth,le=K.filterHeight,de=K.filterWidth,_e=K.strideDepth,Te=K.strideHeight,Ne=K.strideWidth,Fe=K.dilationDepth,He=K.dilationHeight,Ye=K.dilationWidth,Ke=K.effectiveFilterDepth,it=K.effectiveFilterHeight,gt=K.effectiveFilterWidth,wt=Ke-1-K.padInfo.front,At=it-1-K.padInfo.top,zt=gt-1-K.padInfo.left,an=1/(ee*le*de);this.userCode=`
      const ivec3 pads = ivec3(`+wt+", "+At+", "+zt+`);
      const float avgMultiplier = float(`+an+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+Ke+`;
            wD += `+Fe+`) {
          float dyD = float(dyDCorner + wD) / `+_e+`.0;

          if (dyD < 0.0 || dyD >= `+K.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+it+`;
              wR += `+He+`) {
            float dyR = float(dyRCorner + wR) / `+Te+`.0;

            if (dyR < 0.0 || dyR >= `+K.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+gt+`;
                wC += `+Ye+`) {
              float dyC = float(dyCCorner + wC) / `+Ne+`.0;

              if (dyC < 0.0 || dyC >= `+K.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(w);return this.compileAndRun(R,[c],m.dtype)},h.prototype.maxPool3d=function(c,m){var w=new im(m,"max",!1);return this.compileAndRun(w,[c],"float32")},h.prototype.maxPool3dBackprop=function(c,m,w,R){var K=new im(R,"max",!0),ee=this.compileAndRun(K,[m]),le=new function(_e){this.variableNames=["dy","maxPos"],this.outputShape=_e.inShape;var Te=_e.strideDepth,Ne=_e.strideHeight,Fe=_e.strideWidth,He=_e.dilationDepth,Ye=_e.dilationHeight,Ke=_e.dilationWidth,it=_e.effectiveFilterDepth,gt=_e.effectiveFilterHeight,wt=_e.effectiveFilterWidth,At=it-1-_e.padInfo.front,zt=gt-1-_e.padInfo.top,an=wt-1-_e.padInfo.left,dn=it*gt*wt-1;this.userCode=`
      const ivec3 pads = ivec3(`+At+", "+zt+", "+an+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+it+`;
           wD += `+He+`) {
          float dyD = float(dyDCorner + wD) / `+Te+`.0;

          if (dyD < 0.0 || dyD >= `+_e.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+gt+`;
              wR += `+Ye+`) {
            float dyR = float(dyRCorner + wR) / `+Ne+`.0;

            if (dyR < 0.0 || dyR >= `+_e.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+wt+`;
                wC += `+Ke+`) {
              float dyC = float(dyCCorner + wC) / `+Fe+`.0;

              if (dyC < 0.0 || dyC >= `+_e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+dn+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+gt+" * "+wt+` +
                  wR * `+wt+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(R),de=this.compileAndRun(le,[c,ee],m.dtype);return ee.dispose(),de},h.prototype.reshape=function(c,m){var w=this.texData.get(c.dataId);if(w.isPacked&&!Mu(c.shape,m)&&(w.texture===null||!Mu(w.shape,m))){var R=this.packedReshape(c,m);return Ve.makeTensorFromDataId(R.dataId,R.shape,R.dtype)}return bi(c,m)},h.prototype.resizeBilinear=function(c,m,w,R){var K=z().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new function(ee,le,de,_e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var Te=ee[0],Ne=ee[1],Fe=ee[2],He=ee[3];this.outputShape=[Te,le,de,He];var Ye=[_e&&le>1?Ne-1:Ne,_e&&de>1?Fe-1:Fe],Ke=[_e&&le>1?le-1:le,_e&&de>1?de-1:de];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+Ye[0]/Ke[0]+`,
          `+Ye[1]/Ke[1]+`,
          `+Ye[1]/Ke[1]+`);
      const vec3 inputShapeRC = vec3(`+Ne+".0, "+Fe+`.0,
                                     `+Fe+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(He-1)+`;
        bool hasNextRow = coords.z < `+(de-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}(c.shape,m,w,R):new function(ee,le,de,_e){this.variableNames=["A"],this.outputShape=[];var Te=ee[0],Ne=ee[1],Fe=ee[2],He=ee[3];this.outputShape=[Te,le,de,He];var Ye=[_e&&le>1?Ne-1:Ne,_e&&de>1?Fe-1:Fe],Ke=[_e&&le>1?le-1:le,_e&&de>1?de-1:de];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+Ye[0]/Ke[0]+`,
          `+Ye[1]/Ke[1]+`);
      const vec2 inputShapeRC = vec2(`+Ne+".0, "+Fe+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}(c.shape,m,w,R);return this.compileAndRun(K,[c],"float32")},h.prototype.resizeBilinearBackprop=function(c,m,w){var R=new function(K,ee,le){this.variableNames=["dy"],this.outputShape=[],this.outputShape=ee.shape;var de=ee.shape,_e=de[1],Te=de[2],Ne=K.shape,Fe=Ne[1],He=Ne[2],Ye=[le&&Fe>1?_e-1:_e,le&&He>1?Te-1:Te],Ke=[le&&Fe>1?Fe-1:Fe,le&&He>1?He-1:He],it=Ye[0]/Ke[0],gt=Ye[1]/Ke[1],wt=1/it,At=1/gt,zt=2*Math.ceil(wt)+2,an=2*Math.ceil(At)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+it+`);
        const float widthScale = float(`+gt+`);

        const float invHeightScale = float(`+wt+`);
        const float invWidthScale = float(`+At+`);

        const int winHeight = int(`+zt+`);
        const int winWidth = int(`+an+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+Fe+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+He+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(_e-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(Te-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}(c,m,w);return this.compileAndRun(R,[c])},h.prototype.resizeNearestNeighbor=function(c,m,w,R){var K=new function(ee,le,de,_e){this.variableNames=["A"],this.outputShape=[];var Te=ee[0],Ne=ee[1],Fe=ee[2],He=ee[3];this.outputShape=[Te,le,de,He];var Ye=[_e&&le>1?Ne-1:Ne,_e&&de>1?Fe-1:Fe],Ke=[_e&&le>1?le-1:le,_e&&de>1?de-1:de],it=_e?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+Ye[0]/Ke[0]+`,
          `+Ye[1]/Ke[1]+`);
      const vec2 inputShapeRC = vec2(`+Ne+".0, "+Fe+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+it+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}(c.shape,m,w,R);return this.compileAndRun(K,[c])},h.prototype.resizeNearestNeighborBackprop=function(c,m,w){var R=new function(K,ee,le){this.variableNames=["dy"],this.outputShape=[],this.outputShape=ee.shape;var de=ee.shape,_e=de[1],Te=de[2],Ne=K.shape,Fe=Ne[1],He=Ne[2],Ye=[le&&Fe>1?_e-1:_e,le&&He>1?Te-1:Te],Ke=[le&&Fe>1?Fe-1:Fe,le&&He>1?He-1:He],it=Ye[0]/Ke[0],gt=Ye[1]/Ke[1],wt=1/it,At=1/gt,zt=2*Math.ceil(wt)+2,an=2*Math.ceil(At)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+it+`);
        const float widthScale = float(`+gt+`);

        const float invHeightScale = float(`+wt+`);
        const float invWidthScale = float(`+At+`);

        const int winHeight = int(`+zt+`);
        const int winWidth = int(`+an+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+Fe+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+He+`) {
              continue;
            }

            float sourceFracRow =
              float(`+Ye[0]+`) *
                (float(dyR) / float(`+Ke[0]+`));

            float sourceFracCol =
                float(`+Ye[1]+`) *
                  (float(dyC) / float(`+Ke[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+_e+`) - 1),
                `+le+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+Te+`) - 1),
                `+le+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}(c,m,w);return this.compileAndRun(R,[c])},h.prototype.multinomial=function(c,m,w,R){var K=m?c:je(c),ee=K.shape[0],le=K.shape[1],de=new i0(ee,le,w),_e=de.getCustomSetupFunc(R);return this.compileAndRun(de,[K],"int32",_e)},h.prototype.oneHot=function(c,m,w,R){var K=new function(ee,le,de,_e){this.variableNames=["indices"],this.outputShape=[ee,le],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+_e+"), float("+de+`),
                      float(index == coords.y)));
      }
    `}(c.size,m,w,R);return this.compileAndRun(K,[c])},h.prototype.diag=function(c){var m=new function(w){this.variableNames=["X"],this.outputShape=[w,w],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}(c.size);return this.compileAndRun(m,[c])},h.prototype.nonMaxSuppression=function(c,m,w,R,K){return kl("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),fa(c.dataSync(),m.dataSync(),w,R,K)},h.prototype.cropAndResize=function(c,m,w,R,K,ee){var le=new function(de,_e,Te,Ne,Fe){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var He=de[0],Ye=de[1],Ke=de[2],it=de[3],gt=_e[0],wt=Te[0],At=Te[1];this.outputShape=[gt,wt,At,it];var zt=Ne==="bilinear"?1:0,an=[Ye-1+".0",Ke-1+".0"],dn=an[0],sn=an[1],ln=wt>1?[""+(Ye-1)/(wt-1),"(y2-y1) * height_ratio","y1*"+dn+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+dn],Tn=ln[0],Bn=ln[1],In=ln[2],or=At>1?[""+(Ke-1)/(At-1),"(x2-x1) * width_ratio","x1*"+sn+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+sn],fr=or[0],br=or[1],_r=or[2];this.userCode=`
      const float height_ratio = float(`+Tn+`);
      const float width_ratio = float(`+fr+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+He+`) {
          return;
        }

        float height_scale = `+Bn+`;
        float width_scale = `+br+`;

        float in_y = `+In+`;
        if( in_y < 0.0 || in_y > `+dn+` ) {
          setOutput(float(`+Fe+`));
          return;
        }
        float in_x = `+_r+`;
        if( in_x < 0.0 || in_x > `+sn+` ) {
          setOutput(float(`+Fe+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+zt+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}(c.shape,m.shape,R,K,ee);return this.compileAndRun(le,[c,m,w],"float32")},h.prototype.depthToSpace=function(c,m,w){we(m>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+m});var R=c.shape[0],K=w==="NHWC"?c.shape[1]:c.shape[2],ee=w==="NHWC"?c.shape[2]:c.shape[3],le=w==="NHWC"?c.shape[3]:c.shape[1],de=K*m,_e=ee*m,Te=le/(m*m),Ne=new iv(w==="NHWC"?[R,de,_e,Te]:[R,Te,de,_e],m,w);return this.compileAndRun(Ne,[c])},h.prototype.split=function(c,m,w){return ya(c,m,w)},h.prototype.scatterND=function(c,m,w){var R=Il(0,c,w),K=R.sliceRank,ee=R.numUpdates,le=R.sliceSize,de=R.strides,_e=R.outputSize,Te=[_e/le,le],Ne=c.reshape([ee,K]),Fe=m.reshape([ee,le]);if(_e===0)return bi(To([]),w);var He=kr(0),Ye=new ky(ee,K,Ne.rank,Fe.rank,de,Te);return this.compileAndRun(Ye,[Fe,Ne,He]).reshape(w)},h.prototype.sparseToDense=function(c,m,w,R){var K=Il(0,c,w),ee=K.sliceRank,le=K.numUpdates,de=K.strides,_e=K.outputSize,Te=new ky(le,ee,c.rank,m.rank,de,[_e,1]);return this.compileAndRun(Te,[m,c,R]).reshape(w)},h.prototype.fft=function(c){return this.fftImpl(c,!1)},h.prototype.ifft=function(c){return this.fftImpl(c,!0)},h.prototype.fftImpl=function(c,m){var w=this.texData.get(c.dataId),R=new Yg("return real * expR - imag * expI;",c.shape,m),K=new Yg("return real * expI + imag * expR;",c.shape,m),ee=[this.makeComplexComponentTensorInfo(c,w.complexTensors.real),this.makeComplexComponentTensorInfo(c,w.complexTensors.imag)],le=this.compileAndRun(R,ee),de=this.compileAndRun(K,ee),_e=this.complex(le,de).as2D(c.shape[0],c.shape[1]);return le.dispose(),de.dispose(),_e},h.prototype.gatherND=function(c,m){var w=m.shape,R=w[w.length-1],K=uu(c,m),ee=K[0],le=K[1],de=K[2],_e=K[3],Te=m.reshape([le,R]),Ne=c.reshape([c.size/de,de]),Fe=new function(He,Ye,Ke){this.sliceDim=He,this.strides=Ye,this.variableNames=["x","indices"],this.outputShape=Ke;var it=jo(Ye.length),gt=jo(Ke.length),wt=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+it+" strides = "+it+"("+this.strides+`);
         void main() {
          `+gt+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+wt+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}(R,_e,[le,de]);return this.compileAndRun(Fe,[Ne,Te]).reshape(ee)},h.prototype.fill=function(c,m,w){if((w=w||ke(m))==="string"){var R=cn(w,ze(c));return R.fill(m),Ve.makeTensor(R,c,w,this)}var K=new Jg(c,m),ee=K.getCustomSetupFunc(m);return this.compileAndRun(K,[],w,ee)},h.prototype.onesLike=function(c){if(c.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(c.shape,1,c.dtype)},h.prototype.zerosLike=function(c){return this.fill(c.shape,c.dtype==="string"?"":0,c.dtype)},h.prototype.linspace=function(c,m,w){return _i(c,m,w)},h.prototype.makeTensorInfo=function(c,m){var w=this.write(null,c,m);return this.texData.get(w).usage=null,{dataId:w,shape:c,dtype:m}},h.prototype.makeOutput=function(c,m){var w=this.makeTensorInfo(c,m).dataId;return Ve.makeTensorFromDataId(w,c,m,this)},h.prototype.unpackTensor=function(c){var m=new function(w){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=w;var R=w.length,K=_a("rc",R),ee=jo(R),le=function(Te,Ne){if(Te===1)return"rc";for(var Fe="",He=0;He<Te;He++)Fe+=Ne[He],He<Te-1&&(Fe+=",");return Fe}(R,K),de=K.slice(-2),_e=R<=1?"rc":"vec2("+de.join(",")+")";this.userCode=`
      void main() {
        `+ee+` rc = getOutputCoords();
        vec4 packedInput = getA(`+le+`);

        setOutput(getChannel(packedInput, `+_e+`));
      }
    `}(c.shape);return this.runWebGLProgram(m,[c],c.dtype)},h.prototype.packTensor=function(c){var m=new function(w){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=w;var R=w.length;if(R===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var K=_a("rc",R),ee=jo(R),le=function(Te,Ne,Fe){if(Te===1)return"rc > "+Ne[0];for(var He="",Ye=Te-2;Ye<Te;Ye++)He+=Fe[Ye]+" >= "+Ne[Ye],Ye<Te-1&&(He+="||");return He}(R,w,K),de=function(Te,Ne,Fe,He){if(Te===1)return"";var Ye=He.slice(-2);return`
    int r = `+Ye[0]+`;
    int c = `+Ye[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+Ne+`;
    bool rEdge = rp1 >= `+Fe+`;
  `}(R,w[w.length-1],w[w.length-2],K),_e=function(Te,Ne){var Fe=Te.length,He=function(Ye,Ke){for(var it=[],gt=0;gt<=1;gt++)for(var wt=0;wt<=1;wt++){for(var At=(gt===0?"r":"rp1")+", "+(wt===0?"c":"cp1"),zt=2;zt<Ye;zt++)At=Ke[Ke.length-1-zt]+","+At;it.push(At)}return it}(Fe,Ne);return Fe===1?`getA(rc),
            rc + 1 >= `+Te[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+He[0]+`),
          cEdge ? 0. : getA(`+He[1]+`),
          rEdge ? 0. : getA(`+He[2]+`),
          rEdge || cEdge ? 0. : getA(`+He[3]+")"}(w,K);this.userCode=`
        void main() {
          `+ee+` rc = getOutputCoords();

          if(`+le+`) {
            setOutput(vec4(0));
          } else {
            `+de+`

            setOutput(vec4(`+_e+`));
          }
        }
      `}}(c.shape);return this.runWebGLProgram(m,[c],c.dtype,null,!0)},h.prototype.packedReshape=function(c,m){var w=[bs(c.shape)].concat(Fa(c.shape)),R={dtype:c.dtype,shape:w,dataId:c.dataId},K=new function(le,de){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=le;for(var _e="",Te=0;Te<4;Te++){var Ne="thisRC = rc;";Te%2==1&&(Ne+="thisRC.z += 1;"),Te>1&&(Ne+="thisRC.y += 1;"),_e+=`
        `+Ne+`
        `+(Te>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+Te+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(Te>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Ma(["r","c","d"],de)+`
      return ivec3(r, c, d);
    }
  
      `+Ku(le)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+le[1]+`;
        int cols = `+le[2]+`;

        `+_e+`

        setOutput(result);
      }
    `}([bs(m)].concat(Fa(m)),w),ee=this.runWebGLProgram(K,[R],c.dtype,null,!0);return{dataId:ee.dataId,shape:m,dtype:ee.dtype}},h.prototype.decode=function(c){var m,w=this.texData.get(c),R=w.isPacked,K=w.shape,ee=w.dtype,le=Oc(K);return m=R?new function(de){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Zn.DENSE;var _e=gi(de),Te=ko();this.outputShape=de,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Ma(["r","c","d"],de)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+_e[0]+", "+_e[1]+`));
        int index = 4 * (resTexRC.x * `+_e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+Te.output+` = result;
      }
    `}(le):new function(de){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Zn.DENSE;var _e=gi(de),Te=ko();this.outputShape=de,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Ma(["r","c","d"],de)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+_e[0]+", "+_e[1]+`));
        int index = 4 * (resTexRC.x * `+_e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+Te.output+` = result;
      }
    `}(le),{dtype:ee,shape:K,dataId:this.runWebGLProgram(m,[{shape:le,dtype:ee,dataId:c}],ee,null,!0).dataId}},h.prototype.runWebGLProgram=function(c,m,w,R,K){var ee=this;K===void 0&&(K=!1);var le=this.makeTensorInfo(c.outputShape,w),de=this.texData.get(le.dataId);if(c.packedOutput&&(de.isPacked=!0),c.outPackingScheme===Zn.DENSE){var _e=gi(c.outputShape);de.texShape=_e.map(function(wt){return 2*wt})}if(c.outTexUsage!=null&&(de.usage=c.outTexUsage),ze(le.shape)===0)return de.values=Rn(le.dtype,0),le;var Te=[],Ne=m.map(function(wt){if(wt.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var At=ee.texData.get(wt.dataId);if(At.texture==null){if(!c.packedInputs&&ze(wt.shape)<=z().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:wt.shape,texData:null,isUniform:!0,uniformValues:At.values};c.packedInputs&&(At.isPacked=!0,At.shape=wt.shape)}else if(!!At.isPacked!=!!c.packedInputs)wt=At.isPacked?ee.unpackTensor(wt):ee.packTensor(wt),Te.push(wt),At=ee.texData.get(wt.dataId);else if(At.isPacked&&!Mu(At.shape,wt.shape)){var zt=wt,an=wt.shape;wt.shape=At.shape,wt=ee.packedReshape(wt,an),Te.push(wt),At=ee.texData.get(wt.dataId),zt.shape=an}return ee.uploadToGPU(wt.dataId),{shape:wt.shape,texData:At,isUniform:!1}});this.uploadToGPU(le.dataId);var Fe,He={shape:le.shape,texData:de,isUniform:!1},Ye=function(wt,At,zt){var an="";Ne.concat(zt).forEach(function(sn){var ln=sn.texData!=null&&sn.texData.slice!=null&&sn.texData.slice.flatOffset>0,Tn=sn.isUniform?"uniform":sn.texData.texShape;an+=sn.shape+"_"+Tn+"_"+ln});var dn=wt.userCode;return wt.constructor.name+"_"+an+"_"+dn}(c,0,He),Ke=this.getAndSaveBinary(Ye,function(){return function(wt,At,zt,an){var dn=At.userCode,sn=zt.map(function(vr,Pr){var Rr={logicalShape:vr.shape,texShape:vr.isUniform?null:vr.texData.texShape,isUniform:vr.isUniform,isPacked:!vr.isUniform&&vr.texData.isPacked,flatOffset:null};return vr.texData!=null&&vr.texData.slice!=null&&vr.texData.slice.flatOffset>0&&(Rr.flatOffset=vr.texData.slice.flatOffset),{name:At.variableNames[Pr],shapeInfo:Rr}}),ln=sn.map(function(vr){return vr.shapeInfo}),Tn={logicalShape:an.shape,texShape:an.texData.texShape,isUniform:!1,isPacked:an.texData.isPacked,flatOffset:null},Bn=Ha(sn,Tn,dn,At.packedInputs),In=wt.createProgram(Bn),or=null,fr=wt.getUniformLocation(In,"NAN",!1);z().getNumber("WEBGL_VERSION")===1&&(or=wt.getUniformLocation(In,"INFINITY",!1));for(var br={},_r=0;_r<At.variableNames.length;_r++){var xr=At.variableNames[_r];br[xr]=wt.getUniformLocation(In,xr,!1),br["offset"+xr]=wt.getUniformLocation(In,"offset"+xr,!1)}return{program:At,source:Bn,webGLProgram:In,uniformLocations:br,inShapeInfos:ln,outShapeInfo:Tn,infLoc:or,nanLoc:fr}}(ee.gpgpu,c,Ne,He)}),it=this.activeTimers!=null;if(it&&(Fe=this.startTimer()),function(wt,At,zt,an,dn){r0(At.inShapeInfos,zt),r0([At.outShapeInfo],[an]);var sn=an.texData.texture,ln=an.texData.texShape;an.texData.isPacked?wt.setOutputPackedMatrixTexture(sn,ln[0],ln[1]):wt.setOutputMatrixTexture(sn,ln[0],ln[1]),wt.setProgram(At.webGLProgram),z().getNumber("WEBGL_VERSION")===1&&At.infLoc!==null&&wt.gl.uniform1f(At.infLoc,1/0),At.nanLoc!==null&&wt.gl.uniform1f(At.nanLoc,NaN),zt.forEach(function(Tn,Bn){var In=At.program.variableNames[Bn],or=At.uniformLocations[In],fr=At.uniformLocations["offset"+In];if(or!=null)if(Tn.isUniform)if(ze(Tn.shape)<2)wt.gl.uniform1f(or,Tn.uniformValues[0]);else{var br=Tn.uniformValues;br instanceof Float32Array||(br=new Float32Array(br)),wt.gl.uniform1fv(or,br)}else Tn.texData.slice!=null&&fr!=null&&wt.gl.uniform1i(fr,Tn.texData.slice.flatOffset),wt.setInputMatrixTexture(Tn.texData.texture,or,Bn)}),dn!=null&&dn(wt,At.webGLProgram),wt.executeProgram()}(this.gpgpu,Ke,Ne,He,R),Te.forEach(function(wt){return ee.disposeData(wt.dataId)}),it&&(Fe=this.endTimer(Fe),this.activeTimers.push({name:c.constructor.name,query:this.getQueryTime(Fe)})),!z().getBool("WEBGL_LAZILY_UNPACK")&&de.isPacked&&K===!1){var gt=this.unpackTensor(le);return this.disposeData(le.dataId),gt}return le},h.prototype.compileAndRun=function(c,m,w,R,K){K===void 0&&(K=!1),w=w||m[0].dtype;var ee=this.runWebGLProgram(c,m,w,R,K);return Ve.makeTensorFromDataId(ee.dataId,ee.shape,ee.dtype)},h.prototype.getAndSaveBinary=function(c,m){return c in this.binaryCache||(this.binaryCache[c]=m()),this.binaryCache[c]},h.prototype.getTextureManager=function(){return this.textureManager},h.prototype.dispose=function(){var c=this;this.disposed||(z().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(m){c.gpgpu.deleteProgram(c.binaryCache[m].webGLProgram),delete c.binaryCache[m]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},h.prototype.floatPrecision=function(){var c=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Hi(function(){if(!z().get("WEBGL_RENDER_FLOAT32_ENABLED")){var m=z().getBool("DEBUG");z().set("DEBUG",!1);var w=c.abs(kr(1e-8)).dataSync()[0];if(z().set("DEBUG",m),w>0)return 32}return 16})),this.floatPrecisionValue},h.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},h.prototype.uploadToGPU=function(c){var m,w=this.texData.get(c),R=w.shape,K=w.dtype,ee=w.values,le=w.texture,de=w.usage,_e=w.isPacked;if(le==null){var Te,Ne=this.activeTimers!=null;Ne&&(Te=Zt());var Fe=w.texShape;if(Fe==null&&(Fe=cf(R,_e),w.texShape=Fe),ee!=null){var He=Oc(R),Ye=void 0,Ke=Fe[1],it=Fe[0],gt=ee instanceof Uint8Array;_e?(Ke=(m=ei(Fe[0],Fe[1]))[0],Ye=new function(dn,sn,ln){ln===void 0&&(ln=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var Tn=ko(),Bn=sn[0],In=sn[1];this.outputShape=dn;var or="",fr="result";ln&&(fr="floor(result * 255. + 0.5)");for(var br=0;br<=1;br++)for(var _r=0;_r<=1;_r++){var xr=2*br+_r;or+=`
          localCoords = coords;
          if(localCoords[2] + `+_r+" < "+dn[2]+`) {
            localCoords[2] += `+_r+`;
            if(localCoords[1] + `+br+" < "+dn[1]+`) {
              localCoords[1] += `+br+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+In+`;
              c = imod(flatIndex, `+In+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+In+".0, "+Bn+`.0);
              values = `+Tn.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+xr+`] = values[0];
              } else if(offset == 1) {
                result[`+xr+`] = values[1];
              } else if(offset == 2) {
                result[`+xr+`] = values[2];
              } else {
                result[`+xr+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Ku(dn)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+or+`

        `+Tn.output+" = "+fr+`;
      }
    `}(He,[it=m[1],Ke],gt)):Ye=new function(dn,sn,ln){ln===void 0&&(ln=!1),this.variableNames=["A"];var Tn=ko(),Bn=sn[0],In=sn[1];this.outputShape=dn;var or="result";ln&&(or="floor(result * 255. + 0.5)"),this.userCode=`
      `+Ku(dn)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+In+`;
        int c = imod(flatIndex, `+In+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+In+".0, "+Bn+`.0);
        vec4 values = `+Tn.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+Tn.output+" = vec4("+or+`, 0., 0., 0.);
      }
    `}(He,[it,Ke],gt);var wt=this.makeTensorInfo([it,Ke],K);this.texData.get(wt.dataId).usage=gt?cr.PIXELS:cr.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(wt.dataId),Ke,it,ee);var At=this.runWebGLProgram(Ye,[wt],K,null,!0),zt=this.texData.get(At.dataId);w.texture=zt.texture,w.texShape=zt.texShape,w.isPacked=zt.isPacked,w.usage=zt.usage,this.disposeData(wt.dataId),this.texData.delete(At.dataId),w.values=null,Ne&&(this.uploadWaitMs+=Zt()-Te)}else{var an=this.acquireTexture(Fe,de,K,_e);w.texture=an}}},h.prototype.convertAndCacheOnCPU=function(c,m){var w=this.texData.get(c),R=w.dtype;return this.releaseGPUData(c),m!=null&&(w.values=function(K,ee){if(ee==="float32"||ee==="complex64")return K;if(ee==="int32"||ee==="bool"){for(var le=ee==="int32"?new Int32Array(K.length):new Uint8Array(K.length),de=0;de<le.length;++de)le[de]=Math.round(K[de]);return le}throw new Error("Unknown dtype "+ee)}(m,R)),w.values},h.prototype.acquireTexture=function(c,m,w,R){if(this.numBytesInGPU+=this.computeBytes(c,w),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var K=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+K+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(c,m,R)},h.prototype.computeBytes=function(c,m){return c[0]*c[1]*Jt(m)},h}(on);function Qu(b,h){return b(h={exports:{}},h.exports),h.exports}Ln()&&Ve.registerBackend("webgl",function(){return new ng},2);var mc=Qu(function(b){(function(h,c,m){function w(K,ee){return ee.c=K.c,ee.s0=K.s0,ee.s1=K.s1,ee.s2=K.s2,ee}function R(K,ee){var le=new function(Te){var Ne,Fe=this,He=(Ne=4022871197,function(Ye){Ye=Ye.toString();for(var Ke=0;Ke<Ye.length;Ke++){var it=.02519603282416938*(Ne+=Ye.charCodeAt(Ke));it-=Ne=it>>>0,Ne=(it*=Ne)>>>0,Ne+=4294967296*(it-=Ne)}return 23283064365386963e-26*(Ne>>>0)});Fe.next=function(){var Ye=2091639*Fe.s0+23283064365386963e-26*Fe.c;return Fe.s0=Fe.s1,Fe.s1=Fe.s2,Fe.s2=Ye-(Fe.c=0|Ye)},Fe.c=1,Fe.s0=He(" "),Fe.s1=He(" "),Fe.s2=He(" "),Fe.s0-=He(Te),Fe.s0<0&&(Fe.s0+=1),Fe.s1-=He(Te),Fe.s1<0&&(Fe.s1+=1),Fe.s2-=He(Te),Fe.s2<0&&(Fe.s2+=1),He=null}(K),de=ee&&ee.state,_e=le.next;return _e.int32=function(){return 4294967296*le.next()|0},_e.double=function(){return _e()+11102230246251565e-32*(2097152*_e()|0)},_e.quick=_e,de&&(typeof de=="object"&&w(de,le),_e.state=function(){return w(le,{})}),_e}c&&c.exports?c.exports=R:this.alea=R})(0,b)}),yv=Qu(function(b){(function(h,c,m){function w(K,ee){return ee.x=K.x,ee.y=K.y,ee.z=K.z,ee.w=K.w,ee}function R(K,ee){var le=new function(Te){var Ne=this,Fe="";Ne.x=0,Ne.y=0,Ne.z=0,Ne.w=0,Ne.next=function(){var Ye=Ne.x^Ne.x<<11;return Ne.x=Ne.y,Ne.y=Ne.z,Ne.z=Ne.w,Ne.w^=Ne.w>>>19^Ye^Ye>>>8},Te===(0|Te)?Ne.x=Te:Fe+=Te;for(var He=0;He<Fe.length+64;He++)Ne.x^=0|Fe.charCodeAt(He),Ne.next()}(K),de=ee&&ee.state,_e=function(){return(le.next()>>>0)/4294967296};return _e.double=function(){do var Te=((le.next()>>>11)+(le.next()>>>0)/4294967296)/2097152;while(Te===0);return Te},_e.int32=le.next,_e.quick=_e,de&&(typeof de=="object"&&w(de,le),_e.state=function(){return w(le,{})}),_e}c&&c.exports?c.exports=R:this.xor128=R})(0,b)}),um=Qu(function(b){(function(h,c,m){function w(K,ee){return ee.x=K.x,ee.y=K.y,ee.z=K.z,ee.w=K.w,ee.v=K.v,ee.d=K.d,ee}function R(K,ee){var le=new function(Te){var Ne=this,Fe="";Ne.next=function(){var Ye=Ne.x^Ne.x>>>2;return Ne.x=Ne.y,Ne.y=Ne.z,Ne.z=Ne.w,Ne.w=Ne.v,(Ne.d=Ne.d+362437|0)+(Ne.v=Ne.v^Ne.v<<4^Ye^Ye<<1)|0},Ne.x=0,Ne.y=0,Ne.z=0,Ne.w=0,Ne.v=0,Te===(0|Te)?Ne.x=Te:Fe+=Te;for(var He=0;He<Fe.length+64;He++)Ne.x^=0|Fe.charCodeAt(He),He==Fe.length&&(Ne.d=Ne.x<<10^Ne.x>>>4),Ne.next()}(K),de=ee&&ee.state,_e=function(){return(le.next()>>>0)/4294967296};return _e.double=function(){do var Te=((le.next()>>>11)+(le.next()>>>0)/4294967296)/2097152;while(Te===0);return Te},_e.int32=le.next,_e.quick=_e,de&&(typeof de=="object"&&w(de,le),_e.state=function(){return w(le,{})}),_e}c&&c.exports?c.exports=R:this.xorwow=R})(0,b)}),a0=Qu(function(b){(function(h,c,m){function w(K,ee){return ee.x=K.x.slice(),ee.i=K.i,ee}function R(K,ee){K==null&&(K=+new Date);var le=new function(Te){var Ne=this;Ne.next=function(){var Fe,He,Ye=Ne.x,Ke=Ne.i;return Fe=Ye[Ke],He=(Fe^=Fe>>>7)^Fe<<24,He^=(Fe=Ye[Ke+1&7])^Fe>>>10,He^=(Fe=Ye[Ke+3&7])^Fe>>>3,He^=(Fe=Ye[Ke+4&7])^Fe<<7,Fe=Ye[Ke+7&7],He^=(Fe^=Fe<<13)^Fe<<9,Ye[Ke]=He,Ne.i=Ke+1&7,He},function(Fe,He){var Ye,Ke=[];if(He===(0|He))Ke[0]=He;else for(He=""+He,Ye=0;Ye<He.length;++Ye)Ke[7&Ye]=Ke[7&Ye]<<15^He.charCodeAt(Ye)+Ke[Ye+1&7]<<13;for(;Ke.length<8;)Ke.push(0);for(Ye=0;Ye<8&&Ke[Ye]===0;++Ye);for(Ye==8?Ke[7]=-1:Ke[Ye],Fe.x=Ke,Fe.i=0,Ye=256;Ye>0;--Ye)Fe.next()}(Ne,Te)}(K),de=ee&&ee.state,_e=function(){return(le.next()>>>0)/4294967296};return _e.double=function(){do var Te=((le.next()>>>11)+(le.next()>>>0)/4294967296)/2097152;while(Te===0);return Te},_e.int32=le.next,_e.quick=_e,de&&(de.x&&w(de,le),_e.state=function(){return w(le,{})}),_e}c&&c.exports?c.exports=R:this.xorshift7=R})(0,b)}),F1=Qu(function(b){(function(h,c,m){function w(K,ee){return ee.i=K.i,ee.w=K.w,ee.X=K.X.slice(),ee}function R(K,ee){K==null&&(K=+new Date);var le=new function(Te){var Ne=this;Ne.next=function(){var Fe,He,Ye=Ne.w,Ke=Ne.X,it=Ne.i;return Ne.w=Ye=Ye+1640531527|0,He=Ke[it+34&127],Fe=Ke[it=it+1&127],He^=He<<13,Fe^=Fe<<17,He^=He>>>15,Fe^=Fe>>>12,He=Ke[it]=He^Fe,Ne.i=it,He+(Ye^Ye>>>16)|0},function(Fe,He){var Ye,Ke,it,gt,wt,At=[],zt=128;for(He===(0|He)?(Ke=He,He=null):(He+="\0",Ke=0,zt=Math.max(zt,He.length)),it=0,gt=-32;gt<zt;++gt)He&&(Ke^=He.charCodeAt((gt+32)%He.length)),gt===0&&(wt=Ke),Ke^=Ke<<10,Ke^=Ke>>>15,Ke^=Ke<<4,Ke^=Ke>>>13,gt>=0&&(wt=wt+1640531527|0,it=(Ye=At[127&gt]^=Ke+wt)==0?it+1:0);for(it>=128&&(At[127&(He&&He.length||0)]=-1),it=127,gt=512;gt>0;--gt)Ke=At[it+34&127],Ye=At[it=it+1&127],Ke^=Ke<<13,Ye^=Ye<<17,Ke^=Ke>>>15,Ye^=Ye>>>12,At[it]=Ke^Ye;Fe.w=wt,Fe.X=At,Fe.i=it}(Ne,Te)}(K),de=ee&&ee.state,_e=function(){return(le.next()>>>0)/4294967296};return _e.double=function(){do var Te=((le.next()>>>11)+(le.next()>>>0)/4294967296)/2097152;while(Te===0);return Te},_e.int32=le.next,_e.quick=_e,de&&(de.X&&w(de,le),_e.state=function(){return w(le,{})}),_e}c&&c.exports?c.exports=R:this.xor4096=R})(0,b)}),Cy=Qu(function(b){(function(h,c,m){function w(K,ee){return ee.a=K.a,ee.b=K.b,ee.c=K.c,ee.d=K.d,ee}function R(K,ee){var le=new function(Te){var Ne=this,Fe="";Ne.next=function(){var Ye=Ne.b,Ke=Ne.c,it=Ne.d,gt=Ne.a;return Ye=Ye<<25^Ye>>>7^Ke,Ke=Ke-it|0,it=it<<24^it>>>8^gt,gt=gt-Ye|0,Ne.b=Ye=Ye<<20^Ye>>>12^Ke,Ne.c=Ke=Ke-it|0,Ne.d=it<<16^Ke>>>16^gt,Ne.a=gt-Ye|0},Ne.a=0,Ne.b=0,Ne.c=-1640531527,Ne.d=1367130551,Te===Math.floor(Te)?(Ne.a=Te/4294967296|0,Ne.b=0|Te):Fe+=Te;for(var He=0;He<Fe.length+20;He++)Ne.b^=0|Fe.charCodeAt(He),Ne.next()}(K),de=ee&&ee.state,_e=function(){return(le.next()>>>0)/4294967296};return _e.double=function(){do var Te=((le.next()>>>11)+(le.next()>>>0)/4294967296)/2097152;while(Te===0);return Te},_e.int32=le.next,_e.quick=_e,de&&(typeof de=="object"&&w(de,le),_e.state=function(){return w(le,{})}),_e}c&&c.exports?c.exports=R:this.tychei=R})(0,b)}),Of=Qu(function(b){(function(h,c){var m,w=this,R=256,K=6,ee="random",le=c.pow(R,K),de=c.pow(2,52),_e=2*de,Te=R-1;function Ne(it,gt,wt){var At=[],zt=Ye(function sn(ln,Tn){var Bn,In=[],or=typeof ln;if(Tn&&or=="object")for(Bn in ln)try{In.push(sn(ln[Bn],Tn-1))}catch{}return In.length?In:or=="string"?ln:ln+"\0"}((gt=gt==1?{entropy:!0}:gt||{}).entropy?[it,Ke(h)]:it??function(){try{var sn;return m&&(sn=m.randomBytes)?sn=sn(R):(sn=new Uint8Array(R),(w.crypto||w.msCrypto).getRandomValues(sn)),Ke(sn)}catch{var ln=w.navigator,Tn=ln&&ln.plugins;return[+new Date,w,Tn,w.screen,Ke(h)]}}(),3),At),an=new Fe(At),dn=function(){for(var sn=an.g(K),ln=le,Tn=0;sn<de;)sn=(sn+Tn)*R,ln*=R,Tn=an.g(1);for(;sn>=_e;)sn/=2,ln/=2,Tn>>>=1;return(sn+Tn)/ln};return dn.int32=function(){return 0|an.g(4)},dn.quick=function(){return an.g(4)/4294967296},dn.double=dn,Ye(Ke(an.S),h),(gt.pass||wt||function(sn,ln,Tn,Bn){return Bn&&(Bn.S&&He(Bn,an),sn.state=function(){return He(an,{})}),Tn?(c[ee]=sn,ln):sn})(dn,zt,"global"in gt?gt.global:this==c,gt.state)}function Fe(it){var gt,wt=it.length,At=this,zt=0,an=At.i=At.j=0,dn=At.S=[];for(wt||(it=[wt++]);zt<R;)dn[zt]=zt++;for(zt=0;zt<R;zt++)dn[zt]=dn[an=Te&an+it[zt%wt]+(gt=dn[zt])],dn[an]=gt;(At.g=function(sn){for(var ln,Tn=0,Bn=At.i,In=At.j,or=At.S;sn--;)ln=or[Bn=Te&Bn+1],Tn=Tn*R+or[Te&(or[Bn]=or[In=Te&In+ln])+(or[In]=ln)];return At.i=Bn,At.j=In,Tn})(R)}function He(it,gt){return gt.i=it.i,gt.j=it.j,gt.S=it.S.slice(),gt}function Ye(it,gt){for(var wt,At=it+"",zt=0;zt<At.length;)gt[Te&zt]=Te&(wt^=19*gt[Te&zt])+At.charCodeAt(zt++);return Ke(gt)}function Ke(it){return String.fromCharCode.apply(0,it)}if(c["seed"+ee]=Ne,Ye(c.random(),h),b.exports){b.exports=Ne;try{m=r(390)}catch{}}})([],Math)});Of.alea=mc,Of.xor128=yv,Of.xorwow=um,Of.xorshift7=a0,Of.xor4096=F1,Of.tychei=Cy;var Gh=Of.alea,Nd=Pt({addN_:function(b){we(Array.isArray(b),function(){return"The argument passed to tf.addN() must be a list of tensors"}),we(b.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+b.length});var h=b.map(function(w,R){return Ze(w,"tensors"+R,"addN")}),c=h[0];h.forEach(function(w){if(w.dtype!==c.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),h.forEach(function(w){if(!Ut(w.shape,c.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var m=h;return Ve.runKernelFunc(function(w,R){return w.addN(h)},m,null,"AddN")}});function Id(){pd("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}function bv(b){return b.rank===0||b.rank===1?b.as4D(1,1,1,b.size):b.rank===2?b.as4D(1,1,b.shape[0],b.shape[1]):b.rank===3?b.as4D(1,b.shape[0],b.shape[1],b.shape[2]):b}function s0(b,h,c,m,w,R){R==null&&(R=.001);var K,ee,le=Ze(b,"x","batchNorm"),de=Ze(h,"mean","batchNorm"),_e=Ze(c,"variance","batchNorm");w!=null&&(K=Ze(w,"scale","batchNorm")),m!=null&&(ee=Ze(m,"offset","batchNorm")),we(de.rank===_e.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),we(ee==null||de.rank===ee.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),we(K==null||de.rank===K.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var Te={x:le,scale:K,offset:ee,mean:de,variance:_e},Ne={varianceEpsilon:R};return Ve.runKernelFunc(function(Fe,He){var Ye=bv(le),Ke=Fe.batchNormalization(Ye,Fd(de),Fd(_e),R,Fd(K),Fd(ee));return He([le,de,_e,K]),Ke},Te,null,"FusedBatchNorm",Ne).reshape(le.shape)}function Fd(b){return b==null?null:b.rank===0?b.as1D():b.rank===1?b:b.rank===2?b.as4D(1,1,b.shape[0],b.shape[1]):b.rank===3?b.as4D(1,b.shape[0],b.shape[1],b.shape[2]):b}var po=Pt({batchNormalization_:function(b,h,c,m,w,R){return m===void 0&&(m=.001),Id(),s0(b,h,c,R,w,m)}}),Tf=Pt({batchNorm_:s0});function qh(b,h,c,m,w,R){var K,ee,le=Ze(b,"x","batchNorm"),de=Ze(h,"mean","batchNorm"),_e=Ze(c,"variance","batchNorm");return w!=null&&(K=Ze(w,"scale","batchNorm")),m!=null&&(ee=Ze(m,"offset","batchNorm")),we(le.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+le.rank+"."}),we(de.rank===2||de.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+de.rank+"."}),we(_e.rank===2||_e.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+_e.rank+"."}),K!=null&&we(K.rank===2||K.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+K.rank+"."}),ee!=null&&we(ee.rank===2||ee.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+ee.rank+"."}),Tf(le,de,_e,ee,K,R)}var Ay=Pt({batchNormalization2d_:function(b,h,c,m,w,R){return m===void 0&&(m=.001),Id(),qh(b,h,c,R,w,m)}}),Oy=Pt({batchNorm2d_:qh});function rg(b,h,c,m,w,R){var K,ee,le=Ze(b,"x","batchNorm"),de=Ze(h,"mean","batchNorm"),_e=Ze(c,"variance","batchNorm");return w!=null&&(K=Ze(w,"scale","batchNorm")),m!=null&&(ee=Ze(m,"offset","batchNorm")),we(le.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+le.rank+"."}),we(de.rank===3||de.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+de.rank+"."}),we(_e.rank===3||_e.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+_e.rank+"."}),K!=null&&we(K.rank===3||K.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+K.rank+"."}),ee!=null&&we(ee.rank===3||ee.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+ee.rank+"."}),Tf(le,de,_e,ee,K,R)}var Mf=Pt({batchNormalization3d_:function(b,h,c,m,w,R){return m===void 0&&(m=.001),Id(),rg(b,h,c,R,w,m)}}),zl=Pt({batchNorm3d_:rg});function cm(b,h,c,m,w,R){var K,ee,le=Ze(b,"x","batchNorm"),de=Ze(h,"mean","batchNorm"),_e=Ze(c,"variance","batchNorm");return w!=null&&(K=Ze(w,"scale","batchNorm")),m!=null&&(ee=Ze(m,"offset","batchNorm")),we(le.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+le.rank+"."}),we(de.rank===4||de.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+de.rank+"."}),we(_e.rank===4||_e.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+_e.rank+"."}),K!=null&&we(K.rank===4||K.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+K.rank+"."}),ee!=null&&we(ee.rank===4||ee.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+ee.rank+"."}),Tf(le,de,_e,ee,K,R)}var $h=Pt({batchNormalization4d_:function(b,h,c,m,w,R){return m===void 0&&(m=.001),Id(),cm(b,h,c,R,w,m)}}),Rd=Pt({batchNorm4d_:cm}),Df=Pt({broadcastTo_:function(b,h){var c=Ze(b,"broadcastTo","x"),m=c.shape;if(h.some(function(Te){return!(Te>0)||Te%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+h+"].");if(h.length<c.rank)throw new Error("broadcastTo(): shape.length="+h.length+" < input.rank="+c.rank+".");if(h.length>c.rank){for(var w=c.shape.slice();w.length<h.length;)w.unshift(1);c=c.reshape(w)}for(var R=c.shape,K=Array.from(h),ee=h.length-1;ee>=0;ee--)if(R[ee]===h[ee])K[ee]=1;else if(c.shape[ee]!==1)throw new Error("broadcastTo(): ["+m+"] cannot be broadcast to ["+h+"].");var le=K.map(function(Te,Ne){return Te>1?Ne:-1}).filter(function(Te){return Te>=0});if(le.length===0)return c.clone();var de={x:c},_e={shape:h,inputShape:R};return Ve.runKernelFunc(function(Te){return Te.tile(c,K)},de,function(Te){return{x:function(){return Te.sum(le,!0)}}},el,_e)}}),Nf=Pt({clone_:function(b){var h=Ze(b,"x","clone",null);return Ve.runKernelFunc(function(){return Ve.makeTensorFromDataId(h.dataId,h.shape,h.dtype)},{x:h},null,yd)}}),Zu=Pt({logicalAnd_:function(b,h){var c=Ze(b,"a","logicalAnd","bool"),m=Ze(h,"b","logicalAnd","bool");return qi(c.shape,m.shape),Ve.runKernelFunc(function(w){return w.logicalAnd(c,m)},{a:c,b:m},null,"LogicalAnd")}}),Xh=Pt({logicalNot_:function(b){var h=Ze(b,"x","logicalNot","bool");return Ve.runKernelFunc(function(c){return c.logicalNot(h)},{$x:h})}}),Pd=Pt({logicalOr_:function(b,h){var c=Ze(b,"a","logicalOr","bool"),m=Ze(h,"b","logicalOr","bool");return qi(c.shape,m.shape),Ve.runKernelFunc(function(w){return w.logicalOr(c,m)},{$a:c,$b:m})}}),Ul=Pt({logicalXor_:function(b,h){var c=Ze(b,"a","logicalXor","bool"),m=Ze(h,"b","logicalXor","bool");return qi(c.shape,m.shape),Pd(b,h).logicalAnd(Zu(b,h).logicalNot())}}),ul=Pt({where_:function(b,h,c){var m=Ze(h,"a","where"),w=Ze(c,"b","where"),R=Ze(b,"condition","where","bool");return bt(m.shape,w.shape,"Error in where: "),R.rank===1?we(R.shape[0]===m.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):bt(R.shape,w.shape,"Error in where: "),Ve.runKernelFunc(function(K,ee){var le=K.select(R,m,w);return ee([R]),le},{$condition:R,$a:m,$b:w},function(K,ee){var le=ee[0];return{$condition:function(){return mi(le).toFloat()},$a:function(){return K.mul(le.cast(K.dtype))},$b:function(){return K.mul(le.logicalNot().cast(K.dtype))}}})}}),Ld=function(b){return N(this,void 0,void 0,function(){var h,c,m;return L(this,function(w){switch(w.label){case 0:return[4,(h=Ze(b,"condition","whereAsync","bool")).data()];case 1:return c=w.sent(),m=oa(h.shape,c),b!==h&&h.dispose(),[2,m]}})})},ig=Pt({divNoNan_:function(b,h){var c,m=Ze(b,"a","div"),w=Ze(h,"b","div");m=(c=Kt(m,w))[0],w=c[1];var R=ra(m,w),K=mi(R),ee=w.equal(K);return ul(ee,K,R)}}),Bd=Pt({tile_:function(b,h){var c=Ze(b,"x","tile",null);we(c.rank===h.length,function(){return"Error in transpose: rank of input "+c.rank+" must match length of reps "+h+"."});var m=[c],w={x:c},R={reps:h};return Ve.runKernelFunc(function(K,ee){var le=K.tile(c,h);return ee([c]),le},w,null,gf,R,m)}}),cl=Pt({eye_:function(b,h,c,m){m===void 0&&(m="float32"),h==null&&(h=b);for(var w=Di([b,h],m),R=b<=h?b:h,K=0;K<R;++K)w.set(1,K,K);var ee=w.toTensor().as2D(b,h);if(c==null)return ee;if(c.length===1)return Bd(lc(ee,0),[c[0],1,1]);if(c.length===2)return Bd(lc(lc(ee,0),0),[c[0],c[1],1,1]);if(c.length===3)return Bd(lc(lc(lc(ee,0),0),0),[c[0],c[1],c[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+c.length+"D.")}}),ds=Pt({multinomial_:function(b,h,c,m){m===void 0&&(m=!1);var w=Ze(b,"logits","multinomial"),R=w.size,K=w.rank;if(R<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+R+".");if(K>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+K);c=c||Math.random();var ee=K===1?w.as2D(1,-1):w,le=Ve.runKernelFunc(function(de){return de.multinomial(ee,m,h,c)},{logits2D:ee});return K===1?le.as1D():le}}),Lc=Pt({oneHot_:function(b,h,c,m){if(c===void 0&&(c=1),m===void 0&&(m=0),h<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+h);var w=Ze(b,"indices","oneHot","int32"),R=w.shape.concat([h]),K={indices:w=w.flatten()},ee={depth:h,onValue:c,offValue:m};return Ve.runKernelFunc(function(le,de){return de([w]),le.oneHot(w,h,c,m)},K,null,Ph,ee).reshape(R)}}),ec=Pt({pad_:function(b,h,c){c===void 0&&(c=0);var m=Ze(b,"x","pad");if(m.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var w={paddings:h,constantValue:c},R={x:m};return Ve.runKernelFunc(function(K,ee){return ee([m]),K.pad(m,h,c)},R,null,tl,w)}}),Nu=Pt({pad1d_:function(b,h,c){return c===void 0&&(c=0),we(h.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),ec(b,[h],c)}}),Kh=Pt({pad2d_:function(b,h,c){return c===void 0&&(c=0),we(h.length===2&&h[0].length===2&&h[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ec(b,h,c)}}),og=Pt({pad3d_:function(b,h,c){return c===void 0&&(c=0),we(h.length===3&&h[0].length===2&&h[1].length===2&&h[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ec(b,h,c)}}),u0=Pt({pad4d_:function(b,h,c){return c===void 0&&(c=0),we(h.length===4&&h[0].length===2&&h[1].length===2&&h[2].length===2&&h[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ec(b,h,c)}}),c0=Pt({rand_:function(b,h,c){var m=ze(b),w=null;if(c==null||c==="float32")w=new Float32Array(m);else if(c==="int32")w=new Int32Array(m);else{if(c!=="bool")throw new Error("Unknown data type "+c);w=new Uint8Array(m)}for(var R=0;R<m;R++)w[R]=h();return Ve.makeTensor(w,b,c)}}),lm=.001,zo=.1;function fm(){return Ve.backend.floatPrecision()===32?lm:zo}function Bc(b,h,c){var m=!0;if((ft(b)||ft(h))&&(m=!1),ft(b)&&ft(h)&&(m=!0),m){var w=b.constructor.name,R=h.constructor.name;if(w!==R)throw new Error("Arrays are of different type. Actual: "+w+". Expected: "+R)}if(Array.isArray(b)&&Array.isArray(h)){var K=Ka(b),ee=Ka(h);if(!Ut(K,ee))throw new Error("Arrays have different shapes. Actual: ["+K+"]. Expected: ["+ee+"]")}var le=ft(b)?b:Mt(b),de=ft(h)?h:Mt(h);if(le.length!==de.length)throw new Error("Arrays have different lengths actual: "+le.length+" vs expected: "+de.length+`.
Actual:   `+le+`.
Expected: `+de+".");for(var _e=0;_e<de.length;++_e){var Te=le[_e],Ne=de[_e];if(!c(Te,Ne))throw new Error("Arrays differ: actual["+_e+"] = "+Te+", expected["+_e+"] = "+Ne+`.
Actual:   `+le+`.
Expected: `+de+".")}}function jd(b,h,c){return!isFinite(b)&&!isFinite(h)||!(isNaN(b)||isNaN(h)||Math.abs(b-h)>c)}var zd=Object.freeze({TEST_EPSILON_FLOAT16:zo,expectArraysClose:function(b,h,c){return c==null&&(c=fm()),Bc(b,h,function(m,w){return jd(m,w,c)})},testEpsilon:fm,expectPromiseToFail:function(b,h){b().then(function(){return h.fail()},function(){return h()})},expectArraysEqual:function(b,h){var c=typeof h=="string"||typeof h=="number"||typeof h=="boolean"?[h]:h;return Pn(b)||Pn(b[0])||Pn(h)||Pn(h[0])?Bc(b,c,function(m,w){return m==w}):Bc(b,h,function(m,w){return jd(m,w,0)})},expectNumbersClose:function(b,h,c){if(c==null&&(c=fm()),!jd(b,h,c))throw new Error("Numbers differ: actual === "+b+", expected === "+h)},expectValuesInRange:function(b,h,c){for(var m=0;m<b.length;m++)if(b[m]<h||b[m]>c)throw new Error("Value out of range:"+b[m]+" low: "+h+", high: "+c)},expectArrayBuffersEqual:function(b,h){expect(new Float32Array(b)).toEqual(new Float32Array(h))}}),dm=function(){function b(h,c,m,w,R){this.mean=h,this.stdDev=c,this.dtype=m,this.nextVal=NaN,this.truncated=w,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var K=R||Math.random();this.random=Gh(K.toString())}return b.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var h=this.nextVal;return this.nextVal=NaN,h}for(var c,m,w=!1;!w;){var R=void 0,K=void 0,ee=void 0;do ee=(R=2*this.random()-1)*R+(K=2*this.random()-1)*K;while(ee>=1||ee===0);var le=Math.sqrt(-2*Math.log(ee)/ee);c=this.mean+this.stdDev*R*le,m=this.mean+this.stdDev*K*le,this.truncated&&!this.isValidTruncated(c)||(w=!0)}return this.truncated&&!this.isValidTruncated(m)||(this.nextVal=this.convertValue(m)),this.convertValue(c)},b.prototype.convertValue=function(h){return this.dtype==null||this.dtype==="float32"?h:Math.round(h)},b.prototype.isValidTruncated=function(h){return h<=this.upper&&h>=this.lower},b}(),ag=function(){function b(h,c,m,w){this.alpha=h,this.beta=1/c,this.dtype=m;var R=w||Math.random();this.randu=Gh(R.toString()),this.randn=new dm(0,1,m,!1,this.randu()),this.d=h<1?h+2/3:h-1/3,this.c=1/Math.sqrt(9*this.d)}return b.prototype.nextValue=function(){for(var h,c,m,w,R,K;;){do w=this.randn.nextValue(),K=1+this.c*w;while(K<=0);if(K*=K*K,c=1-.331*(h=w*w)*h,m=.5*h+this.d*(1-K+Math.log(K)),(R=this.randu())<c||Math.log(R)<m)break}return K=1/this.beta*this.d*K,this.alpha<1&&(K*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(K)},b.prototype.convertValue=function(h){return this.dtype==="float32"?h:Math.round(h)},b}(),sg=function(){function b(h,c,m,w){var R=this;if(h===void 0&&(h=0),c===void 0&&(c=1),this.canReturnFloat=function(){return R.dtype==null||R.dtype==="float32"},this.min=h,this.range=c-h,this.dtype=m,w==null&&(w=Math.random()),typeof w=="number"&&(w=w.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+h+" - "+c+" <= 1 and dtype is not float");this.random=Gh(w)}return b.prototype.convertValue=function(h){return this.canReturnFloat()?h:Math.round(h)},b.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},b}(),ug=Pt({randomGamma_:function(b,h,c,m,w){if(c===void 0&&(c=1),m===void 0&&(m="float32"),c==null&&(c=1),m==null&&(m="float32"),m!=="float32"&&m!=="int32")throw new Error("Unsupported data type "+m);for(var R=new ag(h,c,m,w),K=Di(b,m),ee=0;ee<K.values.length;ee++)K.values[ee]=R.nextValue();return K.toTensor()}}),xv=Pt({randomNormal_:function(b,h,c,m,w){if(h===void 0&&(h=0),c===void 0&&(c=1),m!=null&&m==="bool")throw new Error("Unsupported data type "+m);for(var R=new dm(h,c,m,!1,w),K=Di(b,m),ee=0;ee<K.values.length;ee++)K.values[ee]=R.nextValue();return K.toTensor()}}),cg=Pt({randomUniform_:function(b,h,c,m,w){h===void 0&&(h=0),c===void 0&&(c=1),m===void 0&&(m="float32");for(var R=Di(b,m),K=new sg(h,c,null,w),ee=0;ee<R.values.length;ee++)R.values[ee]=K.nextValue();return R.toTensor()}}),If=Pt({square_:function(b){var h=Ze(b,"x","square"),c=[h];return Ve.runKernelFunc(function(m,w){return w([h]),m.square(h)},{x:h},null,"Square",{},c,[])}}),lg=Pt({squaredDifference_:function(b,h){var c,m=Ze(b,"a","squaredDifference"),w=Ze(h,"b","squaredDifference");c=Kt(m,w),m=c[0],w=c[1],qi(m.shape,w.shape);var R={a:m,b:w},K=[m,w];return Ve.runKernelFunc(function(ee,le){var de=ee.squaredDifference(m,w);return le([m,w]),de},R,function(ee,le){var de=le[0],_e=le[1],Te=kr(2);return{a:function(){return ee.mul(de.sub(_e).mul(Te))},b:function(){return ee.mul(_e.sub(de).mul(Te))}}},pf,{},K,[])}}),Yh=Pt({truncatedNormal_:function(b,h,c,m,w){if(h===void 0&&(h=0),c===void 0&&(c=1),m!=null&&m==="bool")throw new Error("Unsupported data type $ { dtype }");for(var R=new dm(h,c,m,!0,w),K=Di(b,m),ee=0;ee<K.values.length;ee++)K.values[ee]=R.nextValue();return K.toTensor()}}),fg=Pt({equal_:function(b,h){var c,m=Ze(b,"a","equal"),w=Ze(h,"b","equal");return c=Kt(m,w),m=c[0],w=c[1],qi(m.shape,w.shape),Ve.runKernelFunc(function(R){return R.equal(m,w)},{$a:m,$b:w})}}),l0=Pt({equalStrict_:function(b,h){var c=Ze(b,"a","equalStrict"),m=Ze(h,"b","equalStrict");return bt(c.shape,m.shape,"Error in equalStrict: "),c.equal(m)}}),f0=Pt({greater_:function(b,h){var c,m=Ze(b,"a","greater"),w=Ze(h,"b","greater");return c=Kt(m,w),m=c[0],w=c[1],qi(m.shape,w.shape),Ve.runKernelFunc(function(R){return R.greater(m,w)},{a:m,b:w},null,"Greater")}}),hm=Pt({greaterEqual_:function(b,h){var c,m=Ze(b,"a","greaterEqual"),w=Ze(h,"b","greaterEqual");return c=Kt(m,w),m=c[0],w=c[1],qi(m.shape,w.shape),Ve.runKernelFunc(function(R,K){var ee=R.greaterEqual(m,w);return K([m,w]),ee},{a:m,b:w},function(R,K){var ee=K[0],le=K[1];return{a:function(){return mi(ee)},b:function(){return mi(le)}}},"GreaterEqual")}}),d0=Pt({greaterEqualStrict_:function(b,h){var c=Ze(b,"a","greaterEqualStrict"),m=Ze(h,"b","greaterEqualStrict");return bt(c.shape,m.shape,"Error in greaterEqualStrict: "),c.greaterEqual(m)}}),dg=Pt({greaterStrict_:function(b,h){var c=Ze(b,"a","greaterStrict"),m=Ze(h,"b","greaterStrict");return bt(c.shape,m.shape,"Error in greaterStrict: "),c.greater(m)}}),wv=Pt({less_:function(b,h){var c,m=Ze(b,"a","less"),w=Ze(h,"b","less");return c=Kt(m,w),m=c[0],w=c[1],qi(m.shape,w.shape),Ve.runKernelFunc(function(R){return R.less(m,w)},{a:m,b:w},null,"Less")}}),Wl=Pt({lessEqual_:function(b,h){var c,m=Ze(b,"a","lessEqual"),w=Ze(h,"b","lessEqual");return c=Kt(m,w),m=c[0],w=c[1],qi(m.shape,w.shape),Ve.runKernelFunc(function(R,K){var ee=R.lessEqual(m,w);return K([m,w]),ee},{a:m,b:w},null,"LessEqual")}}),Ty=Pt({lessEqualStrict_:function(b,h){var c=Ze(b,"a","lessEqualStrict"),m=Ze(h,"b","lessEqualStrict");return bt(c.shape,m.shape,"Error in lessEqualStrict: "),c.lessEqual(m)}}),_v=Pt({lessStrict_:function(b,h){var c=Ze(b,"a","lessStrict"),m=Ze(h,"b","lessStrict");return bt(c.shape,m.shape,"Error in lessStrict: "),c.less(m)}}),pm=Pt({notEqual_:function(b,h){var c,m=Ze(b,"a","notEqual"),w=Ze(h,"b","notEqual");return c=Kt(m,w),m=c[0],w=c[1],qi(m.shape,w.shape),Ve.runKernelFunc(function(R){return R.notEqual(m,w)},{a:m,b:w},null,"NotEqual")}}),Ev=Pt({notEqualStrict_:function(b,h){var c=Ze(b,"a","notEqualStrict"),m=Ze(h,"b","notEqualStrict");return bt(c.shape,m.shape,"Error in notEqualStrict: "),c.notEqual(m)}});function Ff(b,h){for(var c=[],m=b;m<h;++m)c.push(m);return c}function Sv(b){for(var h=[],c=0;c<b.length;++c)for(var m=0;m<b[c].length;++m)h.push(b[c][m]);return h}var mm=Pt({gather_:function(b,h,c){c===void 0&&(c=0);var m=Ze(b,"x","gather"),w=Ze(h,"indices","gather","int32");c=Yt(c,m.shape)[0];var R=function(K,ee,le){for(var de=K.shape[le],_e=[],Te=1,Ne=1,Fe=0;Fe<le;Fe++)_e.push(K.shape[Fe]),Te*=K.shape[Fe];for(Fe=0;Fe<ee.rank;Fe++)_e.push(ee.shape[Fe]);for(Fe=le+1;Fe<K.rank;Fe++)_e.push(K.shape[Fe]),Ne*=K.shape[Fe];return{batchSize:Te,sliceSize:Ne,dimSize:de,outputShape:_e}}(m,w,c);return Ve.runKernelFunc(function(K,ee){var le=K.gather(m,w.flatten(),c);return ee([w]),le},{x:m,indices:w},function(K,ee){var le=ee[0];return{x:function(){var de=m.shape,_e=le.size,Te=de.slice(0,c),Ne=Te.length,Fe=de.slice(c,de.length).slice(1),He=Fe.length,Ye=Ff(0,Ne),Ke=Ff(Ne+1,Ne+1+He),it=Sv([Te,[_e],Fe]),gt=K.reshape(it),wt=le.reshape([_e]),At=Sv([[Ne],Ye,Ke]),zt=gt.transpose(At),an=hg(zt,wt,m.shape[c]),dn=Vu(At);return an.transpose(dn)},indices:function(){return le}}},"Gather",{axis:c}).reshape(R.outputShape)}}),hg=Pt({unsortedSegmentSum_:function(b,h,c){var m=Ze(b,"x","unsortedSegmentSum"),w=Ze(h,"segmentIds","unsortedSegmentSum","int32");return we(Ft(c),function(){return"numSegments must be of dtype int"}),Ve.runKernelFunc(function(R,K){var ee=R.unsortedSegmentSum(m,w,c);return K([w]),ee},{$x:m},function(R,K){var ee=K[0];return{$x:function(){return function(le,de){for(var _e=Ta(de,mi(de)),Te=mm(le,_e),Ne=hm(de,kr(0,"int32")),Fe=Te.rank-Ne.rank,He=0;He<Fe;++He)Ne=lc(Ne,He+1);Ne=Zu(Ne,Du(Te.shape,"bool"));var Ye=mi(Te);return ul(Ne,Te,Ye)}(R,ee)}}})}}),kv=function(b,h,c){return N(this,void 0,void 0,function(){var m,w,R,K,ee,le,de,_e,Te,Ne,Fe,He,Ye;return L(this,function(Ke){switch(Ke.label){case 0:for(m=Ze(b,"tensor","boolMask"),w=Ze(h,"mask","boolMask","bool"),R=c??0,K=w.rank,ee=m.shape,we(K>0,function(){return"mask cannot be scalar"}),bt(ee.slice(R,R+K),w.shape,"mask's shape must match the first K dimensions of tensor's shape,"),le=1,de=R;de<R+K;de++)le*=ee[de];return _e=ee.slice(0,R).concat([le],ee.slice(R+K)),Te=m.reshape(_e),Ne=w.reshape([-1]),[4,Ld(Ne)];case 1:return Fe=Ke.sent(),He=Fe.squeeze([1]),Ye=mm(Te,He,R),b!==m&&m.dispose(),h!==w&&w.dispose(),He.dispose(),Te.dispose(),Ne.dispose(),Fe.dispose(),[2,Ye]}})})};function Cv(b,h,c,m,w,R,K){R===void 0&&(R="NHWC"),we(b.length===h.rank,function(){return"Length of inShape ("+b.length+") and rank of dy ("+h.rank+") must match"});var ee=b,le=h,de=!1;h.rank===3&&(de=!0,le=h.as4D(1,h.shape[0],h.shape[1],h.shape[2]),ee=[1,b[0],b[1],b[2]]),we(ee.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+ee.length+"."}),we(le.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+le.rank}),we(c.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+c.rank});var _e=R==="NHWC"?ee[3]:ee[1],Te=R==="NHWC"?le.shape[3]:le.shape[1];we(_e===c.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+_e+") must match input depth for filter "+c.shape[2]+"."}),we(Te===c.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+Te+") must match output depth for filter "+c.shape[3]+"."}),K!=null&&we(Ft(w),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+K+" but got pad "+w+"."});var Ne=ai(R),Fe=Hn(ee,c.shape,m,1,w,K,!1,Ne),He=Ve.runKernelFunc(function(Ye,Ke){var it=Ye.conv2dDerInput(le,c,Fe);return Ke([c,le]),it},{dy4D:le,filter:c},function(Ye,Ke){var it=Ke[0],gt=Ke[1];return{dy4D:function(){return Ud(Ye,it,m,w,R,1,K)},filter:function(){return Tv(Ye,gt,it.shape,m,w,R,K)}}});return de?He.as3D(He.shape[1],He.shape[2],He.shape[3]):He}function h0(b){var h=function(R){return typeof R=="number"?[R,R,R]:R.length===2?[R[0],R[1],1]:R}(b),c=h[0],m=h[1],w=h[2];return c===1&&m===1&&w===1}function Av(b,h,c,m,w){we(b.length===h.rank,function(){return"Length of inShape ("+b.length+") and rank of dy ("+h.rank+") must match"});var R=b,K=h,ee=!1;h.rank===4&&(ee=!0,K=h.as5D(1,h.shape[0],h.shape[1],h.shape[2],h.shape[3]),R=[1,b[0],b[1],b[2],b[3]]);var le=R[4],de=K.shape[4];we(R.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+R.length+"."}),we(K.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+K.rank}),we(c.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+c.rank}),we(le===c.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+le+") must match input depth for filter "+c.shape[3]+"."}),we(de===c.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+de+") must match output depth for filter "+c.shape[4]+"."});var _e=nr(R,c.shape,m,1,w),Te=Ve.runKernelFunc(function(Ne){return Ne.conv3dDerInput(K,c,_e)},{dy5D:K});return ee?Te.as4D(Te.shape[1],Te.shape[2],Te.shape[3],Te.shape[4]):Te}var Ov=Pt({conv1d_:function(b,h,c,m,w,R,K){w===void 0&&(w="NWC"),R===void 0&&(R=1);var ee=Ze(b,"x","conv1d"),le=Ze(h,"filter","conv1d"),de=ee,_e=!1;ee.rank===2&&(_e=!0,de=ee.as3D(1,ee.shape[0],ee.shape[1])),we(de.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+de.rank+"."}),we(le.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+le.rank+"."}),K!=null&&we(Ft(m),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+K+" but got pad "+m+"."}),we(de.shape[2]===le.shape[1],function(){return"Error in conv1d: depth of input ("+de.shape[2]+") must match input depth for filter "+le.shape[1]+"."}),we(Ir(c,R),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+c+" and dilation '"+R+"'"}),we(w==="NWC",function(){return"Error in conv1d: got dataFormat of "+w+" but only NWC is currently supported."});var Te=le.as4D(1,le.shape[0],le.shape[1],le.shape[2]),Ne=de.as4D(de.shape[0],1,de.shape[1],de.shape[2]),Fe=Ud(Ne,Te,[1,c],m,"NHWC",[1,R],K);return _e?Fe.as2D(Fe.shape[2],Fe.shape[3]):Fe.as3D(Fe.shape[0],Fe.shape[2],Fe.shape[3])}}),Ud=Pt({conv2d_:function(b,h,c,m,w,R,K){w===void 0&&(w="NHWC"),R===void 0&&(R=[1,1]);var ee=Ze(b,"x","conv2d"),le=Ze(h,"filter","conv2d"),de=ee,_e=!1;ee.rank===3&&(_e=!0,de=ee.as4D(1,ee.shape[0],ee.shape[1],ee.shape[2])),we(de.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+de.rank+"."}),we(le.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+le.rank+"."}),K!=null&&we(Ft(m),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+K+" but got pad "+m+"."});var Te=w==="NHWC"?de.shape[3]:de.shape[1];we(Te===le.shape[2],function(){return"Error in conv2d: depth of input ("+Te+") must match input depth for filter "+le.shape[2]+"."}),we(Ir(c,R),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+c+" and dilations '"+R+"'"});var Ne=ai(w),Fe=Hn(de.shape,le.shape,c,R,m,K,!1,Ne),He=[le,de],Ye=Ve.runKernelFunc(function(Ke,it){var gt=Ke.conv2d(de,le,Fe);return it([le,de]),gt},{x:de,filter:le},function(Ke,it){var gt=it,wt=gt[0],At=gt[1];return we(ii(R),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+R+"'"}),{x:function(){return Vl(At.shape,Ke,wt,c,m,w)},filter:function(){return Tv(At,Ke,wt.shape,c,m,w)}}},"Conv2D",Fe,He);return _e?Ye.as3D(Ye.shape[1],Ye.shape[2],Ye.shape[3]):Ye}}),My=Pt({conv3d_:function(b,h,c,m,w,R){w===void 0&&(w="NDHWC"),R===void 0&&(R=[1,1,1]);var K=Ze(b,"x","conv3d"),ee=Ze(h,"filter","conv3d"),le=K,de=!1;K.rank===4&&(de=!0,le=K.as5D(1,K.shape[0],K.shape[1],K.shape[2],K.shape[3])),we(le.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+le.rank+"."}),we(ee.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+ee.rank+"."}),we(le.shape[4]===ee.shape[3],function(){return"Error in conv3d: depth of input ("+le.shape[4]+") must match input depth for filter "+ee.shape[3]+"."}),we(function(Ne,Fe){return h0(c)||h0(Fe)}(0,R),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+c+" and dilations '"+R+"'"}),we(w==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+w+" but only NDHWC is currently supported."});var _e=nr(le.shape,ee.shape,c,R,m),Te=Ve.runKernelFunc(function(Ne,Fe){var He=Ne.conv3d(le,ee,_e);return Fe([le,ee]),He},{x:le,$filter:ee},function(Ne,Fe){we(h0(R),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+R+"'"});var He=Fe[0],Ye=Fe[1];return{x:function(){return Av(He.shape,Ne,Ye,c,m)},$filter:function(){return function(Ke,it,gt,wt,At){var zt=Ke;Ke.rank===4&&(zt=Ke.as5D(1,Ke.shape[0],Ke.shape[1],Ke.shape[2],Ke.shape[3]));var an=it;an.rank===4&&(an=it.as5D(1,it.shape[0],it.shape[1],it.shape[2],it.shape[3])),we(zt.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+zt.shape+"."}),we(an.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+an.shape+"."}),we(gt.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+gt+"."}),we(zt.shape[4]===gt[3],function(){return"Error in conv3dDerFilter: depth of input "+zt.shape[4]+") must match input depth in filter ("+gt[3]+"."}),we(an.shape[4]===gt[4],function(){return"Error in conv3dDerFilter: depth of dy ("+an.shape[4]+") must match output depth for filter ("+gt[4]+")."});var dn=nr(zt.shape,gt,wt,1,At);return Ve.runKernelFunc(function(sn){return sn.conv3dDerFilter(zt,an,dn)},{x5D:zt,dy5D:an})}(He,Ne,Ye.shape,c,m)}}});return de?Te.as4D(Te.shape[1],Te.shape[2],Te.shape[3],Te.shape[4]):Te}}),Tv=Pt({conv2dDerFilter_:function(b,h,c,m,w,R,K){R===void 0&&(R="NHWC");var ee=b;b.rank===3&&(ee=b.as4D(1,b.shape[0],b.shape[1],b.shape[2]));var le=h;le.rank===3&&(le=h.as4D(1,h.shape[0],h.shape[1],h.shape[2])),we(ee.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+ee.shape+"."}),we(le.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+le.shape+"."}),we(c.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+c+"."});var de=R==="NHWC"?ee.shape[3]:ee.shape[1],_e=R==="NHWC"?le.shape[3]:le.shape[1];we(de===c[2],function(){return"Error in conv2dDerFilter: depth of input "+de+") must match input depth in filter ("+c[2]+"."}),we(_e===c[3],function(){return"Error in conv2dDerFilter: depth of dy ("+_e+") must match output depth for filter ("+c[3]+")."}),K!=null&&we(Ft(w),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+K+" but got pad "+w+"."});var Te=ai(R),Ne=Hn(ee.shape,c,m,1,w,K,!1,Te);return Ve.runKernelFunc(function(Fe){return Fe.conv2dDerFilter(ee,le,Ne)},{x4D:ee,dy4D:le})}}),Vl=Pt({conv2dDerInput_:Cv}),p0=Pt({depthwiseConv2d_:function(b,h,c,m,w,R,K){R===void 0&&(R=[1,1]);var ee=Ze(b,"x","depthwiseConv2d"),le=Ze(h,"filter","depthwiseConv2d"),de=ee,_e=!1;ee.rank===3&&(_e=!0,de=ee.as4D(1,ee.shape[0],ee.shape[1],ee.shape[2])),we(de.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+de.rank+"."}),we(le.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+le.rank+"."}),we(de.shape[3]===le.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+de.shape[3]+") must match the inChannels dimension in filter "+le.shape[2]+"."}),R==null&&(R=[1,1]),we(Ir(c,R),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+c+" and dilations '"+R+"'"}),K!=null&&we(Ft(m),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+K+" but got pad "+m+"."});var Te=Hn(de.shape,le.shape,c,R,m,K,!0),Ne=[de,le],Fe=Ve.runKernelFunc(function(He,Ye){var Ke=He.depthwiseConv2D(de,le,Te);return Ye([de,le]),Ke},{x:de,filter:le},function(He,Ye){we(ii(R),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+R+"'"});var Ke=Ye[0],it=Ye[1];return{x:function(){return Mv(Ke.shape,He,it,Te)},filter:function(){return Wd(Ke,He,it.shape,Te)}}},"DepthwiseConv2dNative",Te,Ne);return _e?Fe.as3D(Fe.shape[1],Fe.shape[2],Fe.shape[3]):Fe}}),Mv=Pt({depthwiseConv2dDerInput_:function(b,h,c,m){var w=h,R=!1;h.rank===3&&(R=!0,w=h.as4D(1,h.shape[0],h.shape[1],h.shape[2]));var K=Ve.runKernelFunc(function(ee){return ee.depthwiseConv2DDerInput(w,c,m)},{dy4D:w});return R?K.as3D(K.shape[1],K.shape[2],K.shape[3]):K}}),Wd=Pt({depthwiseConv2dDerFilter_:function(b,h,c,m){var w=b;b.rank===3&&(w=b.as4D(1,b.shape[0],b.shape[1],b.shape[2]));var R=h;return R.rank===3&&(R=h.as4D(1,h.shape[0],h.shape[1],h.shape[2])),Ve.runKernelFunc(function(K){return K.depthwiseConv2DDerFilter(w,R,m)},{x4D:w,dy4D:R})}}),Hl=Pt({separableConv2d_:function(b,h,c,m,w,R,K){R===void 0&&(R=[1,1]),K===void 0&&(K="NHWC");var ee=Ze(b,"x","separableConv2d"),le=Ze(h,"depthwiseFilter","separableConv2d"),de=Ze(c,"pointwiseFilter","separableConv2d"),_e=ee,Te=!1;if(ee.rank===3&&(Te=!0,_e=ee.as4D(1,ee.shape[0],ee.shape[1],ee.shape[2])),K==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");we(_e.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+_e.rank+"."}),we(le.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+le.rank+"."}),we(de.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+le.rank+"."}),we(de.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+de.shape[0]+"."}),we(de.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+de.shape[1]+"."});var Ne=le.shape[2],Fe=le.shape[3];we(de.shape[2]===Ne*Fe,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+Ne*Fe+", but got "+de.shape[2]+"."});var He=p0(_e,le,m,w,K,R),Ye=Ud(He,de,1,"valid",K);return Te?Ye.as3D(Ye.shape[1],Ye.shape[2],Ye.shape[3]):Ye}}),pg=Pt({conv2dTranspose_:function(b,h,c,m,w,R){return Cv(c,Ze(b,"x","conv2dTranspose"),Ze(h,"filter","conv2dTranspose"),m,w,"NHWC",R)}}),m0=Pt({conv3dTranspose_:function(b,h,c,m,w){return Av(c,Ze(b,"x","conv3dTranspose"),Ze(h,"filter","conv3dTranspose"),m,w)}}),jc=Pt({matMul_:function(b,h,c,m){var w;c===void 0&&(c=!1),m===void 0&&(m=!1);var R=Ze(b,"a","matMul"),K=Ze(h,"b","matMul");w=Kt(R,K),R=w[0],K=w[1];var ee=c?R.shape[R.rank-2]:R.shape[R.rank-1],le=m?K.shape[K.rank-1]:K.shape[K.rank-2],de=c?R.shape[R.rank-1]:R.shape[R.rank-2],_e=m?K.shape[K.rank-2]:K.shape[K.rank-1],Te=R.shape.slice(0,-2),Ne=K.shape.slice(0,-2),Fe=ze(Te),He=ze(Ne);we(R.rank>=2&&K.rank>=2&&R.rank===K.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+R.rank+" and "+K.rank+"."}),we(Ut(Te,Ne),function(){return"Error in matMul: outer dimensions ("+Te+") and ("+Ne+") of Tensors with shapes "+R.shape+" and "+K.shape+" must match."}),we(ee===le,function(){return"Error in matMul: inner shapes ("+ee+") and ("+le+") of Tensors with shapes "+R.shape+" and "+K.shape+" and transposeA="+c+" and transposeB="+m+" must match."});var Ye=R.shape.slice(0,-2).concat([de,_e]),Ke=c?R.as3D(Fe,ee,de):R.as3D(Fe,de,ee),it=m?K.as3D(He,_e,le):K.as3D(He,le,_e),gt={transposeA:c,transposeB:m};return Ve.runKernelFunc(function(wt,At){var zt=wt.batchMatMul(Ke,it,c,m);return At([Ke,it]),zt},{a:Ke,b:it},function(wt,At){var zt=At,an=zt[0],dn=zt[1];return c||m?!c&&m?{a:function(){return wt.matMul(dn,!1,!1)},b:function(){return wt.matMul(an,!0,!1)}}:c&&!m?{a:function(){return dn.matMul(wt,!1,!0)},b:function(){return an.matMul(wt,!1,!1)}}:{a:function(){return dn.matMul(wt,!0,!0)},b:function(){return wt.matMul(an,!0,!0)}}:{a:function(){return wt.matMul(dn,!1,!0)},b:function(){return an.matMul(wt,!0,!1)}}},"BatchMatMul",gt).reshape(Ye)}}),g0=Pt({dot_:function(b,h){var c=Ze(b,"t1","dot"),m=Ze(h,"t2","dot");we(!(c.rank!==1&&c.rank!==2||m.rank!==1&&m.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+c.rank+" and "+m.rank+"."});var w=c.rank===1?c.size:c.shape[1],R=m.rank===1?m.size:m.shape[0];return we(w===R,function(){return"Error in dot: inner dimensions of inputs must match, but got "+w+" and "+R+"."}),c.rank===1&&m.rank===1?c.as2D(1,-1).matMul(m.as2D(-1,1)).asScalar():c.rank===1&&m.rank===2?c.as2D(1,-1).matMul(m.as2D(m.shape[0],m.shape[1])).as1D():c.rank===2&&m.rank===1?c.matMul(m.as2D(-1,1)).as1D():c.matMul(m.as2D(m.shape[0],m.shape[1]))}}),Dv=Pt({outerProduct_:function(b,h){var c=Ze(b,"v1","outerProduct"),m=Ze(h,"v2","outerProduct");return we(c.rank===1&&m.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+c.rank+" and "+m.rank+"."}),c.as2D(-1,1).matMul(m.as2D(1,-1))}}),Rf=Pt({reverse_:function(b,h){var c=Ze(b,"x","reverse");if(c.rank===0)return c.clone();var m=Yt(h,c.shape);return Ve.runKernelFunc(function(w){return w.reverse(c,m)},{$x:c},function(w){return{$x:function(){return w.reverse(m)}}}).reshapeAs(c)}}),Dy=Pt({reverse1d_:function(b){var h=Ze(b,"x","reverse");return we(h.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+h.rank+"."}),Rf(h,0)}}),Jh=Pt({reverse2d_:function(b,h){var c=Ze(b,"x","reverse");return we(c.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+c.rank+"."}),Rf(c,h)}}),Qh=Pt({reverse3d_:function(b,h){var c=Ze(b,"x","reverse");return we(c.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+c.rank+"."}),Rf(c,h)}}),Pf=Pt({reverse4d_:function(b,h){var c=Ze(b,"x","reverse");return we(c.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+c.rank+"."}),Rf(c,h)}});function Nv(b,h,c,m,w,R){var K=Ze(b,"x","maxPool"),ee=K,le=!1;K.rank===3&&(le=!0,ee=K.as4D(1,K.shape[0],K.shape[1],K.shape[2])),m==null&&(m=[1,1]),we(ee.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+ee.rank+"."}),we(Ir(c,m),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+c+" and dilations '"+m+"'"}),R!=null&&we(Ft(w),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+R+" but got pad "+w+"."});var de=Mn(ee.shape,h,c,m,w,R);if(de.filterWidth===1&&de.filterHeight===1&&Ut(de.inShape,de.outShape))return K.clone();var _e=[ee],Te=Ve.runKernelFunc(function(Ne,Fe){var He=Ne.maxPool(ee,de);return Fe([ee,He]),He},{x:ee},function(Ne,Fe){var He=Fe[0],Ye=Fe[1];return{x:function(){return function(Ke,it,gt,wt,At,zt,an,dn){var sn=Ze(Ke,"dy","maxPoolBackprop"),ln=Ze(it,"input","maxPoolBackprop"),Tn=Ze(gt,"output","maxPoolBackprop");we(ln.rank===sn.rank,function(){return"Rank of input ("+ln.rank+") does not match rank of dy ("+sn.rank+")"}),zt==null&&(zt=[1,1]),we(Ir(At,zt),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+At+" and dilations '"+zt+"'"}),we(sn.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+sn.rank+"."}),we(ln.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+ln.rank+"."});var Bn=Mn(ln.shape,wt,At,zt,an,dn);return Ve.runKernelFunc(function(In){return In.maxPoolBackprop(sn,ln,Tn,Bn)},{$dy:sn,$input:ln})}(Ne,He,Ye,h,c,m,w)}}},"MaxPool",de,_e);return le?Te.as3D(Te.shape[1],Te.shape[2],Te.shape[3]):Te}function Vd(b,h,c,m,w,R){var K=Ze(b,"x","avgPool","float32");m==null&&(m=[1,1]),we(Ir(c,m),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+c+" and dilations '"+m+"'"});var ee=K,le=!1;K.rank===3&&(le=!0,ee=K.as4D(1,K.shape[0],K.shape[1],K.shape[2])),we(ee.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+ee.rank+"."}),R!=null&&we(Ft(w),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+R+" but got pad "+w+"."});var de=Mn(ee.shape,h,c,m,w,R);if(de.filterWidth===1&&de.filterHeight===1&&Ut(de.inShape,de.outShape))return K.clone();var _e=Ve.runKernelFunc(function(Te){return Te.avgPool(ee,de)},{x:ee},function(Te){return{x:function(){return function(Ne,Fe,He,Ye,Ke,it){var gt=Ze(Ne,"dy","avgPoolBackprop"),wt=Ze(Fe,"input","avgPoolBackprop");we(wt.rank===gt.rank,function(){return"Rank of input ("+wt.rank+") does not match rank of dy ("+gt.rank+")"}),Ke==null&&(Ke=[1,1]),we(Ir(Ye,Ke),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+Ye+" and dilations '"+Ke+"'"});var At=wt,zt=gt,an=!1;wt.rank===3&&(an=!0,At=wt.as4D(1,wt.shape[0],wt.shape[1],wt.shape[2]),zt=gt.as4D(1,gt.shape[0],gt.shape[1],gt.shape[2])),we(zt.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+zt.rank+"."}),we(At.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+At.rank+"."});var dn=Mn(At.shape,He,Ye,Ke,it),sn=Ve.runKernelFunc(function(ln){return ln.avgPoolBackprop(zt,At,dn)},{dy4D:zt,input4D:At});return an?sn.as3D(sn.shape[1],sn.shape[2],sn.shape[3]):sn}(Te,ee,h,c,m,w)}}},"AvgPool",de);return _e=_e.cast(K.dtype),le?_e.as3D(_e.shape[1],_e.shape[2],_e.shape[3]):_e}var zc=Pt({maxPool_:function(b,h,c,m,w){return Nv(b,h,c,1,m,w)}}),Zh=Pt({avgPool_:function(b,h,c,m,w){return Vd(b,h,c,1,m,w)}}),gm=Pt({pool_:function(b,h,c,m,w,R){w==null&&(w=[1,1]),R==null&&(R=1),m===0&&(m="valid");var K=Ze(b,"x","maxPool"),ee=K,le=!1;K.rank===3&&(le=!0,ee=K.as4D(1,K.shape[0],K.shape[1],K.shape[2])),we(Ir(R,w),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+R+" and dilations '"+w+"'"});var de,_e=Mn(ee.shape,h,R,w,m),Te=[_e.dilationHeight,_e.dilationWidth];de=m==="same"?function(At,zt){var an=At.map(function(ln,Tn){return ln+(ln-1)*(zt[Tn]-1)}).map(function(ln){return ln-1}),dn=an.map(function(ln){return Math.floor(ln/2)}),sn=an.map(function(ln,Tn){return ln-dn[Tn]});return an.map(function(ln,Tn){return[dn[Tn],sn[Tn]]})}([_e.filterHeight,_e.filterWidth],Te):[[0,0],[0,0]];var Ne=Te[0]===1&&Te[1]===1,Fe=function(At,zt,an){var dn=an.map(function(In){return In[0]}),sn=an.map(function(In){return In[1]}),ln=At.concat(dn,sn),Tn=zt.map(function(In,or){return(In-ln[or]%In)%In}),Bn=sn.map(function(In,or){return In+Tn[or]});return[zt.map(function(In,or){return[dn[or],Bn[or]]}),zt.map(function(In,or){return[0,Tn[or]]})]}([_e.inHeight,_e.inWidth],Te,de),He=Fe[0],Ye=Fe[1],Ke=Ne?m:"valid",it=Ne?ee:Al(ee,Te,He),gt=(c==="avg"?function(){return Vd(it,h,R,1,Ke)}:function(){return Nv(it,h,R,1,Ke)})(),wt=Ne?gt:Gp(gt,Te,Ye);return le?wt.as3D(wt.shape[1],wt.shape[2],wt.shape[3]):wt}}),mg=Pt({maxPool3d_:function(b,h,c,m,w,R,K){R===void 0&&(R="NDHWC");var ee=Ze(b,"x","maxPool3d"),le=ee,de=!1;ee.rank===4&&(de=!0,le=ee.as5D(1,ee.shape[0],ee.shape[1],ee.shape[2],ee.shape[3])),K==null&&(K=[1,1,1]),we(le.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+le.rank+"."}),we(R==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+R}),we(Ir(c,K),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+c+" and dilations '"+K+"'"}),w!=null&&we(Ft(m),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+w+" but got pad "+m+"."});var _e=zn(le.shape,h,c,K,m,w,R),Te=Ve.runKernelFunc(function(Ne,Fe){var He=Ne.maxPool3d(le,_e);return Fe([le,He]),He},{x:le},function(Ne,Fe){var He=Fe[0],Ye=Fe[1];return{x:function(){return function(Ke,it,gt,wt,At,zt,an,dn){var sn=Ze(Ke,"dy","maxPool3dBackprop"),ln=Ze(it,"input","maxPool3dBackprop"),Tn=Ze(gt,"output","maxPool3dBackprop"),Bn=sn,In=ln,or=Tn,fr=!1;ln.rank===4&&(fr=!0,Bn=sn.as5D(1,sn.shape[0],sn.shape[1],sn.shape[2],sn.shape[3]),In=ln.as5D(1,ln.shape[0],ln.shape[1],ln.shape[2],ln.shape[3]),or=Tn.as5D(1,Tn.shape[0],Tn.shape[1],Tn.shape[2],Tn.shape[3])),we(Bn.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+Bn.rank+"."}),we(In.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+In.rank+"."}),we(or.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+or.rank+"."}),zt==null&&(zt=[1,1,1]),we(Ir(At,zt),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+At+" and dilations '"+zt+"'"}),dn!=null&&we(Ft(an),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+dn+" but got pad "+an+"."});var br=zn(In.shape,wt,At,zt,an,dn),_r=Ve.runKernelFunc(function(xr){return xr.maxPool3dBackprop(Bn,In,or,br)},{dy5D:Bn,input5D:In});return fr?_r.as4D(_r.shape[1],_r.shape[2],_r.shape[3],_r.shape[4]):_r}(Ne,He,Ye,h,c,K,m,w)}}});return de?Te.as4D(Te.shape[1],Te.shape[2],Te.shape[3],Te.shape[4]):Te}}),v0=Pt({avgPool3d_:function(b,h,c,m,w,R,K){R===void 0&&(R="NDHWC");var ee=Ze(b,"x","avgPool3d","float32"),le=ee,de=!1;ee.rank===4&&(de=!0,le=ee.as5D(1,ee.shape[0],ee.shape[1],ee.shape[2],ee.shape[3])),K==null&&(K=[1,1,1]),we(le.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+le.rank+"."}),we(R==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+R}),we(Ir(c,K),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+c+" and dilations '"+K+"'"}),w!=null&&we(Ft(m),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+w+" but got pad "+m+"."});var _e=zn(le.shape,h,c,K,m,w,R),Te=Ve.runKernelFunc(function(Ne){return Ne.avgPool3d(le,_e)},{x:le},function(Ne){return{x:function(){return function(Fe,He,Ye,Ke,it,gt,wt){var At=Ze(Fe,"dy","avgPool3dBackprop"),zt=Ze(He,"input","avgPool3dBackprop"),an=At,dn=zt,sn=!1;zt.rank===4&&(sn=!0,an=At.as5D(1,At.shape[0],At.shape[1],At.shape[2],At.shape[3]),dn=zt.as5D(1,zt.shape[0],zt.shape[1],zt.shape[2],zt.shape[3])),we(an.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+an.rank+"."}),we(dn.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+dn.rank+"."}),it==null&&(it=[1,1,1]),we(Ir(Ke,it),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+Ke+" and dilations '"+it+"'"}),wt!=null&&we(Ft(gt),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+wt+" but got pad "+gt+"."});var ln=zn(dn.shape,Ye,Ke,it,gt,wt),Tn=Ve.runKernelFunc(function(Bn){return Bn.avgPool3dBackprop(an,dn,ln)},{dy5D:an,input5D:dn});return sn?Tn.as4D(Tn.shape[1],Tn.shape[2],Tn.shape[3],Tn.shape[4]):Tn}(Ne,le,h,c,K,m,w)}}});return Te=Te.cast(le.dtype),de?Te.as4D(Te.shape[1],Te.shape[2],Te.shape[3],Te.shape[4]):Te}}),Iv=Pt({maxPoolWithArgmax_:function(b,h,c,m,w){w===void 0&&(w=!1);var R=Ze(b,"x","maxPoolWithArgmax"),K={filterSize:h,strides:c,pad:m,includeBatchInIndex:w},ee=Ve.runKernel("MaxPoolWithArgmax",{x:R},K);return{result:ee[0],indexes:ee[1]}}}),hs=Pt({slice_:function(b,h,c){var m,w,R=Ze(b,"x","slice");if(R.rank===0)throw new Error("Slicing scalar is not possible");(m=typeof h=="number"?[h].concat(new Array(R.rank-1).fill(0)):h.length<R.rank?h.concat(new Array(R.rank-h.length).fill(0)):h.slice()).forEach(function(le){we(le!==-1,function(){return"slice() does not support negative begin indexing."})}),w=(w=c==null?new Array(R.rank).fill(-1):typeof c=="number"?[c].concat(new Array(R.rank-1).fill(-1)):c.length<R.rank?c.concat(new Array(R.rank-c.length).fill(-1)):c).map(function(le,de){return le>=0?le:(we(le===-1,function(){return"Negative size values should be exactly -1 but got "+le+" for the slice() size at index "+de+"."}),R.shape[de]-m[de])}),Fl(R,m,w);var K=R.shape,ee={begin:m,size:w};return Ve.runKernelFunc(function(le){return le.slice(R,m,w)},{x:R},function(le){for(var de=[],_e=0;_e<le.rank;_e++)de.push([m[_e],K[_e]-m[_e]-w[_e]]);return{x:function(){return ec(le,de)}}},"Slice",ee)}}),Fv=Pt({slice1d_:function(b,h,c){var m=Ze(b,"x","slice1d");return we(m.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+m.rank+" tensor"}),hs(m,[h],[c])}}),ep=Pt({slice2d_:function(b,h,c){var m=Ze(b,"x","slice2d");return we(m.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+m.rank+" tensor"}),hs(m,h,c)}}),Rv=Pt({slice3d_:function(b,h,c){var m=Ze(b,"x","slice3d");return we(m.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+m.rank+" tensor"}),hs(m,h,c)}}),gg=Pt({slice4d_:function(b,h,c){var m=Ze(b,"x","slice4d");return we(m.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+m.rank+" tensor"}),hs(m,h,c)}});function Lf(b,h,c,m,w){return h.rank<c.rank&&(h=h.reshape(Fo(h.shape,m))),b.rank<c.rank&&(b=b.reshape(Fo(b.shape,m))),{x:function(){var R=b.mul(c.equal(h).cast(b.dtype));return w==null?R:R.transpose(w)}}}var vm=Pt({all_:function(b,h,c){h===void 0&&(h=null),c===void 0&&(c=!1);var m=Ze(b,"x","all","bool"),w=Yt(h,m.shape),R=w,K=Ra(R,m.rank);K!=null&&(m=m.transpose(K),R=Pa(R.length,m.rank));var ee=Ve.runKernelFunc(function(de){return de.all(m,R)},{$x:m});if(c){var le=Fo(ee.shape,w);return ee.reshape(le)}return ee}}),Gl=Pt({any_:function(b,h,c){h===void 0&&(h=null),c===void 0&&(c=!1);var m=Ze(b,"x","any","bool"),w=Yt(h,m.shape),R=w,K=Ra(R,m.rank);K!=null&&(m=m.transpose(K),R=Pa(R.length,m.rank));var ee=Ve.runKernelFunc(function(de){return de.any(m,R)},{$x:m});if(c){var le=Fo(ee.shape,w);return ee.reshape(le)}return ee}}),Pv=Pt({argMax_:function(b,h){h===void 0&&(h=0);var c=Ze(b,"x","argMax");h==null&&(h=0);var m=Yt(h,c.shape),w=Ra(m,c.rank);w!=null&&(c=c.transpose(w),m=Pa(m.length,c.rank));var R={axis:m[0]},K=[c];return Ve.runKernelFunc(function(ee,le){var de=ee.argMax(c,m[0]);return le([c]),de},{x:c},function(ee,le){var de=le[0];return{x:function(){return mi(de)}}},"ArgMax",R,K)}}),vg=Pt({argMin_:function(b,h){h===void 0&&(h=0);var c=Ze(b,"x","argMin");h==null&&(h=0);var m=Yt(h,c.shape),w=Ra(m,c.rank);return w!=null&&(c=c.transpose(w),m=Pa(m.length,c.rank)),Ve.runKernelFunc(function(R,K){var ee=R.argMin(c,m[0]);return K([c]),ee},{$x:c},function(R,K){var ee=K[0];return{$x:function(){return mi(ee)}}})}}),yg=Pt({logSumExp_:function(b,h,c){h===void 0&&(h=null),c===void 0&&(c=!1);var m=Ze(b,"x","logSumExp"),w=Yt(h,m.shape),R=m.max(w,!0),K=m.sub(R).exp().sum(w).log(),ee=R.reshape(K.shape).add(K);if(c){var le=Fo(ee.shape,w);return ee.reshape(le)}return ee}}),y0=Pt({max_:function(b,h,c){h===void 0&&(h=null),c===void 0&&(c=!1);var m=Ze(b,"x","max"),w=m,R=Yt(h,m.shape),K=R,ee=Ra(K,m.rank);ee!=null&&(m=m.transpose(ee),K=Pa(K.length,m.rank));var le=[m],de=Ve.runKernelFunc(function(Te,Ne){var Fe=Te.max(m,K);return Ne([w,Fe]),Fe},{x:m},function(Te,Ne){return Lf(Te,Ne[1],Ne[0],R,ee)},"Max",{axes:K},le,[!0]);if(c){var _e=Fo(de.shape,R);de=de.reshape(_e)}return de}}),ll=Pt({mean_:function(b,h,c){h===void 0&&(h=null),c===void 0&&(c=!1);var m=Ze(b,"x","mean"),w=Yt(h,m.shape),R=ze(Io(m.shape,w)[1]);return H(function(K){var ee=kr(R);return{value:(ee.dtype===K.dtype?K:K.cast(ee.dtype)).div(ee).sum(h,c),gradFunc:function(le){var de=K.shape.slice();return w.forEach(function(_e){de[_e]=1}),le.reshape(de).mul(Du(K.shape,"float32")).div(R)}}})(m)}}),bg=Pt({min_:function(b,h,c){h===void 0&&(h=null),c===void 0&&(c=!1);var m=Ze(b,"x","min"),w=m,R=Yt(h,m.shape),K=R,ee=Ra(K,m.rank);ee!=null&&(m=m.transpose(ee),K=Pa(K.length,m.rank));var le=[m],de=Ve.runKernelFunc(function(Te,Ne){var Fe=Te.min(m,K);return Ne([w,Fe]),Fe},{x:m},function(Te,Ne){return Lf(Te,Ne[1],Ne[0],R,ee)},"Min",{axes:K},le,[!0]);if(c){var _e=Fo(de.shape,R);de=de.reshape(_e)}return de}}),Lv=Pt({moments_:function(b,h,c){h===void 0&&(h=null),c===void 0&&(c=!1);var m=Yt(h,(b=Ze(b,"x","moments")).shape),w=b.mean(m,c),R=w.shape;return c||(R=Fo(w.shape,m)),{mean:w,variance:b.toFloat().sub(w.reshape(R)).square().mean(m,c)}}}),ql=Pt({sum_:function(b,h,c){h===void 0&&(h=null),c===void 0&&(c=!1);var m=Ze(b,"x","sum");m.dtype==="bool"&&(m=m.toInt());var w=Yt(h,m.shape);return H(function(R){var K=Ra(w,R.rank),ee=w,le=R;K!=null&&(le=R.transpose(K),ee=Pa(ee.length,R.rank));var de=function(Fe){var He=R.shape.slice();return w.forEach(function(Ye){He[Ye]=1}),Fe.reshape(He).mul(Du(R.shape,"float32"))},_e={axes:ee},Te=Ve.runKernelFunc(function(Fe){return Fe.sum(le,ee)},{x:le},function(Fe){return{x:function(){return de(Fe)}}},"Sum",_e);if(c){var Ne=Fo(Te.shape,w);Te=Te.reshape(Ne)}return{value:Te,gradFunc:de}})(m)}}),ym=Pt({prod_:function(b,h,c){h===void 0&&(h=null),c===void 0&&(c=!1);var m=Ze(b,"x","prod");m.dtype==="bool"&&(m=m.toInt());var w=Yt(h,m.shape),R=Ra(w,m.rank),K=w,ee=m;R!=null&&(ee=m.transpose(R),K=Pa(K.length,m.rank));var le=Ve.runKernelFunc(function(_e){return _e.prod(ee,K)},{permutedX:ee});if(c){var de=Fo(le.shape,w);le=le.reshape(de)}return le}}),Hd=Pt({elu_:function(b){var h=Ze(b,"x","elu");return Ve.runKernelFunc(function(c,m){var w=c.elu(h);return m([w]),w},{$x:h},function(c,m){var w=m[0];return{$x:function(){return Ve.runKernelFunc(function(R){return R.eluDer(c,w)},{dy:c,y:w})}}})}}),bm=Pt({leakyRelu_:function(b,h){h===void 0&&(h=.2);var c=Ze(b,"x","leakyRelu");return Ta(kr(h).mul(c),c)}}),ps=Pt({prelu_:function(b,h){var c=Ze(b,"x","prelu"),m=Ze(h,"alpha","prelu");return Ve.runKernelFunc(function(w,R){var K=w.prelu(c,m);return R([c,m]),K},{x:c,alpha:m},function(w,R){var K=R[0],ee=R[1],le=K.greater(0);return{x:function(){return ul(le,w,w.mul(ee))},alpha:function(){var de=ul(le,mi(w),w.mul(K)),_e=Wa(ee.shape,w.shape);return _e.length>0&&(de=de.sum(_e)),de.reshape(ee.shape)}}},"Prelu")}}),xg=Pt({relu_:function(b){var h=Ze(b,"x","relu");return h.dtype==="bool"?h.toInt():Ve.runKernelFunc(function(c,m){var w=c.relu(h);return m([h]),w},{x:h},function(c,m){var w=m[0];return{x:function(){return c.mulStrict(w.step().toFloat())}}},"Relu")}}),b0=Pt({relu6_:function(b){var h=Ze(b,"x","relu6");return h.dtype==="bool"?h.toInt():Ve.runKernelFunc(function(c,m){var w=c.relu6(h);return m([h]),w},{x:h},function(c,m){var w=m[0],R=w.lessEqual(6).mul(w.step());return{x:function(){return c.mulStrict(R.toFloat())}}},"Relu6")}}),xm=Pt({selu_:function(b){var h=Ze(b,"x","selu");return Ve.runKernelFunc(function(c,m){var w=c.selu(h);return m([h]),w},{$x:h},function(c,m){var w=m[0];return{$x:function(){var R=w.greater(kr(0)),K=kr(D1),ee=kr(N1),le=c.mul(ee),de=c.mul(K).mul(w.toFloat().exp());return ul(R,le,de)}}})}}),wm=Pt({localResponseNormalization_:function(b,h,c,m,w){h===void 0&&(h=5),c===void 0&&(c=1),m===void 0&&(m=1),w===void 0&&(w=.5);var R=Ze(b,"x","localResponseNormalization");we(R.rank===4||R.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+R.rank+"."}),we(Ft(h),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+h+"."});var K=R,ee=!1;R.rank===3&&(ee=!0,K=R.as4D(1,R.shape[0],R.shape[1],R.shape[2]));var le=Ve.runKernelFunc(function(de,_e){var Te=de.localResponseNormalization4D(K,h,c,m,w);return _e([K,Te]),Te},{x4D:K},function(de,_e){var Te=_e[0],Ne=_e[1];return{x4D:function(){return Ve.runKernelFunc(function(Fe){return Fe.LRNGrad(de,Te,Ne,h,c,m,w)},{})}}});return ee?le.as3D(le.shape[1],le.shape[2],le.shape[3]):le}}),x0=Pt({norm_:function(b,h,c,m){h===void 0&&(h="euclidean"),c===void 0&&(c=null),m===void 0&&(m=!1);var w=function ee(le,de,_e){if(_e===void 0&&(_e=null),le.rank===0)return le.abs();if(le.rank!==1&&_e===null)return ee(le.reshape([-1]),de,_e);if(le.rank===1||typeof _e=="number"||Array.isArray(_e)&&_e.length===1){if(de===1)return le.abs().sum(_e);if(de===1/0)return le.abs().max(_e);if(de===-1/0)return le.abs().min(_e);if(de==="euclidean"||de===2)return le.abs().pow(kr(2,"int32")).sum(_e).sqrt();throw new Error("Error in norm: invalid ord value: "+de)}if(Array.isArray(_e)&&_e.length===2){if(de===1)return le.abs().sum(_e[0]).max(_e[1]-1);if(de===1/0)return le.abs().sum(_e[1]).max(_e[0]);if(de===-1/0)return le.abs().sum(_e[1]).min(_e[0]);if(de==="fro"||de==="euclidean")return le.square().sum(_e).sqrt();throw new Error("Error in norm: invalid ord value: "+de)}throw new Error("Error in norm: invalid axis: "+_e)}(b=Ze(b,"x","norm"),h,c),R=w.shape;if(m){var K=Yt(c,b.shape);R=Fo(w.shape,K)}return w.reshape(R)}}),Bv=Pt({basicLSTMCell_:function(b,h,c,m,w,R){var K=Ze(b,"forgetBias","basicLSTMCell"),ee=Ze(h,"lstmKernel","basicLSTMCell"),le=Ze(c,"lstmBias","basicLSTMCell"),de=Ze(m,"data","basicLSTMCell"),_e=Ze(w,"c","basicLSTMCell"),Te=Ze(R,"h","basicLSTMCell"),Ne=de.concat(Te,1).matMul(ee).add(le),Fe=Ne.shape[0],He=Ne.shape[1]/4,Ye=[Fe,He],Ke=Ne.slice([0,0],Ye),it=Ne.slice([0,He],Ye),gt=Ne.slice([0,2*He],Ye),wt=Ne.slice([0,3*He],Ye),At=Ke.sigmoid().mulStrict(it.tanh()).addStrict(_e.mulStrict(K.add(gt).sigmoid()));return[At,At.tanh().mulStrict(wt.sigmoid())]}}),Ny=Pt({multiRNNCell_:function(b,h,c,m){for(var w=Ze(h,"data","multiRNNCell"),R=cc(c,"c","multiRNNCell"),K=cc(m,"h","multiRNNCell"),ee=w,le=[],de=0;de<b.length;de++){var _e=b[de](ee,R[de],K[de]);le.push(_e[0]),le.push(_e[1]),ee=_e[1]}var Te=[],Ne=[];for(de=0;de<le.length;de+=2)Te.push(le[de]),Ne.push(le[de+1]);return[Te,Ne]}}),fl=Pt({movingAverage_:function(b,h,c,m,w){w===void 0&&(w=!0);var R=Ze(b,"v","movingAverage"),K=Ze(h,"x","movingAverage"),ee=Ze(c,"decay","movingAverage");hn(R,K),we(Ut(R.shape,K.shape),function(){return"Shape mismatch in v and x"});var le=kr(1),de=le.sub(ee),_e=K.sub(R).mul(de);if(w){we(m!=null,function(){return"When using zeroDebias: true, step is required."});var Te=Ze(m,"step","movingAverage");_e=_e.div(le.sub(su(ee,Te)))}return R.add(_e)}}),Gd=Pt({stridedSlice_:function(b,h,c,m,w,R,K,ee,le){if(w===void 0&&(w=0),R===void 0&&(R=0),K===void 0&&(K=0),ee===void 0&&(ee=0),le===void 0&&(le=0),m==null&&(m=new Array(h.length)),K!==0)throw new Error("ellipsis mask is not yet supported");var de=Ze(b,"x","stridedSlice"),_e=cu(ee),Te=de.shape.slice();_e.forEach(function(Ke){h[Ke]=0,c[Ke]=1,Te.splice(Ke,0,1)}),de=de.reshape(Te);for(var Ne=0;Ne<de.rank;Ne++)h[Ne]=Xu(w,h,m,de.shape,Ne),c[Ne]=_u(R,c,m,de.shape,Ne),m[Ne]=m[Ne]||1;var Fe=cu(le);Fe.forEach(function(Ke){c[Ke]=h[Ke]+1,m[Ke]=1});var He=$u(h,c,m),Ye=He.filter(function(Ke,it){return Fe.indexOf(it)===-1});return m.every(function(Ke){return Ke===1})?hs(de,h,He).reshape(Ye):Ve.runKernelFunc(function(Ke){return Ke.stridedSlice(de,h,c,m)},{$x:de}).reshape(Ye)}}),Iy=Pt({topk_:function(b,h,c){h===void 0&&(h=1),c===void 0&&(c=!0);var m=Ze(b,"x","topk");if(m.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var w=m.shape[m.shape.length-1];if(h>w)throw new Error("'k' passed to topk() must be <= the last dimension ("+w+") but got "+h);var R=Ve.runKernelFunc(function(K){return K.topk(m,h,c)},{$x:m});return{values:R[0],indices:R[1]}}}),jv=Pt({scatterND_:function(b,h,c){var m=Ze(b,"indices","scatterND","int32"),w=Ze(h,"updates","scatterND");return Nl(w,m,c),Ve.runKernelFunc(function(R){return R.scatterND(m,w,c)},{indices:m,updates:w},null,"ScatterNd",{shape:c})}}),dl=Pt({fft_:function(b){we(b.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+b.dtype+"."});var h=b.shape[b.shape.length-1],c=b.size/h,m=b.as2D(c,h);return Ve.runKernelFunc(function(w){return w.fft(m)},{input:b}).reshape(b.shape)}}),rs=Pt({ifft_:function(b){we(b.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+b.dtype+"."});var h=b.shape[b.shape.length-1],c=b.size/h,m=b.as2D(c,h);return Ve.runKernelFunc(function(w){return w.ifft(m)},{input:b}).reshape(b.shape)}}),tp=Pt({rfft_:function(b,h){we(b.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+b.dtype});var c,m=b.shape[b.shape.length-1],w=b.size/m;if(h!=null&&h<m){var R=b.shape.map(function(it){return 0}),K=b.shape.map(function(it){return it});K[b.shape.length-1]=h,c=b.slice(R,K),m=h}else if(h!=null&&h>m){var ee=b.shape.map(function(it){return it});ee[b.shape.length-1]=h-m,c=b.concat(ao(ee),b.shape.length-1),m=h}else c=b;var le=c.zerosLike(),de=_o(c,le).as2D(w,m),_e=dl(de),Te=Math.floor(m/2)+1,Ne=va(_e),Fe=Ya(_e),He=Ne.split([Te,m-Te],Ne.shape.length-1),Ye=Fe.split([Te,m-Te],Fe.shape.length-1),Ke=c.shape.slice();return Ke[c.shape.length-1]=Te,_o(He[0],Ye[0]).reshape(Ke)}}),_m=Pt({irfft_:function(b){var h=b.shape[b.shape.length-1],c=b.size/h;if(h<=2){var m=b.as2D(c,h),w=rs(m);return va(w)}var R=[c,2*(h-1)],K=va(b).as2D(c,h),ee=Ya(b).as2D(c,h),le=K.slice([0,1],[c,h-2]).reverse(1),de=ee.slice([0,1],[c,h-2]).reverse(1).mul(kr(-1)),_e=K.concat(le,1),Te=ee.concat(de,1);return m=_o(_e,Te).as2D(R[0],R[1]),w=rs(m),va(w)}}),wg=Object.freeze({fft:dl,ifft:rs,rfft:tp,irfft:_m}),zv=Pt({sparseToDense_:function(b,h,c,m){m===void 0&&(m=0);var w=Ze(b,"sparseIndices","sparseToDense","int32"),R=Ze(h,"sparseValues","sparseToDense"),K=Ze(m,"defaultValue","sparseToDense",R.dtype);return function(ee,le,de,_e){if(ee.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+ee.dtype+".");if(ee.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+ee.shape+".");var Te=ee.rank>0?ee.shape[0]:1,Ne=ee.rank>1?ee.shape[1]:1;if(de.length!==Ne)throw new Error("outputShape has incorrect number of elements:, "+de.length+", should be: "+Ne+".");var Fe=le.size;if(le.rank!==0&&(le.rank!==1||Fe!==Te))throw new Error("sparseValues has incorrect shape "+le.shape+", should be [] or ["+Te+"]");if(le.dtype!==_e.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(w,R,c,K),Ve.runKernelFunc(function(ee){return ee.sparseToDense(w,R,c,K)},{$sparseIndices:w,$sparseValues:R,$defaultValue:K})}}),_g=Pt({gatherND_:function(b,h){var c=Ze(h,"indices","gatherND","int32"),m=Ze(b,"x","gatherND");return Ve.runKernelFunc(function(w){return w.gatherND(m,c)},{x:m,indices:c},null,"GatherNd")}}),Bf=Pt({diag_:function(b){var h=Ze(b,"x","diag").flatten(),c=b.shape.concat(b.shape);return Ve.runKernelFunc(function(m){return m.diag(h)},{$x:h}).reshape(c)}}),R1=Pt({dropout_:function(b,h,c,m){var w=Ze(b,"x","dropout");if(we(w.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+w.dtype+" tensor instead."}),we(h>=0&&h<1,function(){return"rate must be a float in the range [0, 1), but got "+h+"."}),h===0)return b instanceof $t?w.clone():w;var R=function(le,de){if(de==null)return le.shape.slice();if(Ut(le.shape,de))return de;if(le.shape.length===de.length){for(var _e=[],Te=0;Te<le.shape.length;Te++)de[Te]==null&&le.shape[Te]!=null?_e.push(le.shape[Te]):_e.push(de[Te]);return _e}return de}(w,c),K=1-h,ee=cg(R,0,1,"float32",m).add(K).floor().div(K);return w.mul(ee)}});function Eg(b,h,c){for(var m=1-b%2,w=new Float32Array(b),R=0;R<b;++R){var K=2*Math.PI*R/(b+m-1);w[R]=h-c*Math.cos(K)}return ru(w,"float32")}var Ja,Em=Pt({hannWindow_:function(b){return Eg(b,.5,.5)}}),qd=Pt({hammingWindow_:function(b){return Eg(b,.54,.46)}}),Sg=Pt({frame_:function(b,h,c,m,w){m===void 0&&(m=!1),w===void 0&&(w=0);for(var R=0,K=[];R+h<=b.size;)K.push(hs(b,R,h)),R+=c;if(m)for(;R<b.size;){var ee=R+h-b.size,le=Ho([hs(b,R,h-ee),Is([ee],w)]);K.push(le),R+=c}return K.length===0?xu([],[0,h]):Ho(K).as2D(K.length,h)}}),Sm=Pt({stft_:function(b,h,c,m,w){var R;w===void 0&&(w=Em),m==null&&(R=h,m=Math.floor(Math.pow(2,Math.ceil(Math.log(R)/Math.log(2)))));for(var K=Sg(b,h,c),ee=na(K,w(h)),le=[],de=0;de<K.shape[0];de++)le.push(tp(ee.slice([de,0],[1,h]),m));return Ho(le)}}),w0=Object.freeze({hannWindow:Em,hammingWindow:qd,frame:Sg,stft:Sm}),_0=function(b,h,c){return c===void 0&&(c=1),N(this,void 0,void 0,function(){var m,w,R,K,ee,le,de,_e,Te,Ne,Fe,He,Ye,Ke;return L(this,function(it){switch(it.label){case 0:return m=Ze(b,"predictions","inTopK"),w=Ze(h,"targets","inTopK"),we(m.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+m.rank}),we(m.rank-1===w.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+m.rank+" and targets rank "+w.rank}),bt(m.shape.slice(0,m.shape.length-1),w.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),R=m.shape[m.shape.length-1],we(c>0&&c<=R,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+R+"), but got "+c}),[4,m.data()];case 1:return K=it.sent(),[4,w.data()];case 2:for(ee=it.sent(),le=[K.length/R,R],_e=le[1],Te=Rn("bool",de=le[0]),Ne=0;Ne<de;Ne++){for(Fe=Ne*_e,He=K.subarray(Fe,Fe+_e),Ye=[],Ke=0;Ke<He.length;Ke++)Ye.push({value:He[Ke],index:Ke});for(Ye.sort(function(gt,wt){return wt.value-gt.value}),Te[Ne]=0,Ke=0;Ke<c;Ke++)if(Ye[Ke].index===ee[Ne]){Te[Ne]=1;break}}return b!==m&&m.dispose(),h!==w&&w.dispose(),[2,To(Te,w.shape,"bool")]}})})};(function(b){b[b.NONE=0]="NONE",b[b.MEAN=1]="MEAN",b[b.SUM=2]="SUM",b[b.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Ja||(Ja={}));var jf=Pt({absoluteDifference_:function(b,h,c,m){m===void 0&&(m=Ja.SUM_BY_NONZERO_WEIGHTS);var w=Ze(b,"labels","absoluteDifference"),R=Ze(h,"predictions","absoluteDifference"),K=null;c!=null&&(K=Ze(c,"weights","absoluteDifference")),bt(w.shape,R.shape,"Error in absoluteDifference: ");var ee=w.sub(R).abs();return gc(ee,K,m)}}),gc=Pt({computeWeightedLoss_:function(b,h,c){c===void 0&&(c=Ja.SUM_BY_NONZERO_WEIGHTS);var m=Ze(b,"losses","computeWeightedLoss"),w=null;h!=null&&(w=Ze(h,"weights","computeWeightedLoss"));var R=w==null?m:m.mul(w);if(c===Ja.NONE)return R;if(c===Ja.SUM)return R.sum();if(c===Ja.MEAN){if(w==null)return R.mean();var K=m.size/w.size,ee=R.sum().div(w.sum());return K>1?ee.div(kr(K)):ee}if(c===Ja.SUM_BY_NONZERO_WEIGHTS){if(w==null)return R.sum().div(kr(m.size));var le=w.mul(Du(m.shape)).notEqual(kr(0)).sum().toFloat();return R.sum().div(le)}throw Error("Unknown reduction: "+c)}}),Uv=Pt({cosineDistance_:function(b,h,c,m,w){w===void 0&&(w=Ja.SUM_BY_NONZERO_WEIGHTS);var R=Ze(b,"labels","cosineDistance"),K=Ze(h,"predictions","cosineDistance"),ee=null;m!=null&&(ee=Ze(m,"weights","cosineDistance")),bt(R.shape,K.shape,"Error in cosineDistance: ");var le=kr(1).sub(R.mul(K).sum(c,!0));return gc(le,ee,w)}}),Wv=Pt({hingeLoss_:function(b,h,c,m){m===void 0&&(m=Ja.SUM_BY_NONZERO_WEIGHTS);var w=Ze(b,"labels","hingeLoss"),R=Ze(h,"predictions","hingeLoss"),K=null;c!=null&&(K=Ze(c,"weights","hingeLoss")),bt(w.shape,R.shape,"Error in hingeLoss: ");var ee=kr(1);w=kr(2).mul(w).sub(ee);var le=ee.sub(w.mul(R)).relu();return gc(le,K,m)}}),np=Pt({huberLoss_:function(b,h,c,m,w){m===void 0&&(m=1),w===void 0&&(w=Ja.SUM_BY_NONZERO_WEIGHTS);var R=Ze(b,"labels","huberLoss"),K=Ze(h,"predictions","huberLoss"),ee=null;c!=null&&(ee=Ze(c,"weights","huberLoss")),bt(R.shape,K.shape,"Error in huberLoss: ");var le=kr(m),de=K.sub(R).abs(),_e=Hu(de,le),Te=de.sub(_e),Ne=kr(.5).mul(_e.square()).add(le.mul(Te));return gc(Ne,ee,w)}}),km=Pt({logLoss_:function(b,h,c,m,w){m===void 0&&(m=1e-7),w===void 0&&(w=Ja.SUM_BY_NONZERO_WEIGHTS);var R=Ze(b,"labels","logLoss"),K=Ze(h,"predictions","logLoss"),ee=null;c!=null&&(ee=Ze(c,"weights","logLoss")),bt(R.shape,K.shape,"Error in logLoss: ");var le=kr(1),de=kr(m),_e=R.mul(K.add(de).log()).neg().sub(le.sub(R).mul(le.sub(K).add(de).log()));return gc(_e,ee,w)}}),Fy=Pt({meanSquaredError_:function(b,h,c,m){m===void 0&&(m=Ja.SUM_BY_NONZERO_WEIGHTS);var w=Ze(b,"labels","meanSquaredError"),R=Ze(h,"predictions","meanSquaredError"),K=null;c!=null&&(K=Ze(c,"weights","meanSquaredError")),bt(w.shape,R.shape,"Error in meanSquaredError: ");var ee=w.squaredDifference(R);return gc(ee,K,m)}}),E0=Pt({sigmoidCrossEntropy_:function(b,h,c,m,w){m===void 0&&(m=0),w===void 0&&(w=Ja.SUM_BY_NONZERO_WEIGHTS);var R=Ze(b,"multiClassLabels","sigmoidCrossEntropy"),K=Ze(h,"logits","sigmoidCrossEntropy"),ee=null;if(c!=null&&(ee=Ze(c,"weights","sigmoidCrossEntropy")),bt(R.shape,K.shape,"Error in sigmoidCrossEntropy: "),m>0){var le=kr(m),de=kr(1),_e=kr(.5);R=R.mul(de.sub(le)).add(_e.mul(le))}var Te=function(Ne,Fe){var He=Ze(Ne,"labels","sigmoidCrossEntropyWithLogits"),Ye=Ze(Fe,"logits","sigmoidCrossEntropyWithLogits");bt(He.shape,Ye.shape,"Error in sigmoidCrossEntropyWithLogits: ");var Ke=Ye.relu(),it=Ye.mul(He),gt=Ye.abs().neg().exp().log1p();return Ke.sub(it).add(gt)}(R,K);return gc(Te,ee,w)}}),kg=Pt({softmaxCrossEntropy_:function(b,h,c,m,w){m===void 0&&(m=0),w===void 0&&(w=Ja.SUM_BY_NONZERO_WEIGHTS);var R=Ze(b,"onehotLabels","softmaxCrossEntropy"),K=Ze(h,"logits","softmaxCrossEntropy"),ee=null;if(c!=null&&(ee=Ze(c,"weights","softmaxCrossEntropy")),bt(R.shape,K.shape,"Error in softmaxCrossEntropy: "),m>0){var le=kr(m),de=kr(1),_e=kr(R.shape[1]);R=R.mul(de.sub(le)).add(le.div(_e))}var Te=function(Ne,Fe,He){if(He===void 0&&(He=-1),He===-1&&(He=Fe.rank-1),He!==Fe.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+Fe.rank+" and dim was "+He);return H(function(Ye,Ke,it){var gt=Ke.logSumExp([He],!0),wt=Ke.toFloat().sub(gt);return it([Ye,wt]),{value:wt.mul(Ye).neg().sum([He]),gradFunc:function(At,zt){var an=zt[0],dn=zt[1],sn=Fo(At.shape,[He]);return[At.reshape(sn).mul(an.toFloat().sub(dn.exp())),At.reshape(sn).mul(dn.exp().sub(an.toFloat()))]}}})(Ne,Fe)}(R,K);return gc(Te,ee,w)}}),$r=Object.freeze({get Reduction(){return Ja},absoluteDifference:jf,computeWeightedLoss:gc,cosineDistance:Uv,hingeLoss:Wv,huberLoss:np,logLoss:km,meanSquaredError:Fy,sigmoidCrossEntropy:E0,softmaxCrossEntropy:kg});function $(b,h){return h===void 0&&(h=!1),Ve.tidy(function(){if(b.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+b.shape.length+"D Tensor.");for(var c=b.shape[0],m=b.shape[1],w=cl(c),R=b.clone(),K=xu([[1]],[1,1]),ee=K.clone(),le=c>=m?m:c,de=function(Te){var Ne,Fe=R,He=ee,Ye=w;Ne=Ve.tidy(function(){var Ke=R.slice([Te,Te],[c-Te,1]),it=Ke.norm(),gt=R.slice([Te,Te],[1,1]),wt=xu([[-1]]).where(gt.greater(0),xu([[1]])),At=gt.sub(wt.mul(it)),zt=Ke.div(At);ee=zt.shape[0]===1?K.clone():K.concat(zt.slice([1,0],[zt.shape[0]-1,zt.shape[1]]),0);var an=wt.matMul(At).div(it).neg(),dn=R.slice([Te,0],[c-Te,m]),sn=an.mul(ee),ln=ee.transpose();if(Te===0)R=dn.sub(sn.matMul(ln.matMul(dn)));else{var Tn=dn.sub(sn.matMul(ln.matMul(dn)));R=R.slice([0,0],[Te,m]).concat(Tn,0)}var Bn=sn.transpose(),In=w.slice([0,Te],[c,w.shape[1]-Te]);if(Te===0)w=In.sub(In.matMul(ee).matMul(Bn));else{var or=In.sub(In.matMul(ee).matMul(Bn));w=w.slice([0,0],[c,Te]).concat(or,1)}return[ee,R,w]}),ee=Ne[0],R=Ne[1],w=Ne[2],Lo([Fe,He,Ye])},_e=0;_e<le;++_e)de(_e);return!h&&c>m&&(w=w.slice([0,0],[c,m]),R=R.slice([0,0],[m,m])),[w,R]})}var M=Pt({bandPart_:function(b,h,c){if(h%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+h+".");if(c%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+c+".");var m=Ze(b,"a","bandPart");if(m.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+m.rank+".");var w=m.shape,R=m.shape.slice(-2),K=R[0],ee=R[1];if(!(h<=K))throw new Error("bandPart(): numLower ("+h+") must not be greater than the number of rows ("+K+").");if(!(c<=ee))throw new Error("bandPart(): numUpper ("+c+") must not be greater than the number of columns ("+ee+").");h<0&&(h=K),c<0&&(c=ee);var le=Dc(0,K,1,"int32").reshape([-1,1]),de=Dc(0,ee,1,"int32"),_e=Ba(le,de),Te=Zu(_e.lessEqual(kr(+h,"int32")),_e.greaterEqual(kr(-c,"int32"))),Ne=ao([K,ee],m.dtype);return wu(Nh(m.reshape([-1,K,ee])).map(function(Fe){return ul(Te,Fe,Ne)})).reshape(w)}}),T=Pt({gramSchmidt_:function(b){var h;if(Array.isArray(b)){h=!1,we(b!=null&&b.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var c=b[0].shape[0],m=function(le){we(b[le].shape[0]===c,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+b[le].shape[0]+" vs. "+c+")"})},w=1;w<b.length;++w)m(w)}else h=!0,b=Gi(b,b.shape[0],0).map(function(le){return qs(le,[0])});we(b.length<=b[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+b.length+") exceeds number of dimensions ("+b[0].shape[0]+")."});var R=[],K=b,ee=function(le){R.push(Ve.tidy(function(){var de=K[le];if(le>0)for(var _e=0;_e<le;++_e){var Te=ql(R[_e].mulStrict(de)).mul(R[_e]);de=de.sub(Te)}return de.div(x0(de,"euclidean"))}))};for(w=0;w<b.length;++w)ee(w);return h?wu(R,0):R}}),A=Pt({qr_:function(b,h){if(h===void 0&&(h=!1),b.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+b.rank);if(b.rank===2)return $(b,h);var c=b.shape.slice(0,b.shape.length-2).reduce(function(R,K){return R*K}),m=[],w=[];return Nh(b.reshape([c,b.shape[b.shape.length-2],b.shape[b.shape.length-1]]),0).forEach(function(R){var K=$(R,h),ee=K[0],le=K[1];m.push(ee),w.push(le)}),[wu(m,0).reshape(b.shape),wu(w,0).reshape(b.shape)]}}),P=Object.freeze({bandPart:M,gramSchmidt:T,qr:A});function J(b,h,c,m,w,R){m==null&&(m=.5),w==null&&(w=Number.NEGATIVE_INFINITY),R==null&&(R=0);var K=b.shape[0];return c=Math.min(c,K),we(0<=m&&m<=1,function(){return"iouThreshold must be in [0, 1], but was '"+m+"'"}),we(b.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+b.rank+"'"}),we(b.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+b.shape[1]}),we(h.rank===1,function(){return"scores must be a 1D tensor"}),we(h.shape[0]===K,function(){return"scores has incompatible shape with boxes. Expected "+K+", but was "+h.shape[0]}),we(0<=R&&R<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+R+"'"}),{maxOutputSize:c,iouThreshold:m,scoreThreshold:w,softNmsSigma:R}}var ie=Pt({resizeBilinear_:function(b,h,c){c===void 0&&(c=!1);var m=Ze(b,"images","resizeBilinear");we(m.rank===3||m.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+m.rank+"."}),we(h.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+h+"."});var w=m,R=!1;m.rank===3&&(R=!0,w=m.as4D(1,m.shape[0],m.shape[1],m.shape[2]));var K=h[0],ee=h[1],le=Ve.runKernelFunc(function(de,_e){return _e([w]),de.resizeBilinear(w,K,ee,c)},{x:w},function(de,_e){return{x:function(){return Ve.runKernelFunc(function(Te){return Te.resizeBilinearBackprop(de,_e[0],c)},{})}}},"ResizeBilinear",{alignCorners:c,newHeight:K,newWidth:ee});return R?le.as3D(le.shape[1],le.shape[2],le.shape[3]):le}}),pe=Pt({resizeNearestNeighbor_:function(b,h,c){c===void 0&&(c=!1);var m=Ze(b,"images","resizeNearestNeighbor");we(m.rank===3||m.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+m.rank+"."}),we(h.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+h+"."}),we(m.dtype==="float32"||m.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var w=m,R=!1;m.rank===3&&(R=!0,w=m.as4D(1,m.shape[0],m.shape[1],m.shape[2]));var K=h[0],ee=h[1],le=Ve.runKernelFunc(function(de,_e){return _e([w]),de.resizeNearestNeighbor(w,K,ee,c)},{batchImages:w},function(de,_e){return{batchImages:function(){return Ve.runKernelFunc(function(Te){return Te.resizeNearestNeighborBackprop(de,_e[0],c)},{})}}});return R?le.as3D(le.shape[1],le.shape[2],le.shape[3]):le}}),Ae=Pt({nonMaxSuppression_:function(b,h,c,m,w){m===void 0&&(m=.5),w===void 0&&(w=Number.NEGATIVE_INFINITY);var R=Ze(b,"boxes","nonMaxSuppression"),K=Ze(h,"scores","nonMaxSuppression"),ee=J(R,K,c,m,w);c=ee.maxOutputSize,m=ee.iouThreshold,w=ee.scoreThreshold;var le={maxOutputSize:c,iouThreshold:m,scoreThreshold:w};return Ve.runKernelFunc(function(de){return de.nonMaxSuppression(R,K,c,m,w)},{boxes:R,scores:K},null,"NonMaxSuppressionV3",le)}}),Ie=Pt({nonMaxSuppressionWithScore_:function(b,h,c,m,w,R){m===void 0&&(m=.5),w===void 0&&(w=Number.NEGATIVE_INFINITY),R===void 0&&(R=0);var K=Ze(b,"boxes","nonMaxSuppression"),ee=Ze(h,"scores","nonMaxSuppression"),le=J(K,ee,c,m,w,R),de={maxOutputSize:c=le.maxOutputSize,iouThreshold:m=le.iouThreshold,scoreThreshold:w=le.scoreThreshold,softNmsSigma:R=le.softNmsSigma},_e=Ve.runKernel("NonMaxSuppressionV5",{boxes:K,scores:ee},de);return{selectedIndices:_e[0],selectedScores:_e[1]}}}),De=Pt({cropAndResize_:function(b,h,c,m,w,R){var K=Ze(b,"image","cropAndResize"),ee=Ze(h,"boxes","cropAndResize","float32"),le=Ze(c,"boxInd","cropAndResize","int32");w=w||"bilinear",R=R||0;var de=ee.shape[0];return we(K.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+K.rank+"."}),we(ee.rank===2&&ee.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+de+",4] but had shape "+ee.shape+"."}),we(le.rank===1&&le.shape[0]===de,function(){return"Error in cropAndResize: boxInd must be have size ["+de+"] but had shape "+ee.shape+"."}),we(m.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+m.length+"."}),we(m[0]>=1&&m[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+m}),we(w==="bilinear"||w==="nearest",function(){return"method must be bilinear or nearest, but was "+w}),Ve.runKernelFunc(function(_e,Te){return _e.cropAndResize(K,ee,le,m,w,R)},{images:K,boxes:ee,boxInd:le},null,"CropAndResize",{method:w,extrapolationValue:R,cropSize:m})}}),et=Object.freeze({resizeBilinear:ie,resizeNearestNeighbor:pe,nonMaxSuppression:Ae,nonMaxSuppressionAsync:function(b,h,c,m,w){return m===void 0&&(m=.5),w===void 0&&(w=Number.NEGATIVE_INFINITY),N(this,void 0,void 0,function(){var R,K,ee,le,de,_e,Te;return L(this,function(Ne){switch(Ne.label){case 0:return R=Ze(b,"boxes","nonMaxSuppressionAsync"),K=Ze(h,"scores","nonMaxSuppressionAsync"),ee=J(R,K,c,m,w),c=ee.maxOutputSize,m=ee.iouThreshold,w=ee.scoreThreshold,[4,Promise.all([R.data(),K.data()])];case 1:return le=Ne.sent(),de=le[0],_e=le[1],Te=fa(de,_e,c,m,w),R!==b&&R.dispose(),K!==h&&K.dispose(),[2,Te]}})})},nonMaxSuppressionWithScore:Ie,nonMaxSuppressionWithScoreAsync:function(b,h,c,m,w,R){return m===void 0&&(m=.5),w===void 0&&(w=Number.NEGATIVE_INFINITY),R===void 0&&(R=0),N(this,void 0,void 0,function(){var K,ee,le,de,_e,Te,Ne;return L(this,function(Fe){switch(Fe.label){case 0:return K=Ze(b,"boxes","nonMaxSuppressionAsync"),ee=Ze(h,"scores","nonMaxSuppressionAsync"),le=J(K,ee,c,m,w,R),c=le.maxOutputSize,m=le.iouThreshold,w=le.scoreThreshold,R=le.softNmsSigma,[4,Promise.all([K.data(),ee.data()])];case 1:return de=Fe.sent(),_e=de[0],Te=de[1],Ne=Wo(_e,Te,c,m,w,R),K!==b&&K.dispose(),ee!==h&&ee.dispose(),[2,Ne]}})})},cropAndResize:De}),ot=function(b,h){return!(b>0)||h==="linear"},Bt=function(b,h,c){if(c==null||c==="linear")return b;if(c==="relu")return b.mul(h.step());throw new Error("Gradient for activation "+c+" has not been implemented yet.")},Vt=function(b,h){var c=h,m=Wa(b.shape,h.shape);return m.length>0&&(c=c.sum(m)),c.reshape(b.shape)},yn=function(b,h,c){if(h==="linear")return b;if(h==="relu")return xg(b);if(h==="elu")return Hd(b);if(h==="relu6")return b0(b);if(h==="prelu")return ps(b,c);throw new Error("Unknown fused activation "+h+".")},_n=Pt({fusedMatMul_:function(b){var h,c=b.a,m=b.b,w=b.transposeA,R=w!==void 0&&w,K=b.transposeB,ee=K!==void 0&&K,le=b.bias,de=b.activation,_e=de===void 0?"linear":de,Te=b.preluActivationWeights;if(ot(Ve.state.gradientDepth,_e)===!1){var Ne=jc(c,m,R,ee);return le!=null&&(Ne=la(Ne,le)),yn(Ne,_e,Te)}var Fe=Ze(c,"a","fused matMul"),He=Ze(m,"b","fused matMul");h=Kt(Fe,He),Fe=h[0],He=h[1];var Ye=R?Fe.shape[Fe.rank-2]:Fe.shape[Fe.rank-1],Ke=ee?He.shape[He.rank-1]:He.shape[He.rank-2],it=R?Fe.shape[Fe.rank-1]:Fe.shape[Fe.rank-2],gt=ee?He.shape[He.rank-2]:He.shape[He.rank-1],wt=Fe.shape.slice(0,-2),At=He.shape.slice(0,-2),zt=ze(wt),an=ze(At);we(Fe.rank>=2&&He.rank>=2&&Fe.rank===He.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+Fe.rank+" and "+He.rank+"."}),we(Ut(wt,At),function(){return"Error in fused matMul: outer dimensions ("+wt+") and ("+At+") of Tensors with shapes "+Fe.shape+" and "+He.shape+" must match."}),we(Ye===Ke,function(){return"Error in fused matMul: inner shapes ("+Ye+") and ("+Ke+") of Tensors with shapes "+Fe.shape+" and "+He.shape+" and transposeA="+R+" and transposeB="+ee+" must match."});var dn,sn,ln=Fe.shape.slice(0,-2).concat([it,gt]),Tn=R?Fe.as3D(zt,Ye,it):Fe.as3D(zt,it,Ye),Bn=ee?He.as3D(an,gt,Ke):He.as3D(an,Ke,gt);le!=null&&qi(ln,(dn=Kt(dn=Ze(le,"bias","fused matMul"),Fe)[0]).shape),Te!=null&&(sn=Ze(Te,"prelu weights","fused matMul"));var In={a:Tn,b:Bn};le!=null&&(In.bias=dn),Te!=null&&(In.preluActivationWeights=sn);var or=[Tn,Bn];return Ve.runKernelFunc(function(fr,br){var _r=fr.fusedBatchMatMul({a:Tn,b:Bn,transposeA:R,transposeB:ee,bias:dn,activation:_e,preluActivationWeights:sn});return br([Tn,Bn,_r]),_r},In,function(fr,br){var _r=br[0],xr=br[1],vr=br[2],Pr=Bt(fr,vr,_e),Rr={};return le!=null&&(Rr={bias:function(){return Vt(dn,Pr)}}),Object.assign(R||ee?!R&&ee?{a:function(){return Pr.matMul(xr,!1,!1)},b:function(){return Pr.matMul(_r,!0,!1)}}:R&&!ee?{a:function(){return xr.matMul(Pr,!1,!0)},b:function(){return _r.matMul(Pr,!1,!1)}}:{a:function(){return xr.matMul(Pr,!0,!0)},b:function(){return Pr.matMul(_r,!0,!0)}}:{a:function(){return Pr.matMul(xr,!1,!0)},b:function(){return _r.matMul(Pr,!0,!1)}},Rr)},"_FusedMatMul",{transposeA:R,transposeB:ee,activation:_e},or,[!0]).reshape(ln)}}),Dn=Pt({fusedConv2d_:function(b){var h=b.x,c=b.filter,m=b.strides,w=b.pad,R=b.dataFormat,K=R===void 0?"NHWC":R,ee=b.dilations,le=ee===void 0?[1,1]:ee,de=b.dimRoundingMode,_e=b.bias,Te=b.activation,Ne=Te===void 0?"linear":Te,Fe=b.preluActivationWeights;if(Ne=Ne||"linear",ot(Ve.state.gradientDepth,Ne)===!1){var He=Ud(h,c,m,w,K,le,de);return _e!=null&&(He=la(He,_e)),yn(He,Ne,Fe)}var Ye=Ze(h,"x","conv2d"),Ke=Ze(c,"filter","conv2d"),it=Ye,gt=!1;Ye.rank===3&&(gt=!0,it=Ye.as4D(1,Ye.shape[0],Ye.shape[1],Ye.shape[2])),we(it.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+it.rank+"."}),we(Ke.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+Ke.rank+"."}),de!=null&&we(Ft(w),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+de+" but got pad "+w+"."}),we(it.shape[3]===Ke.shape[2],function(){return"Error in conv2d: depth of input ("+it.shape[3]+") must match input depth for filter "+Ke.shape[2]+"."}),we(Ir(m,le),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+le+"'"}),we(K==="NHWC",function(){return"Error in conv2d: got dataFormat of "+K+" but only NHWC is currently supported."});var wt,At,zt=Hn(it.shape,Ke.shape,m,le,w,de);_e!=null&&(wt=Kt(wt=Ze(_e,"bias","fused conv2d"),Ye)[0],qi(zt.outShape,wt.shape)),Fe!=null&&(At=Ze(Fe,"prelu weights","fused conv2d"));var an={x:it,filter:Ke};_e!=null&&(an.bias=wt),Fe!=null&&(an.preluActivationWeights=At);var dn=[Ke,it],sn=Ve.runKernelFunc(function(ln,Tn){var Bn=ln.fusedConv2d({input:it,filter:Ke,convInfo:zt,bias:wt,activation:Ne,preluActivationWeights:At});return Tn([Ke,it,Bn]),Bn},an,function(ln,Tn){var Bn=Tn,In=Bn[0],or=Bn[1],fr=Bn[2],br=Bt(ln,fr,Ne);we(ii(le),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+le+"'"});var _r={};return _e!=null&&(_r={bias:function(){return Vt(wt,br)}}),Object.assign({x:function(){return Vl(or.shape,br,In,m,w)},filter:function(){return Tv(or,br,In.shape,m,w)}},_r)},"FusedConv2D",{convInfo:zt,activation:Ne},dn,[!0]);return gt?sn.as3D(sn.shape[1],sn.shape[2],sn.shape[3]):sn}}),Nn=Pt({fusedDepthwiseConv2d_:function(b){var h=b.x,c=b.filter,m=b.strides,w=b.pad,R=b.dataFormat,K=R===void 0?"NHWC":R,ee=b.dilations,le=ee===void 0?[1,1]:ee,de=b.dimRoundingMode,_e=b.bias,Te=b.activation,Ne=Te===void 0?"linear":Te,Fe=b.preluActivationWeights;if(ot(Ve.state.gradientDepth,Ne)===!1){var He=p0(h,c,m,w,K,le,de);return _e!=null&&(He=la(He,_e)),yn(He,Ne,Fe)}var Ye=Ze(h,"x","depthwiseConv2d"),Ke=Ze(c,"filter","depthwiseConv2d"),it=Ye,gt=!1;Ye.rank===3&&(gt=!0,it=Ye.as4D(1,Ye.shape[0],Ye.shape[1],Ye.shape[2])),we(it.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+it.rank+"."}),we(Ke.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+Ke.rank+"."}),we(it.shape[3]===Ke.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+it.shape[3]+") must match the inChannels dimension in filter "+Ke.shape[2]+"."}),le==null&&(le=[1,1]),we(Ir(m,le),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+le+"'"}),de!=null&&we(Ft(w),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+de+" but got pad "+w+"."});var wt,At,zt=Hn(it.shape,Ke.shape,m,le,w,de,!0);_e!=null&&(wt=Kt(wt=Ze(_e,"bias","fused conv2d"),Ye)[0],qi(zt.outShape,wt.shape)),Fe!=null&&(At=Ze(Fe,"prelu weights","fused depthwiseConv2d"));var an={x:it,filter:Ke};_e!=null&&(an.bias=wt),Fe!=null&&(an.preluActivationWeights=At);var dn=[Ke,it],sn=Ve.runKernelFunc(function(ln,Tn){var Bn=ln.fusedDepthwiseConv2D({input:it,filter:Ke,convInfo:zt,bias:wt,activation:Ne,preluActivationWeights:At});return Tn([Ke,it,Bn]),Bn},an,function(ln,Tn){we(ii(le),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+le+"'"});var Bn=Tn[0],In=Tn[1],or=Tn[2],fr=Bt(ln,or,Ne),br={};return _e!=null&&(br={bias:function(){return Vt(wt,fr)}}),Object.assign({x:function(){return Mv(In.shape,fr,Bn,zt)},filter:function(){return Wd(In,fr,Bn.shape,zt)}},br)},"FusedDepthwiseConv2D",{convInfo:zt,activation:Ne},dn,[!0]);return gt?sn.as3D(sn.shape[1],sn.shape[2],sn.shape[3]):sn}}),Wn=Object.freeze({matMul:_n,conv2d:Dn,depthwiseConv2d:Nn}),Jn=Object.freeze({image:et,linalg:P,losses:$r,spectral:wg,fused:Wn,signal:w0,add:la,addN:Nd,batchNorm:Tf,batchNormalization:po,batchNorm2d:Oy,batchNormalization2d:Ay,batchNorm3d:zl,batchNormalization3d:Mf,batchNorm4d:Rd,batchNormalization4d:$h,broadcastTo:Df,clone:Nf,div:ra,divNoNan:ig,eye:cl,multinomial:ds,oneHot:Lc,pad:ec,pad1d:Nu,pad2d:Kh,pad3d:og,pad4d:u0,rand:c0,randomGamma:ug,randomNormal:xv,randomUniform:cg,square:If,squaredDifference:lg,tile:Bd,truncatedNormal:Yh,conv1d:Ov,conv2d:Ud,conv3d:My,depthwiseConv2d:p0,separableConv2d:Hl,conv2dTranspose:pg,conv3dTranspose:m0,op:Pt,booleanMaskAsync:kv,complex:_o,real:va,imag:Ya,concat:Ho,concat1d:Mh,concat2d:Hp,concat3d:ff,concat4d:Dh,split:Gi,matMul:jc,dot:g0,outerProduct:Dv,reverse:Rf,reverse1d:Dy,reverse2d:Jh,reverse3d:Qh,reverse4d:Pf,maxPool:zc,avgPool:Zh,pool:gm,maxPool3d:mg,avgPool3d:v0,maxPoolWithArgmax:Iv,slice:hs,slice1d:Fv,slice2d:ep,slice3d:Rv,slice4d:gg,abs:Rs,acos:nl,acosh:Va,asin:rl,asinh:fc,atan:bd,atanh:xd,ceil:Ml,clipByValue:Kp,cos:dc,cosh:Kg,erf:Yp,exp:yf,expm1:Zm,floor:wd,log:Dl,log1p:Jp,logSigmoid:Lh,neg:Oa,reciprocal:bf,round:Ps,rsqrt:xf,sigmoid:_d,sign:Bh,isNaN:Qp,isInf:Ed,isFinite:wf,sin:Zp,sinh:em,softplus:vn,sqrt:ou,step:tr,tan:Ls,tanh:mo,all:vm,any:Gl,argMax:Pv,argMin:vg,logSumExp:yg,max:y0,mean:ll,min:bg,moments:Lv,sum:ql,prod:ym,equal:fg,equalStrict:l0,greater:f0,greaterEqual:hm,greaterEqualStrict:d0,greaterStrict:dg,less:wv,lessEqual:Wl,lessEqualStrict:Ty,lessStrict:_v,notEqual:pm,notEqualStrict:Ev,addStrict:_f,atan2:Sd,divStrict:mr,floorDiv:ts,maximum:Ta,maximumStrict:no,minimum:Hu,minimumStrict:Nc,mod:au,modStrict:Ic,mul:na,mulStrict:hc,pow:su,powStrict:vo,squaredDifferenceStrict:ws,sub:Ba,subStrict:_s,elu:Hd,leakyRelu:bm,prelu:ps,relu:xg,relu6:b0,selu:xm,logicalAnd:Zu,logicalNot:Xh,logicalOr:Pd,logicalXor:Ul,where:ul,whereAsync:Ld,buffer:Di,print:da,batchToSpaceND:Gp,cast:qp,cumsum:$p,depthToSpace:Jm,expandDims:lc,reshape:Fs,spaceToBatchND:Al,squeeze:qs,stack:wu,unstack:Nh,setdiff1dAsync:Wi,fill:Is,linspace:Th,ones:Du,range:Dc,scalar:kr,tensor:To,tensor1d:ru,tensor2d:xu,tensor3d:Cl,tensor4d:iu,tensor5d:Oh,tensor6d:Wp,variable:Vp,zeros:ao,onesLike:xs,zerosLike:mi,transpose:vt,softmax:je,logSoftmax:Je,localResponseNormalization:wm,norm:x0,gather:mm,unsortedSegmentSum:hg,basicLSTMCell:Bv,multiRNNCell:Ny,movingAverage:fl,stridedSlice:Gd,topk:Iy,scatterND:jv,fft:dl,ifft:rs,rfft:tp,irfft:_m,sparseToDense:zv,gatherND:_g,diag:Bf,dropout:R1,hannWindow:Em,hammingWindow:qd,frame:Sg,stft:Sm,inTopKAsync:_0});function Cn(b,h){Array.isArray(b)||(b=[b]),b.forEach(function(c){c!=null&&we(c.dtype!=="complex64",function(){return h+" does not support complex64 tensors."})})}function wr(b,h,c,m,w,R){for(var K=w.strideHeight,ee=w.strideWidth,le=w.dilationHeight,de=w.dilationWidth,_e=w.effectiveFilterHeight,Te=w.effectiveFilterWidth,Ne=w.padInfo.top,Fe=w.padInfo.left,He=R==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,Ye=Di(w.outShape,c),Ke=Ye.values,it=w.outShape[1]*w.outShape[2]*w.outShape[3],gt=w.outShape[2]*w.outShape[3],wt=w.outShape[3],At=0;At<w.batchSize;++At)for(var zt=At*it,an=At*m[0],dn=0;dn<w.inChannels;++dn)for(var sn=0;sn<w.outHeight;++sn)for(var ln=sn*K-Ne,Tn=Math.max(0,ln),Bn=Math.min(w.inHeight,_e+ln),In=zt+sn*gt,or=0;or<w.outWidth;++or){for(var fr=or*ee-Fe,br=Math.max(0,fr),_r=Math.min(w.inWidth,Te+fr),xr=He,vr=0,Pr=0,Rr=Tn;Rr<Bn;Rr+=le){for(var Qr=an+Rr*m[1],fi=br;fi<_r;fi+=de){var Ci=b[Qr+fi*m[2]+dn];R==="max"&&Ci>xr?xr=Ci:R==="avg"&&(vr+=Ci,Pr++)}if(isNaN(xr))break}Ke[In+or*wt+dn]=R==="avg"?vr/Pr:xr}return Ye}function Dr(b,h,c,m,w,R){w===void 0&&(w=!1),R===void 0&&(R=!1);for(var K=Di(m.outShape,"int32"),ee=m.strideHeight,le=m.strideWidth,de=m.dilationHeight,_e=m.dilationWidth,Te=m.effectiveFilterHeight,Ne=m.effectiveFilterWidth,Fe=m.padInfo.top,He=m.padInfo.left,Ye=Di(h,c,b),Ke=0;Ke<m.batchSize;++Ke)for(var it=0;it<m.inChannels;++it)for(var gt=0;gt<m.outHeight;++gt){for(var wt=gt*ee-Fe,At=wt;At<0;)At+=de;for(var zt=Math.min(m.inHeight,Te+wt),an=0;an<m.outWidth;++an){for(var dn=an*le-He,sn=dn;sn<0;)sn+=_e;for(var ln=Math.min(m.inWidth,Ne+dn),Tn=Number.NEGATIVE_INFINITY,Bn=-1,In=At;In<zt;In+=de)for(var or=In-wt,fr=sn;fr<ln;fr+=_e){var br=fr-dn,_r=Ye.get(Ke,In,fr,it);_r>Tn&&(Tn=_r,Bn=w?R?((Ke*m.inHeight+In)*m.inWidth+fr)*m.inChannels+it:(In*m.inWidth+fr)*m.inChannels+it:or*Ne+br)}K.set(Bn,Ke,gt,an,it)}}return K}function Nr(b,h,c,m){if(c==="linear")return b.linear(h);if(c==="relu")return b.relu(h);if(c==="elu")return b.elu(h);if(c==="relu6")return b.relu6(h);if(c==="prelu")return b.prelu(h,m);throw new Error("Activation "+c+" has not been implemented for the CPU backend.")}var Yr=function(b){function h(){var c=b.call(this)||this;return c.blockSize=48,c.firstUse=!0,c.data=new Gt(c,Ve),c}return j(h,b),h.prototype.write=function(c,m,w){this.firstUse&&(this.firstUse=!1,z().get("IS_NODE")&&kl(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var R={};return this.data.set(R,{values:c,dtype:w}),R},h.prototype.move=function(c,m,w,R){this.data.set(c,{values:m,dtype:R})},h.prototype.numDataIds=function(){return this.data.numDataIds()},h.prototype.read=function(c){return N(this,void 0,void 0,function(){return L(this,function(m){return[2,this.readSync(c)]})})},h.prototype.readSync=function(c){var m=this.data.get(c),w=m.dtype,R=m.complexTensors;return w==="complex64"?pi(this.readSync(R.real.dataId),this.readSync(R.imag.dataId)):this.data.get(c).values},h.prototype.bufferSync=function(c){var m=this.readSync(c.dataId),w=m;if(c.dtype==="string")try{w=m.map(function(R){return Un(R)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Di(c.shape,c.dtype,w)},h.prototype.makeOutput=function(c,m,w){var R=this.write(c,m,w);return Ve.makeTensorFromDataId(R,m,w,this)},h.prototype.disposeData=function(c){if(this.data.has(c)){var m=this.data.get(c).complexTensors;m!=null&&(m.real.dispose(),m.imag.dispose()),this.data.delete(c)}},h.prototype.time=function(c){return N(this,void 0,void 0,function(){var m;return L(this,function(w){return m=Zt(),c(),[2,{kernelMs:Zt()-m}]})})},h.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},h.prototype.complex=function(c,m){var w=this.makeOutput(null,c.shape,"complex64");return this.data.get(w.dataId).complexTensors={real:Ve.keep(c.clone()),imag:Ve.keep(m.clone())},w},h.prototype.real=function(c){return this.data.get(c.dataId).complexTensors.real.clone()},h.prototype.imag=function(c){return this.data.get(c.dataId).complexTensors.imag.clone()},h.prototype.slice=function(c,m,w){if(Cn(c,"slice"),zh(c.shape,m,w)){var R=kd(m,c.strides),K=ze(w);return To(this.readSync(c.dataId).subarray(R,R+K),w,c.dtype)}for(var ee=Di(w,c.dtype),le=this.bufferSync(c),de=0;de<ee.size;++de){var _e=ee.indexToLoc(de).map(function(Te,Ne){return Te+m[Ne]});ee.values[de]=le.get.apply(le,_e)}return ee.toTensor()},h.prototype.stridedSlice=function(c,m,w,R){Cn(c,"stridedSlice");var K=$u(m,w,R);if(K.some(function(Fe){return Fe===0}))return To([],K);for(var ee=Di(K,c.dtype),le=this.bufferSync(c),de=0;de<ee.size;de++){for(var _e=ee.indexToLoc(de),Te=new Array(_e.length),Ne=0;Ne<Te.length;Ne++)Te[Ne]=_e[Ne]*R[Ne]+m[Ne];ee.set.apply(ee,[le.get.apply(le,Te)].concat(_e))}return ee.toTensor()},h.prototype.diag=function(c){for(var m=this.readSync(c.dataId),w=Di([c.size,c.size],c.dtype),R=w.values,K=0;K<m.length;K++)R[K*c.size+K]=m[K];return w.toTensor()},h.prototype.unstack=function(c,m){for(var w=c.shape[m],R=new Array(c.rank-1),K=0,ee=0;ee<c.rank;ee++)ee!==m&&(R[K++]=c.shape[ee]);var le=new Array(c.rank).fill(0),de=c.shape.slice();de[m]=1;var _e=new Array(w);for(ee=0;ee<_e.length;ee++)le[m]=ee,_e[ee]=this.slice(c,le,de).reshape(R);return _e},h.prototype.reverse=function(c,m){Cn(c,"reverse");for(var w=Di(c.shape,c.dtype),R=this.bufferSync(c),K=function(le){var de=w.indexToLoc(le),_e=de.slice();m.forEach(function(Te){return _e[Te]=c.shape[Te]-1-_e[Te]}),w.set.apply(w,[R.get.apply(R,_e)].concat(de))},ee=0;ee<w.size;ee++)K(ee);return w.toTensor()},h.prototype.concat=function(c,m){var w=this;if(c[0].dtype==="complex64"){var R=c.map(function(Fe){return va(Fe)}),K=c.map(function(Fe){return Ya(Fe)});return _o(this.concat(R,m),this.concat(K,m))}var ee=c.map(function(Fe){var He=ze(Fe.shape.slice(m));return Fe.as2D(-1,He)}),le=bu(ee.map(function(Fe){return Fe.shape}),1),de=Di(le,c[0].dtype).values;if(ee[0].shape[0]===1){var _e=0;ee.forEach(function(Fe){de.set(w.readSync(Fe.dataId),_e),_e+=Fe.size})}else{var Te=0;ee.forEach(function(Fe){for(var He=w.readSync(Fe.dataId),Ye=0,Ke=0;Ke<Fe.shape[0];++Ke)for(var it=Ke*le[1]+Te,gt=0;gt<Fe.shape[1];++gt)de[it+gt]=He[Ye++];Te+=Fe.shape[1]})}var Ne=bu(c.map(function(Fe){return Fe.shape}),m);return To(de,Ne,c[0].dtype)},h.prototype.neg=function(c){return Cn(c,"neg"),this.multiply(kr(-1),c)},h.prototype.add=function(c,m){return c.dtype==="complex64"||m.dtype==="complex64"?this.broadcastedBinaryComplexOp(c.cast("complex64"),m.cast("complex64"),function(w,R,K,ee){return{real:w+K,imag:R+ee}}):this.broadcastedBinaryOp(c,m,En(c.dtype,m.dtype),function(w,R){return w+R})},h.prototype.addN=function(c){var m=this;Cn(c,"addN");for(var w=c.map(function(_e){return m.readSync(_e.dataId)}),R=Di(c[0].shape,c[0].dtype),K=R.values,ee=0;ee<c.length;ee++)for(var le=w[ee],de=0;de<K.length;de++)K[de]+=le[de];return R.toTensor()},h.prototype.softmax=function(c,m){var w=Yt([m],c.shape),R=this.max(c,w),K=Fo(R.shape,w),ee=this.subtract(c,R.reshape(K)),le=this.exp(ee),de=this.sum(le,w).reshape(K);return ra(le,de)},h.prototype.subtract=function(c,m){return c.dtype==="complex64"||m.dtype==="complex64"?this.broadcastedBinaryComplexOp(c.cast("complex64"),m.cast("complex64"),function(w,R,K,ee){return{real:w-K,imag:R-ee}}):this.broadcastedBinaryOp(c,m,En(c.dtype,m.dtype),function(w,R){return w-R})},h.prototype.pow=function(c,m){return Cn([c,m],"pow"),this.broadcastedBinaryOp(c,m,c.dtype,function(w,R){return Math.pow(w,R)})},h.prototype.batchMatMul=function(c,m,w,R){Cn([c,m],"matMul");for(var K=w?c.shape[1]:c.shape[2],ee=w?c.shape[2]:c.shape[1],le=R?m.shape[1]:m.shape[2],de=c.shape[0],_e=this.readSync(c.dataId),Te=this.readSync(m.dataId),Ne=w?[c.strides[0],1,c.strides[1]]:[c.strides[0],c.strides[1],1],Fe=Ne[0],He=Ne[1],Ye=Ne[2],Ke=R?[1,m.strides[1],m.strides[0]]:[m.strides[1],1,m.strides[0]],it=Ke[0],gt=Ke[1],wt=Ke[2],At=ee*le,zt=Di([de,ee,le],c.dtype),an=zt.values,dn=this.blockSize,sn=0;sn<de;sn++)for(var ln=0;ln<ee;ln+=dn)for(var Tn=0;Tn<le;Tn+=dn)for(var Bn=0;Bn<K;Bn+=dn)for(var In=Math.min(ln+dn,ee),or=Math.min(Tn+dn,le),fr=Math.min(Bn+dn,K),br=ln;br<In;br++)for(var _r=Tn;_r<or;_r++){for(var xr=0,vr=Bn;vr<fr;vr++)xr+=_e[sn*Fe+br*He+vr*Ye]*Te[vr*it+_r*gt+sn*wt];an[sn*At+(br*le+_r)]+=xr}return zt.toTensor()},h.prototype.fusedBatchMatMul=function(c){var m=c.a,w=c.b,R=c.transposeA,K=c.transposeB,ee=c.bias,le=c.activation,de=c.preluActivationWeights,_e=this.batchMatMul(m,w,R,K);return ee&&(_e=this.add(_e,ee)),le&&(_e=Nr(this,_e,le,de)),_e},h.prototype.multiply=function(c,m){return c.dtype==="complex64"||m.dtype==="complex64"?this.broadcastedBinaryComplexOp(c.cast("complex64"),m.cast("complex64"),function(w,R,K,ee){return{real:w*K-R*ee,imag:w*ee+R*K}}):this.broadcastedBinaryOp(c,m,En(c.dtype,m.dtype),function(w,R){return w*R})},h.prototype.floorDiv=function(c,m){return Cn([c,m],"floorDiv"),this.broadcastedBinaryOp(c,m,"int32",function(w,R){return Math.floor(w/R)})},h.prototype.sum=function(c,m){Cn(c,"sum"),ta("sum",m,c.rank);for(var w=Io(c.shape,m),R=w[0],K=w[1],ee=ao(R,En(c.dtype,"int32")),le=ze(K),de=this.readSync(ee.dataId),_e=this.readSync(c.dataId),Te=0;Te<de.length;++Te){for(var Ne=Te*le,Fe=0,He=0;He<le;++He)Fe+=_e[Ne+He];de[Te]=Fe}return ee},h.prototype.prod=function(c,m){Cn(c,"sum");for(var w=Io(c.shape,m),R=w[0],K=w[1],ee=ao(R,En(c.dtype,"int32")),le=ze(K),de=this.readSync(ee.dataId),_e=this.readSync(c.dataId),Te=0;Te<de.length;++Te){for(var Ne=Te*le,Fe=1,He=0;He<le;++He)Fe*=_e[Ne+He];de[Te]=Fe}return ee},h.prototype.unsortedSegmentSum=function(c,m,w){Cn(c,"unsortedSegmentSum");for(var R=[],K=c.rank-m.rank,ee=0;ee<K;++ee)m=m.expandDims(ee+1);for(ee=0;ee<w;++ee){var le=kr(ee,"int32"),de=fg(le,m).asType("float32").mul(c).sum(0);R.push(de)}return wu(R)},h.prototype.argMin=function(c,m){Cn(c,"argMin");var w=[m];ta("argMin",w,c.rank);for(var R=Io(c.shape,w),K=R[0],ee=R[1],le=ao(K,"int32"),de=ze(ee),_e=this.readSync(le.dataId),Te=this.readSync(c.dataId),Ne=0;Ne<_e.length;++Ne){for(var Fe=Ne*de,He=Te[Fe],Ye=0,Ke=0;Ke<de;++Ke){var it=Te[Fe+Ke];it<He&&(He=it,Ye=Ke)}_e[Ne]=Ye}return le},h.prototype.argMax=function(c,m){Cn(c,"argMax");var w=[m];ta("argMax",w,c.rank);for(var R=Io(c.shape,w),K=R[0],ee=R[1],le=ao(K,"int32"),de=ze(ee),_e=this.readSync(le.dataId),Te=this.readSync(c.dataId),Ne=0;Ne<_e.length;++Ne){for(var Fe=Ne*de,He=Te[Fe],Ye=0,Ke=0;Ke<de;++Ke){var it=Te[Fe+Ke];it>He&&(He=it,Ye=Ke)}_e[Ne]=Ye}return le},h.prototype.cumsum=function(c,m,w,R){if(Cn(c,"cumsum"),m!==c.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(c.rank-1)+" but got axis="+m);for(var K=En(c.dtype,"int32"),ee=ao(c.shape,K),le=this.readSync(ee.dataId),de=this.readSync(c.dataId),_e=c.shape[c.rank-1],Te=R?function(Ke,it){return Ke+_e-it-1}:function(Ke,it){return Ke+it},Ne=0;Ne<de.length;Ne+=_e)for(var Fe=0;Fe<_e;Fe++){var He=Te(Ne,Fe);if(Fe===0)le[He]=w?0:de[He];else{var Ye=Te(Ne,Fe-1);le[He]=w?de[Ye]+le[Ye]:de[He]+le[Ye]}}return ee},h.prototype.equal=function(c,m){return Cn([c,m],"equal"),this.broadcastedBinaryOp(c,m,"bool",function(w,R){return w===R?1:0})},h.prototype.notEqual=function(c,m){return Cn([c,m],"notEqual"),this.broadcastedBinaryOp(c,m,"bool",function(w,R){return w!==R?1:0})},h.prototype.less=function(c,m){return Cn([c,m],"less"),this.broadcastedBinaryOp(c,m,"bool",function(w,R){return w<R?1:0})},h.prototype.lessEqual=function(c,m){return Cn([c,m],"lessEqual"),this.broadcastedBinaryOp(c,m,"bool",function(w,R){return w<=R?1:0})},h.prototype.greater=function(c,m){return Cn([c,m],"greater"),this.broadcastedBinaryOp(c,m,"bool",function(w,R){return w>R?1:0})},h.prototype.greaterEqual=function(c,m){return Cn([c,m],"greaterEqual"),this.broadcastedBinaryOp(c,m,"bool",function(w,R){return w>=R?1:0})},h.prototype.logicalNot=function(c){Cn(c,"logicalNot");for(var m=this.readSync(c.dataId),w=new Uint8Array(m.length),R=0;R<m.length;++R)w[R]=m[R]?0:1;return this.makeOutput(w,c.shape,"bool")},h.prototype.logicalAnd=function(c,m){return Cn([c,m],"logicalAnd"),this.broadcastedBinaryOp(c,m,"bool",function(w,R){return w&&R})},h.prototype.logicalOr=function(c,m){return Cn([c,m],"logicalOr"),this.broadcastedBinaryOp(c,m,"bool",function(w,R){return w||R})},h.prototype.select=function(c,m,w){Cn([c,m,w],"select");for(var R=this.readSync(c.dataId),K=this.readSync(m.dataId),ee=this.readSync(w.dataId),le=ao(m.shape,En(m.dtype,w.dtype)),de=this.readSync(le.dataId),_e=0,Te=c.rank===0||c.rank>1||m.rank===1?1:ze(m.shape.slice(1)),Ne=0;Ne<R.length;Ne++)for(var Fe=0;Fe<Te;Fe++)R[Ne]===1?de[_e++]=K[Ne]:de[_e++]=ee[Ne];return le},h.prototype.where=function(c){Cn([c],"where");var m=this.readSync(c.dataId);return oa(c.shape,m)},h.prototype.topk=function(c,m,w){return Cn(c,"topk"),ha(this.readSync(c.dataId),c.shape,c.dtype,m)},h.prototype.min=function(c,m){Cn(c,"min"),ta("min",m,c.rank);for(var w=Io(c.shape,m),R=w[0],K=w[1],ee=ao(R,c.dtype),le=ze(K),de=this.readSync(ee.dataId),_e=this.readSync(c.dataId),Te=0;Te<de.length;++Te){for(var Ne=Te*le,Fe=_e[Ne],He=0;He<le;++He){var Ye=_e[Ne+He];Ye<Fe&&(Fe=Ye)}de[Te]=Fe}return ee},h.prototype.minimum=function(c,m){return Cn([c,m],"minimum"),this.broadcastedBinaryOp(c,m,c.dtype,function(w,R){return Math.min(w,R)})},h.prototype.mod=function(c,m){return Cn([c,m],"mod"),this.broadcastedBinaryOp(c,m,c.dtype,function(w,R){var K=w%R;return w<0&&R<0||w>=0&&R>=0?K:(K+R)%R})},h.prototype.max=function(c,m){Cn(c,"max"),ta("max",m,c.rank);for(var w=Io(c.shape,m),R=w[0],K=w[1],ee=ao(R,c.dtype),le=ze(K),de=this.readSync(ee.dataId),_e=this.readSync(c.dataId),Te=0;Te<de.length;++Te){for(var Ne=Te*le,Fe=_e[Ne],He=0;He<le;++He){var Ye=_e[Ne+He];Ye>Fe&&(Fe=Ye)}de[Te]=Fe}return ee},h.prototype.maximum=function(c,m){return Cn([c,m],"maximum"),this.broadcastedBinaryOp(c,m,c.dtype,function(w,R){return Math.max(w,R)})},h.prototype.all=function(c,m){Cn(c,"all"),ta("all",m,c.rank);for(var w=Io(c.shape,m),R=w[0],K=w[1],ee=ao(R,c.dtype),le=ze(K),de=this.readSync(ee.dataId),_e=this.readSync(c.dataId),Te=0;Te<de.length;++Te){for(var Ne=Te*le,Fe=_e[Ne],He=0;He<le;++He){var Ye=_e[Ne+He];Fe=Fe&&Ye}de[Te]=Fe}return ee},h.prototype.any=function(c,m){Cn(c,"any"),ta("any",m,c.rank);for(var w=Io(c.shape,m),R=w[0],K=w[1],ee=ao(R,c.dtype),le=ze(K),de=this.readSync(ee.dataId),_e=this.readSync(c.dataId),Te=0;Te<de.length;++Te){for(var Ne=Te*le,Fe=_e[Ne],He=0;He<le;++He){var Ye=_e[Ne+He];Fe=Fe||Ye}de[Te]=Fe}return ee},h.prototype.squaredDifference=function(c,m){return Cn([c,m],"squaredDifference"),this.broadcastedBinaryOp(c,m,c.dtype,function(w,R){var K=w-R;return K*K})},h.prototype.ceil=function(c){Cn(c,"ceil");for(var m=this.readSync(c.dataId),w=new Float32Array(m.length),R=0;R<m.length;++R)w[R]=Math.ceil(m[R]);return this.makeOutput(w,c.shape,"float32")},h.prototype.floor=function(c){Cn(c,"floor");for(var m=this.readSync(c.dataId),w=new Float32Array(m.length),R=0;R<m.length;++R)w[R]=Math.floor(m[R]);return this.makeOutput(w,c.shape,"float32")},h.prototype.sign=function(c){Cn(c,"x");for(var m=this.readSync(c.dataId),w=new Float32Array(m.length),R=0;R<m.length;++R)m[R]<0?w[R]=-1:m[R]>0?w[R]=1:w[R]=0;return this.makeOutput(w,c.shape,"float32")},h.prototype.isNaN=function(c){Cn(c,"x");for(var m=this.readSync(c.dataId),w=new Uint8Array(m.length),R=0;R<m.length;++R)Number.isNaN(m[R])&&(w[R]=1);return this.makeOutput(w,c.shape,"bool")},h.prototype.isInf=function(c){Cn(c,"x");for(var m=this.readSync(c.dataId),w=new Uint8Array(m.length),R=0;R<m.length;++R)Math.abs(m[R])===1/0&&(w[R]=1);return this.makeOutput(w,c.shape,"bool")},h.prototype.isFinite=function(c){Cn(c,"x");for(var m=this.readSync(c.dataId),w=new Uint8Array(m.length),R=0;R<m.length;++R)Number.isFinite(m[R])&&(w[R]=1);return this.makeOutput(w,c.shape,"bool")},h.prototype.round=function(c){Cn(c,"round");for(var m=this.readSync(c.dataId),w=new Float32Array(m.length),R=0;R<m.length;++R){var K=Math.floor(m[R]);m[R]-K<.5?w[R]=Math.floor(m[R]):m[R]-K>.5?w[R]=Math.ceil(m[R]):w[R]=K%2==0?K:K+1}return this.makeOutput(w,c.shape,"float32")},h.prototype.exp=function(c){Cn(c,"exp");for(var m=this.readSync(c.dataId),w=new Float32Array(m.length),R=0;R<m.length;++R)w[R]=Math.exp(m[R]);return this.makeOutput(w,c.shape,"float32")},h.prototype.expm1=function(c){Cn(c,"expm1");for(var m=this.readSync(c.dataId),w=new Float32Array(m.length),R=0;R<m.length;++R)w[R]=Math.expm1(m[R]);return this.makeOutput(w,c.shape,"float32")},h.prototype.log=function(c){Cn(c,"log");for(var m=this.readSync(c.dataId),w=new Float32Array(m.length),R=0;R<m.length;++R){var K=m[R];w[R]=Math.log(K)}return this.makeOutput(w,c.shape,"float32")},h.prototype.log1p=function(c){Cn(c,"log1p");for(var m=this.readSync(c.dataId),w=new Float32Array(m.length),R=0;R<m.length;++R){var K=m[R];w[R]=Math.log1p(K)}return this.makeOutput(w,c.shape,"float32")},h.prototype.sqrt=function(c){Cn(c,"sqrt");for(var m=this.readSync(c.dataId),w=new Float32Array(m.length),R=0;R<m.length;++R){var K=m[R];w[R]=Math.sqrt(K)}return this.makeOutput(w,c.shape,"float32")},h.prototype.rsqrt=function(c){Cn(c,"rsqrt");for(var m=this.readSync(c.dataId),w=new Float32Array(m.length),R=0;R<m.length;++R){var K=m[R];w[R]=1/Math.sqrt(K)}return this.makeOutput(w,c.shape,"float32")},h.prototype.reciprocal=function(c){Cn(c,"reciprocal");for(var m=this.readSync(c.dataId),w=new Float32Array(m.length),R=0;R<m.length;++R)w[R]=1/m[R];return this.makeOutput(w,c.shape,"float32")},h.prototype.linear=function(c){return c},h.prototype.relu=function(c){Cn(c,"relu");for(var m=ao(c.shape,c.dtype),w=this.readSync(m.dataId),R=this.readSync(c.dataId),K=0;K<R.length;++K)w[K]=Math.max(0,R[K]);return m},h.prototype.relu6=function(c){Cn(c,"relu");for(var m=ao(c.shape,c.dtype),w=this.readSync(m.dataId),R=this.readSync(c.dataId),K=0;K<R.length;++K)w[K]=Math.min(Math.max(0,R[K]),6);return m},h.prototype.prelu=function(c,m){return Cn([c,m],"prelu"),this.broadcastedBinaryOp(c,m,c.dtype,function(w,R){return w<0?R*w:w})},h.prototype.elu=function(c){Cn(c,"elu");for(var m=new Float32Array(c.size),w=this.readSync(c.dataId),R=0;R<w.length;++R){var K=w[R];m[R]=K>=0?K:Math.exp(K)-1}return this.makeOutput(m,c.shape,"float32")},h.prototype.eluDer=function(c,m){Cn([c,m],"eluDer");for(var w=new Float32Array(m.size),R=this.readSync(m.dataId),K=this.readSync(c.dataId),ee=0;ee<R.length;++ee){var le=R[ee];w[ee]=le>=1?K[ee]:K[ee]*(le+1)}return this.makeOutput(w,m.shape,"float32")},h.prototype.selu=function(c){Cn(c,"selu");for(var m=new Float32Array(c.size),w=this.readSync(c.dataId),R=0;R<w.length;++R){var K=w[R];m[R]=K>=0?1.0507009873554805*K:1.7580993408473768*(Math.exp(K)-1)}return this.makeOutput(m,c.shape,"float32")},h.prototype.clip=function(c,m,w){Cn(c,"clip");for(var R=new Float32Array(c.size),K=this.readSync(c.dataId),ee=0;ee<K.length;++ee){var le=K[ee];R[ee]=le>w?w:le<m?m:le}return this.makeOutput(R,c.shape,"float32")},h.prototype.abs=function(c){for(var m=new Float32Array(c.size),w=this.readSync(c.dataId),R=0;R<w.length;++R)m[R]=Math.abs(w[R]);return this.makeOutput(m,c.shape,"float32")},h.prototype.complexAbs=function(c){for(var m=new Float32Array(c.size),w=this.readSync(c.dataId),R=0;R<c.size;++R){var K=w[2*R],ee=w[2*R+1];m[R]=Math.hypot(K,ee)}return this.makeOutput(m,c.shape,"float32")},h.prototype.int=function(c){Cn(c,"int");for(var m=new Int32Array(c.size),w=this.readSync(c.dataId),R=0;R<w.length;++R)m[R]=w[R];return this.makeOutput(m,c.shape,"int32")},h.prototype.sigmoid=function(c){Cn(c,"sigmoid");for(var m=new Float32Array(c.size),w=this.readSync(c.dataId),R=0;R<w.length;++R)m[R]=1/(1+Math.exp(-w[R]));return this.makeOutput(m,c.shape,"float32")},h.prototype.softplus=function(c){Cn(c,"softplus");for(var m=Math.log(11920928955078125e-23)+2,w=new Float32Array(c.size),R=this.readSync(c.dataId),K=0;K<R.length;++K){var ee,le=R[K]>-m,de=R[K]<m,_e=Math.exp(R[K]);ee=de?_e:le?R[K]:Math.log(1+_e),w[K]=ee}return this.makeOutput(w,c.shape,"float32")},h.prototype.sin=function(c){Cn(c,"sin");for(var m=new Float32Array(c.size),w=this.readSync(c.dataId),R=0;R<w.length;++R)m[R]=Math.sin(w[R]);return this.makeOutput(m,c.shape,"float32")},h.prototype.cos=function(c){Cn(c,"cos");for(var m=new Float32Array(c.size),w=this.readSync(c.dataId),R=0;R<w.length;++R)m[R]=Math.cos(w[R]);return this.makeOutput(m,c.shape,"float32")},h.prototype.tan=function(c){Cn(c,"tan");for(var m=new Float32Array(c.size),w=this.readSync(c.dataId),R=0;R<w.length;++R)m[R]=Math.tan(w[R]);return this.makeOutput(m,c.shape,"float32")},h.prototype.asin=function(c){Cn(c,"asin");for(var m=new Float32Array(c.size),w=this.readSync(c.dataId),R=0;R<w.length;++R)m[R]=Math.asin(w[R]);return this.makeOutput(m,c.shape,"float32")},h.prototype.acos=function(c){Cn(c,"acos");for(var m=new Float32Array(c.size),w=this.readSync(c.dataId),R=0;R<w.length;++R)m[R]=Math.acos(w[R]);return this.makeOutput(m,c.shape,"float32")},h.prototype.atan=function(c){Cn(c,"atan");for(var m=new Float32Array(c.size),w=this.readSync(c.dataId),R=0;R<w.length;++R)m[R]=Math.atan(w[R]);return this.makeOutput(m,c.shape,"float32")},h.prototype.atan2=function(c,m){return Cn([c,m],"atan2"),this.broadcastedBinaryOp(c,m,c.dtype,function(w,R){return Math.atan2(w,R)})},h.prototype.sinh=function(c){Cn(c,"sinh");for(var m=new Float32Array(c.size),w=this.readSync(c.dataId),R=0;R<w.length;++R)m[R]=Math.sinh(w[R]);return this.makeOutput(m,c.shape,"float32")},h.prototype.cosh=function(c){Cn(c,"cosh");for(var m=new Float32Array(c.size),w=this.readSync(c.dataId),R=0;R<w.length;++R)m[R]=Math.cosh(w[R]);return this.makeOutput(m,c.shape,"float32")},h.prototype.tanh=function(c){Cn(c,"tanh");for(var m=new Float32Array(c.size),w=this.readSync(c.dataId),R=0;R<w.length;++R)m[R]=pt(w[R]);return this.makeOutput(m,c.shape,"float32")},h.prototype.asinh=function(c){Cn(c,"asinh");for(var m=new Float32Array(c.size),w=this.readSync(c.dataId),R=0;R<w.length;++R)m[R]=Math.asinh(w[R]);return this.makeOutput(m,c.shape,"float32")},h.prototype.acosh=function(c){Cn(c,"acosh");for(var m=new Float32Array(c.size),w=this.readSync(c.dataId),R=0;R<w.length;++R)m[R]=Math.acosh(w[R]);return this.makeOutput(m,c.shape,"float32")},h.prototype.atanh=function(c){Cn(c,"atanh");for(var m=new Float32Array(c.size),w=this.readSync(c.dataId),R=0;R<w.length;++R)m[R]=Math.atanh(w[R]);return this.makeOutput(m,c.shape,"float32")},h.prototype.erf=function(c){Cn(c,"erf");for(var m=new Float32Array(c.size),w=this.readSync(c.dataId),R=0;R<w.length;++R){var K=Math.sign(w[R]),ee=Math.abs(w[R]),le=1/(1+.3275911*ee);m[R]=K*(1-((((1.061405429*le-1.453152027)*le+1.421413741)*le-.284496736)*le+.254829592)*le*Math.exp(-ee*ee))}return this.makeOutput(m,c.shape,"float32")},h.prototype.step=function(c,m){m===void 0&&(m=0),Cn(c,"step");for(var w=new Float32Array(c.size),R=this.readSync(c.dataId),K=0;K<R.length;++K){var ee=R[K];isNaN(ee)?w[K]=NaN:w[K]=ee>0?1:m}return this.makeOutput(w,c.shape,"float32")},h.prototype.fusedConv2d=function(c){var m=c.input,w=c.filter,R=c.convInfo,K=c.bias,ee=c.activation,le=c.preluActivationWeights,de=this.conv2d(m,w,R);return K&&(de=this.add(de,K)),ee&&(de=Nr(this,de,ee,le)),de},h.prototype.conv2d=function(c,m,w){Cn([c,m],"conv2d");for(var R=w.filterHeight,K=w.filterWidth,ee=w.dilationHeight,le=w.dilationWidth,de=w.padInfo.left,_e=w.padInfo.top,Te=w.dataFormat==="channelsLast",Ne=Di(w.outShape,c.dtype),Fe=c.strides[0],He=Te?c.strides[1]:c.strides[2],Ye=Te?c.strides[2]:1,Ke=Te?1:c.strides[1],it=Ne.strides[0],gt=Te?Ne.strides[1]:Ne.strides[2],wt=Te?Ne.strides[2]:1,At=Te?1:Ne.strides[1],zt=this.readSync(c.dataId),an=this.readSync(m.dataId),dn=Ne.values,sn=0;sn<w.batchSize;++sn)for(var ln=sn*Fe,Tn=sn*it,Bn=0;Bn<w.outHeight;++Bn)for(var In=Tn+Bn*gt,or=Bn*w.strideHeight-_e,fr=0;fr<R;fr++){var br=or+fr*ee;if(!(br<0||br>=w.inHeight))for(var _r=fr*m.strides[0],xr=ln+br*He,vr=0;vr<w.outWidth;++vr)for(var Pr=In+vr*wt,Rr=vr*w.strideWidth-de,Qr=0;Qr<K;Qr++){var fi=Rr+Qr*le;if(!(fi<0||fi>=w.inWidth))for(var Ci=xr+fi*Ye,bo=_r+Qr*m.strides[1],xo=0;xo<w.inChannels;++xo){for(var Mo=zt[Ci+xo*Ke],Oo=0;Oo<w.outChannels;++Oo)dn[Pr+Oo*At]+=Mo*an[bo+Oo];bo+=w.outChannels}}}return Ne.toTensor()},h.prototype.conv3d=function(c,m,w){for(var R=w.filterDepth,K=w.filterHeight,ee=w.filterWidth,le=w.dilationDepth,de=w.dilationHeight,_e=w.dilationWidth,Te=w.padInfo.front,Ne=w.padInfo.left,Fe=w.padInfo.top,He=Di(w.outShape,c.dtype),Ye=this.readSync(c.dataId),Ke=this.readSync(m.dataId),it=He.values,gt=0;gt<w.batchSize;++gt)for(var wt=gt*c.strides[0],At=gt*He.strides[0],zt=0;zt<w.outDepth;++zt)for(var an=At+zt*He.strides[1],dn=zt*w.strideDepth-Te,sn=0;sn<R;sn++){var ln=dn+sn*le;if(!(ln<0||ln>=w.inDepth))for(var Tn=sn*m.strides[0],Bn=wt+ln*c.strides[1],In=0;In<w.outHeight;++In)for(var or=an+In*He.strides[2],fr=In*w.strideHeight-Fe,br=0;br<K;br++){var _r=fr+br*de;if(!(_r<0||_r>=w.inHeight))for(var xr=Tn+br*m.strides[1],vr=Bn+_r*c.strides[2],Pr=0;Pr<w.outWidth;++Pr)for(var Rr=or+Pr*w.outChannels,Qr=Pr*w.strideWidth-Ne,fi=0;fi<ee;fi++){var Ci=Qr+fi*_e;if(!(Ci<0||Ci>=w.inWidth))for(var bo=xr+fi*m.strides[2],xo=vr+Ci*w.inChannels,Mo=bo,Oo=0;Oo<w.inChannels;++Oo){for(var Vo=Ye[xo+Oo],ua=0;ua<w.outChannels;++ua)it[Rr+ua]+=Vo*Ke[Mo+ua];Mo+=w.outChannels}}}}return He.toTensor()},h.prototype.conv2dDerInput=function(c,m,w){Cn([c,m],"conv2dDerInput");for(var R=Di(w.inShape,"float32"),K=R.values,ee=this.readSync(c.dataId),le=this.readSync(m.dataId),de=m.strides,_e=de[0],Te=de[1],Ne=de[2],Fe=w.batchSize,He=w.filterHeight,Ye=w.filterWidth,Ke=w.inChannels,it=w.inHeight,gt=w.inWidth,wt=w.outChannels,At=w.outHeight,zt=w.outWidth,an=w.strideHeight,dn=w.strideWidth,sn=w.dataFormat,ln=He-1-w.padInfo.top,Tn=Ye-1-w.padInfo.left,Bn=sn==="channelsLast",In=R.strides[0],or=Bn?R.strides[1]:R.strides[2],fr=Bn?R.strides[2]:1,br=Bn?1:R.strides[1],_r=c.strides[0],xr=Bn?c.strides[1]:c.strides[2],vr=Bn?c.strides[2]:1,Pr=Bn?1:c.strides[1],Rr=0;Rr<Fe;++Rr)for(var Qr=0;Qr<Ke;++Qr)for(var fi=0;fi<it;++fi)for(var Ci=fi-ln,bo=Math.max(0,Math.ceil(Ci/an)),xo=Math.min(At,(He+Ci)/an),Mo=0;Mo<gt;++Mo){for(var Oo=Mo-Tn,Vo=Math.max(0,Math.ceil(Oo/dn)),ua=Math.min(zt,(Ye+Oo)/dn),$a=0,so=bo;so<xo;++so)for(var Do=so*an-Ci,Ko=Vo;Ko<ua;++Ko)for(var Su=_r*Rr+xr*so+vr*Ko,Ks=_e*(He-1-Do)+Te*(Ye-1-(Ko*dn-Oo))+Ne*Qr,Ys=0;Ys<wt;++Ys)$a+=ee[Su+Pr*Ys]*le[Ks+Ys];K[In*Rr+or*fi+fr*Mo+br*Qr]=$a}return R.toTensor()},h.prototype.conv3dDerInput=function(c,m,w){for(var R=Di(w.inShape,"float32"),K=R.values,ee=R.strides,le=ee[0],de=ee[1],_e=ee[2],Te=ee[3],Ne=this.readSync(c.dataId),Fe=c.strides,He=Fe[0],Ye=Fe[1],Ke=Fe[2],it=Fe[3],gt=this.readSync(m.dataId),wt=m.strides,At=wt[0],zt=wt[1],an=wt[2],dn=wt[3],sn=w.batchSize,ln=w.filterDepth,Tn=w.filterHeight,Bn=w.filterWidth,In=w.inChannels,or=w.inDepth,fr=w.inHeight,br=w.inWidth,_r=w.outChannels,xr=w.outDepth,vr=w.outHeight,Pr=w.outWidth,Rr=w.strideDepth,Qr=w.strideHeight,fi=w.strideWidth,Ci=ln-1-w.padInfo.front,bo=Tn-1-w.padInfo.top,xo=Bn-1-w.padInfo.left,Mo=0;Mo<sn;++Mo)for(var Oo=0;Oo<In;++Oo)for(var Vo=0;Vo<or;++Vo)for(var ua=Vo-Ci,$a=Math.max(0,Math.ceil(ua/Rr)),so=Math.min(xr,(ln+ua)/Rr),Do=0;Do<fr;++Do)for(var Ko=Do-bo,Su=Math.max(0,Math.ceil(Ko/Qr)),Ks=Math.min(vr,(Tn+Ko)/Qr),Ys=0;Ys<br;++Ys){for(var cp=Ys-xo,lp=Math.max(0,Math.ceil(cp/fi)),Om=Math.min(Pr,(Bn+cp)/fi),Pu=0,S0=$a;S0<so;++S0)for(var Gv=S0*Rr-ua,fp=Su;fp<Ks;++fp)for(var qv=fp*Qr-Ko,Tm=lp;Tm<Om;++Tm)for(var e3=He*Mo+Ye*S0+Ke*fp+it*Tm,U1=At*(ln-1-Gv)+zt*(Tn-1-qv)+an*(Bn-1-(Tm*fi-cp))+dn*Oo,dp=0;dp<_r;++dp)Pu+=Ne[e3+dp]*gt[U1+dp];K[le*Mo+de*Vo+_e*Do+Te*Ys+Oo]=Pu}return R.toTensor()},h.prototype.conv2dDerFilter=function(c,m,w){Cn([c,m],"conv2dDerFilter");for(var R=w.strideHeight,K=w.strideWidth,ee=w.filterHeight,le=w.filterWidth,de=w.dataFormat==="channelsLast",_e=Di(w.filterShape,"float32"),Te=w.padInfo.left,Ne=w.padInfo.top,Fe=this.bufferSync(c),He=this.bufferSync(m),Ye=0;Ye<ee;++Ye)for(var Ke=Math.max(0,Math.ceil((Ne-Ye)/R)),it=Math.min(w.outHeight,(w.inHeight+Ne-Ye)/R),gt=0;gt<le;++gt)for(var wt=Math.max(0,Math.ceil((Te-gt)/K)),At=Math.min(w.outWidth,(w.inWidth+Te-gt)/K),zt=0;zt<w.inChannels;++zt)for(var an=0;an<w.outChannels;++an){for(var dn=0,sn=0;sn<w.batchSize;++sn)for(var ln=Ke;ln<it;++ln)for(var Tn=Ye+ln*R-Ne,Bn=wt;Bn<At;++Bn){var In=gt+Bn*K-Te;dn+=de?Fe.get(sn,Tn,In,zt)*He.get(sn,ln,Bn,an):Fe.get(sn,zt,Tn,In)*He.get(sn,an,ln,Bn)}_e.set(dn,Ye,gt,zt,an)}return _e.toTensor()},h.prototype.conv3dDerFilter=function(c,m,w){for(var R=w.strideDepth,K=w.strideHeight,ee=w.strideWidth,le=w.filterDepth,de=w.filterHeight,_e=w.filterWidth,Te=Di(w.filterShape,"float32"),Ne=Te.values,Fe=Te.strides,He=Fe[0],Ye=Fe[1],Ke=Fe[2],it=Fe[3],gt=this.readSync(m.dataId),wt=m.strides,At=wt[0],zt=wt[1],an=wt[2],dn=wt[3],sn=this.readSync(c.dataId),ln=c.strides,Tn=ln[0],Bn=ln[1],In=ln[2],or=ln[3],fr=w.padInfo.front,br=w.padInfo.left,_r=w.padInfo.top,xr=0;xr<le;++xr)for(var vr=Math.max(0,Math.ceil((fr-xr)/R)),Pr=Math.min(w.outDepth,(w.inDepth+fr-xr)/R),Rr=xr*He,Qr=0;Qr<de;++Qr)for(var fi=Math.max(0,Math.ceil((_r-Qr)/K)),Ci=Math.min(w.outHeight,(w.inHeight+_r-Qr)/K),bo=Qr*Ye+Rr,xo=0;xo<_e;++xo)for(var Mo=Math.max(0,Math.ceil((br-xo)/ee)),Oo=Math.min(w.outWidth,(w.inWidth+br-xo)/ee),Vo=xo*Ke+bo,ua=0;ua<w.inChannels;++ua)for(var $a=ua*it+Vo,so=0;so<w.outChannels;++so){for(var Do=0,Ko=0;Ko<w.batchSize;++Ko)for(var Su=Ko*Tn,Ks=Ko*At,Ys=vr;Ys<Pr;++Ys)for(var cp=(xr+Ys*R-fr)*Bn+Su,lp=Ys*zt+Ks,Om=fi;Om<Ci;++Om)for(var Pu=(Qr+Om*K-_r)*In+cp,S0=Om*an+lp,Gv=Mo;Gv<Oo;++Gv){var fp=Gv*dn+S0;Do+=sn[(xo+Gv*ee-br)*or+Pu+ua]*gt[fp+so]}Ne[$a+so]=Do}return Te.toTensor()},h.prototype.fusedDepthwiseConv2D=function(c){var m=c.input,w=c.filter,R=c.convInfo,K=c.bias,ee=c.activation,le=c.preluActivationWeights,de=this.depthwiseConv2D(m,w,R);return K&&(de=this.add(de,K)),ee&&(de=Nr(this,de,ee,le)),de},h.prototype.depthwiseConv2D=function(c,m,w){Cn([c,m],"depthwiseConv2D");for(var R=w.filterHeight,K=w.filterWidth,ee=w.dilationHeight,le=w.dilationWidth,de=w.padInfo.left,_e=w.padInfo.top,Te=w.outChannels/w.inChannels,Ne=Di(w.outShape,c.dtype),Fe=this.readSync(c.dataId),He=this.readSync(m.dataId),Ye=Ne.values,Ke=0;Ke<w.batchSize;++Ke)for(var it=Ke*c.strides[0],gt=Ke*Ne.strides[0],wt=0;wt<w.outHeight;++wt)for(var At=gt+wt*Ne.strides[1],zt=wt*w.strideHeight-de,an=0;an<R;++an){var dn=zt+an*ee;if(!(dn<0||dn>=w.inHeight))for(var sn=an*m.strides[0],ln=it+dn*c.strides[1],Tn=0;Tn<w.outWidth;++Tn)for(var Bn=At+Tn*Ne.strides[2],In=Tn*w.strideWidth-_e,or=0;or<K;++or){var fr=In+or*le;if(!(fr<0||fr>=w.inWidth))for(var br=sn+or*m.strides[1],_r=ln+fr*w.inChannels,xr=Bn,vr=br,Pr=0;Pr<w.inChannels;++Pr){for(var Rr=Fe[_r+Pr],Qr=0;Qr<Te;++Qr)Ye[xr+Qr]+=Rr*He[vr+Qr];xr+=Te,vr+=Te}}}return Ne.toTensor()},h.prototype.depthwiseConv2DDerInput=function(c,m,w){Cn([c,m],"depthwiseConv2DDerInput");for(var R=Di(w.inShape,"float32"),K=R.values,ee=R.strides,le=ee[0],de=ee[1],_e=ee[2],Te=this.readSync(c.dataId),Ne=c.strides,Fe=Ne[0],He=Ne[1],Ye=Ne[2],Ke=this.readSync(m.dataId),it=m.strides,gt=it[0],wt=it[1],At=it[2],zt=w.batchSize,an=w.filterHeight,dn=w.filterWidth,sn=w.inChannels,ln=w.inHeight,Tn=w.inWidth,Bn=w.outChannels,In=w.outHeight,or=w.outWidth,fr=w.strideHeight,br=w.strideWidth,_r=an-1-w.padInfo.top,xr=dn-1-w.padInfo.left,vr=Bn/sn,Pr=0;Pr<zt;++Pr)for(var Rr=0;Rr<sn;++Rr)for(var Qr=0;Qr<ln;++Qr)for(var fi=Qr-_r,Ci=Math.max(0,Math.ceil(fi/fr)),bo=Math.min(In,(an+fi)/fr),xo=0;xo<Tn;++xo){for(var Mo=xo-xr,Oo=Math.max(0,Math.ceil(Mo/br)),Vo=Math.min(or,(dn+Mo)/br),ua=0,$a=Ci;$a<bo;++$a)for(var so=$a*fr-fi,Do=Oo;Do<Vo;++Do)for(var Ko=Fe*Pr+He*$a+Ye*Do,Su=gt*(an-1-so)+wt*(dn-1-(Do*br-Mo))+At*Rr,Ks=0;Ks<vr;++Ks)ua+=Te[Ko+(Rr*vr+Ks)]*Ke[Su+Ks];K[le*Pr+de*Qr+_e*xo+Rr]=ua}return R.toTensor()},h.prototype.depthwiseConv2DDerFilter=function(c,m,w){Cn([c,m],"depthwiseConv2DDerFilter");for(var R=w.strideHeight,K=w.strideWidth,ee=w.filterHeight,le=w.filterWidth,de=Di(w.filterShape,"float32"),_e=w.padInfo.left,Te=w.padInfo.top,Ne=w.outChannels/w.inChannels,Fe=this.bufferSync(c),He=this.bufferSync(m),Ye=0;Ye<ee;++Ye)for(var Ke=Math.max(0,Math.ceil((Te-Ye)/R)),it=Math.min(w.outHeight,(w.inHeight+Te-Ye)/R),gt=0;gt<le;++gt)for(var wt=Math.max(0,Math.ceil((_e-gt)/K)),At=Math.min(w.outWidth,(w.inWidth+_e-gt)/K),zt=0;zt<w.outChannels;++zt){for(var an=Math.trunc(zt/Ne),dn=zt%Ne,sn=0,ln=0;ln<w.batchSize;++ln)for(var Tn=Ke;Tn<it;++Tn)for(var Bn=Ye+Tn*R-Te,In=wt;In<At;++In){var or=gt+In*K-_e;sn+=Fe.get(ln,Bn,or,an)*He.get(ln,Tn,In,zt)}de.set(sn,Ye,gt,an,dn)}return de.toTensor()},h.prototype.tile=function(c,m){return Cn(c,"tile"),wa(this.bufferSync(c),m)},h.prototype.pad=function(c,m,w){Cn(c,"pad");var R=m.map(function(Ne,Fe){return Ne[0]+c.shape[Fe]+Ne[1]}),K=m.map(function(Ne){return Ne[0]}),ee=this.bufferSync(c),le=Di(R,c.dtype);w!==0&&le.values.fill(w);for(var de=0;de<c.size;de++){var _e=ee.indexToLoc(de),Te=_e.map(function(Ne,Fe){return Ne+K[Fe]});le.set.apply(le,[ee.get.apply(ee,_e)].concat(Te))}return le.toTensor()},h.prototype.gather=function(c,m,w){Cn([c,m],"gather");var R=c.shape.slice(),K=this.readSync(m.dataId);R[w]=K.length;for(var ee=Di(R,c.dtype),le=this.bufferSync(c),de=0;de<ee.size;++de){var _e=ee.indexToLoc(de),Te=_e.slice();Te[w]=K[_e[w]];var Ne=le.locToIndex(Te);ee.values[de]=le.values[Ne]}return ee.toTensor()},h.prototype.batchToSpaceND=function(c,m,w){Cn([c],"batchToSpaceND");var R=m.reduce(function(Te,Ne){return Te*Ne}),K=vd(c.shape,m,R),ee=Ol(K.length,m.length),le=df(c.shape,m,R),de=Xp(w,m.length),_e=Qm(le,w,m.length);return vt(c.reshape(K),ee).reshape(le).slice(de,_e)},h.prototype.spaceToBatchND=function(c,m,w){Cn([c],"spaceToBatchND");var R=m.reduce(function(Ne,Fe){return Ne*Fe}),K=[[0,0]];K.push.apply(K,w);for(var ee=1+m.length;ee<c.shape.length;++ee)K.push([0,0]);var le=c.pad(K),de=vd(le.shape,m,R,!1),_e=Ol(de.length,m.length,!1),Te=df(le.shape,m,R,!1);return vt(le.reshape(de),_e).reshape(Te)},h.prototype.maxPool=function(c,m){return Cn(c,"maxPool"),wr(this.readSync(c.dataId),c.shape,c.dtype,c.strides,m,"max").toTensor()},h.prototype.maxPoolBackprop=function(c,m,w,R){Cn([m,w],"maxPoolBackprop");for(var K=this.readSync(m.dataId),ee=Di(R.outShape,m.dtype,Dr(K,m.shape,m.dtype,R).values),le=R.strideHeight,de=R.strideWidth,_e=R.dilationHeight,Te=R.dilationWidth,Ne=R.effectiveFilterHeight,Fe=R.effectiveFilterWidth,He=Fe-1-R.padInfo.left,Ye=Ne-1-R.padInfo.top,Ke=Di(m.shape,"float32"),it=this.bufferSync(c),gt=0;gt<R.batchSize;++gt)for(var wt=0;wt<R.inChannels;++wt)for(var At=0;At<R.inHeight;++At)for(var zt=0;zt<R.inWidth;++zt){for(var an=At-Ye,dn=zt-He,sn=0,ln=0;ln<Ne;ln+=_e){var Tn=(an+ln)/le;if(!(Tn<0||Tn>=R.outHeight||Math.floor(Tn)!==Tn))for(var Bn=0;Bn<Fe;Bn+=Te){var In=(dn+Bn)/de;if(!(In<0||In>=R.outWidth||Math.floor(In)!==In)){var or=Ne*Fe-1-ee.get(gt,Tn,In,wt)===ln*Fe+Bn?1:0;or!==0&&(sn+=it.get(gt,Tn,In,wt)*or)}}}Ke.set(sn,gt,At,zt,wt)}return Ke.toTensor()},h.prototype.avgPoolBackprop=function(c,m,w){Cn([c,m],"avgPoolBackprop");for(var R=w.strideHeight,K=w.strideWidth,ee=w.filterHeight,le=w.filterWidth,de=w.dilationHeight,_e=w.dilationWidth,Te=w.effectiveFilterHeight,Ne=w.effectiveFilterWidth,Fe=Ne-1-w.padInfo.left,He=Te-1-w.padInfo.top,Ye=Di(m.shape,"float32"),Ke=1/(ee*le),it=this.bufferSync(c),gt=0;gt<w.batchSize;++gt)for(var wt=0;wt<w.inChannels;++wt)for(var At=0;At<w.inHeight;++At)for(var zt=0;zt<w.inWidth;++zt){for(var an=At-He,dn=zt-Fe,sn=0,ln=0;ln<Te;ln+=de){var Tn=(an+ln)/R;if(!(Tn<0||Tn>=w.outHeight||Math.floor(Tn)!==Tn))for(var Bn=0;Bn<Ne;Bn+=_e){var In=(dn+Bn)/K;In<0||In>=w.outWidth||Math.floor(In)!==In||(sn+=it.get(gt,Tn,In,wt))}}Ye.set(sn*Ke,gt,At,zt,wt)}return Ye.toTensor()},h.prototype.pool3d=function(c,m,w){Cn(c,"pool3d");for(var R=m.strideDepth,K=m.strideHeight,ee=m.strideWidth,le=m.dilationDepth,de=m.dilationHeight,_e=m.dilationWidth,Te=m.effectiveFilterDepth,Ne=m.effectiveFilterHeight,Fe=m.effectiveFilterWidth,He=m.padInfo.front,Ye=m.padInfo.top,Ke=m.padInfo.left,it=w==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,gt=this.readSync(c.dataId),wt=Di(m.outShape,c.dtype),At=wt.values,zt=m.outShape[1]*m.outShape[2]*m.outShape[3]*m.outShape[4],an=m.outShape[2]*m.outShape[3]*m.outShape[4],dn=m.outShape[3]*m.outShape[4],sn=m.outShape[4],ln=0;ln<m.batchSize;++ln)for(var Tn=ln*zt,Bn=ln*c.strides[0],In=0;In<m.inChannels;++In)for(var or=0;or<m.outDepth;++or){for(var fr=or*R-He,br=fr;br<0;)br+=le;for(var _r=Math.min(m.inDepth,Te+fr),xr=Tn+or*an,vr=0;vr<m.outHeight;++vr){for(var Pr=vr*K-Ye,Rr=Pr;Rr<0;)Rr+=de;for(var Qr=Math.min(m.inHeight,Ne+Pr),fi=xr+vr*dn,Ci=0;Ci<m.outWidth;++Ci){for(var bo=Ci*ee-Ke,xo=bo;xo<0;)xo+=_e;for(var Mo=Math.min(m.inWidth,Fe+bo),Oo=fi+Ci*sn,Vo=it,ua=0,$a=0,so=br;so<_r;so+=le){for(var Do=Bn+so*c.strides[1],Ko=Rr;Ko<Qr;Ko+=de){for(var Su=Do+Ko*c.strides[2],Ks=xo;Ks<Mo;Ks+=_e){var Ys=gt[Su+Ks*c.strides[3]+In];if(w==="max"&&Ys>Vo?Vo=Ys:w==="avg"&&(ua+=Ys,$a++),isNaN(Vo))break}if(isNaN(Vo))break}if(isNaN(Vo))break}At[Oo+In]=w==="avg"?ua/$a:Vo}}}return wt.toTensor()},h.prototype.avgPool3d=function(c,m){return Cn(c,"avgPool3d"),this.pool3d(c,m,"avg").toFloat()},h.prototype.avgPool3dBackprop=function(c,m,w){Cn([c,m],"avgPool3dBackprop");for(var R=w.strideDepth,K=w.strideHeight,ee=w.strideWidth,le=w.filterDepth,de=w.filterHeight,_e=w.filterWidth,Te=w.dilationDepth,Ne=w.dilationHeight,Fe=w.dilationWidth,He=w.effectiveFilterDepth,Ye=w.effectiveFilterHeight,Ke=w.effectiveFilterWidth,it=He-1-w.padInfo.front,gt=Ke-1-w.padInfo.left,wt=Ye-1-w.padInfo.top,At=Di(m.shape,"float32"),zt=1/(le*de*_e),an=this.bufferSync(c),dn=0;dn<w.batchSize;++dn)for(var sn=0;sn<w.inChannels;++sn)for(var ln=0;ln<w.inDepth;++ln)for(var Tn=0;Tn<w.inHeight;++Tn)for(var Bn=0;Bn<w.inWidth;++Bn){for(var In=ln-it,or=Tn-wt,fr=Bn-gt,br=0,_r=0;_r<He;_r+=Te){var xr=(In+_r)/R;if(!(xr<0||xr>=w.outDepth||Math.floor(xr)!==xr))for(var vr=0;vr<Ye;vr+=Ne){var Pr=(or+vr)/K;if(!(Pr<0||Pr>=w.outHeight||Math.floor(Pr)!==Pr))for(var Rr=0;Rr<Ke;Rr+=Fe){var Qr=(fr+Rr)/ee;Qr<0||Qr>=w.outWidth||Math.floor(Qr)!==Qr||(br+=an.get(dn,xr,Pr,Qr,sn))}}}At.set(br*zt,dn,ln,Tn,Bn,sn)}return At.toTensor()},h.prototype.maxPool3d=function(c,m){return Cn(c,"maxPool3d"),this.pool3d(c,m,"max").toFloat()},h.prototype.maxPool3dPositions=function(c,m){for(var w=Di(m.outShape,"int32"),R=m.strideDepth,K=m.strideHeight,ee=m.strideWidth,le=m.dilationDepth,de=m.dilationHeight,_e=m.dilationWidth,Te=m.effectiveFilterDepth,Ne=m.effectiveFilterHeight,Fe=m.effectiveFilterWidth,He=m.padInfo.front,Ye=m.padInfo.top,Ke=m.padInfo.left,it=this.bufferSync(c),gt=0;gt<m.batchSize;++gt)for(var wt=0;wt<m.inChannels;++wt)for(var At=0;At<m.outDepth;++At){for(var zt=At*R-He,an=zt;an<0;)an+=le;for(var dn=Math.min(m.inDepth,Te+zt),sn=0;sn<m.outHeight;++sn){for(var ln=sn*K-Ye,Tn=ln;Tn<0;)Tn+=de;for(var Bn=Math.min(m.inHeight,Ne+ln),In=0;In<m.outWidth;++In){for(var or=In*ee-Ke,fr=or;fr<0;)fr+=_e;for(var br=Math.min(m.inWidth,Fe+or),_r=Number.NEGATIVE_INFINITY,xr=-1,vr=an;vr<dn;vr+=le)for(var Pr=vr-zt,Rr=Tn;Rr<Bn;Rr+=de)for(var Qr=Rr-ln,fi=fr;fi<br;fi+=_e){var Ci=fi-or,bo=it.get(gt,vr,Rr,fi,wt);bo>=_r&&(_r=bo,xr=Pr*Ne*Fe+Qr*Ne+Ci)}w.set(xr,gt,At,sn,In,wt)}}}return w.toTensor()},h.prototype.maxPool3dBackprop=function(c,m,w,R){Cn([m,w],"maxPool3dBackprop");for(var K=this.maxPool3dPositions(m,R),ee=R.strideDepth,le=R.strideHeight,de=R.strideWidth,_e=R.dilationDepth,Te=R.dilationHeight,Ne=R.dilationWidth,Fe=R.effectiveFilterDepth,He=R.effectiveFilterHeight,Ye=R.effectiveFilterWidth,Ke=Fe-1-R.padInfo.front,it=Ye-1-R.padInfo.left,gt=He-1-R.padInfo.top,wt=Di(m.shape,"float32"),At=this.bufferSync(K),zt=this.bufferSync(c),an=0;an<R.batchSize;++an)for(var dn=0;dn<R.inChannels;++dn)for(var sn=0;sn<R.inDepth;++sn)for(var ln=0;ln<R.inHeight;++ln)for(var Tn=0;Tn<R.inWidth;++Tn){for(var Bn=sn-Ke,In=ln-gt,or=Tn-it,fr=0,br=0;br<Fe;br+=_e){var _r=(Bn+br)/ee;if(!(_r<0||_r>=R.outDepth||Math.floor(_r)!==_r))for(var xr=0;xr<He;xr+=Te){var vr=(In+xr)/le;if(!(vr<0||vr>=R.outHeight||Math.floor(vr)!==vr))for(var Pr=0;Pr<Ye;Pr+=Ne){var Rr=(or+Pr)/de;if(!(Rr<0||Rr>=R.outWidth||Math.floor(Rr)!==Rr)){var Qr=Fe*He*Ye-1-At.get(an,_r,vr,Rr,dn)===br*He*Ye+xr*Ye+Pr?1:0;Qr!==0&&(fr+=zt.get(an,_r,vr,Rr,dn)*Qr)}}}}wt.set(fr,an,sn,ln,Tn,dn)}return wt.toTensor()},h.prototype.cast=function(c,m){return ni(c,m,this)},h.prototype.reshape=function(c,m){return bi(c,m)},h.prototype.avgPool=function(c,m){return Cn(c,"avgPool"),Cn(c,"maxPool"),wr(this.readSync(c.dataId),c.shape,c.dtype,c.strides,m,"avg").toTensor().toFloat()},h.prototype.resizeBilinear=function(c,m,w,R){Cn(c,"resizeBilinear");for(var K=c.shape,ee=K[0],le=K[1],de=K[2],_e=K[3],Te=this.readSync(c.dataId),Ne=new Float32Array(ze([ee,m,w,_e])),Fe=[R&&m>1?le-1:le,R&&w>1?de-1:de],He=[R&&m>1?m-1:m,R&&w>1?w-1:w],Ye=0,Ke=Fe[0]/He[0],it=Fe[1]/He[1],gt=0;gt<ee;gt++)for(var wt=0;wt<m;wt++)for(var At=Ke*wt,zt=Math.floor(At),an=At-zt,dn=Math.min(le-1,Math.ceil(At)),sn=gt*c.strides[0]+zt*c.strides[1],ln=gt*c.strides[0]+dn*c.strides[1],Tn=0;Tn<w;Tn++)for(var Bn=it*Tn,In=Math.floor(Bn),or=Bn-In,fr=Math.min(de-1,Math.ceil(Bn)),br=sn+In*c.strides[2],_r=ln+In*c.strides[2],xr=sn+fr*c.strides[2],vr=ln+fr*c.strides[2],Pr=0;Pr<_e;Pr++){var Rr=Te[br+Pr],Qr=Te[_r+Pr],fi=Rr+(Te[xr+Pr]-Rr)*or,Ci=fi+(Qr+(Te[vr+Pr]-Qr)*or-fi)*an;Ne[Ye++]=Ci}return To(Ne,[ee,m,w,_e])},h.prototype.resizeBilinearBackprop=function(c,m,w){Cn([c,m],"resizeBilinearBackprop");for(var R=m.shape,K=R[0],ee=R[1],le=R[2],de=R[3],_e=c.shape,Te=_e[1],Ne=_e[2],Fe=new Float32Array(K*ee*le*de),He=[w&&Te>1?ee-1:ee,w&&Ne>1?le-1:le],Ye=[w&&Te>1?Te-1:Te,w&&Ne>1?Ne-1:Ne],Ke=He[0]/Ye[0],it=He[1]/Ye[1],gt=this.readSync(c.dataId),wt=0,At=0;At<K;At++)for(var zt=At*m.strides[0],an=0;an<Te;an++)for(var dn=an*Ke,sn=Math.floor(dn),ln=Math.min(Math.ceil(dn),ee-1),Tn=zt+sn*m.strides[1],Bn=zt+ln*m.strides[1],In=dn-sn,or=1-In,fr=0;fr<Ne;fr++)for(var br=fr*it,_r=Math.floor(br),xr=Math.min(Math.ceil(br),le-1),vr=br-_r,Pr=1-vr,Rr=Tn+_r*m.strides[2],Qr=Tn+xr*m.strides[2],fi=Bn+_r*m.strides[2],Ci=Bn+xr*m.strides[2],bo=or*Pr,xo=or*vr,Mo=In*Pr,Oo=In*vr,Vo=0;Vo<de;Vo++){var ua=gt[wt++];Fe[Rr+Vo]+=ua*bo,Fe[Qr+Vo]+=ua*xo,Fe[fi+Vo]+=ua*Mo,Fe[Ci+Vo]+=ua*Oo}return iu(Fe,[K,le,ee,de],m.dtype)},h.prototype.resizeNearestNeighbor=function(c,m,w,R){Cn(c,"resizeNearestNeighbor");for(var K=c.shape,ee=K[0],le=K[1],de=K[2],_e=K[3],Te=this.readSync(c.dataId),Ne=new Float32Array(ee*m*w*_e),Fe=[R&&m>1?le-1:le,R&&w>1?de-1:de],He=[R&&m>1?m-1:m,R&&w>1?w-1:w],Ye=Fe[0]/He[0],Ke=Fe[1]/He[1],it=0,gt=0;gt<ee;gt++)for(var wt=gt*c.strides[0],At=0;At<m;At++)for(var zt=Ye*At,an=wt+Math.min(le-1,R?Math.round(zt):Math.floor(zt))*c.strides[1],dn=0;dn<w;dn++)for(var sn=Ke*dn,ln=an+Math.min(de-1,R?Math.round(sn):Math.floor(sn))*c.strides[2],Tn=0;Tn<_e;Tn++){var Bn=Te[ln+Tn];Ne[it++]=Bn}return To(Ne,[ee,m,w,_e],c.dtype)},h.prototype.resizeNearestNeighborBackprop=function(c,m,w){Cn([c,m],"resizeNearestNeighborBackprop");for(var R=m.shape,K=R[0],ee=R[1],le=R[2],de=R[3],_e=c.shape,Te=_e[1],Ne=_e[2],Fe=new Float32Array(K*ee*le*de),He=this.readSync(c.dataId),Ye=[w&&Te>1?ee-1:ee,w&&Ne>1?le-1:le],Ke=[w&&Te>1?Te-1:Te,w&&Ne>1?Ne-1:Ne],it=Ye[0]/Ke[0],gt=Ye[1]/Ke[1],wt=1/it,At=1/gt,zt=2*Math.ceil(wt)+2,an=2*Math.ceil(At)+2,dn=0;dn<K;dn++)for(var sn=dn*m.strides[0],ln=0;ln<ee;ln++)for(var Tn=sn+ln*m.strides[1],Bn=Math.floor(ln*wt),In=Math.floor(Bn-zt/2),or=0;or<le;or++)for(var fr=Tn+or*m.strides[2],br=Math.floor(or*At),_r=Math.floor(br-an/2),xr=0;xr<de;xr++){for(var vr=0,Pr=0;Pr<zt;Pr++){var Rr=Pr+In;if(!(Rr<0||Rr>=Te)){var Qr=sn+Rr*c.strides[1],fi=Rr*it;if(ln===Math.min(ee-1,w?Math.round(fi):Math.floor(fi)))for(var Ci=0;Ci<an;Ci++){var bo=Ci+_r;if(!(bo<0||bo>=Ne)){var xo=Qr+bo*c.strides[2],Mo=bo*gt;or===Math.min(le-1,w?Math.round(Mo):Math.floor(Mo))&&(vr+=He[xo+xr])}}}}Fe[fr+xr]=vr}return iu(Fe,m.shape,m.dtype)},h.prototype.batchNormalization=function(c,m,w,R,K,ee){Cn([c,m,w,K,ee],"batchNorm");for(var le=this.readSync(c.dataId),de=this.readSync(m.dataId),_e=this.readSync(w.dataId),Te=K?this.readSync(K.dataId):new Float32Array([1]),Ne=ee?this.readSync(ee.dataId):new Float32Array([0]),Fe=new Float32Array(le.length),He=Ne.length,Ye=Te.length,Ke=_e.length,it=de.length,gt=0,wt=0,At=0,zt=0,an=0;an<le.length;++an)Fe[an]=Ne[gt++]+(le[an]-de[wt++])*Te[At++]/Math.sqrt(_e[zt++]+R),gt>=He&&(gt=0),wt>=it&&(wt=0),At>=Ye&&(At=0),zt>=Ke&&(zt=0);return iu(Fe,c.shape)},h.prototype.localResponseNormalization4D=function(c,m,w,R,K){Cn(c,"localResponseNormalization4D");var ee=c.shape[3],le=ee-1,de=this.readSync(c.dataId),_e=c.size,Te=new Float32Array(_e);function Ne(Ke){for(var it=Ke%ee,gt=Ke-it+Math.max(0,it-m),wt=Ke-it+Math.min(it+m,le),At=0;gt<=wt;gt++){var zt=de[gt];At+=zt*zt}return At}for(var Fe=0;Fe<_e;Fe++){var He=Ne(Fe),Ye=de[Fe]*Math.pow(w+R*He,-K);Te[Fe]=Ye}return iu(Te,c.shape)},h.prototype.LRNGrad=function(c,m,w,R,K,ee,le){Cn(c,"LRNGrad");for(var de=c.shape[3],_e=this.readSync(c.dataId),Te=this.readSync(m.dataId),Ne=this.readSync(w.dataId),Fe=new Float32Array(c.size),He=c.size,Ye=0;Ye<He;Ye++){for(var Ke=Ye%de,it=Ye-Ke+Math.max(0,Ke-R),gt=Ye-Ke+Math.min(de,Ke+R+1),wt=0,At=it;At<gt;At++)wt+=Math.pow(Te[At],2);for(wt=ee*wt+K,At=it;At<gt;At++){var zt=-2*ee*le*Te[At]*Ne[Ye]/wt;Ye===At&&(zt+=Math.pow(wt,-le)),zt*=_e[Ye],Fe[At]+=zt}}return iu(Fe,c.shape)},h.prototype.multinomial=function(c,m,w,R){Cn(c,"multinomial");for(var K=m?c:je(c),ee=K.shape[0],le=K.shape[1],de=ao([ee,w],"int32"),_e=this.readSync(de.dataId),Te=this.readSync(K.dataId),Ne=0;Ne<ee;++Ne){var Fe=Ne*le,He=new Float32Array(le-1);He[0]=Te[Fe];for(var Ye=1;Ye<He.length;++Ye)He[Ye]=He[Ye-1]+Te[Fe+Ye];for(var Ke=Gh(R.toString()),it=Ne*w,gt=0;gt<w;++gt){var wt=Ke();_e[it+gt]=He.length;for(var At=0;At<He.length;At++)if(wt<He[At]){_e[it+gt]=At;break}}}return de},h.prototype.oneHot=function(c,m,w,R){Cn(c,"oneHot");var K=new Float32Array(c.size*m);K.fill(R);for(var ee=this.readSync(c.dataId),le=0;le<c.size;++le)ee[le]>=0&&ee[le]<m&&(K[le*m+ee[le]]=w);return xu(K,[c.size,m],"int32")},h.prototype.nonMaxSuppression=function(c,m,w,R,K){return Cn(c,"nonMaxSuppression"),fa(this.readSync(c.dataId),this.readSync(m.dataId),w,R,K)},h.prototype.fft=function(c){return this.fftBatch(c,!1)},h.prototype.ifft=function(c){return this.fftBatch(c,!0)},h.prototype.fftBatch=function(c,m){for(var w=c.shape[0],R=c.shape[1],K=Di(c.shape,"float32"),ee=Di(c.shape,"float32"),le=va(c).as2D(w,R),de=Ya(c).as2D(w,R),_e=0;_e<w;_e++)for(var Te=le.slice([_e,0],[1,R]),Ne=de.slice([_e,0],[1,R]),Fe=_o(Te,Ne),He=this.readSync(this.fftImpl(Fe,m).dataId),Ye=0;Ye<R;Ye++){var Ke=fo(He,Ye);K.values[_e*R+Ye]=Ke.real,ee.values[_e*R+Ye]=Ke.imag}return _o(K.toTensor(),ee.toTensor()).as2D(w,R)},h.prototype.fftImpl=function(c,m){var w=c.as1D(),R=w.size;if(this.isExponentOf2(R)){var K=this.fftRadix2(w,R,m).as2D(c.shape[0],c.shape[1]);return m&&(K=_o(va(K).div(kr(R)),Ya(K).div(kr(R)))),K}var ee=this.readSync(c.dataId),le=function(de){for(var _e=new Float32Array(de.length/2),Te=new Float32Array(de.length/2),Ne=0;Ne<de.length;Ne+=2)_e[Ne/2]=de[Ne],Te[Ne/2]=de[Ne+1];return{real:_e,imag:Te}}(this.fourierTransformByMatmul(ee,R,m));return _o(le.real,le.imag).as2D(c.shape[0],c.shape[1])},h.prototype.isExponentOf2=function(c){return(c&c-1)==0},h.prototype.fftRadix2=function(c,m,w){if(m===1)return c;var R=this.readSync(c.dataId),K=m/2,ee=function(it){for(var gt=Math.ceil(it.length/4),wt=new Float32Array(gt),At=new Float32Array(gt),zt=0;zt<it.length;zt+=4)wt[Math.floor(zt/4)]=it[zt],At[Math.floor(zt/4)]=it[zt+1];return{real:wt,imag:At}}(R),le=_o(ee.real,ee.imag).as1D(),de=function(it){for(var gt=Math.floor(it.length/4),wt=new Float32Array(gt),At=new Float32Array(gt),zt=2;zt<it.length;zt+=4)wt[Math.floor(zt/4)]=it[zt],At[Math.floor(zt/4)]=it[zt+1];return{real:wt,imag:At}}(R),_e=_o(de.real,de.imag).as1D();le=this.fftRadix2(le,K,w),_e=this.fftRadix2(_e,K,w);var Te=function(it,gt){for(var wt=new Float32Array(it/2),At=new Float32Array(it/2),zt=0;zt<Math.ceil(it/2);zt++){var an=(gt?2:-2)*Math.PI*(zt/it);wt[zt]=Math.cos(an),At[zt]=Math.sin(an)}return{real:wt,imag:At}}(m,w),Ne=_o(Te.real,Te.imag).mul(_e),Fe=le.add(Ne),He=le.sub(Ne),Ye=va(Fe).concat(va(He)),Ke=Ya(Fe).concat(Ya(He));return _o(Ye,Ke).as1D()},h.prototype.fourierTransformByMatmul=function(c,m,w){for(var R=new Float32Array(2*m),K=0;K<m;K++){for(var ee=0,le=0,de=0;de<m;de++){var _e=qo(K*de,m,w),Te=fo(c,de);ee+=Te.real*_e.real-Te.imag*_e.imag,le+=Te.real*_e.imag+Te.imag*_e.real}w&&(ee/=m,le/=m),lo(R,ee,le,K)}return R},h.prototype.depthToSpace=function(c,m,w){we(w==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+w}),we(m>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+m});for(var R=c.shape[0],K=c.shape[1],ee=c.shape[2],le=c.shape[3],de=K*m,_e=ee*m,Te=le/(m*m),Ne=this.readSync(c.dataId),Fe=new Float32Array(R*de*_e*Te),He=0,Ye=0;Ye<R;++Ye)for(var Ke=0;Ke<de;++Ke)for(var it=Math.floor(Ke/m),gt=Ke%m,wt=0;wt<_e;++wt)for(var At=Math.floor(wt/m),zt=(gt*m+wt%m)*Te,an=0;an<Te;++an){var dn=an+zt+le*(At+ee*(it+K*Ye));Fe[He++]=Ne[dn]}return iu(Fe,[R,de,_e,Te])},h.prototype.broadcastedBinaryOp=function(c,m,w,R){var K=qi(c.shape,m.shape),ee=Di(K,w),le=this.readSync(c.dataId),de=this.readSync(m.dataId),_e=La(c.shape,K),Te=La(m.shape,K),Ne=ee.values;if(_e.length+Te.length===0)for(var Fe=0;Fe<Ne.length;++Fe)Ne[Fe]=R(le[Fe%le.length],de[Fe%de.length]);else{var He=this.bufferSync(c),Ye=this.bufferSync(m),Ke=function(it){var gt=ee.indexToLoc(it),wt=gt.slice(-c.rank);_e.forEach(function(dn){return wt[dn]=0});var At=He.locToIndex(wt),zt=gt.slice(-m.rank);Te.forEach(function(dn){return zt[dn]=0});var an=Ye.locToIndex(zt);Ne[it]=R(le[At],de[an])};for(Fe=0;Fe<Ne.length;++Fe)Ke(Fe)}return ee.toTensor()},h.prototype.broadcastedBinaryComplexOp=function(c,m,w){var R=qi(c.shape,m.shape),K=Di(R,"float32"),ee=Di(R,"float32"),le=this.readSync(c.dataId),de=this.readSync(m.dataId),_e=La(c.shape,R),Te=La(m.shape,R),Ne=K.values,Fe=ee.values;if(_e.length+Te.length===0)for(var He=0;He<Ne.length;He++){var Ye=He%le.length,Ke=He%de.length,it=w(le[2*Ye],le[2*Ye+1],de[2*Ke],de[2*Ke+1]);Ne[He]=it.real,Fe[He]=it.imag}else{var gt=this.bufferSync(this.data.get(c.dataId).complexTensors.real),wt=this.bufferSync(this.data.get(m.dataId).complexTensors.real),At=function(zt){var an=K.indexToLoc(zt),dn=an.slice(-c.rank);_e.forEach(function(In){return dn[In]=0});var sn=gt.locToIndex(dn),ln=an.slice(-m.rank);Te.forEach(function(In){return ln[In]=0});var Tn=wt.locToIndex(ln),Bn=w(le[2*sn],le[2*sn+1],de[2*Tn],de[2*Tn+1]);Ne[zt]=Bn.real,Fe[zt]=Bn.imag};for(He=0;He<Ne.length;He++)At(He)}return this.complex(K.toTensor(),ee.toTensor())},h.prototype.split=function(c,m,w){return ya(c,m,w)},h.prototype.dispose=function(){},h.prototype.floatPrecision=function(){return 32},h.prototype.epsilon=function(){return 1e-7},h.prototype.cropAndResize=function(c,m,w,R,K,ee){for(var le=c.shape,de=le[0],_e=le[1],Te=le[2],Ne=le[3],Fe=m.shape[0],He=R[0],Ye=R[1],Ke=Di([Fe,He,Ye,Ne],"float32"),it=this.readSync(m.dataId),gt=this.readSync(w.dataId),wt=this.readSync(c.dataId),At=c.strides,zt=Ke.strides,an=0;an<Fe;an++){var dn=4*an,sn=it[dn],ln=it[dn+1],Tn=it[dn+2],Bn=it[dn+3],In=gt[an];if(!(In>=de))for(var or=He>1?(Tn-sn)*(_e-1)/(He-1):0,fr=Ye>1?(Bn-ln)*(Te-1)/(Ye-1):0,br=0;br<He;br++){var _r=He>1?sn*(_e-1)+br*or:.5*(sn+Tn)*(_e-1);if(_r<0||_r>_e-1)for(var xr=0;xr<Ye;xr++)for(var vr=0;vr<Ne;vr++){var Pr=vr+xr*zt[2]+br*zt[1]+an*zt[0];Ke.values[Pr]=ee}else if(K==="bilinear"){var Rr=Math.floor(_r),Qr=Math.ceil(_r),fi=_r-Rr;for(xr=0;xr<Ye;xr++)if((so=Ye>1?ln*(Te-1)+xr*fr:.5*(ln+Bn)*(Te-1))<0||so>Te-1)for(vr=0;vr<Ne;vr++)Pr=vr+xr*zt[2]+br*zt[1]+an*zt[0],Ke.values[Pr]=ee;else{var Ci=Math.floor(so),bo=Math.ceil(so),xo=so-Ci;for(vr=0;vr<Ne;vr++){var Mo=wt[Pr=vr+Ci*At[2]+Rr*At[1]+In*At[0]],Oo=wt[Pr=vr+bo*At[2]+Rr*At[1]+In*At[0]],Vo=wt[Pr=vr+Ci*At[2]+Qr*At[1]+In*At[0]],ua=Mo+(Oo-Mo)*xo,$a=Vo+(wt[Pr=vr+bo*At[2]+Qr*At[1]+In*At[0]]-Vo)*xo;Pr=vr+xr*zt[2]+br*zt[1]+an*zt[0],Ke.values[Pr]=ua+($a-ua)*fi}}}else for(xr=0;xr<Ye;++xr){var so;if((so=Ye>1?ln*(Te-1)+xr*fr:.5*(ln+Bn)*(Te-1))<0||so>Te-1)for(vr=0;vr<Ne;vr++)Pr=vr+xr*zt[2]+br*zt[1]+an*zt[0],Ke.values[Pr]=ee;else{var Do=Math.round(so),Ko=Math.round(_r);for(vr=0;vr<Ne;vr++){var Su=vr+Do*At[2]+Ko*At[1]+In*At[0],Ks=vr+xr*zt[2]+br*zt[1]+an*zt[0];Ke.values[Ks]=wt[Su]}}}}}return Ke.toTensor()},h.prototype.sparseToDense=function(c,m,w,R){var K=Il(0,c,w),ee=K.sliceRank,le=K.numUpdates,de=K.sliceSize,_e=K.strides,Te=K.outputSize;return this.scatter(c,m,w,Te,de,le,ee,_e,R,!1)},h.prototype.gatherND=function(c,m){var w=m.shape,R=w[w.length-1],K=uu(c,m),ee=K[0],le=K[1],de=K[2],_e=K[3];if(le===0)return To([],ee,c.dtype);for(var Te=new Hr([le,de],c.dtype),Ne=this.readSync(m.dataId),Fe=this.readSync(c.dataId),He=0;He<le;He++){for(var Ye=[],Ke=0,it=0;it<R;it++){var gt=Ne[He*R+it];Ke+=gt*_e[it],Ye.push(gt)}if(Ke<0||Ke>=c.size/de)throw new Error("Invalid indices: "+Ye+" does not index into "+c.shape);for(var wt=0;wt<de;wt++)Te.values[He*de+wt]=Fe[Ke*de+wt]}return Te.toTensor().reshape(ee)},h.prototype.scatterND=function(c,m,w){var R=Il(0,c,w),K=R.sliceRank,ee=R.numUpdates,le=R.sliceSize,de=R.strides,_e=R.outputSize,Te=kr(0);return this.scatter(c,m,w,_e,le,ee,K,de,Te,!0)},h.prototype.fill=function(c,m,w){var R=cn(w=w||ke(m),ze(c));return R.fill(m),Ve.makeTensor(R,c,w,this)},h.prototype.onesLike=function(c){if(c.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(c.shape,1,c.dtype)},h.prototype.zerosLike=function(c){var m=cn(c.dtype,ze(c.shape));return this.makeOutput(m,c.shape,c.dtype)},h.prototype.linspace=function(c,m,w){return _i(c,m,w)},h.prototype.scatter=function(c,m,w,R,K,ee,le,de,_e,Te){var Ne=[R/K,K],Fe=this.readSync(c.dataId),He=this.readSync(m.dataId);if(R===0)return To([],w,m.dtype);var Ye=new Hr(Ne,m.dtype);Ye.values.fill(this.readSync(_e.dataId)[0]);for(var Ke=0;Ke<ee;Ke++){for(var it=[],gt=0,wt=0;wt<le;wt++){var At=Fe[Ke*le+wt];it.push(At),gt+=At*de[wt]}if(gt<0||gt>=R/K)throw new Error("Invalid indices: "+it+" does not index into "+w);for(var zt=0;zt<K;zt++)Te?Ye.values[gt*K+zt]+=He[Ke*K+zt]:Ye.values[gt*K+zt]=m.rank===0?He[0]:He[Ke*K+zt]}return Ye.toTensor().reshape(w)},h}(on);function jr(b,h){return{kernelName:b,backendName:"cpu",kernelFunc:function(c){var m=c.inputs,w=c.backend,R=m,K=R.a,ee=R.b,le=w;Cn([K,ee],b);var de=le.data.get(K.dataId).values,_e=le.data.get(ee.dataId).values,Te=h(K.shape,ee.shape,de,_e,K.dtype),Ne=Te[0],Fe=Te[1];return{dataId:le.write(Ne,Fe,K.dtype),shape:Fe,dtype:K.dtype}}}}function Si(b){return function(h,c,m,w,R){var K=qi(h,c),ee=K.length,le=rn(K),de=Rn(R,ze(K)),_e=h.length,Te=c.length,Ne=rn(h),Fe=rn(c),He=La(h,K),Ye=La(c,K);if(He.length+Ye.length===0)for(var Ke=0;Ke<de.length;++Ke)de[Ke]=b(m[Ke%m.length],w[Ke%w.length]);else{var it=function(gt){var wt=sr(gt,ee,le),At=wt.slice(-_e);He.forEach(function(sn){return At[sn]=0});var zt=ur(At,_e,Ne),an=wt.slice(-Te);Ye.forEach(function(sn){return an[sn]=0});var dn=ur(an,Te,Fe);de[gt]=b(m[zt],w[dn])};for(Ke=0;Ke<de.length;++Ke)it(Ke)}return[de,K]}}Ve.registerBackend("cpu",function(){return new Yr},1);var Fi=Si(function(b,h){return b/h}),Ni=jr(Go,Fi),Ao={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(b){var h=b.inputs,c=b.attrs,m=b.backend,w=h.x,R=c,K=R.filterSize,ee=R.strides,le=R.pad,de=R.includeBatchInIndex,_e=m;Cn(w,"MaxPoolWithArgmax");var Te=_e.data.get(w.dataId).values,Ne=Mn(w.shape,K,ee,[1,1],le),Fe=function(gt,wt,At,zt,an){var dn=wr(gt,0,At,rn(wt),an,"max"),sn=Dr(gt,wt,At,an,!0,zt);return[dn.values,sn.values]}(Te,w.shape,w.dtype,de,Ne),He=Fe[0],Ye=Fe[1],Ke=_e.write(He,Ne.outShape,w.dtype),it=_e.write(Ye,Ne.outShape,w.dtype);return[{dataId:Ke,shape:Ne.outShape,dtype:w.dtype},{dataId:it,shape:Ne.outShape,dtype:"int32"}]}},Xo={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(b){var h=b.inputs,c=b.backend,m=b.attrs,w=h,R=w.boxes,K=w.scores,ee=m,le=ee.maxOutputSize,de=ee.iouThreshold,_e=ee.scoreThreshold,Te=ee.softNmsSigma,Ne=c;Cn(R,"NonMaxSuppressionWithScore");var Fe=Wo(Ne.data.get(R.dataId).values,Ne.data.get(K.dataId).values,le,de,_e,Te);return[Fe.selectedIndices,Fe.selectedScores]}},Po={kernelName:"Square",backendName:"cpu",kernelFunc:function(b){var h=b.inputs,c=b.backend,m=h.x,w=c;Cn(m,"square");for(var R=w.data.get(m.dataId).values,K=new Float32Array(R.length),ee=0;ee<R.length;++ee){var le=R[ee];K[ee]=le*le}return{dataId:w.write(K,m.shape,m.dtype),shape:m.shape,dtype:m.dtype}}},Ro=Si(function(b,h){var c=b-h;return c*c});function Uo(b,h,c,m,w){for(var R=ze(h),K=h.length,ee=rn(h),le=rn(w),de=Rn(c,ze(w)),_e=0;_e<R;++_e){for(var Te=sr(_e,K,ee),Ne=new Array(Te.length),Fe=0;Fe<Ne.length;Fe++)Ne[Fe]=Te[m[Fe]];de[ur(Ne,K,le)]=b[_e]}return de}for(var sa=0,pa=[Xo,Po,jr(pf,Ro),Ni,{kernelName:"Transpose",backendName:"cpu",kernelFunc:function(b){var h=b.inputs,c=b.attrs,m=b.backend,w=h.x,R=c.perm,K=m;Cn(w,"transpose");for(var ee=w.shape.length,le=new Array(ee),de=0;de<le.length;de++)le[de]=w.shape[R[de]];var _e=Uo(K.data.get(w.dataId).values,w.shape,w.dtype,R,le);return{dataId:K.write(_e,le,w.dtype),shape:le,dtype:w.dtype}}},Ao];sa<pa.length;sa++)ce(pa[sa]);for(var Da,du=0,Ri=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(b){var h=b.inputs,c=b.backend,m=b.attrs,w=h.pixels,R=m.numChannels,K=typeof HTMLVideoElement<"u"&&w instanceof HTMLVideoElement,ee=typeof HTMLImageElement<"u"&&w instanceof HTMLImageElement,le=K?[w.videoWidth,w.videoHeight]:[w.width,w.height],de=le[0],_e=le[1],Te=[_e,de],Ne=[_e,de,R];(ee||K)&&(Da==null&&(Da=document.createElement("canvas").getContext("2d")),Da.canvas.width=de,Da.canvas.height=_e,Da.drawImage(w,0,0,de,_e),w=Da.canvas);var Fe=c.makeTensorInfo(Te,"int32");c.texData.get(Fe.dataId).usage=cr.PIXELS,c.gpgpu.uploadPixelDataToTexture(c.getTexture(Fe.dataId),w);var He=z().getBool("WEBGL_PACK")?new function(Ke){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var it=ko(),gt=Ke[0],wt=Ke[1];this.outputShape=Ke,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+wt+".0, "+gt+`.0);
            vec4 values = `+it.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+it.output+` = result;
      }
    `}(Ne):new function(Ke){this.variableNames=["A"];var it=ko(),gt=Ke[0],wt=Ke[1];this.outputShape=Ke,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+wt+".0, "+gt+`.0);

        vec4 values = `+it.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}(Ne),Ye=c.runWebGLProgram(He,[Fe],"int32");return c.disposeData(Fe.dataId),Ye}},{kernelName:Go,backendName:"webgl",kernelFunc:function(b){var h=b.inputs,c=b.backend,m=h;return function(w,R,K){var ee=new $o(`
if (a == b) {
  return 1.0;
};
return a / b;`,w.shape,R.shape);return z().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(ee=new Ga(`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,w.shape,R.shape,!0)),K.runWebGLProgram(ee,[w,R],"float32")}(m.a,m.b,c)}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(b){var h=b.inputs,c=b.backend,m=b.attrs;kl("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var w=h,R=w.boxes,K=w.scores,ee=m,le=ee.maxOutputSize,de=ee.iouThreshold,_e=ee.scoreThreshold,Te=ee.softNmsSigma,Ne=c,Fe=Wo(Ne.readSync(R.dataId),Ne.readSync(K.dataId),le,de,_e,Te);return[Fe.selectedIndices,Fe.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(b){var h=b.inputs,c=b.backend,m=h.x,w=c,R=new yo(m.shape,"return x * x;");return w.runWebGLProgram(R,[m],m.dtype)}},{kernelName:pf,backendName:"webgl",kernelFunc:function(b){var h=b.inputs,c=b.backend,m=h,w=m.a,R=m.b,K=c,ee=z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ga("return (a - b) * (a - b);",w.shape,R.shape):new $o("return (a - b) * (a - b);",w.shape,R.shape);return K.compileAndRun(ee,[w,R])}},{kernelName:"Transpose",backendName:"webgl",kernelFunc:function(b){for(var h,c=b.inputs,m=b.attrs,w=b.backend,R=c.x,K=m.perm,ee=w,le=R.shape.length,de=new Array(le),_e=0;_e<de.length;_e++)de[_e]=R.shape[K[_e]];if(ee.shouldExecuteOnCPU([R])){var Te=Uo(ee.texData.get(R.dataId).values,R.shape,R.dtype,K,de);h=ee.makeTensorInfo(de,R.dtype),ee.texData.get(h.dataId).values=Te}else h=function(Ne,Fe,He){var Ye=z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(Ke,it){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var gt=new Array(Ke.length),wt=0;wt<gt.length;wt++)gt[wt]=Ke[it[wt]];if(this.outputShape=gt,this.rank=gt.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var At=jo(this.rank),zt=ls("rc",this.rank),an=new Array(this.rank);for(wt=0;wt<it.length;wt++)an[it[wt]]=zt[wt];var dn="vec2("+an.slice(-2).join()+")",sn="++"+zt[this.rank-1]+" < "+gt[this.rank-1],ln="getChannel(getA("+an.join()+"), "+dn+")";this.userCode=`
    void main() {
      `+At+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+ln+`;
      if(`+sn+`) {
        result[1] = `+ln+`;
      }
      --`+zt[this.rank-1]+`;
      if(++`+zt[this.rank-2]+" < "+gt[this.rank-2]+`) {
        result[2] = `+ln+`;
        if(`+sn+`) {
          result[3] = `+ln+`;
        }
      }
      setOutput(result);
    }
    `}(Ne.shape,Fe):new function(Ke,it){this.variableNames=["A"];for(var gt=new Array(Ke.length),wt=0;wt<gt.length;wt++)gt[wt]=Ke[it[wt]];this.outputShape=gt,this.rank=gt.length;var At=jo(this.rank),zt=function(an){var dn=an.length;if(dn>6)throw Error("Transpose for rank "+dn+" is not yet supported");for(var sn=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],ln=new Array(dn),Tn=0;Tn<an.length;Tn++)ln[an[Tn]]=sn[Tn];return ln.join()}(it);this.userCode=`
    void main() {
      `+At+` resRC = getOutputCoords();
      setOutput(getA(`+zt+`));
    }
    `}(Ne.shape,Fe);return He.runWebGLProgram(Ye,[Ne],Ne.dtype)}(R,K,ee);return h}},{kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(b){var h=b.inputs,c=b.attrs,m=b.backend,w=h.x,R=c,K=R.filterSize,ee=R.strides,le=R.pad,de=R.includeBatchInIndex,_e=m;we(w.shape.length===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+w.shape.length+"."});var Te=[1,1];we(Ir(ee,Te),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+ee+" and dilations '"+Te+"'"});var Ne=Mn(w.shape,K,ee,Te,le),Fe=function(He,Ye,Ke,it){var gt=new Wh(Ke,"max",!1),wt=it.runWebGLProgram(gt,[He],"float32");return gt=new Wh(Ke,"max",!0,!0,Ye),[wt,it.runWebGLProgram(gt,[He],"float32")]}(w,de,Ne,_e);return[Fe[0],Fe[1]]}}];du<Ri.length;du++)ce(Ri[du]);for(var Qa=0,is=[{kernelName:hf,inputsToSave:["a","b"],gradFunc:function(b,h){var c=h[0],m=h[1],w=qi(c.shape,m.shape);return{a:function(){var R=b,K=Wa(c.shape,w);return K.length>0&&(R=R.sum(K)),R.reshape(c.shape)},b:function(){var R=b,K=Wa(m.shape,w);return K.length>0&&(R=R.sum(K)),R.reshape(m.shape)}}}},{kernelName:"AddN",saveAllInputs:!0,gradFunc:function(b,h){var c={};return h.forEach(function(m,w){c[w]=function(){return b.clone()}}),c}},{kernelName:el,gradFunc:function(b,h,c){for(var m=c,w=m.inputShape,R=m.shape,K=Array.from(R),ee=w.length-1;ee>=0;ee--)if(w[ee]===R[ee])K[ee]=1;else if(w[ee]!==1)throw new Error("broadcastTo(): ["+w+"] cannot be broadcast to ["+R+"].");var le=[];for(ee=0;ee<K.length;ee++)K[ee]>1&&le.push(ee);return{x:function(){return b.sum(le,!0)}}}},{kernelName:Go,inputsToSave:["a","b"],gradFunc:function(b,h){var c=h[0],m=h[1],w=qi(c.shape,m.shape);return{a:function(){var R=ra(b,m.toFloat()),K=Wa(c.shape,w);return K.length>0?ql(R,K).reshape(c.shape):R},b:function(){var R=b.mul(c.toFloat()),K=Wa(m.shape,w);K.length>0&&(R=ql(R,K).reshape(m.shape));var ee=If(m);return Oa(ra(R,ee.toFloat()))}}}},{kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(b,h,c){var m=c.varianceEpsilon,w=h[0],R=h[1],K=h[2],ee=h[3],le=bv(w),de=ee??kr(1),_e=Wa(R.shape,le.shape),Te=[];if(R.rank===1){for(var Ne=0;Ne<le.shape.length-1;++Ne)Te.push(le.shape[Ne]);Te.push(1)}var Fe=Ba(w,R),He=na(b,de),Ye=xf(la(K,kr(m))),Ke=na(na(na(Ye,Ye),Ye),kr(-.5));return{x:function(){return R.rank===1?Fs(na(na(b,Bd(Ye.as4D(1,1,1,R.shape[0]),Te)),de),w.shape):Fs(na(na(b,Ye),de),w.shape)},mean:function(){var it=na(na(Ye,kr(-1)),He);return R.rank===1&&(it=ql(it,_e)),Fs(it,R.shape)},variance:function(){var it=na(na(Ke,Fe),He);return R.rank===1&&(it=ql(it,_e)),Fs(it,R.shape)},scale:function(){var it=na(Fe,Ye),gt=na(b,it);return R.rank===1&&(gt=ql(gt,_e)),Fs(gt,R.shape)},offset:function(){var it=b;return R.rank===1&&(it=ql(it,_e)),Fs(it,R.shape)}}}},{kernelName:yd,gradFunc:function(b){return{x:function(){return b.toFloat()}}}},{kernelName:Ph,inputsToSave:["indices"],gradFunc:function(b,h){var c=h[0];return{indices:function(){return ao(c.shape,"float32")}}}},{kernelName:tl,inputsToSave:["x"],gradFunc:function(b,h,c){var m=h[0],w=c.paddings.map(function(R){return R[0]});return{x:function(){return b.slice(w,m.shape)}}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:function(b,h){var c=h[0];return{x:function(){return b.mul(c.toFloat().mul(2))}}}},{kernelName:pf,inputsToSave:["a","b"],gradFunc:function(b,h){var c=h[0],m=h[1],w=kr(2);return{a:function(){return na(b,na(w,Ba(c,m)))},b:function(){return na(b,na(w,Ba(m,c)))}}}},{kernelName:gf,inputsToSave:["x"],gradFunc:function(b,h,c){var m=h[0],w=c.reps;return{x:function(){var R=mi(m);if(m.rank===1)for(var K=0;K<w[0];++K)R=R.add(b.slice([K*m.shape[0]],[m.shape[0]]));else if(m.rank===2)for(K=0;K<w[0];++K)for(var ee=0;ee<w[1];++ee)R=R.add(b.slice([K*m.shape[0],ee*m.shape[1]],[m.shape[0],m.shape[1]]));else if(m.rank===3)for(K=0;K<w[0];++K)for(ee=0;ee<w[1];++ee)for(var le=0;le<w[2];++le)R=R.add(b.slice([K*m.shape[0],ee*m.shape[1],le*m.shape[2]],[m.shape[0],m.shape[1],m.shape[2]]));else{if(m.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+m.rank+" tensors yet.");for(K=0;K<w[0];++K)for(ee=0;ee<w[1];++ee)for(le=0;le<w[2];++le)for(var de=0;de<w[3];++de)R=R.add(b.slice([K*m.shape[0],ee*m.shape[1],le*m.shape[2],de*m.shape[3]],[m.shape[0],m.shape[1],m.shape[2],m.shape[3]]))}return R}}}},{kernelName:"Transpose",gradFunc:function(b,h,c){var m=Vu(c.perm);return{x:function(){return vt(b,m)}}}}];Qa<is.length;Qa++)be(is[Qa]);var hu=function(){function b(){}return b.prototype.fetch=function(h,c){return fetch(h,c)},b.prototype.now=function(){return performance.now()},b.prototype.encode=function(h,c){if(c!=="utf-8"&&c!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+c);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(h)},b.prototype.decode=function(h,c){return new TextDecoder(c).decode(h)},b}();z().get("IS_BROWSER")&&z().setPlatform("browser",new hu);var zs,Iu=function(){function b(){this.util=r(388),this.textEncoder=new this.util.TextEncoder}return b.prototype.fetch=function(h,c){return z().global.fetch!=null?z().global.fetch(h,c):(zs==null&&(zs=r(389)),zs(h,c))},b.prototype.now=function(){var h=C.hrtime();return 1e3*h[0]+h[1]/1e6},b.prototype.encode=function(h,c){if(c!=="utf-8"&&c!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+c);return this.textEncoder.encode(h)},b.prototype.decode=function(h,c){return h.length===0?"":new this.util.TextDecoder(c).decode(h)},b}();z().get("IS_NODE")&&z().setPlatform("node",new Iu);var Fu={float32:4,int32:4,uint16:2,uint8:1,bool:1},Ru=4;function rp(b,h){for(var c={},m=0,w=function(ee){var le=ee.name,de=ee.dtype,_e=ee.shape,Te=ze(_e),Ne=void 0;if("quantization"in ee){var Fe=ee.quantization;if(Fe.dtype!=="uint8"&&Fe.dtype!=="uint16")throw new Error("Weight "+ee.name+" has unknown quantization dtype "+Fe.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var He=Fu[Fe.dtype],Ye=b.slice(m,m+Te*He),Ke=Fe.dtype==="uint8"?new Uint8Array(Ye):new Uint16Array(Ye);if(de==="float32")Ne=Float32Array.from(Ke,function(an){return an*Fe.scale+Fe.min});else{if(de!=="int32")throw new Error("Unsupported dtype in weight '"+le+"': "+de);Ne=Int32Array.from(Ke,function(an){return Math.round(an*Fe.scale+Fe.min)})}m+=Te*He}else if(de==="string"){var it=ze(ee.shape);Ne=[];for(var gt=0;gt<it;gt++){var wt=new Uint32Array(b.slice(m,m+Ru))[0];m+=Ru;var At=new Uint8Array(b.slice(m,m+wt));Ne.push(At),m+=wt}}else{var zt=Fu[de];if(Ye=b.slice(m,m+Te*zt),de==="float32")Ne=new Float32Array(Ye);else if(de==="int32")Ne=new Int32Array(Ye);else{if(de!=="bool")throw new Error("Unsupported dtype in weight '"+le+"': "+de);Ne=new Uint8Array(Ye)}m+=Te*zt}c[le]=To(Ne,_e,de)},R=0,K=h;R<K.length;R++)w(K[R]);return c}var $d=S!==void 0&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function $l(b){return $d?S.byteLength(b):new Blob([b]).size}function zf(b){var h=0;b.forEach(function(w){h+=w.byteLength});var c=new Uint8Array(h),m=0;return b.forEach(function(w){c.set(new Uint8Array(w),m),m+=w.byteLength}),c.buffer}function Xl(b){for(b=b.trim();b.endsWith("/");)b=b.slice(0,b.length-1);var h=b.split("/");return h[h.length-1]}function vc(b){if(b.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:b.modelTopology==null?0:$l(JSON.stringify(b.modelTopology)),weightSpecsBytes:b.weightSpecs==null?0:$l(JSON.stringify(b.weightSpecs)),weightDataBytes:b.weightData==null?0:b.weightData.byteLength}}var qa=function(){function b(){this.saveRouters=[],this.loadRouters=[]}return b.getInstance=function(){return b.instance==null&&(b.instance=new b),b.instance},b.registerSaveRouter=function(h){b.getInstance().saveRouters.push(h)},b.registerLoadRouter=function(h){b.getInstance().loadRouters.push(h)},b.getSaveHandlers=function(h){return b.getHandlers(h,"save")},b.getLoadHandlers=function(h,c){return b.getHandlers(h,"load",c)},b.getHandlers=function(h,c,m){var w=[];return(c==="load"?b.getInstance().loadRouters:b.getInstance().saveRouters).forEach(function(R){var K=R(h,m);K!==null&&w.push(K)}),w},b}(),Uf="://",Xd=function(){function b(){this.managers={}}return b.getInstance=function(){return b.instance==null&&(b.instance=new b),b.instance},b.registerManager=function(h,c){we(h!=null,function(){return"scheme must not be undefined or null."}),h.endsWith(Uf)&&(h=h.slice(0,h.indexOf(Uf))),we(h.length>0,function(){return"scheme must not be an empty string."});var m=b.getInstance();we(m.managers[h]==null,function(){return"A model store manager is already registered for scheme '"+h+"'."}),m.managers[h]=c},b.getManager=function(h){var c=this.getInstance().managers[h];if(c==null)throw new Error("Cannot find model manager for scheme '"+h+"'");return c},b.getSchemes=function(){return Object.keys(this.getInstance().managers)},b}();function ip(b){if(b.indexOf(Uf)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Xd.getSchemes().join(","));return{scheme:b.split(Uf)[0],path:b.split(Uf)[1]}}function Wf(b,h,c){return c===void 0&&(c=!1),N(this,void 0,void 0,function(){var m,w,R,K,ee,le,de,_e,Te;return L(this,function(Ne){switch(Ne.label){case 0:return we(b!==h,function(){return"Old path and new path are the same: '"+b+"'"}),we((m=qa.getLoadHandlers(b)).length>0,function(){return"Copying failed because no load handler is found for source URL "+b+"."}),we(m.length<2,function(){return"Copying failed because more than one ("+m.length+") load handlers for source URL "+b+"."}),w=m[0],we((R=qa.getSaveHandlers(h)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+h+"."}),we(R.length<2,function(){return"Copying failed because more than one ("+m.length+") save handlers for destination URL "+h+"."}),K=R[0],ee=ip(b).scheme,le=ip(b).path,de=ee===ip(b).scheme,[4,w.load()];case 1:return _e=Ne.sent(),c&&de?[4,Xd.getManager(ee).removeModel(le)]:[3,3];case 2:Ne.sent(),Ne.label=3;case 3:return[4,K.save(_e)];case 4:return Te=Ne.sent(),!c||de?[3,6]:[4,Xd.getManager(ee).removeModel(le)];case 5:Ne.sent(),Ne.label=6;case 6:return[2,Te.modelArtifactsInfo]}})})}var ks="models_store",Kd="model_info_store";function op(){if(!z().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var b=window||self,h=b.indexedDB||b.mozIndexedDB||b.webkitIndexedDB||b.msIndexedDB||b.shimIndexedDB;if(h==null)throw new Error("The current browser does not appear to support IndexedDB.");return h}function ap(b){var h=b.result;h.createObjectStore(ks,{keyPath:"modelPath"}),h.createObjectStore(Kd,{keyPath:"modelPath"})}var hl=function(){function b(h){if(this.indexedDB=op(),h==null||!h)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=h}return b.prototype.save=function(h){return N(this,void 0,void 0,function(){return L(this,function(c){if(h.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,h)]})})},b.prototype.load=function(){return N(this,void 0,void 0,function(){return L(this,function(h){return[2,this.databaseAction(this.modelPath)]})})},b.prototype.databaseAction=function(h,c){var m=this;return new Promise(function(w,R){var K=m.indexedDB.open("tensorflowjs",1);K.onupgradeneeded=function(){return ap(K)},K.onsuccess=function(){var ee=K.result;if(c==null){var le=ee.transaction(ks,"readonly"),de=le.objectStore(ks).get(m.modelPath);de.onsuccess=function(){if(de.result==null)return ee.close(),R(new Error("Cannot find model with path '"+m.modelPath+"' in IndexedDB."));w(de.result.modelArtifacts)},de.onerror=function(Ye){return ee.close(),R(de.error)},le.oncomplete=function(){return ee.close()}}else{var _e,Te=vc(c),Ne=ee.transaction(Kd,"readwrite"),Fe=Ne.objectStore(Kd),He=Fe.put({modelPath:m.modelPath,modelArtifactsInfo:Te});He.onsuccess=function(){var Ye=(_e=ee.transaction(ks,"readwrite")).objectStore(ks).put({modelPath:m.modelPath,modelArtifacts:c,modelArtifactsInfo:Te});Ye.onsuccess=function(){return w({modelArtifactsInfo:Te})},Ye.onerror=function(Ke){var it=(Fe=Ne.objectStore(Kd)).delete(m.modelPath);it.onsuccess=function(){return ee.close(),R(Ye.error)},it.onerror=function(gt){return ee.close(),R(Ye.error)}}},He.onerror=function(Ye){return ee.close(),R(He.error)},Ne.oncomplete=function(){_e==null?ee.close():_e.oncomplete=function(){return ee.close()}}}},K.onerror=function(ee){return R(K.error)}})},b.URL_SCHEME="indexeddb://",b}(),Cm=function(b){return z().getBool("IS_BROWSER")&&!Array.isArray(b)&&b.startsWith(hl.URL_SCHEME)?(h=b.slice(hl.URL_SCHEME.length),new hl(h)):null;var h};qa.registerSaveRouter(Cm),qa.registerLoadRouter(Cm);var yc=function(){function b(){this.indexedDB=op()}return b.prototype.listModels=function(){return N(this,void 0,void 0,function(){var h=this;return L(this,function(c){return[2,new Promise(function(m,w){var R=h.indexedDB.open("tensorflowjs",1);R.onupgradeneeded=function(){return ap(R)},R.onsuccess=function(){var K=R.result,ee=K.transaction(Kd,"readonly"),le=ee.objectStore(Kd).getAll();le.onsuccess=function(){for(var de={},_e=0,Te=le.result;_e<Te.length;_e++){var Ne=Te[_e];de[Ne.modelPath]=Ne.modelArtifactsInfo}m(de)},le.onerror=function(de){return K.close(),w(le.error)},ee.oncomplete=function(){return K.close()}},R.onerror=function(K){return w(R.error)}})]})})},b.prototype.removeModel=function(h){return N(this,void 0,void 0,function(){var c=this;return L(this,function(m){var w;return h=(w=h).startsWith(hl.URL_SCHEME)?w.slice(hl.URL_SCHEME.length):w,[2,new Promise(function(R,K){var ee=c.indexedDB.open("tensorflowjs",1);ee.onupgradeneeded=function(){return ap(ee)},ee.onsuccess=function(){var le,de=ee.result,_e=de.transaction(Kd,"readwrite"),Te=_e.objectStore(Kd),Ne=Te.get(h);Ne.onsuccess=function(){if(Ne.result==null)return de.close(),K(new Error("Cannot find model with path '"+h+"' in IndexedDB."));var Fe=Te.delete(h),He=function(){var Ye=(le=de.transaction(ks,"readwrite")).objectStore(ks).delete(h);Ye.onsuccess=function(){return R(Ne.result.modelArtifactsInfo)},Ye.onerror=function(Ke){return K(Ne.error)}};Fe.onsuccess=He,Fe.onerror=function(Ye){return He(),de.close(),K(Ne.error)}},Ne.onerror=function(Fe){return de.close(),K(Ne.error)},_e.oncomplete=function(){le==null?de.close():le.oncomplete=function(){return de.close()}}},ee.onerror=function(le){return K(ee.error)}})]})})},b}();if(z().getBool("IS_BROWSER"))try{Xd.registerManager(hl.URL_SCHEME,new yc)}catch{}var Us="/",tc="tensorflowjs_models",Cs="info",Kl="model_topology",Yd="weight_specs",sp="weight_data",Jd="model_metadata";function Am(b){return{info:[tc,b,Cs].join(Us),topology:[tc,b,Kl].join(Us),weightSpecs:[tc,b,Yd].join(Us),weightData:[tc,b,sp].join(Us),modelMetadata:[tc,b,Jd].join(Us)}}function Yl(b){var h=b.split(Us);if(h.length<3)throw new Error("Invalid key format: "+b);return h.slice(1,h.length-1).join(Us)}var Eu=function(){function b(h){if(!z().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,h==null||!h)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=h,this.keys=Am(this.modelPath)}return b.prototype.save=function(h){return N(this,void 0,void 0,function(){var c,m,w;return L(this,function(R){if(h.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");c=JSON.stringify(h.modelTopology),m=JSON.stringify(h.weightSpecs),w=vc(h);try{return this.LS.setItem(this.keys.info,JSON.stringify(w)),this.LS.setItem(this.keys.topology,c),this.LS.setItem(this.keys.weightSpecs,m),this.LS.setItem(this.keys.weightData,function(K){if($d)return S.from(K).toString("base64");for(var ee=new Uint8Array(K),le="",de=0,_e=ee.length;de<_e;de++)le+=String.fromCharCode(ee[de]);return btoa(le)}(h.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:h.format,generatedBy:h.generatedBy,convertedBy:h.convertedBy,userDefinedMetadata:h.userDefinedMetadata})),[2,{modelArtifactsInfo:w}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+w.modelTopologyBytes+", weightSpecsBytes="+w.weightSpecsBytes+", weightDataBytes="+w.weightDataBytes+".")}return[2]})})},b.prototype.load=function(){return N(this,void 0,void 0,function(){var h,c,m,w,R,K,ee;return L(this,function(le){if((h=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(h.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(c={},(m=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(c.modelTopology=m,(w=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(c.weightSpecs=w,(R=this.LS.getItem(this.keys.modelMetadata))!=null&&(K=JSON.parse(R),c.format=K.format,c.generatedBy=K.generatedBy,c.convertedBy=K.convertedBy,c.userDefinedMetadata=K.userDefinedMetadata),(ee=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return c.weightData=function(de){if($d){var _e=S.from(de,"base64");return _e.buffer.slice(_e.byteOffset,_e.byteOffset+_e.byteLength)}for(var Te=atob(de),Ne=new Uint8Array(Te.length),Fe=0;Fe<Te.length;++Fe)Ne.set([Te.charCodeAt(Fe)],Fe);return Ne.buffer}(ee),[2,c]})})},b.URL_SCHEME="localstorage://",b}(),P1=function(b){return z().getBool("IS_BROWSER")&&!Array.isArray(b)&&b.startsWith(Eu.URL_SCHEME)?(h=b.slice(Eu.URL_SCHEME.length),new Eu(h)):null;var h};qa.registerSaveRouter(P1),qa.registerLoadRouter(P1);var Jl=function(){function b(){we(z().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),we(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return b.prototype.listModels=function(){return N(this,void 0,void 0,function(){var h,c,m,w,R,K;return L(this,function(ee){for(h={},c=tc+Us,m=Us+Cs,w=0;w<this.LS.length;++w)(R=this.LS.key(w)).startsWith(c)&&R.endsWith(m)&&(K=Yl(R),h[K]=JSON.parse(this.LS.getItem(R)));return[2,h]})})},b.prototype.removeModel=function(h){return N(this,void 0,void 0,function(){var c,m;return L(this,function(w){var R;if(h=(R=h).startsWith(Eu.URL_SCHEME)?R.slice(Eu.URL_SCHEME.length):R,c=Am(h),this.LS.getItem(c.info)==null)throw new Error("Cannot find model at path '"+h+"'");return m=JSON.parse(this.LS.getItem(c.info)),this.LS.removeItem(c.info),this.LS.removeItem(c.topology),this.LS.removeItem(c.weightSpecs),this.LS.removeItem(c.weightData),[2,m]})})},b}();if(z().getBool("IS_BROWSER"))try{Xd.registerManager(Eu.URL_SCHEME,new Jl)}catch{}var up="model",L1=".json",B1=".weights.bin";function j1(b){return new Promise(function(h){return setTimeout(h)}).then(b)}var Vv=function(){function b(h){if(!z().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");h.startsWith(b.URL_SCHEME)&&(h=h.slice(b.URL_SCHEME.length)),h!=null&&h.length!==0||(h=up),this.modelTopologyFileName=h+L1,this.weightDataFileName=h+B1}return b.prototype.save=function(h){return N(this,void 0,void 0,function(){var c,m,w,R,K,ee;return L(this,function(le){switch(le.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(c=window.URL.createObjectURL(new Blob([h.weightData],{type:"application/octet-stream"})),!(h.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return m=[{paths:["./"+this.weightDataFileName],weights:h.weightSpecs}],w={modelTopology:h.modelTopology,format:h.format,generatedBy:h.generatedBy,convertedBy:h.convertedBy,weightsManifest:m},R=window.URL.createObjectURL(new Blob([JSON.stringify(w)],{type:"application/json"})),(K=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,K.href=R,[4,j1(function(){return K.dispatchEvent(new MouseEvent("click"))})];case 2:return le.sent(),h.weightData==null?[3,4]:((ee=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,ee.href=c,[4,j1(function(){return ee.dispatchEvent(new MouseEvent("click"))})]);case 3:le.sent(),le.label=4;case 4:return[2,{modelArtifactsInfo:vc(h)}]}})})},b.URL_SCHEME="downloads://",b}(),Ry=function(){function b(h){if(h==null||h.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+h);this.files=h}return b.prototype.load=function(){return N(this,void 0,void 0,function(){var h,c,m=this;return L(this,function(w){return h=this.files[0],c=this.files.slice(1),[2,new Promise(function(R,K){var ee=new FileReader;ee.onload=function(le){var de=JSON.parse(le.target.result),_e=de.modelTopology;if(_e!=null){c.length===0&&R({modelTopology:_e});var Te=de.weightsManifest;if(Te!=null){var Ne;try{Ne=m.checkManifestAndWeightFiles(Te,c)}catch(Ke){return void K(Ke)}var Fe=[],He=[],Ye=[];Te.forEach(function(Ke){Ke.paths.forEach(function(it){He.push(it),Ye.push(null)}),Fe.push.apply(Fe,Ke.weights)}),Te.forEach(function(Ke){Ke.paths.forEach(function(it){var gt=new FileReader;gt.onload=function(wt){var At=wt.target.result,zt=He.indexOf(it);Ye[zt]=At,Ye.indexOf(null)===-1&&R({modelTopology:_e,weightSpecs:Fe,weightData:zf(Ye),format:de.format,generatedBy:de.generatedBy,convertedBy:de.convertedBy,userDefinedMetadata:de.userDefinedMetadata})},gt.onerror=function(wt){return K("Failed to weights data from file of path '"+it+"'.")},gt.readAsArrayBuffer(Ne[it])})})}else K(new Error("weightManifest field is missing from file "+h.name))}else K(new Error("modelTopology field is missing from file "+h.name))},ee.onerror=function(le){return K("Failed to read model topology and weights manifest JSON from file '"+h.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},ee.readAsText(h)})]})})},b.prototype.checkManifestAndWeightFiles=function(h,c){for(var m=[],w=c.map(function(le){return Xl(le.name)}),R={},K=0,ee=h;K<ee.length;K++)ee[K].paths.forEach(function(le){var de=Xl(le);if(m.indexOf(de)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+de+"'");if(m.push(de),w.indexOf(de)===-1)throw new Error("Weight file with basename '"+de+"' is not provided.");R[le]=c[w.indexOf(de)]});if(m.length!==c.length)throw new Error("Mismatch in the number of files in weights manifest ("+m.length+") and the number of weight files provided ("+c.length+").");return R},b}();function Hv(b,h,c,m){(function(R){we(R!=null&&Array.isArray(R)&&R.length>0,function(){return"promises must be a none empty array"})})(b),function(R,K){we(R>=0&&R<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+R}),we(K>=0&&K<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+K}),we(K>=R,function(){return"startFraction must be no more than endFraction, but got startFraction "+R+" and endFraction "+K})}(c=c??0,m=m??1);var w=0;return Promise.all(b.map(function(R){return R.then(function(K){var ee=c+ ++w/b.length*(m-c);return h(ee),K}),R}))}function Py(b,h){return N(this,void 0,void 0,function(){var c,m,w,R,K,ee,le,de,_e;return L(this,function(Te){switch(Te.label){case 0:return h==null&&(h={}),c=h.fetchFunc==null?z().platform.fetch:h.fetchFunc,m=b.map(function(Ne){return c(Ne,h.requestInit,{isBinary:!0})}),w=0,R=.5,h.onProgress!=null?[3,2]:[4,Promise.all(m)];case 1:return K=Te.sent(),[3,4];case 2:return[4,Hv(m,h.onProgress,w,R)];case 3:K=Te.sent(),Te.label=4;case 4:return ee=K.map(function(Ne){return Ne.arrayBuffer()}),le=.5,de=1,h.onProgress!=null?[3,6]:[4,Promise.all(ee)];case 5:return _e=Te.sent(),[3,8];case 6:return[4,Hv(ee,h.onProgress,le,de)];case 7:_e=Te.sent(),Te.label=8;case 8:return[2,_e]}})})}function Uc(b){var h=this;return function(c,m,w){return m===void 0&&(m=""),N(h,void 0,void 0,function(){var R,K,ee,le,de,_e,Te,Ne,Fe,He;return L(this,function(Ye){switch(Ye.label){case 0:if(R=c.map(function(){return!1}),K={},ee=w!=null?w.map(function(){return!1}):[],le=[],c.forEach(function(Ke,it){var gt=0;Ke.weights.forEach(function(wt){var At="quantization"in wt?wt.quantization.dtype:wt.dtype,zt=Fu[At]*ze(wt.shape),an=function(){R[it]=!0,K[it]==null&&(K[it]=[]),K[it].push({manifestEntry:wt,groupOffset:gt,sizeBytes:zt})};w!=null?w.forEach(function(dn,sn){dn===wt.name&&(an(),ee[sn]=!0)}):an(),le.push(wt.name),gt+=zt})}),!ee.every(function(Ke){return Ke}))throw de=w.filter(function(Ke,it){return!ee[it]}),new Error("Could not find weights in manifest with names: "+de.join(", ")+`. 
Manifest JSON has weights with names: `+le.join(", ")+".");return _e=R.reduce(function(Ke,it,gt){return it&&Ke.push(gt),Ke},[]),Te=[],_e.forEach(function(Ke){c[Ke].paths.forEach(function(it){var gt=m+(m.endsWith("/")?"":"/")+it;Te.push(gt)})}),[4,b(Te)];case 1:return Ne=Ye.sent(),Fe={},He=0,_e.forEach(function(Ke){for(var it=c[Ke].paths.length,gt=0,wt=0;wt<it;wt++)gt+=Ne[He+wt].byteLength;for(var At=new ArrayBuffer(gt),zt=new Uint8Array(At),an=0,dn=0;dn<it;dn++){var sn=new Uint8Array(Ne[He+dn]);zt.set(sn,an),an+=sn.byteLength}K[Ke].forEach(function(ln){var Tn=rp(At.slice(ln.groupOffset,ln.groupOffset+ln.sizeBytes),[ln.manifestEntry]);for(var Bn in Tn)Fe[Bn]=Tn[Bn]}),He+=it}),[2,Fe]}})})}}qa.registerSaveRouter(function(b){return z().getBool("IS_BROWSER")&&!Array.isArray(b)&&b.startsWith(Vv.URL_SCHEME)?function(h){return h===void 0&&(h="model"),new Vv(h)}(b.slice(Vv.URL_SCHEME.length)):null});var z1=function(){function b(h,c){if(this.DEFAULT_METHOD="POST",c==null&&(c={}),this.weightPathPrefix=c.weightPathPrefix,this.onProgress=c.onProgress,c.fetchFunc!=null?(we(typeof c.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=c.fetchFunc):this.fetch=z().platform.fetch,we(h!=null&&h.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(h)&&we(h.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+h.length+")."}),this.path=h,c.requestInit!=null&&c.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=c.requestInit||{}}return b.prototype.save=function(h){return N(this,void 0,void 0,function(){var c,m,w,R;return L(this,function(K){switch(K.label){case 0:if(h.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(c=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,m=[{paths:["./model.weights.bin"],weights:h.weightSpecs}],w={modelTopology:h.modelTopology,format:h.format,generatedBy:h.generatedBy,convertedBy:h.convertedBy,userDefinedMetadata:h.userDefinedMetadata,weightsManifest:m},c.body.append("model.json",new Blob([JSON.stringify(w)],{type:"application/json"}),"model.json"),h.weightData!=null&&c.body.append("model.weights.bin",new Blob([h.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,c)];case 1:if((R=K.sent()).ok)return[2,{modelArtifactsInfo:vc(h),responses:[R]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+R.status+".")}})})},b.prototype.load=function(){return N(this,void 0,void 0,function(){var h,c,m,w,R,K,ee,le,de,_e,Te,Ne;return L(this,function(Fe){switch(Fe.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(h=Fe.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+h.status+". Please verify this URL points to the model JSON of the model to load.");Fe.label=2;case 2:return Fe.trys.push([2,4,,5]),[4,h.json()];case 3:return c=Fe.sent(),[3,5];case 4:throw Fe.sent(),m="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?m+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":m+=" Please make sure the server is serving valid JSON for this request.",new Error(m);case 5:if(w=c.modelTopology,R=c.weightsManifest,K=c.generatedBy,ee=c.convertedBy,le=c.format,de=c.userDefinedMetadata,w==null&&R==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return R==null?[3,7]:[4,this.loadWeights(R)];case 6:Ne=Fe.sent(),_e=Ne[0],Te=Ne[1],Fe.label=7;case 7:return[2,{modelTopology:w,weightSpecs:_e,weightData:Te,userDefinedMetadata:de,generatedBy:K,convertedBy:ee,format:le}]}})})},b.prototype.loadWeights=function(h){return N(this,void 0,void 0,function(){var c,m,w,R,K,ee,le,de,_e,Te,Ne;return L(this,function(Fe){switch(Fe.label){case 0:for(c=Array.isArray(this.path)?this.path[1]:this.path,m=function(He){var Ye=He.lastIndexOf("/"),Ke=He.lastIndexOf("?");return[He.substring(0,Ye)+"/",Ke>Ye?He.substring(Ke):""]}(c),w=m[0],R=m[1],K=this.weightPathPrefix||w,ee=[],le=0,de=h;le<de.length;le++)_e=de[le],ee.push.apply(ee,_e.weights);return Te=[],h.forEach(function(He){He.paths.forEach(function(Ye){Te.push(K+Ye+R)})}),[4,Py(Te,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return Ne=Fe.sent(),[2,[ee,zf(Ne)]]}})})},b.URL_SCHEME_REGEX=/^https?:\/\//,b}();function bc(b){return b.match(z1.URL_SCHEME_REGEX)!=null}var Vf=function(b,h){return typeof fetch>"u"?null:(Array.isArray(b)?b.every(function(c){return bc(c)}):bc(b))?_(b,{onProgress:h}):null};function _(b,h){return new z1(b,h)}qa.registerSaveRouter(Vf),qa.registerLoadRouter(Vf);var v,d=function(){function b(h){this.modelArtifacts=h}return b.prototype.load=function(){return N(this,void 0,void 0,function(){return L(this,function(h){return[2,this.modelArtifacts]})})},b}(),y=function(){function b(h){this.saveHandler=h}return b.prototype.save=function(h){return N(this,void 0,void 0,function(){return L(this,function(c){return[2,this.saveHandler(h)]})})},b}(),E=Object.freeze({browserFiles:function(b){return new Ry(b)},browserHTTPRequest:function(b,h){return _(b,h)},concatenateArrayBuffers:zf,decodeWeights:rp,encodeWeights:function(b,h){return N(this,void 0,void 0,function(){var c,m,w,R,K,ee=this;return L(this,function(le){switch(le.label){case 0:for(c=[],m=[],w=Array.isArray(b)?b.map(function(de){return de.name}):Object.keys(b),R=function(de){var _e=w[de],Te=Array.isArray(b)?b[de].tensor:b[_e];if(Te.dtype!=="float32"&&Te.dtype!=="int32"&&Te.dtype!=="bool"&&Te.dtype!=="string")throw new Error("Unsupported dtype in weight '"+_e+"': "+Te.dtype);var Ne={name:_e,shape:Te.shape,dtype:Te.dtype};if(Te.dtype==="string"){var Fe=new Promise(function(He){return N(ee,void 0,void 0,function(){var Ye,Ke,it,gt,wt,At,zt;return L(this,function(an){switch(an.label){case 0:return[4,Te.bytes()];case 1:for(Ye=an.sent(),Ke=Ye.reduce(function(dn,sn){return dn+sn.length},0)+Ru*Ye.length,it=new Uint8Array(Ke),gt=0,wt=0;wt<Ye.length;wt++)At=Ye[wt],zt=new Uint8Array(new Uint32Array([At.length]).buffer),it.set(zt,gt),gt+=Ru,it.set(At,gt),gt+=At.length;return He(it),[2]}})})});m.push(Fe)}else m.push(Te.data());h!=null&&(Ne.group=h),c.push(Ne)},K=0;K<w.length;++K)R(K);return[4,Promise.all(m)];case 1:return[2,{data:function(de){if(de===null)throw new Error("Invalid input value: "+JSON.stringify(de));var _e=0,Te=[];de.forEach(function(He){if(_e+=He.byteLength,Te.push(He.byteLength===He.buffer.byteLength?He:new He.constructor(He)),!(He instanceof Float32Array||He instanceof Int32Array||He instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+He.constructor.name)});var Ne=new Uint8Array(_e),Fe=0;return Te.forEach(function(He){Ne.set(new Uint8Array(He.buffer),Fe),Fe+=He.byteLength}),Ne.buffer}(le.sent()),specs:c}]}})})},fromMemory:function(b,h,c,m){return arguments.length===1?b.modelTopology!=null||b.weightSpecs!=null?new d(b):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new d({modelTopology:b})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new d({modelTopology:b,weightSpecs:h,weightData:c,trainingConfig:m}))},getLoadHandlers:function(b,h){return qa.getLoadHandlers(b,h)},getModelArtifactsInfoForJSON:vc,getSaveHandlers:function(b){return qa.getSaveHandlers(b)},http:_,isHTTPScheme:bc,loadWeights:function(b,h,c,m){return h===void 0&&(h=""),N(this,void 0,void 0,function(){return L(this,function(w){return[2,Uc(function(R){return Py(R,{requestInit:m})})(b,h,c)]})})},registerLoadRouter:function(b){return qa.registerLoadRouter(b)},registerSaveRouter:function(b){return qa.registerSaveRouter(b)},weightsLoaderFactory:Uc,withSaveHandler:function(b){return new y(b)},copyModel:function(b,h){return N(this,void 0,void 0,function(){return L(this,function(c){return[2,Wf(b,h,!1)]})})},listModels:function(){return N(this,void 0,void 0,function(){var b,h,c,m,w,R,K;return L(this,function(ee){switch(ee.label){case 0:b=Xd.getSchemes(),h={},c=0,m=b,ee.label=1;case 1:return c<m.length?(w=m[c],[4,Xd.getManager(w).listModels()]):[3,4];case 2:for(K in R=ee.sent())h[w+Uf+K]=R[K];ee.label=3;case 3:return c++,[3,1];case 4:return[2,h]}})})},moveModel:function(b,h){return N(this,void 0,void 0,function(){return L(this,function(c){return[2,Wf(b,h,!0)]})})},removeModel:function(b){return N(this,void 0,void 0,function(){var h;return L(this,function(c){return h=ip(b),[2,Xd.getManager(h.scheme).removeModel(h.path)]})})}}),B=Pt({confusionMatrix_:function(b,h,c){var m=Ze(b,"labels","confusionMatrix"),w=Ze(h,"predictions","confusionMatrix");we(c==null||c>0&&Number.isInteger(c),function(){return"If provided, numClasses must be a positive integer, but got "+c}),we(m.rank===1,function(){return"Expected the rank of labels to be 1, but got "+m.rank}),we(w.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+w.rank}),we(m.shape[0]===w.shape[0],function(){return"Mismatch in the number of examples: "+m.shape[0]+" vs. "+w.shape[0]+". Labels and predictions should have the same number of elements."}),we(c>0&&Number.isInteger(c),function(){return"numClasses is required to be a positive integer, but got "+c});var R=Lc(m.asType("int32"),c),K=Lc(w.asType("int32"),c);return R.transpose().matMul(K).asType("int32")}}),Q=Object.freeze({confusionMatrix:B}),re=Pt({fromPixels_:function(b,h){if(h===void 0&&(h=3),h>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(b==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var c=!1,m=!1,w=!1,R=!1,K=!1;if(b.data instanceof Uint8Array)c=!0;else if(typeof ImageData<"u"&&b instanceof ImageData)m=!0;else if(typeof HTMLVideoElement<"u"&&b instanceof HTMLVideoElement)w=!0;else if(typeof HTMLImageElement<"u"&&b instanceof HTMLImageElement)R=!0;else{if(b.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+b.constructor.name);K=!0}if(w&&w&&b.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(Y("FromPixels",Ve.backendName)!=null)return Ve.runKernel("FromPixels",{pixels:b},{numChannels:h});var ee,le,de=w?[b.videoWidth,b.videoHeight]:[b.width,b.height],_e=de[0],Te=de[1];if(K?ee=b.getContext("2d").getImageData(0,0,_e,Te).data:m||c?ee=b.data:(R||w)&&(v==null&&(v=document.createElement("canvas").getContext("2d")),v.canvas.width=_e,v.canvas.height=Te,v.drawImage(b,0,0,_e,Te),ee=v.getImageData(0,0,_e,Te).data),h===4)le=new Int32Array(ee);else{var Ne=_e*Te;le=new Int32Array(Ne*h);for(var Fe=0;Fe<Ne;Fe++)for(var He=0;He<h;++He)le[Fe*h+He]=ee[4*Fe+He]}return Cl(le,[Te,_e,h],"int32")}}),fe=Object.freeze({toPixels:function(b,h){return N(this,void 0,void 0,function(){var c,m,w,R,K,ee,le,de,_e,Te,Ne,Fe,He,Ye,Ke,it,gt,wt,At,zt,an,dn,sn;return L(this,function(ln){switch(ln.label){case 0:if(c=Ze(b,"img","toPixels"),b instanceof $t||(c=c.toInt()),c.rank!==2&&c.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+c.rank+".");if(m=c.shape.slice(0,2),w=m[0],R=m[1],(K=c.rank===2?1:c.shape[2])>4||K===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+K);return[4,c.data()];case 1:return ee=ln.sent(),le=c.min(),de=c.max(),[4,Promise.all([le.data(),de.data()])];case 2:if(_e=ln.sent(),Te=_e[0],Ne=_e[1],Fe=Te[0],He=Ne[0],le.dispose(),de.dispose(),c.dtype==="float32"){if(Fe<0||He>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+Fe+" - "+He+"].")}else{if(c.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+c.dtype+". Please use float32 or int32 tensors.");if(Fe<0||He>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+Fe+" - "+He+"].")}for(Ye=c.dtype==="float32"?255:1,Ke=new Uint8ClampedArray(R*w*4),it=0;it<w*R;++it)gt=void 0,wt=void 0,At=void 0,zt=void 0,K===1?(gt=ee[it]*Ye,wt=ee[it]*Ye,At=ee[it]*Ye,zt=255):K===3?(gt=ee[3*it]*Ye,wt=ee[3*it+1]*Ye,At=ee[3*it+2]*Ye,zt=255):K===4&&(gt=ee[4*it]*Ye,wt=ee[4*it+1]*Ye,At=ee[4*it+2]*Ye,zt=ee[4*it+3]*Ye),Ke[0+(an=4*it)]=Math.round(gt),Ke[an+1]=Math.round(wt),Ke[an+2]=Math.round(At),Ke[an+3]=Math.round(zt);return h!=null&&(h.width=R,h.height=w,dn=h.getContext("2d"),sn=new ImageData(Ke,R,w),dn.putImageData(sn,0,0)),c!==b&&c.dispose(),[2,Ke]}})})},fromPixels:re}),xe=function(){function b(){}return b.prototype.getClassName=function(){return this.constructor.className},b.fromConfig=function(h,c){return new h(c)},b}(),Oe=function(){function b(){this.classNameMap={}}return b.getMap=function(){return b.instance==null&&(b.instance=new b),b.instance},b.register=function(h){b.getMap().classNameMap[h.className]=[h,h.fromConfig]},b}();function Re(b){we(b.className!=null,function(){return"Class being registered does not have the static className property defined."}),we(typeof b.className=="string",function(){return"className is required to be a string, but got type "+typeof b.className}),we(b.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),Oe.register(b)}var Le=Object.freeze({Serializable:xe,SerializationMap:Oe,registerClass:Re}),Be="1.7.4",Xe=Object.freeze({gpgpu_util:al,webgl_util:hd,forceHalfFloat:function(){z().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:ng,setWebGLContext:ki,GPGPUContext:n0}),nt=function(b){function h(){return b!==null&&b.apply(this,arguments)||this}return j(h,b),h.prototype.minimize=function(c,m,w){m===void 0&&(m=!1);var R=this.computeGradients(c,w),K=R.value,ee=R.grads;if(w!=null){var le=w.map(function(de){return{name:de.name,tensor:ee[de.name]}});this.applyGradients(le)}else this.applyGradients(ee);return Lo(ee),m?K:(K.dispose(),null)},Object.defineProperty(h.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),h.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},h.prototype.computeGradients=function(c,m){return D(c,m)},h.prototype.dispose=function(){this.iterations_!=null&&Lo(this.iterations_)},h.prototype.saveIterations=function(){return N(this,void 0,void 0,function(){return L(this,function(c){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:kr(this.iterations_,"int32")}]})})},h.prototype.getWeights=function(){return N(this,void 0,void 0,function(){return L(this,function(c){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},h.prototype.setWeights=function(c){return N(this,void 0,void 0,function(){return L(this,function(m){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},h.prototype.extractIterations=function(c){return N(this,void 0,void 0,function(){var m;return L(this,function(w){switch(w.label){case 0:return m=this,[4,c[0].tensor.data()];case 1:return m.iterations_=w.sent()[0],[2,c.slice(1)]}})})},h}(xe);Object.defineProperty(nt,Symbol.hasInstance,{value:function(b){return b.minimize!=null&&b.computeGradients!=null&&b.applyGradients!=null}});var tt=function(b){function h(c,m,w){w===void 0&&(w=null);var R=b.call(this)||this;return R.learningRate=c,R.rho=m,R.epsilon=w,R.accumulatedGrads=[],R.accumulatedUpdates=[],w==null&&(R.epsilon=Ve.backend.epsilon()),R}return j(h,b),h.prototype.applyGradients=function(c){var m=this;(Array.isArray(c)?c.map(function(w){return w.name}):Object.keys(c)).forEach(function(w,R){var K=Ve.registeredVariables[w];m.accumulatedGrads[R]==null&&(m.accumulatedGrads[R]={originalName:w+"/accum_grad",variable:Hi(function(){return mi(K).variable(!1)})}),m.accumulatedUpdates[R]==null&&(m.accumulatedUpdates[R]={originalName:w+"/accum_var",variable:Hi(function(){return mi(K).variable(!1)})});var ee=Array.isArray(c)?c[R].tensor:c[w];if(ee!=null){var le=m.accumulatedGrads[R].variable,de=m.accumulatedUpdates[R].variable;Hi(function(){var _e=le.mul(m.rho).add(ee.square().mul(1-m.rho)),Te=de.add(m.epsilon).sqrt().div(le.add(m.epsilon).sqrt()).mul(ee),Ne=de.mul(m.rho).add(Te.square().mul(1-m.rho));le.assign(_e),de.assign(Ne);var Fe=Te.mul(-m.learningRate).add(K);K.assign(Fe)})}}),this.incrementIterations()},h.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Lo(this.accumulatedGrads.map(function(c){return c.variable})),Lo(this.accumulatedUpdates.map(function(c){return c.variable})))},h.prototype.getWeights=function(){return N(this,void 0,void 0,function(){var c;return L(this,function(m){switch(m.label){case 0:return c=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[m.sent()].concat(c.map(function(w){return{name:w.originalName,tensor:w.variable}}))]}})})},h.prototype.setWeights=function(c){return N(this,void 0,void 0,function(){var m;return L(this,function(w){switch(w.label){case 0:return[4,this.extractIterations(c)];case 1:return c=w.sent(),m=c.length/2,this.accumulatedGrads=c.slice(0,m).map(function(R){return{originalName:R.name,variable:R.tensor.variable(!1)}}),this.accumulatedUpdates=c.slice(m,2*m).map(function(R){return{originalName:R.name,variable:R.tensor.variable(!1)}}),[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},h.fromConfig=function(c,m){return new c(m.learningRate,m.rho,m.epsilon)},h.className="Adadelta",h}(nt);Re(tt);var ut=function(b){function h(c,m){m===void 0&&(m=.1);var w=b.call(this)||this;return w.learningRate=c,w.initialAccumulatorValue=m,w.accumulatedGrads=[],w}return j(h,b),h.prototype.applyGradients=function(c){var m=this;(Array.isArray(c)?c.map(function(w){return w.name}):Object.keys(c)).forEach(function(w,R){var K=Ve.registeredVariables[w];m.accumulatedGrads[R]==null&&(m.accumulatedGrads[R]={originalName:w+"/accumulator",variable:Hi(function(){return Is(K.shape,m.initialAccumulatorValue).variable(!1)})});var ee=Array.isArray(c)?c[R].tensor:c[w];if(ee!=null){var le=m.accumulatedGrads[R].variable;Hi(function(){var de=le.add(ee.square());le.assign(de);var _e=ee.div(de.add(Ve.backend.epsilon()).sqrt()).mul(-m.learningRate).add(K);K.assign(_e)})}}),this.incrementIterations()},h.prototype.dispose=function(){this.accumulatedGrads!=null&&Lo(this.accumulatedGrads.map(function(c){return c.variable}))},h.prototype.getWeights=function(){return N(this,void 0,void 0,function(){return L(this,function(c){switch(c.label){case 0:return[4,this.saveIterations()];case 1:return[2,[c.sent()].concat(this.accumulatedGrads.map(function(m){return{name:m.originalName,tensor:m.variable}}))]}})})},h.prototype.setWeights=function(c){return N(this,void 0,void 0,function(){return L(this,function(m){switch(m.label){case 0:return[4,this.extractIterations(c)];case 1:return c=m.sent(),this.accumulatedGrads=c.map(function(w){return{originalName:w.name,variable:w.tensor.variable(!1)}}),[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},h.fromConfig=function(c,m){return new c(m.learningRate,m.initialAccumulatorValue)},h.className="Adagrad",h}(nt);Re(ut);var Dt=function(b){function h(c,m,w,R){R===void 0&&(R=null);var K=b.call(this)||this;return K.learningRate=c,K.beta1=m,K.beta2=w,K.epsilon=R,K.accumulatedFirstMoment=[],K.accumulatedSecondMoment=[],Hi(function(){K.accBeta1=kr(m).variable(),K.accBeta2=kr(w).variable()}),R==null&&(K.epsilon=Ve.backend.epsilon()),K}return j(h,b),h.prototype.applyGradients=function(c){var m=this,w=Array.isArray(c)?c.map(function(R){return R.name}):Object.keys(c);Hi(function(){var R=Ba(1,m.accBeta1),K=Ba(1,m.accBeta2);w.forEach(function(ee,le){var de=Ve.registeredVariables[ee];m.accumulatedFirstMoment[le]==null&&(m.accumulatedFirstMoment[le]={originalName:ee+"/m",variable:Hi(function(){return mi(de).variable(!1)})}),m.accumulatedSecondMoment[le]==null&&(m.accumulatedSecondMoment[le]={originalName:ee+"/v",variable:Hi(function(){return mi(de).variable(!1)})});var _e=Array.isArray(c)?c[le].tensor:c[ee];if(_e!=null){var Te=m.accumulatedFirstMoment[le].variable,Ne=m.accumulatedSecondMoment[le].variable,Fe=Te.mul(m.beta1).add(_e.mul(1-m.beta1)),He=Ne.mul(m.beta2).add(_e.square().mul(1-m.beta2)),Ye=Fe.div(R),Ke=He.div(K);Te.assign(Fe),Ne.assign(He);var it=Ye.div(Ke.sqrt().add(m.epsilon)).mul(-m.learningRate).add(de);de.assign(it)}}),m.accBeta1.assign(m.accBeta1.mul(m.beta1)),m.accBeta2.assign(m.accBeta2.mul(m.beta2))}),this.incrementIterations()},h.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Lo(this.accumulatedFirstMoment.map(function(c){return c.variable})),this.accumulatedSecondMoment!=null&&Lo(this.accumulatedSecondMoment.map(function(c){return c.variable}))},h.prototype.getWeights=function(){return N(this,void 0,void 0,function(){var c;return L(this,function(m){switch(m.label){case 0:return c=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[m.sent()].concat(c.map(function(w){return{name:w.originalName,tensor:w.variable}}))]}})})},h.prototype.setWeights=function(c){return N(this,void 0,void 0,function(){var m,w=this;return L(this,function(R){switch(R.label){case 0:return[4,this.extractIterations(c)];case 1:return c=R.sent(),Hi(function(){w.accBeta1.assign(su(w.beta1,w.iterations_+1)),w.accBeta2.assign(su(w.beta2,w.iterations_+1))}),m=c.length/2,this.accumulatedFirstMoment=c.slice(0,m).map(function(K){return{originalName:K.name,variable:K.tensor.variable(!1)}}),this.accumulatedSecondMoment=c.slice(m,2*m).map(function(K){return{originalName:K.name,variable:K.tensor.variable(!1)}}),[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},h.fromConfig=function(c,m){return new c(m.learningRate,m.beta1,m.beta2,m.epsilon)},h.className="Adam",h}(nt);Re(Dt);var Rt=function(b){function h(c,m,w,R,K){R===void 0&&(R=null),K===void 0&&(K=0);var ee=b.call(this)||this;return ee.learningRate=c,ee.beta1=m,ee.beta2=w,ee.epsilon=R,ee.decay=K,ee.accumulatedFirstMoment=[],ee.accumulatedWeightedInfNorm=[],Hi(function(){ee.iteration=kr(0).variable(),ee.accBeta1=kr(m).variable()}),R==null&&(ee.epsilon=Ve.backend.epsilon()),ee}return j(h,b),h.prototype.applyGradients=function(c){var m=this,w=Array.isArray(c)?c.map(function(R){return R.name}):Object.keys(c);Hi(function(){var R=Ba(1,m.accBeta1),K=ra(-m.learningRate,m.iteration.mul(m.decay).add(1));w.forEach(function(ee,le){var de=Ve.registeredVariables[ee];m.accumulatedFirstMoment[le]==null&&(m.accumulatedFirstMoment[le]={originalName:ee+"/m",variable:mi(de).variable(!1)}),m.accumulatedWeightedInfNorm[le]==null&&(m.accumulatedWeightedInfNorm[le]={originalName:ee+"/v",variable:mi(de).variable(!1)});var _e=Array.isArray(c)?c[le].tensor:c[ee];if(_e!=null){var Te=m.accumulatedFirstMoment[le].variable,Ne=m.accumulatedWeightedInfNorm[le].variable,Fe=Te.mul(m.beta1).add(_e.mul(1-m.beta1)),He=Ne.mul(m.beta2),Ye=_e.abs(),Ke=He.maximum(Ye);Te.assign(Fe),Ne.assign(Ke);var it=K.div(R).mul(Fe.div(Ke.add(m.epsilon))).add(de);de.assign(it)}}),m.iteration.assign(m.iteration.add(1)),m.accBeta1.assign(m.accBeta1.mul(m.beta1))}),this.incrementIterations()},h.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Lo(this.accumulatedFirstMoment.map(function(c){return c.variable})),this.accumulatedWeightedInfNorm!=null&&Lo(this.accumulatedWeightedInfNorm.map(function(c){return c.variable}))},h.prototype.getWeights=function(){return N(this,void 0,void 0,function(){return L(this,function(c){throw new Error("getWeights() is not implemented for Adamax yet.")})})},h.prototype.setWeights=function(c){return N(this,void 0,void 0,function(){return L(this,function(m){throw new Error("setWeights() is not implemented for Adamax yet.")})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},h.fromConfig=function(c,m){return new c(m.learningRate,m.beta1,m.beta2,m.epsilon,m.decay)},h.className="Adamax",h}(nt);Re(Rt);var Lt=function(b){function h(c){var m=b.call(this)||this;return m.learningRate=c,m.setLearningRate(c),m}return j(h,b),h.prototype.applyGradients=function(c){var m=this;(Array.isArray(c)?c.map(function(w){return w.name}):Object.keys(c)).forEach(function(w,R){var K=Array.isArray(c)?c[R].tensor:c[w];if(K!=null){var ee=Ve.registeredVariables[w];Hi(function(){var le=m.c.mul(K).add(ee);ee.assign(le)})}}),this.incrementIterations()},h.prototype.setLearningRate=function(c){this.learningRate=c,this.c!=null&&this.c.dispose(),this.c=Ch(kr(-c))},h.prototype.dispose=function(){this.c.dispose()},h.prototype.getWeights=function(){return N(this,void 0,void 0,function(){return L(this,function(c){switch(c.label){case 0:return[4,this.saveIterations()];case 1:return[2,[c.sent()]]}})})},h.prototype.setWeights=function(c){return N(this,void 0,void 0,function(){return L(this,function(m){switch(m.label){case 0:return[4,this.extractIterations(c)];case 1:if((c=m.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate}},h.fromConfig=function(c,m){return new c(m.learningRate)},h.className="SGD",h}(nt);Re(Lt);var qt=function(b){function h(c,m,w){w===void 0&&(w=!1);var R=b.call(this,c)||this;return R.learningRate=c,R.momentum=m,R.useNesterov=w,R.accumulations=[],R.m=kr(R.momentum),R}return j(h,b),h.prototype.applyGradients=function(c){var m=this;(Array.isArray(c)?c.map(function(w){return w.name}):Object.keys(c)).forEach(function(w,R){var K=Ve.registeredVariables[w];m.accumulations[R]==null&&(m.accumulations[R]={originalName:w+"/momentum",variable:Hi(function(){return mi(K).variable(!1)})});var ee=m.accumulations[R].variable,le=Array.isArray(c)?c[R].tensor:c[w];le!=null&&Hi(function(){var de,_e=m.m.mul(ee).add(le);de=m.useNesterov?m.c.mul(le.add(_e.mul(m.m))).add(K):m.c.mul(_e).add(K),ee.assign(_e),K.assign(de)})}),this.incrementIterations()},h.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Lo(this.accumulations.map(function(c){return c.variable}))},h.prototype.setMomentum=function(c){this.momentum=c},h.prototype.getWeights=function(){return N(this,void 0,void 0,function(){return L(this,function(c){switch(c.label){case 0:return[4,this.saveIterations()];case 1:return[2,[c.sent()].concat(this.accumulations.map(function(m){return{name:m.originalName,tensor:m.variable}}))]}})})},h.prototype.setWeights=function(c){return N(this,void 0,void 0,function(){return L(this,function(m){switch(m.label){case 0:return[4,this.extractIterations(c)];case 1:return c=m.sent(),this.accumulations=c.map(function(w){return{originalName:w.name,variable:w.tensor.variable(!1)}}),[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},h.fromConfig=function(c,m){return new c(m.learningRate,m.momentum,m.useNesterov)},h.className="Momentum",h}(Lt);Re(qt);var pn=function(b){function h(c,m,w,R,K){m===void 0&&(m=.9),w===void 0&&(w=0),R===void 0&&(R=null),K===void 0&&(K=!1);var ee=b.call(this)||this;if(ee.learningRate=c,ee.decay=m,ee.momentum=w,ee.epsilon=R,ee.accumulatedMeanSquares=[],ee.accumulatedMoments=[],ee.accumulatedMeanGrads=[],ee.centered=K,R==null&&(ee.epsilon=Ve.backend.epsilon()),c==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return ee}return j(h,b),h.prototype.applyGradients=function(c){var m=this;(Array.isArray(c)?c.map(function(w){return w.name}):Object.keys(c)).forEach(function(w,R){var K=Ve.registeredVariables[w];m.accumulatedMeanSquares[R]==null&&(m.accumulatedMeanSquares[R]={originalName:w+"/rms",variable:Hi(function(){return mi(K).variable(!1)})}),m.accumulatedMoments[R]==null&&(m.accumulatedMoments[R]={originalName:w+"/momentum",variable:Hi(function(){return mi(K).variable(!1)})}),m.accumulatedMeanGrads[R]==null&&m.centered&&(m.accumulatedMeanGrads[R]={originalName:w+"/mg",variable:Hi(function(){return mi(K).variable(!1)})});var ee=Array.isArray(c)?c[R].tensor:c[w];if(ee!=null){var le=m.accumulatedMeanSquares[R].variable,de=m.accumulatedMoments[R].variable;Hi(function(){var _e=le.mul(m.decay).add(ee.square().mul(1-m.decay));if(m.centered){var Te=m.accumulatedMeanGrads[R].variable,Ne=Te.mul(m.decay).add(ee.mul(1-m.decay)),Fe=de.mul(m.momentum).add(ee.mul(m.learningRate).div(_e.sub(Ne.square().add(m.epsilon)).sqrt()));le.assign(_e),Te.assign(Ne),de.assign(Fe);var He=K.sub(Fe);K.assign(He)}else{var Ye=le.mul(m.decay).add(ee.square().mul(1-m.decay));Fe=de.mul(m.momentum).add(ee.mul(m.learningRate).div(Ye.add(m.epsilon).sqrt())),le.assign(Ye),de.assign(Fe),He=K.sub(Fe),K.assign(He)}})}}),this.incrementIterations()},h.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Lo(this.accumulatedMeanSquares.map(function(c){return c.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Lo(this.accumulatedMeanGrads.map(function(c){return c.variable})),this.accumulatedMoments!=null&&Lo(this.accumulatedMoments.map(function(c){return c.variable}))},h.prototype.getWeights=function(){return N(this,void 0,void 0,function(){var c;return L(this,function(m){switch(m.label){case 0:return c=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&c.push.apply(c,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[m.sent()].concat(c.map(function(w){return{name:w.originalName,tensor:w.variable}}))]}})})},h.prototype.setWeights=function(c){return N(this,void 0,void 0,function(){var m;return L(this,function(w){switch(w.label){case 0:return[4,this.extractIterations(c)];case 1:return c=w.sent(),m=this.centered?c.length/3:c.length/2,this.accumulatedMeanSquares=c.slice(0,m).map(function(R){return{originalName:R.name,variable:R.tensor.variable(!1)}}),this.accumulatedMoments=c.slice(m,2*m).map(function(R){return{originalName:R.name,variable:R.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=c.slice(2*m,3*m).map(function(R){return{originalName:R.name,variable:R.tensor.variable(!1)}})),[2]}})})},h.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},h.fromConfig=function(c,m){return new c(m.learningRate,m.decay,m.momentum,m.epsilon,m.centered)},h.className="RMSProp",h}(nt);Re(pn);var bn=function(){function b(){}return b.sgd=function(h){return new Lt(h)},b.momentum=function(h,c,m){return m===void 0&&(m=!1),new qt(h,c,m)},b.rmsprop=function(h,c,m,w,R){return c===void 0&&(c=.9),m===void 0&&(m=0),w===void 0&&(w=null),R===void 0&&(R=!1),new pn(h,c,m,w,R)},b.adam=function(h,c,m,w){return h===void 0&&(h=.001),c===void 0&&(c=.9),m===void 0&&(m=.999),w===void 0&&(w=null),new Dt(h,c,m,w)},b.adadelta=function(h,c,m){return h===void 0&&(h=.001),c===void 0&&(c=.95),m===void 0&&(m=null),new tt(h,c,m)},b.adamax=function(h,c,m,w,R){return h===void 0&&(h=.002),c===void 0&&(c=.9),m===void 0&&(m=.999),w===void 0&&(w=null),R===void 0&&(R=0),new Rt(h,c,m,w,R)},b.adagrad=function(h,c){return c===void 0&&(c=.1),new ut(h,c)},b}(),mn={sgd:bn.sgd,momentum:bn.momentum,adadelta:bn.adadelta,adagrad:bn.adagrad,rmsprop:bn.rmsprop,adamax:bn.adamax,adam:bn.adam},Sn=typeof requestAnimationFrame<"u"?requestAnimationFrame:O!==void 0?O:function(b){return b()};function On(){return new Promise(function(b){return Sn(function(){return b()})})}$t.prototype.add=function(b){return la(this,b)},$t.prototype.broadcastTo=function(b){return Df(this,b)},$t.prototype.div=function(b){return ra(this,b)},$t.prototype.divNoNan=function(b){return ig(this,b)},$t.prototype.squaredDifference=function(b){return lg(this,b)},$t.prototype.tile=function(b){return Bd(this,b)},$t.prototype.oneHot=function(b,h,c){return h===void 0&&(h=1),c===void 0&&(c=0),Lc(this,b,h,c)},$t.prototype.transpose=function(b){return vt(this,b)},$t.prototype.pad=function(b,h){return ec(this,b,h)},$t.prototype.batchNorm=function(b,h,c,m,w){return Tf(this,b,h,c,m,w)},Ot=Jn}.call(this,r(59),r(75),r(92).Buffer,r(207).setImmediate)},function(u,s,r){function l(mt,Tt,fn){return mt.fields=Tt||[],mt.fname=fn,mt}function C(mt){return mt==null?null:mt.fname}function S(mt){return mt==null?null:mt.fields}function O(mt){return mt.length===1?U(mt[0]):j(mt)}r.d(s,"a",function(){return ge}),r.d(s,"b",function(){return be}),r.d(s,"c",function(){return ve}),r.d(s,"d",function(){return ce}),r.d(s,"e",function(){return Ee}),r.d(s,"f",function(){return l}),r.d(s,"g",function(){return S}),r.d(s,"h",function(){return C}),r.d(s,"i",function(){return Pn}),r.d(s,"j",function(){return Tr}),r.d(s,"k",function(){return kn}),r.d(s,"l",function(){return ar}),r.d(s,"m",function(){return Xt}),r.d(s,"n",function(){return Wt}),r.d(s,"o",function(){return N}),r.d(s,"p",function(){return Zt}),r.d(s,"q",function(){return Vn}),r.d(s,"r",function(){return xn}),r.d(s,"s",function(){return G}),r.d(s,"t",function(){return Er}),r.d(s,"u",function(){return W}),r.d(s,"v",function(){return Mr}),r.d(s,"w",function(){return ur}),r.d(s,"x",function(){return z}),r.d(s,"y",function(){return q}),r.d(s,"z",function(){return pr}),r.d(s,"A",function(){return ri}),r.d(s,"B",function(){return ht}),r.d(s,"C",function(){return Kr}),r.d(s,"D",function(){return ti}),r.d(s,"E",function(){return Qn}),r.d(s,"F",function(){return jn}),r.d(s,"G",function(){return ir}),r.d(s,"H",function(){return It}),r.d(s,"I",function(){return Cr}),r.d(s,"J",function(){return Hr}),r.d(s,"K",function(){return qr}),r.d(s,"L",function(){return Ot}),r.d(s,"M",function(){return Ge}),r.d(s,"N",function(){return $t}),r.d(s,"O",function(){return Se}),r.d(s,"P",function(){return we}),r.d(s,"Q",function(){return Z}),r.d(s,"R",function(){return Ce}),r.d(s,"S",function(){return _t}),r.d(s,"T",function(){return Yt}),r.d(s,"U",function(){return Fn}),r.d(s,"V",function(){return Rn}),r.d(s,"W",function(){return Mt}),r.d(s,"X",function(){return Jt}),r.d(s,"Y",function(){return me}),r.d(s,"Z",function(){return Me}),r.d(s,"Aa",function(){return L}),r.d(s,"Ba",function(){return rt}),r.d(s,"Ca",function(){return kt}),r.d(s,"Da",function(){return En}),r.d(s,"Ea",function(){return ze}),r.d(s,"Fa",function(){return Kt}),r.d(s,"Ga",function(){return Nt}),r.d(s,"Ha",function(){return hn}),r.d(s,"Ia",function(){return Y}),r.d(s,"Ja",function(){return Qt}),r.d(s,"Ka",function(){return un}),r.d(s,"La",function(){return bt}),r.d(s,"Ma",function(){return I}),r.d(s,"Na",function(){return qe}),r.d(s,"Oa",function(){return Qe}),r.d(s,"Pa",function(){return $e}),r.d(s,"Qa",function(){return ft});const U=mt=>function(Tt){return Tt[mt]},j=mt=>{const Tt=mt.length;return function(fn){for(let tn=0;tn<Tt;++tn)fn=fn[mt[tn]];return fn}};function N(mt){throw Error(mt)}function L(mt){const Tt=[],fn=mt.length;let tn,Ve,Ln,Xn=null,Zn=0,cr="";function Br(){Tt.push(cr+mt.substring(tn,Ve)),cr="",tn=Ve+1}for(mt+="",tn=Ve=0;Ve<fn;++Ve)if((Ln=mt[Ve])==="\\")cr+=mt.substring(tn,Ve),cr+=mt.substring(++Ve,++Ve),tn=Ve;else if(Ln===Xn)Br(),Xn=null,Zn=-1;else{if(Xn)continue;tn===Zn&&Ln==='"'||tn===Zn&&Ln==="'"?(tn=Ve+1,Xn=Ln):Ln!=="."||Zn?Ln==="["?(Ve>tn&&Br(),Zn=tn=Ve+1):Ln==="]"&&(Zn||N("Access path missing open bracket: "+mt),Zn>0&&Br(),Zn=0,tn=Ve+1):Ve>tn?Br():tn=Ve+1}return Zn&&N("Access path missing closing bracket: "+mt),Xn&&N("Access path missing closing quote: "+mt),Ve>tn&&(Ve++,Br()),Tt}function W(mt,Tt,fn){const tn=L(mt);return mt=tn.length===1?tn[0]:mt,l((fn&&fn.get||O)(tn),[mt],Tt||mt)}const z=W("id"),q=l(mt=>mt,[],"identity"),I=l(()=>0,[],"zero"),Z=l(()=>1,[],"one"),Y=l(()=>!0,[],"true"),G=l(()=>!1,[],"false");function oe(mt,Tt,fn){const tn=[Tt].concat([].slice.call(fn));console[mt].apply(console,tn)}const ce=0,be=1,Ee=2,ve=3,ge=4;function Ge(mt,Tt){let fn=mt||ce;return{level(tn){return arguments.length?(fn=+tn,this):fn},error(){return fn>=be&&oe(Tt||"error","ERROR",arguments),this},warn(){return fn>=Ee&&oe(Tt||"warn","WARN",arguments),this},info(){return fn>=ve&&oe(Tt||"log","INFO",arguments),this},debug(){return fn>=ge&&oe(Tt||"log","DEBUG",arguments),this}}}var ht=Array.isArray;function It(mt){return mt===Object(mt)}const St=mt=>mt!=="__proto__";function we(...mt){return mt.reduce((Tt,fn)=>{for(const tn in fn)if(tn==="signals")Tt.signals=jt(Tt.signals,fn.signals);else{const Ve=tn==="legend"?{layout:1}:tn==="style"||null;bt(Tt,tn,fn[tn],Ve)}return Tt},{})}function bt(mt,Tt,fn,tn){if(!St(Tt))return;let Ve,Ln;if(It(fn)&&!ht(fn))for(Ve in Ln=It(mt[Tt])?mt[Tt]:mt[Tt]={},fn)tn&&(tn===!0||tn[Ve])?bt(Ln,Ve,fn[Ve]):St(Ve)&&(Ln[Ve]=fn[Ve]);else mt[Tt]=fn}function jt(mt,Tt){if(mt==null)return Tt;const fn={},tn=[];function Ve(Ln){fn[Ln.name]||(fn[Ln.name]=1,tn.push(Ln))}return Tt.forEach(Ve),mt.forEach(Ve),tn}function Mt(mt){return mt[mt.length-1]}function ze(mt){return mt==null||mt===""?null:+mt}const Ut=mt=>Tt=>mt*Math.exp(Tt),Ft=mt=>Tt=>Math.log(mt*Tt),pt=mt=>Tt=>Math.sign(Tt)*Math.log1p(Math.abs(Tt/mt)),yt=mt=>Tt=>Math.sign(Tt)*Math.expm1(Math.abs(Tt))*mt,nn=mt=>Tt=>Tt<0?-Math.pow(-Tt,mt):Math.pow(Tt,mt);function xt(mt,Tt,fn,tn){const Ve=fn(mt[0]),Ln=fn(Mt(mt)),Xn=(Ln-Ve)*Tt;return[tn(Ve-Xn),tn(Ln-Xn)]}function _t(mt,Tt){return xt(mt,Tt,ze,q)}function Yt(mt,Tt){var fn=Math.sign(mt[0]);return xt(mt,Tt,Ft(fn),Ut(fn))}function Fn(mt,Tt,fn){return xt(mt,Tt,nn(fn),nn(1/fn))}function Rn(mt,Tt,fn){return xt(mt,Tt,pt(fn),yt(fn))}function cn(mt,Tt,fn,tn,Ve){const Ln=tn(mt[0]),Xn=tn(Mt(mt)),Zn=Tt!=null?tn(Tt):(Ln+Xn)/2;return[Ve(Zn+(Ln-Zn)*fn),Ve(Zn+(Xn-Zn)*fn)]}function qe(mt,Tt,fn){return cn(mt,Tt,fn,ze,q)}function Qe(mt,Tt,fn){const tn=Math.sign(mt[0]);return cn(mt,Tt,fn,Ft(tn),Ut(tn))}function $e(mt,Tt,fn,tn){return cn(mt,Tt,fn,nn(tn),nn(1/tn))}function ft(mt,Tt,fn,tn){return cn(mt,Tt,fn,pt(tn),yt(tn))}function Jt(mt){return 1+~~(new Date(mt).getMonth()/3)}function Qt(mt){return 1+~~(new Date(mt).getUTCMonth()/3)}function Pn(mt){return mt!=null?ht(mt)?mt:[mt]:[]}function kn(mt,Tt,fn){let tn,Ve=mt[0],Ln=mt[1];return Ln<Ve&&(tn=Ln,Ln=Ve,Ve=tn),(tn=Ln-Ve)>=fn-Tt?[Tt,fn]:[Ve=Math.min(Math.max(Ve,Tt),fn-tn),Ve+tn]}function Qn(mt){return typeof mt=="function"}const ke="descending";function ar(mt,Tt,fn){fn=fn||{},Tt=Pn(Tt)||[];const tn=[],Ve=[],Ln={},Xn=fn.comparator||rn;return Pn(mt).forEach((Zn,cr)=>{Zn!=null&&(tn.push(Tt[cr]===ke?-1:1),Ve.push(Zn=Qn(Zn)?Zn:W(Zn,null,fn)),(S(Zn)||[]).forEach(Br=>Ln[Br]=1))}),Ve.length===0?null:l(Xn(Ve,tn),Object.keys(Ln))}const Tr=(mt,Tt)=>(mt<Tt||mt==null)&&Tt!=null?-1:(mt>Tt||Tt==null)&&mt!=null?1:(Tt=Tt instanceof Date?+Tt:Tt,(mt=mt instanceof Date?+mt:mt)!==mt&&Tt==Tt?-1:Tt!=Tt&&mt==mt?1:0),rn=(mt,Tt)=>mt.length===1?Ht(mt[0],Tt[0]):Gn(mt,Tt,mt.length),Ht=(mt,Tt)=>function(fn,tn){return Tr(mt(fn),mt(tn))*Tt},Gn=(mt,Tt,fn)=>(Tt.push(0),function(tn,Ve){let Ln,Xn=0,Zn=-1;for(;Xn===0&&++Zn<fn;)Ln=mt[Zn],Xn=Tr(Ln(tn),Ln(Ve));return Xn*Tt[Zn]});function Xt(mt){return Qn(mt)?mt:()=>mt}function Wt(mt,Tt){let fn;return tn=>{fn&&clearTimeout(fn),fn=setTimeout(()=>(Tt(tn),fn=null),mt)}}function Zt(mt){for(let Tt,fn,tn=1,Ve=arguments.length;tn<Ve;++tn)for(fn in Tt=arguments[tn])mt[fn]=Tt[fn];return mt}function Vn(mt,Tt){let fn,tn,Ve,Ln,Xn=0;if(mt&&(fn=mt.length))if(Tt==null){for(tn=mt[Xn];Xn<fn&&(tn==null||tn!=tn);tn=mt[++Xn]);for(Ve=Ln=tn;Xn<fn;++Xn)(tn=mt[Xn])!=null&&(tn<Ve&&(Ve=tn),tn>Ln&&(Ln=tn))}else{for(tn=Tt(mt[Xn]);Xn<fn&&(tn==null||tn!=tn);tn=Tt(mt[++Xn]));for(Ve=Ln=tn;Xn<fn;++Xn)(tn=Tt(mt[Xn]))!=null&&(tn<Ve&&(Ve=tn),tn>Ln&&(Ln=tn))}return[Ve,Ln]}function xn(mt,Tt){const fn=mt.length;let tn,Ve,Ln,Xn,Zn,cr=-1;if(Tt==null){for(;++cr<fn;)if((Ve=mt[cr])!=null&&Ve>=Ve){tn=Ln=Ve;break}if(cr===fn)return[-1,-1];for(Xn=Zn=cr;++cr<fn;)(Ve=mt[cr])!=null&&(tn>Ve&&(tn=Ve,Xn=cr),Ln<Ve&&(Ln=Ve,Zn=cr))}else{for(;++cr<fn;)if((Ve=Tt(mt[cr],cr,mt))!=null&&Ve>=Ve){tn=Ln=Ve;break}if(cr===fn)return[-1,-1];for(Xn=Zn=cr;++cr<fn;)(Ve=Tt(mt[cr],cr,mt))!=null&&(tn>Ve&&(tn=Ve,Xn=cr),Ln<Ve&&(Ln=Ve,Zn=cr))}return[Xn,Zn]}const Un=Object.prototype.hasOwnProperty;function ur(mt,Tt){return Un.call(mt,Tt)}const sr={};function Er(mt){let Tt,fn={};function tn(Ln){return ur(fn,Ln)&&fn[Ln]!==sr}const Ve={size:0,empty:0,object:fn,has:tn,get:Ln=>tn(Ln)?fn[Ln]:void 0,set(Ln,Xn){return tn(Ln)||(++Ve.size,fn[Ln]===sr&&--Ve.empty),fn[Ln]=Xn,this},delete(Ln){return tn(Ln)&&(--Ve.size,++Ve.empty,fn[Ln]=sr),this},clear(){Ve.size=Ve.empty=0,Ve.object=fn={}},test(Ln){return arguments.length?(Tt=Ln,Ve):Tt},clean(){const Ln={};let Xn=0;for(const Zn in fn){const cr=fn[Zn];cr===sr||Tt&&Tt(cr)||(Ln[Zn]=cr,++Xn)}Ve.size=Xn,Ve.empty=0,Ve.object=fn=Ln}};return mt&&Object.keys(mt).forEach(Ln=>{Ve.set(Ln,mt[Ln])}),Ve}function Mr(mt,Tt,fn,tn,Ve,Ln){if(!fn&&fn!==0)return Ln;const Xn=+fn;let Zn,cr=mt[0],Br=Mt(mt);Br<cr&&(Zn=cr,cr=Br,Br=Zn),Zn=Math.abs(Tt-cr);const Sr=Math.abs(Br-Tt);return Zn<Sr&&Zn<=Xn?tn:Sr<=Xn?Ve:Ln}function pr(mt,Tt,fn){const tn=mt.prototype=Object.create(Tt.prototype);return Object.defineProperty(tn,"constructor",{value:mt,writable:!0,enumerable:!0,configurable:!0}),Zt(tn,fn)}function ri(mt,Tt,fn,tn){let Ve,Ln=Tt[0],Xn=Tt[Tt.length-1];return Ln>Xn&&(Ve=Ln,Ln=Xn,Xn=Ve),fn=fn===void 0||fn,tn=tn===void 0||tn,(fn?Ln<=mt:Ln<mt)&&(tn?mt<=Xn:mt<Xn)}function Kr(mt){return typeof mt=="boolean"}function ti(mt){return Object.prototype.toString.call(mt)==="[object Date]"}function jn(mt){return mt&&Qn(mt[Symbol.iterator])}function ir(mt){return typeof mt=="number"}function Cr(mt){return Object.prototype.toString.call(mt)==="[object RegExp]"}function Hr(mt){return typeof mt=="string"}function qr(mt,Tt,fn){mt&&(mt=Tt?Pn(mt).map(Zn=>Zn.replace(/\\(.)/g,"$1")):Pn(mt));const tn=mt&&mt.length,Ve=fn&&fn.get||O,Ln=Zn=>Ve(Tt?[Zn]:L(Zn));let Xn;if(tn)if(tn===1){const Zn=Ln(mt[0]);Xn=function(cr){return""+Zn(cr)}}else{const Zn=mt.map(Ln);Xn=function(cr){let Br=""+Zn[0](cr),Sr=0;for(;++Sr<tn;)Br+="|"+Zn[Sr](cr);return Br}}else Xn=function(){return""};return l(Xn,mt,"key")}function Ot(mt,Tt){const fn=mt[0],tn=Mt(mt),Ve=+Tt;return Ve?Ve===1?tn:fn+Ve*(tn-fn):fn}const Fr=1e4;function $t(mt){let Tt,fn,tn;mt=+mt||Fr;const Ve=()=>{Tt={},fn={},tn=0},Ln=(Xn,Zn)=>(++tn>mt&&(fn=Tt,Tt={},tn=1),Tt[Xn]=Zn);return Ve(),{clear:Ve,has:Xn=>ur(Tt,Xn)||ur(fn,Xn),get:Xn=>ur(Tt,Xn)?Tt[Xn]:ur(fn,Xn)?Ln(Xn,fn[Xn]):void 0,set:(Xn,Zn)=>ur(Tt,Xn)?Tt[Xn]=Zn:Ln(Xn,Zn)}}function Se(mt,Tt,fn,tn){const Ve=Tt.length,Ln=fn.length;if(!Ln)return Tt;if(!Ve)return fn;const Xn=tn||new Tt.constructor(Ve+Ln);let Zn=0,cr=0,Br=0;for(;Zn<Ve&&cr<Ln;++Br)Xn[Br]=mt(Tt[Zn],fn[cr])>0?fn[cr++]:Tt[Zn++];for(;Zn<Ve;++Zn,++Br)Xn[Br]=Tt[Zn];for(;cr<Ln;++cr,++Br)Xn[Br]=fn[cr];return Xn}function me(mt,Tt){let fn="";for(;--Tt>=0;)fn+=mt;return fn}function Ce(mt,Tt,fn,tn){const Ve=fn||" ",Ln=mt+"",Xn=Tt-Ln.length;return Xn<=0?Ln:tn==="left"?me(Ve,Xn)+Ln:tn==="center"?me(Ve,~~(Xn/2))+Ln+me(Ve,Math.ceil(Xn/2)):Ln+me(Ve,Xn)}function Me(mt){return mt&&Mt(mt)-mt[0]||0}function rt(mt){return ht(mt)?"["+mt.map(rt)+"]":It(mt)||Hr(mt)?JSON.stringify(mt).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):mt}function kt(mt){return mt==null||mt===""?null:!(!mt||mt==="false"||mt==="0")&&!!mt}const en=mt=>ir(mt)||ti(mt)?mt:Date.parse(mt);function En(mt,Tt){return Tt=Tt||en,mt==null||mt===""?null:Tt(mt)}function Nt(mt){return mt==null||mt===""?null:mt+""}function Kt(mt){const Tt={},fn=mt.length;for(let tn=0;tn<fn;++tn)Tt[mt[tn]]=!0;return Tt}function hn(mt,Tt,fn,tn){const Ve=tn??"",Ln=mt+"",Xn=Ln.length,Zn=Math.max(0,Tt-Ve.length);return Xn<=Tt?Ln:fn==="left"?Ve+Ln.slice(Xn-Zn):fn==="center"?Ln.slice(0,Math.ceil(Zn/2))+Ve+Ln.slice(Xn-~~(Zn/2)):Ln.slice(0,Zn)+Ve}function un(mt,Tt,fn){if(mt)if(Tt){const tn=mt.length;for(let Ve=0;Ve<tn;++Ve){const Ln=Tt(mt[Ve]);Ln&&fn(Ln,Ve,mt)}}else mt.forEach(fn)}},function(u,s,r){r.r(s);var l=r(0),C=function(ae,ne){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,H){D.__proto__=H}||function(D,H){for(var ue in H)H.hasOwnProperty(ue)&&(D[ue]=H[ue])})(ae,ne)};function S(ae,ne){function D(){this.constructor=ae}C(ae,ne),ae.prototype=ne===null?Object.create(ne):(D.prototype=ne.prototype,new D)}var O,U=function(){return(U=Object.assign||function(ae){for(var ne,D=1,H=arguments.length;D<H;D++)for(var ue in ne=arguments[D])Object.prototype.hasOwnProperty.call(ne,ue)&&(ae[ue]=ne[ue]);return ae}).apply(this,arguments)};function j(ae,ne,D,H){return new(D||(D=Promise))(function(ue,je){function Je(on){try{Gt(H.next(on))}catch(dt){je(dt)}}function vt(on){try{Gt(H.throw(on))}catch(dt){je(dt)}}function Gt(on){on.done?ue(on.value):new D(function(dt){dt(on.value)}).then(Je,vt)}Gt((H=H.apply(ae,ne||[])).next())})}function N(ae,ne){var D,H,ue,je,Je={label:0,sent:function(){if(1&ue[0])throw ue[1];return ue[1]},trys:[],ops:[]};return je={next:vt(0),throw:vt(1),return:vt(2)},typeof Symbol=="function"&&(je[Symbol.iterator]=function(){return this}),je;function vt(Gt){return function(on){return function(dt){if(D)throw new TypeError("Generator is already executing.");for(;Je;)try{if(D=1,H&&(ue=2&dt[0]?H.return:dt[0]?H.throw||((ue=H.return)&&ue.call(H),0):H.next)&&!(ue=ue.call(H,dt[1])).done)return ue;switch(H=0,ue&&(dt=[2&dt[0],ue.value]),dt[0]){case 0:case 1:ue=dt;break;case 4:return Je.label++,{value:dt[1],done:!1};case 5:Je.label++,H=dt[1],dt=[0];continue;case 7:dt=Je.ops.pop(),Je.trys.pop();continue;default:if(!(ue=(ue=Je.trys).length>0&&ue[ue.length-1])&&(dt[0]===6||dt[0]===2)){Je=0;continue}if(dt[0]===3&&(!ue||dt[1]>ue[0]&&dt[1]<ue[3])){Je.label=dt[1];break}if(dt[0]===6&&Je.label<ue[1]){Je.label=ue[1],ue=dt;break}if(ue&&Je.label<ue[2]){Je.label=ue[2],Je.ops.push(dt);break}ue[2]&&Je.ops.pop(),Je.trys.pop();continue}dt=ne.call(ae,Je)}catch(Mn){dt=[6,Mn],H=0}finally{D=ue=0}if(5&dt[0])throw dt[1];return{value:dt[0]?dt[1]:void 0,done:!0}}([Gt,on])}}}function L(){return O==null&&(O=Object(l.backend)().epsilon()),O}var W=function(ae){function ne(D){var H=ae.call(this,D)||this;return Object.setPrototypeOf(H,ne.prototype),H}return S(ne,ae),ne}(Error),z=function(ae){function ne(D){var H=ae.call(this,D)||this;return Object.setPrototypeOf(H,ne.prototype),H}return S(ne,ae),ne}(Error),q=function(ae){function ne(D){var H=ae.call(this,D)||this;return Object.setPrototypeOf(H,ne.prototype),H}return S(ne,ae),ne}(Error),I=function(ae){function ne(D){var H=ae.call(this,D)||this;return Object.setPrototypeOf(H,ne.prototype),H}return S(ne,ae),ne}(Error),Z=function(ae){function ne(D){var H=ae.call(this,D)||this;return Object.setPrototypeOf(H,ne.prototype),H}return S(ne,ae),ne}(Error);(function(ae){function ne(D){var H=ae.call(this,D)||this;return Object.setPrototypeOf(H,ne.prototype),H}S(ne,ae)})(Error);function Y(ae,ne){if(Array.isArray(ae)){for(var D=[],H=0;H<ne;H++)D=D.concat(ae);return D}return(D=new Array(ne)).fill(ae),D}function G(ae,ne){if(!ae)throw new Z(ne)}function oe(ae,ne){for(var D=0,H=0,ue=ae;H<ue.length;H++)ue[H]===ne&&D++;return D}function ce(ae){return ae.length===1?ae[0]:ae}function be(ae){return Array.isArray(ae)?ae:[ae]}function Ee(ae){var ne=ae.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return ne[0]!=="_"?ne:"private"+ne}function ve(ae){return ae.length<=1||ae.indexOf("_")===-1?ae:ae.replace(/[_]+(\w|$)/g,function(ne,D){return D.toUpperCase()})}var ge={};function Ge(ae){if(ae==null)return null;var ne={};return ne.className=ae.getClassName(),ne.config=ae.getConfig(),ne}function ht(ae,ne,D,H,ue){var je,Je,vt;if(ne===void 0&&(ne={}),D===void 0&&(D={}),H===void 0&&(H="object"),ue===void 0&&(ue=!1),typeof ae=="string"){var Gt=ae,on=void 0;if(Gt in D)on=D[Gt];else if(Gt in ge)on=ge[Gt];else if((on=ne[Gt])==null)throw new q("Unknown "+H+": "+ae+`. This may be due to one of the following reasons:
1. The `+H+` is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom `+H+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");return on}var dt=ae;if(dt.className==null||dt.config==null)throw new q(H+": Improper config format: "+JSON.stringify(dt)+`.
'className' and 'config' must set.`);var Mn=dt.className,zn=void 0,Hn=void 0;if(Mn in D?(zn=(je=D[Mn])[0],Hn=je[1]):Mn in ge?(zn=(Je=ge.className)[0],Hn=Je[1]):Mn in ne&&(zn=(vt=ne[Mn])[0],Hn=vt[1]),zn==null)throw new q("Unknown "+H+": "+Mn+`. This may be due to one of the following reasons:
1. The `+H+` is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom `+H+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");if(Hn!=null){for(var nr={},Yn=0,dr=Object.keys(ge);Yn<dr.length;Yn++)nr[ai=dr[Yn]]=ge[ai];for(var gr=0,Ar=Object.keys(D);gr<Ar.length;gr++)nr[ai=Ar[gr]]=D[ai];dt.config.customObjects=nr;for(var Gr=U({},ge),ii=0,Ir=Object.keys(D);ii<Ir.length;ii++){var ai=Ir[ii];ge[ai]=D[ai]}(function oi(pi){if(pi!=null&&typeof pi=="object")if(Array.isArray(pi))pi.forEach(function(ho){return oi(ho)});else for(var fo=0,lo=Object.keys(pi);fo<lo.length;fo++){var qo=lo[fo],$i=pi[qo];$i!=null&&typeof $i=="object"&&(Array.isArray($i)||$i.type!=="ndarray"||typeof $i.value!="number"?oi($i):pi[qo]=$i.value)}})(dt.config);var ni=Hn(zn,dt.config,D,ue);return ge=U({},Gr),ni}Gr=U({},ge);for(var bi=0,_i=Object.keys(D);bi<_i.length;bi++)ai=_i[bi],ge[ai]=D[ai];return ni=new zn(dt.config),ge=U({},Gr),ni}function It(ae,ne){return-1*function(D,H){return D<H?-1:D>H?1:0}(ae,ne)}function St(ae){if(ae==null)return ae;for(var ne=[],D=0,H=ae;D<H.length;D++){var ue=H[D];ne.indexOf(ue)===-1&&ne.push(ue)}return ne}function we(ae){if(ae==null)throw new q("Invalid value in obj: "+JSON.stringify(ae));for(var ne in ae)if(ae.hasOwnProperty(ne))return!1;return!0}function bt(ae,ne,D){if(D!=null&&ae.indexOf(D)<0)throw new q(D+" is not a valid "+ne+".  Valid values are "+ae+" or null/undefined.")}function jt(ae,ne,D,H){return D===void 0&&(D=0),H===void 0&&(H=1/0),G(D>=0),G(H>=D),Array.isArray(ae)&&ae.length>=D&&ae.length<=H&&ae.every(function(ue){return typeof ue===ne})}function Mt(ae,ne){Array.isArray(ae)?(l.util.assert(ae.length>0,function(){return ne+" is unexpectedly an empty array."}),ae.forEach(function(D,H){return Mt(D,"element "+(H+1)+" of "+ne)})):l.util.assert(Number.isInteger(ae)&&ae>0,function(){return"Expected "+ne+" to be a positive integer, but got "+function D(H){return H===null?"null":Array.isArray(H)?"["+H.map(function(ue){return D(ue)}).join(",")+"]":typeof H=="string"?'"'+H+'"':""+H}(ae)+"."})}function ze(ae){return ae==="relu"?"relu":ae==="linear"?"linear":ae==="elu"?"elu":null}function Ut(ae,ne){return Object(l.tidy)(function(){return Object(l.sqrt)(Object(l.sum)(Object(l.mulStrict)(ae,ae),ne,!0))})}var Ft=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne.prototype.getConfig=function(){return{}},ne}(l.serialization.Serializable),pt=function(ae){function ne(D){var H=ae.call(this)||this;return H.defaultMaxValue=2,H.defaultAxis=0,H.maxValue=D.maxValue!=null?D.maxValue:H.defaultMaxValue,H.axis=D.axis!=null?D.axis:H.defaultAxis,H}return S(ne,ae),ne.prototype.apply=function(D){var H=this;return Object(l.tidy)(function(){var ue=Ut(D,H.axis),je=Object(l.clipByValue)(ue,0,H.maxValue);return Object(l.mul)(D,Object(l.div)(je,Object(l.add)(L(),ue)))})},ne.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},ne.className="MaxNorm",ne}(Ft);l.serialization.registerClass(pt);var yt=function(ae){function ne(D){var H=ae.call(this)||this;return H.defaultAxis=0,H.axis=D.axis!=null?D.axis:H.defaultAxis,H}return S(ne,ae),ne.prototype.apply=function(D){var H=this;return Object(l.tidy)(function(){return Object(l.div)(D,Object(l.add)(L(),Ut(D,H.axis)))})},ne.prototype.getConfig=function(){return{axis:this.axis}},ne.className="UnitNorm",ne}(Ft);l.serialization.registerClass(yt);var nn=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne.prototype.apply=function(D){return Object(l.relu)(D)},ne.className="NonNeg",ne}(Ft);l.serialization.registerClass(nn);var xt=function(ae){function ne(D){var H=ae.call(this)||this;return H.defaultMinValue=0,H.defaultMaxValue=1,H.defaultRate=1,H.defaultAxis=0,H.minValue=D.minValue!=null?D.minValue:H.defaultMinValue,H.maxValue=D.maxValue!=null?D.maxValue:H.defaultMaxValue,H.rate=D.rate!=null?D.rate:H.defaultRate,H.axis=D.axis!=null?D.axis:H.defaultAxis,H}return S(ne,ae),ne.prototype.apply=function(D){var H=this;return Object(l.tidy)(function(){var ue=Ut(D,H.axis),je=Object(l.add)(Object(l.mul)(H.rate,Object(l.clipByValue)(ue,H.minValue,H.maxValue)),Object(l.mul)(1-H.rate,ue));return Object(l.mul)(D,Object(l.div)(je,Object(l.add)(L(),ue)))})},ne.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},ne.className="MinMaxNorm",ne}(Ft);l.serialization.registerClass(xt);var _t={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Yt(ae){return Ge(ae)}function Fn(ae,ne){return ne===void 0&&(ne={}),ht(ae,l.serialization.SerializationMap.getMap().classNameMap,ne,"constraint")}function Rn(ae){return ae==null?null:typeof ae=="string"?Fn({className:ae in _t?_t[ae]:ae,config:{}}):ae instanceof Ft?ae:Fn(ae)}var cn=Object.freeze({maxNorm:function(ae){return new pt(ae)},unitNorm:function(ae){return new yt(ae)},nonNeg:function(){return new nn},minMaxNorm:function(ae){return new xt(ae)}}),qe=["channelsFirst","channelsLast"],Qe=["valid","same","causal"],$e=["max","avg"],ft=["sum","mul","concat","ave"],Jt=new Map;function Qt(ae){bt(qe,"DataFormat",ae)}function Pn(ae){bt(Qe,"PaddingMode",ae)}function kn(ae){bt($e,"PoolMode",ae)}var Qn=[],ke="/";function ar(ae,ne){Qn.push(ae);try{var D=ne();return Qn.pop(),D}catch(H){throw Qn.pop(),H}}function Tr(ae){if(!Gn(ae))throw new Error("Not a valid tensor name: '"+ae+"'");return(Qn.length===0?"":Qn.join(ke)+ke)+ae}function rn(ae){if(!Gn(ae))throw new Error("Not a valid tensor name: '"+ae+"'");Jt.has(ae)||Jt.set(ae,0);var ne=Jt.get(ae);if(Jt.set(ae,Jt.get(ae)+1),ne>0){var D=ae+"_"+ne;return Jt.set(D,1),D}return ae}var Ht=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function Gn(ae){return!!ae.match(Ht)}function Xt(ae){return ae===parseInt(ae.toString(),10)}function Wt(ae,ne,D){ne==null&&(ne=0),D==null&&(D=ae.length);for(var H=1,ue=ne;ue<D;++ue)H*=ae[ue];return H}function Zt(ae){return ae=Array.isArray(ae)?new Float32Array(ae):ae,Object(l.tensor1d)(ae)}function Vn(ae){return Object(l.min)(Zt(ae)).dataSync()[0]}function xn(ae){return Object(l.max)(Zt(ae)).dataSync()[0]}function Un(ae,ne){if(ne<ae)throw new q("end ("+ne+") < begin ("+ae+") is forbidden.");for(var D=[],H=ae;H<ne;++H)D.push(H);return D}function ur(ae,ne){return ae.asType(ne)}function sr(ae,ne){ne===void 0&&(ne=-1);var D=ae.shape.slice();return ne<0&&(ne=D.length+ne+1),D.splice(ne,0,1),ae.reshape(D)}function Er(ae,ne,D){return Object(l.tidy)(function(){switch(ae.rank){case 1:return Object(l.slice1d)(ae,ne,D);case 2:return Object(l.slice2d)(ae,[ne,0],[D,ae.shape[1]]);case 3:return Object(l.slice3d)(ae,[ne,0,0],[D,ae.shape[1],ae.shape[2]]);case 4:return Object(l.slice4d)(ae,[ne,0,0,0],[D,ae.shape[1],ae.shape[2],ae.shape[3]]);case 5:return Object(l.slice)(ae,[ne,0,0,0,0],[D,ae.shape[1],ae.shape[2],ae.shape[3],ae.shape[4]]);case 6:return Object(l.slice)(ae,[ne,0,0,0,0,0],[D,ae.shape[1],ae.shape[2],ae.shape[3],ae.shape[4],ae.shape[5]]);default:throw new q("sliceAlongFirstAxis() received an unsupported tensor rank: "+ae.rank)}})}function Mr(ae,ne,D){return Object(l.tidy)(function(){switch(ae.rank){case 1:return Object(l.slice1d)(ae,ne,D);case 2:return Object(l.slice2d)(ae,[0,ne],[ae.shape[0],D]);case 3:return Object(l.slice3d)(ae,[0,0,ne],[ae.shape[0],ae.shape[1],D]);case 4:return Object(l.slice4d)(ae,[0,0,0,ne],[ae.shape[0],ae.shape[1],ae.shape[2],D]);default:throw new q("sliceAlongLastAxis() received an unsupported tensor rank: "+ae.rank)}})}function pr(ae,ne,D,H){return Object(l.tidy)(function(){switch(ae.rank){case 1:return Object(l.slice1d)(ae,ne,D);case 2:switch(H){case 1:return Er(ae,ne,D);case 2:return Mr(ae,ne,D);default:throw new q("The axis is not within the rank of the tensor "+H)}case 3:switch(H){case 1:return Er(ae,ne,D);case 2:return Object(l.slice3d)(ae,[0,ne,0],[ae.shape[0],D,ae.shape[2]]);case 3:return Mr(ae,ne,D);default:throw new q("The axis is not within the rank of the tensor "+H)}case 4:switch(H){case 1:return Er(ae,ne,D);case 2:return Object(l.slice4d)(ae,[0,ne,0,0],[ae.shape[0],D,ae.shape[2],ae.shape[3]]);case 3:return Object(l.slice4d)(ae,[0,0,ne,0],[ae.shape[0],ae.shape[1],D,ae.shape[3]]);case 4:return Mr(ae,ne,D);default:throw new q("The axis is not within the rank of the tensor "+H)}default:throw new q("sliceAlongLastAxis() received an unsupported tensor rank: "+ae.rank)}})}function ri(ae,ne){var D;return ne===void 0&&(ne=-1),ne<0&&(ne=(D=ae[0].rank)!==0?D:0),ne===ae[0].rank&&(ne=-1),Object(l.concat)(ae,ne)}function Kr(ae,ne){switch(ae.rank){case 1:return Object(l.concat1d)([ae,ne]);case 2:return Object(l.concat2d)([ae,ne],0);case 3:return Object(l.concat3d)([ae,ne],0);case 4:return Object(l.concat4d)([ae,ne],0);default:throw new q("concatAlongFirstAxis() received an unsupported tensor rank: "+ae.rank)}}function ti(ae,ne){if(Array.isArray(ne)||(ne=[ne]),ae.rank!==ne.length)throw new q("The length of input n ("+ne.length+") does not match the number of dimensions in input x ("+ae.rank+")");return Object(l.tile)(ae,ne)}function jn(ae,ne,D,H,ue){return ne===void 0&&(ne=0),D===void 0&&(D=1),Object(l.randomNormal)(ae,ne,D,H,ue)}function ir(ae,ne,D,H){if(ae.rank<2||ne.rank<2)throw new I("dot requires both inputs to be rank >= 2 but got x shape = "+ae.shape+" and y shape = "+ne.shape);if(ne.rank>=3&&ae.shape.slice(-1)[0]!==(dt=ne.shape.slice(-2)[0]))throw new I("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = "+ae.shape+" and  y shape = "+ne.shape);if(ae.rank===2&&ne.rank===2){var ue=!1,je=!1;return l.fused.matMul({a:ae,b:ne,transposeA:ue,transposeB:je,bias:H?qr(ae.rank,H,"channelsLast"):null,activation:D})}var Je=ae.shape.slice(),vt=Je.pop();ae=ae.reshape([-1,vt]);var Gt=ne.shape.slice(),on=Gt.pop(),dt=Gt.pop(),Mn=Gt.concat([on]),zn=Array.from({length:ne.rank},function(nr,Yn){return Yn===0?ne.rank-2:Yn<=ne.rank-2?Yn-1:Yn});ne=ne.transpose(zn).reshape([dt,-1]);var Hn=Je.concat(Mn);return ue=!1,je=!1,l.fused.matMul({a:ae,b:ne,transposeA:ue,transposeB:je,bias:H?qr(ae.rank,H,"channelsLast"):null,activation:D}).reshape(Hn)}function Cr(ae,ne,D){return Object(l.tidy)(function(){return ne=Array.isArray(ne)?Object(l.tensor1d)(ne,"int32"):ne.toInt(),Object(l.gather)(ae,ne,D)})}function Hr(ae){return Object(l.mulStrict)(ae,ae)}function qr(ae,ne,D){var H=ne.shape;if(ne.rank!==1&&ne.rank!==ae)throw new q("Unexpected bias dimensions: "+ne.rank+"; expected it to be 1 or "+ae);if(ae===5){if(D==="channelsFirst")return H.length===1?ne.reshape([1,H[0],1,1,1]):ne.reshape([1,H[3],H[0],H[1],H[2]]);if(D==="channelsLast")return H.length===1?ne.reshape([1,1,1,1,H[0]]):ne.reshape([1].concat(H))}else if(ae===4){if(D==="channelsFirst")return H.length===1?ne.reshape([1,H[0],1,1]):ne.reshape([1,H[2],H[0],H[1]]);if(D==="channelsLast")return H.length===1?ne.reshape([1,1,1,H[0]]):ne.reshape([1].concat(H))}else if(ae===3){if(D==="channelsFirst")return H.length===1?ne.reshape([1,H[0],1]):ne.reshape([1,H[1],H[0]]);if(D==="channelsLast")return H.length===1?ne.reshape([1,1,H[0]]):ne.reshape([1].concat(H))}else if(ae<3)return ne;throw new q("Unsupported input rank by biasAdd: "+ne.rank)}function Ot(ae,ne,D){return Object(l.tidy)(function(){return D==null&&(D="channelsLast"),Qt(D),ae.add(qr(ae.rank,ne,D))})}function Fr(ae,ne,D,H){return Object(l.tidy)(function(){return Object(l.dropout)(ae,ne,D,H)})}function $t(ae,ne,D){return D===void 0&&(D=!1),D?ae():ne()}var Se=["fanIn","fanOut","fanAvg"],me=["normal","uniform","truncatedNormal"],Ce=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne.prototype.fromConfigUsesCustomObjects=function(){return!1},ne.prototype.getConfig=function(){return{}},ne}(l.serialization.Serializable),Me=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne.prototype.apply=function(D,H){return Object(l.zeros)(D,H)},ne.className="Zeros",ne}(Ce);l.serialization.registerClass(Me);var rt=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne.prototype.apply=function(D,H){return Object(l.ones)(D,H)},ne.className="Ones",ne}(Ce);l.serialization.registerClass(rt);var kt=function(ae){function ne(D){var H=ae.call(this)||this;if(typeof D!="object")throw new q("Expected argument of type ConstantConfig but got "+D);if(D.value===void 0)throw new q("config must have value set but got "+D);return H.value=D.value,H}return S(ne,ae),ne.prototype.apply=function(D,H){var ue=this;return Object(l.tidy)(function(){return Object(l.mul)(Object(l.scalar)(ue.value),Object(l.ones)(D,H))})},ne.prototype.getConfig=function(){return{value:this.value}},ne.className="Constant",ne}(Ce);l.serialization.registerClass(kt);var en=function(ae){function ne(D){var H=ae.call(this)||this;return H.DEFAULT_MINVAL=-.05,H.DEFAULT_MAXVAL=.05,H.minval=D.minval||H.DEFAULT_MINVAL,H.maxval=D.maxval||H.DEFAULT_MAXVAL,H.seed=D.seed,H}return S(ne,ae),ne.prototype.apply=function(D,H){return Object(l.randomUniform)(D,this.minval,this.maxval,H)},ne.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},ne.className="RandomUniform",ne}(Ce);l.serialization.registerClass(en);var En=function(ae){function ne(D){var H=ae.call(this)||this;return H.DEFAULT_MEAN=0,H.DEFAULT_STDDEV=.05,H.mean=D.mean||H.DEFAULT_MEAN,H.stddev=D.stddev||H.DEFAULT_STDDEV,H.seed=D.seed,H}return S(ne,ae),ne.prototype.apply=function(D,H){if((H=H||"float32")!=="float32"&&H!=="int32")throw new I("randomNormal does not support dType "+H+".");return jn(D,this.mean,this.stddev,H,this.seed)},ne.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},ne.className="RandomNormal",ne}(Ce);l.serialization.registerClass(En);var Nt=function(ae){function ne(D){var H=ae.call(this)||this;return H.DEFAULT_MEAN=0,H.DEFAULT_STDDEV=.05,H.mean=D.mean||H.DEFAULT_MEAN,H.stddev=D.stddev||H.DEFAULT_STDDEV,H.seed=D.seed,H}return S(ne,ae),ne.prototype.apply=function(D,H){if((H=H||"float32")!=="float32"&&H!=="int32")throw new I("truncatedNormal does not support dType "+H+".");return Object(l.truncatedNormal)(D,this.mean,this.stddev,H,this.seed)},ne.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},ne.className="TruncatedNormal",ne}(Ce);l.serialization.registerClass(Nt);var Kt=function(ae){function ne(D){var H=ae.call(this)||this;return H.gain=D.gain!=null?D.gain:1,H}return S(ne,ae),ne.prototype.apply=function(D,H){var ue=this;return Object(l.tidy)(function(){if(D.length!==2||D[0]!==D[1])throw new q("Identity matrix initializer can only be used for 2D square matrices.");return Object(l.mul)(ue.gain,Object(l.eye)(D[0]))})},ne.prototype.getConfig=function(){return{gain:this.gain}},ne.className="Identity",ne}(Ce);l.serialization.registerClass(Kt);var hn=function(ae){function ne(D){var H=ae.call(this)||this;if(D.scale<0)throw new q("scale must be a positive float. Got: "+D.scale);return H.scale=D.scale==null?1:D.scale,H.mode=D.mode==null?"fanIn":D.mode,function(ue){bt(Se,"FanMode",ue)}(H.mode),H.distribution=D.distribution==null?"normal":D.distribution,function(ue){bt(me,"Distribution",ue)}(H.distribution),H.seed=D.seed,H}return S(ne,ae),ne.prototype.apply=function(D,H){var ue=function(dt,Mn){var zn,Hn;if(Mn===void 0&&(Mn="channelsLast"),Qt(Mn),dt.length===2)zn=dt[0],Hn=dt[1];else if([3,4,5].indexOf(dt.length)!==-1)if(Mn==="channelsFirst"){var nr=Wt(dt,2);zn=dt[1]*nr,Hn=dt[0]*nr}else Mn==="channelsLast"&&(nr=Wt(dt,0,dt.length-2),zn=dt[dt.length-2]*nr,Hn=dt[dt.length-1]*nr);else{var Yn=Wt(dt);zn=Math.sqrt(Yn),Hn=Math.sqrt(Yn)}return[zn,Hn]}(D),je=ue[0],Je=ue[1],vt=this.scale;if(this.mode==="fanIn"?vt/=Math.max(1,je):this.mode==="fanOut"?vt/=Math.max(1,Je):vt/=Math.max(1,(je+Je)/2),this.distribution==="normal"){var Gt=Math.sqrt(vt);if((H=H||"float32")!=="float32"&&H!=="int32")throw new I(this.getClassName()+" does not support dType "+H+".");return Object(l.truncatedNormal)(D,0,Gt,H,this.seed)}var on=Math.sqrt(3*vt);return Object(l.randomUniform)(D,-on,on,H)},ne.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},ne.className="VarianceScaling",ne}(Ce);l.serialization.registerClass(hn);var un=function(ae){function ne(D){return ae.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:D==null?null:D.seed})||this}return S(ne,ae),ne.prototype.getClassName=function(){return hn.className},ne.className="GlorotUniform",ne}(hn);l.serialization.registerClass(un);var mt=function(ae){function ne(D){return ae.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:D==null?null:D.seed})||this}return S(ne,ae),ne.prototype.getClassName=function(){return hn.className},ne.className="GlorotNormal",ne}(hn);l.serialization.registerClass(mt);var Tt=function(ae){function ne(D){return ae.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:D==null?null:D.seed})||this}return S(ne,ae),ne.prototype.getClassName=function(){return hn.className},ne.className="HeNormal",ne}(hn);l.serialization.registerClass(Tt);var fn=function(ae){function ne(D){return ae.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:D==null?null:D.seed})||this}return S(ne,ae),ne.prototype.getClassName=function(){return hn.className},ne.className="HeUniform",ne}(hn);l.serialization.registerClass(fn);var tn=function(ae){function ne(D){return ae.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:D==null?null:D.seed})||this}return S(ne,ae),ne.prototype.getClassName=function(){return hn.className},ne.className="LeCunNormal",ne}(hn);l.serialization.registerClass(tn);var Ve=function(ae){function ne(D){return ae.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:D==null?null:D.seed})||this}return S(ne,ae),ne.prototype.getClassName=function(){return hn.className},ne.className="LeCunNormal",ne}(hn);l.serialization.registerClass(Ve);var Ln=function(ae){function ne(D){var H=ae.call(this)||this;if(H.DEFAULT_GAIN=1,H.gain=D.gain==null?H.DEFAULT_GAIN:D.gain,H.seed=D.seed,H.seed!=null)throw new I("Random seed is not implemented for Orthogonal Initializer yet.");return H}return S(ne,ae),ne.prototype.apply=function(D,H){var ue=this;return Object(l.tidy)(function(){if(D.length!==2)throw new I("The Orthogonal Initializer does not support non-2D shapes yet.");D[0]*D[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 ("+D[0]*D[1]+") elements: Slowness may result.");var je=jn(D[0]>D[1]?[D[1],D[0]]:D,0,1,"float32"),Je=l.linalg.gramSchmidt(je);return D[0]>D[1]&&(Je=Je.transpose()),Object(l.mul)(ue.gain,Je)})},ne.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},ne.className="Orthogonal",ne}(Ce);l.serialization.registerClass(Ln);var Xn={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Zn(ae,ne){return ne===void 0&&(ne={}),ht(ae,l.serialization.SerializationMap.getMap().classNameMap,ne,"initializer")}function cr(ae){return Ge(ae)}function Br(ae){if(typeof ae=="string"){var ne=ae in Xn?Xn[ae]:ae;if(ne==="GlorotNormal")return new mt;if(ne==="GlorotUniform")return new un;if(ne==="HeNormal")return new Tt;if(ne==="HeUniform")return new fn;if(ne==="LeCunNormal")return new tn;if(ne==="LeCunUniform")return new Ve;var D={};return D.className=ne,D.config={},Zn(D)}return ae instanceof Ce?ae:Zn(ae)}var Sr=Object.freeze({zeros:function(){return new Me},ones:function(){return new rt},constant:function(ae){return new kt(ae)},randomUniform:function(ae){return new en(ae)},randomNormal:function(ae){return new En(ae)},truncatedNormal:function(ae){return new Nt(ae)},identity:function(ae){return new Kt(ae)},varianceScaling:function(ae){return new hn(ae)},glorotUniform:function(ae){return new un(ae)},glorotNormal:function(ae){return new mt(ae)},heNormal:function(ae){return new Tt(ae)},heUniform:function(ae){return new fn(ae)},leCunNormal:function(ae){return new tn(ae)},leCunUniform:function(ae){return new Ve(ae)},orthogonal:function(ae){return new Ln(ae)}}),yi=0;function ki(){return yi++}var Zr={};function Zi(ae){return ae===void 0&&(ae=""),ae in Zr||(Zr[ae]=0),Zr[ae]+=1,ae+Zr[ae].toString()}function gi(ae){return Array.isArray(ae)&&Array.isArray(ae[0])}function ei(ae){return ae.length===0?[]:Array.isArray(ae[0])?ae:[ae]}function Xr(ae){var ne;if(Array.isArray(ae)){if(ae.length!==1)throw new q("Expected Tensor length to be 1; got "+ae.length);ne=ae[0]}else ne=ae;return ne}function Kn(ae){if(Array.isArray(ae)&&Array.isArray(ae[0])){if(ae.length===1)return(ae=ae)[0];throw new q("Expected exactly 1 Shape; got "+ae.length)}return ae}function di(ae){for(var ne=0,D=0,H=ae;D<H.length;D++){var ue=H[D];ue.shape.length===0?ne+=1:ne+=ue.shape.reduce(function(je,Je){return je*Je})}return ne}var Ei="Variable",zr=function(){function ae(ne,D,H,ue,je){D===void 0&&(D="float32"),H===void 0&&(H=Ei),ue===void 0&&(ue=!0),je===void 0&&(je=null),this.dtype=D??"float32",this.shape=ne.shape,this.id=ki(),H=H??Ei,this.originalName=Tr(H),this.name=rn(this.originalName),this.trainable_=ue,this.constraint=je,this.val=Object(l.variable)(ne,this.trainable_,this.name,this.dtype)}return ae.prototype.read=function(){return this.assertNotDisposed(),this.val},ae.prototype.write=function(ne){return this.assertNotDisposed(),function(D,H){if(D.shape.toString()!==H.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(D.shape)+" vs. "+JSON.stringify(H.shape))}(this.val,ne),this.val.id!==ne.id&&(this.val.assign(ne),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this},ae.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},ae.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable "+this.name+" is already disposed.")},Object.defineProperty(ae.prototype,"trainable",{get:function(){return this.trainable_},set:function(ne){this.trainable_=ne,this.val.trainable=ne},enumerable:!0,configurable:!0}),ae}();function oo(ae){return ae.map(function(ne){return ne.read()})}function zi(ae){ae.forEach(function(ne){ne[0].write(ne[1])})}var eo=function(ae){this.dtype=ae.dtype,this.shape=ae.shape,ae.shape!=null?this.ndim=ae.shape.length:this.ndim=ae.ndim,this.maxNDim=ae.maxNDim,this.minNDim=ae.minNDim,this.axes=ae.axes||{}},wo=function(ae,ne,D,H,ue,je,Je){this.dtype=ae,this.shape=ne,this.sourceLayer=D,this.inputs=H,this.callArgs=ue,this.outputTensorIndex=Je,this.id=ki(),je!=null&&(this.originalName=Tr(je),this.name=rn(this.originalName)),this.rank=ne.length},ba=0,Ts=function(){function ae(ne,D){this.callArgs=D,this.id=ba++,this.outboundLayer=ne.outboundLayer,this.inboundLayers=ne.inboundLayers,this.nodeIndices=ne.nodeIndices,this.tensorIndices=ne.tensorIndices,this.inputTensors=ne.inputTensors,this.outputTensors=ne.outputTensors,this.inputMasks=ne.inputMasks,this.outputMasks=ne.outputMasks,this.inputShapes=ne.inputShapes,this.outputShapes=ne.outputShapes;for(var H=0,ue=ne.inboundLayers;H<ue.length;H++){var je=ue[H];je!=null&&je.outboundNodes.push(this)}ne.outboundLayer.inboundNodes.push(this)}return ae.prototype.getConfig=function(){for(var ne=[],D=0,H=this.inboundLayers;D<H.length;D++){var ue=H[D];ue!=null?ne.push(ue.name):ne.push(null)}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:ne,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},ae}(),xh=0,to=function(ae){function ne(D){var H=ae.call(this)||this;H._callHook=null,H._addedWeightNames=[],H._stateful=!1,H.id=xh++,H.activityRegularizer=null,H.inputSpec=null,H.supportsMasking=!1,H._trainableWeights=[],H._nonTrainableWeights=[],H._losses=[],H._updates=[],H._built=!1,H.inboundNodes=[],H.outboundNodes=[];var ue=D.name;if(!ue){var je=H.getClassName();ue=Ee(je)+"_"+Zi(je)}if(H.name=ue,H.trainable_=D.trainable==null||D.trainable,D.inputShape!=null||D.batchInputShape!=null){var Je=void 0;if(D.batchInputShape!=null)Je=D.batchInputShape;else if(D.inputShape!=null){var vt=null;D.batchSize!=null&&(vt=D.batchSize),Je=[vt].concat(D.inputShape)}H.batchInputShape=Je;var Gt=D.dtype;Gt==null&&(Gt=D.inputDType),Gt==null&&(Gt="float32"),H.dtype=Gt}return D.weights!=null?H.initialWeights=D.weights:H.initialWeights=null,H._refCount=null,H.fastWeightInitDuringBuild=!1,H}return S(ne,ae),ne.nodeKey=function(D,H){return D.name+"_ib-"+H.toString()},ne.prototype.getNodeAtIndex=function(D,H){if(this.inboundNodes.length===0)throw new z("The layer has never been called and thus has no defined "+H+".");if(this.inboundNodes.length<=D)throw new q("Asked to get "+H+" at node "+D+", but the layer has only "+this.inboundNodes.length+" inbound nodes.");return this.inboundNodes[D]},ne.prototype.getInputAt=function(D){return ce(this.getNodeAtIndex(D,"input").inputTensors)},ne.prototype.getOutputAt=function(D){return ce(this.getNodeAtIndex(D,"output").outputTensors)},Object.defineProperty(ne.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new W("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(this.inboundNodes.length===0)throw new W("Layer "+this.name+" is not connected, no input to return.");return ce(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"output",{get:function(){if(this.inboundNodes.length===0)throw new W("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new W("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return ce(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),ne.prototype.calculateLosses=function(){return this.losses.map(function(D){return D()})},Object.defineProperty(ne.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"built",{get:function(){return this._built},set:function(D){this._built=D},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"trainable",{get:function(){return this.trainable_},set:function(D){this._trainableWeights.forEach(function(H){return H.trainable=D}),this.trainable_=D},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter(function(D){return D.trainable}):[]},set:function(D){this._trainableWeights=D},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter(function(D){return!D.trainable}).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(D){this._nonTrainableWeights=D},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),ne.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},ne.prototype.assertInputCompatibility=function(D){if(D=be(D),this.inputSpec!=null&&this.inputSpec.length!==0){var H=be(this.inputSpec);if(D.length!==H.length)throw new q("Layer "+this.name+" expects "+H.length+" inputs, but it received "+D.length+" input tensors. Input received: "+D);for(var ue=0;ue<D.length;ue++){var je=D[ue],Je=H[ue];if(Je!=null){var vt=je.rank;if(Je.ndim!=null&&vt!==Je.ndim)throw new q("Input "+ue+" is incompatible with layer "+this.name+": expected ndim="+Je.ndim+", found ndim="+vt);if(Je.maxNDim!=null&&vt>Je.maxNDim)throw new q("Input "+ue+" is incompatible with layer "+this.name+": expected max_ndim="+Je.maxNDim+", found ndim="+vt);if(Je.minNDim!=null&&vt<Je.minNDim)throw new q("Input "+ue+" is incompatible with layer "+this.name+": expected min_ndim="+Je.minNDim+", found ndim="+vt+".");if(Je.dtype!=null&&je.dtype!==Je.dtype)throw new q("Input "+ue+" is incompatible with layer "+this.name+" : expected dtype="+Je.dtype+", found dtype="+je.dtype+".");if(Je.axes){var Gt=je.shape;for(var on in Je.axes){var dt=Number(on),Mn=Je.axes[on],zn=dt>=0?Gt[dt]:Gt[Gt.length+dt];if(Mn!=null&&[Mn,null].indexOf(zn)===-1)throw new q("Input "+ue+" is incompatible with layer "+this.name+": expected axis "+dt+" of input shape to have value "+Mn+" but got shape "+Gt+".")}}if(Je.shape!=null)for(var Hn=0;Hn<Je.shape.length;++Hn){var nr=Je.shape[Hn],Yn=je.shape[Hn];if(nr!=null&&Yn!=null&&nr!==Yn)throw new q("Input "+ue+" is incompatible with layer "+this.name+": expected shape="+Je.shape+", found shape="+je.shape+".")}}}}},ne.prototype.call=function(D,H){return D},ne.prototype.invokeCallHook=function(D,H){this._callHook!=null&&this._callHook(D,H)},ne.prototype.setCallHook=function(D){this._callHook=D},ne.prototype.clearCallHook=function(){this._callHook=null},ne.prototype.apply=function(D,H){var ue=this;H=H||{},this.assertNotDisposed();for(var je=be(D),Je=!0,vt=0,Gt=je;vt<Gt.length;vt++)if(!(Gt[vt]instanceof wo)){Je=!1;break}for(var on=!0,dt=0,Mn=je;dt<Mn.length;dt++)if(Mn[dt]instanceof wo){on=!1;break}if(Je===on)throw new q("Arguments to apply() must be all SymbolicTensors or all Tensors");return ar(this.name,function(){if(!ue.built){ue.assertInputCompatibility(D);for(var zn=[],Hn=0,nr=be(D);Hn<nr.length;Hn++){var Yn=nr[Hn];zn.push(Yn.shape)}ue.build(ce(zn)),ue.built=!0,ue.initialWeights&&ue.setWeights(ue.initialWeights),ue._refCount===null&&on&&(ue._refCount=1)}if(ue.assertInputCompatibility(D),on){for(var dr=[],gr=0,Ar=be(ai=ue.call(D,H));gr<Ar.length;gr++){var Gr=Ar[gr];je.indexOf(Gr)!==-1&&(Gr=Gr.clone()),dr.push(Gr)}if(ai=ce(dr),ue.activityRegularizer!=null)throw new I("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return ai}var ii=function(bi){for(var _i=[],oi=0,pi=bi=be(bi);oi<pi.length;oi++){var fo=pi[oi];_i.push(fo.shape)}return ce(_i)}(D),Ir=ue.computeOutputShape(ii),ai=void 0,ni="float32";if(ue.warnOnIncompatibleInputShape(Array.isArray(D)?ii[0]:ii),ai=Ir!=null&&Ir.length>0&&Array.isArray(Ir[0])?Ir.map(function(bi,_i){return new wo(ni,bi,ue,be(D),H,ue.name,_i)}):new wo(ni,Ir,ue,be(D),H,ue.name),ue.addInboundNode(D,ai,null,null,ii,Ir,H),ue._refCount++,ue.activityRegularizer!=null)throw new I("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return ai})},ne.prototype.warnOnIncompatibleInputShape=function(D){if(this.batchInputShape!=null)if(D.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(D)+") does not match that of the batchInputShape ("+JSON.stringify(this.batchInputShape)+") of the layer "+this.name);else{var H=!1;this.batchInputShape.forEach(function(ue,je){ue!=null&&D[je]!=null&&D[je]!==ue&&(H=!0)}),H&&console.warn("The shape of the input tensor ("+JSON.stringify(D)+") does not match the expectation of layer "+this.name+": "+JSON.stringify(this.batchInputShape))}},Object.defineProperty(ne.prototype,"outputShape",{get:function(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new W("The layer "+this.name+" has never been called and thus has no defined output shape.");for(var D=[],H=0,ue=this.inboundNodes;H<ue.length;H++){var je=ue[H],Je=JSON.stringify(je.outputShapes);D.indexOf(Je)===-1&&D.push(Je)}if(D.length===1){var vt=this.inboundNodes[0].outputShapes;return Array.isArray(vt)&&Array.isArray(vt[0])&&vt.length===1?vt[0]:vt}throw new W("The layer "+this.name+' has multiple inbound nodes with different output shapes. Hence the notion of "outut shape" is ill-defined for the layer.')},enumerable:!0,configurable:!0}),ne.prototype.countParams=function(){if(!this.built)throw new z("You tried to call countParams() on "+this.name+", but the layer is not built yet. Build it first by calling build(batchInputShape).");return di(this.weights)},ne.prototype.build=function(D){this.built=!0},ne.prototype.getWeights=function(D){return D===void 0&&(D=!1),oo(D?this.trainableWeights:this.weights)},ne.prototype.setWeights=function(D){var H=this;Object(l.tidy)(function(){var ue=H.weights;if(ue.length!==D.length)throw new q('You called setWeights(weights) on layer "'+H.name+'" with a weight list of length '+D.length+", but the layer was expecting "+ue.length+" weights. Provided weights: "+D+"...");if(ue.length!==0){for(var je=[],Je=oo(ue),vt=0;vt<Je.length;++vt){var Gt=Je[vt],on=ue[vt],dt=D[vt];if(!l.util.arraysEqual(Gt.shape,dt.shape))throw new q("Layer weight shape "+Gt.shape+" not compatible with provided weight shape "+dt.shape);je.push([on,dt])}zi(je)}})},ne.prototype.addWeight=function(D,H,ue,je,Je,vt,Gt){if(this._addedWeightNames.indexOf(D)!==-1)throw new q("Duplicate weight name "+D+" for layer "+this.name);this._addedWeightNames.push(D),ue==null&&(ue="float32"),this.fastWeightInitDuringBuild&&(je=Br("zeros"));var on=je.apply(H,ue),dt=new zr(on,ue,D,vt,Gt);return on.dispose(),Je!=null&&this.addLoss(function(){return Je.apply(dt.read())}),vt==null&&(vt=!0),vt?this._trainableWeights.push(dt):this._nonTrainableWeights.push(dt),dt},ne.prototype.setFastWeightInitDuringBuild=function(D){this.fastWeightInitDuringBuild=D},ne.prototype.addLoss=function(D){var H;D==null||Array.isArray(D)&&D.length===0||(D=be(D),this._losses!==void 0&&this._losses!==null&&(H=this.losses).push.apply(H,D))},ne.prototype.computeOutputShape=function(D){return D},ne.prototype.computeMask=function(D,H){var ue=this;if(!this.supportsMasking){if(H!=null){if(!Array.isArray(H))throw new TypeError("Layer "+this.name+" does not support masking, but was passed an inputMask.");H.forEach(function(je){if(je!=null)throw new TypeError("Layer "+ue.name+" does not support masking, but was passed an inputMask.")})}return null}return H},ne.prototype.addInboundNode=function(D,H,ue,je,Je,vt,Gt){Gt===void 0&&(Gt=null);var on=be(D);H=be(H),ue=be(ue),je=be(je),Je=ei(Je),vt=ei(vt);for(var dt=[],Mn=[],zn=[],Hn=0,nr=on;Hn<nr.length;Hn++){var Yn=nr[Hn];dt.push(Yn.sourceLayer),Mn.push(Yn.nodeIndex),zn.push(Yn.tensorIndex)}new Ts({outboundLayer:this,inboundLayers:dt,nodeIndices:Mn,tensorIndices:zn,inputTensors:on,outputTensors:H,inputMasks:ue,outputMasks:je,inputShapes:Je,outputShapes:vt},Gt);for(var dr=0;dr<H.length;dr++)H[dr].sourceLayer=this,H[dr].nodeIndex=this.inboundNodes.length-1,H[dr].tensorIndex=dr},ne.prototype.getConfig=function(){var D={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(D.batchInputShape=this.batchInputShape),this.dtype!=null&&(D.dtype=this.dtype),D},ne.prototype.disposeWeights=function(){return this.weights.forEach(function(D){return D.dispose()}),this.weights.length},ne.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Layer '"+this.name+"' is already disposed.")},ne.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer "+this.name+" because it has not been built yet.");if(this._refCount===null)throw new Error("Cannot dispose Layer "+this.name+" because it has not been used yet.");this.assertNotDisposed();var D=0;return--this._refCount==0&&(D=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:D}},ne}(l.serialization.Serializable),Cc,Uu=function(ae){function ne(D){var H=ae.call(this,{dtype:D.dtype,name:D.name!=null?D.name:Zi("input").toString()})||this;if(D.batchSize==null&&(D.batchSize=null),D.sparse==null&&(D.sparse=!1),H.trainable=!1,H.built=!0,H.sparse=D.sparse,D.inputShape!=null&&D.batchInputShape!=null)throw new q("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var ue=D.batchInputShape;if(ue==null){if(D.inputShape==null)throw new q("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");ue=[D.batchSize].concat(D.inputShape)}else if(D.batchSize!=null)throw new q("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var je=D.dtype||"float32";H.batchInputShape=ue,H.dtype=je,H.inputSpec=[{shape:ue}];var Je=new wo(H.dtype,H.batchInputShape,H,[],{},H.name);return Je.nodeIndex=0,Je.tensorIndex=0,new Ts({outboundLayer:H,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[Je],outputTensors:[Je],inputMasks:[null],outputMasks:[null],inputShapes:[ue],outputShapes:[ue]}),H}return S(ne,ae),ne.prototype.apply=function(D,H){throw new q("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)},ne.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},ne.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},ne.className="InputLayer",ne}(to);function Yc(ae){if(ae.batchShape==null&&ae.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(ae.batchShape!=null&&ae.shape!=null)throw new q("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var ne=ae.batchShape;ae.shape!=null&&ne==null&&(ne=[null].concat(ae.shape));var D=ae.dtype;return D==null&&(D="float32"),new Uu({batchInputShape:ne,name:ae.name,dtype:D,sparse:ae.sparse}).inboundNodes[0].outputTensors[0]}function sc(ae){return j(this,void 0,void 0,function(){var ne,D,H,ue,je,Je,vt,Gt;return N(this,function(on){switch(on.label){case 0:if(ae==null)return[2];for(ue in ne=[],D=[],H=[],ae)typeof(je=ae[ue])!="number"&&(Je=je,ne.push(Je.data()),D.push(ue),H.push(Je));return ne.length>0?[4,Promise.all(ne)]:[3,2];case 1:for(vt=on.sent(),Gt=0;Gt<vt.length;++Gt)ae[D[Gt]]=vt[Gt][0];Object(l.dispose)(H),on.label=2;case 2:return[2]}})})}function Jc(ae){if(ae!=null)for(var ne in ae){var D=ae[ne];typeof D!="number"&&D.dispose()}}l.serialization.registerClass(Uu),function(ae){ae[ae.SILENT=0]="SILENT",ae[ae.VERBOSE=1]="VERBOSE"}(Cc||(Cc={}));var Rp=125,ys=function(){function ae(){this.validationData=null}return ae.prototype.setParams=function(ne){this.params=ne},ae.prototype.onEpochBegin=function(ne,D){return j(this,void 0,void 0,function(){return N(this,function(H){return[2]})})},ae.prototype.onEpochEnd=function(ne,D){return j(this,void 0,void 0,function(){return N(this,function(H){return[2]})})},ae.prototype.onBatchBegin=function(ne,D){return j(this,void 0,void 0,function(){return N(this,function(H){return[2]})})},ae.prototype.onBatchEnd=function(ne,D){return j(this,void 0,void 0,function(){return N(this,function(H){return[2]})})},ae.prototype.onTrainBegin=function(ne){return j(this,void 0,void 0,function(){return N(this,function(D){return[2]})})},ae.prototype.onTrainEnd=function(ne){return j(this,void 0,void 0,function(){return N(this,function(D){return[2]})})},ae.prototype.setModel=function(ne){},ae}(),sd=function(){function ae(ne,D){D===void 0&&(D=10),ne==null&&(ne=[]),this.callbacks=ne,this.queueLength=D}return ae.prototype.append=function(ne){this.callbacks.push(ne)},ae.prototype.setParams=function(ne){for(var D=0,H=this.callbacks;D<H.length;D++)H[D].setParams(ne)},ae.prototype.setModel=function(ne){for(var D=0,H=this.callbacks;D<H.length;D++)H[D].setModel(ne)},ae.prototype.onEpochBegin=function(ne,D){return j(this,void 0,void 0,function(){var H,ue;return N(this,function(je){switch(je.label){case 0:D==null&&(D={}),H=0,ue=this.callbacks,je.label=1;case 1:return H<ue.length?[4,ue[H].onEpochBegin(ne,D)]:[3,4];case 2:je.sent(),je.label=3;case 3:return H++,[3,1];case 4:return[2]}})})},ae.prototype.onEpochEnd=function(ne,D){return j(this,void 0,void 0,function(){var H,ue;return N(this,function(je){switch(je.label){case 0:D==null&&(D={}),H=0,ue=this.callbacks,je.label=1;case 1:return H<ue.length?[4,ue[H].onEpochEnd(ne,D)]:[3,4];case 2:je.sent(),je.label=3;case 3:return H++,[3,1];case 4:return[2]}})})},ae.prototype.onBatchBegin=function(ne,D){return j(this,void 0,void 0,function(){var H,ue;return N(this,function(je){switch(je.label){case 0:D==null&&(D={}),H=0,ue=this.callbacks,je.label=1;case 1:return H<ue.length?[4,ue[H].onBatchBegin(ne,D)]:[3,4];case 2:je.sent(),je.label=3;case 3:return H++,[3,1];case 4:return[2]}})})},ae.prototype.onBatchEnd=function(ne,D){return j(this,void 0,void 0,function(){var H,ue;return N(this,function(je){switch(je.label){case 0:D==null&&(D={}),H=0,ue=this.callbacks,je.label=1;case 1:return H<ue.length?[4,ue[H].onBatchEnd(ne,D)]:[3,4];case 2:je.sent(),je.label=3;case 3:return H++,[3,1];case 4:return[2]}})})},ae.prototype.onTrainBegin=function(ne){return j(this,void 0,void 0,function(){var D,H;return N(this,function(ue){switch(ue.label){case 0:ne==null&&(ne={}),D=0,H=this.callbacks,ue.label=1;case 1:return D<H.length?[4,H[D].onTrainBegin(ne)]:[3,4];case 2:ue.sent(),ue.label=3;case 3:return D++,[3,1];case 4:return[2]}})})},ae.prototype.onTrainEnd=function(ne){return j(this,void 0,void 0,function(){var D,H;return N(this,function(ue){switch(ue.label){case 0:ne==null&&(ne={}),D=0,H=this.callbacks,ue.label=1;case 1:return D<H.length?[4,H[D].onTrainEnd(ne)]:[3,4];case 2:ue.sent(),ue.label=3;case 3:return D++,[3,1];case 4:return[2]}})})},ae}(),Pp=function(ae){function ne(){return ae.call(this)||this}return S(ne,ae),ne.prototype.onEpochBegin=function(D){return j(this,void 0,void 0,function(){return N(this,function(H){return this.seen=0,this.totals={},[2]})})},ne.prototype.onBatchEnd=function(D,H){return j(this,void 0,void 0,function(){var ue,je,Je,vt,Gt=this;return N(this,function(on){for(vt in H==null&&(H={}),ue=H.size==null?0:H.size,this.seen+=ue,je=function(dt){var Mn=H[dt];if(typeof Mn=="number")Je.totals.hasOwnProperty(dt)||(Je.totals[dt]=0),Je.totals[dt]=Je.totals[dt]+Mn*ue;else{var zn=void 0;dt in Je.totals?zn=Je.totals[dt]:Je.totals[dt]=0;var Hn=Object(l.tidy)(function(){return Object(l.add)(Gt.totals[dt],Object(l.mul)(Mn,ue))});Je.totals[dt]=Hn,zn!=null&&zn.dispose()}},Je=this,H)je(vt);return[2]})})},ne.prototype.onEpochEnd=function(D,H){return j(this,void 0,void 0,function(){var ue,je,Je,vt,Gt,on=this;return N(this,function(dt){if(H!=null)for(ue=function(Mn){if(je.totals[Mn]==null)return"continue";typeof je.totals[Mn]=="number"?H[Mn]=je.totals[Mn]/je.seen:Object(l.tidy)(function(){var zn=Object(l.mul)(Object(l.div)(1,on.seen),on.totals[Mn]);H[Mn]=zn,on.totals[Mn].dispose(),Object(l.keep)(H[Mn])})},je=this,Je=0,vt=this.params.metrics;Je<vt.length;Je++)Gt=vt[Je],ue(Gt);return[2]})})},ne}(ys),uc=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne.prototype.onTrainBegin=function(D){return j(this,void 0,void 0,function(){return N(this,function(H){return this.epoch=[],this.history={},[2]})})},ne.prototype.onEpochEnd=function(D,H){return j(this,void 0,void 0,function(){var ue;return N(this,function(je){for(ue in H==null&&(H={}),this.epoch.push(D),H)this.history[ue]==null&&(this.history[ue]=[]),this.history[ue].push(H[ue]);return[2]})})},ne.prototype.syncData=function(){return j(this,void 0,void 0,function(){var D,H,ue,je,Je,vt,Gt,on,dt;return N(this,function(Mn){switch(Mn.label){case 0:for(je in D=[],H=[],ue=[],this.history)for(Je=this.history[je],vt=0;vt<Je.length;++vt)typeof Je[vt]!="number"&&(Gt=Je[vt],D.push(Gt.data()),H.push(je),ue.push(vt));return[4,Promise.all(D)];case 1:for(on=Mn.sent(),dt=0;dt<on.length;++dt)this.history[H[dt]][ue[dt]].dispose(),this.history[H[dt]][ue[dt]]=on[dt][0];return[2]}})})},ne}(ys),ud=function(ae){function ne(D,H){var ue=ae.call(this)||this;if(ue.currentEpoch=0,ue.yieldEvery=H||"auto",ue.yieldEvery==="auto"&&(ue.yieldEvery=Rp),ue.yieldEvery==="never"&&D.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return l.util.isNumber(ue.yieldEvery)&&(ue.maybeWait=function(je,Je){var vt,Gt=l.util.now();return function(){for(var on=[],dt=0;dt<arguments.length;dt++)on[dt]=arguments[dt];var Mn=l.util.now();return Mn-Gt<Je?vt:(Gt=Mn,vt=je.apply(void 0,on))}}(ue.maybeWait.bind(ue),ue.yieldEvery)),ue.trainBegin=D.onTrainBegin,ue.trainEnd=D.onTrainEnd,ue.epochBegin=D.onEpochBegin,ue.epochEnd=D.onEpochEnd,ue.batchBegin=D.onBatchBegin,ue.batchEnd=D.onBatchEnd,ue.yield=D.onYield,ue}return S(ne,ae),ne.prototype.maybeWait=function(D,H,ue){return j(this,void 0,void 0,function(){var je;return N(this,function(Je){switch(Je.label){case 0:return je=[],this.yield==null?[3,2]:[4,sc(ue)];case 1:Je.sent(),je.push(this.yield(D,H,ue)),Je.label=2;case 2:return je.push(Object(l.nextFrame)()),[4,Promise.all(je)];case 3:return Je.sent(),[2]}})})},ne.prototype.onEpochBegin=function(D,H){return j(this,void 0,void 0,function(){return N(this,function(ue){switch(ue.label){case 0:return this.currentEpoch=D,this.epochBegin==null?[3,3]:[4,sc(H)];case 1:return ue.sent(),[4,this.epochBegin(D,H)];case 2:ue.sent(),ue.label=3;case 3:return[2]}})})},ne.prototype.onEpochEnd=function(D,H){return j(this,void 0,void 0,function(){var ue;return N(this,function(je){switch(je.label){case 0:return ue=[],this.epochEnd==null?[3,2]:[4,sc(H)];case 1:je.sent(),ue.push(this.epochEnd(D,H)),je.label=2;case 2:return this.yieldEvery==="epoch"&&ue.push(Object(l.nextFrame)()),[4,Promise.all(ue)];case 3:return je.sent(),[2]}})})},ne.prototype.onBatchBegin=function(D,H){return j(this,void 0,void 0,function(){return N(this,function(ue){switch(ue.label){case 0:return this.batchBegin==null?[3,3]:[4,sc(H)];case 1:return ue.sent(),[4,this.batchBegin(D,H)];case 2:ue.sent(),ue.label=3;case 3:return[2]}})})},ne.prototype.onBatchEnd=function(D,H){return j(this,void 0,void 0,function(){var ue;return N(this,function(je){switch(je.label){case 0:return ue=[],this.batchEnd==null?[3,2]:[4,sc(H)];case 1:je.sent(),ue.push(this.batchEnd(D,H)),je.label=2;case 2:return this.yieldEvery==="batch"?ue.push(Object(l.nextFrame)()):l.util.isNumber(this.yieldEvery)&&ue.push(this.maybeWait(this.currentEpoch,D,H)),[4,Promise.all(ue)];case 3:return je.sent(),[2]}})})},ne.prototype.onTrainBegin=function(D){return j(this,void 0,void 0,function(){return N(this,function(H){switch(H.label){case 0:return this.trainBegin==null?[3,3]:[4,sc(D)];case 1:return H.sent(),[4,this.trainBegin(D)];case 2:H.sent(),H.label=3;case 3:return[2]}})})},ne.prototype.onTrainEnd=function(D){return j(this,void 0,void 0,function(){return N(this,function(H){switch(H.label){case 0:return this.trainEnd==null?[3,3]:[4,sc(D)];case 1:return H.sent(),[4,this.trainEnd(D)];case 2:H.sent(),H.label=3;case 3:return[2]}})})},ne}(ys);function wh(ae,ne){return ae==null&&(ae={}),ae instanceof ys?[ae]:Array.isArray(ae)&&ae[0]instanceof ys?ae:be(ae).map(function(D){return new ud(D,ne)})}var Qc=function(){function ae(){}return ae.registerCallbackConstructor=function(ne,D){l.util.assert(ne>=0&&Number.isInteger(ne),function(){return"Verbosity level is expected to be an integer >= 0, but got "+ne}),ae.checkForDuplicate(D),ae.constructors[ne]==null&&(ae.constructors[ne]=[]),ae.constructors[ne].push(D)},ae.checkForDuplicate=function(ne){for(var D in ae.constructors)ae.constructors[+D].forEach(function(H){if(H===ne)throw new q("Duplicate callback constructor.")})},ae.clear=function(){ae.constructors={}},ae.createCallbacks=function(ne){var D=[];for(var H in ae.constructors){var ue=+H;ne>=ue&&D.push.apply(D,ae.constructors[ue])}return D.map(function(je){return new je})},ae.constructors={},ae}();function uf(ae,ne,D,H,ue,je,Je,vt,Gt){var on=new uc,dt=[new Pp].concat(Qc.createCallbacks(ne));ae!=null&&dt.push.apply(dt,ae),dt.push(on);var Mn=new sd(dt);return Mn.setParams({epochs:D,initialEpoch:H,samples:ue,steps:je,batchSize:Je,verbose:ne,doValidation:vt,metrics:Gt}),{callbackList:Mn,history:on}}function Ua(ae,ne,D){return ne===void 0&&(ne={}),D===void 0&&(D=!1),ht(ae,l.serialization.SerializationMap.getMap().classNameMap,ne,"layer",D)}function Sl(ae,ne){return Object(l.tidy)(function(){ae.dtype!=="float32"&&(ae=ae.asType("float32"));var D=Object(l.sum)(Hr(ae),ne,!0),H=Object(l.fill)(D.shape,L()),ue=Object(l.sqrt)(Object(l.maximum)(D,H));return Object(l.div)(ae,ue)})}function ga(ae,ne){return Object(l.tidy)(function(){return Object(l.mean)(Hr(Object(l.sub)(ne,ae)),-1)})}function Ac(ae,ne){return Object(l.tidy)(function(){return Object(l.mean)(Object(l.abs)(Object(l.sub)(ne,ae)),-1)})}function bs(ae,ne){return Object(l.tidy)(function(){var D=Object(l.sub)(ae,ne),H=Object(l.clipByValue)(Object(l.abs)(ae),L(),Number.MAX_VALUE),ue=Object(l.abs)(Object(l.div)(D,H));return Object(l.mul)(100,Object(l.mean)(ue,-1))})}function Fa(ae,ne,D){return D===void 0&&(D=!1),Object(l.tidy)(function(){if(D)ne=Object(l.softmax)(ne);else{var H=Object(l.sum)(ne,ne.shape.length-1,!0);ne=Object(l.div)(ne,H)}return ne=Object(l.clipByValue)(ne,L(),1-L()),Object(l.neg)(Object(l.sum)(Object(l.mul)(ae.toFloat(),Object(l.log)(ne)),ne.shape.length-1))})}function Oc(ae,ne){return Object(l.tidy)(function(){var D=Object(l.floor)(function(ue){var je=[Wt(ue.shape)];return ue.reshape(je)}(ae)).toInt(),H=(ne=Object(l.clipByValue)(ne,L(),1-L())).shape;return Fa(Object(l.oneHot)(D,H[H.length-1]).reshape(H),ne,!1)})}function cf(ae,ne){return Object(l.tidy)(function(){var D;return D=Object(l.clipByValue)(ne,L(),1-L()),D=Object(l.log)(Object(l.div)(D,Object(l.sub)(1,D))),Object(l.mean)(function(H,ue){if(!l.util.arraysEqual(H.shape,ue.shape))throw new q("logits and labels must have the same shape, but got shapes "+JSON.stringify(H.shape)+" and "+JSON.stringify(ue.shape));return Object(l.tidy)(function(){var je=ue.relu(),Je=ue.abs().neg();return je.sub(ue.mul(H)).add(Je.exp().log1p())})}(ae,D),-1)})}function Tc(ae,ne){return Object(l.tidy)(function(){var D=Sl(ae,-1),H=Sl(ne,-1),ue=Object(l.mul)(D,H);return Object(l.neg)(Object(l.sum)(ue,-1))})}var Mu={meanSquaredError:ga,meanAbsoluteError:Ac,meanAbsolutePercentageError:bs,meanSquaredLogarithmicError:function(ae,ne){return Object(l.tidy)(function(){var D=Object(l.clipByValue)(ne,L(),Number.MAX_VALUE),H=Object(l.log)(Object(l.add)(1,D)),ue=Object(l.clipByValue)(ae,L(),Number.MAX_VALUE),je=Object(l.log)(Object(l.add)(1,ue));return Object(l.mean)(Hr(Object(l.sub)(H,je)),-1)})},squaredHinge:function(ae,ne){return Object(l.tidy)(function(){var D=Object(l.maximum)(0,Object(l.sub)(1,Object(l.mul)(ae,ne)));return Object(l.mean)(Hr(D),-1)})},hinge:function(ae,ne){return Object(l.tidy)(function(){var D=Object(l.maximum)(0,Object(l.sub)(1,Object(l.mul)(ae,ne)));return Object(l.mean)(D,-1)})},categoricalHinge:function(ae,ne){return Object(l.tidy)(function(){var D=Object(l.sum)(Object(l.mul)(ae,ne),-1),H=Object(l.max)(Object(l.mul)(Object(l.sub)(1,ae),ne),-1);return Object(l.maximum)(0,Object(l.add)(1,Object(l.sub)(H,D)))})},logcosh:function(ae,ne){return Object(l.tidy)(function(){var D=Math.log(2),H=Object(l.sub)(ne,ae),ue=Object(l.sub)(Object(l.add)(H,Object(l.softplus)(Object(l.mul)(-2,H))),D);return Object(l.mean)(ue,-1)})},categoricalCrossentropy:Fa,sparseCategoricalCrossentropy:Oc,binaryCrossentropy:cf,kullbackLeiblerDivergence:function(ae,ne){return Object(l.tidy)(function(){var D=Object(l.clipByValue)(ae,L(),1),H=Object(l.clipByValue)(ne,L(),1);return Object(l.sum)(Object(l.mul)(ae,Object(l.log)(Object(l.div)(D,H))),-1)})},poisson:function(ae,ne){return Object(l.tidy)(function(){var D=Object(l.log)(Object(l.add)(L(),ne));return Object(l.mean)(Object(l.sub)(ne,Object(l.mul)(ae,D)),-1)})},cosineProximity:Tc};function _h(ae){if(typeof ae=="string"){if(ae in Mu)return Mu[ae];var ne="Unknown loss "+ae;throw ae.toLowerCase().includes("softmaxcrossentropy")&&(ne="Unknown loss "+ae+'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new q(ne)}return ae}function cd(ae,ne){return Object(l.tidy)(function(){var D=Object(l.mul)(.5,Object(l.onesLike)(ne)),H=ur(Object(l.greater)(ne,D),ae.dtype);return Object(l.mean)(Object(l.equal)(ae,H),-1)})}function ld(ae,ne){return Object(l.tidy)(function(){return ur(Object(l.equal)(Object(l.argMax)(ae,-1),Object(l.argMax)(ne,-1)),"float32")})}function xa(ae,ne){return Object(l.tidy)(function(){return Object(l.logicalAnd)(ae.equal(1),ne.equal(1)).sum().cast("float32")})}function Eh(ae,ne){return Object(l.tidy)(function(){var D=xa(ae,ne),H=function(je,Je){return Object(l.tidy)(function(){return Object(l.logicalAnd)(je.equal(0),Je.equal(1)).sum().cast("float32")})}(ae,ne),ue=D.add(H);return Object(l.where)(Object(l.greater)(ue,0),D.div(ue),0).cast("float32")})}function Lp(ae,ne){return Object(l.tidy)(function(){var D=xa(ae,ne),H=function(je,Je){return Object(l.tidy)(function(){return Object(l.logicalAnd)(je.equal(1),Je.equal(0)).sum().cast("float32")})}(ae,ne),ue=D.add(H);return Object(l.where)(Object(l.greater)(ue,0),D.div(ue),0).cast("float32")})}function fd(ae,ne){return cf(ae,ne)}function dd(ae,ne){return ae.rank===ne.rank&&(ae=ae.squeeze([ae.rank-1])),(ne=ne.argMax(-1)).dtype!==ae.dtype&&(ne=ne.asType(ae.dtype)),Object(l.equal)(ae,ne).asType("float32")}var Ms=Fa,hd=Oc,yr={binaryAccuracy:cd,categoricalAccuracy:ld,precision:Eh,categoricalCrossentropy:Ms,sparseCategoricalCrossentropy:hd,mse:ga,MSE:ga,mae:Ac,MAE:Ac,mape:bs,MAPE:bs,cosine:Tc};function Wu(ae){if(G(ae!==null,"Unknown LossOrMetricFn "+ae),typeof ae=="string")return ae;for(var ne=void 0,D=0,H=Object.keys(Mu);D<H.length;D++){var ue=H[D];if(Mu[ue]===ae){ne=ue;break}}if(ne!==void 0)return ne;for(var je=0,Je=Object.keys(yr);je<Je.length;je++)if(ue=Je[je],yr[ue]===ae){ne=ue;break}return ne!==void 0?ne:ae.name}var $m=1048576;function Xm(ae,ne,D){if(D===void 0&&(D=!1),ae==null||typeof ae!="object"||Object.getPrototypeOf(ae)!==Object.prototype||!function ue(je){if(je===null)return!0;if(typeof je=="object"){if(Object.getPrototypeOf(je)===Object.prototype){for(var Je=0,vt=Object.keys(je);Je<vt.length;Je++){var Gt=vt[Je];if(typeof Gt!="string"||!ue(je[Gt]))return!1}return!0}if(Array.isArray(je)){for(var on=0,dt=je;on<dt.length;on++)if(!ue(dt[on]))return!1;return!0}return!1}var Mn=typeof je;return Mn==="string"||Mn==="number"||Mn==="boolean"}(ae))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(D){var H=JSON.stringify(ae);H.length>$m&&console.warn('User-defined metadata of model "'+ne+'" is too large in size (length='+H.length+" when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+$m+".")}}function pd(ae,ne,D,H){H===void 0&&(H=console.log);var ue,je=function(zn){var Hn=!0,nr=[],Yn=[];for(var dr in zn.nodesByDepth)nr.push(zn.nodesByDepth[dr]);for(var gr=0,Ar=nr;gr<Ar.length;gr++){var Gr=Ar[gr];if(Gr.length>1||Gr.length===1&&Gr[0].inboundLayers.length>1){Hn=!1;break}Yn.push.apply(Yn,Gr)}if(Hn)for(var ii=0,Ir=zn.layers;ii<Ir.length;ii++){for(var ai=!1,ni=0,bi=Ir[ii].inboundNodes;ni<bi.length;ni++){var _i=bi[ni];if(Yn.indexOf(_i)!==-1){if(ai){Hn=!1;break}ai=!0}}if(!Hn)break}return Hn}(ae),Je=["Layer (type)","Output shape","Param #"];if(je?(ne=ne||65,D=D||[.45,.85,1]):(ne=ne||98,D=D||[.33,.55,.67,1]),D[D.length-1]<=1&&(D=D.map(function(zn){return Math.floor(ne*zn)})),!je)for(var vt in Je.push("Receives inputs"),ue=[],ae.nodesByDepth)ue.push.apply(ue,ae.nodesByDepth[vt]);H("_".repeat(ne)),lf(Je,D,H),H("=".repeat(ne));for(var Gt=ae.layers,on=0;on<Gt.length;++on)je?Bp(Gt[on],D,H):Sh(Gt[on],D,ue,H),H((on===Gt.length-1?"=":"_").repeat(ne));ae.checkTrainableWeightsConsistency();var dt=function(zn){return zn.collectedTrainableWeights!=null?di(zn.collectedTrainableWeights):di(zn.trainableWeights)}(ae),Mn=di(ae.nonTrainableWeights);H("Total params: "+(dt+Mn)),H("Trainable params: "+dt),H("Non-trainable params: "+Mn),H("_".repeat(ne))}function lf(ae,ne,D){D===void 0&&(D=console.log);for(var H="",ue=0;ue<ae.length;++ue)ue>0&&(H=H.slice(0,H.length-1)+" "),H=(H+=ae[ue]).slice(0,ne[ue]),H+=" ".repeat(ne[ue]-H.length);D(H)}function Bp(ae,ne,D){var H;try{H=JSON.stringify(ae.outputShape)}catch{H="multiple"}lf([ae.name+" ("+ae.getClassName()+")",H,ae.countParams().toString()],ne,D)}function Sh(ae,ne,D,H){var ue;try{ue=JSON.stringify(ae.outputShape)}catch{ue="multiple"}for(var je=[],Je=0,vt=ae.inboundNodes;Je<vt.length;Je++){var Gt=vt[Je];if(!(D!=null&&D.length>0&&D.indexOf(Gt)===-1))for(var on=0;on<Gt.inboundLayers.length;++on){var dt=Gt.inboundLayers[on].name,Mn=Gt.nodeIndices[on],zn=Gt.tensorIndices[on];je.push(dt+"["+Mn+"]["+zn+"]")}}var Hn=ae.name,nr=ae.getClassName(),Yn=je.length===0?"":je[0];for(lf([Hn+" ("+nr+")",ue,ae.countParams().toString(),Yn],ne,H),on=1;on<je.length;++on)lf(["","","",je[on]],ne,H)}function kh(ae,ne,D){return(ae==="inboundNodes"||ae==="outputLayers"||ae==="inputLayers")&&ne===0&&typeof D=="string"}function Hi(ae,ne){if(ae===null)return null;if(typeof ae=="string")return ve(ae);if(typeof ae=="number"||typeof ae=="boolean")return ae;if(ae instanceof Array){for(var D=[],H=ae.length,ue=0;ue<H;++ue){var je=ae[ue];kh(ne,ue,je)?D.push(je):D.push(Hi(je,ne))}return D}for(var Je={},vt=0,Gt=Object.keys(ae);vt<Gt.length;vt++){var on=Gt[vt],dt=ae[on];if(on==="name"&&typeof dt=="string")Je[on]=dt;else{var Mn=ve(on);Je[Mn]=Hi(dt,Mn)}}return Je}var Lo=function(){function ae(ne){if(this.id2Value={},this.id2Mask={},this.name2Id={},ne instanceof ae)for(var D in ne.id2Value)this.id2Value[D]=ne.id2Value[D],D in ne.id2Mask&&(this.id2Mask[D]=ne.id2Mask[D]);else{if(ne==null)return;for(var H=0,ue=ne;H<ue.length;H++){var je=ue[H];this.add(je.key,je.value)}}}return ae.prototype.add=function(ne,D,H){if(this.id2Value[ne.id]!=null)throw new q("Duplicate key: name="+ne.name+", id="+ne.id);return this.id2Value[ne.id]=function(ue,je){if(ue.dtype==null||ue.dtype===je.dtype)return je;try{return Object(l.cast)(je,ue.dtype)}catch{throw new q("The dtype of the feed ("+je.dtype+") can not be cast to the dtype of the key '"+ue.name+"' ("+ue.dtype+").")}}(ne,D),this.name2Id[ne.name]=ne.id,H!=null&&(this.id2Mask[ne.id]=H),this},ae.prototype.addFeed=function(ne){this.add(ne.key,ne.value)},ae.prototype.hasKey=function(ne){return this.id2Value[ne.id]!=null},ae.prototype.names=function(){return Object.keys(this.name2Id)},ae.prototype.getValue=function(ne){if(ne instanceof wo){if(this.id2Value[ne.id]==null)throw new q("Nonexistent key: "+ne.name);return this.id2Value[ne.id]}var D=this.name2Id[ne];if(D==null)throw new q("Feed dict has no SymbolicTensor name: "+ne);return this.id2Value[D]},ae.prototype.getMask=function(ne){if(ne instanceof wo){if(this.id2Value[ne.id]==null)throw new q("Nonexistent key: "+ne.name);return this.id2Mask[ne.id]}var D=this.name2Id[ne];if(D==null)throw new q("Feed dict has no SymbolicTensor name: "+ne);return this.id2Mask[D]},ae.prototype.disposeMasks=function(){this.id2Mask!=null&&Object(l.dispose)(this.id2Mask)},ae}(),Ch={},Gg={};function md(ae,ne,D,H){for(var ue=D!=null&&D.training,je=Array.isArray(ae),Je=je?ae:[ae],vt=Je.map(function(Ui){return Ui.name}),Gt=[],on=ne.names(),dt=0,Mn=vt;dt<Mn.length;dt++){var zn=Mn[dt];on.indexOf(zn)!==-1?Gt.push(ne.getValue(zn)):Gt.push(null)}H!=null&&(H.maxNumTensors=-1/0,H.minNumTensors=1/0);var Hn,nr,Yn=vt.join(",")+"|"+ne.names().join(",");if(Ch[Yn]==null){var dr=function(Ui,So){l.util.assert(Ui!=null&&Ui.length>0,function(){return"Expected at least one fetch, got none"});var ya=[],wa={};if(Ui.length===1){var ha=jp(Ui[0],So);ya=ha.sorted,wa=ha.recipientMap}else for(var oa=new Set,ls=0,_a=Ui;ls<_a.length;ls++){for(var ko=jp(_a[ls],So),Ma=ko.sorted,Ku=ko.recipientMap,Es=0,Ha=Ma;Es<Ha.length;Es++){var Bo=Ha[Es];oa.has(Bo.name)||(ya.push(Bo),oa.add(Bo.name))}var Rc=function($s){wa[$s]==null&&(wa[$s]=new Set),Ku[$s].forEach(function(aa){return wa[$s].add(aa)})};for(var lu in Ku)Rc(lu)}return{sorted:ya,recipientCounts:function($s){var aa={};for(var Xs in $s)aa[Xs]=$s[Xs].size;return aa}(wa)}}(Je,ne);Hn=dr.sorted,nr=dr.recipientCounts,Ch[Yn]=Hn,Gg[Yn]=nr}Hn=Ch[Yn],nr={},ue||Object.assign(nr,Gg[Yn]);for(var gr=new Lo(ne),Ar=0;Ar<Hn.length;++Ar){if(H!=null){var Gr=Object(l.memory)().numTensors;Gr>H.maxNumTensors&&(H.maxNumTensors=Gr),Gr<H.minNumTensors&&(H.minNumTensors=Gr)}var ii=Hn[Ar],Ir=ii.sourceLayer;if(!(Ir instanceof Uu)){for(var ai=[],ni=[],bi=[],_i=!1,oi=0,pi=ii.inputs;oi<pi.length;oi++){var fo=pi[oi],lo=gr.getValue(fo),qo=gr.getMask(fo);ai.push(lo),ni.push(qo),qo!=null&&(_i=!0),ue||(nr[fo.name]--,nr[fo.name]!==0||ne.hasKey(fo)||vt.indexOf(fo.name)!==-1||lo.isDisposed||fo.sourceLayer.stateful===!0||bi.push(lo))}_i&&((D=D||{}).mask=ni[0]);var $i=be(Ir.apply(ai,D)),ho=null;Ir.supportsMasking&&(ho=Ir.computeMask(ai,ni));for(var fa=Ds(ii),Wo=Array.isArray(fa)?fa:[fa],ia=0;ia<Wo.length;++ia){gr.hasKey(Wo[ia])||gr.add(Wo[ia],$i[ia],Array.isArray(ho)?ho[0]:ho);var Vi=vt.indexOf(Wo[ia].name);Vi!==-1&&(Gt[Vi]=$i[ia])}ue||Object(l.dispose)(bi)}}return gr.disposeMasks(),je?Gt:Gt[0]}function jp(ae,ne){for(var D=new Set,H=[],ue={},je=0,Je=ne.names();je<Je.length;je++){var vt=Je[je];D.add(vt)}var Gt=[],on=[];for(Gt.push(ae);Gt.length>0;){var dt=Gt[Gt.length-1];if(D.has(dt.name))Gt.pop();else{var Mn=on[on.length-1]===Gt.length-1;if(dt.inputs.length===0||Mn)Gt.pop(),H.push(dt),D.add(dt.name),Mn&&on.pop();else{on.push(Gt.length-1);for(var zn=0,Hn=dt.inputs;zn<Hn.length;zn++){var nr=Hn[zn];ue[nr.name]==null&&(ue[nr.name]=new Set),ue[nr.name].add(dt.name),D.has(nr.name)||Gt.push(nr)}}}}return{sorted:H,recipientMap:ue}}function Ds(ae){var ne;if(ae.sourceLayer.inboundNodes.length===1)ne=ae.sourceLayer.output;else{for(var D=null,H=0;H<ae.sourceLayer.inboundNodes.length;++H)for(var ue=0,je=ae.sourceLayer.inboundNodes[H].outputTensors;ue<je.length;ue++)if(je[ue].id===ae.id){D=H;break}ne=ae.sourceLayer.getOutputAt(D)}return ne}function Mc(ae,ne){return function(D,H,ue){var je=H.length;if(D==null||Array.isArray(D)&&D.length===0)return H.map(function(vt){return null});if(je===1)return Array.isArray(D)&&D.length===1?D:typeof D=="object"&&H[0]in D?[D[H[0]]]:[D];if(Array.isArray(D)){if(D.length!==je)throw new Error("Provided "+ue+" is an array of "+D.length+" element(s), but the model has "+je+" outputs. Make sure a set of weights is provided for each model output.");return D}if(typeof D=="object"&&Object.keys(D).length>0&&typeof D[Object.keys(D)[0]]=="object"){var Je=[];return H.forEach(function(vt){vt in D?Je.push(D[vt]):Je.push(null)}),Je}throw new Error("The model has multiple ("+je+") outputs, so "+ue+" must be either an array with "+je+" elements or an object with "+H+" keys. Provided "+ue+" not understood: "+JSON.stringify(D))}(ae,ne,"classWeight")}function zp(ae,ne,D,H){return j(this,void 0,void 0,function(){var ue,je,Je,vt,Gt;return N(this,function(on){switch(on.label){case 0:if(ne!=null||H!=null)throw new Error("Support sampleWeight is not implemented yet");return D==null?[3,2]:(ue=Object(l.tidy)(function(){if(ae.shape.length===1)return ae.clone();if(ae.shape.length===2){if(ae.shape[1]>1)return ae.argMax(1);if(ae.shape[1]===1)return ae.reshape([ae.shape[0]]);throw new Error("Encountered unexpected last-dimension size ("+ae.shape[1]+") during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor ("+ae.rank+") during handling of class weights. The rank is expected to be 1 or 2.")}),vt=(Je=Array).from,[4,ue.data()]);case 1:return je=vt.apply(Je,[on.sent()]),Object(l.dispose)(ue),Gt=[],je.forEach(function(dt){if(D[dt]==null)throw new Error("classWeight must contain all classes in the training data. The class "+dt+" exists in the data but not in classWeight");Gt.push(D[dt])}),[2,Object(l.tensor1d)(Gt,"float32")];case 2:return[2,null]}})})}function Km(ae,ne){return Object(l.mul)(ae,ne)}var Ym=32;function qg(ae,ne){var D,H,ue=ne;D=ue.xs,H=ue.ys,l.util.assert(D!=null&&H!=null,function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+ne});var je=$g("input",ae.inputNames,D),Je=$g("output",ae.outputNames,H),vt=je[0].shape[0];l.util.assert(je.length===ae.inputs.length,function(){return"LayersModel has "+ae.inputs.length+" inputs, but the dataset provides "+je.length+" inputs.  (Expected input keys: "+JSON.stringify(ae.inputNames)+")"}),l.util.assert(Je.length===ae.outputs.length,function(){return"LayersModel has "+ae.outputs.length+" outputs, but the dataset provides "+Je.length+" outputs.  (Expected output keys: "+JSON.stringify(ae.outputNames)+")"});for(var Gt=function(zn){l.util.assert(je[zn].shape[0]===vt,function(){return"Batch size mismatch: input "+ae.inputNames[zn]+" has "+je[zn].shape[0]+"; expected  "+vt+" based on input "+ae.inputNames[0]+"."})},on=0;on<je.length;on++)Gt(on);for(var dt=function(zn){l.util.assert(Je[zn].shape[0]===vt,function(){return"Batch size mismatch: output "+ae.outputNames[zn]+" has "+Je[zn].shape[0]+"; expected  "+vt+" based on input "+ae.inputNames[0]+"."})},Mn=0;Mn<Je.length;Mn++)dt(Mn);return{xs:je,ys:Je}}function $g(ae,ne,D){if(D instanceof l.Tensor)return[D];if(Array.isArray(D))return l.util.assert(D.length===ne.length,function(){return"Received an array of "+D.length+" Tensors, but expected "+ne.length+" to match the "+ae+" keys "+ne+"."}),D;for(var H=[],ue=0,je=ne;ue<je.length;ue++){var Je=je[ue];if(D[Je]==null)throw new q("The feature data generated by the dataset lacks the required "+ae+" key '"+Je+"'.");H.push(D[Je])}return H}function kl(ae,ne,D){return j(this,void 0,void 0,function(){var H,ue,je,Je,vt,Gt,on,dt,Mn,zn,Hn,nr,Yn,dr,gr,Ar,Gr,ii,Ir,ai,ni,bi,_i,oi,pi,fo,lo,qo,$i,ho,fa,Wo,ia,Vi;return N(this,function(Ui){switch(Ui.label){case 0:if(H=D.batchesPerEpoch!=null,l.util.assert(ae.optimizer!=null,function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."}),l.util.assert(D!=null,function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."}),l.util.assert(D.epochs!=null&&D.epochs>0&&Number.isInteger(D.epochs),function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got "+D.epochs}),l.util.assert(!H||D.batchesPerEpoch>0&&Number.isInteger(D.batchesPerEpoch),function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got "+D.batchesPerEpoch}),l.util.assert(D.validationSplit==null,function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."}),ae.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");ae.isTraining=!0,Ui.label=1;case 1:return Ui.trys.push([1,,26,27]),ue=D.validationData!=null,je=void 0,Je=void 0,ue&&(Ka(D.validationData)?l.util.assert(D.validationBatches==null||D.validationBatches>0&&Number.isInteger(D.validationBatches),function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got "+D.validationBatches}):(vt=function(So){if(So.length===3)throw new I("Validation with sample weights is not implemented yet.");return{xs:So[0],ys:So[1]}}(D.validationData),je=vt.xs,Je=vt.ys)),Gt=ae.makeTrainFunction(),on=ae.getDedupedMetricsNames(),dt=void 0,dt=ue?on.slice().concat(on.map(function(So){return"val_"+So})):on.slice(),Mn=wh(D.callbacks,D.yieldEvery),zn=D.verbose==null?1:D.verbose,Hn=uf(Mn,zn,D.epochs,null,null,function(So,ya){var wa=null;return ya.batchesPerEpoch!=null?wa=ya.batchesPerEpoch:Number.isFinite(So.size)&&(wa=So.size),wa}(ne,D),null,ue,dt),nr=Hn.callbackList,Yn=Hn.history,nr.setModel(ae),ae.history=Yn,[4,nr.onTrainBegin()];case 2:return Ui.sent(),ae.stopTraining_=!1,dr=D.initialEpoch==null?0:D.initialEpoch,[4,ne.iterator()];case 3:gr=Ui.sent(),Ui.label=4;case 4:return dr<D.epochs?(Ar={},[4,nr.onEpochBegin(dr)]):[3,23];case 5:return Ui.sent(),Gr=0,ii=0,H?[3,7]:[4,ne.iterator()];case 6:gr=Ui.sent(),Ui.label=7;case 7:return!H||Gr<D.batchesPerEpoch?[4,gr.next()]:[3,21];case 8:return Ir=Ui.sent(),H&&Ir.done?(console.warn("You provided `batchesPerEpoch` as "+D.batchesPerEpoch+", but your dataset iterator ran out of data after "+Gr+" batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+D.batchesPerEpoch*D.epochs+" batches). You may need to use the repeat() function when building your dataset."),[3,21]):Ir.value==null?[3,15]:(ai=qg(ae,Ir.value),ni=ai.xs,bi=ai.ys,(_i={}).batch=ii,_i.size=ni[0].shape[0],[4,nr.onBatchBegin(ii,_i)]);case 9:if(Ui.sent(),oi=[],D.classWeight==null)return[3,13];pi=Mc(D.classWeight,ae.outputNames),Vi=0,Ui.label=10;case 10:return Vi<pi.length?(lo=(fo=oi).push,[4,zp(bi[Vi],null,pi[Vi])]):[3,13];case 11:lo.apply(fo,[Ui.sent()]),Ui.label=12;case 12:return++Vi,[3,10];case 13:for(qo=ni.concat(bi).concat(oi),$i=Gt(qo),Object(l.dispose)(qo),Vi=0;Vi<on.length;++Vi)ho=on[Vi],fa=$i[Vi],_i[ho]=fa,Object(l.keep)(fa);return[4,nr.onBatchEnd(ii,_i)];case 14:Ui.sent(),Jc(_i),ii++,Gr++,Ui.label=15;case 15:return(H?Gr>=D.batchesPerEpoch:Ir.done)?ue?(Wo=void 0,Ka(D.validationData)?(ia=be,[4,ae.evaluateDataset(D.validationData,{batches:D.validationBatches})]):[3,17]):[3,19]:[3,20];case 16:return Wo=ia.apply(void 0,[Ui.sent()]),[3,18];case 17:Wo=be(ae.evaluate(je,Je,{batchSize:D.validationBatchSize==null?Ym:D.validationBatchSize,verbose:0})),Ui.label=18;case 18:for(Vi=0;Vi<ae.metricsNames.length;++Vi)Ar["val_"+ae.metricsNames[Vi]]=Wo[Vi];Ui.label=19;case 19:return[3,21];case 20:return ae.stopTraining_?[3,21]:[3,7];case 21:return[4,nr.onEpochEnd(dr,Ar)];case 22:return Ui.sent(),dr++,ae.stopTraining_?[3,23]:[3,4];case 23:return[4,nr.onTrainEnd()];case 24:return Ui.sent(),[4,ae.history.syncData()];case 25:return Ui.sent(),[2,ae.history];case 26:return ae.isTraining=!1,[7];case 27:return[2]}})})}function Ka(ae){return typeof ae.iterator=="function"}function Ah(ae){l.util.assert(ae>0&&Number.isInteger(ae),function(){return"batchSize is required to be a positive integer, but got "+ae})}function Ze(ae,ne,D){return ae==null?[null]:Array.isArray(ae)?ae.map(function(H){return Er(H,ne,D-ne)}):Er(ae,ne,D-ne)}function cc(ae,ne){return Object(l.tidy)(function(){return ae==null?null:Array.isArray(ae)?ae.map(function(D){return cc(D,ne)}):Cr(ae,ne.dtype==="int32"?ne:ne.toInt())})}function gd(ae,ne){for(var D=[],H=0,ue=null;H<ae;)(ue=H+ne)>=ae&&(ue=ae),D.push([H,ue]),H=ue;return D}function Up(ae,ne,D,H){return H===void 0&&(H={}),j(this,void 0,void 0,function(){var ue,je,Je,vt,Gt,on,dt,Mn,zn,Hn,nr,Yn,dr,gr,Ar,Gr,ii,Ir,ai,ni,bi,_i;return N(this,function(oi){switch(oi.label){case 0:if(ae.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");ae.isTraining=!0,oi.label=1;case 1:return oi.trys.push([1,,7,8]),Ah(Mn=H.batchSize==null?32:H.batchSize),zn=!1,[4,ae.standardizeUserData(ne,D,H.sampleWeight,H.classWeight,zn,Mn)];case 2:if(Hn=oi.sent(),ue=Hn[0],je=Hn[1],dt=Hn[2],nr=!1,Yn=void 0,!(H.validationData!=null&&H.validationData.length>0))return[3,4];if(nr=!0,H.validationData.length!==2)throw H.validationData.length===3?new I("validationData including sample weights is not supported yet."):new q("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+H.validationData+" is invalid.");return Je=H.validationData[0],vt=H.validationData[1],dr=!0,[4,ae.standardizeUserData(Je,vt,null,null,dr,Mn)];case 3:return gr=oi.sent(),Gt=gr[0],on=gr[1],Yn=Gt.concat(on),[3,5];case 4:H.validationSplit!=null&&H.validationSplit>0&&H.validationSplit<1?(nr=!0,Ar=Math.floor(ue[0].shape[0]*(1-H.validationSplit)),Gr=ue[0].shape[0],Gt=Ze(ue,Ar,Gr),ue=Ze(ue,0,Ar),on=Ze(je,Ar,Gr),je=Ze(je,0,Ar),Yn=Gt.concat(on)):H.validationSteps!=null&&(nr=!0),oi.label=5;case 5:return ii=ue.concat(je).concat(dt),ae.checkTrainableWeightsConsistency(),Ir=ae.makeTrainFunction(),ai=ae.getDedupedMetricsNames(),ni=void 0,bi=void 0,nr?(ae.makeTestFunction(),ni=ae.testFunction,bi=ai.slice().concat(ai.map(function(pi){return"val_"+pi}))):(ni=null,Yn=[],bi=ai.slice()),_i=wh(H.callbacks,H.yieldEvery),[4,function(pi,fo,lo,qo,$i,ho,fa,Wo,ia,Vi,Ui,So,ya,wa,ha){return j(this,void 0,void 0,function(){var oa,ls,_a,ko,Ma,Ku,Es,Ha;return N(this,function(Bo){switch(Bo.label){case 0:if($i==null&&($i=32),ho==null&&(ho=1),Ui==null&&(Ui=!0),ya==null&&(ya=0),oa=!1,ia!=null&&Vi!=null&&(oa=!0),ha!=null&&(oa=!0,wa==null))throw new q("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");return(ls=pi.checkNumSamples(lo,$i,wa,"steps_per_epoch"))!=null&&(_a=Un(0,ls)),fa==null&&(fa=1),ko=uf(Wo,fa,ho,ya,ls,wa,$i,oa,So),Ma=ko.callbackList,Ku=ko.history,Ma.setModel(pi),pi.history=Ku,[4,Ma.onTrainBegin()];case 1:Bo.sent(),pi.stopTraining_=!1,Es=function(Rc){var lu,$s,aa,Xs,jo;return N(this,function(Bs){switch(Bs.label){case 0:return[4,Ma.onEpochBegin(Rc)];case 1:if(Bs.sent(),lu={},wa==null)return[3,2];throw new I("stepsPerEpoch mode is not implemented yet.");case 2:if(Ui==="batch")throw new I("batch shuffling is not implemneted yet");Ui&&l.util.shuffle(_a),$s=Object(l.tensor1d)(_a),aa=gd(ls,$i),Xs=function(Ss){var go;return N(this,function(js){switch(js.label){case 0:return go={},[4,Ma.onBatchBegin(Ss,go)];case 1:return js.sent(),Object(l.tidy)(function(){var ns=aa[Ss][0],fu=aa[Ss][1],il=Er($s,ns,fu-ns);go.batch=Ss,go.size=fu-ns;for(var $o=cc(lo,il),fs=fo($o),Ga=0;Ga<qo.length;++Ga){var Pc=qo[Ga],Rl=fs[Ga];go[Pc]=Rl,Object(l.keep)(Rl)}if(Ss===aa.length-1&&oa){var wi=pi.testLoop(ia,Vi,$i);for(Ga=0;Ga<qo.length;++Ga)Pc=qo[Ga],Rl=wi[Ga],Object(l.keep)(Rl),lu["val_"+Pc]=Rl}}),[4,Ma.onBatchEnd(Ss,go)];case 2:return js.sent(),Jc(go),pi.stopTraining_?[2,"break"]:[2]}})},jo=0,Bs.label=3;case 3:return jo<aa.length?[5,Xs(jo)]:[3,6];case 4:if(Bs.sent()==="break")return[3,6];Bs.label=5;case 5:return++jo,[3,3];case 6:$s.dispose(),Bs.label=7;case 7:return[4,Ma.onEpochEnd(Rc,lu)];case 8:return Bs.sent(),pi.stopTraining_?[2,"break"]:[2]}})},Ha=ya,Bo.label=2;case 2:return Ha<ho?[5,Es(Ha)]:[3,5];case 3:if(Bo.sent()==="break")return[3,5];Bo.label=4;case 4:return++Ha,[3,2];case 5:return[4,Ma.onTrainEnd()];case 6:return Bo.sent(),[4,pi.history.syncData()];case 7:return Bo.sent(),[2,pi.history]}})})}(ae,Ir,ii,ai,Mn,H.epochs,H.verbose,_i,ni,Yn,H.shuffle,bi,H.initialEpoch,null,null)];case 6:return[2,oi.sent()];case 7:return ae.isTraining=!1,Fo(ue,ne),Fo(je,D),Fo(Gt,Je),Fo(on,vt),dt!=null&&Object(l.dispose)(dt),[7];case 8:return[2]}})})}function Io(ae){var ne=[];ae instanceof l.Tensor&&(ae=[ae]);for(var D=0;D<ae.length;++D){var H=ae[D];if(H.rank===1)ne.push(sr(H,1));else{if(H.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");ne.push(H)}}return ne}function Fo(ae,ne){if(ae!=null){var D=[];if(ne instanceof l.Tensor)D.push(ne.id);else if(Array.isArray(ne))ne.forEach(function(Gt){return D.push(Gt.id)});else if(ne!=null)for(var H in ne){var ue=ne[H];D.push(ue.id)}var je=[];if(ae instanceof l.Tensor)D.indexOf(ae.id)===-1&&je.push(ae);else if(Array.isArray(ae))ae.forEach(function(Gt){D.indexOf(Gt.id)===-1&&je.push(Gt)});else if(ae!=null)for(var Je in ae){var vt=ae[Je];D.indexOf(vt.id)===-1&&je.push(vt)}je.forEach(function(Gt){Gt.isDisposed||Gt.dispose()})}}function ta(ae){return Array.isArray(ae)}function Ra(ae){return!function(ne){return ne instanceof l.Tensor}(ae)&&!ta(ae)}function Vu(ae,ne,D,H,ue){if(H===void 0&&(H=!0),ue===void 0&&(ue=""),ne==null||ne.length===0){if(ae!=null){var je=!1;if(ta(ae)&&ae.length>0)je=!0;else if(Ra(ae)){for(var Je in ae)if(ae.hasOwnProperty(Je)){je=!0;break}}else je=!0;if(je)throw new q("Error when checking model "+ue+" expected no data, but got "+ae)}return[]}if(ae==null)return ne.map(function(dr){return null});var vt;if(Ra(ae)){ae=ae,vt=[];for(var Gt=0,on=ne;Gt<on.length;Gt++){var dt=on[Gt];if(ae[dt]==null)throw new q('No data provided for "'+dt+'". Need data for each key in: '+ne);vt.push(ae[dt])}}else if(ta(ae)){if((ae=ae).length!==ne.length)throw new q("Error when checking model "+ue+": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see "+ne.length+" Tensor(s), but instead got the following list of Tensor(s): "+ae);vt=ae}else{if(ae=ae,ne.length>1)throw new q("The model "+ue+" expects "+ne.length+" Tensor(s), but only received one Tensor. Found: Tensor with shape "+ae.shape);vt=[ae]}if(vt=Io(vt),D!=null){for(var Mn=0;Mn<ne.length;++Mn)if(D[Mn]!=null){var zn=vt[Mn];if(zn.shape.length!==D[Mn].length)throw new q("Error when checking "+ue+": expected "+ne[Mn]+" to have "+D[Mn].length+" dimension(s). but got array with shape "+zn.shape);for(var Hn=0;Hn<D[Mn].length;++Hn)if(Hn!==0||H){var nr=zn.shape[Hn],Yn=D[Mn][Hn];if(Yn!=null&&Yn>=0&&nr!==Yn)throw new q("Error when checking "+ue+": expected "+ne[Mn]+" to have shape ["+D[Mn]+"], but got array with shape ["+zn.shape+"].")}}}return vt}function Pa(ae,ne,D,H,ue){var je;if(H===void 0&&(H=!0),ue===void 0&&(ue=""),Array.isArray(ae)){if(ae.length!==ne.length)throw new q("Error when checking model "+ue+": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see "+ne.length+" Tensor(s), but instead got "+ae.length+" Tensors(s).");je=ae}else{if(ne.length>1)throw new q("The model expects "+ne.length+" "+ue+" Tensors, but only received one Tensor. Found: array with shape "+JSON.stringify(ae.shape)+".");je=[ae]}if(D!=null){for(var Je=0;Je<ne.length;++Je)if(D[Je]!=null){var vt=je[Je];if(vt.shape.length!==D[Je].length)throw new q("Error when checking "+ue+": expected "+ne[Je]+" to have "+D[Je].length+" dimension(s), but got array with shape "+JSON.stringify(vt.shape));for(var Gt=0;Gt<D[Je].length;++Gt)if(Gt!==0||H){var on=vt.shape[Gt],dt=D[Je][Gt];if(dt!=null&&dt!==on)throw new q("Error when checking "+ue+": expected "+ne[Je]+" to have shape "+JSON.stringify(D[Je])+" but got array with shape "+JSON.stringify(vt.shape)+".")}}}}var Zc=function(ae){function ne(D){var H=ae.call(this,D)||this;return H.isTraining=!1,H}return S(ne,ae),ne.prototype.summary=function(D,H,ue){if(ue===void 0&&(ue=console.log),!this.built)throw new q("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");pd(this,D,H,ue)},ne.prototype.compile=function(D){var H=this;if(D.loss==null&&(D.loss=[]),this.loss=D.loss,typeof D.optimizer=="string")this.optimizer_=function(dr){var gr={Adagrad:function(){return l.train.adagrad(.01)},Adadelta:function(){return l.train.adadelta(1,.95,L())},Adam:function(){return l.train.adam(.001,.9,.999,L())},Adamax:function(){return l.train.adamax(.002,.9,.999,L(),0)},RMSProp:function(){return l.train.rmsprop(.001,.9,0,L())},SGD:function(){return l.train.sgd(.01)}};if(gr.adagrad=gr.Adagrad,gr.adadelta=gr.Adadelta,gr.adam=gr.Adam,gr.adamax=gr.Adamax,gr.rmsprop=gr.RMSProp,gr.sgd=gr.SGD,dr in gr)return gr[dr]();throw new q("Unknown Optimizer "+dr)}(D.optimizer),this.isOptimizerOwned=!0;else{if(!(D.optimizer instanceof l.Optimizer))throw new q("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=D.optimizer,this.isOptimizerOwned=!1}var ue=[];if(Array.isArray(D.loss)||typeof D.loss=="string"||typeof D.loss=="function")if(Array.isArray(D.loss)){if(D.loss.length!==this.outputs.length)throw new q("When passing an Array as loss, it should have one entry per model output. The model has "+this.outputs.length+" output(s), but you passed loss="+D.loss+".");var je=D.loss;ue=je.map(function(dr){return _h(dr)})}else{var Je=_h(D.loss);this.outputs.forEach(function(dr){ue.push(Je)})}else{for(var vt in D.loss=D.loss,D.loss)if(this.outputNames.indexOf(vt)===-1)throw new q('Unknown entry in loss dictionary: "'+vt+'". Only expected the following keys: '+this.outputNames);for(var Gt=0,on=this.outputNames;Gt<on.length;Gt++){var dt=on[Gt];D.loss[dt]==null&&console.warn('Output "'+dt+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to '+dt+" during training"),ue.push(_h(D.loss[dt]))}}this.lossFunctions=ue,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var Mn=0;Mn<this.outputs.length;++Mn){var zn=this.internalOutputShapes[Mn],Hn=this.outputNames[Mn];this.feedOutputNames.push(Hn),this.feedOutputShapes.push(zn),this.feedLossFns.push(this.lossFunctions[Mn])}var nr=[];this.metrics=D.metrics,this.metricsNames=["loss"],this.metricsTensors=[],ar("loss",function(){for(var dr=0;dr<H.outputs.length;++dr)if(nr.indexOf(dr)===-1){var gr=H.lossFunctions[dr];H.outputs.length>1&&(H.metricsTensors.push([gr,dr]),H.metricsNames.push(H.outputNames[dr]+"_loss"))}});var Yn=function(dr,gr){if(dr==null||Array.isArray(dr)&&dr.length===0)return gr.map(function(bi){return[]});var Ar;if(typeof dr=="string"||typeof dr=="function")Ar=[dr];else{if(!Array.isArray(dr)&&typeof dr!="object")throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: "+dr);Ar=dr}if(Array.isArray(Ar))return gr.map(function(bi){return Ar});for(var Gr=[],ii=0,Ir=gr;ii<Ir.length;ii++){var ai=Ir[ii],ni=Ar.hasOwnProperty(ai)?Ar[ai]:[];Array.isArray(ni)||(ni=[ni]),Gr.push(ni)}return Gr}(D.metrics,this.outputNames);ar("metric",function(){for(var dr=function(Ar){if(nr.indexOf(Ar)!==-1)return"continue";(function(Gr){for(var ii,Ir,ai,ni=function(oi){if(typeof oi=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(oi)!==-1){var pi=H.internalOutputShapes[Ar];pi[pi.length-1]===1||H.lossFunctions[Ar]===cf?["accuracy","acc"].indexOf(oi)!==-1?Ir=cd:["crossentropy","ce"].indexOf(oi)!==-1&&(Ir=fd):H.lossFunctions[Ar]===Oc?["accuracy","acc"].indexOf(oi)!==-1?Ir=dd:["crossentropy","ce"].indexOf(oi)!==-1&&(Ir=hd):["accuracy","acc"].indexOf(oi)!==-1?Ir=ld:["crossentropy","ce"].indexOf(oi)!==-1&&(Ir=Ms);var fo=void 0;["accuracy","acc"].indexOf(oi)!==-1?fo="acc":["crossentropy","ce"].indexOf(oi)!==-1&&(fo="ce"),ai=Ir,ii=""+fo}else{var lo=function($i){if(typeof $i=="string"&&$i in yr)return yr[$i];if(typeof $i!="string"&&$i!=null)return $i;throw new q("Unknown metric "+$i)}(oi);ai=lo,ii=""+Wu(oi)}var qo;ar(ii,function(){qo=ai}),function($i,ho,fa){H.outputNames.length>1&&(ho=H.outputNames[$i]+"_"+ho),H.metricsNames.push(ho),H.metricsTensors.push([fa,$i])}(Ar,ii,qo)},bi=0,_i=Yn[Ar];bi<_i.length;bi++)ni(_i[bi])})()},gr=0;gr<H.outputs.length;++gr)dr(gr)}),this.collectedTrainableWeights=this.trainableWeights},ne.prototype.checkTrainableWeightsConsistency=function(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},ne.prototype.evaluate=function(D,H,ue){ue===void 0&&(ue={});var je=ue.batchSize==null?32:ue.batchSize;Ah(je);var Je=this.standardizeUserDataXY(D,H,!0,je);try{var vt=Je[0].concat(Je[1]);this.makeTestFunction();var Gt=this.testFunction;return ce(this.testLoop(Gt,vt,je,ue.verbose,ue.steps))}finally{Fo(Je[0],D),Fo(Je[1],H)}},ne.prototype.evaluateDataset=function(D,H){return j(this,void 0,void 0,function(){return N(this,function(ue){return this.makeTestFunction(),[2,function(je,Je,vt){return j(this,void 0,void 0,function(){var Gt,on,dt,Mn,zn,Hn,nr,Yn,dr,gr;return N(this,function(Ar){switch(Ar.label){case 0:if(Gt=(vt=vt||{}).batches!=null,on=je.testFunction,dt=[],vt.verbose>0)throw new I("Verbose mode is not implemented yet.");return l.util.assert(!Gt||vt.batches>0&&Number.isInteger(vt.batches),function(){return"Test loop expects `batches` to be a positive integer, but received "+JSON.stringify(vt.batches)}),function(Gr){return typeof Gr.next=="function"}(Je)?(zn=Je,[3,3]):[3,1];case 1:return[4,Je.iterator()];case 2:zn=Ar.sent(),Ar.label=3;case 3:Mn=zn,Hn=0,nr=0,Yn=function(){var Gr;return N(this,function(ii){switch(ii.label){case 0:return[4,Mn.next()];case 1:return Gr=ii.sent(),dt=Object(l.tidy)(function(){if(Gr.value){var Ir=qg(je,Gr.value),ai=Ir.xs,ni=Ir.ys,bi=ai.concat(ni),_i=Object(l.tidy)(function(){return on(bi)});if(Object(l.dispose)(bi),nr===0)for(var oi=0;oi<_i.length;++oi)dt.push(Object(l.scalar)(0));var pi=bi[0].shape[0],fo=function(lo){var qo=_i[lo],$i=dt[lo];dt[lo]=Object(l.tidy)(function(){return Object(l.add)(dt[lo],Object(l.mul)(pi,qo))}),nr>0&&Object(l.dispose)($i)};for(oi=0;oi<_i.length;++oi)fo(oi);Object(l.dispose)(_i),Hn+=pi,++nr}return dt}),Gr.done?(Gt&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, "+vt.batches+" batches). You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}})},Ar.label=4;case 4:return!Gt||nr<vt.batches?[5,Yn()]:[3,6];case 5:return Ar.sent()==="break"?[3,6]:[3,4];case 6:for(dr=0;dr<dt.length;++dr)gr=dt[dr],dt[dr]=Object(l.div)(dt[dr],Hn),Object(l.dispose)(gr);return[2,ce(dt)]}})})}(this,D,H)]})})},ne.prototype.checkNumSamples=function(D,H,ue,je){var Je;if(je===void 0&&(je="steps"),ue!=null){if(Je=null,H!=null)throw new q("If "+je+" is set, batchSize must be null or undefined.Got batchSize = "+H)}else{if(D==null)throw new q("Either the input data should have a defined shape, or "+je+" shoud be specified.");Je=Array.isArray(D)?D[0].shape[0]:D.shape[0]}return Je},ne.prototype.execute=function(D,H){if(Array.isArray(H)&&H.length===0)throw new q("`outputs` is an empty Array, which is not allowed.");var ue=Array.isArray(H),je=ue?H:[H],Je=this.retrieveSymbolicTensors(je),vt=new Lo;if(D instanceof l.Tensor&&(D=[D]),Array.isArray(D)){if(D.length!==this.inputs.length)throw new q("The number of inputs provided ("+D.length+") does not match the number of inputs of this model ("+this.inputs.length+").");for(var Gt=0;Gt<this.inputs.length;++Gt)vt.add(this.inputs[Gt],D[Gt])}else for(var on=0,dt=this.inputs;on<dt.length;on++){var Mn=dt[on],zn=D[Mn.name];if(zn==null)throw new q("No value is provided for the model's input "+Mn.name);vt.add(Mn,zn)}var Hn=md(Je,vt);return ue?Hn:Hn[0]},ne.prototype.retrieveSymbolicTensors=function(D){for(var H=Y(null,D.length),ue=D.length,je=0,Je=this.layers;je<Je.length;je++){for(var vt=Je[je],Gt=Array.isArray(vt.output)?vt.output:[vt.output],on=Gt.map(function(Hn){return Hn.name}),dt=0;dt<D.length;++dt){var Mn=on.indexOf(D[dt]);if(Mn!==-1&&(H[dt]=Gt[Mn],ue--),ue===0)break}if(ue===0)break}if(ue>0){var zn=[];throw H.forEach(function(Hn,nr){Hn==null&&zn.push(D[nr])}),new q("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(zn))}return H},ne.prototype.predictLoop=function(D,H,ue){var je=this;return H===void 0&&(H=32),ue===void 0&&(ue=!1),Object(l.tidy)(function(){var Je=je.checkNumSamples(D);if(ue)throw new I("Verbose predictLoop() is not implemented yet.");for(var vt=gd(Je,H),Gt=je.outputs.map(function(Mn){return[]}),on=function(Mn){Object(l.tidy)(function(){var zn=vt[Mn][0],Hn=vt[Mn][1],nr=Ze(D,zn,Hn),Yn=[];if(Array.isArray(nr))for(var dr=0;dr<nr.length;++dr)Yn.push({key:je.inputs[dr],value:nr[dr]});else Yn.push({key:je.inputs[0],value:nr});var gr=new Lo(Yn);return md(je.outputs,gr)}).forEach(function(zn,Hn){return Gt[Hn].push(zn)})},dt=0;dt<vt.length;++dt)on(dt);return ce(Gt.map(function(Mn){return Object(l.concat)(Mn,0)}))})},ne.prototype.predict=function(D,H){H===void 0&&(H={});var ue=Io(D);Pa(ue,this.inputNames,this.feedInputShapes,!1);try{var je=H.batchSize==null?32:H.batchSize;return Ah(je),this.predictLoop(ue,je)}finally{Fo(ue,D)}},ne.prototype.predictOnBatch=function(D){Pa(D,this.inputNames,this.feedInputShapes,!0);var H=(Array.isArray(D)?D[0]:D).shape[0];return this.predictLoop(D,H)},ne.prototype.standardizeUserDataXY=function(D,H,ue,je){if(this.optimizer_==null)throw new z("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var Je=[],vt=0;vt<this.feedOutputShapes.length;++vt){var Gt=this.feedOutputShapes[vt];this.feedLossFns[vt]===Oc?Je.push(Gt.slice(0,Gt.length-1).concat([1])):Je.push(Gt)}if(function(on,dt,Mn){var zn=St(on.map(function(nr){return nr.shape[0]}));zn.sort();var Hn=St(dt.map(function(nr){return nr.shape[0]}));if(Hn.sort(),zn.length>1)throw new q("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(on.map(function(nr){return nr.shape})));if(Hn.length>1)throw new q("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(dt.map(function(nr){return nr.shape})));if(zn.length>0&&Hn.length>0&&!l.util.arraysEqual(zn,Hn))throw new q("Input Tensors should have the same number of samples as target Tensors. Found "+zn[0]+" input sample(s) and "+Hn[0]+" target sample(s).")}(D=Vu(D,this.feedInputNames,this.feedInputShapes,!1,"input"),H=Vu(H,this.feedOutputNames,Je,!1,"target")),function(on,dt,Mn){for(var zn=[ga,cf,Fa],Hn=0;Hn<on.length;++Hn){var nr=on[Hn],Yn=dt[Hn],dr=Mn[Hn];if(Yn!=null){if(Yn===Fa&&nr.shape[nr.shape.length-1]===1)throw new q("You are passing a target array of shape "+nr.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(zn.indexOf(Yn)!==-1)for(var gr=nr.shape.slice(1),Ar=dr.slice(1),Gr=0;Gr<gr.length;++Gr){var ii=gr[Gr],Ir=Ar[Gr];if(Ir!=null&&ii!==Ir)throw new q("A target Tensor with shape "+nr.shape+" was passed for an output of shape "+dr+", while using a loss function that expects targets to have the same shape as the output.")}}}}(H,this.feedLossFns,this.feedOutputShapes),this.stateful&&je!=null&&je>0&&D[0].shape[0]%je!=0)throw new q("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+je+". Found: "+D[0].shape[0]+" sample(s).");return[D,H]},ne.prototype.standardizeUserData=function(D,H,ue,je,Je,vt){return Je===void 0&&(Je=!0),j(this,void 0,void 0,function(){var Gt,on,dt,Mn,zn,Hn,nr,Yn;return N(this,function(dr){switch(dr.label){case 0:if(Gt=this.standardizeUserDataXY(D,H,Je,vt),on=Gt[0],dt=Gt[1],ue!=null)throw new Error("sample weight is not supported yet.");if(Mn=null,je==null)return[3,4];zn=Mc(je,this.outputNames),Mn=[],Hn=0,dr.label=1;case 1:return Hn<zn.length?(Yn=(nr=Mn).push,[4,zp(dt[Hn],null,zn[Hn])]):[3,4];case 2:Yn.apply(nr,[dr.sent()]),dr.label=3;case 3:return++Hn,[3,1];case 4:return[2,[on,dt,Mn]]}})})},ne.prototype.testLoop=function(D,H,ue,je,Je){var vt=this;return je===void 0&&(je=0),Object(l.tidy)(function(){var Gt=vt.checkNumSamples(H,ue,Je,"steps"),on=[];if(je>0)throw new I("Verbose mode is not implemented yet.");if(Je!=null)throw new I("steps mode in testLoop() is not implemented yet");for(var dt=gd(Gt,ue),Mn=Object(l.tensor1d)(Un(0,Gt)),zn=0;zn<dt.length;++zn){var Hn=dt[zn][0],nr=dt[zn][1],Yn=Er(Mn,Hn,nr-Hn),dr=cc(H,Yn),gr=D(dr);if(zn===0)for(var Ar=0;Ar<gr.length;++Ar)on.push(Object(l.scalar)(0));for(Ar=0;Ar<gr.length;++Ar){var Gr=gr[Ar];on[Ar]=Object(l.add)(on[Ar],Object(l.mul)(nr-Hn,Gr))}}for(Ar=0;Ar<on.length;++Ar)on[Ar]=Object(l.div)(on[Ar],Gt);return on})},ne.prototype.getDedupedMetricsNames=function(){for(var D=this.metricsNames,H=[],ue=0;ue<D.length;++ue){var je=D[ue],Je=je;oe(D,je)>1&&(Je+="_"+oe(D.slice(0,ue),je)),H.push(Je)}return H},ne.prototype.makeTrainFunction=function(){var D=this;return function(H){var ue=[],je=H.slice(0,D.inputs.length),Je=H.slice(D.inputs.length,D.inputs.length+D.outputs.length),vt=H.slice(D.inputs.length+D.outputs.length,D.inputs.length+2*D.outputs.length),Gt=[],on=D.collectedTrainableWeights.map(function(dt){return dt.read()});return[D.optimizer_.minimize(function(){for(var dt=[],Mn=0;Mn<D.inputs.length;++Mn)dt.push({key:D.inputs[Mn],value:je[Mn]});var zn,Hn=new Lo(dt),nr=md(D.outputs,Hn,{training:!0});for(Mn=0;Mn<D.lossFunctions.length;++Mn){var Yn=(0,D.lossFunctions[Mn])(Je[Mn],nr[Mn]);vt[Mn]!=null&&(Yn=Km(Yn,vt[Mn]));var dr=Object(l.mean)(Yn);ue.push(dr),zn=Mn===0?Yn:Object(l.add)(zn,Yn)}for(Mn=0;Mn<D.metricsTensors.length;++Mn){var gr=void 0;if(D.outputs.length>1&&Mn<D.outputs.length)gr=ue[Mn];else{var Ar=D.metricsTensors[Mn][0],Gr=D.metricsTensors[Mn][1];gr=Object(l.mean)(Ar(Je[Gr],nr[Gr]))}Object(l.keep)(gr),Gt.push(gr)}return zn=Object(l.mean)(zn),D.calculateLosses().forEach(function(ii){zn=Object(l.add)(zn,ii)}),zn},!0,on)].concat(Gt)}},ne.prototype.makeTestFunction=function(){var D=this;this.testFunction=function(H){return Object(l.tidy)(function(){for(var ue,je=[],Je=H.slice(0,D.inputs.length),vt=H.slice(D.inputs.length,D.inputs.length+D.outputs.length),Gt=[],on=0;on<D.inputs.length;++on)Gt.push({key:D.inputs[on],value:Je[on]});var dt=new Lo(Gt),Mn=md(D.outputs,dt);for(on=0;on<D.lossFunctions.length;++on){var zn=D.lossFunctions[on],Hn=Object(l.mean)(zn(vt[on],Mn[on]));ue=on===0?Hn:Object(l.add)(ue,Hn),je.push(ue)}for(on=0;on<D.metricsTensors.length;++on){var nr=D.metricsTensors[on][0],Yn=D.metricsTensors[on][1],dr=Object(l.mean)(nr(vt[Yn],Mn[Yn]));je.push(dr)}return je})}},ne.prototype.fit=function(D,H,ue){return ue===void 0&&(ue={}),j(this,void 0,void 0,function(){return N(this,function(je){return[2,Up(this,D,H,ue)]})})},ne.prototype.fitDataset=function(D,H){return j(this,void 0,void 0,function(){return N(this,function(ue){return[2,kl(this,D,H)]})})},ne.prototype.trainOnBatch=function(D,H){return j(this,void 0,void 0,function(){var ue,je,Je,vt,Gt,on,dt,Mn,zn;return N(this,function(Hn){switch(Hn.label){case 0:return[4,this.standardizeUserData(D,H)];case 1:ue=Hn.sent(),je=ue[0],Je=ue[1],vt=this.makeTrainFunction(),Gt=vt(je.concat(Je)),on=[],dt=0,Mn=Gt,Hn.label=2;case 2:return dt<Mn.length?[4,Mn[dt].data()]:[3,5];case 3:zn=Hn.sent(),on.push(zn[0]),Hn.label=4;case 4:return dt++,[3,2];case 5:return Object(l.dispose)(Gt),[2,ce(on)]}})})},ne.prototype.getNamedWeights=function(D){for(var H=[],ue=D!=null&&D.trainableOnly,je=ue?this.trainableWeights:this.weights,Je=this.getWeights(ue),vt=0;vt<je.length;++vt)ue&&!je[vt].trainable||H.push({name:je[vt].originalName,tensor:Je[vt]});return H},Object.defineProperty(ne.prototype,"stopTraining",{get:function(){return this.stopTraining_},set:function(D){this.stopTraining_=D},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"optimizer",{get:function(){return this.optimizer_},set:function(D){this.optimizer_!==D&&(this.optimizer_=D,this.isOptimizerOwned=!1)},enumerable:!0,configurable:!0}),ne.prototype.dispose=function(){var D=ae.prototype.dispose.call(this);if(D.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){var H=Object(l.memory)().numTensors;this.optimizer_.dispose(),D.numDisposedVariables+=H-Object(l.memory)().numTensors}return D},ne.prototype.getLossIdentifiers=function(){var D;if(typeof this.loss=="string")D=Ee(this.loss);else if(Array.isArray(this.loss)){for(var H=0,ue=this.loss;H<ue.length;H++)if(typeof ue[H]!="string")throw new Error("Serialization of non-string loss is not supported.");D=this.loss.map(function(dt){return Ee(dt)})}else{var je=Object.keys(this.loss);D={};for(var Je=this.loss,vt=0,Gt=je;vt<Gt.length;vt++){var on=Gt[vt];if(typeof Je[on]!="string")throw new Error("Serialization of non-string loss is not supported.");D[on]=Ee(Je[on])}}return D},ne.prototype.getMetricIdentifiers=function(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Ee(Wu(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(function(ue){return Ee(Wu(ue))});var D={};for(var H in this.metrics)D[H]=Ee(Wu(this.metrics[H]));return D},ne.prototype.getTrainingConfig=function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}},ne.prototype.loadTrainingConfig=function(D){if(D.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(D.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(D.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");var H,ue,je=Ua(Hi(D.optimizer_config));if(typeof D.loss=="string")H=ve(D.loss);else if(Array.isArray(D.loss))H=D.loss.map(function(vt){return ve(vt)});else if(D.loss!=null)for(var Je in H={},D.loss)H[Je]=ve(D.loss[Je]);if(Array.isArray(D.metrics))ue=D.metrics.map(function(vt){return ve(vt)});else if(D.metrics!=null)for(var Je in ue={},D.metrics)ue[Je]=ve(D.metrics[Je]);this.compile({loss:H,metrics:ue,optimizer:je})},ne.prototype.save=function(D,H){return j(this,void 0,void 0,function(){var ue,je,Je,vt,Gt,on,dt,Mn,zn,Hn,nr,Yn,dr,gr;return N(this,function(Ar){switch(Ar.label){case 0:if(typeof D=="string"){if((ue=l.io.getSaveHandlers(D)).length===0)throw new q("Cannot find any save handlers for URL '"+D+"'");if(ue.length>1)throw new q("Found more than one ("+ue.length+") save handlers for URL '"+D+"'");D=ue[0]}if(D.save==null)throw new q("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,l.io.encodeWeights(this.getNamedWeights(H))];case 1:return je=Ar.sent(),Je=!1,vt=null,Gt=this.toJSON(vt,Je),on={modelTopology:Gt,format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v1.7.4",convertedBy:null},H!=null&&H.includeOptimizer&&this.optimizer!=null?(on.trainingConfig=this.getTrainingConfig(),dt="optimizer",Yn=(nr=l.io).encodeWeights,[4,this.optimizer.getWeights()]):[3,4];case 2:return[4,Yn.apply(nr,[Ar.sent(),dt])];case 3:Mn=Ar.sent(),zn=Mn.data,Hn=Mn.specs,(gr=je.specs).push.apply(gr,Hn),je.data=l.io.concatenateArrayBuffers([je.data,zn]),Ar.label=4;case 4:return this.userDefinedMetadata!=null&&(dr=!0,Xm(this.userDefinedMetadata,this.name,dr),on.userDefinedMetadata=this.userDefinedMetadata),on.weightData=je.data,on.weightSpecs=je.specs,[2,D.save(on)]}})})},ne.prototype.setUserDefinedMetadata=function(D){Xm(D,this.name),this.userDefinedMetadata=D},ne.prototype.getUserDefinedMetadata=function(){return this.userDefinedMetadata},ne.className="Model",ne}(function(ae){function ne(D){var H=ae.call(this,{})||this;if(H.containerNodes=new Set,H.name=D.name,H.name==null){var ue=H.getClassName().toLowerCase();H.name=Zi(ue)}if(H.supportsMasking=!1,H.trainable_=!0,Array.isArray(D.inputs)?H.inputs=D.inputs.slice():H.inputs=[D.inputs],Array.isArray(D.outputs)?H.outputs=D.outputs.slice():H.outputs=[D.outputs],St(H.inputs).length!==H.inputs.length)throw new q("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+H.inputs.map(function(go){return go.name}));St(H.outputs).length!==H.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+H.outputs.map(function(go){return go.name})),H.inputLayers=[],H.inputLayersNodeIndices=[],H.inputLayersTensorIndices=[],H.outputLayers=[],H.outputLayersNodeIndices=[],H.outputLayersTensorIndices=[],H.layers=[],H.internalContainerRefs=[];for(var je=0,Je=H.outputs;je<Je.length;je++){var vt=(oi=Je[je]).sourceLayer,Gt=oi.nodeIndex,on=oi.tensorIndex;H.outputLayers.push(vt),H.outputLayersNodeIndices.push(Gt),H.outputLayersTensorIndices.push(on)}for(var dt=0,Mn=H.inputs;dt<Mn.length;dt++)vt=(oi=Mn[dt]).sourceLayer,Gt=oi.nodeIndex,on=oi.tensorIndex,G(Gt===0,"input layer has >1 nodes"),G(on===0,"input layer has >1 tensors"),H.inputLayers.push(vt),H.inputLayersNodeIndices.push(Gt),H.inputLayersTensorIndices.push(on);H.inputNames=[],H.outputNames=[],H.feedInputShapes=[],H.feedInputNames=[],H.feedOutputNames=[];for(var zn=0;zn<H.inputLayers.length;zn++){if(!((vt=H.inputLayers[zn])instanceof Uu))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: "+D.inputs+". Input "+zn+" (0-based) originates from layer type "+vt.getClassName()+".");H.inputNames.push(vt.name),H.feedInputShapes.push(vt.batchInputShape),H.feedInputNames.push(vt.name)}for(var Hn=0,nr=H.outputLayers;Hn<nr.length;Hn++)vt=nr[Hn],H.outputNames.push(vt.name);H.internalInputShapes=H.inputs.map(function(go){return go.shape}),H.internalOutputShapes=H.outputs.map(function(go){return go.shape});for(var Yn={},dr={},gr={},Ar={},Gr={},ii=[],Ir=function(go,js,ns,fu,il,$o){fu!=null&&il!=null&&$o!=null||(fu=go.sourceLayer,il=go.nodeIndex,$o=go.tensorIndex);var fs=fu.inboundNodes[il];if(ns.indexOf(fs)!==-1)throw new z("The tensor "+go.name+' at layer "'+fu.name+'" is part of a cycle.');if(js.indexOf(fs)===-1){H.containerNodes.add(ne.nodeKey(fu,il)),fu.id in Gr||(Gr[fu.id]=Object.keys(Gr).length),ns.indexOf(fs)===-1&&ns.push(fs);for(var Ga=fs.inboundLayers.length,Pc=0;Pc<Ga;Pc++){var Rl=fs.inputTensors[Pc],wi=fs.inboundLayers[Pc],tm=fs.nodeIndices[Pc],Pl=fs.tensorIndices[Pc];Ir(Rl,js,ns,wi,tm,Pl)}for(js.push(fs);ns.indexOf(fs)>=0;)ns.splice(ns.indexOf(fs),1);ii.push(fs)}},ai=[],ni=[],bi=0,_i=H.outputs;bi<_i.length;bi++){var oi=_i[bi];Ir(oi,ai,ni)}for(var pi=0,fo=ii.slice().reverse();pi<fo.length;pi++){dr[(Bo=fo[pi]).id]=Bo,Bo.id in Yn||(Yn[Bo.id]=0);var lo=Yn[Bo.id],qo=gr[Bo.outboundLayer.id]==null?0:gr[Bo.outboundLayer.id];for(lo=Math.max(lo,qo),gr[Bo.outboundLayer.id]=lo,Ar[Bo.outboundLayer.id]=Bo.outboundLayer,Yn[Bo.id]=lo,zn=0;zn<Bo.inboundLayers.length;zn++){var $i=Bo.inboundLayers[zn],ho=(Gt=Bo.nodeIndices[zn],$i.inboundNodes[Gt]),fa=Yn[ho.id]==null?0:Yn[ho.id];Yn[ho.id]=Math.max(lo+1,fa),dr[ho.id]=ho}}var Wo={};for(var ia in Yn)(lo=Yn[ia])in Wo||(Wo[lo]=[]),Wo[lo].push(dr[ia]);var Vi={};for(var Ui in gr)(lo=gr[Ui])in Vi||(Vi[lo]=[]),Vi[lo].push(Ar[Ui]);var So=Object.keys(Vi).map(function(go){return parseInt(go,10)}).sort(It);H.layers=[];for(var ya=0,wa=So;ya<wa.length;ya++){var ha=Vi[lo=wa[ya]];ha.sort(function(go,js){var ns=Gr[go.id],fu=Gr[js.id];return ns<fu?-1:ns>fu?1:0});for(var oa=0,ls=ha;oa<ls.length;oa++)(vt=ls[oa])instanceof ne&&H.internalContainerRefs.push(vt),H.layers.push(vt)}H.layersByDepth=Vi,So=Object.keys(Wo).map(function(go){return parseInt(go,10)}).sort(It);for(var _a=H.inputs.slice(),ko=[],Ma=0,Ku=So;Ma<Ku.length;Ma++)for(var Es=0,Ha=Wo[lo=Ku[Ma]];Es<Ha.length;Es++){var Bo;if((vt=(Bo=Ha[Es]).outboundLayer)!=null){for(var Rc=0,lu=Bo.inputTensors;Rc<lu.length;Rc++)if(oi=lu[Rc],_a.indexOf(oi)===-1)throw new z("Graph disconnected: cannot obtain value for tensor "+oi+' at layer "'+vt.name+'". The following previous layers were accessed without issue: '+ko);for(var $s=0,aa=Bo.outputTensors;$s<aa.length;$s++)oi=aa[$s],_a.push(oi);ko.push(vt.name)}}H.nodesByDepth=Wo;for(var Xs=H.layers.map(function(go){return go.name}),jo=function(go){var js=Xs.filter(function(ns){return ns===go}).length;if(js!==1)throw new z('The name "'+go+'" is used '+js+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(Xs))},Bs=0,Ss=Xs;Bs<Ss.length;Bs++)jo(Ss[Bs]);return H.outboundNodes=[],H.inboundNodes=[],new Ts({outboundLayer:H,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:H.inputs,outputTensors:H.outputs,inputMasks:H.inputs.map(function(go){return null}),outputMasks:H.outputs.map(function(go){return null}),inputShapes:H.inputs.map(function(go){return go.shape}),outputShapes:H.outputs.map(function(go){return go.shape})}),H.built=!0,H._refCount=1,H}return S(ne,ae),ne.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Container '"+this.name+"' is already disposed.")},ne.prototype.dispose=function(){this.assertNotDisposed();var D={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount==0){for(var H=0,ue=this.layers;H<ue.length;H++){var je=ue[H];D.numDisposedVariables+=je.dispose().numDisposedVariables}for(var Je=0,vt=this.internalContainerRefs;Je<vt.length;Je++){var Gt=vt[Je];D.numDisposedVariables+=Gt.dispose().numDisposedVariables}}return D.refCountAfterDispose=this._refCount,D},Object.defineProperty(ne.prototype,"trainable",{get:function(){return this.trainable_},set:function(D){this.layers.forEach(function(H){H._trainableWeights.forEach(function(ue){return ue.trainable=D})}),this.trainable_=D},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"trainableWeights",{get:function(){if(this._trainableWeights.length>0)throw new q("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];for(var D=[],H=0,ue=this.layers;H<ue.length;H++){var je=ue[H];D=D.concat(je.trainableWeights)}return D},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"nonTrainableWeights",{get:function(){for(var D=[],H=0,ue=this.layers;H<ue.length;H++){var je=ue[H];D.push.apply(D,je.nonTrainableWeights)}if(!this.trainable){for(var Je=[],vt=0,Gt=this.layers;vt<Gt.length;vt++)je=Gt[vt],Je.push.apply(Je,je.trainableWeights);return Je.concat(D)}return D},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),ne.prototype.loadWeights=function(D,H){H===void 0&&(H=!0);for(var ue={},je=0,Je=0,vt=this.layers;Je<vt.length;Je++)for(var Gt=0,on=vt[Je].weights;Gt<on.length;Gt++){var dt=on[Gt];if(ue[dt.originalName]!=null)throw new q("Duplicate weight name: "+dt.originalName);ue[dt.originalName]=dt,je++}var Mn=[];for(var zn in D){if(ue[zn]!=null)Mn.push([ue[zn],D[zn]]);else if(H)throw new q("Provided weight data has no target variable: "+zn);delete ue[zn]}if(H){var Hn=[];for(var nr in ue)Hn.push(nr);if(Hn.length>0)throw new q(Hn.length+" of "+je+" weights are not set: "+Hn)}zi(Mn)},ne.prototype.updatedConfig=function(){var D=this.getConfig(),H={};return H.className=this.getClassName(),H.config=D,H.kerasVersion="tfjs-layers 1.7.4",H.backend="TensorFlow.js",H},ne.prototype.toJSON=function(D,H){H===void 0&&(H=!0);var ue=function je(Je,vt){if(Je==null)return null;if(typeof Je=="string")return Ee(Je);if(typeof Je=="number"||typeof Je=="boolean")return Je;if(Je instanceof Array){for(var Gt=[],on=Je.length,dt=0;dt<on;++dt){var Mn=Je[dt];kh(vt,dt,Mn)?Gt.push(Mn):Gt.push(je(Mn,vt))}return Gt}for(var zn={},Hn=0,nr=Object.keys(Je);Hn<nr.length;Hn++){var Yn=nr[Hn],dr=Je[Yn];zn[Ee(Yn)]=Yn!=="name"&&Yn!=="className"||typeof dr!="string"?je(dr,Yn):dr}return zn}(this.updatedConfig());return H?JSON.stringify(ue):ue},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){D=be(D);for(var je=new Lo,Je=0;Je<ue.inputs.length;++Je)je.add(ue.inputs[Je],D[Je]);return md(ue.outputs,je,H)})},ne.prototype.computeMask=function(D,H){var ue=this;return Object(l.tidy)(function(){var je;return D=be(D),je=H==null?Y(null,D.length):be(H),ue.runInternalGraph(D,je)[1]})},ne.prototype.computeOutputShape=function(D){var H=ei(D);if(H.length!==this.inputLayers.length)throw new q("Invalid inputShape argument "+D+": model has "+this.inputLayers.length+" tensor inputs.");for(var ue={},je=0;je<H.length;je++){var Je=this.inputLayers[je],vt=H[je];ue[_i=Je.name+"_0_0"]=vt}var Gt=Object.keys(this.nodesByDepth).map(function(pi){return parseInt(pi,10)}).sort(It);if(Gt.length>1)for(var on=0,dt=Gt;on<dt.length;on++)for(var Mn=dt[on],zn=0,Hn=this.nodesByDepth[Mn];zn<Hn.length;zn++){var nr=Hn[zn];if(Je=nr.outboundLayer,this.inputLayers.map(function(pi){return pi.id}).indexOf(Je.id)===-1){for(var Yn=[],dr=0;dr<nr.inboundLayers.length;dr++){var gr=nr.inboundLayers[dr],Ar=nr.nodeIndices[dr],Gr=nr.tensorIndices[dr],ii=ue[_i=gr.name+"_"+Ar+"_"+Gr];Yn.push(ii)}var Ir=ei(Je.computeOutputShape(ce(Yn))),ai=Je.inboundNodes.indexOf(nr);for(dr=0;dr<Ir.length;dr++)ue[_i=Je.name+"_"+ai+"_"+dr]=Ir[dr]}}var ni=[],bi=[];for(je=0;je<this.outputLayers.length;je++){Je=this.outputLayers[je],ai=this.outputLayersNodeIndices[je],Gr=this.outputLayersTensorIndices[je];var _i=Je.name+"_"+ai+"_"+Gr;bi.push(_i)}for(je=0;je<bi.length;je++){var oi=bi[je];G(oi in ue),ni.push(ue[oi])}return ce(ni)},ne.prototype.runInternalGraph=function(D,H){H==null&&(H=Y(null,D.length));for(var ue={},je=0;je<this.inputs.length;++je){var Je=this.inputs[je],vt=D[je],Gt=H[je];ue[Je.id]=[vt,Gt]}for(var on=0,dt=Object.keys(this.nodesByDepth).map(function(Vi){return parseInt(Vi,10)}).sort(It);on<dt.length;on++)for(var Mn=dt[on],zn=0,Hn=this.nodesByDepth[Mn];zn<Hn.length;zn++){for(var nr=Hn[zn],Yn=nr.outboundLayer,dr=nr.inputTensors,gr=nr.outputTensors,Ar=new Array,Gr=0,ii=dr;Gr<ii.length;Gr++)(Je=ii[Gr]).id in ue&&Ar.push(ue[Je.id]);if(Ar.length===dr.length){var Ir={},ai=void 0,ni=void 0,bi=void 0,_i=void 0;if(nr.callArgs!=null&&(Ir=nr.callArgs),Ar.length===1){var oi=Ar[0],pi=oi[0],fo=oi[1];Ir.mask==null&&(Ir.mask=fo),bi=be(Yn.call(pi,Ir)),_i=be(Yn.computeMask(pi,fo)),ai=[pi],ni=[fo]}else ai=Ar.map(function(Vi){return Vi[0]}),ni=Ar.map(function(Vi){return Vi[1]}),Ir.mask==null&&(Ir.mask=ni),bi=be(Yn.call(ai,Ir)),_i=be(Yn.computeMask(ai,ni));if(Yn.activityRegularizer)throw new I("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(je=0;je<gr.length;++je)Je=gr[je],vt=bi[je],Gt=_i[je],ue[Je.id]=[vt,Gt]}}for(var lo=[],qo=[],$i=[],ho=0,fa=this.outputs;ho<fa.length;ho++){G((Je=fa[ho]).id in ue,"Could not compute output "+Je.name+" : "+Je.id);var Wo=ue[Je.id],ia=Wo[0];Gt=Wo[1],$i.push(ia.shape),lo.push(ia),qo.push(Gt)}return[lo,qo,$i]},ne.prototype.buildNodeConversionMap=function(D){for(var H,ue={},je=0,Je=this.layers;je<Je.length;je++){var vt=Je[je];H=vt instanceof ne?1:0;for(var Gt=0;Gt<vt.inboundNodes.length;Gt++){var on=ne.nodeKey(vt,Gt);this.containerNodes.has(on)&&(ue[on]=H,H+=1)}}return ue},ne.prototype.getLayer=function(D,H){if(H!=null){if(this.layers.length<=H)throw new q("Was asked to retrieve layer at index "+H+", but model only has "+this.layers.length+" layer(s).");return this.layers[H]}if(D==null)throw new q("Provide either a layer name or layer index");for(var ue=0,je=this.layers;ue<je.length;ue++){var Je=je[ue];if(Je.name===D)return Je}throw new q("No such layer: "+D)},ne.prototype.calculateLosses=function(){var D=this;return Object(l.tidy)(function(){for(var H=[],ue=0,je=D.layers;ue<je.length;ue++)for(var Je=je[ue],vt=0;vt<Je.inboundNodes.length;++vt){var Gt=ne.nodeKey(Je,vt);D.containerNodes.has(Gt)&&H.push.apply(H,Je.calculateLosses())}return H})},ne.prototype.getConfig=function(){for(var D={name:this.name},H=this.buildNodeConversionMap(this.layers),ue=[],je=0,Je=this.layers;je<Je.length;je++){for(var vt=(Ir=Je[je]).getClassName(),Gt=Ir.getConfig(),on=[],dt=0;dt<Ir.inboundNodes.length;dt++){var Mn=Ir.inboundNodes[dt],zn=ne.nodeKey(Ir,dt),Hn={};if(this.containerNodes.has(zn)){if(Mn.callArgs)try{JSON.stringify(Mn.callArgs),Hn=Mn.callArgs}catch{console.warn("Layer "+Ir.name+" was passed non-serializable keyword arguments: "+Mn.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),Hn={}}if(Mn.inboundLayers.length>0){for(var nr=[],Yn=0;Yn<Mn.inboundLayers.length;Yn++){var dr=Mn.inboundLayers[Yn],gr=Mn.nodeIndices[Yn],Ar=Mn.tensorIndices[Yn];(ni=H[ne.nodeKey(dr,gr)])==null&&(ni=0),nr.push([dr.name,ni,Ar,Hn])}on.push(nr)}}}var Gr={};Gr.name=Ir.name,Gr.className=vt,Gr.config=Gt,Gr.inboundNodes=on,ue.push(Gr)}D.layers=ue;var ii=[];for(Yn=0;Yn<this.inputLayers.length;Yn++){var Ir=this.inputLayers[Yn];gr=this.inputLayersNodeIndices[Yn],zn=ne.nodeKey(Ir,gr),this.containerNodes.has(zn)&&((ni=H[zn])!==null&&ni!==void 0||(ni=0),Ar=this.inputLayersTensorIndices[Yn],ii.push([Ir.name,ni,Ar]))}D.inputLayers=ii;var ai=[];for(Yn=0;Yn<this.outputLayers.length;Yn++){var ni;Ir=this.outputLayers[Yn],gr=this.outputLayersNodeIndices[Yn],zn=ne.nodeKey(Ir,gr),this.containerNodes.has(zn)&&((ni=H[zn])!==null&&ni!==void 0||(ni=0),Ar=this.outputLayersTensorIndices[Yn],ai.push([Ir.name,ni,Ar]))}return D.outputLayers=ai,D},ne.fromConfig=function(D,H,ue,je){je===void 0&&(je=!1);var Je={},vt={};function Gt(ho,fa){ho.name in vt?vt[ho.name].push(fa):vt[ho.name]=[fa]}function on(ho,fa){for(var Wo,ia=[],Vi=0,Ui=fa;Vi<Ui.length;Vi++){var So=Ui[Vi],ya=So[0],wa=So[1],ha=So[2];if(Wo=So[3]==null?{}:So[3],!(ya in Je))return void Gt(ho,fa);var oa=Je[ya];if(oa.inboundNodes.length<=wa)return void Gt(ho,fa);var ls=oa.inboundNodes[wa];ia.push(ls.outputTensors[ha])}ia.length>0&&ho.apply(ce(ia),Wo)}function dt(ho){var fa=ho.name,Wo=Ua(ho,H.customObjects!=null?H.customObjects:{});Wo.setFastWeightInitDuringBuild(je),Je[fa]=Wo,ho.inboundNodes.forEach(function(ia){if(!(ia instanceof Array))throw new q("Corrupted configuration, expected array for nodeData: "+ia);Gt(Wo,ia)})}for(var Mn=H.name,zn=H.layers,Hn=0,nr=zn;Hn<nr.length;Hn++)dt(gr=nr[Hn]);for(;!we(vt);)for(var Yn=0,dr=zn;Yn<dr.length;Yn++){var gr=dr[Yn];if(($i=Je[gr.name]).name in vt){var Ar=vt[$i.name];delete vt[$i.name];for(var Gr=0,ii=Ar;Gr<ii.length;Gr++)on($i,ii[Gr])}}for(var Ir=[],ai=[],ni=0,bi=H.inputLayers;ni<bi.length;ni++){var _i=(gr=bi[ni])[0],oi=gr[1],pi=gr[2];G(_i in Je);var fo=($i=Je[_i]).inboundNodes[oi].outputTensors;Ir.push(fo[pi])}for(var lo=0,qo=H.outputLayers;lo<qo.length;lo++){var $i;_i=(gr=qo[lo])[0],oi=gr[1],pi=gr[2],G(_i in Je),fo=($i=Je[_i]).inboundNodes[oi].outputTensors,ai.push(fo[pi])}return new D({inputs:Ir,outputs:ai,name:Mn})},Object.defineProperty(ne.prototype,"stateful",{get:function(){if(this._stateful)throw new q("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(var D=0,H=this.layers;D<H.length;D++)if(H[D].stateful)return!0;return!1},enumerable:!0,configurable:!0}),ne.prototype.resetStates=function(){var D=this;Object(l.tidy)(function(){D.layers.forEach(function(H){H.stateful&&H.resetStates()})})},ne}(to));function bu(ae,ne){return j(this,void 0,void 0,function(){var D;return N(this,function(H){if(ne==null&&(ne={}),typeof ae=="string"){if((D=l.io.getLoadHandlers(ae,ne.onProgress)).length===0)D.push(l.io.browserHTTPRequest(ae,ne));else if(D.length>1)throw new q("Found more than one ("+D.length+") load handlers for URL '"+ae+"'");ae=D[0]}return[2,function(ue,je,Je){return j(this,void 0,void 0,function(){var vt,Gt,on,dt,Mn,zn,Hn,nr,Yn;return N(this,function(dr){switch(dr.label){case 0:if(Je==null&&(Je={}),ue.load==null)throw new q("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,ue.load()];case 1:if(vt=dr.sent(),(Gt=vt.modelTopology).model_config!=null&&(Gt=Gt.model_config),on=Je.strict==null||Je.strict,dt=vt.weightData!=null&&vt.weightSpecs!=null&&on,Mn=Ua(Hi(Gt),je,dt),(zn=vt.trainingConfig)!=null&&Mn.loadTrainingConfig(zn),vt.userDefinedMetadata!=null&&Mn.setUserDefinedMetadata(vt.userDefinedMetadata),vt.weightData==null)return[3,4];if(vt.weightSpecs==null)throw new q("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");return Hn=function(gr,Ar){var Gr=l.io.decodeWeights(gr,Ar),ii={},Ir=[];return Ar.forEach(function(ai){ai.group==="optimizer"?Ir.push({name:ai.name,tensor:Gr[ai.name]}):ii[ai.name]=Gr[ai.name]}),{modelWeights:ii,optimizerWeights:Ir}}(vt.weightData,vt.weightSpecs),nr=Hn.modelWeights,Yn=Hn.optimizerWeights,Mn.loadWeights(nr,on),Mn.optimizer!=null&&Yn.length>0?[4,Mn.optimizer.setWeights(Yn)]:[3,3];case 2:dr.sent(),dr.label=3;case 3:Object(l.dispose)(nr),Object(l.dispose)(Yn.map(function(gr){return gr.tensor})),dr.label=4;case 4:return[2,Mn]}})})}(ae,void 0,ne)]})})}l.serialization.registerClass(Zc);var Pt=function(ae){function ne(D){var H=ae.call(this,{inputs:[],outputs:[]})||this;if(D=D||{},H.trainable=!0,H.built=!1,H.name=D.name!=null?D.name:Zi("sequential_"),D.layers!=null)for(var ue=0,je=D.layers;ue<je.length;ue++){var Je=je[ue];H.add(Je)}return H}return S(ne,ae),ne.prototype.checkShape=function(D){if(D.inboundNodes[0].outputTensors[0].shape.some(function(H){return H<0}))throw new q("Negative dimension size caused by adding layer "+D.name+" with input shape ["+D.inboundNodes[0].inputTensors[0].shape+"]")},ne.prototype.add=function(D){var H,ue=D instanceof ne||D instanceof Zc;if(ue){if((H=D).outputs.length!==1)throw new q("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(H.inputs.length!==1)throw new q("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(D.inboundNodes.length===0){if(D.batchInputShape==null)throw new q("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var je=Yc({batchShape:D.batchInputShape,dtype:D.dtype,name:D.name+"_input"});D.apply(je)}if(ue)this.outputs=H.outputs,this.inputs=H.inputs;else{if(D.inboundNodes.length!==1)throw new q("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer "+D.name+" which has "+D.inboundNodes.length+" pre-existing inbound connections.");if(D.inboundNodes[0].outputTensors.length!==1)throw new q("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(D),this.outputs=[D.inboundNodes[0].outputTensors[0]],this.inputs=function vt(Gt,on,dt){if((on==null||dt!=null&&dt>0)&&(on=Gt.sourceLayer,dt=Gt.nodeIndex),on.inboundNodes.length===0)return[Gt];var Mn=on.inboundNodes[dt];if(Mn.inboundLayers.length===0)return Mn.inputTensors;for(var zn=[],Hn=0;Hn<Mn.inboundLayers.length;Hn++)for(var nr=0,Yn=vt(Mn.inputTensors[Hn],Mn.inboundLayers[Hn],Mn.nodeIndices[Hn]);nr<Yn.length;nr++){var dr=Yn[nr];zn.indexOf(dr)===-1&&zn.push(dr)}return zn}(this.outputs[0])}this.inboundNodes=[],new Ts({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Y(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(vt){return vt.shape}),outputShapes:this.outputs[0].shape})}else{var Je=D.apply(this.outputs[0]);if(Array.isArray(Je))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(D),this.outputs=[Je],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(D),this.built=!1},ne.prototype.pop=function(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var D=this.layers.length-1;this.layers[D].outboundNodes=[],this.outputs=[this.layers[D].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},ne.prototype.call=function(D,H){return this.model==null&&this.build(),this.model.call(D,H)},ne.prototype.build=function(D){if(Kn(D),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Zc({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},ne.prototype.countParams=function(){return this.built||this.build(),ae.prototype.countParams.call(this)},ne.prototype.summary=function(D,H,ue){ue===void 0&&(ue=console.log),this.built||this.build(),ae.prototype.summary.call(this,D,H,ue)},ne.prototype.setWeights=function(D){this.model==null&&this.build(),this.model.setWeights(D)},ne.prototype.evaluate=function(D,H,ue){if(ue===void 0&&(ue={}),!this.built)throw new z("The model needs to be compiled before being used.");return this.model.evaluate(D,H,ue)},ne.prototype.evaluateDataset=function(D,H){return j(this,void 0,void 0,function(){return N(this,function(ue){if(!this.built)throw new z("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(D,H)]})})},ne.prototype.predict=function(D,H){return H===void 0&&(H={}),this.model==null&&this.build(),this.model.predict(D,H)},ne.prototype.predictOnBatch=function(D){return this.model==null&&this.build(),this.model.predictOnBatch(D)},ne.prototype.compile=function(D){this.build(),this.model.compile(D),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Object.defineProperty(ne.prototype,"optimizer",{get:function(){return this.model==null?void 0:this.model.optimizer},set:function(D){this.model.optimizer=D},enumerable:!0,configurable:!0}),ne.prototype.fit=function(D,H,ue){return ue===void 0&&(ue={}),j(this,void 0,void 0,function(){return N(this,function(je){if(!this.built)throw new z("The model needs to be compiled before being used.");return[2,this.model.fit(D,H,ue)]})})},ne.prototype.fitDataset=function(D,H){return j(this,void 0,void 0,function(){return N(this,function(ue){if(!this.built)throw new z("The model needs to be compiled before being used.");return[2,this.model.fitDataset(D,H)]})})},ne.prototype.trainOnBatch=function(D,H){return j(this,void 0,void 0,function(){return N(this,function(ue){return[2,this.model.trainOnBatch(D,H)]})})},ne.fromConfig=function(D,H,ue,je){var Je;je===void 0&&(je=!1);var vt={};if(H instanceof Array){if(H[0].className==null||H[0].className==="Merge")throw new q("Legacy serialization format not supported yet.");Je=H}else l.util.assert(H.layers!=null,function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."}),Je=H.layers,delete H.layers,vt=H;var Gt=new D(vt);if(!(Gt instanceof ne))throw new I("Sequential.fromConfig called on non-Sequential input: "+Gt);for(var on=0,dt=Je;on<dt.length;on++){var Mn=Ua(dt[on],void 0,je);je&&Mn.setFastWeightInitDuringBuild(!0),Gt.add(Mn)}return Gt},Object.defineProperty(ne.prototype,"stopTraining",{get:function(){if(this.model==null)throw new q("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(D){if(this.model==null)throw new q("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=D},enumerable:!0,configurable:!0}),ne.prototype.getConfig=function(){for(var D=[],H=0,ue=this.layers;H<ue.length;H++){var je=ue[H],Je={};Je.className=je.getClassName(),Je.config=je.getConfig(),D.push(Je)}return{name:this.name,layers:D}},ne.className="Sequential",ne}(Zc);function _o(ae){return new Zc(ae)}function va(ae){return new Pt(ae)}function Ya(ae,ne){return ne==null&&(ne={}),bu(ae,ne)}function To(ae){return Yc(ae)}function Ns(ae,ne){Qc.registerCallbackConstructor(ae,ne)}l.serialization.registerClass(Pt);var kr=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne.prototype.getConfig=function(){return{}},ne}(l.serialization.Serializable),ru=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne.prototype.apply=function(D,H){return H===void 0&&(H=1),function(ue,je){if(je===void 0&&(je=1),je!==1)throw new I("Support for alpha values other than 1 ("+je+") is not implemented yet.");return Object(l.elu)(ue)}(D,H)},ne.className="elu",ne}(kr);l.serialization.registerClass(ru);var xu=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne.prototype.apply=function(D){return Object(l.selu)(D)},ne.className="selu",ne}(kr);l.serialization.registerClass(xu);var Cl=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne.prototype.apply=function(D){return Object(l.relu)(D)},ne.className="relu",ne}(kr);l.serialization.registerClass(Cl);var iu=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne.prototype.apply=function(D){return Object(l.tidy)(function(){return Object(l.minimum)(6,Object(l.relu)(D))})},ne.className="relu6",ne}(kr);l.serialization.registerClass(iu);var Oh=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne.prototype.apply=function(D){return D},ne.className="linear",ne}(kr);l.serialization.registerClass(Oh);var Wp=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne.prototype.apply=function(D){return Object(l.sigmoid)(D)},ne.className="sigmoid",ne}(kr);l.serialization.registerClass(Wp);var Vp=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne.prototype.apply=function(D){return function(H){return Object(l.tidy)(function(){var ue=Object(l.add)(.5,Object(l.mul)(.2,H));return Object(l.clipByValue)(ue,0,1)})}(D)},ne.className="hardSigmoid",ne}(kr);l.serialization.registerClass(Vp);var Du=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne.prototype.apply=function(D){return Object(l.softplus)(D)},ne.className="softplus",ne}(kr);l.serialization.registerClass(Du);var ao=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne.prototype.apply=function(D){return function(H){return Object(l.tidy)(function(){return Object(l.div)(H,Object(l.abs)(H).add(1))})}(D)},ne.className="softsign",ne}(kr);l.serialization.registerClass(ao);var Is=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne.prototype.apply=function(D){return Object(l.tanh)(D)},ne.className="tanh",ne}(kr);l.serialization.registerClass(Is);var Th=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne.prototype.apply=function(D,H){return H===void 0&&(H=-1),Object(l.softmax)(D,H)},ne.className="softmax",ne}(kr);l.serialization.registerClass(Th);var Dc=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne.prototype.apply=function(D,H){return H===void 0&&(H=-1),Object(l.logSoftmax)(D,H)},ne.className="logSoftmax",ne}(kr);function xs(ae){return ae.getClassName()}function mi(ae,ne){return ne===void 0&&(ne={}),ht(ae,l.serialization.SerializationMap.getMap().classNameMap,ne,"activation")}function Ho(ae){var ne;return ae==null?mi(ne={className:"linear",config:{}}):typeof ae=="string"?((ne={}).className=ae,ne.config={},mi(ne)):ae instanceof kr?ae:mi(ae)}function Mh(ae){if(ae!=null&&typeof ae!="object")throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: "+ae)}l.serialization.registerClass(Dc);var Hp=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne}(l.serialization.Serializable),ff=function(ae){function ne(D){var H=ae.call(this)||this;return Mh(D),H.l1=D==null||D.l1==null?.01:D.l1,H.l2=D==null||D.l2==null?.01:D.l2,H.hasL1=H.l1!==0,H.hasL2=H.l2!==0,H}return S(ne,ae),ne.prototype.apply=function(D){var H=this;return Object(l.tidy)(function(){var ue=Object(l.zeros)([1]);return H.hasL1&&(ue=Object(l.add)(ue,Object(l.sum)(Object(l.mul)(H.l1,Object(l.abs)(D))))),H.hasL2&&(ue=Object(l.add)(ue,Object(l.sum)(Object(l.mul)(H.l2,Hr(D))))),ue.asScalar()})},ne.prototype.getConfig=function(){return{l1:this.l1,l2:this.l2}},ne.fromConfig=function(D,H){return new D({l1:H.l1,l2:H.l2})},ne.className="L1L2",ne}(Hp);l.serialization.registerClass(ff);var Dh={l1l2:"L1L2"};function Gi(ae){return Ge(ae)}function Di(ae,ne){return ne===void 0&&(ne={}),ht(ae,l.serialization.SerializationMap.getMap().classNameMap,ne,"regularizer")}function da(ae){return ae==null?null:typeof ae=="string"?Di({className:ae in Dh?Dh[ae]:ae,config:{}}):ae instanceof Hp?ae:Di(ae)}var Gp=function(ae){function ne(D){var H=ae.call(this,D??{})||this;return H.supportsMasking=!0,D!=null&&(H.maxValue=D.maxValue),H}return S(ne,ae),ne.prototype.call=function(D,H){D=Xr(D);var ue=Object(l.relu)(D);return this.maxValue!=null&&(ue=Object(l.clipByValue)(ue,0,this.maxValue)),ue},ne.prototype.computeOutputShape=function(D){return D},ne.prototype.getConfig=function(){var D={maxValue:this.maxValue},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="ReLU",ne}(to);l.serialization.registerClass(Gp);var qp=function(ae){function ne(D){var H=ae.call(this,D??{})||this;return H.DEFAULT_ALPHA=.3,D==null&&(D={}),H.alpha=D.alpha==null?H.DEFAULT_ALPHA:D.alpha,H}return S(ne,ae),ne.prototype.call=function(D,H){var ue=Xr(D);return Object(l.leakyRelu)(ue,this.alpha)},ne.prototype.computeOutputShape=function(D){return D},ne.prototype.getConfig=function(){var D={alpha:this.alpha},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="LeakyReLU",ne}(to);l.serialization.registerClass(qp);var $p=function(ae){function ne(D){var H=ae.call(this,D??{})||this;if(H.DEFAULT_ALPHA_INITIALIZER="zeros",D==null&&(D={}),H.supportsMasking=!0,H.alphaInitializer=Br(D.alphaInitializer||H.DEFAULT_ALPHA_INITIALIZER),H.alphaRegularizer=da(D.alphaRegularizer),H.alphaConstraint=Rn(D.alphaConstraint),D.sharedAxes==null)H.sharedAxes=null;else if(Array.isArray(D.sharedAxes))H.sharedAxes=D.sharedAxes;else{if(typeof D.sharedAxes!="number")throw new q("Expected sharedAxes to be a number or an array of numbers, but got "+D.sharedAxes);H.sharedAxes=[D.sharedAxes]}return H}return S(ne,ae),ne.prototype.build=function(D){var H=(D=Kn(D)).slice(1);if(this.sharedAxes!=null)for(var ue=0,je=this.sharedAxes;ue<je.length;ue++)H[(vt=je[ue])-1]=1;this.alpha=this.addWeight("alpha",H,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var Je={};if(this.sharedAxes!=null)for(var vt=1;vt<D.length;++vt)Je[vt]=D[vt];this.inputSpec=[new eo({ndim:D.length,axes:Je})],this.built=!0},ne.prototype.call=function(D,H){return D=Xr(D),Object(l.prelu)(D,this.alpha.read())},ne.prototype.getConfig=function(){var D={alphaInitializer:cr(this.alphaInitializer),alphaRegularizer:Gi(this.alphaRegularizer),alphaConstraint:Yt(this.alphaConstraint),sharedAxes:this.sharedAxes},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="PReLU",ne}(to);l.serialization.registerClass($p);var Jm=function(ae){function ne(D){var H=ae.call(this,D??{})||this;if(H.DEFAULT_ALPHA=1,D==null&&(D={}),D.alpha!=null&&D.alpha!==H.DEFAULT_ALPHA)throw new I("Non-default alpha value ("+D.alpha+") is not supported by the ELU layer yet.");return H.alpha=D.alpha==null?H.DEFAULT_ALPHA:D.alpha,H}return S(ne,ae),ne.prototype.call=function(D,H){var ue=Xr(D);return Object(l.elu)(ue)},ne.prototype.computeOutputShape=function(D){return D},ne.prototype.getConfig=function(){var D={alpha:this.alpha},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="ELU",ne}(to);l.serialization.registerClass(Jm);var lc=function(ae){function ne(D){var H=ae.call(this,D??{})||this;return H.DEFAULT_THETA=1,D==null&&(D={}),H.theta=D.theta==null?H.DEFAULT_THETA:D.theta,H}return S(ne,ae),ne.prototype.call=function(D,H){var ue=Xr(D);return ue.mul(ur(ue.greater(this.theta),"float32"))},ne.prototype.computeOutputShape=function(D){return D},ne.prototype.getConfig=function(){var D={theta:this.theta},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="ThresholdedReLU",ne}(to);l.serialization.registerClass(lc);var Fs=function(ae){function ne(D){var H=ae.call(this,D??{})||this;return H.DEFAULT_AXIS=1,D==null&&(D={}),H.softmax=new Th().apply,H.axis=D.axis==null?H.DEFAULT_AXIS:D.axis,H}return S(ne,ae),ne.prototype.call=function(D,H){var ue=Xr(D);return this.softmax(ue,this.axis)},ne.prototype.computeOutputShape=function(D){return D},ne.prototype.getConfig=function(){var D={axis:this.axis},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="Softmax",ne}(to);function Al(ae,ne,D){if(typeof ae=="number")return Y(ae,ne);if(ae.length!==ne)throw new q("The "+D+" argument must be an integer or tuple of "+ne+" integers. Received: "+ae.length+" elements.");for(var H=0;H<ne;++H){var ue=ae[H];if(!Xt(ue))throw new q("The "+D+" argument must be an integer or tuple of "+ne+" integers. Received: "+JSON.stringify(ae)+" including a non-integer number "+ue)}return ae}function qs(ae,ne,D,H,ue){return ue===void 0&&(ue=1),ae==null?ae:(je=D==="same"?ae:ae-(ne+(ne-1)*(ue-1))+1,Math.floor((je+H-1)/H));var je}function wu(ae,ne,D,H){if(ae==null)return null;if(H==="valid")ae=ae*ne+xn([D-ne,0]);else{if(H!=="same")throw new q("Unsupport padding mode: "+H+".");ae*=ne}return ae}function Nh(ae,ne){return Object(l.tidy)(function(){return Qt(ne),ne==="channelsFirst"?Object(l.transpose)(ae,[0,2,3,1]):ae})}function Wi(ae,ne){return Object(l.tidy)(function(){return Qt(ne),ne==="channelsFirst"?Object(l.transpose)(ae,[0,2,3,4,1]):ae})}function vd(ae,ne,D,H,ue,je,Je,vt){return H===void 0&&(H=[1,1]),ue===void 0&&(ue="valid"),vt===void 0&&(vt=null),Object(l.tidy)(function(){if(je==null&&(je="channelsLast"),Qt(je),ae.rank!==3&&ae.rank!==4)throw new q("conv2dWithBiasActivation expects input to be of rank 3 or 4, but received "+ae.rank+".");if(ne.rank!==3&&ne.rank!==4)throw new q("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received "+ae.rank+".");var Gt=Nh(ae,je);if(ue==="causal")throw new I("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return Gt=l.fused.conv2d({x:Gt,filter:ne,strides:H,pad:ue==="same"?"same":"valid",dilations:Je,dataFormat:"NHWC",bias:D,activation:vt}),je==="channelsFirst"&&(Gt=Object(l.transpose)(Gt,[0,3,1,2])),Gt})}l.serialization.registerClass(Fs);var Ol=function(ae){function ne(D,H){var ue=ae.call(this,H)||this;if(ue.bias=null,ue.DEFAULT_KERNEL_INITIALIZER="glorotNormal",ue.DEFAULT_BIAS_INITIALIZER="zeros",ne.verifyArgs(H),ue.rank=D,Mt(ue.rank,"rank"),ue.rank!==1&&ue.rank!==2&&ue.rank!==3)throw new I("Convolution layer for rank other than 1, 2, or 3 ("+ue.rank+") is not implemented yet.");if(ue.kernelSize=Al(H.kernelSize,D,"kernelSize"),ue.strides=Al(H.strides==null?1:H.strides,D,"strides"),ue.padding=H.padding==null?"valid":H.padding,Pn(ue.padding),ue.dataFormat=H.dataFormat==null?"channelsLast":H.dataFormat,Qt(ue.dataFormat),ue.activation=Ho(H.activation),ue.useBias=H.useBias==null||H.useBias,ue.biasInitializer=Br(H.biasInitializer||ue.DEFAULT_BIAS_INITIALIZER),ue.biasConstraint=Rn(H.biasConstraint),ue.biasRegularizer=da(H.biasRegularizer),ue.activityRegularizer=da(H.activityRegularizer),ue.dilationRate=Al(H.dilationRate==null?1:H.dilationRate,D,"dilationRate"),ue.rank===1&&Array.isArray(ue.dilationRate)&&ue.dilationRate.length!==1)throw new q("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(ue.dilationRate));if(ue.rank===2){if(typeof ue.dilationRate=="number")ue.dilationRate=[ue.dilationRate,ue.dilationRate];else if(ue.dilationRate.length!==2)throw new q("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(ue.dilationRate))}else if(ue.rank===3){if(typeof ue.dilationRate=="number")ue.dilationRate=[ue.dilationRate,ue.dilationRate,ue.dilationRate];else if(ue.dilationRate.length!==3)throw new q("dilationRate must be a number or array of three numbers for 3D convolution, but received "+JSON.stringify(ue.dilationRate))}return ue}return S(ne,ae),ne.verifyArgs=function(D){if(G("kernelSize"in D,"required key 'kernelSize' not in config"),typeof D.kernelSize!="number"&&!jt(D.kernelSize,"number",1,3))throw new q("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received "+JSON.stringify(D.kernelSize)+".")},ne.prototype.getConfig=function(){var D={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:xs(this.activation),useBias:this.useBias,biasInitializer:cr(this.biasInitializer),biasRegularizer:Gi(this.biasRegularizer),activityRegularizer:Gi(this.activityRegularizer),biasConstraint:Yt(this.biasConstraint)},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne}(to),df=function(ae){function ne(D,H){var ue=ae.call(this,D,H)||this;return ue.kernel=null,ne.verifyArgs(H),ue.filters=H.filters,Mt(ue.filters,"filters"),ue.kernelInitializer=Br(H.kernelInitializer||ue.DEFAULT_KERNEL_INITIALIZER),ue.kernelConstraint=Rn(H.kernelConstraint),ue.kernelRegularizer=da(H.kernelRegularizer),ue}return S(ne,ae),ne.prototype.build=function(D){var H;D=Kn(D);var ue=this.dataFormat==="channelsFirst"?1:D.length-1;if(D[ue]==null)throw new q("The channel dimension of the input should be defined. Found "+D[ue]);var je=D[ue],Je=this.kernelSize.concat([je,this.filters]);this.kernel=this.addWeight("kernel",Je,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(H={},H[ue]=je,H)}],this.built=!0},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){var je;D=Xr(D);var Je=ue.bias==null?null:ue.bias.read(),vt=ze(ue.activation.getClassName());if(vt!=null&&ue.rank===2)je=vd(D,ue.kernel.read(),Je,ue.strides,ue.padding,ue.dataFormat,ue.dilationRate,vt);else{if(ue.rank===1)je=function(Gt,on,dt,Mn,zn,Hn,nr){return Mn===void 0&&(Mn=1),zn===void 0&&(zn="valid"),nr===void 0&&(nr=1),Object(l.tidy)(function(){if(Hn==null&&(Hn="channelsLast"),Qt(Hn),Gt.shape.length!==3)throw new q("The input of a conv1dWithBias operation should be 3, but is "+Gt.shape.length+" instead.");if(on.shape.length!==3)throw new q("The kernel for a conv1dWithBias operation should be 3, but is "+on.shape.length+" instead");if(dt!=null&&dt.shape.length!==1)throw new q("The bias for a conv1dWithBias operation should be 1, but is "+on.shape.length+" instead");if(Hn==="channelsFirst"&&(Gt=Object(l.transpose)(Gt,[0,2,1])),zn==="causal")throw new I("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var Yn=Object(l.conv1d)(Gt,on,Mn,zn==="same"?"same":"valid","NWC",nr);return dt!=null&&(Yn=Ot(Yn,dt)),Yn})}(D,ue.kernel.read(),Je,ue.strides[0],ue.padding,ue.dataFormat,ue.dilationRate[0]);else if(ue.rank===2)je=vd(D,ue.kernel.read(),Je,ue.strides,ue.padding,ue.dataFormat,ue.dilationRate);else{if(ue.rank!==3)throw new I("convolutions greater than 3D are not implemented yet.");je=function(Gt,on,dt,Mn,zn,Hn,nr){return Mn===void 0&&(Mn=[1,1,1]),zn===void 0&&(zn="valid"),Object(l.tidy)(function(){if(Hn==null&&(Hn="channelsLast"),Qt(Hn),Gt.rank!==4&&Gt.rank!==5)throw new q("conv3dWithBias expects input to be of rank 4 or 5, but received "+Gt.rank+".");if(on.rank!==4&&on.rank!==5)throw new q("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+Gt.rank+".");var Yn=Wi(Gt,Hn);if(zn==="causal")throw new I("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return Yn=Object(l.conv3d)(Yn,on,Mn,zn==="same"?"same":"valid","NDHWC",nr),dt!=null&&(Yn=Ot(Yn,dt)),Hn==="channelsFirst"&&(Yn=Object(l.transpose)(Yn,[0,4,1,2,3])),Yn})}(D,ue.kernel.read(),Je,ue.strides,ue.padding,ue.dataFormat,ue.dilationRate)}ue.activation!=null&&(je=ue.activation.apply(je))}return je})},ne.prototype.computeOutputShape=function(D){D=Kn(D);for(var H=[],ue=this.dataFormat==="channelsLast"?D.slice(1,D.length-1):D.slice(2),je=0;je<ue.length;++je){var Je=qs(ue[je],this.kernelSize[je],this.padding,this.strides[je],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[je]);H.push(Je)}var vt=[D[0]];return this.dataFormat==="channelsLast"?(vt=vt.concat(H)).push(this.filters):(vt.push(this.filters),vt=vt.concat(H)),vt},ne.prototype.getConfig=function(){var D={filters:this.filters,kernelInitializer:cr(this.kernelInitializer),kernelRegularizer:Gi(this.kernelRegularizer),kernelConstraint:Yt(this.kernelConstraint)},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.verifyArgs=function(D){if(!("filters"in D)||typeof D.filters!="number"||D.filters<1)throw new q("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(D.filters))},ne}(Ol),Xp=function(ae){function ne(D){var H=ae.call(this,2,D)||this;return ne.verifyArgs(D),H}return S(ne,ae),ne.prototype.getConfig=function(){var D=ae.prototype.getConfig.call(this);return delete D.rank,D},ne.verifyArgs=function(D){if(typeof D.kernelSize!="number"&&!jt(D.kernelSize,"number",1,2))throw new q("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(D.kernelSize)+".")},ne.className="Conv2D",ne}(df);l.serialization.registerClass(Xp);var Qm=function(ae){function ne(D){var H=ae.call(this,3,D)||this;return ne.verifyArgs(D),H}return S(ne,ae),ne.prototype.getConfig=function(){var D=ae.prototype.getConfig.call(this);return delete D.rank,D},ne.verifyArgs=function(D){if(typeof D.kernelSize!="number"&&(!Array.isArray(D.kernelSize)||D.kernelSize.length!==1&&D.kernelSize.length!==3))throw new q("Conv3D expects config.kernelSize to be number or [number, number, number], but received "+JSON.stringify(D.kernelSize)+".")},ne.className="Conv3D",ne}(df);l.serialization.registerClass(Qm);var hf=function(ae){function ne(D){var H=ae.call(this,D)||this;if(H.inputSpec=[new eo({ndim:4})],H.padding!=="same"&&H.padding!=="valid")throw new q("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+H.padding);return H}return S(ne,ae),ne.prototype.build=function(D){var H;if((D=Kn(D)).length!==4)throw new q("Input should have rank 4; Received input shape: "+JSON.stringify(D));var ue=this.dataFormat==="channelsFirst"?1:D.length-1;if(D[ue]==null)throw new q("The channel dimension of the inputs should be defined. Found `None`.");var je=D[ue],Je=this.kernelSize.concat([this.filters,je]);this.kernel=this.addWeight("kernel",Je,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new eo({ndim:4,axes:(H={},H[ue]=je,H)})],this.built=!0},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){var je=Xr(D);if(je.shape.length!==4)throw new q("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+je.shape.length);var Je,vt,Gt=je.shape,on=Gt[0];ue.dataFormat==="channelsFirst"?(Je=2,vt=3):(Je=1,vt=2);var dt=Gt[Je],Mn=Gt[vt],zn=ue.kernelSize[0],Hn=ue.kernelSize[1],nr=ue.strides[0],Yn=ue.strides[1],dr=[on,wu(dt,nr,zn,ue.padding),wu(Mn,Yn,Hn,ue.padding),ue.filters];ue.dataFormat!=="channelsLast"&&(je=Object(l.transpose)(je,[0,2,3,1]));var gr=Object(l.conv2dTranspose)(je,ue.kernel.read(),dr,ue.strides,ue.padding);return ue.dataFormat!=="channelsLast"&&(gr=Object(l.transpose)(gr,[0,3,1,2])),ue.bias!=null&&(gr=Ot(gr,ue.bias.read(),ue.dataFormat)),ue.activation!=null&&(gr=ue.activation.apply(gr)),gr})},ne.prototype.computeOutputShape=function(D){var H,ue,je,Je=(D=Kn(D)).slice();this.dataFormat==="channelsFirst"?(H=1,ue=2,je=3):(H=3,ue=1,je=2);var vt=this.kernelSize[0],Gt=this.kernelSize[1],on=this.strides[0],dt=this.strides[1];return Je[H]=this.filters,Je[ue]=wu(Je[ue],on,vt,this.padding),Je[je]=wu(Je[je],dt,Gt,this.padding),Je},ne.prototype.getConfig=function(){var D=ae.prototype.getConfig.call(this);return delete D.dilationRate,D},ne.className="Conv2DTranspose",ne}(Xp);l.serialization.registerClass(hf);var Ih=function(ae){function ne(D){return ae.call(this,2,D)||this}return S(ne,ae),ne.className="SeparableConv2D",ne}(function(ae){function ne(D,H){var ue=ae.call(this,D,H)||this;if(ue.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",ue.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",ue.depthwiseKernel=null,ue.pointwiseKernel=null,H.filters==null)throw new q("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(H.kernelInitializer!=null||H.kernelRegularizer!=null||H.kernelConstraint!=null)throw new q("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(H.padding!=null&&H.padding!=="same"&&H.padding!=="valid")throw new q("SeparableConv"+ue.rank+"D supports only padding modes: 'same' and 'valid', but received "+JSON.stringify(H.padding));return ue.depthMultiplier=H.depthMultiplier==null?1:H.depthMultiplier,ue.depthwiseInitializer=Br(H.depthwiseInitializer||ue.DEFAULT_DEPTHWISE_INITIALIZER),ue.depthwiseRegularizer=da(H.depthwiseRegularizer),ue.depthwiseConstraint=Rn(H.depthwiseConstraint),ue.pointwiseInitializer=Br(H.depthwiseInitializer||ue.DEFAULT_POINTWISE_INITIALIZER),ue.pointwiseRegularizer=da(H.pointwiseRegularizer),ue.pointwiseConstraint=Rn(H.pointwiseConstraint),ue}return S(ne,ae),ne.prototype.build=function(D){var H;if((D=Kn(D)).length<this.rank+2)throw new q("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2)+", but received input shape: "+JSON.stringify(D));var ue=this.dataFormat==="channelsFirst"?1:D.length-1;if(D[ue]==null||D[ue]<0)throw new q("The channel dimension of the inputs should be defined, but found "+JSON.stringify(D[ue]));for(var je=D[ue],Je=this.kernelSize.concat([je,this.depthMultiplier]),vt=[],Gt=0;Gt<this.rank;++Gt)vt.push(1);vt.push(je*this.depthMultiplier,this.filters),this.depthwiseKernel=this.addWeight("depthwise_kernel",Je,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",vt,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.inputSpec=[new eo({ndim:this.rank+2,axes:(H={},H[ue]=je,H)})],this.built=!0},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){var je;if(D=Xr(D),ue.rank===1)throw new I("1D separable convolution is not implemented yet.");return ue.rank===2&&(ue.dataFormat==="channelsFirst"&&(D=Object(l.transpose)(D,[0,2,3,1])),je=Object(l.separableConv2d)(D,ue.depthwiseKernel.read(),ue.pointwiseKernel.read(),ue.strides,ue.padding,ue.dilationRate,"NHWC")),ue.useBias&&(je=Ot(je,ue.bias.read(),ue.dataFormat)),ue.activation!=null&&(je=ue.activation.apply(je)),ue.dataFormat==="channelsFirst"&&(je=Object(l.transpose)(je,[0,3,1,2])),je})},ne.prototype.getConfig=function(){var D=ae.prototype.getConfig.call(this);return delete D.rank,delete D.kernelInitializer,delete D.kernelRegularizer,delete D.kernelConstraint,D.depthwiseInitializer=cr(this.depthwiseInitializer),D.pointwiseInitializer=cr(this.pointwiseInitializer),D.depthwiseRegularizer=Gi(this.depthwiseRegularizer),D.pointwiseRegularizer=Gi(this.pointwiseRegularizer),D.depthwiseConstraint=Yt(this.depthwiseConstraint),D.pointwiseConstraint=Yt(this.pointwiseConstraint),D},ne.className="SeparableConv",ne}(df));l.serialization.registerClass(Ih);var Go=function(ae){function ne(D){var H=ae.call(this,1,D)||this;return ne.verifyArgs(D),H.inputSpec=[{ndim:3}],H}return S(ne,ae),ne.prototype.getConfig=function(){var D=ae.prototype.getConfig.call(this);return delete D.rank,delete D.dataFormat,D},ne.verifyArgs=function(D){if(typeof D.kernelSize!="number"&&!jt(D.kernelSize,"number",1,1))throw new q("Conv1D expects config.kernelSize to be number or number[] with length 1, but received "+JSON.stringify(D.kernelSize)+".")},ne.className="Conv1D",ne}(df);l.serialization.registerClass(Go);var Fh=function(ae){function ne(D){var H=ae.call(this,D)||this;return typeof D.cropping=="number"?H.cropping=[[D.cropping,D.cropping],[D.cropping,D.cropping]]:typeof D.cropping[0]=="number"?H.cropping=[[D.cropping[0],D.cropping[0]],[D.cropping[1],D.cropping[1]]]:H.cropping=D.cropping,H.dataFormat=D.dataFormat===void 0?"channelsLast":D.dataFormat,H.inputSpec=[{ndim:4}],H}return S(ne,ae),ne.prototype.computeOutputShape=function(D){return this.dataFormat==="channelsFirst"?[D[0],D[1],D[2]-this.cropping[0][0]-this.cropping[0][1],D[3]-this.cropping[1][0]-this.cropping[1][1]]:[D[0],D[1]-this.cropping[0][0]-this.cropping[0][1],D[2]-this.cropping[1][0]-this.cropping[1][1],D[3]]},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){return D=Xr(D),ue.dataFormat==="channelsLast"?pr(pr(D,ue.cropping[0][0],D.shape[1]-ue.cropping[0][0]-ue.cropping[0][1],2),ue.cropping[1][0],D.shape[2]-ue.cropping[1][1]-ue.cropping[1][0],3):pr(pr(D,ue.cropping[0][0],D.shape[2]-ue.cropping[0][0]-ue.cropping[0][1],3),ue.cropping[1][0],D.shape[3]-ue.cropping[1][1]-ue.cropping[1][0],4)})},ne.prototype.getConfig=function(){var D={cropping:this.cropping,dataFormat:this.dataFormat},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="Cropping2D",ne}(to);l.serialization.registerClass(Fh);var pf=function(ae){function ne(D){var H=ae.call(this,D)||this;return H.DEFAULT_SIZE=[2,2],H.inputSpec=[{ndim:4}],H.size=D.size==null?H.DEFAULT_SIZE:D.size,H.dataFormat=D.dataFormat==null?"channelsLast":D.dataFormat,H}return S(ne,ae),ne.prototype.computeOutputShape=function(D){if(this.dataFormat==="channelsFirst"){var H=D[2]==null?null:this.size[0]*D[2],ue=D[3]==null?null:this.size[1]*D[3];return[D[0],D[1],H,ue]}return H=D[1]==null?null:this.size[0]*D[1],ue=D[2]==null?null:this.size[1]*D[2],[D[0],H,ue,D[3]]},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){var je=Xr(D),Je=je.shape;if(ue.dataFormat==="channelsFirst"){je=Object(l.transpose)(je,[0,2,3,1]);var vt=ue.size[0]*Je[2],Gt=ue.size[1]*Je[3],on=je.resizeNearestNeighbor([vt,Gt]);return Object(l.transpose)(on,[0,3,1,2])}return vt=ue.size[0]*Je[1],Gt=ue.size[1]*Je[2],je.resizeNearestNeighbor([vt,Gt])})},ne.prototype.getConfig=function(){var D={size:this.size,dataFormat:this.dataFormat},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="UpSampling2D",ne}(to);l.serialization.registerClass(pf);var Rh=function(ae){function ne(D){var H=ae.call(this,2,D)||this;return H.depthwiseKernel=null,H.depthMultiplier=D.depthMultiplier==null?1:D.depthMultiplier,H.depthwiseInitializer=Br(D.depthwiseInitializer||H.DEFAULT_KERNEL_INITIALIZER),H.depthwiseConstraint=Rn(D.depthwiseConstraint),H.depthwiseRegularizer=da(D.depthwiseRegularizer),H}return S(ne,ae),ne.prototype.build=function(D){if((D=Kn(D)).length<4)throw new q("Inputs to DepthwiseConv2D should have rank 4. Received input shape: "+JSON.stringify(D)+".");var H=this.dataFormat==="channelsFirst"?1:3;if(D[H]==null||D[H]<0)throw new q("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not ("+D[H]+").");var ue=D[H],je=[this.kernelSize[0],this.kernelSize[1],ue,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",je,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[ue*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){var je=function(Je,vt,Gt,on,dt,Mn){return Gt===void 0&&(Gt=[1,1]),on===void 0&&(on="valid"),Object(l.tidy)(function(){dt==null&&(dt="channelsLast"),Qt(dt);var zn=Nh(Je,dt);if(Je.rank!==4)throw new q("Input for depthwiseConv2d is required to be 4-D, but is instead "+Je.rank+"-D");if(vt.rank!==4)throw new q("depthwiseKernel is required to be 4-D, but is instead "+vt.rank+"-D");return zn=Object(l.depthwiseConv2d)(zn,vt,Gt,on==="same"?"same":"valid","NHWC",Mn),dt==="channelsFirst"&&(zn=Object(l.transpose)(zn,[0,3,1,2])),zn})}(D=Xr(D),ue.depthwiseKernel.read(),ue.strides,ue.padding,ue.dataFormat,null);return ue.useBias&&(je=Ot(je,ue.bias.read(),ue.dataFormat)),ue.activation!=null&&(je=ue.activation.apply(je)),je})},ne.prototype.computeOutputShape=function(D){D=Kn(D);var H=this.dataFormat==="channelsFirst"?D[2]:D[1],ue=this.dataFormat==="channelsFirst"?D[3]:D[2],je=this.dataFormat==="channelsFirst"?D[1]*this.depthMultiplier:D[3]*this.depthMultiplier,Je=qs(H,this.kernelSize[0],this.padding,this.strides[0]),vt=qs(ue,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[D[0],je,Je,vt]:[D[0],Je,vt,je]},ne.prototype.getConfig=function(){var D=ae.prototype.getConfig.call(this);return D.depthMultiplier=this.depthMultiplier,D.depthwiseInitializer=cr(this.depthwiseInitializer),D.depthwiseRegularizer=Gi(this.depthwiseRegularizer),D.depthwiseConstraint=Yt(this.depthwiseRegularizer),D},ne.className="DepthwiseConv2D",ne}(Ol);l.serialization.registerClass(Rh);var mf=function(ae){function ne(D){var H=ae.call(this,D)||this;return H.rate=Math.max(Math.min(D.rate,1),0),H.noiseShape=D.noiseShape,H.seed=D.seed,H.supportsMasking=!0,H}return S(ne,ae),ne.prototype.getNoiseShape=function(D){if(this.noiseShape==null)return this.noiseShape;for(var H=D.shape,ue=[],je=0;je<this.noiseShape.length;++je)ue.push(this.noiseShape[je]==null?H[je]:this.noiseShape[je]);return ue},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){ue.invokeCallHook(D,H);var je=Xr(D);if(0<ue.rate&&ue.rate<1){var Je=H.training!=null&&H.training,vt=ue.getNoiseShape(je);return $t(function(){return Fr(je,ue.rate,vt,ue.seed)},function(){return je},Je)}return D})},ne.prototype.getConfig=function(){var D={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.prototype.dispose=function(){return ae.prototype.dispose.call(this)},ne.className="Dropout",ne}(to);l.serialization.registerClass(mf);var Tl=function(ae){function ne(D){var H=ae.call(this,D)||this;return H.inputSpec=[{ndim:3}],H}return S(ne,ae),ne.prototype.getNoiseShape=function(D){var H=D.shape;return[H[0],1,H[2]]},ne.className="SpatialDropout1D",ne}(mf);l.serialization.registerClass(Tl);var el=function(ae){function ne(D){var H=ae.call(this,D)||this;if(H.activation=null,H.useBias=!0,H.kernel=null,H.bias=null,H.DEFAULT_KERNEL_INITIALIZER="glorotNormal",H.DEFAULT_BIAS_INITIALIZER="zeros",D.batchInputShape==null&&D.inputShape==null&&D.inputDim!=null){var ue=null;D.batchSize!=null&&(ue=D.batchSize),H.batchInputShape=[ue,D.inputDim]}return H.units=D.units,Mt(H.units,"units"),H.activation=Ho(D.activation),D.useBias!=null&&(H.useBias=D.useBias),H.kernelInitializer=Br(D.kernelInitializer||H.DEFAULT_KERNEL_INITIALIZER),H.biasInitializer=Br(D.biasInitializer||H.DEFAULT_BIAS_INITIALIZER),H.kernelConstraint=Rn(D.kernelConstraint),H.biasConstraint=Rn(D.biasConstraint),H.kernelRegularizer=da(D.kernelRegularizer),H.biasRegularizer=da(D.biasRegularizer),H.activityRegularizer=da(D.activityRegularizer),H.supportsMasking=!0,H.inputSpec=[{minNDim:2}],H}return S(ne,ae),ne.prototype.build=function(D){var H,ue=(D=Kn(D))[D.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[ue,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(H={},H[-1]=ue,H)}],this.built=!0},ne.prototype.computeOutputShape=function(D){var H=(D=Kn(D)).slice();return H[H.length-1]=this.units,H},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){ue.invokeCallHook(D,H);var je,Je=Xr(D),vt=ze(ue.activation.getClassName());return vt!=null?je=ir(Je,ue.kernel.read(),vt,ue.bias?ue.bias.read():null):(je=ir(Je,ue.kernel.read()),ue.bias!=null&&(je=Ot(je,ue.bias.read())),ue.activation!=null&&(je=ue.activation.apply(je))),je})},ne.prototype.getConfig=function(){var D={units:this.units,activation:xs(this.activation),useBias:this.useBias,kernelInitializer:cr(this.kernelInitializer),biasInitializer:cr(this.biasInitializer),kernelRegularizer:Gi(this.kernelRegularizer),biasRegularizer:Gi(this.biasRegularizer),activityRegularizer:Gi(this.activityRegularizer),kernelConstraint:Yt(this.kernelConstraint),biasConstraint:Yt(this.biasConstraint)},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="Dense",ne}(to);l.serialization.registerClass(el);var Ph=function(ae){function ne(D){var H=this;return D=D||{},(H=ae.call(this,D)||this).inputSpec=[{minNDim:3}],H.dataFormat=D.dataFormat,H}return S(ne,ae),ne.prototype.computeOutputShape=function(D){for(var H=0,ue=(D=Kn(D)).slice(1);H<ue.length;H++)if(ue[H]==null)throw new q('The shape of the input to "Flatten" is not fully defined (got '+D.slice(1)+'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.');return[D[0],Wt(D,1)]},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){ue.invokeCallHook(D,H);var je=Xr(D);if(ue.dataFormat==="channelsFirst"&&je.rank>1){for(var Je=[0],vt=2;vt<je.rank;++vt)Je.push(vt);Je.push(1),je=je.transpose(Je)}return function(Gt){if(Gt.rank<=1)throw new q("batchFlatten requires a minimum rank of 2. Got rank: "+Gt.rank+".");var on=[Gt.shape[0],Wt(Gt.shape,1)];return Gt.reshape(on)}(je)})},ne.prototype.getConfig=function(){var D={};this.dataFormat!=null&&(D.dataFormat=this.dataFormat);var H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="Flatten",ne}(to);l.serialization.registerClass(Ph);var yd=function(ae){function ne(D){var H=ae.call(this,D)||this;return H.supportsMasking=!0,H.activation=Ho(D.activation),H}return S(ne,ae),ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){ue.invokeCallHook(D,H);var je=Xr(D);return ue.activation.apply(je)})},ne.prototype.getConfig=function(){var D={activation:xs(this.activation)},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="Activation",ne}(to);l.serialization.registerClass(yd);var gf=function(ae){function ne(D){var H=ae.call(this,D)||this;return H.n=D.n,H.inputSpec=[{ndim:2}],H}return S(ne,ae),ne.prototype.computeOutputShape=function(D){return[D[0],this.n,D[1]]},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){return function(je,Je){return Object(l.tidy)(function(){if(je.shape.length!==2)throw new q("repeat() expects a rank-2 tensor, but received a rank-"+je.shape.length+" tensor.");return ti(sr(je,1),[1,Je,1])})}(D=Xr(D),ue.n)})},ne.prototype.getConfig=function(){var D={n:this.n},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="RepeatVector",ne}(to);l.serialization.registerClass(gf);var tl=function(ae){function ne(D){var H=ae.call(this,D)||this;H.targetShape=D.targetShape;for(var ue=0;ue<H.targetShape.length;++ue)H.isUnknown(H.targetShape[ue])&&(H.targetShape[ue]=null);return H}return S(ne,ae),ne.prototype.isUnknown=function(D){return D<0||D==null},ne.prototype.fixUnknownDimension=function(D,H){for(var ue="Total size of new array must be unchanged.",je=H.slice(),Je=1,vt=null,Gt=0;Gt<je.length;++Gt){var on=je[Gt];if(this.isUnknown(on)){if(vt!==null)throw new q("Can only specifiy one unknown dimension.");vt=Gt}else Je*=on}var dt=Wt(D);if(vt!==null){if(Je===0||dt%Je!=0)throw new q(ue);je[vt]=dt/Je}else if(dt!==Je)throw new q(ue);return je},ne.prototype.computeOutputShape=function(D){for(var H=!1,ue=0;ue<D.length;++ue)if(this.isUnknown(D[ue])){H=!0;break}return H?D.slice(0,1).concat(this.targetShape):D.slice(0,1).concat(this.fixUnknownDimension(D.slice(1),this.targetShape))},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){ue.invokeCallHook(D,H);var je=Xr(D),Je=je.shape,vt=Je.slice(0,1).concat(ue.fixUnknownDimension(Je.slice(1),ue.targetShape));return je.reshape(vt)})},ne.prototype.getConfig=function(){var D={targetShape:this.targetShape},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="Reshape",ne}(to);l.serialization.registerClass(tl);var Xg=function(ae){function ne(D){var H=ae.call(this,D)||this;if(D.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(D.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+D.dims+" instead.");var ue=Un(1,D.dims.length+1);if(!l.util.arraysEqual(D.dims.slice().sort(),ue))throw new Error("Invalid permutation `dims`: "+JSON.stringify(D.dims)+" `dims` must contain consecutive integers starting from 1.");return H.dims=D.dims,H.dimsIncludingBatch=[0].concat(H.dims),H.inputSpec=[new eo({ndim:H.dims.length+1})],H}return S(ne,ae),ne.prototype.computeOutputShape=function(D){var H=(D=Kn(D)).slice();return this.dims.forEach(function(ue,je){H[je+1]=D[ue]}),H},ne.prototype.call=function(D,H){return Object(l.transpose)(Xr(D),this.dimsIncludingBatch)},ne.prototype.getConfig=function(){var D={dims:this.dims},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="Permute",ne}(to);l.serialization.registerClass(Xg);var vf=function(ae){function ne(D){var H=ae.call(this,D??{})||this;return H.supportsMasking=!0,H.maskValue=D!=null?D.maskValue==null?0:D.maskValue:0,H}return S(ne,ae),ne.prototype.computeOutputShape=function(D){return D},ne.prototype.getConfig=function(){var D=ae.prototype.getConfig.call(this),H={maskValue:this.maskValue};return Object.assign(H,D),H},ne.prototype.computeMask=function(D,H){var ue=Xr(D);return Object(l.any)(Object(l.notEqual)(ue,this.maskValue),-1)},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){ue.invokeCallHook(D,H);var je=Xr(D),Je=Object(l.any)(Object(l.notEqual)(je,ue.maskValue),-1,!0);return je.mul(Je.asType(je.dtype))})},ne.className="Masking",ne}(to);l.serialization.registerClass(vf);var la=function(ae){function ne(D){var H=ae.call(this,D)||this;if(H.embeddings=null,H.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",D.batchInputShape==null&&D.inputShape==null){var ue=null;D.batchSize!=null&&(ue=D.batchSize),D.inputLength==null?H.batchInputShape=[ue,null]:H.batchInputShape=[ue].concat(be(D.inputLength))}return H.inputDim=D.inputDim,Mt(H.inputDim,"inputDim"),H.outputDim=D.outputDim,Mt(H.outputDim,"outputDim"),H.embeddingsInitializer=Br(D.embeddingsInitializer||H.DEFAULT_EMBEDDINGS_INITIALIZER),H.embeddingsRegularizer=da(D.embeddingsRegularizer),H.activityRegularizer=da(D.activityRegularizer),H.embeddingsConstraint=Rn(D.embeddingsConstraint),H.maskZero=D.maskZero,H.supportsMasking=D.maskZero,H.inputLength=D.inputLength,H}return S(ne,ae),ne.prototype.build=function(D){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},ne.prototype.warnOnIncompatibleInputShape=function(D){},ne.prototype.computeMask=function(D,H){var ue=this;return Object(l.tidy)(function(){return ue.maskZero?(D=Xr(D),Object(l.notEqual)(D,Object(l.zerosLike)(D))):null})},ne.prototype.computeOutputShape=function(D){if(D=Kn(D),this.inputLength==null)return D.concat([this.outputDim]);var H=be(this.inputLength);if(H.length!==D.length-1)throw new q('"inputLength" is '+this.inputLength+", but received input shape has shape "+D);for(var ue=0,je=0;je<H.length;++je){var Je=H[je],vt=D[je+1];if(Je!=null&&vt!=null&&Je!==vt)throw new q('"inputLength" is '+this.inputLength+", but received input shape has shape "+D);Je==null&&(H[ue]=vt),ue++}return[D[0]].concat(H,[this.outputDim])},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){ue.invokeCallHook(D,H);var je=Xr(D);return je.dtype!=="int32"&&(je=ur(je,"int32")),Cr(ue.embeddings.read(),je.as1D()).reshape(Kn(ue.computeOutputShape(je.shape)))})},ne.prototype.getConfig=function(){var D={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:cr(this.embeddingsInitializer),embeddingsRegularizer:Gi(this.embeddingsRegularizer),activityRegularizer:Gi(this.activityRegularizer),embeddingsConstraint:Yt(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="Embedding",ne}(to);l.serialization.registerClass(la);var La=function(ae){function ne(D){var H=ae.call(this,D||{})||this;return H.supportsMasking=!0,H}return S(ne,ae),ne.prototype.mergeFunction=function(D){throw new I},ne.prototype.computeElementwiseOpOutputShape=function(D,H){if(D==null||H==null)return null;if(D.length<H.length)return this.computeElementwiseOpOutputShape(H,D);if(H.length===0)return D;for(var ue=D.slice(0,D.length-H.length),je=0;je<H.length;++je){var Je=D[D.length-H.length+je],vt=H[je];if(Je==null||vt==null||Je<0||vt<0)ue.push(null);else if(Je===1)ue.push(vt);else if(vt===1)ue.push(Je);else{if(Je!==vt)throw new q("Operands could not be broadcast together with shapes "+JSON.stringify(D)+" "+JSON.stringify(H));ue.push(Je)}}return ue},ne.prototype.build=function(D){if(Array.isArray(D)&&!Array.isArray(D[0])&&(D=[Kn(D)]),(D=D).length<2)throw new q("A merge layer should be called on an Array of at least 2 inputs. Got "+D.length+" input(s).");for(var H=[],ue=0,je=D;ue<je.length;ue++)(Gt=je[ue])!=null&&Gt[0]!==null&&H.push(Gt[0]);if((H=St(H)).length>1)throw new q("Can not merge tensors with different batch sizes. Got tensors with shapes: "+JSON.stringify(D)+".");for(var Je=D[0]==null?null:D[0].slice(1),vt=1;vt<D.length;++vt){var Gt=D[vt]==null?null:D[vt].slice(1);Je=this.computeElementwiseOpOutputShape(Je,Gt)}var on=D.map(function(dt){return dt.length});D.indexOf(null)===-1&&St(on).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){if(D=D,ue.reshapeRequired){var je=[],Je=D.map(function(bi){return bi.rank});if(Je.indexOf(null)===-1){for(var vt=xn(Je),Gt=0,on=D;Gt<on.length;Gt++){for(var dt=(Yn=on[Gt]).rank,Mn=0;Mn<vt-dt;++Mn)Yn=sr(Yn,1);je.push(Yn)}return ue.mergeFunction(je)}for(var zn=!1,Hn=0,nr=D;Hn<nr.length;Hn++){var Yn;if((dt=(Yn=nr[Hn]).rank)==null){var dr=Yn.shape,gr=dr[0],Ar=dr.slice(1).concat([gr]),Gr=Yn.reshape([gr].concat(Wt(dr.slice(1))));Gr=(Gr=Object(l.transpose)(Gr,[1,0])).reshape(Ar),je.push(Gr),zn=!0}else if(dt>1){var ii=Un(1,dt).concat([0]);je.push(Object(l.transpose)(Yn,ii)),zn=!0}else je.push(Yn)}var Ir=ue.mergeFunction(je),ai=Ir.rank;if(zn)if(ai==null){var ni=Ir.shape;Ar=[gr=ni[ni.length-1]].concat(ni.slice(0,ni.length-1)),Ir=Object(l.transpose)(Ir.reshape([-1,gr]),[1,0]).reshape(Ar)}else ai>1&&(ii=[ai-1].concat(Un(0,ai-1)),Ir=Object(l.transpose)(Ir,ii));return Ir}return ue.mergeFunction(D)})},ne.prototype.computeOutputShape=function(D){var H;H=(D=D)[0]==null?null:D[0].slice(1);for(var ue=1;ue<D.length;++ue){var je=D[ue]==null?null:D[ue].slice(1);H=this.computeElementwiseOpOutputShape(H,je)}for(var Je=[],vt=0,Gt=D;vt<Gt.length;vt++)(je=Gt[vt])!=null&&je[0]!==null&&Je.push(je[0]);return(Je=St(Je)).length===1?Je.concat(H):[null].concat(H)},ne.prototype.computeMask=function(D,H){return Object(l.tidy)(function(){if(H==null)return null;if(!Array.isArray(H))throw new q("`mask` should be an Array");if(!Array.isArray(D))throw new q("`inputs` should be an Array");if(H.length!==D.length)throw new q("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths ("+D.length+" vs "+H.length+")");if(H.every(function(Je){return Je==null}))return null;for(var ue=(H=H.map(function(Je){return Je==null?Je:Object(l.expandDims)(Je,0)}))[0],je=1;je<H.length-1;++je)ue=Object(l.logicalAnd)(ue,H[je]);return ue})},ne}(to),Wa=function(ae){function ne(D){return ae.call(this,D)||this}return S(ne,ae),ne.prototype.mergeFunction=function(D){return Object(l.tidy)(function(){for(var H=D[0].clone(),ue=1;ue<D.length;++ue)H=Object(l.add)(H,D[ue]);return H})},ne.className="Add",ne}(La);l.serialization.registerClass(Wa);var qi=function(ae){function ne(D){return ae.call(this,D)||this}return S(ne,ae),ne.prototype.mergeFunction=function(D){return Object(l.tidy)(function(){for(var H=D[0].clone(),ue=1;ue<D.length;++ue)H=Object(l.mul)(H,D[ue]);return H})},ne.className="Multiply",ne}(La);l.serialization.registerClass(qi);var Rs=function(ae){function ne(D){return ae.call(this,D)||this}return S(ne,ae),ne.prototype.mergeFunction=function(D){return Object(l.tidy)(function(){for(var H=D[0].clone(),ue=1;ue<D.length;++ue)H=Object(l.add)(H,D[ue]);return Object(l.mul)(1/D.length,H)})},ne.className="Average",ne}(La);l.serialization.registerClass(Rs);var nl=function(ae){function ne(D){return ae.call(this,D)||this}return S(ne,ae),ne.prototype.mergeFunction=function(D){return Object(l.tidy)(function(){for(var H=D[0],ue=1;ue<D.length;++ue)H=Object(l.maximum)(H,D[ue]);return H})},ne.className="Maximum",ne}(La);l.serialization.registerClass(nl);var Va=function(ae){function ne(D){return ae.call(this,D)||this}return S(ne,ae),ne.prototype.mergeFunction=function(D){return Object(l.tidy)(function(){for(var H=D[0],ue=1;ue<D.length;++ue)H=Object(l.minimum)(H,D[ue]);return H})},ne.className="Minimum",ne}(La);l.serialization.registerClass(Va);var rl=function(ae){function ne(D){var H=ae.call(this,D)||this;return H.DEFAULT_AXIS=-1,D==null&&(D={}),H.axis=D.axis==null?H.DEFAULT_AXIS:D.axis,H.supportsMasking=!0,H.reshapeRequired=!1,H}return S(ne,ae),ne.prototype.build=function(D){if(!Array.isArray(D)||!Array.isArray(D[0])||D.length===1)throw new q("A `Concatenate` layer should be called on a list of at least 2 inputs");for(var H=!0,ue=0,je=D=D;ue<je.length;ue++)if((zn=je[ue])!=null){H=!1;break}if(!H){for(var Je=[],vt=0;vt<D.length;++vt){var Gt=D[vt].slice();Gt.splice(this.axis,1);for(var on=!1,dt=0,Mn=Je;dt<Mn.length;dt++){var zn=Mn[dt];if(l.util.arraysEqual(zn,Gt)){on=!0;break}}on||Je.push(Gt)}if(Je.length>1)throw new q("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(D))}},ne.prototype.mergeFunction=function(D){var H=this;return Object(l.tidy)(function(){return ri(D,H.axis)})},ne.prototype.computeOutputShape=function(D){if(!Array.isArray(D)||!Array.isArray(D[0]))throw new q("A `Concatenate` layer should be called on a list of inputs.");for(var H=D,ue=H[0].slice(),je=this.axis<0?ue.length+this.axis:this.axis,Je=0,vt=H.slice(1);Je<vt.length;Je++){var Gt=vt[Je];if(ue[je]==null||Gt[je]==null){ue[je]=null;break}ue[je]+=Gt[je]}return ue},ne.prototype.computeMask=function(D,H){var ue=this;if(H==null)return null;if(!Array.isArray(H))throw new q("`mask` should be an array for Concatenate");if(!Array.isArray(D))throw new q("`inputs` should be an array for Concatenate");if(H.length!==D.length)throw new q("Mismatch in the length of mask ("+H.length+") and the legnth of inputs ("+D.length+")");return Object(l.tidy)(function(){var je=!0;if(H.forEach(function(on){on==null||(je=!1)}),je)return null;for(var Je=[],vt=0;vt<D.length;++vt)H[vt]==null?Je.push(Object(l.onesLike)(D[vt]).asType("bool")):H[vt].rank<D[vt].rank?Je.push(Object(l.expandDims)(H[vt],-1)):Je.push(H[vt]);var Gt=Object(l.concat)(Je,ue.axis);return Object(l.all)(Gt,-1,!1)})},ne.prototype.getConfig=function(){var D={axis:this.axis},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="Concatenate",ne}(La);function fc(ae,ne){for(;ae<0;)ae+=ne;return ae}l.serialization.registerClass(rl);var bd=function(ae){function ne(D){var H=ae.call(this,D)||this;return H.axes=D.axes,H.normalize=D.normalize!=null&&D.normalize,H.supportsMasking=!0,H.reshapeRequired=!1,H}return S(ne,ae),ne.prototype.build=function(D){l.util.assert(Array.isArray(D)&&D.length===2&&Array.isArray(D[0])&&Array.isArray(D[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var H=D[0],ue=D[1];if(H.length>3||ue.length>3)throw new I("Dot layer does not support tensors of 4D or higher rank yet.");var je=this.interpretAxes(H,ue);if(H[je[0]]!==ue[je[1]])throw new q("Dimension incompatibility: "+H[je[0]]+" !== "+ue[je[1]])},ne.prototype.mergeFunction=function(D){if(D.length!==2)throw new q("A `Dot` layer must be called on exactly 2 inputs, but received "+D.length+" input(s).");var H,ue=D[0],je=D[1];return H=Array.isArray(this.axes)?this.axes.map(function(Je,vt){return fc(Je,D[vt].shape.length)}):[fc(this.axes,ue.shape.length),fc(this.axes,je.shape.length)],this.normalize&&(ue=Sl(ue,H[0]),je=Sl(je,H[1])),function(Je,vt,Gt){if(Je.shape.length>3||vt.shape.length>3)throw new I("batchDot is not implemented for tensors of 4D or higher rank yet");if(l.util.assert(Je.shape.length>=2,function(){return"batchDot requires the rank of x to be >= 2, but got "+Je.shape.length}),l.util.assert(Je.shape.length>=2,function(){return"batchDot requires the rank of y to be >= 2, but got "+vt.shape.length}),typeof Gt=="number"&&(Gt=[Gt,Gt]),Je.dtype==="complex64"||vt.dtype==="complex64")throw new I("batchDot is not implemented for complex64-type Tensors yet.");var on=Je.shape.length,dt=vt.shape.length;Gt==null&&(Gt=[on-1,dt-2]);var Mn=Gt;return Object(l.tidy)(function(){var zn,Hn;if(on>dt){zn=on-dt;for(var nr=[],Yn=0;Yn<zn;++Yn)nr.push(1);vt=vt.reshape(vt.shape.concat(nr))}else if(dt>on){for(zn=dt-on,nr=[],Yn=0;Yn<zn;++Yn)nr.push(1);Je=Je.reshape(Je.shape.concat(nr))}else zn=0;if(Je.shape.length===2&&vt.shape.length===2)Hn=Mn[0]===Mn[1]?Je.mulStrict(vt).sum(Mn[0]):Je.transpose([1,0]).mulStrict(vt).sum(Mn[1]);else{var dr=Mn[0]!==Je.shape.length-1,gr=Mn[1]===vt.shape.length-1;Hn=Je.matMul(vt,dr,gr)}if(zn>0){var Ar,Gr=[];for(Yn=Ar=on>dt?on+dt-3:on-1;Yn<Ar+zn;++Yn)Gr.push(Yn);Hn=Hn.squeeze(Gr)}return Hn.shape.length===1&&(Hn=Hn.expandDims(1)),Hn})}(ue,je,H)},ne.prototype.interpretAxes=function(D,H){return Array.isArray(this.axes)?this.axes:[fc(this.axes,D.length),fc(this.axes,H.length)]},ne.prototype.computeOutputShape=function(D){l.util.assert(Array.isArray(D)&&D.length===2&&Array.isArray(D[0])&&Array.isArray(D[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var H=D[0].slice(),ue=D[1].slice();if(H.length>3||ue.length>3)throw new I("Dot layer does not support tensors of 4D or higher rank yet.");var je=this.interpretAxes(H,ue);H.splice(je[0],1),ue.splice(je[1],1),ue.splice(0,1);var Je=H.concat(ue);return Je.length===1&&Je.push(1),Je},ne.prototype.computeMask=function(D,H){return null},ne.prototype.getConfig=function(){var D={axes:this.axes,normalize:this.normalize},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="Dot",ne}(La);l.serialization.registerClass(bd);var xd=function(ae){function ne(D){var H=ae.call(this,D)||this;return H.supportsMasking=!0,H.stddev=D.stddev,H}return S(ne,ae),ne.prototype.computeOutputShape=function(D){return D},ne.prototype.getConfig=function(){var D=ae.prototype.getConfig.call(this),H={stddev:this.stddev};return Object.assign(H,D),H},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){ue.invokeCallHook(D,H);var je=Xr(D);return $t(function(){return jn(je.shape,0,ue.stddev).add(je)},function(){return je},H.training||!1)})},ne.className="GaussianNoise",ne}(to);l.serialization.registerClass(xd);var Ml=function(ae){function ne(D){var H=ae.call(this,D)||this;return H.supportsMasking=!0,H.rate=D.rate,H}return S(ne,ae),ne.prototype.computeOutputShape=function(D){return D},ne.prototype.getConfig=function(){var D=ae.prototype.getConfig.call(this),H={rate:this.rate};return Object.assign(H,D),H},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){ue.invokeCallHook(D,H);var je=Xr(D);return ue.rate>0&&ue.rate<1?$t(function(){var Je=Math.sqrt(ue.rate/(1-ue.rate));return je.mul(jn(je.shape,1,Je))},function(){return je},H.training||!1):je})},ne.className="GaussianDropout",ne}(to);l.serialization.registerClass(Ml);var Kp=function(ae){function ne(D){var H=ae.call(this,D)||this;return H.supportsMasking=!0,H.rate=D.rate,H.noiseShape=D.noiseShape,H}return S(ne,ae),ne.prototype._getNoiseShape=function(D){return this.noiseShape||Xr(D).shape},ne.prototype.computeOutputShape=function(D){return D},ne.prototype.getConfig=function(){var D=ae.prototype.getConfig.call(this),H={rate:this.rate};return Object.assign(H,D),H},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){if(ue.rate<1&&ue.rate>0){var je=ue._getNoiseShape(D);return $t(function(){var Je=Xr(D),vt=-1.7580993408473766,Gt=Object(l.greaterEqual)(Object(l.randomUniform)(je),ue.rate);Gt=ur(Gt,"float32");var on=Math.pow((1-ue.rate)*(1+ue.rate*Math.pow(vt,2)),-.5),dt=-on*vt*ue.rate;return Je.mul(Gt).add(Gt.add(-1).mul(vt)).mul(on).add(dt)},function(){return Xr(D)},H.training||!1)}return D})},ne.className="AlphaDropout",ne}(to);function dc(ae,ne,D,H,ue,je){var Je;if(je===void 0&&(je=.001),ae.rank===2)Je=Object(l.batchNorm2d)(ae,ne,D,H,ue,je);else if(ae.rank===3)Je=Object(l.batchNorm3d)(ae,ne,D,H,ue,je);else{if(ae.rank!==4)throw new I("batchNormalization is not implemented for array of rank "+ae.rank+" yet");Je=Object(l.batchNorm4d)(ae,ne,D,H,ue,je)}return Je}function Kg(ae,ne,D,H,ue){return ue===void 0&&(ue=.001),l.util.arraysEqual(H.slice().sort(),Un(0,ae.rank-1))?function(je,Je,vt,Gt,on){return on===void 0&&(on=.001),Object(l.tidy)(function(){var dt=Object(l.moments)(je,Gt),Mn=dt.mean,zn=dt.variance;return[dc(je,Mn,zn,vt,Je,on),Mn,zn]})}(ae,ne,D,H,ue):function(je,Je,vt,Gt,on){return on===void 0&&(on=.001),Object(l.tidy)(function(){for(var dt=Object(l.moments)(je,Gt),Mn=dt.mean,zn=dt.variance,Hn=[],nr=0,Yn=Un(0,je.rank);nr<Yn.length;nr++){var dr=Yn[nr];Gt.indexOf(dr)!==-1?Hn.push(1):Hn.push(je.shape[dr])}var gr=Mn.reshape(Hn),Ar=zn.reshape(Hn),Gr=Je==null?null:Je.reshape(Hn),ii=vt==null?null:vt.reshape(Hn);return[dc(je,gr,Ar,ii,Gr,on),Mn,zn]})}(ae,ne,D,H,ue)}l.serialization.registerClass(Kp);var Yp=function(ae){function ne(D){var H=this;return D==null&&(D={}),(H=ae.call(this,D)||this).supportsMasking=!0,H.axis=D.axis==null?-1:D.axis,H.momentum=D.momentum==null?.99:D.momentum,H.epsilon=D.epsilon==null?.001:D.epsilon,H.center=D.center==null||D.center,H.scale=D.scale==null||D.scale,H.betaInitializer=Br(D.betaInitializer||"zeros"),H.gammaInitializer=Br(D.gammaInitializer||"ones"),H.movingMeanInitializer=Br(D.movingMeanInitializer||"zeros"),H.movingVarianceInitializer=Br(D.movingVarianceInitializer||"ones"),H.betaConstraint=Rn(D.betaConstraint),H.gammaConstraint=Rn(D.gammaConstraint),H.betaRegularizer=da(D.betaRegularizer),H.gammaRegularizer=da(D.gammaRegularizer),H}return S(ne,ae),ne.prototype.build=function(D){var H;D=Kn(D);var ue=this.axis>=0?this.axis:this.axis+D.length,je=D[ue];if(je==null)throw new q("Axis "+ue+" of input tensor should have a defined dimension but the layer received an input with shape "+JSON.stringify(D)+".");this.inputSpec=[new eo({ndim:D.length,axes:(H={},H[ue]=je,H)})];var Je=[je];this.scale&&(this.gamma=this.addWeight("gamma",Je,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",Je,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",Je,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",Je,null,this.movingVarianceInitializer,null,!1),this.built=!0},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){var je=H.training!=null&&H.training,Je=Xr(D),vt=Je.shape,Gt=vt.length,on=Un(0,Gt),dt=ue.axis>=0?ue.axis:ue.axis+Gt;on.splice(dt,1);var Mn=Y(1,Gt);Mn[dt]=vt[dt];var zn=on.slice();zn.sort();var Hn=!l.util.arraysEqual(zn,Un(0,Gt).slice(0,Gt-1));if(!je)return function(){if(Hn){var Gr=ue.movingMean.read().reshape(Mn),ii=ue.movingVariance.read().reshape(Mn),Ir=ue.center?ue.beta.read().reshape(Mn):null,ai=ue.scale?ue.gamma.read().reshape(Mn):null;return dc(Je,Gr,ii,Ir,ai,ue.epsilon)}return dc(Je,ue.movingMean.read(),ue.movingVariance.read(),ue.beta==null?null:ue.beta.read(),ue.gamma==null?null:ue.gamma.read(),ue.epsilon)}();var nr=Kg(Je,ue.gamma.read(),ue.beta.read(),on,ue.epsilon),Yn=nr[0],dr=nr[1],gr=nr[2],Ar=function(Gr,ii,Ir){Object(l.tidy)(function(){var ai=1-Ir,ni=Gr.read(),bi=ni.sub(ii).mul(ai);Gr.write(ni.sub(bi))})};return Ar(ue.movingMean,dr,ue.momentum),Ar(ue.movingVariance,gr,ue.momentum),Yn})},ne.prototype.getConfig=function(){var D={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:cr(this.betaInitializer),gammaInitializer:cr(this.gammaInitializer),movingMeanInitializer:cr(this.movingMeanInitializer),movingVarianceInitializer:cr(this.movingVarianceInitializer),betaRegularizer:Gi(this.betaRegularizer),gammaRegularizer:Gi(this.gammaRegularizer),betaConstraint:Yt(this.betaConstraint),gammaConstraint:Yt(this.gammaConstraint)},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="BatchNormalization",ne}(to);l.serialization.registerClass(Yp);var yf=function(ae){function ne(D){var H=this;if(D==null&&(D={}),(H=ae.call(this,D)||this).axis=D.axis==null?-1:D.axis,typeof H.axis=="number"){if(!Number.isInteger(H.axis))throw new Error("Expected axis to be an integer, but received "+H.axis)}else{if(!Array.isArray(H.axis))throw new Error("Expected axis to be an integer or an array of integers, but received "+JSON.stringify(H.axis));for(var ue=0,je=H.axis;ue<je.length;ue++){var Je=je[ue];if(!Number.isInteger(Je))throw new Error("Expected axis to be an array of integers, but received "+JSON.stringify(H.axis))}}return H.epsilon=D.epsilon==null?.001:D.epsilon,H.center=D.center==null||D.center,H.scale=D.scale==null||D.scale,H.betaInitializer=Br(D.betaInitializer||"zeros"),H.gammaInitializer=Br(D.gammaInitializer||"ones"),H.betaRegularizer=da(D.betaRegularizer),H.gammaRegularizer=da(D.gammaRegularizer),H.supportsMasking=!0,H}return S(ne,ae),ne.prototype.build=function(D){var H=(D=Kn(D)).length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(var ue=0;ue<this.axis.length;++ue)this.axis[ue]<0&&(this.axis[ue]+=H);for(var je=0,Je=this.axis;je<Je.length;je++){var vt=Je[je];if(vt<0||vt>=H)throw new Error("Invalid axis: "+vt)}if(this.axis.length!==St(this.axis).length)throw new Error("Found duplicate axes in: "+this.axis);var Gt=this.axis.map(function(on){return D[on]});this.scale?this.gamma=this.addWeight("gamma",Gt,"float32",this.gammaInitializer,this.gammaRegularizer,!0):this.gamma=null,this.center?this.beta=this.addWeight("beta",Gt,"float32",this.betaInitializer,this.betaRegularizer,!0):this.beta=null,this.built=!0},ne.prototype.call=function(D,H){var ue=this,je=Xr(D),Je=je.shape,vt=Je.length;return Object(l.tidy)(function(){for(var Gt=Object(l.moments)(je,ue.axis,!0),on=Gt.mean,dt=Gt.variance,Mn=Y(1,vt),zn=0,Hn=ue.axis;zn<Hn.length;zn++){var nr=Hn[zn];Mn[nr]=Je[nr]}for(var Yn=function(Ir){return Ir!=null&&Ir.shape.length!==vt&&ue.axis!==[vt-1]?Ir.reshape(Mn):Ir},dr=Yn(ue.gamma.read()),gr=Yn(ue.beta.read()),Ar=[],Gr=[],ii=0;ii<vt;++ii)ue.axis.indexOf(ii)!==-1?(Ar.push(Je[ii]),Gr.push(1)):(Ar.push(1),Gr.push(Je[ii]));return on=on.tile(Ar),dt=dt.tile(Ar),dr=dr.tile(Gr),gr=gr.tile(Gr),dc(je,on,dt,gr,dr,ue.epsilon)})},ne.prototype.getConfig=function(){var D={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:cr(this.betaInitializer),gammaInitializer:cr(this.gammaInitializer),betaRegularizer:Gi(this.betaRegularizer),gammaRegularizer:Gi(this.gammaRegularizer)},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="LayerNormalization",ne}(to);l.serialization.registerClass(yf);var Zm=function(ae){function ne(D){var H=this;if(D==null&&(D={}),(H=ae.call(this,D)||this).dataFormat=D.dataFormat==null?"channelsLast":D.dataFormat,D.padding==null)H.padding=[[1,1],[1,1]];else if(typeof D.padding=="number")H.padding=[[D.padding,D.padding],[D.padding,D.padding]];else{if(D.padding=D.padding,D.padding.length!==2)throw new q("ZeroPadding2D expects padding to be a length-2 array, but received a length-"+D.padding.length+" array.");var ue=void 0,je=void 0;if(typeof D.padding[0]=="number")ue=[D.padding[0],D.padding[0]],je=[D.padding[1],D.padding[1]];else{if(D.padding=D.padding,D.padding[0].length!==2)throw new q("ZeroPadding2D expects height padding to be a length-2 array, but received a length-"+D.padding[0].length+" array.");if(ue=D.padding[0],D.padding[1].length!==2)throw new q("ZeroPadding2D expects width padding to be a length-2 array, but received a length-"+D.padding[1].length+" array.");je=D.padding[1]}H.padding=[ue,je]}return H.inputSpec=[new eo({ndim:4})],H}return S(ne,ae),ne.prototype.computeOutputShape=function(D){var H,ue;return D=Kn(D),this.dataFormat==="channelsFirst"?(H=D[2]!=null&&D[2]>=0?D[2]+this.padding[0][0]+this.padding[0][1]:null,ue=D[3]!=null&&D[3]>=0?D[3]+this.padding[1][0]+this.padding[1][1]:null,[D[0],D[1],H,ue]):(H=D[1]!=null&&D[1]>=0?D[1]+this.padding[0][0]+this.padding[0][1]:null,ue=D[2]!=null&&D[2]>=0?D[2]+this.padding[1][0]+this.padding[1][1]:null,[D[0],H,ue,D[3]])},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){return function(je,Je,vt){return Object(l.tidy)(function(){if(je.rank!==4)throw new q("temporalPadding expects input tensor to be 4-D, but received a "+je.rank+"-D tensor.");if(Je==null&&(Je=[[1,1],[1,1]]),Je.length!==2||Je[0].length!==2||Je[1].length!==2)throw new q("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(vt==null&&(vt="channelsLast"),vt!=="channelsLast"&&vt!=="channelsFirst")throw new q("Unknown data format: "+vt+". Supported data formats are 'channelsLast' and 'channelsFirst.");var Gt;return Gt=vt==="channelsFirst"?[[0,0],[0,0],Je[0],Je[1]]:[[0,0],Je[0],Je[1],[0,0]],Object(l.pad)(je,Gt)})}(Xr(D),ue.padding,ue.dataFormat)})},ne.prototype.getConfig=function(){var D={padding:this.padding,dataFormat:this.dataFormat},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="ZeroPadding2D",ne}(to);function wd(ae,ne,D,H,ue,je){return Object(l.tidy)(function(){var Je;Qt(ue),kn(je),Pn(H),D==null&&(D=[1,1]),H==null&&(H="valid"),ue==null&&(ue="channelsLast"),je==null&&(je="max"),ae=Nh(ae,ue);var vt=H==="same"?"same":"valid";return Je=je==="max"?Object(l.maxPool)(ae,ne,D,vt):Object(l.avgPool)(ae,ne,D,vt),ue==="channelsFirst"&&(Je=Object(l.transpose)(Je,[0,3,1,2])),Je})}function Dl(ae,ne,D,H,ue,je){return Object(l.tidy)(function(){var Je;Qt(ue),kn(je),Pn(H),D==null&&(D=[1,1,1]),H==null&&(H="valid"),ue==null&&(ue="channelsLast"),je==null&&(je="max"),ae=Wi(ae,ue);var vt=H==="same"?"same":"valid";return Je=je==="max"?Object(l.maxPool3d)(ae,ne,D,vt):Object(l.avgPool3d)(ae,ne,D,vt),ue==="channelsFirst"&&(Je=Object(l.transpose)(Je,[0,4,1,2,3])),Je})}l.serialization.registerClass(Zm);var Jp=function(ae){function ne(D){var H=this;if(D.poolSize==null&&(D.poolSize=2),H=ae.call(this,D)||this,typeof D.poolSize=="number")H.poolSize=[D.poolSize];else{if(!Array.isArray(D.poolSize)||D.poolSize.length!==1||typeof D.poolSize[0]!="number")throw new q("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(D.poolSize));H.poolSize=D.poolSize}if(Mt(H.poolSize,"poolSize"),D.strides==null)H.strides=H.poolSize;else if(typeof D.strides=="number")H.strides=[D.strides];else{if(!Array.isArray(D.strides)||D.strides.length!==1||typeof D.strides[0]!="number")throw new q("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(D.strides));H.strides=D.strides}return Mt(H.strides,"strides"),H.padding=D.padding==null?"valid":D.padding,Pn(H.padding),H.inputSpec=[new eo({ndim:3})],H}return S(ne,ae),ne.prototype.computeOutputShape=function(D){var H=qs((D=Kn(D))[1],this.poolSize[0],this.padding,this.strides[0]);return[D[0],H,D[2]]},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){ue.invokeCallHook(D,H),D=sr(Xr(D),2);var je=ue.poolingFunction(Xr(D),[ue.poolSize[0],1],[ue.strides[0],1],ue.padding,"channelsLast");return Object(l.squeeze)(je,[2])})},ne.prototype.getConfig=function(){var D={poolSize:this.poolSize,padding:this.padding,strides:this.strides},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne}(to),Lh=function(ae){function ne(D){return ae.call(this,D)||this}return S(ne,ae),ne.prototype.poolingFunction=function(D,H,ue,je,Je){return Qt(Je),Pn(je),wd(D,H,ue,je,Je,"max")},ne.className="MaxPooling1D",ne}(Jp);l.serialization.registerClass(Lh);var Oa=function(ae){function ne(D){return ae.call(this,D)||this}return S(ne,ae),ne.prototype.poolingFunction=function(D,H,ue,je,Je){return Qt(Je),Pn(je),wd(D,H,ue,je,Je,"avg")},ne.className="AveragePooling1D",ne}(Jp);l.serialization.registerClass(Oa);var bf=function(ae){function ne(D){var H=this;if(D.poolSize==null&&(D.poolSize=[2,2]),(H=ae.call(this,D)||this).poolSize=Array.isArray(D.poolSize)?D.poolSize:[D.poolSize,D.poolSize],D.strides==null)H.strides=H.poolSize;else if(Array.isArray(D.strides)){if(D.strides.length!==2)throw new q("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+D.strides.length+".");H.strides=D.strides}else H.strides=[D.strides,D.strides];return Mt(H.poolSize,"poolSize"),Mt(H.strides,"strides"),H.padding=D.padding==null?"valid":D.padding,H.dataFormat=D.dataFormat==null?"channelsLast":D.dataFormat,Qt(H.dataFormat),Pn(H.padding),H.inputSpec=[new eo({ndim:4})],H}return S(ne,ae),ne.prototype.computeOutputShape=function(D){D=Kn(D);var H=this.dataFormat==="channelsFirst"?D[2]:D[1],ue=this.dataFormat==="channelsFirst"?D[3]:D[2];return H=qs(H,this.poolSize[0],this.padding,this.strides[0]),ue=qs(ue,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[D[0],D[1],H,ue]:[D[0],H,ue,D[3]]},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){return ue.invokeCallHook(D,H),ue.poolingFunction(Xr(D),ue.poolSize,ue.strides,ue.padding,ue.dataFormat)})},ne.prototype.getConfig=function(){var D={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne}(to),Ps=function(ae){function ne(D){return ae.call(this,D)||this}return S(ne,ae),ne.prototype.poolingFunction=function(D,H,ue,je,Je){return Qt(Je),Pn(je),wd(D,H,ue,je,Je,"max")},ne.className="MaxPooling2D",ne}(bf);l.serialization.registerClass(Ps);var xf=function(ae){function ne(D){return ae.call(this,D)||this}return S(ne,ae),ne.prototype.poolingFunction=function(D,H,ue,je,Je){return Qt(Je),Pn(je),wd(D,H,ue,je,Je,"avg")},ne.className="AveragePooling2D",ne}(bf);l.serialization.registerClass(xf);var _d=function(ae){function ne(D){var H=this;if(D.poolSize==null&&(D.poolSize=[2,2,2]),(H=ae.call(this,D)||this).poolSize=Array.isArray(D.poolSize)?D.poolSize:[D.poolSize,D.poolSize,D.poolSize],D.strides==null)H.strides=H.poolSize;else if(Array.isArray(D.strides)){if(D.strides.length!==3)throw new q("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+D.strides.length+".");H.strides=D.strides}else H.strides=[D.strides,D.strides,D.strides];return Mt(H.poolSize,"poolSize"),Mt(H.strides,"strides"),H.padding=D.padding==null?"valid":D.padding,H.dataFormat=D.dataFormat==null?"channelsLast":D.dataFormat,Qt(H.dataFormat),Pn(H.padding),H.inputSpec=[new eo({ndim:5})],H}return S(ne,ae),ne.prototype.computeOutputShape=function(D){D=Kn(D);var H=this.dataFormat==="channelsFirst"?D[2]:D[1],ue=this.dataFormat==="channelsFirst"?D[3]:D[2],je=this.dataFormat==="channelsFirst"?D[4]:D[3];return H=qs(H,this.poolSize[0],this.padding,this.strides[0]),ue=qs(ue,this.poolSize[1],this.padding,this.strides[1]),je=qs(je,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[D[0],D[1],H,ue,je]:[D[0],H,ue,je,D[4]]},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){return ue.invokeCallHook(D,H),ue.poolingFunction(Xr(D),ue.poolSize,ue.strides,ue.padding,ue.dataFormat)})},ne.prototype.getConfig=function(){var D={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne}(to),Bh=function(ae){function ne(D){return ae.call(this,D)||this}return S(ne,ae),ne.prototype.poolingFunction=function(D,H,ue,je,Je){return Qt(Je),Pn(je),Dl(D,H,ue,je,Je,"max")},ne.className="MaxPooling3D",ne}(_d);l.serialization.registerClass(Bh);var Qp=function(ae){function ne(D){return ae.call(this,D)||this}return S(ne,ae),ne.prototype.poolingFunction=function(D,H,ue,je,Je){return Qt(Je),Pn(je),Dl(D,H,ue,je,Je,"avg")},ne.className="AveragePooling3D",ne}(_d);l.serialization.registerClass(Qp);var Ed=function(ae){function ne(D){var H=ae.call(this,D)||this;return H.inputSpec=[new eo({ndim:3})],H}return S(ne,ae),ne.prototype.computeOutputShape=function(D){return[D[0],D[2]]},ne.prototype.call=function(D,H){throw new I},ne}(to),wf=function(ae){function ne(D){return ae.call(this,D||{})||this}return S(ne,ae),ne.prototype.call=function(D,H){return Object(l.tidy)(function(){var ue=Xr(D);return Object(l.mean)(ue,1)})},ne.className="GlobalAveragePooling1D",ne}(Ed);l.serialization.registerClass(wf);var Zp=function(ae){function ne(D){return ae.call(this,D||{})||this}return S(ne,ae),ne.prototype.call=function(D,H){return Object(l.tidy)(function(){var ue=Xr(D);return Object(l.max)(ue,1)})},ne.className="GlobalMaxPooling1D",ne}(Ed);l.serialization.registerClass(Zp);var em=function(ae){function ne(D){var H=ae.call(this,D)||this;return H.dataFormat=D.dataFormat==null?"channelsLast":D.dataFormat,Qt(H.dataFormat),H.inputSpec=[new eo({ndim:4})],H}return S(ne,ae),ne.prototype.computeOutputShape=function(D){return D=D,this.dataFormat==="channelsLast"?[D[0],D[3]]:[D[0],D[1]]},ne.prototype.call=function(D,H){throw new I},ne.prototype.getConfig=function(){var D={dataFormat:this.dataFormat},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne}(to),vn=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){var je=Xr(D);return ue.dataFormat==="channelsLast"?Object(l.mean)(je,[1,2]):Object(l.mean)(je,[2,3])})},ne.className="GlobalAveragePooling2D",ne}(em);l.serialization.registerClass(vn);var ou=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){var je=Xr(D);return ue.dataFormat==="channelsLast"?Object(l.max)(je,[1,2]):Object(l.max)(je,[2,3])})},ne.className="GlobalMaxPooling2D",ne}(em);function tr(ae,ne,D,H){if(Array.isArray(ae)){if(ne!=null||D!=null)throw new q("When inputs is an array, neither initialState or constants should be provided");H!=null&&(D=ae.slice(ae.length-H,ae.length),ae=ae.slice(0,ae.length-H)),ae.length>1&&(ne=ae.slice(1,ae.length)),ae=ae[0]}function ue(je){return je==null||Array.isArray(je)?je:[je]}return{inputs:ae,initialState:ne=ue(ne),constants:D=ue(D)}}function Ls(ae,ne,D,H,ue,je,Je,vt){return H===void 0&&(H=!1),Je===void 0&&(Je=!1),vt===void 0&&(vt=!1),Object(l.tidy)(function(){var Gt=ne.shape.length;if(Gt<3)throw new q("Input should be at least 3D, but is "+Gt+"D.");var on=[1,0].concat(Un(2,Gt));if(ne=Object(l.transpose)(ne,on),je!=null)throw new I("The rnn() functoin of the deeplearn.js backend does not support constants yet.");Je&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),ue!=null&&((ue=ue.asType("bool").asType("float32")).rank===Gt-1&&(ue=Object(l.expandDims)(ue,-1)),ue=Object(l.transpose)(ue,on)),H&&(ne=Object(l.reverse)(ne,0),ue!=null&&(ue=Object(l.reverse)(ue,0)));var dt,Mn,zn=[],Hn=D,nr=ne.shape[0],Yn=Object(l.unstack)(ne);ue!=null&&(Mn=Object(l.unstack)(ue));for(var dr,gr=function(Gr){var ii=Yn[Gr],Ir=Object(l.tidy)(function(){return ae(ii,Hn)});if(ue==null)dt=Ir[0],Hn=Ir[1];else{var ai=Object(l.tidy)(function(){var ni=Mn[Gr],bi=Object(l.onesLike)(ni).sub(ni);return{output:Ir[0].mul(ni).addStrict(Hn[0].mul(bi)),newStates:Hn.map(function(_i,oi){return Ir[1][oi].mul(ni).addStrict(_i.mul(bi))})}});dt=ai.output,Hn=ai.newStates}vt&&zn.push(dt)},Ar=0;Ar<nr;++Ar)gr(Ar);return vt&&(dr=Object(l.stack)(zn,1)),[dt,dr,Hn]})}l.serialization.registerClass(ou);var mo=function(ae){function ne(D){var H,ue=ae.call(this,D)||this;if(D.cell==null)throw new q("cell property is missing for the constructor of RNN.");if((H=Array.isArray(D.cell)?new Nc({cells:D.cell}):D.cell).stateSize==null)throw new q("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return ue.cell=H,ue.returnSequences=D.returnSequences!=null&&D.returnSequences,ue.returnState=D.returnState!=null&&D.returnState,ue.goBackwards=D.goBackwards!=null&&D.goBackwards,ue._stateful=D.stateful!=null&&D.stateful,ue.unroll=D.unroll!=null&&D.unroll,ue.supportsMasking=!0,ue.inputSpec=[new eo({ndim:3})],ue.stateSpec=null,ue.states_=null,ue.numConstants=null,ue.keptStates=[],ue}return S(ne,ae),ne.prototype.getStates=function(){return this.states_==null?Un(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(function(D){return null}):this.states_},ne.prototype.setStates=function(D){this.states_=D},ne.prototype.computeOutputShape=function(D){gi(D)&&(D=D[0]),D=D;var H=this.cell.stateSize;Array.isArray(H)||(H=[H]);var ue,je=H[0];if(ue=this.returnSequences?[D[0],D[1],je]:[D[0],je],this.returnState){for(var Je=[],vt=0,Gt=H;vt<Gt.length;vt++){var on=Gt[vt];Je.push([D[0],on])}return[ue].concat(Je)}return ue},ne.prototype.computeMask=function(D,H){var ue=this;return Object(l.tidy)(function(){Array.isArray(H)&&(H=H[0]);var je=ue.returnSequences?H:null;if(ue.returnState){var Je=ue.states.map(function(vt){return null});return[je].concat(Je)}return je})},Object.defineProperty(ne.prototype,"states",{get:function(){if(this.states_==null){for(var D=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,H=[],ue=0;ue<D;++ue)H.push(null);return H}return this.states_},set:function(D){this.states_=D},enumerable:!0,configurable:!0}),ne.prototype.build=function(D){if(this.numConstants!=null)throw new I("Constants support is not implemented in RNN yet.");gi(D)&&(D=D[0]),D=D;var H=this.stateful?D[0]:null,ue=D[D.length-1];this.inputSpec[0]=new eo({shape:[H,null,ue]});var je,Je=[D[0]].concat(D.slice(2));if(this.cell.build(Je),je=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],this.stateSpec!=null){if(!l.util.arraysEqual(this.stateSpec.map(function(vt){return vt.shape[vt.shape.length-1]}),je))throw new q("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec="+this.stateSpec+"; However cell.stateSize is "+this.cell.stateSize)}else this.stateSpec=je.map(function(vt){return new eo({shape:[null,vt]})});this.stateful&&this.resetStates()},ne.prototype.resetStates=function(D,H){var ue=this;H===void 0&&(H=!1),Object(l.tidy)(function(){if(!ue.stateful)throw new W("Cannot call resetStates() on an RNN Layer that is not stateful.");var je=ue.inputSpec[0].shape[0];if(je==null)throw new q("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(ue.states_==null)Array.isArray(ue.cell.stateSize)?ue.states_=ue.cell.stateSize.map(function(dt){return Object(l.zeros)([je,dt])}):ue.states_=[Object(l.zeros)([je,ue.cell.stateSize])];else if(D==null)Object(l.dispose)(ue.states_),ue.keptStates!=null&&(Object(l.dispose)(ue.keptStates),ue.keptStates=[]),Array.isArray(ue.cell.stateSize)?ue.states_=ue.cell.stateSize.map(function(dt){return Object(l.zeros)([je,dt])}):ue.states_[0]=Object(l.zeros)([je,ue.cell.stateSize]);else{if(Array.isArray(D)||(D=[D]),D.length!==ue.states_.length)throw new q("Layer "+ue.name+" expects "+ue.states_.length+" state(s), but it received "+D.length+" state value(s). Input received: "+D);H===!0?ue.keptStates.push(ue.states_.slice()):Object(l.dispose)(ue.states_);for(var Je=0;Je<ue.states_.length;++Je){var vt=D[Je],Gt=Array.isArray(ue.cell.stateSize)?ue.cell.stateSize[Je]:ue.cell.stateSize,on=[je,Gt];if(!l.util.arraysEqual(vt.shape,on))throw new q("State "+Je+" is incompatible with layer "+ue.name+": expected shape="+on+", received shape="+vt.shape);ue.states_[Je]=vt}}ue.states_=ue.states_.map(function(dt){return Object(l.keep)(dt.clone())})})},ne.prototype.apply=function(D,H){var ue=H==null?null:H.initialState,je=H==null?null:H.constants;H==null&&(H={});var Je=tr(D,ue,je,this.numConstants);D=Je.inputs,ue=Je.initialState,je=Je.constants;var vt=[],Gt=[];if(ue!=null){H.initialState=ue,vt=vt.concat(ue),this.stateSpec=[];for(var on=0,dt=ue;on<dt.length;on++){var Mn=dt[on];this.stateSpec.push(new eo({shape:Mn.shape}))}Gt=Gt.concat(this.stateSpec)}if(je!=null&&(H.constants=je,vt=vt.concat(je),this.numConstants=je.length),vt[0]instanceof wo){var zn=[D].concat(vt),Hn=this.inputSpec.concat(Gt),nr=this.inputSpec;this.inputSpec=Hn;var Yn=ae.prototype.apply.call(this,zn,H);return this.inputSpec=nr,Yn}return ae.prototype.apply.call(this,D,H)},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){var je=H==null?null:H.mask,Je=H==null?null:H.training,vt=H==null?null:H.initialState;D=Xr(D),vt==null&&(vt=ue.stateful?ue.states_:ue.getInitialState(D));var Gt=Array.isArray(ue.cell.stateSize)?ue.cell.stateSize.length:1;if(vt.length!==Gt)throw new q("RNN Layer has "+Gt+" state(s) but was passed "+vt.length+" initial state(s).");ue.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var on={training:Je},dt=Ls(function(Yn,dr){var gr=ue.cell.call([Yn].concat(dr),on);return[gr[0],gr.slice(1)]},D,vt,ue.goBackwards,je,null,ue.unroll,ue.returnSequences),Mn=dt[0],zn=dt[1],Hn=dt[2];ue.stateful&&ue.resetStates(Hn,Je);var nr=ue.returnSequences?zn:Mn;return ue.returnState?[nr].concat(Hn):nr})},ne.prototype.getInitialState=function(D){var H=this;return Object(l.tidy)(function(){var ue=Object(l.zeros)(D.shape);return ue=sr(ue=Object(l.sum)(ue,[1,2])),Array.isArray(H.cell.stateSize)?H.cell.stateSize.map(function(je){return je>1?ti(ue,[1,je]):ue}):H.cell.stateSize>1?[ti(ue,[1,H.cell.stateSize])]:[ue]})},Object.defineProperty(ne.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),ne.prototype.setFastWeightInitDuringBuild=function(D){ae.prototype.setFastWeightInitDuringBuild.call(this,D),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(D)},ne.prototype.getConfig=function(){var D={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(D.numConstants=this.numConstants);var H=this.cell.getConfig();D.cell={className:this.cell.getClassName(),config:H};var ue=ae.prototype.getConfig.call(this);return Object.assign(D,ue),D},ne.fromConfig=function(D,H,ue){ue===void 0&&(ue={});var je=Ua(H.cell,ue);return new D(Object.assign(H,{cell:je}))},ne.className="RNN",ne}(to);l.serialization.registerClass(mo);var _f=function(ae){function ne(){return ae!==null&&ae.apply(this,arguments)||this}return S(ne,ae),ne}(to),Sd=function(ae){function ne(D){var H=ae.call(this,D)||this;return H.DEFAULT_ACTIVATION="tanh",H.DEFAULT_KERNEL_INITIALIZER="glorotNormal",H.DEFAULT_RECURRENT_INITIALIZER="orthogonal",H.DEFAULT_BIAS_INITIALIZER="zeros",H.units=D.units,Mt(H.units,"units"),H.activation=Ho(D.activation==null?H.DEFAULT_ACTIVATION:D.activation),H.useBias=D.useBias==null||D.useBias,H.kernelInitializer=Br(D.kernelInitializer||H.DEFAULT_KERNEL_INITIALIZER),H.recurrentInitializer=Br(D.recurrentInitializer||H.DEFAULT_RECURRENT_INITIALIZER),H.biasInitializer=Br(D.biasInitializer||H.DEFAULT_BIAS_INITIALIZER),H.kernelRegularizer=da(D.kernelRegularizer),H.recurrentRegularizer=da(D.recurrentRegularizer),H.biasRegularizer=da(D.biasRegularizer),H.kernelConstraint=Rn(D.kernelConstraint),H.recurrentConstraint=Rn(D.recurrentConstraint),H.biasConstraint=Rn(D.biasConstraint),H.dropout=Vn([1,xn([0,D.dropout==null?0:D.dropout])]),H.recurrentDropout=Vn([1,xn([0,D.recurrentDropout==null?0:D.recurrentDropout])]),H.stateSize=H.units,H.dropoutMask=null,H.recurrentDropoutMask=null,H}return S(ne,ae),ne.prototype.build=function(D){D=Kn(D),this.kernel=this.addWeight("kernel",[D[D.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){if((D=D).length!==2)throw new q("SimpleRNNCell expects 2 input Tensors, got "+D.length+".");var je=D[1];D=D[0];var Je,vt=H.training!=null&&H.training;0<ue.dropout&&ue.dropout<1&&ue.dropoutMask==null&&(ue.dropoutMask=au(function(){return Object(l.onesLike)(D)},ue.dropout,vt)),0<ue.recurrentDropout&&ue.recurrentDropout<1&&ue.recurrentDropoutMask==null&&(ue.recurrentDropoutMask=au(function(){return Object(l.onesLike)(je)},ue.recurrentDropout,vt));var Gt=ue.dropoutMask,on=ue.recurrentDropoutMask;Je=ir(Gt!=null?Object(l.mul)(D,Gt):D,ue.kernel.read()),ue.bias!=null&&(Je=Ot(Je,ue.bias.read())),on!=null&&(je=Object(l.mul)(je,on));var dt=Object(l.add)(Je,ir(je,ue.recurrentKernel.read()));return ue.activation!=null&&(dt=ue.activation.apply(dt)),[dt,dt]})},ne.prototype.getConfig=function(){var D={units:this.units,activation:xs(this.activation),useBias:this.useBias,kernelInitializer:cr(this.kernelInitializer),recurrentInitializer:cr(this.recurrentInitializer),biasInitializer:cr(this.biasInitializer),kernelRegularizer:Gi(this.kernelRegularizer),recurrentRegularizer:Gi(this.recurrentRegularizer),biasRegularizer:Gi(this.biasRegularizer),activityRegularizer:Gi(this.activityRegularizer),kernelConstraint:Yt(this.kernelConstraint),recurrentConstraint:Yt(this.recurrentConstraint),biasConstraint:Yt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="SimpleRNNCell",ne}(_f);l.serialization.registerClass(Sd);var mr=function(ae){function ne(D){return D.cell=new Sd(D),ae.call(this,D)||this}return S(ne,ae),ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){ue.cell.dropoutMask!=null&&(Object(l.dispose)(ue.cell.dropoutMask),ue.cell.dropoutMask=null),ue.cell.recurrentDropoutMask!=null&&(Object(l.dispose)(ue.cell.recurrentDropoutMask),ue.cell.recurrentDropoutMask=null);var je=H==null?null:H.mask,Je=H==null?null:H.training,vt=H==null?null:H.initialState;return ae.prototype.call.call(ue,D,{mask:je,training:Je,initialState:vt})})},Object.defineProperty(ne.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),ne.prototype.getConfig=function(){var D={units:this.units,activation:xs(this.activation),useBias:this.useBias,kernelInitializer:cr(this.kernelInitializer),recurrentInitializer:cr(this.recurrentInitializer),biasInitializer:cr(this.biasInitializer),kernelRegularizer:Gi(this.kernelRegularizer),recurrentRegularizer:Gi(this.recurrentRegularizer),biasRegularizer:Gi(this.biasRegularizer),activityRegularizer:Gi(this.activityRegularizer),kernelConstraint:Yt(this.kernelConstraint),recurrentConstraint:Yt(this.recurrentConstraint),biasConstraint:Yt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},H=ae.prototype.getConfig.call(this);return delete H.cell,Object.assign(D,H),D},ne.fromConfig=function(D,H){return new D(H)},ne.className="SimpleRNN",ne}(mo);l.serialization.registerClass(mr);var ts=function(ae){function ne(D){var H=ae.call(this,D)||this;return H.DEFAULT_ACTIVATION="tanh",H.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",H.DEFAULT_KERNEL_INITIALIZER="glorotNormal",H.DEFAULT_RECURRENT_INITIALIZER="orthogonal",H.DEFAULT_BIAS_INITIALIZER="zeros",H.units=D.units,Mt(H.units,"units"),H.activation=Ho(D.activation===void 0?H.DEFAULT_ACTIVATION:D.activation),H.recurrentActivation=Ho(D.recurrentActivation===void 0?H.DEFAULT_RECURRENT_ACTIVATION:D.recurrentActivation),H.useBias=D.useBias==null||D.useBias,H.kernelInitializer=Br(D.kernelInitializer||H.DEFAULT_KERNEL_INITIALIZER),H.recurrentInitializer=Br(D.recurrentInitializer||H.DEFAULT_RECURRENT_INITIALIZER),H.biasInitializer=Br(D.biasInitializer||H.DEFAULT_BIAS_INITIALIZER),H.kernelRegularizer=da(D.kernelRegularizer),H.recurrentRegularizer=da(D.recurrentRegularizer),H.biasRegularizer=da(D.biasRegularizer),H.kernelConstraint=Rn(D.kernelConstraint),H.recurrentConstraint=Rn(D.recurrentConstraint),H.biasConstraint=Rn(D.biasConstraint),H.dropout=Vn([1,xn([0,D.dropout==null?0:D.dropout])]),H.recurrentDropout=Vn([1,xn([0,D.recurrentDropout==null?0:D.recurrentDropout])]),H.implementation=D.implementation,H.stateSize=H.units,H.dropoutMask=null,H.recurrentDropoutMask=null,H}return S(ne,ae),ne.prototype.build=function(D){var H=(D=Kn(D))[D.length-1];this.kernel=this.addWeight("kernel",[H,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){if((D=D).length!==2)throw new q("GRUCell expects 2 input Tensors (inputs, h, c), got "+D.length+".");var je=H.training!=null&&H.training,Je=D[1];D=D[0],0<ue.dropout&&ue.dropout<1&&ue.dropoutMask==null&&(ue.dropoutMask=au(function(){return Object(l.onesLike)(D)},ue.dropout,je,3)),0<ue.recurrentDropout&&ue.recurrentDropout<1&&ue.recurrentDropoutMask==null&&(ue.recurrentDropoutMask=au(function(){return Object(l.onesLike)(Je)},ue.recurrentDropout,je,3));var vt,Gt,on,dt=ue.dropoutMask,Mn=ue.recurrentDropoutMask;0<ue.dropout&&ue.dropout<1&&(D=Object(l.mul)(D,dt[0]));var zn=ir(D,ue.kernel.read());ue.useBias&&(zn=Ot(zn,ue.bias.read())),0<ue.recurrentDropout&&ue.recurrentDropout<1&&(Je=Object(l.mul)(Je,Mn[0]));var Hn=ue.recurrentKernel.read(),nr=Object(l.split)(Hn,[2*ue.units,ue.units],Hn.rank-1),Yn=nr[0],dr=nr[1],gr=ir(Je,Yn),Ar=Object(l.split)(zn,3,zn.rank-1),Gr=Ar[0],ii=Ar[1],Ir=Ar[2],ai=Object(l.split)(gr,2,gr.rank-1),ni=ai[0],bi=ai[1];vt=ue.recurrentActivation.apply(Object(l.add)(Gr,ni)),Gt=ue.recurrentActivation.apply(Object(l.add)(ii,bi));var _i=ir(Object(l.mul)(Gt,Je),dr);on=ue.activation.apply(Object(l.add)(Ir,_i));var oi=Object(l.add)(Object(l.mul)(vt,Je),Object(l.mul)(Object(l.add)(1,Object(l.neg)(vt)),on));return[oi,oi]})},ne.prototype.getConfig=function(){var D={units:this.units,activation:xs(this.activation),recurrentActivation:xs(this.recurrentActivation),useBias:this.useBias,kernelInitializer:cr(this.kernelInitializer),recurrentInitializer:cr(this.recurrentInitializer),biasInitializer:cr(this.biasInitializer),kernelRegularizer:Gi(this.kernelRegularizer),recurrentRegularizer:Gi(this.recurrentRegularizer),biasRegularizer:Gi(this.biasRegularizer),activityRegularizer:Gi(this.activityRegularizer),kernelConstraint:Yt(this.kernelConstraint),recurrentConstraint:Yt(this.recurrentConstraint),biasConstraint:Yt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="GRUCell",ne}(_f);l.serialization.registerClass(ts);var Ta=function(ae){function ne(D){return D.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),D.cell=new ts(D),ae.call(this,D)||this}return S(ne,ae),ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){ue.cell.dropoutMask!=null&&(Object(l.dispose)(ue.cell.dropoutMask),ue.cell.dropoutMask=null),ue.cell.recurrentDropoutMask!=null&&(Object(l.dispose)(ue.cell.recurrentDropoutMask),ue.cell.recurrentDropoutMask=null);var je=H==null?null:H.mask,Je=H==null?null:H.training,vt=H==null?null:H.initialState;return ae.prototype.call.call(ue,D,{mask:je,training:Je,initialState:vt})})},Object.defineProperty(ne.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),ne.prototype.getConfig=function(){var D={units:this.units,activation:xs(this.activation),recurrentActivation:xs(this.recurrentActivation),useBias:this.useBias,kernelInitializer:cr(this.kernelInitializer),recurrentInitializer:cr(this.recurrentInitializer),biasInitializer:cr(this.biasInitializer),kernelRegularizer:Gi(this.kernelRegularizer),recurrentRegularizer:Gi(this.recurrentRegularizer),biasRegularizer:Gi(this.biasRegularizer),activityRegularizer:Gi(this.activityRegularizer),kernelConstraint:Yt(this.kernelConstraint),recurrentConstraint:Yt(this.recurrentConstraint),biasConstraint:Yt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},H=ae.prototype.getConfig.call(this);return delete H.cell,Object.assign(D,H),D},ne.fromConfig=function(D,H){return H.implmentation===0&&(H.implementation=1),new D(H)},ne.className="GRU",ne}(mo);l.serialization.registerClass(Ta);var no=function(ae){function ne(D){var H=ae.call(this,D)||this;return H.DEFAULT_ACTIVATION="tanh",H.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",H.DEFAULT_KERNEL_INITIALIZER="glorotNormal",H.DEFAULT_RECURRENT_INITIALIZER="orthogonal",H.DEFAULT_BIAS_INITIALIZER="zeros",H.units=D.units,Mt(H.units,"units"),H.activation=Ho(D.activation===void 0?H.DEFAULT_ACTIVATION:D.activation),H.recurrentActivation=Ho(D.recurrentActivation===void 0?H.DEFAULT_RECURRENT_ACTIVATION:D.recurrentActivation),H.useBias=D.useBias==null||D.useBias,H.kernelInitializer=Br(D.kernelInitializer||H.DEFAULT_KERNEL_INITIALIZER),H.recurrentInitializer=Br(D.recurrentInitializer||H.DEFAULT_RECURRENT_INITIALIZER),H.biasInitializer=Br(D.biasInitializer||H.DEFAULT_BIAS_INITIALIZER),H.unitForgetBias=D.unitForgetBias,H.kernelRegularizer=da(D.kernelRegularizer),H.recurrentRegularizer=da(D.recurrentRegularizer),H.biasRegularizer=da(D.biasRegularizer),H.kernelConstraint=Rn(D.kernelConstraint),H.recurrentConstraint=Rn(D.recurrentConstraint),H.biasConstraint=Rn(D.biasConstraint),H.dropout=Vn([1,xn([0,D.dropout==null?0:D.dropout])]),H.recurrentDropout=Vn([1,xn([0,D.recurrentDropout==null?0:D.recurrentDropout])]),H.implementation=D.implementation,H.stateSize=[H.units,H.units],H.dropoutMask=null,H.recurrentDropoutMask=null,H}return S(ne,ae),ne.prototype.build=function(D){var H,ue,je=(D=Kn(D))[D.length-1];if(this.kernel=this.addWeight("kernel",[je,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var Je=this.biasInitializer,vt=this.units;ue=new((H=function(Gt){function on(){return Gt!==null&&Gt.apply(this,arguments)||this}return S(on,Gt),on.prototype.apply=function(dt,Mn){var zn=Je.apply([vt]),Hn=new rt().apply([vt]),nr=Je.apply([2*vt]);return Kr(Kr(zn,Hn),nr)},on}(Ce)).className="CustomInit",H)}else ue=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,ue,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){var je=H.training!=null&&H.training;if((D=D).length!==3)throw new q("LSTMCell expects 3 input Tensors (inputs, h, c), got "+D.length+".");var Je=D[1],vt=D[2];D=D[0],0<ue.dropout&&ue.dropout<1&&ue.dropoutMask==null&&(ue.dropoutMask=au(function(){return Object(l.onesLike)(D)},ue.dropout,je,4)),0<ue.recurrentDropout&&ue.recurrentDropout<1&&ue.recurrentDropoutMask==null&&(ue.recurrentDropoutMask=au(function(){return Object(l.onesLike)(Je)},ue.recurrentDropout,je,4));var Gt,on,dt,Mn,zn=ue.dropoutMask,Hn=ue.recurrentDropoutMask;0<ue.dropout&&ue.dropout<1&&(D=Object(l.mul)(D,zn[0]));var nr=ir(D,ue.kernel.read());0<ue.recurrentDropout&&ue.recurrentDropout<1&&(Je=Object(l.mul)(Je,Hn[0])),nr=Object(l.add)(nr,ir(Je,ue.recurrentKernel.read())),ue.useBias&&(nr=Ot(nr,ue.bias.read()));var Yn=Object(l.split)(nr,4,nr.rank-1),dr=Yn[0],gr=Yn[1],Ar=Yn[2],Gr=Yn[3];Gt=ue.recurrentActivation.apply(dr),on=ue.recurrentActivation.apply(gr),dt=Object(l.add)(Object(l.mul)(on,vt),Object(l.mul)(Gt,ue.activation.apply(Ar))),Mn=ue.recurrentActivation.apply(Gr);var ii=Object(l.mul)(Mn,ue.activation.apply(dt));return[ii,ii,dt]})},ne.prototype.getConfig=function(){var D={units:this.units,activation:xs(this.activation),recurrentActivation:xs(this.recurrentActivation),useBias:this.useBias,kernelInitializer:cr(this.kernelInitializer),recurrentInitializer:cr(this.recurrentInitializer),biasInitializer:cr(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Gi(this.kernelRegularizer),recurrentRegularizer:Gi(this.recurrentRegularizer),biasRegularizer:Gi(this.biasRegularizer),activityRegularizer:Gi(this.activityRegularizer),kernelConstraint:Yt(this.kernelConstraint),recurrentConstraint:Yt(this.recurrentConstraint),biasConstraint:Yt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.className="LSTMCell",ne}(_f);l.serialization.registerClass(no);var Hu=function(ae){function ne(D){return D.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),D.cell=new no(D),ae.call(this,D)||this}return S(ne,ae),ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){ue.cell.dropoutMask!=null&&(Object(l.dispose)(ue.cell.dropoutMask),ue.cell.dropoutMask=null),ue.cell.recurrentDropoutMask!=null&&(Object(l.dispose)(ue.cell.recurrentDropoutMask),ue.cell.recurrentDropoutMask=null);var je=H==null?null:H.mask,Je=H==null?null:H.training,vt=H==null?null:H.initialState;return ae.prototype.call.call(ue,D,{mask:je,training:Je,initialState:vt})})},Object.defineProperty(ne.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"unitForgetBias",{get:function(){return this.cell.unitForgetBias},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),ne.prototype.getConfig=function(){var D={units:this.units,activation:xs(this.activation),recurrentActivation:xs(this.recurrentActivation),useBias:this.useBias,kernelInitializer:cr(this.kernelInitializer),recurrentInitializer:cr(this.recurrentInitializer),biasInitializer:cr(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Gi(this.kernelRegularizer),recurrentRegularizer:Gi(this.recurrentRegularizer),biasRegularizer:Gi(this.biasRegularizer),activityRegularizer:Gi(this.activityRegularizer),kernelConstraint:Yt(this.kernelConstraint),recurrentConstraint:Yt(this.recurrentConstraint),biasConstraint:Yt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},H=ae.prototype.getConfig.call(this);return delete H.cell,Object.assign(D,H),D},ne.fromConfig=function(D,H){return H.implmentation===0&&(H.implementation=1),new D(H)},ne.className="LSTM",ne}(mo);l.serialization.registerClass(Hu);var Nc=function(ae){function ne(D){var H=ae.call(this,D)||this;return H.cells=D.cells,H}return S(ne,ae),Object.defineProperty(ne.prototype,"stateSize",{get:function(){for(var D=[],H=0,ue=this.cells.slice().reverse();H<ue.length;H++){var je=ue[H];Array.isArray(je.stateSize)?D.push.apply(D,je.stateSize):D.push(je.stateSize)}return D},enumerable:!0,configurable:!0}),ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){for(var je=(D=D).slice(1),Je=[],vt=0,Gt=ue.cells.slice().reverse();vt<Gt.length;vt++){var on=Gt[vt];Array.isArray(on.stateSize)?Je.push(je.splice(0,on.stateSize.length)):Je.push(je.splice(0,1))}Je.reverse();for(var dt,Mn=[],zn=0;zn<ue.cells.length;++zn)on=ue.cells[zn],je=Je[zn],dt=zn===0?[D[0]].concat(je):[dt[0]].concat(je),dt=on.call(dt,H),Mn.push(dt.slice(1));je=[];for(var Hn=0,nr=Mn.slice().reverse();Hn<nr.length;Hn++){var Yn=nr[Hn];je.push.apply(je,Yn)}return[dt[0]].concat(je)})},ne.prototype.build=function(D){var H;gi(D)&&(D=D[0]),D=D,this.cells.forEach(function(ue,je){ar("RNNCell_"+je,function(){ue.build(D),H=Array.isArray(ue.stateSize)?ue.stateSize[0]:ue.stateSize,D=[D[0],H]})}),this.built=!0},ne.prototype.getConfig=function(){for(var D=[],H=0,ue=this.cells;H<ue.length;H++){var je=ue[H];D.push({className:je.getClassName(),config:je.getConfig()})}var Je={cells:D},vt=ae.prototype.getConfig.call(this);return Object.assign(Je,vt),Je},ne.fromConfig=function(D,H,ue){ue===void 0&&(ue={});for(var je=[],Je=0,vt=H.cells;Je<vt.length;Je++){var Gt=vt[Je];je.push(Ua(Gt,ue))}return new D({cells:je})},Object.defineProperty(ne.prototype,"trainableWeights",{get:function(){if(!this.trainable)return[];for(var D=[],H=0,ue=this.cells;H<ue.length;H++){var je=ue[H];D.push.apply(D,je.trainableWeights)}return D},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"nonTrainableWeights",{get:function(){for(var D=[],H=0,ue=this.cells;H<ue.length;H++){var je=ue[H];D.push.apply(D,je.nonTrainableWeights)}if(!this.trainable){for(var Je=[],vt=0,Gt=this.cells;vt<Gt.length;vt++)je=Gt[vt],Je.push.apply(Je,je.trainableWeights);return Je.concat(D)}return D},enumerable:!0,configurable:!0}),ne.prototype.getWeights=function(){for(var D=[],H=0,ue=this.cells;H<ue.length;H++){var je=ue[H];D.push.apply(D,je.weights)}return oo(D)},ne.prototype.setWeights=function(D){for(var H=[],ue=0,je=this.cells;ue<je.length;ue++)for(var Je=je[ue],vt=Je.weights.length,Gt=D.splice(vt),on=0;on<Je.weights.length;++on)H.push([Je.weights[on],Gt[on]]);zi(H)},ne.className="StackedRNNCells",ne}(_f);function au(ae,ne,D,H){function ue(){return Fr(ae(),ne)}if(D===void 0&&(D=null),H===void 0&&(H=1),H>1){for(var je=[],Je=0;Je<H;Je++)je.push($t(ue,ae,D));return je.map(function(vt){return Object(l.keep)(vt.clone())})}return Object(l.keep)($t(ue,ae,D).clone())}l.serialization.registerClass(Nc);var Ic=function(ae){function ne(D){var H=ae.call(this,D)||this;return H.layer=D.layer,H}return S(ne,ae),ne.prototype.build=function(D){this.built=!0},Object.defineProperty(ne.prototype,"trainable",{get:function(){return this.layer!=null&&this.layer.trainable},set:function(D){this.layer!=null&&(this.layer.trainable=D)},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),ne.prototype.getWeights=function(){return this.layer.getWeights()},ne.prototype.setWeights=function(D){this.layer.setWeights(D)},ne.prototype.getConfig=function(){var D={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.prototype.setFastWeightInitDuringBuild=function(D){ae.prototype.setFastWeightInitDuringBuild.call(this,D),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(D)},ne.fromConfig=function(D,H,ue){ue===void 0&&(ue={});var je=Ua(H.layer,ue);delete H.layer;var Je={layer:je};return Object.assign(Je,H),new D(Je)},ne}(to),na=function(ae){function ne(D){var H=ae.call(this,D)||this;return H.supportsMasking=!0,H}return S(ne,ae),ne.prototype.build=function(D){if((D=Kn(D)).length<3)throw new q("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(D));this.inputSpec=[{shape:D}];var H=[D[0]].concat(D.slice(2));this.layer.built||(this.layer.build(H),this.layer.built=!0),ae.prototype.build.call(this,D)},ne.prototype.computeOutputShape=function(D){var H=[(D=Kn(D))[0]].concat(D.slice(2)),ue=this.layer.computeOutputShape(H),je=D[1];return[ue[0],je].concat(ue.slice(1))},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){return Ls(function(je,Je){return[Xr(ue.layer.call(je,H)),[]]},D=Xr(D),[],!1,null,null,!1,!0)[1]})},ne.className="TimeDistributed",ne}(Ic);l.serialization.registerClass(na);var hc="concat",su=function(ae){function ne(D){var H=ae.call(this,D)||this,ue=D.layer.getConfig(),je={};je.className=D.layer.getClassName(),je.config=ue,H.forwardLayer=Ua(je),ue.goBackwards=ue.goBackwards!==!0;var Je={};if(Je.className=D.layer.getClassName(),Je.config=ue,H.backwardLayer=Ua(Je),H.forwardLayer.name="forward_"+H.forwardLayer.name,H.backwardLayer.name="backward_"+H.backwardLayer.name,H.mergeMode=D.mergeMode===void 0?hc:D.mergeMode,function(vt){bt(ft,"BidirectionalMergeMode",vt)}(H.mergeMode),D.weights)throw new I("weights support is not implemented for Bidirectional layer yet.");return H._stateful=D.layer.stateful,H.returnSequences=D.layer.returnSequences,H.returnState=D.layer.returnState,H.supportsMasking=!0,H._trainable=!0,H.inputSpec=D.layer.inputSpec,H.numConstants=null,H}return S(ne,ae),Object.defineProperty(ne.prototype,"trainable",{get:function(){return this._trainable},set:function(D){this._trainable=D,this.forwardLayer!=null&&(this.forwardLayer.trainable=D),this.backwardLayer!=null&&(this.backwardLayer.trainable=D)},enumerable:!0,configurable:!0}),ne.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},ne.prototype.setWeights=function(D){var H=D.length,ue=Math.floor(H/2);this.forwardLayer.setWeights(D.slice(0,ue)),this.backwardLayer.setWeights(D.slice(ue))},ne.prototype.computeOutputShape=function(D){var H,ue,je,Je=this.forwardLayer.computeOutputShape(D);return Array.isArray(Je)&&Array.isArray(Je[0])||(Je=[Je]),Je=Je,this.returnState&&(je=Je.slice(1)),H=Je[0],H=H,this.mergeMode==="concat"?(H[H.length-1]*=2,ue=[H]):ue=this.mergeMode==null?[H,H.slice()]:[H],this.returnState?this.mergeMode==null?ue.concat(je).concat(je.slice()):[H].concat(je).concat(je.slice()):ce(ue)},ne.prototype.apply=function(D,H){var ue=H==null?null:H.initialState,je=H==null?null:H.constants;H==null&&(H={});var Je=tr(D,ue,je,this.numConstants);if(D=Je.inputs,ue=Je.initialState,je=Je.constants,Array.isArray(D)&&(ue=D.slice(1),D=D[0]),(ue==null||ue.length===0)&&je==null)return ae.prototype.apply.call(this,D,H);var vt=[],Gt=[];if(ue!=null){var on=ue.length;if(on%2>0)throw new q("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");H.initialState=ue,vt.push.apply(vt,ue);var dt=ue.map(function(Ar){return new eo({shape:Ar.shape})});this.forwardLayer.stateSpec=dt.slice(0,on/2),this.backwardLayer.stateSpec=dt.slice(on/2),Gt.push.apply(Gt,dt)}if(je!=null)throw new I("Support for constants in Bidirectional layers is not implemented yet.");for(var Mn=vt[0]instanceof wo,zn=0,Hn=vt;zn<Hn.length;zn++)if(Hn[zn]instanceof wo!==Mn)throw new q("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(Mn){var nr=[D].concat(vt),Yn=this.inputSpec.concat(Gt),dr=this.inputSpec;this.inputSpec=Yn;var gr=ae.prototype.apply.call(this,nr,H);return this.inputSpec=dr,gr}return ae.prototype.apply.call(this,D,H)},ne.prototype.call=function(D,H){var ue=this;return Object(l.tidy)(function(){var je,Je,vt,Gt,on=H.initialState;if(on==null)je=ue.forwardLayer.call(D,H),Je=ue.backwardLayer.call(D,H);else{var dt=on.slice(0,on.length/2),Mn=on.slice(on.length/2);je=ue.forwardLayer.call(D,Object.assign(H,{initialState:dt})),Je=ue.backwardLayer.call(D,Object.assign(H,{initialState:Mn}))}return ue.returnState&&(Array.isArray(je)&&(vt=je.slice(1).concat(Je.slice(1))),je=je[0],Je=Je[0]),ue.returnSequences&&(Je=Object(l.reverse)(Je,1)),ue.mergeMode==="concat"?Gt=ri([je,Je]):ue.mergeMode==="sum"?Gt=Object(l.add)(je,Je):ue.mergeMode==="ave"?Gt=Object(l.mul)(.5,Object(l.add)(je,Je)):ue.mergeMode==="mul"?Gt=Object(l.mul)(je,Je):ue.mergeMode==null&&(Gt=[je,Je]),ue.returnState?ue.mergeMode==null?Gt.concat(vt):[Gt].concat(vt):Gt})},ne.prototype.resetStates=function(D){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},ne.prototype.build=function(D){var H=this;ar(this.forwardLayer.name,function(){H.forwardLayer.build(D)}),ar(this.backwardLayer.name,function(){H.backwardLayer.build(D)}),this.built=!0},ne.prototype.computeMask=function(D,H){var ue;if(Array.isArray(H)&&(H=H[0]),ue=this.returnSequences?this.mergeMode==null?[H,H]:H:this.mergeMode==null?[null,null]:null,this.returnState){var je=this.forwardLayer.states.map(function(Je){return null});return Array.isArray(ue)?ue.concat(je).concat(je):[ue].concat(je).concat(je)}return ue},Object.defineProperty(ne.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),ne.prototype.setFastWeightInitDuringBuild=function(D){ae.prototype.setFastWeightInitDuringBuild.call(this,D),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(D),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(D)},ne.prototype.getConfig=function(){var D={mergeMode:this.mergeMode},H=ae.prototype.getConfig.call(this);return Object.assign(D,H),D},ne.fromConfig=function(D,H){var ue=Ua(H.layer);if(delete H.layer,H.numConstants!=null)throw new I("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var je=H;return je.layer=ue,new D(je)},ne.className="Bidirectional",ne}(Ic);function vo(ae){return new Oa(ae)}function ws(ae){return new xf(ae)}function Ba(ae){return new Qp(ae)}function _s(ae){return new Zp(ae)}function ra(ae){return new ou(ae)}function uu(ae){return new Lh(ae)}function Gu(ae){return new Ps(ae)}l.serialization.registerClass(su);var pc=_s,Fc=ra,qu=uu,Nl=Gu,Il=Object.freeze({inputLayer:function(ae){return new Uu(ae)},elu:function(ae){return new Jm(ae)},reLU:function(ae){return new Gp(ae)},leakyReLU:function(ae){return new qp(ae)},prelu:function(ae){return new $p(ae)},softmax:function(ae){return new Fs(ae)},thresholdedReLU:function(ae){return new lc(ae)},conv1d:function(ae){return new Go(ae)},conv2d:function(ae){return new Xp(ae)},conv2dTranspose:function(ae){return new hf(ae)},conv3d:function(ae){return new Qm(ae)},separableConv2d:function(ae){return new Ih(ae)},cropping2D:function(ae){return new Fh(ae)},upSampling2d:function(ae){return new pf(ae)},depthwiseConv2d:function(ae){return new Rh(ae)},activation:function(ae){return new yd(ae)},dense:function(ae){return new el(ae)},dropout:function(ae){return new mf(ae)},spatialDropout1d:function(ae){return new Tl(ae)},flatten:function(ae){return new Ph(ae)},repeatVector:function(ae){return new gf(ae)},reshape:function(ae){return new tl(ae)},permute:function(ae){return new Xg(ae)},embedding:function(ae){return new la(ae)},add:function(ae){return new Wa(ae)},average:function(ae){return new Rs(ae)},concatenate:function(ae){return new rl(ae)},maximum:function(ae){return new nl(ae)},minimum:function(ae){return new Va(ae)},multiply:function(ae){return new qi(ae)},dot:function(ae){return new bd(ae)},batchNormalization:function(ae){return new Yp(ae)},layerNormalization:function(ae){return new yf(ae)},zeroPadding2d:function(ae){return new Zm(ae)},averagePooling1d:vo,avgPool1d:function(ae){return vo(ae)},avgPooling1d:function(ae){return vo(ae)},averagePooling2d:ws,avgPool2d:function(ae){return ws(ae)},avgPooling2d:function(ae){return ws(ae)},averagePooling3d:Ba,avgPool3d:function(ae){return Ba(ae)},avgPooling3d:function(ae){return Ba(ae)},globalAveragePooling1d:function(ae){return new wf(ae)},globalAveragePooling2d:function(ae){return new vn(ae)},globalMaxPooling1d:_s,globalMaxPooling2d:ra,maxPooling1d:uu,maxPooling2d:Gu,maxPooling3d:function(ae){return new Bh(ae)},gru:function(ae){return new Ta(ae)},gruCell:function(ae){return new ts(ae)},lstm:function(ae){return new Hu(ae)},lstmCell:function(ae){return new no(ae)},simpleRNN:function(ae){return new mr(ae)},simpleRNNCell:function(ae){return new Sd(ae)},rnn:function(ae){return new mo(ae)},stackedRNNCells:function(ae){return new Nc(ae)},bidirectional:function(ae){return new su(ae)},timeDistributed:function(ae){return new na(ae)},globalMaxPool1d:pc,globalMaxPool2d:Fc,maxPool1d:qu,maxPool2d:Nl,Layer:to,RNN:mo,RNNCell:_f,input:To,gaussianNoise:function(ae){return new xd(ae)},gaussianDropout:function(ae){return new Ml(ae)},alphaDropout:function(ae){return new Kp(ae)},masking:function(ae){return new vf(ae)}}),jh=Object.freeze({binaryAccuracy:function(ae,ne){return cd(ae,ne)},binaryCrossentropy:function(ae,ne){return fd(ae,ne)},sparseCategoricalAccuracy:function(ae,ne){return dd(ae,ne)},categoricalAccuracy:function(ae,ne){return ld(ae,ne)},categoricalCrossentropy:function(ae,ne){return Ms(ae,ne)},precision:function(ae,ne){return Eh(ae,ne)},recall:function(ae,ne){return Lp(ae,ne)},cosineProximity:function(ae,ne){return Tc(ae,ne)},meanAbsoluteError:function(ae,ne){return Ac(ae,ne)},meanAbsolutePercentageError:function(ae,ne){return bs(ae,ne)},MAPE:function(ae,ne){return bs(ae,ne)},mape:function(ae,ne){return bs(ae,ne)},meanSquaredError:function(ae,ne){return ga(ae,ne)},MSE:function(ae,ne){return ga(ae,ne)},mse:function(ae,ne){return ga(ae,ne)}}),Fl=Object.freeze({modelFromJSON:function(ae,ne){return j(this,void 0,void 0,function(){var D,H,ue,je,Je,vt,Gt,on;return N(this,function(dt){switch(dt.label){case 0:return"modelTopology"in ae||(ae={modelTopology:ae}),(D=(ae=ae).modelTopology).model_config!=null&&(D=D.model_config),H=Hi(D),ue=Ua(H,ne),ae.weightsManifest==null?[3,2]:[4,l.io.loadWeights(ae.weightsManifest,ae.pathPrefix,ue.weights.map(function(Mn){return Mn.originalName}))];case 1:for(je=dt.sent(),Je={},vt=0,Gt=ue.weights;vt<Gt.length;vt++)on=Gt[vt],Je[on.originalName]=je[on.originalName];ue.loadWeights(Je),Object(l.dispose)(je),dt.label=2;case 2:return[2,ue]}})})}}),cu=Object.freeze({l1l2:function(ae){return new ff(ae)},l1:function(ae){return function(ne){return Mh(ne),new ff({l1:ne!=null?ne.l1:null,l2:0})}(ae)},l2:function(ae){return function(ne){return Mh(ne),new ff({l2:ne!=null?ne.l2:null,l1:0})}(ae)}}),$u=function(ae){function ne(){var D=ae!==null&&ae.apply(this,arguments)||this;return D.model=null,D}return S(ne,ae),ne.prototype.setModel=function(D){if(!(D instanceof Zc))throw new Error("model must be a LayersModel, not some other Container");this.model=D},ne}(ys);function Xu(ae,ne){return ae<ne}function _u(ae,ne){return ae>ne}var zh=function(ae){function ne(D){var H=ae.call(this)||this;if(D==null&&(D={}),D.restoreBestWeights)throw new I("restoreBestWeights = True is not implemented in EarlyStopping yet.");return H.monitor=D.monitor||"val_loss",H.minDelta=Math.abs(D.minDelta||0),H.patience=D.patience||0,H.verbose=D.verbose||0,H.mode=D.mode||"auto",H.baseline=D.baseline,["auto","min","max"].indexOf(H.mode)===-1&&(console.warn("EarlyStopping mode '"+H.mode+"' is invalid. Falling back to mode 'auto'."),H.mode="auto"),H.mode==="min"?H.monitorFunc=Xu:H.mode==="max"||H.monitor.indexOf("acc")!==-1?H.monitorFunc=_u:H.monitorFunc=Xu,H.monitorFunc===Xu&&(H.minDelta*=-1),H}return S(ne,ae),ne.prototype.onTrainBegin=function(D){return j(this,void 0,void 0,function(){return N(this,function(H){return this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===Xu?1/0:-1/0,[2]})})},ne.prototype.onEpochEnd=function(D,H){return j(this,void 0,void 0,function(){var ue;return N(this,function(je){switch(je.label){case 0:return[4,sc(H)];case 1:return je.sent(),(ue=this.getMonitorValue(H))==null?[2]:(this.monitorFunc(ue-this.minDelta,this.best)?(this.best=ue,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=D,this.model.stopTraining=!0)),[2])}})})},ne.prototype.onTrainEnd=function(D){return j(this,void 0,void 0,function(){return N(this,function(H){return this.stoppedEpoch>0&&this.verbose&&console.log("Epoch "+this.stoppedEpoch+": early stopping."),[2]})})},ne.prototype.getMonitorValue=function(D){D==null&&(D={});var H=D[this.monitor];return H==null&&console.warn("Metric for EarlyStopping "+this.monitor+" is not available. Available metrics are: "+Object.keys(D)),H},ne}($u),kd={earlyStopping:function(ae){return new zh(ae)}},Cd=r(20),Ef=r(130);r.d(s,"version",function(){return Ad}),r.d(s,"AdadeltaOptimizer",function(){return l.AdadeltaOptimizer}),r.d(s,"AdagradOptimizer",function(){return l.AdagradOptimizer}),r.d(s,"AdamOptimizer",function(){return l.AdamOptimizer}),r.d(s,"AdamaxOptimizer",function(){return l.AdamaxOptimizer}),r.d(s,"Add",function(){return l.Add}),r.d(s,"AddN",function(){return l.AddN}),r.d(s,"BroadcastTo",function(){return l.BroadcastTo}),r.d(s,"DataStorage",function(){return l.DataStorage}),r.d(s,"Div",function(){return l.Div}),r.d(s,"ENV",function(){return l.ENV}),r.d(s,"Environment",function(){return l.Environment}),r.d(s,"FromPixels",function(){return l.FromPixels}),r.d(s,"FusedBatchNorm",function(){return l.FusedBatchNorm}),r.d(s,"Identity",function(){return l.Identity}),r.d(s,"KernelBackend",function(){return l.KernelBackend}),r.d(s,"MaxPoolWithArgmax",function(){return l.MaxPoolWithArgmax}),r.d(s,"MomentumOptimizer",function(){return l.MomentumOptimizer}),r.d(s,"NonMaxSuppressionV5",function(){return l.NonMaxSuppressionV5}),r.d(s,"OneHot",function(){return l.OneHot}),r.d(s,"Optimizer",function(){return l.Optimizer}),r.d(s,"PadV2",function(){return l.PadV2}),r.d(s,"RMSPropOptimizer",function(){return l.RMSPropOptimizer}),r.d(s,"Rank",function(){return l.Rank}),r.d(s,"Reduction",function(){return l.Reduction}),r.d(s,"SGDOptimizer",function(){return l.SGDOptimizer}),r.d(s,"Square",function(){return l.Square}),r.d(s,"SquaredDifference",function(){return l.SquaredDifference}),r.d(s,"Tensor",function(){return l.Tensor}),r.d(s,"TensorBuffer",function(){return l.TensorBuffer}),r.d(s,"Tile",function(){return l.Tile}),r.d(s,"Transpose",function(){return l.Transpose}),r.d(s,"Variable",function(){return l.Variable}),r.d(s,"abs",function(){return l.abs}),r.d(s,"acos",function(){return l.acos}),r.d(s,"acosh",function(){return l.acosh}),r.d(s,"add",function(){return l.add}),r.d(s,"addN",function(){return l.addN}),r.d(s,"addStrict",function(){return l.addStrict}),r.d(s,"all",function(){return l.all}),r.d(s,"any",function(){return l.any}),r.d(s,"argMax",function(){return l.argMax}),r.d(s,"argMin",function(){return l.argMin}),r.d(s,"asin",function(){return l.asin}),r.d(s,"asinh",function(){return l.asinh}),r.d(s,"atan",function(){return l.atan}),r.d(s,"atan2",function(){return l.atan2}),r.d(s,"atanh",function(){return l.atanh}),r.d(s,"avgPool",function(){return l.avgPool}),r.d(s,"avgPool3d",function(){return l.avgPool3d}),r.d(s,"backend",function(){return l.backend}),r.d(s,"backend_util",function(){return l.backend_util}),r.d(s,"basicLSTMCell",function(){return l.basicLSTMCell}),r.d(s,"batchNorm",function(){return l.batchNorm}),r.d(s,"batchNorm2d",function(){return l.batchNorm2d}),r.d(s,"batchNorm3d",function(){return l.batchNorm3d}),r.d(s,"batchNorm4d",function(){return l.batchNorm4d}),r.d(s,"batchNormalization",function(){return l.batchNormalization}),r.d(s,"batchNormalization2d",function(){return l.batchNormalization2d}),r.d(s,"batchNormalization3d",function(){return l.batchNormalization3d}),r.d(s,"batchNormalization4d",function(){return l.batchNormalization4d}),r.d(s,"batchToSpaceND",function(){return l.batchToSpaceND}),r.d(s,"booleanMaskAsync",function(){return l.booleanMaskAsync}),r.d(s,"broadcastTo",function(){return l.broadcastTo}),r.d(s,"browser",function(){return l.browser}),r.d(s,"buffer",function(){return l.buffer}),r.d(s,"cast",function(){return l.cast}),r.d(s,"ceil",function(){return l.ceil}),r.d(s,"clipByValue",function(){return l.clipByValue}),r.d(s,"clone",function(){return l.clone}),r.d(s,"complex",function(){return l.complex}),r.d(s,"concat",function(){return l.concat}),r.d(s,"concat1d",function(){return l.concat1d}),r.d(s,"concat2d",function(){return l.concat2d}),r.d(s,"concat3d",function(){return l.concat3d}),r.d(s,"concat4d",function(){return l.concat4d}),r.d(s,"conv1d",function(){return l.conv1d}),r.d(s,"conv2d",function(){return l.conv2d}),r.d(s,"conv2dTranspose",function(){return l.conv2dTranspose}),r.d(s,"conv3d",function(){return l.conv3d}),r.d(s,"conv3dTranspose",function(){return l.conv3dTranspose}),r.d(s,"cos",function(){return l.cos}),r.d(s,"cosh",function(){return l.cosh}),r.d(s,"cumsum",function(){return l.cumsum}),r.d(s,"customGrad",function(){return l.customGrad}),r.d(s,"deprecationWarn",function(){return l.deprecationWarn}),r.d(s,"depthToSpace",function(){return l.depthToSpace}),r.d(s,"depthwiseConv2d",function(){return l.depthwiseConv2d}),r.d(s,"diag",function(){return l.diag}),r.d(s,"disableDeprecationWarnings",function(){return l.disableDeprecationWarnings}),r.d(s,"dispose",function(){return l.dispose}),r.d(s,"disposeVariables",function(){return l.disposeVariables}),r.d(s,"div",function(){return l.div}),r.d(s,"divNoNan",function(){return l.divNoNan}),r.d(s,"divStrict",function(){return l.divStrict}),r.d(s,"dot",function(){return l.dot}),r.d(s,"dropout",function(){return l.dropout}),r.d(s,"elu",function(){return l.elu}),r.d(s,"enableDebugMode",function(){return l.enableDebugMode}),r.d(s,"enableProdMode",function(){return l.enableProdMode}),r.d(s,"engine",function(){return l.engine}),r.d(s,"env",function(){return l.env}),r.d(s,"equal",function(){return l.equal}),r.d(s,"equalStrict",function(){return l.equalStrict}),r.d(s,"erf",function(){return l.erf}),r.d(s,"exp",function(){return l.exp}),r.d(s,"expandDims",function(){return l.expandDims}),r.d(s,"expm1",function(){return l.expm1}),r.d(s,"eye",function(){return l.eye}),r.d(s,"fft",function(){return l.fft}),r.d(s,"fill",function(){return l.fill}),r.d(s,"findBackend",function(){return l.findBackend}),r.d(s,"findBackendFactory",function(){return l.findBackendFactory}),r.d(s,"floor",function(){return l.floor}),r.d(s,"floorDiv",function(){return l.floorDiv}),r.d(s,"frame",function(){return l.frame}),r.d(s,"fused",function(){return l.fused}),r.d(s,"gather",function(){return l.gather}),r.d(s,"gatherND",function(){return l.gatherND}),r.d(s,"gather_util",function(){return l.gather_util}),r.d(s,"getBackend",function(){return l.getBackend}),r.d(s,"getGradient",function(){return l.getGradient}),r.d(s,"getKernel",function(){return l.getKernel}),r.d(s,"getKernelsForBackend",function(){return l.getKernelsForBackend}),r.d(s,"grad",function(){return l.grad}),r.d(s,"grads",function(){return l.grads}),r.d(s,"greater",function(){return l.greater}),r.d(s,"greaterEqual",function(){return l.greaterEqual}),r.d(s,"greaterEqualStrict",function(){return l.greaterEqualStrict}),r.d(s,"greaterStrict",function(){return l.greaterStrict}),r.d(s,"hammingWindow",function(){return l.hammingWindow}),r.d(s,"hannWindow",function(){return l.hannWindow}),r.d(s,"ifft",function(){return l.ifft}),r.d(s,"imag",function(){return l.imag}),r.d(s,"image",function(){return l.image}),r.d(s,"inTopKAsync",function(){return l.inTopKAsync}),r.d(s,"io",function(){return l.io}),r.d(s,"irfft",function(){return l.irfft}),r.d(s,"isFinite",function(){return l.isFinite}),r.d(s,"isInf",function(){return l.isInf}),r.d(s,"isNaN",function(){return l.isNaN}),r.d(s,"keep",function(){return l.keep}),r.d(s,"leakyRelu",function(){return l.leakyRelu}),r.d(s,"less",function(){return l.less}),r.d(s,"lessEqual",function(){return l.lessEqual}),r.d(s,"lessEqualStrict",function(){return l.lessEqualStrict}),r.d(s,"lessStrict",function(){return l.lessStrict}),r.d(s,"linalg",function(){return l.linalg}),r.d(s,"linspace",function(){return l.linspace}),r.d(s,"localResponseNormalization",function(){return l.localResponseNormalization}),r.d(s,"log",function(){return l.log}),r.d(s,"log1p",function(){return l.log1p}),r.d(s,"logSigmoid",function(){return l.logSigmoid}),r.d(s,"logSoftmax",function(){return l.logSoftmax}),r.d(s,"logSumExp",function(){return l.logSumExp}),r.d(s,"logicalAnd",function(){return l.logicalAnd}),r.d(s,"logicalNot",function(){return l.logicalNot}),r.d(s,"logicalOr",function(){return l.logicalOr}),r.d(s,"logicalXor",function(){return l.logicalXor}),r.d(s,"losses",function(){return l.losses}),r.d(s,"matMul",function(){return l.matMul}),r.d(s,"math",function(){return l.math}),r.d(s,"max",function(){return l.max}),r.d(s,"maxPool",function(){return l.maxPool}),r.d(s,"maxPool3d",function(){return l.maxPool3d}),r.d(s,"maxPoolWithArgmax",function(){return l.maxPoolWithArgmax}),r.d(s,"maximum",function(){return l.maximum}),r.d(s,"maximumStrict",function(){return l.maximumStrict}),r.d(s,"mean",function(){return l.mean}),r.d(s,"memory",function(){return l.memory}),r.d(s,"min",function(){return l.min}),r.d(s,"minimum",function(){return l.minimum}),r.d(s,"minimumStrict",function(){return l.minimumStrict}),r.d(s,"mod",function(){return l.mod}),r.d(s,"modStrict",function(){return l.modStrict}),r.d(s,"moments",function(){return l.moments}),r.d(s,"movingAverage",function(){return l.movingAverage}),r.d(s,"mul",function(){return l.mul}),r.d(s,"mulStrict",function(){return l.mulStrict}),r.d(s,"multiRNNCell",function(){return l.multiRNNCell}),r.d(s,"multinomial",function(){return l.multinomial}),r.d(s,"neg",function(){return l.neg}),r.d(s,"nextFrame",function(){return l.nextFrame}),r.d(s,"norm",function(){return l.norm}),r.d(s,"notEqual",function(){return l.notEqual}),r.d(s,"notEqualStrict",function(){return l.notEqualStrict}),r.d(s,"oneHot",function(){return l.oneHot}),r.d(s,"ones",function(){return l.ones}),r.d(s,"onesLike",function(){return l.onesLike}),r.d(s,"op",function(){return l.op}),r.d(s,"outerProduct",function(){return l.outerProduct}),r.d(s,"pad",function(){return l.pad}),r.d(s,"pad1d",function(){return l.pad1d}),r.d(s,"pad2d",function(){return l.pad2d}),r.d(s,"pad3d",function(){return l.pad3d}),r.d(s,"pad4d",function(){return l.pad4d}),r.d(s,"pool",function(){return l.pool}),r.d(s,"pow",function(){return l.pow}),r.d(s,"powStrict",function(){return l.powStrict}),r.d(s,"prelu",function(){return l.prelu}),r.d(s,"print",function(){return l.print}),r.d(s,"prod",function(){return l.prod}),r.d(s,"profile",function(){return l.profile}),r.d(s,"rand",function(){return l.rand}),r.d(s,"randomGamma",function(){return l.randomGamma}),r.d(s,"randomNormal",function(){return l.randomNormal}),r.d(s,"randomUniform",function(){return l.randomUniform}),r.d(s,"range",function(){return l.range}),r.d(s,"ready",function(){return l.ready}),r.d(s,"real",function(){return l.real}),r.d(s,"reciprocal",function(){return l.reciprocal}),r.d(s,"registerBackend",function(){return l.registerBackend}),r.d(s,"registerGradient",function(){return l.registerGradient}),r.d(s,"registerKernel",function(){return l.registerKernel}),r.d(s,"relu",function(){return l.relu}),r.d(s,"relu6",function(){return l.relu6}),r.d(s,"removeBackend",function(){return l.removeBackend}),r.d(s,"reshape",function(){return l.reshape}),r.d(s,"reverse",function(){return l.reverse}),r.d(s,"reverse1d",function(){return l.reverse1d}),r.d(s,"reverse2d",function(){return l.reverse2d}),r.d(s,"reverse3d",function(){return l.reverse3d}),r.d(s,"reverse4d",function(){return l.reverse4d}),r.d(s,"rfft",function(){return l.rfft}),r.d(s,"round",function(){return l.round}),r.d(s,"rsqrt",function(){return l.rsqrt}),r.d(s,"scalar",function(){return l.scalar}),r.d(s,"scatterND",function(){return l.scatterND}),r.d(s,"scatter_util",function(){return l.scatter_util}),r.d(s,"selu",function(){return l.selu}),r.d(s,"separableConv2d",function(){return l.separableConv2d}),r.d(s,"serialization",function(){return l.serialization}),r.d(s,"setBackend",function(){return l.setBackend}),r.d(s,"setPlatform",function(){return l.setPlatform}),r.d(s,"setdiff1dAsync",function(){return l.setdiff1dAsync}),r.d(s,"sigmoid",function(){return l.sigmoid}),r.d(s,"sign",function(){return l.sign}),r.d(s,"signal",function(){return l.signal}),r.d(s,"sin",function(){return l.sin}),r.d(s,"sinh",function(){return l.sinh}),r.d(s,"slice",function(){return l.slice}),r.d(s,"slice1d",function(){return l.slice1d}),r.d(s,"slice2d",function(){return l.slice2d}),r.d(s,"slice3d",function(){return l.slice3d}),r.d(s,"slice4d",function(){return l.slice4d}),r.d(s,"slice_util",function(){return l.slice_util}),r.d(s,"softmax",function(){return l.softmax}),r.d(s,"softplus",function(){return l.softplus}),r.d(s,"spaceToBatchND",function(){return l.spaceToBatchND}),r.d(s,"sparseToDense",function(){return l.sparseToDense}),r.d(s,"spectral",function(){return l.spectral}),r.d(s,"split",function(){return l.split}),r.d(s,"sqrt",function(){return l.sqrt}),r.d(s,"square",function(){return l.square}),r.d(s,"squaredDifference",function(){return l.squaredDifference}),r.d(s,"squaredDifferenceStrict",function(){return l.squaredDifferenceStrict}),r.d(s,"squeeze",function(){return l.squeeze}),r.d(s,"stack",function(){return l.stack}),r.d(s,"step",function(){return l.step}),r.d(s,"stft",function(){return l.stft}),r.d(s,"stridedSlice",function(){return l.stridedSlice}),r.d(s,"sub",function(){return l.sub}),r.d(s,"subStrict",function(){return l.subStrict}),r.d(s,"sum",function(){return l.sum}),r.d(s,"sumOutType",function(){return l.sumOutType}),r.d(s,"tan",function(){return l.tan}),r.d(s,"tanh",function(){return l.tanh}),r.d(s,"tensor",function(){return l.tensor}),r.d(s,"tensor1d",function(){return l.tensor1d}),r.d(s,"tensor2d",function(){return l.tensor2d}),r.d(s,"tensor3d",function(){return l.tensor3d}),r.d(s,"tensor4d",function(){return l.tensor4d}),r.d(s,"tensor5d",function(){return l.tensor5d}),r.d(s,"tensor6d",function(){return l.tensor6d}),r.d(s,"tensor_util",function(){return l.tensor_util}),r.d(s,"test_util",function(){return l.test_util}),r.d(s,"tidy",function(){return l.tidy}),r.d(s,"tile",function(){return l.tile}),r.d(s,"time",function(){return l.time}),r.d(s,"topk",function(){return l.topk}),r.d(s,"train",function(){return l.train}),r.d(s,"transpose",function(){return l.transpose}),r.d(s,"truncatedNormal",function(){return l.truncatedNormal}),r.d(s,"unregisterGradient",function(){return l.unregisterGradient}),r.d(s,"unregisterKernel",function(){return l.unregisterKernel}),r.d(s,"unsortedSegmentSum",function(){return l.unsortedSegmentSum}),r.d(s,"unstack",function(){return l.unstack}),r.d(s,"util",function(){return l.util}),r.d(s,"valueAndGrad",function(){return l.valueAndGrad}),r.d(s,"valueAndGrads",function(){return l.valueAndGrads}),r.d(s,"variable",function(){return l.variable}),r.d(s,"variableGrads",function(){return l.variableGrads}),r.d(s,"version_core",function(){return l.version_core}),r.d(s,"webgl",function(){return l.webgl}),r.d(s,"where",function(){return l.where}),r.d(s,"whereAsync",function(){return l.whereAsync}),r.d(s,"zeros",function(){return l.zeros}),r.d(s,"zerosLike",function(){return l.zerosLike}),r.d(s,"constraints",function(){return cn}),r.d(s,"initializers",function(){return Sr}),r.d(s,"layers",function(){return Il}),r.d(s,"metrics",function(){return jh}),r.d(s,"models",function(){return Fl}),r.d(s,"regularizers",function(){return cu}),r.d(s,"CallbackList",function(){return sd}),r.d(s,"CustomCallback",function(){return ud}),r.d(s,"History",function(){return uc}),r.d(s,"Callback",function(){return $u}),r.d(s,"callbacks",function(){return kd}),r.d(s,"EarlyStopping",function(){return zh}),r.d(s,"InputSpec",function(){return eo}),r.d(s,"SymbolicTensor",function(){return wo}),r.d(s,"LayersModel",function(){return Zc}),r.d(s,"input",function(){return To}),r.d(s,"loadLayersModel",function(){return Ya}),r.d(s,"model",function(){return _o}),r.d(s,"registerCallbackConstructor",function(){return Ns}),r.d(s,"sequential",function(){return va}),r.d(s,"RNN",function(){return mo}),r.d(s,"Sequential",function(){return Pt}),r.d(s,"LayerVariable",function(){return zr}),r.d(s,"version_layers",function(){return"1.7.4"}),r.d(s,"GraphModel",function(){return Cd.GraphModel}),r.d(s,"loadGraphModel",function(){return Cd.loadGraphModel}),r.d(s,"deregisterOp",function(){return Cd.deregisterOp}),r.d(s,"registerOp",function(){return Cd.registerOp}),r.d(s,"version_converter",function(){return Cd.version_converter}),r.d(s,"data",function(){return Ef});var Ad={"tfjs-core":l.version_core,"tfjs-data":Ef.version_data,"tfjs-layers":"1.7.4","tfjs-converter":Cd.version_converter,tfjs:"1.7.4"}},function(u,s,r){r.r(s),function(l,C,S,O){r.d(s,"AdadeltaOptimizer",function(){return L1}),r.d(s,"AdagradOptimizer",function(){return B1}),r.d(s,"AdamOptimizer",function(){return j1}),r.d(s,"AdamaxOptimizer",function(){return Vv}),r.d(s,"DataStorage",function(){return _f}),r.d(s,"ENV",function(){return q}),r.d(s,"Environment",function(){return W}),r.d(s,"KernelBackend",function(){return Sd}),r.d(s,"MomentumOptimizer",function(){return Hv}),r.d(s,"Optimizer",function(){return up}),r.d(s,"RMSPropOptimizer",function(){return Py}),r.d(s,"Rank",function(){return Se}),r.d(s,"Reduction",function(){return ps}),r.d(s,"SGDOptimizer",function(){return Ry}),r.d(s,"Tensor",function(){return $t}),r.d(s,"TensorBuffer",function(){return Hr}),r.d(s,"Variable",function(){return kt}),r.d(s,"abs",function(){return al}),r.d(s,"acos",function(){return n0}),r.d(s,"acosh",function(){return r0}),r.d(s,"add",function(){return qh}),r.d(s,"addN",function(){return Ay}),r.d(s,"addStrict",function(){return Oy}),r.d(s,"all",function(){return m0}),r.d(s,"any",function(){return jc}),r.d(s,"argMax",function(){return g0}),r.d(s,"argMin",function(){return Dv}),r.d(s,"asin",function(){return Yu}),r.d(s,"asinh",function(){return i0}),r.d(s,"atan",function(){return Wh}),r.d(s,"atan2",function(){return rg}),r.d(s,"atanh",function(){return im}),r.d(s,"avgPool",function(){return Ov}),r.d(s,"avgPool3d",function(){return Tv}),r.d(s,"backend",function(){return qg}),r.d(s,"backend_util",function(){return Fc}),r.d(s,"basicLSTMCell",function(){return Rv}),r.d(s,"batchNorm",function(){return Cy}),r.d(s,"batchNorm2d",function(){return Of}),r.d(s,"batchNorm3d",function(){return Gh}),r.d(s,"batchNorm4d",function(){return Nd}),r.d(s,"batchNormalization",function(){return F1}),r.d(s,"batchNormalization2d",function(){return yv}),r.d(s,"batchNormalization3d",function(){return um}),r.d(s,"batchNormalization4d",function(){return a0}),r.d(s,"batchToSpaceND",function(){return Ol}),r.d(s,"booleanMaskAsync",function(){return ug}),r.d(s,"broadcastTo",function(){return df}),r.d(s,"browser",function(){return yc}),r.d(s,"buffer",function(){return Wi}),r.d(s,"cast",function(){return Xp}),r.d(s,"ceil",function(){return ky}),r.d(s,"clipByValue",function(){return om}),r.d(s,"clone",function(){return Qm}),r.d(s,"complex",function(){return _o}),r.d(s,"concat",function(){return Ho}),r.d(s,"concat1d",function(){return Mh}),r.d(s,"concat2d",function(){return Hp}),r.d(s,"concat3d",function(){return ff}),r.d(s,"concat4d",function(){return Dh}),r.d(s,"conv1d",function(){return lg}),r.d(s,"conv2d",function(){return Yh}),r.d(s,"conv2dTranspose",function(){return Wl}),r.d(s,"conv3d",function(){return fg}),r.d(s,"conv3dTranspose",function(){return Ty}),r.d(s,"cos",function(){return sl}),r.d(s,"cosh",function(){return am}),r.d(s,"cumsum",function(){return hf}),r.d(s,"customGrad",function(){return ou}),r.d(s,"deprecationWarn",function(){return pd}),r.d(s,"depthToSpace",function(){return Ih}),r.d(s,"depthwiseConv2d",function(){return hm}),r.d(s,"diag",function(){return ym}),r.d(s,"disableDeprecationWarnings",function(){return Xm}),r.d(s,"dispose",function(){return Lo}),r.d(s,"disposeVariables",function(){return lf}),r.d(s,"div",function(){return Mf}),r.d(s,"divNoNan",function(){return zl}),r.d(s,"divStrict",function(){return cm}),r.d(s,"dot",function(){return pm}),r.d(s,"dropout",function(){return Hd}),r.d(s,"elu",function(){return zc}),r.d(s,"enableDebugMode",function(){return $m}),r.d(s,"enableProdMode",function(){return Wu}),r.d(s,"engine",function(){return Bp}),r.d(s,"env",function(){return z}),r.d(s,"equal",function(){return Lc}),r.d(s,"equalStrict",function(){return ec}),r.d(s,"erf",function(){return lv}),r.d(s,"exp",function(){return fv}),r.d(s,"expandDims",function(){return Go}),r.d(s,"expm1",function(){return o0}),r.d(s,"eye",function(){return Fh}),r.d(s,"fft",function(){return vg}),r.d(s,"fill",function(){return Is}),r.d(s,"findBackend",function(){return zp}),r.d(s,"findBackendFactory",function(){return Km}),r.d(s,"floor",function(){return D1}),r.d(s,"floorDiv",function(){return $h}),r.d(s,"frame",function(){return xm}),r.d(s,"fused",function(){return E0}),r.d(s,"gather",function(){return ag}),r.d(s,"gatherND",function(){return ql}),r.d(s,"gather_util",function(){return Kg}),r.d(s,"getBackend",function(){return Ds}),r.d(s,"getGradient",function(){return G}),r.d(s,"getKernel",function(){return Y}),r.d(s,"getKernelsForBackend",function(){return oe}),r.d(s,"grad",function(){return Ed}),r.d(s,"grads",function(){return wf}),r.d(s,"greater",function(){return Nu}),r.d(s,"greaterEqual",function(){return Kh}),r.d(s,"greaterEqualStrict",function(){return og}),r.d(s,"greaterStrict",function(){return u0}),r.d(s,"hammingWindow",function(){return b0}),r.d(s,"hannWindow",function(){return xg}),r.d(s,"ifft",function(){return yg}),r.d(s,"imag",function(){return Ya}),r.d(s,"image",function(){return _0}),r.d(s,"inTopKAsync",function(){return Bv}),r.d(s,"io",function(){return op}),r.d(s,"irfft",function(){return ll}),r.d(s,"isFinite",function(){return Vh}),r.d(s,"isInf",function(){return gv}),r.d(s,"isNaN",function(){return mv}),r.d(s,"keep",function(){return Ch}),r.d(s,"leakyRelu",function(){return Zh}),r.d(s,"less",function(){return c0}),r.d(s,"lessEqual",function(){return lm}),r.d(s,"lessEqualStrict",function(){return zo}),r.d(s,"lessStrict",function(){return fm}),r.d(s,"linalg",function(){return Eg}),r.d(s,"linspace",function(){return Th}),r.d(s,"localResponseNormalization",function(){return Fv}),r.d(s,"log",function(){return N1}),r.d(s,"log1p",function(){return yo}),r.d(s,"logSigmoid",function(){return dv}),r.d(s,"logSoftmax",function(){return mo}),r.d(s,"logSumExp",function(){return Rf}),r.d(s,"logicalAnd",function(){return Id}),r.d(s,"logicalNot",function(){return bv}),r.d(s,"logicalOr",function(){return s0}),r.d(s,"logicalXor",function(){return Fd}),r.d(s,"losses",function(){return wg}),r.d(s,"matMul",function(){return _v}),r.d(s,"math",function(){return hl}),r.d(s,"max",function(){return Dy}),r.d(s,"maxPool",function(){return Av}),r.d(s,"maxPool3d",function(){return My}),r.d(s,"maximum",function(){return Rd}),r.d(s,"maximumStrict",function(){return Df}),r.d(s,"mean",function(){return Jh}),r.d(s,"memory",function(){return Sh}),r.d(s,"min",function(){return Qh}),r.d(s,"minimum",function(){return Nf}),r.d(s,"minimumStrict",function(){return Zu}),r.d(s,"mod",function(){return Xh}),r.d(s,"modStrict",function(){return Pd}),r.d(s,"moments",function(){return Pf}),r.d(s,"movingAverage",function(){return Lf}),r.d(s,"mul",function(){return Ul}),r.d(s,"mulStrict",function(){return ul}),r.d(s,"multiRNNCell",function(){return gg}),r.d(s,"multinomial",function(){return pf}),r.d(s,"neg",function(){return hv}),r.d(s,"nextFrame",function(){return Vf}),r.d(s,"norm",function(){return ep}),r.d(s,"notEqual",function(){return Bc}),r.d(s,"notEqualStrict",function(){return jd}),r.d(s,"oneHot",function(){return Rh}),r.d(s,"ones",function(){return Du}),r.d(s,"onesLike",function(){return xs}),r.d(s,"op",function(){return Pt}),r.d(s,"outerProduct",function(){return Ev}),r.d(s,"pad",function(){return mf}),r.d(s,"pad1d",function(){return Tl}),r.d(s,"pad2d",function(){return el}),r.d(s,"pad3d",function(){return Ph}),r.d(s,"pad4d",function(){return yd}),r.d(s,"pool",function(){return Ud}),r.d(s,"pow",function(){return Ld}),r.d(s,"powStrict",function(){return ig}),r.d(s,"prelu",function(){return gm}),r.d(s,"print",function(){return vd}),r.d(s,"prod",function(){return Vd}),r.d(s,"profile",function(){return kh}),r.d(s,"rand",function(){return gf}),r.d(s,"randomGamma",function(){return Xg}),r.d(s,"randomNormal",function(){return tl}),r.d(s,"randomUniform",function(){return vf}),r.d(s,"range",function(){return Dc}),r.d(s,"ready",function(){return jp}),r.d(s,"real",function(){return va}),r.d(s,"reciprocal",function(){return eg}),r.d(s,"registerBackend",function(){return Ym}),r.d(s,"registerGradient",function(){return be}),r.d(s,"registerKernel",function(){return ce}),r.d(s,"relu",function(){return mg}),r.d(s,"relu6",function(){return v0}),r.d(s,"removeBackend",function(){return Mc}),r.d(s,"reshape",function(){return la}),r.d(s,"reverse",function(){return Ff}),r.d(s,"reverse1d",function(){return Sv}),r.d(s,"reverse2d",function(){return mm}),r.d(s,"reverse3d",function(){return hg}),r.d(s,"reverse4d",function(){return kv}),r.d(s,"rfft",function(){return y0}),r.d(s,"round",function(){return pv}),r.d(s,"rsqrt",function(){return sm}),r.d(s,"scalar",function(){return kr}),r.d(s,"scatterND",function(){return Pv}),r.d(s,"scatter_util",function(){return Jp}),r.d(s,"selu",function(){return Iv}),r.d(s,"separableConv2d",function(){return wv}),r.d(s,"serialization",function(){return Kl}),r.d(s,"setBackend",function(){return md}),r.d(s,"setPlatform",function(){return $g}),r.d(s,"setdiff1dAsync",function(){return rl}),r.d(s,"sigmoid",function(){return Ll}),r.d(s,"sign",function(){return Bl}),r.d(s,"signal",function(){return x0}),r.d(s,"sin",function(){return Dd}),r.d(s,"sinh",function(){return Hh}),r.d(s,"slice",function(){return Vl}),r.d(s,"slice1d",function(){return p0}),r.d(s,"slice2d",function(){return Mv}),r.d(s,"slice3d",function(){return Wd}),r.d(s,"slice4d",function(){return Hl}),r.d(s,"slice_util",function(){return Qp}),r.d(s,"softmax",function(){return Ls}),r.d(s,"softplus",function(){return I1}),r.d(s,"spaceToBatchND",function(){return La}),r.d(s,"sparseToDense",function(){return Lv}),r.d(s,"spectral",function(){return bg}),r.d(s,"split",function(){return Gi}),r.d(s,"sqrt",function(){return tg}),r.d(s,"square",function(){return t0}),r.d(s,"squaredDifference",function(){return Md}),r.d(s,"squaredDifferenceStrict",function(){return Bd}),r.d(s,"squeeze",function(){return Wa}),r.d(s,"stack",function(){return qi}),r.d(s,"step",function(){return jl}),r.d(s,"stft",function(){return wm}),r.d(s,"stridedSlice",function(){return vm}),r.d(s,"sub",function(){return cl}),r.d(s,"subStrict",function(){return ds}),r.d(s,"sum",function(){return Nv}),r.d(s,"sumOutType",function(){return Nt}),r.d(s,"tan",function(){return Ju}),r.d(s,"tanh",function(){return kf}),r.d(s,"tensor",function(){return To}),r.d(s,"tensor1d",function(){return ru}),r.d(s,"tensor2d",function(){return xu}),r.d(s,"tensor3d",function(){return Cl}),r.d(s,"tensor4d",function(){return iu}),r.d(s,"tensor5d",function(){return Oh}),r.d(s,"tensor6d",function(){return Wp}),r.d(s,"tensor_util",function(){return Tt}),r.d(s,"test_util",function(){return Eu}),r.d(s,"tidy",function(){return Hi}),r.d(s,"tile",function(){return Rs}),r.d(s,"time",function(){return Gg}),r.d(s,"topk",function(){return Gl}),r.d(s,"train",function(){return z1}),r.d(s,"transpose",function(){return hs}),r.d(s,"truncatedNormal",function(){return nl}),r.d(s,"unregisterGradient",function(){return ve}),r.d(s,"unregisterKernel",function(){return Ee}),r.d(s,"unsortedSegmentSum",function(){return sg}),r.d(s,"unstack",function(){return Va}),r.d(s,"util",function(){return Er}),r.d(s,"valueAndGrad",function(){return Zp}),r.d(s,"valueAndGrads",function(){return em}),r.d(s,"variable",function(){return Vp}),r.d(s,"variableGrads",function(){return vn}),r.d(s,"version_core",function(){return P1}),r.d(s,"webgl",function(){return Jl}),r.d(s,"where",function(){return po}),r.d(s,"whereAsync",function(){return Tf}),r.d(s,"zeros",function(){return ao}),r.d(s,"zerosLike",function(){return mi});var U=function(_,v){return(U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,y){d.__proto__=y}||function(d,y){for(var E in y)y.hasOwnProperty(E)&&(d[E]=y[E])})(_,v)};function j(_,v){function d(){this.constructor=_}U(_,v),_.prototype=v===null?Object.create(v):(d.prototype=v.prototype,new d)}function N(_,v,d,y){return new(d||(d=Promise))(function(E,B){function Q(xe){try{fe(y.next(xe))}catch(Oe){B(Oe)}}function re(xe){try{fe(y.throw(xe))}catch(Oe){B(Oe)}}function fe(xe){xe.done?E(xe.value):new d(function(Oe){Oe(xe.value)}).then(Q,re)}fe((y=y.apply(_,v||[])).next())})}function L(_,v){var d,y,E,B,Q={label:0,sent:function(){if(1&E[0])throw E[1];return E[1]},trys:[],ops:[]};return B={next:re(0),throw:re(1),return:re(2)},typeof Symbol=="function"&&(B[Symbol.iterator]=function(){return this}),B;function re(fe){return function(xe){return function(Oe){if(d)throw new TypeError("Generator is already executing.");for(;Q;)try{if(d=1,y&&(E=2&Oe[0]?y.return:Oe[0]?y.throw||((E=y.return)&&E.call(y),0):y.next)&&!(E=E.call(y,Oe[1])).done)return E;switch(y=0,E&&(Oe=[2&Oe[0],E.value]),Oe[0]){case 0:case 1:E=Oe;break;case 4:return Q.label++,{value:Oe[1],done:!1};case 5:Q.label++,y=Oe[1],Oe=[0];continue;case 7:Oe=Q.ops.pop(),Q.trys.pop();continue;default:if(!(E=(E=Q.trys).length>0&&E[E.length-1])&&(Oe[0]===6||Oe[0]===2)){Q=0;continue}if(Oe[0]===3&&(!E||Oe[1]>E[0]&&Oe[1]<E[3])){Q.label=Oe[1];break}if(Oe[0]===6&&Q.label<E[1]){Q.label=E[1],E=Oe;break}if(E&&Q.label<E[2]){Q.label=E[2],Q.ops.push(Oe);break}E[2]&&Q.ops.pop(),Q.trys.pop();continue}Oe=v.call(_,Q)}catch(Re){Oe=[6,Re],y=0}finally{d=E=0}if(5&Oe[0])throw Oe[1];return{value:Oe[0]?Oe[1]:void 0,done:!0}}([fe,xe])}}}var W=function(){function _(v){this.global=v,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return _.prototype.setPlatform=function(v,d){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+d+"."),this.platformName=v,this.platform=d},_.prototype.registerFlag=function(v,d,y){if(this.flagRegistry[v]={evaluationFn:d,setHook:y},this.urlFlags[v]!=null){var E=this.urlFlags[v];console.warn("Setting feature override from URL "+v+": "+E+"."),this.set(v,E)}},_.prototype.get=function(v){return v in this.flags?this.flags[v]:(this.flags[v]=this.evaluateFlag(v),this.flags[v])},_.prototype.getNumber=function(v){return this.get(v)},_.prototype.getBool=function(v){return this.get(v)},_.prototype.getFlags=function(){return this.flags},Object.defineProperty(_.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),_.prototype.set=function(v,d){if(this.flagRegistry[v]==null)throw new Error("Cannot set flag "+v+" as it has not been registered.");this.flags[v]=d,this.flagRegistry[v].setHook!=null&&this.flagRegistry[v].setHook(d)},_.prototype.evaluateFlag=function(v){if(this.flagRegistry[v]==null)throw new Error("Cannot evaluate flag '"+v+"': no evaluation function found.");return this.flagRegistry[v].evaluationFn()},_.prototype.setFlags=function(v){this.flags=Object.assign({},v)},_.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},_.prototype.populateURLFlags=function(){var v=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var d,y,E=(d=this.global.location.search,y={},d.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(B){for(var Q=[],re=1;re<arguments.length;re++)Q[re-1]=arguments[re];return function(fe,xe,Oe){fe[decodeURIComponent(xe)]=decodeURIComponent(Oe||"")}(y,Q[0],Q[1]),Q.join("=")}),y);"tfjsflags"in E&&E.tfjsflags.split(",").forEach(function(B){var Q=B.split(":"),re=Q[0],fe=Q[1];v.urlFlags[re]=function(xe,Oe){if((Oe=Oe.toLowerCase())==="true"||Oe==="false")return Oe==="true";if(""+ +Oe===Oe)return+Oe;throw new Error("Could not parse value flag value "+Oe+" for flag "+xe+".")}(re,fe)})}},_}();function z(){return q}var q=null,I=new Map,Z=new Map;function Y(_,v){var d=ge(_,v);return I.get(d)}function G(_){return Z.get(_)}function oe(_){for(var v=I.entries(),d=[];;){var y=v.next(),E=y.done,B=y.value;if(E)break;var Q=B[0],re=B[1];Q.split("_")[0]===_&&d.push(re)}return d}function ce(_){var v=_.kernelName,d=_.backendName,y=ge(v,d);if(I.has(y))throw new Error("The kernel '"+v+"' for backend '"+d+"' is already registered");I.set(y,_)}function be(_){var v=_.kernelName;Z.has(v)&&console.warn("Overriding the gradient for '"+v+"'"),Z.set(v,_)}function Ee(_,v){var d=ge(_,v);if(!I.has(d))throw new Error("The kernel '"+_+"' for backend '"+v+"' is not registered");I.delete(d)}function ve(_){if(!Z.has(_))throw new Error("The gradient '"+_+"' for backend is not registered");Z.delete(_)}function ge(_,v){return v+"_"+_}function Ge(_){for(var v=_.length,d=0,y=0;v>0;)y=Math.random()*v|0,d=_[--v],_[v]=_[y],_[y]=d}function ht(_,v,d){return Math.max(_,Math.min(v,d))}function It(_){return _%2==0?_:_+1}function St(_){for(var v=0,d=0;d<_.length;d++)v+=_[d];return v}function we(_,v){if(!_)throw new Error(typeof v=="string"?v:v())}function bt(_,v,d){d===void 0&&(d=""),we(Ut(_,v),function(){return d+" Shapes "+_+" and "+v+" must match"})}function jt(_){we(_!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Mt(_,v,d){if(v===void 0&&(v=[]),d===void 0&&(d=!1),v==null&&(v=[]),Array.isArray(_)||ft(_)&&!d)for(var y=0;y<_.length;++y)Mt(_[y],v,d);else v.push(_);return v}function ze(_){if(_.length===0)return 1;for(var v=_[0],d=1;d<_.length;d++)v*=_[d];return v}function Ut(_,v){if(_===v)return!0;if(_==null||v==null||_.length!==v.length)return!1;for(var d=0;d<_.length;d++)if(_[d]!==v[d])return!1;return!0}function Ft(_){return _%1==0}function pt(_){if(Math.tanh!=null)return Math.tanh(_);if(_===1/0)return 1;if(_===-1/0)return-1;var v=Math.exp(2*_);return(v-1)/(v+1)}function yt(_){var v=Math.ceil(Math.sqrt(_));return[v,Math.ceil(_/v)]}function nn(_,v){return v<=_.length?_:_+" ".repeat(v-_.length)}function xt(_,v,d){return v===void 0&&(v=function(y){return 0}),new Promise(function(y,E){var B=0,Q=function(){if(_())y();else{var re=v(++B);d!=null&&B>=d?E():setTimeout(Q,re)}};Q()})}function _t(_,v){for(var d=1,y=-1,E=0;E<_.length;++E)if(_[E]>=0)d*=_[E];else if(_[E]===-1){if(y!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+y+" and dim "+E);y=E}else if(_[E]<0)throw Error("Shapes can not be < 0. Found "+_[E]+" at dim "+E);if(y===-1){if(v>0&&v!==d)throw Error("Size("+v+") must match the product of shape "+_);return _}if(d===0)throw Error("Cannot infer the missing size in ["+_+"] when there are 0 elements");if(v%d!=0)throw Error("The implicit shape can't be a fractional number. Got "+v+" / "+d);var B=_.slice();return B[y]=v/d,B}function Yt(_,v){var d=v.length;return we((_=_==null?v.map(function(y,E){return E}):[].concat(_)).every(function(y){return y>=-d&&y<d}),function(){return"All values in axis param must be in range [-"+d+", "+d+") but got axis "+_}),we(_.every(function(y){return Ft(y)}),function(){return"All values in axis param must be integers but got axis "+_}),_.map(function(y){return y<0?d+y:y})}function Fn(_,v){for(var d=[],y=[],E=v!=null&&Array.isArray(v)&&v.length===0,B=v==null||E?null:Yt(v,_).sort(),Q=0,re=0;re<_.length;++re){if(B!=null){if(B[Q]===re&&_[re]!==1)throw new Error("Can't squeeze axis "+re+" since its dim '"+_[re]+"' is not 1");(B[Q]==null||B[Q]>re)&&_[re]===1&&(d.push(_[re]),y.push(re)),B[Q]<=re&&Q++}_[re]!==1&&(d.push(_[re]),y.push(re))}return{newShape:d,keptDims:y}}function Rn(_,v){var d=null;if(_==null||_==="float32")d=new Float32Array(v);else if(_==="int32")d=new Int32Array(v);else{if(_!=="bool")throw new Error("Unknown data type "+_);d=new Uint8Array(v)}return d}function cn(_,v){var d=null;if(_==null||_==="float32")d=new Float32Array(v);else if(_==="int32")d=new Int32Array(v);else if(_==="bool")d=new Uint8Array(v);else{if(_!=="string")throw new Error("Unknown data type "+_);d=new Array(v)}return d}function qe(_,v){for(var d=0;d<_.length;d++){var y=_[d];if(isNaN(y)||!isFinite(y))throw Error("A tensor of type "+v+" being uploaded contains "+y+".")}}function Qe(_){return _==="bool"||_==="complex64"||_==="float32"||_==="int32"||_==="string"}function $e(_,v){return!(v==="complex64"||v==="float32"&&_!=="complex64"||v==="int32"&&_!=="float32"&&_!=="complex64"||v==="bool"&&_==="bool")}function ft(_){return _ instanceof Float32Array||_ instanceof Int32Array||_ instanceof Uint8Array}function Jt(_){if(_==="float32"||_==="int32")return 4;if(_==="complex64")return 8;if(_==="bool")return 1;throw new Error("Unknown dtype "+_)}function Qt(_){if(_==null)return 0;var v=0;return _.forEach(function(d){return v+=d.length}),v}function Pn(_){return typeof _=="string"||_ instanceof String}function kn(_){return typeof _=="boolean"}function Qn(_){return typeof _=="number"}function ke(_){return Array.isArray(_)?ke(_[0]):_ instanceof Float32Array?"float32":_ instanceof Int32Array||_ instanceof Uint8Array?"int32":Qn(_)?"float32":Pn(_)?"string":kn(_)?"bool":"float32"}function ar(_){return!!(_&&_.constructor&&_.call&&_.apply)}function Tr(_,v){for(var d=v;d<_;++d)if(_%d==0)return d;return _}function rn(_){var v=_.length;if(v<2)return[];var d=new Array(v-1);d[v-2]=_[v-1];for(var y=v-3;y>=0;--y)d[y]=d[y+1]*_[y+1];return d}function Ht(_,v,d){if(v==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(_)&&(_=Mt(_)),d&&qe(_,v),function(B,Q){return B instanceof Float32Array&&Q==="float32"||B instanceof Int32Array&&Q==="int32"||B instanceof Uint8Array&&Q==="bool"}(_,v))return _;if(v==null||v==="float32"||v==="complex64")return new Float32Array(_);if(v==="int32")return new Int32Array(_);if(v==="bool"){for(var y=new Uint8Array(_.length),E=0;E<y.length;++E)Math.round(_[E])!==0&&(y[E]=1);return y}throw new Error("Unknown data type "+v)}function Gn(_,v){if(_.length===0)return v[0];var d=_.reduce(function(y,E){return y*E});if(d===0)return[];if(d!==v.length)throw new Error("["+_+"] does not match the input size.");return function y(E,B,Q){var re=new Array;if(B.length===1)for(var fe=B[0],xe=0;xe<fe;xe++)re[xe]=Q[E+xe];else{fe=B[0];var Oe=B.slice(1),Re=Oe.reduce(function(Le,Be){return Le*Be});for(xe=0;xe<fe;xe++)re[xe]=y(E+xe*Re,Oe,Q)}return re}(0,_,v)}function Xt(_,v){for(var d=Wt(_,v),y=0;y<d.length;y++)d[y]=1;return d}function Wt(_,v){if(v==null||v==="float32"||v==="complex64")return new Float32Array(_);if(v==="int32")return new Int32Array(_);if(v==="bool")return new Uint8Array(_);throw new Error("Unknown data type "+v)}function Zt(){return z().platform.now()}function Vn(_){_.forEach(function(v){we(Number.isInteger(v)&&v>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+_+"]."})})}function xn(_,v){return v===void 0&&(v="utf-8"),v=v||"utf-8",z().platform.encode(_,v)}function Un(_,v){return v===void 0&&(v="utf-8"),v=v||"utf-8",z().platform.decode(_,v)}function ur(_,v,d){if(v===0)return 0;if(v===1)return _[0];for(var y=_[_.length-1],E=0;E<_.length-1;++E)y+=d[E]*_[E];return y}function sr(_,v,d){if(v===0)return[];if(v===1)return[_];for(var y=new Array(v),E=0;E<y.length-1;++E)y[E]=Math.floor(_/d[E]),_-=y[E]*d[E];return y[y.length-1]=_,y}var Er=Object.freeze({shuffle:Ge,clamp:ht,nearestLargerEven:It,sum:St,randUniform:function(_,v){var d=Math.random();return v*d+(1-d)*_},distSquared:function(_,v){for(var d=0,y=0;y<_.length;y++){var E=Number(_[y])-Number(v[y]);d+=E*E}return d},assert:we,assertShapesMatch:bt,assertNonNull:jt,flatten:Mt,sizeFromShape:ze,isScalarShape:function(_){return _.length===0},arraysEqual:Ut,isInt:Ft,tanh:pt,sizeToSquarishShape:yt,createShuffledIndices:function(_){for(var v=new Uint32Array(_),d=0;d<_;++d)v[d]=d;return Ge(v),v},rightPad:nn,repeatedTry:xt,inferFromImplicitShape:_t,parseAxisParam:Yt,squeezeShape:Fn,getTypedArrayFromDType:Rn,getArrayFromDType:cn,checkConversionForErrors:qe,isValidDtype:Qe,hasEncodingLoss:$e,isTypedArray:ft,bytesPerElement:Jt,bytesFromStringArray:Qt,isString:Pn,isBoolean:kn,isNumber:Qn,inferDtype:ke,isFunction:ar,nearestDivisor:Tr,computeStrides:rn,toTypedArray:Ht,toNestedArray:Gn,makeOnesTypedArray:Xt,makeZerosTypedArray:Wt,now:Zt,assertNonNegativeIntegerDimensions:Vn,fetch:function(_,v){return z().platform.fetch(_,v)},encodeString:xn,decodeString:Un,locToIndex:ur,indexToLoc:sr}),Mr=function(){function _(v,d){this.backendTimer=v,this.logger=d,d==null&&(this.logger=new pr)}return _.prototype.profileKernel=function(v,d,y){var E,B=this,Q=this.backendTimer.time(function(){E=y()});return E.forEach(function(re){re.data().then(function(fe){(function(xe,Oe,Re){if(Oe!=="float32")return!1;for(var Le=0;Le<xe.length;Le++){var Be=xe[Le];if(isNaN(Be)||!isFinite(Be))return console.warn("Found "+Be+" in the result of '"+Re+"'"),!0}})(fe,re.dtype,v),Q.then(function(xe){var Oe="";xe.getExtraProfileInfo!=null&&(Oe=xe.getExtraProfileInfo()),B.logger.logKernelProfile(v,re,fe,xe.kernelMs,d,Oe)})})}),E},_}(),pr=function(){function _(){}return _.prototype.logKernelProfile=function(v,d,y,E,B,Q){var re=typeof E=="number"?nn(E+"ms",9):E.error,fe=nn(v,25),xe=d.rank,Oe=d.size,Re=nn(d.shape.toString(),14),Le="";for(var Be in B){var Xe=B[Be].shape||d.shape,nt=Xe.length;Le+=Be+": "+nt+"D "+(nt>0?Xe:"")+" "}console.log("%c"+fe+"	%c"+re+"	%c"+xe+"D "+Re+"	%c"+Oe+"	%c"+Le+"	%c"+Q,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},_}(),ri=20,Kr=3,ti=7;function jn(_,v,d){return nn(Array.isArray(_)?parseFloat(_[0].toFixed(ti))+" + "+parseFloat(_[1].toFixed(ti))+"j":Pn(_)?"'"+_+"'":d==="bool"?ir(_):parseFloat(_.toFixed(ti)).toString(),v)}function ir(_){return _===0?"false":"true"}function Cr(_){for(var v=[],d=0;d<_.length;d+=2)v.push([_[d],_[d+1]]);return v}var Hr=function(){function _(v,d,y){var E=this;if(this.dtype=d,this.shape=v.slice(),this.size=ze(v),y!=null){var B=y.length;we(B===this.size,function(){return"Length of values '"+B+"' does not match the size inferred by the shape '"+E.size+"'."})}if(d==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=y||cn(d,this.size),this.strides=rn(v)}return _.prototype.set=function(v){for(var d=this,y=[],E=1;E<arguments.length;E++)y[E-1]=arguments[E];y.length===0&&(y=[0]),we(y.length===this.rank,function(){return"The number of provided coordinates ("+y.length+") must match the rank ("+d.rank+")"});var B=this.locToIndex(y);this.values[B]=v},_.prototype.get=function(){for(var v=[],d=0;d<arguments.length;d++)v[d]=arguments[d];v.length===0&&(v=[0]);for(var y=0,E=0,B=v;E<B.length;E++){var Q=B[E];if(Q<0||Q>=this.shape[y]){var re="Requested out of range element at "+v+".   Buffer shape="+this.shape;throw new Error(re)}y++}for(var fe=v[v.length-1],xe=0;xe<v.length-1;++xe)fe+=this.strides[xe]*v[xe];return this.values[fe]},_.prototype.locToIndex=function(v){if(this.rank===0)return 0;if(this.rank===1)return v[0];for(var d=v[v.length-1],y=0;y<v.length-1;++y)d+=this.strides[y]*v[y];return d},_.prototype.indexToLoc=function(v){if(this.rank===0)return[];if(this.rank===1)return[v];for(var d=new Array(this.shape.length),y=0;y<d.length-1;++y)d[y]=Math.floor(v/this.strides[y]),v-=d[y]*this.strides[y];return d[d.length-1]=v,d},Object.defineProperty(_.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),_.prototype.toTensor=function(){return qr().makeTensor(this.values,this.shape,this.dtype)},_}(),qr=null,Ot=null,Fr=null,$t=function(){function _(v,d,y,E){this.kept=!1,this.isDisposedInternal=!1,this.shape=v.slice(),this.dtype=d||"float32",this.size=ze(v),this.strides=rn(v),this.dataId=y,this.id=E,this.rankType=this.rank<5?this.rank.toString():"higher"}return _.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},_.prototype.asScalar=function(){return this.throwIfDisposed(),we(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},_.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},_.prototype.as2D=function(v,d){return this.throwIfDisposed(),this.reshape([v,d])},_.prototype.as3D=function(v,d,y){return this.throwIfDisposed(),this.reshape([v,d,y])},_.prototype.as4D=function(v,d,y,E){return this.throwIfDisposed(),this.reshape([v,d,y,E])},_.prototype.as5D=function(v,d,y,E,B){return this.throwIfDisposed(),this.reshape([v,d,y,E,B])},_.prototype.asType=function(v){return this.throwIfDisposed(),Ot.cast(this,v)},Object.defineProperty(_.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),_.prototype.buffer=function(){return N(this,void 0,void 0,function(){var v;return L(this,function(d){switch(d.label){case 0:return[4,this.data()];case 1:return v=d.sent(),[2,Ot.buffer(this.shape,this.dtype,v)]}})})},_.prototype.bufferSync=function(){return Ot.buffer(this.shape,this.dtype,this.dataSync())},_.prototype.array=function(){return N(this,void 0,void 0,function(){var v;return L(this,function(d){switch(d.label){case 0:return[4,this.data()];case 1:return v=d.sent(),[2,Gn(this.shape,v)]}})})},_.prototype.arraySync=function(){return Gn(this.shape,this.dataSync())},_.prototype.data=function(){return N(this,void 0,void 0,function(){var v,d;return L(this,function(y){switch(y.label){case 0:return this.throwIfDisposed(),v=qr().read(this.dataId),this.dtype!=="string"?[3,2]:[4,v];case 1:d=y.sent();try{return[2,d.map(function(E){return Un(E)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}y.label=2;case 2:return[2,v]}})})},_.prototype.dataSync=function(){this.throwIfDisposed();var v=qr().readSync(this.dataId);if(this.dtype==="string")try{return v.map(function(d){return Un(d)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return v},_.prototype.bytes=function(){return N(this,void 0,void 0,function(){var v;return L(this,function(d){switch(d.label){case 0:return this.throwIfDisposed(),[4,qr().read(this.dataId)];case 1:return v=d.sent(),this.dtype==="string"?[2,v]:[2,new Uint8Array(v.buffer)]}})})},_.prototype.dispose=function(){this.isDisposed||(qr().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(_.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),_.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},_.prototype.toFloat=function(){return this.asType("float32")},_.prototype.toInt=function(){return this.asType("int32")},_.prototype.toBool=function(){return this.asType("bool")},_.prototype.print=function(v){return v===void 0&&(v=!1),Ot.print(this,v)},_.prototype.reshape=function(v){return this.throwIfDisposed(),Ot.reshape(this,v)},_.prototype.reshapeAs=function(v){return this.throwIfDisposed(),this.reshape(v.shape)},_.prototype.expandDims=function(v){return v===void 0&&(v=0),Ot.expandDims(this,v)},_.prototype.cumsum=function(v,d,y){return v===void 0&&(v=0),d===void 0&&(d=!1),y===void 0&&(y=!1),Ot.cumsum(this,v,d,y)},_.prototype.squeeze=function(v){return this.throwIfDisposed(),Ot.squeeze(this,v)},_.prototype.clone=function(){return this.throwIfDisposed(),Ot.clone(this)},_.prototype.oneHot=function(v,d,y){return this.throwIfDisposed(),Ot.oneHot(this,v,d,y)},_.prototype.toString=function(v){return v===void 0&&(v=!1),function(d,y,E,B){var Q=rn(y),re=function(Re,Le,Be,Xe){var nt=ze(Le),tt=Xe[Xe.length-1],ut=new Array(tt).fill(0),Dt=Le.length,Rt=Be==="complex64"?Cr(Re):Re;if(Dt>1)for(var Lt=0;Lt<nt/tt;Lt++)for(var qt=Lt*tt,pn=0;pn<tt;pn++)ut[pn]=Math.max(ut[pn],jn(Rt[qt+pn],0,Be).length);return ut}(d,y,E,Q),fe=y.length,xe=function Re(Le,Be,Xe,nt,tt,ut){ut===void 0&&(ut=!0);var Dt=Xe==="complex64"?2:1,Rt=Be[0],Lt=Be.length;if(Lt===0)return Xe==="complex64"?[jn(Cr(Le)[0],0,Xe)]:Xe==="bool"?[ir(Le[0])]:[Le[0].toString()];if(Lt===1){if(Rt>ri){var qt=Kr*Dt,pn=Array.from(Le.slice(0,qt)),bn=Array.from(Le.slice((Rt-Kr)*Dt,Rt*Dt));return Xe==="complex64"&&(pn=Cr(pn),bn=Cr(bn)),["["+pn.map(function(K,ee){return jn(K,tt[ee],Xe)}).join(", ")+", ..., "+bn.map(function(K,ee){return jn(K,tt[Rt-Kr+ee],Xe)}).join(", ")+"]"]}return["["+(Xe==="complex64"?Cr(Le):Array.from(Le)).map(function(K,ee){return jn(K,tt[ee],Xe)}).join(", ")+"]"]}var mn=Be.slice(1),Sn=nt.slice(1),On=nt[0]*Dt,b=[];if(Rt>ri){for(var h=0;h<Kr;h++){var c=(m=h*On)+On;b.push.apply(b,Re(Le.slice(m,c),mn,Xe,Sn,tt,!1))}for(b.push("..."),h=Rt-Kr;h<Rt;h++)c=(m=h*On)+On,b.push.apply(b,Re(Le.slice(m,c),mn,Xe,Sn,tt,h===Rt-1))}else for(h=0;h<Rt;h++){var m;c=(m=h*On)+On,b.push.apply(b,Re(Le.slice(m,c),mn,Xe,Sn,tt,h===Rt-1))}var w=Lt===2?",":"";for(b[0]="["+b[0]+w,h=1;h<b.length-1;h++)b[h]=" "+b[h]+w;var R=`,
`;for(h=2;h<Lt;h++)R+=`
`;return b[b.length-1]=" "+b[b.length-1]+"]"+(ut?"":R),b}(d,y,E,Q,re),Oe=["Tensor"];return B&&(Oe.push("  dtype: "+E),Oe.push("  rank: "+fe),Oe.push("  shape: ["+y+"]"),Oe.push("  values:")),Oe.push(xe.map(function(Re){return"    "+Re}).join(`
`)),Oe.join(`
`)}(this.dataSync(),this.shape,this.dtype,v)},_.prototype.tile=function(v){return this.throwIfDisposed(),Ot.tile(this,v)},_.prototype.gather=function(v,d){return d===void 0&&(d=0),this.throwIfDisposed(),Ot.gather(this,v,d)},_.prototype.matMul=function(v,d,y){return d===void 0&&(d=!1),y===void 0&&(y=!1),this.throwIfDisposed(),Ot.matMul(this,v,d,y)},_.prototype.dot=function(v){return this.throwIfDisposed(),Ot.dot(this,v)},_.prototype.norm=function(v,d,y){return v===void 0&&(v="euclidean"),d===void 0&&(d=null),y===void 0&&(y=!1),this.throwIfDisposed(),Ot.norm(this,v,d,y)},_.prototype.slice=function(v,d){return this.throwIfDisposed(),Ot.slice(this,v,d)},_.prototype.reverse=function(v){return this.throwIfDisposed(),Ot.reverse(this,v)},_.prototype.concat=function(v,d){return d===void 0&&(d=0),this.throwIfDisposed(),v instanceof _&&(v=[v]),Ot.concat([this].concat(v),d)},_.prototype.split=function(v,d){return d===void 0&&(d=0),this.throwIfDisposed(),Ot.split(this,v,d)},_.prototype.stack=function(v,d){return d===void 0&&(d=0),Ot.stack([this,v],d)},_.prototype.unstack=function(v){return v===void 0&&(v=0),Ot.unstack(this,v)},_.prototype.pad=function(v,d){return d===void 0&&(d=0),Ot.pad(this,v,d)},_.prototype.batchNormalization=function(v,d,y,E,B){return y===void 0&&(y=.001),Fr("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(v,d,B,E,y)},_.prototype.batchNorm=function(v,d,y,E,B){return B===void 0&&(B=.001),this.throwIfDisposed(),Ot.batchNorm(this,v,d,y,E,B)},_.prototype.all=function(v,d){return v===void 0&&(v=null),d===void 0&&(d=!1),this.throwIfDisposed(),Ot.all(this,v,d)},_.prototype.any=function(v,d){return v===void 0&&(v=null),d===void 0&&(d=!1),this.throwIfDisposed(),Ot.any(this,v,d)},_.prototype.logSumExp=function(v,d){return v===void 0&&(v=null),d===void 0&&(d=!1),this.throwIfDisposed(),Ot.logSumExp(this,v,d)},_.prototype.sum=function(v,d){return v===void 0&&(v=null),d===void 0&&(d=!1),this.throwIfDisposed(),Ot.sum(this,v,d)},_.prototype.prod=function(v,d){return v===void 0&&(v=null),d===void 0&&(d=!1),this.throwIfDisposed(),Ot.prod(this,v,d)},_.prototype.mean=function(v,d){return v===void 0&&(v=null),d===void 0&&(d=!1),this.throwIfDisposed(),Ot.mean(this,v,d)},_.prototype.min=function(v,d){return v===void 0&&(v=null),d===void 0&&(d=!1),this.throwIfDisposed(),Ot.min(this,v,d)},_.prototype.max=function(v,d){return v===void 0&&(v=null),d===void 0&&(d=!1),this.throwIfDisposed(),Ot.max(this,v,d)},_.prototype.argMin=function(v){return v===void 0&&(v=null),this.throwIfDisposed(),Ot.argMin(this,v)},_.prototype.argMax=function(v){return v===void 0&&(v=null),this.throwIfDisposed(),Ot.argMax(this,v)},_.prototype.cast=function(v){return this.throwIfDisposed(),Ot.cast(this,v)},_.prototype.add=function(v){return this.throwIfDisposed(),Ot.add(this,v)},_.prototype.addStrict=function(v){return this.throwIfDisposed(),Ot.addStrict(this,v)},_.prototype.atan2=function(v){return this.throwIfDisposed(),Ot.atan2(this,v)},_.prototype.sub=function(v){return this.throwIfDisposed(),Ot.sub(this,v)},_.prototype.subStrict=function(v){return this.throwIfDisposed(),Ot.subStrict(this,v)},_.prototype.pow=function(v){return this.throwIfDisposed(),Ot.pow(this,v)},_.prototype.powStrict=function(v){return this.throwIfDisposed(),Ot.powStrict(this,v)},_.prototype.mul=function(v){return this.throwIfDisposed(),Ot.mul(this,v)},_.prototype.mulStrict=function(v){return this.throwIfDisposed(),Ot.mulStrict(this,v)},_.prototype.div=function(v){return this.throwIfDisposed(),Ot.div(this,v)},_.prototype.divNoNan=function(v){return this.throwIfDisposed(),Ot.divNoNan(this,v)},_.prototype.floorDiv=function(v){return this.throwIfDisposed(),Ot.floorDiv(this,v)},_.prototype.divStrict=function(v){return this.throwIfDisposed(),Ot.divStrict(this,v)},_.prototype.minimum=function(v){return this.throwIfDisposed(),Ot.minimum(this,v)},_.prototype.minimumStrict=function(v){return this.throwIfDisposed(),Ot.minimumStrict(this,v)},_.prototype.maximum=function(v){return this.throwIfDisposed(),Ot.maximum(this,v)},_.prototype.maximumStrict=function(v){return this.throwIfDisposed(),Ot.maximumStrict(this,v)},_.prototype.mod=function(v){return this.throwIfDisposed(),Ot.mod(this,v)},_.prototype.modStrict=function(v){return this.throwIfDisposed(),Ot.modStrict(this,v)},_.prototype.squaredDifferenceStrict=function(v){return this.throwIfDisposed(),Ot.squaredDifferenceStrict(this,v)},_.prototype.transpose=function(v){return this.throwIfDisposed(),Ot.transpose(this,v)},_.prototype.notEqual=function(v){return this.throwIfDisposed(),Ot.notEqual(this,v)},_.prototype.notEqualStrict=function(v){return this.throwIfDisposed(),Ot.notEqualStrict(this,v)},_.prototype.less=function(v){return this.throwIfDisposed(),Ot.less(this,v)},_.prototype.lessStrict=function(v){return this.throwIfDisposed(),Ot.lessStrict(this,v)},_.prototype.equal=function(v){return this.throwIfDisposed(),Ot.equal(this,v)},_.prototype.equalStrict=function(v){return this.throwIfDisposed(),Ot.equalStrict(this,v)},_.prototype.lessEqual=function(v){return this.throwIfDisposed(),Ot.lessEqual(this,v)},_.prototype.lessEqualStrict=function(v){return this.throwIfDisposed(),Ot.lessEqualStrict(this,v)},_.prototype.greater=function(v){return this.throwIfDisposed(),Ot.greater(this,v)},_.prototype.greaterStrict=function(v){return this.throwIfDisposed(),Ot.greaterStrict(this,v)},_.prototype.greaterEqual=function(v){return this.throwIfDisposed(),Ot.greaterEqual(this,v)},_.prototype.greaterEqualStrict=function(v){return this.throwIfDisposed(),Ot.greaterEqualStrict(this,v)},_.prototype.logicalAnd=function(v){return this.throwIfDisposed(),Ot.logicalAnd(this,v)},_.prototype.logicalOr=function(v){return this.throwIfDisposed(),Ot.logicalOr(this,v)},_.prototype.logicalNot=function(){return this.throwIfDisposed(),Ot.logicalNot(this)},_.prototype.logicalXor=function(v){return this.throwIfDisposed(),Ot.logicalXor(this,v)},_.prototype.where=function(v,d){return this.throwIfDisposed(),Ot.where(v,this,d)},_.prototype.neg=function(){return this.throwIfDisposed(),Ot.neg(this)},_.prototype.ceil=function(){return this.throwIfDisposed(),Ot.ceil(this)},_.prototype.floor=function(){return this.throwIfDisposed(),Ot.floor(this)},_.prototype.sign=function(){return this.throwIfDisposed(),Ot.sign(this)},_.prototype.isNaN=function(){return this.throwIfDisposed(),Ot.isNaN(this)},_.prototype.isInf=function(){return this.throwIfDisposed(),Ot.isInf(this)},_.prototype.isFinite=function(){return this.throwIfDisposed(),Ot.isFinite(this)},_.prototype.exp=function(){return this.throwIfDisposed(),Ot.exp(this)},_.prototype.expm1=function(){return this.throwIfDisposed(),Ot.expm1(this)},_.prototype.log=function(){return this.throwIfDisposed(),Ot.log(this)},_.prototype.log1p=function(){return this.throwIfDisposed(),Ot.log1p(this)},_.prototype.sqrt=function(){return this.throwIfDisposed(),Ot.sqrt(this)},_.prototype.rsqrt=function(){return this.throwIfDisposed(),Ot.rsqrt(this)},_.prototype.square=function(){return this.throwIfDisposed(),Ot.square(this)},_.prototype.reciprocal=function(){return this.throwIfDisposed(),Ot.reciprocal(this)},_.prototype.abs=function(){return this.throwIfDisposed(),Ot.abs(this)},_.prototype.clipByValue=function(v,d){return this.throwIfDisposed(),Ot.clipByValue(this,v,d)},_.prototype.relu=function(){return this.throwIfDisposed(),Ot.relu(this)},_.prototype.relu6=function(){return this.throwIfDisposed(),Ot.relu6(this)},_.prototype.elu=function(){return this.throwIfDisposed(),Ot.elu(this)},_.prototype.selu=function(){return this.throwIfDisposed(),Ot.selu(this)},_.prototype.leakyRelu=function(v){return v===void 0&&(v=.2),this.throwIfDisposed(),Ot.leakyRelu(this,v)},_.prototype.prelu=function(v){return this.throwIfDisposed(),Ot.prelu(this,v)},_.prototype.sigmoid=function(){return this.throwIfDisposed(),Ot.sigmoid(this)},_.prototype.logSigmoid=function(){return this.throwIfDisposed(),Ot.logSigmoid(this)},_.prototype.softplus=function(){return this.throwIfDisposed(),Ot.softplus(this)},_.prototype.zerosLike=function(){return this.throwIfDisposed(),Ot.zerosLike(this)},_.prototype.onesLike=function(){return this.throwIfDisposed(),Ot.onesLike(this)},_.prototype.sin=function(){return this.throwIfDisposed(),Ot.sin(this)},_.prototype.cos=function(){return this.throwIfDisposed(),Ot.cos(this)},_.prototype.tan=function(){return this.throwIfDisposed(),Ot.tan(this)},_.prototype.asin=function(){return this.throwIfDisposed(),Ot.asin(this)},_.prototype.acos=function(){return this.throwIfDisposed(),Ot.acos(this)},_.prototype.atan=function(){return this.throwIfDisposed(),Ot.atan(this)},_.prototype.sinh=function(){return this.throwIfDisposed(),Ot.sinh(this)},_.prototype.cosh=function(){return this.throwIfDisposed(),Ot.cosh(this)},_.prototype.tanh=function(){return this.throwIfDisposed(),Ot.tanh(this)},_.prototype.asinh=function(){return this.throwIfDisposed(),Ot.asinh(this)},_.prototype.acosh=function(){return this.throwIfDisposed(),Ot.acosh(this)},_.prototype.atanh=function(){return this.throwIfDisposed(),Ot.atanh(this)},_.prototype.erf=function(){return this.throwIfDisposed(),Ot.erf(this)},_.prototype.round=function(){return this.throwIfDisposed(),Ot.round(this)},_.prototype.step=function(v){return v===void 0&&(v=0),this.throwIfDisposed(),Ot.step(this,v)},_.prototype.softmax=function(v){return v===void 0&&(v=-1),this.throwIfDisposed(),Ot.softmax(this,v)},_.prototype.logSoftmax=function(v){return v===void 0&&(v=-1),this.throwIfDisposed(),Ot.logSoftmax(this,v)},_.prototype.resizeBilinear=function(v,d){return d===void 0&&(d=!1),this.throwIfDisposed(),Ot.image.resizeBilinear(this,v,d)},_.prototype.resizeNearestNeighbor=function(v,d){return d===void 0&&(d=!1),this.throwIfDisposed(),Ot.image.resizeNearestNeighbor(this,v,d)},_.prototype.conv1d=function(v,d,y,E,B,Q){return E===void 0&&(E="NWC"),B===void 0&&(B=1),this.throwIfDisposed(),Ot.conv1d(this,v,d,y,E,B,Q)},_.prototype.conv2d=function(v,d,y,E,B,Q){return E===void 0&&(E="NHWC"),B===void 0&&(B=[1,1]),this.throwIfDisposed(),Ot.conv2d(this,v,d,y,E,B,Q)},_.prototype.conv2dTranspose=function(v,d,y,E,B){return this.throwIfDisposed(),Ot.conv2dTranspose(this,v,d,y,E,B)},_.prototype.depthwiseConv2D=function(v,d,y,E,B,Q){return E===void 0&&(E="NHWC"),B===void 0&&(B=[1,1]),this.throwIfDisposed(),Ot.depthwiseConv2d(this,v,d,y,E,B,Q)},_.prototype.separableConv2d=function(v,d,y,E,B,Q){return B===void 0&&(B=[1,1]),Q===void 0&&(Q="NHWC"),this.throwIfDisposed(),Ot.separableConv2d(this,v,d,y,E,B,Q)},_.prototype.avgPool=function(v,d,y,E){return this.throwIfDisposed(),Ot.avgPool(this,v,d,y,E)},_.prototype.maxPool=function(v,d,y,E){return this.throwIfDisposed(),Ot.maxPool(this,v,d,y,E)},_.prototype.localResponseNormalization=function(v,d,y,E){return v===void 0&&(v=5),d===void 0&&(d=1),y===void 0&&(y=1),E===void 0&&(E=.5),Ot.localResponseNormalization(this,v,d,y,E)},_.prototype.pool=function(v,d,y,E,B){return this.throwIfDisposed(),Ot.pool(this,v,d,y,E,B)},_.prototype.variable=function(v,d,y){return v===void 0&&(v=!0),this.throwIfDisposed(),qr().makeVariable(this,v,d,y)},_.prototype.unsortedSegmentSum=function(v,d){return this.throwIfDisposed(),Ot.unsortedSegmentSum(this,v,d)},_.prototype.batchToSpaceND=function(v,d){return this.throwIfDisposed(),Ot.batchToSpaceND(this,v,d)},_.prototype.spaceToBatchND=function(v,d){return this.throwIfDisposed(),Ot.spaceToBatchND(this,v,d)},_.prototype.topk=function(v,d){return v===void 0&&(v=1),d===void 0&&(d=!0),this.throwIfDisposed(),Ot.topk(this,v,d)},_.prototype.stridedSlice=function(v,d,y,E,B,Q,re,fe){return E===void 0&&(E=0),B===void 0&&(B=0),Q===void 0&&(Q=0),re===void 0&&(re=0),fe===void 0&&(fe=0),this.throwIfDisposed(),Ot.stridedSlice(this,v,d,y,E,B,Q,re,fe)},_.prototype.depthToSpace=function(v,d){return this.throwIfDisposed(),Ot.depthToSpace(this,v,d)},_.prototype.fft=function(){return this.throwIfDisposed(),Ot.spectral.fft(this)},_.prototype.ifft=function(){return this.throwIfDisposed(),Ot.spectral.ifft(this)},_.prototype.rfft=function(){return this.throwIfDisposed(),Ot.spectral.rfft(this)},_.prototype.irfft=function(){return this.throwIfDisposed(),Ot.spectral.irfft(this)},_}();Object.defineProperty($t,Symbol.hasInstance,{value:function(_){return!!_&&_.dataId!=null&&_.shape!=null&&_.dtype!=null}});var Se,me,Ce,Me,rt,kt=function(_){function v(d,y,E,B){var Q=_.call(this,d.shape,d.dtype,d.dataId,B)||this;return Q.trainable=y,Q.name=E,Q}return j(v,_),v.prototype.assign=function(d){if(d.dtype!==this.dtype)throw new Error("dtype of the new value ("+d.dtype+") and previous value ("+this.dtype+") must match");if(!Ut(d.shape,this.shape))throw new Error("shape of the new value ("+d.shape+") and previous value ("+this.shape+") must match");qr().disposeTensor(this),this.dataId=d.dataId,qr().incRef(this,null)},v.prototype.dispose=function(){qr().disposeVariable(this),this.isDisposedInternal=!0},v}($t);Object.defineProperty(kt,Symbol.hasInstance,{value:function(_){return _ instanceof $t&&_.assign!=null&&_.assign instanceof Function}}),function(_){_.R0="R0",_.R1="R1",_.R2="R2",_.R3="R3",_.R4="R4",_.R5="R5",_.R6="R6"}(Se||(Se={})),function(_){_.float32="float32",_.int32="int32",_.bool="int32",_.complex64="complex64"}(me||(me={})),function(_){_.float32="float32",_.int32="int32",_.bool="bool",_.complex64="complex64"}(Ce||(Ce={})),function(_){_.float32="float32",_.int32="float32",_.bool="float32",_.complex64="complex64"}(Me||(Me={})),function(_){_.float32="complex64",_.int32="complex64",_.bool="complex64",_.complex64="complex64"}(rt||(rt={}));var en={float32:Me,int32:me,bool:Ce,complex64:rt};function En(_,v){if(_==="string"||v==="string"){if(_==="string"&&v==="string")return"string";throw new Error("Can not upcast "+_+" with "+v)}return en[_][v]}function Nt(_){return En(_,"int32")}function Kt(_,v){if(_.dtype===v.dtype)return[_,v];var d=En(_.dtype,v.dtype);return[_.cast(d),v.cast(d)]}function hn(_,v){we(_.dtype===v.dtype,function(){return"The dtypes of the first("+_.dtype+") and second("+v.dtype+") input must match"})}function un(_){var v=[];return function d(y,E,B){if(y!=null){if(y instanceof $t)E.push(y);else if(Q=y,Array.isArray(Q)||typeof Q=="object"){var Q,re=y;for(var fe in re){var xe=re[fe];B.has(xe)||(B.add(xe),d(xe,E,B))}}}}(_,v,new Set),v}var mt,Tt=Object.freeze({makeTypesMatch:Kt,assertTypesMatch:hn,isTensorInList:function(_,v){return v.some(function(d){return d.id===_.id})},getTensorsInContainer:un}),fn=function(){function _(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return _.prototype.dispose=function(){for(var v in this.registeredVariables)this.registeredVariables[v].dispose()},_}(),tn=function(){function _(v){this.ENV=v,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new fn}return _.prototype.ready=function(){return N(this,void 0,void 0,function(){var v,d,y;return L(this,function(E){switch(E.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];v=this.getSortedBackends(),d=0,E.label=1;case 1:return d<v.length?(y=v[d],[4,this.initializeBackend(y).success]):[3,5];case 2:return E.sent()?[4,this.setBackend(y)]:[3,4];case 3:return E.sent(),[2];case 4:return d++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(_.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var v=this.initializeBackendsAndReturnBest(),d=v.name;if(v.asyncInit)throw new Error("The highest priority backend '"+d+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(d)}return this.backendInstance},enumerable:!0,configurable:!0}),_.prototype.backendNames=function(){return Object.keys(this.registryFactory)},_.prototype.findBackend=function(v){return!(v in this.registry)&&(!(v in this.registryFactory)||this.initializeBackend(v).asyncInit)?null:this.registry[v]},_.prototype.findBackendFactory=function(v){return v in this.registryFactory?this.registryFactory[v].factory:null},_.prototype.registerBackend=function(v,d,y){return y===void 0&&(y=1),v in this.registryFactory?(console.warn(v+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[v]={factory:d,priority:y},!0)},_.prototype.setBackend=function(v){return N(this,void 0,void 0,function(){var d,y,E;return L(this,function(B){switch(B.label){case 0:if(this.registryFactory[v]==null)throw new Error("Backend name '"+v+"' not found in registry");return this.backendName=v,this.registry[v]!=null?[3,4]:(this.backendInstance=null,d=this.initializeBackend(v),y=d.success,d.asyncInit?[4,y]:[3,2]);case 1:return E=B.sent(),[3,3];case 2:E=y,B.label=3;case 3:if(!E)return[2,!1];B.label=4;case 4:return this.backendInstance=this.registry[v],this.setupRegisteredKernels(),this.profiler=new Mr(this.backendInstance),[2,!0]}})})},_.prototype.setupRegisteredKernels=function(){var v=this;oe(this.backendName).forEach(function(d){d.setupFunc!=null&&d.setupFunc(v.backendInstance)})},_.prototype.disposeRegisteredKernels=function(v){var d=this;oe(v).forEach(function(y){y.disposeFunc!=null&&y.disposeFunc(d.registry[v])})},_.prototype.initializeBackend=function(v){var d=this,y=this.registryFactory[v];if(y==null)throw new Error("Cannot initialize backend "+v+", no registration found.");try{var E=y.factory();if(Promise.resolve(E)===E){var B=++this.pendingBackendInitId,Q=E.then(function(re){return!(B<d.pendingBackendInitId||(d.registry[v]=re,d.pendingBackendInit=null,0))}).catch(function(re){return!(B<d.pendingBackendInitId||(d.pendingBackendInit=null,console.warn("Initialization of backend "+v+" failed"),console.warn(re.stack||re.message),1))});return this.pendingBackendInit=Q,{success:Q,asyncInit:!0}}return this.registry[v]=E,{success:!0,asyncInit:!1}}catch(re){return console.warn("Initialization of backend "+v+" failed"),console.warn(re.stack||re.message),{success:!1,asyncInit:!1}}},_.prototype.removeBackend=function(v){if(!(v in this.registryFactory))throw new Error(v+" backend not found in registry");this.backendName===v&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,v in this.registry&&(this.disposeRegisteredKernels(v),this.registry[v].dispose(),delete this.registry[v]),delete this.registryFactory[v],this.backendName===v&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},_.prototype.getSortedBackends=function(){var v=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(d,y){return v.registryFactory[y].priority-v.registryFactory[d].priority})},_.prototype.initializeBackendsAndReturnBest=function(){for(var v=this.getSortedBackends(),d=0;d<v.length;d++){var y=v[d],E=this.initializeBackend(y),B=E.success,Q=E.asyncInit;if(Q||B)return{name:y,asyncInit:Q}}throw new Error("Could not initialize any backends, all backend initializations failed.")},_.prototype.moveData=function(v,d){var y=this.state.tensorInfo.get(d),E=y.backend,B=this.readSync(d);E.disposeData(d),y.backend=v,v.move(d,B,y.shape,y.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},_.prototype.tidy=function(v,d){var y,E=this,B=null;if(d==null){if(typeof v!="function")throw new Error("Please provide a function to tidy()");d=v}else{if(typeof v!="string"&&!(v instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof d!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");B=v}return this.scopedRun(function(){return E.startScope(B)},function(){return E.endScope(y)},function(){return(y=d())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),y})},_.prototype.scopedRun=function(v,d,y){v();try{var E=y();return d(),E}catch(B){throw d(),B}},_.prototype.nextTensorId=function(){return _.nextTensorId++},_.prototype.nextVariableId=function(){return _.nextVariableId++},_.prototype.clone=function(v){var d=this.makeTensorFromDataId(v.dataId,v.shape,v.dtype),y={x:v};return this.addTapeNode(this.state.activeScope.name,y,[d],function(E){return{x:function(){return E.toFloat()}}},[]),d},_.prototype.runKernel=function(v,d,y,E,B){return this.runKernelFunc(null,d,null,v,y,E,B)},_.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},_.prototype.checkKernelForMemLeak=function(v,d,y){var E=this.backend.numDataIds(),B=0;y.forEach(function(fe){B+=fe.dtype==="complex64"?3:1});var Q=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],re=E-d-B-Q;if(re>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+re+" data ids) after running '"+v+"'")},_.prototype.runKernelFunc=function(v,d,y,E,B,Q,re){var fe,xe=this;Q===void 0&&(Q=[]),re===void 0&&(re=[]);var Oe=[],Re=this.isTapeOn();E==null&&(E=this.state.activeScope!=null?this.state.activeScope.name:"");var Le,Be=function(Dt){Re&&(Oe=Dt.map(function(Rt){return xe.keep(xe.clone(Rt))}))},Xe=this.state.numBytes,nt=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var tt,ut=Y(E,this.backendName);return Le=ut!=null?function(){var Dt=xe.backend.numDataIds();tt=ut.kernelFunc({inputs:d,attrs:B,backend:xe.backend});var Rt=Array.isArray(tt)?tt:[tt];xe.shouldCheckForMemLeaks()&&xe.checkKernelForMemLeak(E,Dt,Rt);var Lt=Rt.map(function(pn){var bn=pn.dataId,mn=pn.shape,Sn=pn.dtype;return xe.makeTensorFromDataId(bn,mn,Sn)}),qt=Lt.filter(function(pn,bn){return re[bn]});return Be((Q||[]).slice().concat(qt)),Lt}:function(){var Dt=xe.backend.numDataIds();tt=xe.tidy(function(){return v(xe.backend,Be)});var Rt=Array.isArray(tt)?tt:[tt];return xe.shouldCheckForMemLeaks()&&xe.checkKernelForMemLeak(E,Dt,Rt),Rt},this.scopedRun(function(){return xe.state.kernelDepth++},function(){return xe.state.kernelDepth--},function(){fe=xe.ENV.getBool("DEBUG")?xe.profiler.profileKernel(E,d,function(){return Le()}):Le()}),Re&&this.addTapeNode(E,d,fe,y,Oe),this.state.profiling&&this.state.activeProfile.kernels.push({name:E,bytesAdded:this.state.numBytes-Xe,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-nt,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(function(Dt){return d[Dt].shape}),outputShapes:fe.map(function(Dt){return Dt.shape})}),Array.isArray(tt)?fe:fe[0]},_.prototype.makeTensor=function(v,d,y,E){if(v==null)throw new Error("Values passed to engine.makeTensor() are null");y=y||"float32",E=E||this.backend;var B=v;y==="string"&&Pn(v[0])&&(B=v.map(function(Oe){return xn(Oe)}));var Q=E.write(B,d,y),re=new $t(d,y,Q,this.nextTensorId());if(this.incRef(re,E),y==="string"){var fe=this.state.tensorInfo.get(Q),xe=Qt(B);this.state.numBytes+=xe-fe.bytes,fe.bytes=xe}return re},_.prototype.makeTensorFromDataId=function(v,d,y,E){var B=new $t(d,y=y||"float32",v,this.nextTensorId());return this.incRef(B,E),B},_.prototype.makeVariable=function(v,d,y,E){d===void 0&&(d=!0),y=y||this.nextVariableId().toString(),E!=null&&E!==v.dtype&&(v=v.asType(E));var B=new kt(v,d,y,this.nextTensorId());if(this.state.registeredVariables[B.name]!=null)throw new Error("Variable with name "+B.name+" was already registered");return this.state.registeredVariables[B.name]=B,this.incRef(B,this.backend),B},_.prototype.incRef=function(v,d){var y=this.state.tensorInfo.has(v.dataId)?this.state.tensorInfo.get(v.dataId).refCount:0;if(this.state.numTensors++,v.dtype==="string"&&this.state.numStringTensors++,y===0){this.state.numDataBuffers++;var E=0;v.dtype!=="complex64"&&v.dtype!=="string"&&(E=v.size*Jt(v.dtype)),this.state.tensorInfo.set(v.dataId,{backend:d||this.backend,dtype:v.dtype,shape:v.shape,bytes:E,refCount:0}),this.state.numBytes+=E}this.state.tensorInfo.get(v.dataId).refCount++,v instanceof kt||this.track(v)},_.prototype.disposeTensor=function(v){if(this.state.tensorInfo.has(v.dataId)){this.state.numTensors--,v.dtype==="string"&&this.state.numStringTensors--;var d=this.state.tensorInfo.get(v.dataId);d.refCount<=1?(v.dtype!=="complex64"&&(this.state.numBytes-=d.bytes),this.state.numDataBuffers--,d.backend.disposeData(v.dataId),this.state.tensorInfo.delete(v.dataId)):this.state.tensorInfo.get(v.dataId).refCount--}},_.prototype.disposeVariables=function(){for(var v in this.state.registeredVariables){var d=this.state.registeredVariables[v];this.disposeVariable(d)}},_.prototype.disposeVariable=function(v){this.disposeTensor(v),this.state.registeredVariables[v.name]!=null&&delete this.state.registeredVariables[v.name]},_.prototype.memory=function(){var v=this.backend.memory();return v.numTensors=this.state.numTensors,v.numDataBuffers=this.state.numDataBuffers,v.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(v.unreliable=!0,v.reasons==null&&(v.reasons=[]),v.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),v},_.prototype.profile=function(v){return N(this,void 0,void 0,function(){var d,y;return L(this,function(E){return this.state.profiling=!0,d=this.state.numBytes,y=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=v(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(B){return B.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-d,this.state.activeProfile.newTensors=this.state.numTensors-y,[2,this.state.activeProfile]})})},_.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},_.prototype.addTapeNode=function(v,d,y,E,B){var Q=this,re={id:this.state.nextTapeNodeId++,kernelName:v,inputs:d,outputs:y,saved:B},fe=G(v);fe!=null&&(E=fe.gradFunc),E!=null&&(re.gradient=function(xe){return xe=xe.map(function(Oe,Re){if(Oe==null){var Le=y[Re],Be=Wt(Le.size,Le.dtype);return Q.makeTensor(Be,Le.shape,Le.dtype)}return Oe}),E(xe.length>1?xe:xe[0],B)}),this.state.activeTape.push(re)},_.prototype.keep=function(v){return v.kept=!0,v},_.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},_.prototype.endTape=function(){this.state.gradientDepth--},_.prototype.startScope=function(v){var d={track:[],name:"unnamed scope",id:this.state.nextScopeId++};v&&(d.name=v),this.state.scopeStack.push(d),this.state.activeScope=d},_.prototype.endScope=function(v){for(var d=this,y=un(v),E=new Set(y.map(function(fe){return fe.id})),B=0;B<this.state.activeScope.track.length;B++){var Q=this.state.activeScope.track[B];Q.kept||E.has(Q.id)||Q.dispose()}var re=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],y.forEach(function(fe){fe.kept||fe.scopeId!==re.id||d.track(fe)})},_.prototype.gradients=function(v,d,y,E){var B=this;if(E===void 0&&(E=!1),we(d.length>0,function(){return"gradients() received an empty list of xs."}),y!=null&&y.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+y.dtype+"'");var Q=this.scopedRun(function(){return B.startTape()},function(){return B.endTape()},function(){return B.tidy("forward",v)});we(Q instanceof $t,function(){return"The result y returned by f() must be a tensor."});var re=function(fe,xe,Oe){for(var Re={},Le={},Be=0;Be<xe.length;Be++)Re[xe[Be].id]=!0;for(Be=0;Be<fe.length;Be++){var Xe=(pn=fe[Be]).inputs;for(var nt in Xe){for(var tt=Xe[nt],ut=!1,Dt=0;Dt<xe.length;Dt++)if(Re[tt.id]){pn.outputs.forEach(function(On){return Re[On.id]=!0}),ut=!0,Le[pn.id]=!0;break}if(ut)break}}var Rt={};Rt[Oe.id]=!0;var Lt={};for(Be=fe.length-1;Be>=0;Be--)for(Xe=(pn=fe[Be]).inputs,Dt=0;Dt<pn.outputs.length;Dt++)if(Rt[pn.outputs[Dt].id]){for(var nt in Xe)Rt[Xe[nt].id]=!0,Lt[pn.id]=!0;break}var qt=[];for(Be=0;Be<fe.length;Be++){var pn;if(Le[(pn=fe[Be]).id]&&Lt[pn.id]){var bn={};for(var nt in pn.inputs){var mn=pn.inputs[nt];Re[mn.id]&&(bn[nt]=mn)}var Sn=Object.assign({},pn);Sn.inputs=bn,Sn.outputs=pn.outputs,qt.push(Sn)}}return qt}(this.state.activeTape,d,Q);if(!E&&re.length===0&&d.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var fe,xe,Oe={};Oe[Q.id]=y??(xe=Xt(ze(fe=Q.shape),"float32"),Ve.makeTensor(xe,fe,"float32")),function(Le,Be,Xe){for(var nt=function(ut){var Dt=Be[ut],Rt=[];if(Dt.outputs.forEach(function(bn){var mn=Le[bn.id];mn!=null?Rt.push(mn):Rt.push(null)}),Dt.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+Dt.kernelName+".");var Lt=Dt.gradient(Rt),qt=function(bn){if(!(bn in Lt))throw new Error("Cannot backprop through input "+bn+". Available gradients found: "+Object.keys(Lt)+".");var mn=Xe(function(){return Lt[bn]()});if(mn.dtype!=="float32")throw new Error("Error in gradient for op "+Dt.kernelName+". The gradient of input "+bn+" must have 'float32' dtype, but has '"+mn.dtype+"'");var Sn=Dt.inputs[bn];if(!Ut(mn.shape,Sn.shape))throw new Error("Error in gradient for op "+Dt.kernelName+". The gradient of input '"+bn+"' has shape '"+mn.shape+"', which does not match the shape of the input '"+Sn.shape+"'");if(Le[Sn.id]==null)Le[Sn.id]=mn;else{var On=Le[Sn.id];Le[Sn.id]=On.add(mn),On.dispose()}};for(var pn in Dt.inputs)qt(pn)},tt=Be.length-1;tt>=0;tt--)nt(tt)}(Oe,re,function(Le){return B.tidy(Le)});var Re=d.map(function(Le){return Oe[Le.id]});return B.state.gradientDepth===0&&(B.state.activeTape.forEach(function(Le){for(var Be=0,Xe=Le.saved;Be<Xe.length;Be++)Xe[Be].dispose()}),B.state.activeTape=null),{value:Q,grads:Re}})},_.prototype.customGrad=function(v){var d=this;return we(ar(v),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var y,E=[],B=0;B<arguments.length;B++)E[B]=arguments[B];we(E.every(function(re){return re instanceof $t}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var Q={};return E.forEach(function(re,fe){Q[fe]=re}),d.runKernelFunc(function(re,fe){return we((y=v.apply(void 0,E.concat([fe]))).value instanceof $t,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),we(ar(y.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),y.value},Q,function(re,fe){var xe=y.gradFunc(re,fe),Oe=Array.isArray(xe)?xe:[xe];we(Oe.length===E.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),we(Oe.every(function(Le){return Le instanceof $t}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var Re={};return Oe.forEach(function(Le,Be){Re[Be]=function(){return Le}}),Re})}},_.prototype.readSync=function(v){return this.state.tensorInfo.get(v).backend.readSync(v)},_.prototype.read=function(v){return this.state.tensorInfo.get(v).backend.read(v)},_.prototype.time=function(v){return N(this,void 0,void 0,function(){var d,y;return L(this,function(E){switch(E.label){case 0:return d=Zt(),[4,this.backend.time(v)];case 1:return(y=E.sent()).wallMs=Zt()-d,[2,y]}})})},_.prototype.track=function(v){return this.state.activeScope!=null&&(v.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(v)),v},Object.defineProperty(_.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),_.prototype.reset=function(){for(var v in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new fn,this.registry)this.disposeRegisteredKernels(v),this.registry[v].dispose(),delete this.registry[v];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},_.nextTensorId=0,_.nextVariableId=0,_}(),Ve=function(){var _=function(){if(mt==null){var d=void 0;if(typeof window<"u")d=window;else if(l!==void 0)d=l;else if(C!==void 0)d=C;else{if(typeof self>"u")throw new Error("Could not find a global object");d=self}mt=d}return mt}();if(_._tfengine==null){var v=new W(_);_._tfengine=new tn(v)}return function(d){q=d}(_._tfengine.ENV),qr=function(){return _._tfengine},_._tfengine}();function Ln(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Xn=z();Xn.registerFlag("DEBUG",function(){return!1},function(_){_&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Xn.registerFlag("IS_BROWSER",function(){return Ln()}),Xn.registerFlag("IS_NODE",function(){return C!==void 0&&C.versions!==void 0&&C.versions.node!==void 0}),Xn.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Xn.registerFlag("PROD",function(){return!1}),Xn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Xn.getBool("DEBUG")}),Xn.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Xn.registerFlag("IS_TEST",function(){return!1});var Zn,cr,Br,Sr={},yi={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function ki(_,v){Sr[_]=v}function Zr(_){_ in Sr||(Sr[_]=function(d){if(d!==1&&d!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var y=function(E){if(typeof OffscreenCanvas<"u"&&E===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(d);return y.addEventListener("webglcontextlost",function(E){E.preventDefault(),delete Sr[d]},!1),d===1?y.getContext("webgl",yi)||y.getContext("experimental-webgl",yi):y.getContext("webgl2",yi)}(_));var v=Sr[_];return v.isContextLost()?(delete Sr[_],Zr(_)):(v.disable(v.DEPTH_TEST),v.disable(v.STENCIL_TEST),v.disable(v.BLEND),v.disable(v.DITHER),v.disable(v.POLYGON_OFFSET_FILL),v.disable(v.SAMPLE_COVERAGE),v.enable(v.SCISSOR_TEST),v.enable(v.CULL_FACE),v.cullFace(v.BACK),Sr[_])}function Zi(_,v){return[v,_]}function gi(_){var v=ze(_);return yt(Math.ceil(v/4))}function ei(_,v){return[Math.max(1,Math.ceil(v/2)),Math.max(1,Math.ceil(_/2))]}function Xr(_,v){var d,y,E,B,Q,re,fe,xe,Oe,Re=_;return z().getNumber("WEBGL_VERSION")===2?(d=Re.R32F,y=Re.R16F,E=Re.RGBA16F,B=Re.RGBA32F,Q=Re.RED,re=4,fe=1,xe=Re.HALF_FLOAT,Oe=Re.FLOAT):(d=_.RGBA,y=_.RGBA,E=_.RGBA,B=Re.RGBA,Q=_.RGBA,re=4,fe=4,xe=v!=null?v.HALF_FLOAT_OES:null,Oe=_.FLOAT),{internalFormatFloat:d,internalFormatHalfFloat:y,internalFormatPackedHalfFloat:E,internalFormatPackedFloat:B,textureFormatFloat:Q,downloadTextureFormat:_.RGBA,downloadUnpackNumChannels:re,defaultNumChannels:fe,textureTypeHalfFloat:xe,textureTypeFloat:Oe}}function Kn(_,v,d){var y=d();return v&&function(E){var B=E.getError();if(B!==E.NO_ERROR)throw new Error("WebGL Error: "+oo(E,B))}(_),y}(function(_){_[_.DENSE=0]="DENSE",_[_.SHARED_BATCH=1]="SHARED_BATCH"})(Zn||(Zn={})),function(_){_[_.RENDER=0]="RENDER",_[_.UPLOAD=1]="UPLOAD",_[_.PIXELS=2]="PIXELS",_[_.DOWNLOAD=3]="DOWNLOAD"}(cr||(cr={})),function(_){_[_.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",_[_.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",_[_.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",_[_.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",_[_.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Br||(Br={}));var di=596e-10,Ei=65504;function zr(_){return!!(z().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||_===0||di<Math.abs(_)&&Math.abs(_)<Ei)}function oo(_,v){switch(v){case _.NO_ERROR:return"NO_ERROR";case _.INVALID_ENUM:return"INVALID_ENUM";case _.INVALID_VALUE:return"INVALID_VALUE";case _.INVALID_OPERATION:return"INVALID_OPERATION";case _.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case _.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case _.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+v}}function zi(_,v,d){return ga(_,v,function(){return _.getExtension(d)},'Extension "'+d+'" not supported on this browser.')}function eo(_,v,d){var y=ga(_,v,function(){return _.createShader(_.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Kn(_,v,function(){return _.shaderSource(y,d)}),Kn(_,v,function(){return _.compileShader(y)}),_.getShaderParameter(y,_.COMPILE_STATUS)===!1)throw console.log(_.getShaderInfoLog(y)),new Error("Failed to compile vertex shader.");return y}function wo(_,v,d){var y=ga(_,v,function(){return _.createShader(_.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Kn(_,v,function(){return _.shaderSource(y,d)}),Kn(_,v,function(){return _.compileShader(y)}),_.getShaderParameter(y,_.COMPILE_STATUS)===!1)throw function(E,B){var Q=xh.exec(B);if(Q==null)return console.log("Couldn't parse line number in error: "+B),void console.log(E);for(var re=+Q[1],fe=E.split(`
`),xe=fe.length.toString().length+2,Oe=fe.map(function(tt,ut){return nn((ut+1).toString(),xe)+tt}),Re=0,Le=0;Le<Oe.length;Le++)Re=Math.max(Oe[Le].length,Re);var Be=Oe.slice(0,re-1),Xe=Oe.slice(re-1,re),nt=Oe.slice(re);console.log(Be.join(`
`)),console.log(B.split(`
`)[0]),console.log("%c "+nn(Xe[0],Re),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(nt.join(`
`))}(d,_.getShaderInfoLog(y)),new Error("Failed to compile fragment shader.");return y}var ba,Ts,xh=/ERROR: [0-9]+:([0-9]+):/g;function to(_,v){return ga(_,v,function(){return _.createProgram()},"Unable to create WebGLProgram.")}function Cc(_,v,d){if(Kn(_,v,function(){return _.linkProgram(d)}),_.getProgramParameter(d,_.LINK_STATUS)===!1)throw console.log(_.getProgramInfoLog(d)),new Error("Failed to link vertex and fragment shaders.")}function Uu(_,v,d){if(Kn(_,v,function(){return _.validateProgram(d)}),_.getProgramParameter(d,_.VALIDATE_STATUS)===!1)throw console.log(_.getProgramInfoLog(d)),new Error("Shader program validation failed.")}function Yc(_,v,d){var y=ga(_,v,function(){return _.createBuffer()},"Unable to create WebGLBuffer");return Kn(_,v,function(){return _.bindBuffer(_.ARRAY_BUFFER,y)}),Kn(_,v,function(){return _.bufferData(_.ARRAY_BUFFER,d,_.STATIC_DRAW)}),y}function sc(_,v,d){var y=ga(_,v,function(){return _.createBuffer()},"Unable to create WebGLBuffer");return Kn(_,v,function(){return _.bindBuffer(_.ELEMENT_ARRAY_BUFFER,y)}),Kn(_,v,function(){return _.bufferData(_.ELEMENT_ARRAY_BUFFER,d,_.STATIC_DRAW)}),y}function Jc(_,v){return ga(_,v,function(){return _.createTexture()},"Unable to create WebGLTexture.")}function Rp(_,v){var d=z().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(_<=0||v<=0){var y="["+_+"x"+v+"]";throw new Error("Requested texture size "+y+" is invalid.")}if(_>d||v>d)throw y="["+_+"x"+v+"]",new Error("Requested texture size "+y+" greater than WebGL maximum on this browser / GPU ["+d+"x"+d+"].")}function ys(_,v){return ga(_,v,function(){return _.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function sd(_,v,d,y,E,B,Q,re){var fe=_.getAttribLocation(d,y);return fe!==-1&&(Kn(_,v,function(){return _.bindBuffer(_.ARRAY_BUFFER,E)}),Kn(_,v,function(){return _.vertexAttribPointer(fe,B,_.FLOAT,!1,Q,re)}),Kn(_,v,function(){return _.enableVertexAttribArray(fe)}),!0)}function Pp(_,v,d,y){Ac(_,y),Kn(_,v,function(){return _.activeTexture(_.TEXTURE0+y)}),Kn(_,v,function(){return _.bindTexture(_.TEXTURE_2D,d)})}function uc(_,v,d,y){return ga(_,v,function(){return _.getUniformLocation(d,y)},'uniform "'+y+'" not present in program.')}function ud(_,v,d){return _.getUniformLocation(v,d)}function wh(_,v,d,y,E,B){Kn(_,v,function(){return Pp(_,v,y,B)}),Kn(_,v,function(){return _.uniform1i(E,B)})}function Qc(_,v,d,y){Kn(_,v,function(){return _.bindFramebuffer(_.FRAMEBUFFER,y)}),Kn(_,v,function(){return _.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,d,0)})}function uf(_,v,d){Kn(_,v,function(){return _.bindFramebuffer(_.FRAMEBUFFER,d)}),Kn(_,v,function(){return _.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,null,0)})}function Ua(_){var v=_.checkFramebufferStatus(_.FRAMEBUFFER);if(v!==_.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Sl(_,v))}function Sl(_,v){switch(v){case _.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case _.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case _.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case _.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+v}}function ga(_,v,d,y){var E=Kn(_,v,function(){return d()});if(E==null)throw new Error(y);return E}function Ac(_,v){var d=_.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,y=v+_.TEXTURE0;if(y<_.TEXTURE0||y>d)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+d+"].")}function bs(_,v){return v===void 0&&(v=2),ze(_.slice(0,_.length-v))}function Fa(_){if(_.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[_.length>1?_[_.length-2]:1,_[_.length-1]]}function Oc(_){var v=[1,1,1];return _.length===0||_.length===1&&_[0]===1||(v=[bs(_)].concat(Fa(_))),v}function cf(_,v){var d;v===void 0&&(v=!1);var y=z().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(v&&(y*=2,(_=_.map(function(xe,Oe){return Oe>=_.length-2?It(_[Oe]):_[Oe]})).length===1&&(_=[2,_[0]])),_.length!==2){var E=Fn(_);_=E.newShape}var B=ze(_);if(_.length<=1&&B<=y)return[1,B];if(_.length===2&&_[0]<=y&&_[1]<=y)return _;if(_.length===3&&_[0]*_[1]<=y&&_[2]<=y)return[_[0]*_[1],_[2]];if(_.length===3&&_[0]<=y&&_[1]*_[2]<=y)return[_[0],_[1]*_[2]];if(_.length===4&&_[0]*_[1]*_[2]<=y&&_[3]<=y)return[_[0]*_[1]*_[2],_[3]];if(_.length===4&&_[0]<=y&&_[1]*_[2]*_[3]<=y)return[_[0],_[1]*_[2]*_[3]];if(v){var Q=bs(_),re=2,fe=2;return _.length&&(re=(d=Fa(_))[0],fe=d[1]),yt(B=Q*(re/2)*(fe/2)).map(function(xe){return 2*xe})}return yt(B)}function Tc(_){return _%2==0}function Mu(_,v){if(Ut(_=_.slice(-2),v=v.slice(-2))||!_.length||!v.length||_[0]===0||_[1]===0||v[0]===0||v[1]===0)return!0;if(_.length!==v.length){var d=_.slice(-1)[0],y=v.slice(-1)[0];if(d===y||Tc(d)&&Tc(y)&&(_[0]===1||v[0]===1))return!0}return _[1]===v[1]&&Tc(_[0])&&Tc(v[0])}function _h(_){if(ba==null){var v=Zr(_);ba=v.getParameter(v.MAX_TEXTURE_SIZE)}return ba}function cd(_){if(Ts==null){var v=Zr(_);Ts=v.getParameter(v.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Ts)}function ld(_){if(_===0)return 0;var v=Zr(_);return xa(v,"EXT_disjoint_timer_query_webgl2")&&_===2?2:xa(v,"EXT_disjoint_timer_query")?1:0}function xa(_,v){return _.getExtension(v)!=null}function Eh(_){try{if(Zr(_)!=null)return!0}catch{return!1}return!1}function Lp(_){if(_===0)return!1;var v=Zr(_);if(_===1){if(!xa(v,"OES_texture_float"))return!1}else if(!xa(v,"EXT_color_buffer_float"))return!1;return dd(v)}function fd(_){if(_===0)return!1;var v=Zr(_);return _!==1?xa(v,"EXT_color_buffer_float")?dd(v):!!xa(v,"EXT_color_buffer_half_float")&&function(d,y){var E=Xr(d,y),B=d.createTexture();d.bindTexture(d.TEXTURE_2D,B),d.texImage2D(d.TEXTURE_2D,0,E.internalFormatHalfFloat,1,1,0,E.textureFormatFloat,E.textureTypeHalfFloat,null);var Q=d.createFramebuffer();d.bindFramebuffer(d.FRAMEBUFFER,Q),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,B,0);var re=d.checkFramebufferStatus(d.FRAMEBUFFER)===d.FRAMEBUFFER_COMPLETE;return d.bindTexture(d.TEXTURE_2D,null),d.bindFramebuffer(d.FRAMEBUFFER,null),d.deleteTexture(B),d.deleteFramebuffer(Q),re}(v,v.getExtension("EXT_color_buffer_half_float")):!!xa(v,"OES_texture_float")&&!!xa(v,"WEBGL_color_buffer_float")&&dd(v)}function dd(_){var v=Xr(_),d=_.createTexture();_.bindTexture(_.TEXTURE_2D,d),_.texImage2D(_.TEXTURE_2D,0,v.internalFormatFloat,1,1,0,v.textureFormatFloat,v.textureTypeFloat,null);var y=_.createFramebuffer();_.bindFramebuffer(_.FRAMEBUFFER,y),_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,d,0);var E=_.checkFramebufferStatus(_.FRAMEBUFFER)===_.FRAMEBUFFER_COMPLETE;return _.bindTexture(_.TEXTURE_2D,null),_.bindFramebuffer(_.FRAMEBUFFER,null),_.deleteTexture(d),_.deleteFramebuffer(y),E}function Ms(_){return _===2&&Zr(_).fenceSync!=null}var hd=Object.freeze({callAndCheck:Kn,canBeRepresented:zr,getWebGLErrorMessage:oo,getExtensionOrThrow:zi,createVertexShader:eo,createFragmentShader:wo,createProgram:to,linkProgram:Cc,validateProgram:Uu,createStaticVertexBuffer:Yc,createStaticIndexBuffer:sc,getNumChannels:function(){return z().getNumber("WEBGL_VERSION")===2?1:4},createTexture:Jc,validateTextureSize:Rp,createFramebuffer:ys,bindVertexBufferToProgramAttribute:sd,bindTextureUnit:Pp,unbindTextureUnit:function(_,v,d){Ac(_,d),Kn(_,v,function(){return _.activeTexture(_.TEXTURE0+d)}),Kn(_,v,function(){return _.bindTexture(_.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:uc,getProgramUniformLocation:ud,bindTextureToProgramUniformSampler:wh,bindCanvasToFramebuffer:function(_,v){Kn(_,v,function(){return _.bindFramebuffer(_.FRAMEBUFFER,null)}),Kn(_,v,function(){return _.viewport(0,0,_.canvas.width,_.canvas.height)}),Kn(_,v,function(){return _.scissor(0,0,_.canvas.width,_.canvas.height)})},bindColorTextureToFramebuffer:Qc,unbindColorTextureFromFramebuffer:uf,validateFramebuffer:Ua,getFramebufferErrorMessage:Sl,getBatchDim:bs,getRowsCols:Fa,getShapeAs3D:Oc,getTextureShapeFromLogicalShape:cf,isReshapeFree:Mu,getWebGLMaxTextureSize:_h,resetMaxTextureSize:function(){ba=null},resetMaxTexturesInShader:function(){Ts=null},getMaxTexturesInShader:cd,getWebGLDisjointQueryTimerVersion:ld,hasExtension:xa,isWebGLVersionEnabled:Eh,isCapableOfRenderingToFloatTexture:Lp,isDownloadFloatTextureEnabled:fd,isWebGLFenceEnabled:Ms}),yr=z();function Wu(){z().set("PROD",!0)}function $m(){z().set("DEBUG",!0)}function Xm(){z().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function pd(_){z().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(_+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function lf(){Ve.disposeVariables()}function Bp(){return Ve}function Sh(){return Ve.memory()}function kh(_){return Ve.profile(_)}function Hi(_,v){return Ve.tidy(_,v)}function Lo(_){un(_).forEach(function(v){return v.dispose()})}function Ch(_){return Ve.keep(_)}function Gg(_){return Ve.time(_)}function md(_){return Ve.setBackend(_)}function jp(){return Ve.ready()}function Ds(){return Ve.backendName}function Mc(_){Ve.removeBackend(_)}function zp(_){return Ve.findBackend(_)}function Km(_){return Ve.findBackendFactory(_)}function Ym(_,v,d){return d===void 0&&(d=1),Ve.registerBackend(_,v,d)}function qg(){return Ve.backend}function $g(_,v){z().setPlatform(_,v)}function kl(){for(var _=[],v=0;v<arguments.length;v++)_[v]=arguments[v];z().getBool("IS_TEST")||console.warn.apply(console,_)}function Ka(_,v){var d=_;if(ft(_))return v==="string"?[]:[_.length];if(!Array.isArray(_))return[];for(var y=[];Array.isArray(d)||ft(d)&&v!=="string";)y.push(d.length),d=d[0];return Array.isArray(_)&&z().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function E(B,Q,re){if(re=re||[],Array.isArray(B)||ft(B)){we(Q.length>0,function(){return"Element arr["+re.join("][")+"] should be a primitive, but is an array of "+B.length+" elements"}),we(B.length===Q[0],function(){return"Element arr["+re.join("][")+"] should have "+Q[0]+" elements, but has "+B.length+" elements"});for(var fe=Q.slice(1),xe=0;xe<B.length;++xe)E(B[xe],fe,re.concat(xe))}else we(Q.length===0,function(){return"Element arr["+re.join("][")+"] is a primitive, but should be an array/TypedArray of "+Q[0]+" elements"})}(_,y,[]),y}function Ah(_,v,d,y){if(_!=null&&(_!=="numeric"&&_!==v||_==="numeric"&&v==="string"))throw new Error("Argument '"+d+"' passed to '"+y+"' must be "+_+" tensor, but got "+v+" tensor")}function Ze(_,v,d,y){if(y===void 0&&(y="numeric"),_ instanceof $t)return Ah(y,_.dtype,v,d),_;var E=ke(_);if(E!=="string"&&["bool","int32","float32"].indexOf(y)>=0&&(E=y),Ah(y,E,v,d),_==null||!ft(_)&&!Array.isArray(_)&&typeof _!="number"&&typeof _!="boolean"&&typeof _!="string"){var B=_==null?"null":_.constructor.name;throw new Error("Argument '"+v+"' passed to '"+d+"' must be a Tensor or TensorLike, but got '"+B+"'")}var Q=Ka(_,E);ft(_)||Array.isArray(_)||(_=[_]);var re=E!=="string"?Ht(_,E,z().getBool("DEBUG")):Mt(_,[],!0);return Ve.makeTensor(re,Q,E)}function cc(_,v,d,y){if(y===void 0&&(y="numeric"),!Array.isArray(_))throw new Error("Argument "+v+" passed to "+d+" must be a `Tensor[]` or `TensorLike[]`");return _.map(function(E,B){return Ze(E,v+"["+B+"]",d)},y)}function gd(_,v){for(var d=0;d<_.length;++d)if(_[_.length-d-1]!==v-1-d)return!1;return!0}function Up(_,v,d){for(var y=_.length+v.length,E=[],B=0,Q=0,re=0;re<y;re++)d.indexOf(re)===-1?E.push(_[B++]):E.push(v[Q++]);return E}function Io(_,v){for(var d=[],y=_.length,E=0;E<y;E++)v.indexOf(E)===-1&&d.push(_[E]);return[d,v.map(function(B){return _[B]})]}function Fo(_,v){return Up(_,v.map(function(d){return 1}),v)}function ta(_,v,d){we(gd(v,d),function(){return _+" supports only inner-most axes for now. Got axes "+v+" and rank-"+d+" input."})}function Ra(_,v){if(gd(_,v))return null;for(var d=[],y=0;y<v;++y)_.indexOf(y)===-1&&d.push(y);return _.forEach(function(E){return d.push(E)}),d}function Vu(_){return _.map(function(v,d){return[d,v]}).sort(function(v,d){return v[1]-d[1]}).map(function(v){return v[0]})}function Pa(_,v){for(var d=[],y=v-_;y<v;++y)d.push(y);return d}function Zc(_,v){var d=_[0].length;_.forEach(function(E,B){we(E.length===d,function(){return"Error in concat"+d+"D: rank of tensors["+B+"] must be the same as the rank of the rest ("+d+")"})}),we(v>=0&&v<d,function(){return"Error in concat"+d+"D: axis must be between 0 and "+(d-1)+"."});var y=_[0];_.forEach(function(E,B){for(var Q=0;Q<d;Q++)we(Q===v||E[Q]===y[Q],function(){return"Error in concat"+d+"D: Shape of tensors["+B+"] ("+E+") does not match the shape of the rest ("+y+") along the non-concatenated axis "+B+"."})})}function bu(_,v){for(var d=_[0].slice(),y=1;y<_.length;y++)d[v]+=_[y][v];return d}function Pt(_){var v=Object.keys(_);if(v.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+v.length+" keys.");var d=v[0],y=_[d];d.endsWith("_")&&(d=d.substring(0,d.length-1));var E=function(){for(var B=[],Q=0;Q<arguments.length;Q++)B[Q]=arguments[Q];Ve.startScope(d);try{var re=y.apply(void 0,B);return re instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Ve.endScope(re),re}catch(fe){throw Ve.endScope(null),fe}};return Object.defineProperty(E,"name",{value:d,configurable:!0}),E}yr.registerFlag("HAS_WEBGL",function(){return yr.getNumber("WEBGL_VERSION")>0}),yr.registerFlag("WEBGL_VERSION",function(){return Eh(2)?2:Eh(1)?1:0}),yr.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return yr.get("WEBGL_VERSION")===2}),yr.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),yr.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),yr.registerFlag("WEBGL_PACK",function(){return yr.getBool("HAS_WEBGL")}),yr.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return yr.getBool("WEBGL_PACK")}),yr.registerFlag("WEBGL_PACK_CLIP",function(){return yr.getBool("WEBGL_PACK")}),yr.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),yr.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return yr.getBool("WEBGL_PACK")}),yr.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return yr.getBool("WEBGL_PACK")}),yr.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return yr.getBool("WEBGL_PACK")}),yr.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return yr.getBool("WEBGL_PACK")}),yr.registerFlag("WEBGL_PACK_REDUCE",function(){return yr.getBool("WEBGL_PACK")}),yr.registerFlag("WEBGL_LAZILY_UNPACK",function(){return yr.getBool("WEBGL_PACK")}),yr.registerFlag("WEBGL_CONV_IM2COL",function(){return yr.getBool("WEBGL_PACK")}),yr.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return _h(yr.getNumber("WEBGL_VERSION"))}),yr.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return cd(yr.getNumber("WEBGL_VERSION"))}),yr.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var _=yr.getNumber("WEBGL_VERSION");return _===0?0:ld(_)}),yr.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return yr.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(_=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(_)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(_.substr(0,4))));var _}),yr.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return Lp(yr.getNumber("WEBGL_VERSION"))}),yr.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!yr.getBool("WEBGL_FORCE_F16_TEXTURES")&&yr.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),yr.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return fd(yr.getNumber("WEBGL_VERSION"))}),yr.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return Ms(yr.getNumber("WEBGL_VERSION"))}),yr.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return yr.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),Fr=pd;var _o=Pt({complex_:function(_,v){var d=Ze(_,"real","complex"),y=Ze(v,"imag","complex");return bt(d.shape,y.shape,"real and imag shapes, "+d.shape+" and "+y.shape+", must match in call to tf.complex()."),Ve.runKernelFunc(function(E){return E.complex(d,y)},{$real:d,$imag:y})}}),va=Pt({real_:function(_){var v=Ze(_,"input","real");return Ve.runKernelFunc(function(d){return d.real(v)},{$input:v})}}),Ya=Pt({imag_:function(_){var v=Ze(_,"input","imag");return Ve.runKernelFunc(function(d){return d.imag(v)},{$input:v})}});function To(_,v,d){return Ns(_,v,Ka(_,d),d)}function Ns(_,v,d,y){if(y==null&&(y=ke(_)),y==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!ft(_)&&!Array.isArray(_)&&typeof _!="number"&&typeof _!="boolean"&&typeof _!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(v!=null){Vn(v);var E=ze(v),B=ze(d);we(E===B,function(){return"Based on the provided shape, ["+v+"], the tensor should have "+E+" values but has "+B});for(var Q=0;Q<d.length;++Q){var re=d[Q],fe=Q!==d.length-1||re!==ze(v.slice(Q));we(d[Q]===v[Q]||!fe,function(){return"Error creating a new Tensor. Inferred shape ("+d+") does not match the provided shape ("+v+"). "})}}return ft(_)||Array.isArray(_)||(_=[_]),v=v||d,_=y!=="string"?Ht(_,y,z().getBool("DEBUG")):Mt(_,[],!0),Ve.makeTensor(_,v,y)}function kr(_,v){if((ft(_)&&v!=="string"||Array.isArray(_))&&v!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(v==="string"&&ft(_)&&!(_ instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Ns(_,[],[],v)}function ru(_,v){jt(_);var d=Ka(_,v);if(d.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Ns(_,null,d,v)}function xu(_,v,d){if(jt(_),v!=null&&v.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var y=Ka(_,d);if(y.length!==2&&y.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(y.length===1&&v==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Ns(_,v,y,d)}function Cl(_,v,d){if(jt(_),v!=null&&v.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var y=Ka(_,d);if(y.length!==3&&y.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(y.length===1&&v==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Ns(_,v,y,d)}function iu(_,v,d){if(jt(_),v!=null&&v.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var y=Ka(_,d);if(y.length!==4&&y.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(y.length===1&&v==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Ns(_,v,y,d)}function Oh(_,v,d){if(jt(_),v!=null&&v.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var y=Ka(_,d);if(y.length!==5&&y.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(y.length===1&&v==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Ns(_,v,y,d)}function Wp(_,v,d){if(jt(_),v!=null&&v.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var y=Ka(_,d);if(y.length!==6&&y.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(y.length===1&&v==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Ns(_,v=v||y,y,d)}function Vp(_,v,d,y){return v===void 0&&(v=!0),Ve.makeVariable(_,v,d,y)}function Du(_,v){if(v===void 0&&(v="float32"),v==="complex64"){var d=Du(_,"float32"),y=ao(_,"float32");return _o(d,y)}var E=Xt(ze(_),v);return Ve.makeTensor(E,_,v)}function ao(_,v){if(v===void 0&&(v="float32"),v==="complex64"){var d=ao(_,"float32"),y=ao(_,"float32");return _o(d,y)}var E=Wt(ze(_),v);return Ve.makeTensor(E,_,v)}function Is(_,v,d){return Ve.runKernelFunc(function(y){return y.fill(_,v,d)},{})}function Th(_,v,d){if(d<=0)throw new Error("The number of values should be positive.");return Ve.runKernelFunc(function(y){return y.linspace(_,v,d)},{})}function Dc(_,v,d,y){if(d===void 0&&(d=1),y===void 0&&(y="float32"),d===0)throw new Error("Cannot have a step of zero");if(_===v||_<v&&d<0||v<_&&d>1)return ao([0],y);var E=Wt(Math.abs(Math.ceil((v-_)/d)),y);v<_&&d===1&&(d=-1),E[0]=_;for(var B=1;B<E.length;B++)E[B]=E[B-1]+d;return ru(E,y)}var xs=Pt({onesLike_:function(_){var v=Ze(_,"x","onesLike");if(v.dtype==="complex64"){var d=xs(va(v)),y=mi(Ya(v));return _o(d,y)}return Ve.runKernelFunc(function(E){return E.onesLike(v)},{$x:v},function(E,B){return{$x:function(){return mi(E)}}})}}),mi=Pt({zerosLike_:function(_){var v=Ze(_,"x","zerosLike");return Ve.runKernelFunc(function(d){return d.zerosLike(v)},{$x:v},function(d,y){return{$x:function(){return mi(d)}}})}}),Ho=Pt({concat_:function(_,v){v===void 0&&(v=0),we(_.length>=1,function(){return"Pass at least one tensor to concat"});var d=cc(_,"tensors","concat");d[0].dtype==="complex64"&&d.forEach(function(re){if(re.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+re.dtype+". ")}),v=Yt(v,d[0].shape)[0];var y=bu(d.map(function(re){return re.shape}),v);if(ze(y)===0)return To([],y);if((d=d.filter(function(re){return re.size>0})).length===1)return d[0];var E=d.map(function(re){return re.shape});Zc(E,v);var B=d,Q={axis:v};return Ve.runKernelFunc(function(re){return re.concat(d,v)},B,function(re){var fe=E.map(function(xe){return xe[v]});return Gi(re,fe,v).map(function(xe){return function(){return xe}})},"Concat",Q)}}),Mh=Pt({concat1d_:function(_){return Ho(_,0)}}),Hp=Pt({concat2d_:function(_,v){return Ho(_,v)}}),ff=Pt({concat3d_:function(_,v){return Ho(_,v)}}),Dh=Pt({concat4d_:function(_,v){return Ho(_,v)}}),Gi=Pt({split_:function(_,v,d){d===void 0&&(d=0);var y,E=Ze(_,"x","split");return d=Yt(d,E.shape)[0],typeof v=="number"?(we(E.shape[d]%v==0,function(){return"Number of splits must evenly divide the axis."}),y=new Array(v).fill(E.shape[d]/v)):(we(E.shape[d]===v.reduce(function(B,Q){return B+Q}),function(){return"The sum of sizes must match the size of the axis dimension."}),y=v),Ve.runKernelFunc(function(B){return B.split(E,y,d)},{$x:E},function(B){return{$x:function(){return Ho(B,d)}}})}});function Di(_,v){return _(v={exports:{}},v.exports),v.exports}var da=Di(function(_){(function(v,d,y){function E(Q,re){return re.c=Q.c,re.s0=Q.s0,re.s1=Q.s1,re.s2=Q.s2,re}function B(Q,re){var fe=new function(Re){var Le,Be=this,Xe=(Le=4022871197,function(nt){nt=nt.toString();for(var tt=0;tt<nt.length;tt++){var ut=.02519603282416938*(Le+=nt.charCodeAt(tt));ut-=Le=ut>>>0,Le=(ut*=Le)>>>0,Le+=4294967296*(ut-=Le)}return 23283064365386963e-26*(Le>>>0)});Be.next=function(){var nt=2091639*Be.s0+23283064365386963e-26*Be.c;return Be.s0=Be.s1,Be.s1=Be.s2,Be.s2=nt-(Be.c=0|nt)},Be.c=1,Be.s0=Xe(" "),Be.s1=Xe(" "),Be.s2=Xe(" "),Be.s0-=Xe(Re),Be.s0<0&&(Be.s0+=1),Be.s1-=Xe(Re),Be.s1<0&&(Be.s1+=1),Be.s2-=Xe(Re),Be.s2<0&&(Be.s2+=1),Xe=null}(Q),xe=re&&re.state,Oe=fe.next;return Oe.int32=function(){return 4294967296*fe.next()|0},Oe.double=function(){return Oe()+11102230246251565e-32*(2097152*Oe()|0)},Oe.quick=Oe,xe&&(typeof xe=="object"&&E(xe,fe),Oe.state=function(){return E(fe,{})}),Oe}d&&d.exports?d.exports=B:this.alea=B})(0,_)}),Gp=Di(function(_){(function(v,d,y){function E(Q,re){return re.x=Q.x,re.y=Q.y,re.z=Q.z,re.w=Q.w,re}function B(Q,re){var fe=new function(Re){var Le=this,Be="";Le.x=0,Le.y=0,Le.z=0,Le.w=0,Le.next=function(){var nt=Le.x^Le.x<<11;return Le.x=Le.y,Le.y=Le.z,Le.z=Le.w,Le.w^=Le.w>>>19^nt^nt>>>8},Re===(0|Re)?Le.x=Re:Be+=Re;for(var Xe=0;Xe<Be.length+64;Xe++)Le.x^=0|Be.charCodeAt(Xe),Le.next()}(Q),xe=re&&re.state,Oe=function(){return(fe.next()>>>0)/4294967296};return Oe.double=function(){do var Re=((fe.next()>>>11)+(fe.next()>>>0)/4294967296)/2097152;while(Re===0);return Re},Oe.int32=fe.next,Oe.quick=Oe,xe&&(typeof xe=="object"&&E(xe,fe),Oe.state=function(){return E(fe,{})}),Oe}d&&d.exports?d.exports=B:this.xor128=B})(0,_)}),qp=Di(function(_){(function(v,d,y){function E(Q,re){return re.x=Q.x,re.y=Q.y,re.z=Q.z,re.w=Q.w,re.v=Q.v,re.d=Q.d,re}function B(Q,re){var fe=new function(Re){var Le=this,Be="";Le.next=function(){var nt=Le.x^Le.x>>>2;return Le.x=Le.y,Le.y=Le.z,Le.z=Le.w,Le.w=Le.v,(Le.d=Le.d+362437|0)+(Le.v=Le.v^Le.v<<4^nt^nt<<1)|0},Le.x=0,Le.y=0,Le.z=0,Le.w=0,Le.v=0,Re===(0|Re)?Le.x=Re:Be+=Re;for(var Xe=0;Xe<Be.length+64;Xe++)Le.x^=0|Be.charCodeAt(Xe),Xe==Be.length&&(Le.d=Le.x<<10^Le.x>>>4),Le.next()}(Q),xe=re&&re.state,Oe=function(){return(fe.next()>>>0)/4294967296};return Oe.double=function(){do var Re=((fe.next()>>>11)+(fe.next()>>>0)/4294967296)/2097152;while(Re===0);return Re},Oe.int32=fe.next,Oe.quick=Oe,xe&&(typeof xe=="object"&&E(xe,fe),Oe.state=function(){return E(fe,{})}),Oe}d&&d.exports?d.exports=B:this.xorwow=B})(0,_)}),$p=Di(function(_){(function(v,d,y){function E(Q,re){return re.x=Q.x.slice(),re.i=Q.i,re}function B(Q,re){Q==null&&(Q=+new Date);var fe=new function(Re){var Le=this;Le.next=function(){var Be,Xe,nt=Le.x,tt=Le.i;return Be=nt[tt],Xe=(Be^=Be>>>7)^Be<<24,Xe^=(Be=nt[tt+1&7])^Be>>>10,Xe^=(Be=nt[tt+3&7])^Be>>>3,Xe^=(Be=nt[tt+4&7])^Be<<7,Be=nt[tt+7&7],Xe^=(Be^=Be<<13)^Be<<9,nt[tt]=Xe,Le.i=tt+1&7,Xe},function(Be,Xe){var nt,tt=[];if(Xe===(0|Xe))tt[0]=Xe;else for(Xe=""+Xe,nt=0;nt<Xe.length;++nt)tt[7&nt]=tt[7&nt]<<15^Xe.charCodeAt(nt)+tt[nt+1&7]<<13;for(;tt.length<8;)tt.push(0);for(nt=0;nt<8&&tt[nt]===0;++nt);for(nt==8?tt[7]=-1:tt[nt],Be.x=tt,Be.i=0,nt=256;nt>0;--nt)Be.next()}(Le,Re)}(Q),xe=re&&re.state,Oe=function(){return(fe.next()>>>0)/4294967296};return Oe.double=function(){do var Re=((fe.next()>>>11)+(fe.next()>>>0)/4294967296)/2097152;while(Re===0);return Re},Oe.int32=fe.next,Oe.quick=Oe,xe&&(xe.x&&E(xe,fe),Oe.state=function(){return E(fe,{})}),Oe}d&&d.exports?d.exports=B:this.xorshift7=B})(0,_)}),Jm=Di(function(_){(function(v,d,y){function E(Q,re){return re.i=Q.i,re.w=Q.w,re.X=Q.X.slice(),re}function B(Q,re){Q==null&&(Q=+new Date);var fe=new function(Re){var Le=this;Le.next=function(){var Be,Xe,nt=Le.w,tt=Le.X,ut=Le.i;return Le.w=nt=nt+1640531527|0,Xe=tt[ut+34&127],Be=tt[ut=ut+1&127],Xe^=Xe<<13,Be^=Be<<17,Xe^=Xe>>>15,Be^=Be>>>12,Xe=tt[ut]=Xe^Be,Le.i=ut,Xe+(nt^nt>>>16)|0},function(Be,Xe){var nt,tt,ut,Dt,Rt,Lt=[],qt=128;for(Xe===(0|Xe)?(tt=Xe,Xe=null):(Xe+="\0",tt=0,qt=Math.max(qt,Xe.length)),ut=0,Dt=-32;Dt<qt;++Dt)Xe&&(tt^=Xe.charCodeAt((Dt+32)%Xe.length)),Dt===0&&(Rt=tt),tt^=tt<<10,tt^=tt>>>15,tt^=tt<<4,tt^=tt>>>13,Dt>=0&&(Rt=Rt+1640531527|0,ut=(nt=Lt[127&Dt]^=tt+Rt)==0?ut+1:0);for(ut>=128&&(Lt[127&(Xe&&Xe.length||0)]=-1),ut=127,Dt=512;Dt>0;--Dt)tt=Lt[ut+34&127],nt=Lt[ut=ut+1&127],tt^=tt<<13,nt^=nt<<17,tt^=tt>>>15,nt^=nt>>>12,Lt[ut]=tt^nt;Be.w=Rt,Be.X=Lt,Be.i=ut}(Le,Re)}(Q),xe=re&&re.state,Oe=function(){return(fe.next()>>>0)/4294967296};return Oe.double=function(){do var Re=((fe.next()>>>11)+(fe.next()>>>0)/4294967296)/2097152;while(Re===0);return Re},Oe.int32=fe.next,Oe.quick=Oe,xe&&(xe.X&&E(xe,fe),Oe.state=function(){return E(fe,{})}),Oe}d&&d.exports?d.exports=B:this.xor4096=B})(0,_)}),lc=Di(function(_){(function(v,d,y){function E(Q,re){return re.a=Q.a,re.b=Q.b,re.c=Q.c,re.d=Q.d,re}function B(Q,re){var fe=new function(Re){var Le=this,Be="";Le.next=function(){var nt=Le.b,tt=Le.c,ut=Le.d,Dt=Le.a;return nt=nt<<25^nt>>>7^tt,tt=tt-ut|0,ut=ut<<24^ut>>>8^Dt,Dt=Dt-nt|0,Le.b=nt=nt<<20^nt>>>12^tt,Le.c=tt=tt-ut|0,Le.d=ut<<16^tt>>>16^Dt,Le.a=Dt-nt|0},Le.a=0,Le.b=0,Le.c=-1640531527,Le.d=1367130551,Re===Math.floor(Re)?(Le.a=Re/4294967296|0,Le.b=0|Re):Be+=Re;for(var Xe=0;Xe<Be.length+20;Xe++)Le.b^=0|Be.charCodeAt(Xe),Le.next()}(Q),xe=re&&re.state,Oe=function(){return(fe.next()>>>0)/4294967296};return Oe.double=function(){do var Re=((fe.next()>>>11)+(fe.next()>>>0)/4294967296)/2097152;while(Re===0);return Re},Oe.int32=fe.next,Oe.quick=Oe,xe&&(typeof xe=="object"&&E(xe,fe),Oe.state=function(){return E(fe,{})}),Oe}d&&d.exports?d.exports=B:this.tychei=B})(0,_)}),Fs=Di(function(_){(function(v,d){var y,E=this,B=256,Q=6,re="random",fe=d.pow(B,Q),xe=d.pow(2,52),Oe=2*xe,Re=B-1;function Le(ut,Dt,Rt){var Lt=[],qt=nt(function mn(Sn,On){var b,h=[],c=typeof Sn;if(On&&c=="object")for(b in Sn)try{h.push(mn(Sn[b],On-1))}catch{}return h.length?h:c=="string"?Sn:Sn+"\0"}((Dt=Dt==1?{entropy:!0}:Dt||{}).entropy?[ut,tt(v)]:ut??function(){try{var mn;return y&&(mn=y.randomBytes)?mn=mn(B):(mn=new Uint8Array(B),(E.crypto||E.msCrypto).getRandomValues(mn)),tt(mn)}catch{var Sn=E.navigator,On=Sn&&Sn.plugins;return[+new Date,E,On,E.screen,tt(v)]}}(),3),Lt),pn=new Be(Lt),bn=function(){for(var mn=pn.g(Q),Sn=fe,On=0;mn<xe;)mn=(mn+On)*B,Sn*=B,On=pn.g(1);for(;mn>=Oe;)mn/=2,Sn/=2,On>>>=1;return(mn+On)/Sn};return bn.int32=function(){return 0|pn.g(4)},bn.quick=function(){return pn.g(4)/4294967296},bn.double=bn,nt(tt(pn.S),v),(Dt.pass||Rt||function(mn,Sn,On,b){return b&&(b.S&&Xe(b,pn),mn.state=function(){return Xe(pn,{})}),On?(d[re]=mn,Sn):mn})(bn,qt,"global"in Dt?Dt.global:this==d,Dt.state)}function Be(ut){var Dt,Rt=ut.length,Lt=this,qt=0,pn=Lt.i=Lt.j=0,bn=Lt.S=[];for(Rt||(ut=[Rt++]);qt<B;)bn[qt]=qt++;for(qt=0;qt<B;qt++)bn[qt]=bn[pn=Re&pn+ut[qt%Rt]+(Dt=bn[qt])],bn[pn]=Dt;(Lt.g=function(mn){for(var Sn,On=0,b=Lt.i,h=Lt.j,c=Lt.S;mn--;)Sn=c[b=Re&b+1],On=On*B+c[Re&(c[b]=c[h=Re&h+Sn])+(c[h]=Sn)];return Lt.i=b,Lt.j=h,On})(B)}function Xe(ut,Dt){return Dt.i=ut.i,Dt.j=ut.j,Dt.S=ut.S.slice(),Dt}function nt(ut,Dt){for(var Rt,Lt=ut+"",qt=0;qt<Lt.length;)Dt[Re&qt]=Re&(Rt^=19*Dt[Re&qt])+Lt.charCodeAt(qt++);return tt(Dt)}function tt(ut){return String.fromCharCode.apply(0,ut)}if(d["seed"+re]=Le,nt(d.random(),v),_.exports){_.exports=Le;try{y=r(251)}catch{}}})([],Math)});Fs.alea=da,Fs.xor128=Gp,Fs.xorwow=qp,Fs.xorshift7=$p,Fs.xor4096=Jm,Fs.tychei=lc;var Al=Fs.alea,qs=function(){function _(v,d,y,E,B){this.mean=v,this.stdDev=d,this.dtype=y,this.nextVal=NaN,this.truncated=E,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var Q=B||Math.random();this.random=Al(Q.toString())}return _.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var v=this.nextVal;return this.nextVal=NaN,v}for(var d,y,E=!1;!E;){var B=void 0,Q=void 0,re=void 0;do re=(B=2*this.random()-1)*B+(Q=2*this.random()-1)*Q;while(re>=1||re===0);var fe=Math.sqrt(-2*Math.log(re)/re);d=this.mean+this.stdDev*B*fe,y=this.mean+this.stdDev*Q*fe,this.truncated&&!this.isValidTruncated(d)||(E=!0)}return this.truncated&&!this.isValidTruncated(y)||(this.nextVal=this.convertValue(y)),this.convertValue(d)},_.prototype.convertValue=function(v){return this.dtype==null||this.dtype==="float32"?v:Math.round(v)},_.prototype.isValidTruncated=function(v){return v<=this.upper&&v>=this.lower},_}(),wu=function(){function _(v,d,y,E){this.alpha=v,this.beta=1/d,this.dtype=y;var B=E||Math.random();this.randu=Al(B.toString()),this.randn=new qs(0,1,y,!1,this.randu()),this.d=v<1?v+2/3:v-1/3,this.c=1/Math.sqrt(9*this.d)}return _.prototype.nextValue=function(){for(var v,d,y,E,B,Q;;){do E=this.randn.nextValue(),Q=1+this.c*E;while(Q<=0);if(Q*=Q*Q,d=1-.331*(v=E*E)*v,y=.5*v+this.d*(1-Q+Math.log(Q)),(B=this.randu())<d||Math.log(B)<y)break}return Q=1/this.beta*this.d*Q,this.alpha<1&&(Q*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(Q)},_.prototype.convertValue=function(v){return this.dtype==="float32"?v:Math.round(v)},_}(),Nh=function(){function _(v,d,y,E){var B=this;if(v===void 0&&(v=0),d===void 0&&(d=1),this.canReturnFloat=function(){return B.dtype==null||B.dtype==="float32"},this.min=v,this.range=d-v,this.dtype=y,E==null&&(E=Math.random()),typeof E=="number"&&(E=E.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+v+" - "+d+" <= 1 and dtype is not float");this.random=Al(E)}return _.prototype.convertValue=function(v){return this.canReturnFloat()?v:Math.round(v)},_.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},_}();function Wi(_,v,d){return v===void 0&&(v="float32"),v=v||"float32",Vn(_),new Hr(_,v,d)}function vd(_,v){v===void 0&&(v=!1),console.log(_.toString(v))}var Ol=Pt({batchToSpaceND_:function(_,v,d){var y=Ze(_,"x","batchToSpaceND"),E=v.reduce(function(B,Q){return B*Q});return we(y.rank>=1+v.length,function(){return"input rank is "+y.rank+" but should be > than blockShape.length "+v.length}),we(d.length===v.length,function(){return"crops.length is "+d.length+" but should be equal to blockShape.length  "+v.length}),we(y.shape[0]%E==0,function(){return"input tensor batch is "+y.shape[0]+" but is not divisible by the product of the elements of blockShape "+v.join(" * ")+" === "+E}),Ve.runKernelFunc(function(B){return B.batchToSpaceND(y,v,d)},{$x:y},function(B){return{$x:function(){return B.spaceToBatchND(v,d)}}})}}),df=Pt({broadcastTo_:function(_,v){var d=Ze(_,"broadcastTo","x"),y=d.shape;if(v.some(function(fe){return!(fe>0)||fe%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+v+"].");if(v.length<d.rank)throw new Error("broadcastTo(): shape.length="+v.length+" < input.rank="+d.rank+".");if(v.length>d.rank){for(var E=d.shape.slice();E.length<v.length;)E.unshift(1);d=d.reshape(E)}for(var B=Array.from(v),Q=v.length-1;Q>=0;Q--)if(d.shape[Q]===v[Q])B[Q]=1;else if(d.shape[Q]!==1)throw new Error("broadcastTo(): ["+y+"] cannot be broadcast to ["+v+"].");var re=B.map(function(fe,xe){return fe>1?xe:-1}).filter(function(fe){return fe>=0});return re.length===0?d.clone():Ve.runKernelFunc(function(fe){return fe.tile(d,B)},{input:d},function(fe){return{input:function(){return fe.sum(re,!0)}}})}}),Xp=Pt({cast_:function(_,v){var d=Ze(_,"x","cast");if(!Qe(v))throw new Error("Failed to cast to unknown dtype "+v);if(v==="string"&&d.dtype!=="string"||v!=="string"&&d.dtype==="string")throw new Error("Only strings can be casted to strings");var y={dtype:v};return Ve.runKernelFunc(function(E){return E.cast(d,v)},{x:d},function(E){return{x:function(){return E.clone()}}},"Cast",y)}}),Qm=Pt({clone_:function(_){var v=Ze(_,"x","clone",null);return Ve.runKernelFunc(function(){return Ve.makeTensorFromDataId(v.dataId,v.shape,v.dtype)},{$x:v},function(d){return{$x:function(){return d.toFloat()}}})}}),hf=Pt({cumsum_:function(_,v,d,y){v===void 0&&(v=0),d===void 0&&(d=!1),y===void 0&&(y=!1);var E=Ze(_,"x","cumsum"),B=Ra([v|=0],E.rank),Q=E;B!=null&&(Q=E.transpose(B));var re=Pa(1,E.rank)[0],fe=Ve.runKernelFunc(function(xe){return xe.cumsum(Q,re,d,y)},{permutedX:Q},function(xe){return{permutedX:function(){return xe.cumsum(v,d,!y)}}});return B!=null&&(fe=fe.transpose(B)),fe}}),Ih=Pt({depthToSpace_:function(_,v,d){d===void 0&&(d="NHWC");var y=Ze(_,"x","depthToSpace"),E=d==="NHWC"?y.shape[1]:y.shape[2],B=d==="NHWC"?y.shape[2]:y.shape[3],Q=d==="NHWC"?y.shape[3]:y.shape[1];return we(E*v>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+E+" and "+v+`  for depthToSpace with input shape
      `+y.shape}),we(B*v>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+B+" and "+v+` for depthToSpace with input shape
          `+y.shape}),we(Q%(v*v)==0,function(){return"Dimension size must be evenly divisible by "+v*v+" but is "+Q+" for depthToSpace with input shape "+y.shape}),Ve.runKernelFunc(function(re){return re.depthToSpace(y,v,d)},{$x:y})}}),Go=Pt({expandDims_:function(_,v){v===void 0&&(v=0);var d=Ze(_,"x","expandDims",null);we(v<=d.rank,function(){return"Axis must be <= rank of the tensor"});var y=d.shape.slice();return v<0&&(we(-(d.rank+1)<=v,function(){return"Axis must be in the interval ["+-(d.rank+1)+", "+d.rank+"]"}),v=d.rank+v+1),y.splice(v,0,1),la(d,y)}}),Fh=Pt({eye_:function(_,v,d,y){y===void 0&&(y="float32"),v==null&&(v=_);for(var E=Wi([_,v],y),B=_<=v?_:v,Q=0;Q<B;++Q)E.set(1,Q,Q);var re=E.toTensor().as2D(_,v);if(d==null)return re;if(d.length===1)return Rs(Go(re,0),[d[0],1,1]);if(d.length===2)return Rs(Go(Go(re,0),0),[d[0],d[1],1,1]);if(d.length===3)return Rs(Go(Go(Go(re,0),0),0),[d[0],d[1],d[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+d.length+"D.")}}),pf=Pt({multinomial_:function(_,v,d,y){y===void 0&&(y=!1);var E=Ze(_,"logits","multinomial"),B=E.size,Q=E.rank;if(B<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+B+".");if(Q>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+Q);d=d||Math.random();var re=Q===1?E.as2D(1,-1):E,fe=Ve.runKernelFunc(function(xe){return xe.multinomial(re,y,v,d)},{logits2D:re});return Q===1?fe.as1D():fe}}),Rh=Pt({oneHot_:function(_,v,d,y){if(d===void 0&&(d=1),y===void 0&&(y=0),v<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+v);var E=Ze(_,"indices","oneHot","int32"),B=E.shape.concat([v]);return E=E.flatten(),Ve.runKernelFunc(function(Q){return Q.oneHot(E,v,d,y)},{$indices:E},function(Q){return{$indices:function(){return ao(E.shape,"float32")}}}).reshape(B)}}),mf=Pt({pad_:function(_,v,d){d===void 0&&(d=0);var y=Ze(_,"x","pad");if(y.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var E={paddings:v,constantValue:d};return Ve.runKernelFunc(function(B){return B.pad(y,v,d)},{x:y},function(B){var Q=v.map(function(re){return re[0]});return{x:function(){return B.slice(Q,y.shape)}}},"PadV2",E)}}),Tl=Pt({pad1d_:function(_,v,d){return d===void 0&&(d=0),we(v.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),mf(_,[v],d)}}),el=Pt({pad2d_:function(_,v,d){return d===void 0&&(d=0),we(v.length===2&&v[0].length===2&&v[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),mf(_,v,d)}}),Ph=Pt({pad3d_:function(_,v,d){return d===void 0&&(d=0),we(v.length===3&&v[0].length===2&&v[1].length===2&&v[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),mf(_,v,d)}}),yd=Pt({pad4d_:function(_,v,d){return d===void 0&&(d=0),we(v.length===4&&v[0].length===2&&v[1].length===2&&v[2].length===2&&v[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),mf(_,v,d)}}),gf=Pt({rand_:function(_,v,d){var y=ze(_),E=null;if(d==null||d==="float32")E=new Float32Array(y);else if(d==="int32")E=new Int32Array(y);else{if(d!=="bool")throw new Error("Unknown data type "+d);E=new Uint8Array(y)}for(var B=0;B<y;B++)E[B]=v();return Ve.makeTensor(E,_,d)}}),tl=Pt({randomNormal_:function(_,v,d,y,E){if(v===void 0&&(v=0),d===void 0&&(d=1),y!=null&&y==="bool")throw new Error("Unsupported data type "+y);for(var B=new qs(v,d,y,!1,E),Q=Wi(_,y),re=0;re<Q.values.length;re++)Q.values[re]=B.nextValue();return Q.toTensor()}}),Xg=Pt({randomGamma_:function(_,v,d,y,E){if(d===void 0&&(d=1),y===void 0&&(y="float32"),d==null&&(d=1),y==null&&(y="float32"),y!=="float32"&&y!=="int32")throw new Error("Unsupported data type "+y);for(var B=new wu(v,d,y,E),Q=Wi(_,y),re=0;re<Q.values.length;re++)Q.values[re]=B.nextValue();return Q.toTensor()}}),vf=Pt({randomUniform_:function(_,v,d,y,E){v===void 0&&(v=0),d===void 0&&(d=1),y===void 0&&(y="float32");for(var B=Wi(_,y),Q=new Nh(v,d,null,E),re=0;re<B.values.length;re++)B.values[re]=Q.nextValue();return B.toTensor()}}),la=Pt({reshape_:function(_,v){var d=Ze(_,"x","reshape",null);v=_t(v,d.size),we(d.size===ze(v),function(){return"new shape and old shape must have the same number of elements."});var y={shape:v};return Ve.runKernelFunc(function(E){return E.reshape(d,v)},{x:d},function(E){return{x:function(){return E.reshape(d.shape)}}},"Reshape",y)}}),La=Pt({spaceToBatchND_:function(_,v,d){var y=Ze(_,"x","spaceToBatchND");return we(y.rank>=1+v.length,function(){return"input rank "+y.rank+" should be > than [blockShape] "+v.length}),we(d.length===v.length,function(){return"paddings.shape[0] "+d.length+" must be equal to [blockShape] "+v.length}),we(y.shape.reduce(function(E,B,Q){return Q>0&&Q<=v.length?E&&(B+d[Q-1][0]+d[Q-1][1])%v[Q-1]==0:E},!0),function(){return"input spatial dimensions "+y.shape.slice(1)+" with paddings "+d.toString()+" must be divisible by blockShapes "+v.toString()}),Ve.runKernelFunc(function(E){return E.spaceToBatchND(y,v,d)},{$x:y},function(E){return{$x:function(){return E.batchToSpaceND(v,d)}}})}}),Wa=Pt({squeeze_:function(_,v){var d=Ze(_,"x","squeeze");return la(d,Fn(d.shape,v).newShape)}}),qi=Pt({stack_:function(_,v){v===void 0&&(v=0);var d=cc(_,"tensors","stack");if(we(d.length>=1,function(){return"Pass at least one tensor to tf.stack"}),d.length===1)return d[0].expandDims(v);var y=d[0].rank,E=d[0].shape,B=d[0].dtype;we(v<=y,function(){return"Axis must be <= rank of the tensor"}),d.forEach(function(re){bt(E,re.shape,"All tensors passed to stack must have matching shapes")}),d.forEach(function(re){we(B===re.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var Q=d.map(function(re){return re.expandDims(v)});return Ho(Q,v)}}),Rs=Pt({tile_:function(_,v){var d=Ze(_,"x","tile",null);we(d.rank===v.length,function(){return"Error in transpose: rank of input "+d.rank+" must match length of reps "+v+"."});var y=[d],E={reps:v};return Ve.runKernelFunc(function(B,Q){var re=B.tile(d,v);return Q([d]),re},{x:d},function(B,Q){var re=Q[0];return{x:function(){var fe=mi(re);if(re.rank===1)for(var xe=0;xe<v[0];++xe)fe=fe.add(B.slice([xe*re.shape[0]],[re.shape[0]]));else if(re.rank===2)for(xe=0;xe<v[0];++xe)for(var Oe=0;Oe<v[1];++Oe)fe=fe.add(B.slice([xe*re.shape[0],Oe*re.shape[1]],[re.shape[0],re.shape[1]]));else if(re.rank===3)for(xe=0;xe<v[0];++xe)for(Oe=0;Oe<v[1];++Oe)for(var Re=0;Re<v[2];++Re)fe=fe.add(B.slice([xe*re.shape[0],Oe*re.shape[1],Re*re.shape[2]],[re.shape[0],re.shape[1],re.shape[2]]));else{if(re.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+re.rank+" tensors yet.");for(xe=0;xe<v[0];++xe)for(Oe=0;Oe<v[1];++Oe)for(Re=0;Re<v[2];++Re)for(var Le=0;Le<v[3];++Le)fe=fe.add(B.slice([xe*re.shape[0],Oe*re.shape[1],Re*re.shape[2],Le*re.shape[3]],[re.shape[0],re.shape[1],re.shape[2],re.shape[3]]))}return fe}}},"Tile",E,y)}}),nl=Pt({truncatedNormal_:function(_,v,d,y,E){if(v===void 0&&(v=0),d===void 0&&(d=1),y!=null&&y==="bool")throw new Error("Unsupported data type "+y);for(var B=new qs(v,d,y,!0,E),Q=Wi(_,y),re=0;re<Q.values.length;re++)Q.values[re]=B.nextValue();return Q.toTensor()}}),Va=Pt({unstack_:function(_,v){v===void 0&&(v=0),v=v||0;var d=Ze(_,"x","unstack");we(v>=-d.shape.length&&v<d.shape.length,function(){return"Axis = "+v+" is not in [-"+d.shape.length+", "+d.shape.length+")"}),v<0&&(v+=d.shape.length);var y={axis:v};return Ve.runKernelFunc(function(E){return E.unstack(d,v)},{x:d},function(E){return{x:function(){return qi(E,v)}}},"Unpack",y)}}),rl=function(_,v){return N(this,void 0,void 0,function(){var d,y,E,B,Q,re,fe,xe,Oe,Re;return L(this,function(Le){switch(Le.label){case 0:return d=Ze(_,"x","setdiff1d"),y=Ze(v,"y","setdiff1d"),we(d.dtype===y.dtype,function(){return"x and y should have the same dtype, but got x ("+d.dtype+") and y ("+y.dtype+")."}),we(d.rank===1,function(){return"x should be 1D tensor, but got x ("+d.shape+")."}),we(y.rank===1,function(){return"y should be 1D tensor, but got y ("+y.shape+")."}),[4,d.data()];case 1:return E=Le.sent(),[4,y.data()];case 2:for(B=Le.sent(),Q=new Set(B),re=0,Oe=0;Oe<E.length;Oe++)Q.has(E[Oe])||re++;for(fe=new Hr([re],d.dtype),xe=new Hr([re],"int32"),Oe=0,Re=0;Oe<E.length;Oe++)Q.has(E[Oe])||(fe.values[Re]=E[Oe],xe.values[Re]=Oe,Re++);return[2,[fe.toTensor(),xe.toTensor()]]}})})};function fc(_,v,d,y){y===void 0&&(y=!0);var E=[];if(y)(E=E.concat(v.slice(0))).push(_[0]/d),E=E.concat(_.slice(1));else{E=E.concat(_[0]);for(var B=v.length,Q=0;Q<B;++Q)E=E.concat([_[Q+1]/v[Q],v[Q]]);E=E.concat(_.slice(B+1))}return E}function bd(_,v,d){d===void 0&&(d=!0);var y=[];if(d){y.push(v);for(var E=v+1;E<_;++E)E<=2*v?(y.push(E),y.push(E-(v+1))):y.push(E)}else{var B=[],Q=[];for(E=1;E<_;++E)E>=2*v+1||E%2==1?Q.push(E):B.push(E);y.push.apply(y,B),y.push(0),y.push.apply(y,Q)}return y}function xd(_,v,d,y){y===void 0&&(y=!0);var E=[];y?E.push(_[0]/d):E.push(_[0]*d);for(var B=1;B<_.length;++B)B<=v.length?y?E.push(v[B-1]*_[B]):E.push(_[B]/v[B-1]):E.push(_[B]);return E}function Ml(_,v){for(var d=[0],y=0;y<v;++y)d.push(_[y][0]);return d}function Kp(_,v,d){for(var y=_.slice(0,1),E=0;E<d;++E)y.push(_[E+1]-v[E][0]-v[E][1]);return y}function dc(_,v){if(_.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+_.rank+".");if(v.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+v.rank+".");if(v.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+v.dtype+".");if(v.shape[v.rank-1]>_.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+v.shape[v.rank-1]+" vs. "+_.rank);if(_.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+_.shape+".");for(var d=v.shape,y=d[d.length-1],E=1,B=0;B<d.length-1;++B)E*=d[B];var Q=_.shape,re=d.slice();re.pop();var fe=1;for(B=y;B<_.rank;++B)fe*=Q[B],re.push(Q[B]);var xe=rn(_.shape).map(function(Oe){return Oe/fe}).concat([1]).slice(0,y);return[re,E,fe,xe]}var Kg=Object.freeze({prepareAndValidate:dc}),Yp=30;function yf(_){return _<=Yp?_:Tr(_,Math.floor(Math.sqrt(_)))}function Zm(_,v,d){var y=v.rank>1?v.shape[v.rank-1]:1,E=v.rank>1?v.rank-1:1,B="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+d.shape+", indices.shape: "+v.shape+", shape: "+_+", sliceDim: "+y+", and batchDim: "+E+".";if(d.rank<E)throw new Error(B+" update.rank < "+E+". ");if(_.length<y+(d.rank-E))throw new Error(B+" Output shape length < "+(y+(d.rank-E)));if(d.rank!==E+_.length-y)throw new Error(B+" update.rank != "+(E+_.length-y));for(var Q=0;Q<E;++Q)if(d.shape[Q]!==v.shape[Q])throw new Error(B+" updates.shape["+Q+"] ("+d.shape[Q]+") != indices.shape["+Q+"] ("+v.shape[Q]+").");for(Q=0;Q<d.rank-E;++Q)if(d.shape[Q+E]!==_[Q+y])throw new Error(B+" updates.shape["+(Q+E)+"] ("+d.shape[Q+E]+") != shape["+(Q+E)+"] ("+_[Q+E]+")")}function wd(_,v,d){if(v.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+v.rank+".");if(_.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+_.rank+".");if(v.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+v.dtype);if(d.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+d);if(d.length===0){if(v.size===0)throw new Error("Indices specified for empty output. indices shape: "+v.shape);if(_.size===0)throw new Error("Updates specified for empty output. updates shape: "+_.shape)}Zm(d,v,_)}function Dl(_,v,d){for(var y=v.shape.length,E=y>1?v.shape[y-1]:1,B=d.length,Q=1,re=E;re<B;++re)Q*=d[re];var fe=E<1?1:E;return{sliceRank:E,numUpdates:ze(v.shape)/fe,sliceSize:Q,strides:rn(d.slice(0,E)).concat([1]),outputSize:ze(d)}}var Jp=Object.freeze({validateUpdateShape:Zm,validateInput:wd,calculateShapes:Dl});function Lh(_,v,d){we(_.rank===v.length,function(){return"Error in slice"+_.rank+"D: Length of begin "+v+" must match the rank of the array ("+_.rank+")."}),we(_.rank===d.length,function(){return"Error in slice"+_.rank+"D: Length of size "+d+" must match the rank of the array ("+_.rank+")."});for(var y=function(B){we(v[B]+d[B]<=_.shape[B],function(){return"Error in slice"+_.rank+"D: begin["+B+"] + size["+B+"] ("+(v[B]+d[B])+") would overflow input.shape["+B+"] ("+_.shape[B]+")"})},E=0;E<_.rank;++E)y(E)}function Oa(_){for(var v=[],d=0;_>0;)1&_&&v.push(d),_/=2,d++;return v}function bf(_,v,d){for(var y=[],E=0;E<_.length;E++)y[E]=Math.ceil((v[E]-_[E])/d[E]);return y}function Ps(_,v,d,y,E){var B=v[E],Q=d[E]||1;(_&1<<E||B==null)&&(B=Q>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var re=y[E];return B<0&&(B+=re),ht(0,B,re-1)}function xf(_,v,d,y,E){var B=v[E],Q=d[E]||1;(_&1<<E||B==null)&&(B=Q>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var re=y[E];return B<0&&(B+=re),Q>0?ht(0,B,re):ht(-1,B,re-1)}function _d(_,v,d){for(var y=d.length,E=0;E<d.length;E++)if(d[E]>1){y=E;break}for(E=y+1;E<d.length;E++)if(v[E]>0||d[E]!==_[E])return!1;return!0}function Bh(_,v){for(var d=_.length>0?_[_.length-1]:1,y=0;y<_.length-1;y++)d+=_[y]*v[y];return d}var Qp=Object.freeze({assertParamsValid:Lh,maskToAxes:Oa,computeOutShape:bf,startForAxis:Ps,stopForAxis:xf,isSliceContinous:_d,computeFlatOffset:Bh});function Ed(_){return we(ar(_),function(){return"The f passed in grad(f) must be a function"}),function(v,d){var y=Ze(v,"x","tf.grad",null),E=d!=null?Ze(d,"dy","tf.grad"):null;return Ve.tidy(function(){var B=Ve.gradients(function(){return _(y)},[y],E),Q=B.value,re=B.grads;return E!=null&&bt(Q.shape,E.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),tr(re),re[0]})}}function wf(_){return we(ar(_),function(){return"The f passed in grads(f) must be a function"}),function(v,d){we(Array.isArray(v),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var y=cc(v,"args","tf.grads",null),E=d!=null?Ze(d,"dy","tf.grads"):null;return Ve.tidy(function(){var B=Ve.gradients(function(){return _.apply(void 0,y)},y,E),Q=B.value,re=B.grads;return E!=null&&bt(Q.shape,E.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),tr(re),re})}}function Zp(_){return we(ar(_),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(v,d){we(v instanceof $t,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),we(d==null||d instanceof $t,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var y=Ve.gradients(function(){return _(v)},[v],d),E=y.grads,B=y.value;return tr(E),{grad:E[0],value:B}}}function em(_){return we(ar(_),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(v,d){we(Array.isArray(v)&&v.every(function(E){return E instanceof $t}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),we(d==null||d instanceof $t,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var y=Ve.gradients(function(){return _.apply(void 0,v)},v,d);return d!=null&&bt(y.value.shape,d.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),tr(y.grads),y}}function vn(_,v){we(ar(_),function(){return"The f passed in variableGrads(f) must be a function"}),we(v==null||Array.isArray(v)&&v.every(function(Oe){return Oe instanceof kt}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var d=v!=null;if(!d)for(var y in v=[],Ve.registeredVariables)v.push(Ve.registeredVariables[y]);var E=d?v.filter(function(Oe){return!Oe.trainable}):null,B=v.length;we((v=v.filter(function(Oe){return Oe.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+B+" variables is trainable."});var Q=Ve.gradients(_,v,null,!0),re=Q.value,fe=Q.grads;we(fe.some(function(Oe){return Oe!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),we(re.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+re.rank+" tensor"});var xe={};return v.forEach(function(Oe,Re){fe[Re]!=null&&(xe[Oe.name]=fe[Re])}),E!=null&&E.forEach(function(Oe){return xe[Oe.name]=null}),{value:re,grads:xe}}function ou(_){return Ve.customGrad(_)}function tr(_){if(_.filter(function(v){return v==null}).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}var Ls=Pt({softmax_:function(_,v){v===void 0&&(v=-1);var d=Ze(_,"logits","softmax","float32");if(v===-1&&(v=d.rank-1),v!==d.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+d.rank+" and dim was "+v);return Ve.runKernelFunc(function(y,E){var B=y.softmax(d,v);return E([B]),B},{logits:d},function(y,E){var B=E[0],Q=y.mul(B);return{logits:function(){return Q.sub(Q.sum([v],!0).mul(B))}}},"Softmax",{dim:v},[],[!0])}}),mo=Pt({logSoftmax_:function(_,v){v===void 0&&(v=-1);var d=Ze(_,"logits","logSoftmax");if(v===-1&&(v=d.rank-1),v!==d.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+d.rank+" and axis was "+v);return ou(function(y,E){var B=y.max(v,!0),Q=y.sub(B),re=Q.toFloat().sub(Q.exp().sum(v,!0).log());return E([re]),{value:re,gradFunc:function(fe,xe){var Oe=xe[0].exp();return fe.sub(fe.sum(v,!0).mul(Oe))}}})(d)}}),_f=function(){function _(v,d){this.backend=v,this.dataMover=d,this.data=new WeakMap,this.dataIdsCount=0}return _.prototype.get=function(v){return this.data.has(v)||this.dataMover.moveData(this.backend,v),this.data.get(v)},_.prototype.set=function(v,d){this.dataIdsCount++,this.data.set(v,d)},_.prototype.has=function(v){return this.data.has(v)},_.prototype.delete=function(v){return this.dataIdsCount--,this.data.delete(v)},_.prototype.numDataIds=function(){return this.dataIdsCount},_}(),Sd=function(){function _(){}return _.prototype.time=function(v){return mr("time")},_.prototype.read=function(v){return mr("read")},_.prototype.readSync=function(v){return mr("readSync")},_.prototype.numDataIds=function(){return mr("numDataIds")},_.prototype.disposeData=function(v){return mr("disposeData")},_.prototype.write=function(v,d,y){return mr("write")},_.prototype.move=function(v,d,y,E){return mr("move")},_.prototype.memory=function(){return mr("memory")},_.prototype.floatPrecision=function(){return mr("floatPrecision")},_.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},_.prototype.batchMatMul=function(v,d,y,E){return mr("batchMatMul")},_.prototype.fusedBatchMatMul=function(v){return v.a,v.b,v.transposeA,v.transposeB,v.bias,v.activation,v.preluActivationWeights,mr("fusedBatchMatMul")},_.prototype.slice=function(v,d,y){return mr("slice")},_.prototype.stridedSlice=function(v,d,y,E){return mr("stridedSlice")},_.prototype.unstack=function(v,d){return mr("unstack")},_.prototype.reverse=function(v,d){return mr("reverse")},_.prototype.concat=function(v,d){return mr("concat")},_.prototype.neg=function(v){return mr("neg")},_.prototype.add=function(v,d){return mr("add")},_.prototype.addN=function(v){return mr("addN")},_.prototype.subtract=function(v,d){return mr("subtract")},_.prototype.multiply=function(v,d){return mr("multiply")},_.prototype.realDivide=function(v,d){return mr("realDivide")},_.prototype.floorDiv=function(v,d){return mr("floorDiv")},_.prototype.sum=function(v,d){return mr("sum")},_.prototype.prod=function(v,d){return mr("prod")},_.prototype.unsortedSegmentSum=function(v,d,y){return mr("unsortedSegmentSum")},_.prototype.argMin=function(v,d){return mr("argMin")},_.prototype.argMax=function(v,d){return mr("argMax")},_.prototype.equal=function(v,d){return mr("equal")},_.prototype.notEqual=function(v,d){return mr("notEqual")},_.prototype.less=function(v,d){return mr("less")},_.prototype.lessEqual=function(v,d){return mr("lessEqual")},_.prototype.greater=function(v,d){return mr("greater")},_.prototype.greaterEqual=function(v,d){return mr("greaterEqual")},_.prototype.logicalNot=function(v){return mr("logicalNot")},_.prototype.logicalAnd=function(v,d){return mr("logicalAnd")},_.prototype.logicalOr=function(v,d){return mr("logicalOr")},_.prototype.where=function(v){return mr("where")},_.prototype.select=function(v,d,y){return mr("select")},_.prototype.topk=function(v,d,y){return mr("topk")},_.prototype.min=function(v,d){return mr("min")},_.prototype.minimum=function(v,d){return mr("minimum")},_.prototype.mod=function(v,d){return mr("mod")},_.prototype.max=function(v,d){return mr("max")},_.prototype.maximum=function(v,d){return mr("maximum")},_.prototype.all=function(v,d){return mr("all")},_.prototype.any=function(v,d){return mr("any")},_.prototype.squaredDifference=function(v,d){return mr("squaredDifference")},_.prototype.ceil=function(v){return mr("ceil")},_.prototype.floor=function(v){return mr("floor")},_.prototype.round=function(v){return mr("round")},_.prototype.sign=function(v){return mr("sign")},_.prototype.isNaN=function(v){return mr("isNaN")},_.prototype.isInf=function(v){return mr("isInf")},_.prototype.isFinite=function(v){return mr("isFinite")},_.prototype.pow=function(v,d){return mr("pow")},_.prototype.exp=function(v){return mr("exp")},_.prototype.expm1=function(v){return mr("expm1")},_.prototype.softmax=function(v,d){return mr("softmax")},_.prototype.log=function(v){return mr("log")},_.prototype.log1p=function(v){return mr("log1p")},_.prototype.sqrt=function(v){return mr("sqrt")},_.prototype.rsqrt=function(v){return mr("rsqrt")},_.prototype.square=function(v){return mr("square")},_.prototype.reciprocal=function(v){return mr("reciprocal")},_.prototype.relu=function(v){return mr("relu")},_.prototype.relu6=function(v){return mr("relu6")},_.prototype.prelu=function(v,d){return mr("prelu")},_.prototype.elu=function(v){return mr("elu")},_.prototype.eluDer=function(v,d){return mr("eluDer")},_.prototype.selu=function(v){return mr("selu")},_.prototype.int=function(v){return mr("int")},_.prototype.clip=function(v,d,y){return mr("clip")},_.prototype.abs=function(v){return mr("abs")},_.prototype.complexAbs=function(v){return mr("complexAbs")},_.prototype.sigmoid=function(v){return mr("sigmoid")},_.prototype.softplus=function(v){return mr("softplus")},_.prototype.sin=function(v){return mr("sin")},_.prototype.cos=function(v){return mr("cos")},_.prototype.tan=function(v){return mr("tan")},_.prototype.asin=function(v){return mr("asin")},_.prototype.acos=function(v){return mr("acos")},_.prototype.atan=function(v){return mr("atan")},_.prototype.atan2=function(v,d){return mr("atan2")},_.prototype.sinh=function(v){return mr("sinh")},_.prototype.cosh=function(v){return mr("cosh")},_.prototype.tanh=function(v){return mr("tanh")},_.prototype.asinh=function(v){return mr("asinh")},_.prototype.acosh=function(v){return mr("acosh")},_.prototype.atanh=function(v){return mr("atanh")},_.prototype.erf=function(v){return mr("erf")},_.prototype.step=function(v,d){return mr("step")},_.prototype.fusedConv2d=function(v){return v.input,v.filter,v.convInfo,v.bias,v.activation,v.preluActivationWeights,mr("fusedConv2d")},_.prototype.conv2d=function(v,d,y){return mr("conv2d")},_.prototype.conv2dDerInput=function(v,d,y){return mr("conv2dDerInput")},_.prototype.conv2dDerFilter=function(v,d,y){return mr("conv2dDerFilter")},_.prototype.fusedDepthwiseConv2D=function(v){return v.input,v.filter,v.convInfo,v.bias,v.activation,v.preluActivationWeights,mr("fusedDepthwiseConv2D")},_.prototype.depthwiseConv2D=function(v,d,y){return mr("depthwiseConv2D")},_.prototype.depthwiseConv2DDerInput=function(v,d,y){return mr("depthwiseConv2DDerInput")},_.prototype.depthwiseConv2DDerFilter=function(v,d,y){return mr("depthwiseConv2DDerFilter")},_.prototype.conv3d=function(v,d,y){return mr("conv3d")},_.prototype.conv3dDerInput=function(v,d,y){return mr("conv3dDerInput")},_.prototype.conv3dDerFilter=function(v,d,y){return mr("conv3dDerFilter")},_.prototype.maxPool=function(v,d){return mr("maxPool")},_.prototype.maxPoolBackprop=function(v,d,y,E){return mr("maxPoolBackprop")},_.prototype.avgPool=function(v,d){return mr("avgPool")},_.prototype.avgPoolBackprop=function(v,d,y){return mr("avgPoolBackprop")},_.prototype.avgPool3d=function(v,d){return mr("avgPool3d")},_.prototype.avgPool3dBackprop=function(v,d,y){return mr("avgPool3dBackprop")},_.prototype.maxPool3d=function(v,d){return mr("maxPool3d")},_.prototype.maxPool3dBackprop=function(v,d,y,E){return mr("maxPool3dBackprop")},_.prototype.reshape=function(v,d){return mr("reshape")},_.prototype.cast=function(v,d){return mr("cast")},_.prototype.tile=function(v,d){return mr("tile")},_.prototype.pad=function(v,d,y){return mr("pad")},_.prototype.transpose=function(v,d){return mr("transpose")},_.prototype.gather=function(v,d,y){return mr("gather")},_.prototype.gatherND=function(v,d){return mr("gatherND")},_.prototype.scatterND=function(v,d,y){return mr("scatterND")},_.prototype.batchToSpaceND=function(v,d,y){return mr("batchToSpaceND")},_.prototype.spaceToBatchND=function(v,d,y){return mr("spaceToBatchND")},_.prototype.resizeBilinear=function(v,d,y,E){return mr("resizeBilinear")},_.prototype.resizeBilinearBackprop=function(v,d,y){return mr("resizeBilinearBackprop")},_.prototype.resizeNearestNeighbor=function(v,d,y,E){return mr("resizeNearestNeighbor")},_.prototype.resizeNearestNeighborBackprop=function(v,d,y){return mr("resizeNearestNeighborBackprop")},_.prototype.batchNormalization=function(v,d,y,E,B,Q){return mr("batchNormalization")},_.prototype.localResponseNormalization4D=function(v,d,y,E,B){return mr("localResponseNormalization4D")},_.prototype.LRNGrad=function(v,d,y,E,B,Q,re){return mr("LRNGrad")},_.prototype.multinomial=function(v,d,y,E){return mr("multinomial")},_.prototype.oneHot=function(v,d,y,E){return mr("oneHot")},_.prototype.cumsum=function(v,d,y,E){return mr("cumsum")},_.prototype.nonMaxSuppression=function(v,d,y,E,B){return mr("nonMaxSuppression")},_.prototype.fft=function(v){return mr("fft")},_.prototype.ifft=function(v){return mr("ifft")},_.prototype.complex=function(v,d){return mr("complex")},_.prototype.real=function(v){return mr("real")},_.prototype.imag=function(v){return mr("imag")},_.prototype.cropAndResize=function(v,d,y,E,B,Q){return mr("cropAndResize")},_.prototype.depthToSpace=function(v,d,y){return mr("depthToSpace")},_.prototype.split=function(v,d,y){return mr("split")},_.prototype.sparseToDense=function(v,d,y,E){return mr("sparseToDense")},_.prototype.diag=function(v){return mr("diag")},_.prototype.fill=function(v,d,y){return mr("fill")},_.prototype.onesLike=function(v){return mr("onesLike")},_.prototype.zerosLike=function(v){return mr("zerosLike")},_.prototype.linspace=function(v,d,y){return mr("linspace")},_.prototype.dispose=function(){return mr("dispose")},_}();function mr(_){throw new Error("'"+_+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function ts(_,v){for(var d=_.length,y=[],E=0;E<d;E++){var B=d-1-E,Q=_[B]||1;(v[v.length-1-E]||1)>1&&Q===1&&y.unshift(B)}return y}function Ta(_,v){for(var d=[],y=0;y<v.length;y++){var E=_[_.length-y-1],B=v.length-y-1,Q=v[B];(E==null||E===1&&Q>1)&&d.unshift(B)}return d}function no(_,v){for(var d=[],y=Math.max(_.length,v.length),E=0;E<y;E++){var B=_[_.length-E-1];B==null&&(B=1);var Q=v[v.length-E-1];if(Q==null&&(Q=1),B===1)d.unshift(Q);else if(Q===1)d.unshift(B);else{if(B!==Q)throw Error("Operands could not be broadcast together with shapes "+_+" and "+v+".");d.unshift(B)}}return d}function Hu(_,v,d,y,E,B,Q){Q===void 0&&(Q="channelsLast");var re,fe=hc(v),xe=fe[0],Oe=fe[1];if(Q==="channelsLast")re=[xe,Oe,_[3],_[3]];else{if(Q!=="channelsFirst")throw new Error("Unknown dataFormat "+Q);re=[xe,Oe,_[1],_[1]]}return au(_,re,d,y,E,B,!1,Q)}function Nc(_,v,d,y,E,B,Q){Q===void 0&&(Q="NDHWC");var re,fe,xe=su(v),Oe=xe[0],Re=xe[1],Le=xe[2];if(Q==="NDHWC")fe="channelsLast",re=[Oe,Re,Le,_[4],_[4]];else{if(Q!=="NCDHW")throw new Error("Unknown dataFormat "+Q);fe="channelsFirst",re=[Oe,Re,Le,_[1],_[1]]}return Ic(_,re,d,y,E,!1,fe,B)}function au(_,v,d,y,E,B,Q,re){Q===void 0&&(Q=!1),re===void 0&&(re="channelsLast");var fe=[-1,-1,-1,-1],xe=fe[0],Oe=fe[1],Re=fe[2],Le=fe[3];if(re==="channelsLast")xe=_[0],Oe=_[1],Re=_[2],Le=_[3];else{if(re!=="channelsFirst")throw new Error("Unknown dataFormat "+re);xe=_[0],Le=_[1],Oe=_[2],Re=_[3]}var Be,Xe=v[0],nt=v[1],tt=v[3],ut=hc(d),Dt=ut[0],Rt=ut[1],Lt=hc(y),qt=Lt[0],pn=Lt[1],bn=vo(Xe,qt),mn=vo(nt,pn),Sn=function(m,w,R,K,ee,le,de,_e){var Te,Ne,Fe;if(typeof m=="number"){Te={top:m,bottom:m,left:m,right:m,type:m===0?"VALID":"NUMBER"};var He=function(At,zt,an,dn,sn){dn==null&&(dn=na(At,zt,an));var ln=At[1],Tn=ws((At[0]-zt+2*dn)/an+1,sn);we(Ft(Tn),function(){return"The output # of rows ("+Tn+") must be an integer. Change the stride and/or zero pad parameters"});var Bn=ws((ln-zt+2*dn)/an+1,sn);return we(Ft(Bn),function(){return"The output # of columns ("+Bn+") must be an integer. Change the stride and/or zero pad parameters"}),[Tn,Bn]}([w,R],le,K,m,_e);Ne=He[0],Fe=He[1]}else if(m==="same"){Ne=Math.ceil(w/K),Fe=Math.ceil(R/ee);var Ye=Math.max(0,(Ne-1)*K+le-w),Ke=Math.max(0,(Fe-1)*ee+de-R),it=Math.floor(Ye/2),gt=Ye-it,wt=Math.floor(Ke/2);Te={top:it,bottom:gt,left:wt,right:Ke-wt,type:"SAME"}}else{if(m!=="valid")throw Error("Unknown padding parameter: "+m);Te={top:0,bottom:0,left:0,right:0,type:"VALID"},Ne=Math.ceil((w-le+1)/K),Fe=Math.ceil((R-de+1)/ee)}return{padInfo:Te,outHeight:Ne,outWidth:Fe}}(E,Oe,Re,Dt,Rt,bn,mn,B),On=Sn.padInfo,b=Sn.outHeight,h=Sn.outWidth,c=Q?tt*Le:tt;return re==="channelsFirst"?Be=[xe,c,b,h]:re==="channelsLast"&&(Be=[xe,b,h,c]),{batchSize:xe,dataFormat:re,inHeight:Oe,inWidth:Re,inChannels:Le,outHeight:b,outWidth:h,outChannels:c,padInfo:On,strideHeight:Dt,strideWidth:Rt,filterHeight:Xe,filterWidth:nt,effectiveFilterHeight:bn,effectiveFilterWidth:mn,dilationHeight:qt,dilationWidth:pn,inShape:_,outShape:Be,filterShape:v}}function Ic(_,v,d,y,E,B,Q,re){B===void 0&&(B=!1),Q===void 0&&(Q="channelsLast");var fe=[-1,-1,-1,-1,-1],xe=fe[0],Oe=fe[1],Re=fe[2],Le=fe[3],Be=fe[4];if(Q==="channelsLast")xe=_[0],Oe=_[1],Re=_[2],Le=_[3],Be=_[4];else{if(Q!=="channelsFirst")throw new Error("Unknown dataFormat "+Q);xe=_[0],Be=_[1],Oe=_[2],Re=_[3],Le=_[4]}var Xe,nt=v[0],tt=v[1],ut=v[2],Dt=v[4],Rt=su(d),Lt=Rt[0],qt=Rt[1],pn=Rt[2],bn=su(y),mn=bn[0],Sn=bn[1],On=bn[2],b=vo(nt,mn),h=vo(tt,Sn),c=vo(ut,On),m=function(de,_e,Te,Ne,Fe,He,Ye,Ke,it,gt,wt){var At,zt,an,dn;if(typeof de=="number"){At={top:de,bottom:de,left:de,right:de,front:de,back:de,type:de===0?"VALID":"NUMBER"};var sn=function(xr,vr,Pr,Rr,Qr,fi){Qr==null&&(Qr=na(xr,vr,Rr));var Ci=xr[1],bo=xr[2],xo=ws((xr[0]-vr+2*Qr)/Rr+1,fi);we(Ft(xo),function(){return"The output # of depths ("+xo+") must be an integer. Change the stride and/or zero pad parameters"});var Mo=ws((Ci-vr+2*Qr)/Rr+1,fi);we(Ft(Mo),function(){return"The output # of rows ("+Mo+") must be an integer. Change the stride and/or zero pad parameters"});var Oo=ws((bo-vr+2*Qr)/Rr+1,fi);return we(Ft(Oo),function(){return"The output # of columns ("+Oo+") must be an integer. Change the stride and/or zero pad parameters"}),[xo,Mo,Oo,1]}([_e,Te,Ne,1],Ke,0,Fe,de,wt);zt=sn[0],an=sn[1],dn=sn[2]}else if(de==="same"){var ln=((zt=Math.ceil(_e/Fe))-1)*Fe+Ke-_e,Tn=((an=Math.ceil(Te/He))-1)*He+it-Te,Bn=((dn=Math.ceil(Ne/Ye))-1)*Ye+gt-Ne,In=Math.floor(ln/2),or=ln-In,fr=Math.floor(Tn/2),br=Tn-fr,_r=Math.floor(Bn/2);At={top:fr,bottom:br,left:_r,right:Bn-_r,front:In,back:or,type:"SAME"}}else{if(de!=="valid")throw Error("Unknown padding parameter: "+de);At={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},zt=Math.ceil((_e-Ke+1)/Fe),an=Math.ceil((Te-it+1)/He),dn=Math.ceil((Ne-gt+1)/Ye)}return{padInfo:At,outDepth:zt,outHeight:an,outWidth:dn}}(E,Oe,Re,Le,Lt,qt,pn,b,h,c,re),w=m.padInfo,R=m.outDepth,K=m.outHeight,ee=m.outWidth,le=B?Dt*Be:Dt;return Q==="channelsFirst"?Xe=[xe,le,R,K,ee]:Q==="channelsLast"&&(Xe=[xe,R,K,ee,le]),{batchSize:xe,dataFormat:Q,inDepth:Oe,inHeight:Re,inWidth:Le,inChannels:Be,outDepth:R,outHeight:K,outWidth:ee,outChannels:le,padInfo:w,strideDepth:Lt,strideHeight:qt,strideWidth:pn,filterDepth:nt,filterHeight:tt,filterWidth:ut,effectiveFilterDepth:b,effectiveFilterHeight:h,effectiveFilterWidth:c,dilationDepth:mn,dilationHeight:Sn,dilationWidth:On,inShape:_,outShape:Xe,filterShape:v}}function na(_,v,d,y){y===void 0&&(y=1);var E=vo(v,y);return Math.floor((_[0]*(d-1)-d+E)/2)}function hc(_){return typeof _=="number"?[_,_,_]:_.length===2?[_[0],_[1],1]:_}function su(_){return typeof _=="number"?[_,_,_]:_}function vo(_,v){return v<=1?_:_+(_-1)*(v-1)}function ws(_,v){if(!v)return _;switch(v){case"round":return Math.round(_);case"ceil":return Math.ceil(_);case"floor":return Math.floor(_);default:throw new Error("Unknown roundingMode "+v)}}function Ba(_){var v=hc(_),d=v[0],y=v[1],E=v[2];return d===1&&y===1&&E===1}function _s(_,v){return Ba(_)||Ba(v)}function ra(_){if(_==="NHWC")return"channelsLast";if(_==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+_)}function uu(_,v,d){if(v==="complex64"){if(_.dtype==="complex64")return _.clone();var y=ao(_.shape),E=_.toFloat(),B=d.complex(E,y);return y.dispose(),E.dispose(),B}if(!$e(_.dtype,v))return Ve.makeTensorFromDataId(_.dataId,_.shape,v);if(_.dtype==="complex64"){var Q=d.real(_);return B=Q.cast(v),Q.dispose(),B}if(v==="int32")return d.int(_);if(v==="bool"){var re=kr(0,_.dtype);return B=d.notEqual(_,re),re.dispose(),B}throw new Error("Error in Cast: failed to cast "+_.dtype+" to "+v)}function Gu(_,v){return Ve.makeTensorFromDataId(_.dataId,v,_.dtype)}function pc(_,v,d){var y=(v-_)/(d-1),E=Wt(d,"float32");E[0]=_;for(var B=1;B<E.length;B++)E[B]=E[B-1]+y;return ru(E,"float32")}var Fc=Object.freeze({castTensor:uu,reshapeTensor:Gu,linspaceImpl:pc,upcastType:En,axesAreInnerMostDims:gd,combineLocations:Up,computeOutAndReduceShapes:Io,expandShapeToKeepDim:Fo,assertAxesAreInnerMostDims:ta,getAxesPermutation:Ra,getUndoAxesPermutation:Vu,getInnerMostAxes:Pa,getBroadcastDims:ts,getReductionAxes:Ta,assertAndGetBroadcastShape:no,assertParamsConsistent:Zc,computeOutShape:bu,computePool2DInfo:Hu,computePool3DInfo:Nc,computeConv2DInfo:au,computeConv3DInfo:Ic,computeDefaultPad:na,tupleValuesAreOne:Ba,eitherStridesOrDilationsAreOne:_s,convertConv2DDataFormat:ra,PARALLELIZE_THRESHOLD:Yp,computeOptimalWindowSize:yf});function qu(_,v){if(_.length!==v.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+_.length+", imag: "+v.length+".");for(var d=new Float32Array(2*_.length),y=0;y<d.length;y+=2)d[y]=_[y/2],d[y+1]=v[y/2];return d}function Nl(_,v){return{real:_[2*v],imag:_[2*v+1]}}function Il(_,v,d,y){_[2*y]=v,_[2*y+1]=d}function jh(_,v,d){var y=(d?2:-2)*Math.PI*(_/v);return{real:Math.cos(y),imag:Math.sin(y)}}function Fl(_,v,d){var y=function(B,Q,re){return function(fe,xe,Oe){for(var Re=0,Le=fe.length,Be=0,Xe=!1;Re<Le;){var nt=Oe(xe,fe[Be=Re+(Le-Re>>>1)]);nt>0?Re=Be+1:(Le=Be,Xe=!nt)}return Xe?Re:-Re-1}(B,Q,re||cu)}(_,v,d),E=y<0?-(y+1):y;_.splice(E,0,v)}function cu(_,v){return _>v?1:_<v?-1:0}function $u(_,v,d,y,E){return _u(_,v,d,y,E,0).selectedIndices}function Xu(_,v,d,y,E,B){var Q=_u(_,v,d,y,E,B);return Q.numValidOutputs.dispose(),{selectedIndices:Q.selectedIndices,selectedScores:Q.selectedScores}}function _u(_,v,d,y,E,B,Q,re){re===void 0&&(re=!1);for(var fe=Array.from(v).map(function(Lt,qt){return{score:Lt,boxIndex:qt,suppressBeginIndex:0}}).filter(function(Lt){return Lt.score>E}).sort(Cd),xe=B>0?-.5/B:0,Oe=[],Re=[];Oe.length<d&&fe.length>0;){var Le=fe.pop(),Be=Le.score,Xe=Le.boxIndex,nt=Le.suppressBeginIndex;if(Be<E)break;for(var tt=!1,ut=Oe.length-1;ut>=nt;--ut){var Dt=zh(_,Xe,Oe[ut]);if(Dt>=y){tt=!0;break}if(Le.score=Le.score*kd(y,xe,Dt),Le.score<=E)break}Le.suppressBeginIndex=Oe.length,tt||(Le.score===Be?(Oe.push(Xe),Re.push(Le.score)):Le.score>E&&Fl(fe,Le,Cd))}var Rt=Oe.length;return re&&(Oe.fill(0,Rt),Re.fill(0,Rt)),{selectedIndices:ru(Oe,"int32"),selectedScores:ru(Re,"float32"),numValidOutputs:kr(Rt,"int32")}}function zh(_,v,d){var y=_.subarray(4*v,4*v+4),E=_.subarray(4*d,4*d+4),B=Math.min(y[0],y[2]),Q=Math.min(y[1],y[3]),re=Math.max(y[0],y[2]),fe=Math.max(y[1],y[3]),xe=Math.min(E[0],E[2]),Oe=Math.min(E[1],E[3]),Re=Math.max(E[0],E[2]),Le=Math.max(E[1],E[3]),Be=(re-B)*(fe-Q),Xe=(Re-xe)*(Le-Oe);if(Be<=0||Xe<=0)return 0;var nt=Math.max(B,xe),tt=Math.max(Q,Oe),ut=Math.min(re,Re),Dt=Math.min(fe,Le),Rt=Math.max(ut-nt,0)*Math.max(Dt-tt,0);return Rt/(Be+Xe-Rt)}function kd(_,v,d){var y=Math.exp(v*d*d);return d<=_?y:0}function Cd(_,v){return _.score-v.score||_.score===v.score&&v.boxIndex-_.boxIndex}function Ef(_,v,d){var y=new Array(_.rank).fill(0),E=_.shape.slice();return v.map(function(B){E[d]=B;var Q=_.slice(y,E);return y[d]+=B,Q})}function Ad(_,v){for(var d=new Array(_.rank),y=0;y<d.length;y++)d[y]=_.shape[y]*v[y];var E=Wi(d,_.dtype);for(y=0;y<E.values.length;++y){for(var B=E.indexToLoc(y),Q=new Array(_.rank),re=0;re<Q.length;re++)Q[re]=B[re]%_.shape[re];var fe=_.locToIndex(Q);E.values[y]=_.values[fe]}return E.toTensor()}function ae(_,v,d,y,E){for(var B=v[v.length-1],Q=[_.length/B,B],re=Q[0],fe=Q[1],xe=Rn(d,re*y),Oe=Rn("int32",re*y),Re=0;Re<re;Re++){for(var Le=Re*fe,Be=_.subarray(Le,Le+fe),Xe=[],nt=0;nt<Be.length;nt++)Xe.push({value:Be[nt],index:nt});Xe.sort(function(Lt,qt){return qt.value-Lt.value});var tt=Re*y,ut=xe.subarray(tt,tt+y),Dt=Oe.subarray(tt,tt+y);for(nt=0;nt<y;nt++)ut[nt]=Xe[nt].value,Dt[nt]=Xe[nt].index}var Rt=v.slice();return Rt[Rt.length-1]=y,[To(xe,Rt,d),To(Oe,Rt,"int32")]}function ne(_,v){for(var d=[],y=0;y<v.length;y++)v[y]&&d.push(y);var E=Wi(_,"int32"),B=Wi([d.length,_.length],"int32");for(y=0;y<d.length;y++){var Q=E.indexToLoc(d[y]),re=y*_.length;B.values.set(Q,re)}return B.toTensor()}function D(_,v){return["x","y","z","w","u","v"].slice(0,v).map(function(d){return _+"."+d})}function H(_,v){return v===1?[_]:D(_,v)}function ue(){var _,v,d,y,E,B,Q,re,fe,xe;return z().getNumber("WEBGL_VERSION")===2?(_="#version 300 es",v="in",d="out",y="in",E="texture",B="outputColor",Q="out vec4 outputColor;",re=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,fe="",xe=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(_="",v="attribute",d="varying",y="varying",E="texture2D",B="gl_FragColor",Q="",re=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,fe=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,xe=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:_,attribute:v,varyingVs:d,varyingFs:y,texture2D:E,output:B,defineOutput:Q,defineSpecialNaN:re,defineSpecialInf:fe,defineRound:xe}}function je(_,v,d){d===void 0&&(d="index");var y=rn(v);return y.map(function(E,B){return"int "+_[B]+" = "+d+" / "+E+"; "+(B===y.length-1?"int "+_[B+1]+" = "+d+" - "+_[B]+" * "+E:"index -= "+_[B]+" * "+E)+";"}).join("")}function Je(_){var v=rn(_).map(function(d){return d.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+v[0]+" + coords.y * "+v[1]+` + coords.z;
  }
`}var vt=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function Gt(_,v,d,y){var E=[];_.forEach(function(Be){var Xe=ze(Be.shapeInfo.logicalShape);Be.shapeInfo.isUniform?E.push("uniform float "+Be.name+(Xe>1?"["+Xe+"]":"")+";"):(E.push("uniform sampler2D "+Be.name+";"),E.push("uniform int offset"+Be.name+";"))});var B,Q,re=E.join(`
`),fe=_.map(function(Be){return function(Xe,nt,tt){tt===void 0&&(tt=!1);var ut="";ut+=tt?function Lt(qt){var pn,bn,mn;switch(qt.shapeInfo.logicalShape.length){case 0:return pn=qt.name,bn="get"+pn.charAt(0).toUpperCase()+pn.slice(1),mn=ue(),`
    vec4 `+bn+`() {
      return `+mn.texture2D+"("+pn+`, halfCR);
    }
  `;case 1:return function(Sn){var On=Sn.name,b="get"+On.charAt(0).toUpperCase()+On.slice(1),h=Sn.shapeInfo.texShape,c=[Math.ceil(h[0]/2),Math.ceil(h[1]/2)],m=ue();return`
    vec4 `+b+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+c[0]+", "+c[1]+`, index);
      return `+m.texture2D+"("+On+`, uv);
    }
  `}(qt);case 2:return function(Sn){var On=Sn.shapeInfo.logicalShape,b=Sn.name,h="get"+b.charAt(0).toUpperCase()+b.slice(1),c=Sn.shapeInfo.texShape,m=c[0],w=c[1],R=ue();if(c!=null&&Ut(On,c))return`
      vec4 `+h+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+w+".0, "+m+`.0);

        return `+R.texture2D+"("+b+`, uv);
      }
    `;var K=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],ee=Math.ceil(On[1]/2);return`
    vec4 `+h+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+ee+", "+K[0]+", "+K[1]+`, row, col);
      return `+R.texture2D+"("+b+`, uv);
    }
  `}(qt);case 3:return function(Sn){var On=Sn.shapeInfo.logicalShape,b=Sn.name,h="get"+b.charAt(0).toUpperCase()+b.slice(1),c=Sn.shapeInfo.texShape,m=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];if(On[0]===1){var w=On.slice(1),R=dr(Sn,w);return`
        `+Lt(R)+`
        vec4 `+h+`(int b, int row, int col) {
          return `+h+"("+gr(["b","row","col"],[1,2])+`);
        }
      `}var K=m[0],ee=m[1],le=Math.ceil(On[2]/2),de=le*Math.ceil(On[1]/2),_e=ue();return`
    vec4 `+h+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+K+", "+ee+", "+de+", "+le+`, b, row, col);
      return `+_e.texture2D+"("+b+`, uv);
    }
  `}(qt);default:return function(Sn){for(var On=Sn.shapeInfo.logicalShape,b=On.length,h=Sn.name,c="get"+h.charAt(0).toUpperCase()+h.slice(1),m=Sn.shapeInfo.texShape,w=[Math.ceil(m[0]/2),Math.ceil(m[1]/2)],R=w[0],K=w[1],ee=Math.ceil(On[b-1]/2),le=ee*Math.ceil(On[b-2]/2),de="int b, int row, int col",_e="b * "+le+" + (row / 2) * "+ee+" + (col / 2)",Te=2;Te<b-1;Te++)de="int b"+Te+", "+de,le*=On[b-Te-1],_e="b"+Te+" * "+le+" + "+_e;var Ne=ue();return`
    vec4 `+c+"("+de+`) {
      int index = `+_e+`;
      int texR = index / `+K+`;
      int texC = index - texR * `+K+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+K+", "+R+`);
      return `+Ne.texture2D+"("+h+`, uv);
    }
  `}(qt)}}(Xe):function Lt(qt){var pn=qt.shapeInfo.logicalShape;switch(pn.length){case 0:return function(bn){var mn=bn.name,Sn="get"+mn.charAt(0).toUpperCase()+mn.slice(1);if(bn.shapeInfo.isUniform)return"float "+Sn+"() {return "+mn+";}";var On=bn.shapeInfo.texShape,b=On[0],h=On[1];if(b===1&&h===1)return`
      float `+Sn+`() {
        return sampleTexture(`+mn+`, halfCR);
      }
    `;var c=bn.shapeInfo.texShape,m=c[0],w=c[1],R=Hn(mn);return`
    float `+Sn+`() {
      vec2 uv = uvFromFlat(`+m+", "+w+", "+R+`);
      return sampleTexture(`+mn+`, uv);
    }
  `}(qt);case 1:return function(bn){var mn=bn.name,Sn="get"+mn.charAt(0).toUpperCase()+mn.slice(1);if(bn.shapeInfo.isUniform)return`
      float `+Sn+`(int index) {
        `+nr(bn)+`
      }
    `;var On=bn.shapeInfo.texShape,b=On[0],h=On[1];if(h===1&&b===1)return`
      float `+Sn+`(int index) {
        return sampleTexture(`+mn+`, halfCR);
      }
    `;var c=Hn(mn);return h===1?`
      float `+Sn+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+c+") + 0.5) / "+b+`.0);
        return sampleTexture(`+mn+`, uv);
      }
    `:b===1?`
      float `+Sn+`(int index) {
        vec2 uv = vec2((float(index + `+c+") + 0.5) / "+h+`.0, 0.5);
        return sampleTexture(`+mn+`, uv);
      }
    `:`
    float `+Sn+`(int index) {
      vec2 uv = uvFromFlat(`+b+", "+h+", index + "+c+`);
      return sampleTexture(`+mn+`, uv);
    }
  `}(qt);case 2:return function(bn){var mn=bn.shapeInfo.logicalShape,Sn=bn.name,On="get"+Sn.charAt(0).toUpperCase()+Sn.slice(1),b=bn.shapeInfo.texShape;if(b!=null&&Ut(mn,b)){var h=b[0],c=b[1];return`
    float `+On+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+h+`.0);
      return sampleTexture(`+Sn+`, uv);
    }
  `}var m=Fn(mn),w=m.newShape,R=m.keptDims,K=w;if(K.length<mn.length){var ee=dr(bn,K);return`
      `+Lt(ee)+`
      float `+On+`(int row, int col) {
        return `+On+"("+gr(["row","col"],R)+`);
      }
    `}if(bn.shapeInfo.isUniform)return`
      float `+On+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+mn[1]+`, 1)));
        `+nr(bn)+`
      }
    `;var le=b[0],de=b[1],_e=Hn(Sn);return de===1?`
    float `+On+`(int row, int col) {
      float index = dot(vec3(row, col, `+_e+"), vec3("+mn[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+le+`.0);
      return sampleTexture(`+Sn+`, uv);
    }
  `:le===1?`
    float `+On+`(int row, int col) {
      float index = dot(vec3(row, col, `+_e+"), vec3("+mn[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+de+`.0, 0.5);
      return sampleTexture(`+Sn+`, uv);
    }
  `:`
  float `+On+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+mn[1]+" + col + "+_e+`;
    vec2 uv = uvFromFlat(`+le+", "+de+`, index);
    return sampleTexture(`+Sn+`, uv);
  }
`}(qt);case 3:return function(bn){var mn=bn.shapeInfo.logicalShape,Sn=bn.name,On="get"+Sn.charAt(0).toUpperCase()+Sn.slice(1),b=mn[1]*mn[2],h=mn[2],c=Fn(mn),m=c.newShape,w=c.keptDims,R=m;if(R.length<mn.length){var K=dr(bn,R);return`
        `+Lt(K)+`
        float `+On+`(int row, int col, int depth) {
          return `+On+"("+gr(["row","col","depth"],w)+`);
        }
      `}if(bn.shapeInfo.isUniform)return`
      float `+On+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+b+", "+h+`, 1)));
        `+nr(bn)+`
      }
    `;var ee=bn.shapeInfo.texShape,le=ee[0],de=ee[1],_e=bn.shapeInfo.flatOffset;if(de===b&&_e==null)return`
        float `+On+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+h+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+de+".0, "+le+`.0);
          return sampleTexture(`+Sn+`, uv);
        }
      `;if(de===h&&_e==null)return`
    float `+On+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+mn[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+de+".0, "+le+`.0);
      return sampleTexture(`+Sn+`, uv);
    }
  `;var Te=Hn(Sn);return`
      float `+On+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+b+" + col * "+h+" + depth + "+Te+`;
        vec2 uv = uvFromFlat(`+le+", "+de+`, index);
        return sampleTexture(`+Sn+`, uv);
      }
  `}(qt);case 4:return function(bn){var mn=bn.shapeInfo.logicalShape,Sn=bn.name,On="get"+Sn.charAt(0).toUpperCase()+Sn.slice(1),b=mn[3],h=mn[2]*b,c=mn[1]*h,m=Fn(mn),w=m.newShape,R=m.keptDims;if(w.length<mn.length){var K=dr(bn,w);return`
      `+Lt(K)+`
      float `+On+`(int row, int col, int depth, int depth2) {
        return `+On+"("+gr(["row","col","depth","depth2"],R)+`);
      }
    `}if(bn.shapeInfo.isUniform)return`
      float `+On+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+c+", "+h+", "+b+`, 1)));
        `+nr(bn)+`
      }
    `;var ee=bn.shapeInfo.flatOffset,le=bn.shapeInfo.texShape,de=le[0],_e=le[1];if(_e===c&&ee==null)return`
      float `+On+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+h+", "+b+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+_e+".0, "+de+`.0);
        return sampleTexture(`+Sn+`, uv);
      }
    `;if(_e===b&&ee==null)return`
      float `+On+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+mn[1]*mn[2]+", "+mn[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+_e+".0, "+de+`.0);
        return sampleTexture(`+Sn+`, uv);
      }
    `;var Te=Hn(Sn);return`
    float `+On+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+c+" + col * "+h+` +
          depth * `+b+` + depth2;
      vec2 uv = uvFromFlat(`+de+", "+_e+", index + "+Te+`);
      return sampleTexture(`+Sn+`, uv);
    }
  `}(qt);case 5:return function(bn){var mn=bn.shapeInfo.logicalShape,Sn=bn.name,On="get"+Sn.charAt(0).toUpperCase()+Sn.slice(1),b=mn[4],h=mn[3]*b,c=mn[2]*h,m=mn[1]*c,w=Fn(mn),R=w.newShape,K=w.keptDims;if(R.length<mn.length){var ee=dr(bn,R);return`
      `+Lt(ee)+`
      float `+On+`(int row, int col, int depth, int depth2, int depth3) {
        return `+On+"("+gr(["row","col","depth","depth2","depth3"],K)+`);
      }
    `}if(bn.shapeInfo.isUniform)return`
      float `+On+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+m+", "+c+", "+h+", "+b+`)) +
          depth3;
        `+nr(bn)+`
      }
    `;var le=bn.shapeInfo.flatOffset,de=bn.shapeInfo.texShape,_e=de[0],Te=de[1];if(Te===m&&le==null)return`
      float `+On+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+c+", "+h+", "+b+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+Te+".0, "+_e+`.0);
        return sampleTexture(`+Sn+`, uv);
      }
    `;if(Te===b&&le==null)return`
      float `+On+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+mn[1]*mn[2]*mn[3]+`,
               `+mn[2]*mn[3]+", "+mn[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+Te+".0, "+_e+`.0);
        return sampleTexture(`+Sn+`, uv);
      }
    `;var Ne=Hn(Sn);return`
    float `+On+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+m+" + col * "+c+" + depth * "+h+` +
          depth2 * `+b+" + depth3 + "+Ne+`;
      vec2 uv = uvFromFlat(`+_e+", "+Te+`, index);
      return sampleTexture(`+Sn+`, uv);
    }
  `}(qt);case 6:return function(bn){var mn=bn.shapeInfo.logicalShape,Sn=bn.name,On="get"+Sn.charAt(0).toUpperCase()+Sn.slice(1),b=Fn(mn),h=b.newShape,c=b.keptDims;if(h.length<mn.length){var m=dr(bn,h);return`
      `+Lt(m)+`
      float `+On+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+On+"("+gr(["row","col","depth","depth2","depth3","depth4"],c)+`);
      }
    `}var w=mn[5],R=mn[4]*w,K=mn[3]*R,ee=mn[2]*K,le=mn[1]*ee;if(bn.shapeInfo.isUniform)return`
      float `+On+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+le+", "+ee+", "+K+", "+R+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+w+`, 1)));
        `+nr(bn)+`
      }
    `;var de=bn.shapeInfo.flatOffset,_e=bn.shapeInfo.texShape,Te=_e[0],Ne=_e[1];if(Ne===le&&de==null)return`
      float `+On+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+ee+", "+K+", "+R+", "+w+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+Ne+".0, "+Te+`.0);
        return sampleTexture(`+Sn+`, uv);
      }
    `;if(Ne===w&&de==null)return`
      float `+On+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+mn[1]*mn[2]*mn[3]*mn[4]+`,
               `+mn[2]*mn[3]*mn[4]+`,
               `+mn[3]*mn[4]+`,
               `+mn[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+Ne+".0, "+Te+`.0);
        return sampleTexture(`+Sn+`, uv);
      }
    `;var Fe=Hn(Sn);return`
    float `+On+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+le+" + col * "+ee+" + depth * "+K+` +
          depth2 * `+R+" + depth3 * "+w+" + depth4 + "+Fe+`;
      vec2 uv = uvFromFlat(`+Te+", "+Ne+`, index);
      return sampleTexture(`+Sn+`, uv);
    }
  `}(qt);default:throw new Error(pn.length+"-D input sampling is not yet supported")}}(Xe);var Dt=Xe.shapeInfo.logicalShape,Rt=nt.logicalShape;return Dt.length<=Rt.length&&(ut+=tt?function(Lt,qt){var pn,bn=Lt.name,mn=bn.charAt(0).toUpperCase()+bn.slice(1),Sn="get"+mn+"AtOutCoords",On=Lt.shapeInfo.logicalShape.length,b=qt.logicalShape.length,h=ts(Lt.shapeInfo.logicalShape,qt.logicalShape),c=Yn(b),m=b-On,w=["x","y","z","w","u","v"];pn=On===0?"":b<2&&h.length>=1?"coords = 0;":h.map(function(Te){return"coords."+w[Te+m]+" = 0;"}).join(`
`);var R;R=b<2&&On>0?"coords":Lt.shapeInfo.logicalShape.map(function(Te,Ne){return"coords."+w[Ne+m]}).join(", ");var K="return outputValue;",ee=ze(Lt.shapeInfo.logicalShape)===1,le=ze(qt.logicalShape)===1;if(On!==1||ee||le){if(ee&&!le)K=b===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(h.length){var de=On-2,_e=On-1;h.indexOf(de)>-1&&h.indexOf(_e)>-1?K="return vec4(outputValue.x);":h.indexOf(de)>-1?K="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":h.indexOf(_e)>-1&&(K="return vec4(outputValue.xx, outputValue.zz);")}}else K=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+Sn+`() {
      `+c+` coords = getOutputCoords();
      `+pn+`
      vec4 outputValue = get`+mn+"("+R+`);
      `+K+`
    }
  `}(Xe,nt):function(Lt,qt){var pn=Lt.name,bn=pn.charAt(0).toUpperCase()+pn.slice(1),mn="get"+bn+"AtOutCoords",Sn=qt.texShape,On=Lt.shapeInfo.texShape,b=Lt.shapeInfo.logicalShape.length,h=qt.logicalShape.length;if(!Lt.shapeInfo.isUniform&&b===h&&Lt.shapeInfo.flatOffset==null&&Ut(On,Sn))return`
      float `+mn+`() {
        return sampleTexture(`+pn+`, resultUV);
      }
    `;var c=Yn(h),m=ts(Lt.shapeInfo.logicalShape,qt.logicalShape),w=h-b,R=["x","y","z","w","u","v"];return`
    float `+mn+`() {
      `+c+` coords = getOutputCoords();
      `+(b===0?"":h<2&&m.length>=1?"coords = 0;":m.map(function(K){return"coords."+R[K+w]+" = 0;"}).join(`
`))+`
      return get`+bn+"("+(h<2&&b>0?"coords":Lt.shapeInfo.logicalShape.map(function(K,ee){return"coords."+R[ee+w]}).join(", "))+`);
    }
  `}(Xe,nt)),ut}(Be,v,y)}).join(`
`),xe=v.texShape,Oe=ue(),Re=`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+Oe.texture2D+`(textureSampler, uv).r;
    }
  `,Le=function(Be){return Be.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+Be.varyingFs+` vec2 resultUV;
    `+Be.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+Be.defineSpecialNaN+`
    `+Be.defineSpecialInf+`
    `+Be.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+on+`
    `+dt+`
    `+Mn+`
  `}(Oe);return v.isPacked?(B=function(Be,Xe){switch(Be.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(Lt,qt){var pn=[Math.ceil(qt[0]/2),Math.ceil(qt[1]/2)];return pn[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+pn[1]+`.0);
      }
    `:pn[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+pn[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+pn[0]+", "+pn[1]+`));
      return 2 * (resTexRC.x * `+pn[1]+` + resTexRC.y);
    }
  `}(0,Xe);case 2:return function(Lt,qt){var pn=[Math.ceil(qt[0]/2),Math.ceil(qt[1]/2)];if(Ut(Lt,qt))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+pn[0]+", "+pn[1]+`));
      }
    `;var bn=Math.ceil(Lt[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+pn[0]+", "+pn[1]+`));

      int index = resTexRC.x * `+pn[1]+` + resTexRC.y;
      int r = 2 * (index / `+bn+`);
      int c = imod(index, `+bn+`) * 2;

      return ivec2(r, c);
    }
  `}(Be,Xe);case 3:return nt=Be,tt=Xe,ut=[Math.ceil(tt[0]/2),Math.ceil(tt[1]/2)],Rt=(Dt=Math.ceil(nt[2]/2))*Math.ceil(nt[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+ut[0]+", "+ut[1]+`));
      int index = resTexRC.x * `+ut[1]+` + resTexRC.y;

      int b = index / `+Rt+`;
      index -= b * `+Rt+`;

      int r = 2 * (index / `+Dt+`);
      int c = imod(index, `+Dt+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(Lt,qt){for(var pn=[Math.ceil(qt[0]/2),Math.ceil(qt[1]/2)],bn=Math.ceil(Lt[Lt.length-1]/2),mn=bn*Math.ceil(Lt[Lt.length-2]/2),Sn=mn,On="",b="b, r, c",h=2;h<Lt.length-1;h++)On=`
      int b`+h+" = index / "+(Sn*=Lt[Lt.length-h-1])+`;
      index -= b`+h+" * "+Sn+`;
    `+On,b="b"+h+", "+b;return`
    ivec`+Lt.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+pn[0]+", "+pn[1]+`));
      int index = resTexRC.x * `+pn[1]+` + resTexRC.y;

      `+On+`

      int b = index / `+mn+`;
      index -= b * `+mn+`;

      int r = 2 * (index / `+bn+`);
      int c = imod(index, `+bn+`) * 2;

      return ivec`+Lt.length+"("+b+`);
    }
  `}(Be,Xe)}var nt,tt,ut,Dt,Rt}(v.logicalShape,xe),Q=`
    void setOutput(vec4 val) {
      `+Oe.output+` = val;
    }
  `):(B=function(Be,Xe){switch(Be.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(ut,Dt){return Dt[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+Dt[1]+`.0);
      }
    `:Dt[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+Dt[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Dt[0]+", "+Dt[1]+`));
      return resTexRC.x * `+Dt[1]+` + resTexRC.y;
    }
  `}(0,Xe);case 2:return function(ut,Dt){return Ut(ut,Dt)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+Dt[0]+", "+Dt[1]+`));
      }
    `:ut[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+Dt[0]+", "+Dt[1]+`));
        int index = resTexRC.x * `+Dt[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:ut[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+Dt[0]+", "+Dt[1]+`));
        int index = resTexRC.x * `+Dt[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+Dt[0]+", "+Dt[1]+`));
      int index = resTexRC.x * `+Dt[1]+` + resTexRC.y;
      int r = index / `+ut[1]+`;
      int c = index - r * `+ut[1]+`;
      return ivec2(r, c);
    }
  `}(Be,Xe);case 3:return nt=Xe,tt=je(["r","c","d"],Be),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+nt[0]+", "+nt[1]+`));
      int index = resTexRC.x * `+nt[1]+` + resTexRC.y;
      `+tt+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(ut,Dt){var Rt=je(["r","c","d","d2"],ut);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+Dt[0]+", "+Dt[1]+`));
      int index = resTexRC.x * `+Dt[1]+` + resTexRC.y;
      `+Rt+`
      return ivec4(r, c, d, d2);
    }
  `}(Be,Xe);case 5:return function(ut,Dt){var Rt=je(["r","c","d","d2","d3"],ut);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+Dt[0]+`,
                             `+Dt[1]+`));

      int index = resTexRC.x * `+Dt[1]+` + resTexRC.y;

      `+Rt+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(Be,Xe);case 6:return function(ut,Dt){var Rt=je(["r","c","d","d2","d3","d4"],ut);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+Dt[0]+", "+Dt[1]+`));
      int index = resTexRC.x * `+Dt[1]+` + resTexRC.y;

      `+Rt+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(Be,Xe);default:throw new Error(Be.length+"-D output sampling is not yet supported")}var nt,tt}(v.logicalShape,xe),Q=`
    void setOutput(float val) {
      `+Oe.output+` = vec4(val, 0, 0, 0);
    }
  `),y&&(Le+=zn),[Le,Re,Q,re,B,fe,d].join(`
`)}var on=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,dt=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Mn=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,zn=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Hn(_){return"offset"+_}function nr(_){var v=_.name,d=ze(_.shapeInfo.logicalShape);return d<2?"return "+v+";":`
    for (int i = 0; i < `+d+`; i++) {
      if (i == index) {
        return `+v+`[i];
      }
    }
  `}function Yn(_){if(_<=1)return"int";if(_===2)return"ivec2";if(_===3)return"ivec3";if(_===4)return"ivec4";if(_===5)return"ivec5";if(_===6)return"ivec6";throw Error("GPU for rank "+_+" is not yet supported")}function dr(_,v){var d=JSON.parse(JSON.stringify(_));return d.shapeInfo.logicalShape=v,d}function gr(_,v){return v.map(function(d){return _[d]}).join(", ")}var Ar=function(_,v,d){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=no(v,d),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+_+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Gr="return a + b;",ii="return a - b;",Ir="return a * b;",ai="return (a < 0.) ? b * a : a;",ni=function(_,v,d){this.variableNames=["A","B"],this.outputShape=no(v,d),this.userCode=`
      float binaryOperation(float a, float b) {
        `+_+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},bi=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,_i=function(_,v,d,y){y===void 0&&(y=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=no(v,d);var E=this.outputShape.length,B="";if(y)if(E===0||ze(this.outputShape)===1)B=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(B=`
          `+Yn(E)+` coords = getOutputCoords();
        `,E===1)B+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var Q=H("coords",E);B+=`
            bool nextRowOutOfBounds =
              (`+Q[E-2]+" + 1) >= "+this.outputShape[E-2]+`;
            bool nextColOutOfBounds =
              (`+Q[E-1]+" + 1) >= "+this.outputShape[E-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+_+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+B+`

        setOutput(result);
      }
    `},oi=function(){function _(v){this.variableNames=["A"],this.outputShape=v,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return _.prototype.getCustomSetupFunc=function(v,d){var y=this;return function(E,B){y.minLoc==null&&(y.minLoc=E.getUniformLocationNoThrow(B,"minVal"),y.maxLoc=E.getUniformLocationNoThrow(B,"maxVal")),E.gl.uniform1f(y.minLoc,v),E.gl.uniform1f(y.maxLoc,d)}},_}(),pi=function(){function _(v){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=v,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return _.prototype.getCustomSetupFunc=function(v,d){var y=this;return function(E,B){y.minLoc==null&&(y.minLoc=E.getUniformLocationNoThrow(B,"minVal"),y.maxLoc=E.getUniformLocationNoThrow(B,"maxVal")),E.gl.uniform1f(y.minLoc,v),E.gl.uniform1f(y.maxLoc,d)}},_}();function fo(_,v,d){var y=_.indexOf(v);return _.map(function(E,B){return B===y?E+" - "+d:E}).join()}var lo=function(_,v,d,y){v===void 0&&(v=!1),d===void 0&&(d=null),y===void 0&&(y=!1),this.variableNames=["x","W"],this.outputShape=_.outShape;var E=_.padInfo.top,B=_.padInfo.left,Q=_.strideHeight,re=_.strideWidth,fe=_.dilationHeight,xe=_.dilationWidth,Oe=_.filterHeight,Re=_.filterWidth,Le=4*Math.floor(_.inChannels/4),Be=_.inChannels%4,Xe=_.dataFormat==="channelsLast",nt=Xe?1:2,tt=Xe?2:3,ut=Xe?3:1,Dt="",Rt="";d&&(Dt=y?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+d+`
        }`:`
          float activation(float x) {
            `+d+`
          }
        `,Rt="result = activation(result);");var Lt=v?"result += getBiasAtOutCoords();":"";v&&this.variableNames.push("bias"),y&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+Dt+`

      const ivec2 strides = ivec2(`+Q+", "+re+`);
      const ivec2 pads = ivec2(`+E+", "+B+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+ut+`];

        ivec2 xRCCorner =
            ivec2(coords[`+nt+"], coords["+tt+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+Oe+`; wR++) {
          int xR = xRCorner + wR * `+fe+`;

          if (xR < 0 || xR >= `+_.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+Re+`; wC++) {
            int xC = xCCorner + wC * `+xe+`;

            if (xC < 0 || xC >= `+_.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+Le+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+Xe+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(Be===1)+`) {

              if (`+Xe+`) {
                dotProd +=
                    getX(batch, xR, xC, `+Le+`) *
                    getW(wR, wC, `+Le+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+Le+`, xR, xC) *
                    getW(wR, wC, `+Le+`, d2);
              }

            } else if (`+(Be===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+Le+`, d2),
                getW(wR, wC, `+Le+` + 1, d2)
              );

              if (`+Xe+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+Le+`),
                  getX(batch, xR, xC, `+Le+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+Le+`, xR, xC),
                  getX(batch, `+Le+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(Be===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+Le+`, d2),
                getW(wR, wC, `+Le+` + 1, d2),
                getW(wR, wC, `+Le+` + 2, d2)
              );

              if (`+Xe+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+Le+`),
                  getX(batch, xR, xC, `+Le+` + 1),
                  getX(batch, xR, xC, `+Le+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+Le+`, xR, xC),
                  getX(batch, `+Le+` + 1, xR, xC),
                  getX(batch, `+Le+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+Lt+`
        `+Rt+`
        setOutput(result);
      }
    `},qo=function(_,v,d,y){v===void 0&&(v=!1),d===void 0&&(d=null),y===void 0&&(y=!1),this.variableNames=["x","W"],this.outputShape=_.outShape;var E=_.inHeight,B=_.inWidth,Q=_.padInfo.top,re=_.padInfo.left,fe=_.strideHeight,xe=_.strideWidth,Oe=_.dilationHeight,Re=_.dilationWidth,Le=_.filterHeight,Be=_.filterWidth,Xe=_.outChannels/_.inChannels,nt="",tt="";d&&(nt=y?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+d+`
        }`:`
          float activation(float x) {
            `+d+`
          }
        `,tt="result = activation(result);");var ut=v?"result += getBiasAtOutCoords();":"";v&&this.variableNames.push("bias"),y&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+nt+`

      const ivec2 strides = ivec2(`+fe+", "+xe+`);
      const ivec2 pads = ivec2(`+Q+", "+re+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+Xe+`;
        int q = d2 - d1 * `+Xe+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+Le+`; wR++) {
          int xR = xRCorner + wR * `+Oe+`;

          if (xR < 0 || xR >= `+E+`) {
            continue;
          }

          for (int wC = 0; wC < `+Be+`; wC++) {
            int xC = xCCorner + wC * `+Re+`;

            if (xC < 0 || xC >= `+B+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+ut+`
        `+tt+`
        setOutput(result);
      }
    `},$i=function(_,v,d,y){v===void 0&&(v=!1),d===void 0&&(d=null),y===void 0&&(y=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=_.outShape;for(var E=_.inHeight,B=_.inWidth,Q=_.padInfo.top,re=_.padInfo.left,fe=_.strideHeight,xe=_.strideWidth,Oe=_.dilationHeight,Re=_.dilationWidth,Le=_.filterHeight,Be=_.filterWidth,Xe=Be,nt="int xR; int xC; int xCOffset;",tt=0;tt<Le;tt++)for(var ut=0;ut<Be;ut++)nt+=`
          vec4 xTexelR`+tt+"C"+2*ut+` = vec4(0.);
          vec4 wR`+tt+"C"+ut+` = vec4(0.);
          vec4 xR`+tt+"C"+ut+" = vec4(0.);";for(tt=0;tt<Le;tt++)for(var Dt=0;Dt<Xe;Dt++){if(nt+=`
          xR = xRCorner + `+tt*Oe+`;
          xC = xCCorner + `+(ut=2*Dt)*Re+`;
        `,xe===1){if(ut<Be&&(nt+=re%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+E+" && xCOffset >= 0 && xCOffset < "+B+`) {
                  xTexelR`+tt+"C"+ut+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+B+`) {
                    xTexelR`+tt+"C"+ut+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+tt+"C"+ut+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+E+" && xCOffset >= 0 && xCOffset < "+B+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+B+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+tt+"C"+ut+" = vec4(previous.zw, xTexelR"+tt+"C"+ut+`.xy);
                } else {
                  xR`+tt+"C"+ut+" = vec4(0, 0, xTexelR"+tt+"C"+ut+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+E+" && xC >= 0 && xC < "+B+`) {
                  xTexelR`+tt+"C"+ut+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+tt+"C"+ut+` = vec4(0.);
                }

                xR`+tt+"C"+ut+" = xTexelR"+tt+"C"+ut+`;
              `,ut+1<Be)){var Rt=re%2==0?It(Re):Re;Re%2==0&&re%2==1||Re%2!=0&&re%2!=1?(nt+=`
                  xCOffset = xC + `+re%2+" + "+Rt+`;

                  if(xR >= 0 && xR < `+E+` &&
                    xCOffset >= 0 && xCOffset < `+B+`) {
                    xTexelR`+tt+"C"+(ut+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,Re>1&&(nt+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+E+` &&
                      xCOffset >= 0 && xCOffset < `+B+`) {
                      xTexelR`+tt+"C"+ut+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+tt+"C"+ut+` = vec4(0.);
                    }
                  `),nt+=`
                  xR`+tt+"C"+(ut+1)+` = vec4(
                    xTexelR`+tt+"C"+ut+".zw, xTexelR"+tt+"C"+(ut+2)+`.xy);
                `):nt+=`
                  xCOffset = xC + `+Rt+`;

                  if(xR >= 0 && xR < `+E+` &&
                    xCOffset >= 0 && xCOffset < `+B+`) {
                    xTexelR`+tt+"C"+(ut+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+tt+"C"+(ut+1)+" = xTexelR"+tt+"C"+(ut+2)+`;
                `}}else ut<Be&&(nt+=`
              if(xR >= 0 && xR < `+E+`) {
            `,re%2==1?(nt+=`
                xCOffset = xC + 1 - `+xe+`;
                if(xCOffset >= 0 && xCOffset < `+B+`) {
                  xTexelR`+tt+"C"+ut+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+tt+"C"+ut+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+B+`) {
                  xTexelR`+tt+"C"+(ut+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+tt+"C"+(ut+2)+` = vec4(0.);
                }

                xR`+tt+"C"+ut+` = vec4(
                  xTexelR`+tt+"C"+ut+".zw, xTexelR"+tt+"C"+(ut+2)+`.zw);
              `,ut+1<Be&&(nt+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+xe+`;
                  if(xCOffset >= 0 && xCOffset < `+B+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+tt+"C"+(ut+1)+" = vec4(xTexelR"+tt+"C"+(ut+2)+`.xy, final.xy);
                `)):(nt+=`
                if(xC >= 0 && xC < `+B+`) {
                  xTexelR`+tt+"C"+ut+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+tt+"C"+ut+` = vec4(0.);
                }

                xCOffset = xC + `+xe+`;
                if(xCOffset >= 0 && xCOffset < `+B+`) {
                  xTexelR`+tt+"C"+(ut+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+tt+"C"+(ut+2)+` = vec4(0.);
                }

                xR`+tt+"C"+ut+` = vec4(
                  xTexelR`+tt+"C"+ut+".xy, xTexelR"+tt+"C"+(ut+2)+`.xy);
              `,ut+1<Be&&(nt+=`
                  xR`+tt+"C"+(ut+1)+` = vec4(
                    xTexelR`+tt+"C"+ut+".zw, xTexelR"+tt+"C"+(ut+2)+`.zw);
                `)),nt+="}");ut<Be&&(nt+=`
            vec4 wTexelR`+tt+"C"+ut+" = getW("+tt+", "+ut+`, d1, q);
            wR`+tt+"C"+ut+" = vec4(wTexelR"+tt+"C"+ut+".xz, wTexelR"+tt+"C"+ut+`.xz);
          `,ut+1<Be&&(nt+=`
              vec4 wTexelR`+tt+"C"+(ut+1)+" = getW("+tt+", "+(ut+1)+`, d1, q);
              wR`+tt+"C"+(ut+1)+` =
                vec4(wTexelR`+tt+"C"+(ut+1)+".xz, wTexelR"+tt+"C"+(ut+1)+".xz);"))}for(tt=0;tt<Le;tt++)for(ut=0;ut<Be;ut++)nt+="dotProd += xR"+tt+"C"+ut+" * wR"+tt+"C"+ut+";";var Lt="",qt="";d&&(Lt=y?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+d+`
        }`:`vec4 activation(vec4 x) {
          `+d+`
        }`,qt="result = activation(result);");var pn=v?"result += getBiasAtOutCoords();":"";v&&this.variableNames.push("bias"),y&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+Lt+`

      const ivec2 strides = ivec2(`+fe+", "+xe+`);
      const ivec2 pads = ivec2(`+Q+", "+re+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+nt+`

        vec4 result = dotProd;
        `+pn+`
        `+qt+`
        setOutput(result);
      }
    `};function ho(_,v){if(_===1)return""+v;if(_===2)return v+".y";if(_===3)return v+".z";if(_===4)return v+".w";throw Error("Cumulative sum for rank "+_+" is not yet supported")}var fa=function(){function _(v,d,y){this.variableNames=["x"],this.outputShape=[],this.outputShape=v,this.blockSize=d,this.dataFormat=y,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+d+`;
      int offset_h = imod(h, `+d+`);
      int in_w = w / `+d+`;
      int offset_w = imod(w, `+d+`);
      int offset_d = (offset_h * `+d+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return _.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},_.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},_.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},_.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},_.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},_}(),Wo=function(_,v,d){this.variableNames=["real","imag"];var y=v[1];this.outputShape=v;var E=d?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,B=d?y+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+E+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+_+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+y+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+y+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+B+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},ia=function(){function _(v,d){this.outputShape=[],this.variableNames=["x"],this.outputShape=v,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return _.prototype.getCustomSetupFunc=function(v){var d=this;return function(y,E){d.valueLoc==null&&(d.valueLoc=y.getUniformLocationNoThrow(E,"value")),y.gl.uniform1f(d.valueLoc,v)}},_}();function Vi(_,v){var d=ue();return eo(_,v,d.version+`
    precision highp float;
    `+d.attribute+` vec3 clipSpacePos;
    `+d.attribute+` vec2 uv;
    `+d.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function Ui(_,v){return Yc(_,v,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function So(_,v){return sc(_,v,new Uint16Array([0,1,2,2,1,3]))}function ya(_,v,d,y,E,B,Q){Rp(d,y);var re=Jc(_,v),fe=_.TEXTURE_2D;return Kn(_,v,function(){return _.bindTexture(fe,re)}),Kn(_,v,function(){return _.texParameteri(fe,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE)}),Kn(_,v,function(){return _.texParameteri(fe,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE)}),Kn(_,v,function(){return _.texParameteri(fe,_.TEXTURE_MIN_FILTER,_.NEAREST)}),Kn(_,v,function(){return _.texParameteri(fe,_.TEXTURE_MAG_FILTER,_.NEAREST)}),Kn(_,v,function(){return _.texImage2D(fe,0,E,d,y,0,B,Q,null)}),Kn(_,v,function(){return _.bindTexture(_.TEXTURE_2D,null)}),re}function wa(_,v,d,y,E){var B=Zi(d,y);return ya(_,v,B[0],B[1],E.internalFormatFloat,E.textureFormatFloat,_.FLOAT)}function ha(_,v,d,y,E){var B=Zi(d,y);return ya(_,v,B[0],B[1],E.internalFormatHalfFloat,E.textureFormatFloat,E.textureTypeHalfFloat)}function oa(_,v,d,y,E){var B=Zi(d,y);return ya(_,v,B[0],B[1],_.RGBA,_.RGBA,_.UNSIGNED_BYTE)}function ls(_,v,d,y,E){var B=ei(d,y);return ya(_,v,B[0],B[1],E.internalFormatPackedFloat,_.RGBA,_.FLOAT)}function _a(_,v,d,y,E){var B=ei(d,y);return ya(_,v,B[0],B[1],E.internalFormatPackedHalfFloat,_.RGBA,E.textureTypeHalfFloat)}function ko(_,v,d,y){return Kn(_,v,function(){return _.bindBuffer(_.ARRAY_BUFFER,y)}),sd(_,v,d,"clipSpacePos",y,3,20,0)&&sd(_,v,d,"uv",y,2,20,12)}function Ma(_,v,d,y,E,B,Q){var re,fe,xe;Kn(_,v,function(){return _.bindTexture(_.TEXTURE_2D,d)}),B instanceof Uint8Array?(re=new Uint8Array(y*E*4),fe=_.UNSIGNED_BYTE,xe=_.RGBA):(re=new Float32Array(y*E*4),fe=_.FLOAT,xe=Q.internalFormatPackedFloat),re.set(B),Kn(_,v,function(){return _.texImage2D(_.TEXTURE_2D,0,xe,y,E,0,_.RGBA,fe,re)}),Kn(_,v,function(){return _.bindTexture(_.TEXTURE_2D,null)})}function Ku(_,v,d,y){Kn(_,v,function(){return _.bindTexture(_.TEXTURE_2D,d)}),y.data instanceof Uint8Array?Kn(_,v,function(){return _.texImage2D(_.TEXTURE_2D,0,_.RGBA,y.width,y.height,0,_.RGBA,_.UNSIGNED_BYTE,y.data)}):Kn(_,v,function(){return _.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,y)}),Kn(_,v,function(){return _.bindTexture(_.TEXTURE_2D,null)})}function Es(_,v,d,y,E){var B=_.createBuffer();Kn(_,v,function(){return _.bindBuffer(_.PIXEL_PACK_BUFFER,B)});var Q=16*d*y;return Kn(_,v,function(){return _.bufferData(_.PIXEL_PACK_BUFFER,Q,_.STREAM_READ)}),Kn(_,v,function(){return _.readPixels(0,0,y,d,_.RGBA,_.FLOAT,0)}),Kn(_,v,function(){return _.bindBuffer(_.PIXEL_PACK_BUFFER,null)}),B}function Ha(_,v,d){var y=_,E=new Float32Array(d);return y.bindBuffer(y.PIXEL_PACK_BUFFER,v),y.getBufferSubData(y.PIXEL_PACK_BUFFER,0,E),y.bindBuffer(y.PIXEL_PACK_BUFFER,null),E}function Bo(_,v,d,y,E){var B=Zi(d,y),Q=B[0],re=B[1],fe=new Uint8Array(d*y*4);return Kn(_,v,function(){return _.readPixels(0,0,Q,re,E.downloadTextureFormat,_.UNSIGNED_BYTE,fe)}),new Float32Array(fe.buffer)}function Rc(_,v,d,y,E,B,Q,re){var fe=_,xe=new Float32Array(function(Oe,Re){var Le=ei(B,Q);return Le[0]*Le[1]*4}());return fe.bindBuffer(fe.PIXEL_PACK_BUFFER,v),fe.getBufferSubData(fe.PIXEL_PACK_BUFFER,0,xe),fe.bindBuffer(fe.PIXEL_PACK_BUFFER,null),xe}function lu(_,v,d,y){var E=new Float32Array(d*y*4);return Kn(_,v,function(){return _.readPixels(0,0,y,d,_.RGBA,_.FLOAT,E)}),E}var $s=Object.freeze({createVertexShader:Vi,createVertexBuffer:Ui,createIndexBuffer:So,createFloat32MatrixTexture:wa,createFloat16MatrixTexture:ha,createUnsignedBytesMatrixTexture:oa,createPackedMatrixTexture:ls,createFloat16PackedMatrixTexture:_a,bindVertexProgramAttributeStreams:ko,uploadDenseMatrixToTexture:Ma,uploadPixelDataToTexture:Ku,createBufferFromOutputTexture:Es,downloadFloat32MatrixFromBuffer:Ha,downloadByteEncodedFloatMatrixFromOutputTexture:Bo,downloadPackedMatrixFromBuffer:Rc,downloadMatrixFromPackedOutputTexture:lu}),aa=function(){function _(v){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var d=z().getNumber("WEBGL_VERSION");v!=null?(this.gl=v,ki(d,v)):this.gl=Zr(d);var y="WEBGL_color_buffer_float";if(z().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=zi(this.gl,this.debug,"OES_texture_float"),xa(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=zi(this.gl,this.debug,"OES_texture_half_float");else if(z().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(y),xa(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=zi(this.gl,this.debug,"EXT_color_buffer_half_float");else if(z().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(y="EXT_color_buffer_float",xa(this.gl,y))this.colorBufferFloatExtension=this.gl.getExtension(y);else{if(!xa(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Ui(this.gl,this.debug),this.indexBuffer=So(this.gl,this.debug),this.framebuffer=ys(this.gl,this.debug),this.textureConfig=Xr(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(_.prototype,"debug",{get:function(){return z().getBool("DEBUG")},enumerable:!0,configurable:!0}),_.prototype.dispose=function(){var v=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var d=this.gl;Kn(d,this.debug,function(){return d.finish()}),Kn(d,this.debug,function(){return d.bindFramebuffer(d.FRAMEBUFFER,null)}),Kn(d,this.debug,function(){return d.deleteFramebuffer(v.framebuffer)}),Kn(d,this.debug,function(){return d.bindBuffer(d.ARRAY_BUFFER,null)}),Kn(d,this.debug,function(){return d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null)}),Kn(d,this.debug,function(){return d.deleteBuffer(v.indexBuffer)}),this.disposed=!0}},_.prototype.createFloat32MatrixTexture=function(v,d){return this.throwIfDisposed(),wa(this.gl,this.debug,v,d,this.textureConfig)},_.prototype.createFloat16MatrixTexture=function(v,d){return this.throwIfDisposed(),ha(this.gl,this.debug,v,d,this.textureConfig)},_.prototype.createUnsignedBytesMatrixTexture=function(v,d){return this.throwIfDisposed(),oa(this.gl,this.debug,v,d,this.textureConfig)},_.prototype.uploadPixelDataToTexture=function(v,d){this.throwIfDisposed(),Ku(this.gl,this.debug,v,d)},_.prototype.uploadDenseMatrixToTexture=function(v,d,y,E){this.throwIfDisposed(),Ma(this.gl,this.debug,v,d,y,E,this.textureConfig)},_.prototype.createFloat16PackedMatrixTexture=function(v,d){return this.throwIfDisposed(),_a(this.gl,this.debug,v,d,this.textureConfig)},_.prototype.createPackedMatrixTexture=function(v,d){return this.throwIfDisposed(),ls(this.gl,this.debug,v,d,this.textureConfig)},_.prototype.deleteMatrixTexture=function(v){var d=this;this.throwIfDisposed(),this.outputTexture===v&&(uf(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Kn(this.gl,this.debug,function(){return d.gl.deleteTexture(v)})},_.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(v,d,y){var E=this;return this.downloadMatrixDriver(v,function(){return Bo(E.gl,E.debug,d,y,E.textureConfig)})},_.prototype.downloadPackedMatrixFromBuffer=function(v,d,y,E,B,Q){return Rc(this.gl,v,0,0,0,B,Q,this.textureConfig)},_.prototype.downloadFloat32MatrixFromBuffer=function(v,d){return Ha(this.gl,v,d)},_.prototype.createBufferFromTexture=function(v,d,y){this.bindTextureToFrameBuffer(v);var E=Es(this.gl,this.debug,d,y,this.textureConfig);return this.unbindTextureToFrameBuffer(),E},_.prototype.createAndWaitForFence=function(){var v=this.createFence(this.gl);return this.pollFence(v)},_.prototype.createFence=function(v){var d,y,E=this;if(z().getBool("WEBGL_FENCE_API_ENABLED")){var B=v,Q=B.fenceSync(B.SYNC_GPU_COMMANDS_COMPLETE,0);v.flush(),y=function(){var re=B.clientWaitSync(Q,0,0);return re===B.ALREADY_SIGNALED||re===B.CONDITION_SATISFIED},d=Q}else z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(d=this.beginQuery(),this.endQuery(),y=function(){return E.isQueryAvailable(d,z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):y=function(){return!0};return{query:d,isFencePassed:y}},_.prototype.downloadMatrixFromPackedTexture=function(v,d,y){var E=this;return this.downloadMatrixDriver(v,function(){return lu(E.gl,E.debug,d,y)})},_.prototype.createProgram=function(v){this.throwIfDisposed();var d=this.gl,y=wo(d,this.debug,v),E=Vi(d,this.debug),B=to(d,this.debug);return Kn(d,this.debug,function(){return d.attachShader(B,E)}),Kn(d,this.debug,function(){return d.attachShader(B,y)}),Cc(d,this.debug,B),this.debug&&Uu(d,this.debug,B),this.vertexAttrsAreBound||(this.setProgram(B),this.vertexAttrsAreBound=ko(d,this.debug,this.program,this.vertexBuffer)),B},_.prototype.deleteProgram=function(v){var d=this;this.throwIfDisposed(),v===this.program&&(this.program=null),v!=null&&Kn(this.gl,this.debug,function(){return d.gl.deleteProgram(v)})},_.prototype.setProgram=function(v){var d=this;this.throwIfDisposed(),this.program=v,this.program!=null&&this.debug&&Uu(this.gl,this.debug,this.program),Kn(this.gl,this.debug,function(){return d.gl.useProgram(v)})},_.prototype.getUniformLocation=function(v,d,y){return y===void 0&&(y=!0),this.throwIfDisposed(),y?uc(this.gl,this.debug,v,d):ud(this.gl,v,d)},_.prototype.getAttributeLocation=function(v,d){var y=this;return this.throwIfDisposed(),Kn(this.gl,this.debug,function(){return y.gl.getAttribLocation(v,d)})},_.prototype.getUniformLocationNoThrow=function(v,d){return this.throwIfDisposed(),this.gl.getUniformLocation(v,d)},_.prototype.setInputMatrixTexture=function(v,d,y){this.throwIfDisposed(),this.throwIfNoProgram(),wh(this.gl,this.debug,this.program,v,d,y)},_.prototype.setOutputMatrixTexture=function(v,d,y){this.setOutputMatrixTextureDriver(v,y,d)},_.prototype.setOutputPackedMatrixTexture=function(v,d,y){this.throwIfDisposed();var E=ei(d,y),B=E[0],Q=E[1];this.setOutputMatrixTextureDriver(v,B,Q)},_.prototype.setOutputMatrixWriteRegion=function(v,d,y,E){this.setOutputMatrixWriteRegionDriver(y,v,E,d)},_.prototype.setOutputPackedMatrixWriteRegion=function(v,d,y,E){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},_.prototype.debugValidate=function(){this.program!=null&&Uu(this.gl,this.debug,this.program),Ua(this.gl)},_.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var v=this.gl;this.debug&&this.debugValidate(),Kn(v,this.debug,function(){return v.drawElements(v.TRIANGLES,6,v.UNSIGNED_SHORT,0)})},_.prototype.blockUntilAllProgramsCompleted=function(){var v=this;this.throwIfDisposed(),Kn(this.gl,this.debug,function(){return v.gl.finish()})},_.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=zi(this.gl,this.debug,z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},_.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},_.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},_.prototype.beginQuery=function(){if(z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var v=this.gl,d=this.getQueryTimerExtensionWebGL2(),y=v.createQuery();return v.beginQuery(d.TIME_ELAPSED_EXT,y),y}var E=this.getQueryTimerExtensionWebGL1(),B=E.createQueryEXT();return E.beginQueryEXT(E.TIME_ELAPSED_EXT,B),B},_.prototype.endQuery=function(){if(z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var v=this.getQueryTimerExtensionWebGL1();v.endQueryEXT(v.TIME_ELAPSED_EXT)}else{var d=this.gl,y=this.getQueryTimerExtensionWebGL2();d.endQuery(y.TIME_ELAPSED_EXT)}},_.prototype.waitForQueryAndGetTime=function(v){return N(this,void 0,void 0,function(){var d=this;return L(this,function(y){switch(y.label){case 0:return[4,xt(function(){return d.disposed||d.isQueryAvailable(v,z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return y.sent(),[2,this.getQueryTime(v,z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},_.prototype.getQueryTime=function(v,d){if(d===0)return null;if(d===2){var y=this.gl;return y.getQueryParameter(v,y.QUERY_RESULT)/1e6}var E=this.getQueryTimerExtensionWebGL1();return E.getQueryObjectEXT(v,E.QUERY_RESULT_EXT)/1e6},_.prototype.isQueryAvailable=function(v,d){if(d===0)return!0;if(d===2){var y=this.gl,E=this.getQueryTimerExtensionWebGL2(),B=y.getQueryParameter(v,y.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(E.GPU_DISJOINT_EXT)),B&&!this.disjoint}return B=(E=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(v,E.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(E.GPU_DISJOINT_EXT)),B&&!this.disjoint},_.prototype.pollFence=function(v){var d=this;return new Promise(function(y){d.addItemToPoll(function(){return v.isFencePassed()},function(){return y()})})},_.prototype.pollItems=function(){for(var v=function(y){for(var E=0;E<y.length&&y[E]();++E);return E-1}(this.itemsToPoll.map(function(y){return y.isDoneFn})),d=0;d<=v;++d)(0,this.itemsToPoll[d].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(v+1)},_.prototype.addItemToPoll=function(v,d){var y=this;this.itemsToPoll.push({isDoneFn:v,resolveFn:d}),this.itemsToPoll.length>1||xt(function(){return y.pollItems(),y.itemsToPoll.length===0})},_.prototype.bindTextureToFrameBuffer=function(v){this.throwIfDisposed(),Qc(this.gl,this.debug,v,this.framebuffer),this.debug&&Ua(this.gl)},_.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Qc(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Ua(this.gl)):uf(this.gl,this.debug,this.framebuffer)},_.prototype.downloadMatrixDriver=function(v,d){this.bindTextureToFrameBuffer(v);var y=d();return this.unbindTextureToFrameBuffer(),y},_.prototype.setOutputMatrixTextureDriver=function(v,d,y){this.throwIfDisposed();var E=this.gl;Qc(E,this.debug,v,this.framebuffer),this.debug&&Ua(E),this.outputTexture=v,Kn(E,this.debug,function(){return E.viewport(0,0,d,y)}),Kn(E,this.debug,function(){return E.scissor(0,0,d,y)})},_.prototype.setOutputMatrixWriteRegionDriver=function(v,d,y,E){var B=this;this.throwIfDisposed(),Kn(this.gl,this.debug,function(){return B.gl.scissor(v,d,y,E)})},_.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},_.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},_}();function Xs(_,v){if(_.length!==v.length)throw Error("Binary was compiled with "+_.length+" inputs, but was executed with "+v.length+" inputs");_.forEach(function(d,y){var E=d.logicalShape,B=v[y],Q=B.shape;if(!Ut(E,Q))throw Error("Binary was compiled with different shapes than the current args. Shapes "+E+" and "+Q+" must match");if(!d.isUniform||!B.isUniform){var re=d.texShape,fe=B.isUniform?null:B.texData.texShape;if(!Ut(re,fe))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+re+" and "+fe+" must match")}})}var jo=function(_,v,d,y,E,B,Q){d===void 0&&(d=!1),y===void 0&&(y=!1),E===void 0&&(E=!1),B===void 0&&(B=null),Q===void 0&&(Q=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=v;var re=d?_[1]:_[2],fe=Math.ceil(re/2),xe=d?"i * 2, rc.y":"rc.y, i * 2",Oe=y?"rc.z, i * 2":"i * 2, rc.z",Re=d?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],Le=y?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],Be="",Xe="";B&&(Be=Q?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+B+`
        }`:`vec4 activation(vec4 x) {
          `+B+`
        }`,Xe="result = activation(result);");var nt=E?"result += getBiasAtOutCoords();":"";E&&this.variableNames.push("bias"),Q&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+Be+`

      const float sharedDimension = `+fe+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+fe+`; i++) {
          vec4 a = getMatrixA(rc.x, `+xe+`);
          vec4 b = getMatrixB(rc.x, `+Oe+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+Re[0]+" * "+Le[0]+`);
          result += (`+Re[1]+" * "+Le[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+nt+`

        `+Xe+`

        setOutput(result);
      }
    `},Bs=function(){function _(v,d,y){this.variableNames=["probs"],this.outputShape=[v,y],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(d-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(d-1)+`));
      }
    `}return _.prototype.getCustomSetupFunc=function(v){var d=this;return function(y,E){d.seedLoc==null&&(d.seedLoc=y.getUniformLocation(E,"seed")),y.gl.uniform1f(d.seedLoc,v)}},_}(),Ss=function(_,v,d){if(this.variableNames=["x"],v==="avg"&&d)throw new Error("Cannot compute positions for average pool.");var y=_.filterWidth,E=_.strideHeight,B=_.strideWidth,Q=_.dilationHeight,re=_.dilationWidth,fe=_.effectiveFilterHeight,xe=_.effectiveFilterWidth,Oe=_.padInfo.top,Re=_.padInfo.left;this.outputShape=_.outShape;var Le=v==="avg",Be="0.0";if(Le||(Be="-1.0 / 1e-20"),d)this.userCode=`
        const ivec2 strides = ivec2(`+E+", "+B+`);
        const ivec2 pads = ivec2(`+Oe+", "+Re+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+fe+`;
              wR += `+Q+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+_.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+xe+`;
                wC += `+re+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+_.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+xe+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var Xe=v+"("+v+"("+v+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";v==="avg"&&(Xe="avgValue / count");var nt=4*Math.floor(y/4),tt=y%4,ut=`
      if (`+Le+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+E+", "+B+`);
      const ivec2 pads = ivec2(`+Oe+", "+Re+`);
      const float initializationValue = `+Be+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+_.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+Be+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+fe+`;
            wR += `+Q+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+_.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+nt+`; wC += 4) {
            int xC = xCCorner + wC * `+re+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+re+`, d),
              getValue(batch, xR, xC + 2 * `+re+`, d),
              getValue(batch, xR, xC + 3 * `+re+`, d)
            );

            `+ut+`
          }

          int xC = xCCorner + `+nt+`;
          if (`+(tt===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+ut+`
          } else if (`+(tt===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+re+`, d),
              initializationValue,
              initializationValue
            );

            `+ut+`
          } else if (`+(tt===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+re+`, d),
              getValue(batch, xR, xC + 2 * `+re+`, d),
              initializationValue
            );

            `+ut+`
          }
        }
        setOutput(`+Xe+`);
      }
    `}},go=function(_,v,d){if(this.variableNames=["x"],v==="avg"&&d)throw new Error("Cannot compute positions for average pool.");var y=_.filterWidth,E=_.strideDepth,B=_.strideHeight,Q=_.strideWidth,re=_.dilationDepth,fe=_.dilationHeight,xe=_.dilationWidth,Oe=_.effectiveFilterDepth,Re=_.effectiveFilterHeight,Le=_.effectiveFilterWidth,Be=_.padInfo.front,Xe=_.padInfo.top,nt=_.padInfo.left;this.outputShape=_.outShape;var tt=v==="avg",ut="0.0";if(tt||(ut="-1.0 / 1e-20"),d)this.userCode=`
        const ivec3 strides =
            ivec3(`+E+", "+B+", "+Q+`);
        const ivec3 pads = ivec3(`+Be+", "+Xe+", "+nt+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+Oe+`;
              wD += `+re+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+_.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+Re+`;
                wR += `+fe+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+_.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+Le+`;
                  wC += `+xe+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+_.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+Re+" * "+Le+` +
                      wR * `+Le+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var Dt=v+"("+v+"("+v+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";v==="avg"&&(Dt="avgValue / count");var Rt=4*Math.floor(y/4),Lt=y%4,qt=`
      if (`+tt+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+E+", "+B+", "+Q+`);
      const ivec3 pads = ivec3(`+Be+", "+Xe+", "+nt+`);
      const float initializationValue = `+ut+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+_.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+ut+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+Oe+`;
            wD += `+re+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+_.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+Re+`;
            wR += `+fe+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+_.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+Rt+`; wC += 4) {
              int xC = xCCorner + wC * `+xe+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+xe+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+xe+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+xe+`, ch)
              );

              `+qt+`
            }

            int xC = xCCorner + `+Rt+`;
            if (`+(Lt===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+qt+`
            } else if (`+(Lt===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+xe+`, ch),
                initializationValue,
                initializationValue
              );

              `+qt+`
            } else if (`+(Lt===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+xe+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+xe+`, ch),
                initializationValue
              );

              `+qt+`
            }
          }
          setOutput(`+Dt+`);
        }
      }
    `}},js=function(_,v,d,y,E,B,Q){this.variableNames=["updates","indices","defaultValue"],this.outputShape=B;var re=Yn(E.length),fe=Yn(B.length),xe="";d===1?xe="i":d===2&&(xe="i, j");var Oe="getIndices("+xe+")",Re="";y===1?Re="i":y===2&&(Re="i, coords[1]");var Le="getUpdates("+Re+")",Be=v>1?"strides[j]":"strides";this.userCode=`
        `+re+" strides = "+re+"("+E+`);

        void main() {
          `+fe+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+_+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+v+`; j++) {
              int index = round(`+Oe+`);
              flattenedIndex += index * `+Be+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+Le+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},ns=function(){function _(v){this.variableNames=["source"],this.outputShape=v,this.rank=v.length;var d,y=Yn(this.rank),E="uniform int start["+this.rank+"];",B=function(Q){if(Q===1)return"sourceLoc";if(Q<=6)return fu.slice(0,Q).map(function(re){return"sourceLoc."+re}).join(",");throw Error("Slicing for rank "+Q+" is not yet supported")}(this.rank);d=`
        `+y+` sourceLoc;
        `+y+` coords = getOutputCoords();
        `+v.map(function(Q,re){return"sourceLoc."+fu[re]+" = start["+re+"] + coords."+fu[re]+";"}).join(`
`)+`
      `,this.userCode=`
      `+E+`
      void main() {
        `+d+`
        setOutput(getSource(`+B+`));
      }
    `}return _.prototype.getCustomSetupFunc=function(v){var d=this;if(v.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+v.length+")");return function(y,E){d.startLoc==null&&(d.startLoc=y.getUniformLocationNoThrow(E,"start"),d.startLoc==null)||y.gl.uniform1iv(d.startLoc,v)}},_}(),fu=["x","y","z","w","u","v"],il=function(){function _(v){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=v,this.rank=v.length;var d=Yn(this.rank),y=H("coords",this.rank),E=H("sourceLoc",this.rank),B=this.rank===1?"sourceLoc":"vec2("+E.slice(-2).join()+")",Q="getChannel(getSource("+E.join()+"), "+B+")",re=`
      result.x = `+Q+`;
      if (++`+y[this.rank-1]+" < "+v[this.rank-1]+`) {
        ++`+E[this.rank-1]+`;
        result.y = `+Q+`;
        --`+E[this.rank-1]+`;
      }
    `,fe=this.rank===1?"":`
      --`+y[this.rank-1]+`;
      if (++`+y[this.rank-2]+" < "+v[this.rank-2]+`) {
        ++`+E[this.rank-2]+`;
        result.z = `+Q+`;
        if (++`+y[this.rank-1]+" < "+v[this.rank-1]+`) {
          ++`+E[this.rank-1]+`;
          result.w = `+Q+`;
        }
      }
    `,xe=this.rank<=4?`sourceLoc = coords +
            `+d+"("+v.map(function(Oe,Re){return"start["+Re+"]"}).join()+");":v.map(function(Oe,Re){return E[Re]+" = "+y[Re]+" + start["+Re+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+d+` coords = getOutputCoords();
        `+d+` sourceLoc;
        `+xe+`
        vec4 result = vec4(0.);
        `+re+`
        `+fe+`
        setOutput(result);
      }
    `}return _.prototype.getCustomSetupFunc=function(v){var d=this;if(v.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+v.length+")");return function(y,E){d.startLoc==null&&(d.startLoc=y.getUniformLocationNoThrow(E,"start"),d.startLoc==null)||y.gl.uniform1iv(d.startLoc,v)}},_}(),$o=function(){function _(v){this.gpgpu=v,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return _.prototype.acquireTexture=function(v,d,y){var E,B=fs(d,y),Q=Ga(v,B,y);if(Q in this.freeTextures||(this.freeTextures[Q]=[]),Q in this.usedTextures||(this.usedTextures[Q]=[]),this.freeTextures[Q].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var re=this.freeTextures[Q].shift();return this.usedTextures[Q].push(re),re}return this.numUsedTextures++,this.log(),B===Br.PACKED_2X2_FLOAT32?E=this.gpgpu.createPackedMatrixTexture(v[0],v[1]):B===Br.PACKED_2X2_FLOAT16?E=this.gpgpu.createFloat16PackedMatrixTexture(v[0],v[1]):B===Br.UNPACKED_FLOAT32?E=this.gpgpu.createFloat32MatrixTexture(v[0],v[1]):B===Br.UNPACKED_FLOAT16?E=this.gpgpu.createFloat16MatrixTexture(v[0],v[1]):B===Br.PACKED_4X1_UNSIGNED_BYTE&&(E=this.gpgpu.createUnsignedBytesMatrixTexture(v[0],v[1])),this.usedTextures[Q].push(E),E},_.prototype.releaseTexture=function(v,d,y,E){if(this.freeTextures!=null){var B=Ga(d,fs(y,E),E);B in this.freeTextures||(this.freeTextures[B]=[]),this.freeTextures[B].push(v),this.numFreeTextures++,this.numUsedTextures--;var Q=this.usedTextures[B],re=Q.indexOf(v);if(re<0)throw new Error("Cannot release a texture that was never provided by this texture manager");Q.splice(re,1),this.log()}},_.prototype.log=function(){if(this.logEnabled){var v=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+v+")")}},_.prototype.getNumUsedTextures=function(){return this.numUsedTextures},_.prototype.getNumFreeTextures=function(){return this.numFreeTextures},_.prototype.dispose=function(){var v=this;if(this.freeTextures!=null){for(var d in this.freeTextures)this.freeTextures[d].forEach(function(y){v.gpgpu.deleteMatrixTexture(y)});for(var d in this.usedTextures)this.usedTextures[d].forEach(function(E){v.gpgpu.deleteMatrixTexture(E)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},_}();function fs(_,v){if(_===cr.UPLOAD)return Br.PACKED_2X2_FLOAT32;if(_===cr.RENDER||_==null)return function(d){return z().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?d?Br.PACKED_2X2_FLOAT32:Br.UNPACKED_FLOAT32:d?Br.PACKED_2X2_FLOAT16:Br.UNPACKED_FLOAT16}(v);if(_===cr.DOWNLOAD||_===cr.PIXELS)return Br.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+_)}function Ga(_,v,d){return _[0]+"_"+_[1]+"_"+v+"_"+d}var Pc=1.7580993408473768,Rl=1.0507009873554805,wi=function(_,v){this.variableNames=["A"],this.outputShape=_,this.userCode=`
      float unaryOperation(float x) {
        `+v+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},tm="if (isnan(x)) return x;",Pl="return x;",Sf="return abs(x);",rv=tm+`
  return (x < 0.0) ? 0.0 : x;
`,iv=tm+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Yg="return (x >= 0.0) ? x : (exp(x) - 1.0);",Jg="return -x;",ov="return ceil(x);",Qg="return floor(x);",av="return exp(x);",Od="return exp(x) - 1.0;",nm="return x;",sv="return x;",uv=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cv=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,ol=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Td=function(_,v){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=_,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+v+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},rm={};function Zg(_,v){if(v===void 0&&(v=!1),_==="linear")return v?sv:Pl;if(_==="relu")return v?uv:rv;if(_==="elu")return v?ol:Yg;if(_==="relu6")return v?cv:iv;if(_==="prelu")return v?bi:ai;throw new Error("Activation "+_+" has not been implemented for the WebGL backend.")}var e0=600,Sy=function(_){function v(d){var y,E=_.call(this)||this;if(E.pendingRead=new WeakMap,E.pendingDisposal=new WeakSet,E.dataRefCount=new WeakMap,E.numBytesInGPU=0,E.uploadWaitMs=0,E.downloadWaitMs=0,E.warnedAboutMemory=!1,E.pendingDeletes=0,E.disposed=!1,!z().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(d==null){var B=Zr(z().getNumber("WEBGL_VERSION"));E.binaryCache=((y=z().getNumber("WEBGL_VERSION"))in rm||(rm[y]={}),rm[y]),E.gpgpu=new aa(B),E.canvas=B.canvas,E.gpgpuCreatedLocally=!0}else E.gpgpu=d,E.binaryCache={},E.gpgpuCreatedLocally=!1,E.canvas=d.gl.canvas;return E.textureManager=new $o(E.gpgpu),E.numMBBeforeWarning=z().global.screen==null?1024:z().global.screen.height*z().global.screen.width*window.devicePixelRatio*e0/1024/1024,E.texData=new _f(E,Ve),E}return j(v,_),v.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},v.prototype.write=function(d,y,E){if(z().getBool("DEBUG")&&this.checkNumericalProblems(d),E==="complex64"&&d!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var B={};return this.texData.set(B,{shape:y,dtype:E,values:d,usage:cr.UPLOAD}),B},v.prototype.move=function(d,y,E,B){if(z().getBool("DEBUG")&&this.checkNumericalProblems(y),B==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(d,{shape:E,dtype:B,values:y,usage:cr.UPLOAD})},v.prototype.readSync=function(d){var y=this.texData.get(d),E=y.values,B=y.dtype,Q=y.complexTensors,re=y.slice,fe=y.shape,xe=y.isPacked;if(re!=null){var Oe;Oe=xe?new Td(fe,nm):new wi(fe,nm);var Re=this.runWebGLProgram(Oe,[{dataId:d,shape:fe,dtype:B}],B),Le=this.readSync(Re.dataId);return this.disposeData(Re.dataId),Le}if(E!=null)return this.convertAndCacheOnCPU(d);if(B==="string")return E;var Be,Xe,nt=this.activeTimers!=null;return nt&&(Be=Zt()),Xe=B==="complex64"?qu(Q.real.dataSync(),Q.imag.dataSync()):this.getValuesFromTexture(d),nt&&(this.downloadWaitMs+=Zt()-Be),this.convertAndCacheOnCPU(d,Xe)},v.prototype.read=function(d){return N(this,void 0,void 0,function(){var y,E,B,Q,re,fe,xe,Oe,Re,Le,Be,Xe,nt,tt,ut,Dt,Rt,Lt,qt,pn,bn,mn;return L(this,function(Sn){switch(Sn.label){case 0:if(this.pendingRead.has(d))return y=this.pendingRead.get(d),[2,new Promise(function(On){return y.push(On)})];if(E=this.texData.get(d),B=E.values,Q=E.shape,re=E.slice,fe=E.dtype,xe=E.complexTensors,Oe=E.isPacked,re!=null)return Re=void 0,Re=Oe?new Td(Q,nm):new wi(Q,nm),Le=this.runWebGLProgram(Re,[{dataId:d,shape:Q,dtype:fe}],fe),Be=this.read(Le.dataId),this.disposeData(Le.dataId),[2,Be];if(B!=null)return[2,this.convertAndCacheOnCPU(d)];if(!z().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&z().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return Xe=null,fe!=="complex64"&&z().get("WEBGL_BUFFER_SUPPORTED")&&(nt=this.decode(d),tt=this.texData.get(nt.dataId),Xe=(mn=this.gpgpu).createBufferFromTexture.apply(mn,[tt.texture].concat(gi(Q)))),this.pendingRead.set(d,[]),fe==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:Sn.sent(),Sn.label=2;case 2:return fe!=="complex64"?[3,4]:[4,Promise.all([xe.real.data(),xe.imag.data()])];case 3:return Dt=Sn.sent(),Rt=Dt[0],Lt=Dt[1],ut=qu(Rt,Lt),[3,5];case 4:Xe==null?ut=this.getValuesFromTexture(d):(qt=ze(Q),ut=this.gpgpu.downloadFloat32MatrixFromBuffer(Xe,qt)),Sn.label=5;case 5:return nt!=null&&this.disposeData(nt.dataId),pn=this.convertAndCacheOnCPU(d,ut),bn=this.pendingRead.get(d),this.pendingRead.delete(d),bn.forEach(function(On){return On(pn)}),this.pendingDisposal.has(d)&&(this.pendingDisposal.delete(d),this.disposeData(d),this.pendingDeletes--),[2,pn]}})})},v.prototype.checkNumericalProblems=function(d){if(d!=null)for(var y=0;y<d.length;y++){var E=d[y];if(!zr(E))throw z().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+E+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+E+" cannot be represented on this device.")}},v.prototype.getValuesFromTexture=function(d){var y,E=this.texData.get(d),B=E.shape,Q=E.dtype,re=E.isPacked,fe=ze(B);if(z().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var xe=this.decode(d),Oe=this.texData.get(xe.dataId),Re=(y=this.gpgpu).downloadMatrixFromPackedTexture.apply(y,[Oe.texture].concat(gi(B))).subarray(0,fe);return this.disposeData(xe.dataId),Re}var Le=z().getBool("WEBGL_PACK")&&re===!0,Be=Le?Oc(B):B,Xe=Le?new function(Dt){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=cr.DOWNLOAD;var Rt=ue();this.outputShape=Dt,this.userCode=`
      `+vt+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+Rt.output+` = encode_float(x);
      }
    `}(Be):new function(Dt){this.variableNames=["A"],this.outTexUsage=cr.DOWNLOAD;var Rt=ue();this.outputShape=Dt,this.userCode=`
      `+vt+`

      void main() {
        float x = getAAtOutCoords();
        `+Rt.output+` = encode_float(x);
      }
    `}(Be),nt=this.runWebGLProgram(Xe,[{shape:Be,dtype:Q,dataId:d}],"float32"),tt=this.texData.get(nt.dataId),ut=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(tt.texture,tt.texShape[0],tt.texShape[1]).subarray(0,fe);return this.disposeData(nt.dataId),ut},v.prototype.time=function(d){return N(this,void 0,void 0,function(){var y,E,B,Q,re,fe,xe;return L(this,function(Oe){switch(Oe.label){case 0:return y=this.activeTimers,E=[],B=!1,this.programTimersStack==null?(this.programTimersStack=E,B=!0):this.activeTimers.push(E),this.activeTimers=E,d(),Q=Mt(this.activeTimers.map(function(Re){return Re.query})).filter(function(Re){return Re!=null}),re=Mt(this.activeTimers.map(function(Re){return Re.name})).filter(function(Re){return Re!=null}),this.activeTimers=y,B&&(this.programTimersStack=null),fe={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(Q)]:[3,2];case 1:return xe=Oe.sent(),fe.kernelMs=St(xe),fe.getExtraProfileInfo=function(){return xe.map(function(Re,Le){return{name:re[Le],ms:Re}}).map(function(Re){return Re.name+": "+Re.ms}).join(", ")},[3,3];case 2:fe.kernelMs={error:"WebGL query timers are not supported in this environment."},Oe.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,fe]}})})},v.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},v.prototype.startTimer=function(){return z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Zt(),endMs:null}},v.prototype.endTimer=function(d){return z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),d):(d.endMs=Zt(),d)},v.prototype.getQueryTime=function(d){return N(this,void 0,void 0,function(){var y;return L(this,function(E){return z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(d)]:[2,(y=d).endMs-y.startMs]})})},v.prototype.disposeData=function(d){if(!this.pendingDisposal.has(d)){if(this.pendingRead.has(d))return this.pendingDisposal.add(d),void this.pendingDeletes++;if(this.texData.has(d)){this.releaseGPUData(d);var y=this.texData.get(d).complexTensors;y!=null&&(y.real.dispose(),y.imag.dispose()),this.texData.delete(d)}}},v.prototype.releaseGPUData=function(d){var y=this.texData.get(d),E=y.texture,B=y.dtype,Q=y.texShape,re=y.usage,fe=y.isPacked,xe=y.slice,Oe=xe&&xe.origDataId||d,Re=this.dataRefCount.get(Oe);Re>1?this.dataRefCount.set(Oe,Re-1):(this.dataRefCount.delete(Oe),E!=null&&(this.numBytesInGPU-=this.computeBytes(Q,B),this.textureManager.releaseTexture(E,Q,re,fe)));var Le=this.texData.get(d);Le.texture=null,Le.texShape=null,Le.isPacked=!1,Le.slice=null},v.prototype.getTexture=function(d){return this.uploadToGPU(d),this.texData.get(d).texture},v.prototype.getDataInfo=function(d){return this.texData.get(d)},v.prototype.getCPUBackend=function(){return z().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=Ve.findBackend("cpu")),this.cpuBackend):null},v.prototype.shouldExecuteOnCPU=function(d,y){var E=this;return y===void 0&&(y=128),this.getCPUBackend()!=null&&d.every(function(B){return E.texData.get(B.dataId).texture==null&&B.size<y})},v.prototype.getGPGPUContext=function(){return this.gpgpu},v.prototype.complex=function(d,y){var E=this.makeOutput(d.shape,"complex64");return this.texData.get(E.dataId).complexTensors={real:Ve.keep(d.clone()),imag:Ve.keep(y.clone())},E},v.prototype.real=function(d){return this.texData.get(d.dataId).complexTensors.real.clone()},v.prototype.imag=function(d){return this.texData.get(d.dataId).complexTensors.imag.clone()},v.prototype.slice=function(d,y,E){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.slice(d,y,E);if(ze(E)===0)return To([],E,d.dtype);var B=this.texData.get(d.dataId).isPacked,Q=_d(d.shape,y,E);if(B||!Q){var re=z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new il(E):new ns(E),fe=re.getCustomSetupFunc(y);return this.compileAndRun(re,[d],null,fe)}return this.uploadToGPU(d.dataId),this.shallowSlice(d,y,E)},v.prototype.shallowSlice=function(d,y,E){var B=this.texData.get(d.dataId),Q=this.makeOutput(E,d.dtype),re=this.texData.get(Q.dataId);Object.assign(re,B),re.shape=E,re.dtype=d.dtype;var fe=Bh(y,d.strides);B.slice&&(fe+=B.slice.flatOffset),re.slice={flatOffset:fe,origDataId:B.slice&&B.slice.origDataId||d.dataId};var xe=this.dataRefCount.get(re.slice.origDataId)||1;return this.dataRefCount.set(re.slice.origDataId,xe+1),Q},v.prototype.stridedSlice=function(d,y,E,B){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.stridedSlice(d,y,E,B);var Q=bf(y,E,B);if(Q.some(function(fe){return fe===0}))return To([],Q);var re=new function(fe,xe,Oe){this.variableNames=["x"],this.outputShape=Oe;var Re=Oe.length,Le=Yn(Oe.length),Be=Yn(Oe.length),Xe="";if(Re===1)Xe="coords * strides + begin";else{var nt=0;Xe=Oe.map(function(tt,ut){return nt++,Oe.length===1?"coords * strides["+ut+"] + begin["+ut+"]":"coords["+(nt-1)+"] * strides["+ut+"] + begin["+ut+"]"}).join(",")}this.userCode=`
      `+Le+" begin = "+Le+"("+fe+`);
      `+Le+" strides = "+Le+"("+xe+`);

      void main() {
        `+Be+` coords = getOutputCoords();
        setOutput(getX(`+Xe+`));
      }
    `}(y,B,Q);return this.compileAndRun(re,[d])},v.prototype.reverse=function(d,y){var E=z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(B,Q){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var re=B.length;if(re>4)throw new Error("WebGL backend: Reverse of rank-"+re+" tensor is not yet supported");this.outputShape=B;var fe=H("rc",re),xe=fe[re-1]+" + 1 < "+this.outputShape[re-1],Oe=fe[re-2]+" + 1 < "+this.outputShape[re-2],Re=Yn(re);function Le(Be){var Xe=B.map(function(nt,tt){return function(ut,Dt){return Q.indexOf(ut)!==-1&&B[ut]!==1?B[ut]+" - "+Dt[ut]+" - 1":""+Dt[ut]}(tt,Be)});return"getChannel(getX("+Xe.join(",")+"), vec2("+Xe.slice(-2).join(",")+"))"}this.userCode=re===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+B[0]+` - rc - 1),
            `+B[0]+` - rc - 1);
          if(`+xe+`){
              result.g = getChannel(getX(`+B[0]+` - (rc  + 1) - 1),
                `+B[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+Re+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+Le(fe.slice())+`;
          if(`+xe+`){
            result.g = `+function(Be){return Be[re-1]="("+Be[re-1]+" + 1)",Le(Be)}(fe.slice())+`;
          }
          if(`+Oe+`) {
            result.b = `+function(Be){return Be[re-2]="("+Be[re-2]+" + 1)",Le(Be)}(fe.slice())+`;
            if(`+xe+`) {
              result.a = `+function(Be){return Be[re-1]="("+Be[re-1]+" + 1)",Be[re-2]="("+Be[re-2]+" + 1)",Le(Be)}(fe.slice())+`;
            }
          }
          setOutput(result);
        }
    `}(d.shape,y):new function(B,Q){this.variableNames=["x"];var re=B.length;if(re>4)throw new Error("WebGL backend: Reverse of rank-"+re+" tensor is not yet supported");if(this.outputShape=B,re!==1){var fe=B.map(function(Oe,Re){return function(Le){return Q.indexOf(Le)!==-1&&B[Le]!==1?B[Le]+" - coords["+Le+"] - 1":"coords["+Le+"]"}(Re)}).join(","),xe=Yn(re);this.userCode=`
      void main() {
        `+xe+` coords = getOutputCoords();
        setOutput(getX(`+fe+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+B[0]+` - coord - 1));
        }
      `}(d.shape,y);return this.compileAndRun(E,[d])},v.prototype.concat=function(d,y){if(d[0].dtype==="complex64"){var E=d.map(function(Be){return va(Be)}),B=d.map(function(Be){return Ya(Be)});return _o(this.concat(E,y),this.concat(B,y))}if(this.shouldExecuteOnCPU(d))return this.cpuBackend.concat(d,y);if(d.length===1)return d[0];if(d.length>z().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var Q=Math.floor(d.length/2),re=this.concat(d.slice(0,Q),y),fe=this.concat(d.slice(Q),y);return this.concat([re,fe],y)}if(z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&d[0].rank>1){var xe=new function(Be,Xe){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=bu(Be,Xe);var nt=this.outputShape,tt=nt.length,ut=Yn(tt),Dt=H("coords",tt),Rt=["x","y","z","w","u","v"].slice(0,tt);this.variableNames=Be.map(function(c,m){return"T"+m});var Lt=new Array(Be.length-1);Lt[0]=Be[0][Xe];for(var qt=1;qt<Lt.length;qt++)Lt[qt]=Lt[qt-1]+Be[qt][Xe];var pn=Rt[Xe],bn=Rt.slice(-2),mn=Rt.join(),Sn="if ("+pn+" < "+Lt[0]+`) {
        return getChannel(
            getT0(`+mn+"), vec2("+bn.join()+`));
        }`;for(qt=1;qt<Lt.length;qt++){var On=Lt[qt-1];Sn+=`
        if (`+pn+" < "+Lt[qt]+"  && "+pn+" >= "+Lt[qt-1]+`) {
          return getChannel(
            getT`+qt+"("+fo(Rt,pn,On)+`),
            vec2(`+fo(bn,pn,On)+`));
        }`}var b=Lt.length,h=Lt[Lt.length-1];Sn+=`
        return getChannel(
          getT`+b+"("+fo(Rt,pn,h)+`),
          vec2(`+fo(bn,pn,h)+"));",this.userCode=`
      float getValue(`+Rt.map(function(c){return"int "+c})+`) {
        `+Sn+`
      }

      void main() {
        `+ut+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+Dt+`), 0., 0., 0.);

        `+Dt[tt-1]+" = "+Dt[tt-1]+` + 1;
        if (`+Dt[tt-1]+" < "+nt[tt-1]+`) {
          result.g = getValue(`+Dt+`);
        }

        `+Dt[tt-2]+" = "+Dt[tt-2]+` + 1;
        if (`+Dt[tt-2]+" < "+nt[tt-2]+`) {
          result.a = getValue(`+Dt+`);
        }

        `+Dt[tt-1]+" = "+Dt[tt-1]+` - 1;
        if (`+Dt[tt-2]+" < "+nt[tt-2]+` &&
            `+Dt[tt-1]+" < "+nt[tt-1]+`) {
          result.b = getValue(`+Dt+`);
        }
        setOutput(result);
      }
    `}(d.map(function(Be){return Be.shape}),y);return this.compileAndRun(xe,d)}var Oe=bu(d.map(function(Be){return Be.shape}),y),Re=d.map(function(Be){return Be.as2D(-1,ze(Be.shape.slice(y)))}),Le=new function(Be){this.outputShape=[],this.outputShape=bu(Be,1),this.variableNames=Be.map(function(Lt,qt){return"T"+qt});var Xe=new Array(Be.length-1);Xe[0]=Be[0][1];for(var nt=1;nt<Xe.length;nt++)Xe[nt]=Xe[nt-1]+Be[nt][1];var tt=["if (yC < "+Xe[0]+") setOutput(getT0(yR, yC));"];for(nt=1;nt<Xe.length;nt++){var ut=Xe[nt-1];tt.push("else if (yC < "+Xe[nt]+") setOutput(getT"+nt+"(yR, yC-"+ut+"));")}var Dt=Xe.length,Rt=Xe[Xe.length-1];tt.push("else setOutput(getT"+Dt+"(yR, yC-"+Rt+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+tt.join(`
        `)+`
      }
    `}(Re.map(function(Be){return Be.shape}));return this.compileAndRun(Le,Re).reshape(Oe)},v.prototype.neg=function(d){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.neg(d);if(z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(d,Jg,d.dtype);var y=new wi(d.shape,Jg);return this.compileAndRun(y,[d])},v.prototype.batchMatMul=function(d,y,E,B){var Q=E?d.shape[2]:d.shape[1],re=B?y.shape[1]:y.shape[2],fe=E?d.shape[1]:d.shape[2],xe=d.shape[0];if((Q===1||re===1)&&fe>1e3){E&&(d=d.transpose([0,2,1])),B&&(y=y.transpose([0,2,1]));var Oe=re===1?d:d.as3D(xe,fe,1),Re=re===1?2:1,Le=re===1?y.as3D(xe,1,fe):y;return this.multiply(Oe,Le).sum(Re,!0)}var Be=En(d.dtype,y.dtype),Xe=new jo(d.shape,[xe,Q,re],E,B);return this.compileAndRun(Xe,[d,y],Be)},v.prototype.fusedBatchMatMul=function(d){var y=d.a,E=d.b,B=d.transposeA,Q=d.transposeB,re=d.bias,fe=d.activation,xe=d.preluActivationWeights,Oe=B?y.shape[2]:y.shape[1],Re=Q?E.shape[1]:E.shape[2],Le=y.shape[0],Be=En(y.dtype,E.dtype),Xe=re!=null,nt=xe!=null,tt=fe?Zg(fe,!0):null,ut=new jo(y.shape,[Le,Oe,Re],B,Q,Xe,tt,nt),Dt=[y,E];return re&&Dt.push(re),xe&&Dt.push(xe),this.compileAndRun(ut,Dt,Be)},v.prototype.multiply=function(d,y){if(d.dtype==="complex64"){var E=this.texData.get(d.dataId),B=this.texData.get(y.dataId),Q=new Ar("return areal * breal - aimag * bimag;",d.shape,y.shape),re=new Ar("return areal * bimag + aimag * breal;",d.shape,y.shape),fe=[this.makeComplexComponentTensorInfo(d,E.complexTensors.real),this.makeComplexComponentTensorInfo(d,E.complexTensors.imag),this.makeComplexComponentTensorInfo(y,B.complexTensors.real),this.makeComplexComponentTensorInfo(y,B.complexTensors.imag)],xe=this.compileAndRun(Q,fe),Oe=this.compileAndRun(re,fe),Re=this.complex(xe,Oe);return xe.dispose(),Oe.dispose(),Re}if(this.shouldExecuteOnCPU([d,y]))return this.cpuBackend.multiply(d,y);if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,Ir,d.dtype);var Le=new ni(Ir,d.shape,y.shape);return this.compileAndRun(Le,[d,y],d.dtype)},v.prototype.batchNormalization=function(d,y,E,B,Q,re){var fe=[d,y,E],xe=null;re!=null&&(xe=re.shape,fe.push(re));var Oe=null;if(Q!=null&&(Oe=Q.shape,fe.push(Q)),z().getBool("WEBGL_PACK_NORMALIZATION")){var Re=new function(Be,Xe,nt,tt,ut,Dt){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],no(Be,Xe),no(Be,nt);var Rt="vec4(0.0)";tt!=null&&(no(Be,tt),this.variableNames.push("offset"),Rt="getOffsetAtOutCoords()");var Lt="vec4(1.0)";ut!=null&&(no(Be,ut),this.variableNames.push("scale"),Lt="getScaleAtOutCoords()"),this.outputShape=Be,this.userCode=`
      void main() {
        vec4 offset = `+Rt+`;
        vec4 scale = `+Lt+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+Dt+`));

        setOutput((x - mean) * inv + offset);
      }
    `}(d.shape,y.shape,E.shape,xe,Oe,B);return this.compileAndRun(Re,fe)}var Le=new function(Be,Xe,nt,tt,ut,Dt){this.outputShape=[],this.variableNames=["x","mean","variance"],no(Be,Xe),no(Be,nt);var Rt="0.0";tt!=null&&(no(Be,tt),this.variableNames.push("offset"),Rt="getOffsetAtOutCoords()");var Lt="1.0";ut!=null&&(no(Be,ut),this.variableNames.push("scale"),Lt="getScaleAtOutCoords()"),this.outputShape=Be,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+Rt+`;
        float scale = `+Lt+`;
        float inv = scale * inversesqrt(variance + float(`+Dt+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}(d.shape,y.shape,E.shape,xe,Oe,B);return this.compileAndRun(Le,fe)},v.prototype.localResponseNormalization4D=function(d,y,E,B,Q){var re=z().getBool("WEBGL_PACK_NORMALIZATION")?new function(fe,xe,Oe,Re,Le){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var Be,Xe=xe,nt=fe[3]-1;this.outputShape=fe;var tt="float("+Oe+") + float("+Re+") * sum";Be=Le===.5?"inversesqrt("+tt+")":Le===1?"1.0/("+tt+")":"exp(log("+tt+") * float(-"+Le+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+Xe+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+Xe+"; j <= "+Xe+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+nt+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+Be+`;
        setOutput(result);
      }
    `}(d.shape,y,E,B,Q):new function(fe,xe,Oe,Re,Le){this.variableNames=["x"],this.outputShape=[];var Be,Xe=xe,nt=fe[3]-1;this.outputShape=fe;var tt="float("+Oe+") + float("+Re+") * sum";Be=Le===.5?"inversesqrt("+tt+")":Le===1?"1.0/("+tt+")":"exp(log("+tt+") * float(-"+Le+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+Xe+"; j <= "+Xe+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+nt+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+Be+`;
        setOutput(val);
      }
    `}(d.shape,y,E,B,Q);return this.compileAndRun(re,[d])},v.prototype.LRNGrad=function(d,y,E,B,Q,re,fe){var xe=new function(Oe,Re,Le,Be,Xe){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=Oe,this.depth=Oe[3],this.depthRadius=Re,this.bias=Le,this.alpha=Be,this.beta=Xe,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+Re+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+Re+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+Be+") * norm + float("+Le+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+Be+`)
                * float(`+Xe+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+Xe+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}(y.shape,B,Q,re,fe);return this.compileAndRun(xe,[y,E,d])},v.prototype.tile=function(d,y){if(d.dtype==="string"){var E=this.readSync(d.dataId).map(function(Q){return Un(Q)});return Ad(Wi(d.shape,d.dtype,E),y)}var B=new function(Q,re){this.variableNames=["A"];for(var fe=new Array(Q.length),xe=0;xe<fe.length;xe++)fe[xe]=Q[xe]*re[xe];this.outputShape=fe,this.rank=fe.length;var Oe=Yn(this.rank),Re=function(Le){var Be=Le.length;if(Be>5)throw Error("Tile for rank "+Be+" is not yet supported");if(Be===1)return"imod(resRC, "+Le[0]+")";for(var Xe=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],nt=[],tt=0;tt<Le.length;tt++)nt.push("imod("+Xe[tt]+", "+Le[tt]+")");return nt.join()}(Q);this.userCode=`
      void main() {
        `+Oe+` resRC = getOutputCoords();
        setOutput(getA(`+Re+`));
      }
    `}(d.shape,y);return this.compileAndRun(B,[d])},v.prototype.pad=function(d,y,E){var B=z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(Q,re,fe){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=re.map(function(pn,bn){return pn[0]+Q[bn]+pn[1]});for(var xe=Q.length,Oe=Yn(xe),Re=re.map(function(pn){return pn[0]}).join(","),Le=re.map(function(pn,bn){return pn[0]+Q[bn]}).join(","),Be=H("rc",xe),Xe=H("source",xe),nt=Be[xe-1]+" < "+this.outputShape[xe-1],tt=xe===1?"source":"vec2("+Xe.slice(-2).join()+")",ut=[Oe+" rc = outputLoc;",Be[xe-1]+` += 1;
       if(`+nt+`) {
      `,xe===1?"":`}
       rc = outputLoc;
       `+Be[xe-2]+` += 1;
       if(`+Be[xe-2]+" < "+this.outputShape[xe-2]+") {",xe===1?"":"  "+Be[xe-1]+` += 1;
         if(`+nt+") {"],Dt=xe===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",Rt="",Lt=0,qt=xe===1?2:4;Lt<qt;Lt++)Rt+=`
        `+ut[Lt]+`
        if (`+Dt+`) {
          result[`+Lt+"] = float("+fe+`);
        } else {
          `+Oe+` source = rc - start;
          result[`+Lt+"] = getChannel(getX("+Xe.join()+"), "+tt+`);
        }
      `;Rt+=xe===1?"} ":"}}",this.userCode=`
      const `+Oe+" start = "+Oe+"("+Re+`);
      const `+Oe+" end = "+Oe+"("+Le+`);

      void main() {
        `+Oe+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+Rt+`
        setOutput(result);
      }
    `}(d.shape,y,E):new function(Q,re,fe){this.variableNames=["x"],this.outputShape=re.map(function(Xe,nt){return Xe[0]+Q[nt]+Xe[1]});var xe=Q.length,Oe=Yn(xe),Re=re.map(function(Xe){return Xe[0]}).join(","),Le=re.map(function(Xe,nt){return Xe[0]+Q[nt]}).join(","),Be=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,xe);this.userCode=xe!==1?`
      `+Oe+" start = "+Oe+"("+Re+`);
      `+Oe+" end = "+Oe+"("+Le+`);

      void main() {
        `+Oe+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+fe+`));
        } else {
          `+Oe+` coords = outC - start;
          setOutput(getX(`+Be+`));
        }
      }
    `:`
        int start = `+Re+`;
        int end = `+Le+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+fe+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}(d.shape,y,E);return this.compileAndRun(B,[d])},v.prototype.transpose=function(d,y){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.transpose(d,y);var E=z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new function(B,Q){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var re=new Array(B.length),fe=0;fe<re.length;fe++)re[fe]=B[Q[fe]];if(this.outputShape=re,this.rank=re.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var xe=Yn(this.rank),Oe=D("rc",this.rank),Re=new Array(this.rank);for(fe=0;fe<Q.length;fe++)Re[Q[fe]]=Oe[fe];var Le="vec2("+Re.slice(-2).join()+")",Be="++"+Oe[this.rank-1]+" < "+re[this.rank-1],Xe="getChannel(getA("+Re.join()+"), "+Le+")";this.userCode=`
    void main() {
      `+xe+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+Xe+`;
      if(`+Be+`) {
        result[1] = `+Xe+`;
      }
      --`+Oe[this.rank-1]+`;
      if(++`+Oe[this.rank-2]+" < "+re[this.rank-2]+`) {
        result[2] = `+Xe+`;
        if(`+Be+`) {
          result[3] = `+Xe+`;
        }
      }
      setOutput(result);
    }
    `}(d.shape,y):new function(B,Q){this.variableNames=["A"];for(var re=new Array(B.length),fe=0;fe<re.length;fe++)re[fe]=B[Q[fe]];this.outputShape=re,this.rank=re.length;var xe=Yn(this.rank),Oe=function(Re){var Le=Re.length;if(Le>6)throw Error("Transpose for rank "+Le+" is not yet supported");for(var Be=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],Xe=new Array(Le),nt=0;nt<Re.length;nt++)Xe[Re[nt]]=Be[nt];return Xe.join()}(Q);this.userCode=`
    void main() {
      `+xe+` resRC = getOutputCoords();
      setOutput(getA(`+Oe+`));
    }
    `}(d.shape,y);return this.compileAndRun(E,[d])},v.prototype.gather=function(d,y,E){if(this.shouldExecuteOnCPU([d,y]))return this.cpuBackend.gather(d,y,E);var B=new function(Q,re,fe){this.variableNames=["A","indices"];var xe=Q.slice();xe[fe]=re,this.outputShape=xe,this.rank=xe.length;var Oe=Yn(this.rank),Re=function(Le,Be){var Xe=Le.length;if(Xe>4)throw Error("Gather for rank "+Xe+" is not yet supported");if(Xe===1)return"int(getIndices(resRC))";for(var nt=["resRC.x","resRC.y","resRC.z","resRC.w"],tt=[],ut=0;ut<Le.length;ut++)ut===Be?tt.push("int(getIndices("+nt[ut]+"))"):tt.push(""+nt[ut]);return tt.join()}(Q,fe);this.userCode=`
      void main() {
        `+Oe+` resRC = getOutputCoords();
        setOutput(getA(`+Re+`));
      }
    `}(d.shape,y.size,E);return this.compileAndRun(B,[d,y])},v.prototype.batchToSpaceND=function(d,y,E){we(d.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var B=y.reduce(function(Re,Le){return Re*Le}),Q=fc(d.shape,y,B),re=bd(Q.length,y.length),fe=xd(d.shape,y,B),xe=Ml(E,y.length),Oe=Kp(fe,E,y.length);return d.reshape(Q).transpose(re).reshape(fe).slice(xe,Oe)},v.prototype.spaceToBatchND=function(d,y,E){we(d.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var B=y.reduce(function(Le,Be){return Le*Be}),Q=[[0,0]];Q.push.apply(Q,E);for(var re=1+y.length;re<d.shape.length;++re)Q.push([0,0]);var fe=d.pad(Q),xe=fc(fe.shape,y,B,!1),Oe=bd(xe.length,y.length,!1),Re=xd(fe.shape,y,B,!1);return fe.reshape(xe).transpose(Oe).reshape(Re)},v.prototype.reduce=function(d,y,E){var B=d.shape[0],Q=d.shape[1],re=new function(xe,Oe){this.variableNames=["x"];var Re=xe.windowSize,Le=xe.batchSize,Be=xe.inSize,Xe=Math.ceil(Be/Re);this.outputShape=[Le,Xe];var nt="0.0",tt="";Oe==="prod"?nt="1.0":Oe==="min"?(nt="1.0 / 1e-20",tt="min"):Oe==="max"&&(nt="-1.0 / 1e-20",tt="max");var ut=Oe+"("+Oe+"("+Oe+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";Oe==="sum"?ut="sumValue":Oe==="prod"?ut="prodValue":Oe==="all"?ut="allValue":Oe==="any"&&(ut="anyValue");var Dt=4*Math.floor(Re/4),Rt=Re%4,Lt=`
      if (`+(Oe==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(Oe==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+tt+`(values, minMaxValue);
      }
    `,qt="vec4";Oe==="all"?(nt="1.0",Lt=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,qt="bvec4"):Oe==="any"&&(nt="0.0",Lt=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,qt="bvec4");var pn="";Be%Re>0&&(pn=`
        if (inIdx < 0 || inIdx >= `+Be+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+nt+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+pn+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+Re+`;

        vec4 minMaxValue = vec4(`+nt+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+Dt+`; i += 4) {
          int inIdx = inOffset + i;
          `+qt+" values = "+qt+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+Lt+`
        }

        int inIdx = inOffset + `+Dt+`;
        if (`+(Rt===1)+`) {
          `+qt+" values = "+qt+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+Lt+`
        } else if (`+(Rt===2)+`) {
          `+qt+" values = "+qt+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+Lt+`
        } else if (`+(Rt===3)+`) {
          `+qt+" values = "+qt+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+Lt+`
        }
        setOutput(`+ut+`);
      }
    `}({windowSize:yf(Q),inSize:Q,batchSize:B},y),fe=this.compileAndRun(re,[d],E);return fe.shape[1]===1?fe:this.reduce(fe,y,E)},v.prototype.argReduce=function(d,y,E){E===void 0&&(E=null);var B=d.shape[0],Q=d.shape[1];E!=null&&(B=E.shape[0],Q=E.shape[1]);var re=new function(Oe,Re,Le){this.variableNames=["A"];var Be=Oe.windowSize,Xe=Oe.batchSize,nt=Oe.inSize,tt=Math.ceil(nt/Be);Le||this.variableNames.push("bestIndicesA"),this.outputShape=[Xe,tt];var ut=Re==="max"?">":"<",Dt=Le?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+Be+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+Be+`; i++) {
          int inIdx = `+Dt+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+ut+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}({windowSize:yf(Q),inSize:Q,batchSize:B},y,E==null),fe=[d];E!=null&&fe.push(E);var xe=this.compileAndRun(re,fe,"int32");return xe.shape[1]===1?xe:this.argReduce(d,y,xe)},v.prototype.argReducePacked=function(d,y,E){E===void 0&&(E=null);var B=E!=null?E.shape:d.shape,Q=new function(xe,Oe,Re,Le){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,we(xe.length>2,function(){return"Packed arg"+(Re.charAt(0).toUpperCase()+Re.slice(1))+" supports only inputs with rank above 2."});var Be=xe[xe.length-1],Xe=Math.ceil(Be/Oe);this.outputShape=xe.slice(0,-1),Xe>1&&this.outputShape.push(Xe),Le||this.variableNames.push("bestIndicesA");var nt,tt,ut=this.outputShape,Dt=ut.length,Rt=Yn(Dt),Lt=H("coords",Dt);if(Xe===1){var qt=Yn(tt=Dt+1);nt=`
        `+qt+" sourceLocR = "+qt+"("+Lt.join()+`, 0);
        ++`+Lt[Dt-1]+`;
        `+qt+" sourceLocG = "+qt+"("+Lt.join()+`, 0);
        ++`+Lt[Dt-2]+`;
        `+qt+" sourceLocA = "+qt+"("+Lt.join()+`, 0);
        --`+Lt[Dt-1]+`;
        `+qt+" sourceLocB = "+qt+"("+Lt.join()+`, 0);
        --`+Lt[Dt-2]+";"}else tt=Dt,nt=`
        `+Rt+` sourceLocR = coords;
        ++`+Lt[Dt-1]+`;
        `+Rt+` sourceLocG = coords;
        ++`+Lt[Dt-2]+`;
        `+Rt+` sourceLocA = coords;
        --`+Lt[Dt-1]+`;
        `+Rt+` sourceLocB = coords;
        --`+Lt[Dt-2]+";";var pn=["x","y","z","w","u","v"].slice(0,tt),bn="."+pn[tt-1],mn=pn.map(function(K){return"int "+K}),Sn=H("sourceLocR",tt-1).concat("inIdx.r"),On=H("sourceLocG",tt-1).concat("inIdx.g"),b=H("sourceLocB",tt-1).concat("inIdx.b"),h=H("sourceLocA",tt-1).concat("inIdx.a"),c=Re==="max"?"greaterThan":"lessThan",m=Le?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+Sn.join()+`),
                             getBestIndicesAChannel(`+On.join()+`),
                             getBestIndicesAChannel(`+b.join()+`),
                             getBestIndicesAChannel(`+h.join()+")));",w=`vec4(
            getAChannel(`+Sn.join()+`),
            hasNextCol ? getAChannel(`+On.join()+`) : 0.,
            hasNextRow ? getAChannel(`+b.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+h.join()+") : 0.)",R=Le?"":`
      float getBestIndicesAChannel(`+mn.join()+`) {
        return getChannel(getBestIndicesA(`+pn.join()+`),
                                          vec2(`+pn.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+mn.join()+`) {
        return getChannel(getA(`+pn.join()+`),
                               vec2(`+pn.slice(-2).join()+`));
      }
      `+R+`
      void main() {
        `+Rt+` coords = getOutputCoords();
        bool hasNextCol = `+Lt[Dt-1]+" < "+(ut[Dt-1]-1)+`;
        bool hasNextRow = `+Lt[Dt-2]+" < "+(ut[Dt-2]-1)+`;
        `+nt+`
        ivec4 srcIdx = ivec4(sourceLocR`+bn+", sourceLocG"+bn+`,
          sourceLocB`+bn+", sourceLocA"+bn+") * "+Oe+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+w+`;

        for (int i = 0; i < `+Oe+`; i++) {
          inIdx = srcIdx;
          `+m+`
          vec4 candidate = `+w+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+c+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}(B,yf(B[B.length-1]),y,E==null),re=E==null?[d]:[d,E],fe=this.compileAndRun(Q,re,"int32");return fe.rank===d.rank?this.argReducePacked(d,y,fe):fe},v.prototype.sum=function(d,y){ta("sum",y,d.rank);var E=Io(d.shape,y),B=E[0],Q=ze(E[1]),re=d.as2D(-1,Q),fe=Nt(d.dtype);return this.reduce(re,"sum",fe).reshape(B)},v.prototype.prod=function(d,y){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.prod(d,y);var E=Io(d.shape,y),B=E[0],Q=ze(E[1]),re=d.as2D(-1,Q),fe=Nt(d.dtype);return this.reduce(re,"prod",fe).reshape(B)},v.prototype.unsortedSegmentSum=function(d,y,E){var B=0,Q=Ra([B],d.rank),re=d;Q!=null&&(re=d.transpose(Q),B=Pa(1,d.rank)[0]);var fe=function(Be,Xe,nt){for(var tt=[],ut=Be.length,Dt=0;Dt<ut;Dt++)Dt!==Xe?tt.push(Be[Dt]):tt.push(nt);return tt}(re.shape,B,E),xe=ze([re.shape[B]]),Oe=re.as2D(-1,xe),Re=Nt(d.dtype),Le=this.segOpCompute(Oe,"unsortedSegmentSum",y,Re,E).reshape(fe);return Q!=null&&(Le=Le.transpose(Vu(Q))),Le},v.prototype.segOpCompute=function(d,y,E,B,Q){var re=d.shape[0],fe=d.shape[1],xe=function(Le,Be){var Xe,nt=!1;for(Le<=Yp?(Xe=Le,nt=!0):Xe=Tr(Le,Math.floor(Math.sqrt(Le)));!nt;)Xe>Be||Xe===Le?nt=!0:Xe=Tr(Le,Xe+1);return Xe}(fe,Q),Oe=new function(Le,Be){this.variableNames=["x","segmentIds"];var Xe=Le.windowSize,nt=Le.batchSize,tt=Le.inSize,ut=Le.numSegments,Dt=ut*Math.ceil(tt/Xe);this.outputShape=[nt,Dt];var Rt=4*Math.floor(Xe/4),Lt=Xe%4,qt=`
        sumValue += dot(values, segFilter);
    `,pn="";tt%Xe>0&&(pn=`
        if (inIdx < 0 || inIdx >= `+tt+`) {
          return initializationValue;
        }
      `);var bn="";tt%Xe>0&&(bn=`
        if (inIdx < 0 || inIdx >= `+tt+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+pn+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+bn+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+ut+")) * float("+Xe+`));
        int currentSeg = int(mod(float(outIdx), float(`+ut+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+Rt+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+qt+`
        }

        int inIdx = inOffset + `+Rt+`;
        if (`+(Lt===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+qt+`
        } else if (`+(Lt===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+qt+`
        } else if (`+(Lt===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+qt+`
        }
        setOutput(sumValue);
      }
    `}({windowSize:xe,inSize:fe,batchSize:re,numSegments:Q}),Re=this.compileAndRun(Oe,[d,E],B);return Re.shape[1]===Q?Re:(E=Dc(0,Q).tile([fe/xe]),this.segOpCompute(Re,y,E,B,Q))},v.prototype.argMinMaxReduce=function(d,y,E){var B=[y];if(ta("arg"+E.charAt(0).toUpperCase()+E.slice(1),B,d.rank),!z().getBool("WEBGL_PACK_REDUCE")||d.rank<=2){var Q=Io(d.shape,B),re=Q[0],fe=ze(Q[1]),xe=d.as2D(-1,fe);return this.argReduce(xe,E).reshape(re)}return this.argReducePacked(d,E)},v.prototype.argMin=function(d,y){return this.argMinMaxReduce(d,y,"min")},v.prototype.argMax=function(d,y){return this.argMinMaxReduce(d,y,"max")},v.prototype.cumsum=function(d,y,E,B){if(y!==d.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(d.rank-1)+" but got axis="+y);var Q=new function(re,fe,xe){this.variableNames=["x"],this.outputShape=re;var Oe=re.length,Re=re[re.length-1],Le=xe?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(xe?"return "+Re+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Yn(Oe)+` coords = getOutputCoords();
        int end = `+ho(Oe,"coords")+`;
        float val = 0.0;
        for (int i = `+Re+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+Le+` end) {
            continue;
          }
          if (idx == end && `+fe+`) {
            continue;
          }
          `+ho(Oe,"coords")+` = idx;
          val += getX(`+function(Be,Xe){if(Be===1)return""+Xe;if(Be===2)return Xe+".x, "+Xe+".y";if(Be===3)return Xe+".x, "+Xe+".y, "+Xe+".z";if(Be===4)return Xe+".x, "+Xe+".y, "+Xe+".z, "+Xe+".w";throw Error("Cumulative sum for rank "+Be+" is not yet supported")}(Oe,"coords")+`);
        }
        setOutput(val);
      }
    `}(d.shape,E,B);return this.compileAndRun(Q,[d])},v.prototype.equal=function(d,y){if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,`
  return vec4(equal(a, b));
`,"bool");var E=new ni("return float(a == b);",d.shape,y.shape);return this.compileAndRun(E,[d,y],"bool")},v.prototype.notEqual=function(d,y){if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,`
  return vec4(notEqual(a, b));
`,"bool");var E=new ni("return float(a != b);",d.shape,y.shape);return this.compileAndRun(E,[d,y],"bool")},v.prototype.less=function(d,y){if(this.shouldExecuteOnCPU([d,y]))return this.cpuBackend.less(d,y);if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,`
  return vec4(lessThan(a, b));
`,"bool");var E=new ni("return float(a < b);",d.shape,y.shape);return this.compileAndRun(E,[d,y],"bool")},v.prototype.lessEqual=function(d,y){if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,`
  return vec4(lessThanEqual(a, b));
`,"bool");var E=new ni("return float(a <= b);",d.shape,y.shape);return this.compileAndRun(E,[d,y],"bool")},v.prototype.greater=function(d,y){if(this.shouldExecuteOnCPU([d,y]))return this.cpuBackend.greater(d,y);if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,`
  return vec4(greaterThan(a, b));
`,"bool");var E=new ni("return float(a > b);",d.shape,y.shape);return this.compileAndRun(E,[d,y],"bool")},v.prototype.greaterEqual=function(d,y){if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var E=new ni("return float(a >= b);",d.shape,y.shape);return this.compileAndRun(E,[d,y],"bool")},v.prototype.logicalNot=function(d){var y=new wi(d.shape,"return float(!(x >= 1.0));");return this.compileAndRun(y,[d])},v.prototype.logicalAnd=function(d,y){if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var E=new ni("return float(a >= 1.0 && b >= 1.0);",d.shape,y.shape);return this.compileAndRun(E,[d,y],"bool")},v.prototype.logicalOr=function(d,y){if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var E=new ni("return float(a >= 1.0 || b >= 1.0);",d.shape,y.shape);return this.compileAndRun(E,[d,y],"bool")},v.prototype.select=function(d,y,E){var B=new function(Q,re,fe){var xe,Oe;if(this.variableNames=["c","a","b"],this.outputShape=re,fe>4)throw Error("Where for rank "+fe+" is not yet supported");if(fe===1)Oe="resRC",xe="resRC";else{for(var Re=["resRC.x","resRC.y","resRC.z","resRC.w"],Le=[],Be=[],Xe=0;Xe<re.length;Xe++)Be.push(""+Re[Xe]),Xe<Q&&Le.push(""+Re[Xe]);xe=Le.join(),Oe=Be.join()}var nt=Yn(fe);this.userCode=`
      void main() {
        `+nt+` resRC = getOutputCoords();
        float cVal = getC(`+xe+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+Oe+`));
        } else {
          setOutput(getB(`+Oe+`));
        }
      }
    `}(d.rank,y.shape,y.rank);return this.compileAndRun(B,[d,y,E],En(y.dtype,E.dtype))},v.prototype.where=function(d){kl("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var y=d.dataSync();return ne(d.shape,y)},v.prototype.topk=function(d,y,E){return ae(d.dataSync(),d.shape,d.dtype,y)},v.prototype.min=function(d,y){ta("min",y,d.rank);var E=Io(d.shape,y),B=E[0],Q=ze(E[1]),re=d.as2D(-1,Q);return this.reduce(re,"min",re.dtype).reshape(B)},v.prototype.minimum=function(d,y){if(this.shouldExecuteOnCPU([d,y]))return this.cpuBackend.minimum(d,y);var E=z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _i(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,d.shape,y.shape):new ni(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,d.shape,y.shape);return this.compileAndRun(E,[d,y])},v.prototype.mod=function(d,y){var E=z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _i(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,d.shape,y.shape):new ni(`if (b == 0.0) return NAN;
  return mod(a, b);`,d.shape,y.shape);return this.compileAndRun(E,[d,y])},v.prototype.max=function(d,y){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.max(d,y);ta("max",y,d.rank);var E=Io(d.shape,y),B=E[0],Q=ze(E[1]),re=d.as2D(-1,Q);return this.reduce(re,"max",re.dtype).reshape(B)},v.prototype.maximum=function(d,y){if(this.shouldExecuteOnCPU([d,y]))return this.cpuBackend.maximum(d,y);var E=z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _i(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,d.shape,y.shape):new ni(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,d.shape,y.shape);return this.compileAndRun(E,[d,y])},v.prototype.all=function(d,y){ta("all",y,d.rank);var E=Io(d.shape,y),B=E[0],Q=ze(E[1]),re=d.as2D(-1,Q);return this.reduce(re,"all",re.dtype).reshape(B)},v.prototype.any=function(d,y){ta("any",y,d.rank);var E=Io(d.shape,y),B=E[0],Q=ze(E[1]),re=d.as2D(-1,Q);return this.reduce(re,"any",re.dtype).reshape(B)},v.prototype.realDivide=function(d,y){if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var E=new ni(`
if (a == b) {
  return 1.0;
};
return a / b;`,d.shape,y.shape);return this.compileAndRun(E,[d,y],"float32")},v.prototype.floorDiv=function(d,y){if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var E=new ni(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,d.shape,y.shape);return this.compileAndRun(E,[d,y],"int32")},v.prototype.add=function(d,y){if(d.dtype==="complex64"&&y.dtype==="complex64")return this.complexSeparableBinaryOp(d,y,Gr);if(this.shouldExecuteOnCPU([d,y]))return this.cpuBackend.add(d,y);var E=En(d.dtype,y.dtype);if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,Gr,E);var B=new ni(Gr,d.shape,y.shape);return this.compileAndRun(B,[d,y],E)},v.prototype.packedUnaryOp=function(d,y,E){var B=new Td(d.shape,y);return this.compileAndRun(B,[d],E)},v.prototype.packedBinaryOp=function(d,y,E,B,Q){Q===void 0&&(Q=!1);var re=new _i(E,d.shape,y.shape,Q);return this.compileAndRun(re,[d,y],B)},v.prototype.complexSeparableBinaryOp=function(d,y,E){var B=this,Q=this.texData.get(d.dataId),re=this.texData.get(y.dataId),fe=[[Q.complexTensors.real,re.complexTensors.real],[Q.complexTensors.imag,re.complexTensors.imag]].map(function(Le){var Be=Le[0],Xe=Le[1],nt=B.makeComplexComponentTensorInfo(d,Be),tt=B.makeComplexComponentTensorInfo(y,Xe),ut=new ni(E,d.shape,y.shape);return B.compileAndRun(ut,[nt,tt],En(Be.dtype,Xe.dtype))}),xe=fe[0],Oe=fe[1],Re=this.complex(xe,Oe);return xe.dispose(),Oe.dispose(),Re},v.prototype.makeComplexComponentTensorInfo=function(d,y){return{dataId:y.dataId,dtype:y.dtype,shape:d.shape}},v.prototype.addN=function(d){if(d.length===1)return d[0];if(d.length>z().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var y=Math.floor(d.length/2),E=this.addN(d.slice(0,y)),B=this.addN(d.slice(y));return this.addN([E,B])}var Q=d.map(function(xe){return xe.dtype}).reduce(function(xe,Oe){return En(xe,Oe)}),re=d.map(function(xe){return xe.shape}),fe=z().getBool("WEBGL_PACK")?new function(xe,Oe){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=xe,this.variableNames=Oe.map(function(Be,Xe){return"T"+Xe});var Re=[];this.variableNames.forEach(function(Be){Re.push("vec4 v"+Be+" = get"+Be+"AtOutCoords();")});var Le=this.variableNames.map(function(Be){return"v"+Be}).join(" + ");this.userCode=`
      void main() {
        `+Re.join(`
        `)+`

        vec4 result = `+Le+`;
        setOutput(result);
      }
    `}(d[0].shape,re):new function(xe,Oe){this.outputShape=[],this.outputShape=xe,this.variableNames=Oe.map(function(Be,Xe){return"T"+Xe});var Re=[];this.variableNames.forEach(function(Be){Re.push("float v"+Be+" = get"+Be+"AtOutCoords();")});var Le=this.variableNames.map(function(Be){return"v"+Be}).join(" + ");this.userCode=`
      void main() {
        `+Re.join(`
        `)+`

        float result = `+Le+`;
        setOutput(result);
      }
    `}(d[0].shape,re);return this.compileAndRun(fe,d,Q)},v.prototype.subtract=function(d,y){if(d.dtype==="complex64"&&y.dtype==="complex64")return this.complexSeparableBinaryOp(d,y,ii);if(this.shouldExecuteOnCPU([d,y]))return this.cpuBackend.subtract(d,y);var E=En(d.dtype,y.dtype);if(z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,y,ii,d.dtype);var B=new ni(ii,d.shape,y.shape);return this.compileAndRun(B,[d,y],E)},v.prototype.pow=function(d,y){var E=z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _i(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,d.shape,y.shape):new ni(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,d.shape,y.shape),B=En(d.dtype,y.dtype);return this.compileAndRun(E,[d,y],B)},v.prototype.ceil=function(d){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.ceil(d);if(z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(d,ov,d.dtype);var y=new wi(d.shape,ov);return this.compileAndRun(y,[d])},v.prototype.floor=function(d){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.floor(d);if(z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(d,Qg,d.dtype);var y=new wi(d.shape,Qg);return this.compileAndRun(y,[d])},v.prototype.sign=function(d){var y=new wi(d.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(y,[d])},v.prototype.isNaN=function(d){var y=new wi(d.shape,"return float(isnan(x));");return this.compileAndRun(y,[d],"bool")},v.prototype.isInf=function(d){var y=new wi(d.shape,"return float(isinf(x));");return this.compileAndRun(y,[d],"bool")},v.prototype.isFinite=function(d){var y=new wi(d.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(y,[d],"bool")},v.prototype.round=function(d){var y=new wi(d.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(y,[d])},v.prototype.exp=function(d){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.exp(d);if(z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(d,av,d.dtype);var y=new wi(d.shape,av);return this.compileAndRun(y,[d])},v.prototype.expm1=function(d){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.expm1(d);if(z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(d,Od,d.dtype);var y=new wi(d.shape,Od);return this.compileAndRun(y,[d])},v.prototype.softmax=function(d,y){var E=Yt([y],d.shape),B=this.max(d,E),Q=Fo(B.shape,E),re=this.subtract(d,B.reshape(Q)),fe=this.exp(re),xe=this.sum(fe,E).reshape(Q);return this.realDivide(fe,xe)},v.prototype.log=function(d){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.log(d);if(z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(d,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,d.dtype);var y=new wi(d.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(y,[d])},v.prototype.log1p=function(d){var y=new wi(d.shape,"return log(1.0 + x);");return this.compileAndRun(y,[d])},v.prototype.sqrt=function(d){var y=new wi(d.shape,"return sqrt(x);");return this.compileAndRun(y,[d])},v.prototype.rsqrt=function(d){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.rsqrt(d);var y=new wi(d.shape,"return inversesqrt(x);");return this.compileAndRun(y,[d])},v.prototype.reciprocal=function(d){var y=new wi(d.shape,"return 1.0 / x;");return this.compileAndRun(y,[d])},v.prototype.relu=function(d){var y;return y=z().getBool("WEBGL_PACK")?new Td(d.shape,uv):new wi(d.shape,rv),this.compileAndRun(y,[d])},v.prototype.relu6=function(d){var y;return y=z().getBool("WEBGL_PACK")?new Td(d.shape,cv):new wi(d.shape,iv),this.compileAndRun(y,[d])},v.prototype.prelu=function(d,y){var E=z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _i(bi,d.shape,y.shape):new ni(ai,d.shape,y.shape);return this.compileAndRun(E,[d,y])},v.prototype.elu=function(d){if(z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(d,ol,d.dtype);var y=new wi(d.shape,Yg);return this.compileAndRun(y,[d])},v.prototype.eluDer=function(d,y){var E=z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _i(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,d.shape,y.shape):new ni("return (b >= 1.0) ? a : a * (b + 1.0);",d.shape,y.shape);return this.compileAndRun(E,[d,y])},v.prototype.selu=function(d){var y=new wi(d.shape,`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = 1.7580993408473768;
  float scale = 1.0507009873554805;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`);return this.compileAndRun(y,[d])},v.prototype.int=function(d){var y=new wi(d.shape,"return float(int(x));");return this.compileAndRun(y,[d],"int32")},v.prototype.clip=function(d,y,E){var B,Q=(B=z().getBool("WEBGL_PACK_CLIP")?new pi(d.shape):new oi(d.shape)).getCustomSetupFunc(y,E);return this.compileAndRun(B,[d],null,Q)},v.prototype.abs=function(d){if(this.shouldExecuteOnCPU([d]))return this.cpuBackend.abs(d);if(z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(d,Sf,d.dtype);var y=new wi(d.shape,Sf);return this.compileAndRun(y,[d])},v.prototype.complexAbs=function(d){var y=this.texData.get(d.dataId),E=new function(Q){this.variableNames=["real","imag"],this.outputShape=Q,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}(d.shape),B=[this.makeComplexComponentTensorInfo(d,y.complexTensors.real),this.makeComplexComponentTensorInfo(d,y.complexTensors.imag)];return this.compileAndRun(E,B)},v.prototype.sigmoid=function(d){var y=new wi(d.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(y,[d])},v.prototype.softplus=function(d){var y=new wi(d.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(y,[d])},v.prototype.sin=function(d){var y=new wi(d.shape,`if (isnan(x)) return x;
  return sin(x);
`);return this.compileAndRun(y,[d])},v.prototype.cos=function(d){var y=new wi(d.shape,`if (isnan(x)) return x;
  return cos(x);
`);return this.compileAndRun(y,[d])},v.prototype.tan=function(d){var y=new wi(d.shape,"return tan(x);");return this.compileAndRun(y,[d])},v.prototype.asin=function(d){var y=new wi(d.shape,`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`);return this.compileAndRun(y,[d])},v.prototype.acos=function(d){var y=new wi(d.shape,`if (isnan(x)) return x;
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`);return this.compileAndRun(y,[d])},v.prototype.atan=function(d){var y=new wi(d.shape,`if (isnan(x)) return x;
  return atan(x);
`);return this.compileAndRun(y,[d])},v.prototype.atan2=function(d,y){var E=z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _i(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,d.shape,y.shape):new ni(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,d.shape,y.shape);return this.compileAndRun(E,[d,y])},v.prototype.sinh=function(d){var y=new wi(d.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(y,[d])},v.prototype.cosh=function(d){var y=new wi(d.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(y,[d])},v.prototype.tanh=function(d){var y=new wi(d.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(y,[d])},v.prototype.asinh=function(d){var y=new wi(d.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(y,[d])},v.prototype.acosh=function(d){var y=new wi(d.shape,`if (isnan(x)) return x;
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`);return this.compileAndRun(y,[d])},v.prototype.atanh=function(d){var y=new wi(d.shape,`if (isnan(x)) return x;
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`);return this.compileAndRun(y,[d])},v.prototype.erf=function(d){var y=new wi(d.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(y,[d])},v.prototype.step=function(d,y){var E=new wi(d.shape,function(B){return B===void 0&&(B=0),tm+`
    return x > 0.0 ? 1.0 : float(`+B+`);
  `}(y));return this.compileAndRun(E,[d])},v.prototype.conv2dByMatMul=function(d,y,E,B,Q,re){var fe=d.shape,xe=this.texData.get(d.dataId),Oe=E.inChannels,Re=fe[0]*fe[1]*fe[2],Le=E.outChannels,Be=E.dataFormat==="channelsLast",Xe=(Re===1||Le===1)&&Oe>1e3,nt=fe[2]%2!=0&&!!xe.isPacked;if(Xe||!z().getBool("WEBGL_LAZILY_UNPACK")||!z().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!nt){var tt=Be?fe[0]*fe[1]*fe[2]:fe[0]*fe[2]*fe[3],ut=this.reshape(d,[1,tt,E.inChannels]),Dt=this.reshape(y,[1,E.inChannels,E.outChannels]);return this.reshape(this.fusedBatchMatMul({a:ut,b:Dt,transposeA:!1,transposeB:!1,bias:B,activation:Q,preluActivationWeights:re}),E.outShape)}var Rt=Be?fe[0]*fe[1]*(fe[2]+1):fe[0]*fe[2]*(fe[3]+1),Lt={dataId:d.dataId,shape:[1,Rt,E.inChannels],dtype:d.dtype},qt=xe.shape;xe.shape=xe.shape.slice(),xe.shape[xe.shape.length-2]++,we(Mu(xe.shape,Lt.shape),function(){return"packed reshape "+xe.shape+" to "+Lt.shape+" isn't free"});var pn=this.reshape(y,[1,E.inChannels,E.outChannels]),bn=this.fusedBatchMatMul({a:Lt,b:pn,transposeA:!1,transposeB:!1,bias:B,activation:Q,preluActivationWeights:re}),mn=this.texData.get(bn.dataId);return we(mn.isPacked,function(){return"batchMatMul result is expected to be packed"}),xe.shape=qt,mn.shape=E.outShape,Ve.makeTensorFromDataId(bn.dataId,E.outShape,bn.dtype)},v.prototype.conv2dWithIm2Row=function(d,y,E,B,Q,re){var fe=E.filterWidth,xe=E.filterHeight,Oe=E.inChannels,Re=E.outWidth,Le=E.outHeight,Be=E.dataFormat==="channelsLast",Xe=fe*xe*Oe,nt=Le*Re,tt=[Xe,nt],ut=d.squeeze([0]),Dt=y.reshape([1,Xe,-1]),Rt=new function(b,h,c){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=b;for(var m=c.filterWidth,w=c.inChannels,R=c.strideWidth,K=c.strideHeight,ee=c.padInfo,le=c.outWidth,de=c.dilationWidth,_e=c.dilationHeight,Te=c.dataFormat,Ne=ee.left,Fe=ee.top,He=w*m,Ye=ue(),Ke=Te==="channelsLast",it=Ke?0:1,gt=Ke?1:2,wt="",At=0;At<=1;At++)for(var zt=0;zt<=1;zt++)wt+=`
          blockIndex = rc.y + `+zt+`;
          pos = rc.x + `+At+`;

          if(blockIndex < `+b[1]+" && pos < "+b[0]+`) {
            offsetY = int(blockIndex / (`+le+")) * "+K+" - "+Fe+`;
            d0 = offsetY + `+_e+" * (pos / "+He+`);

            if(d0 < `+h[it]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+le+".) * "+R+". - "+Ne+`.);
              d1 = offsetX + `+de+" * (int(mod(float(pos), "+He+".) / "+w+`.));

              if(d1 < `+h[gt]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+w+`.));

                if (`+Ke+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*At+zt)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*At+zt)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+wt+`

        `+Ye.output+` = result;
      }
    `}(tt,ut.shape,E),Lt=this.compileAndRun(Rt,[ut]).reshape([1,tt[0],tt[1]]),qt=B!=null,pn=re!=null,bn=Q?Zg(Q,!0):null,mn=new jo(Lt.shape,[1,nt,E.outChannels],!0,!1,qt,bn,pn),Sn=[Lt,Dt];B&&Sn.push(B),pn&&Sn.push(re);var On=this.compileAndRun(mn,Sn);return Be?On.reshape([1,Le,Re,E.outChannels]):On.reshape([1,E.outChannels,Le,Re])},v.prototype.fusedConv2d=function(d){var y=d.input,E=d.filter,B=d.convInfo,Q=d.bias,re=d.activation,fe=d.preluActivationWeights;if(B.filterHeight===1&&B.filterWidth===1&&B.dilationHeight===1&&B.dilationWidth===1&&B.strideHeight===1&&B.strideWidth===1&&(B.padInfo.type==="SAME"||B.padInfo.type==="VALID"))return this.conv2dByMatMul(y,E,B,Q,re,fe);if(z().getBool("WEBGL_CONV_IM2COL")&&y.shape[0]===1)return this.conv2dWithIm2Row(y,E,B,Q,re,fe);var xe=Q!=null,Oe=fe!=null,Re=re?Zg(re,!1):null,Le=new lo(B,xe,Re,Oe),Be=[y,E];return Q&&Be.push(Q),fe&&Be.push(fe),this.compileAndRun(Le,Be)},v.prototype.conv2d=function(d,y,E){if(E.filterHeight===1&&E.filterWidth===1&&E.dilationHeight===1&&E.dilationWidth===1&&E.strideHeight===1&&E.strideWidth===1&&(E.padInfo.type==="SAME"||E.padInfo.type==="VALID"))return this.conv2dByMatMul(d,y,E);if(z().getBool("WEBGL_CONV_IM2COL")&&d.shape[0]===1)return this.conv2dWithIm2Row(d,y,E);var B=new lo(E);return this.compileAndRun(B,[d,y])},v.prototype.conv2dDerInput=function(d,y,E){var B=new function(Q){this.variableNames=["dy","W"],this.outputShape=Q.inShape;var re=Q.filterHeight,fe=Q.filterWidth,xe=Q.strideHeight,Oe=Q.strideWidth,Re=Q.dataFormat==="channelsLast",Le=re-1-Q.padInfo.top,Be=fe-1-Q.padInfo.left,Xe=Re?1:2,nt=Re?2:3,tt=Re?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+Le+", "+Be+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+tt+`];

        ivec2 dyCorner = ivec2(coords[`+Xe+"], coords["+nt+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+re+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+xe+`.0;

          if (dyR < 0.0 || dyR >= `+Q.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+re+` - 1 - wR;

          for (int wC = 0; wC < `+fe+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+Oe+`.0;

            if (dyC < 0.0 || dyC >= `+Q.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+fe+` - 1 - wC;

            for (int d2 = 0; d2 < `+Q.outChannels+`; d2++) {

              if (`+Re+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}(E);return this.compileAndRun(B,[d,y])},v.prototype.conv2dDerFilter=function(d,y,E){var B=new function(Q){this.variableNames=["x","dy"],this.outputShape=Q.filterShape;var re=Q.strideHeight,fe=Q.strideWidth,xe=Q.padInfo.top,Oe=Q.padInfo.left,Re=Q.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+Q.batchSize+`; b++) {
          for (int yR = 0; yR < `+Q.outHeight+`; yR++) {
            int xR = wR + yR * `+re+" - "+xe+`;

            if (xR < 0 || xR >= `+Q.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+Q.outWidth+`; yC++) {
              int xC = wC + yC * `+fe+" - "+Oe+`;

              if (xC < 0 || xC >= `+Q.inWidth+`) {
                continue;
              }

              if (`+Re+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}(E);return this.compileAndRun(B,[d,y])},v.prototype.fusedDepthwiseConv2D=function(d){var y,E=d.input,B=d.filter,Q=d.convInfo,re=d.bias,fe=d.activation,xe=d.preluActivationWeights,Oe=z().getBool("WEBGL_PACK_DEPTHWISECONV")&&Q.strideWidth<=2&&Q.outChannels/Q.inChannels==1,Re=fe?Zg(fe,Oe):null,Le=[E,B],Be=re!=null,Xe=xe!=null;return Be&&Le.push(re),Xe&&Le.push(xe),Oe?(y=new $i(Q,Be,Re,Xe),this.compileAndRun(y,Le)):(y=new qo(Q,Be,Re,Xe),this.compileAndRun(y,Le))},v.prototype.depthwiseConv2D=function(d,y,E){var B;return z().getBool("WEBGL_PACK_DEPTHWISECONV")&&E.strideWidth<=2&&E.outChannels/E.inChannels==1?(B=new $i(E),this.compileAndRun(B,[d,y])):(B=new qo(E),this.compileAndRun(B,[d,y]))},v.prototype.depthwiseConv2DDerInput=function(d,y,E){var B=new function(Q){this.variableNames=["dy","W"],this.outputShape=Q.inShape;var re=Q.filterHeight,fe=Q.filterWidth,xe=Q.strideHeight,Oe=Q.strideWidth,Re=re-1-Q.padInfo.top,Le=fe-1-Q.padInfo.left,Be=Q.outChannels/Q.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+Re+", "+Le+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+re+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+xe+`.0;

          if (dyR < 0.0 || dyR >= `+Q.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+re+` - 1 - wR;

          for (int wC = 0; wC < `+fe+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+Oe+`.0;

            if (dyC < 0.0 || dyC >= `+Q.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+fe+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+Be+`; dm++) {
              int d2 = d1 * `+Be+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(E);return this.compileAndRun(B,[d,y])},v.prototype.depthwiseConv2DDerFilter=function(d,y,E){var B=new function(Q){this.variableNames=["x","dy"],this.outputShape=Q.filterShape;var re=Q.strideHeight,fe=Q.strideWidth,xe=Q.padInfo.top,Oe=Q.padInfo.left,Re=Q.outChannels/Q.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+Re+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+Q.batchSize+`; b++) {
          for (int yR = 0; yR < `+Q.outHeight+`; yR++) {
            int xR = wR + yR * `+re+" - "+xe+`;

            if (xR < 0 || xR >= `+Q.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+Q.outWidth+`; yC++) {
              int xC = wC + yC * `+fe+" - "+Oe+`;

              if (xC < 0 || xC >= `+Q.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}(E);return this.compileAndRun(B,[d,y])},v.prototype.conv3d=function(d,y,E){var B=new function(Q){this.variableNames=["x","W"],this.outputShape=Q.outShape;var re=Q.padInfo.front,fe=Q.padInfo.top,xe=Q.padInfo.left,Oe=Q.strideDepth,Re=Q.strideHeight,Le=Q.strideWidth,Be=Q.dilationDepth,Xe=Q.dilationHeight,nt=Q.dilationWidth,tt=Q.filterDepth,ut=Q.filterHeight,Dt=Q.filterWidth,Rt=4*Math.floor(Q.inChannels/4),Lt=Q.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+Oe+", "+Re+", "+Le+`);
      const ivec3 pads = ivec3(`+re+", "+fe+", "+xe+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+tt+`; wF++) {
          int xF = xFCorner + wF * `+Be+`;

          if (xF < 0 || xF >= `+Q.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+ut+`; wR++) {
            int xR = xRCorner + wR * `+Xe+`;

            if (xR < 0 || xR >= `+Q.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+Dt+`; wC++) {
              int xC = xCCorner + wC * `+nt+`;

              if (xC < 0 || xC >= `+Q.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+Rt+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(Lt===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+Rt+`) *
                  getW(wF, wR, wC, `+Rt+`, d2);
              } else if (`+(Lt===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+Rt+`),
                  getX(batch, xF, xR, xC, `+Rt+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+Rt+`, d2),
                  getW(wF, wR, wC, `+Rt+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(Lt===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+Rt+`),
                  getX(batch, xF, xR, xC, `+Rt+` + 1),
                  getX(batch, xF, xR, xC, `+Rt+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+Rt+`, d2),
                  getW(wF, wR, wC, `+Rt+` + 1, d2),
                  getW(wF, wR, wC, `+Rt+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(E);return this.compileAndRun(B,[d,y])},v.prototype.conv3dDerInput=function(d,y,E){var B=new function(Q){this.variableNames=["dy","W"],this.outputShape=Q.inShape;var re=Q.filterDepth,fe=Q.filterHeight,xe=Q.filterWidth,Oe=Q.strideDepth,Re=Q.strideHeight,Le=Q.strideWidth,Be=re-1-Q.padInfo.front,Xe=fe-1-Q.padInfo.top,nt=xe-1-Q.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+Be+", "+Xe+", "+nt+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+re+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+Oe+`.0;

          if (dyF < 0.0 || dyF >= `+Q.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+re+` - 1 - wF;

          for (int wR = 0; wR < `+fe+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+Re+`.0;

            if (dyR < 0.0 || dyR >= `+Q.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+fe+` - 1 - wR;

            for (int wC = 0; wC < `+xe+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+Le+`.0;

              if (dyC < 0.0 || dyC >= `+Q.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+xe+` - 1 - wC;

              for (int d2 = 0; d2 < `+Q.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(E);return this.compileAndRun(B,[d,y])},v.prototype.conv3dDerFilter=function(d,y,E){var B=new function(Q){this.variableNames=["x","dy"],this.outputShape=Q.filterShape;var re=Q.strideDepth,fe=Q.strideHeight,xe=Q.strideWidth,Oe=Q.padInfo.front,Re=Q.padInfo.top,Le=Q.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+Q.batchSize+`; b++) {
          for (int yF = 0; yF < `+Q.outDepth+`; yF++) {
            int xF = wF + yF * `+re+" - "+Oe+`;

            if (xF < 0 || xF >= `+Q.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+Q.outHeight+`; yR++) {
              int xR = wR + yR * `+fe+" - "+Re+`;

              if (xR < 0 || xR >= `+Q.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+Q.outWidth+`; yC++) {
                int xC = wC + yC * `+xe+" - "+Le+`;

                if (xC < 0 || xC >= `+Q.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}(E);return this.compileAndRun(B,[d,y])},v.prototype.maxPool=function(d,y){var E=new Ss(y,"max",!1);return this.compileAndRun(E,[d])},v.prototype.avgPool=function(d,y){var E=new Ss(y,"avg",!1);return this.compileAndRun(E,[d],"float32")},v.prototype.maxPoolBackprop=function(d,y,E,B){var Q=new Ss(B,"max",!0),re=this.compileAndRun(Q,[y]),fe=new function(Oe){this.variableNames=["dy","maxPos"],this.outputShape=Oe.inShape;var Re=Oe.strideHeight,Le=Oe.strideWidth,Be=Oe.dilationHeight,Xe=Oe.effectiveFilterHeight,nt=Oe.effectiveFilterWidth,tt=Xe-1-Oe.padInfo.top,ut=nt-1-Oe.padInfo.left,Dt=Xe*nt-1;this.userCode=`
      const ivec2 pads = ivec2(`+tt+", "+ut+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+Xe+`;
          wR += `+Be+`) {
          float dyR = float(dyRCorner + wR) / `+Re+`.0;

          if (dyR < 0.0 || dyR >= `+Oe.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+nt+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+Le+`.0;

            if (dyC < 0.0 || dyC >= `+Oe.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+Dt+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+nt+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}(B),xe=this.compileAndRun(fe,[d,re],y.dtype);return re.dispose(),xe},v.prototype.avgPoolBackprop=function(d,y,E){var B=new function(Q){this.variableNames=["dy"],this.outputShape=Q.inShape;var re=Q.filterHeight,fe=Q.filterWidth,xe=Q.strideHeight,Oe=Q.strideWidth,Re=Q.dilationHeight,Le=Q.dilationWidth,Be=Q.effectiveFilterHeight,Xe=Q.effectiveFilterWidth,nt=Be-1-Q.padInfo.top,tt=Xe-1-Q.padInfo.left,ut=1/(re*fe);this.userCode=`
      const ivec2 pads = ivec2(`+nt+", "+tt+`);
      const float avgMultiplier = float(`+ut+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+Be+`;
            wR += `+Re+`) {
          float dyR = float(dyRCorner + wR) / `+xe+`.0;

          if (dyR < 0.0 || dyR >= `+Q.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+Xe+`;
            wC+= `+Le+`) {
            float dyC = float(dyCCorner + wC) / `+Oe+`.0;

            if (dyC < 0.0 || dyC >= `+Q.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}(E);return this.compileAndRun(B,[d],y.dtype)},v.prototype.cast=function(d,y){return uu(d,y,this)},v.prototype.unstack=function(d,y){for(var E=d.shape[y],B=new Array(d.rank-1),Q=0,re=0;re<d.rank;re++)re!==y&&(B[Q++]=d.shape[re]);var fe=new Array(d.rank).fill(0),xe=d.shape.slice();xe[y]=1;var Oe=new Array(E);for(re=0;re<Oe.length;re++)fe[y]=re,Oe[re]=this.slice(d,fe,xe).reshape(B);return Oe},v.prototype.avgPool3d=function(d,y){var E=new go(y,"avg",!1);return this.compileAndRun(E,[d],"float32")},v.prototype.avgPool3dBackprop=function(d,y,E){var B=new function(Q){this.variableNames=["dy"],this.outputShape=Q.inShape;var re=Q.filterDepth,fe=Q.filterHeight,xe=Q.filterWidth,Oe=Q.strideDepth,Re=Q.strideHeight,Le=Q.strideWidth,Be=Q.dilationDepth,Xe=Q.dilationHeight,nt=Q.dilationWidth,tt=Q.effectiveFilterDepth,ut=Q.effectiveFilterHeight,Dt=Q.effectiveFilterWidth,Rt=tt-1-Q.padInfo.front,Lt=ut-1-Q.padInfo.top,qt=Dt-1-Q.padInfo.left,pn=1/(re*fe*xe);this.userCode=`
      const ivec3 pads = ivec3(`+Rt+", "+Lt+", "+qt+`);
      const float avgMultiplier = float(`+pn+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+tt+`;
            wD += `+Be+`) {
          float dyD = float(dyDCorner + wD) / `+Oe+`.0;

          if (dyD < 0.0 || dyD >= `+Q.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+ut+`;
              wR += `+Xe+`) {
            float dyR = float(dyRCorner + wR) / `+Re+`.0;

            if (dyR < 0.0 || dyR >= `+Q.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+Dt+`;
                wC += `+nt+`) {
              float dyC = float(dyCCorner + wC) / `+Le+`.0;

              if (dyC < 0.0 || dyC >= `+Q.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(E);return this.compileAndRun(B,[d],y.dtype)},v.prototype.maxPool3d=function(d,y){var E=new go(y,"max",!1);return this.compileAndRun(E,[d],"float32")},v.prototype.maxPool3dBackprop=function(d,y,E,B){var Q=new go(B,"max",!0),re=this.compileAndRun(Q,[y]),fe=new function(Oe){this.variableNames=["dy","maxPos"],this.outputShape=Oe.inShape;var Re=Oe.strideDepth,Le=Oe.strideHeight,Be=Oe.strideWidth,Xe=Oe.dilationDepth,nt=Oe.dilationHeight,tt=Oe.dilationWidth,ut=Oe.effectiveFilterDepth,Dt=Oe.effectiveFilterHeight,Rt=Oe.effectiveFilterWidth,Lt=ut-1-Oe.padInfo.front,qt=Dt-1-Oe.padInfo.top,pn=Rt-1-Oe.padInfo.left,bn=ut*Dt*Rt-1;this.userCode=`
      const ivec3 pads = ivec3(`+Lt+", "+qt+", "+pn+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+ut+`;
           wD += `+Xe+`) {
          float dyD = float(dyDCorner + wD) / `+Re+`.0;

          if (dyD < 0.0 || dyD >= `+Oe.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+Dt+`;
              wR += `+nt+`) {
            float dyR = float(dyRCorner + wR) / `+Le+`.0;

            if (dyR < 0.0 || dyR >= `+Oe.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+Rt+`;
                wC += `+tt+`) {
              float dyC = float(dyCCorner + wC) / `+Be+`.0;

              if (dyC < 0.0 || dyC >= `+Oe.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+bn+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+Dt+" * "+Rt+` +
                  wR * `+Rt+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}(B),xe=this.compileAndRun(fe,[d,re],y.dtype);return re.dispose(),xe},v.prototype.reshape=function(d,y){var E=this.texData.get(d.dataId);if(E.isPacked&&!Mu(d.shape,y)&&(E.texture===null||!Mu(E.shape,y))){var B=this.packedReshape(d,y);return Ve.makeTensorFromDataId(B.dataId,B.shape,B.dtype)}return Gu(d,y)},v.prototype.resizeBilinear=function(d,y,E,B){var Q=z().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new function(re,fe,xe,Oe){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var Re=re[0],Le=re[1],Be=re[2],Xe=re[3];this.outputShape=[Re,fe,xe,Xe];var nt=[Oe&&fe>1?Le-1:Le,Oe&&xe>1?Be-1:Be],tt=[Oe&&fe>1?fe-1:fe,Oe&&xe>1?xe-1:xe];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+nt[0]/tt[0]+`,
          `+nt[1]/tt[1]+`,
          `+nt[1]/tt[1]+`);
      const vec3 inputShapeRC = vec3(`+Le+".0, "+Be+`.0,
                                     `+Be+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(Xe-1)+`;
        bool hasNextRow = coords.z < `+(xe-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}(d.shape,y,E,B):new function(re,fe,xe,Oe){this.variableNames=["A"],this.outputShape=[];var Re=re[0],Le=re[1],Be=re[2],Xe=re[3];this.outputShape=[Re,fe,xe,Xe];var nt=[Oe&&fe>1?Le-1:Le,Oe&&xe>1?Be-1:Be],tt=[Oe&&fe>1?fe-1:fe,Oe&&xe>1?xe-1:xe];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+nt[0]/tt[0]+`,
          `+nt[1]/tt[1]+`);
      const vec2 inputShapeRC = vec2(`+Le+".0, "+Be+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}(d.shape,y,E,B);return this.compileAndRun(Q,[d],"float32")},v.prototype.resizeBilinearBackprop=function(d,y,E){var B=new function(Q,re,fe){this.variableNames=["dy"],this.outputShape=[],this.outputShape=re.shape;var xe=re.shape,Oe=xe[1],Re=xe[2],Le=Q.shape,Be=Le[1],Xe=Le[2],nt=[fe&&Be>1?Oe-1:Oe,fe&&Xe>1?Re-1:Re],tt=[fe&&Be>1?Be-1:Be,fe&&Xe>1?Xe-1:Xe],ut=nt[0]/tt[0],Dt=nt[1]/tt[1],Rt=1/ut,Lt=1/Dt,qt=2*Math.ceil(Rt)+2,pn=2*Math.ceil(Lt)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+ut+`);
        const float widthScale = float(`+Dt+`);

        const float invHeightScale = float(`+Rt+`);
        const float invWidthScale = float(`+Lt+`);

        const int winHeight = int(`+qt+`);
        const int winWidth = int(`+pn+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+Be+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+Xe+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(Oe-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(Re-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}(d,y,E);return this.compileAndRun(B,[d])},v.prototype.resizeNearestNeighbor=function(d,y,E,B){var Q=new function(re,fe,xe,Oe){this.variableNames=["A"],this.outputShape=[];var Re=re[0],Le=re[1],Be=re[2],Xe=re[3];this.outputShape=[Re,fe,xe,Xe];var nt=[Oe&&fe>1?Le-1:Le,Oe&&xe>1?Be-1:Be],tt=[Oe&&fe>1?fe-1:fe,Oe&&xe>1?xe-1:xe],ut=Oe?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+nt[0]/tt[0]+`,
          `+nt[1]/tt[1]+`);
      const vec2 inputShapeRC = vec2(`+Le+".0, "+Be+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+ut+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}(d.shape,y,E,B);return this.compileAndRun(Q,[d])},v.prototype.resizeNearestNeighborBackprop=function(d,y,E){var B=new function(Q,re,fe){this.variableNames=["dy"],this.outputShape=[],this.outputShape=re.shape;var xe=re.shape,Oe=xe[1],Re=xe[2],Le=Q.shape,Be=Le[1],Xe=Le[2],nt=[fe&&Be>1?Oe-1:Oe,fe&&Xe>1?Re-1:Re],tt=[fe&&Be>1?Be-1:Be,fe&&Xe>1?Xe-1:Xe],ut=nt[0]/tt[0],Dt=nt[1]/tt[1],Rt=1/ut,Lt=1/Dt,qt=2*Math.ceil(Rt)+2,pn=2*Math.ceil(Lt)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+ut+`);
        const float widthScale = float(`+Dt+`);

        const float invHeightScale = float(`+Rt+`);
        const float invWidthScale = float(`+Lt+`);

        const int winHeight = int(`+qt+`);
        const int winWidth = int(`+pn+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+Be+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+Xe+`) {
              continue;
            }

            float sourceFracRow =
              float(`+nt[0]+`) *
                (float(dyR) / float(`+tt[0]+`));

            float sourceFracCol =
                float(`+nt[1]+`) *
                  (float(dyC) / float(`+tt[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+Oe+`) - 1),
                `+fe+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+Re+`) - 1),
                `+fe+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}(d,y,E);return this.compileAndRun(B,[d])},v.prototype.multinomial=function(d,y,E,B){var Q=y?d:Ls(d),re=Q.shape[0],fe=Q.shape[1],xe=new Bs(re,fe,E),Oe=xe.getCustomSetupFunc(B);return this.compileAndRun(xe,[Q],"int32",Oe)},v.prototype.oneHot=function(d,y,E,B){var Q=new function(re,fe,xe,Oe){this.variableNames=["indices"],this.outputShape=[re,fe],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+Oe+"), float("+xe+`),
                      float(index == coords.y)));
      }
    `}(d.size,y,E,B);return this.compileAndRun(Q,[d])},v.prototype.diag=function(d){var y=new function(E){this.variableNames=["X"],this.outputShape=[E,E],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}(d.size);return this.compileAndRun(y,[d])},v.prototype.nonMaxSuppression=function(d,y,E,B,Q){return kl("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),$u(d.dataSync(),y.dataSync(),E,B,Q)},v.prototype.cropAndResize=function(d,y,E,B,Q,re){var fe=new function(xe,Oe,Re,Le,Be){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var Xe=xe[0],nt=xe[1],tt=xe[2],ut=xe[3],Dt=Oe[0],Rt=Re[0],Lt=Re[1];this.outputShape=[Dt,Rt,Lt,ut];var qt=Le==="bilinear"?1:0,pn=[nt-1+".0",tt-1+".0"],bn=pn[0],mn=pn[1],Sn=Rt>1?[""+(nt-1)/(Rt-1),"(y2-y1) * height_ratio","y1*"+bn+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+bn],On=Sn[0],b=Sn[1],h=Sn[2],c=Lt>1?[""+(tt-1)/(Lt-1),"(x2-x1) * width_ratio","x1*"+mn+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+mn],m=c[0],w=c[1],R=c[2];this.userCode=`
      const float height_ratio = float(`+On+`);
      const float width_ratio = float(`+m+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+Xe+`) {
          return;
        }

        float height_scale = `+b+`;
        float width_scale = `+w+`;

        float in_y = `+h+`;
        if( in_y < 0.0 || in_y > `+bn+` ) {
          setOutput(float(`+Be+`));
          return;
        }
        float in_x = `+R+`;
        if( in_x < 0.0 || in_x > `+mn+` ) {
          setOutput(float(`+Be+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+qt+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}(d.shape,y.shape,B,Q,re);return this.compileAndRun(fe,[d,y,E],"float32")},v.prototype.depthToSpace=function(d,y,E){we(y>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+y});var B=d.shape[0],Q=E==="NHWC"?d.shape[1]:d.shape[2],re=E==="NHWC"?d.shape[2]:d.shape[3],fe=E==="NHWC"?d.shape[3]:d.shape[1],xe=Q*y,Oe=re*y,Re=fe/(y*y),Le=new fa(E==="NHWC"?[B,xe,Oe,Re]:[B,Re,xe,Oe],y,E);return this.compileAndRun(Le,[d])},v.prototype.split=function(d,y,E){return Ef(d,y,E)},v.prototype.scatterND=function(d,y,E){var B=Dl(0,d,E),Q=B.sliceRank,re=B.numUpdates,fe=B.sliceSize,xe=B.strides,Oe=B.outputSize,Re=[Oe/fe,fe],Le=d.reshape([re,Q]),Be=y.reshape([re,fe]);if(Oe===0)return Gu(To([]),E);var Xe=kr(0),nt=new js(re,Q,Le.rank,Be.rank,xe,Re);return this.compileAndRun(nt,[Be,Le,Xe]).reshape(E)},v.prototype.sparseToDense=function(d,y,E,B){var Q=Dl(0,d,E),re=Q.sliceRank,fe=Q.numUpdates,xe=Q.strides,Oe=Q.outputSize,Re=new js(fe,re,d.rank,y.rank,xe,[Oe,1]);return this.compileAndRun(Re,[y,d,B]).reshape(E)},v.prototype.fft=function(d){return this.fftImpl(d,!1)},v.prototype.ifft=function(d){return this.fftImpl(d,!0)},v.prototype.fftImpl=function(d,y){var E=this.texData.get(d.dataId),B=new Wo("return real * expR - imag * expI;",d.shape,y),Q=new Wo("return real * expI + imag * expR;",d.shape,y),re=[this.makeComplexComponentTensorInfo(d,E.complexTensors.real),this.makeComplexComponentTensorInfo(d,E.complexTensors.imag)],fe=this.compileAndRun(B,re),xe=this.compileAndRun(Q,re),Oe=this.complex(fe,xe).as2D(d.shape[0],d.shape[1]);return fe.dispose(),xe.dispose(),Oe},v.prototype.gatherND=function(d,y){var E=y.shape,B=E[E.length-1],Q=dc(d,y),re=Q[0],fe=Q[1],xe=Q[2],Oe=Q[3],Re=y.reshape([fe,B]),Le=d.reshape([d.size/xe,xe]),Be=new function(Xe,nt,tt){this.sliceDim=Xe,this.strides=nt,this.variableNames=["x","indices"],this.outputShape=tt;var ut=Yn(nt.length),Dt=Yn(tt.length),Rt=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+ut+" strides = "+ut+"("+this.strides+`);
         void main() {
          `+Dt+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+Rt+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}(B,Oe,[fe,xe]);return this.compileAndRun(Be,[Le,Re]).reshape(re)},v.prototype.fill=function(d,y,E){if((E=E||ke(y))==="string"){var B=cn(E,ze(d));return B.fill(y),Ve.makeTensor(B,d,E,this)}var Q=new ia(d,y),re=Q.getCustomSetupFunc(y);return this.compileAndRun(Q,[],E,re)},v.prototype.onesLike=function(d){if(d.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(d.shape,1,d.dtype)},v.prototype.zerosLike=function(d){return this.fill(d.shape,d.dtype==="string"?"":0,d.dtype)},v.prototype.linspace=function(d,y,E){return pc(d,y,E)},v.prototype.makeTensorInfo=function(d,y){var E=this.write(null,d,y);return this.texData.get(E).usage=null,{dataId:E,shape:d,dtype:y}},v.prototype.makeOutput=function(d,y){var E=this.makeTensorInfo(d,y).dataId;return Ve.makeTensorFromDataId(E,d,y,this)},v.prototype.unpackTensor=function(d){var y=new function(E){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=E;var B=E.length,Q=H("rc",B),re=Yn(B),fe=function(Re,Le){if(Re===1)return"rc";for(var Be="",Xe=0;Xe<Re;Xe++)Be+=Le[Xe],Xe<Re-1&&(Be+=",");return Be}(B,Q),xe=Q.slice(-2),Oe=B<=1?"rc":"vec2("+xe.join(",")+")";this.userCode=`
      void main() {
        `+re+` rc = getOutputCoords();
        vec4 packedInput = getA(`+fe+`);

        setOutput(getChannel(packedInput, `+Oe+`));
      }
    `}(d.shape);return this.runWebGLProgram(y,[d],d.dtype)},v.prototype.packTensor=function(d){var y=new function(E){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=E;var B=E.length;if(B===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var Q=H("rc",B),re=Yn(B),fe=function(Re,Le,Be){if(Re===1)return"rc > "+Le[0];for(var Xe="",nt=Re-2;nt<Re;nt++)Xe+=Be[nt]+" >= "+Le[nt],nt<Re-1&&(Xe+="||");return Xe}(B,E,Q),xe=function(Re,Le,Be,Xe){if(Re===1)return"";var nt=Xe.slice(-2);return`
    int r = `+nt[0]+`;
    int c = `+nt[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+Le+`;
    bool rEdge = rp1 >= `+Be+`;
  `}(B,E[E.length-1],E[E.length-2],Q),Oe=function(Re,Le){var Be=Re.length,Xe=function(nt,tt){for(var ut=[],Dt=0;Dt<=1;Dt++)for(var Rt=0;Rt<=1;Rt++){for(var Lt=(Dt===0?"r":"rp1")+", "+(Rt===0?"c":"cp1"),qt=2;qt<nt;qt++)Lt=tt[tt.length-1-qt]+","+Lt;ut.push(Lt)}return ut}(Be,Le);return Be===1?`getA(rc),
            rc + 1 >= `+Re[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+Xe[0]+`),
          cEdge ? 0. : getA(`+Xe[1]+`),
          rEdge ? 0. : getA(`+Xe[2]+`),
          rEdge || cEdge ? 0. : getA(`+Xe[3]+")"}(E,Q);this.userCode=`
        void main() {
          `+re+` rc = getOutputCoords();

          if(`+fe+`) {
            setOutput(vec4(0));
          } else {
            `+xe+`

            setOutput(vec4(`+Oe+`));
          }
        }
      `}}(d.shape);return this.runWebGLProgram(y,[d],d.dtype,null,!0)},v.prototype.packedReshape=function(d,y){var E=[bs(d.shape)].concat(Fa(d.shape)),B={dtype:d.dtype,shape:E,dataId:d.dataId},Q=new function(fe,xe){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=fe;for(var Oe="",Re=0;Re<4;Re++){var Le="thisRC = rc;";Re%2==1&&(Le+="thisRC.z += 1;"),Re>1&&(Le+="thisRC.y += 1;"),Oe+=`
        `+Le+`
        `+(Re>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+Re+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(Re>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+je(["r","c","d"],xe)+`
      return ivec3(r, c, d);
    }
  
      `+Je(fe)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+fe[1]+`;
        int cols = `+fe[2]+`;

        `+Oe+`

        setOutput(result);
      }
    `}([bs(y)].concat(Fa(y)),E),re=this.runWebGLProgram(Q,[B],d.dtype,null,!0);return{dataId:re.dataId,shape:y,dtype:re.dtype}},v.prototype.decode=function(d){var y,E=this.texData.get(d),B=E.isPacked,Q=E.shape,re=E.dtype,fe=Oc(Q);return y=B?new function(xe){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Zn.DENSE;var Oe=gi(xe),Re=ue();this.outputShape=xe,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+je(["r","c","d"],xe)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+Oe[0]+", "+Oe[1]+`));
        int index = 4 * (resTexRC.x * `+Oe[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+Re.output+` = result;
      }
    `}(fe):new function(xe){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Zn.DENSE;var Oe=gi(xe),Re=ue();this.outputShape=xe,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+je(["r","c","d"],xe)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+Oe[0]+", "+Oe[1]+`));
        int index = 4 * (resTexRC.x * `+Oe[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+Re.output+` = result;
      }
    `}(fe),{dtype:re,shape:Q,dataId:this.runWebGLProgram(y,[{shape:fe,dtype:re,dataId:d}],re,null,!0).dataId}},v.prototype.runWebGLProgram=function(d,y,E,B,Q){var re=this;Q===void 0&&(Q=!1);var fe=this.makeTensorInfo(d.outputShape,E),xe=this.texData.get(fe.dataId);if(d.packedOutput&&(xe.isPacked=!0),d.outPackingScheme===Zn.DENSE){var Oe=gi(d.outputShape);xe.texShape=Oe.map(function(Rt){return 2*Rt})}if(d.outTexUsage!=null&&(xe.usage=d.outTexUsage),ze(fe.shape)===0)return xe.values=Rn(fe.dtype,0),fe;var Re=[],Le=y.map(function(Rt){if(Rt.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var Lt=re.texData.get(Rt.dataId);if(Lt.texture==null){if(!d.packedInputs&&ze(Rt.shape)<=z().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:Rt.shape,texData:null,isUniform:!0,uniformValues:Lt.values};d.packedInputs&&(Lt.isPacked=!0,Lt.shape=Rt.shape)}else if(!!Lt.isPacked!=!!d.packedInputs)Rt=Lt.isPacked?re.unpackTensor(Rt):re.packTensor(Rt),Re.push(Rt),Lt=re.texData.get(Rt.dataId);else if(Lt.isPacked&&!Mu(Lt.shape,Rt.shape)){var qt=Rt,pn=Rt.shape;Rt.shape=Lt.shape,Rt=re.packedReshape(Rt,pn),Re.push(Rt),Lt=re.texData.get(Rt.dataId),qt.shape=pn}return re.uploadToGPU(Rt.dataId),{shape:Rt.shape,texData:Lt,isUniform:!1}});this.uploadToGPU(fe.dataId);var Be,Xe={shape:fe.shape,texData:xe,isUniform:!1},nt=function(Rt,Lt,qt){var pn="";Le.concat(qt).forEach(function(mn){var Sn=mn.texData!=null&&mn.texData.slice!=null&&mn.texData.slice.flatOffset>0,On=mn.isUniform?"uniform":mn.texData.texShape;pn+=mn.shape+"_"+On+"_"+Sn});var bn=Rt.userCode;return Rt.constructor.name+"_"+pn+"_"+bn}(d,0,Xe),tt=this.getAndSaveBinary(nt,function(){return function(Rt,Lt,qt,pn){var bn=Lt.userCode,mn=qt.map(function(ee,le){var de={logicalShape:ee.shape,texShape:ee.isUniform?null:ee.texData.texShape,isUniform:ee.isUniform,isPacked:!ee.isUniform&&ee.texData.isPacked,flatOffset:null};return ee.texData!=null&&ee.texData.slice!=null&&ee.texData.slice.flatOffset>0&&(de.flatOffset=ee.texData.slice.flatOffset),{name:Lt.variableNames[le],shapeInfo:de}}),Sn=mn.map(function(ee){return ee.shapeInfo}),On={logicalShape:pn.shape,texShape:pn.texData.texShape,isUniform:!1,isPacked:pn.texData.isPacked,flatOffset:null},b=Gt(mn,On,bn,Lt.packedInputs),h=Rt.createProgram(b),c=null,m=Rt.getUniformLocation(h,"NAN",!1);z().getNumber("WEBGL_VERSION")===1&&(c=Rt.getUniformLocation(h,"INFINITY",!1));for(var w={},R=0;R<Lt.variableNames.length;R++){var K=Lt.variableNames[R];w[K]=Rt.getUniformLocation(h,K,!1),w["offset"+K]=Rt.getUniformLocation(h,"offset"+K,!1)}return{program:Lt,source:b,webGLProgram:h,uniformLocations:w,inShapeInfos:Sn,outShapeInfo:On,infLoc:c,nanLoc:m}}(re.gpgpu,d,Le,Xe)}),ut=this.activeTimers!=null;if(ut&&(Be=this.startTimer()),function(Rt,Lt,qt,pn,bn){Xs(Lt.inShapeInfos,qt),Xs([Lt.outShapeInfo],[pn]);var mn=pn.texData.texture,Sn=pn.texData.texShape;pn.texData.isPacked?Rt.setOutputPackedMatrixTexture(mn,Sn[0],Sn[1]):Rt.setOutputMatrixTexture(mn,Sn[0],Sn[1]),Rt.setProgram(Lt.webGLProgram),z().getNumber("WEBGL_VERSION")===1&&Lt.infLoc!==null&&Rt.gl.uniform1f(Lt.infLoc,1/0),Lt.nanLoc!==null&&Rt.gl.uniform1f(Lt.nanLoc,NaN),qt.forEach(function(On,b){var h=Lt.program.variableNames[b],c=Lt.uniformLocations[h],m=Lt.uniformLocations["offset"+h];if(c!=null)if(On.isUniform)if(ze(On.shape)<2)Rt.gl.uniform1f(c,On.uniformValues[0]);else{var w=On.uniformValues;w instanceof Float32Array||(w=new Float32Array(w)),Rt.gl.uniform1fv(c,w)}else On.texData.slice!=null&&m!=null&&Rt.gl.uniform1i(m,On.texData.slice.flatOffset),Rt.setInputMatrixTexture(On.texData.texture,c,b)}),bn!=null&&bn(Rt,Lt.webGLProgram),Rt.executeProgram()}(this.gpgpu,tt,Le,Xe,B),Re.forEach(function(Rt){return re.disposeData(Rt.dataId)}),ut&&(Be=this.endTimer(Be),this.activeTimers.push({name:d.constructor.name,query:this.getQueryTime(Be)})),!z().getBool("WEBGL_LAZILY_UNPACK")&&xe.isPacked&&Q===!1){var Dt=this.unpackTensor(fe);return this.disposeData(fe.dataId),Dt}return fe},v.prototype.compileAndRun=function(d,y,E,B,Q){Q===void 0&&(Q=!1),E=E||y[0].dtype;var re=this.runWebGLProgram(d,y,E,B,Q);return Ve.makeTensorFromDataId(re.dataId,re.shape,re.dtype)},v.prototype.getAndSaveBinary=function(d,y){return d in this.binaryCache||(this.binaryCache[d]=y()),this.binaryCache[d]},v.prototype.getTextureManager=function(){return this.textureManager},v.prototype.dispose=function(){var d=this;this.disposed||(z().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(y){d.gpgpu.deleteProgram(d.binaryCache[y].webGLProgram),delete d.binaryCache[y]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},v.prototype.floatPrecision=function(){var d=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Hi(function(){if(!z().get("WEBGL_RENDER_FLOAT32_ENABLED")){var y=z().getBool("DEBUG");z().set("DEBUG",!1);var E=d.abs(kr(1e-8)).dataSync()[0];if(z().set("DEBUG",y),E>0)return 32}return 16})),this.floatPrecisionValue},v.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},v.prototype.uploadToGPU=function(d){var y,E=this.texData.get(d),B=E.shape,Q=E.dtype,re=E.values,fe=E.texture,xe=E.usage,Oe=E.isPacked;if(fe==null){var Re,Le=this.activeTimers!=null;Le&&(Re=Zt());var Be=E.texShape;if(Be==null&&(Be=cf(B,Oe),E.texShape=Be),re!=null){var Xe=Oc(B),nt=void 0,tt=Be[1],ut=Be[0],Dt=re instanceof Uint8Array;Oe?(tt=(y=ei(Be[0],Be[1]))[0],nt=new function(bn,mn,Sn){Sn===void 0&&(Sn=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var On=ue(),b=mn[0],h=mn[1];this.outputShape=bn;var c="",m="result";Sn&&(m="floor(result * 255. + 0.5)");for(var w=0;w<=1;w++)for(var R=0;R<=1;R++){var K=2*w+R;c+=`
          localCoords = coords;
          if(localCoords[2] + `+R+" < "+bn[2]+`) {
            localCoords[2] += `+R+`;
            if(localCoords[1] + `+w+" < "+bn[1]+`) {
              localCoords[1] += `+w+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+h+`;
              c = imod(flatIndex, `+h+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+h+".0, "+b+`.0);
              values = `+On.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+K+`] = values[0];
              } else if(offset == 1) {
                result[`+K+`] = values[1];
              } else if(offset == 2) {
                result[`+K+`] = values[2];
              } else {
                result[`+K+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Je(bn)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+c+`

        `+On.output+" = "+m+`;
      }
    `}(Xe,[ut=y[1],tt],Dt)):nt=new function(bn,mn,Sn){Sn===void 0&&(Sn=!1),this.variableNames=["A"];var On=ue(),b=mn[0],h=mn[1];this.outputShape=bn;var c="result";Sn&&(c="floor(result * 255. + 0.5)"),this.userCode=`
      `+Je(bn)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+h+`;
        int c = imod(flatIndex, `+h+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+h+".0, "+b+`.0);
        vec4 values = `+On.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+On.output+" = vec4("+c+`, 0., 0., 0.);
      }
    `}(Xe,[ut,tt],Dt);var Rt=this.makeTensorInfo([ut,tt],Q);this.texData.get(Rt.dataId).usage=Dt?cr.PIXELS:cr.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(Rt.dataId),tt,ut,re);var Lt=this.runWebGLProgram(nt,[Rt],Q,null,!0),qt=this.texData.get(Lt.dataId);E.texture=qt.texture,E.texShape=qt.texShape,E.isPacked=qt.isPacked,E.usage=qt.usage,this.disposeData(Rt.dataId),this.texData.delete(Lt.dataId),E.values=null,Le&&(this.uploadWaitMs+=Zt()-Re)}else{var pn=this.acquireTexture(Be,xe,Q,Oe);E.texture=pn}}},v.prototype.convertAndCacheOnCPU=function(d,y){var E=this.texData.get(d),B=E.dtype;return this.releaseGPUData(d),y!=null&&(E.values=function(Q,re){if(re==="float32"||re==="complex64")return Q;if(re==="int32"||re==="bool"){for(var fe=re==="int32"?new Int32Array(Q.length):new Uint8Array(Q.length),xe=0;xe<fe.length;++xe)fe[xe]=Math.round(Q[xe]);return fe}throw new Error("Unknown dtype "+re)}(y,B)),E.values},v.prototype.acquireTexture=function(d,y,E,B){if(this.numBytesInGPU+=this.computeBytes(d,E),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var Q=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+Q+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(d,y,B)},v.prototype.computeBytes=function(d,y){return d[0]*d[1]*Jt(y)},v}(Sd);Ln()&&Ve.registerBackend("webgl",function(){return new Sy},2);var t0=Pt({square_:function(_){var v=Ze(_,"x","square"),d=[v];return Ve.runKernelFunc(function(y,E){return E([v]),y.square(v)},{x:v},null,"Square",{},d,[])}}),Uh="SquaredDifference",Md=Pt({squaredDifference_:function(_,v){var d,y=Ze(_,"a","squaredDifference"),E=Ze(v,"b","squaredDifference");d=Kt(y,E),y=d[0],E=d[1],no(y.shape,E.shape);var B={a:y,b:E},Q=[y,E];return Ve.runKernelFunc(function(re,fe){var xe=re.squaredDifference(y,E);return fe([y,E]),xe},B,function(re,fe){var xe=fe[0],Oe=fe[1],Re=kr(2);return{a:function(){return re.mul(xe.sub(Oe).mul(Re))},b:function(){return re.mul(Oe.sub(xe).mul(Re))}}},Uh,{},Q,[])}}),al=Pt({abs_:function(_){var v=Ze(_,"x","abs");return v.dtype==="complex64"?Ve.runKernelFunc(function(d){return d.complexAbs(v)},{$x:v}):Ve.runKernelFunc(function(d,y){var E=d.abs(v);return y([v]),E},{x:v},function(d,y){var E=y[0];return{x:function(){return d.mul(E.toFloat().step(-1))}}},"Abs")}}),n0=Pt({acos_:function(_){var v=Ze(_,"x","acos");return Ve.runKernelFunc(function(d,y){var E=d.acos(v);return y([v]),E},{$x:v},function(d,y){var E=y[0];return{$x:function(){return d.divStrict(kr(1).sub(E.toFloat().square()).sqrt()).neg()}}})}}),r0=Pt({acosh_:function(_){var v=Ze(_,"x","acosh");return Ve.runKernelFunc(function(d,y){var E=d.acosh(v);return y([v]),E},{$x:v},function(d,y){var E=y[0];return{$x:function(){return d.divStrict(E.toFloat().square().sub(1).sqrt())}}})}}),Yu=Pt({asin_:function(_){var v=Ze(_,"x","asin");return Ve.runKernelFunc(function(d,y){var E=d.asin(v);return y([v]),E},{$x:v},function(d,y){var E=y[0];return{$x:function(){return d.divStrict(kr(1).sub(E.toFloat().square()).sqrt())}}})}}),i0=Pt({asinh_:function(_){var v=Ze(_,"x","asinh");return Ve.runKernelFunc(function(d,y){var E=d.asinh(v);return y([v]),E},{$x:v},function(d,y){var E=y[0];return{$x:function(){return d.divStrict(kr(1).add(E.toFloat().square()).sqrt())}}})}}),Wh=Pt({atan_:function(_){var v=Ze(_,"x","atan");return Ve.runKernelFunc(function(d,y){var E=d.atan(v);return y([v]),E},{$x:v},function(d,y){var E=y[0];return{$x:function(){return d.div(E.toFloat().square().add(1))}}})}}),im=Pt({atanh_:function(_){var v=Ze(_,"x","atanh");return Ve.runKernelFunc(function(d,y){var E=d.atanh(v);return y([v]),E},{$x:v},function(d,y){var E=y[0];return{$x:function(){return d.div(kr(1).sub(E.toFloat().square()))}}})}}),ky=Pt({ceil_:function(_){var v=Ze(_,"x","ceil");return Ve.runKernelFunc(function(d){return d.ceil(v)},{$x:v},function(d){return{$x:function(){return mi(d)}}})}}),om=Pt({clipByValue_:function(_,v,d){var y=Ze(_,"x","clipByValue");we(v<=d,function(){return"Error in clip: min ("+v+") must be less than or equal to max ("+d+")."});var E=[y],B={min:v,max:d};return Ve.runKernelFunc(function(Q,re){var fe=Q.clip(y,v,d);return re([y]),fe},{x:y},function(Q,re){var fe=re[0];return{x:function(){return Q.where(fe.greaterEqual(v).logicalAnd(fe.lessEqual(d)),mi(Q))}}},"ClipByValue",B,E)}}),sl=Pt({cos_:function(_){var v=Ze(_,"x","cos"),d=[v];return Ve.runKernelFunc(function(y,E){var B=y.cos(v);return E([v]),B},{x:v},function(y,E){var B=E[0];return{x:function(){return B.toFloat().sin().neg().mul(y)}}},"Cos",{},d)}}),am=Pt({cosh_:function(_){var v=Ze(_,"x","cosh");return Ve.runKernelFunc(function(d,y){var E=d.cosh(v);return y([v]),E},{$x:v},function(d,y){var E=y[0];return{$x:function(){return E.toFloat().sinh().mulStrict(d)}}})}}),lv=Pt({erf_:function(_){var v=Ze(_,"x","erf");return we(v.dtype==="int32"||v.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),v.dtype==="int32"&&(v=v.toFloat()),Ve.runKernelFunc(function(d,y){var E=d.erf(v);return y([v]),E},{$x:v},function(d,y){var E=y[0];return{$x:function(){return d.mul(E.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),fv=Pt({exp_:function(_){var v=Ze(_,"x","exp");return Ve.runKernelFunc(function(d,y){var E=d.exp(v);return y([E]),E},{x:v},function(d,y){return{x:function(){return d.mulStrict(y[0])}}},"Exp",{},[],[!0])}}),o0=Pt({expm1_:function(_){var v=Ze(_,"x","expm1");return Ve.runKernelFunc(function(d,y){var E=d.expm1(v);return y([v]),E},{$x:v},function(d,y){var E=y[0];return{$x:function(){return d.mul(E.exp())}}})}}),D1=Pt({floor_:function(_){var v=Ze(_,"x","floor");return Ve.runKernelFunc(function(d){return d.floor(v)},{$x:v},function(d){return{$x:function(){return mi(d)}}})}}),N1=Pt({log_:function(_){var v=Ze(_,"x","log"),d=[v];return Ve.runKernelFunc(function(y,E){var B=y.log(v);return E([v]),B},{x:v},function(y,E){var B=E[0];return{x:function(){return y.div(B.toFloat())}}},"Log",{},d)}}),yo=Pt({log1p_:function(_){var v=Ze(_,"x","log1p");return Ve.runKernelFunc(function(d,y){var E=d.log1p(v);return y([v]),E},{$x:v},function(d,y){var E=y[0];return{$x:function(){return d.div(E.add(1))}}})}}),dv=Pt({logSigmoid_:function(_){var v=Ze(_,"x","logSigmoid");return Ve.runKernelFunc(function(d,y){var E=d.softplus(v.neg()).neg();return y([v]),E},{$x:v},function(d,y){var E=y[0];return{$x:function(){return d.mul(E.neg().sigmoid())}}})}}),hv=Pt({neg_:function(_){var v=Ze(_,"x","neg"),d=[v];return Ve.runKernelFunc(function(y){return y.neg(v)},{x:v},function(y){return{x:function(){return y.neg()}}},"Neg",{},d)}}),eg=Pt({reciprocal_:function(_){var v=Ze(_,"x","reciprocal");return Ve.runKernelFunc(function(d,y){var E=d.reciprocal(v);return y([v]),E},{$x:v},function(d,y){var E=y[0];return{$x:function(){return d.div(E.square().neg())}}})}}),pv=Pt({round_:function(_){var v=Ze(_,"x","round");return Ve.runKernelFunc(function(d){return d.round(v)},{$x:v},function(d){return{$x:function(){return mi(d)}}})}}),sm=Pt({rsqrt_:function(_){var v=Ze(_,"x","rsqrt"),d=[v];return Ve.runKernelFunc(function(y,E){var B=y.rsqrt(v);return E([v]),B},{x:v},function(y,E){var B=E[0];return{x:function(){return y.div(B.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},d)}}),Ll=Pt({sigmoid_:function(_){var v=Ze(_,"x","sigmoid");return Ve.runKernelFunc(function(d,y){var E=d.sigmoid(v);return y([E]),E},{x:v},function(d,y){var E=y[0];return{x:function(){return d.mul(E.mul(kr(1).sub(E)))}}},"Sigmoid")}}),Bl=Pt({sign_:function(_){var v=Ze(_,"x","sign");return Ve.runKernelFunc(function(d){return d.sign(v)},{$x:v},function(d){return{$x:function(){return mi(d)}}})}}),mv=Pt({isNaN_:function(_){var v=Ze(_,"x","isNaN");return Ve.runKernelFunc(function(d){return d.isNaN(v)},{$x:v},function(d){return{$x:function(){return mi(d)}}})}}),gv=Pt({isInf_:function(_){var v=Ze(_,"x","isInf");return Ve.runKernelFunc(function(d){return d.isInf(v)},{$x:v},function(d){return{$x:function(){return mi(d)}}})}}),Vh=Pt({isFinite_:function(_){var v=Ze(_,"x","isFinite");return Ve.runKernelFunc(function(d){return d.isFinite(v)},{$x:v},function(d){return{$x:function(){return mi(d)}}})}}),Dd=Pt({sin_:function(_){var v=Ze(_,"x","sin"),d=[v];return Ve.runKernelFunc(function(y,E){var B=y.sin(v);return E([v]),B},{x:v},function(y,E){var B=E[0];return{x:function(){return B.toFloat().cos().mul(y)}}},"Sin",{},d)}}),Hh=Pt({sinh_:function(_){var v=Ze(_,"x","sinh");return Ve.runKernelFunc(function(d,y){var E=d.sinh(v);return y([v]),E},{$x:v},function(d,y){var E=y[0];return{$x:function(){return E.toFloat().cosh().mulStrict(d)}}})}}),I1=Pt({softplus_:function(_){var v=Ze(_,"x","softplus");return Ve.runKernelFunc(function(d,y){var E=d.softplus(v);return y([v]),E},{$x:v},function(d,y){var E=y[0];return{$x:function(){return d.mul(E.sigmoid())}}})}}),tg=Pt({sqrt_:function(_){var v=Ze(_,"x","sqrt");return Ve.runKernelFunc(function(d,y){var E=d.sqrt(v);return y([v]),E},{$x:v},function(d,y){var E=y[0];return{$x:function(){return d.div(E.toFloat().sqrt().mul(2))}}})}}),jl=Pt({step_:function(_,v){v===void 0&&(v=0);var d=Ze(_,"x","step");return Ve.runKernelFunc(function(y){return y.step(d,v)},{$x:d},function(y){return{$x:function(){return mi(y)}}})}}),Ju=Pt({tan_:function(_){var v=Ze(_,"x","tan");return Ve.runKernelFunc(function(d,y){var E=d.tan(v);return y([v]),E},{$x:v},function(d,y){var E=y[0];return{$x:function(){return d.div(E.cos().square())}}})}}),kf=Pt({tanh_:function(_){var v=Ze(_,"x","tanh");return Ve.runKernelFunc(function(d,y){var E=d.tanh(v);return y([E]),E},{x:v},function(d,y){var E=y[0];return{x:function(){return kr(1).sub(E.square()).mulStrict(d)}}},"Tanh",{},null,[!0])}});function Cf(_,v,d,y,E,B){var Q,re,fe=Ze(_,"x","batchNorm"),xe=Ze(v,"mean","batchNorm"),Oe=Ze(d,"variance","batchNorm");return E!=null&&(Q=Ze(E,"scale","batchNorm")),y!=null&&(re=Ze(y,"offset","batchNorm")),we(fe.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+fe.rank+"."}),we(xe.rank===2||xe.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+xe.rank+"."}),we(Oe.rank===2||Oe.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+Oe.rank+"."}),Q!=null&&we(Q.rank===2||Q.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+Q.rank+"."}),re!=null&&we(re.rank===2||re.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+re.rank+"."}),ng(fe,xe,Oe,re,Q,B)}function Af(_,v,d,y,E,B){var Q,re,fe=Ze(_,"x","batchNorm"),xe=Ze(v,"mean","batchNorm"),Oe=Ze(d,"variance","batchNorm");return E!=null&&(Q=Ze(E,"scale","batchNorm")),y!=null&&(re=Ze(y,"offset","batchNorm")),we(fe.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+fe.rank+"."}),we(xe.rank===3||xe.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+xe.rank+"."}),we(Oe.rank===3||Oe.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+Oe.rank+"."}),Q!=null&&we(Q.rank===3||Q.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+Q.rank+"."}),re!=null&&we(re.rank===3||re.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+re.rank+"."}),ng(fe,xe,Oe,re,Q,B)}function vv(_,v,d,y,E,B){var Q,re,fe=Ze(_,"x","batchNorm"),xe=Ze(v,"mean","batchNorm"),Oe=Ze(d,"variance","batchNorm");return E!=null&&(Q=Ze(E,"scale","batchNorm")),y!=null&&(re=Ze(y,"offset","batchNorm")),we(fe.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+fe.rank+"."}),we(xe.rank===4||xe.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+xe.rank+"."}),we(Oe.rank===4||Oe.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+Oe.rank+"."}),Q!=null&&we(Q.rank===4||Q.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+Q.rank+"."}),re!=null&&we(re.rank===4||re.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+re.rank+"."}),ng(fe,xe,Oe,re,Q,B)}function ng(_,v,d,y,E,B){B==null&&(B=.001);var Q,re,fe,xe=Ze(_,"x","batchNorm"),Oe=Ze(v,"mean","batchNorm"),Re=Ze(d,"variance","batchNorm");E!=null&&(Q=Ze(E,"scale","batchNorm")),y!=null&&(re=Ze(y,"offset","batchNorm")),we(Oe.rank===Re.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),we(re==null||Oe.rank===re.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),we(Q==null||Oe.rank===Q.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),fe=xe.rank===0||xe.rank===1?xe.as4D(1,1,1,xe.size):xe.rank===2?xe.as4D(1,1,xe.shape[0],xe.shape[1]):xe.rank===3?xe.as4D(1,xe.shape[0],xe.shape[1],xe.shape[2]):xe;var Le=[xe,Oe,Re,Q];return Ve.runKernelFunc(function(Be,Xe){var nt=Be.batchNormalization(fe,Qu(Oe),Qu(Re),B,Qu(Q),Qu(re));return Xe([xe,Oe,Re,Q]),nt},{x:xe,mean:Oe,variance:Re,scale:Q,offset:re},function(Be,Xe){var nt=Xe,tt=nt[0],ut=nt[1],Dt=nt[2],Rt=nt[3],Lt=Rt??kr(1),qt=Ta(ut.shape,fe.shape),pn=[];if(ut.rank===1){for(var bn=0;bn<fe.shape.length-1;++bn)pn.push(fe.shape[bn]);pn.push(1)}var mn=tt.sub(ut),Sn=Be.mul(Lt),On=sm(Dt.add(kr(B))),b=On.mul(On).mul(On).mul(kr(-.5));return{x:function(){return ut.rank===1?Be.mul(Rs(On.as4D(1,1,1,ut.shape[0]),pn)).mul(Lt).reshape(tt.shape):Be.mul(On).mul(Lt).reshape(tt.shape)},mean:function(){var h=On.mul(kr(-1)).mul(Sn);return ut.rank===1&&(h=h.sum(qt)),h.reshape(ut.shape)},variance:function(){var h=b.mul(mn).mul(Sn);return ut.rank===1&&(h=h.sum(qt)),h.reshape(ut.shape)},scale:function(){var h=mn.mul(On),c=Be.mul(h);return ut.rank===1&&(c=c.sum(qt)),c.reshape(ut.shape)},offset:function(){var h=Be;return ut.rank===1&&(h=h.sum(qt)),h.reshape(ut.shape)}}},"BatchNormalization",{varianceEpsilon:B},Le).reshape(xe.shape)}function Qu(_){return _==null?null:_.rank===0?_.as1D():_.rank===1?_:_.rank===2?_.as4D(1,1,_.shape[0],_.shape[1]):_.rank===3?_.as4D(1,_.shape[0],_.shape[1],_.shape[2]):_}function mc(){pd("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var yv=Pt({batchNormalization2d_:function(_,v,d,y,E,B){return y===void 0&&(y=.001),mc(),Cf(_,v,d,B,E,y)}}),um=Pt({batchNormalization3d_:function(_,v,d,y,E,B){return y===void 0&&(y=.001),mc(),Af(_,v,d,B,E,y)}}),a0=Pt({batchNormalization4d_:function(_,v,d,y,E,B){return y===void 0&&(y=.001),mc(),vv(_,v,d,B,E,y)}}),F1=Pt({batchNormalization_:function(_,v,d,y,E,B){return y===void 0&&(y=.001),mc(),ng(_,v,d,B,E,y)}}),Cy=Pt({batchNorm_:ng}),Of=Pt({batchNorm2d_:Cf}),Gh=Pt({batchNorm3d_:Af}),Nd=Pt({batchNorm4d_:vv}),Id=Pt({logicalAnd_:function(_,v){var d=Ze(_,"a","logicalAnd","bool"),y=Ze(v,"b","logicalAnd","bool");return no(d.shape,y.shape),Ve.runKernelFunc(function(E){return E.logicalAnd(d,y)},{a:d,b:y},null,"LogicalAnd")}}),bv=Pt({logicalNot_:function(_){var v=Ze(_,"x","logicalNot","bool");return Ve.runKernelFunc(function(d){return d.logicalNot(v)},{$x:v})}}),s0=Pt({logicalOr_:function(_,v){var d=Ze(_,"a","logicalOr","bool"),y=Ze(v,"b","logicalOr","bool");return no(d.shape,y.shape),Ve.runKernelFunc(function(E){return E.logicalOr(d,y)},{$a:d,$b:y})}}),Fd=Pt({logicalXor_:function(_,v){var d=Ze(_,"a","logicalXor","bool"),y=Ze(v,"b","logicalXor","bool");return no(d.shape,y.shape),s0(_,v).logicalAnd(Id(_,v).logicalNot())}}),po=Pt({where_:function(_,v,d){var y=Ze(v,"a","where"),E=Ze(d,"b","where"),B=Ze(_,"condition","where","bool");return bt(y.shape,E.shape,"Error in where: "),B.rank===1?we(B.shape[0]===y.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):bt(B.shape,E.shape,"Error in where: "),Ve.runKernelFunc(function(Q,re){var fe=Q.select(B,y,E);return re([B]),fe},{$condition:B,$a:y,$b:E},function(Q,re){var fe=re[0];return{$condition:function(){return mi(fe).toFloat()},$a:function(){return Q.mul(fe.cast(Q.dtype))},$b:function(){return Q.mul(fe.logicalNot().cast(Q.dtype))}}})}}),Tf=function(_){return N(this,void 0,void 0,function(){var v,d,y;return L(this,function(E){switch(E.label){case 0:return[4,(v=Ze(_,"condition","whereAsync","bool")).data()];case 1:return d=E.sent(),y=ne(v.shape,d),_!==v&&v.dispose(),[2,y]}})})},qh=Pt({add_:function(_,v){var d,y=Ze(_,"a","add"),E=Ze(v,"b","add");d=Kt(y,E),y=d[0],E=d[1];var B=no(y.shape,E.shape);return Ve.runKernelFunc(function(Q){return Q.add(y,E)},{a:y,b:E},function(Q){return{a:function(){var re=Q,fe=Ta(y.shape,B);return fe.length>0&&(re=re.sum(fe)),re.reshape(y.shape)},b:function(){var re=Q,fe=Ta(E.shape,B);return fe.length>0&&(re=re.sum(fe)),re.reshape(E.shape)}}},"Add")}}),Ay=Pt({addN_:function(_){we(Array.isArray(_),function(){return"The argument passed to tf.addN() must be a list of tensors"}),we(_.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+_.length});var v=_.map(function(E,B){return Ze(E,"tensors"+B,"addN")}),d=v[0];v.forEach(function(E){if(E.dtype!==d.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),v.forEach(function(E){if(!Ut(E.shape,d.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var y=v;return Ve.runKernelFunc(function(E){return E.addN(v)},y,function(E){var B={};return v.forEach(function(Q,re){B[re]=function(){return E.clone()}}),B},"AddN")}}),Oy=Pt({addStrict_:function(_,v){var d=Ze(_,"a","addStrict"),y=Ze(v,"b","addStrict");return bt(d.shape,y.shape,"Error in addStrict: "),d.add(y)}}),rg=Pt({atan2_:function(_,v){var d,y=Ze(_,"a","atan2"),E=Ze(v,"b","atan2");d=Kt(y,E),y=d[0],E=d[1];var B=no(y.shape,E.shape);return Ve.runKernelFunc(function(Q,re){var fe=Q.atan2(y,E);return re([y,E]),fe},{$a:y,$b:E},function(Q,re){var fe=re[0],xe=re[1];return{$a:function(){var Oe=qh(fe.square(),xe.square()),Re=Q.mul(xe.div(Oe)),Le=Ta(fe.shape,B);return Le.length>0&&(Re=Re.sum(Le)),Re.reshape(fe.shape)},$b:function(){var Oe=qh(fe.square(),xe.square()),Re=hv(Q.mul(fe.div(Oe))),Le=Ta(xe.shape,B);return Le.length>0&&(Re=Re.sum(Le)),Re.reshape(xe.shape)}}})}}),Mf=Pt({div_:function(_,v){var d,y=Ze(_,"a","div"),E=Ze(v,"b","div");if(d=Kt(y,E),y=d[0],E=d[1],y.dtype==="int32"&&E.dtype==="int32")return $h(y,E);var B=no(y.shape,E.shape);return Ve.runKernelFunc(function(Q,re){var fe=Q.realDivide(y,E);return re([y,E]),fe},{a:y,b:E},function(Q,re){var fe=re[0],xe=re[1];return{a:function(){var Oe=Q.div(xe.toFloat()),Re=Ta(fe.shape,B);return Re.length>0?Oe.sum(Re).reshape(fe.shape):Oe},b:function(){var Oe=Q.mul(fe.toFloat()),Re=Ta(xe.shape,B);Re.length>0&&(Oe=Oe.sum(Re).reshape(xe.shape));var Le=xe.square();return Oe.div(Le.toFloat()).neg()}}},"Div")}}),zl=Pt({divNoNan_:function(_,v){var d,y=Ze(_,"a","div"),E=Ze(v,"b","div");y=(d=Kt(y,E))[0],E=d[1];var B=Mf(y,E),Q=mi(B),re=E.equal(Q);return po(re,Q,B)}}),cm=Pt({divStrict_:function(_,v){var d=Ze(_,"a","div"),y=Ze(v,"b","div");return bt(d.shape,y.shape,"Error in divideStrict: "),d.div(y)}}),$h=Pt({floorDiv_:function(_,v){var d,y=Ze(_,"a","floorDiv"),E=Ze(v,"b","floorDiv");d=Kt(y,E),y=d[0],E=d[1];var B=no(y.shape,E.shape);return Ve.runKernelFunc(function(Q,re){var fe=Q.floorDiv(y,E);return re([y,E]),fe},{a:y,b:E},function(Q,re){var fe=re[0],xe=re[1];return{a:function(){var Oe=Q.div(xe.toFloat()),Re=Ta(fe.shape,B);return Re.length>0?Oe.sum(Re).reshape(fe.shape):Oe},b:function(){var Oe=Q.mul(fe.toFloat()),Re=Ta(xe.shape,B);Re.length>0&&(Oe=Oe.sum(Re).reshape(xe.shape));var Le=xe.square();return Oe.div(Le.toFloat()).neg()}}},"FloorDiv")}}),Rd=Pt({maximum_:function(_,v){var d,y=Ze(_,"a","maximum"),E=Ze(v,"b","maximum");return d=Kt(y,E),y=d[0],E=d[1],y.dtype==="bool"&&(y=y.toInt(),E=E.toInt()),no(y.shape,E.shape),Ve.runKernelFunc(function(B,Q){var re=B.maximum(y,E);return Q([y,E]),re},{a:y,b:E},function(B,Q){var re=Q[0],fe=Q[1];return{a:function(){return B.mul(re.greaterEqual(fe).toFloat())},b:function(){return B.mul(re.less(fe).toFloat())}}},"Maximum")}}),Df=Pt({maximumStrict_:function(_,v){var d=Ze(_,"a","maximumStrict"),y=Ze(v,"b","maximumStrict");return bt(d.shape,y.shape,"Error in maximumStrict: "),d.maximum(y)}}),Nf=Pt({minimum_:function(_,v){var d,y=Ze(_,"a","minimum"),E=Ze(v,"b","minimum");return d=Kt(y,E),y=d[0],E=d[1],y.dtype==="bool"&&(y=y.toInt(),E=E.toInt()),no(y.shape,E.shape),Ve.runKernelFunc(function(B,Q){var re=B.minimum(y,E);return Q([y,E]),re},{a:y,b:E},function(B,Q){var re=Q[0],fe=Q[1];return{a:function(){return B.mul(re.lessEqual(fe).toFloat())},b:function(){return B.mul(re.greater(fe).toFloat())}}},"Minimum")}}),Zu=Pt({minimumStrict_:function(_,v){var d=Ze(_,"a","minimumStrict"),y=Ze(v,"b","minimumStrict");return bt(d.shape,y.shape,"Error in minimumStrict: "),d.minimum(y)}}),Xh=Pt({mod_:function(_,v){var d,y=Ze(_,"a","mod"),E=Ze(v,"b","mod");d=Kt(y,E),y=d[0],E=d[1];var B=no(y.shape,E.shape);return Ve.runKernelFunc(function(Q,re){var fe=Q.mod(y,E);return re([y,E]),fe},{$a:y,$b:E},function(Q,re){var fe=re[0],xe=re[1];return{$a:function(){var Oe=Ta(fe.shape,B);return Oe.length>0?Q.sum(Oe).reshape(fe.shape):Q},$b:function(){var Oe=Q.mul(fe.div(xe).floor().neg()),Re=Ta(xe.shape,B);return Re.length>0?Oe.sum(Re).reshape(xe.shape):Oe}}})}}),Pd=Pt({modStrict_:function(_,v){var d=Ze(_,"a","modStrict"),y=Ze(v,"b","modStrict");return bt(d.shape,y.shape,"Error in modStrict: "),d.mod(y)}}),Ul=Pt({mul_:function(_,v){var d,y=Ze(_,"a","mul"),E=Ze(v,"b","mul");d=Kt(y,E),y=d[0],E=d[1];var B=no(y.shape,E.shape);return Ve.runKernelFunc(function(Q,re){var fe=Q.multiply(y,E);return re([y,E]),fe},{a:y,b:E},function(Q,re){var fe=re[0],xe=re[1];return{a:function(){var Oe=Q.mul(xe.toFloat()),Re=Ta(fe.shape,B);return Re.length>0?Oe.sum(Re).reshape(fe.shape):Oe},b:function(){var Oe=Q.mul(fe.toFloat()),Re=Ta(xe.shape,B);return Re.length>0?Oe.sum(Re).reshape(xe.shape):Oe}}},"Mul")}}),ul=Pt({mulStrict_:function(_,v){var d=Ze(_,"a","mul"),y=Ze(v,"b","mul");return bt(d.shape,y.shape,"Error in multiplyStrict: "),d.mul(y)}}),Ld=Pt({pow_:function(_,v){var d,y=Ze(_,"base","pow"),E=Ze(v,"exp","pow");d=Kt(y,E),y=d[0],E=d[1];var B=no(y.shape,E.shape),Q=[y,E];return Ve.runKernelFunc(function(re,fe){var xe=re.pow(y,E);return fe([y,E,xe]),xe},{a:y,b:E},function(re,fe){var xe=fe[0],Oe=fe[1],Re=fe[2];return{a:function(){var Le=Oe.toFloat(),Be=re.mul(Le.mul(xe.pow(Le.sub(kr(1))))),Xe=Ta(xe.shape,B);return Xe.length>0&&(Be=Be.sum(Xe)),Be.reshape(xe.shape)},b:function(){var Le=xe.greater(0),Be=xe.log().where(Le,mi(xe)),Xe=re.mul(Re.mul(Be)),nt=Ta(Oe.shape,B);return nt.length>0&&(Xe=Xe.sum(nt)),Xe.reshape(Oe.shape)}}},"Pow",{},Q,[!0])}}),ig=Pt({powStrict_:function(_,v){return bt(_.shape,v.shape,"Error in powStrict: "),_.pow(v)}}),Bd=Pt({squaredDifferenceStrict_:function(_,v){var d=Ze(_,"a","squaredDifferenceStrict"),y=Ze(v,"b","squaredDifferenceStrict");return bt(d.shape,y.shape,"Error in squaredDifferenceStrict: "),d.squaredDifference(y)}}),cl=Pt({sub_:function(_,v){var d,y=Ze(_,"a","sub"),E=Ze(v,"b","sub");d=Kt(y,E),y=d[0],E=d[1];var B=no(y.shape,E.shape);return Ve.runKernelFunc(function(Q){return Q.subtract(y,E)},{a:y,b:E},function(Q){return{a:function(){var re=Q,fe=Ta(y.shape,B);return fe.length>0&&(re=re.sum(fe)),re.reshape(y.shape)},b:function(){var re=Q,fe=Ta(E.shape,B);return fe.length>0&&(re=re.sum(fe)),re.neg().reshape(E.shape)}}},"Sub")}}),ds=Pt({subStrict_:function(_,v){var d=Ze(_,"a","subStrict"),y=Ze(v,"b","subStrict");return bt(d.shape,y.shape,"Error in subStrict: "),d.sub(y)}}),Lc=Pt({equal_:function(_,v){var d,y=Ze(_,"a","equal"),E=Ze(v,"b","equal");return d=Kt(y,E),y=d[0],E=d[1],no(y.shape,E.shape),Ve.runKernelFunc(function(B){return B.equal(y,E)},{$a:y,$b:E})}}),ec=Pt({equalStrict_:function(_,v){var d=Ze(_,"a","equalStrict"),y=Ze(v,"b","equalStrict");return bt(d.shape,y.shape,"Error in equalStrict: "),d.equal(y)}}),Nu=Pt({greater_:function(_,v){var d,y=Ze(_,"a","greater"),E=Ze(v,"b","greater");return d=Kt(y,E),y=d[0],E=d[1],no(y.shape,E.shape),Ve.runKernelFunc(function(B){return B.greater(y,E)},{a:y,b:E},null,"Greater")}}),Kh=Pt({greaterEqual_:function(_,v){var d,y=Ze(_,"a","greaterEqual"),E=Ze(v,"b","greaterEqual");return d=Kt(y,E),y=d[0],E=d[1],no(y.shape,E.shape),Ve.runKernelFunc(function(B,Q){var re=B.greaterEqual(y,E);return Q([y,E]),re},{a:y,b:E},function(B,Q){var re=Q[0],fe=Q[1];return{a:function(){return mi(re)},b:function(){return mi(fe)}}},"GreaterEqual")}}),og=Pt({greaterEqualStrict_:function(_,v){var d=Ze(_,"a","greaterEqualStrict"),y=Ze(v,"b","greaterEqualStrict");return bt(d.shape,y.shape,"Error in greaterEqualStrict: "),d.greaterEqual(y)}}),u0=Pt({greaterStrict_:function(_,v){var d=Ze(_,"a","greaterStrict"),y=Ze(v,"b","greaterStrict");return bt(d.shape,y.shape,"Error in greaterStrict: "),d.greater(y)}}),c0=Pt({less_:function(_,v){var d,y=Ze(_,"a","less"),E=Ze(v,"b","less");return d=Kt(y,E),y=d[0],E=d[1],no(y.shape,E.shape),Ve.runKernelFunc(function(B){return B.less(y,E)},{a:y,b:E},null,"Less")}}),lm=Pt({lessEqual_:function(_,v){var d,y=Ze(_,"a","lessEqual"),E=Ze(v,"b","lessEqual");return d=Kt(y,E),y=d[0],E=d[1],no(y.shape,E.shape),Ve.runKernelFunc(function(B,Q){var re=B.lessEqual(y,E);return Q([y,E]),re},{a:y,b:E},null,"LessEqual")}}),zo=Pt({lessEqualStrict_:function(_,v){var d=Ze(_,"a","lessEqualStrict"),y=Ze(v,"b","lessEqualStrict");return bt(d.shape,y.shape,"Error in lessEqualStrict: "),d.lessEqual(y)}}),fm=Pt({lessStrict_:function(_,v){var d=Ze(_,"a","lessStrict"),y=Ze(v,"b","lessStrict");return bt(d.shape,y.shape,"Error in lessStrict: "),d.less(y)}}),Bc=Pt({notEqual_:function(_,v){var d,y=Ze(_,"a","notEqual"),E=Ze(v,"b","notEqual");return d=Kt(y,E),y=d[0],E=d[1],no(y.shape,E.shape),Ve.runKernelFunc(function(B){return B.notEqual(y,E)},{a:y,b:E},null,"NotEqual")}}),jd=Pt({notEqualStrict_:function(_,v){var d=Ze(_,"a","notEqualStrict"),y=Ze(v,"b","notEqualStrict");return bt(d.shape,y.shape,"Error in notEqualStrict: "),d.notEqual(y)}});function zd(_,v){for(var d=[],y=_;y<v;++y)d.push(y);return d}function dm(_){for(var v=[],d=0;d<_.length;++d)for(var y=0;y<_[d].length;++y)v.push(_[d][y]);return v}var ag=Pt({gather_:function(_,v,d){d===void 0&&(d=0);var y=Ze(_,"x","gather"),E=Ze(v,"indices","gather","int32");d=Yt(d,y.shape)[0];var B=function(Q,re,fe){for(var xe=Q.shape[fe],Oe=[],Re=1,Le=1,Be=0;Be<fe;Be++)Oe.push(Q.shape[Be]),Re*=Q.shape[Be];for(Be=0;Be<re.rank;Be++)Oe.push(re.shape[Be]);for(Be=fe+1;Be<Q.rank;Be++)Oe.push(Q.shape[Be]),Le*=Q.shape[Be];return{batchSize:Re,sliceSize:Le,dimSize:xe,outputShape:Oe}}(y,E,d);return Ve.runKernelFunc(function(Q,re){var fe=Q.gather(y,E.flatten(),d);return re([E]),fe},{x:y,indices:E},function(Q,re){var fe=re[0];return{x:function(){var xe=y.shape,Oe=fe.size,Re=xe.slice(0,d),Le=Re.length,Be=xe.slice(d,xe.length).slice(1),Xe=Be.length,nt=zd(0,Le),tt=zd(Le+1,Le+1+Xe),ut=dm([Re,[Oe],Be]),Dt=Q.reshape(ut),Rt=fe.reshape([Oe]),Lt=dm([[Le],nt,tt]),qt=Dt.transpose(Lt),pn=sg(qt,Rt,y.shape[d]),bn=Vu(Lt);return pn.transpose(bn)},indices:function(){return fe}}},"Gather",{axis:d}).reshape(B.outputShape)}}),sg=Pt({unsortedSegmentSum_:function(_,v,d){var y=Ze(_,"x","unsortedSegmentSum"),E=Ze(v,"segmentIds","unsortedSegmentSum","int32");return we(Ft(d),function(){return"numSegments must be of dtype int"}),Ve.runKernelFunc(function(B,Q){var re=B.unsortedSegmentSum(y,E,d);return Q([E]),re},{$x:y},function(B,Q){var re=Q[0];return{$x:function(){return function(fe,xe){for(var Oe=Rd(xe,mi(xe)),Re=ag(fe,Oe),Le=Kh(xe,kr(0,"int32")),Be=Re.rank-Le.rank,Xe=0;Xe<Be;++Xe)Le=Go(Le,Xe+1);Le=Id(Le,Du(Re.shape,"bool"));var nt=mi(Re);return po(Le,Re,nt)}(B,re)}}})}}),ug=function(_,v,d){return N(this,void 0,void 0,function(){var y,E,B,Q,re,fe,xe,Oe,Re,Le,Be,Xe,nt;return L(this,function(tt){switch(tt.label){case 0:for(y=Ze(_,"tensor","boolMask"),E=Ze(v,"mask","boolMask","bool"),B=d??0,Q=E.rank,re=y.shape,we(Q>0,function(){return"mask cannot be scalar"}),bt(re.slice(B,B+Q),E.shape,"mask's shape must match the first K dimensions of tensor's shape,"),fe=1,xe=B;xe<B+Q;xe++)fe*=re[xe];return Oe=re.slice(0,B).concat([fe],re.slice(B+Q)),Re=y.reshape(Oe),Le=E.reshape([-1]),[4,Tf(Le)];case 1:return Be=tt.sent(),Xe=Be.squeeze([1]),nt=ag(Re,Xe,B),_!==y&&y.dispose(),v!==E&&E.dispose(),Xe.dispose(),Re.dispose(),Le.dispose(),Be.dispose(),[2,nt]}})})};function xv(_,v,d,y,E,B,Q){B===void 0&&(B="NHWC"),we(_.length===v.rank,function(){return"Length of inShape ("+_.length+") and rank of dy ("+v.rank+") must match"});var re=_,fe=v,xe=!1;v.rank===3&&(xe=!0,fe=v.as4D(1,v.shape[0],v.shape[1],v.shape[2]),re=[1,_[0],_[1],_[2]]),we(re.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+re.length+"."}),we(fe.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+fe.rank}),we(d.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+d.rank});var Oe=B==="NHWC"?re[3]:re[1],Re=B==="NHWC"?fe.shape[3]:fe.shape[1];we(Oe===d.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+Oe+") must match input depth for filter "+d.shape[2]+"."}),we(Re===d.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+Re+") must match output depth for filter "+d.shape[3]+"."}),Q!=null&&we(Ft(E),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+Q+" but got pad "+E+"."});var Le=ra(B),Be=au(re,d.shape,y,1,E,Q,!1,Le),Xe=Ve.runKernelFunc(function(nt,tt){var ut=nt.conv2dDerInput(fe,d,Be);return tt([d,fe]),ut},{dy4D:fe,filter:d},function(nt,tt){var ut=tt[0],Dt=tt[1];return{dy4D:function(){return Yh(nt,ut,y,E,B,1,Q)},filter:function(){return l0(nt,Dt,ut.shape,y,E,B,Q)}}});return xe?Xe.as3D(Xe.shape[1],Xe.shape[2],Xe.shape[3]):Xe}function cg(_){var v=function(B){return typeof B=="number"?[B,B,B]:B.length===2?[B[0],B[1],1]:B}(_),d=v[0],y=v[1],E=v[2];return d===1&&y===1&&E===1}function If(_,v,d,y,E){we(_.length===v.rank,function(){return"Length of inShape ("+_.length+") and rank of dy ("+v.rank+") must match"});var B=_,Q=v,re=!1;v.rank===4&&(re=!0,Q=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3]),B=[1,_[0],_[1],_[2],_[3]]);var fe=B[4],xe=Q.shape[4];we(B.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+B.length+"."}),we(Q.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+Q.rank}),we(d.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+d.rank}),we(fe===d.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+fe+") must match input depth for filter "+d.shape[3]+"."}),we(xe===d.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+xe+") must match output depth for filter "+d.shape[4]+"."});var Oe=Ic(B,d.shape,y,1,E),Re=Ve.runKernelFunc(function(Le){return Le.conv3dDerInput(Q,d,Oe)},{dy5D:Q});return re?Re.as4D(Re.shape[1],Re.shape[2],Re.shape[3],Re.shape[4]):Re}var lg=Pt({conv1d_:function(_,v,d,y,E,B,Q){E===void 0&&(E="NWC"),B===void 0&&(B=1);var re=Ze(_,"x","conv1d"),fe=Ze(v,"filter","conv1d"),xe=re,Oe=!1;re.rank===2&&(Oe=!0,xe=re.as3D(1,re.shape[0],re.shape[1])),we(xe.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+xe.rank+"."}),we(fe.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+fe.rank+"."}),Q!=null&&we(Ft(y),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+Q+" but got pad "+y+"."}),we(xe.shape[2]===fe.shape[1],function(){return"Error in conv1d: depth of input ("+xe.shape[2]+") must match input depth for filter "+fe.shape[1]+"."}),we(_s(d,B),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+d+" and dilation '"+B+"'"}),we(E==="NWC",function(){return"Error in conv1d: got dataFormat of "+E+" but only NWC is currently supported."});var Re=fe.as4D(1,fe.shape[0],fe.shape[1],fe.shape[2]),Le=xe.as4D(xe.shape[0],1,xe.shape[1],xe.shape[2]),Be=Yh(Le,Re,[1,d],y,"NHWC",[1,B],Q);return Oe?Be.as2D(Be.shape[2],Be.shape[3]):Be.as3D(Be.shape[0],Be.shape[2],Be.shape[3])}}),Yh=Pt({conv2d_:function(_,v,d,y,E,B,Q){E===void 0&&(E="NHWC"),B===void 0&&(B=[1,1]);var re=Ze(_,"x","conv2d"),fe=Ze(v,"filter","conv2d"),xe=re,Oe=!1;re.rank===3&&(Oe=!0,xe=re.as4D(1,re.shape[0],re.shape[1],re.shape[2])),we(xe.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+xe.rank+"."}),we(fe.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+fe.rank+"."}),Q!=null&&we(Ft(y),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+Q+" but got pad "+y+"."});var Re=E==="NHWC"?xe.shape[3]:xe.shape[1];we(Re===fe.shape[2],function(){return"Error in conv2d: depth of input ("+Re+") must match input depth for filter "+fe.shape[2]+"."}),we(_s(d,B),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+d+" and dilations '"+B+"'"});var Le=ra(E),Be=au(xe.shape,fe.shape,d,B,y,Q,!1,Le),Xe=[fe,xe],nt=Ve.runKernelFunc(function(tt,ut){var Dt=tt.conv2d(xe,fe,Be);return ut([fe,xe]),Dt},{x:xe,filter:fe},function(tt,ut){var Dt=ut,Rt=Dt[0],Lt=Dt[1];return we(Ba(B),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+B+"'"}),{x:function(){return f0(Lt.shape,tt,Rt,d,y,E)},filter:function(){return l0(Lt,tt,Rt.shape,d,y,E)}}},"Conv2D",Be,Xe);return Oe?nt.as3D(nt.shape[1],nt.shape[2],nt.shape[3]):nt}}),fg=Pt({conv3d_:function(_,v,d,y,E,B){E===void 0&&(E="NDHWC"),B===void 0&&(B=[1,1,1]);var Q=Ze(_,"x","conv3d"),re=Ze(v,"filter","conv3d"),fe=Q,xe=!1;Q.rank===4&&(xe=!0,fe=Q.as5D(1,Q.shape[0],Q.shape[1],Q.shape[2],Q.shape[3])),we(fe.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+fe.rank+"."}),we(re.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+re.rank+"."}),we(fe.shape[4]===re.shape[3],function(){return"Error in conv3d: depth of input ("+fe.shape[4]+") must match input depth for filter "+re.shape[3]+"."}),we(function(Le,Be){return cg(d)||cg(Be)}(0,B),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+d+" and dilations '"+B+"'"}),we(E==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+E+" but only NDHWC is currently supported."});var Oe=Ic(fe.shape,re.shape,d,B,y),Re=Ve.runKernelFunc(function(Le,Be){var Xe=Le.conv3d(fe,re,Oe);return Be([fe,re]),Xe},{x:fe,$filter:re},function(Le,Be){we(cg(B),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+B+"'"});var Xe=Be[0],nt=Be[1];return{x:function(){return If(Xe.shape,Le,nt,d,y)},$filter:function(){return function(tt,ut,Dt,Rt,Lt){var qt=tt;tt.rank===4&&(qt=tt.as5D(1,tt.shape[0],tt.shape[1],tt.shape[2],tt.shape[3]));var pn=ut;pn.rank===4&&(pn=ut.as5D(1,ut.shape[0],ut.shape[1],ut.shape[2],ut.shape[3])),we(qt.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+qt.shape+"."}),we(pn.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+pn.shape+"."}),we(Dt.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+Dt+"."}),we(qt.shape[4]===Dt[3],function(){return"Error in conv3dDerFilter: depth of input "+qt.shape[4]+") must match input depth in filter ("+Dt[3]+"."}),we(pn.shape[4]===Dt[4],function(){return"Error in conv3dDerFilter: depth of dy ("+pn.shape[4]+") must match output depth for filter ("+Dt[4]+")."});var bn=Ic(qt.shape,Dt,Rt,1,Lt);return Ve.runKernelFunc(function(mn){return mn.conv3dDerFilter(qt,pn,bn)},{x5D:qt,dy5D:pn})}(Xe,Le,nt.shape,d,y)}}});return xe?Re.as4D(Re.shape[1],Re.shape[2],Re.shape[3],Re.shape[4]):Re}}),l0=Pt({conv2dDerFilter_:function(_,v,d,y,E,B,Q){B===void 0&&(B="NHWC");var re=_;_.rank===3&&(re=_.as4D(1,_.shape[0],_.shape[1],_.shape[2]));var fe=v;fe.rank===3&&(fe=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),we(re.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+re.shape+"."}),we(fe.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+fe.shape+"."}),we(d.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+d+"."});var xe=B==="NHWC"?re.shape[3]:re.shape[1],Oe=B==="NHWC"?fe.shape[3]:fe.shape[1];we(xe===d[2],function(){return"Error in conv2dDerFilter: depth of input "+xe+") must match input depth in filter ("+d[2]+"."}),we(Oe===d[3],function(){return"Error in conv2dDerFilter: depth of dy ("+Oe+") must match output depth for filter ("+d[3]+")."}),Q!=null&&we(Ft(E),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+Q+" but got pad "+E+"."});var Re=ra(B),Le=au(re.shape,d,y,1,E,Q,!1,Re);return Ve.runKernelFunc(function(Be){return Be.conv2dDerFilter(re,fe,Le)},{x4D:re,dy4D:fe})}}),f0=Pt({conv2dDerInput_:xv}),hm=Pt({depthwiseConv2d_:function(_,v,d,y,E,B,Q){B===void 0&&(B=[1,1]);var re=Ze(_,"x","depthwiseConv2d"),fe=Ze(v,"filter","depthwiseConv2d"),xe=re,Oe=!1;re.rank===3&&(Oe=!0,xe=re.as4D(1,re.shape[0],re.shape[1],re.shape[2])),we(xe.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+xe.rank+"."}),we(fe.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+fe.rank+"."}),we(xe.shape[3]===fe.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+xe.shape[3]+") must match the inChannels dimension in filter "+fe.shape[2]+"."}),B==null&&(B=[1,1]),we(_s(d,B),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+d+" and dilations '"+B+"'"}),Q!=null&&we(Ft(y),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+Q+" but got pad "+y+"."});var Re=au(xe.shape,fe.shape,d,B,y,Q,!0),Le=[xe,fe],Be=Ve.runKernelFunc(function(Xe,nt){var tt=Xe.depthwiseConv2D(xe,fe,Re);return nt([xe,fe]),tt},{x:xe,filter:fe},function(Xe,nt){we(Ba(B),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+B+"'"});var tt=nt[0],ut=nt[1];return{x:function(){return d0(tt.shape,Xe,ut,Re)},filter:function(){return dg(tt,Xe,ut.shape,Re)}}},"DepthwiseConv2dNative",Re,Le);return Oe?Be.as3D(Be.shape[1],Be.shape[2],Be.shape[3]):Be}}),d0=Pt({depthwiseConv2dDerInput_:function(_,v,d,y){var E=v,B=!1;v.rank===3&&(B=!0,E=v.as4D(1,v.shape[0],v.shape[1],v.shape[2]));var Q=Ve.runKernelFunc(function(re){return re.depthwiseConv2DDerInput(E,d,y)},{dy4D:E});return B?Q.as3D(Q.shape[1],Q.shape[2],Q.shape[3]):Q}}),dg=Pt({depthwiseConv2dDerFilter_:function(_,v,d,y){var E=_;_.rank===3&&(E=_.as4D(1,_.shape[0],_.shape[1],_.shape[2]));var B=v;return B.rank===3&&(B=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),Ve.runKernelFunc(function(Q){return Q.depthwiseConv2DDerFilter(E,B,y)},{x4D:E,dy4D:B})}}),wv=Pt({separableConv2d_:function(_,v,d,y,E,B,Q){B===void 0&&(B=[1,1]),Q===void 0&&(Q="NHWC");var re=Ze(_,"x","separableConv2d"),fe=Ze(v,"depthwiseFilter","separableConv2d"),xe=Ze(d,"pointwiseFilter","separableConv2d"),Oe=re,Re=!1;if(re.rank===3&&(Re=!0,Oe=re.as4D(1,re.shape[0],re.shape[1],re.shape[2])),Q==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");we(Oe.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+Oe.rank+"."}),we(fe.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+fe.rank+"."}),we(xe.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+fe.rank+"."}),we(xe.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+xe.shape[0]+"."}),we(xe.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+xe.shape[1]+"."});var Le=fe.shape[2],Be=fe.shape[3];we(xe.shape[2]===Le*Be,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+Le*Be+", but got "+xe.shape[2]+"."});var Xe=hm(Oe,fe,y,E,Q,B),nt=Yh(Xe,xe,1,"valid",Q);return Re?nt.as3D(nt.shape[1],nt.shape[2],nt.shape[3]):nt}}),Wl=Pt({conv2dTranspose_:function(_,v,d,y,E,B){return xv(d,Ze(_,"x","conv2dTranspose"),Ze(v,"filter","conv2dTranspose"),y,E,"NHWC",B)}}),Ty=Pt({conv3dTranspose_:function(_,v,d,y,E){return If(d,Ze(_,"x","conv3dTranspose"),Ze(v,"filter","conv3dTranspose"),y,E)}}),_v=Pt({matMul_:function(_,v,d,y){var E;d===void 0&&(d=!1),y===void 0&&(y=!1);var B=Ze(_,"a","matMul"),Q=Ze(v,"b","matMul");E=Kt(B,Q),B=E[0],Q=E[1];var re=d?B.shape[B.rank-2]:B.shape[B.rank-1],fe=y?Q.shape[Q.rank-1]:Q.shape[Q.rank-2],xe=d?B.shape[B.rank-1]:B.shape[B.rank-2],Oe=y?Q.shape[Q.rank-2]:Q.shape[Q.rank-1],Re=B.shape.slice(0,-2),Le=Q.shape.slice(0,-2),Be=ze(Re),Xe=ze(Le);we(B.rank>=2&&Q.rank>=2&&B.rank===Q.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+B.rank+" and "+Q.rank+"."}),we(Ut(Re,Le),function(){return"Error in matMul: outer dimensions ("+Re+") and ("+Le+") of Tensors with shapes "+B.shape+" and "+Q.shape+" must match."}),we(re===fe,function(){return"Error in matMul: inner shapes ("+re+") and ("+fe+") of Tensors with shapes "+B.shape+" and "+Q.shape+" and transposeA="+d+" and transposeB="+y+" must match."});var nt=B.shape.slice(0,-2).concat([xe,Oe]),tt=d?B.as3D(Be,re,xe):B.as3D(Be,xe,re),ut=y?Q.as3D(Xe,Oe,fe):Q.as3D(Xe,fe,Oe),Dt={transposeA:d,transposeB:y};return Ve.runKernelFunc(function(Rt,Lt){var qt=Rt.batchMatMul(tt,ut,d,y);return Lt([tt,ut]),qt},{a:tt,b:ut},function(Rt,Lt){var qt=Lt,pn=qt[0],bn=qt[1];return d||y?!d&&y?{a:function(){return Rt.matMul(bn,!1,!1)},b:function(){return Rt.matMul(pn,!0,!1)}}:d&&!y?{a:function(){return bn.matMul(Rt,!1,!0)},b:function(){return pn.matMul(Rt,!1,!1)}}:{a:function(){return bn.matMul(Rt,!0,!0)},b:function(){return Rt.matMul(pn,!0,!0)}}:{a:function(){return Rt.matMul(bn,!1,!0)},b:function(){return pn.matMul(Rt,!0,!1)}}},"BatchMatMul",Dt).reshape(nt)}}),pm=Pt({dot_:function(_,v){var d=Ze(_,"t1","dot"),y=Ze(v,"t2","dot");we(!(d.rank!==1&&d.rank!==2||y.rank!==1&&y.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+d.rank+" and "+y.rank+"."});var E=d.rank===1?d.size:d.shape[1],B=y.rank===1?y.size:y.shape[0];return we(E===B,function(){return"Error in dot: inner dimensions of inputs must match, but got "+E+" and "+B+"."}),d.rank===1&&y.rank===1?d.as2D(1,-1).matMul(y.as2D(-1,1)).asScalar():d.rank===1&&y.rank===2?d.as2D(1,-1).matMul(y.as2D(y.shape[0],y.shape[1])).as1D():d.rank===2&&y.rank===1?d.matMul(y.as2D(-1,1)).as1D():d.matMul(y.as2D(y.shape[0],y.shape[1]))}}),Ev=Pt({outerProduct_:function(_,v){var d=Ze(_,"v1","outerProduct"),y=Ze(v,"v2","outerProduct");return we(d.rank===1&&y.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+d.rank+" and "+y.rank+"."}),d.as2D(-1,1).matMul(y.as2D(1,-1))}}),Ff=Pt({reverse_:function(_,v){var d=Ze(_,"x","reverse");if(d.rank===0)return d.clone();var y=Yt(v,d.shape);return Ve.runKernelFunc(function(E){return E.reverse(d,y)},{$x:d},function(E){return{$x:function(){return E.reverse(y)}}}).reshapeAs(d)}}),Sv=Pt({reverse1d_:function(_){var v=Ze(_,"x","reverse");return we(v.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+v.rank+"."}),Ff(v,0)}}),mm=Pt({reverse2d_:function(_,v){var d=Ze(_,"x","reverse");return we(d.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+d.rank+"."}),Ff(d,v)}}),hg=Pt({reverse3d_:function(_,v){var d=Ze(_,"x","reverse");return we(d.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+d.rank+"."}),Ff(d,v)}}),kv=Pt({reverse4d_:function(_,v){var d=Ze(_,"x","reverse");return we(d.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+d.rank+"."}),Ff(d,v)}});function Cv(_,v,d,y,E,B){var Q=Ze(_,"x","maxPool"),re=Q,fe=!1;Q.rank===3&&(fe=!0,re=Q.as4D(1,Q.shape[0],Q.shape[1],Q.shape[2])),y==null&&(y=[1,1]),we(re.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+re.rank+"."}),we(_s(d,y),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+d+" and dilations '"+y+"'"}),B!=null&&we(Ft(E),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+B+" but got pad "+E+"."});var xe=Hu(re.shape,v,d,y,E,B);if(xe.filterWidth===1&&xe.filterHeight===1&&Ut(xe.inShape,xe.outShape))return Q.clone();var Oe=[re],Re=Ve.runKernelFunc(function(Le,Be){var Xe=Le.maxPool(re,xe);return Be([re,Xe]),Xe},{x:re},function(Le,Be){var Xe=Be[0],nt=Be[1];return{x:function(){return function(tt,ut,Dt,Rt,Lt,qt,pn,bn){var mn=Ze(tt,"dy","maxPoolBackprop"),Sn=Ze(ut,"input","maxPoolBackprop"),On=Ze(Dt,"output","maxPoolBackprop");we(Sn.rank===mn.rank,function(){return"Rank of input ("+Sn.rank+") does not match rank of dy ("+mn.rank+")"}),qt==null&&(qt=[1,1]),we(_s(Lt,qt),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+Lt+" and dilations '"+qt+"'"}),we(mn.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+mn.rank+"."}),we(Sn.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+Sn.rank+"."});var b=Hu(Sn.shape,Rt,Lt,qt,pn,bn);return Ve.runKernelFunc(function(h){return h.maxPoolBackprop(mn,Sn,On,b)},{$dy:mn,$input:Sn})}(Le,Xe,nt,v,d,y,E)}}},"MaxPool",xe,Oe);return fe?Re.as3D(Re.shape[1],Re.shape[2],Re.shape[3]):Re}function h0(_,v,d,y,E,B){var Q=Ze(_,"x","avgPool","float32");y==null&&(y=[1,1]),we(_s(d,y),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+d+" and dilations '"+y+"'"});var re=Q,fe=!1;Q.rank===3&&(fe=!0,re=Q.as4D(1,Q.shape[0],Q.shape[1],Q.shape[2])),we(re.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+re.rank+"."}),B!=null&&we(Ft(E),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+B+" but got pad "+E+"."});var xe=Hu(re.shape,v,d,y,E,B);if(xe.filterWidth===1&&xe.filterHeight===1&&Ut(xe.inShape,xe.outShape))return Q.clone();var Oe=Ve.runKernelFunc(function(Re){return Re.avgPool(re,xe)},{x:re},function(Re){return{x:function(){return function(Le,Be,Xe,nt,tt,ut){var Dt=Ze(Le,"dy","avgPoolBackprop"),Rt=Ze(Be,"input","avgPoolBackprop");we(Rt.rank===Dt.rank,function(){return"Rank of input ("+Rt.rank+") does not match rank of dy ("+Dt.rank+")"}),tt==null&&(tt=[1,1]),we(_s(nt,tt),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+nt+" and dilations '"+tt+"'"});var Lt=Rt,qt=Dt,pn=!1;Rt.rank===3&&(pn=!0,Lt=Rt.as4D(1,Rt.shape[0],Rt.shape[1],Rt.shape[2]),qt=Dt.as4D(1,Dt.shape[0],Dt.shape[1],Dt.shape[2])),we(qt.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+qt.rank+"."}),we(Lt.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+Lt.rank+"."});var bn=Hu(Lt.shape,Xe,nt,tt,ut),mn=Ve.runKernelFunc(function(Sn){return Sn.avgPoolBackprop(qt,Lt,bn)},{dy4D:qt,input4D:Lt});return pn?mn.as3D(mn.shape[1],mn.shape[2],mn.shape[3]):mn}(Re,re,v,d,y,E)}}},"AvgPool",xe);return Oe=Oe.cast(Q.dtype),fe?Oe.as3D(Oe.shape[1],Oe.shape[2],Oe.shape[3]):Oe}var Av=Pt({maxPool_:function(_,v,d,y,E){return Cv(_,v,d,1,y,E)}}),Ov=Pt({avgPool_:function(_,v,d,y,E){return h0(_,v,d,1,y,E)}}),Ud=Pt({pool_:function(_,v,d,y,E,B){E==null&&(E=[1,1]),B==null&&(B=1),y===0&&(y="valid");var Q=Ze(_,"x","maxPool"),re=Q,fe=!1;Q.rank===3&&(fe=!0,re=Q.as4D(1,Q.shape[0],Q.shape[1],Q.shape[2])),we(_s(B,E),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+B+" and dilations '"+E+"'"});var xe,Oe=Hu(re.shape,v,B,E,y),Re=[Oe.dilationHeight,Oe.dilationWidth];xe=y==="same"?function(Lt,qt){var pn=Lt.map(function(Sn,On){return Sn+(Sn-1)*(qt[On]-1)}).map(function(Sn){return Sn-1}),bn=pn.map(function(Sn){return Math.floor(Sn/2)}),mn=pn.map(function(Sn,On){return Sn-bn[On]});return pn.map(function(Sn,On){return[bn[On],mn[On]]})}([Oe.filterHeight,Oe.filterWidth],Re):[[0,0],[0,0]];var Le=Re[0]===1&&Re[1]===1,Be=function(Lt,qt,pn){var bn=pn.map(function(h){return h[0]}),mn=pn.map(function(h){return h[1]}),Sn=Lt.concat(bn,mn),On=qt.map(function(h,c){return(h-Sn[c]%h)%h}),b=mn.map(function(h,c){return h+On[c]});return[qt.map(function(h,c){return[bn[c],b[c]]}),qt.map(function(h,c){return[0,On[c]]})]}([Oe.inHeight,Oe.inWidth],Re,xe),Xe=Be[0],nt=Be[1],tt=Le?y:"valid",ut=Le?re:La(re,Re,Xe),Dt=(d==="avg"?function(){return h0(ut,v,B,1,tt)}:function(){return Cv(ut,v,B,1,tt)})(),Rt=Le?Dt:Ol(Dt,Re,nt);return fe?Rt.as3D(Rt.shape[1],Rt.shape[2],Rt.shape[3]):Rt}}),My=Pt({maxPool3d_:function(_,v,d,y,E,B,Q){B===void 0&&(B="NDHWC");var re=Ze(_,"x","maxPool3d"),fe=re,xe=!1;re.rank===4&&(xe=!0,fe=re.as5D(1,re.shape[0],re.shape[1],re.shape[2],re.shape[3])),Q==null&&(Q=[1,1,1]),we(fe.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+fe.rank+"."}),we(B==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+B}),we(_s(d,Q),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+d+" and dilations '"+Q+"'"}),E!=null&&we(Ft(y),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+E+" but got pad "+y+"."});var Oe=Nc(fe.shape,v,d,Q,y,E,B),Re=Ve.runKernelFunc(function(Le,Be){var Xe=Le.maxPool3d(fe,Oe);return Be([fe,Xe]),Xe},{x:fe},function(Le,Be){var Xe=Be[0],nt=Be[1];return{x:function(){return function(tt,ut,Dt,Rt,Lt,qt,pn,bn){var mn=Ze(tt,"dy","maxPool3dBackprop"),Sn=Ze(ut,"input","maxPool3dBackprop"),On=Ze(Dt,"output","maxPool3dBackprop"),b=mn,h=Sn,c=On,m=!1;Sn.rank===4&&(m=!0,b=mn.as5D(1,mn.shape[0],mn.shape[1],mn.shape[2],mn.shape[3]),h=Sn.as5D(1,Sn.shape[0],Sn.shape[1],Sn.shape[2],Sn.shape[3]),c=On.as5D(1,On.shape[0],On.shape[1],On.shape[2],On.shape[3])),we(b.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+b.rank+"."}),we(h.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+h.rank+"."}),we(c.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+c.rank+"."}),qt==null&&(qt=[1,1,1]),we(_s(Lt,qt),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+Lt+" and dilations '"+qt+"'"}),bn!=null&&we(Ft(pn),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+bn+" but got pad "+pn+"."});var w=Nc(h.shape,Rt,Lt,qt,pn,bn),R=Ve.runKernelFunc(function(K){return K.maxPool3dBackprop(b,h,c,w)},{dy5D:b,input5D:h});return m?R.as4D(R.shape[1],R.shape[2],R.shape[3],R.shape[4]):R}(Le,Xe,nt,v,d,Q,y,E)}}});return xe?Re.as4D(Re.shape[1],Re.shape[2],Re.shape[3],Re.shape[4]):Re}}),Tv=Pt({avgPool3d_:function(_,v,d,y,E,B,Q){B===void 0&&(B="NDHWC");var re=Ze(_,"x","avgPool3d","float32"),fe=re,xe=!1;re.rank===4&&(xe=!0,fe=re.as5D(1,re.shape[0],re.shape[1],re.shape[2],re.shape[3])),Q==null&&(Q=[1,1,1]),we(fe.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+fe.rank+"."}),we(B==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+B}),we(_s(d,Q),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+d+" and dilations '"+Q+"'"}),E!=null&&we(Ft(y),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+E+" but got pad "+y+"."});var Oe=Nc(fe.shape,v,d,Q,y,E,B),Re=Ve.runKernelFunc(function(Le){return Le.avgPool3d(fe,Oe)},{x:fe},function(Le){return{x:function(){return function(Be,Xe,nt,tt,ut,Dt,Rt){var Lt=Ze(Be,"dy","avgPool3dBackprop"),qt=Ze(Xe,"input","avgPool3dBackprop"),pn=Lt,bn=qt,mn=!1;qt.rank===4&&(mn=!0,pn=Lt.as5D(1,Lt.shape[0],Lt.shape[1],Lt.shape[2],Lt.shape[3]),bn=qt.as5D(1,qt.shape[0],qt.shape[1],qt.shape[2],qt.shape[3])),we(pn.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+pn.rank+"."}),we(bn.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+bn.rank+"."}),ut==null&&(ut=[1,1,1]),we(_s(tt,ut),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+tt+" and dilations '"+ut+"'"}),Rt!=null&&we(Ft(Dt),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+Rt+" but got pad "+Dt+"."});var Sn=Nc(bn.shape,nt,tt,ut,Dt,Rt),On=Ve.runKernelFunc(function(b){return b.avgPool3dBackprop(pn,bn,Sn)},{dy5D:pn,input5D:bn});return mn?On.as4D(On.shape[1],On.shape[2],On.shape[3],On.shape[4]):On}(Le,fe,v,d,Q,y,E)}}});return Re=Re.cast(fe.dtype),xe?Re.as4D(Re.shape[1],Re.shape[2],Re.shape[3],Re.shape[4]):Re}}),Vl=Pt({slice_:function(_,v,d){var y,E,B=Ze(_,"x","slice");if(B.rank===0)throw new Error("Slicing scalar is not possible");(y=typeof v=="number"?[v].concat(new Array(B.rank-1).fill(0)):v.length<B.rank?v.concat(new Array(B.rank-v.length).fill(0)):v.slice()).forEach(function(fe){we(fe!==-1,function(){return"slice() does not support negative begin indexing."})}),E=(E=d==null?new Array(B.rank).fill(-1):typeof d=="number"?[d].concat(new Array(B.rank-1).fill(-1)):d.length<B.rank?d.concat(new Array(B.rank-d.length).fill(-1)):d).map(function(fe,xe){return fe>=0?fe:(we(fe===-1,function(){return"Negative size values should be exactly -1 but got "+fe+" for the slice() size at index "+xe+"."}),B.shape[xe]-y[xe])}),Lh(B,y,E);var Q=B.shape,re={begin:y,size:E};return Ve.runKernelFunc(function(fe){return fe.slice(B,y,E)},{x:B},function(fe){for(var xe=[],Oe=0;Oe<fe.rank;Oe++)xe.push([y[Oe],Q[Oe]-y[Oe]-E[Oe]]);return{x:function(){return fe.pad(xe)}}},"Slice",re)}}),p0=Pt({slice1d_:function(_,v,d){var y=Ze(_,"x","slice1d");return we(y.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+y.rank+" tensor"}),Vl(y,[v],[d])}}),Mv=Pt({slice2d_:function(_,v,d){var y=Ze(_,"x","slice2d");return we(y.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+y.rank+" tensor"}),Vl(y,v,d)}}),Wd=Pt({slice3d_:function(_,v,d){var y=Ze(_,"x","slice3d");return we(y.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+y.rank+" tensor"}),Vl(y,v,d)}}),Hl=Pt({slice4d_:function(_,v,d){var y=Ze(_,"x","slice4d");return we(y.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+y.rank+" tensor"}),Vl(y,v,d)}});function pg(_,v,d,y,E){return v.rank<d.rank&&(v=v.reshape(Fo(v.shape,y))),_.rank<d.rank&&(_=_.reshape(Fo(_.shape,y))),{x:function(){var B=_.mul(d.equal(v).cast(_.dtype));return E==null?B:B.transpose(E)}}}var m0=Pt({all_:function(_,v,d){v===void 0&&(v=null),d===void 0&&(d=!1);var y=Ze(_,"x","all","bool"),E=Yt(v,y.shape),B=E,Q=Ra(B,y.rank);Q!=null&&(y=y.transpose(Q),B=Pa(B.length,y.rank));var re=Ve.runKernelFunc(function(xe){return xe.all(y,B)},{$x:y});if(d){var fe=Fo(re.shape,E);return re.reshape(fe)}return re}}),jc=Pt({any_:function(_,v,d){v===void 0&&(v=null),d===void 0&&(d=!1);var y=Ze(_,"x","any","bool"),E=Yt(v,y.shape),B=E,Q=Ra(B,y.rank);Q!=null&&(y=y.transpose(Q),B=Pa(B.length,y.rank));var re=Ve.runKernelFunc(function(xe){return xe.any(y,B)},{$x:y});if(d){var fe=Fo(re.shape,E);return re.reshape(fe)}return re}}),g0=Pt({argMax_:function(_,v){v===void 0&&(v=0);var d=Ze(_,"x","argMax");v==null&&(v=0);var y=Yt(v,d.shape),E=Ra(y,d.rank);E!=null&&(d=d.transpose(E),y=Pa(y.length,d.rank));var B={axis:y[0]},Q=[d];return Ve.runKernelFunc(function(re,fe){var xe=re.argMax(d,y[0]);return fe([d]),xe},{x:d},function(re,fe){var xe=fe[0];return{x:function(){return mi(xe)}}},"ArgMax",B,Q)}}),Dv=Pt({argMin_:function(_,v){v===void 0&&(v=0);var d=Ze(_,"x","argMin");v==null&&(v=0);var y=Yt(v,d.shape),E=Ra(y,d.rank);return E!=null&&(d=d.transpose(E),y=Pa(y.length,d.rank)),Ve.runKernelFunc(function(B,Q){var re=B.argMin(d,y[0]);return Q([d]),re},{$x:d},function(B,Q){var re=Q[0];return{$x:function(){return mi(re)}}})}}),Rf=Pt({logSumExp_:function(_,v,d){v===void 0&&(v=null),d===void 0&&(d=!1);var y=Ze(_,"x","logSumExp"),E=Yt(v,y.shape),B=y.max(E,!0),Q=y.sub(B).exp().sum(E).log(),re=B.reshape(Q.shape).add(Q);if(d){var fe=Fo(re.shape,E);return re.reshape(fe)}return re}}),Dy=Pt({max_:function(_,v,d){v===void 0&&(v=null),d===void 0&&(d=!1);var y=Ze(_,"x","max"),E=y,B=Yt(v,y.shape),Q=B,re=Ra(Q,y.rank);re!=null&&(y=y.transpose(re),Q=Pa(Q.length,y.rank));var fe=[y],xe=Ve.runKernelFunc(function(Re,Le){var Be=Re.max(y,Q);return Le([E,Be]),Be},{x:y},function(Re,Le){return pg(Re,Le[1],Le[0],B,re)},"Max",{axes:Q},fe,[!0]);if(d){var Oe=Fo(xe.shape,B);xe=xe.reshape(Oe)}return xe}}),Jh=Pt({mean_:function(_,v,d){v===void 0&&(v=null),d===void 0&&(d=!1);var y=Ze(_,"x","mean"),E=Yt(v,y.shape),B=ze(Io(y.shape,E)[1]);return ou(function(Q){var re=kr(B);return{value:(re.dtype===Q.dtype?Q:Q.cast(re.dtype)).div(re).sum(v,d),gradFunc:function(fe){var xe=Q.shape.slice();return E.forEach(function(Oe){xe[Oe]=1}),fe.reshape(xe).mul(Du(Q.shape,"float32")).div(B)}}})(y)}}),Qh=Pt({min_:function(_,v,d){v===void 0&&(v=null),d===void 0&&(d=!1);var y=Ze(_,"x","min"),E=y,B=Yt(v,y.shape),Q=B,re=Ra(Q,y.rank);re!=null&&(y=y.transpose(re),Q=Pa(Q.length,y.rank));var fe=[y],xe=Ve.runKernelFunc(function(Re,Le){var Be=Re.min(y,Q);return Le([E,Be]),Be},{x:y},function(Re,Le){return pg(Re,Le[1],Le[0],B,re)},"Min",{axes:Q},fe,[!0]);if(d){var Oe=Fo(xe.shape,B);xe=xe.reshape(Oe)}return xe}}),Pf=Pt({moments_:function(_,v,d){v===void 0&&(v=null),d===void 0&&(d=!1);var y=Yt(v,(_=Ze(_,"x","moments")).shape),E=_.mean(y,d),B=E.shape;return d||(B=Fo(E.shape,y)),{mean:E,variance:_.toFloat().sub(E.reshape(B)).square().mean(y,d)}}}),Nv=Pt({sum_:function(_,v,d){v===void 0&&(v=null),d===void 0&&(d=!1);var y=Ze(_,"x","sum");y.dtype==="bool"&&(y=y.toInt());var E=Yt(v,y.shape);return ou(function(B){var Q=Ra(E,B.rank),re=E,fe=B;Q!=null&&(fe=B.transpose(Q),re=Pa(re.length,B.rank));var xe=function(Be){var Xe=B.shape.slice();return E.forEach(function(nt){Xe[nt]=1}),Be.reshape(Xe).mul(Du(B.shape,"float32"))},Oe={axes:re},Re=Ve.runKernelFunc(function(Be){return Be.sum(fe,re)},{x:fe},function(Be){return{x:function(){return xe(Be)}}},"Sum",Oe);if(d){var Le=Fo(Re.shape,E);Re=Re.reshape(Le)}return{value:Re,gradFunc:xe}})(y)}}),Vd=Pt({prod_:function(_,v,d){v===void 0&&(v=null),d===void 0&&(d=!1);var y=Ze(_,"x","prod");y.dtype==="bool"&&(y=y.toInt());var E=Yt(v,y.shape),B=Ra(E,y.rank),Q=E,re=y;B!=null&&(re=y.transpose(B),Q=Pa(Q.length,y.rank));var fe=Ve.runKernelFunc(function(Oe){return Oe.prod(re,Q)},{permutedX:re});if(d){var xe=Fo(fe.shape,E);fe=fe.reshape(xe)}return fe}}),zc=Pt({elu_:function(_){var v=Ze(_,"x","elu");return Ve.runKernelFunc(function(d,y){var E=d.elu(v);return y([E]),E},{$x:v},function(d,y){var E=y[0];return{$x:function(){return Ve.runKernelFunc(function(B){return B.eluDer(d,E)},{dy:d,y:E})}}})}}),Zh=Pt({leakyRelu_:function(_,v){v===void 0&&(v=.2);var d=Ze(_,"x","leakyRelu");return Rd(kr(v).mul(d),d)}}),gm=Pt({prelu_:function(_,v){var d=Ze(_,"x","prelu"),y=Ze(v,"alpha","prelu");return Ve.runKernelFunc(function(E,B){var Q=E.prelu(d,y);return B([d,y]),Q},{x:d,alpha:y},function(E,B){var Q=B[0],re=B[1],fe=Q.greater(0);return{x:function(){return po(fe,E,E.mul(re))},alpha:function(){var xe=po(fe,mi(E),E.mul(Q)),Oe=Ta(re.shape,E.shape);return Oe.length>0&&(xe=xe.sum(Oe)),xe.reshape(re.shape)}}},"Prelu")}}),mg=Pt({relu_:function(_){var v=Ze(_,"x","relu");return v.dtype==="bool"?v.toInt():Ve.runKernelFunc(function(d,y){var E=d.relu(v);return y([v]),E},{x:v},function(d,y){var E=y[0];return{x:function(){return d.mulStrict(E.step().toFloat())}}},"Relu")}}),v0=Pt({relu6_:function(_){var v=Ze(_,"x","relu6");return v.dtype==="bool"?v.toInt():Ve.runKernelFunc(function(d,y){var E=d.relu6(v);return y([v]),E},{x:v},function(d,y){var E=y[0],B=E.lessEqual(6).mul(E.step());return{x:function(){return d.mulStrict(B.toFloat())}}},"Relu6")}}),Iv=Pt({selu_:function(_){var v=Ze(_,"x","selu");return Ve.runKernelFunc(function(d,y){var E=d.selu(v);return y([v]),E},{$x:v},function(d,y){var E=y[0];return{$x:function(){var B=E.greater(kr(0)),Q=kr(Pc),re=kr(Rl),fe=d.mul(re),xe=d.mul(Q).mul(E.toFloat().exp());return po(B,fe,xe)}}})}}),hs=Pt({transpose_:function(_,v){var d=Ze(_,"x","transpose");if(v==null&&(v=d.shape.map(function(E,B){return B}).reverse()),we(d.rank===v.length,function(){return"Error in transpose: rank of input "+d.rank+" must match length of perm "+v+"."}),v.forEach(function(E){we(E>=0&&E<d.rank,function(){return"All entries in 'perm' must be between 0 and "+(d.rank-1)+" but got "+v})}),d.rank<=1)return d.clone();var y={perm:v};return Ve.runKernelFunc(function(E){return E.transpose(d,v)},{x:d},function(E){var B=Vu(v);return{x:function(){return E.transpose(B)}}},"Transpose",y)}}),Fv=Pt({localResponseNormalization_:function(_,v,d,y,E){v===void 0&&(v=5),d===void 0&&(d=1),y===void 0&&(y=1),E===void 0&&(E=.5);var B=Ze(_,"x","localResponseNormalization");we(B.rank===4||B.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+B.rank+"."}),we(Ft(v),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+v+"."});var Q=B,re=!1;B.rank===3&&(re=!0,Q=B.as4D(1,B.shape[0],B.shape[1],B.shape[2]));var fe=Ve.runKernelFunc(function(xe,Oe){var Re=xe.localResponseNormalization4D(Q,v,d,y,E);return Oe([Q,Re]),Re},{x4D:Q},function(xe,Oe){var Re=Oe[0],Le=Oe[1];return{x4D:function(){return Ve.runKernelFunc(function(Be){return Be.LRNGrad(xe,Re,Le,v,d,y,E)},{})}}});return re?fe.as3D(fe.shape[1],fe.shape[2],fe.shape[3]):fe}}),ep=Pt({norm_:function(_,v,d,y){v===void 0&&(v="euclidean"),d===void 0&&(d=null),y===void 0&&(y=!1);var E=function re(fe,xe,Oe){if(Oe===void 0&&(Oe=null),fe.rank===0)return fe.abs();if(fe.rank!==1&&Oe===null)return re(fe.reshape([-1]),xe,Oe);if(fe.rank===1||typeof Oe=="number"||Array.isArray(Oe)&&Oe.length===1){if(xe===1)return fe.abs().sum(Oe);if(xe===1/0)return fe.abs().max(Oe);if(xe===-1/0)return fe.abs().min(Oe);if(xe==="euclidean"||xe===2)return fe.abs().pow(kr(2,"int32")).sum(Oe).sqrt();throw new Error("Error in norm: invalid ord value: "+xe)}if(Array.isArray(Oe)&&Oe.length===2){if(xe===1)return fe.abs().sum(Oe[0]).max(Oe[1]-1);if(xe===1/0)return fe.abs().sum(Oe[1]).max(Oe[0]);if(xe===-1/0)return fe.abs().sum(Oe[1]).min(Oe[0]);if(xe==="fro"||xe==="euclidean")return fe.square().sum(Oe).sqrt();throw new Error("Error in norm: invalid ord value: "+xe)}throw new Error("Error in norm: invalid axis: "+Oe)}(_=Ze(_,"x","norm"),v,d),B=E.shape;if(y){var Q=Yt(d,_.shape);B=Fo(E.shape,Q)}return E.reshape(B)}}),Rv=Pt({basicLSTMCell_:function(_,v,d,y,E,B){var Q=Ze(_,"forgetBias","basicLSTMCell"),re=Ze(v,"lstmKernel","basicLSTMCell"),fe=Ze(d,"lstmBias","basicLSTMCell"),xe=Ze(y,"data","basicLSTMCell"),Oe=Ze(E,"c","basicLSTMCell"),Re=Ze(B,"h","basicLSTMCell"),Le=xe.concat(Re,1).matMul(re).add(fe),Be=Le.shape[0],Xe=Le.shape[1]/4,nt=[Be,Xe],tt=Le.slice([0,0],nt),ut=Le.slice([0,Xe],nt),Dt=Le.slice([0,2*Xe],nt),Rt=Le.slice([0,3*Xe],nt),Lt=tt.sigmoid().mulStrict(ut.tanh()).addStrict(Oe.mulStrict(Q.add(Dt).sigmoid()));return[Lt,Lt.tanh().mulStrict(Rt.sigmoid())]}}),gg=Pt({multiRNNCell_:function(_,v,d,y){for(var E=Ze(v,"data","multiRNNCell"),B=cc(d,"c","multiRNNCell"),Q=cc(y,"h","multiRNNCell"),re=E,fe=[],xe=0;xe<_.length;xe++){var Oe=_[xe](re,B[xe],Q[xe]);fe.push(Oe[0]),fe.push(Oe[1]),re=Oe[1]}var Re=[],Le=[];for(xe=0;xe<fe.length;xe+=2)Re.push(fe[xe]),Le.push(fe[xe+1]);return[Re,Le]}}),Lf=Pt({movingAverage_:function(_,v,d,y,E){E===void 0&&(E=!0);var B=Ze(_,"v","movingAverage"),Q=Ze(v,"x","movingAverage"),re=Ze(d,"decay","movingAverage");hn(B,Q),we(Ut(B.shape,Q.shape),function(){return"Shape mismatch in v and x"});var fe=kr(1),xe=fe.sub(re),Oe=Q.sub(B).mul(xe);if(E){we(y!=null,function(){return"When using zeroDebias: true, step is required."});var Re=Ze(y,"step","movingAverage");Oe=Oe.div(fe.sub(Ld(re,Re)))}return B.add(Oe)}}),vm=Pt({stridedSlice_:function(_,v,d,y,E,B,Q,re,fe){if(E===void 0&&(E=0),B===void 0&&(B=0),Q===void 0&&(Q=0),re===void 0&&(re=0),fe===void 0&&(fe=0),y==null&&(y=new Array(v.length)),Q!==0)throw new Error("ellipsis mask is not yet supported");var xe=Ze(_,"x","stridedSlice"),Oe=Oa(re),Re=xe.shape.slice();Oe.forEach(function(tt){v[tt]=0,d[tt]=1,Re.splice(tt,0,1)}),xe=xe.reshape(Re);for(var Le=0;Le<xe.rank;Le++)v[Le]=Ps(E,v,y,xe.shape,Le),d[Le]=xf(B,d,y,xe.shape,Le),y[Le]=y[Le]||1;var Be=Oa(fe);Be.forEach(function(tt){d[tt]=v[tt]+1,y[tt]=1});var Xe=bf(v,d,y),nt=Xe.filter(function(tt,ut){return Be.indexOf(ut)===-1});return y.every(function(tt){return tt===1})?Vl(xe,v,Xe).reshape(nt):Ve.runKernelFunc(function(tt){return tt.stridedSlice(xe,v,d,y)},{$x:xe}).reshape(nt)}}),Gl=Pt({topk_:function(_,v,d){v===void 0&&(v=1),d===void 0&&(d=!0);var y=Ze(_,"x","topk");if(y.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var E=y.shape[y.shape.length-1];if(v>E)throw new Error("'k' passed to topk() must be <= the last dimension ("+E+") but got "+v);var B=Ve.runKernelFunc(function(Q){return Q.topk(y,v,d)},{$x:y});return{values:B[0],indices:B[1]}}}),Pv=Pt({scatterND_:function(_,v,d){var y=Ze(_,"indices","scatterND","int32"),E=Ze(v,"updates","scatterND");return wd(E,y,d),Ve.runKernelFunc(function(B){return B.scatterND(y,E,d)},{indices:y,updates:E},null,"ScatterNd",{shape:d})}}),vg=Pt({fft_:function(_){we(_.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+_.dtype+"."});var v=_.shape[_.shape.length-1],d=_.size/v,y=_.as2D(d,v);return Ve.runKernelFunc(function(E){return E.fft(y)},{input:_}).reshape(_.shape)}}),yg=Pt({ifft_:function(_){we(_.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+_.dtype+"."});var v=_.shape[_.shape.length-1],d=_.size/v,y=_.as2D(d,v);return Ve.runKernelFunc(function(E){return E.ifft(y)},{input:_}).reshape(_.shape)}}),y0=Pt({rfft_:function(_,v){we(_.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+_.dtype});var d,y=_.shape[_.shape.length-1],E=_.size/y;if(v!=null&&v<y){var B=_.shape.map(function(ut){return 0}),Q=_.shape.map(function(ut){return ut});Q[_.shape.length-1]=v,d=_.slice(B,Q),y=v}else if(v!=null&&v>y){var re=_.shape.map(function(ut){return ut});re[_.shape.length-1]=v-y,d=_.concat(ao(re),_.shape.length-1),y=v}else d=_;var fe=d.zerosLike(),xe=_o(d,fe).as2D(E,y),Oe=vg(xe),Re=Math.floor(y/2)+1,Le=va(Oe),Be=Ya(Oe),Xe=Le.split([Re,y-Re],Le.shape.length-1),nt=Be.split([Re,y-Re],Be.shape.length-1),tt=d.shape.slice();return tt[d.shape.length-1]=Re,_o(Xe[0],nt[0]).reshape(tt)}}),ll=Pt({irfft_:function(_){var v=_.shape[_.shape.length-1],d=_.size/v;if(v<=2){var y=_.as2D(d,v),E=yg(y);return va(E)}var B=[d,2*(v-1)],Q=va(_).as2D(d,v),re=Ya(_).as2D(d,v),fe=Q.slice([0,1],[d,v-2]).reverse(1),xe=re.slice([0,1],[d,v-2]).reverse(1).mul(kr(-1)),Oe=Q.concat(fe,1),Re=re.concat(xe,1);return y=_o(Oe,Re).as2D(B[0],B[1]),E=yg(y),va(E)}}),bg=Object.freeze({fft:vg,ifft:yg,rfft:y0,irfft:ll}),Lv=Pt({sparseToDense_:function(_,v,d,y){y===void 0&&(y=0);var E=Ze(_,"sparseIndices","sparseToDense","int32"),B=Ze(v,"sparseValues","sparseToDense"),Q=Ze(y,"defaultValue","sparseToDense",B.dtype);return function(re,fe,xe,Oe){if(re.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+re.dtype+".");if(re.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+re.shape+".");var Re=re.rank>0?re.shape[0]:1,Le=re.rank>1?re.shape[1]:1;if(xe.length!==Le)throw new Error("outputShape has incorrect number of elements:, "+xe.length+", should be: "+Le+".");var Be=fe.size;if(fe.rank!==0&&(fe.rank!==1||Be!==Re))throw new Error("sparseValues has incorrect shape "+fe.shape+", should be [] or ["+Re+"]");if(fe.dtype!==Oe.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(E,B,d,Q),Ve.runKernelFunc(function(re){return re.sparseToDense(E,B,d,Q)},{$sparseIndices:E,$sparseValues:B,$defaultValue:Q})}}),ql=Pt({gatherND_:function(_,v){var d=Ze(v,"indices","gatherND","int32"),y=Ze(_,"x","gatherND");return Ve.runKernelFunc(function(E){return E.gatherND(y,d)},{x:y,indices:d},null,"GatherNd")}}),ym=Pt({diag_:function(_){var v=Ze(_,"x","diag").flatten(),d=_.shape.concat(_.shape);return Ve.runKernelFunc(function(y){return y.diag(v)},{$x:v}).reshape(d)}}),Hd=Pt({dropout_:function(_,v,d,y){var E=Ze(_,"x","dropout");if(we(E.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+E.dtype+" tensor instead."}),we(v>=0&&v<1,function(){return"rate must be a float in the range [0, 1), but got "+v+"."}),v===0)return _ instanceof $t?E.clone():E;var B=function(fe,xe){if(xe==null)return fe.shape.slice();if(Ut(fe.shape,xe))return xe;if(fe.shape.length===xe.length){for(var Oe=[],Re=0;Re<fe.shape.length;Re++)xe[Re]==null&&fe.shape[Re]!=null?Oe.push(fe.shape[Re]):Oe.push(xe[Re]);return Oe}return xe}(E,d),Q=1-v,re=vf(B,0,1,"float32",y).add(Q).floor().div(Q);return E.mul(re)}});function bm(_,v,d){for(var y=1-_%2,E=new Float32Array(_),B=0;B<_;++B){var Q=2*Math.PI*B/(_+y-1);E[B]=v-d*Math.cos(Q)}return ru(E,"float32")}var ps,xg=Pt({hannWindow_:function(_){return bm(_,.5,.5)}}),b0=Pt({hammingWindow_:function(_){return bm(_,.54,.46)}}),xm=Pt({frame_:function(_,v,d,y,E){y===void 0&&(y=!1),E===void 0&&(E=0);for(var B=0,Q=[];B+v<=_.size;)Q.push(Vl(_,B,v)),B+=d;if(y)for(;B<_.size;){var re=B+v-_.size,fe=Ho([Vl(_,B,v-re),Is([re],E)]);Q.push(fe),B+=d}return Q.length===0?xu([],[0,v]):Ho(Q).as2D(Q.length,v)}}),wm=Pt({stft_:function(_,v,d,y,E){var B;E===void 0&&(E=xg),y==null&&(B=v,y=Math.floor(Math.pow(2,Math.ceil(Math.log(B)/Math.log(2)))));for(var Q=xm(_,v,d),re=Ul(Q,E(v)),fe=[],xe=0;xe<Q.shape[0];xe++)fe.push(y0(re.slice([xe,0],[1,v]),y));return Ho(fe)}}),x0=Object.freeze({hannWindow:xg,hammingWindow:b0,frame:xm,stft:wm}),Bv=function(_,v,d){return d===void 0&&(d=1),N(this,void 0,void 0,function(){var y,E,B,Q,re,fe,xe,Oe,Re,Le,Be,Xe,nt,tt;return L(this,function(ut){switch(ut.label){case 0:return y=Ze(_,"predictions","inTopK"),E=Ze(v,"targets","inTopK"),we(y.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+y.rank}),we(y.rank-1===E.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+y.rank+" and targets rank "+E.rank}),bt(y.shape.slice(0,y.shape.length-1),E.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),B=y.shape[y.shape.length-1],we(d>0&&d<=B,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+B+"), but got "+d}),[4,y.data()];case 1:return Q=ut.sent(),[4,E.data()];case 2:for(re=ut.sent(),fe=[Q.length/B,B],Oe=fe[1],Re=Rn("bool",xe=fe[0]),Le=0;Le<xe;Le++){for(Be=Le*Oe,Xe=Q.subarray(Be,Be+Oe),nt=[],tt=0;tt<Xe.length;tt++)nt.push({value:Xe[tt],index:tt});for(nt.sort(function(Dt,Rt){return Rt.value-Dt.value}),Re[Le]=0,tt=0;tt<d;tt++)if(nt[tt].index===re[Le]){Re[Le]=1;break}}return _!==y&&y.dispose(),v!==E&&E.dispose(),[2,To(Re,E.shape,"bool")]}})})};(function(_){_[_.NONE=0]="NONE",_[_.MEAN=1]="MEAN",_[_.SUM=2]="SUM",_[_.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(ps||(ps={}));var Ny=Pt({absoluteDifference_:function(_,v,d,y){y===void 0&&(y=ps.SUM_BY_NONZERO_WEIGHTS);var E=Ze(_,"labels","absoluteDifference"),B=Ze(v,"predictions","absoluteDifference"),Q=null;d!=null&&(Q=Ze(d,"weights","absoluteDifference")),bt(E.shape,B.shape,"Error in absoluteDifference: ");var re=E.sub(B).abs();return fl(re,Q,y)}}),fl=Pt({computeWeightedLoss_:function(_,v,d){d===void 0&&(d=ps.SUM_BY_NONZERO_WEIGHTS);var y=Ze(_,"losses","computeWeightedLoss"),E=null;v!=null&&(E=Ze(v,"weights","computeWeightedLoss"));var B=E==null?y:y.mul(E);if(d===ps.NONE)return B;if(d===ps.SUM)return B.sum();if(d===ps.MEAN){if(E==null)return B.mean();var Q=y.size/E.size,re=B.sum().div(E.sum());return Q>1?re.div(kr(Q)):re}if(d===ps.SUM_BY_NONZERO_WEIGHTS){if(E==null)return B.sum().div(kr(y.size));var fe=E.mul(Du(y.shape)).notEqual(kr(0)).sum().toFloat();return B.sum().div(fe)}throw Error("Unknown reduction: "+d)}}),Gd=Pt({cosineDistance_:function(_,v,d,y,E){E===void 0&&(E=ps.SUM_BY_NONZERO_WEIGHTS);var B=Ze(_,"labels","cosineDistance"),Q=Ze(v,"predictions","cosineDistance"),re=null;y!=null&&(re=Ze(y,"weights","cosineDistance")),bt(B.shape,Q.shape,"Error in cosineDistance: ");var fe=kr(1).sub(B.mul(Q).sum(d,!0));return fl(fe,re,E)}}),Iy=Pt({hingeLoss_:function(_,v,d,y){y===void 0&&(y=ps.SUM_BY_NONZERO_WEIGHTS);var E=Ze(_,"labels","hingeLoss"),B=Ze(v,"predictions","hingeLoss"),Q=null;d!=null&&(Q=Ze(d,"weights","hingeLoss")),bt(E.shape,B.shape,"Error in hingeLoss: ");var re=kr(1);E=kr(2).mul(E).sub(re);var fe=re.sub(E.mul(B)).relu();return fl(fe,Q,y)}}),jv=Pt({huberLoss_:function(_,v,d,y,E){y===void 0&&(y=1),E===void 0&&(E=ps.SUM_BY_NONZERO_WEIGHTS);var B=Ze(_,"labels","huberLoss"),Q=Ze(v,"predictions","huberLoss"),re=null;d!=null&&(re=Ze(d,"weights","huberLoss")),bt(B.shape,Q.shape,"Error in huberLoss: ");var fe=kr(y),xe=Q.sub(B).abs(),Oe=Nf(xe,fe),Re=xe.sub(Oe),Le=kr(.5).mul(Oe.square()).add(fe.mul(Re));return fl(Le,re,E)}}),dl=Pt({logLoss_:function(_,v,d,y,E){y===void 0&&(y=1e-7),E===void 0&&(E=ps.SUM_BY_NONZERO_WEIGHTS);var B=Ze(_,"labels","logLoss"),Q=Ze(v,"predictions","logLoss"),re=null;d!=null&&(re=Ze(d,"weights","logLoss")),bt(B.shape,Q.shape,"Error in logLoss: ");var fe=kr(1),xe=kr(y),Oe=B.mul(Q.add(xe).log()).neg().sub(fe.sub(B).mul(fe.sub(Q).add(xe).log()));return fl(Oe,re,E)}}),rs=Pt({meanSquaredError_:function(_,v,d,y){y===void 0&&(y=ps.SUM_BY_NONZERO_WEIGHTS);var E=Ze(_,"labels","meanSquaredError"),B=Ze(v,"predictions","meanSquaredError"),Q=null;d!=null&&(Q=Ze(d,"weights","meanSquaredError")),bt(E.shape,B.shape,"Error in meanSquaredError: ");var re=E.squaredDifference(B);return fl(re,Q,y)}}),tp=Pt({sigmoidCrossEntropy_:function(_,v,d,y,E){y===void 0&&(y=0),E===void 0&&(E=ps.SUM_BY_NONZERO_WEIGHTS);var B=Ze(_,"multiClassLabels","sigmoidCrossEntropy"),Q=Ze(v,"logits","sigmoidCrossEntropy"),re=null;if(d!=null&&(re=Ze(d,"weights","sigmoidCrossEntropy")),bt(B.shape,Q.shape,"Error in sigmoidCrossEntropy: "),y>0){var fe=kr(y),xe=kr(1),Oe=kr(.5);B=B.mul(xe.sub(fe)).add(Oe.mul(fe))}var Re=function(Le,Be){var Xe=Ze(Le,"labels","sigmoidCrossEntropyWithLogits"),nt=Ze(Be,"logits","sigmoidCrossEntropyWithLogits");bt(Xe.shape,nt.shape,"Error in sigmoidCrossEntropyWithLogits: ");var tt=nt.relu(),ut=nt.mul(Xe),Dt=nt.abs().neg().exp().log1p();return tt.sub(ut).add(Dt)}(B,Q);return fl(Re,re,E)}}),_m=Pt({softmaxCrossEntropy_:function(_,v,d,y,E){y===void 0&&(y=0),E===void 0&&(E=ps.SUM_BY_NONZERO_WEIGHTS);var B=Ze(_,"onehotLabels","softmaxCrossEntropy"),Q=Ze(v,"logits","softmaxCrossEntropy"),re=null;if(d!=null&&(re=Ze(d,"weights","softmaxCrossEntropy")),bt(B.shape,Q.shape,"Error in softmaxCrossEntropy: "),y>0){var fe=kr(y),xe=kr(1),Oe=kr(B.shape[1]);B=B.mul(xe.sub(fe)).add(fe.div(Oe))}var Re=function(Le,Be,Xe){if(Xe===void 0&&(Xe=-1),Xe===-1&&(Xe=Be.rank-1),Xe!==Be.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+Be.rank+" and dim was "+Xe);return ou(function(nt,tt,ut){var Dt=tt.logSumExp([Xe],!0),Rt=tt.toFloat().sub(Dt);return ut([nt,Rt]),{value:Rt.mul(nt).neg().sum([Xe]),gradFunc:function(Lt,qt){var pn=qt[0],bn=qt[1],mn=Fo(Lt.shape,[Xe]);return[Lt.reshape(mn).mul(pn.toFloat().sub(bn.exp())),Lt.reshape(mn).mul(bn.exp().sub(pn.toFloat()))]}}})(Le,Be)}(B,Q);return fl(Re,re,E)}}),wg=Object.freeze({get Reduction(){return ps},absoluteDifference:Ny,computeWeightedLoss:fl,cosineDistance:Gd,hingeLoss:Iy,huberLoss:jv,logLoss:dl,meanSquaredError:rs,sigmoidCrossEntropy:tp,softmaxCrossEntropy:_m});function zv(_,v){return v===void 0&&(v=!1),Ve.tidy(function(){if(_.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+_.shape.length+"D Tensor.");for(var d=_.shape[0],y=_.shape[1],E=Fh(d),B=_.clone(),Q=xu([[1]],[1,1]),re=Q.clone(),fe=d>=y?y:d,xe=function(Re){var Le,Be=B,Xe=re,nt=E;Le=Ve.tidy(function(){var tt=B.slice([Re,Re],[d-Re,1]),ut=tt.norm(),Dt=B.slice([Re,Re],[1,1]),Rt=xu([[-1]]).where(Dt.greater(0),xu([[1]])),Lt=Dt.sub(Rt.mul(ut)),qt=tt.div(Lt);re=qt.shape[0]===1?Q.clone():Q.concat(qt.slice([1,0],[qt.shape[0]-1,qt.shape[1]]),0);var pn=Rt.matMul(Lt).div(ut).neg(),bn=B.slice([Re,0],[d-Re,y]),mn=pn.mul(re);if(Re===0)B=bn.sub(mn.matMul(re.transpose().matMul(bn)));else{var Sn=bn.sub(mn.matMul(re.transpose().matMul(bn)));B=B.slice([0,0],[Re,y]).concat(Sn,0)}var On=E.slice([0,Re],[d,E.shape[1]-Re]);if(Re===0)E=On.sub(On.matMul(re).matMul(mn.transpose()));else{var b=On.sub(On.matMul(re).matMul(mn.transpose()));E=E.slice([0,0],[d,Re]).concat(b,1)}return[re,B,E]}),re=Le[0],B=Le[1],E=Le[2],Lo([Be,Xe,nt])},Oe=0;Oe<fe;++Oe)xe(Oe);return!v&&d>y&&(E=E.slice([0,0],[d,y]),B=B.slice([0,0],[y,y])),[E,B]})}var _g=Pt({bandPart_:function(_,v,d){if(v%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+v+".");if(d%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+d+".");var y=Ze(_,"a","bandPart");if(y.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+y.rank+".");var E=y.shape,B=y.shape.slice(-2),Q=B[0],re=B[1];if(!(v<=Q))throw new Error("bandPart(): numLower ("+v+") must not be greater than the number of rows ("+Q+").");if(!(d<=re))throw new Error("bandPart(): numUpper ("+d+") must not be greater than the number of columns ("+re+").");v<0&&(v=Q),d<0&&(d=re);var fe=Dc(0,Q,1,"int32").reshape([-1,1]),xe=Dc(0,re,1,"int32"),Oe=cl(fe,xe),Re=Id(Oe.lessEqual(kr(+v,"int32")),Oe.greaterEqual(kr(-d,"int32"))),Le=ao([Q,re],y.dtype);return qi(Va(y.reshape([-1,Q,re])).map(function(Be){return po(Re,Be,Le)})).reshape(E)}}),Bf=Pt({gramSchmidt_:function(_){var v;if(Array.isArray(_)){v=!1,we(_!=null&&_.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var d=_[0].shape[0],y=function(fe){we(_[fe].shape[0]===d,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+_[fe].shape[0]+" vs. "+d+")"})},E=1;E<_.length;++E)y(E)}else v=!0,_=Gi(_,_.shape[0],0).map(function(fe){return Wa(fe,[0])});we(_.length<=_[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+_.length+") exceeds number of dimensions ("+_[0].shape[0]+")."});var B=[],Q=_,re=function(fe){B.push(Ve.tidy(function(){var xe=Q[fe];if(fe>0)for(var Oe=0;Oe<fe;++Oe){var Re=Nv(B[Oe].mulStrict(xe)).mul(B[Oe]);xe=xe.sub(Re)}return xe.div(ep(xe,"euclidean"))}))};for(E=0;E<_.length;++E)re(E);return v?qi(B,0):B}}),R1=Pt({qr_:function(_,v){if(v===void 0&&(v=!1),_.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+_.rank);if(_.rank===2)return zv(_,v);var d=_.shape.slice(0,_.shape.length-2).reduce(function(B,Q){return B*Q}),y=[],E=[];return Va(_.reshape([d,_.shape[_.shape.length-2],_.shape[_.shape.length-1]]),0).forEach(function(B){var Q=zv(B,v),re=Q[0],fe=Q[1];y.push(re),E.push(fe)}),[qi(y,0).reshape(_.shape),qi(E,0).reshape(_.shape)]}}),Eg=Object.freeze({bandPart:_g,gramSchmidt:Bf,qr:R1});function Ja(_,v,d,y,E,B){y==null&&(y=.5),E==null&&(E=Number.NEGATIVE_INFINITY),B==null&&(B=0);var Q=_.shape[0];return d=Math.min(d,Q),we(0<=y&&y<=1,function(){return"iouThreshold must be in [0, 1], but was '"+y+"'"}),we(_.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+_.rank+"'"}),we(_.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+_.shape[1]}),we(v.rank===1,function(){return"scores must be a 1D tensor"}),we(v.shape[0]===Q,function(){return"scores has incompatible shape with boxes. Expected "+Q+", but was "+v.shape[0]}),we(0<=B&&B<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+B+"'"}),{maxOutputSize:d,iouThreshold:y,scoreThreshold:E,softNmsSigma:B}}var Em=Pt({resizeBilinear_:function(_,v,d){d===void 0&&(d=!1);var y=Ze(_,"images","resizeBilinear");we(y.rank===3||y.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+y.rank+"."}),we(v.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+v+"."});var E=y,B=!1;y.rank===3&&(B=!0,E=y.as4D(1,y.shape[0],y.shape[1],y.shape[2]));var Q=v[0],re=v[1],fe=Ve.runKernelFunc(function(xe,Oe){return Oe([E]),xe.resizeBilinear(E,Q,re,d)},{x:E},function(xe,Oe){return{x:function(){return Ve.runKernelFunc(function(Re){return Re.resizeBilinearBackprop(xe,Oe[0],d)},{})}}},"ResizeBilinear",{alignCorners:d,newHeight:Q,newWidth:re});return B?fe.as3D(fe.shape[1],fe.shape[2],fe.shape[3]):fe}}),qd=Pt({resizeNearestNeighbor_:function(_,v,d){d===void 0&&(d=!1);var y=Ze(_,"images","resizeNearestNeighbor");we(y.rank===3||y.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+y.rank+"."}),we(v.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+v+"."}),we(y.dtype==="float32"||y.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var E=y,B=!1;y.rank===3&&(B=!0,E=y.as4D(1,y.shape[0],y.shape[1],y.shape[2]));var Q=v[0],re=v[1],fe=Ve.runKernelFunc(function(xe,Oe){return Oe([E]),xe.resizeNearestNeighbor(E,Q,re,d)},{batchImages:E},function(xe,Oe){return{batchImages:function(){return Ve.runKernelFunc(function(Re){return Re.resizeNearestNeighborBackprop(xe,Oe[0],d)},{})}}});return B?fe.as3D(fe.shape[1],fe.shape[2],fe.shape[3]):fe}}),Sg=Pt({nonMaxSuppression_:function(_,v,d,y,E){y===void 0&&(y=.5),E===void 0&&(E=Number.NEGATIVE_INFINITY);var B=Ze(_,"boxes","nonMaxSuppression"),Q=Ze(v,"scores","nonMaxSuppression"),re=Ja(B,Q,d,y,E);d=re.maxOutputSize,y=re.iouThreshold,E=re.scoreThreshold;var fe={maxOutputSize:d,iouThreshold:y,scoreThreshold:E};return Ve.runKernelFunc(function(xe){return xe.nonMaxSuppression(B,Q,d,y,E)},{boxes:B,scores:Q},null,"NonMaxSuppressionV3",fe)}}),Sm=Pt({nonMaxSuppressionWithScore_:function(_,v,d,y,E,B){y===void 0&&(y=.5),E===void 0&&(E=Number.NEGATIVE_INFINITY),B===void 0&&(B=0);var Q=Ze(_,"boxes","nonMaxSuppression"),re=Ze(v,"scores","nonMaxSuppression"),fe=Ja(Q,re,d,y,E,B),xe={maxOutputSize:d=fe.maxOutputSize,iouThreshold:y=fe.iouThreshold,scoreThreshold:E=fe.scoreThreshold,softNmsSigma:B=fe.softNmsSigma},Oe=Ve.runKernel("NonMaxSuppressionV5",{boxes:Q,scores:re},xe);return{selectedIndices:Oe[0],selectedScores:Oe[1]}}}),w0=Pt({cropAndResize_:function(_,v,d,y,E,B){var Q=Ze(_,"image","cropAndResize"),re=Ze(v,"boxes","cropAndResize","float32"),fe=Ze(d,"boxInd","cropAndResize","int32");E=E||"bilinear",B=B||0;var xe=re.shape[0];return we(Q.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+Q.rank+"."}),we(re.rank===2&&re.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+xe+",4] but had shape "+re.shape+"."}),we(fe.rank===1&&fe.shape[0]===xe,function(){return"Error in cropAndResize: boxInd must be have size ["+xe+"] but had shape "+re.shape+"."}),we(y.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+y.length+"."}),we(y[0]>=1&&y[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+y}),we(E==="bilinear"||E==="nearest",function(){return"method must be bilinear or nearest, but was "+E}),Ve.runKernelFunc(function(Oe,Re){return Oe.cropAndResize(Q,re,fe,y,E,B)},{images:Q,boxes:re,boxInd:fe},null,"CropAndResize",{method:E,extrapolationValue:B,cropSize:y})}}),_0=Object.freeze({resizeBilinear:Em,resizeNearestNeighbor:qd,nonMaxSuppression:Sg,nonMaxSuppressionAsync:function(_,v,d,y,E){return y===void 0&&(y=.5),E===void 0&&(E=Number.NEGATIVE_INFINITY),N(this,void 0,void 0,function(){var B,Q,re,fe,xe,Oe,Re;return L(this,function(Le){switch(Le.label){case 0:return B=Ze(_,"boxes","nonMaxSuppressionAsync"),Q=Ze(v,"scores","nonMaxSuppressionAsync"),re=Ja(B,Q,d,y,E),d=re.maxOutputSize,y=re.iouThreshold,E=re.scoreThreshold,[4,Promise.all([B.data(),Q.data()])];case 1:return fe=Le.sent(),xe=fe[0],Oe=fe[1],Re=$u(xe,Oe,d,y,E),B!==_&&B.dispose(),Q!==v&&Q.dispose(),[2,Re]}})})},nonMaxSuppressionWithScore:Sm,nonMaxSuppressionWithScoreAsync:function(_,v,d,y,E,B){return y===void 0&&(y=.5),E===void 0&&(E=Number.NEGATIVE_INFINITY),B===void 0&&(B=0),N(this,void 0,void 0,function(){var Q,re,fe,xe,Oe,Re,Le;return L(this,function(Be){switch(Be.label){case 0:return Q=Ze(_,"boxes","nonMaxSuppressionAsync"),re=Ze(v,"scores","nonMaxSuppressionAsync"),fe=Ja(Q,re,d,y,E,B),d=fe.maxOutputSize,y=fe.iouThreshold,E=fe.scoreThreshold,B=fe.softNmsSigma,[4,Promise.all([Q.data(),re.data()])];case 1:return xe=Be.sent(),Oe=xe[0],Re=xe[1],Le=Xu(Oe,Re,d,y,E,B),Q!==_&&Q.dispose(),re!==v&&re.dispose(),[2,Le]}})})},cropAndResize:w0}),jf=function(_,v){return!(_>0)||v==="linear"},gc=function(_,v,d){if(d==null||d==="linear")return _;if(d==="relu")return _.mul(v.step());throw new Error("Gradient for activation "+d+" has not been implemented yet.")},Uv=function(_,v){var d=v,y=Ta(_.shape,v.shape);return y.length>0&&(d=d.sum(y)),d.reshape(_.shape)},Wv=function(_,v,d){if(v==="linear")return _;if(v==="relu")return mg(_);if(v==="elu")return zc(_);if(v==="relu6")return v0(_);if(v==="prelu")return gm(_,d);throw new Error("Unknown fused activation "+v+".")},np=Pt({fusedMatMul_:function(_){var v,d=_.a,y=_.b,E=_.transposeA,B=E!==void 0&&E,Q=_.transposeB,re=Q!==void 0&&Q,fe=_.bias,xe=_.activation,Oe=xe===void 0?"linear":xe,Re=_.preluActivationWeights;if(jf(Ve.state.gradientDepth,Oe)===!1){var Le=_v(d,y,B,re);return fe!=null&&(Le=qh(Le,fe)),Wv(Le,Oe,Re)}var Be=Ze(d,"a","fused matMul"),Xe=Ze(y,"b","fused matMul");v=Kt(Be,Xe),Be=v[0],Xe=v[1];var nt=B?Be.shape[Be.rank-2]:Be.shape[Be.rank-1],tt=re?Xe.shape[Xe.rank-1]:Xe.shape[Xe.rank-2],ut=B?Be.shape[Be.rank-1]:Be.shape[Be.rank-2],Dt=re?Xe.shape[Xe.rank-2]:Xe.shape[Xe.rank-1],Rt=Be.shape.slice(0,-2),Lt=Xe.shape.slice(0,-2),qt=ze(Rt),pn=ze(Lt);we(Be.rank>=2&&Xe.rank>=2&&Be.rank===Xe.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+Be.rank+" and "+Xe.rank+"."}),we(Ut(Rt,Lt),function(){return"Error in fused matMul: outer dimensions ("+Rt+") and ("+Lt+") of Tensors with shapes "+Be.shape+" and "+Xe.shape+" must match."}),we(nt===tt,function(){return"Error in fused matMul: inner shapes ("+nt+") and ("+tt+") of Tensors with shapes "+Be.shape+" and "+Xe.shape+" and transposeA="+B+" and transposeB="+re+" must match."});var bn,mn,Sn=Be.shape.slice(0,-2).concat([ut,Dt]),On=B?Be.as3D(qt,nt,ut):Be.as3D(qt,ut,nt),b=re?Xe.as3D(pn,Dt,tt):Xe.as3D(pn,tt,Dt);fe!=null&&no(Sn,(bn=Kt(bn=Ze(fe,"bias","fused matMul"),Be)[0]).shape),Re!=null&&(mn=Ze(Re,"prelu weights","fused matMul"));var h={a:On,b};fe!=null&&(h.bias=bn),Re!=null&&(h.preluActivationWeights=mn);var c=[On,b];return Ve.runKernelFunc(function(m,w){var R=m.fusedBatchMatMul({a:On,b,transposeA:B,transposeB:re,bias:bn,activation:Oe,preluActivationWeights:mn});return w([On,b,R]),R},h,function(m,w){var R=w[0],K=w[1],ee=w[2],le=gc(m,ee,Oe),de={};return fe!=null&&(de={bias:function(){return Uv(bn,le)}}),Object.assign(B||re?!B&&re?{a:function(){return le.matMul(K,!1,!1)},b:function(){return le.matMul(R,!0,!1)}}:B&&!re?{a:function(){return K.matMul(le,!1,!0)},b:function(){return R.matMul(le,!1,!1)}}:{a:function(){return K.matMul(le,!0,!0)},b:function(){return le.matMul(R,!0,!0)}}:{a:function(){return le.matMul(K,!1,!0)},b:function(){return R.matMul(le,!0,!1)}},de)},"_FusedMatMul",{transposeA:B,transposeB:re,activation:Oe},c,[!0]).reshape(Sn)}}),km=Pt({fusedConv2d_:function(_){var v=_.x,d=_.filter,y=_.strides,E=_.pad,B=_.dataFormat,Q=B===void 0?"NHWC":B,re=_.dilations,fe=re===void 0?[1,1]:re,xe=_.dimRoundingMode,Oe=_.bias,Re=_.activation,Le=Re===void 0?"linear":Re,Be=_.preluActivationWeights;if(Le=Le||"linear",jf(Ve.state.gradientDepth,Le)===!1){var Xe=Yh(v,d,y,E,Q,fe,xe);return Oe!=null&&(Xe=qh(Xe,Oe)),Wv(Xe,Le,Be)}var nt=Ze(v,"x","conv2d"),tt=Ze(d,"filter","conv2d"),ut=nt,Dt=!1;nt.rank===3&&(Dt=!0,ut=nt.as4D(1,nt.shape[0],nt.shape[1],nt.shape[2])),we(ut.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+ut.rank+"."}),we(tt.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+tt.rank+"."}),xe!=null&&we(Ft(E),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+xe+" but got pad "+E+"."}),we(ut.shape[3]===tt.shape[2],function(){return"Error in conv2d: depth of input ("+ut.shape[3]+") must match input depth for filter "+tt.shape[2]+"."}),we(_s(y,fe),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+fe+"'"}),we(Q==="NHWC",function(){return"Error in conv2d: got dataFormat of "+Q+" but only NHWC is currently supported."});var Rt,Lt,qt=au(ut.shape,tt.shape,y,fe,E,xe);Oe!=null&&(Rt=Kt(Rt=Ze(Oe,"bias","fused conv2d"),nt)[0],no(qt.outShape,Rt.shape)),Be!=null&&(Lt=Ze(Be,"prelu weights","fused conv2d"));var pn={x:ut,filter:tt};Oe!=null&&(pn.bias=Rt),Be!=null&&(pn.preluActivationWeights=Lt);var bn=[tt,ut],mn=Ve.runKernelFunc(function(Sn,On){var b=Sn.fusedConv2d({input:ut,filter:tt,convInfo:qt,bias:Rt,activation:Le,preluActivationWeights:Lt});return On([tt,ut,b]),b},pn,function(Sn,On){var b=On,h=b[0],c=b[1],m=b[2],w=gc(Sn,m,Le);we(Ba(fe),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+fe+"'"});var R={};return Oe!=null&&(R={bias:function(){return Uv(Rt,w)}}),Object.assign({x:function(){return f0(c.shape,w,h,y,E)},filter:function(){return l0(c,w,h.shape,y,E)}},R)},"FusedConv2D",{convInfo:qt,activation:Le},bn,[!0]);return Dt?mn.as3D(mn.shape[1],mn.shape[2],mn.shape[3]):mn}}),Fy=Pt({fusedDepthwiseConv2d_:function(_){var v=_.x,d=_.filter,y=_.strides,E=_.pad,B=_.dataFormat,Q=B===void 0?"NHWC":B,re=_.dilations,fe=re===void 0?[1,1]:re,xe=_.dimRoundingMode,Oe=_.bias,Re=_.activation,Le=Re===void 0?"linear":Re,Be=_.preluActivationWeights;if(jf(Ve.state.gradientDepth,Le)===!1){var Xe=hm(v,d,y,E,Q,fe,xe);return Oe!=null&&(Xe=qh(Xe,Oe)),Wv(Xe,Le,Be)}var nt=Ze(v,"x","depthwiseConv2d"),tt=Ze(d,"filter","depthwiseConv2d"),ut=nt,Dt=!1;nt.rank===3&&(Dt=!0,ut=nt.as4D(1,nt.shape[0],nt.shape[1],nt.shape[2])),we(ut.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+ut.rank+"."}),we(tt.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+tt.rank+"."}),we(ut.shape[3]===tt.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+ut.shape[3]+") must match the inChannels dimension in filter "+tt.shape[2]+"."}),fe==null&&(fe=[1,1]),we(_s(y,fe),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+fe+"'"}),xe!=null&&we(Ft(E),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+xe+" but got pad "+E+"."});var Rt,Lt,qt=au(ut.shape,tt.shape,y,fe,E,xe,!0);Oe!=null&&(Rt=Kt(Rt=Ze(Oe,"bias","fused conv2d"),nt)[0],no(qt.outShape,Rt.shape)),Be!=null&&(Lt=Ze(Be,"prelu weights","fused depthwiseConv2d"));var pn={x:ut,filter:tt};Oe!=null&&(pn.bias=Rt),Be!=null&&(pn.preluActivationWeights=Lt);var bn=[tt,ut],mn=Ve.runKernelFunc(function(Sn,On){var b=Sn.fusedDepthwiseConv2D({input:ut,filter:tt,convInfo:qt,bias:Rt,activation:Le,preluActivationWeights:Lt});return On([tt,ut,b]),b},pn,function(Sn,On){we(Ba(fe),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+fe+"'"});var b=On[0],h=On[1],c=On[2],m=gc(Sn,c,Le),w={};return Oe!=null&&(w={bias:function(){return Uv(Rt,m)}}),Object.assign({x:function(){return d0(h.shape,m,b,qt)},filter:function(){return dg(h,m,b.shape,qt)}},w)},"FusedDepthwiseConv2D",{convInfo:qt,activation:Le},bn,[!0]);return Dt?mn.as3D(mn.shape[1],mn.shape[2],mn.shape[3]):mn}}),E0=Object.freeze({matMul:np,conv2d:km,depthwiseConv2d:Fy}),kg=Object.freeze({image:_0,linalg:Eg,losses:wg,spectral:bg,fused:E0,signal:x0,square:t0,squaredDifference:Md,conv1d:lg,conv2d:Yh,conv3d:fg,depthwiseConv2d:hm,separableConv2d:wv,conv2dTranspose:Wl,conv3dTranspose:Ty,op:Pt,batchNormalization2d:yv,batchNormalization3d:um,batchNormalization4d:a0,batchNormalization:F1,batchNorm:Cy,batchNorm2d:Of,batchNorm3d:Gh,batchNorm4d:Nd,booleanMaskAsync:ug,complex:_o,real:va,imag:Ya,concat:Ho,concat1d:Mh,concat2d:Hp,concat3d:ff,concat4d:Dh,split:Gi,matMul:_v,dot:pm,outerProduct:Ev,reverse:Ff,reverse1d:Sv,reverse2d:mm,reverse3d:hg,reverse4d:kv,maxPool:Av,avgPool:Ov,pool:Ud,maxPool3d:My,avgPool3d:Tv,slice:Vl,slice1d:p0,slice2d:Mv,slice3d:Wd,slice4d:Hl,abs:al,acos:n0,acosh:r0,asin:Yu,asinh:i0,atan:Wh,atanh:im,ceil:ky,clipByValue:om,cos:sl,cosh:am,erf:lv,exp:fv,expm1:o0,floor:D1,log:N1,log1p:yo,logSigmoid:dv,neg:hv,reciprocal:eg,round:pv,rsqrt:sm,sigmoid:Ll,sign:Bl,isNaN:mv,isInf:gv,isFinite:Vh,sin:Dd,sinh:Hh,softplus:I1,sqrt:tg,step:jl,tan:Ju,tanh:kf,all:m0,any:jc,argMax:g0,argMin:Dv,logSumExp:Rf,max:Dy,mean:Jh,min:Qh,moments:Pf,sum:Nv,prod:Vd,equal:Lc,equalStrict:ec,greater:Nu,greaterEqual:Kh,greaterEqualStrict:og,greaterStrict:u0,less:c0,lessEqual:lm,lessEqualStrict:zo,lessStrict:fm,notEqual:Bc,notEqualStrict:jd,add:qh,addN:Ay,addStrict:Oy,atan2:rg,div:Mf,divNoNan:zl,divStrict:cm,floorDiv:$h,maximum:Rd,maximumStrict:Df,minimum:Nf,minimumStrict:Zu,mod:Xh,modStrict:Pd,mul:Ul,mulStrict:ul,pow:Ld,powStrict:ig,squaredDifferenceStrict:Bd,sub:cl,subStrict:ds,elu:zc,leakyRelu:Zh,prelu:gm,relu:mg,relu6:v0,selu:Iv,logicalAnd:Id,logicalNot:bv,logicalOr:s0,logicalXor:Fd,where:po,whereAsync:Tf,buffer:Wi,print:vd,batchToSpaceND:Ol,broadcastTo:df,cast:Xp,clone:Qm,cumsum:hf,depthToSpace:Ih,expandDims:Go,eye:Fh,multinomial:pf,oneHot:Rh,pad:mf,pad1d:Tl,pad2d:el,pad3d:Ph,pad4d:yd,rand:gf,randomNormal:tl,randomGamma:Xg,randomUniform:vf,reshape:la,spaceToBatchND:La,squeeze:Wa,stack:qi,tile:Rs,truncatedNormal:nl,unstack:Va,setdiff1dAsync:rl,fill:Is,linspace:Th,ones:Du,range:Dc,scalar:kr,tensor:To,tensor1d:ru,tensor2d:xu,tensor3d:Cl,tensor4d:iu,tensor5d:Oh,tensor6d:Wp,variable:Vp,zeros:ao,onesLike:xs,zerosLike:mi,transpose:hs,softmax:Ls,logSoftmax:mo,localResponseNormalization:Fv,norm:ep,gather:ag,unsortedSegmentSum:sg,basicLSTMCell:Rv,multiRNNCell:gg,movingAverage:Lf,stridedSlice:vm,topk:Gl,scatterND:Pv,fft:vg,ifft:yg,rfft:y0,irfft:ll,sparseToDense:Lv,gatherND:ql,diag:ym,dropout:Hd,hannWindow:xg,hammingWindow:b0,frame:xm,stft:wm,inTopKAsync:Bv});function $r(_,v){Array.isArray(_)||(_=[_]),_.forEach(function(d){d!=null&&we(d.dtype!=="complex64",function(){return v+" does not support complex64 tensors."})})}function $(_,v,d,y){if(d==="linear")return _.linear(v);if(d==="relu")return _.relu(v);if(d==="elu")return _.elu(v);if(d==="relu6")return _.relu6(v);if(d==="prelu")return _.prelu(v,y);throw new Error("Activation "+d+" has not been implemented for the CPU backend.")}var M=function(_){function v(){var d=_.call(this)||this;return d.blockSize=48,d.firstUse=!0,d.data=new _f(d,Ve),d}return j(v,_),v.prototype.write=function(d,y,E){this.firstUse&&(this.firstUse=!1,z().get("IS_NODE")&&kl(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var B={};return this.data.set(B,{values:d,dtype:E}),B},v.prototype.move=function(d,y,E,B){this.data.set(d,{values:y,dtype:B})},v.prototype.numDataIds=function(){return this.data.numDataIds()},v.prototype.read=function(d){return N(this,void 0,void 0,function(){return L(this,function(y){return[2,this.readSync(d)]})})},v.prototype.readSync=function(d){var y=this.data.get(d),E=y.dtype,B=y.complexTensors;return E==="complex64"?qu(this.readSync(B.real.dataId),this.readSync(B.imag.dataId)):this.data.get(d).values},v.prototype.bufferSync=function(d){var y=this.readSync(d.dataId),E=y;if(d.dtype==="string")try{E=y.map(function(B){return Un(B)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Wi(d.shape,d.dtype,E)},v.prototype.makeOutput=function(d,y,E){var B=this.write(d,y,E);return Ve.makeTensorFromDataId(B,y,E,this)},v.prototype.disposeData=function(d){if(this.data.has(d)){var y=this.data.get(d).complexTensors;y!=null&&(y.real.dispose(),y.imag.dispose()),this.data.delete(d)}},v.prototype.time=function(d){return N(this,void 0,void 0,function(){var y;return L(this,function(E){return y=Zt(),d(),[2,{kernelMs:Zt()-y}]})})},v.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},v.prototype.complex=function(d,y){var E=this.makeOutput(null,d.shape,"complex64");return this.data.get(E.dataId).complexTensors={real:Ve.keep(d.clone()),imag:Ve.keep(y.clone())},E},v.prototype.real=function(d){return this.data.get(d.dataId).complexTensors.real.clone()},v.prototype.imag=function(d){return this.data.get(d.dataId).complexTensors.imag.clone()},v.prototype.slice=function(d,y,E){if($r(d,"slice"),_d(d.shape,y,E)){var B=Bh(y,d.strides),Q=ze(E);return To(this.readSync(d.dataId).subarray(B,B+Q),E,d.dtype)}for(var re=Wi(E,d.dtype),fe=this.bufferSync(d),xe=0;xe<re.size;++xe){var Oe=re.indexToLoc(xe).map(function(Re,Le){return Re+y[Le]});re.values[xe]=fe.get.apply(fe,Oe)}return re.toTensor()},v.prototype.stridedSlice=function(d,y,E,B){$r(d,"stridedSlice");var Q=bf(y,E,B);if(Q.some(function(Be){return Be===0}))return To([],Q);for(var re=Wi(Q,d.dtype),fe=this.bufferSync(d),xe=0;xe<re.size;xe++){for(var Oe=re.indexToLoc(xe),Re=new Array(Oe.length),Le=0;Le<Re.length;Le++)Re[Le]=Oe[Le]*B[Le]+y[Le];re.set.apply(re,[fe.get.apply(fe,Re)].concat(Oe))}return re.toTensor()},v.prototype.diag=function(d){for(var y=this.readSync(d.dataId),E=Wi([d.size,d.size],d.dtype),B=E.values,Q=0;Q<y.length;Q++)B[Q*d.size+Q]=y[Q];return E.toTensor()},v.prototype.unstack=function(d,y){for(var E=d.shape[y],B=new Array(d.rank-1),Q=0,re=0;re<d.rank;re++)re!==y&&(B[Q++]=d.shape[re]);var fe=new Array(d.rank).fill(0),xe=d.shape.slice();xe[y]=1;var Oe=new Array(E);for(re=0;re<Oe.length;re++)fe[y]=re,Oe[re]=this.slice(d,fe,xe).reshape(B);return Oe},v.prototype.reverse=function(d,y){$r(d,"reverse");for(var E=Wi(d.shape,d.dtype),B=this.bufferSync(d),Q=function(fe){var xe=E.indexToLoc(fe),Oe=xe.slice();y.forEach(function(Re){return Oe[Re]=d.shape[Re]-1-Oe[Re]}),E.set.apply(E,[B.get.apply(B,Oe)].concat(xe))},re=0;re<E.size;re++)Q(re);return E.toTensor()},v.prototype.concat=function(d,y){var E=this;if(d[0].dtype==="complex64"){var B=d.map(function(Be){return va(Be)}),Q=d.map(function(Be){return Ya(Be)});return _o(this.concat(B,y),this.concat(Q,y))}var re=d.map(function(Be){var Xe=ze(Be.shape.slice(y));return Be.as2D(-1,Xe)}),fe=bu(re.map(function(Be){return Be.shape}),1),xe=Wi(fe,d[0].dtype).values;if(re[0].shape[0]===1){var Oe=0;re.forEach(function(Be){xe.set(E.readSync(Be.dataId),Oe),Oe+=Be.size})}else{var Re=0;re.forEach(function(Be){for(var Xe=E.readSync(Be.dataId),nt=0,tt=0;tt<Be.shape[0];++tt)for(var ut=tt*fe[1]+Re,Dt=0;Dt<Be.shape[1];++Dt)xe[ut+Dt]=Xe[nt++];Re+=Be.shape[1]})}var Le=bu(d.map(function(Be){return Be.shape}),y);return To(xe,Le,d[0].dtype)},v.prototype.neg=function(d){return $r(d,"neg"),this.multiply(kr(-1),d)},v.prototype.add=function(d,y){return d.dtype==="complex64"||y.dtype==="complex64"?this.broadcastedBinaryComplexOp(d.cast("complex64"),y.cast("complex64"),function(E,B,Q,re){return{real:E+Q,imag:B+re}}):this.broadcastedBinaryOp(d,y,En(d.dtype,y.dtype),function(E,B){return E+B})},v.prototype.addN=function(d){var y=this;$r(d,"addN");for(var E=d.map(function(Oe){return y.readSync(Oe.dataId)}),B=Wi(d[0].shape,d[0].dtype),Q=B.values,re=0;re<d.length;re++)for(var fe=E[re],xe=0;xe<Q.length;xe++)Q[xe]+=fe[xe];return B.toTensor()},v.prototype.softmax=function(d,y){var E=Yt([y],d.shape),B=this.max(d,E),Q=Fo(B.shape,E),re=this.subtract(d,B.reshape(Q)),fe=this.exp(re),xe=this.sum(fe,E).reshape(Q);return this.realDivide(fe,xe)},v.prototype.subtract=function(d,y){return d.dtype==="complex64"||y.dtype==="complex64"?this.broadcastedBinaryComplexOp(d.cast("complex64"),y.cast("complex64"),function(E,B,Q,re){return{real:E-Q,imag:B-re}}):this.broadcastedBinaryOp(d,y,En(d.dtype,y.dtype),function(E,B){return E-B})},v.prototype.pow=function(d,y){return $r([d,y],"pow"),this.broadcastedBinaryOp(d,y,d.dtype,function(E,B){return Math.pow(E,B)})},v.prototype.batchMatMul=function(d,y,E,B){$r([d,y],"matMul");for(var Q=E?d.shape[1]:d.shape[2],re=E?d.shape[2]:d.shape[1],fe=B?y.shape[1]:y.shape[2],xe=d.shape[0],Oe=this.readSync(d.dataId),Re=this.readSync(y.dataId),Le=E?[d.strides[0],1,d.strides[1]]:[d.strides[0],d.strides[1],1],Be=Le[0],Xe=Le[1],nt=Le[2],tt=B?[1,y.strides[1],y.strides[0]]:[y.strides[1],1,y.strides[0]],ut=tt[0],Dt=tt[1],Rt=tt[2],Lt=re*fe,qt=Wi([xe,re,fe],d.dtype),pn=qt.values,bn=this.blockSize,mn=0;mn<xe;mn++)for(var Sn=0;Sn<re;Sn+=bn)for(var On=0;On<fe;On+=bn)for(var b=0;b<Q;b+=bn)for(var h=Math.min(Sn+bn,re),c=Math.min(On+bn,fe),m=Math.min(b+bn,Q),w=Sn;w<h;w++)for(var R=On;R<c;R++){for(var K=0,ee=b;ee<m;ee++)K+=Oe[mn*Be+w*Xe+ee*nt]*Re[ee*ut+R*Dt+mn*Rt];pn[mn*Lt+(w*fe+R)]+=K}return qt.toTensor()},v.prototype.fusedBatchMatMul=function(d){var y=d.a,E=d.b,B=d.transposeA,Q=d.transposeB,re=d.bias,fe=d.activation,xe=d.preluActivationWeights,Oe=this.batchMatMul(y,E,B,Q);return re&&(Oe=this.add(Oe,re)),fe&&(Oe=$(this,Oe,fe,xe)),Oe},v.prototype.multiply=function(d,y){return d.dtype==="complex64"||y.dtype==="complex64"?this.broadcastedBinaryComplexOp(d.cast("complex64"),y.cast("complex64"),function(E,B,Q,re){return{real:E*Q-B*re,imag:E*re+B*Q}}):this.broadcastedBinaryOp(d,y,En(d.dtype,y.dtype),function(E,B){return E*B})},v.prototype.realDivide=function(d,y){return $r([d,y],"realDivide"),this.broadcastedBinaryOp(d,y,"float32",function(E,B){return E/B})},v.prototype.floorDiv=function(d,y){return $r([d,y],"floorDiv"),this.broadcastedBinaryOp(d,y,"int32",function(E,B){return Math.floor(E/B)})},v.prototype.sum=function(d,y){$r(d,"sum"),ta("sum",y,d.rank);for(var E=Io(d.shape,y),B=E[0],Q=E[1],re=ao(B,En(d.dtype,"int32")),fe=ze(Q),xe=this.readSync(re.dataId),Oe=this.readSync(d.dataId),Re=0;Re<xe.length;++Re){for(var Le=Re*fe,Be=0,Xe=0;Xe<fe;++Xe)Be+=Oe[Le+Xe];xe[Re]=Be}return re},v.prototype.prod=function(d,y){$r(d,"sum");for(var E=Io(d.shape,y),B=E[0],Q=E[1],re=ao(B,En(d.dtype,"int32")),fe=ze(Q),xe=this.readSync(re.dataId),Oe=this.readSync(d.dataId),Re=0;Re<xe.length;++Re){for(var Le=Re*fe,Be=1,Xe=0;Xe<fe;++Xe)Be*=Oe[Le+Xe];xe[Re]=Be}return re},v.prototype.unsortedSegmentSum=function(d,y,E){$r(d,"unsortedSegmentSum");for(var B=[],Q=d.rank-y.rank,re=0;re<Q;++re)y=y.expandDims(re+1);for(re=0;re<E;++re){var fe=kr(re,"int32"),xe=Lc(fe,y).asType("float32").mul(d).sum(0);B.push(xe)}return qi(B)},v.prototype.argMin=function(d,y){$r(d,"argMin");var E=[y];ta("argMin",E,d.rank);for(var B=Io(d.shape,E),Q=B[0],re=B[1],fe=ao(Q,"int32"),xe=ze(re),Oe=this.readSync(fe.dataId),Re=this.readSync(d.dataId),Le=0;Le<Oe.length;++Le){for(var Be=Le*xe,Xe=Re[Be],nt=0,tt=0;tt<xe;++tt){var ut=Re[Be+tt];ut<Xe&&(Xe=ut,nt=tt)}Oe[Le]=nt}return fe},v.prototype.argMax=function(d,y){$r(d,"argMax");var E=[y];ta("argMax",E,d.rank);for(var B=Io(d.shape,E),Q=B[0],re=B[1],fe=ao(Q,"int32"),xe=ze(re),Oe=this.readSync(fe.dataId),Re=this.readSync(d.dataId),Le=0;Le<Oe.length;++Le){for(var Be=Le*xe,Xe=Re[Be],nt=0,tt=0;tt<xe;++tt){var ut=Re[Be+tt];ut>Xe&&(Xe=ut,nt=tt)}Oe[Le]=nt}return fe},v.prototype.cumsum=function(d,y,E,B){if($r(d,"cumsum"),y!==d.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(d.rank-1)+" but got axis="+y);for(var Q=En(d.dtype,"int32"),re=ao(d.shape,Q),fe=this.readSync(re.dataId),xe=this.readSync(d.dataId),Oe=d.shape[d.rank-1],Re=B?function(tt,ut){return tt+Oe-ut-1}:function(tt,ut){return tt+ut},Le=0;Le<xe.length;Le+=Oe)for(var Be=0;Be<Oe;Be++){var Xe=Re(Le,Be);if(Be===0)fe[Xe]=E?0:xe[Xe];else{var nt=Re(Le,Be-1);fe[Xe]=E?xe[nt]+fe[nt]:xe[Xe]+fe[nt]}}return re},v.prototype.equal=function(d,y){return $r([d,y],"equal"),this.broadcastedBinaryOp(d,y,"bool",function(E,B){return E===B?1:0})},v.prototype.notEqual=function(d,y){return $r([d,y],"notEqual"),this.broadcastedBinaryOp(d,y,"bool",function(E,B){return E!==B?1:0})},v.prototype.less=function(d,y){return $r([d,y],"less"),this.broadcastedBinaryOp(d,y,"bool",function(E,B){return E<B?1:0})},v.prototype.lessEqual=function(d,y){return $r([d,y],"lessEqual"),this.broadcastedBinaryOp(d,y,"bool",function(E,B){return E<=B?1:0})},v.prototype.greater=function(d,y){return $r([d,y],"greater"),this.broadcastedBinaryOp(d,y,"bool",function(E,B){return E>B?1:0})},v.prototype.greaterEqual=function(d,y){return $r([d,y],"greaterEqual"),this.broadcastedBinaryOp(d,y,"bool",function(E,B){return E>=B?1:0})},v.prototype.logicalNot=function(d){$r(d,"logicalNot");for(var y=this.readSync(d.dataId),E=new Uint8Array(y.length),B=0;B<y.length;++B)E[B]=y[B]?0:1;return this.makeOutput(E,d.shape,"bool")},v.prototype.logicalAnd=function(d,y){return $r([d,y],"logicalAnd"),this.broadcastedBinaryOp(d,y,"bool",function(E,B){return E&&B})},v.prototype.logicalOr=function(d,y){return $r([d,y],"logicalOr"),this.broadcastedBinaryOp(d,y,"bool",function(E,B){return E||B})},v.prototype.select=function(d,y,E){$r([d,y,E],"select");for(var B=this.readSync(d.dataId),Q=this.readSync(y.dataId),re=this.readSync(E.dataId),fe=ao(y.shape,En(y.dtype,E.dtype)),xe=this.readSync(fe.dataId),Oe=0,Re=d.rank===0||d.rank>1||y.rank===1?1:ze(y.shape.slice(1)),Le=0;Le<B.length;Le++)for(var Be=0;Be<Re;Be++)B[Le]===1?xe[Oe++]=Q[Le]:xe[Oe++]=re[Le];return fe},v.prototype.where=function(d){$r([d],"where");var y=this.readSync(d.dataId);return ne(d.shape,y)},v.prototype.topk=function(d,y,E){return $r(d,"topk"),ae(this.readSync(d.dataId),d.shape,d.dtype,y)},v.prototype.min=function(d,y){$r(d,"min"),ta("min",y,d.rank);for(var E=Io(d.shape,y),B=E[0],Q=E[1],re=ao(B,d.dtype),fe=ze(Q),xe=this.readSync(re.dataId),Oe=this.readSync(d.dataId),Re=0;Re<xe.length;++Re){for(var Le=Re*fe,Be=Oe[Le],Xe=0;Xe<fe;++Xe){var nt=Oe[Le+Xe];nt<Be&&(Be=nt)}xe[Re]=Be}return re},v.prototype.minimum=function(d,y){return $r([d,y],"minimum"),this.broadcastedBinaryOp(d,y,d.dtype,function(E,B){return Math.min(E,B)})},v.prototype.mod=function(d,y){return $r([d,y],"mod"),this.broadcastedBinaryOp(d,y,d.dtype,function(E,B){var Q=E%B;return E<0&&B<0||E>=0&&B>=0?Q:(Q+B)%B})},v.prototype.max=function(d,y){$r(d,"max"),ta("max",y,d.rank);for(var E=Io(d.shape,y),B=E[0],Q=E[1],re=ao(B,d.dtype),fe=ze(Q),xe=this.readSync(re.dataId),Oe=this.readSync(d.dataId),Re=0;Re<xe.length;++Re){for(var Le=Re*fe,Be=Oe[Le],Xe=0;Xe<fe;++Xe){var nt=Oe[Le+Xe];nt>Be&&(Be=nt)}xe[Re]=Be}return re},v.prototype.maximum=function(d,y){return $r([d,y],"maximum"),this.broadcastedBinaryOp(d,y,d.dtype,function(E,B){return Math.max(E,B)})},v.prototype.all=function(d,y){$r(d,"all"),ta("all",y,d.rank);for(var E=Io(d.shape,y),B=E[0],Q=E[1],re=ao(B,d.dtype),fe=ze(Q),xe=this.readSync(re.dataId),Oe=this.readSync(d.dataId),Re=0;Re<xe.length;++Re){for(var Le=Re*fe,Be=Oe[Le],Xe=0;Xe<fe;++Xe){var nt=Oe[Le+Xe];Be=Be&&nt}xe[Re]=Be}return re},v.prototype.any=function(d,y){$r(d,"any"),ta("any",y,d.rank);for(var E=Io(d.shape,y),B=E[0],Q=E[1],re=ao(B,d.dtype),fe=ze(Q),xe=this.readSync(re.dataId),Oe=this.readSync(d.dataId),Re=0;Re<xe.length;++Re){for(var Le=Re*fe,Be=Oe[Le],Xe=0;Xe<fe;++Xe){var nt=Oe[Le+Xe];Be=Be||nt}xe[Re]=Be}return re},v.prototype.squaredDifference=function(d,y){return $r([d,y],"squaredDifference"),this.broadcastedBinaryOp(d,y,d.dtype,function(E,B){var Q=E-B;return Q*Q})},v.prototype.ceil=function(d){$r(d,"ceil");for(var y=this.readSync(d.dataId),E=new Float32Array(y.length),B=0;B<y.length;++B)E[B]=Math.ceil(y[B]);return this.makeOutput(E,d.shape,"float32")},v.prototype.floor=function(d){$r(d,"floor");for(var y=this.readSync(d.dataId),E=new Float32Array(y.length),B=0;B<y.length;++B)E[B]=Math.floor(y[B]);return this.makeOutput(E,d.shape,"float32")},v.prototype.sign=function(d){$r(d,"x");for(var y=this.readSync(d.dataId),E=new Float32Array(y.length),B=0;B<y.length;++B)y[B]<0?E[B]=-1:y[B]>0?E[B]=1:E[B]=0;return this.makeOutput(E,d.shape,"float32")},v.prototype.isNaN=function(d){$r(d,"x");for(var y=this.readSync(d.dataId),E=new Uint8Array(y.length),B=0;B<y.length;++B)Number.isNaN(y[B])&&(E[B]=1);return this.makeOutput(E,d.shape,"bool")},v.prototype.isInf=function(d){$r(d,"x");for(var y=this.readSync(d.dataId),E=new Uint8Array(y.length),B=0;B<y.length;++B)Math.abs(y[B])===1/0&&(E[B]=1);return this.makeOutput(E,d.shape,"bool")},v.prototype.isFinite=function(d){$r(d,"x");for(var y=this.readSync(d.dataId),E=new Uint8Array(y.length),B=0;B<y.length;++B)Number.isFinite(y[B])&&(E[B]=1);return this.makeOutput(E,d.shape,"bool")},v.prototype.round=function(d){$r(d,"round");for(var y=this.readSync(d.dataId),E=new Float32Array(y.length),B=0;B<y.length;++B){var Q=Math.floor(y[B]);y[B]-Q<.5?E[B]=Math.floor(y[B]):y[B]-Q>.5?E[B]=Math.ceil(y[B]):E[B]=Q%2==0?Q:Q+1}return this.makeOutput(E,d.shape,"float32")},v.prototype.exp=function(d){$r(d,"exp");for(var y=this.readSync(d.dataId),E=new Float32Array(y.length),B=0;B<y.length;++B)E[B]=Math.exp(y[B]);return this.makeOutput(E,d.shape,"float32")},v.prototype.expm1=function(d){$r(d,"expm1");for(var y=this.readSync(d.dataId),E=new Float32Array(y.length),B=0;B<y.length;++B)E[B]=Math.expm1(y[B]);return this.makeOutput(E,d.shape,"float32")},v.prototype.log=function(d){$r(d,"log");for(var y=this.readSync(d.dataId),E=new Float32Array(y.length),B=0;B<y.length;++B){var Q=y[B];E[B]=Math.log(Q)}return this.makeOutput(E,d.shape,"float32")},v.prototype.log1p=function(d){$r(d,"log1p");for(var y=this.readSync(d.dataId),E=new Float32Array(y.length),B=0;B<y.length;++B){var Q=y[B];E[B]=Math.log1p(Q)}return this.makeOutput(E,d.shape,"float32")},v.prototype.sqrt=function(d){$r(d,"sqrt");for(var y=this.readSync(d.dataId),E=new Float32Array(y.length),B=0;B<y.length;++B){var Q=y[B];E[B]=Math.sqrt(Q)}return this.makeOutput(E,d.shape,"float32")},v.prototype.rsqrt=function(d){$r(d,"rsqrt");for(var y=this.readSync(d.dataId),E=new Float32Array(y.length),B=0;B<y.length;++B){var Q=y[B];E[B]=1/Math.sqrt(Q)}return this.makeOutput(E,d.shape,"float32")},v.prototype.reciprocal=function(d){$r(d,"reciprocal");for(var y=this.readSync(d.dataId),E=new Float32Array(y.length),B=0;B<y.length;++B)E[B]=1/y[B];return this.makeOutput(E,d.shape,"float32")},v.prototype.linear=function(d){return d},v.prototype.relu=function(d){$r(d,"relu");for(var y=ao(d.shape,d.dtype),E=this.readSync(y.dataId),B=this.readSync(d.dataId),Q=0;Q<B.length;++Q)E[Q]=Math.max(0,B[Q]);return y},v.prototype.relu6=function(d){$r(d,"relu");for(var y=ao(d.shape,d.dtype),E=this.readSync(y.dataId),B=this.readSync(d.dataId),Q=0;Q<B.length;++Q)E[Q]=Math.min(Math.max(0,B[Q]),6);return y},v.prototype.prelu=function(d,y){return $r([d,y],"prelu"),this.broadcastedBinaryOp(d,y,d.dtype,function(E,B){return E<0?B*E:E})},v.prototype.elu=function(d){$r(d,"elu");for(var y=new Float32Array(d.size),E=this.readSync(d.dataId),B=0;B<E.length;++B){var Q=E[B];y[B]=Q>=0?Q:Math.exp(Q)-1}return this.makeOutput(y,d.shape,"float32")},v.prototype.eluDer=function(d,y){$r([d,y],"eluDer");for(var E=new Float32Array(y.size),B=this.readSync(y.dataId),Q=this.readSync(d.dataId),re=0;re<B.length;++re){var fe=B[re];E[re]=fe>=1?Q[re]:Q[re]*(fe+1)}return this.makeOutput(E,y.shape,"float32")},v.prototype.selu=function(d){$r(d,"selu");for(var y=new Float32Array(d.size),E=this.readSync(d.dataId),B=0;B<E.length;++B){var Q=E[B];y[B]=Q>=0?1.0507009873554805*Q:1.7580993408473768*(Math.exp(Q)-1)}return this.makeOutput(y,d.shape,"float32")},v.prototype.clip=function(d,y,E){$r(d,"clip");for(var B=new Float32Array(d.size),Q=this.readSync(d.dataId),re=0;re<Q.length;++re){var fe=Q[re];B[re]=fe>E?E:fe<y?y:fe}return this.makeOutput(B,d.shape,"float32")},v.prototype.abs=function(d){for(var y=new Float32Array(d.size),E=this.readSync(d.dataId),B=0;B<E.length;++B)y[B]=Math.abs(E[B]);return this.makeOutput(y,d.shape,"float32")},v.prototype.complexAbs=function(d){for(var y=new Float32Array(d.size),E=this.readSync(d.dataId),B=0;B<d.size;++B){var Q=E[2*B],re=E[2*B+1];y[B]=Math.hypot(Q,re)}return this.makeOutput(y,d.shape,"float32")},v.prototype.int=function(d){$r(d,"int");for(var y=new Int32Array(d.size),E=this.readSync(d.dataId),B=0;B<E.length;++B)y[B]=E[B];return this.makeOutput(y,d.shape,"int32")},v.prototype.sigmoid=function(d){$r(d,"sigmoid");for(var y=new Float32Array(d.size),E=this.readSync(d.dataId),B=0;B<E.length;++B)y[B]=1/(1+Math.exp(-E[B]));return this.makeOutput(y,d.shape,"float32")},v.prototype.softplus=function(d){$r(d,"softplus");for(var y=Math.log(11920928955078125e-23)+2,E=new Float32Array(d.size),B=this.readSync(d.dataId),Q=0;Q<B.length;++Q){var re,fe=B[Q]>-y,xe=B[Q]<y,Oe=Math.exp(B[Q]);re=xe?Oe:fe?B[Q]:Math.log(1+Oe),E[Q]=re}return this.makeOutput(E,d.shape,"float32")},v.prototype.sin=function(d){$r(d,"sin");for(var y=new Float32Array(d.size),E=this.readSync(d.dataId),B=0;B<E.length;++B)y[B]=Math.sin(E[B]);return this.makeOutput(y,d.shape,"float32")},v.prototype.cos=function(d){$r(d,"cos");for(var y=new Float32Array(d.size),E=this.readSync(d.dataId),B=0;B<E.length;++B)y[B]=Math.cos(E[B]);return this.makeOutput(y,d.shape,"float32")},v.prototype.tan=function(d){$r(d,"tan");for(var y=new Float32Array(d.size),E=this.readSync(d.dataId),B=0;B<E.length;++B)y[B]=Math.tan(E[B]);return this.makeOutput(y,d.shape,"float32")},v.prototype.asin=function(d){$r(d,"asin");for(var y=new Float32Array(d.size),E=this.readSync(d.dataId),B=0;B<E.length;++B)y[B]=Math.asin(E[B]);return this.makeOutput(y,d.shape,"float32")},v.prototype.acos=function(d){$r(d,"acos");for(var y=new Float32Array(d.size),E=this.readSync(d.dataId),B=0;B<E.length;++B)y[B]=Math.acos(E[B]);return this.makeOutput(y,d.shape,"float32")},v.prototype.atan=function(d){$r(d,"atan");for(var y=new Float32Array(d.size),E=this.readSync(d.dataId),B=0;B<E.length;++B)y[B]=Math.atan(E[B]);return this.makeOutput(y,d.shape,"float32")},v.prototype.atan2=function(d,y){return $r([d,y],"atan2"),this.broadcastedBinaryOp(d,y,d.dtype,function(E,B){return Math.atan2(E,B)})},v.prototype.sinh=function(d){$r(d,"sinh");for(var y=new Float32Array(d.size),E=this.readSync(d.dataId),B=0;B<E.length;++B)y[B]=Math.sinh(E[B]);return this.makeOutput(y,d.shape,"float32")},v.prototype.cosh=function(d){$r(d,"cosh");for(var y=new Float32Array(d.size),E=this.readSync(d.dataId),B=0;B<E.length;++B)y[B]=Math.cosh(E[B]);return this.makeOutput(y,d.shape,"float32")},v.prototype.tanh=function(d){$r(d,"tanh");for(var y=new Float32Array(d.size),E=this.readSync(d.dataId),B=0;B<E.length;++B)y[B]=pt(E[B]);return this.makeOutput(y,d.shape,"float32")},v.prototype.asinh=function(d){$r(d,"asinh");for(var y=new Float32Array(d.size),E=this.readSync(d.dataId),B=0;B<E.length;++B)y[B]=Math.asinh(E[B]);return this.makeOutput(y,d.shape,"float32")},v.prototype.acosh=function(d){$r(d,"acosh");for(var y=new Float32Array(d.size),E=this.readSync(d.dataId),B=0;B<E.length;++B)y[B]=Math.acosh(E[B]);return this.makeOutput(y,d.shape,"float32")},v.prototype.atanh=function(d){$r(d,"atanh");for(var y=new Float32Array(d.size),E=this.readSync(d.dataId),B=0;B<E.length;++B)y[B]=Math.atanh(E[B]);return this.makeOutput(y,d.shape,"float32")},v.prototype.erf=function(d){$r(d,"erf");for(var y=new Float32Array(d.size),E=this.readSync(d.dataId),B=0;B<E.length;++B){var Q=Math.sign(E[B]),re=Math.abs(E[B]),fe=1/(1+.3275911*re);y[B]=Q*(1-((((1.061405429*fe-1.453152027)*fe+1.421413741)*fe-.284496736)*fe+.254829592)*fe*Math.exp(-re*re))}return this.makeOutput(y,d.shape,"float32")},v.prototype.step=function(d,y){y===void 0&&(y=0),$r(d,"step");for(var E=new Float32Array(d.size),B=this.readSync(d.dataId),Q=0;Q<B.length;++Q){var re=B[Q];isNaN(re)?E[Q]=NaN:E[Q]=re>0?1:y}return this.makeOutput(E,d.shape,"float32")},v.prototype.fusedConv2d=function(d){var y=d.input,E=d.filter,B=d.convInfo,Q=d.bias,re=d.activation,fe=d.preluActivationWeights,xe=this.conv2d(y,E,B);return Q&&(xe=this.add(xe,Q)),re&&(xe=$(this,xe,re,fe)),xe},v.prototype.conv2d=function(d,y,E){$r([d,y],"conv2d");for(var B=E.filterHeight,Q=E.filterWidth,re=E.dilationHeight,fe=E.dilationWidth,xe=E.padInfo.left,Oe=E.padInfo.top,Re=E.dataFormat==="channelsLast",Le=Wi(E.outShape,d.dtype),Be=d.strides[0],Xe=Re?d.strides[1]:d.strides[2],nt=Re?d.strides[2]:1,tt=Re?1:d.strides[1],ut=Le.strides[0],Dt=Re?Le.strides[1]:Le.strides[2],Rt=Re?Le.strides[2]:1,Lt=Re?1:Le.strides[1],qt=this.readSync(d.dataId),pn=this.readSync(y.dataId),bn=Le.values,mn=0;mn<E.batchSize;++mn)for(var Sn=mn*Be,On=mn*ut,b=0;b<E.outHeight;++b)for(var h=On+b*Dt,c=b*E.strideHeight-Oe,m=0;m<B;m++){var w=c+m*re;if(!(w<0||w>=E.inHeight))for(var R=m*y.strides[0],K=Sn+w*Xe,ee=0;ee<E.outWidth;++ee)for(var le=h+ee*Rt,de=ee*E.strideWidth-xe,_e=0;_e<Q;_e++){var Te=de+_e*fe;if(!(Te<0||Te>=E.inWidth))for(var Ne=K+Te*nt,Fe=R+_e*y.strides[1],He=0;He<E.inChannels;++He){for(var Ye=qt[Ne+He*tt],Ke=0;Ke<E.outChannels;++Ke)bn[le+Ke*Lt]+=Ye*pn[Fe+Ke];Fe+=E.outChannels}}}return Le.toTensor()},v.prototype.conv3d=function(d,y,E){for(var B=E.filterDepth,Q=E.filterHeight,re=E.filterWidth,fe=E.dilationDepth,xe=E.dilationHeight,Oe=E.dilationWidth,Re=E.padInfo.front,Le=E.padInfo.left,Be=E.padInfo.top,Xe=Wi(E.outShape,d.dtype),nt=this.readSync(d.dataId),tt=this.readSync(y.dataId),ut=Xe.values,Dt=0;Dt<E.batchSize;++Dt)for(var Rt=Dt*d.strides[0],Lt=Dt*Xe.strides[0],qt=0;qt<E.outDepth;++qt)for(var pn=Lt+qt*Xe.strides[1],bn=qt*E.strideDepth-Re,mn=0;mn<B;mn++){var Sn=bn+mn*fe;if(!(Sn<0||Sn>=E.inDepth))for(var On=mn*y.strides[0],b=Rt+Sn*d.strides[1],h=0;h<E.outHeight;++h)for(var c=pn+h*Xe.strides[2],m=h*E.strideHeight-Be,w=0;w<Q;w++){var R=m+w*xe;if(!(R<0||R>=E.inHeight))for(var K=On+w*y.strides[1],ee=b+R*d.strides[2],le=0;le<E.outWidth;++le)for(var de=c+le*E.outChannels,_e=le*E.strideWidth-Le,Te=0;Te<re;Te++){var Ne=_e+Te*Oe;if(!(Ne<0||Ne>=E.inWidth))for(var Fe=K+Te*y.strides[2],He=ee+Ne*E.inChannels,Ye=Fe,Ke=0;Ke<E.inChannels;++Ke){for(var it=nt[He+Ke],gt=0;gt<E.outChannels;++gt)ut[de+gt]+=it*tt[Ye+gt];Ye+=E.outChannels}}}}return Xe.toTensor()},v.prototype.conv2dDerInput=function(d,y,E){$r([d,y],"conv2dDerInput");for(var B=Wi(E.inShape,"float32"),Q=B.values,re=this.readSync(d.dataId),fe=this.readSync(y.dataId),xe=y.strides,Oe=xe[0],Re=xe[1],Le=xe[2],Be=E.batchSize,Xe=E.filterHeight,nt=E.filterWidth,tt=E.inChannels,ut=E.inHeight,Dt=E.inWidth,Rt=E.outChannels,Lt=E.outHeight,qt=E.outWidth,pn=E.strideHeight,bn=E.strideWidth,mn=E.dataFormat,Sn=Xe-1-E.padInfo.top,On=nt-1-E.padInfo.left,b=mn==="channelsLast",h=B.strides[0],c=b?B.strides[1]:B.strides[2],m=b?B.strides[2]:1,w=b?1:B.strides[1],R=d.strides[0],K=b?d.strides[1]:d.strides[2],ee=b?d.strides[2]:1,le=b?1:d.strides[1],de=0;de<Be;++de)for(var _e=0;_e<tt;++_e)for(var Te=0;Te<ut;++Te)for(var Ne=Te-Sn,Fe=Math.max(0,Math.ceil(Ne/pn)),He=Math.min(Lt,(Xe+Ne)/pn),Ye=0;Ye<Dt;++Ye){for(var Ke=Ye-On,it=Math.max(0,Math.ceil(Ke/bn)),gt=Math.min(qt,(nt+Ke)/bn),wt=0,At=Fe;At<He;++At)for(var zt=At*pn-Ne,an=it;an<gt;++an)for(var dn=R*de+K*At+ee*an,sn=Oe*(Xe-1-zt)+Re*(nt-1-(an*bn-Ke))+Le*_e,ln=0;ln<Rt;++ln)wt+=re[dn+le*ln]*fe[sn+ln];Q[h*de+c*Te+m*Ye+w*_e]=wt}return B.toTensor()},v.prototype.conv3dDerInput=function(d,y,E){for(var B=Wi(E.inShape,"float32"),Q=B.values,re=B.strides,fe=re[0],xe=re[1],Oe=re[2],Re=re[3],Le=this.readSync(d.dataId),Be=d.strides,Xe=Be[0],nt=Be[1],tt=Be[2],ut=Be[3],Dt=this.readSync(y.dataId),Rt=y.strides,Lt=Rt[0],qt=Rt[1],pn=Rt[2],bn=Rt[3],mn=E.batchSize,Sn=E.filterDepth,On=E.filterHeight,b=E.filterWidth,h=E.inChannels,c=E.inDepth,m=E.inHeight,w=E.inWidth,R=E.outChannels,K=E.outDepth,ee=E.outHeight,le=E.outWidth,de=E.strideDepth,_e=E.strideHeight,Te=E.strideWidth,Ne=Sn-1-E.padInfo.front,Fe=On-1-E.padInfo.top,He=b-1-E.padInfo.left,Ye=0;Ye<mn;++Ye)for(var Ke=0;Ke<h;++Ke)for(var it=0;it<c;++it)for(var gt=it-Ne,wt=Math.max(0,Math.ceil(gt/de)),At=Math.min(K,(Sn+gt)/de),zt=0;zt<m;++zt)for(var an=zt-Fe,dn=Math.max(0,Math.ceil(an/_e)),sn=Math.min(ee,(On+an)/_e),ln=0;ln<w;++ln){for(var Tn=ln-He,Bn=Math.max(0,Math.ceil(Tn/Te)),In=Math.min(le,(b+Tn)/Te),or=0,fr=wt;fr<At;++fr)for(var br=fr*de-gt,_r=dn;_r<sn;++_r)for(var xr=_r*_e-an,vr=Bn;vr<In;++vr)for(var Pr=Xe*Ye+nt*fr+tt*_r+ut*vr,Rr=Lt*(Sn-1-br)+qt*(On-1-xr)+pn*(b-1-(vr*Te-Tn))+bn*Ke,Qr=0;Qr<R;++Qr)or+=Le[Pr+Qr]*Dt[Rr+Qr];Q[fe*Ye+xe*it+Oe*zt+Re*ln+Ke]=or}return B.toTensor()},v.prototype.conv2dDerFilter=function(d,y,E){$r([d,y],"conv2dDerFilter");for(var B=E.strideHeight,Q=E.strideWidth,re=E.filterHeight,fe=E.filterWidth,xe=E.dataFormat==="channelsLast",Oe=Wi(E.filterShape,"float32"),Re=E.padInfo.left,Le=E.padInfo.top,Be=this.bufferSync(d),Xe=this.bufferSync(y),nt=0;nt<re;++nt)for(var tt=Math.max(0,Math.ceil((Le-nt)/B)),ut=Math.min(E.outHeight,(E.inHeight+Le-nt)/B),Dt=0;Dt<fe;++Dt)for(var Rt=Math.max(0,Math.ceil((Re-Dt)/Q)),Lt=Math.min(E.outWidth,(E.inWidth+Re-Dt)/Q),qt=0;qt<E.inChannels;++qt)for(var pn=0;pn<E.outChannels;++pn){for(var bn=0,mn=0;mn<E.batchSize;++mn)for(var Sn=tt;Sn<ut;++Sn)for(var On=nt+Sn*B-Le,b=Rt;b<Lt;++b){var h=Dt+b*Q-Re;bn+=xe?Be.get(mn,On,h,qt)*Xe.get(mn,Sn,b,pn):Be.get(mn,qt,On,h)*Xe.get(mn,pn,Sn,b)}Oe.set(bn,nt,Dt,qt,pn)}return Oe.toTensor()},v.prototype.conv3dDerFilter=function(d,y,E){for(var B=E.strideDepth,Q=E.strideHeight,re=E.strideWidth,fe=E.filterDepth,xe=E.filterHeight,Oe=E.filterWidth,Re=Wi(E.filterShape,"float32"),Le=Re.values,Be=Re.strides,Xe=Be[0],nt=Be[1],tt=Be[2],ut=Be[3],Dt=this.readSync(y.dataId),Rt=y.strides,Lt=Rt[0],qt=Rt[1],pn=Rt[2],bn=Rt[3],mn=this.readSync(d.dataId),Sn=d.strides,On=Sn[0],b=Sn[1],h=Sn[2],c=Sn[3],m=E.padInfo.front,w=E.padInfo.left,R=E.padInfo.top,K=0;K<fe;++K)for(var ee=Math.max(0,Math.ceil((m-K)/B)),le=Math.min(E.outDepth,(E.inDepth+m-K)/B),de=K*Xe,_e=0;_e<xe;++_e)for(var Te=Math.max(0,Math.ceil((R-_e)/Q)),Ne=Math.min(E.outHeight,(E.inHeight+R-_e)/Q),Fe=_e*nt+de,He=0;He<Oe;++He)for(var Ye=Math.max(0,Math.ceil((w-He)/re)),Ke=Math.min(E.outWidth,(E.inWidth+w-He)/re),it=He*tt+Fe,gt=0;gt<E.inChannels;++gt)for(var wt=gt*ut+it,At=0;At<E.outChannels;++At){for(var zt=0,an=0;an<E.batchSize;++an)for(var dn=an*On,sn=an*Lt,ln=ee;ln<le;++ln)for(var Tn=(K+ln*B-m)*b+dn,Bn=ln*qt+sn,In=Te;In<Ne;++In)for(var or=(_e+In*Q-R)*h+Tn,fr=In*pn+Bn,br=Ye;br<Ke;++br){var _r=br*bn+fr;zt+=mn[(He+br*re-w)*c+or+gt]*Dt[_r+At]}Le[wt+At]=zt}return Re.toTensor()},v.prototype.fusedDepthwiseConv2D=function(d){var y=d.input,E=d.filter,B=d.convInfo,Q=d.bias,re=d.activation,fe=d.preluActivationWeights,xe=this.depthwiseConv2D(y,E,B);return Q&&(xe=this.add(xe,Q)),re&&(xe=$(this,xe,re,fe)),xe},v.prototype.depthwiseConv2D=function(d,y,E){$r([d,y],"depthwiseConv2D");for(var B=E.filterHeight,Q=E.filterWidth,re=E.dilationHeight,fe=E.dilationWidth,xe=E.padInfo.left,Oe=E.padInfo.top,Re=E.outChannels/E.inChannels,Le=Wi(E.outShape,d.dtype),Be=this.readSync(d.dataId),Xe=this.readSync(y.dataId),nt=Le.values,tt=0;tt<E.batchSize;++tt)for(var ut=tt*d.strides[0],Dt=tt*Le.strides[0],Rt=0;Rt<E.outHeight;++Rt)for(var Lt=Dt+Rt*Le.strides[1],qt=Rt*E.strideHeight-xe,pn=0;pn<B;++pn){var bn=qt+pn*re;if(!(bn<0||bn>=E.inHeight))for(var mn=pn*y.strides[0],Sn=ut+bn*d.strides[1],On=0;On<E.outWidth;++On)for(var b=Lt+On*Le.strides[2],h=On*E.strideWidth-Oe,c=0;c<Q;++c){var m=h+c*fe;if(!(m<0||m>=E.inWidth))for(var w=mn+c*y.strides[1],R=Sn+m*E.inChannels,K=b,ee=w,le=0;le<E.inChannels;++le){for(var de=Be[R+le],_e=0;_e<Re;++_e)nt[K+_e]+=de*Xe[ee+_e];K+=Re,ee+=Re}}}return Le.toTensor()},v.prototype.depthwiseConv2DDerInput=function(d,y,E){$r([d,y],"depthwiseConv2DDerInput");for(var B=Wi(E.inShape,"float32"),Q=B.values,re=B.strides,fe=re[0],xe=re[1],Oe=re[2],Re=this.readSync(d.dataId),Le=d.strides,Be=Le[0],Xe=Le[1],nt=Le[2],tt=this.readSync(y.dataId),ut=y.strides,Dt=ut[0],Rt=ut[1],Lt=ut[2],qt=E.batchSize,pn=E.filterHeight,bn=E.filterWidth,mn=E.inChannels,Sn=E.inHeight,On=E.inWidth,b=E.outChannels,h=E.outHeight,c=E.outWidth,m=E.strideHeight,w=E.strideWidth,R=pn-1-E.padInfo.top,K=bn-1-E.padInfo.left,ee=b/mn,le=0;le<qt;++le)for(var de=0;de<mn;++de)for(var _e=0;_e<Sn;++_e)for(var Te=_e-R,Ne=Math.max(0,Math.ceil(Te/m)),Fe=Math.min(h,(pn+Te)/m),He=0;He<On;++He){for(var Ye=He-K,Ke=Math.max(0,Math.ceil(Ye/w)),it=Math.min(c,(bn+Ye)/w),gt=0,wt=Ne;wt<Fe;++wt)for(var At=wt*m-Te,zt=Ke;zt<it;++zt)for(var an=Be*le+Xe*wt+nt*zt,dn=Dt*(pn-1-At)+Rt*(bn-1-(zt*w-Ye))+Lt*de,sn=0;sn<ee;++sn)gt+=Re[an+(de*ee+sn)]*tt[dn+sn];Q[fe*le+xe*_e+Oe*He+de]=gt}return B.toTensor()},v.prototype.depthwiseConv2DDerFilter=function(d,y,E){$r([d,y],"depthwiseConv2DDerFilter");for(var B=E.strideHeight,Q=E.strideWidth,re=E.filterHeight,fe=E.filterWidth,xe=Wi(E.filterShape,"float32"),Oe=E.padInfo.left,Re=E.padInfo.top,Le=E.outChannels/E.inChannels,Be=this.bufferSync(d),Xe=this.bufferSync(y),nt=0;nt<re;++nt)for(var tt=Math.max(0,Math.ceil((Re-nt)/B)),ut=Math.min(E.outHeight,(E.inHeight+Re-nt)/B),Dt=0;Dt<fe;++Dt)for(var Rt=Math.max(0,Math.ceil((Oe-Dt)/Q)),Lt=Math.min(E.outWidth,(E.inWidth+Oe-Dt)/Q),qt=0;qt<E.outChannels;++qt){for(var pn=Math.trunc(qt/Le),bn=qt%Le,mn=0,Sn=0;Sn<E.batchSize;++Sn)for(var On=tt;On<ut;++On)for(var b=nt+On*B-Re,h=Rt;h<Lt;++h){var c=Dt+h*Q-Oe;mn+=Be.get(Sn,b,c,pn)*Xe.get(Sn,On,h,qt)}xe.set(mn,nt,Dt,pn,bn)}return xe.toTensor()},v.prototype.tile=function(d,y){return $r(d,"tile"),Ad(this.bufferSync(d),y)},v.prototype.pad=function(d,y,E){$r(d,"pad");var B=y.map(function(Le,Be){return Le[0]+d.shape[Be]+Le[1]}),Q=y.map(function(Le){return Le[0]}),re=this.bufferSync(d),fe=Wi(B,d.dtype);E!==0&&fe.values.fill(E);for(var xe=0;xe<d.size;xe++){var Oe=re.indexToLoc(xe),Re=Oe.map(function(Le,Be){return Le+Q[Be]});fe.set.apply(fe,[re.get.apply(re,Oe)].concat(Re))}return fe.toTensor()},v.prototype.transpose=function(d,y){$r(d,"transpose");for(var E=new Array(d.rank),B=0;B<E.length;B++)E[B]=d.shape[y[B]];var Q=this.readSync(d.dataId),re=Wi(E,d.dtype),fe=this.bufferSync(d);for(B=0;B<d.size;++B){for(var xe=fe.indexToLoc(B),Oe=new Array(xe.length),Re=0;Re<Oe.length;Re++)Oe[Re]=xe[y[Re]];var Le=re.locToIndex(Oe);re.values[Le]=Q[B]}return re.toTensor()},v.prototype.gather=function(d,y,E){$r([d,y],"gather");var B=d.shape.slice(),Q=this.readSync(y.dataId);B[E]=Q.length;for(var re=Wi(B,d.dtype),fe=this.bufferSync(d),xe=0;xe<re.size;++xe){var Oe=re.indexToLoc(xe),Re=Oe.slice();Re[E]=Q[Oe[E]];var Le=fe.locToIndex(Re);re.values[xe]=fe.values[Le]}return re.toTensor()},v.prototype.batchToSpaceND=function(d,y,E){$r([d],"batchToSpaceND");var B=y.reduce(function(Re,Le){return Re*Le}),Q=fc(d.shape,y,B),re=bd(Q.length,y.length),fe=xd(d.shape,y,B),xe=Ml(E,y.length),Oe=Kp(fe,E,y.length);return d.reshape(Q).transpose(re).reshape(fe).slice(xe,Oe)},v.prototype.spaceToBatchND=function(d,y,E){$r([d],"spaceToBatchND");var B=y.reduce(function(Le,Be){return Le*Be}),Q=[[0,0]];Q.push.apply(Q,E);for(var re=1+y.length;re<d.shape.length;++re)Q.push([0,0]);var fe=d.pad(Q),xe=fc(fe.shape,y,B,!1),Oe=bd(xe.length,y.length,!1),Re=xd(fe.shape,y,B,!1);return fe.reshape(xe).transpose(Oe).reshape(Re)},v.prototype.pool=function(d,y,E){$r(d,"pool");for(var B=y.strideHeight,Q=y.strideWidth,re=y.dilationHeight,fe=y.dilationWidth,xe=y.effectiveFilterHeight,Oe=y.effectiveFilterWidth,Re=y.padInfo.top,Le=y.padInfo.left,Be=E==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,Xe=this.readSync(d.dataId),nt=Wi(y.outShape,d.dtype),tt=nt.values,ut=y.outShape[1]*y.outShape[2]*y.outShape[3],Dt=y.outShape[2]*y.outShape[3],Rt=y.outShape[3],Lt=0;Lt<y.batchSize;++Lt)for(var qt=Lt*ut,pn=Lt*d.strides[0],bn=0;bn<y.inChannels;++bn)for(var mn=0;mn<y.outHeight;++mn)for(var Sn=mn*B-Re,On=Math.max(0,Sn),b=Math.min(y.inHeight,xe+Sn),h=qt+mn*Dt,c=0;c<y.outWidth;++c){for(var m=c*Q-Le,w=Math.max(0,m),R=Math.min(y.inWidth,Oe+m),K=Be,ee=0,le=0,de=On;de<b;de+=re){for(var _e=pn+de*d.strides[1],Te=w;Te<R;Te+=fe){var Ne=Xe[_e+Te*d.strides[2]+bn];E==="max"&&Ne>K?K=Ne:E==="avg"&&(ee+=Ne,le++)}if(isNaN(K))break}tt[h+c*Rt+bn]=E==="avg"?ee/le:K}return nt.toTensor()},v.prototype.maxPool=function(d,y){return this.pool(d,y,"max")},v.prototype.maxPoolPositions=function(d,y){for(var E=Wi(y.outShape,"int32"),B=y.strideHeight,Q=y.strideWidth,re=y.dilationHeight,fe=y.dilationWidth,xe=y.effectiveFilterHeight,Oe=y.effectiveFilterWidth,Re=y.padInfo.top,Le=y.padInfo.left,Be=this.bufferSync(d),Xe=0;Xe<y.batchSize;++Xe)for(var nt=0;nt<y.inChannels;++nt)for(var tt=0;tt<y.outHeight;++tt){for(var ut=tt*B-Re,Dt=ut;Dt<0;)Dt+=re;for(var Rt=Math.min(y.inHeight,xe+ut),Lt=0;Lt<y.outWidth;++Lt){for(var qt=Lt*Q-Le,pn=qt;pn<0;)pn+=fe;for(var bn=Math.min(y.inWidth,Oe+qt),mn=Number.NEGATIVE_INFINITY,Sn=-1,On=Dt;On<Rt;On+=re)for(var b=On-ut,h=pn;h<bn;h+=fe){var c=h-qt,m=Be.get(Xe,On,h,nt);m>mn&&(mn=m,Sn=b*Oe+c)}E.set(Sn,Xe,tt,Lt,nt)}}return E.toTensor()},v.prototype.maxPoolBackprop=function(d,y,E,B){$r([y,E],"maxPoolBackprop");for(var Q=this.maxPoolPositions(y,B),re=B.strideHeight,fe=B.strideWidth,xe=B.dilationHeight,Oe=B.dilationWidth,Re=B.effectiveFilterHeight,Le=B.effectiveFilterWidth,Be=Le-1-B.padInfo.left,Xe=Re-1-B.padInfo.top,nt=Wi(y.shape,"float32"),tt=this.bufferSync(Q),ut=this.bufferSync(d),Dt=0;Dt<B.batchSize;++Dt)for(var Rt=0;Rt<B.inChannels;++Rt)for(var Lt=0;Lt<B.inHeight;++Lt)for(var qt=0;qt<B.inWidth;++qt){for(var pn=Lt-Xe,bn=qt-Be,mn=0,Sn=0;Sn<Re;Sn+=xe){var On=(pn+Sn)/re;if(!(On<0||On>=B.outHeight||Math.floor(On)!==On))for(var b=0;b<Le;b+=Oe){var h=(bn+b)/fe;if(!(h<0||h>=B.outWidth||Math.floor(h)!==h)){var c=Re*Le-1-tt.get(Dt,On,h,Rt)===Sn*Le+b?1:0;c!==0&&(mn+=ut.get(Dt,On,h,Rt)*c)}}}nt.set(mn,Dt,Lt,qt,Rt)}return nt.toTensor()},v.prototype.avgPoolBackprop=function(d,y,E){$r([d,y],"avgPoolBackprop");for(var B=E.strideHeight,Q=E.strideWidth,re=E.filterHeight,fe=E.filterWidth,xe=E.dilationHeight,Oe=E.dilationWidth,Re=E.effectiveFilterHeight,Le=E.effectiveFilterWidth,Be=Le-1-E.padInfo.left,Xe=Re-1-E.padInfo.top,nt=Wi(y.shape,"float32"),tt=1/(re*fe),ut=this.bufferSync(d),Dt=0;Dt<E.batchSize;++Dt)for(var Rt=0;Rt<E.inChannels;++Rt)for(var Lt=0;Lt<E.inHeight;++Lt)for(var qt=0;qt<E.inWidth;++qt){for(var pn=Lt-Xe,bn=qt-Be,mn=0,Sn=0;Sn<Re;Sn+=xe){var On=(pn+Sn)/B;if(!(On<0||On>=E.outHeight||Math.floor(On)!==On))for(var b=0;b<Le;b+=Oe){var h=(bn+b)/Q;h<0||h>=E.outWidth||Math.floor(h)!==h||(mn+=ut.get(Dt,On,h,Rt))}}nt.set(mn*tt,Dt,Lt,qt,Rt)}return nt.toTensor()},v.prototype.pool3d=function(d,y,E){$r(d,"pool3d");for(var B=y.strideDepth,Q=y.strideHeight,re=y.strideWidth,fe=y.dilationDepth,xe=y.dilationHeight,Oe=y.dilationWidth,Re=y.effectiveFilterDepth,Le=y.effectiveFilterHeight,Be=y.effectiveFilterWidth,Xe=y.padInfo.front,nt=y.padInfo.top,tt=y.padInfo.left,ut=E==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,Dt=this.readSync(d.dataId),Rt=Wi(y.outShape,d.dtype),Lt=Rt.values,qt=y.outShape[1]*y.outShape[2]*y.outShape[3]*y.outShape[4],pn=y.outShape[2]*y.outShape[3]*y.outShape[4],bn=y.outShape[3]*y.outShape[4],mn=y.outShape[4],Sn=0;Sn<y.batchSize;++Sn)for(var On=Sn*qt,b=Sn*d.strides[0],h=0;h<y.inChannels;++h)for(var c=0;c<y.outDepth;++c){for(var m=c*B-Xe,w=m;w<0;)w+=fe;for(var R=Math.min(y.inDepth,Re+m),K=On+c*pn,ee=0;ee<y.outHeight;++ee){for(var le=ee*Q-nt,de=le;de<0;)de+=xe;for(var _e=Math.min(y.inHeight,Le+le),Te=K+ee*bn,Ne=0;Ne<y.outWidth;++Ne){for(var Fe=Ne*re-tt,He=Fe;He<0;)He+=Oe;for(var Ye=Math.min(y.inWidth,Be+Fe),Ke=Te+Ne*mn,it=ut,gt=0,wt=0,At=w;At<R;At+=fe){for(var zt=b+At*d.strides[1],an=de;an<_e;an+=xe){for(var dn=zt+an*d.strides[2],sn=He;sn<Ye;sn+=Oe){var ln=Dt[dn+sn*d.strides[3]+h];if(E==="max"&&ln>it?it=ln:E==="avg"&&(gt+=ln,wt++),isNaN(it))break}if(isNaN(it))break}if(isNaN(it))break}Lt[Ke+h]=E==="avg"?gt/wt:it}}}return Rt.toTensor()},v.prototype.avgPool3d=function(d,y){return $r(d,"avgPool3d"),this.pool3d(d,y,"avg").toFloat()},v.prototype.avgPool3dBackprop=function(d,y,E){$r([d,y],"avgPool3dBackprop");for(var B=E.strideDepth,Q=E.strideHeight,re=E.strideWidth,fe=E.filterDepth,xe=E.filterHeight,Oe=E.filterWidth,Re=E.dilationDepth,Le=E.dilationHeight,Be=E.dilationWidth,Xe=E.effectiveFilterDepth,nt=E.effectiveFilterHeight,tt=E.effectiveFilterWidth,ut=Xe-1-E.padInfo.front,Dt=tt-1-E.padInfo.left,Rt=nt-1-E.padInfo.top,Lt=Wi(y.shape,"float32"),qt=1/(fe*xe*Oe),pn=this.bufferSync(d),bn=0;bn<E.batchSize;++bn)for(var mn=0;mn<E.inChannels;++mn)for(var Sn=0;Sn<E.inDepth;++Sn)for(var On=0;On<E.inHeight;++On)for(var b=0;b<E.inWidth;++b){for(var h=Sn-ut,c=On-Rt,m=b-Dt,w=0,R=0;R<Xe;R+=Re){var K=(h+R)/B;if(!(K<0||K>=E.outDepth||Math.floor(K)!==K))for(var ee=0;ee<nt;ee+=Le){var le=(c+ee)/Q;if(!(le<0||le>=E.outHeight||Math.floor(le)!==le))for(var de=0;de<tt;de+=Be){var _e=(m+de)/re;_e<0||_e>=E.outWidth||Math.floor(_e)!==_e||(w+=pn.get(bn,K,le,_e,mn))}}}Lt.set(w*qt,bn,Sn,On,b,mn)}return Lt.toTensor()},v.prototype.maxPool3d=function(d,y){return $r(d,"maxPool3d"),this.pool3d(d,y,"max").toFloat()},v.prototype.maxPool3dPositions=function(d,y){for(var E=Wi(y.outShape,"int32"),B=y.strideDepth,Q=y.strideHeight,re=y.strideWidth,fe=y.dilationDepth,xe=y.dilationHeight,Oe=y.dilationWidth,Re=y.effectiveFilterDepth,Le=y.effectiveFilterHeight,Be=y.effectiveFilterWidth,Xe=y.padInfo.front,nt=y.padInfo.top,tt=y.padInfo.left,ut=this.bufferSync(d),Dt=0;Dt<y.batchSize;++Dt)for(var Rt=0;Rt<y.inChannels;++Rt)for(var Lt=0;Lt<y.outDepth;++Lt){for(var qt=Lt*B-Xe,pn=qt;pn<0;)pn+=fe;for(var bn=Math.min(y.inDepth,Re+qt),mn=0;mn<y.outHeight;++mn){for(var Sn=mn*Q-nt,On=Sn;On<0;)On+=xe;for(var b=Math.min(y.inHeight,Le+Sn),h=0;h<y.outWidth;++h){for(var c=h*re-tt,m=c;m<0;)m+=Oe;for(var w=Math.min(y.inWidth,Be+c),R=Number.NEGATIVE_INFINITY,K=-1,ee=pn;ee<bn;ee+=fe)for(var le=ee-qt,de=On;de<b;de+=xe)for(var _e=de-Sn,Te=m;Te<w;Te+=Oe){var Ne=Te-c,Fe=ut.get(Dt,ee,de,Te,Rt);Fe>=R&&(R=Fe,K=le*Le*Be+_e*Le+Ne)}E.set(K,Dt,Lt,mn,h,Rt)}}}return E.toTensor()},v.prototype.maxPool3dBackprop=function(d,y,E,B){$r([y,E],"maxPool3dBackprop");for(var Q=this.maxPool3dPositions(y,B),re=B.strideDepth,fe=B.strideHeight,xe=B.strideWidth,Oe=B.dilationDepth,Re=B.dilationHeight,Le=B.dilationWidth,Be=B.effectiveFilterDepth,Xe=B.effectiveFilterHeight,nt=B.effectiveFilterWidth,tt=Be-1-B.padInfo.front,ut=nt-1-B.padInfo.left,Dt=Xe-1-B.padInfo.top,Rt=Wi(y.shape,"float32"),Lt=this.bufferSync(Q),qt=this.bufferSync(d),pn=0;pn<B.batchSize;++pn)for(var bn=0;bn<B.inChannels;++bn)for(var mn=0;mn<B.inDepth;++mn)for(var Sn=0;Sn<B.inHeight;++Sn)for(var On=0;On<B.inWidth;++On){for(var b=mn-tt,h=Sn-Dt,c=On-ut,m=0,w=0;w<Be;w+=Oe){var R=(b+w)/re;if(!(R<0||R>=B.outDepth||Math.floor(R)!==R))for(var K=0;K<Xe;K+=Re){var ee=(h+K)/fe;if(!(ee<0||ee>=B.outHeight||Math.floor(ee)!==ee))for(var le=0;le<nt;le+=Le){var de=(c+le)/xe;if(!(de<0||de>=B.outWidth||Math.floor(de)!==de)){var _e=Be*Xe*nt-1-Lt.get(pn,R,ee,de,bn)===w*Xe*nt+K*nt+le?1:0;_e!==0&&(m+=qt.get(pn,R,ee,de,bn)*_e)}}}}Rt.set(m,pn,mn,Sn,On,bn)}return Rt.toTensor()},v.prototype.cast=function(d,y){return uu(d,y,this)},v.prototype.reshape=function(d,y){return Gu(d,y)},v.prototype.avgPool=function(d,y){return $r(d,"avgPool"),this.pool(d,y,"avg").toFloat()},v.prototype.resizeBilinear=function(d,y,E,B){$r(d,"resizeBilinear");for(var Q=d.shape,re=Q[0],fe=Q[1],xe=Q[2],Oe=Q[3],Re=this.readSync(d.dataId),Le=new Float32Array(ze([re,y,E,Oe])),Be=[B&&y>1?fe-1:fe,B&&E>1?xe-1:xe],Xe=[B&&y>1?y-1:y,B&&E>1?E-1:E],nt=0,tt=Be[0]/Xe[0],ut=Be[1]/Xe[1],Dt=0;Dt<re;Dt++)for(var Rt=0;Rt<y;Rt++)for(var Lt=tt*Rt,qt=Math.floor(Lt),pn=Lt-qt,bn=Math.min(fe-1,Math.ceil(Lt)),mn=Dt*d.strides[0]+qt*d.strides[1],Sn=Dt*d.strides[0]+bn*d.strides[1],On=0;On<E;On++)for(var b=ut*On,h=Math.floor(b),c=b-h,m=Math.min(xe-1,Math.ceil(b)),w=mn+h*d.strides[2],R=Sn+h*d.strides[2],K=mn+m*d.strides[2],ee=Sn+m*d.strides[2],le=0;le<Oe;le++){var de=Re[w+le],_e=Re[R+le],Te=de+(Re[K+le]-de)*c,Ne=Te+(_e+(Re[ee+le]-_e)*c-Te)*pn;Le[nt++]=Ne}return To(Le,[re,y,E,Oe])},v.prototype.resizeBilinearBackprop=function(d,y,E){$r([d,y],"resizeBilinearBackprop");for(var B=y.shape,Q=B[0],re=B[1],fe=B[2],xe=B[3],Oe=d.shape,Re=Oe[1],Le=Oe[2],Be=new Float32Array(Q*re*fe*xe),Xe=[E&&Re>1?re-1:re,E&&Le>1?fe-1:fe],nt=[E&&Re>1?Re-1:Re,E&&Le>1?Le-1:Le],tt=Xe[0]/nt[0],ut=Xe[1]/nt[1],Dt=this.readSync(d.dataId),Rt=0,Lt=0;Lt<Q;Lt++)for(var qt=Lt*y.strides[0],pn=0;pn<Re;pn++)for(var bn=pn*tt,mn=Math.floor(bn),Sn=Math.min(Math.ceil(bn),re-1),On=qt+mn*y.strides[1],b=qt+Sn*y.strides[1],h=bn-mn,c=1-h,m=0;m<Le;m++)for(var w=m*ut,R=Math.floor(w),K=Math.min(Math.ceil(w),fe-1),ee=w-R,le=1-ee,de=On+R*y.strides[2],_e=On+K*y.strides[2],Te=b+R*y.strides[2],Ne=b+K*y.strides[2],Fe=c*le,He=c*ee,Ye=h*le,Ke=h*ee,it=0;it<xe;it++){var gt=Dt[Rt++];Be[de+it]+=gt*Fe,Be[_e+it]+=gt*He,Be[Te+it]+=gt*Ye,Be[Ne+it]+=gt*Ke}return iu(Be,[Q,fe,re,xe],y.dtype)},v.prototype.resizeNearestNeighbor=function(d,y,E,B){$r(d,"resizeNearestNeighbor");for(var Q=d.shape,re=Q[0],fe=Q[1],xe=Q[2],Oe=Q[3],Re=this.readSync(d.dataId),Le=new Float32Array(re*y*E*Oe),Be=[B&&y>1?fe-1:fe,B&&E>1?xe-1:xe],Xe=[B&&y>1?y-1:y,B&&E>1?E-1:E],nt=Be[0]/Xe[0],tt=Be[1]/Xe[1],ut=0,Dt=0;Dt<re;Dt++)for(var Rt=Dt*d.strides[0],Lt=0;Lt<y;Lt++)for(var qt=nt*Lt,pn=Rt+Math.min(fe-1,B?Math.round(qt):Math.floor(qt))*d.strides[1],bn=0;bn<E;bn++)for(var mn=tt*bn,Sn=pn+Math.min(xe-1,B?Math.round(mn):Math.floor(mn))*d.strides[2],On=0;On<Oe;On++){var b=Re[Sn+On];Le[ut++]=b}return To(Le,[re,y,E,Oe],d.dtype)},v.prototype.resizeNearestNeighborBackprop=function(d,y,E){$r([d,y],"resizeNearestNeighborBackprop");for(var B=y.shape,Q=B[0],re=B[1],fe=B[2],xe=B[3],Oe=d.shape,Re=Oe[1],Le=Oe[2],Be=new Float32Array(Q*re*fe*xe),Xe=this.readSync(d.dataId),nt=[E&&Re>1?re-1:re,E&&Le>1?fe-1:fe],tt=[E&&Re>1?Re-1:Re,E&&Le>1?Le-1:Le],ut=nt[0]/tt[0],Dt=nt[1]/tt[1],Rt=1/ut,Lt=1/Dt,qt=2*Math.ceil(Rt)+2,pn=2*Math.ceil(Lt)+2,bn=0;bn<Q;bn++)for(var mn=bn*y.strides[0],Sn=0;Sn<re;Sn++)for(var On=mn+Sn*y.strides[1],b=Math.floor(Sn*Rt),h=Math.floor(b-qt/2),c=0;c<fe;c++)for(var m=On+c*y.strides[2],w=Math.floor(c*Lt),R=Math.floor(w-pn/2),K=0;K<xe;K++){for(var ee=0,le=0;le<qt;le++){var de=le+h;if(!(de<0||de>=Re)){var _e=mn+de*d.strides[1],Te=de*ut;if(Sn===Math.min(re-1,E?Math.round(Te):Math.floor(Te)))for(var Ne=0;Ne<pn;Ne++){var Fe=Ne+R;if(!(Fe<0||Fe>=Le)){var He=_e+Fe*d.strides[2],Ye=Fe*Dt;c===Math.min(fe-1,E?Math.round(Ye):Math.floor(Ye))&&(ee+=Xe[He+K])}}}}Be[m+K]=ee}return iu(Be,y.shape,y.dtype)},v.prototype.batchNormalization=function(d,y,E,B,Q,re){$r([d,y,E,Q,re],"batchNorm");for(var fe=this.readSync(d.dataId),xe=this.readSync(y.dataId),Oe=this.readSync(E.dataId),Re=Q?this.readSync(Q.dataId):new Float32Array([1]),Le=re?this.readSync(re.dataId):new Float32Array([0]),Be=new Float32Array(fe.length),Xe=Le.length,nt=Re.length,tt=Oe.length,ut=xe.length,Dt=0,Rt=0,Lt=0,qt=0,pn=0;pn<fe.length;++pn)Be[pn]=Le[Dt++]+(fe[pn]-xe[Rt++])*Re[Lt++]/Math.sqrt(Oe[qt++]+B),Dt>=Xe&&(Dt=0),Rt>=ut&&(Rt=0),Lt>=nt&&(Lt=0),qt>=tt&&(qt=0);return iu(Be,d.shape)},v.prototype.localResponseNormalization4D=function(d,y,E,B,Q){$r(d,"localResponseNormalization4D");var re=d.shape[3],fe=re-1,xe=this.readSync(d.dataId),Oe=d.size,Re=new Float32Array(Oe);function Le(tt){for(var ut=tt%re,Dt=tt-ut+Math.max(0,ut-y),Rt=tt-ut+Math.min(ut+y,fe),Lt=0;Dt<=Rt;Dt++){var qt=xe[Dt];Lt+=qt*qt}return Lt}for(var Be=0;Be<Oe;Be++){var Xe=Le(Be),nt=xe[Be]*Math.pow(E+B*Xe,-Q);Re[Be]=nt}return iu(Re,d.shape)},v.prototype.LRNGrad=function(d,y,E,B,Q,re,fe){$r(d,"LRNGrad");for(var xe=d.shape[3],Oe=this.readSync(d.dataId),Re=this.readSync(y.dataId),Le=this.readSync(E.dataId),Be=new Float32Array(d.size),Xe=d.size,nt=0;nt<Xe;nt++){for(var tt=nt%xe,ut=nt-tt+Math.max(0,tt-B),Dt=nt-tt+Math.min(xe,tt+B+1),Rt=0,Lt=ut;Lt<Dt;Lt++)Rt+=Math.pow(Re[Lt],2);for(Rt=re*Rt+Q,Lt=ut;Lt<Dt;Lt++){var qt=-2*re*fe*Re[Lt]*Le[nt]/Rt;nt===Lt&&(qt+=Math.pow(Rt,-fe)),qt*=Oe[nt],Be[Lt]+=qt}}return iu(Be,d.shape)},v.prototype.multinomial=function(d,y,E,B){$r(d,"multinomial");for(var Q=y?d:Ls(d),re=Q.shape[0],fe=Q.shape[1],xe=ao([re,E],"int32"),Oe=this.readSync(xe.dataId),Re=this.readSync(Q.dataId),Le=0;Le<re;++Le){var Be=Le*fe,Xe=new Float32Array(fe-1);Xe[0]=Re[Be];for(var nt=1;nt<Xe.length;++nt)Xe[nt]=Xe[nt-1]+Re[Be+nt];for(var tt=Al(B.toString()),ut=Le*E,Dt=0;Dt<E;++Dt){var Rt=tt();Oe[ut+Dt]=Xe.length;for(var Lt=0;Lt<Xe.length;Lt++)if(Rt<Xe[Lt]){Oe[ut+Dt]=Lt;break}}}return xe},v.prototype.oneHot=function(d,y,E,B){$r(d,"oneHot");var Q=new Float32Array(d.size*y);Q.fill(B);for(var re=this.readSync(d.dataId),fe=0;fe<d.size;++fe)re[fe]>=0&&re[fe]<y&&(Q[fe*y+re[fe]]=E);return xu(Q,[d.size,y],"int32")},v.prototype.nonMaxSuppression=function(d,y,E,B,Q){return $r(d,"nonMaxSuppression"),$u(this.readSync(d.dataId),this.readSync(y.dataId),E,B,Q)},v.prototype.fft=function(d){return this.fftBatch(d,!1)},v.prototype.ifft=function(d){return this.fftBatch(d,!0)},v.prototype.fftBatch=function(d,y){for(var E=d.shape[0],B=d.shape[1],Q=Wi(d.shape,"float32"),re=Wi(d.shape,"float32"),fe=va(d).as2D(E,B),xe=Ya(d).as2D(E,B),Oe=0;Oe<E;Oe++)for(var Re=fe.slice([Oe,0],[1,B]),Le=xe.slice([Oe,0],[1,B]),Be=_o(Re,Le),Xe=this.readSync(this.fftImpl(Be,y).dataId),nt=0;nt<B;nt++){var tt=Nl(Xe,nt);Q.values[Oe*B+nt]=tt.real,re.values[Oe*B+nt]=tt.imag}return _o(Q.toTensor(),re.toTensor()).as2D(E,B)},v.prototype.fftImpl=function(d,y){var E=d.as1D(),B=E.size;if(this.isExponentOf2(B)){var Q=this.fftRadix2(E,B,y).as2D(d.shape[0],d.shape[1]);return y&&(Q=_o(va(Q).div(kr(B)),Ya(Q).div(kr(B)))),Q}var re=this.readSync(d.dataId),fe=function(xe){for(var Oe=new Float32Array(xe.length/2),Re=new Float32Array(xe.length/2),Le=0;Le<xe.length;Le+=2)Oe[Le/2]=xe[Le],Re[Le/2]=xe[Le+1];return{real:Oe,imag:Re}}(this.fourierTransformByMatmul(re,B,y));return _o(fe.real,fe.imag).as2D(d.shape[0],d.shape[1])},v.prototype.isExponentOf2=function(d){return(d&d-1)==0},v.prototype.fftRadix2=function(d,y,E){if(y===1)return d;var B=this.readSync(d.dataId),Q=y/2,re=function(ut){for(var Dt=Math.ceil(ut.length/4),Rt=new Float32Array(Dt),Lt=new Float32Array(Dt),qt=0;qt<ut.length;qt+=4)Rt[Math.floor(qt/4)]=ut[qt],Lt[Math.floor(qt/4)]=ut[qt+1];return{real:Rt,imag:Lt}}(B),fe=_o(re.real,re.imag).as1D(),xe=function(ut){for(var Dt=Math.floor(ut.length/4),Rt=new Float32Array(Dt),Lt=new Float32Array(Dt),qt=2;qt<ut.length;qt+=4)Rt[Math.floor(qt/4)]=ut[qt],Lt[Math.floor(qt/4)]=ut[qt+1];return{real:Rt,imag:Lt}}(B),Oe=_o(xe.real,xe.imag).as1D();fe=this.fftRadix2(fe,Q,E),Oe=this.fftRadix2(Oe,Q,E);var Re=function(ut,Dt){for(var Rt=new Float32Array(ut/2),Lt=new Float32Array(ut/2),qt=0;qt<Math.ceil(ut/2);qt++){var pn=(Dt?2:-2)*Math.PI*(qt/ut);Rt[qt]=Math.cos(pn),Lt[qt]=Math.sin(pn)}return{real:Rt,imag:Lt}}(y,E),Le=_o(Re.real,Re.imag).mul(Oe),Be=fe.add(Le),Xe=fe.sub(Le),nt=va(Be).concat(va(Xe)),tt=Ya(Be).concat(Ya(Xe));return _o(nt,tt).as1D()},v.prototype.fourierTransformByMatmul=function(d,y,E){for(var B=new Float32Array(2*y),Q=0;Q<y;Q++){for(var re=0,fe=0,xe=0;xe<y;xe++){var Oe=jh(Q*xe,y,E),Re=Nl(d,xe);re+=Re.real*Oe.real-Re.imag*Oe.imag,fe+=Re.real*Oe.imag+Re.imag*Oe.real}E&&(re/=y,fe/=y),Il(B,re,fe,Q)}return B},v.prototype.depthToSpace=function(d,y,E){we(E==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+E}),we(y>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+y});for(var B=d.shape[0],Q=d.shape[1],re=d.shape[2],fe=d.shape[3],xe=Q*y,Oe=re*y,Re=fe/(y*y),Le=this.readSync(d.dataId),Be=new Float32Array(B*xe*Oe*Re),Xe=0,nt=0;nt<B;++nt)for(var tt=0;tt<xe;++tt)for(var ut=Math.floor(tt/y),Dt=tt%y,Rt=0;Rt<Oe;++Rt)for(var Lt=Math.floor(Rt/y),qt=(Dt*y+Rt%y)*Re,pn=0;pn<Re;++pn){var bn=pn+qt+fe*(Lt+re*(ut+Q*nt));Be[Xe++]=Le[bn]}return iu(Be,[B,xe,Oe,Re])},v.prototype.broadcastedBinaryOp=function(d,y,E,B){var Q=no(d.shape,y.shape),re=Wi(Q,E),fe=this.readSync(d.dataId),xe=this.readSync(y.dataId),Oe=ts(d.shape,Q),Re=ts(y.shape,Q),Le=re.values;if(Oe.length+Re.length===0)for(var Be=0;Be<Le.length;++Be)Le[Be]=B(fe[Be%fe.length],xe[Be%xe.length]);else{var Xe=this.bufferSync(d),nt=this.bufferSync(y),tt=function(ut){var Dt=re.indexToLoc(ut),Rt=Dt.slice(-d.rank);Oe.forEach(function(bn){return Rt[bn]=0});var Lt=Xe.locToIndex(Rt),qt=Dt.slice(-y.rank);Re.forEach(function(bn){return qt[bn]=0});var pn=nt.locToIndex(qt);Le[ut]=B(fe[Lt],xe[pn])};for(Be=0;Be<Le.length;++Be)tt(Be)}return re.toTensor()},v.prototype.broadcastedBinaryComplexOp=function(d,y,E){var B=no(d.shape,y.shape),Q=Wi(B,"float32"),re=Wi(B,"float32"),fe=this.readSync(d.dataId),xe=this.readSync(y.dataId),Oe=ts(d.shape,B),Re=ts(y.shape,B),Le=Q.values,Be=re.values;if(Oe.length+Re.length===0)for(var Xe=0;Xe<Le.length;Xe++){var nt=Xe%fe.length,tt=Xe%xe.length,ut=E(fe[2*nt],fe[2*nt+1],xe[2*tt],xe[2*tt+1]);Le[Xe]=ut.real,Be[Xe]=ut.imag}else{var Dt=this.bufferSync(this.data.get(d.dataId).complexTensors.real),Rt=this.bufferSync(this.data.get(y.dataId).complexTensors.real),Lt=function(qt){var pn=Q.indexToLoc(qt),bn=pn.slice(-d.rank);Oe.forEach(function(h){return bn[h]=0});var mn=Dt.locToIndex(bn),Sn=pn.slice(-y.rank);Re.forEach(function(h){return Sn[h]=0});var On=Rt.locToIndex(Sn),b=E(fe[2*mn],fe[2*mn+1],xe[2*On],xe[2*On+1]);Le[qt]=b.real,Be[qt]=b.imag};for(Xe=0;Xe<Le.length;Xe++)Lt(Xe)}return this.complex(Q.toTensor(),re.toTensor())},v.prototype.split=function(d,y,E){return Ef(d,y,E)},v.prototype.dispose=function(){},v.prototype.floatPrecision=function(){return 32},v.prototype.epsilon=function(){return 1e-7},v.prototype.cropAndResize=function(d,y,E,B,Q,re){for(var fe=d.shape,xe=fe[0],Oe=fe[1],Re=fe[2],Le=fe[3],Be=y.shape[0],Xe=B[0],nt=B[1],tt=Wi([Be,Xe,nt,Le],"float32"),ut=this.readSync(y.dataId),Dt=this.readSync(E.dataId),Rt=this.readSync(d.dataId),Lt=d.strides,qt=tt.strides,pn=0;pn<Be;pn++){var bn=4*pn,mn=ut[bn],Sn=ut[bn+1],On=ut[bn+2],b=ut[bn+3],h=Dt[pn];if(!(h>=xe))for(var c=Xe>1?(On-mn)*(Oe-1)/(Xe-1):0,m=nt>1?(b-Sn)*(Re-1)/(nt-1):0,w=0;w<Xe;w++){var R=Xe>1?mn*(Oe-1)+w*c:.5*(mn+On)*(Oe-1);if(R<0||R>Oe-1)for(var K=0;K<nt;K++)for(var ee=0;ee<Le;ee++){var le=ee+K*qt[2]+w*qt[1]+pn*qt[0];tt.values[le]=re}else if(Q==="bilinear"){var de=Math.floor(R),_e=Math.ceil(R),Te=R-de;for(K=0;K<nt;K++)if((At=nt>1?Sn*(Re-1)+K*m:.5*(Sn+b)*(Re-1))<0||At>Re-1)for(ee=0;ee<Le;ee++)le=ee+K*qt[2]+w*qt[1]+pn*qt[0],tt.values[le]=re;else{var Ne=Math.floor(At),Fe=Math.ceil(At),He=At-Ne;for(ee=0;ee<Le;ee++){var Ye=Rt[le=ee+Ne*Lt[2]+de*Lt[1]+h*Lt[0]],Ke=Rt[le=ee+Fe*Lt[2]+de*Lt[1]+h*Lt[0]],it=Rt[le=ee+Ne*Lt[2]+_e*Lt[1]+h*Lt[0]],gt=Ye+(Ke-Ye)*He,wt=it+(Rt[le=ee+Fe*Lt[2]+_e*Lt[1]+h*Lt[0]]-it)*He;le=ee+K*qt[2]+w*qt[1]+pn*qt[0],tt.values[le]=gt+(wt-gt)*Te}}}else for(K=0;K<nt;++K){var At;if((At=nt>1?Sn*(Re-1)+K*m:.5*(Sn+b)*(Re-1))<0||At>Re-1)for(ee=0;ee<Le;ee++)le=ee+K*qt[2]+w*qt[1]+pn*qt[0],tt.values[le]=re;else{var zt=Math.round(At),an=Math.round(R);for(ee=0;ee<Le;ee++){var dn=ee+zt*Lt[2]+an*Lt[1]+h*Lt[0],sn=ee+K*qt[2]+w*qt[1]+pn*qt[0];tt.values[sn]=Rt[dn]}}}}}return tt.toTensor()},v.prototype.sparseToDense=function(d,y,E,B){var Q=Dl(0,d,E),re=Q.sliceRank,fe=Q.numUpdates,xe=Q.sliceSize,Oe=Q.strides,Re=Q.outputSize;return this.scatter(d,y,E,Re,xe,fe,re,Oe,B,!1)},v.prototype.gatherND=function(d,y){var E=y.shape,B=E[E.length-1],Q=dc(d,y),re=Q[0],fe=Q[1],xe=Q[2],Oe=Q[3];if(fe===0)return To([],re,d.dtype);for(var Re=new Hr([fe,xe],d.dtype),Le=this.readSync(y.dataId),Be=this.readSync(d.dataId),Xe=0;Xe<fe;Xe++){for(var nt=[],tt=0,ut=0;ut<B;ut++){var Dt=Le[Xe*B+ut];tt+=Dt*Oe[ut],nt.push(Dt)}if(tt<0||tt>=d.size/xe)throw new Error("Invalid indices: "+nt+" does not index into "+d.shape);for(var Rt=0;Rt<xe;Rt++)Re.values[Xe*xe+Rt]=Be[tt*xe+Rt]}return Re.toTensor().reshape(re)},v.prototype.scatterND=function(d,y,E){var B=Dl(0,d,E),Q=B.sliceRank,re=B.numUpdates,fe=B.sliceSize,xe=B.strides,Oe=B.outputSize,Re=kr(0);return this.scatter(d,y,E,Oe,fe,re,Q,xe,Re,!0)},v.prototype.fill=function(d,y,E){var B=cn(E=E||ke(y),ze(d));return B.fill(y),Ve.makeTensor(B,d,E,this)},v.prototype.onesLike=function(d){if(d.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(d.shape,1,d.dtype)},v.prototype.zerosLike=function(d){var y=cn(d.dtype,ze(d.shape));return this.makeOutput(y,d.shape,d.dtype)},v.prototype.linspace=function(d,y,E){return pc(d,y,E)},v.prototype.scatter=function(d,y,E,B,Q,re,fe,xe,Oe,Re){var Le=[B/Q,Q],Be=this.readSync(d.dataId),Xe=this.readSync(y.dataId);if(B===0)return To([],E,y.dtype);var nt=new Hr(Le,y.dtype);nt.values.fill(this.readSync(Oe.dataId)[0]);for(var tt=0;tt<re;tt++){for(var ut=[],Dt=0,Rt=0;Rt<fe;Rt++){var Lt=Be[tt*fe+Rt];ut.push(Lt),Dt+=Lt*xe[Rt]}if(Dt<0||Dt>=B/Q)throw new Error("Invalid indices: "+ut+" does not index into "+E);for(var qt=0;qt<Q;qt++)Re?nt.values[Dt*Q+qt]+=Xe[tt*Q+qt]:nt.values[Dt*Q+qt]=y.rank===0?Xe[0]:Xe[tt*Q+qt]}return nt.toTensor().reshape(E)},v}(Sd);Ve.registerBackend("cpu",function(){return new M},1);for(var T=0,A=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(_){var v=_.inputs,d=_.backend,y=_.attrs,E=v,B=E.boxes,Q=E.scores,re=y,fe=re.maxOutputSize,xe=re.iouThreshold,Oe=re.scoreThreshold,Re=re.softNmsSigma,Le=d;$r(B,"NonMaxSuppressionWithScore");var Be=Xu(Le.data.get(B.dataId).values,Le.data.get(Q.dataId).values,fe,xe,Oe,Re);return[Be.selectedIndices,Be.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(_){var v=_.inputs,d=_.backend,y=v.x,E=d;$r(y,"square");for(var B=E.data.get(y.dataId).values,Q=new Float32Array(B.length),re=0;re<B.length;++re){var fe=B[re];Q[re]=fe*fe}return{dataId:E.write(Q,y.shape,y.dtype),shape:y.shape,dtype:y.dtype}}},{kernelName:Uh,backendName:"cpu",kernelFunc:function(_){var v=_.inputs,d=_.backend,y=v,E=y.a,B=y.b,Q=d;$r([E,B],Uh);var re=Q.data.get(E.dataId).values,fe=Q.data.get(B.dataId).values,xe=function(Le,Be,Xe,nt,tt,ut){var Dt=no(Le,Be),Rt=Dt.length,Lt=rn(Dt),qt=Rn(tt,ze(Dt)),pn=Le.length,bn=Be.length,mn=rn(Le),Sn=rn(Be),On=ts(Le,Dt),b=ts(Be,Dt);if(On.length+b.length===0)for(var h=0;h<qt.length;++h)qt[h]=ut(Xe[h%Xe.length],nt[h%nt.length]);else{var c=function(m){var w=sr(m,Rt,Lt),R=w.slice(-pn);On.forEach(function(de){return R[de]=0});var K=ur(R,pn,mn),ee=w.slice(-bn);b.forEach(function(de){return ee[de]=0});var le=ur(ee,bn,Sn);qt[m]=ut(Xe[K],nt[le])};for(h=0;h<qt.length;++h)c(h)}return[qt,Dt]}(E.shape,B.shape,re,fe,E.dtype,function(Le,Be){var Xe=Le-Be;return Xe*Xe}),Oe=xe[0],Re=xe[1];return{dataId:Q.write(Oe,Re,E.dtype),shape:Re,dtype:E.dtype}}}];T<A.length;T++)ce(A[T]);for(var P,J=0,ie=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(_){var v=_.inputs,d=_.backend,y=_.attrs,E=v.pixels,B=y.numChannels,Q=typeof HTMLVideoElement<"u"&&E instanceof HTMLVideoElement,re=typeof HTMLImageElement<"u"&&E instanceof HTMLImageElement,fe=Q?[E.videoWidth,E.videoHeight]:[E.width,E.height],xe=fe[0],Oe=fe[1],Re=[Oe,xe],Le=[Oe,xe,B];(re||Q)&&(P==null&&(P=document.createElement("canvas").getContext("2d")),P.canvas.width=xe,P.canvas.height=Oe,P.drawImage(E,0,0,xe,Oe),E=P.canvas);var Be=d.makeTensorInfo(Re,"int32");d.texData.get(Be.dataId).usage=cr.PIXELS,d.gpgpu.uploadPixelDataToTexture(d.getTexture(Be.dataId),E);var Xe=z().getBool("WEBGL_PACK")?new function(tt){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var ut=ue(),Dt=tt[0],Rt=tt[1];this.outputShape=tt,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+Rt+".0, "+Dt+`.0);
            vec4 values = `+ut.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+ut.output+` = result;
      }
    `}(Le):new function(tt){this.variableNames=["A"];var ut=ue(),Dt=tt[0],Rt=tt[1];this.outputShape=tt,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+Rt+".0, "+Dt+`.0);

        vec4 values = `+ut.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}(Le),nt=d.runWebGLProgram(Xe,[Be],"int32");return d.disposeData(Be.dataId),nt}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(_){var v=_.inputs,d=_.backend,y=_.attrs;kl("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var E=v,B=E.boxes,Q=E.scores,re=y,fe=re.maxOutputSize,xe=re.iouThreshold,Oe=re.scoreThreshold,Re=re.softNmsSigma,Le=d,Be=Xu(Le.readSync(B.dataId),Le.readSync(Q.dataId),fe,xe,Oe,Re);return[Be.selectedIndices,Be.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(_){var v=_.inputs,d=_.backend,y=v.x,E=d,B=new wi(y.shape,"return x * x;");return E.runWebGLProgram(B,[y],y.dtype)}},{kernelName:Uh,backendName:"webgl",kernelFunc:function(_){var v=_.inputs,d=_.backend,y=v,E=y.a,B=y.b,Q=d,re=z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _i("return (a - b) * (a - b);",E.shape,B.shape):new ni("return (a - b) * (a - b);",E.shape,B.shape);return Q.compileAndRun(re,[E,B])}}];J<ie.length;J++)ce(ie[J]);for(var pe=0,Ae=[{kernelName:"Square",gradFunc:function(_,v){var d=v[0];return{x:function(){return _.mul(d.toFloat().mul(2))}}}},{kernelName:Uh,gradFunc:function(_,v){var d=v[0],y=v[1],E=kr(2);return{a:function(){return Ul(_,Ul(E,cl(d,y)))},b:function(){return Ul(_,Ul(E,cl(y,d)))}}}}];pe<Ae.length;pe++)be(Ae[pe]);var Ie=function(){function _(){}return _.prototype.fetch=function(v,d){return fetch(v,d)},_.prototype.now=function(){return performance.now()},_.prototype.encode=function(v,d){if(d!=="utf-8"&&d!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+d);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(v)},_.prototype.decode=function(v,d){return new TextDecoder(d).decode(v)},_}();z().get("IS_BROWSER")&&z().setPlatform("browser",new Ie);var De,et=function(){function _(){this.util=r(249),this.textEncoder=new this.util.TextEncoder}return _.prototype.fetch=function(v,d){return z().global.fetch!=null?z().global.fetch(v,d):(De==null&&(De=r(250)),De(v,d))},_.prototype.now=function(){var v=C.hrtime();return 1e3*v[0]+v[1]/1e6},_.prototype.encode=function(v,d){if(d!=="utf-8"&&d!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+d);return this.textEncoder.encode(v)},_.prototype.decode=function(v,d){return v.length===0?"":new this.util.TextDecoder(d).decode(v)},_}();z().get("IS_NODE")&&z().setPlatform("node",new et);var ot={float32:4,int32:4,uint16:2,uint8:1,bool:1},Bt=4;function Vt(_,v){for(var d={},y=0,E=function(re){var fe=re.name,xe=re.dtype,Oe=re.shape,Re=ze(Oe),Le=void 0;if("quantization"in re){var Be=re.quantization;if(Be.dtype!=="uint8"&&Be.dtype!=="uint16")throw new Error("Weight "+re.name+" has unknown quantization dtype "+Be.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var Xe=ot[Be.dtype],nt=_.slice(y,y+Re*Xe),tt=Be.dtype==="uint8"?new Uint8Array(nt):new Uint16Array(nt);if(xe==="float32")Le=Float32Array.from(tt,function(pn){return pn*Be.scale+Be.min});else{if(xe!=="int32")throw new Error("Unsupported dtype in weight '"+fe+"': "+xe);Le=Int32Array.from(tt,function(pn){return Math.round(pn*Be.scale+Be.min)})}y+=Re*Xe}else if(xe==="string"){var ut=ze(re.shape);Le=[];for(var Dt=0;Dt<ut;Dt++){var Rt=new Uint32Array(_.slice(y,y+Bt))[0];y+=Bt;var Lt=new Uint8Array(_.slice(y,y+Rt));Le.push(Lt),y+=Rt}}else{var qt=ot[xe];if(nt=_.slice(y,y+Re*qt),xe==="float32")Le=new Float32Array(nt);else if(xe==="int32")Le=new Int32Array(nt);else{if(xe!=="bool")throw new Error("Unsupported dtype in weight '"+fe+"': "+xe);Le=new Uint8Array(nt)}y+=Re*qt}d[fe]=To(Le,Oe,xe)},B=0,Q=v;B<Q.length;B++)E(Q[B]);return d}var yn=S!==void 0&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function _n(_){return yn?S.byteLength(_):new Blob([_]).size}function Dn(_){var v=0;_.forEach(function(E){v+=E.byteLength});var d=new Uint8Array(v),y=0;return _.forEach(function(E){d.set(new Uint8Array(E),y),y+=E.byteLength}),d.buffer}function Nn(_){for(_=_.trim();_.endsWith("/");)_=_.slice(0,_.length-1);var v=_.split("/");return v[v.length-1]}function Wn(_){if(_.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:_.modelTopology==null?0:_n(JSON.stringify(_.modelTopology)),weightSpecsBytes:_.weightSpecs==null?0:_n(JSON.stringify(_.weightSpecs)),weightDataBytes:_.weightData==null?0:_.weightData.byteLength}}var Jn=function(){function _(){this.saveRouters=[],this.loadRouters=[]}return _.getInstance=function(){return _.instance==null&&(_.instance=new _),_.instance},_.registerSaveRouter=function(v){_.getInstance().saveRouters.push(v)},_.registerLoadRouter=function(v){_.getInstance().loadRouters.push(v)},_.getSaveHandlers=function(v){return _.getHandlers(v,"save")},_.getLoadHandlers=function(v,d){return _.getHandlers(v,"load",d)},_.getHandlers=function(v,d,y){var E=[];return(d==="load"?_.getInstance().loadRouters:_.getInstance().saveRouters).forEach(function(B){var Q=B(v,y);Q!==null&&E.push(Q)}),E},_}(),Cn="://",wr=function(){function _(){this.managers={}}return _.getInstance=function(){return _.instance==null&&(_.instance=new _),_.instance},_.registerManager=function(v,d){we(v!=null,function(){return"scheme must not be undefined or null."}),v.endsWith(Cn)&&(v=v.slice(0,v.indexOf(Cn))),we(v.length>0,function(){return"scheme must not be an empty string."});var y=_.getInstance();we(y.managers[v]==null,function(){return"A model store manager is already registered for scheme '"+v+"'."}),y.managers[v]=d},_.getManager=function(v){var d=this.getInstance().managers[v];if(d==null)throw new Error("Cannot find model manager for scheme '"+v+"'");return d},_.getSchemes=function(){return Object.keys(this.getInstance().managers)},_}();function Dr(_){if(_.indexOf(Cn)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+wr.getSchemes().join(","));return{scheme:_.split(Cn)[0],path:_.split(Cn)[1]}}function Nr(_,v,d){return d===void 0&&(d=!1),N(this,void 0,void 0,function(){var y,E,B,Q,re,fe,xe,Oe,Re;return L(this,function(Le){switch(Le.label){case 0:return we(_!==v,function(){return"Old path and new path are the same: '"+_+"'"}),we((y=Jn.getLoadHandlers(_)).length>0,function(){return"Copying failed because no load handler is found for source URL "+_+"."}),we(y.length<2,function(){return"Copying failed because more than one ("+y.length+") load handlers for source URL "+_+"."}),E=y[0],we((B=Jn.getSaveHandlers(v)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+v+"."}),we(B.length<2,function(){return"Copying failed because more than one ("+y.length+") save handlers for destination URL "+v+"."}),Q=B[0],re=Dr(_).scheme,fe=Dr(_).path,xe=re===Dr(_).scheme,[4,E.load()];case 1:return Oe=Le.sent(),d&&xe?[4,wr.getManager(re).removeModel(fe)]:[3,3];case 2:Le.sent(),Le.label=3;case 3:return[4,Q.save(Oe)];case 4:return Re=Le.sent(),!d||xe?[3,6]:[4,wr.getManager(re).removeModel(fe)];case 5:Le.sent(),Le.label=6;case 6:return[2,Re.modelArtifactsInfo]}})})}var Yr="models_store",jr="model_info_store";function Si(){if(!z().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var _=window||self,v=_.indexedDB||_.mozIndexedDB||_.webkitIndexedDB||_.msIndexedDB||_.shimIndexedDB;if(v==null)throw new Error("The current browser does not appear to support IndexedDB.");return v}function Fi(_){var v=_.result;v.createObjectStore(Yr,{keyPath:"modelPath"}),v.createObjectStore(jr,{keyPath:"modelPath"})}var Ni=function(){function _(v){if(this.indexedDB=Si(),v==null||!v)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=v}return _.prototype.save=function(v){return N(this,void 0,void 0,function(){return L(this,function(d){if(v.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,v)]})})},_.prototype.load=function(){return N(this,void 0,void 0,function(){return L(this,function(v){return[2,this.databaseAction(this.modelPath)]})})},_.prototype.databaseAction=function(v,d){var y=this;return new Promise(function(E,B){var Q=y.indexedDB.open("tensorflowjs",1);Q.onupgradeneeded=function(){return Fi(Q)},Q.onsuccess=function(){var re=Q.result;if(d==null){var fe=re.transaction(Yr,"readonly"),xe=fe.objectStore(Yr).get(y.modelPath);xe.onsuccess=function(){if(xe.result==null)return re.close(),B(new Error("Cannot find model with path '"+y.modelPath+"' in IndexedDB."));E(xe.result.modelArtifacts)},xe.onerror=function(nt){return re.close(),B(xe.error)},fe.oncomplete=function(){return re.close()}}else{var Oe,Re=Wn(d),Le=re.transaction(jr,"readwrite"),Be=Le.objectStore(jr),Xe=Be.put({modelPath:y.modelPath,modelArtifactsInfo:Re});Xe.onsuccess=function(){var nt=(Oe=re.transaction(Yr,"readwrite")).objectStore(Yr).put({modelPath:y.modelPath,modelArtifacts:d,modelArtifactsInfo:Re});nt.onsuccess=function(){return E({modelArtifactsInfo:Re})},nt.onerror=function(tt){var ut=(Be=Le.objectStore(jr)).delete(y.modelPath);ut.onsuccess=function(){return re.close(),B(nt.error)},ut.onerror=function(Dt){return re.close(),B(nt.error)}}},Xe.onerror=function(nt){return re.close(),B(Xe.error)},Le.oncomplete=function(){Oe==null?re.close():Oe.oncomplete=function(){return re.close()}}}},Q.onerror=function(re){return B(Q.error)}})},_.URL_SCHEME="indexeddb://",_}(),Ao=function(_){return z().getBool("IS_BROWSER")&&!Array.isArray(_)&&_.startsWith(Ni.URL_SCHEME)?(v=_.slice(Ni.URL_SCHEME.length),new Ni(v)):null;var v};Jn.registerSaveRouter(Ao),Jn.registerLoadRouter(Ao);var Xo=function(){function _(){this.indexedDB=Si()}return _.prototype.listModels=function(){return N(this,void 0,void 0,function(){var v=this;return L(this,function(d){return[2,new Promise(function(y,E){var B=v.indexedDB.open("tensorflowjs",1);B.onupgradeneeded=function(){return Fi(B)},B.onsuccess=function(){var Q=B.result,re=Q.transaction(jr,"readonly"),fe=re.objectStore(jr).getAll();fe.onsuccess=function(){for(var xe={},Oe=0,Re=fe.result;Oe<Re.length;Oe++){var Le=Re[Oe];xe[Le.modelPath]=Le.modelArtifactsInfo}y(xe)},fe.onerror=function(xe){return Q.close(),E(fe.error)},re.oncomplete=function(){return Q.close()}},B.onerror=function(Q){return E(B.error)}})]})})},_.prototype.removeModel=function(v){return N(this,void 0,void 0,function(){var d=this;return L(this,function(y){var E;return v=(E=v).startsWith(Ni.URL_SCHEME)?E.slice(Ni.URL_SCHEME.length):E,[2,new Promise(function(B,Q){var re=d.indexedDB.open("tensorflowjs",1);re.onupgradeneeded=function(){return Fi(re)},re.onsuccess=function(){var fe,xe=re.result,Oe=xe.transaction(jr,"readwrite"),Re=Oe.objectStore(jr),Le=Re.get(v);Le.onsuccess=function(){if(Le.result==null)return xe.close(),Q(new Error("Cannot find model with path '"+v+"' in IndexedDB."));var Be=Re.delete(v),Xe=function(){var nt=(fe=xe.transaction(Yr,"readwrite")).objectStore(Yr).delete(v);nt.onsuccess=function(){return B(Le.result.modelArtifactsInfo)},nt.onerror=function(tt){return Q(Le.error)}};Be.onsuccess=Xe,Be.onerror=function(nt){return Xe(),xe.close(),Q(Le.error)}},Le.onerror=function(Be){return xe.close(),Q(Le.error)},Oe.oncomplete=function(){fe==null?xe.close():fe.oncomplete=function(){return xe.close()}}},re.onerror=function(fe){return Q(re.error)}})]})})},_}();if(z().getBool("IS_BROWSER"))try{wr.registerManager(Ni.URL_SCHEME,new Xo)}catch{}var Po="/",Ro="tensorflowjs_models",Uo="info",sa="model_topology",pa="weight_specs",Da="weight_data",du="model_metadata";function Ri(_){return{info:[Ro,_,Uo].join(Po),topology:[Ro,_,sa].join(Po),weightSpecs:[Ro,_,pa].join(Po),weightData:[Ro,_,Da].join(Po),modelMetadata:[Ro,_,du].join(Po)}}function Qa(_){var v=_.split(Po);if(v.length<3)throw new Error("Invalid key format: "+_);return v.slice(1,v.length-1).join(Po)}var is=function(){function _(v){if(!z().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,v==null||!v)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=v,this.keys=Ri(this.modelPath)}return _.prototype.save=function(v){return N(this,void 0,void 0,function(){var d,y,E;return L(this,function(B){if(v.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");d=JSON.stringify(v.modelTopology),y=JSON.stringify(v.weightSpecs),E=Wn(v);try{return this.LS.setItem(this.keys.info,JSON.stringify(E)),this.LS.setItem(this.keys.topology,d),this.LS.setItem(this.keys.weightSpecs,y),this.LS.setItem(this.keys.weightData,function(Q){if(yn)return S.from(Q).toString("base64");for(var re=new Uint8Array(Q),fe="",xe=0,Oe=re.length;xe<Oe;xe++)fe+=String.fromCharCode(re[xe]);return btoa(fe)}(v.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:v.format,generatedBy:v.generatedBy,convertedBy:v.convertedBy,userDefinedMetadata:v.userDefinedMetadata})),[2,{modelArtifactsInfo:E}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+E.modelTopologyBytes+", weightSpecsBytes="+E.weightSpecsBytes+", weightDataBytes="+E.weightDataBytes+".")}return[2]})})},_.prototype.load=function(){return N(this,void 0,void 0,function(){var v,d,y,E,B,Q,re;return L(this,function(fe){if((v=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(v.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(d={},(y=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(d.modelTopology=y,(E=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(d.weightSpecs=E,(B=this.LS.getItem(this.keys.modelMetadata))!=null&&(Q=JSON.parse(B),d.format=Q.format,d.generatedBy=Q.generatedBy,d.convertedBy=Q.convertedBy,d.userDefinedMetadata=Q.userDefinedMetadata),(re=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return d.weightData=function(xe){if(yn){var Oe=S.from(xe,"base64");return Oe.buffer.slice(Oe.byteOffset,Oe.byteOffset+Oe.byteLength)}for(var Re=atob(xe),Le=new Uint8Array(Re.length),Be=0;Be<Re.length;++Be)Le.set([Re.charCodeAt(Be)],Be);return Le.buffer}(re),[2,d]})})},_.URL_SCHEME="localstorage://",_}(),hu=function(_){return z().getBool("IS_BROWSER")&&!Array.isArray(_)&&_.startsWith(is.URL_SCHEME)?(v=_.slice(is.URL_SCHEME.length),new is(v)):null;var v};Jn.registerSaveRouter(hu),Jn.registerLoadRouter(hu);var zs=function(){function _(){we(z().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),we(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return _.prototype.listModels=function(){return N(this,void 0,void 0,function(){var v,d,y,E,B,Q;return L(this,function(re){for(v={},d=Ro+Po,y=Po+Uo,E=0;E<this.LS.length;++E)(B=this.LS.key(E)).startsWith(d)&&B.endsWith(y)&&(Q=Qa(B),v[Q]=JSON.parse(this.LS.getItem(B)));return[2,v]})})},_.prototype.removeModel=function(v){return N(this,void 0,void 0,function(){var d,y;return L(this,function(E){var B;if(v=(B=v).startsWith(is.URL_SCHEME)?B.slice(is.URL_SCHEME.length):B,d=Ri(v),this.LS.getItem(d.info)==null)throw new Error("Cannot find model at path '"+v+"'");return y=JSON.parse(this.LS.getItem(d.info)),this.LS.removeItem(d.info),this.LS.removeItem(d.topology),this.LS.removeItem(d.weightSpecs),this.LS.removeItem(d.weightData),[2,y]})})},_}();if(z().getBool("IS_BROWSER"))try{wr.registerManager(is.URL_SCHEME,new zs)}catch{}var Iu="model",Fu=".json",Ru=".weights.bin";function rp(_){return new Promise(function(v){return setTimeout(v)}).then(_)}var $d=function(){function _(v){if(!z().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");v.startsWith(_.URL_SCHEME)&&(v=v.slice(_.URL_SCHEME.length)),v!=null&&v.length!==0||(v=Iu),this.modelTopologyFileName=v+Fu,this.weightDataFileName=v+Ru}return _.prototype.save=function(v){return N(this,void 0,void 0,function(){var d,y,E,B,Q,re;return L(this,function(fe){switch(fe.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(d=window.URL.createObjectURL(new Blob([v.weightData],{type:"application/octet-stream"})),!(v.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return y=[{paths:["./"+this.weightDataFileName],weights:v.weightSpecs}],E={modelTopology:v.modelTopology,format:v.format,generatedBy:v.generatedBy,convertedBy:v.convertedBy,weightsManifest:y},B=window.URL.createObjectURL(new Blob([JSON.stringify(E)],{type:"application/json"})),(Q=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,Q.href=B,[4,rp(function(){return Q.dispatchEvent(new MouseEvent("click"))})];case 2:return fe.sent(),v.weightData==null?[3,4]:((re=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,re.href=d,[4,rp(function(){return re.dispatchEvent(new MouseEvent("click"))})]);case 3:fe.sent(),fe.label=4;case 4:return[2,{modelArtifactsInfo:Wn(v)}]}})})},_.URL_SCHEME="downloads://",_}(),$l=function(){function _(v){if(v==null||v.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+v);this.files=v}return _.prototype.load=function(){return N(this,void 0,void 0,function(){var v,d,y=this;return L(this,function(E){return v=this.files[0],d=this.files.slice(1),[2,new Promise(function(B,Q){var re=new FileReader;re.onload=function(fe){var xe=JSON.parse(fe.target.result),Oe=xe.modelTopology;if(Oe!=null){d.length===0&&B({modelTopology:Oe});var Re=xe.weightsManifest;if(Re!=null){var Le;try{Le=y.checkManifestAndWeightFiles(Re,d)}catch(tt){return void Q(tt)}var Be=[],Xe=[],nt=[];Re.forEach(function(tt){tt.paths.forEach(function(ut){Xe.push(ut),nt.push(null)}),Be.push.apply(Be,tt.weights)}),Re.forEach(function(tt){tt.paths.forEach(function(ut){var Dt=new FileReader;Dt.onload=function(Rt){var Lt=Rt.target.result,qt=Xe.indexOf(ut);nt[qt]=Lt,nt.indexOf(null)===-1&&B({modelTopology:Oe,weightSpecs:Be,weightData:Dn(nt),format:xe.format,generatedBy:xe.generatedBy,convertedBy:xe.convertedBy,userDefinedMetadata:xe.userDefinedMetadata})},Dt.onerror=function(Rt){return Q("Failed to weights data from file of path '"+ut+"'.")},Dt.readAsArrayBuffer(Le[ut])})})}else Q(new Error("weightManifest field is missing from file "+v.name))}else Q(new Error("modelTopology field is missing from file "+v.name))},re.onerror=function(fe){return Q("Failed to read model topology and weights manifest JSON from file '"+v.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},re.readAsText(v)})]})})},_.prototype.checkManifestAndWeightFiles=function(v,d){for(var y=[],E=d.map(function(fe){return Nn(fe.name)}),B={},Q=0,re=v;Q<re.length;Q++)re[Q].paths.forEach(function(fe){var xe=Nn(fe);if(y.indexOf(xe)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+xe+"'");if(y.push(xe),E.indexOf(xe)===-1)throw new Error("Weight file with basename '"+xe+"' is not provided.");B[fe]=d[E.indexOf(xe)]});if(y.length!==d.length)throw new Error("Mismatch in the number of files in weights manifest ("+y.length+") and the number of weight files provided ("+d.length+").");return B},_}();function zf(_,v,d,y){(function(B){we(B!=null&&Array.isArray(B)&&B.length>0,function(){return"promises must be a none empty array"})})(_),function(B,Q){we(B>=0&&B<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+B}),we(Q>=0&&Q<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+Q}),we(Q>=B,function(){return"startFraction must be no more than endFraction, but got startFraction "+B+" and endFraction "+Q})}(d=d??0,y=y??1);var E=0;return Promise.all(_.map(function(B){return B.then(function(Q){var re=d+ ++E/_.length*(y-d);return v(re),Q}),B}))}function Xl(_,v){return N(this,void 0,void 0,function(){var d,y,E,B,Q,re,fe,xe,Oe;return L(this,function(Re){switch(Re.label){case 0:return v==null&&(v={}),d=v.fetchFunc==null?z().platform.fetch:v.fetchFunc,y=_.map(function(Le){return d(Le,v.requestInit,{isBinary:!0})}),E=0,B=.5,v.onProgress!=null?[3,2]:[4,Promise.all(y)];case 1:return Q=Re.sent(),[3,4];case 2:return[4,zf(y,v.onProgress,E,B)];case 3:Q=Re.sent(),Re.label=4;case 4:return re=Q.map(function(Le){return Le.arrayBuffer()}),fe=.5,xe=1,v.onProgress!=null?[3,6]:[4,Promise.all(re)];case 5:return Oe=Re.sent(),[3,8];case 6:return[4,zf(re,v.onProgress,fe,xe)];case 7:Oe=Re.sent(),Re.label=8;case 8:return[2,Oe]}})})}function vc(_){var v=this;return function(d,y,E){return y===void 0&&(y=""),N(v,void 0,void 0,function(){var B,Q,re,fe,xe,Oe,Re,Le,Be,Xe;return L(this,function(nt){switch(nt.label){case 0:if(B=d.map(function(){return!1}),Q={},re=E!=null?E.map(function(){return!1}):[],fe=[],d.forEach(function(tt,ut){var Dt=0;tt.weights.forEach(function(Rt){var Lt="quantization"in Rt?Rt.quantization.dtype:Rt.dtype,qt=ot[Lt]*ze(Rt.shape),pn=function(){B[ut]=!0,Q[ut]==null&&(Q[ut]=[]),Q[ut].push({manifestEntry:Rt,groupOffset:Dt,sizeBytes:qt})};E!=null?E.forEach(function(bn,mn){bn===Rt.name&&(pn(),re[mn]=!0)}):pn(),fe.push(Rt.name),Dt+=qt})}),!re.every(function(tt){return tt}))throw xe=E.filter(function(tt,ut){return!re[ut]}),new Error("Could not find weights in manifest with names: "+xe.join(", ")+`. 
Manifest JSON has weights with names: `+fe.join(", ")+".");return Oe=B.reduce(function(tt,ut,Dt){return ut&&tt.push(Dt),tt},[]),Re=[],Oe.forEach(function(tt){d[tt].paths.forEach(function(ut){var Dt=y+(y.endsWith("/")?"":"/")+ut;Re.push(Dt)})}),[4,_(Re)];case 1:return Le=nt.sent(),Be={},Xe=0,Oe.forEach(function(tt){for(var ut=d[tt].paths.length,Dt=0,Rt=0;Rt<ut;Rt++)Dt+=Le[Xe+Rt].byteLength;for(var Lt=new ArrayBuffer(Dt),qt=new Uint8Array(Lt),pn=0,bn=0;bn<ut;bn++){var mn=new Uint8Array(Le[Xe+bn]);qt.set(mn,pn),pn+=mn.byteLength}Q[tt].forEach(function(Sn){var On=Vt(Lt.slice(Sn.groupOffset,Sn.groupOffset+Sn.sizeBytes),[Sn.manifestEntry]);for(var b in On)Be[b]=On[b]}),Xe+=ut}),[2,Be]}})})}}Jn.registerSaveRouter(function(_){return z().getBool("IS_BROWSER")&&!Array.isArray(_)&&_.startsWith($d.URL_SCHEME)?function(v){return v===void 0&&(v="model"),new $d(v)}(_.slice($d.URL_SCHEME.length)):null});var qa=function(){function _(v,d){if(this.DEFAULT_METHOD="POST",d==null&&(d={}),this.weightPathPrefix=d.weightPathPrefix,this.onProgress=d.onProgress,d.fetchFunc!=null?(we(typeof d.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=d.fetchFunc):this.fetch=z().platform.fetch,we(v!=null&&v.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(v)&&we(v.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+v.length+")."}),this.path=v,d.requestInit!=null&&d.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=d.requestInit||{}}return _.prototype.save=function(v){return N(this,void 0,void 0,function(){var d,y,E,B;return L(this,function(Q){switch(Q.label){case 0:if(v.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(d=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,y=[{paths:["./model.weights.bin"],weights:v.weightSpecs}],E={modelTopology:v.modelTopology,format:v.format,generatedBy:v.generatedBy,convertedBy:v.convertedBy,userDefinedMetadata:v.userDefinedMetadata,weightsManifest:y},d.body.append("model.json",new Blob([JSON.stringify(E)],{type:"application/json"}),"model.json"),v.weightData!=null&&d.body.append("model.weights.bin",new Blob([v.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,d)];case 1:if((B=Q.sent()).ok)return[2,{modelArtifactsInfo:Wn(v),responses:[B]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+B.status+".")}})})},_.prototype.load=function(){return N(this,void 0,void 0,function(){var v,d,y,E,B,Q,re,fe,xe,Oe,Re,Le;return L(this,function(Be){switch(Be.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(v=Be.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+v.status+". Please verify this URL points to the model JSON of the model to load.");Be.label=2;case 2:return Be.trys.push([2,4,,5]),[4,v.json()];case 3:return d=Be.sent(),[3,5];case 4:throw Be.sent(),y="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?y+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":y+=" Please make sure the server is serving valid JSON for this request.",new Error(y);case 5:if(E=d.modelTopology,B=d.weightsManifest,Q=d.generatedBy,re=d.convertedBy,fe=d.format,xe=d.userDefinedMetadata,E==null&&B==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return B==null?[3,7]:[4,this.loadWeights(B)];case 6:Le=Be.sent(),Oe=Le[0],Re=Le[1],Be.label=7;case 7:return[2,{modelTopology:E,weightSpecs:Oe,weightData:Re,userDefinedMetadata:xe,generatedBy:Q,convertedBy:re,format:fe}]}})})},_.prototype.loadWeights=function(v){return N(this,void 0,void 0,function(){var d,y,E,B,Q,re,fe,xe,Oe,Re,Le;return L(this,function(Be){switch(Be.label){case 0:for(d=Array.isArray(this.path)?this.path[1]:this.path,y=function(Xe){var nt=Xe.lastIndexOf("/"),tt=Xe.lastIndexOf("?");return[Xe.substring(0,nt)+"/",tt>nt?Xe.substring(tt):""]}(d),E=y[0],B=y[1],Q=this.weightPathPrefix||E,re=[],fe=0,xe=v;fe<xe.length;fe++)Oe=xe[fe],re.push.apply(re,Oe.weights);return Re=[],v.forEach(function(Xe){Xe.paths.forEach(function(nt){Re.push(Q+nt+B)})}),[4,Xl(Re,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return Le=Be.sent(),[2,[re,Dn(Le)]]}})})},_.URL_SCHEME_REGEX=/^https?:\/\//,_}();function Uf(_){return _.match(qa.URL_SCHEME_REGEX)!=null}var Xd=function(_,v){return typeof fetch>"u"?null:(Array.isArray(_)?_.every(function(d){return Uf(d)}):Uf(_))?ip(_,{onProgress:v}):null};function ip(_,v){return new qa(_,v)}Jn.registerSaveRouter(Xd),Jn.registerLoadRouter(Xd);var Wf,ks=function(){function _(v){this.modelArtifacts=v}return _.prototype.load=function(){return N(this,void 0,void 0,function(){return L(this,function(v){return[2,this.modelArtifacts]})})},_}(),Kd=function(){function _(v){this.saveHandler=v}return _.prototype.save=function(v){return N(this,void 0,void 0,function(){return L(this,function(d){return[2,this.saveHandler(v)]})})},_}(),op=Object.freeze({browserFiles:function(_){return new $l(_)},browserHTTPRequest:function(_,v){return ip(_,v)},concatenateArrayBuffers:Dn,decodeWeights:Vt,encodeWeights:function(_,v){return N(this,void 0,void 0,function(){var d,y,E,B,Q,re=this;return L(this,function(fe){switch(fe.label){case 0:for(d=[],y=[],E=Array.isArray(_)?_.map(function(xe){return xe.name}):Object.keys(_),B=function(xe){var Oe=E[xe],Re=Array.isArray(_)?_[xe].tensor:_[Oe];if(Re.dtype!=="float32"&&Re.dtype!=="int32"&&Re.dtype!=="bool"&&Re.dtype!=="string")throw new Error("Unsupported dtype in weight '"+Oe+"': "+Re.dtype);var Le={name:Oe,shape:Re.shape,dtype:Re.dtype};if(Re.dtype==="string"){var Be=new Promise(function(Xe){return N(re,void 0,void 0,function(){var nt,tt,ut,Dt,Rt,Lt,qt;return L(this,function(pn){switch(pn.label){case 0:return[4,Re.bytes()];case 1:for(nt=pn.sent(),tt=nt.reduce(function(bn,mn){return bn+mn.length},0)+Bt*nt.length,ut=new Uint8Array(tt),Dt=0,Rt=0;Rt<nt.length;Rt++)Lt=nt[Rt],qt=new Uint8Array(new Uint32Array([Lt.length]).buffer),ut.set(qt,Dt),Dt+=Bt,ut.set(Lt,Dt),Dt+=Lt.length;return Xe(ut),[2]}})})});y.push(Be)}else y.push(Re.data());v!=null&&(Le.group=v),d.push(Le)},Q=0;Q<E.length;++Q)B(Q);return[4,Promise.all(y)];case 1:return[2,{data:function(xe){if(xe===null)throw new Error("Invalid input value: "+JSON.stringify(xe));var Oe=0,Re=[];xe.forEach(function(Xe){if(Oe+=Xe.byteLength,Re.push(Xe.byteLength===Xe.buffer.byteLength?Xe:new Xe.constructor(Xe)),!(Xe instanceof Float32Array||Xe instanceof Int32Array||Xe instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+Xe.constructor.name)});var Le=new Uint8Array(Oe),Be=0;return Re.forEach(function(Xe){Le.set(new Uint8Array(Xe.buffer),Be),Be+=Xe.byteLength}),Le.buffer}(fe.sent()),specs:d}]}})})},fromMemory:function(_,v,d,y){return arguments.length===1?_.modelTopology!=null||_.weightSpecs!=null?new ks(_):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new ks({modelTopology:_})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new ks({modelTopology:_,weightSpecs:v,weightData:d,trainingConfig:y}))},getLoadHandlers:function(_,v){return Jn.getLoadHandlers(_,v)},getModelArtifactsInfoForJSON:Wn,getSaveHandlers:function(_){return Jn.getSaveHandlers(_)},http:ip,isHTTPScheme:Uf,loadWeights:function(_,v,d,y){return v===void 0&&(v=""),N(this,void 0,void 0,function(){return L(this,function(E){return[2,vc(function(B){return Xl(B,{requestInit:y})})(_,v,d)]})})},registerLoadRouter:function(_){return Jn.registerLoadRouter(_)},registerSaveRouter:function(_){return Jn.registerSaveRouter(_)},weightsLoaderFactory:vc,withSaveHandler:function(_){return new Kd(_)},copyModel:function(_,v){return N(this,void 0,void 0,function(){return L(this,function(d){return[2,Nr(_,v,!1)]})})},listModels:function(){return N(this,void 0,void 0,function(){var _,v,d,y,E,B,Q;return L(this,function(re){switch(re.label){case 0:_=wr.getSchemes(),v={},d=0,y=_,re.label=1;case 1:return d<y.length?(E=y[d],[4,wr.getManager(E).listModels()]):[3,4];case 2:for(Q in B=re.sent())v[E+Cn+Q]=B[Q];re.label=3;case 3:return d++,[3,1];case 4:return[2,v]}})})},moveModel:function(_,v){return N(this,void 0,void 0,function(){return L(this,function(d){return[2,Nr(_,v,!0)]})})},removeModel:function(_){return N(this,void 0,void 0,function(){var v;return L(this,function(d){return v=Dr(_),[2,wr.getManager(v.scheme).removeModel(v.path)]})})}}),ap=Pt({confusionMatrix_:function(_,v,d){var y=Ze(_,"labels","confusionMatrix"),E=Ze(v,"predictions","confusionMatrix");we(d==null||d>0&&Number.isInteger(d),function(){return"If provided, numClasses must be a positive integer, but got "+d}),we(y.rank===1,function(){return"Expected the rank of labels to be 1, but got "+y.rank}),we(E.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+E.rank}),we(y.shape[0]===E.shape[0],function(){return"Mismatch in the number of examples: "+y.shape[0]+" vs. "+E.shape[0]+". Labels and predictions should have the same number of elements."}),we(d>0&&Number.isInteger(d),function(){return"numClasses is required to be a positive integer, but got "+d});var B=Rh(y.asType("int32"),d),Q=Rh(E.asType("int32"),d);return B.transpose().matMul(Q).asType("int32")}}),hl=Object.freeze({confusionMatrix:ap}),Cm=Pt({fromPixels_:function(_,v){if(v===void 0&&(v=3),v>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(_==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var d=!1,y=!1,E=!1,B=!1,Q=!1;if(_.data instanceof Uint8Array)d=!0;else if(typeof ImageData<"u"&&_ instanceof ImageData)y=!0;else if(typeof HTMLVideoElement<"u"&&_ instanceof HTMLVideoElement)E=!0;else if(typeof HTMLImageElement<"u"&&_ instanceof HTMLImageElement)B=!0;else{if(_.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+_.constructor.name);Q=!0}if(E&&E&&_.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(Y("FromPixels",Ve.backendName)!=null)return Ve.runKernel("FromPixels",{pixels:_},{numChannels:v});var re,fe,xe=E?[_.videoWidth,_.videoHeight]:[_.width,_.height],Oe=xe[0],Re=xe[1];if(Q?re=_.getContext("2d").getImageData(0,0,Oe,Re).data:y||d?re=_.data:(B||E)&&(Wf==null&&(Wf=document.createElement("canvas").getContext("2d")),Wf.canvas.width=Oe,Wf.canvas.height=Re,Wf.drawImage(_,0,0,Oe,Re),re=Wf.getImageData(0,0,Oe,Re).data),v===4)fe=new Int32Array(re);else{var Le=Oe*Re;fe=new Int32Array(Le*v);for(var Be=0;Be<Le;Be++)for(var Xe=0;Xe<v;++Xe)fe[Be*v+Xe]=re[4*Be+Xe]}return Cl(fe,[Re,Oe,v],"int32")}}),yc=Object.freeze({toPixels:function(_,v){return N(this,void 0,void 0,function(){var d,y,E,B,Q,re,fe,xe,Oe,Re,Le,Be,Xe,nt,tt,ut,Dt,Rt,Lt,qt,pn,bn,mn;return L(this,function(Sn){switch(Sn.label){case 0:if(d=Ze(_,"img","toPixels"),_ instanceof $t||(d=d.toInt()),d.rank!==2&&d.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+d.rank+".");if(y=d.shape.slice(0,2),E=y[0],B=y[1],(Q=d.rank===2?1:d.shape[2])>4||Q===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+Q);return[4,d.data()];case 1:return re=Sn.sent(),fe=d.min(),xe=d.max(),[4,Promise.all([fe.data(),xe.data()])];case 2:if(Oe=Sn.sent(),Re=Oe[0],Le=Oe[1],Be=Re[0],Xe=Le[0],fe.dispose(),xe.dispose(),d.dtype==="float32"){if(Be<0||Xe>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+Be+" - "+Xe+"].")}else{if(d.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+d.dtype+". Please use float32 or int32 tensors.");if(Be<0||Xe>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+Be+" - "+Xe+"].")}for(nt=d.dtype==="float32"?255:1,tt=new Uint8ClampedArray(B*E*4),ut=0;ut<E*B;++ut)Dt=void 0,Rt=void 0,Lt=void 0,qt=void 0,Q===1?(Dt=re[ut]*nt,Rt=re[ut]*nt,Lt=re[ut]*nt,qt=255):Q===3?(Dt=re[3*ut]*nt,Rt=re[3*ut+1]*nt,Lt=re[3*ut+2]*nt,qt=255):Q===4&&(Dt=re[4*ut]*nt,Rt=re[4*ut+1]*nt,Lt=re[4*ut+2]*nt,qt=re[4*ut+3]*nt),tt[0+(pn=4*ut)]=Math.round(Dt),tt[pn+1]=Math.round(Rt),tt[pn+2]=Math.round(Lt),tt[pn+3]=Math.round(qt);return v!=null&&(v.width=B,v.height=E,bn=v.getContext("2d"),mn=new ImageData(tt,B,E),bn.putImageData(mn,0,0)),d!==_&&d.dispose(),[2,tt]}})})},fromPixels:Cm}),Us=function(){function _(){}return _.prototype.getClassName=function(){return this.constructor.className},_.fromConfig=function(v,d){return new v(d)},_}(),tc=function(){function _(){this.classNameMap={}}return _.getMap=function(){return _.instance==null&&(_.instance=new _),_.instance},_.register=function(v){_.getMap().classNameMap[v.className]=[v,v.fromConfig]},_}();function Cs(_){we(_.className!=null,function(){return"Class being registered does not have the static className property defined."}),we(typeof _.className=="string",function(){return"className is required to be a string, but got type "+typeof _.className}),we(_.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),tc.register(_)}var Kl=Object.freeze({Serializable:Us,SerializationMap:tc,registerClass:Cs}),Yd=.001,sp=.1;function Jd(){return Ve.backend.floatPrecision()===32?Yd:sp}function Am(_,v,d){var y=!0;if((ft(_)||ft(v))&&(y=!1),ft(_)&&ft(v)&&(y=!0),y){var E=_.constructor.name,B=v.constructor.name;if(E!==B)throw new Error("Arrays are of different type. Actual: "+E+". Expected: "+B)}if(Array.isArray(_)&&Array.isArray(v)){var Q=Ka(_),re=Ka(v);if(!Ut(Q,re))throw new Error("Arrays have different shapes. Actual: ["+Q+"]. Expected: ["+re+"]")}var fe=ft(_)?_:Mt(_),xe=ft(v)?v:Mt(v);if(fe.length!==xe.length)throw new Error("Arrays have different lengths actual: "+fe.length+" vs expected: "+xe.length+`.
Actual:   `+fe+`.
Expected: `+xe+".");for(var Oe=0;Oe<xe.length;++Oe){var Re=fe[Oe],Le=xe[Oe];if(!d(Re,Le))throw new Error("Arrays differ: actual["+Oe+"] = "+Re+", expected["+Oe+"] = "+Le+`.
Actual:   `+fe+`.
Expected: `+xe+".")}}function Yl(_,v,d){return!isFinite(_)&&!isFinite(v)||!(isNaN(_)||isNaN(v)||Math.abs(_-v)>d)}var Eu=Object.freeze({TEST_EPSILON_FLOAT16:sp,expectArraysClose:function(_,v,d){return d==null&&(d=Jd()),Am(_,v,function(y,E){return Yl(y,E,d)})},testEpsilon:Jd,expectPromiseToFail:function(_,v){_().then(function(){return v.fail()},function(){return v()})},expectArraysEqual:function(_,v){var d=typeof v=="string"||typeof v=="number"||typeof v=="boolean"?[v]:v;return Pn(_)||Pn(_[0])||Pn(v)||Pn(v[0])?Am(_,d,function(y,E){return y==E}):Am(_,v,function(y,E){return Yl(y,E,0)})},expectNumbersClose:function(_,v,d){if(d==null&&(d=Jd()),!Yl(_,v,d))throw new Error("Numbers differ: actual === "+_+", expected === "+v)},expectValuesInRange:function(_,v,d){for(var y=0;y<_.length;y++)if(_[y]<v||_[y]>d)throw new Error("Value out of range:"+_[y]+" low: "+v+", high: "+d)},expectArrayBuffersEqual:function(_,v){expect(new Float32Array(_)).toEqual(new Float32Array(v))}}),P1="1.7.0",Jl=Object.freeze({gpgpu_util:$s,webgl_util:hd,forceHalfFloat:function(){z().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:Sy,setWebGLContext:ki,GPGPUContext:aa}),up=function(_){function v(){return _!==null&&_.apply(this,arguments)||this}return j(v,_),v.prototype.minimize=function(d,y,E){y===void 0&&(y=!1);var B=this.computeGradients(d,E),Q=B.value,re=B.grads;if(E!=null){var fe=E.map(function(xe){return{name:xe.name,tensor:re[xe.name]}});this.applyGradients(fe)}else this.applyGradients(re);return Lo(re),y?Q:(Q.dispose(),null)},Object.defineProperty(v.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),v.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},v.prototype.computeGradients=function(d,y){return vn(d,y)},v.prototype.dispose=function(){this.iterations_!=null&&Lo(this.iterations_)},v.prototype.saveIterations=function(){return N(this,void 0,void 0,function(){return L(this,function(d){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:kr(this.iterations_,"int32")}]})})},v.prototype.getWeights=function(){return N(this,void 0,void 0,function(){return L(this,function(d){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},v.prototype.setWeights=function(d){return N(this,void 0,void 0,function(){return L(this,function(y){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},v.prototype.extractIterations=function(d){return N(this,void 0,void 0,function(){var y;return L(this,function(E){switch(E.label){case 0:return y=this,[4,d[0].tensor.data()];case 1:return y.iterations_=E.sent()[0],[2,d.slice(1)]}})})},v}(Us);Object.defineProperty(up,Symbol.hasInstance,{value:function(_){return _.minimize!=null&&_.computeGradients!=null&&_.applyGradients!=null}});var L1=function(_){function v(d,y,E){E===void 0&&(E=null);var B=_.call(this)||this;return B.learningRate=d,B.rho=y,B.epsilon=E,B.accumulatedGrads=[],B.accumulatedUpdates=[],E==null&&(B.epsilon=Ve.backend.epsilon()),B}return j(v,_),v.prototype.applyGradients=function(d){var y=this;(Array.isArray(d)?d.map(function(E){return E.name}):Object.keys(d)).forEach(function(E,B){var Q=Ve.registeredVariables[E];y.accumulatedGrads[B]==null&&(y.accumulatedGrads[B]={originalName:E+"/accum_grad",variable:Hi(function(){return mi(Q).variable(!1)})}),y.accumulatedUpdates[B]==null&&(y.accumulatedUpdates[B]={originalName:E+"/accum_var",variable:Hi(function(){return mi(Q).variable(!1)})});var re=Array.isArray(d)?d[B].tensor:d[E];if(re!=null){var fe=y.accumulatedGrads[B].variable,xe=y.accumulatedUpdates[B].variable;Hi(function(){var Oe=fe.mul(y.rho).add(re.square().mul(1-y.rho)),Re=xe.add(y.epsilon).sqrt().div(fe.add(y.epsilon).sqrt()).mul(re),Le=xe.mul(y.rho).add(Re.square().mul(1-y.rho));fe.assign(Oe),xe.assign(Le);var Be=Re.mul(-y.learningRate).add(Q);Q.assign(Be)})}}),this.incrementIterations()},v.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Lo(this.accumulatedGrads.map(function(d){return d.variable})),Lo(this.accumulatedUpdates.map(function(d){return d.variable})))},v.prototype.getWeights=function(){return N(this,void 0,void 0,function(){var d;return L(this,function(y){switch(y.label){case 0:return d=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[y.sent()].concat(d.map(function(E){return{name:E.originalName,tensor:E.variable}}))]}})})},v.prototype.setWeights=function(d){return N(this,void 0,void 0,function(){var y;return L(this,function(E){switch(E.label){case 0:return[4,this.extractIterations(d)];case 1:return d=E.sent(),y=d.length/2,this.accumulatedGrads=d.slice(0,y).map(function(B){return{originalName:B.name,variable:B.tensor.variable(!1)}}),this.accumulatedUpdates=d.slice(y,2*y).map(function(B){return{originalName:B.name,variable:B.tensor.variable(!1)}}),[2]}})})},v.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},v.fromConfig=function(d,y){return new d(y.learningRate,y.rho,y.epsilon)},v.className="Adadelta",v}(up);Cs(L1);var B1=function(_){function v(d,y){y===void 0&&(y=.1);var E=_.call(this)||this;return E.learningRate=d,E.initialAccumulatorValue=y,E.accumulatedGrads=[],E}return j(v,_),v.prototype.applyGradients=function(d){var y=this;(Array.isArray(d)?d.map(function(E){return E.name}):Object.keys(d)).forEach(function(E,B){var Q=Ve.registeredVariables[E];y.accumulatedGrads[B]==null&&(y.accumulatedGrads[B]={originalName:E+"/accumulator",variable:Hi(function(){return Is(Q.shape,y.initialAccumulatorValue).variable(!1)})});var re=Array.isArray(d)?d[B].tensor:d[E];if(re!=null){var fe=y.accumulatedGrads[B].variable;Hi(function(){var xe=fe.add(re.square());fe.assign(xe);var Oe=re.div(xe.add(Ve.backend.epsilon()).sqrt()).mul(-y.learningRate).add(Q);Q.assign(Oe)})}}),this.incrementIterations()},v.prototype.dispose=function(){this.accumulatedGrads!=null&&Lo(this.accumulatedGrads.map(function(d){return d.variable}))},v.prototype.getWeights=function(){return N(this,void 0,void 0,function(){return L(this,function(d){switch(d.label){case 0:return[4,this.saveIterations()];case 1:return[2,[d.sent()].concat(this.accumulatedGrads.map(function(y){return{name:y.originalName,tensor:y.variable}}))]}})})},v.prototype.setWeights=function(d){return N(this,void 0,void 0,function(){return L(this,function(y){switch(y.label){case 0:return[4,this.extractIterations(d)];case 1:return d=y.sent(),this.accumulatedGrads=d.map(function(E){return{originalName:E.name,variable:E.tensor.variable(!1)}}),[2]}})})},v.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},v.fromConfig=function(d,y){return new d(y.learningRate,y.initialAccumulatorValue)},v.className="Adagrad",v}(up);Cs(B1);var j1=function(_){function v(d,y,E,B){B===void 0&&(B=null);var Q=_.call(this)||this;return Q.learningRate=d,Q.beta1=y,Q.beta2=E,Q.epsilon=B,Q.accumulatedFirstMoment=[],Q.accumulatedSecondMoment=[],Hi(function(){Q.accBeta1=kr(y).variable(),Q.accBeta2=kr(E).variable()}),B==null&&(Q.epsilon=Ve.backend.epsilon()),Q}return j(v,_),v.prototype.applyGradients=function(d){var y=this,E=Array.isArray(d)?d.map(function(B){return B.name}):Object.keys(d);Hi(function(){var B=cl(1,y.accBeta1),Q=cl(1,y.accBeta2);E.forEach(function(re,fe){var xe=Ve.registeredVariables[re];y.accumulatedFirstMoment[fe]==null&&(y.accumulatedFirstMoment[fe]={originalName:re+"/m",variable:Hi(function(){return mi(xe).variable(!1)})}),y.accumulatedSecondMoment[fe]==null&&(y.accumulatedSecondMoment[fe]={originalName:re+"/v",variable:Hi(function(){return mi(xe).variable(!1)})});var Oe=Array.isArray(d)?d[fe].tensor:d[re];if(Oe!=null){var Re=y.accumulatedFirstMoment[fe].variable,Le=y.accumulatedSecondMoment[fe].variable,Be=Re.mul(y.beta1).add(Oe.mul(1-y.beta1)),Xe=Le.mul(y.beta2).add(Oe.square().mul(1-y.beta2)),nt=Be.div(B),tt=Xe.div(Q);Re.assign(Be),Le.assign(Xe);var ut=nt.div(tt.sqrt().add(y.epsilon)).mul(-y.learningRate).add(xe);xe.assign(ut)}}),y.accBeta1.assign(y.accBeta1.mul(y.beta1)),y.accBeta2.assign(y.accBeta2.mul(y.beta2))}),this.incrementIterations()},v.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Lo(this.accumulatedFirstMoment.map(function(d){return d.variable})),this.accumulatedSecondMoment!=null&&Lo(this.accumulatedSecondMoment.map(function(d){return d.variable}))},v.prototype.getWeights=function(){return N(this,void 0,void 0,function(){var d;return L(this,function(y){switch(y.label){case 0:return d=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[y.sent()].concat(d.map(function(E){return{name:E.originalName,tensor:E.variable}}))]}})})},v.prototype.setWeights=function(d){return N(this,void 0,void 0,function(){var y,E=this;return L(this,function(B){switch(B.label){case 0:return[4,this.extractIterations(d)];case 1:return d=B.sent(),Hi(function(){E.accBeta1.assign(Ld(E.beta1,E.iterations_+1)),E.accBeta2.assign(Ld(E.beta2,E.iterations_+1))}),y=d.length/2,this.accumulatedFirstMoment=d.slice(0,y).map(function(Q){return{originalName:Q.name,variable:Q.tensor.variable(!1)}}),this.accumulatedSecondMoment=d.slice(y,2*y).map(function(Q){return{originalName:Q.name,variable:Q.tensor.variable(!1)}}),[2]}})})},v.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},v.fromConfig=function(d,y){return new d(y.learningRate,y.beta1,y.beta2,y.epsilon)},v.className="Adam",v}(up);Cs(j1);var Vv=function(_){function v(d,y,E,B,Q){B===void 0&&(B=null),Q===void 0&&(Q=0);var re=_.call(this)||this;return re.learningRate=d,re.beta1=y,re.beta2=E,re.epsilon=B,re.decay=Q,re.accumulatedFirstMoment=[],re.accumulatedWeightedInfNorm=[],Hi(function(){re.iteration=kr(0).variable(),re.accBeta1=kr(y).variable()}),B==null&&(re.epsilon=Ve.backend.epsilon()),re}return j(v,_),v.prototype.applyGradients=function(d){var y=this,E=Array.isArray(d)?d.map(function(B){return B.name}):Object.keys(d);Hi(function(){var B=cl(1,y.accBeta1),Q=Mf(-y.learningRate,y.iteration.mul(y.decay).add(1));E.forEach(function(re,fe){var xe=Ve.registeredVariables[re];y.accumulatedFirstMoment[fe]==null&&(y.accumulatedFirstMoment[fe]={originalName:re+"/m",variable:mi(xe).variable(!1)}),y.accumulatedWeightedInfNorm[fe]==null&&(y.accumulatedWeightedInfNorm[fe]={originalName:re+"/v",variable:mi(xe).variable(!1)});var Oe=Array.isArray(d)?d[fe].tensor:d[re];if(Oe!=null){var Re=y.accumulatedFirstMoment[fe].variable,Le=y.accumulatedWeightedInfNorm[fe].variable,Be=Re.mul(y.beta1).add(Oe.mul(1-y.beta1)),Xe=Le.mul(y.beta2),nt=Oe.abs(),tt=Xe.maximum(nt);Re.assign(Be),Le.assign(tt);var ut=Q.div(B).mul(Be.div(tt.add(y.epsilon))).add(xe);xe.assign(ut)}}),y.iteration.assign(y.iteration.add(1)),y.accBeta1.assign(y.accBeta1.mul(y.beta1))}),this.incrementIterations()},v.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Lo(this.accumulatedFirstMoment.map(function(d){return d.variable})),this.accumulatedWeightedInfNorm!=null&&Lo(this.accumulatedWeightedInfNorm.map(function(d){return d.variable}))},v.prototype.getWeights=function(){return N(this,void 0,void 0,function(){return L(this,function(d){throw new Error("getWeights() is not implemented for Adamax yet.")})})},v.prototype.setWeights=function(d){return N(this,void 0,void 0,function(){return L(this,function(y){throw new Error("setWeights() is not implemented for Adamax yet.")})})},v.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},v.fromConfig=function(d,y){return new d(y.learningRate,y.beta1,y.beta2,y.epsilon,y.decay)},v.className="Adamax",v}(up);Cs(Vv);var Ry=function(_){function v(d){var y=_.call(this)||this;return y.learningRate=d,y.setLearningRate(d),y}return j(v,_),v.prototype.applyGradients=function(d){var y=this;(Array.isArray(d)?d.map(function(E){return E.name}):Object.keys(d)).forEach(function(E,B){var Q=Array.isArray(d)?d[B].tensor:d[E];if(Q!=null){var re=Ve.registeredVariables[E];Hi(function(){var fe=y.c.mul(Q).add(re);re.assign(fe)})}}),this.incrementIterations()},v.prototype.setLearningRate=function(d){this.learningRate=d,this.c!=null&&this.c.dispose(),this.c=Ch(kr(-d))},v.prototype.dispose=function(){this.c.dispose()},v.prototype.getWeights=function(){return N(this,void 0,void 0,function(){return L(this,function(d){switch(d.label){case 0:return[4,this.saveIterations()];case 1:return[2,[d.sent()]]}})})},v.prototype.setWeights=function(d){return N(this,void 0,void 0,function(){return L(this,function(y){switch(y.label){case 0:return[4,this.extractIterations(d)];case 1:if((d=y.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},v.prototype.getConfig=function(){return{learningRate:this.learningRate}},v.fromConfig=function(d,y){return new d(y.learningRate)},v.className="SGD",v}(up);Cs(Ry);var Hv=function(_){function v(d,y,E){E===void 0&&(E=!1);var B=_.call(this,d)||this;return B.learningRate=d,B.momentum=y,B.useNesterov=E,B.accumulations=[],B.m=kr(B.momentum),B}return j(v,_),v.prototype.applyGradients=function(d){var y=this;(Array.isArray(d)?d.map(function(E){return E.name}):Object.keys(d)).forEach(function(E,B){var Q=Ve.registeredVariables[E];y.accumulations[B]==null&&(y.accumulations[B]={originalName:E+"/momentum",variable:Hi(function(){return mi(Q).variable(!1)})});var re=y.accumulations[B].variable,fe=Array.isArray(d)?d[B].tensor:d[E];fe!=null&&Hi(function(){var xe,Oe=y.m.mul(re).add(fe);xe=y.useNesterov?y.c.mul(fe.add(Oe.mul(y.m))).add(Q):y.c.mul(Oe).add(Q),re.assign(Oe),Q.assign(xe)})}),this.incrementIterations()},v.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Lo(this.accumulations.map(function(d){return d.variable}))},v.prototype.setMomentum=function(d){this.momentum=d},v.prototype.getWeights=function(){return N(this,void 0,void 0,function(){return L(this,function(d){switch(d.label){case 0:return[4,this.saveIterations()];case 1:return[2,[d.sent()].concat(this.accumulations.map(function(y){return{name:y.originalName,tensor:y.variable}}))]}})})},v.prototype.setWeights=function(d){return N(this,void 0,void 0,function(){return L(this,function(y){switch(y.label){case 0:return[4,this.extractIterations(d)];case 1:return d=y.sent(),this.accumulations=d.map(function(E){return{originalName:E.name,variable:E.tensor.variable(!1)}}),[2]}})})},v.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},v.fromConfig=function(d,y){return new d(y.learningRate,y.momentum,y.useNesterov)},v.className="Momentum",v}(Ry);Cs(Hv);var Py=function(_){function v(d,y,E,B,Q){y===void 0&&(y=.9),E===void 0&&(E=0),B===void 0&&(B=null),Q===void 0&&(Q=!1);var re=_.call(this)||this;if(re.learningRate=d,re.decay=y,re.momentum=E,re.epsilon=B,re.accumulatedMeanSquares=[],re.accumulatedMoments=[],re.accumulatedMeanGrads=[],re.centered=Q,B==null&&(re.epsilon=Ve.backend.epsilon()),d==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return re}return j(v,_),v.prototype.applyGradients=function(d){var y=this;(Array.isArray(d)?d.map(function(E){return E.name}):Object.keys(d)).forEach(function(E,B){var Q=Ve.registeredVariables[E];y.accumulatedMeanSquares[B]==null&&(y.accumulatedMeanSquares[B]={originalName:E+"/rms",variable:Hi(function(){return mi(Q).variable(!1)})}),y.accumulatedMoments[B]==null&&(y.accumulatedMoments[B]={originalName:E+"/momentum",variable:Hi(function(){return mi(Q).variable(!1)})}),y.accumulatedMeanGrads[B]==null&&y.centered&&(y.accumulatedMeanGrads[B]={originalName:E+"/mg",variable:Hi(function(){return mi(Q).variable(!1)})});var re=Array.isArray(d)?d[B].tensor:d[E];if(re!=null){var fe=y.accumulatedMeanSquares[B].variable,xe=y.accumulatedMoments[B].variable;Hi(function(){var Oe=fe.mul(y.decay).add(re.square().mul(1-y.decay));if(y.centered){var Re=y.accumulatedMeanGrads[B].variable,Le=Re.mul(y.decay).add(re.mul(1-y.decay)),Be=xe.mul(y.momentum).add(re.mul(y.learningRate).div(Oe.sub(Le.square().add(y.epsilon)).sqrt()));fe.assign(Oe),Re.assign(Le),xe.assign(Be);var Xe=Q.sub(Be);Q.assign(Xe)}else{var nt=fe.mul(y.decay).add(re.square().mul(1-y.decay));Be=xe.mul(y.momentum).add(re.mul(y.learningRate).div(nt.add(y.epsilon).sqrt())),fe.assign(nt),xe.assign(Be),Xe=Q.sub(Be),Q.assign(Xe)}})}}),this.incrementIterations()},v.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Lo(this.accumulatedMeanSquares.map(function(d){return d.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Lo(this.accumulatedMeanGrads.map(function(d){return d.variable})),this.accumulatedMoments!=null&&Lo(this.accumulatedMoments.map(function(d){return d.variable}))},v.prototype.getWeights=function(){return N(this,void 0,void 0,function(){var d;return L(this,function(y){switch(y.label){case 0:return d=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&d.push.apply(d,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[y.sent()].concat(d.map(function(E){return{name:E.originalName,tensor:E.variable}}))]}})})},v.prototype.setWeights=function(d){return N(this,void 0,void 0,function(){var y;return L(this,function(E){switch(E.label){case 0:return[4,this.extractIterations(d)];case 1:return d=E.sent(),y=this.centered?d.length/3:d.length/2,this.accumulatedMeanSquares=d.slice(0,y).map(function(B){return{originalName:B.name,variable:B.tensor.variable(!1)}}),this.accumulatedMoments=d.slice(y,2*y).map(function(B){return{originalName:B.name,variable:B.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=d.slice(2*y,3*y).map(function(B){return{originalName:B.name,variable:B.tensor.variable(!1)}})),[2]}})})},v.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},v.fromConfig=function(d,y){return new d(y.learningRate,y.decay,y.momentum,y.epsilon,y.centered)},v.className="RMSProp",v}(up);Cs(Py);var Uc=function(){function _(){}return _.sgd=function(v){return new Ry(v)},_.momentum=function(v,d,y){return y===void 0&&(y=!1),new Hv(v,d,y)},_.rmsprop=function(v,d,y,E,B){return d===void 0&&(d=.9),y===void 0&&(y=0),E===void 0&&(E=null),B===void 0&&(B=!1),new Py(v,d,y,E,B)},_.adam=function(v,d,y,E){return v===void 0&&(v=.001),d===void 0&&(d=.9),y===void 0&&(y=.999),E===void 0&&(E=null),new j1(v,d,y,E)},_.adadelta=function(v,d,y){return v===void 0&&(v=.001),d===void 0&&(d=.95),y===void 0&&(y=null),new L1(v,d,y)},_.adamax=function(v,d,y,E,B){return v===void 0&&(v=.002),d===void 0&&(d=.9),y===void 0&&(y=.999),E===void 0&&(E=null),B===void 0&&(B=0),new Vv(v,d,y,E,B)},_.adagrad=function(v,d){return d===void 0&&(d=.1),new B1(v,d)},_}(),z1={sgd:Uc.sgd,momentum:Uc.momentum,adadelta:Uc.adadelta,adagrad:Uc.adagrad,rmsprop:Uc.rmsprop,adamax:Uc.adamax,adam:Uc.adam},bc=typeof requestAnimationFrame<"u"?requestAnimationFrame:O!==void 0?O:function(_){return _()};function Vf(){return new Promise(function(_){return bc(function(){return _()})})}$t.prototype.squaredDifference=function(_){return Md(this,_)},Ot=kg}.call(this,r(59),r(75),r(92).Buffer,r(207).setImmediate)},function(u,s,r){u.exports=r(281)},function(u,s,r){r.d(s,"c",function(){return C}),r.d(s,"a",function(){return S}),r.d(s,"b",function(){return O}),r.d(s,"d",function(){return U}),r.d(s,"e",function(){return j});var l=function(N,L){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(W,z){W.__proto__=z}||function(W,z){for(var q in z)z.hasOwnProperty(q)&&(W[q]=z[q])})(N,L)};function C(N,L){function W(){this.constructor=N}l(N,L),N.prototype=L===null?Object.create(L):(W.prototype=L.prototype,new W)}var S=function(){return(S=Object.assign||function(N){for(var L,W=1,z=arguments.length;W<z;W++)for(var q in L=arguments[W])Object.prototype.hasOwnProperty.call(L,q)&&(N[q]=L[q]);return N}).apply(this,arguments)};function O(N,L,W,z){return new(W||(W=Promise))(function(q,I){function Z(oe){try{G(z.next(oe))}catch(ce){I(ce)}}function Y(oe){try{G(z.throw(oe))}catch(ce){I(ce)}}function G(oe){oe.done?q(oe.value):function(ce){return ce instanceof W?ce:new W(function(be){be(ce)})}(oe.value).then(Z,Y)}G((z=z.apply(N,L||[])).next())})}function U(N,L){var W,z,q,I,Z={label:0,sent:function(){if(1&q[0])throw q[1];return q[1]},trys:[],ops:[]};return I={next:Y(0),throw:Y(1),return:Y(2)},typeof Symbol=="function"&&(I[Symbol.iterator]=function(){return this}),I;function Y(G){return function(oe){return function(ce){if(W)throw new TypeError("Generator is already executing.");for(;Z;)try{if(W=1,z&&(q=2&ce[0]?z.return:ce[0]?z.throw||((q=z.return)&&q.call(z),0):z.next)&&!(q=q.call(z,ce[1])).done)return q;switch(z=0,q&&(ce=[2&ce[0],q.value]),ce[0]){case 0:case 1:q=ce;break;case 4:return Z.label++,{value:ce[1],done:!1};case 5:Z.label++,z=ce[1],ce=[0];continue;case 7:ce=Z.ops.pop(),Z.trys.pop();continue;default:if(!(q=(q=Z.trys).length>0&&q[q.length-1])&&(ce[0]===6||ce[0]===2)){Z=0;continue}if(ce[0]===3&&(!q||ce[1]>q[0]&&ce[1]<q[3])){Z.label=ce[1];break}if(ce[0]===6&&Z.label<q[1]){Z.label=q[1],q=ce;break}if(q&&Z.label<q[2]){Z.label=q[2],Z.ops.push(ce);break}q[2]&&Z.ops.pop(),Z.trys.pop();continue}ce=L.call(N,Z)}catch(be){ce=[6,be],z=0}finally{W=q=0}if(5&ce[0])throw ce[1];return{value:ce[0]?ce[1]:void 0,done:!0}}([G,oe])}}}function j(){for(var N=0,L=0,W=arguments.length;L<W;L++)N+=arguments[L].length;var z=Array(N),q=0;for(L=0;L<W;L++)for(var I=arguments[L],Z=0,Y=I.length;Z<Y;Z++,q++)z[q]=I[Z];return z}},function(u,s){function r(l,C,S,O,U,j,N){try{var L=l[j](N),W=L.value}catch(z){return void S(z)}L.done?C(W):Promise.resolve(W).then(O,U)}u.exports=function(l){return function(){var C=this,S=arguments;return new Promise(function(O,U){var j=l.apply(C,S);function N(W){r(j,O,U,N,L,"next",W)}function L(W){r(j,O,U,N,L,"throw",W)}N(void 0)})}},u.exports.__esModule=!0,u.exports.default=u.exports},function(u,s){function r(l){return u.exports=r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},u.exports.__esModule=!0,u.exports.default=u.exports,r(l)}u.exports=r,u.exports.__esModule=!0,u.exports.default=u.exports},function(u,s,r){var l=r(16),C=r(24),S=r(42),O=r(38),U=r(56),j=function(N,L,W){var z,q,I,Z,Y=N&j.F,G=N&j.G,oe=N&j.S,ce=N&j.P,be=N&j.B,Ee=G?l:oe?l[L]||(l[L]={}):(l[L]||{}).prototype,ve=G?C:C[L]||(C[L]={}),ge=ve.prototype||(ve.prototype={});for(z in G&&(W=L),W)I=((q=!Y&&Ee&&Ee[z]!==void 0)?Ee:W)[z],Z=be&&q?U(I,l):ce&&typeof I=="function"?U(Function.call,I):I,Ee&&O(Ee,z,I,N&j.U),ve[z]!=I&&S(ve,z,Z),ce&&ge[z]!=I&&(ge[z]=I)};l.core=C,j.F=1,j.G=2,j.S=4,j.P=8,j.B=16,j.W=32,j.U=64,j.R=128,u.exports=j},function(u,s){function r(l,C){for(var S=0;S<C.length;S++){var O=C[S];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(l,O.key,O)}}u.exports=function(l,C,S){return C&&r(l.prototype,C),S&&r(l,S),Object.defineProperty(l,"prototype",{writable:!1}),l},u.exports.__esModule=!0,u.exports.default=u.exports},function(u,s){u.exports=function(r,l){if(!(r instanceof l))throw new TypeError("Cannot call a class as a function")},u.exports.__esModule=!0,u.exports.default=u.exports},function(u,s,r){r.d(s,"a",function(){return Ge}),r.d(s,"b",function(){return ht}),r.d(s,"c",function(){return It}),r.d(s,"d",function(){return St}),r.d(s,"e",function(){return jt}),r.d(s,"f",function(){return we}),r.d(s,"g",function(){return ve}),r.d(s,"h",function(){return Ee}),r.d(s,"i",function(){return bt}),r.d(s,"j",function(){return Mt}),r.d(s,"k",function(){return ge}),r.d(s,"l",function(){return be}),r.d(s,"m",function(){return xt}),r.d(s,"n",function(){return qr}),r.d(s,"o",function(){return ar}),r.d(s,"p",function(){return Wt}),r.d(s,"q",function(){return xn}),r.d(s,"r",function(){return sr}),r.d(s,"s",function(){return pt}),r.d(s,"t",function(){return Ut}),r.d(s,"u",function(){return Ht}),r.d(s,"v",function(){return Zt}),r.d(s,"w",function(){return Un}),r.d(s,"x",function(){return Er}),r.d(s,"y",function(){return qe}),r.d(s,"z",function(){return Qe}),r.d(s,"A",function(){return _t});var l=r(1),C=r(72),S=r(40),O=r(71),U=r(39),j=r(70),N=r(135),L=r(184),W=r(183),z=r(69),q=r(182),I=r(68),Z=r(134),Y=r(181),G=r(180),oe=r(108),ce=r(45);const be="year",Ee="quarter",ve="month",ge="week",Ge="date",ht="day",It="dayofyear",St="hours",we="minutes",bt="seconds",jt="milliseconds",Mt=[be,Ee,ve,ge,Ge,ht,It,St,we,bt,jt],ze=Mt.reduce((Ot,Fr,$t)=>(Ot[Fr]=1+$t,Ot),{});function Ut(Ot){const Fr=Object(l.i)(Ot).slice(),$t={};return Fr.length||Object(l.o)("Missing time unit."),Fr.forEach(Se=>{Object(l.w)(ze,Se)?$t[Se]=1:Object(l.o)("Invalid time unit: ".concat(Se,"."))}),($t[ge]||$t[ht]?1:0)+($t[Ee]||$t[ve]||$t[Ge]?1:0)+($t[It]?1:0)>1&&Object(l.o)("Incompatible time units: ".concat(Ot)),Fr.sort((Se,me)=>ze[Se]-ze[me]),Fr}const Ft={[be]:"%Y ",[Ee]:"Q%q ",[ve]:"%b ",[Ge]:"%d ",[ge]:"W%U ",[ht]:"%a ",[It]:"%j ",[St]:"%H:00",[we]:"00:%M",[bt]:":%S",[jt]:".%L",["".concat(be,"-").concat(ve)]:"%Y-%m ",["".concat(be,"-").concat(ve,"-").concat(Ge)]:"%Y-%m-%d ",["".concat(St,"-").concat(we)]:"%H:%M"};function pt(Ot,Fr){const $t=Object(l.p)({},Ft,Fr),Se=Ut(Ot),me=Se.length;let Ce,Me,rt="",kt=0;for(kt=0;kt<me;)for(Ce=Se.length;Ce>kt;--Ce)if($t[Me=Se.slice(kt,Ce).join("-")]!=null){rt+=$t[Me],kt=Ce;break}return rt.trim()}const yt=new Date;function nn(Ot){return yt.setFullYear(Ot),yt.setMonth(0),yt.setDate(1),yt.setHours(0,0,0,0),yt}function xt(Ot){return Yt(new Date(Ot))}function _t(Ot){return Fn(new Date(Ot))}function Yt(Ot){return C.a.count(nn(Ot.getFullYear())-1,Ot)}function Fn(Ot){return S.b.count(nn(Ot.getFullYear())-1,Ot)}function Rn(Ot){return nn(Ot).getDay()}function cn(Ot,Fr,$t,Se,me,Ce,Me){if(0<=Ot&&Ot<100){const rt=new Date(-1,Fr,$t,Se,me,Ce,Me);return rt.setFullYear(Ot),rt}return new Date(Ot,Fr,$t,Se,me,Ce,Me)}function qe(Ot){return $e(new Date(Ot))}function Qe(Ot){return ft(new Date(Ot))}function $e(Ot){const Fr=Date.UTC(Ot.getUTCFullYear(),0,1);return O.a.count(Fr-1,Ot)}function ft(Ot){const Fr=Date.UTC(Ot.getUTCFullYear(),0,1);return U.b.count(Fr-1,Ot)}function Jt(Ot){return yt.setTime(Date.UTC(Ot,0,1)),yt.getUTCDay()}function Qt(Ot,Fr,$t,Se,me,Ce,Me){if(0<=Ot&&Ot<100){const rt=new Date(Date.UTC(-1,Fr,$t,Se,me,Ce,Me));return rt.setUTCFullYear($t.y),rt}return new Date(Date.UTC(Ot,Fr,$t,Se,me,Ce,Me))}function Pn(Ot,Fr,$t,Se,me){const Ce=Fr||1,Me=Object(l.W)(Ot),rt=(fn,tn,Ve)=>function(Ln,Xn,Zn,cr){const Br=Zn<=1?Ln:cr?(Sr,yi)=>cr+Zn*Math.floor((Ln(Sr,yi)-cr)/Zn):(Sr,yi)=>Zn*Math.floor(Ln(Sr,yi)/Zn);return Xn?(Sr,yi)=>Xn(Br(Sr,yi),yi):Br}($t[Ve=Ve||fn],Se[Ve],fn===Me&&Ce,tn),kt=new Date,en=Object(l.Fa)(Ot),En=en[be]?rt(be):Object(l.m)(2012),Nt=en[ve]?rt(ve):en[Ee]?rt(Ee):l.Ma,Kt=en[ge]&&en[ht]?rt(ht,1,ge+ht):en[ge]?rt(ge,1):en[ht]?rt(ht,1):en[Ge]?rt(Ge,1):en[It]?rt(It,1):l.Q,hn=en[St]?rt(St):l.Ma,un=en[we]?rt(we):l.Ma,mt=en[bt]?rt(bt):l.Ma,Tt=en[jt]?rt(jt):l.Ma;return function(fn){kt.setTime(+fn);const tn=En(kt);return me(tn,Nt(kt),Kt(kt,tn),hn(kt),un(kt),mt(kt),Tt(kt))}}function kn(Ot,Fr,$t){return Fr+7*Ot-($t+6)%7}const Qn={[be]:Ot=>Ot.getFullYear(),[Ee]:Ot=>Math.floor(Ot.getMonth()/3),[ve]:Ot=>Ot.getMonth(),[Ge]:Ot=>Ot.getDate(),[St]:Ot=>Ot.getHours(),[we]:Ot=>Ot.getMinutes(),[bt]:Ot=>Ot.getSeconds(),[jt]:Ot=>Ot.getMilliseconds(),[It]:Ot=>Yt(Ot),[ge]:Ot=>Fn(Ot),[ge+ht]:(Ot,Fr)=>kn(Fn(Ot),Ot.getDay(),Rn(Fr)),[ht]:(Ot,Fr)=>kn(1,Ot.getDay(),Rn(Fr))},ke={[Ee]:Ot=>3*Ot,[ge]:(Ot,Fr)=>kn(Ot,0,Rn(Fr))};function ar(Ot,Fr){return Pn(Ot,Fr||1,Qn,ke,cn)}const Tr={[be]:Ot=>Ot.getUTCFullYear(),[Ee]:Ot=>Math.floor(Ot.getUTCMonth()/3),[ve]:Ot=>Ot.getUTCMonth(),[Ge]:Ot=>Ot.getUTCDate(),[St]:Ot=>Ot.getUTCHours(),[we]:Ot=>Ot.getUTCMinutes(),[bt]:Ot=>Ot.getUTCSeconds(),[jt]:Ot=>Ot.getUTCMilliseconds(),[It]:Ot=>$e(Ot),[ge]:Ot=>ft(Ot),[ht]:(Ot,Fr)=>kn(1,Ot.getUTCDay(),Jt(Fr)),[ge+ht]:(Ot,Fr)=>kn(ft(Ot),Ot.getUTCDay(),Jt(Fr))},rn={[Ee]:Ot=>3*Ot,[ge]:(Ot,Fr)=>kn(Ot,0,Jt(Fr))};function Ht(Ot,Fr){return Pn(Ot,Fr||1,Tr,rn,Qt)}const Gn={[be]:j.a,[Ee]:N.a.every(3),[ve]:N.a,[ge]:S.b,[Ge]:C.a,[ht]:C.a,[It]:C.a,[St]:L.a,[we]:W.a,[bt]:z.a,[jt]:q.a},Xt={[be]:I.a,[Ee]:Z.a.every(3),[ve]:Z.a,[ge]:U.b,[Ge]:O.a,[ht]:O.a,[It]:O.a,[St]:Y.a,[we]:G.a,[bt]:z.a,[jt]:q.a};function Wt(Ot){return Gn[Ot]}function Zt(Ot){return Xt[Ot]}function Vn(Ot,Fr,$t){return Ot?Ot.offset(Fr,$t):void 0}function xn(Ot,Fr,$t){return Vn(Wt(Ot),Fr,$t)}function Un(Ot,Fr,$t){return Vn(Zt(Ot),Fr,$t)}function ur(Ot,Fr,$t,Se){return Ot?Ot.range(Fr,$t,Se):void 0}function sr(Ot,Fr,$t,Se){return ur(Wt(Ot),Fr,$t,Se)}function Er(Ot,Fr,$t,Se){return ur(Zt(Ot),Fr,$t,Se)}const Mr=31536e6,pr=[be,ve,Ge,St,we,bt,jt],ri=pr.slice(0,-1),Kr=ri.slice(0,-1),ti=Kr.slice(0,-1),jn=ti.slice(0,-1),ir=[be,ve],Cr=[be],Hr=[[ri,1,1e3],[ri,5,5e3],[ri,15,15e3],[ri,30,3e4],[Kr,1,6e4],[Kr,5,3e5],[Kr,15,9e5],[Kr,30,18e5],[ti,1,36e5],[ti,3,108e5],[ti,6,216e5],[ti,12,432e5],[jn,1,864e5],[[be,ge],1,6048e5],[ir,1,2592e6],[ir,3,7776e6],[Cr,1,Mr]];function qr(Ot){const Fr=Ot.extent,$t=Ot.maxbins||40,Se=Math.abs(Object(l.Z)(Fr))/$t;let me,Ce,Me=Object(oe.a)(rt=>rt[2]).right(Hr,Se);return Me===Hr.length?(me=Cr,Ce=Object(ce.c)(Fr[0]/Mr,Fr[1]/Mr,$t)):Me?(me=(Me=Hr[Se/Hr[Me-1][2]<Hr[Me][2]/Se?Me-1:Me])[0],Ce=Me[1]):(me=pr,Ce=Math.max(Object(ce.c)(Fr[0],Fr[1],$t),1)),{units:me,step:Ce}}},function(u,s,r){r.d(s,"e",function(){return l}),r.d(s,"c",function(){return C}),r.d(s,"b",function(){return S}),r.d(s,"a",function(){return O}),r.d(s,"f",function(){return U}),r.d(s,"d",function(){return j}),r.d(s,"g",function(){return N});const l=1e3,C=60*l,S=60*C,O=24*S,U=7*O,j=30*O,N=365*O},function(u,s){u.exports=function(r){return typeof r=="object"?r!==null:typeof r=="function"}},function(u,s,r){var l=r(13);u.exports=function(C){if(!l(C))throw TypeError(C+" is not an object!");return C}},function(u,s){u.exports=function(r){try{return!!r()}catch{return!0}}},function(u,s){var r=u.exports=typeof window<"u"&&window.Math==Math?window:typeof self<"u"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=r)},function(u,s,r){u.exports=r(280)},function(u,s){u.exports=function(r,l,C){return l in r?Object.defineProperty(r,l,{value:C,enumerable:!0,configurable:!0,writable:!0}):r[l]=C,r},u.exports.__esModule=!0,u.exports.default=u.exports},function(u,s,r){var l=r(129)("wks"),C=r(84),S=r(16).Symbol,O=typeof S=="function";(u.exports=function(U){return l[U]||(l[U]=O&&S[U]||(O?S:C)("Symbol."+U))}).store=l},function(u,s,r){r.r(s),function(l){r.d(s,"GraphModel",function(){return Ot}),r.d(s,"loadGraphModel",function(){return Fr}),r.d(s,"deregisterOp",function(){return q}),r.d(s,"registerOp",function(){return W}),r.d(s,"version_converter",function(){return $t});var C,S,O=r(0),U=function(){return(U=Object.assign||function(Se){for(var me,Ce=1,Me=arguments.length;Ce<Me;Ce++)for(var rt in me=arguments[Ce])Object.prototype.hasOwnProperty.call(me,rt)&&(Se[rt]=me[rt]);return Se}).apply(this,arguments)};function j(Se,me,Ce,Me){return new(Ce||(Ce=Promise))(function(rt,kt){function en(Kt){try{Nt(Me.next(Kt))}catch(hn){kt(hn)}}function En(Kt){try{Nt(Me.throw(Kt))}catch(hn){kt(hn)}}function Nt(Kt){Kt.done?rt(Kt.value):new Ce(function(hn){hn(Kt.value)}).then(en,En)}Nt((Me=Me.apply(Se,me||[])).next())})}function N(Se,me){var Ce,Me,rt,kt,en={label:0,sent:function(){if(1&rt[0])throw rt[1];return rt[1]},trys:[],ops:[]};return kt={next:En(0),throw:En(1),return:En(2)},typeof Symbol=="function"&&(kt[Symbol.iterator]=function(){return this}),kt;function En(Nt){return function(Kt){return function(hn){if(Ce)throw new TypeError("Generator is already executing.");for(;en;)try{if(Ce=1,Me&&(rt=2&hn[0]?Me.return:hn[0]?Me.throw||((rt=Me.return)&&rt.call(Me),0):Me.next)&&!(rt=rt.call(Me,hn[1])).done)return rt;switch(Me=0,rt&&(hn=[2&hn[0],rt.value]),hn[0]){case 0:case 1:rt=hn;break;case 4:return en.label++,{value:hn[1],done:!1};case 5:en.label++,Me=hn[1],hn=[0];continue;case 7:hn=en.ops.pop(),en.trys.pop();continue;default:if(!(rt=(rt=en.trys).length>0&&rt[rt.length-1])&&(hn[0]===6||hn[0]===2)){en=0;continue}if(hn[0]===3&&(!rt||hn[1]>rt[0]&&hn[1]<rt[3])){en.label=hn[1];break}if(hn[0]===6&&en.label<rt[1]){en.label=rt[1],rt=hn;break}if(rt&&en.label<rt[2]){en.label=rt[2],en.ops.push(hn);break}rt[2]&&en.ops.pop(),en.trys.pop();continue}hn=me.call(Se,en)}catch(un){hn=[6,un],Me=0}finally{Ce=rt=0}if(5&hn[0])throw hn[1];return{value:hn[0]?hn[1]:void 0,done:!0}}([Nt,Kt])}}}(function(Se){Se[Se.DT_INVALID=0]="DT_INVALID",Se[Se.DT_FLOAT=1]="DT_FLOAT",Se[Se.DT_DOUBLE=2]="DT_DOUBLE",Se[Se.DT_INT32=3]="DT_INT32",Se[Se.DT_UINT8=4]="DT_UINT8",Se[Se.DT_INT16=5]="DT_INT16",Se[Se.DT_INT8=6]="DT_INT8",Se[Se.DT_STRING=7]="DT_STRING",Se[Se.DT_COMPLEX64=8]="DT_COMPLEX64",Se[Se.DT_INT64=9]="DT_INT64",Se[Se.DT_BOOL=10]="DT_BOOL",Se[Se.DT_QINT8=11]="DT_QINT8",Se[Se.DT_QUINT8=12]="DT_QUINT8",Se[Se.DT_QINT32=13]="DT_QINT32",Se[Se.DT_BFLOAT16=14]="DT_BFLOAT16",Se[Se.DT_FLOAT_REF=101]="DT_FLOAT_REF",Se[Se.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",Se[Se.DT_INT32_REF=103]="DT_INT32_REF",Se[Se.DT_UINT8_REF=104]="DT_UINT8_REF",Se[Se.DT_INT16_REF=105]="DT_INT16_REF",Se[Se.DT_INT8_REF=106]="DT_INT8_REF",Se[Se.DT_STRING_REF=107]="DT_STRING_REF",Se[Se.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",Se[Se.DT_INT64_REF=109]="DT_INT64_REF",Se[Se.DT_BOOL_REF=110]="DT_BOOL_REF",Se[Se.DT_QINT8_REF=111]="DT_QINT8_REF",Se[Se.DT_QUINT8_REF=112]="DT_QUINT8_REF",Se[Se.DT_QINT32_REF=113]="DT_QINT32_REF",Se[Se.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"})(C||(C={})),function(Se){(function(me){me[me.LEGACY=0]="LEGACY",me[me.V1=1]="V1",me[me.V2=2]="V2"})(Se.CheckpointFormatVersion||(Se.CheckpointFormatVersion={}))}(S||(S={}));var L={};function W(Se,me){var Ce={tfOpName:Se,category:"custom",inputs:[],attrs:[],customExecutor:me};L[Se]=Ce}function z(Se){return L[Se]}function q(Se){delete L[Se]}function I(Se,me,Ce,Me){var rt=me.inputParams[Se];if(rt&&rt.inputIndexStart!==void 0){var kt=rt.inputIndexStart,en=rt.inputIndexEnd===0?void 0:rt.inputIndexEnd===void 0?kt+1:rt.inputIndexEnd;if(rt.type==="tensor")return Z(me.inputNames[rt.inputIndexStart],Ce,Me);if(rt.type==="tensors")return me.inputNames.slice(kt,en).map(function(Kt){return Z(Kt,Ce,Me)});var En=Array.prototype.slice.call(Z(me.inputNames.slice(kt)[0],Ce,Me).dataSync());return rt.type==="number"?En[0]:En}var Nt=me.attrParams[Se];return Nt&&Nt.value}function Z(Se,me,Ce){var Me=oe(Se),rt=Me[0],kt=Me[1],en=Ce.currentContextIds.find(function(En){return!!me[G(rt,En)]});return en!==void 0?me[G(rt,en)][kt]:void 0}function Y(Se,me){var Ce=oe(Se),Me=Ce[0],rt=Ce[1];return[G(Me,me&&me.currentContextId),rt]}function G(Se,me){return me?Se+"-"+me:Se}function oe(Se){var me=Se.lastIndexOf(":");return me===-1?[Se,0]:[Se.substring(0,me),Number(Se.substring(me+1))]}function ce(Se,me){for(var Ce=[],Me=0;Me<Se.length;Me+=me)Ce.push(Se.slice(Me,Me+me));return Ce}var be=Object.freeze({json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Ee=Object.freeze({json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"clip_value_min",name:"clipValueMin",type:"number"},{tfName:"clip_value_max",name:"clipValueMax",type:"number"}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"clipValueMin",name:"clipValueMin",type:"number",defaultValue:0},{tfName:"clipValueMax",name:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),ve=Object.freeze({json:[{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"}]}]}),ge=Object.freeze({json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]}]}),Ge=Object.freeze({json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]}),ht=Object.freeze({json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),It=Object.freeze({json:[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]}]}),St=Object.freeze({json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]}),we=Object.freeze({json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}]}),bt=Object.freeze({json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),jt=Object.freeze({json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Mt=Object.freeze({json:[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]}),ze=Object.freeze({json:[{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]}]}),Ut=Object.freeze({json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]}),Ft=Object.freeze({json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]}),pt=Object.freeze({json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]}]}),yt=function(){function Se(){var me=[be,Ee,ve,ge,Ge,ht,It,bt,we,St,jt,Mt,ze,Ut,Ft,pt],Ce=[].concat.apply([],me.map(function(Me){return Me.json}));this.opMappers=Ce.reduce(function(Me,rt){return Me[rt.tfOpName]=rt,Me},{})}return Object.defineProperty(Se,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),Se.prototype.transformGraph=function(me,Ce){var Me=this;Ce===void 0&&(Ce={});var rt=[],kt=[],en=me.node.reduce(function(mt,Tt){return mt[Tt.name]=Me.mapNode(Tt),Tt.op.startsWith("Placeholder")&&rt.push(mt[Tt.name]),Tt.op==="Const"&&kt.push(mt[Tt.name]),mt},{}),En=[],Nt=[],Kt={},hn={};Ce!=null&&(Kt=this.mapSignatureEntries(Ce.inputs),hn=this.mapSignatureEntries(Ce.outputs));var un=Object.keys(en);return un.forEach(function(mt){var Tt=en[mt];Tt.inputNames.forEach(function(fn){var tn=Y(fn)[0];Tt.inputs.push(en[tn]),en[tn].children.push(Tt)})}),Object.keys(hn).length===0?un.forEach(function(mt){var Tt=en[mt];Tt.children.length===0&&Nt.push(Tt)}):Object.keys(hn).forEach(function(mt){var Tt=Y(mt)[0],fn=en[Tt];fn!=null&&(fn.signatureKey=hn[mt],Nt.push(fn))}),Object.keys(Kt).length>0?Object.keys(Kt).forEach(function(mt){var Tt=Y(mt)[0],fn=en[Tt];fn&&(fn.signatureKey=Kt[mt],En.push(fn))}):En=rt,{nodes:en,inputs:En,outputs:Nt,weights:kt,placeholders:rt,signature:Ce}},Se.prototype.mapSignatureEntries=function(me){return Object.keys(me||{}).reduce(function(Ce,Me){return Ce[me[Me].name]=Me,Ce},{})},Se.prototype.mapNode=function(me){var Ce=z(me.op)||this.opMappers[me.op]||{};me.attr==null&&(me.attr={});var Me={name:me.name,op:me.op,category:Ce.category,inputNames:(me.input||[]).map(function(rt){return rt.startsWith("^")?rt.substr(1):rt}),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:me.attr};return Ce.inputs!=null&&(Me.inputParams=Ce.inputs.reduce(function(rt,kt){return rt[kt.name]={type:kt.type,inputIndexStart:kt.start,inputIndexEnd:kt.end},rt},{})),Ce.attrs!=null&&(Me.attrParams=Ce.attrs.reduce(function(rt,kt){var en=kt.type,En=void 0;switch(kt.type){case"string":(En=xt(me.attr,kt.tfName,kt.defaultValue))===void 0&&kt.tfDeprecatedName&&(En=xt(me.attr,kt.tfDeprecatedName,kt.defaultValue));break;case"string[]":(En=ft(me.attr,kt.tfName,kt.defaultValue))===void 0&&kt.tfDeprecatedName&&(En=ft(me.attr,kt.tfDeprecatedName,kt.defaultValue));break;case"number":(En=Yt(me.attr,kt.tfName,kt.defaultValue||0))===void 0&&kt.tfDeprecatedName&&(En=Yt(me.attr,kt.tfDeprecatedName,kt.defaultValue));break;case"number[]":(En=$e(me.attr,kt.tfName,kt.defaultValue))===void 0&&kt.tfDeprecatedName&&(En=$e(me.attr,kt.tfDeprecatedName,kt.defaultValue));break;case"bool":(En=_t(me.attr,kt.tfName,kt.defaultValue))===void 0&&kt.tfDeprecatedName&&(En=_t(me.attr,kt.tfDeprecatedName,kt.defaultValue));break;case"bool[]":(En=Qt(me.attr,kt.tfName,kt.defaultValue))===void 0&&kt.tfDeprecatedName&&(En=Qt(me.attr,kt.tfDeprecatedName,kt.defaultValue));break;case"shape":(En=Qe(me.attr,kt.tfName,kt.defaultValue))===void 0&&kt.tfDeprecatedName&&(En=Qe(me.attr,kt.tfDeprecatedName,kt.defaultValue));break;case"shape[]":(En=Jt(me.attr,kt.tfName,kt.defaultValue))===void 0&&kt.tfDeprecatedName&&(En=Jt(me.attr,kt.tfDeprecatedName,kt.defaultValue));break;case"dtype":(En=Rn(me.attr,kt.tfName,kt.defaultValue))===void 0&&kt.tfDeprecatedName&&(En=Rn(me.attr,kt.tfDeprecatedName,kt.defaultValue));break;case"dtype[]":(En=cn(me.attr,kt.tfName,kt.defaultValue))===void 0&&kt.tfDeprecatedName&&(En=cn(me.attr,kt.tfDeprecatedName,kt.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+kt.type+" for op: "+me.op)}return rt[kt.name]={value:En,type:en},rt},{})),Me},Se}();function nn(Se,me){var Ce=Array.isArray(Se)?String.fromCharCode.apply(null,Se):function(Me){var rt=Object(O.env)().global;if(rt.atob!==void 0)return rt.atob(Me);if(l!==void 0)return new l(Me,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(Se);return me?Ce:Ce.toLowerCase()}function xt(Se,me,Ce,Me){Me===void 0&&(Me=!1);var rt=Se[me];return rt!=null?nn(rt.s,Me):Ce}function _t(Se,me,Ce){var Me=Se[me];return Me?Me.b:Ce}function Yt(Se,me,Ce){var Me=Se[me]||{},rt=Me.i!=null?Me.i:Me.f!=null?Me.f:Ce;return typeof rt=="number"?rt:parseInt(rt,10)}function Fn(Se){switch(typeof Se=="string"&&(Se=C[Se]),Se){case C.DT_FLOAT:return"float32";case C.DT_INT32:case C.DT_INT64:case C.DT_INT8:case C.DT_UINT8:return"int32";case C.DT_BOOL:return"bool";case C.DT_DOUBLE:return"float32";case C.DT_STRING:return"string";default:return null}}function Rn(Se,me,Ce){var Me=Se[me];return Me&&Me.type?Fn(Me.type):Ce}function cn(Se,me,Ce){var Me=Se[me];return Me&&Me.list&&Me.list.type?Me.list.type.map(function(rt){return Fn(rt)}):Ce}function qe(Se){if(!Se.unknownRank)return Se.dim!=null?Se.dim.map(function(me){return typeof me.size=="number"?me.size:parseInt(me.size,10)}):[]}function Qe(Se,me,Ce){var Me=Se[me];return Me&&Me.shape?qe(Me.shape):Ce}function $e(Se,me,Ce){var Me=Se[me];return Me?((Me.list.f&&Me.list.f.length?Me.list.f:Me.list.i)||[]).map(function(rt){return typeof rt=="number"?rt:parseInt(rt,10)}):Ce}function ft(Se,me,Ce,Me){Me===void 0&&(Me=!1);var rt=Se[me];return rt&&rt.list&&rt.list.s?rt.list.s.map(function(kt){return nn(kt,Me)}):Ce}function Jt(Se,me,Ce){var Me=Se[me];return Me&&Me.list&&Me.list.shape?Me.list.shape.map(function(rt){return qe(rt)}):Ce}function Qt(Se,me,Ce){var Me=Se[me];return Me&&Me.list&&Me.list.b?Me.list.b:Ce}var Pn=function(){function Se(me,Ce,Me){var rt=this;this.node=me,this.tensorMap=Ce,this.context=Me,this.inputs=[],this.attrs={},this.inputs=me.inputNames.map(function(kt){return rt.getInput(kt)}),me.rawAttrs!=null&&(this.attrs=Object.keys(me.rawAttrs).reduce(function(kt,en){return kt[en]=rt.getAttr(en),kt},{}))}return Se.prototype.getInput=function(me){return Z(me,this.tensorMap,this.context)},Se.prototype.getAttr=function(me,Ce){var Me=this.node.rawAttrs[me];if(Me.tensor!=null)return Z(me,this.tensorMap,this.context);if(Me.i!=null||Me.f!=null)return Yt(this.node.rawAttrs,me,Ce);if(Me.s!=null)return xt(this.node.rawAttrs,me,Ce);if(Me.b!=null)return _t(this.node.rawAttrs,me,Ce);if(Me.shape!=null)return Qe(this.node.rawAttrs,me,Ce);if(Me.type!=null)return Rn(this.node.rawAttrs,me,Ce);if(Me.list!=null){if(Me.list.i!=null||Me.list.f!=null)return $e(this.node.rawAttrs,me,Ce);if(Me.list.s!=null)return ft(this.node.rawAttrs,me,Ce);if(Me.list.shape!=null)return Jt(this.node.rawAttrs,me,Ce);if(Me.list.b!=null)return Qt(this.node.rawAttrs,me,Ce);if(Me.list.type!=null)return cn(this.node.rawAttrs,me,Ce)}return Ce},Se}(),kn=function(Se,me,Ce){switch(Se.op){case"BiasAdd":case"AddV2":case"Add":return[Object(O.add)(I("a",Se,me,Ce),I("b",Se,me,Ce))];case"AddN":return[Object(O.addN)(I("tensors",Se,me,Ce))];case"FloorMod":case"Mod":return[Object(O.mod)(I("a",Se,me,Ce),I("b",Se,me,Ce))];case"Mul":return[Object(O.mul)(I("a",Se,me,Ce),I("b",Se,me,Ce))];case"RealDiv":case"Div":return[Object(O.div)(I("a",Se,me,Ce),I("b",Se,me,Ce))];case"DivNoNan":return[Object(O.divNoNan)(I("a",Se,me,Ce),I("b",Se,me,Ce))];case"FloorDiv":return[Object(O.floorDiv)(I("a",Se,me,Ce),I("b",Se,me,Ce))];case"Sub":return[Object(O.sub)(I("a",Se,me,Ce),I("b",Se,me,Ce))];case"Minimum":return[Object(O.minimum)(I("a",Se,me,Ce),I("b",Se,me,Ce))];case"Maximum":return[Object(O.maximum)(I("a",Se,me,Ce),I("b",Se,me,Ce))];case"Pow":return[Object(O.pow)(I("a",Se,me,Ce),I("b",Se,me,Ce))];case"SquaredDifference":return[Object(O.squaredDifference)(I("a",Se,me,Ce),I("b",Se,me,Ce))];default:throw TypeError("Node type "+Se.op+" is not implemented")}},Qn=function(Se,me,Ce){switch(Se.op){case"Abs":case"ComplexAbs":return[Object(O.abs)(I("x",Se,me,Ce))];case"Acos":return[Object(O.acos)(I("x",Se,me,Ce))];case"Acosh":return[Object(O.acosh)(I("x",Se,me,Ce))];case"Asin":return[Object(O.asin)(I("x",Se,me,Ce))];case"Asinh":return[Object(O.asinh)(I("x",Se,me,Ce))];case"Atan":return[Object(O.atan)(I("x",Se,me,Ce))];case"Atan2":return[Object(O.atan2)(I("x",Se,me,Ce),I("y",Se,me,Ce))];case"Atanh":return[Object(O.atanh)(I("x",Se,me,Ce))];case"Ceil":return[Object(O.ceil)(I("x",Se,me,Ce))];case"Complex":return[Object(O.complex)(I("real",Se,me,Ce),I("imag",Se,me,Ce))];case"Cos":return[Object(O.cos)(I("x",Se,me,Ce))];case"Cosh":return[Object(O.cosh)(I("x",Se,me,Ce))];case"Elu":return[Object(O.elu)(I("x",Se,me,Ce))];case"Erf":return[Object(O.erf)(I("x",Se,me,Ce))];case"Exp":return[Object(O.exp)(I("x",Se,me,Ce))];case"Expm1":return[Object(O.expm1)(I("x",Se,me,Ce))];case"Floor":return[Object(O.floor)(I("x",Se,me,Ce))];case"Log":return[Object(O.log)(I("x",Se,me,Ce))];case"Log1p":return[Object(O.log1p)(I("x",Se,me,Ce))];case"Imag":return[Object(O.imag)(I("x",Se,me,Ce))];case"Neg":return[Object(O.neg)(I("x",Se,me,Ce))];case"Reciprocal":return[Object(O.reciprocal)(I("x",Se,me,Ce))];case"Real":return[Object(O.real)(I("x",Se,me,Ce))];case"Relu":return[Object(O.relu)(I("x",Se,me,Ce))];case"Round":return[Object(O.round)(I("x",Se,me,Ce))];case"Selu":return[Object(O.selu)(I("x",Se,me,Ce))];case"Sigmoid":return[Object(O.sigmoid)(I("x",Se,me,Ce))];case"Sin":return[Object(O.sin)(I("x",Se,me,Ce))];case"Sign":return[Object(O.sign)(I("x",Se,me,Ce))];case"Sinh":return[Object(O.sinh)(I("x",Se,me,Ce))];case"Softplus":return[Object(O.softplus)(I("x",Se,me,Ce))];case"Sqrt":return[Object(O.sqrt)(I("x",Se,me,Ce))];case"Square":return[Object(O.square)(I("x",Se,me,Ce))];case"Tanh":return[Object(O.tanh)(I("x",Se,me,Ce))];case"Tan":return[Object(O.tan)(I("x",Se,me,Ce))];case"Relu6":case"ClipByValue":return[Object(O.clipByValue)(I("x",Se,me,Ce),I("clipValueMin",Se,me,Ce),I("clipValueMax",Se,me,Ce))];case"Rsqrt":return[Object(O.rsqrt)(Z(Se.inputNames[0],me,Ce))];case"Prod":return[Object(O.prod)(I("x",Se,me,Ce),I("axes",Se,me,Ce))];case"LeakyRelu":return[Object(O.leakyRelu)(I("x",Se,me,Ce),I("alpha",Se,me,Ce))];case"Prelu":return[Object(O.prelu)(I("x",Se,me,Ce),I("alpha",Se,me,Ce))];default:throw TypeError("Node type "+Se.op+" is not implemented")}},ke=function(){function Se(me,Ce,Me,rt,kt,en,En){this.name=me,this.dtype=Ce,this.maxSize=Me,this.elementShape=rt,this.identicalElementShapes=kt,this.dynamicSize=en,this.clearAfterRead=En,this.tensors=[],this.closed_=!1,this.id=Se.nextId++}return Object.defineProperty(Se.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),Se.prototype.clearAndClose=function(){this.tensors.forEach(function(me){return me.tensor.dispose()}),this.tensors=[],this.closed_=!0},Se.prototype.size=function(){return this.tensors.length},Se.prototype.read=function(me){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(me<0||me>=this.tensors.length)throw new Error("Tried to read from index "+me+", but array size is: "+this.tensors.length);var Ce=this.tensors[me];if(Ce.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+me+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(Ce.cleared=!0),Ce.read=!0,Ce.tensor},Se.prototype.readMany=function(me){var Ce=this;return me.map(function(Me){return Ce.read(Me)})},Se.prototype.write=function(me,Ce){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(me<0||!this.dynamicSize&&me>=this.maxSize)throw new Error("Tried to write to index "+me+", but array is not resizeable and size is: "+this.maxSize);var Me=this.tensors[me]||{};if(Ce.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+me+`,
          because the value dtype is `+Ce.dtype+", but TensorArray dtype is "+this.dtype+".");if(this.size()!==0||this.elementShape!=null&&this.elementShape.length!==0||(this.elementShape=Ce.shape),this.assertShapesMatchAllowUndefinedSize(this.elementShape,Ce.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+me+"."),Me&&Me.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+me+", because it has already been read.");if(Me&&Me.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+me+", because it has already been written.");Me.tensor=Ce,Me.written=!0,this.tensors[me]=Me},Se.prototype.writeMany=function(me,Ce){var Me=this;if(me.length!==Ce.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,because the index size: "+me.length+" is not the same as tensors size: "+Ce.length+".");me.forEach(function(rt,kt){return Me.write(rt,Ce[kt])})},Se.prototype.gather=function(me,Ce){if(Ce&&Ce!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+Ce);if(!me){me=[];for(var Me=0;Me<this.size();Me++)me.push(Me)}if(me.length===0)return Object(O.tensor)([],[0].concat(this.elementShape));var rt=this.readMany(me);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,rt[0].shape,"TensorArray shape mismatch: "),Object(O.stack)(rt,0)},Se.prototype.concat=function(me){if(me&&me!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+me);if(this.size()===0)return Object(O.tensor)([],[0].concat(this.elementShape));for(var Ce=[],Me=0;Me<this.size();Me++)Ce.push(Me);var rt=this.readMany(Ce);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,rt[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+rt[0].shape+")"),Object(O.concat)(rt,0)},Se.prototype.scatter=function(me,Ce){if(Ce.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+Ce.dtype);if(me.length!==Ce.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+me.length+" vs. "+Ce.shape[0]);var Me=Math.max.apply(Math,me);if(!this.dynamicSize&&Me>=this.maxSize)throw new Error("Max index must be < array size ("+Me+"  vs. "+this.maxSize+")");this.writeMany(me,Object(O.unstack)(Ce,0))},Se.prototype.split=function(me,Ce){var Me=this;if(Ce.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+Ce.dtype);var rt=0,kt=me.map(function(hn){return rt+=hn});if(rt!==Ce.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `+rt+", and tensor's shape is: "+Ce.shape);if(!this.dynamicSize&&me.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+me.length+"), and the TensorArray is not marked as dynamically resizeable");var en=rt===0?0:Ce.size/rt,En=[];Object(O.tidy)(function(){Ce=Ce.reshape([1,rt,en]);for(var hn=0;hn<me.length;++hn){var un=[0,hn===0?0:kt[hn-1],0],mt=[1,me[hn],en];En[hn]=Object(O.slice)(Ce,un,mt).reshape(Me.elementShape)}return En});for(var Nt=[],Kt=0;Kt<me.length;Kt++)Nt[Kt]=Kt;this.writeMany(Nt,En)},Se.prototype.assertShapesMatchAllowUndefinedSize=function(me,Ce,Me){Me===void 0&&(Me=""),O.util.assert(this.shapesEqualAllowUndefinedSize(me,Ce),function(){return Me+" Shapes "+me+" and "+Ce+" must match"})},Se.prototype.shapesEqualAllowUndefinedSize=function(me,Ce){if(me.length!==Ce.length)return!1;for(var Me=0;Me<me.length;Me++)if(me[Me]!==-1&&Ce[Me]!==-1&&me[Me]!==Ce[Me])return!1;return!0},Se.nextId=0,Se}(),ar=function(Se,me,Ce){return j(void 0,void 0,void 0,function(){var Me,rt,kt,en,En,Nt,Kt,hn,un,mt,Tt,fn,tn,Ve,Ln,Xn,Zn,cr,Br,Sr,yi,ki,Zr,Zi,gi,ei,Xr,Kn,di,Ei,zr,oo,zi,eo,wo;return N(this,function(ba){switch(ba.label){case 0:switch(Se.op){case"LoopCond":return[3,1];case"Switch":return[3,2];case"Merge":return[3,4];case"Enter":return[3,5];case"Exit":return[3,6];case"NextIteration":return[3,7];case"TensorArrayV3":return[3,8];case"TensorArrayWriteV3":return[3,9];case"TensorArrayReadV3":return[3,10];case"TensorArrayGatherV3":return[3,11];case"TensorArrayScatterV3":return[3,12];case"TensorArrayConcatV3":return[3,13];case"TensorArraySplitV3":return[3,14];case"TensorArraySizeV3":return[3,15];case"TensorArrayCloseV3":return[3,16]}return[3,17];case 1:return[2,[I("pred",Se,me,Ce).clone()]];case 2:return Me=I("pred",Se,me,Ce),rt=I("data",Se,me,Ce),[4,Me.data()];case 3:return[2,ba.sent()[0]?[void 0,rt.clone()]:[rt.clone(),void 0]];case 4:return[2,(kt=Se.inputNames.find(function(Ts){return Z(Ts,me,Ce)!==void 0}))?[Z(kt,me,Ce).clone()]:void 0];case 5:return en=I("frameName",Se,me,Ce),En=I("tensor",Se,me,Ce),Ce.enterFrame(en),[2,[En.clone()]];case 6:return Nt=I("tensor",Se,me,Ce),Ce.exitFrame(),[2,[Nt.clone()]];case 7:return Kt=I("tensor",Se,me,Ce),Ce.nextIteration(),[2,[Kt.clone()]];case 8:return hn=I("size",Se,me,Ce),un=I("dtype",Se,me,Ce),mt=I("elementShape",Se,me,Ce),Tt=I("dynamicSize",Se,me,Ce),fn=I("clearAfterRead",Se,me,Ce),tn=I("identicalElementShapes",Se,me,Ce),Ve=I("name",Se,me,Ce),Ln=new ke(Ve,un,hn,mt,tn,Tt,fn),Ce.addTensorArray(Ln),[2,[Object(O.scalar)(Ln.id),Object(O.scalar)(1)]];case 9:return Xn=I("tensorArrayId",Se,me,Ce),Zn=I("index",Se,me,Ce),cr=I("tensor",Se,me,Ce),Ce.getTensorArray(Xn).write(Zn,cr),[2,[Object(O.scalar)(1)]];case 10:return Br=I("tensorArrayId",Se,me,Ce),Sr=I("index",Se,me,Ce),[2,[Ce.getTensorArray(Br).read(Sr)]];case 11:return yi=I("tensorArrayId",Se,me,Ce),ki=I("indices",Se,me,Ce),Zr=I("dtype",Se,me,Ce),[2,[Ce.getTensorArray(yi).gather(ki,Zr)]];case 12:return Zi=I("tensorArrayId",Se,me,Ce),gi=I("indices",Se,me,Ce),ei=I("tensor",Se,me,Ce),Ce.getTensorArray(Zi).scatter(gi,ei),[2,[Object(O.scalar)(1)]];case 13:return Xr=I("tensorArrayId",Se,me,Ce),Kn=Ce.getTensorArray(Xr),di=I("dtype",Se,me,Ce),[2,[Kn.concat(di)]];case 14:return Ei=I("tensorArrayId",Se,me,Ce),zr=I("tensor",Se,me,Ce),oo=I("lengths",Se,me,Ce),Ce.getTensorArray(Ei).split(oo,zr),[2,[Object(O.scalar)(1)]];case 15:return zi=I("tensorArrayId",Se,me,Ce),eo=Ce.getTensorArray(zi),[2,[Object(O.scalar)(eo.size(),"int32")]];case 16:return wo=I("tensorArrayId",Se,me,Ce),Ce.getTensorArray(wo).clearAndClose(),[2,[Object(O.scalar)(0)]];case 17:throw TypeError("Node type "+Se.op+" is not implemented")}})})},Tr=function(Se,me,Ce){switch(Se.op){case"Conv1D":var Me=I("stride",Se,me,Ce),rt=I("pad",Se,me,Ce),kt=I("dataFormat",Se,me,Ce).toUpperCase(),en=I("dilation",Se,me,Ce);return[Object(O.conv1d)(I("x",Se,me,Ce),I("filter",Se,me,Ce),Me,rt,kt,en)];case"Conv2D":Me=I("strides",Se,me,Ce),rt=I("pad",Se,me,Ce),kt=I("dataFormat",Se,me,Ce).toUpperCase();var En=I("dilations",Se,me,Ce);return[Object(O.conv2d)(I("x",Se,me,Ce),I("filter",Se,me,Ce),[Me[1],Me[2]],rt,kt,[En[1],En[2]])];case"_FusedConv2D":case"FusedDepthwiseConv2dNative":var Nt=I("fusedOps",Se,me,Ce),Kt=Nt[0],hn=Nt[1],un=Kt==="biasadd",mt=hn==="prelu",Tt=Kt==="fusedbatchnorm",fn=I("numArgs",Se,me,Ce);if(un){if(mt&&fn!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!mt&&fn!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(Tt)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.");Me=I("strides",Se,me,Ce),rt=I("pad",Se,me,Ce),kt=I("dataFormat",Se,me,Ce).toUpperCase(),En=I("dilations",Se,me,Ce);var tn=I("args",Se,me,Ce),Ve=tn[0],Ln=tn[1];return[(Se.op==="_FusedConv2D"?O.fused.conv2d:O.fused.depthwiseConv2d)({x:I("x",Se,me,Ce),filter:I("filter",Se,me,Ce),strides:[Me[1],Me[2]],pad:rt,dataFormat:kt,dilations:[En[1],En[2]],bias:Ve,activation:hn,preluActivationWeights:Ln})];case"Conv2DBackpropInput":case"Conv2dTranspose":var Xn=I("outputShape",Se,me,Ce);return Me=I("strides",Se,me,Ce),rt=I("pad",Se,me,Ce),[Object(O.conv2dTranspose)(I("x",Se,me,Ce),I("filter",Se,me,Ce),Xn,[Me[1],Me[2]],rt)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":return Me=I("strides",Se,me,Ce),rt=I("pad",Se,me,Ce),En=I("dilations",Se,me,Ce),kt=I("dataFormat",Se,me,Ce).toUpperCase(),[Object(O.depthwiseConv2d)(I("input",Se,me,Ce),I("filter",Se,me,Ce),[Me[1],Me[2]],rt,kt,[En[1],En[2]])];case"Conv3D":return Me=I("strides",Se,me,Ce),rt=I("pad",Se,me,Ce),kt=I("dataFormat",Se,me,Ce).toUpperCase(),En=I("dilations",Se,me,Ce),[Object(O.conv3d)(I("x",Se,me,Ce),I("filter",Se,me,Ce),[Me[1],Me[2],Me[3]],rt,kt,[En[1],En[2],En[3]])];case"AvgPool":Me=I("strides",Se,me,Ce),rt=I("pad",Se,me,Ce);var Zn=I("kernelSize",Se,me,Ce);return[Object(O.avgPool)(I("x",Se,me,Ce),[Zn[1],Zn[2]],[Me[1],Me[2]],rt)];case"MaxPool":return Me=I("strides",Se,me,Ce),rt=I("pad",Se,me,Ce),Zn=I("kernelSize",Se,me,Ce),[Object(O.maxPool)(I("x",Se,me,Ce),[Zn[1],Zn[2]],[Me[1],Me[2]],rt)];case"MaxPoolWithArgmax":Me=I("strides",Se,me,Ce),rt=I("pad",Se,me,Ce),Zn=I("kernelSize",Se,me,Ce);var cr=I("includeBatchInIndex",Se,me,Ce),Br=Object(O.maxPoolWithArgmax)(I("x",Se,me,Ce),[Zn[1],Zn[2]],[Me[1],Me[2]],rt,cr);return[Br.result,Br.indexes];case"AvgPool3D":return Me=I("strides",Se,me,Ce),rt=I("pad",Se,me,Ce),Zn=I("kernelSize",Se,me,Ce),[Object(O.avgPool3d)(I("x",Se,me,Ce),[Zn[1],Zn[2],Zn[3]],[Me[1],Me[2],Me[3]],rt)];case"MaxPool3D":return Me=I("strides",Se,me,Ce),rt=I("pad",Se,me,Ce),Zn=I("kernelSize",Se,me,Ce),[Object(O.maxPool3d)(I("x",Se,me,Ce),[Zn[1],Zn[2],Zn[3]],[Me[1],Me[2],Me[3]],rt)];default:throw TypeError("Node type "+Se.op+" is not implemented")}},rn=function(Se,me,Ce){switch(Se.op){case"Fill":var Me=I("shape",Se,me,Ce),rt=I("dtype",Se,me,Ce),kt=I("value",Se,me,Ce);return[Object(O.fill)(Me,kt,rt)];case"LinSpace":var en=I("start",Se,me,Ce),En=I("stop",Se,me,Ce),Nt=I("num",Se,me,Ce);return[Object(O.linspace)(en,En,Nt)];case"Multinomial":var Kt=I("logits",Se,me,Ce),hn=I("numSamples",Se,me,Ce),un=I("seed",Se,me,Ce);return[Object(O.multinomial)(Kt,hn,un)];case"OneHot":var mt=I("indices",Se,me,Ce),Tt=I("depth",Se,me,Ce),fn=I("onValue",Se,me,Ce),tn=I("offValue",Se,me,Ce);return[Object(O.oneHot)(mt,Tt,fn,tn)];case"Ones":return[Object(O.ones)(I("shape",Se,me,Ce),I("dtype",Se,me,Ce))];case"OnesLike":return[Object(O.onesLike)(I("x",Se,me,Ce))];case"RandomUniform":return[Object(O.randomUniform)(I("shape",Se,me,Ce),I("minval",Se,me,Ce),I("maxval",Se,me,Ce),I("dtype",Se,me,Ce))];case"Range":en=I("start",Se,me,Ce);var Ve=I("stop",Se,me,Ce),Ln=I("step",Se,me,Ce);return[Object(O.range)(en,Ve,Ln,I("dtype",Se,me,Ce))];case"TruncatedNormal":Me=I("shape",Se,me,Ce);var Xn=I("mean",Se,me,Ce),Zn=I("stdDev",Se,me,Ce);return un=I("seed",Se,me,Ce),[Object(O.truncatedNormal)(Me,Xn,Zn,I("dtype",Se,me,Ce),un)];case"Zeros":return[Object(O.zeros)(I("shape",Se,me,Ce),I("dtype",Se,me,Ce))];case"ZerosLike":return[Object(O.zerosLike)(I("x",Se,me,Ce))];default:throw TypeError("Node type "+Se.op+" is not implemented")}},Ht=function(Se,me,Ce){return j(void 0,void 0,void 0,function(){var Me,rt,kt,en,En,Nt,Kt,hn;return N(this,function(un){switch(un.label){case 0:switch(Se.op){case"NonMaxSuppressionV5":case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":return[3,1];case"Where":return[3,5];case"ListDiff":return[3,7]}return[3,8];case 1:return Me=I("boxes",Se,me,Ce),rt=I("scores",Se,me,Ce),kt=I("maxOutputSize",Se,me,Ce),en=I("iouThreshold",Se,me,Ce),En=I("scoreThreshold",Se,me,Ce),Se.op!=="NonMaxSuppressionV5"?[3,3]:(Nt=I("softNmsSigma",Se,me,Ce),[4,O.image.nonMaxSuppressionWithScoreAsync(Me,rt,kt,en,En,Nt)]);case 2:return[2,[(hn=un.sent()).selectedIndices,hn.selectedScores]];case 3:return[4,O.image.nonMaxSuppressionAsync(Me,rt,kt,en,En)];case 4:return[2,[un.sent()]];case 5:return Kt=I("condition",Se,me,Ce).asType("bool"),[4,Object(O.whereAsync)(Kt)];case 6:return hn=[un.sent()],Kt.dispose(),[2,hn];case 7:return[2,Object(O.setdiff1dAsync)(I("x",Se,me,Ce),I("y",Se,me,Ce))];case 8:throw TypeError("Node type "+Se.op+" is not implemented")}})})},Gn=function(Se,me,Ce){switch(Se.op){case"TopKV2":var Me=I("x",Se,me,Ce),rt=I("k",Se,me,Ce),kt=I("sorted",Se,me,Ce),en=Object(O.topk)(Me,rt,kt);return[en.values,en.indices];default:throw TypeError("Node type "+Se.op+" is not implemented")}},Xt=function(Se,me,Ce){switch(Se.op){case"Const":return me[Se.name];case"PlaceholderWithDefault":var Me=I("default",Se,me,Ce);return[Z(Se.name,me,Ce)||Me];case"Placeholder":return[Z(Se.name,me,Ce)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[I("x",Se,me,Ce).clone()];case"IdentityN":return I("x",Se,me,Ce).map(function(Kt){return Kt.clone()});case"Snapshot":return[I("x",Se,me,Ce).clone()];case"Shape":return[Object(O.tensor1d)(I("x",Se,me,Ce).shape,"int32")];case"ShapeN":return I("x",Se,me,Ce).map(function(Kt){return Object(O.tensor1d)(Kt.shape)});case"Size":return[Object(O.scalar)(I("x",Se,me,Ce).size,"int32")];case"Rank":return[Object(O.scalar)(I("x",Se,me,Ce).rank,"int32")];case"NoOp":return[Object(O.scalar)(1)];case"Print":var rt=I("x",Se,me,Ce),kt=I("data",Se,me,Ce),en=I("message",Se,me,Ce),En=I("summarize",Se,me,Ce);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(en);for(var Nt=0;Nt<kt.length;Nt++)console.log(Array.prototype.slice.call(kt[Nt].dataSync()).slice(0,En));return[rt];default:throw TypeError("Node type "+Se.op+" is not implemented")}},Wt=function(Se,me,Ce){switch(Se.op){case"ResizeBilinear":var Me=I("images",Se,me,Ce),rt=I("size",Se,me,Ce),kt=I("alignCorners",Se,me,Ce);return[O.image.resizeBilinear(Me,[rt[0],rt[1]],kt)];case"ResizeNearestNeighbor":return Me=I("images",Se,me,Ce),rt=I("size",Se,me,Ce),kt=I("alignCorners",Se,me,Ce),[O.image.resizeNearestNeighbor(Me,[rt[0],rt[1]],kt)];case"CropAndResize":var en=I("image",Se,me,Ce),En=I("boxes",Se,me,Ce),Nt=I("boxInd",Se,me,Ce),Kt=I("cropSize",Se,me,Ce),hn=I("method",Se,me,Ce),un=I("extrapolationValue",Se,me,Ce);return[O.image.cropAndResize(en,En,Nt,Kt,hn,un)];default:throw TypeError("Node type "+Se.op+" is not implemented")}},Zt=function(Se,me,Ce){switch(Se.op){case"Equal":return[Object(O.equal)(I("a",Se,me,Ce),I("b",Se,me,Ce))];case"NotEqual":return[Object(O.notEqual)(I("a",Se,me,Ce),I("b",Se,me,Ce))];case"Greater":return[Object(O.greater)(I("a",Se,me,Ce),I("b",Se,me,Ce))];case"GreaterEqual":return[Object(O.greaterEqual)(I("a",Se,me,Ce),I("b",Se,me,Ce))];case"Less":return[Object(O.less)(I("a",Se,me,Ce),I("b",Se,me,Ce))];case"LessEqual":return[Object(O.lessEqual)(I("a",Se,me,Ce),I("b",Se,me,Ce))];case"LogicalAnd":return[Object(O.logicalAnd)(I("a",Se,me,Ce),I("b",Se,me,Ce))];case"LogicalNot":return[Object(O.logicalNot)(I("a",Se,me,Ce))];case"LogicalOr":return[Object(O.logicalOr)(I("a",Se,me,Ce),I("b",Se,me,Ce))];case"Select":case"SelectV2":return[Object(O.where)(I("condition",Se,me,Ce),I("a",Se,me,Ce),I("b",Se,me,Ce))];default:throw TypeError("Node type "+Se.op+" is not implemented")}},Vn=function(Se,me,Ce){switch(Se.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[Object(O.matMul)(I("a",Se,me,Ce),I("b",Se,me,Ce),I("transposeA",Se,me,Ce),I("transposeB",Se,me,Ce))];case"Transpose":return[Object(O.transpose)(I("x",Se,me,Ce),I("perm",Se,me,Ce))];case"_FusedMatMul":var Me=I("fusedOps",Se,me,Ce),rt=Me[0],kt=Me[1],en=rt==="biasadd",En=kt==="prelu",Nt=I("numArgs",Se,me,Ce);if(en){if(En&&Nt!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!En&&Nt!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var Kt=I("args",Se,me,Ce),hn=Kt[0],un=Kt[1];return[O.fused.matMul({a:I("a",Se,me,Ce),b:I("b",Se,me,Ce),transposeA:I("transposeA",Se,me,Ce),transposeB:I("transposeB",Se,me,Ce),bias:hn,activation:kt,preluActivationWeights:un})];default:throw TypeError("Node type "+Se.op+" is not implemented")}},xn=function(Se,me,Ce){switch(Se.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[Object(O.batchNorm)(I("x",Se,me,Ce),I("mean",Se,me,Ce),I("variance",Se,me,Ce),I("offset",Se,me,Ce),I("scale",Se,me,Ce),I("epsilon",Se,me,Ce))];case"LRN":return[Object(O.localResponseNormalization)(I("x",Se,me,Ce),I("radius",Se,me,Ce),I("bias",Se,me,Ce),I("alpha",Se,me,Ce),I("beta",Se,me,Ce))];case"Softmax":return[Object(O.softmax)(I("x",Se,me,Ce))];case"LogSoftmax":return[Object(O.logSoftmax)(I("x",Se,me,Ce))];case"SparseToDense":return[Object(O.sparseToDense)(I("sparseIndices",Se,me,Ce),I("outputShape",Se,me,Ce),I("sparseValues",Se,me,Ce),I("defaultValue",Se,me,Ce))];default:throw TypeError("Node type "+Se.op+" is not implemented")}},Un=function(Se,me,Ce){switch(Se.op){case"Max":var Me=I("axis",Se,me,Ce),rt=I("keepDims",Se,me,Ce);return[Object(O.max)(I("x",Se,me,Ce),Me,rt)];case"Mean":return Me=I("axis",Se,me,Ce),rt=I("keepDims",Se,me,Ce),[Object(O.mean)(I("x",Se,me,Ce),Me,rt)];case"Min":return Me=I("axis",Se,me,Ce),rt=I("keepDims",Se,me,Ce),[Object(O.min)(I("x",Se,me,Ce),Me,rt)];case"Sum":return Me=I("axis",Se,me,Ce),rt=I("keepDims",Se,me,Ce),[Object(O.sum)(I("x",Se,me,Ce),Me,rt)];case"All":return Me=I("axis",Se,me,Ce),rt=I("keepDims",Se,me,Ce),[Object(O.all)(I("x",Se,me,Ce),Me,rt)];case"Any":return Me=I("axis",Se,me,Ce),rt=I("keepDims",Se,me,Ce),[Object(O.any)(I("x",Se,me,Ce),Me,rt)];case"ArgMax":return Me=I("axis",Se,me,Ce),[Object(O.argMax)(I("x",Se,me,Ce),Me)];case"ArgMin":return Me=I("axis",Se,me,Ce),[Object(O.argMin)(I("x",Se,me,Ce),Me)];case"Prod":return Me=I("axis",Se,me,Ce),rt=I("keepDims",Se,me,Ce),[Object(O.prod)(I("x",Se,me,Ce),Me,rt)];default:throw TypeError("Node type "+Se.op+" is not implemented")}},ur=function(Se,me,Ce){switch(Se.op){case"ConcatV2":case"Concat":var Me=I("n",Se,me,Ce),rt=I("axis",Se,me,Ce),kt=I("tensors",Se,me,Ce);return kt=kt.slice(0,Me),[Object(O.concat)(kt,rt)];case"GatherV2":case"Gather":rt=I("axis",Se,me,Ce);var en=I("x",Se,me,Ce),En=I("indices",Se,me,Ce);return[Object(O.gather)(en,En.asType("int32"),rt)];case"ReverseV2":case"Reverse":return rt=I("axis",Se,me,Ce),en=I("x",Se,me,Ce),[Object(O.reverse)(en,rt)];case"Slice":var Nt=I("begin",Se,me,Ce),Kt=I("size",Se,me,Ce);return[Object(O.slice)(I("x",Se,me,Ce),Nt,Kt)];case"StridedSlice":Nt=I("begin",Se,me,Ce);var hn=I("end",Se,me,Ce),un=I("strides",Se,me,Ce),mt=I("beginMask",Se,me,Ce),Tt=I("endMask",Se,me,Ce),fn=I("ellipsisMask",Se,me,Ce),tn=I("newAxisMask",Se,me,Ce),Ve=I("shrinkAxisMask",Se,me,Ce),Ln=I("x",Se,me,Ce);if(Nt.length===1&&Ln.shape.length>1)for(var Xn=1;Xn<Ln.shape.length;Xn++)Nt.push(0),hn.push(Ln.shape[Xn]),un.push(un[0]);return[Object(O.stridedSlice)(Ln,Nt,hn,un,mt,Tt,fn,tn,Ve)];case"Pack":return Object(O.tidy)(function(){var Zi=I("axis",Se,me,Ce),gi=I("tensors",Se,me,Ce),ei=gi[0].shape,Xr=gi[0].squeeze().shape,Kn=gi.map(function(di){var Ei=O.util.arraysEqual(di.shape,ei);if(!Ei&&!O.util.arraysEqual(di.squeeze().shape,Xr))throw new Error("the input tensors shape does not match");return Ei?di:di.reshape(ei)});return[Object(O.stack)(Kn,Zi)]});case"Unpack":return Object(O.tidy)(function(){var Zi=I("axis",Se,me,Ce),gi=I("tensor",Se,me,Ce);return Object(O.unstack)(gi,Zi)});case"Tile":var Zn=I("reps",Se,me,Ce);return[Object(O.tile)(I("x",Se,me,Ce),Zn)];case"Split":case"SplitV":rt=I("axis",Se,me,Ce);var cr=I("numOrSizeSplits",Se,me,Ce);return Object(O.split)(I("x",Se,me,Ce),cr,rt);case"ScatterNd":En=I("indices",Se,me,Ce);var Br=I("values",Se,me,Ce),Sr=I("shape",Se,me,Ce);return[Object(O.scatterND)(En,Br,Sr)];case"GatherNd":var yi=I("x",Se,me,Ce);return En=I("indices",Se,me,Ce),[Object(O.gatherND)(yi,En)];case"SparseToDense":En=I("sparseIndices",Se,me,Ce),Sr=I("outputShape",Se,me,Ce);var ki=I("sparseValues",Se,me,Ce),Zr=I("defaultValue",Se,me,Ce);return[Object(O.sparseToDense)(En,ki,Sr,ki.dtype===Zr.dtype?Zr:Zr.asType(ki.dtype))];default:throw TypeError("Node type "+Se.op+" is not implemented")}},sr=function(Se,me,Ce){switch(Se.op){case"FFT":return[Object(O.fft)(I("x",Se,me,Ce))];case"IFFT":return[Object(O.ifft)(I("x",Se,me,Ce))];case"RFFT":return[Object(O.rfft)(I("x",Se,me,Ce))];case"IRFFT":return[Object(O.irfft)(I("x",Se,me,Ce))];default:throw TypeError("Node type "+Se.op+" is not implemented")}},Er=function(Se,me,Ce){switch(Se.op){case"Cast":return[Object(O.cast)(I("x",Se,me,Ce),I("dtype",Se,me,Ce))];case"ExpandDims":var Me=I("axis",Se,me,Ce);return[Object(O.expandDims)(I("x",Se,me,Ce),Me)];case"Squeeze":return Me=I("axis",Se,me,Ce),[Object(O.squeeze)(I("x",Se,me,Ce),Me)];case"Reshape":return[Object(O.reshape)(I("x",Se,me,Ce),I("shape",Se,me,Ce))];case"PadV2":case"Pad":return[Object(O.pad)(I("x",Se,me,Ce),ce(I("padding",Se,me,Ce),2),I("constantValue",Se,me,Ce))];case"SpaceToBatchND":var rt=I("blockShape",Se,me,Ce),kt=ce(I("paddings",Se,me,Ce),2);return[Object(O.spaceToBatchND)(I("x",Se,me,Ce),rt,kt)];case"BatchToSpaceND":rt=I("blockShape",Se,me,Ce);var en=ce(I("crops",Se,me,Ce),2);return[Object(O.batchToSpaceND)(I("x",Se,me,Ce),rt,en)];case"DepthToSpace":var En=I("blockSize",Se,me,Ce),Nt=I("dataFormat",Se,me,Ce).toUpperCase();return[Object(O.depthToSpace)(I("x",Se,me,Ce),En,Nt)];default:throw TypeError("Node type "+Se.op+" is not implemented")}};function Mr(Se,me,Ce){var Me=function(rt,kt,en){switch(rt.category){case"arithmetic":return Object(O.tidy)(function(){return kn(rt,kt,en)});case"basic_math":return Object(O.tidy)(function(){return Qn(rt,kt,en)});case"control":return ar(rt,kt,en);case"convolution":return Object(O.tidy)(function(){return Tr(rt,kt,en)});case"creation":return Object(O.tidy)(function(){return rn(rt,kt,en)});case"dynamic":return Ht(rt,kt,en);case"evaluation":return Object(O.tidy)(function(){return Gn(rt,kt,en)});case"image":return Object(O.tidy)(function(){return Wt(rt,kt,en)});case"graph":return Object(O.tidy)(function(){return Xt(rt,kt,en)});case"logical":return Object(O.tidy)(function(){return Zt(rt,kt,en)});case"matrices":return Object(O.tidy)(function(){return Vn(rt,kt,en)});case"normalization":return Object(O.tidy)(function(){return xn(rt,kt,en)});case"reduction":return Object(O.tidy)(function(){return Un(rt,kt,en)});case"slice_join":return Object(O.tidy)(function(){return ur(rt,kt,en)});case"spectral":return Object(O.tidy)(function(){return sr(rt,kt,en)});case"transformation":return Object(O.tidy)(function(){return Er(rt,kt,en)});case"custom":var En=z(rt.op);if(En&&En.customExecutor)return En.customExecutor(new Pn(rt,kt,en));throw TypeError("Custom op "+rt.op+" is not registered.");default:throw TypeError("Unknown op '"+rt.op+"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(Se,me,Ce);return Me instanceof Promise?Me.then(function(rt){return[].concat(rt)}):[].concat(Me)}var pr=function(){function Se(me,Ce){this.weightMap=me,this.tensorArrayMap=Ce,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return Se.prototype.newFrame=function(me,Ce){return{id:me,frameName:Ce,iterationId:0}},Object.defineProperty(Se.prototype,"currentContext",{get:function(){return this.contexts},set:function(me){this.contexts!==me&&(this.contexts=me,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),Se.prototype.generateCurrentContextIds=function(){for(var me=[],Ce=0;Ce<this.contexts.length-1;Ce++){var Me=this.contexts.slice(0,this.contexts.length-Ce);me.push(this.contextIdforContexts(Me))}me.push(""),this._currentContextIds=me},Se.prototype.contextIdforContexts=function(me){return me?me.map(function(Ce){return Ce.id===0&&Ce.iterationId===0?"":Ce.frameName+"-"+Ce.iterationId}).join("/"):""},Se.prototype.enterFrame=function(me){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,me)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},Se.prototype.exitFrame=function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()},Se.prototype.nextIteration=function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var me=Object.assign({},this.contexts[this.contexts.length-1]);me.iterationId+=1,me.id=this.lastId,this.contexts.splice(-1,1,me),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))},Se.prototype.getWeight=function(me){return this.weightMap[me]},Se.prototype.addTensorArray=function(me){this.tensorArrayMap[me.id]=me},Se.prototype.getTensorArray=function(me){return this.tensorArrayMap[me]},Se}();function ri(Se,me,Ce){for(var Me=new Set,rt=[],kt=null,en=null,En=new Set,Nt=Object.keys(Se).map(function(un){return oe(un)[0]}),Kt=me.slice();Kt.length>0;){var hn=Kt.pop();(jn(hn)||ir(hn))&&kt==null&&(en=(kt=hn).children.map(function(un){return un.name}).filter(function(un){return Me.has(un)})),Me.add(hn.name),Ce[hn.name]==null&&Nt.indexOf(hn.name)===-1&&(hn.inputs.length!==0?hn.inputs.forEach(function(un){En.has(un.name)||(En.add(un.name),Kt.push(un))}):rt.push(hn.name))}return{inputs:Se,outputs:me,usedNodes:Me,missingInputs:rt,dynamicNode:kt,syncInputs:en}}var Kr=["Switch","Merge","Enter","Exit","NextIteration"],ti=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"];function jn(Se){return Kr.indexOf(Se.op)>=0}function ir(Se){return ti.indexOf(Se.op)>=0}var Cr=function(){function Se(me){this.graph=me,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._outputs=me.outputs,this._inputs=me.inputs,this._signature=me.signature}return Object.defineProperty(Se.prototype,"weightMap",{get:function(){return this._weightMap},set:function(me){var Ce=Object.keys(me).map(function(Me){return me[Me].map(function(rt){return rt.id})});this.weightIds=[].concat.apply([],Ce),this._weightMap=me},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"inputs",{get:function(){return this._inputs.map(function(me){return{name:me.name,shape:me.attrParams.shape?me.attrParams.shape.value:void 0,dtype:me.attrParams.dtype?me.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"outputs",{get:function(){return this._outputs.map(function(me){return{name:me.name,shape:me.attrParams.shape?me.attrParams.shape.value:void 0,dtype:me.attrParams.dtype?me.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"inputNodes",{get:function(){return this._inputs.map(function(me){return me.signatureKey||me.name})},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"outputNodes",{get:function(){return this._outputs.map(function(me){return me.signatureKey||me.name})},enumerable:!0,configurable:!0}),Se.prototype.getCompilationKey=function(me,Ce){var Me=me.map(function(kt){return kt.name}).sort(),rt=Ce.map(function(kt){return kt.name}).sort();return Me.join(this.SEPERATOR)+"--"+rt.join(this.SEPERATOR)},Se.prototype.compile=function(me,Ce){var Me=ri(me,Ce,this.weightMap),rt=Me.missingInputs,kt=Me.dynamicNode,en=Me.syncInputs;if(kt!=null)throw new Error("This execution contains the node '"+kt.name+"', which has the dynamic op '"+kt.op+"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs ["+en+"]");if(rt.length>0){var En=Ce.map(function(Kt){return Kt.name}),Nt=Object.keys(me);throw new Error("Cannot compute the outputs ["+En+"] from the provided inputs ["+Nt+"]. Missing the following inputs: ["+rt+"]")}return function(Kt,hn,un){var mt=un.usedNodes,Tt=un.inputs,fn=[];Object.keys(Tt).map(function(Xn){return oe(Xn)[0]}).map(function(Xn){return Kt.nodes[Xn]}).forEach(function(Xn){mt.has(Xn.name)&&fn.push(Xn)}),Kt.weights.forEach(function(Xn){mt.has(Xn.name)&&fn.push(Xn)});for(var tn=new Set,Ve=[];fn.length>0;){var Ln=fn.pop();tn.add(Ln.name),hn[Ln.name]||Ve.push(Ln),Ln.children.forEach(function(Xn){!tn.has(Xn.name)&&mt.has(Xn.name)&&Xn.inputs.every(function(Zn){return tn.has(Zn.name)})&&fn.push(Xn)})}return Ve}(this.graph,this.weightMap,Me)},Se.prototype.execute=function(me,Ce){var Me=this;me=this.mapInputs(me);var rt=Object.keys(me).sort();this.checkInputs(me),this.checkInputShapeAndType(me),Ce=this.mapOutputs(Ce),this.checkOutputs(Ce);var kt=rt.map(function(hn){return Me.graph.nodes[oe(hn)[0]]}),en=Ce.map(function(hn){return Me.graph.nodes[oe(hn)[0]]}),En=this.getCompilationKey(kt,en),Nt=this.compiledMap.get(En);Nt==null&&(Nt=this.compile(me,en),this.compiledMap.set(En,Nt));var Kt={};return Object(O.tidy)(function(){var hn=new pr(Me._weightMap,Kt),un=U({},Me.weightMap);Object.keys(me).forEach(function(Ln){var Xn=oe(Ln),Zn=Xn[0],cr=[];cr[Xn[1]]=me[Ln],un[Zn]=cr});for(var mt=Me.getFrozenTensorIds(un),Tt={},fn=0;fn<Nt.length;fn++){var tn=Nt[fn];if(!un[tn.name]){var Ve=Mr(tn,un,hn);if(Ve instanceof Promise)throw new Error("The execution of the op '"+tn.op+"' returned a promise. Please use model.executeAsync() instead.");un[tn.name]=Ve,Me.checkTensorForDisposal(tn.name,tn,un,hn,mt,Ce,Tt)}}return Ce.map(function(Ln){return Z(Ln,un,hn)})})},Se.prototype.getFrozenTensorIds=function(me){var Ce=[].concat.apply([],Object.keys(me).map(function(Me){return me[Me]}).map(function(Me){return Me.map(function(rt){return rt.id})}));return new Set(Ce)},Se.prototype.checkTensorForDisposal=function(me,Ce,Me,rt,kt,en,En){Ce.category!=="control"&&en.indexOf(me)===-1&&(Me[me].forEach(function(Nt){Nt!=null&&(En[Nt.id]=(En[Nt.id]||0)+Ce.children.length)}),Ce.inputs.forEach(function(Nt){if(Nt.category!=="control"){var Kt=function(hn,un,mt){return un[G(hn,mt.currentContextId)]}(Nt.name,Me,rt);Kt!=null&&Kt.forEach(function(hn){if(hn&&!kt.has(hn.id)){var un=En[hn.id];un===1?(hn.dispose(),delete En[hn.id]):un!=null&&En[hn.id]--}})}}))},Se.prototype.executeAsync=function(me,Ce){return j(this,void 0,void 0,function(){var Me,rt,kt,en,En,Nt,Kt=this;return N(this,function(hn){switch(hn.label){case 0:return me=this.mapInputs(me),this.checkInputs(me),this.checkInputShapeAndType(me),Ce=this.mapOutputs(Ce),this.checkOutputs(Ce),Me={},rt=new pr(this._weightMap,Me),[4,this.executeWithControlFlow(me,rt,Ce)];case 1:return kt=hn.sent(),en=Ce.map(function(un){return Z(un,kt,rt)}),En=new Set(en.map(function(un){return un.id})),Nt=new Set(Object.keys(me).map(function(un){return me[un].id})),Object.keys(kt).forEach(function(un){kt[un].forEach(function(mt){!mt||mt.isDisposed||En.has(mt.id)||Nt.has(mt.id)||Kt.weightIds.indexOf(mt.id)!==-1||mt.dispose()})}),[2,en]}})})},Se.prototype.executeWithControlFlow=function(me,Ce,Me){return j(this,void 0,void 0,function(){var rt,kt,en,En,Nt,Kt,hn,un,mt,Tt,fn,tn,Ve,Ln,Xn,Zn,cr=this;return N(this,function(Br){switch(Br.label){case 0:rt=Object.keys(me),kt=rt.map(function(Sr){return cr.graph.nodes[oe(Sr)[0]]}),en=Me.map(function(Sr){return cr.graph.nodes[oe(Sr)[0]]}),En=ri(me,en,this.weightMap),Nt=En.usedNodes,Kt=En.missingInputs,hn=En.dynamicNode,un=En.syncInputs,mt=kt.concat(this.graph.weights).map(function(Sr){return{node:Sr,contexts:Ce.currentContext}}),Tt=U({},this.weightMap),Object.keys(me).forEach(function(Sr){var yi=oe(Sr),ki=yi[0],Zr=[];Zr[yi[1]]=me[Sr],Tt[ki]=Zr}),fn={},tn=this.getFrozenTensorIds(Tt),Ve={},Br.label=1;case 1:return mt.length>0?(Ln=this.processStack(kt,mt,Ce,Tt,Ve,tn,Me,fn,Nt),[4,Promise.all(Ln)]):[3,3];case 2:return Br.sent(),[3,1];case 3:if(hn==null&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),(Xn=en.filter(function(Sr){return!jn(Sr)&&!Z(Sr.name,Tt,Ce)}).map(function(Sr){return Sr.name})).length>0)throw Zn="",hn!=null&&(Zn="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs ["+un+"]"),new Error("Cannot compute the outputs ["+Xn+"] from the provided inputs ["+rt+"]. Consider providing the following inputs: ["+Kt+"]. "+Zn);return[2,Tt]}})})},Se.prototype.processStack=function(me,Ce,Me,rt,kt,en,En,Nt,Kt){for(var hn=this,un=[],mt=function(){var fn=Ce.pop();Me.currentContext=fn.contexts;var tn="";if(fn.node.op==="Enter"&&I("isConstant",fn.node,rt,Me)&&(tn=Y(fn.node.name,Me)[0]),me.indexOf(fn.node)===-1){var Ve=Mr(fn.node,rt,Me);tn||(tn=Y(fn.node.name,Me)[0]);var Ln=Me.currentContext;Ve instanceof Promise?un.push(Ve.then(function(Xn){return rt[tn]=Xn,Me.currentContext=Ln,hn.checkTensorForDisposal(tn,fn.node,rt,Me,en,En,Nt),hn.processChildNodes(fn.node,Ce,Me,rt,kt,Kt),Xn})):(rt[tn]=Ve,Tt.checkTensorForDisposal(tn,fn.node,rt,Me,en,En,Nt),Tt.processChildNodes(fn.node,Ce,Me,rt,kt,Kt))}else Tt.processChildNodes(fn.node,Ce,Me,rt,kt,Kt)},Tt=this;Ce.length>0;)mt();return un},Se.prototype.processChildNodes=function(me,Ce,Me,rt,kt,en){me.children.forEach(function(En){var Nt=Y(En.name,Me)[0];!kt[Nt]&&en.has(En.name)&&(En.op==="Merge"?En.inputNames.some(function(Kt){return!!Z(Kt,rt,Me)})&&(kt[Nt]=!0,Ce.push({contexts:Me.currentContext,node:En})):En.inputNames.every(function(Kt){return!!Z(Kt,rt,Me)})&&(kt[Nt]=!0,Ce.push({contexts:Me.currentContext,node:En})))})},Se.prototype.dispose=function(){var me=this;Object.keys(this.weightMap).forEach(function(Ce){return me.weightMap[Ce].forEach(function(Me){return Me.dispose()})})},Se.prototype.checkInputShapeAndType=function(me){var Ce=this;Object.keys(me).forEach(function(Me){var rt=me[Me],kt=oe(Me)[0],en=Ce.graph.nodes[kt];if(en.attrParams.shape&&en.attrParams.shape.value){var En=en.attrParams.shape.value,Nt=En.length===rt.shape.length&&rt.shape.every(function(Kt,hn){return En[hn]===-1||En[hn]===Kt});O.util.assert(Nt,function(){return"The shape of dict['"+en.name+"'] provided in model.execute(dict) must be ["+En+"], but was ["+rt.shape+"]"})}en.attrParams.dtype&&en.attrParams.dtype.value&&O.util.assert(rt.dtype===en.attrParams.dtype.value,function(){return"The dtype of dict['"+en.name+"'] provided in model.execute(dict) must be "+en.attrParams.dtype.value+", but was "+rt.dtype})})},Se.prototype.mapInputs=function(me){var Ce={};for(var Me in me)this._signature!=null&&this._signature.inputs!=null&&this._signature.inputs[Me]!=null?Ce[this._signature.inputs[Me].name]=me[Me]:Ce[Me]=me[Me];return Ce},Se.prototype.checkInputs=function(me){var Ce=this,Me=Object.keys(me).filter(function(rt){var kt=oe(rt)[0];return Ce.graph.nodes[kt]==null});if(Me.length>0)throw new Error("The dict provided in model.execute(dict) has keys: ["+Me+"] that are not part of graph")},Se.prototype.mapOutputs=function(me){var Ce=this;return me.map(function(Me){return Ce._signature!=null&&Ce._signature.outputs!=null&&Ce._signature.outputs[Me]!=null?Ce._signature.outputs[Me].name:Me},{})},Se.prototype.checkOutputs=function(me){var Ce=this;me.forEach(function(Me){var rt=oe(Me)[0];if(!Ce.graph.nodes[rt])throw new Error("The output '"+Me+"' is not found in the graph")})},Se}(),Hr="?tfjs-format=file",qr="model.json",Ot=function(){function Se(me,Ce){Ce===void 0&&(Ce={}),this.modelUrl=me,this.loadOptions=Ce,this.version="n/a",Ce==null&&(this.loadOptions={})}return Object.defineProperty(Se.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(Se.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),Se.prototype.findIOHandler=function(){var me=this.modelUrl;if(me.load!=null)this.handler=me;else if(this.loadOptions.requestInit!=null)this.handler=O.io.browserHTTPRequest(me,this.loadOptions);else{var Ce=O.io.getLoadHandlers(me,this.loadOptions.onProgress);if(Ce.length===0)Ce.push(O.io.browserHTTPRequest(me,this.loadOptions));else if(Ce.length>1)throw new Error("Found more than one ("+Ce.length+") load handlers for URL '"+[me]+"'");this.handler=Ce[0]}},Se.prototype.load=function(){return j(this,void 0,void 0,function(){var me,Ce,Me,rt;return N(this,function(kt){switch(kt.label){case 0:if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return me=this,[4,this.handler.load()];case 1:return me.artifacts=kt.sent(),Ce=this.artifacts.modelTopology,Me={},this.artifacts.userDefinedMetadata!=null&&(Me=this.artifacts.userDefinedMetadata.signature),this.version=Ce.versions.producer+"."+Ce.versions.minConsumer,rt=O.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs),this.executor=new Cr(yt.Instance.transformGraph(Ce,Me)),this.executor.weightMap=this.convertTensorMapToTensorsMap(rt),[2,!0]}})})},Se.prototype.save=function(me,Ce){return j(this,void 0,void 0,function(){var Me;return N(this,function(rt){if(typeof me=="string"){if((Me=O.io.getSaveHandlers(me)).length===0)throw new Error("Cannot find any save handlers for URL '"+me+"'");if(Me.length>1)throw new Error("Found more than one ("+Me.length+") save handlers for URL '"+me+"'");me=Me[0]}if(me.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[2,me.save(this.artifacts)]})})},Se.prototype.predict=function(me,Ce){return this.execute(me,this.outputNodes)},Se.prototype.normalizeInputs=function(me){if(!(me instanceof O.Tensor||Array.isArray(me)))return me;if((me=Array.isArray(me)?me:[me]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has "+this.inputNodes.length+" placeholders, while there are "+me.length+" input tensors.");return this.inputNodes.reduce(function(Ce,Me,rt){return Ce[Me]=me[rt],Ce},{})},Se.prototype.normalizeOutputs=function(me){return me=me||this.outputNodes,Array.isArray(me)?me:[me]},Se.prototype.execute=function(me,Ce){me=this.normalizeInputs(me),Ce=this.normalizeOutputs(Ce);var Me=this.executor.execute(me,Ce);return Me.length>1?Me:Me[0]},Se.prototype.executeAsync=function(me,Ce){return j(this,void 0,void 0,function(){var Me;return N(this,function(rt){switch(rt.label){case 0:return me=this.normalizeInputs(me),Ce=this.normalizeOutputs(Ce),[4,this.executor.executeAsync(me,Ce)];case 1:return[2,(Me=rt.sent()).length>1?Me:Me[0]]}})})},Se.prototype.convertTensorMapToTensorsMap=function(me){return Object.keys(me).reduce(function(Ce,Me){return Ce[Me]=[me[Me]],Ce},{})},Se.prototype.dispose=function(){this.executor.dispose()},Se}();function Fr(Se,me){return me===void 0&&(me={}),j(this,void 0,void 0,function(){var Ce;return N(this,function(Me){switch(Me.label){case 0:if(Se==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return me==null&&(me={}),me.fromTFHub&&Se.load==null&&(Se.endsWith("/")||(Se+="/"),Se=""+Se+qr+Hr),[4,(Ce=new Ot(Se,me)).load()];case 1:return Me.sent(),[2,Ce]}})})}var $t="1.7.4"}.call(this,r(92).Buffer)},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(103);function C(Y){for(var G=Y.length,oe=0,ce=0;G>0;)ce=Math.random()*G|0,oe=Y[--G],Y[G]=Y[ce],Y[ce]=oe}function S(Y,G){if(!Y)throw new Error(typeof G=="string"?G:G())}function O(Y,G,oe){if(G===void 0&&(G=[]),oe===void 0&&(oe=!1),G==null&&(G=[]),Array.isArray(Y)||W(Y)&&!oe)for(var ce=0;ce<Y.length;++ce)O(Y[ce],G,oe);else G.push(Y);return G}function U(Y,G){if(Y===G)return!0;if(Y==null||G==null||Y.length!==G.length)return!1;for(var oe=0;oe<Y.length;oe++)if(Y[oe]!==G[oe])return!1;return!0}function j(Y){return Y%1==0}function N(Y,G){var oe=G.length;return S((Y=Y==null?G.map(function(ce,be){return be}):[].concat(Y)).every(function(ce){return ce>=-oe&&ce<oe}),function(){return"All values in axis param must be in range [-"+oe+", "+oe+") but got axis "+Y}),S(Y.every(function(ce){return j(ce)}),function(){return"All values in axis param must be integers but got axis "+Y}),Y.map(function(ce){return ce<0?oe+ce:ce})}function L(Y,G){for(var oe=0;oe<Y.length;oe++){var ce=Y[oe];if(isNaN(ce)||!isFinite(ce))throw Error("A tensor of type "+G+" being uploaded contains "+ce+".")}}function W(Y){return Y instanceof Float32Array||Y instanceof Int32Array||Y instanceof Uint8Array}function z(Y){return typeof Y=="string"||Y instanceof String}function q(Y){return typeof Y=="boolean"}function I(Y){return typeof Y=="number"}function Z(Y,G){if(G==null||G==="float32"||G==="complex64")return new Float32Array(Y);if(G==="int32")return new Int32Array(Y);if(G==="bool")return new Uint8Array(Y);throw new Error("Unknown data type "+G)}s.shuffle=C,s.clamp=function(Y,G,oe){return Math.max(Y,Math.min(G,oe))},s.nearestLargerEven=function(Y){return Y%2==0?Y:Y+1},s.sum=function(Y){for(var G=0,oe=0;oe<Y.length;oe++)G+=Y[oe];return G},s.randUniform=function(Y,G){var oe=Math.random();return G*oe+(1-oe)*Y},s.distSquared=function(Y,G){for(var oe=0,ce=0;ce<Y.length;ce++){var be=Number(Y[ce])-Number(G[ce]);oe+=be*be}return oe},s.assert=S,s.assertShapesMatch=function(Y,G,oe){oe===void 0&&(oe=""),S(U(Y,G),function(){return oe+" Shapes "+Y+" and "+G+" must match"})},s.assertNonNull=function(Y){S(Y!=null,function(){return"The input to the tensor constructor must be a non-null value."})},s.flatten=O,s.sizeFromShape=function(Y){if(Y.length===0)return 1;for(var G=Y[0],oe=1;oe<Y.length;oe++)G*=Y[oe];return G},s.isScalarShape=function(Y){return Y.length===0},s.arraysEqual=U,s.isInt=j,s.tanh=function(Y){if(Math.tanh!=null)return Math.tanh(Y);if(Y===1/0)return 1;if(Y===-1/0)return-1;var G=Math.exp(2*Y);return(G-1)/(G+1)},s.sizeToSquarishShape=function(Y){var G=Math.ceil(Math.sqrt(Y));return[G,Math.ceil(Y/G)]},s.createShuffledIndices=function(Y){for(var G=new Uint32Array(Y),oe=0;oe<Y;++oe)G[oe]=oe;return C(G),G},s.rightPad=function(Y,G){return G<=Y.length?Y:Y+" ".repeat(G-Y.length)},s.repeatedTry=function(Y,G,oe){return G===void 0&&(G=function(ce){return 0}),new Promise(function(ce,be){var Ee=0,ve=function(){if(Y())ce();else{var ge=G(++Ee);oe!=null&&Ee>=oe?be():setTimeout(ve,ge)}};ve()})},s.inferFromImplicitShape=function(Y,G){for(var oe=1,ce=-1,be=0;be<Y.length;++be)if(Y[be]>=0)oe*=Y[be];else if(Y[be]===-1){if(ce!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+ce+" and dim "+be);ce=be}else if(Y[be]<0)throw Error("Shapes can not be < 0. Found "+Y[be]+" at dim "+be);if(ce===-1){if(G>0&&G!==oe)throw Error("Size("+G+") must match the product of shape "+Y);return Y}if(oe===0)throw Error("Cannot infer the missing size in ["+Y+"] when there are 0 elements");if(G%oe!=0)throw Error("The implicit shape can't be a fractional number. Got "+G+" / "+oe);var Ee=Y.slice();return Ee[ce]=G/oe,Ee},s.parseAxisParam=N,s.squeezeShape=function(Y,G){for(var oe=[],ce=[],be=G!=null&&Array.isArray(G)&&G.length===0,Ee=G==null||be?null:N(G,Y).sort(),ve=0,ge=0;ge<Y.length;++ge){if(Ee!=null){if(Ee[ve]===ge&&Y[ge]!==1)throw new Error("Can't squeeze axis "+ge+" since its dim '"+Y[ge]+"' is not 1");(Ee[ve]==null||Ee[ve]>ge)&&Y[ge]===1&&(oe.push(Y[ge]),ce.push(ge)),Ee[ve]<=ge&&ve++}Y[ge]!==1&&(oe.push(Y[ge]),ce.push(ge))}return{newShape:oe,keptDims:ce}},s.getTypedArrayFromDType=function(Y,G){var oe=null;if(Y==null||Y==="float32")oe=new Float32Array(G);else if(Y==="int32")oe=new Int32Array(G);else{if(Y!=="bool")throw new Error("Unknown data type "+Y);oe=new Uint8Array(G)}return oe},s.getArrayFromDType=function(Y,G){var oe=null;if(Y==null||Y==="float32")oe=new Float32Array(G);else if(Y==="int32")oe=new Int32Array(G);else if(Y==="bool")oe=new Uint8Array(G);else{if(Y!=="string")throw new Error("Unknown data type "+Y);oe=new Array(G)}return oe},s.checkConversionForErrors=L,s.isValidDtype=function(Y){return Y==="bool"||Y==="complex64"||Y==="float32"||Y==="int32"||Y==="string"},s.hasEncodingLoss=function(Y,G){return!(G==="complex64"||G==="float32"&&Y!=="complex64"||G==="int32"&&Y!=="float32"&&Y!=="complex64"||G==="bool"&&Y==="bool")},s.isTypedArray=W,s.bytesPerElement=function(Y){if(Y==="float32"||Y==="int32")return 4;if(Y==="complex64")return 8;if(Y==="bool")return 1;throw new Error("Unknown dtype "+Y)},s.bytesFromStringArray=function(Y){if(Y==null)return 0;var G=0;return Y.forEach(function(oe){return G+=oe.length}),G},s.isString=z,s.isBoolean=q,s.isNumber=I,s.inferDtype=function Y(G){return Array.isArray(G)?Y(G[0]):G instanceof Float32Array?"float32":G instanceof Int32Array||G instanceof Uint8Array?"int32":I(G)?"float32":z(G)?"string":q(G)?"bool":"float32"},s.isFunction=function(Y){return!!(Y&&Y.constructor&&Y.call&&Y.apply)},s.nearestDivisor=function(Y,G){for(var oe=G;oe<Y;++oe)if(Y%oe==0)return oe;return Y},s.computeStrides=function(Y){var G=Y.length;if(G<2)return[];var oe=new Array(G-1);oe[G-2]=Y[G-1];for(var ce=G-3;ce>=0;--ce)oe[ce]=oe[ce+1]*Y[ce+1];return oe},s.toTypedArray=function(Y,G,oe){if(G==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(Y)&&(Y=O(Y)),oe&&L(Y,G),function(Ee,ve){return Ee instanceof Float32Array&&ve==="float32"||Ee instanceof Int32Array&&ve==="int32"||Ee instanceof Uint8Array&&ve==="bool"}(Y,G))return Y;if(G==null||G==="float32"||G==="complex64")return new Float32Array(Y);if(G==="int32")return new Int32Array(Y);if(G==="bool"){for(var ce=new Uint8Array(Y.length),be=0;be<ce.length;++be)Math.round(Y[be])!==0&&(ce[be]=1);return ce}throw new Error("Unknown data type "+G)},s.toNestedArray=function(Y,G){if(Y.length===0)return G[0];var oe=Y.reduce(function(ce,be){return ce*be});if(oe===0)return[];if(oe!==G.length)throw new Error("["+Y+"] does not match the input size.");return function ce(be,Ee,ve){var ge=new Array;if(Ee.length===1)for(var Ge=Ee[0],ht=0;ht<Ge;ht++)ge[ht]=ve[be+ht];else{Ge=Ee[0];var It=Ee.slice(1),St=It.reduce(function(we,bt){return we*bt});for(ht=0;ht<Ge;ht++)ge[ht]=ce(be+ht*St,It,ve)}return ge}(0,Y,G)},s.makeOnesTypedArray=function(Y,G){for(var oe=Z(Y,G),ce=0;ce<oe.length;ce++)oe[ce]=1;return oe},s.makeZerosTypedArray=Z,s.now=function(){return l.env().platform.now()},s.assertNonNegativeIntegerDimensions=function(Y){Y.forEach(function(G){S(Number.isInteger(G)&&G>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+Y+"]."})})},s.fetch=function(Y,G){return l.env().platform.fetch(Y,G)},s.encodeString=function(Y,G){return G===void 0&&(G="utf-8"),G=G||"utf-8",l.env().platform.encode(Y,G)},s.decodeString=function(Y,G){return G===void 0&&(G="utf-8"),G=G||"utf-8",l.env().platform.decode(Y,G)},s.locToIndex=function(Y,G,oe){if(G===0)return 0;if(G===1)return Y[0];for(var ce=Y[Y.length-1],be=0;be<Y.length-1;++be)ce+=oe[be]*Y[be];return ce},s.indexToLoc=function(Y,G,oe){if(G===0)return[];if(G===1)return[Y];for(var ce=new Array(G),be=0;be<ce.length-1;++be)ce[be]=Math.floor(Y/oe[be]),Y-=ce[be]*oe[be];return ce[ce.length-1]=Y,ce}},function(u,s,r){var l=r(54),C=Math.min;u.exports=function(S){return S>0?C(l(S),9007199254740991):0}},function(u,s,r){var l=r(262),C=r(261),S=r(187),O=r(260);u.exports=function(U,j){return l(U)||C(U,j)||S(U,j)||O()},u.exports.__esModule=!0,u.exports.default=u.exports},function(u,s){var r=u.exports={version:"2.6.12"};typeof __e=="number"&&(__e=r)},function(u,s,r){(function(l,C){var S=this&&this.__awaiter||function(oe,ce,be,Ee){return new(be||(be=Promise))(function(ve,ge){function Ge(St){try{It(Ee.next(St))}catch(we){ge(we)}}function ht(St){try{It(Ee.throw(St))}catch(we){ge(we)}}function It(St){St.done?ve(St.value):new be(function(we){we(St.value)}).then(Ge,ht)}It((Ee=Ee.apply(oe,ce||[])).next())})},O=this&&this.__generator||function(oe,ce){var be,Ee,ve,ge,Ge={label:0,sent:function(){if(1&ve[0])throw ve[1];return ve[1]},trys:[],ops:[]};return ge={next:ht(0),throw:ht(1),return:ht(2)},typeof Symbol=="function"&&(ge[Symbol.iterator]=function(){return this}),ge;function ht(It){return function(St){return function(we){if(be)throw new TypeError("Generator is already executing.");for(;Ge;)try{if(be=1,Ee&&(ve=2&we[0]?Ee.return:we[0]?Ee.throw||((ve=Ee.return)&&ve.call(Ee),0):Ee.next)&&!(ve=ve.call(Ee,we[1])).done)return ve;switch(Ee=0,ve&&(we=[2&we[0],ve.value]),we[0]){case 0:case 1:ve=we;break;case 4:return Ge.label++,{value:we[1],done:!1};case 5:Ge.label++,Ee=we[1],we=[0];continue;case 7:we=Ge.ops.pop(),Ge.trys.pop();continue;default:if(!(ve=(ve=Ge.trys).length>0&&ve[ve.length-1])&&(we[0]===6||we[0]===2)){Ge=0;continue}if(we[0]===3&&(!ve||we[1]>ve[0]&&we[1]<ve[3])){Ge.label=we[1];break}if(we[0]===6&&Ge.label<ve[1]){Ge.label=ve[1],ve=we;break}if(ve&&Ge.label<ve[2]){Ge.label=ve[2],Ge.ops.push(we);break}ve[2]&&Ge.ops.pop(),Ge.trys.pop();continue}we=ce.call(oe,Ge)}catch(bt){we=[6,bt],Ee=0}finally{be=ve=0}if(5&we[0])throw we[1];return{value:we[0]?we[1]:void 0,done:!0}}([It,St])}}};Object.defineProperty(s,"__esModule",{value:!0});var U,j=r(103),N=r(382),L=r(381),W=r(380),z=r(33),q=r(74),I=r(21),Z=r(21),Y=function(){function oe(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return oe.prototype.dispose=function(){for(var ce in this.registeredVariables)this.registeredVariables[ce].dispose()},oe}(),G=function(){function oe(ce){this.ENV=ce,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Y}return oe.prototype.ready=function(){return S(this,void 0,void 0,function(){var ce,be,Ee;return O(this,function(ve){switch(ve.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];ce=this.getSortedBackends(),be=0,ve.label=1;case 1:return be<ce.length?(Ee=ce[be],[4,this.initializeBackend(Ee).success]):[3,5];case 2:return ve.sent()?[4,this.setBackend(Ee)]:[3,4];case 3:return ve.sent(),[2];case 4:return be++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(oe.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var ce=this.initializeBackendsAndReturnBest(),be=ce.name;if(ce.asyncInit)throw new Error("The highest priority backend '"+be+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(be)}return this.backendInstance},enumerable:!0,configurable:!0}),oe.prototype.backendNames=function(){return Object.keys(this.registryFactory)},oe.prototype.findBackend=function(ce){return!(ce in this.registry)&&(!(ce in this.registryFactory)||this.initializeBackend(ce).asyncInit)?null:this.registry[ce]},oe.prototype.findBackendFactory=function(ce){return ce in this.registryFactory?this.registryFactory[ce].factory:null},oe.prototype.registerBackend=function(ce,be,Ee){return Ee===void 0&&(Ee=1),ce in this.registryFactory?(console.warn(ce+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[ce]={factory:be,priority:Ee},!0)},oe.prototype.setBackend=function(ce){return S(this,void 0,void 0,function(){var be,Ee,ve;return O(this,function(ge){switch(ge.label){case 0:if(this.registryFactory[ce]==null)throw new Error("Backend name '"+ce+"' not found in registry");return this.backendName=ce,this.registry[ce]!=null?[3,4]:(this.backendInstance=null,be=this.initializeBackend(ce),Ee=be.success,be.asyncInit?[4,Ee]:[3,2]);case 1:return ve=ge.sent(),[3,3];case 2:ve=Ee,ge.label=3;case 3:if(!ve)return[2,!1];ge.label=4;case 4:return this.backendInstance=this.registry[ce],this.setupRegisteredKernels(),this.profiler=new L.Profiler(this.backendInstance),[2,!0]}})})},oe.prototype.setupRegisteredKernels=function(){var ce=this;N.getKernelsForBackend(this.backendName).forEach(function(be){be.setupFunc!=null&&be.setupFunc(ce.backendInstance)})},oe.prototype.disposeRegisteredKernels=function(ce){var be=this;N.getKernelsForBackend(ce).forEach(function(Ee){Ee.disposeFunc!=null&&Ee.disposeFunc(be.registry[ce])})},oe.prototype.initializeBackend=function(ce){var be=this,Ee=this.registryFactory[ce];if(Ee==null)throw new Error("Cannot initialize backend "+ce+", no registration found.");try{var ve=Ee.factory();if(Promise.resolve(ve)===ve){var ge=++this.pendingBackendInitId,Ge=ve.then(function(ht){return!(ge<be.pendingBackendInitId)&&(be.registry[ce]=ht,be.pendingBackendInit=null,!0)}).catch(function(ht){return!(ge<be.pendingBackendInitId)&&(be.pendingBackendInit=null,console.warn("Initialization of backend "+ce+" failed"),console.warn(ht.stack||ht.message),!1)});return this.pendingBackendInit=Ge,{success:Ge,asyncInit:!0}}return this.registry[ce]=ve,{success:!0,asyncInit:!1}}catch(ht){return console.warn("Initialization of backend "+ce+" failed"),console.warn(ht.stack||ht.message),{success:!1,asyncInit:!1}}},oe.prototype.removeBackend=function(ce){if(!(ce in this.registryFactory))throw new Error(ce+" backend not found in registry");this.backendName===ce&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,ce in this.registry&&(this.disposeRegisteredKernels(ce),this.registry[ce].dispose(),delete this.registry[ce]),delete this.registryFactory[ce],this.backendName===ce&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},oe.prototype.getSortedBackends=function(){var ce=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(be,Ee){return ce.registryFactory[Ee].priority-ce.registryFactory[be].priority})},oe.prototype.initializeBackendsAndReturnBest=function(){for(var ce=this.getSortedBackends(),be=0;be<ce.length;be++){var Ee=ce[be],ve=this.initializeBackend(Ee),ge=ve.success,Ge=ve.asyncInit;if(Ge||ge)return{name:Ee,asyncInit:Ge}}throw new Error("Could not initialize any backends, all backend initializations failed.")},oe.prototype.moveData=function(ce,be){var Ee=this.state.tensorInfo.get(be),ve=Ee.backend,ge=this.readSync(be);ve.disposeData(be),Ee.backend=ce,ce.move(be,ge,Ee.shape,Ee.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},oe.prototype.tidy=function(ce,be){var Ee,ve=this,ge=null;if(be==null){if(typeof ce!="function")throw new Error("Please provide a function to tidy()");be=ce}else{if(typeof ce!="string"&&!(ce instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof be!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");ge=ce}return this.scopedRun(function(){return ve.startScope(ge)},function(){return ve.endScope(Ee)},function(){return(Ee=be())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Ee})},oe.prototype.scopedRun=function(ce,be,Ee){ce();try{var ve=Ee();return be(),ve}catch(ge){throw be(),ge}},oe.prototype.nextTensorId=function(){return oe.nextTensorId++},oe.prototype.nextVariableId=function(){return oe.nextVariableId++},oe.prototype.clone=function(ce){var be=this.makeTensorFromDataId(ce.dataId,ce.shape,ce.dtype),Ee={x:ce};return this.addTapeNode(this.state.activeScope.name,Ee,[be],function(ve){return{x:function(){return ve.toFloat()}}},[],{}),be},oe.prototype.runKernel=function(ce,be,Ee,ve,ge){return this.runKernelFunc(null,be,null,ce,Ee,ve,ge)},oe.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},oe.prototype.checkKernelForMemLeak=function(ce,be,Ee){var ve=this.backend.numDataIds(),ge=0;Ee.forEach(function(It){ge+=It.dtype==="complex64"?3:1});var Ge=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],ht=ve-be-ge-Ge;if(ht>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+ht+" data ids) after running '"+ce+"'")},oe.prototype.runKernelFunc=function(ce,be,Ee,ve,ge,Ge,ht){var It,St=this,we=[],bt=this.isTapeOn();ve==null&&(ve=this.state.activeScope!=null?this.state.activeScope.name:"");var jt,Mt=this.state.numBytes,ze=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var Ut,Ft=N.getKernel(ve,this.backendName);if(Ft!=null)jt=function(){var yt=St.backend.numDataIds();Ut=Ft.kernelFunc({inputs:be,attrs:ge,backend:St.backend});var nn=Array.isArray(Ut)?Ut:[Ut];St.shouldCheckForMemLeaks()&&St.checkKernelForMemLeak(ve,yt,nn);var xt=nn.map(function(Fn){var Rn=Fn.dataId,cn=Fn.shape,qe=Fn.dtype;return St.makeTensorFromDataId(Rn,cn,qe)});if(bt){var _t=St.getTensorsForGradient(ve,be,xt);if(_t==null){ht==null&&(ht=[]);var Yt=xt.filter(function(Fn,Rn){return ht[Rn]});_t=(Ge||[]).slice().concat(Yt)}we=St.saveTensorsForBackwardMode(_t)}return xt};else{var pt=function(yt){bt&&(we=yt.map(function(nn){return St.keep(St.clone(nn))}))};jt=function(){var yt=St.backend.numDataIds();Ut=St.tidy(function(){return ce(St.backend,pt)});var nn=Array.isArray(Ut)?Ut:[Ut];return St.shouldCheckForMemLeaks()&&St.checkKernelForMemLeak(ve,yt,nn),nn}}return this.scopedRun(function(){return St.state.kernelDepth++},function(){return St.state.kernelDepth--},function(){It=St.ENV.getBool("DEBUG")?St.profiler.profileKernel(ve,be,function(){return jt()}):jt()}),bt&&this.addTapeNode(ve,be,It,Ee,we,ge),this.state.profiling&&this.state.activeProfile.kernels.push({name:ve,bytesAdded:this.state.numBytes-Mt,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-ze,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(be).map(function(yt){return be[yt].shape}),outputShapes:It.map(function(yt){return yt.shape})}),Array.isArray(Ut)?It:It[0]},oe.prototype.saveTensorsForBackwardMode=function(ce){var be=this;return ce.map(function(Ee){return be.keep(be.clone(Ee))})},oe.prototype.getTensorsForGradient=function(ce,be,Ee){var ve=N.getGradient(ce);if(ve!=null){var ge=ve.inputsToSave||[],Ge=ve.outputsToSave||[],ht=void 0;ve.saveAllInputs?(I.assert(Array.isArray(be),function(){return"saveAllInputs is true, expected inputs to be an array."}),ht=Object.keys(be).map(function(St){return be[St]})):ht=ge.map(function(St){return be[St]});var It=Ee.filter(function(St,we){return Ge[we]});return ht.concat(It)}return null},oe.prototype.makeTensor=function(ce,be,Ee,ve){if(ce==null)throw new Error("Values passed to engine.makeTensor() are null");Ee=Ee||"float32",ve=ve||this.backend;var ge=ce;Ee==="string"&&I.isString(ce[0])&&(ge=ce.map(function(we){return I.encodeString(we)}));var Ge=ve.write(ge,be,Ee),ht=new z.Tensor(be,Ee,Ge,this.nextTensorId());if(this.incRef(ht,ve),Ee==="string"){var It=this.state.tensorInfo.get(Ge),St=Z.bytesFromStringArray(ge);this.state.numBytes+=St-It.bytes,It.bytes=St}return ht},oe.prototype.makeTensorFromDataId=function(ce,be,Ee,ve){Ee=Ee||"float32";var ge=new z.Tensor(be,Ee,ce,this.nextTensorId());return this.incRef(ge,ve),ge},oe.prototype.makeVariable=function(ce,be,Ee,ve){be===void 0&&(be=!0),Ee=Ee||this.nextVariableId().toString(),ve!=null&&ve!==ce.dtype&&(ce=ce.asType(ve));var ge=new z.Variable(ce,be,Ee,this.nextTensorId());if(this.state.registeredVariables[ge.name]!=null)throw new Error("Variable with name "+ge.name+" was already registered");return this.state.registeredVariables[ge.name]=ge,this.incRef(ge,this.backend),ge},oe.prototype.incRef=function(ce,be){var Ee=this.state.tensorInfo.has(ce.dataId)?this.state.tensorInfo.get(ce.dataId).refCount:0;if(this.state.numTensors++,ce.dtype==="string"&&this.state.numStringTensors++,Ee===0){this.state.numDataBuffers++;var ve=0;ce.dtype!=="complex64"&&ce.dtype!=="string"&&(ve=ce.size*I.bytesPerElement(ce.dtype)),this.state.tensorInfo.set(ce.dataId,{backend:be||this.backend,dtype:ce.dtype,shape:ce.shape,bytes:ve,refCount:0}),this.state.numBytes+=ve}this.state.tensorInfo.get(ce.dataId).refCount++,ce instanceof z.Variable||this.track(ce)},oe.prototype.disposeTensor=function(ce){if(this.state.tensorInfo.has(ce.dataId)){this.state.numTensors--,ce.dtype==="string"&&this.state.numStringTensors--;var be=this.state.tensorInfo.get(ce.dataId);be.refCount<=1?(ce.dtype!=="complex64"&&(this.state.numBytes-=be.bytes),this.state.numDataBuffers--,be.backend.disposeData(ce.dataId),this.state.tensorInfo.delete(ce.dataId)):this.state.tensorInfo.get(ce.dataId).refCount--}},oe.prototype.disposeVariables=function(){for(var ce in this.state.registeredVariables){var be=this.state.registeredVariables[ce];this.disposeVariable(be)}},oe.prototype.disposeVariable=function(ce){this.disposeTensor(ce),this.state.registeredVariables[ce.name]!=null&&delete this.state.registeredVariables[ce.name]},oe.prototype.memory=function(){var ce=this.backend.memory();return ce.numTensors=this.state.numTensors,ce.numDataBuffers=this.state.numDataBuffers,ce.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(ce.unreliable=!0,ce.reasons==null&&(ce.reasons=[]),ce.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),ce},oe.prototype.profile=function(ce){return S(this,void 0,void 0,function(){var be,Ee;return O(this,function(ve){return this.state.profiling=!0,be=this.state.numBytes,Ee=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=ce(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(ge){return ge.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-be,this.state.activeProfile.newTensors=this.state.numTensors-Ee,[2,this.state.activeProfile]})})},oe.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},oe.prototype.addTapeNode=function(ce,be,Ee,ve,ge,Ge){var ht=this,It={id:this.state.nextTapeNodeId++,kernelName:ce,inputs:be,outputs:Ee,saved:ge},St=N.getGradient(ce);St!=null&&(ve=St.gradFunc),ve!=null&&(It.gradient=function(we){return we=we.map(function(bt,jt){if(bt==null){var Mt=Ee[jt],ze=I.makeZerosTypedArray(Mt.size,Mt.dtype);return ht.makeTensor(ze,Mt.shape,Mt.dtype)}return bt}),ve(we.length>1?we:we[0],ge,Ge)}),this.state.activeTape.push(It)},oe.prototype.keep=function(ce){return ce.kept=!0,ce},oe.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},oe.prototype.endTape=function(){this.state.gradientDepth--},oe.prototype.startScope=function(ce){var be={track:[],name:"unnamed scope",id:this.state.nextScopeId++};ce&&(be.name=ce),this.state.scopeStack.push(be),this.state.activeScope=be},oe.prototype.endScope=function(ce){for(var be=this,Ee=q.getTensorsInContainer(ce),ve=new Set(Ee.map(function(It){return It.id})),ge=0;ge<this.state.activeScope.track.length;ge++){var Ge=this.state.activeScope.track[ge];Ge.kept||ve.has(Ge.id)||Ge.dispose()}var ht=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],Ee.forEach(function(It){It.kept||It.scopeId!==ht.id||be.track(It)})},oe.prototype.gradients=function(ce,be,Ee,ve){var ge=this;if(ve===void 0&&(ve=!1),I.assert(be.length>0,function(){return"gradients() received an empty list of xs."}),Ee!=null&&Ee.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+Ee.dtype+"'");var Ge=this.scopedRun(function(){return ge.startTape()},function(){return ge.endTape()},function(){return ge.tidy("forward",ce)});I.assert(Ge instanceof z.Tensor,function(){return"The result y returned by f() must be a tensor."});var ht=W.getFilteredNodesXToY(this.state.activeTape,be,Ge);if(!ve&&ht.length===0&&be.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var It={};It[Ge.id]=Ee??function(we){var bt=Z.makeOnesTypedArray(Z.sizeFromShape(we),"float32");return s.ENGINE.makeTensor(bt,we,"float32")}(Ge.shape),W.backpropagateGradients(It,ht,function(we){return ge.tidy(we)});var St=be.map(function(we){return It[we.id]});return ge.state.gradientDepth===0&&(ge.state.activeTape.forEach(function(we){for(var bt=0,jt=we.saved;bt<jt.length;bt++)jt[bt].dispose()}),ge.state.activeTape=null),{value:Ge,grads:St}})},oe.prototype.customGrad=function(ce){var be=this;return I.assert(I.isFunction(ce),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var Ee,ve=[],ge=0;ge<arguments.length;ge++)ve[ge]=arguments[ge];I.assert(ve.every(function(ht){return ht instanceof z.Tensor}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var Ge={};return ve.forEach(function(ht,It){Ge[It]=ht}),be.runKernelFunc(function(ht,It){return Ee=ce.apply(void 0,ve.concat([It])),I.assert(Ee.value instanceof z.Tensor,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),I.assert(I.isFunction(Ee.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),Ee.value},Ge,function(ht,It){var St=Ee.gradFunc(ht,It),we=Array.isArray(St)?St:[St];I.assert(we.length===ve.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),I.assert(we.every(function(jt){return jt instanceof z.Tensor}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var bt={};return we.forEach(function(jt,Mt){bt[Mt]=function(){return jt}}),bt})}},oe.prototype.readSync=function(ce){return this.state.tensorInfo.get(ce).backend.readSync(ce)},oe.prototype.read=function(ce){return this.state.tensorInfo.get(ce).backend.read(ce)},oe.prototype.time=function(ce){return S(this,void 0,void 0,function(){var be,Ee;return O(this,function(ve){switch(ve.label){case 0:return be=Z.now(),[4,this.backend.time(ce)];case 1:return(Ee=ve.sent()).wallMs=Z.now()-be,[2,Ee]}})})},oe.prototype.track=function(ce){return this.state.activeScope!=null&&(ce.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(ce)),ce},Object.defineProperty(oe.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),oe.prototype.reset=function(){for(var ce in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Y,this.registry)this.disposeRegisteredKernels(ce),this.registry[ce].dispose(),delete this.registry[ce];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},oe.nextTensorId=0,oe.nextVariableId=0,oe}();s.Engine=G,s.ENGINE=function(){var oe=function(){if(U==null){var be=void 0;if(typeof window<"u")be=window;else if(l!==void 0)be=l;else if(C!==void 0)be=C;else{if(typeof self>"u")throw new Error("Could not find a global object");be=self}U=be}return U}();if(oe._tfengine==null){var ce=new j.Environment(oe);oe._tfengine=new G(ce)}return j.setEnvironmentGlobal(oe._tfengine.ENV),z.setTensorTracker(function(){return oe._tfengine}),oe._tfengine}()}).call(this,r(59),r(75))},function(u,s,r){var l=r(14),C=r(240),S=r(66),O=Object.defineProperty;s.f=r(27)?Object.defineProperty:function(U,j,N){if(l(U),j=S(j,!0),l(N),C)try{return O(U,j,N)}catch{}if("get"in N||"set"in N)throw TypeError("Accessors not supported!");return"value"in N&&(U[j]=N.value),U}},function(u,s,r){u.exports=!r(15)(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7})},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(25);s.op=function(C){var S=Object.keys(C);if(S.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+S.length+" keys.");var O=S[0],U=C[O];O.endsWith("_")&&(O=O.substring(0,O.length-1));var j=function(){for(var N=[],L=0;L<arguments.length;L++)N[L]=arguments[L];l.ENGINE.startScope(O);try{var W=U.apply(void 0,N);return W instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),l.ENGINE.endScope(W),W}catch(z){throw l.ENGINE.endScope(null),z}};return Object.defineProperty(j,"name",{value:O,configurable:!0}),j}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(25),C=r(103),S=r(33),O=r(21);function U(L,W){var z=L;if(O.isTypedArray(L))return W==="string"?[]:[L.length];if(!Array.isArray(L))return[];for(var q=[];Array.isArray(z)||O.isTypedArray(z)&&W!=="string";)q.push(z.length),z=z[0];return Array.isArray(L)&&C.env().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function I(Z,Y,G){if(G=G||[],!Array.isArray(Z)&&!O.isTypedArray(Z))return void O.assert(Y.length===0,function(){return"Element arr["+G.join("][")+"] is a primitive, but should be an array/TypedArray of "+Y[0]+" elements"});O.assert(Y.length>0,function(){return"Element arr["+G.join("][")+"] should be a primitive, but is an array of "+Z.length+" elements"}),O.assert(Z.length===Y[0],function(){return"Element arr["+G.join("][")+"] should have "+Y[0]+" elements, but has "+Z.length+" elements"});for(var oe=Y.slice(1),ce=0;ce<Z.length;++ce)I(Z[ce],oe,G.concat(ce))}(L,q,[]),q}function j(L,W,z,q){if(L!=null&&(L!=="numeric"&&L!==W||L==="numeric"&&W==="string"))throw new Error("Argument '"+z+"' passed to '"+q+"' must be "+L+" tensor, but got "+W+" tensor")}function N(L,W,z,q){if(q===void 0&&(q="numeric"),L instanceof S.Tensor)return j(q,L.dtype,W,z),L;var I=O.inferDtype(L);if(I!=="string"&&["bool","int32","float32"].indexOf(q)>=0&&(I=q),j(q,I,W,z),L==null||!O.isTypedArray(L)&&!Array.isArray(L)&&typeof L!="number"&&typeof L!="boolean"&&typeof L!="string"){var Z=L==null?"null":L.constructor.name;throw new Error("Argument '"+W+"' passed to '"+z+"' must be a Tensor or TensorLike, but got '"+Z+"'")}var Y=U(L,I);O.isTypedArray(L)||Array.isArray(L)||(L=[L]);var G=I!=="string"?O.toTypedArray(L,I,C.env().getBool("DEBUG")):O.flatten(L,[],!0);return l.ENGINE.makeTensor(G,Y,I)}s.inferShape=U,s.convertToTensor=N,s.convertToTensorArray=function(L,W,z,q){if(q===void 0&&(q="numeric"),!Array.isArray(L))throw new Error("Argument "+W+" passed to "+z+" must be a `Tensor[]` or `TensorLike[]`");return L.map(function(I,Z){return N(I,W+"["+Z+"]",z)},q)}},function(u,s,r){var l=r(254),C=r(253),S=r(187),O=r(252);u.exports=function(U){return l(U)||C(U)||S(U)||O()},u.exports.__esModule=!0,u.exports.default=u.exports},function(u,s,r){r.d(s,"a",function(){return S});var l=new Date,C=new Date;function S(O,U,j,N){function L(W){return O(W=arguments.length===0?new Date:new Date(+W)),W}return L.floor=function(W){return O(W=new Date(+W)),W},L.ceil=function(W){return O(W=new Date(W-1)),U(W,1),O(W),W},L.round=function(W){var z=L(W),q=L.ceil(W);return W-z<q-W?z:q},L.offset=function(W,z){return U(W=new Date(+W),z==null?1:Math.floor(z)),W},L.range=function(W,z,q){var I,Z=[];if(W=L.ceil(W),q=q==null?1:Math.floor(q),!(W<z&&q>0))return Z;do Z.push(I=new Date(+W)),U(W,q),O(W);while(I<W&&W<z);return Z},L.filter=function(W){return S(function(z){if(z>=z)for(;O(z),!W(z);)z.setTime(z-1)},function(z,q){if(z>=z)if(q<0)for(;++q<=0;)for(;U(z,-1),!W(z););else for(;--q>=0;)for(;U(z,1),!W(z););})},j&&(L.count=function(W,z){return l.setTime(+W),C.setTime(+z),O(l),O(C),Math.floor(j(l,C))},L.every=function(W){return W=Math.floor(W),isFinite(W)&&W>0?W>1?L.filter(N?function(z){return N(z)%W==0}:function(z){return L.count(0,z)%W==0}):L:null}),L}},function(u,s,r){const l=r(116),{MAX_LENGTH:C,MAX_SAFE_INTEGER:S}=r(117),{re:O,t:U}=r(90),j=r(115),{compareIdentifiers:N}=r(146);class L{constructor(z,q){if(q=j(q),z instanceof L){if(z.loose===!!q.loose&&z.includePrerelease===!!q.includePrerelease)return z;z=z.version}else if(typeof z!="string")throw new TypeError(`Invalid Version: ${z}`);if(z.length>C)throw new TypeError(`version is longer than ${C} characters`);l("SemVer",z,q),this.options=q,this.loose=!!q.loose,this.includePrerelease=!!q.includePrerelease;const I=z.trim().match(q.loose?O[U.LOOSE]:O[U.FULL]);if(!I)throw new TypeError(`Invalid Version: ${z}`);if(this.raw=z,this.major=+I[1],this.minor=+I[2],this.patch=+I[3],this.major>S||this.major<0)throw new TypeError("Invalid major version");if(this.minor>S||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>S||this.patch<0)throw new TypeError("Invalid patch version");I[4]?this.prerelease=I[4].split(".").map(Z=>{if(/^[0-9]+$/.test(Z)){const Y=+Z;if(Y>=0&&Y<S)return Y}return Z}):this.prerelease=[],this.build=I[5]?I[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(z){if(l("SemVer.compare",this.version,this.options,z),!(z instanceof L)){if(typeof z=="string"&&z===this.version)return 0;z=new L(z,this.options)}return z.version===this.version?0:this.compareMain(z)||this.comparePre(z)}compareMain(z){return z instanceof L||(z=new L(z,this.options)),N(this.major,z.major)||N(this.minor,z.minor)||N(this.patch,z.patch)}comparePre(z){if(z instanceof L||(z=new L(z,this.options)),this.prerelease.length&&!z.prerelease.length)return-1;if(!this.prerelease.length&&z.prerelease.length)return 1;if(!this.prerelease.length&&!z.prerelease.length)return 0;let q=0;do{const I=this.prerelease[q],Z=z.prerelease[q];if(l("prerelease compare",q,I,Z),I===void 0&&Z===void 0)return 0;if(Z===void 0)return 1;if(I===void 0)return-1;if(I!==Z)return N(I,Z)}while(++q)}compareBuild(z){z instanceof L||(z=new L(z,this.options));let q=0;do{const I=this.build[q],Z=z.build[q];if(l("prerelease compare",q,I,Z),I===void 0&&Z===void 0)return 0;if(Z===void 0)return 1;if(I===void 0)return-1;if(I!==Z)return N(I,Z)}while(++q)}inc(z,q){switch(z){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",q);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",q);break;case"prepatch":this.prerelease.length=0,this.inc("patch",q),this.inc("pre",q);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",q),this.inc("pre",q);break;case"major":this.minor===0&&this.patch===0&&this.prerelease.length!==0||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":this.patch===0&&this.prerelease.length!==0||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let I=this.prerelease.length;for(;--I>=0;)typeof this.prerelease[I]=="number"&&(this.prerelease[I]++,I=-2);I===-1&&this.prerelease.push(0)}q&&(this.prerelease[0]===q?isNaN(this.prerelease[1])&&(this.prerelease=[q,0]):this.prerelease=[q,0]);break;default:throw new Error(`invalid increment argument: ${z}`)}return this.format(),this.raw=this.version,this}}u.exports=L},function(u,s,r){var l=this&&this.__extends||function(){var Z=function(Y,G){return(Z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(oe,ce){oe.__proto__=ce}||function(oe,ce){for(var be in ce)ce.hasOwnProperty(be)&&(oe[be]=ce[be])})(Y,G)};return function(Y,G){function oe(){this.constructor=Y}Z(Y,G),Y.prototype=G===null?Object.create(G):(oe.prototype=G.prototype,new oe)}}(),C=this&&this.__awaiter||function(Z,Y,G,oe){return new(G||(G=Promise))(function(ce,be){function Ee(Ge){try{ge(oe.next(Ge))}catch(ht){be(ht)}}function ve(Ge){try{ge(oe.throw(Ge))}catch(ht){be(ht)}}function ge(Ge){Ge.done?ce(Ge.value):new G(function(ht){ht(Ge.value)}).then(Ee,ve)}ge((oe=oe.apply(Z,Y||[])).next())})},S=this&&this.__generator||function(Z,Y){var G,oe,ce,be,Ee={label:0,sent:function(){if(1&ce[0])throw ce[1];return ce[1]},trys:[],ops:[]};return be={next:ve(0),throw:ve(1),return:ve(2)},typeof Symbol=="function"&&(be[Symbol.iterator]=function(){return this}),be;function ve(ge){return function(Ge){return function(ht){if(G)throw new TypeError("Generator is already executing.");for(;Ee;)try{if(G=1,oe&&(ce=2&ht[0]?oe.return:ht[0]?oe.throw||((ce=oe.return)&&ce.call(oe),0):oe.next)&&!(ce=ce.call(oe,ht[1])).done)return ce;switch(oe=0,ce&&(ht=[2&ht[0],ce.value]),ht[0]){case 0:case 1:ce=ht;break;case 4:return Ee.label++,{value:ht[1],done:!1};case 5:Ee.label++,oe=ht[1],ht=[0];continue;case 7:ht=Ee.ops.pop(),Ee.trys.pop();continue;default:if(!(ce=(ce=Ee.trys).length>0&&ce[ce.length-1])&&(ht[0]===6||ht[0]===2)){Ee=0;continue}if(ht[0]===3&&(!ce||ht[1]>ce[0]&&ht[1]<ce[3])){Ee.label=ht[1];break}if(ht[0]===6&&Ee.label<ce[1]){Ee.label=ce[1],ce=ht;break}if(ce&&Ee.label<ce[2]){Ee.label=ce[2],Ee.ops.push(ht);break}ce[2]&&Ee.ops.pop(),Ee.trys.pop();continue}ht=Y.call(Z,Ee)}catch(It){ht=[6,It],oe=0}finally{G=ce=0}if(5&ht[0])throw ht[1];return{value:ht[0]?ht[1]:void 0,done:!0}}([ge,Ge])}}};Object.defineProperty(s,"__esModule",{value:!0});var O=r(379),U=r(21),j=r(21),N=function(){function Z(Y,G,oe){var ce=this;if(this.dtype=G,this.shape=Y.slice(),this.size=U.sizeFromShape(Y),oe!=null){var be=oe.length;U.assert(be===this.size,function(){return"Length of values '"+be+"' does not match the size inferred by the shape '"+ce.size+"'."})}if(G==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=oe||U.getArrayFromDType(G,this.size),this.strides=j.computeStrides(Y)}return Z.prototype.set=function(Y){for(var G=this,oe=[],ce=1;ce<arguments.length;ce++)oe[ce-1]=arguments[ce];oe.length===0&&(oe=[0]),U.assert(oe.length===this.rank,function(){return"The number of provided coordinates ("+oe.length+") must match the rank ("+G.rank+")"});var be=this.locToIndex(oe);this.values[be]=Y},Z.prototype.get=function(){for(var Y=[],G=0;G<arguments.length;G++)Y[G]=arguments[G];Y.length===0&&(Y=[0]);for(var oe=0,ce=0,be=Y;ce<be.length;ce++){var Ee=be[ce];if(Ee<0||Ee>=this.shape[oe]){var ve="Requested out of range element at "+Y+".   Buffer shape="+this.shape;throw new Error(ve)}oe++}for(var ge=Y[Y.length-1],Ge=0;Ge<Y.length-1;++Ge)ge+=this.strides[Ge]*Y[Ge];return this.values[ge]},Z.prototype.locToIndex=function(Y){if(this.rank===0)return 0;if(this.rank===1)return Y[0];for(var G=Y[Y.length-1],oe=0;oe<Y.length-1;++oe)G+=this.strides[oe]*Y[oe];return G},Z.prototype.indexToLoc=function(Y){if(this.rank===0)return[];if(this.rank===1)return[Y];for(var G=new Array(this.shape.length),oe=0;oe<G.length-1;++oe)G[oe]=Math.floor(Y/this.strides[oe]),Y-=G[oe]*this.strides[oe];return G[G.length-1]=Y,G},Object.defineProperty(Z.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),Z.prototype.toTensor=function(){return L().makeTensor(this.values,this.shape,this.dtype)},Z}();s.TensorBuffer=N;var L=null,W=null,z=null;s.setTensorTracker=function(Z){L=Z},s.setOpHandler=function(Z){W=Z},s.setDeprecationWarningFn=function(Z){z=Z};var q=function(){function Z(Y,G,oe,ce){this.kept=!1,this.isDisposedInternal=!1,this.shape=Y.slice(),this.dtype=G||"float32",this.size=U.sizeFromShape(Y),this.strides=j.computeStrides(Y),this.dataId=oe,this.id=ce,this.rankType=this.rank<5?this.rank.toString():"higher"}return Z.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},Z.prototype.asScalar=function(){return this.throwIfDisposed(),U.assert(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},Z.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},Z.prototype.as2D=function(Y,G){return this.throwIfDisposed(),this.reshape([Y,G])},Z.prototype.as3D=function(Y,G,oe){return this.throwIfDisposed(),this.reshape([Y,G,oe])},Z.prototype.as4D=function(Y,G,oe,ce){return this.throwIfDisposed(),this.reshape([Y,G,oe,ce])},Z.prototype.as5D=function(Y,G,oe,ce,be){return this.throwIfDisposed(),this.reshape([Y,G,oe,ce,be])},Z.prototype.asType=function(Y){return this.throwIfDisposed(),W.cast(this,Y)},Object.defineProperty(Z.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),Z.prototype.buffer=function(){return C(this,void 0,void 0,function(){var Y;return S(this,function(G){switch(G.label){case 0:return[4,this.data()];case 1:return Y=G.sent(),[2,W.buffer(this.shape,this.dtype,Y)]}})})},Z.prototype.bufferSync=function(){return W.buffer(this.shape,this.dtype,this.dataSync())},Z.prototype.array=function(){return C(this,void 0,void 0,function(){var Y;return S(this,function(G){switch(G.label){case 0:return[4,this.data()];case 1:return Y=G.sent(),[2,j.toNestedArray(this.shape,Y)]}})})},Z.prototype.arraySync=function(){return j.toNestedArray(this.shape,this.dataSync())},Z.prototype.data=function(){return C(this,void 0,void 0,function(){var Y,G;return S(this,function(oe){switch(oe.label){case 0:return this.throwIfDisposed(),Y=L().read(this.dataId),this.dtype!=="string"?[3,2]:[4,Y];case 1:G=oe.sent();try{return[2,G.map(function(ce){return U.decodeString(ce)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}oe.label=2;case 2:return[2,Y]}})})},Z.prototype.dataSync=function(){this.throwIfDisposed();var Y=L().readSync(this.dataId);if(this.dtype==="string")try{return Y.map(function(G){return U.decodeString(G)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return Y},Z.prototype.bytes=function(){return C(this,void 0,void 0,function(){var Y;return S(this,function(G){switch(G.label){case 0:return this.throwIfDisposed(),[4,L().read(this.dataId)];case 1:return Y=G.sent(),this.dtype==="string"?[2,Y]:[2,new Uint8Array(Y.buffer)]}})})},Z.prototype.dispose=function(){this.isDisposed||(L().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(Z.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),Z.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},Z.prototype.toFloat=function(){return this.asType("float32")},Z.prototype.toInt=function(){return this.asType("int32")},Z.prototype.toBool=function(){return this.asType("bool")},Z.prototype.print=function(Y){return Y===void 0&&(Y=!1),W.print(this,Y)},Z.prototype.reshape=function(Y){return this.throwIfDisposed(),W.reshape(this,Y)},Z.prototype.reshapeAs=function(Y){return this.throwIfDisposed(),this.reshape(Y.shape)},Z.prototype.expandDims=function(Y){return Y===void 0&&(Y=0),W.expandDims(this,Y)},Z.prototype.cumsum=function(Y,G,oe){return Y===void 0&&(Y=0),G===void 0&&(G=!1),oe===void 0&&(oe=!1),W.cumsum(this,Y,G,oe)},Z.prototype.squeeze=function(Y){return this.throwIfDisposed(),W.squeeze(this,Y)},Z.prototype.clone=function(){return this.throwIfDisposed(),W.clone(this)},Z.prototype.toString=function(Y){Y===void 0&&(Y=!1);var G=this.dataSync();return O.tensorToString(G,this.shape,this.dtype,Y)},Z.prototype.gather=function(Y,G){return G===void 0&&(G=0),this.throwIfDisposed(),W.gather(this,Y,G)},Z.prototype.matMul=function(Y,G,oe){return G===void 0&&(G=!1),oe===void 0&&(oe=!1),this.throwIfDisposed(),W.matMul(this,Y,G,oe)},Z.prototype.dot=function(Y){return this.throwIfDisposed(),W.dot(this,Y)},Z.prototype.norm=function(Y,G,oe){return Y===void 0&&(Y="euclidean"),G===void 0&&(G=null),oe===void 0&&(oe=!1),this.throwIfDisposed(),W.norm(this,Y,G,oe)},Z.prototype.slice=function(Y,G){return this.throwIfDisposed(),W.slice(this,Y,G)},Z.prototype.reverse=function(Y){return this.throwIfDisposed(),W.reverse(this,Y)},Z.prototype.concat=function(Y,G){return G===void 0&&(G=0),this.throwIfDisposed(),Y instanceof Z&&(Y=[Y]),W.concat([this].concat(Y),G)},Z.prototype.split=function(Y,G){return G===void 0&&(G=0),this.throwIfDisposed(),W.split(this,Y,G)},Z.prototype.stack=function(Y,G){return G===void 0&&(G=0),W.stack([this,Y],G)},Z.prototype.unstack=function(Y){return Y===void 0&&(Y=0),W.unstack(this,Y)},Z.prototype.batchNormalization=function(Y,G,oe,ce,be){return oe===void 0&&(oe=.001),z("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(Y,G,be,ce,oe)},Z.prototype.all=function(Y,G){return Y===void 0&&(Y=null),G===void 0&&(G=!1),this.throwIfDisposed(),W.all(this,Y,G)},Z.prototype.any=function(Y,G){return Y===void 0&&(Y=null),G===void 0&&(G=!1),this.throwIfDisposed(),W.any(this,Y,G)},Z.prototype.logSumExp=function(Y,G){return Y===void 0&&(Y=null),G===void 0&&(G=!1),this.throwIfDisposed(),W.logSumExp(this,Y,G)},Z.prototype.sum=function(Y,G){return Y===void 0&&(Y=null),G===void 0&&(G=!1),this.throwIfDisposed(),W.sum(this,Y,G)},Z.prototype.prod=function(Y,G){return Y===void 0&&(Y=null),G===void 0&&(G=!1),this.throwIfDisposed(),W.prod(this,Y,G)},Z.prototype.mean=function(Y,G){return Y===void 0&&(Y=null),G===void 0&&(G=!1),this.throwIfDisposed(),W.mean(this,Y,G)},Z.prototype.min=function(Y,G){return Y===void 0&&(Y=null),G===void 0&&(G=!1),this.throwIfDisposed(),W.min(this,Y,G)},Z.prototype.max=function(Y,G){return Y===void 0&&(Y=null),G===void 0&&(G=!1),this.throwIfDisposed(),W.max(this,Y,G)},Z.prototype.argMin=function(Y){return Y===void 0&&(Y=null),this.throwIfDisposed(),W.argMin(this,Y)},Z.prototype.argMax=function(Y){return Y===void 0&&(Y=null),this.throwIfDisposed(),W.argMax(this,Y)},Z.prototype.cast=function(Y){return this.throwIfDisposed(),W.cast(this,Y)},Z.prototype.addStrict=function(Y){return this.throwIfDisposed(),W.addStrict(this,Y)},Z.prototype.atan2=function(Y){return this.throwIfDisposed(),W.atan2(this,Y)},Z.prototype.sub=function(Y){return this.throwIfDisposed(),W.sub(this,Y)},Z.prototype.subStrict=function(Y){return this.throwIfDisposed(),W.subStrict(this,Y)},Z.prototype.pow=function(Y){return this.throwIfDisposed(),W.pow(this,Y)},Z.prototype.powStrict=function(Y){return this.throwIfDisposed(),W.powStrict(this,Y)},Z.prototype.mul=function(Y){return this.throwIfDisposed(),W.mul(this,Y)},Z.prototype.mulStrict=function(Y){return this.throwIfDisposed(),W.mulStrict(this,Y)},Z.prototype.floorDiv=function(Y){return this.throwIfDisposed(),W.floorDiv(this,Y)},Z.prototype.divStrict=function(Y){return this.throwIfDisposed(),W.divStrict(this,Y)},Z.prototype.minimum=function(Y){return this.throwIfDisposed(),W.minimum(this,Y)},Z.prototype.minimumStrict=function(Y){return this.throwIfDisposed(),W.minimumStrict(this,Y)},Z.prototype.maximum=function(Y){return this.throwIfDisposed(),W.maximum(this,Y)},Z.prototype.maximumStrict=function(Y){return this.throwIfDisposed(),W.maximumStrict(this,Y)},Z.prototype.mod=function(Y){return this.throwIfDisposed(),W.mod(this,Y)},Z.prototype.modStrict=function(Y){return this.throwIfDisposed(),W.modStrict(this,Y)},Z.prototype.squaredDifferenceStrict=function(Y){return this.throwIfDisposed(),W.squaredDifferenceStrict(this,Y)},Z.prototype.notEqual=function(Y){return this.throwIfDisposed(),W.notEqual(this,Y)},Z.prototype.notEqualStrict=function(Y){return this.throwIfDisposed(),W.notEqualStrict(this,Y)},Z.prototype.less=function(Y){return this.throwIfDisposed(),W.less(this,Y)},Z.prototype.lessStrict=function(Y){return this.throwIfDisposed(),W.lessStrict(this,Y)},Z.prototype.equal=function(Y){return this.throwIfDisposed(),W.equal(this,Y)},Z.prototype.equalStrict=function(Y){return this.throwIfDisposed(),W.equalStrict(this,Y)},Z.prototype.lessEqual=function(Y){return this.throwIfDisposed(),W.lessEqual(this,Y)},Z.prototype.lessEqualStrict=function(Y){return this.throwIfDisposed(),W.lessEqualStrict(this,Y)},Z.prototype.greater=function(Y){return this.throwIfDisposed(),W.greater(this,Y)},Z.prototype.greaterStrict=function(Y){return this.throwIfDisposed(),W.greaterStrict(this,Y)},Z.prototype.greaterEqual=function(Y){return this.throwIfDisposed(),W.greaterEqual(this,Y)},Z.prototype.greaterEqualStrict=function(Y){return this.throwIfDisposed(),W.greaterEqualStrict(this,Y)},Z.prototype.logicalAnd=function(Y){return this.throwIfDisposed(),W.logicalAnd(this,Y)},Z.prototype.logicalOr=function(Y){return this.throwIfDisposed(),W.logicalOr(this,Y)},Z.prototype.logicalNot=function(){return this.throwIfDisposed(),W.logicalNot(this)},Z.prototype.logicalXor=function(Y){return this.throwIfDisposed(),W.logicalXor(this,Y)},Z.prototype.where=function(Y,G){return this.throwIfDisposed(),W.where(Y,this,G)},Z.prototype.neg=function(){return this.throwIfDisposed(),W.neg(this)},Z.prototype.ceil=function(){return this.throwIfDisposed(),W.ceil(this)},Z.prototype.floor=function(){return this.throwIfDisposed(),W.floor(this)},Z.prototype.sign=function(){return this.throwIfDisposed(),W.sign(this)},Z.prototype.isNaN=function(){return this.throwIfDisposed(),W.isNaN(this)},Z.prototype.isInf=function(){return this.throwIfDisposed(),W.isInf(this)},Z.prototype.isFinite=function(){return this.throwIfDisposed(),W.isFinite(this)},Z.prototype.exp=function(){return this.throwIfDisposed(),W.exp(this)},Z.prototype.expm1=function(){return this.throwIfDisposed(),W.expm1(this)},Z.prototype.log=function(){return this.throwIfDisposed(),W.log(this)},Z.prototype.log1p=function(){return this.throwIfDisposed(),W.log1p(this)},Z.prototype.sqrt=function(){return this.throwIfDisposed(),W.sqrt(this)},Z.prototype.rsqrt=function(){return this.throwIfDisposed(),W.rsqrt(this)},Z.prototype.square=function(){return this.throwIfDisposed(),W.square(this)},Z.prototype.reciprocal=function(){return this.throwIfDisposed(),W.reciprocal(this)},Z.prototype.abs=function(){return this.throwIfDisposed(),W.abs(this)},Z.prototype.clipByValue=function(Y,G){return this.throwIfDisposed(),W.clipByValue(this,Y,G)},Z.prototype.relu=function(){return this.throwIfDisposed(),W.relu(this)},Z.prototype.relu6=function(){return this.throwIfDisposed(),W.relu6(this)},Z.prototype.elu=function(){return this.throwIfDisposed(),W.elu(this)},Z.prototype.selu=function(){return this.throwIfDisposed(),W.selu(this)},Z.prototype.leakyRelu=function(Y){return Y===void 0&&(Y=.2),this.throwIfDisposed(),W.leakyRelu(this,Y)},Z.prototype.prelu=function(Y){return this.throwIfDisposed(),W.prelu(this,Y)},Z.prototype.sigmoid=function(){return this.throwIfDisposed(),W.sigmoid(this)},Z.prototype.logSigmoid=function(){return this.throwIfDisposed(),W.logSigmoid(this)},Z.prototype.softplus=function(){return this.throwIfDisposed(),W.softplus(this)},Z.prototype.zerosLike=function(){return this.throwIfDisposed(),W.zerosLike(this)},Z.prototype.onesLike=function(){return this.throwIfDisposed(),W.onesLike(this)},Z.prototype.sin=function(){return this.throwIfDisposed(),W.sin(this)},Z.prototype.cos=function(){return this.throwIfDisposed(),W.cos(this)},Z.prototype.tan=function(){return this.throwIfDisposed(),W.tan(this)},Z.prototype.asin=function(){return this.throwIfDisposed(),W.asin(this)},Z.prototype.acos=function(){return this.throwIfDisposed(),W.acos(this)},Z.prototype.atan=function(){return this.throwIfDisposed(),W.atan(this)},Z.prototype.sinh=function(){return this.throwIfDisposed(),W.sinh(this)},Z.prototype.cosh=function(){return this.throwIfDisposed(),W.cosh(this)},Z.prototype.tanh=function(){return this.throwIfDisposed(),W.tanh(this)},Z.prototype.asinh=function(){return this.throwIfDisposed(),W.asinh(this)},Z.prototype.acosh=function(){return this.throwIfDisposed(),W.acosh(this)},Z.prototype.atanh=function(){return this.throwIfDisposed(),W.atanh(this)},Z.prototype.erf=function(){return this.throwIfDisposed(),W.erf(this)},Z.prototype.round=function(){return this.throwIfDisposed(),W.round(this)},Z.prototype.step=function(Y){return Y===void 0&&(Y=0),this.throwIfDisposed(),W.step(this,Y)},Z.prototype.softmax=function(Y){return Y===void 0&&(Y=-1),this.throwIfDisposed(),W.softmax(this,Y)},Z.prototype.logSoftmax=function(Y){return Y===void 0&&(Y=-1),this.throwIfDisposed(),W.logSoftmax(this,Y)},Z.prototype.resizeBilinear=function(Y,G){return G===void 0&&(G=!1),this.throwIfDisposed(),W.image.resizeBilinear(this,Y,G)},Z.prototype.resizeNearestNeighbor=function(Y,G){return G===void 0&&(G=!1),this.throwIfDisposed(),W.image.resizeNearestNeighbor(this,Y,G)},Z.prototype.conv1d=function(Y,G,oe,ce,be,Ee){return ce===void 0&&(ce="NWC"),be===void 0&&(be=1),this.throwIfDisposed(),W.conv1d(this,Y,G,oe,ce,be,Ee)},Z.prototype.conv2d=function(Y,G,oe,ce,be,Ee){return ce===void 0&&(ce="NHWC"),be===void 0&&(be=[1,1]),this.throwIfDisposed(),W.conv2d(this,Y,G,oe,ce,be,Ee)},Z.prototype.conv2dTranspose=function(Y,G,oe,ce,be){return this.throwIfDisposed(),W.conv2dTranspose(this,Y,G,oe,ce,be)},Z.prototype.depthwiseConv2D=function(Y,G,oe,ce,be,Ee){return ce===void 0&&(ce="NHWC"),be===void 0&&(be=[1,1]),this.throwIfDisposed(),W.depthwiseConv2d(this,Y,G,oe,ce,be,Ee)},Z.prototype.separableConv2d=function(Y,G,oe,ce,be,Ee){return be===void 0&&(be=[1,1]),Ee===void 0&&(Ee="NHWC"),this.throwIfDisposed(),W.separableConv2d(this,Y,G,oe,ce,be,Ee)},Z.prototype.avgPool=function(Y,G,oe,ce){return this.throwIfDisposed(),W.avgPool(this,Y,G,oe,ce)},Z.prototype.maxPool=function(Y,G,oe,ce){return this.throwIfDisposed(),W.maxPool(this,Y,G,oe,ce)},Z.prototype.localResponseNormalization=function(Y,G,oe,ce){return Y===void 0&&(Y=5),G===void 0&&(G=1),oe===void 0&&(oe=1),ce===void 0&&(ce=.5),W.localResponseNormalization(this,Y,G,oe,ce)},Z.prototype.pool=function(Y,G,oe,ce,be){return this.throwIfDisposed(),W.pool(this,Y,G,oe,ce,be)},Z.prototype.variable=function(Y,G,oe){return Y===void 0&&(Y=!0),this.throwIfDisposed(),L().makeVariable(this,Y,G,oe)},Z.prototype.unsortedSegmentSum=function(Y,G){return this.throwIfDisposed(),W.unsortedSegmentSum(this,Y,G)},Z.prototype.batchToSpaceND=function(Y,G){return this.throwIfDisposed(),W.batchToSpaceND(this,Y,G)},Z.prototype.spaceToBatchND=function(Y,G){return this.throwIfDisposed(),W.spaceToBatchND(this,Y,G)},Z.prototype.topk=function(Y,G){return Y===void 0&&(Y=1),G===void 0&&(G=!0),this.throwIfDisposed(),W.topk(this,Y,G)},Z.prototype.stridedSlice=function(Y,G,oe,ce,be,Ee,ve,ge){return ce===void 0&&(ce=0),be===void 0&&(be=0),Ee===void 0&&(Ee=0),ve===void 0&&(ve=0),ge===void 0&&(ge=0),this.throwIfDisposed(),W.stridedSlice(this,Y,G,oe,ce,be,Ee,ve,ge)},Z.prototype.depthToSpace=function(Y,G){return this.throwIfDisposed(),W.depthToSpace(this,Y,G)},Z.prototype.fft=function(){return this.throwIfDisposed(),W.spectral.fft(this)},Z.prototype.ifft=function(){return this.throwIfDisposed(),W.spectral.ifft(this)},Z.prototype.rfft=function(){return this.throwIfDisposed(),W.spectral.rfft(this)},Z.prototype.irfft=function(){return this.throwIfDisposed(),W.spectral.irfft(this)},Z}();s.Tensor=q,Object.defineProperty(q,Symbol.hasInstance,{value:function(Z){return!!Z&&Z.dataId!=null&&Z.shape!=null&&Z.dtype!=null}});var I=function(Z){function Y(G,oe,ce,be){var Ee=Z.call(this,G.shape,G.dtype,G.dataId,be)||this;return Ee.trainable=oe,Ee.name=ce,Ee}return l(Y,Z),Y.prototype.assign=function(G){if(G.dtype!==this.dtype)throw new Error("dtype of the new value ("+G.dtype+") and previous value ("+this.dtype+") must match");if(!U.arraysEqual(G.shape,this.shape))throw new Error("shape of the new value ("+G.shape+") and previous value ("+this.shape+") must match");L().disposeTensor(this),this.dataId=G.dataId,L().incRef(this,null)},Y.prototype.dispose=function(){L().disposeVariable(this),this.isDisposedInternal=!0},Y}(q);s.Variable=I,Object.defineProperty(I,Symbol.hasInstance,{value:function(Z){return Z instanceof q&&Z.assign!=null&&Z.assign instanceof Function}})},function(u,s,r){var l=r(61);u.exports=function(C){return Object(l(C))}},function(u,s){function r(l){return u.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(C){return C.__proto__||Object.getPrototypeOf(C)},u.exports.__esModule=!0,u.exports.default=u.exports,r(l)}u.exports=r,u.exports.__esModule=!0,u.exports.default=u.exports},function(u,s,r){var l=r(195),C=Object.prototype.toString;function S(W){return C.call(W)==="[object Array]"}function O(W){return W===void 0}function U(W){return W!==null&&typeof W=="object"}function j(W){if(C.call(W)!=="[object Object]")return!1;var z=Object.getPrototypeOf(W);return z===null||z===Object.prototype}function N(W){return C.call(W)==="[object Function]"}function L(W,z){if(W!=null)if(typeof W!="object"&&(W=[W]),S(W))for(var q=0,I=W.length;q<I;q++)z.call(null,W[q],q,W);else for(var Z in W)Object.prototype.hasOwnProperty.call(W,Z)&&z.call(null,W[Z],Z,W)}u.exports={isArray:S,isArrayBuffer:function(W){return C.call(W)==="[object ArrayBuffer]"},isBuffer:function(W){return W!==null&&!O(W)&&W.constructor!==null&&!O(W.constructor)&&typeof W.constructor.isBuffer=="function"&&W.constructor.isBuffer(W)},isFormData:function(W){return typeof FormData<"u"&&W instanceof FormData},isArrayBufferView:function(W){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(W):W&&W.buffer&&W.buffer instanceof ArrayBuffer},isString:function(W){return typeof W=="string"},isNumber:function(W){return typeof W=="number"},isObject:U,isPlainObject:j,isUndefined:O,isDate:function(W){return C.call(W)==="[object Date]"},isFile:function(W){return C.call(W)==="[object File]"},isBlob:function(W){return C.call(W)==="[object Blob]"},isFunction:N,isStream:function(W){return U(W)&&N(W.pipe)},isURLSearchParams:function(W){return typeof URLSearchParams<"u"&&W instanceof URLSearchParams},isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:L,merge:function W(){var z={};function q(Y,G){j(z[G])&&j(Y)?z[G]=W(z[G],Y):j(Y)?z[G]=W({},Y):S(Y)?z[G]=Y.slice():z[G]=Y}for(var I=0,Z=arguments.length;I<Z;I++)L(arguments[I],q);return z},extend:function(W,z,q){return L(z,function(I,Z){W[Z]=q&&typeof I=="function"?l(I,q):I}),W},trim:function(W){return W.trim?W.trim():W.replace(/^\s+|\s+$/g,"")},stripBOM:function(W){return W.charCodeAt(0)===65279&&(W=W.slice(1)),W}}},function(u,s,r){var l=r(8),C=r(15),S=r(61),O=/"/g,U=function(j,N,L,W){var z=String(S(j)),q="<"+N;return L!==""&&(q+=" "+L+'="'+String(W).replace(O,"&quot;")+'"'),q+">"+z+"</"+N+">"};u.exports=function(j,N){var L={};L[j]=N(U),l(l.P+l.F*C(function(){var W=""[j]('"');return W!==W.toLowerCase()||W.split('"').length>3}),"String",L)}},function(u,s,r){var l=r(16),C=r(42),S=r(43),O=r(84)("src"),U=r(576),j=(""+U).split("toString");r(24).inspectSource=function(N){return U.call(N)},(u.exports=function(N,L,W,z){var q=typeof W=="function";q&&(S(W,"name")||C(W,"name",L)),N[L]!==W&&(q&&(S(W,O)||C(W,O,N[L]?""+N[L]:j.join(String(L)))),N===l?N[L]=W:z?N[L]?N[L]=W:C(N,L,W):(delete N[L],C(N,L,W)))})(Function.prototype,"toString",function(){return typeof this=="function"&&this[O]||U.call(this)})},function(u,s,r){r.d(s,"b",function(){return O}),r.d(s,"a",function(){return U}),r.d(s,"c",function(){return L});var l=r(31),C=r(12);function S(q){return Object(l.a)(function(I){I.setUTCDate(I.getUTCDate()-(I.getUTCDay()+7-q)%7),I.setUTCHours(0,0,0,0)},function(I,Z){I.setUTCDate(I.getUTCDate()+7*Z)},function(I,Z){return(Z-I)/C.f})}var O=S(0),U=S(1),j=S(2),N=S(3),L=S(4),W=S(5),z=S(6);O.range,U.range,j.range,N.range,L.range,W.range,z.range},function(u,s,r){r.d(s,"b",function(){return O}),r.d(s,"a",function(){return U}),r.d(s,"c",function(){return L});var l=r(31),C=r(12);function S(q){return Object(l.a)(function(I){I.setDate(I.getDate()-(I.getDay()+7-q)%7),I.setHours(0,0,0,0)},function(I,Z){I.setDate(I.getDate()+7*Z)},function(I,Z){return(Z-I-(Z.getTimezoneOffset()-I.getTimezoneOffset())*C.c)/C.f})}var O=S(0),U=S(1),j=S(2),N=S(3),L=S(4),W=S(5),z=S(6);O.range,U.range,j.range,N.range,L.range,W.range,z.range},function(u,s,r){var l=r(107),C=r(61);u.exports=function(S){return l(C(S))}},function(u,s,r){var l=r(26),C=r(85);u.exports=r(27)?function(S,O,U){return l.f(S,O,C(1,U))}:function(S,O,U){return S[O]=U,S}},function(u,s){var r={}.hasOwnProperty;u.exports=function(l,C){return r.call(l,C)}},function(u,s,r){var l=r(45),C=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function S(cn){if(!(qe=C.exec(cn)))throw new Error("invalid format: "+cn);var qe;return new O({fill:qe[1],align:qe[2],sign:qe[3],symbol:qe[4],zero:qe[5],width:qe[6],comma:qe[7],precision:qe[8]&&qe[8].slice(1),trim:qe[9],type:qe[10]})}function O(cn){this.fill=cn.fill===void 0?" ":cn.fill+"",this.align=cn.align===void 0?">":cn.align+"",this.sign=cn.sign===void 0?"-":cn.sign+"",this.symbol=cn.symbol===void 0?"":cn.symbol+"",this.zero=!!cn.zero,this.width=cn.width===void 0?void 0:+cn.width,this.comma=!!cn.comma,this.precision=cn.precision===void 0?void 0:+cn.precision,this.trim=!!cn.trim,this.type=cn.type===void 0?"":cn.type+""}S.prototype=O.prototype,O.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,0|this.width))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};function U(cn,qe){if((Qe=(cn=qe?cn.toExponential(qe-1):cn.toExponential()).indexOf("e"))<0)return null;var Qe,$e=cn.slice(0,Qe);return[$e.length>1?$e[0]+$e.slice(2):$e,+cn.slice(Qe+1)]}var j,N,L,W,z=function(cn){return(cn=U(Math.abs(cn)))?cn[1]:NaN},q=function(cn,qe){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(z(qe)/3)))-z(Math.abs(cn)))},I=function(cn,qe){return cn=Math.abs(cn),qe=Math.abs(qe)-cn,Math.max(0,z(qe)-z(cn))+1},Z=function(cn){return Math.max(0,-z(Math.abs(cn)))},Y=function(cn){e:for(var qe,Qe=cn.length,$e=1,ft=-1;$e<Qe;++$e)switch(cn[$e]){case".":ft=qe=$e;break;case"0":ft===0&&(ft=$e),qe=$e;break;default:if(!+cn[$e])break e;ft>0&&(ft=0)}return ft>0?cn.slice(0,ft)+cn.slice(qe+1):cn},G=function(cn,qe){var Qe=U(cn,qe);if(!Qe)return cn+"";var $e=Qe[0],ft=Qe[1];return ft<0?"0."+new Array(-ft).join("0")+$e:$e.length>ft+1?$e.slice(0,ft+1)+"."+$e.slice(ft+1):$e+new Array(ft-$e.length+2).join("0")},oe={"%":(cn,qe)=>(100*cn).toFixed(qe),b:cn=>Math.round(cn).toString(2),c:cn=>cn+"",d:function(cn){return Math.abs(cn=Math.round(cn))>=1e21?cn.toLocaleString("en").replace(/,/g,""):cn.toString(10)},e:(cn,qe)=>cn.toExponential(qe),f:(cn,qe)=>cn.toFixed(qe),g:(cn,qe)=>cn.toPrecision(qe),o:cn=>Math.round(cn).toString(8),p:(cn,qe)=>G(100*cn,qe),r:G,s:function(cn,qe){var Qe=U(cn,qe);if(!Qe)return cn+"";var $e=Qe[0],ft=Qe[1],Jt=ft-(j=3*Math.max(-8,Math.min(8,Math.floor(ft/3))))+1,Qt=$e.length;return Jt===Qt?$e:Jt>Qt?$e+new Array(Jt-Qt+1).join("0"):Jt>0?$e.slice(0,Jt)+"."+$e.slice(Jt):"0."+new Array(1-Jt).join("0")+U(cn,Math.max(0,qe+Jt-1))[0]},X:cn=>Math.round(cn).toString(16).toUpperCase(),x:cn=>Math.round(cn).toString(16)},ce=function(cn){return cn},be=Array.prototype.map,Ee=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"],ve=function(cn){var qe=cn.grouping===void 0||cn.thousands===void 0?ce:function(ke,ar){return function(Tr,rn){for(var Ht=Tr.length,Gn=[],Xt=0,Wt=ke[0],Zt=0;Ht>0&&Wt>0&&(Zt+Wt+1>rn&&(Wt=Math.max(1,rn-Zt)),Gn.push(Tr.substring(Ht-=Wt,Ht+Wt)),!((Zt+=Wt+1)>rn));)Wt=ke[Xt=(Xt+1)%ke.length];return Gn.reverse().join(ar)}}(be.call(cn.grouping,Number),cn.thousands+""),Qe=cn.currency===void 0?"":cn.currency[0]+"",$e=cn.currency===void 0?"":cn.currency[1]+"",ft=cn.decimal===void 0?".":cn.decimal+"",Jt=cn.numerals===void 0?ce:function(ke){return function(ar){return ar.replace(/[0-9]/g,function(Tr){return ke[+Tr]})}}(be.call(cn.numerals,String)),Qt=cn.percent===void 0?"%":cn.percent+"",Pn=cn.minus===void 0?"":cn.minus+"",kn=cn.nan===void 0?"NaN":cn.nan+"";function Qn(ke){var ar=(ke=S(ke)).fill,Tr=ke.align,rn=ke.sign,Ht=ke.symbol,Gn=ke.zero,Xt=ke.width,Wt=ke.comma,Zt=ke.precision,Vn=ke.trim,xn=ke.type;xn==="n"?(Wt=!0,xn="g"):oe[xn]||(Zt===void 0&&(Zt=12),Vn=!0,xn="g"),(Gn||ar==="0"&&Tr==="=")&&(Gn=!0,ar="0",Tr="=");var Un=Ht==="$"?Qe:Ht==="#"&&/[boxX]/.test(xn)?"0"+xn.toLowerCase():"",ur=Ht==="$"?$e:/[%p]/.test(xn)?Qt:"",sr=oe[xn],Er=/[defgprs%]/.test(xn);function Mr(pr){var ri,Kr,ti,jn=Un,ir=ur;if(xn==="c")ir=sr(pr)+ir,pr="";else{var Cr=(pr=+pr)<0||1/pr<0;if(pr=isNaN(pr)?kn:sr(Math.abs(pr),Zt),Vn&&(pr=Y(pr)),Cr&&+pr==0&&rn!=="+"&&(Cr=!1),jn=(Cr?rn==="("?rn:Pn:rn==="-"||rn==="("?"":rn)+jn,ir=(xn==="s"?Ee[8+j/3]:"")+ir+(Cr&&rn==="("?")":""),Er){for(ri=-1,Kr=pr.length;++ri<Kr;)if(48>(ti=pr.charCodeAt(ri))||ti>57){ir=(ti===46?ft+pr.slice(ri+1):pr.slice(ri))+ir,pr=pr.slice(0,ri);break}}}Wt&&!Gn&&(pr=qe(pr,1/0));var Hr=jn.length+pr.length+ir.length,qr=Hr<Xt?new Array(Xt-Hr+1).join(ar):"";switch(Wt&&Gn&&(pr=qe(qr+pr,qr.length?Xt-ir.length:1/0),qr=""),Tr){case"<":pr=jn+pr+ir+qr;break;case"=":pr=jn+qr+pr+ir;break;case"^":pr=qr.slice(0,Hr=qr.length>>1)+jn+pr+ir+qr.slice(Hr);break;default:pr=qr+jn+pr+ir}return Jt(pr)}return Zt=Zt===void 0?6:/[gprs]/.test(xn)?Math.max(1,Math.min(21,Zt)):Math.max(0,Math.min(20,Zt)),Mr.toString=function(){return ke+""},Mr}return{format:Qn,formatPrefix:function(ke,ar){var Tr=Qn(((ke=S(ke)).type="f",ke)),rn=3*Math.max(-8,Math.min(8,Math.floor(z(ar)/3))),Ht=Math.pow(10,-rn),Gn=Ee[8+rn/3];return function(Xt){return Tr(Ht*Xt)+Gn}}}};(function(cn){N=ve(cn),L=N.format,W=N.formatPrefix})({thousands:",",grouping:[3],currency:["$",""]});var ge=r(11),Ge=r(1),ht=r(100),It=r(246);function St(cn){const qe={};return Qe=>qe[Qe]||(qe[Qe]=cn(Qe))}function we(cn){const qe=St(cn.format),Qe=cn.formatPrefix;return{format:qe,formatPrefix:Qe,formatFloat($e){const ft=S($e||",");if(ft.precision==null){switch(ft.precision=12,ft.type){case"%":ft.precision-=2;break;case"e":ft.precision-=1}return function(Jt,Qt){return Pn=>{const kn=Jt(Pn),Qn=kn.indexOf(Qt);if(Qn<0)return kn;let ke=function(Tr,rn){let Ht,Gn=Tr.lastIndexOf("e");if(Gn>0)return Gn;for(Gn=Tr.length;--Gn>rn;)if((Ht=Tr.charCodeAt(Gn))>=48&&Ht<=57)return Gn+1}(kn,Qn);const ar=ke<kn.length?kn.slice(ke):"";for(;--ke>Qn;)if(kn[ke]!=="0"){++ke;break}return kn.slice(0,ke)+ar}}(qe(ft),qe(".1f")(1)[1])}return qe(ft)},formatSpan($e,ft,Jt,Qt){Qt=S(Qt??",f");const Pn=Object(l.c)($e,ft,Jt),kn=Math.max(Math.abs($e),Math.abs(ft));let Qn;if(Qt.precision==null)switch(Qt.type){case"s":return isNaN(Qn=q(Pn,kn))||(Qt.precision=Qn),Qe(Qt,kn);case"":case"e":case"g":case"p":case"r":isNaN(Qn=I(Pn,kn))||(Qt.precision=Qn-(Qt.type==="e"));break;case"f":case"%":isNaN(Qn=Z(Pn))||(Qt.precision=Qn-2*(Qt.type==="%"))}return qe(Qt)}}}let bt,jt;function Mt(){return bt=we({format:L,formatPrefix:W})}function ze(cn){return we(ve(cn))}function Ut(cn){return arguments.length?bt=ze(cn):bt}function Ft(cn,qe,Qe){Qe=Qe||{},Object(Ge.H)(Qe)||Object(Ge.o)("Invalid time multi-format specifier: ".concat(Qe));const $e=qe(ge.i),ft=qe(ge.f),Jt=qe(ge.d),Qt=qe(ge.a),Pn=qe(ge.k),kn=qe(ge.g),Qn=qe(ge.h),ke=qe(ge.l),ar=cn(Qe[ge.e]||".%L"),Tr=cn(Qe[ge.i]||":%S"),rn=cn(Qe[ge.f]||"%I:%M"),Ht=cn(Qe[ge.d]||"%I %p"),Gn=cn(Qe[ge.a]||Qe[ge.b]||"%a %d"),Xt=cn(Qe[ge.k]||"%b %d"),Wt=cn(Qe[ge.g]||"%B"),Zt=cn(Qe[ge.h]||"%B"),Vn=cn(Qe[ge.l]||"%Y");return xn=>($e(xn)<xn?ar:ft(xn)<xn?Tr:Jt(xn)<xn?rn:Qt(xn)<xn?Ht:kn(xn)<xn?Pn(xn)<xn?Gn:Xt:ke(xn)<xn?Qn(xn)<xn?Wt:Zt:Vn)(xn)}function pt(cn){const qe=St(cn.format),Qe=St(cn.utcFormat);return{timeFormat:$e=>Object(Ge.J)($e)?qe($e):Ft(qe,ge.p,$e),utcFormat:$e=>Object(Ge.J)($e)?Qe($e):Ft(Qe,ge.v,$e),timeParse:St(cn.parse),utcParse:St(cn.utcParse)}}function yt(){return jt=pt({format:ht.a,parse:ht.b,utcFormat:ht.c,utcParse:ht.d})}function nn(cn){return pt(Object(It.a)(cn))}function xt(cn){return arguments.length?jt=nn(cn):jt}r.d(s,"a",function(){return Fn}),r.d(s,"b",function(){return Yt}),r.d(s,"c",function(){return Ut}),r.d(s,"d",function(){return Rn}),r.d(s,"e",function(){return xt}),Mt(),yt();const _t=(cn,qe)=>Object(Ge.p)({},cn,qe);function Yt(cn,qe){const Qe=cn?ze(cn):Ut(),$e=qe?nn(qe):xt();return _t(Qe,$e)}function Fn(cn,qe){const Qe=arguments.length;return Qe&&Qe!==2&&Object(Ge.o)("defaultLocale expects either zero or two arguments."),Qe?_t(Ut(cn),xt(qe)):_t(Ut(),xt())}function Rn(){return Mt(),yt(),Fn()}},function(u,s,r){r.d(s,"b",function(){return O}),r.d(s,"c",function(){return U});var l=Math.sqrt(50),C=Math.sqrt(10),S=Math.sqrt(2);function O(j,N,L){var W=(N-j)/Math.max(0,L),z=Math.floor(Math.log(W)/Math.LN10),q=W/Math.pow(10,z);return z>=0?(q>=l?10:q>=C?5:q>=S?2:1)*Math.pow(10,z):-Math.pow(10,-z)/(q>=l?10:q>=C?5:q>=S?2:1)}function U(j,N,L){var W=Math.abs(N-j)/Math.max(0,L),z=Math.pow(10,Math.floor(Math.log(W)/Math.LN10)),q=W/z;return q>=l?z*=10:q>=C?z*=5:q>=S&&(z*=2),N<j?-z:z}s.a=function(j,N,L){var W,z,q,I,Z=-1;if(L=+L,(j=+j)==(N=+N)&&L>0)return[j];if((W=N<j)&&(z=j,j=N,N=z),(I=O(j,N,L))===0||!isFinite(I))return[];if(I>0){let Y=Math.round(j/I),G=Math.round(N/I);for(Y*I<j&&++Y,G*I>N&&--G,q=new Array(z=G-Y+1);++Z<z;)q[Z]=(Y+Z)*I}else{I=-I;let Y=Math.round(j*I),G=Math.round(N*I);for(Y/I<j&&++Y,G/I>N&&--G,q=new Array(z=G-Y+1);++Z<z;)q[Z]=(Y+Z)/I}return W&&q.reverse(),q}},function(u,s,r){var l=this&&this.__awaiter||function(O,U,j,N){return new(j||(j=Promise))(function(L,W){function z(Z){try{I(N.next(Z))}catch(Y){W(Y)}}function q(Z){try{I(N.throw(Z))}catch(Y){W(Y)}}function I(Z){Z.done?L(Z.value):new j(function(Y){Y(Z.value)}).then(z,q)}I((N=N.apply(O,U||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0});const C=r(198),S=r(197);s.getDrawArea=function(O){if(O instanceof HTMLElement)return O;if(C.isSurface(O))return O.drawArea;if(C.isSurfaceInfo(O))return S.visor().surface({name:O.name,tab:O.tab,styles:O.styles}).drawArea;throw new Error("Not a drawable")},s.shallowEquals=function(O,U){const j=Object.getOwnPropertyNames(O),N=Object.getOwnPropertyNames(U);if(j.length!==N.length)return!1;for(let L=0;L<j.length;L++){const W=j[L];if(O[W]!==U[W])return!1}return!0},s.nextFrame=function(){return l(this,void 0,void 0,function*(){yield new Promise(O=>requestAnimationFrame(O))})}},function(u,s,r){class l{constructor(jt,Mt){if(Mt=S(Mt),jt instanceof l)return jt.loose===!!Mt.loose&&jt.includePrerelease===!!Mt.includePrerelease?jt:new l(jt.raw,Mt);if(jt instanceof O)return this.raw=jt.value,this.set=[[jt]],this.format(),this;if(this.options=Mt,this.loose=!!Mt.loose,this.includePrerelease=!!Mt.includePrerelease,this.raw=jt,this.set=jt.split(/\s*\|\|\s*/).map(ze=>this.parseRange(ze.trim())).filter(ze=>ze.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${jt}`);if(this.set.length>1){const ze=this.set[0];if(this.set=this.set.filter(Ut=>!I(Ut[0])),this.set.length===0)this.set=[ze];else if(this.set.length>1){for(const Ut of this.set)if(Ut.length===1&&Z(Ut[0])){this.set=[Ut];break}}}this.format()}format(){return this.range=this.set.map(jt=>jt.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(jt){jt=jt.trim();const Mt=`parseRange:${Object.keys(this.options).join(",")}:${jt}`,ze=C.get(Mt);if(ze)return ze;const Ut=this.options.loose,Ft=Ut?N[L.HYPHENRANGELOOSE]:N[L.HYPHENRANGE];jt=jt.replace(Ft,St(this.options.includePrerelease)),U("hyphen replace",jt),jt=jt.replace(N[L.COMPARATORTRIM],W),U("comparator trim",jt,N[L.COMPARATORTRIM]),jt=(jt=(jt=jt.replace(N[L.TILDETRIM],z)).replace(N[L.CARETTRIM],q)).split(/\s+/).join(" ");const pt=Ut?N[L.COMPARATORLOOSE]:N[L.COMPARATOR],yt=jt.split(" ").map(_t=>G(_t,this.options)).join(" ").split(/\s+/).map(_t=>It(_t,this.options)).filter(this.options.loose?_t=>!!_t.match(pt):()=>!0).map(_t=>new O(_t,this.options)),nn=(yt.length,new Map);for(const _t of yt){if(I(_t))return[_t];nn.set(_t.value,_t)}nn.size>1&&nn.has("")&&nn.delete("");const xt=[...nn.values()];return C.set(Mt,xt),xt}intersects(jt,Mt){if(!(jt instanceof l))throw new TypeError("a Range is required");return this.set.some(ze=>Y(ze,Mt)&&jt.set.some(Ut=>Y(Ut,Mt)&&ze.every(Ft=>Ut.every(pt=>Ft.intersects(pt,Mt)))))}test(jt){if(!jt)return!1;if(typeof jt=="string")try{jt=new j(jt,this.options)}catch{return!1}for(let Mt=0;Mt<this.set.length;Mt++)if(we(this.set[Mt],jt,this.options))return!0;return!1}}u.exports=l;const C=new(r(335))({max:1e3}),S=r(115),O=r(113),U=r(116),j=r(32),{re:N,t:L,comparatorTrimReplace:W,tildeTrimReplace:z,caretTrimReplace:q}=r(90),I=bt=>bt.value==="<0.0.0-0",Z=bt=>bt.value==="",Y=(bt,jt)=>{let Mt=!0;const ze=bt.slice();let Ut=ze.pop();for(;Mt&&ze.length;)Mt=ze.every(Ft=>Ut.intersects(Ft,jt)),Ut=ze.pop();return Mt},G=(bt,jt)=>(U("comp",bt,jt),bt=Ee(bt,jt),U("caret",bt),bt=ce(bt,jt),U("tildes",bt),bt=ge(bt,jt),U("xrange",bt),bt=ht(bt,jt),U("stars",bt),bt),oe=bt=>!bt||bt.toLowerCase()==="x"||bt==="*",ce=(bt,jt)=>bt.trim().split(/\s+/).map(Mt=>be(Mt,jt)).join(" "),be=(bt,jt)=>{const Mt=jt.loose?N[L.TILDELOOSE]:N[L.TILDE];return bt.replace(Mt,(ze,Ut,Ft,pt,yt)=>{let nn;return U("tilde",bt,ze,Ut,Ft,pt,yt),oe(Ut)?nn="":oe(Ft)?nn=`>=${Ut}.0.0 <${+Ut+1}.0.0-0`:oe(pt)?nn=`>=${Ut}.${Ft}.0 <${Ut}.${+Ft+1}.0-0`:yt?(U("replaceTilde pr",yt),nn=`>=${Ut}.${Ft}.${pt}-${yt} <${Ut}.${+Ft+1}.0-0`):nn=`>=${Ut}.${Ft}.${pt} <${Ut}.${+Ft+1}.0-0`,U("tilde return",nn),nn})},Ee=(bt,jt)=>bt.trim().split(/\s+/).map(Mt=>ve(Mt,jt)).join(" "),ve=(bt,jt)=>{U("caret",bt,jt);const Mt=jt.loose?N[L.CARETLOOSE]:N[L.CARET],ze=jt.includePrerelease?"-0":"";return bt.replace(Mt,(Ut,Ft,pt,yt,nn)=>{let xt;return U("caret",bt,Ut,Ft,pt,yt,nn),oe(Ft)?xt="":oe(pt)?xt=`>=${Ft}.0.0${ze} <${+Ft+1}.0.0-0`:oe(yt)?xt=Ft==="0"?`>=${Ft}.${pt}.0${ze} <${Ft}.${+pt+1}.0-0`:`>=${Ft}.${pt}.0${ze} <${+Ft+1}.0.0-0`:nn?(U("replaceCaret pr",nn),xt=Ft==="0"?pt==="0"?`>=${Ft}.${pt}.${yt}-${nn} <${Ft}.${pt}.${+yt+1}-0`:`>=${Ft}.${pt}.${yt}-${nn} <${Ft}.${+pt+1}.0-0`:`>=${Ft}.${pt}.${yt}-${nn} <${+Ft+1}.0.0-0`):(U("no pr"),xt=Ft==="0"?pt==="0"?`>=${Ft}.${pt}.${yt}${ze} <${Ft}.${pt}.${+yt+1}-0`:`>=${Ft}.${pt}.${yt}${ze} <${Ft}.${+pt+1}.0-0`:`>=${Ft}.${pt}.${yt} <${+Ft+1}.0.0-0`),U("caret return",xt),xt})},ge=(bt,jt)=>(U("replaceXRanges",bt,jt),bt.split(/\s+/).map(Mt=>Ge(Mt,jt)).join(" ")),Ge=(bt,jt)=>{bt=bt.trim();const Mt=jt.loose?N[L.XRANGELOOSE]:N[L.XRANGE];return bt.replace(Mt,(ze,Ut,Ft,pt,yt,nn)=>{U("xRange",bt,ze,Ut,Ft,pt,yt,nn);const xt=oe(Ft),_t=xt||oe(pt),Yt=_t||oe(yt),Fn=Yt;return Ut==="="&&Fn&&(Ut=""),nn=jt.includePrerelease?"-0":"",xt?ze=Ut===">"||Ut==="<"?"<0.0.0-0":"*":Ut&&Fn?(_t&&(pt=0),yt=0,Ut===">"?(Ut=">=",_t?(Ft=+Ft+1,pt=0,yt=0):(pt=+pt+1,yt=0)):Ut==="<="&&(Ut="<",_t?Ft=+Ft+1:pt=+pt+1),Ut==="<"&&(nn="-0"),ze=`${Ut+Ft}.${pt}.${yt}${nn}`):_t?ze=`>=${Ft}.0.0${nn} <${+Ft+1}.0.0-0`:Yt&&(ze=`>=${Ft}.${pt}.0${nn} <${Ft}.${+pt+1}.0-0`),U("xRange return",ze),ze})},ht=(bt,jt)=>(U("replaceStars",bt,jt),bt.trim().replace(N[L.STAR],"")),It=(bt,jt)=>(U("replaceGTE0",bt,jt),bt.trim().replace(N[jt.includePrerelease?L.GTE0PRE:L.GTE0],"")),St=bt=>(jt,Mt,ze,Ut,Ft,pt,yt,nn,xt,_t,Yt,Fn,Rn)=>`${Mt=oe(ze)?"":oe(Ut)?`>=${ze}.0.0${bt?"-0":""}`:oe(Ft)?`>=${ze}.${Ut}.0${bt?"-0":""}`:pt?`>=${Mt}`:`>=${Mt}${bt?"-0":""}`} ${nn=oe(xt)?"":oe(_t)?`<${+xt+1}.0.0-0`:oe(Yt)?`<${xt}.${+_t+1}.0-0`:Fn?`<=${xt}.${_t}.${Yt}-${Fn}`:bt?`<${xt}.${_t}.${+Yt+1}-0`:`<=${nn}`}`.trim(),we=(bt,jt,Mt)=>{for(let ze=0;ze<bt.length;ze++)if(!bt[ze].test(jt))return!1;if(jt.prerelease.length&&!Mt.includePrerelease){for(let ze=0;ze<bt.length;ze++)if(U(bt[ze].semver),bt[ze].semver!==O.ANY&&bt[ze].semver.prerelease.length>0){const Ut=bt[ze].semver;if(Ut.major===jt.major&&Ut.minor===jt.minor&&Ut.patch===jt.patch)return!0}return!1}return!0}},function(u,s,r){const l=r(32);u.exports=(C,S,O)=>new l(C,O).compare(new l(S,O))},function(u,s,r){var l=r(15);u.exports=function(C,S){return!!C&&l(function(){S?C.call(null,function(){},1):C.call(null)})}},function(u,s,r){r.r(s);var l=function(ve,ge){if((Ge=(ve=ge?ve.toExponential(ge-1):ve.toExponential()).indexOf("e"))<0)return null;var Ge,ht=ve.slice(0,Ge);return[ht.length>1?ht[0]+ht.slice(2):ht,+ve.slice(Ge+1)]},C=function(ve){return(ve=l(Math.abs(ve)))?ve[1]:NaN},S=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function O(ve){return new U(ve)}function U(ve){if(!(ge=S.exec(ve)))throw new Error("invalid format: "+ve);var ge;this.fill=ge[1]||" ",this.align=ge[2]||">",this.sign=ge[3]||"-",this.symbol=ge[4]||"",this.zero=!!ge[5],this.width=ge[6]&&+ge[6],this.comma=!!ge[7],this.precision=ge[8]&&+ge[8].slice(1),this.trim=!!ge[9],this.type=ge[10]||""}O.prototype=U.prototype,U.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width==null?"":Math.max(1,0|this.width))+(this.comma?",":"")+(this.precision==null?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var j,N,L,W,z=function(ve){e:for(var ge,Ge=ve.length,ht=1,It=-1;ht<Ge;++ht)switch(ve[ht]){case".":It=ge=ht;break;case"0":It===0&&(It=ht),ge=ht;break;default:if(It>0){if(!+ve[ht])break e;It=0}}return It>0?ve.slice(0,It)+ve.slice(ge+1):ve},q=function(ve,ge){var Ge=l(ve,ge);if(!Ge)return ve+"";var ht=Ge[0],It=Ge[1];return It<0?"0."+new Array(-It).join("0")+ht:ht.length>It+1?ht.slice(0,It+1)+"."+ht.slice(It+1):ht+new Array(It-ht.length+2).join("0")},I={"%":function(ve,ge){return(100*ve).toFixed(ge)},b:function(ve){return Math.round(ve).toString(2)},c:function(ve){return ve+""},d:function(ve){return Math.round(ve).toString(10)},e:function(ve,ge){return ve.toExponential(ge)},f:function(ve,ge){return ve.toFixed(ge)},g:function(ve,ge){return ve.toPrecision(ge)},o:function(ve){return Math.round(ve).toString(8)},p:function(ve,ge){return q(100*ve,ge)},r:q,s:function(ve,ge){var Ge=l(ve,ge);if(!Ge)return ve+"";var ht=Ge[0],It=Ge[1],St=It-(j=3*Math.max(-8,Math.min(8,Math.floor(It/3))))+1,we=ht.length;return St===we?ht:St>we?ht+new Array(St-we+1).join("0"):St>0?ht.slice(0,St)+"."+ht.slice(St):"0."+new Array(1-St).join("0")+l(ve,Math.max(0,ge+St-1))[0]},X:function(ve){return Math.round(ve).toString(16).toUpperCase()},x:function(ve){return Math.round(ve).toString(16)}},Z=function(ve){return ve},Y=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"],G=function(ve){var ge=ve.grouping&&ve.thousands?function(bt,jt){return function(Mt,ze){for(var Ut=Mt.length,Ft=[],pt=0,yt=bt[0],nn=0;Ut>0&&yt>0&&(nn+yt+1>ze&&(yt=Math.max(1,ze-nn)),Ft.push(Mt.substring(Ut-=yt,Ut+yt)),!((nn+=yt+1)>ze));)yt=bt[pt=(pt+1)%bt.length];return Ft.reverse().join(jt)}}(ve.grouping,ve.thousands):Z,Ge=ve.currency,ht=ve.decimal,It=ve.numerals?function(bt){return function(jt){return jt.replace(/[0-9]/g,function(Mt){return bt[+Mt]})}}(ve.numerals):Z,St=ve.percent||"%";function we(bt){var jt=(bt=O(bt)).fill,Mt=bt.align,ze=bt.sign,Ut=bt.symbol,Ft=bt.zero,pt=bt.width,yt=bt.comma,nn=bt.precision,xt=bt.trim,_t=bt.type;_t==="n"?(yt=!0,_t="g"):I[_t]||(nn==null&&(nn=12),xt=!0,_t="g"),(Ft||jt==="0"&&Mt==="=")&&(Ft=!0,jt="0",Mt="=");var Yt=Ut==="$"?Ge[0]:Ut==="#"&&/[boxX]/.test(_t)?"0"+_t.toLowerCase():"",Fn=Ut==="$"?Ge[1]:/[%p]/.test(_t)?St:"",Rn=I[_t],cn=/[defgprs%]/.test(_t);function qe(Qe){var $e,ft,Jt,Qt=Yt,Pn=Fn;if(_t==="c")Pn=Rn(Qe)+Pn,Qe="";else{var kn=(Qe=+Qe)<0;if(Qe=Rn(Math.abs(Qe),nn),xt&&(Qe=z(Qe)),kn&&+Qe==0&&(kn=!1),Qt=(kn?ze==="("?ze:"-":ze==="-"||ze==="("?"":ze)+Qt,Pn=(_t==="s"?Y[8+j/3]:"")+Pn+(kn&&ze==="("?")":""),cn){for($e=-1,ft=Qe.length;++$e<ft;)if(48>(Jt=Qe.charCodeAt($e))||Jt>57){Pn=(Jt===46?ht+Qe.slice($e+1):Qe.slice($e))+Pn,Qe=Qe.slice(0,$e);break}}}yt&&!Ft&&(Qe=ge(Qe,1/0));var Qn=Qt.length+Qe.length+Pn.length,ke=Qn<pt?new Array(pt-Qn+1).join(jt):"";switch(yt&&Ft&&(Qe=ge(ke+Qe,ke.length?pt-Pn.length:1/0),ke=""),Mt){case"<":Qe=Qt+Qe+Pn+ke;break;case"=":Qe=Qt+ke+Qe+Pn;break;case"^":Qe=ke.slice(0,Qn=ke.length>>1)+Qt+Qe+Pn+ke.slice(Qn);break;default:Qe=ke+Qt+Qe+Pn}return It(Qe)}return nn=nn==null?6:/[gprs]/.test(_t)?Math.max(1,Math.min(21,nn)):Math.max(0,Math.min(20,nn)),qe.toString=function(){return bt+""},qe}return{format:we,formatPrefix:function(bt,jt){var Mt=we(((bt=O(bt)).type="f",bt)),ze=3*Math.max(-8,Math.min(8,Math.floor(C(jt)/3))),Ut=Math.pow(10,-ze),Ft=Y[8+ze/3];return function(pt){return Mt(Ut*pt)+Ft}}}};function oe(ve){return N=G(ve),L=N.format,W=N.formatPrefix,N}oe({decimal:".",thousands:",",grouping:[3],currency:["$",""]});var ce=function(ve){return Math.max(0,-C(Math.abs(ve)))},be=function(ve,ge){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(C(ge)/3)))-C(Math.abs(ve)))},Ee=function(ve,ge){return ve=Math.abs(ve),ge=Math.abs(ge)-ve,Math.max(0,C(ge)-C(ve))+1};r.d(s,"formatDefaultLocale",function(){return oe}),r.d(s,"format",function(){return L}),r.d(s,"formatPrefix",function(){return W}),r.d(s,"formatLocale",function(){return G}),r.d(s,"formatSpecifier",function(){return O}),r.d(s,"precisionFixed",function(){return ce}),r.d(s,"precisionPrefix",function(){return be}),r.d(s,"precisionRound",function(){return Ee})},function(u,s,r){var l=r(56),C=r(107),S=r(34),O=r(22),U=r(224);u.exports=function(j,N){var L=j==1,W=j==2,z=j==3,q=j==4,I=j==6,Z=j==5||I,Y=N||U;return function(G,oe,ce){for(var be,Ee,ve=S(G),ge=C(ve),Ge=l(oe,ce,3),ht=O(ge.length),It=0,St=L?Y(G,ht):W?Y(G,0):void 0;ht>It;It++)if((Z||It in ge)&&(Ee=Ge(be=ge[It],It,ve),j)){if(L)St[It]=Ee;else if(Ee)switch(j){case 3:return!0;case 5:return be;case 6:return It;case 2:St.push(be)}else if(q)return!1}return I?-1:z||q?q:St}}},function(u,s,r){var l=r(8),C=r(24),S=r(15);u.exports=function(O,U){var j=(C.Object||{})[O]||Object[O],N={};N[O]=U(j),l(l.S+l.F*S(function(){j(1)}),"Object",N)}},function(u,s,r){var l=r(106),C=r(85),S=r(41),O=r(66),U=r(43),j=r(240),N=Object.getOwnPropertyDescriptor;s.f=r(27)?N:function(L,W){if(L=S(L),W=O(W,!0),j)try{return N(L,W)}catch{}if(U(L,W))return C(!l.f.call(L,W),L[W])}},function(u,s){var r=Math.ceil,l=Math.floor;u.exports=function(C){return isNaN(C=+C)?0:(C>0?l:r)(C)}},function(u,s){u.exports=function(r){if(typeof r!="function")throw TypeError(r+" is not a function!");return r}},function(u,s,r){var l=r(55);u.exports=function(C,S,O){if(l(C),S===void 0)return C;switch(O){case 1:return function(U){return C.call(S,U)};case 2:return function(U,j){return C.call(S,U,j)};case 3:return function(U,j,N){return C.call(S,U,j,N)}}return function(){return C.apply(S,arguments)}}},function(u,s,r){var l=r(7).default,C=r(258);u.exports=function(S,O){if(O&&(l(O)==="object"||typeof O=="function"))return O;if(O!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return C(S)},u.exports.__esModule=!0,u.exports.default=u.exports},function(u,s,r){var l=r(259);u.exports=function(C,S){if(typeof S!="function"&&S!==null)throw new TypeError("Super expression must either be null or a function");C.prototype=Object.create(S&&S.prototype,{constructor:{value:C,writable:!0,configurable:!0}}),Object.defineProperty(C,"prototype",{writable:!1}),S&&l(C,S)},u.exports.__esModule=!0,u.exports.default=u.exports},function(u,s){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch{typeof window=="object"&&(r=window)}u.exports=r},function(u,s,r){if(r(27)){var l=r(83),C=r(16),S=r(15),O=r(8),U=r(118),j=r(151),N=r(56),L=r(94),W=r(85),z=r(42),q=r(93),I=r(54),Z=r(22),Y=r(213),G=r(81),oe=r(66),ce=r(43),be=r(105),Ee=r(13),ve=r(34),ge=r(159),Ge=r(80),ht=r(78),It=r(79).f,St=r(157),we=r(84),bt=r(19),jt=r(51),Mt=r(128),ze=r(104),Ut=r(155),Ft=r(96),pt=r(125),yt=r(95),nn=r(156),xt=r(222),_t=r(26),Yt=r(53),Fn=_t.f,Rn=Yt.f,cn=C.RangeError,qe=C.TypeError,Qe=C.Uint8Array,$e=Array.prototype,ft=j.ArrayBuffer,Jt=j.DataView,Qt=jt(0),Pn=jt(2),kn=jt(3),Qn=jt(4),ke=jt(5),ar=jt(6),Tr=Mt(!0),rn=Mt(!1),Ht=Ut.values,Gn=Ut.keys,Xt=Ut.entries,Wt=$e.lastIndexOf,Zt=$e.reduce,Vn=$e.reduceRight,xn=$e.join,Un=$e.sort,ur=$e.slice,sr=$e.toString,Er=$e.toLocaleString,Mr=bt("iterator"),pr=bt("toStringTag"),ri=we("typed_constructor"),Kr=we("def_constructor"),ti=U.CONSTR,jn=U.TYPED,ir=U.VIEW,Cr=jt(1,function(tn,Ve){return $t(ze(tn,tn[Kr]),Ve)}),Hr=S(function(){return new Qe(new Uint16Array([1]).buffer)[0]===1}),qr=!!Qe&&!!Qe.prototype.set&&S(function(){new Qe(1).set({})}),Ot=function(tn,Ve){var Ln=I(tn);if(Ln<0||Ln%Ve)throw cn("Wrong offset!");return Ln},Fr=function(tn){if(Ee(tn)&&jn in tn)return tn;throw qe(tn+" is not a typed array!")},$t=function(tn,Ve){if(!(Ee(tn)&&ri in tn))throw qe("It is not a typed array constructor!");return new tn(Ve)},Se=function(tn,Ve){return me(ze(tn,tn[Kr]),Ve)},me=function(tn,Ve){for(var Ln=0,Xn=Ve.length,Zn=$t(tn,Xn);Xn>Ln;)Zn[Ln]=Ve[Ln++];return Zn},Ce=function(tn,Ve,Ln){Fn(tn,Ve,{get:function(){return this._d[Ln]}})},Me=function(tn){var Ve,Ln,Xn,Zn,cr,Br,Sr=ve(tn),yi=arguments.length,ki=yi>1?arguments[1]:void 0,Zr=ki!==void 0,Zi=St(Sr);if(Zi!=null&&!ge(Zi)){for(Br=Zi.call(Sr),Xn=[],Ve=0;!(cr=Br.next()).done;Ve++)Xn.push(cr.value);Sr=Xn}for(Zr&&yi>2&&(ki=N(ki,arguments[2],2)),Ve=0,Ln=Z(Sr.length),Zn=$t(this,Ln);Ln>Ve;Ve++)Zn[Ve]=Zr?ki(Sr[Ve],Ve):Sr[Ve];return Zn},rt=function(){for(var tn=0,Ve=arguments.length,Ln=$t(this,Ve);Ve>tn;)Ln[tn]=arguments[tn++];return Ln},kt=!!Qe&&S(function(){Er.call(new Qe(1))}),en=function(){return Er.apply(kt?ur.call(Fr(this)):Fr(this),arguments)},En={copyWithin:function(tn,Ve){return xt.call(Fr(this),tn,Ve,arguments.length>2?arguments[2]:void 0)},every:function(tn){return Qn(Fr(this),tn,arguments.length>1?arguments[1]:void 0)},fill:function(tn){return nn.apply(Fr(this),arguments)},filter:function(tn){return Se(this,Pn(Fr(this),tn,arguments.length>1?arguments[1]:void 0))},find:function(tn){return ke(Fr(this),tn,arguments.length>1?arguments[1]:void 0)},findIndex:function(tn){return ar(Fr(this),tn,arguments.length>1?arguments[1]:void 0)},forEach:function(tn){Qt(Fr(this),tn,arguments.length>1?arguments[1]:void 0)},indexOf:function(tn){return rn(Fr(this),tn,arguments.length>1?arguments[1]:void 0)},includes:function(tn){return Tr(Fr(this),tn,arguments.length>1?arguments[1]:void 0)},join:function(tn){return xn.apply(Fr(this),arguments)},lastIndexOf:function(tn){return Wt.apply(Fr(this),arguments)},map:function(tn){return Cr(Fr(this),tn,arguments.length>1?arguments[1]:void 0)},reduce:function(tn){return Zt.apply(Fr(this),arguments)},reduceRight:function(tn){return Vn.apply(Fr(this),arguments)},reverse:function(){for(var tn,Ve=Fr(this).length,Ln=Math.floor(Ve/2),Xn=0;Xn<Ln;)tn=this[Xn],this[Xn++]=this[--Ve],this[Ve]=tn;return this},some:function(tn){return kn(Fr(this),tn,arguments.length>1?arguments[1]:void 0)},sort:function(tn){return Un.call(Fr(this),tn)},subarray:function(tn,Ve){var Ln=Fr(this),Xn=Ln.length,Zn=G(tn,Xn);return new(ze(Ln,Ln[Kr]))(Ln.buffer,Ln.byteOffset+Zn*Ln.BYTES_PER_ELEMENT,Z((Ve===void 0?Xn:G(Ve,Xn))-Zn))}},Nt=function(tn,Ve){return Se(this,ur.call(Fr(this),tn,Ve))},Kt=function(tn){Fr(this);var Ve=Ot(arguments[1],1),Ln=this.length,Xn=ve(tn),Zn=Z(Xn.length),cr=0;if(Zn+Ve>Ln)throw cn("Wrong length!");for(;cr<Zn;)this[Ve+cr]=Xn[cr++]},hn={entries:function(){return Xt.call(Fr(this))},keys:function(){return Gn.call(Fr(this))},values:function(){return Ht.call(Fr(this))}},un=function(tn,Ve){return Ee(tn)&&tn[jn]&&typeof Ve!="symbol"&&Ve in tn&&String(+Ve)==String(Ve)},mt=function(tn,Ve){return un(tn,Ve=oe(Ve,!0))?W(2,tn[Ve]):Rn(tn,Ve)},Tt=function(tn,Ve,Ln){return!(un(tn,Ve=oe(Ve,!0))&&Ee(Ln)&&ce(Ln,"value"))||ce(Ln,"get")||ce(Ln,"set")||Ln.configurable||ce(Ln,"writable")&&!Ln.writable||ce(Ln,"enumerable")&&!Ln.enumerable?Fn(tn,Ve,Ln):(tn[Ve]=Ln.value,tn)};ti||(Yt.f=mt,_t.f=Tt),O(O.S+O.F*!ti,"Object",{getOwnPropertyDescriptor:mt,defineProperty:Tt}),S(function(){sr.call({})})&&(sr=Er=function(){return xn.call(this)});var fn=q({},En);q(fn,hn),z(fn,Mr,hn.values),q(fn,{slice:Nt,set:Kt,constructor:function(){},toString:sr,toLocaleString:en}),Ce(fn,"buffer","b"),Ce(fn,"byteOffset","o"),Ce(fn,"byteLength","l"),Ce(fn,"length","e"),Fn(fn,pr,{get:function(){return this[jn]}}),u.exports=function(tn,Ve,Ln,Xn){var Zn=tn+((Xn=!!Xn)?"Clamped":"")+"Array",cr="get"+tn,Br="set"+tn,Sr=C[Zn],yi=Sr||{},ki=Sr&&ht(Sr),Zr=!Sr||!U.ABV,Zi={},gi=Sr&&Sr.prototype,ei=function(Ei,zr){Fn(Ei,zr,{get:function(){return function(oo,zi){var eo=oo._d;return eo.v[cr](zi*Ve+eo.o,Hr)}(this,zr)},set:function(oo){return function(zi,eo,wo){var ba=zi._d;Xn&&(wo=(wo=Math.round(wo))<0?0:wo>255?255:255&wo),ba.v[Br](eo*Ve+ba.o,wo,Hr)}(this,zr,oo)},enumerable:!0})};Zr?(Sr=Ln(function(Ei,zr,oo,zi){L(Ei,Sr,Zn,"_d");var eo,wo,ba,Ts,xh=0,to=0;if(Ee(zr)){if(!(zr instanceof ft||(Ts=be(zr))=="ArrayBuffer"||Ts=="SharedArrayBuffer"))return jn in zr?me(Sr,zr):Me.call(Sr,zr);eo=zr,to=Ot(oo,Ve);var Cc=zr.byteLength;if(zi===void 0){if(Cc%Ve||(wo=Cc-to)<0)throw cn("Wrong length!")}else if((wo=Z(zi)*Ve)+to>Cc)throw cn("Wrong length!");ba=wo/Ve}else ba=Y(zr),eo=new ft(wo=ba*Ve);for(z(Ei,"_d",{b:eo,o:to,l:wo,e:ba,v:new Jt(eo)});xh<ba;)ei(Ei,xh++)}),gi=Sr.prototype=Ge(fn),z(gi,"constructor",Sr)):S(function(){Sr(1)})&&S(function(){new Sr(-1)})&&pt(function(Ei){new Sr,new Sr(null),new Sr(1.5),new Sr(Ei)},!0)||(Sr=Ln(function(Ei,zr,oo,zi){var eo;return L(Ei,Sr,Zn),Ee(zr)?zr instanceof ft||(eo=be(zr))=="ArrayBuffer"||eo=="SharedArrayBuffer"?zi!==void 0?new yi(zr,Ot(oo,Ve),zi):oo!==void 0?new yi(zr,Ot(oo,Ve)):new yi(zr):jn in zr?me(Sr,zr):Me.call(Sr,zr):new yi(Y(zr))}),Qt(ki!==Function.prototype?It(yi).concat(It(ki)):It(yi),function(Ei){Ei in Sr||z(Sr,Ei,yi[Ei])}),Sr.prototype=gi,l||(gi.constructor=Sr));var Xr=gi[Mr],Kn=!!Xr&&(Xr.name=="values"||Xr.name==null),di=hn.values;z(Sr,ri,!0),z(gi,jn,Zn),z(gi,ir,!0),z(gi,Kr,Sr),(Xn?new Sr(1)[pr]==Zn:pr in gi)||Fn(gi,pr,{get:function(){return Zn}}),Zi[Zn]=Sr,O(O.G+O.W+O.F*(Sr!=yi),Zi),O(O.S,Zn,{BYTES_PER_ELEMENT:Ve}),O(O.S+O.F*S(function(){yi.of.call(Sr,1)}),Zn,{from:Me,of:rt}),"BYTES_PER_ELEMENT"in gi||z(gi,"BYTES_PER_ELEMENT",Ve),O(O.P,Zn,En),yt(Zn),O(O.P+O.F*qr,Zn,{set:Kt}),O(O.P+O.F*!Kn,Zn,hn),l||gi.toString==sr||(gi.toString=sr),O(O.P+O.F*S(function(){new Sr(1).slice()}),Zn,{slice:Nt}),O(O.P+O.F*(S(function(){return[1,2].toLocaleString()!=new Sr([1,2]).toLocaleString()})||!S(function(){gi.toLocaleString.call([1,2])})),Zn,{toLocaleString:en}),Ft[Zn]=Kn?Xr:di,l||Kn||z(gi,Mr,di)}}else u.exports=function(){}},function(u,s){u.exports=function(r){if(r==null)throw TypeError("Can't call method on  "+r);return r}},function(u,s){var r={}.toString;u.exports=function(l){return r.call(l).slice(8,-1)}},function(u,s,r){(function(l){r.d(s,"a",function(){return It}),r.d(s,"b",function(){return St}),r.d(s,"c",function(){return ce}),r.d(s,"d",function(){return be}),r.d(s,"e",function(){return jt}),r.d(s,"f",function(){return bt}),r.d(s,"g",function(){return we}),r.d(s,"h",function(){return Y});var C=r(1),S=r(582),O=r(176),U=r(44);const j=/^(data:|([A-Za-z]+:)?\/\/)/,N=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,L=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,W="file://";async function z(){Object(C.o)("No file system access.")}async function q(){Object(C.o)("No HTTP fetch method available.")}const I=Mt=>Mt!=null&&Mt==Mt,Z=Mt=>!(Number.isNaN(+Mt)||Mt instanceof Date),Y={boolean:C.Ca,integer:C.Ea,number:C.Ea,date:C.Da,string:C.Ga,unknown:C.y},G=[Mt=>Mt==="true"||Mt==="false"||Mt===!0||Mt===!1,Mt=>Z(Mt)&&Number.isInteger(+Mt),Z,Mt=>!Number.isNaN(Date.parse(Mt))],oe=["boolean","integer","number","date"];function ce(Mt,ze){if(!Mt||!Mt.length)return"unknown";const Ut=Mt.length,Ft=G.length,pt=G.map((yt,nn)=>nn+1);for(let yt,nn,xt=0,_t=0;xt<Ut;++xt)for(nn=ze?Mt[xt][ze]:Mt[xt],yt=0;yt<Ft;++yt)if(pt[yt]&&I(nn)&&!G[yt](nn)&&(pt[yt]=0,++_t===G.length))return"string";return oe[pt.reduce((yt,nn)=>yt===0?nn:yt,0)-1]}function be(Mt,ze){return ze.reduce((Ut,Ft)=>(Ut[Ft]=ce(Mt,Ft),Ut),{})}function Ee(Mt){const ze=function(Ut,Ft){const pt={delimiter:Mt};return ve(Ut,Ft?Object(C.p)(Ft,pt):pt)};return ze.responseType="text",ze}function ve(Mt,ze){return ze.header&&(Mt=ze.header.map(C.Ba).join(ze.delimiter)+`
`+Mt),Object(S.a)(ze.delimiter).parse(Mt+"")}function ge(Mt,ze){const Ut=ze&&ze.property?Object(C.u)(ze.property):C.y;return Object(C.H)(Mt)&&!function(Ft){return!(typeof l!="function"||!Object(C.E)(l.isBuffer))&&l.isBuffer(Ft)}(Mt)?function(Ft,pt){return!Object(C.B)(Ft)&&Object(C.F)(Ft)&&(Ft=[...Ft]),pt&&pt.copy?JSON.parse(JSON.stringify(Ft)):Ft}(Ut(Mt),ze):Ut(JSON.parse(Mt))}ve.responseType="text",ge.responseType="json";const Ge={interior:(Mt,ze)=>Mt!==ze,exterior:(Mt,ze)=>Mt===ze};function ht(Mt,ze){let Ut,Ft,pt,yt;return Mt=ge(Mt,ze),ze&&ze.feature?(Ut=O.a,pt=ze.feature):ze&&ze.mesh?(Ut=O.b,pt=ze.mesh,yt=Ge[ze.filter]):Object(C.o)("Missing TopoJSON feature or mesh parameter."),(Ft=(Ft=Mt.objects[pt])?Ut(Mt,Ft,yt):Object(C.o)("Invalid TopoJSON object: "+pt))&&Ft.features||[Ft]}ht.responseType="json";const It={dsv:ve,csv:Ee(","),tsv:Ee("	"),json:ge,topojson:ht};function St(Mt,ze){return arguments.length>1?(It[Mt]=ze,this):Object(C.w)(It,Mt)?It[Mt]:null}function we(Mt){const ze=St(Mt);return ze&&ze.responseType||"text"}function bt(Mt,ze,Ut,Ft){const pt=St((ze=ze||{}).type||"json");return pt||Object(C.o)("Unknown data format type: "+ze.type),Mt=pt(Mt,ze),ze.parse&&function(yt,nn,xt,_t){if(!yt.length)return;const Yt=Object(U.e)();xt=xt||Yt.timeParse,_t=_t||Yt.utcParse;let Fn,Rn,cn,qe,Qe,$e,ft=yt.columns||Object.keys(yt[0]);nn==="auto"&&(nn=be(yt,ft));const Jt=(ft=Object.keys(nn)).map(Qt=>{const Pn=nn[Qt];let kn,Qn;if(Pn&&(Pn.startsWith("date:")||Pn.startsWith("utc:")))return kn=Pn.split(/:(.+)?/,2),((Qn=kn[1])[0]==="'"&&Qn[Qn.length-1]==="'"||Qn[0]==='"'&&Qn[Qn.length-1]==='"')&&(Qn=Qn.slice(1,-1)),(kn[0]==="utc"?_t:xt)(Qn);if(!Y[Pn])throw Error("Illegal format pattern: "+Qt+":"+Pn);return Y[Pn]});for(cn=0,Qe=yt.length,$e=ft.length;cn<Qe;++cn)for(Fn=yt[cn],qe=0;qe<$e;++qe)Rn=ft[qe],Fn[Rn]=Jt[qe](Fn[Rn])}(Mt,ze.parse,Ut,Ft),Object(C.w)(Mt,"columns")&&delete Mt.columns,Mt}const jt=function(Mt,ze){return Ut=>({options:Ut||{},sanitize:async function(Ft,pt){pt=Object(C.p)({},this.options,pt);const yt=this.fileAccess,nn={href:null};let xt,_t,Yt;const Fn=N.test(Ft.replace(L,""));Ft!=null&&typeof Ft=="string"&&Fn||Object(C.o)("Sanitize failure, invalid URI: "+Object(C.Ba)(Ft));const Rn=j.test(Ft);return(Yt=pt.baseURL)&&!Rn&&(Ft.startsWith("/")||Yt.endsWith("/")||(Ft="/"+Ft),Ft=Yt+Ft),_t=(xt=Ft.startsWith(W))||pt.mode==="file"||pt.mode!=="http"&&!Rn&&yt,xt?Ft=Ft.slice(W.length):Ft.startsWith("//")&&(pt.defaultProtocol==="file"?(Ft=Ft.slice(2),_t=!0):Ft=(pt.defaultProtocol||"http")+":"+Ft),Object.defineProperty(nn,"localFile",{value:!!_t}),nn.href=Ft,pt.target&&(nn.target=pt.target+""),pt.rel&&(nn.rel=pt.rel+""),pt.context==="image"&&pt.crossOrigin&&(nn.crossOrigin=pt.crossOrigin+""),nn},load:async function(Ft,pt){const yt=await this.sanitize(Ft,pt),nn=yt.href;return yt.localFile?this.file(nn):this.http(nn,pt)},fileAccess:!!ze,file:function(Ft){return Ft?pt=>new Promise((yt,nn)=>{Ft.readFile(pt,(xt,_t)=>{xt?nn(xt):yt(_t)})}):z}(ze),http:function(Ft){return Ft?async function(pt,yt){const nn=Object(C.p)({},this.options.http,yt),xt=yt&&yt.response,_t=await Ft(pt,nn);return _t.ok?Object(C.E)(_t[xt])?_t[xt]():_t.text():Object(C.o)(_t.status+""+_t.statusText)}:q}(Mt)})}(typeof fetch<"u"&&fetch,null)}).call(this,r(92).Buffer)},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});const l=r(102),C=r(46),S={prepend:!1};s.subSurface=function(O,U,j={}){const N=C.getDrawArea(O),L=l.css({"& canvas":{display:"block"},marginTop:".5rem",marginBottom:".5rem"}),W=l.css({backgroundColor:"white",display:"inline-block",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",padding:"0 10px 0 10px",marginBottom:"20px",fontWeight:"600",textAlign:"left"}),z=Object.assign({},S,j);let q=N.querySelector(`div[data-name=${U}]`);if(!q){if((q=document.createElement("div")).setAttribute("class",`${L}`),q.dataset.name=U,z.title){const I=document.createElement("div");I.setAttribute("class",`subsurface-title ${W}`),I.innerText=z.title,q.appendChild(I)}z.prepend?N.insertBefore(q,N.firstChild):N.appendChild(q)}return q},s.getDefaultWidth=function(O){let U=0,j=O;for(;j&&j.clientWidth===0;)j=j.parentElement,U=50;return j.clientWidth-U},s.getDefaultHeight=function(O){return O.clientHeight===0?200:O.clientHeight}},function(u,s,r){var l=r(84)("meta"),C=r(13),S=r(43),O=r(26).f,U=0,j=Object.isExtensible||function(){return!0},N=!r(15)(function(){return j(Object.preventExtensions({}))}),L=function(z){O(z,l,{value:{i:"O"+ ++U,w:{}}})},W=u.exports={KEY:l,NEED:!1,fastKey:function(z,q){if(!C(z))return typeof z=="symbol"?z:(typeof z=="string"?"S":"P")+z;if(!S(z,l)){if(!j(z))return"F";if(!q)return"E";L(z)}return z[l].i},getWeak:function(z,q){if(!S(z,l)){if(!j(z))return!0;if(!q)return!1;L(z)}return z[l].w},onFreeze:function(z){return N&&W.NEED&&j(z)&&!S(z,l)&&L(z),z}}},function(u,s,r){var l=r(13);u.exports=function(C,S){if(!l(C))return C;var O,U;if(S&&typeof(O=C.toString)=="function"&&!l(U=O.call(C))||typeof(O=C.valueOf)=="function"&&!l(U=O.call(C))||!S&&typeof(O=C.toString)=="function"&&!l(U=O.call(C)))return U;throw TypeError("Can't convert object to primitive value")}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),r(0),r(384);const l=r(349),C=r(289),S=r(288),O=r(137),U=r(196),j=r(287),N=r(109),L=r(286),W=r(285),z=r(284),q=r(283),I=r(110),Z=r(282);s.version_vis=Z.version;const Y={barchart:l.barchart,table:N.table,histogram:O.histogram,linechart:U.linechart,scatterplot:j.scatterplot,confusionMatrix:C.confusionMatrix,heatmap:S.heatmap};s.render=Y;const G={accuracy:I.accuracy,perClassAccuracy:I.perClassAccuracy,confusionMatrix:I.confusionMatrix};s.metrics=G;const oe={history:L.history,fitCallbacks:L.fitCallbacks,perClassAccuracy:z.perClassAccuracy,valuesDistribution:q.valuesDistribution,layer:W.layer,modelSummary:W.modelSummary};s.show=oe;var ce=r(197);s.visor=ce.visor,function(be){for(var Ee in be)s.hasOwnProperty(Ee)||(s[Ee]=be[Ee])}(r(198))},function(u,s,r){var l=r(31),C=Object(l.a)(function(S){S.setUTCMonth(0,1),S.setUTCHours(0,0,0,0)},function(S,O){S.setUTCFullYear(S.getUTCFullYear()+O)},function(S,O){return O.getUTCFullYear()-S.getUTCFullYear()},function(S){return S.getUTCFullYear()});C.every=function(S){return isFinite(S=Math.floor(S))&&S>0?Object(l.a)(function(O){O.setUTCFullYear(Math.floor(O.getUTCFullYear()/S)*S),O.setUTCMonth(0,1),O.setUTCHours(0,0,0,0)},function(O,U){O.setUTCFullYear(O.getUTCFullYear()+U*S)}):null},s.a=C,C.range},function(u,s,r){var l=r(31),C=r(12),S=Object(l.a)(function(O){O.setTime(O-O.getMilliseconds())},function(O,U){O.setTime(+O+U*C.e)},function(O,U){return(U-O)/C.e},function(O){return O.getUTCSeconds()});s.a=S,S.range},function(u,s,r){var l=r(31),C=Object(l.a)(function(S){S.setMonth(0,1),S.setHours(0,0,0,0)},function(S,O){S.setFullYear(S.getFullYear()+O)},function(S,O){return O.getFullYear()-S.getFullYear()},function(S){return S.getFullYear()});C.every=function(S){return isFinite(S=Math.floor(S))&&S>0?Object(l.a)(function(O){O.setFullYear(Math.floor(O.getFullYear()/S)*S),O.setMonth(0,1),O.setHours(0,0,0,0)},function(O,U){O.setFullYear(O.getFullYear()+U*S)}):null},s.a=C,C.range},function(u,s,r){var l=r(31),C=r(12),S=Object(l.a)(function(O){O.setUTCHours(0,0,0,0)},function(O,U){O.setUTCDate(O.getUTCDate()+U)},function(O,U){return(U-O)/C.a},function(O){return O.getUTCDate()-1});s.a=S,S.range},function(u,s,r){var l=r(31),C=r(12),S=Object(l.a)(O=>O.setHours(0,0,0,0),(O,U)=>O.setDate(O.getDate()+U),(O,U)=>(U-O-(U.getTimezoneOffset()-O.getTimezoneOffset())*C.c)/C.a,O=>O.getDate()-1);s.a=S,S.range},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.Add="Add",s.AddN="AddN",s.Div="Div",s.FusedBatchNorm="FusedBatchNorm",s.SquaredDifference="SquaredDifference",s.Square="Square",s.Transpose="Transpose",s.NonMaxSuppressionV5="NonMaxSuppressionV5",s.BroadcastTo="BroadcastTo",s.OneHot="OneHot",s.Identity="Identity",s.Tile="Tile",s.PadV2="PadV2",s.FromPixels="FromPixels",s.MaxPoolWithArgmax="MaxPoolWithArgmax"},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(33),C=r(378),S=r(21);s.makeTypesMatch=function(O,U){if(O.dtype===U.dtype)return[O,U];var j=C.upcastType(O.dtype,U.dtype);return[O.cast(j),U.cast(j)]},s.assertTypesMatch=function(O,U){S.assert(O.dtype===U.dtype,function(){return"The dtypes of the first("+O.dtype+") and second("+U.dtype+") input must match"})},s.isTensorInList=function(O,U){return U.some(function(j){return j.id===O.id})},s.getTensorsInContainer=function(O){var U=[];return function j(N,L,W){if(N!=null){if(N instanceof l.Tensor)L.push(N);else if(function(Z){return Array.isArray(Z)||typeof Z=="object"}(N)){var z=N;for(var q in z){var I=z[q];W.has(I)||(W.add(I),j(I,L,W))}}}}(O,U,new Set),U}},function(u,s){var r,l,C=u.exports={};function S(){throw new Error("setTimeout has not been defined")}function O(){throw new Error("clearTimeout has not been defined")}function U(Y){if(r===setTimeout)return setTimeout(Y,0);if((r===S||!r)&&setTimeout)return r=setTimeout,setTimeout(Y,0);try{return r(Y,0)}catch{try{return r.call(null,Y,0)}catch{return r.call(this,Y,0)}}}(function(){try{r=typeof setTimeout=="function"?setTimeout:S}catch{r=S}try{l=typeof clearTimeout=="function"?clearTimeout:O}catch{l=O}})();var j,N=[],L=!1,W=-1;function z(){L&&j&&(L=!1,j.length?N=j.concat(N):W=-1,N.length&&q())}function q(){if(!L){var Y=U(z);L=!0;for(var G=N.length;G;){for(j=N,N=[];++W<G;)j&&j[W].run();W=-1,G=N.length}j=null,L=!1,function(oe){if(l===clearTimeout)return clearTimeout(oe);if((l===O||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(oe);try{l(oe)}catch{try{return l.call(null,oe)}catch{return l.call(this,oe)}}}(Y)}}function I(Y,G){this.fun=Y,this.array=G}function Z(){}C.nextTick=function(Y){var G=new Array(arguments.length-1);if(arguments.length>1)for(var oe=1;oe<arguments.length;oe++)G[oe-1]=arguments[oe];N.push(new I(Y,G)),N.length!==1||L||U(q)},I.prototype.run=function(){this.fun.apply(null,this.array)},C.title="browser",C.browser=!0,C.env={},C.argv=[],C.version="",C.versions={},C.on=Z,C.addListener=Z,C.once=Z,C.off=Z,C.removeListener=Z,C.removeAllListeners=Z,C.emit=Z,C.prependListener=Z,C.prependOnceListener=Z,C.listeners=function(Y){return[]},C.binding=function(Y){throw new Error("process.binding is not supported")},C.cwd=function(){return"/"},C.chdir=function(Y){throw new Error("process.chdir is not supported")},C.umask=function(){return 0}},function(u,s,r){var l=r(13);u.exports=function(C,S){if(!l(C)||C._t!==S)throw TypeError("Incompatible receiver, "+S+" required!");return C}},function(u,s,r){var l=r(19)("unscopables"),C=Array.prototype;C[l]==null&&r(42)(C,l,{}),u.exports=function(S){C[l][S]=!0}},function(u,s,r){var l=r(43),C=r(34),S=r(173)("IE_PROTO"),O=Object.prototype;u.exports=Object.getPrototypeOf||function(U){return U=C(U),l(U,S)?U[S]:typeof U.constructor=="function"&&U instanceof U.constructor?U.constructor.prototype:U instanceof Object?O:null}},function(u,s,r){var l=r(238),C=r(172).concat("length","prototype");s.f=Object.getOwnPropertyNames||function(S){return l(S,C)}},function(u,s,r){var l=r(14),C=r(237),S=r(172),O=r(173)("IE_PROTO"),U=function(){},j=function(){var N,L=r(175)("iframe"),W=S.length;for(L.style.display="none",r(171).appendChild(L),L.src="javascript:",(N=L.contentWindow.document).open(),N.write("<script>document.F=Object<\/script>"),N.close(),j=N.F;W--;)delete j.prototype[S[W]];return j()};u.exports=Object.create||function(N,L){var W;return N!==null?(U.prototype=l(N),W=new U,U.prototype=null,W[O]=N):W=j(),L===void 0?W:C(W,L)}},function(u,s,r){var l=r(54),C=Math.max,S=Math.min;u.exports=function(O,U){return(O=l(O))<0?C(O+U,0):S(O,U)}},function(u,s,r){var l=r(238),C=r(172);u.exports=Object.keys||function(S){return l(S,C)}},function(u,s){u.exports=!1},function(u,s){var r=0,l=Math.random();u.exports=function(C){return"Symbol(".concat(C===void 0?"":C,")_",(++r+l).toString(36))}},function(u,s){u.exports=function(r,l){return{enumerable:!(1&r),configurable:!(2&r),writable:!(4&r),value:l}}},function(u,s,r){u.exports=function(l,C){C||(C={}),typeof C=="function"&&(C={cmp:C});var S=typeof C.cycles=="boolean"&&C.cycles,O=C.cmp&&function(j){return function(N){return function(L,W){var z={key:L,value:N[L]},q={key:W,value:N[W]};return j(z,q)}}}(C.cmp),U=[];return function j(N){if(N&&N.toJSON&&typeof N.toJSON=="function"&&(N=N.toJSON()),N!==void 0){if(typeof N=="number")return isFinite(N)?""+N:"null";if(typeof N!="object")return JSON.stringify(N);var L,W;if(Array.isArray(N)){for(W="[",L=0;L<N.length;L++)L&&(W+=","),W+=j(N[L])||"null";return W+"]"}if(N===null)return"null";if(U.indexOf(N)!==-1){if(S)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var z=U.push(N)-1,q=Object.keys(N).sort(O&&O(N));for(W="",L=0;L<q.length;L++){var I=q[L],Z=j(N[I]);Z&&(W&&(W+=","),W+=JSON.stringify(I)+":"+Z)}return U.splice(z,1),"{"+W+"}"}}(l)}},function(u,s,r){s.a=function(l,C){return l<C?-1:l>C?1:l>=C?0:NaN}},function(u,s,r){r.r(s);var l={};r.d(l,"JsonPatchError",function(){return Mt}),r.d(l,"deepClone",function(){return ze}),r.d(l,"getValueByPointer",function(){return pt}),r.d(l,"applyOperation",function(){return yt}),r.d(l,"applyPatch",function(){return nn}),r.d(l,"applyReducer",function(){return xt}),r.d(l,"validator",function(){return _t}),r.d(l,"validate",function(){return Yt}),r.d(l,"_areEquals",function(){return Fn});var C={};r.d(C,"unobserve",function(){return Qe}),r.d(C,"observe",function(){return $e}),r.d(C,"generate",function(){return ft}),r.d(C,"compare",function(){return Qt});var S={};r.d(S,"aggregate",function(){return Mc}),r.d(S,"bin",function(){return zp}),r.d(S,"collect",function(){return Ym}),r.d(S,"compare",function(){return qg}),r.d(S,"countpattern",function(){return kl}),r.d(S,"cross",function(){return Ka}),r.d(S,"density",function(){return Up}),r.d(S,"dotbin",function(){return Vu}),r.d(S,"expression",function(){return Pa}),r.d(S,"extent",function(){return bu}),r.d(S,"facet",function(){return _o}),r.d(S,"field",function(){return va}),r.d(S,"filter",function(){return To}),r.d(S,"flatten",function(){return Ns}),r.d(S,"fold",function(){return kr}),r.d(S,"formula",function(){return ru}),r.d(S,"generate",function(){return xu}),r.d(S,"impute",function(){return Oh}),r.d(S,"joinaggregate",function(){return Wp}),r.d(S,"kde",function(){return Vp}),r.d(S,"key",function(){return Du}),r.d(S,"load",function(){return Is}),r.d(S,"lookup",function(){return Dc}),r.d(S,"multiextent",function(){return xs}),r.d(S,"multivalues",function(){return Ho}),r.d(S,"params",function(){return Hp}),r.d(S,"pivot",function(){return ff}),r.d(S,"prefacet",function(){return Dh}),r.d(S,"project",function(){return Gi}),r.d(S,"proxy",function(){return Di}),r.d(S,"quantile",function(){return da}),r.d(S,"relay",function(){return Gp}),r.d(S,"sample",function(){return qp}),r.d(S,"sequence",function(){return $p}),r.d(S,"sieve",function(){return Jm}),r.d(S,"subflow",function(){return Pt}),r.d(S,"timeunit",function(){return lc}),r.d(S,"tupleindex",function(){return Al}),r.d(S,"values",function(){return qs}),r.d(S,"window",function(){return Ol});var O={};r.d(O,"interpolate",function(){return ha}),r.d(O,"interpolateArray",function(){return fa}),r.d(O,"interpolateBasis",function(){return ii}),r.d(O,"interpolateBasisClosed",function(){return Ir}),r.d(O,"interpolateDate",function(){return ia}),r.d(O,"interpolateDiscrete",function(){return ky}),r.d(O,"interpolateHue",function(){return om}),r.d(O,"interpolateNumber",function(){return Vi}),r.d(O,"interpolateNumberArray",function(){return $i}),r.d(O,"interpolateObject",function(){return Ui}),r.d(O,"interpolateRound",function(){return oa}),r.d(O,"interpolateString",function(){return wa}),r.d(O,"interpolateTransformCss",function(){return o0}),r.d(O,"interpolateTransformSvg",function(){return D1}),r.d(O,"interpolateZoom",function(){return dv}),r.d(O,"interpolateRgb",function(){return pi}),r.d(O,"interpolateRgbBasis",function(){return lo}),r.d(O,"interpolateRgbBasisClosed",function(){return qo}),r.d(O,"interpolateHsl",function(){return eg}),r.d(O,"interpolateHslLong",function(){return pv}),r.d(O,"interpolateLab",function(){return um}),r.d(O,"interpolateHcl",function(){return F1}),r.d(O,"interpolateHclLong",function(){return Cy}),r.d(O,"interpolateCubehelix",function(){return qh}),r.d(O,"interpolateCubehelixLong",function(){return Ay}),r.d(O,"piecewise",function(){return Yu}),r.d(O,"quantize",function(){return Oy});var U={};r.d(U,"bound",function(){return s5}),r.d(U,"identifier",function(){return uT}),r.d(U,"mark",function(){return c5}),r.d(U,"overlap",function(){return l5}),r.d(U,"render",function(){return g5}),r.d(U,"viewlayout",function(){return _5});var j={};r.d(j,"axisticks",function(){return S5}),r.d(j,"datajoin",function(){return k5}),r.d(j,"encode",function(){return C5}),r.d(j,"legendentries",function(){return A5}),r.d(j,"linkpath",function(){return cT}),r.d(j,"pie",function(){return lT}),r.d(j,"scale",function(){return I5}),r.d(j,"sortitems",function(){return P5}),r.d(j,"stack",function(){return dT});var N={};r.d(N,"contour",function(){return HT}),r.d(N,"geojson",function(){return $T}),r.d(N,"geopath",function(){return XT}),r.d(N,"geopoint",function(){return KT}),r.d(N,"geoshape",function(){return YT}),r.d(N,"graticule",function(){return JT}),r.d(N,"heatmap",function(){return QT}),r.d(N,"isocontour",function(){return UT}),r.d(N,"kde2d",function(){return VT}),r.d(N,"projection",function(){return $6});var L={};r.d(L,"force",function(){return iM});var W={};r.d(W,"nest",function(){return fM}),r.d(W,"pack",function(){return hM}),r.d(W,"partition",function(){return mM}),r.d(W,"stratify",function(){return gM}),r.d(W,"tree",function(){return yM}),r.d(W,"treelinks",function(){return bM}),r.d(W,"treemap",function(){return wM});var z={};r.d(z,"label",function(){return EM});var q={};r.d(q,"loess",function(){return SM}),r.d(q,"regression",function(){return CM});var I={};r.d(I,"voronoi",function(){return DM});var Z={};r.d(Z,"wordcloud",function(){return IM});var Y={};r.d(Y,"crossfilter",function(){return FM}),r.d(Y,"resolvefilter",function(){return RM});var G={};r.d(G,"Dataflow",function(){return un}),r.d(G,"EventStream",function(){return qr}),r.d(G,"MultiPulse",function(){return en}),r.d(G,"Operator",function(){return ir}),r.d(G,"Parameters",function(){return Kr}),r.d(G,"Pulse",function(){return Ce}),r.d(G,"Transform",function(){return Tt}),r.d(G,"changeset",function(){return pr}),r.d(G,"definition",function(){return tn}),r.d(G,"ingest",function(){return xn}),r.d(G,"isTuple",function(){return Wt}),r.d(G,"transform",function(){return Ve}),r.d(G,"transforms",function(){return fn}),r.d(G,"tupleid",function(){return Zt}),r.d(G,"interpolate",function(){return fg}),r.d(G,"interpolateColors",function(){return If}),r.d(G,"interpolateRange",function(){return cg}),r.d(G,"quantizeInterpolator",function(){return lg}),r.d(G,"scale",function(){return zo}),r.d(G,"scheme",function(){return d0}),r.d(G,"projection",function(){return zT}),r.d(G,"View",function(){return YL}),r.d(G,"defaultLocale",function(){return Tr.a}),r.d(G,"formatLocale",function(){return Tr.c}),r.d(G,"locale",function(){return Tr.b}),r.d(G,"resetDefaultLocale",function(){return Tr.d}),r.d(G,"timeFormatLocale",function(){return Tr.e}),r.d(G,"expressionFunction",function(){return xc}),r.d(G,"parse",function(){return WJ}),r.d(G,"runtimeContext",function(){return ML}),r.d(G,"codegenExpression",function(){return PQ}),r.d(G,"parseExpression",function(){return IQ}),r.d(G,"parseSelector",function(){return fx}),r.d(G,"version",function(){return HQ}),r.d(G,"Debug",function(){return ke.a}),r.d(G,"Error",function(){return ke.b}),r.d(G,"Info",function(){return ke.c}),r.d(G,"None",function(){return ke.d}),r.d(G,"Warn",function(){return ke.e}),r.d(G,"accessor",function(){return ke.f}),r.d(G,"accessorFields",function(){return ke.g}),r.d(G,"accessorName",function(){return ke.h}),r.d(G,"array",function(){return ke.i}),r.d(G,"ascending",function(){return ke.j}),r.d(G,"clampRange",function(){return ke.k}),r.d(G,"compare",function(){return ke.l}),r.d(G,"constant",function(){return ke.m}),r.d(G,"debounce",function(){return ke.n}),r.d(G,"error",function(){return ke.o}),r.d(G,"extend",function(){return ke.p}),r.d(G,"extent",function(){return ke.q}),r.d(G,"extentIndex",function(){return ke.r}),r.d(G,"falsy",function(){return ke.s}),r.d(G,"fastmap",function(){return ke.t}),r.d(G,"field",function(){return ke.u}),r.d(G,"flush",function(){return ke.v}),r.d(G,"hasOwnProperty",function(){return ke.w}),r.d(G,"id",function(){return ke.x}),r.d(G,"identity",function(){return ke.y}),r.d(G,"inherits",function(){return ke.z}),r.d(G,"inrange",function(){return ke.A}),r.d(G,"isArray",function(){return ke.B}),r.d(G,"isBoolean",function(){return ke.C}),r.d(G,"isDate",function(){return ke.D}),r.d(G,"isFunction",function(){return ke.E}),r.d(G,"isIterable",function(){return ke.F}),r.d(G,"isNumber",function(){return ke.G}),r.d(G,"isObject",function(){return ke.H}),r.d(G,"isRegExp",function(){return ke.I}),r.d(G,"isString",function(){return ke.J}),r.d(G,"key",function(){return ke.K}),r.d(G,"lerp",function(){return ke.L}),r.d(G,"logger",function(){return ke.M}),r.d(G,"lruCache",function(){return ke.N}),r.d(G,"merge",function(){return ke.O}),r.d(G,"mergeConfig",function(){return ke.P}),r.d(G,"one",function(){return ke.Q}),r.d(G,"pad",function(){return ke.R}),r.d(G,"panLinear",function(){return ke.S}),r.d(G,"panLog",function(){return ke.T}),r.d(G,"panPow",function(){return ke.U}),r.d(G,"panSymlog",function(){return ke.V}),r.d(G,"peek",function(){return ke.W}),r.d(G,"quarter",function(){return ke.X}),r.d(G,"repeat",function(){return ke.Y}),r.d(G,"span",function(){return ke.Z}),r.d(G,"splitAccessPath",function(){return ke.Aa}),r.d(G,"stringValue",function(){return ke.Ba}),r.d(G,"toBoolean",function(){return ke.Ca}),r.d(G,"toDate",function(){return ke.Da}),r.d(G,"toNumber",function(){return ke.Ea}),r.d(G,"toSet",function(){return ke.Fa}),r.d(G,"toString",function(){return ke.Ga}),r.d(G,"truncate",function(){return ke.Ha}),r.d(G,"truthy",function(){return ke.Ia}),r.d(G,"utcquarter",function(){return ke.Ja}),r.d(G,"visitArray",function(){return ke.Ka}),r.d(G,"writeConfig",function(){return ke.La}),r.d(G,"zero",function(){return ke.Ma}),r.d(G,"zoomLinear",function(){return ke.Na}),r.d(G,"zoomLog",function(){return ke.Oa}),r.d(G,"zoomPow",function(){return ke.Pa}),r.d(G,"zoomSymlog",function(){return ke.Qa}),r.d(G,"bandwidthNRD",function(){return ei}),r.d(G,"bin",function(){return Xr}),r.d(G,"bootstrapCI",function(){return Ei}),r.d(G,"cumulativeLogNormal",function(){return Rp}),r.d(G,"cumulativeNormal",function(){return to}),r.d(G,"cumulativeUniform",function(){return wh}),r.d(G,"densityLogNormal",function(){return Jc}),r.d(G,"densityNormal",function(){return xh}),r.d(G,"densityUniform",function(){return ud}),r.d(G,"dotbin",function(){return zr}),r.d(G,"quantileLogNormal",function(){return ys}),r.d(G,"quantileNormal",function(){return Cc}),r.d(G,"quantileUniform",function(){return Qc}),r.d(G,"quantiles",function(){return Zi}),r.d(G,"quartiles",function(){return gi}),r.d(G,"random",function(){return Kn}),r.d(G,"randomInteger",function(){return zi}),r.d(G,"randomKDE",function(){return Yc}),r.d(G,"randomLCG",function(){return oo}),r.d(G,"randomLogNormal",function(){return sd}),r.d(G,"randomMixture",function(){return Pp}),r.d(G,"randomNormal",function(){return Uu}),r.d(G,"randomUniform",function(){return uf}),r.d(G,"regressionExp",function(){return Oc}),r.d(G,"regressionLinear",function(){return bs}),r.d(G,"regressionLoess",function(){return ld}),r.d(G,"regressionLog",function(){return Fa}),r.d(G,"regressionPoly",function(){return Mu}),r.d(G,"regressionPow",function(){return cf}),r.d(G,"regressionQuad",function(){return Tc}),r.d(G,"sampleCurve",function(){return fd}),r.d(G,"sampleLogNormal",function(){return sc}),r.d(G,"sampleNormal",function(){return Ts}),r.d(G,"sampleUniform",function(){return uc}),r.d(G,"setRandom",function(){return di}),r.d(G,"DATE",function(){return yr.a}),r.d(G,"DAY",function(){return yr.b}),r.d(G,"DAYOFYEAR",function(){return yr.c}),r.d(G,"HOURS",function(){return yr.d}),r.d(G,"MILLISECONDS",function(){return yr.e}),r.d(G,"MINUTES",function(){return yr.f}),r.d(G,"MONTH",function(){return yr.g}),r.d(G,"QUARTER",function(){return yr.h}),r.d(G,"SECONDS",function(){return yr.i}),r.d(G,"TIME_UNITS",function(){return yr.j}),r.d(G,"WEEK",function(){return yr.k}),r.d(G,"YEAR",function(){return yr.l}),r.d(G,"dayofyear",function(){return yr.m}),r.d(G,"timeBin",function(){return yr.n}),r.d(G,"timeFloor",function(){return yr.o}),r.d(G,"timeInterval",function(){return yr.p}),r.d(G,"timeOffset",function(){return yr.q}),r.d(G,"timeSequence",function(){return yr.r}),r.d(G,"timeUnitSpecifier",function(){return yr.s}),r.d(G,"timeUnits",function(){return yr.t}),r.d(G,"utcFloor",function(){return yr.u}),r.d(G,"utcInterval",function(){return yr.v}),r.d(G,"utcOffset",function(){return yr.w}),r.d(G,"utcSequence",function(){return yr.x}),r.d(G,"utcdayofyear",function(){return yr.y}),r.d(G,"utcweek",function(){return yr.z}),r.d(G,"week",function(){return yr.A}),r.d(G,"format",function(){return ar.a}),r.d(G,"formats",function(){return ar.b}),r.d(G,"inferType",function(){return ar.c}),r.d(G,"inferTypes",function(){return ar.d}),r.d(G,"loader",function(){return ar.e}),r.d(G,"read",function(){return ar.f}),r.d(G,"responseType",function(){return ar.g}),r.d(G,"typeParsers",function(){return ar.h}),r.d(G,"Bounds",function(){return rs}),r.d(G,"CanvasHandler",function(){return Xe}),r.d(G,"CanvasRenderer",function(){return Lt}),r.d(G,"Gradient",function(){return g0}),r.d(G,"GroupItem",function(){return _m}),r.d(G,"Handler",function(){return d}),r.d(G,"Item",function(){return tp}),r.d(G,"Marks",function(){return Jl}),r.d(G,"RenderType",function(){return xr}),r.d(G,"Renderer",function(){return E}),r.d(G,"ResourceLoader",function(){return wg}),r.d(G,"SVGHandler",function(){return pn}),r.d(G,"SVGRenderer",function(){return gt}),r.d(G,"SVGStringRenderer",function(){return _r}),r.d(G,"Scenegraph",function(){return Hv}),r.d(G,"boundClip",function(){return xo}),r.d(G,"boundContext",function(){return kg}),r.d(G,"boundItem",function(){return up}),r.d(G,"boundMark",function(){return B1}),r.d(G,"boundStroke",function(){return Bf}),r.d(G,"domChild",function(){return bc}),r.d(G,"domClear",function(){return Vf}),r.d(G,"domCreate",function(){return Uc}),r.d(G,"domFind",function(){return z1}),r.d(G,"font",function(){return sp}),r.d(G,"fontFamily",function(){return Yd}),r.d(G,"fontSize",function(){return yc}),r.d(G,"intersect",function(){return Rr}),r.d(G,"intersectBoxLine",function(){return Ie}),r.d(G,"intersectPath",function(){return J}),r.d(G,"intersectPoint",function(){return ie}),r.d(G,"intersectRule",function(){return Ae}),r.d(G,"lineHeight",function(){return Us}),r.d(G,"markup",function(){return Fe}),r.d(G,"multiLineOffset",function(){return Cs}),r.d(G,"pathCurves",function(){return Rf}),r.d(G,"pathEqual",function(){return Vo}),r.d(G,"pathParse",function(){return Qh}),r.d(G,"pathRectangle",function(){return Lv}),r.d(G,"pathRender",function(){return ep}),r.d(G,"pathSymbols",function(){return Lf}),r.d(G,"pathTrail",function(){return ql}),r.d(G,"point",function(){return v}),r.d(G,"renderModule",function(){return Pr}),r.d(G,"resetSVGClipId",function(){return jv}),r.d(G,"resetSVGDefIds",function(){return ua}),r.d(G,"sceneEqual",function(){return Oo}),r.d(G,"sceneFromJSON",function(){return Ry}),r.d(G,"scenePickVisit",function(){return Jn}),r.d(G,"sceneToJSON",function(){return Vv}),r.d(G,"sceneVisit",function(){return Wn}),r.d(G,"sceneZOrder",function(){return Nn}),r.d(G,"serializeXML",function(){return He}),r.d(G,"textMetrics",function(){return ks});var oe={};r.d(oe,"invalidSpec",function(){return IZ}),r.d(oe,"FIT_NON_SINGLE",function(){return FZ}),r.d(oe,"containerSizeNonSingle",function(){return RZ}),r.d(oe,"containerSizeNotCompatibleWithAutosize",function(){return PZ}),r.d(oe,"droppingFit",function(){return LZ}),r.d(oe,"cannotProjectOnChannelWithoutField",function(){return BZ}),r.d(oe,"cannotProjectAggregate",function(){return jZ}),r.d(oe,"nearestNotSupportForContinuous",function(){return zZ}),r.d(oe,"selectionNotSupported",function(){return UZ}),r.d(oe,"selectionNotFound",function(){return WZ}),r.d(oe,"SCALE_BINDINGS_CONTINUOUS",function(){return VZ}),r.d(oe,"LEGEND_BINDINGS_PROJECT_LENGTH",function(){return HZ}),r.d(oe,"noSameUnitLookup",function(){return GZ}),r.d(oe,"noSuchRepeatedValue",function(){return qZ}),r.d(oe,"columnsNotSupportByRowCol",function(){return $Z}),r.d(oe,"CONCAT_CANNOT_SHARE_AXIS",function(){return XZ}),r.d(oe,"unrecognizedParse",function(){return KZ}),r.d(oe,"differentParse",function(){return YZ}),r.d(oe,"invalidTransformIgnored",function(){return JZ}),r.d(oe,"NO_FIELDS_NEEDS_AS",function(){return QZ}),r.d(oe,"customFormatTypeNotAllowed",function(){return ZZ}),r.d(oe,"encodingOverridden",function(){return eee}),r.d(oe,"projectionOverridden",function(){return tee}),r.d(oe,"REPLACE_ANGLE_WITH_THETA",function(){return nee}),r.d(oe,"primitiveChannelDef",function(){return ree}),r.d(oe,"invalidFieldType",function(){return iee}),r.d(oe,"invalidFieldTypeForCountAggregate",function(){return oee}),r.d(oe,"invalidAggregate",function(){return aee}),r.d(oe,"missingFieldType",function(){return see}),r.d(oe,"droppingColor",function(){return uee}),r.d(oe,"emptyFieldDef",function(){return cee}),r.d(oe,"latLongDeprecated",function(){return lee}),r.d(oe,"LINE_WITH_VARYING_SIZE",function(){return fee}),r.d(oe,"incompatibleChannel",function(){return dee}),r.d(oe,"invalidEncodingChannel",function(){return hee}),r.d(oe,"facetChannelShouldBeDiscrete",function(){return pee}),r.d(oe,"facetChannelDropped",function(){return mee}),r.d(oe,"discreteChannelCannotEncode",function(){return gee}),r.d(oe,"lineWithRange",function(){return vee}),r.d(oe,"orientOverridden",function(){return yee}),r.d(oe,"CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN",function(){return bee}),r.d(oe,"RANGE_STEP_DEPRECATED",function(){return xee}),r.d(oe,"cannotUseScalePropertyWithNonColor",function(){return wee}),r.d(oe,"unaggregateDomainHasNoEffectForRawField",function(){return _ee}),r.d(oe,"unaggregateDomainWithNonSharedDomainOp",function(){return Eee}),r.d(oe,"unaggregatedDomainWithLogScale",function(){return See}),r.d(oe,"cannotApplySizeToNonOrientedMark",function(){return kee}),r.d(oe,"scaleTypeNotWorkWithChannel",function(){return Cee}),r.d(oe,"scaleTypeNotWorkWithFieldDef",function(){return Aee}),r.d(oe,"scalePropertyNotWorkWithScaleType",function(){return Oee}),r.d(oe,"scaleTypeNotWorkWithMark",function(){return Tee}),r.d(oe,"stepDropped",function(){return Mee}),r.d(oe,"mergeConflictingProperty",function(){return Dee}),r.d(oe,"mergeConflictingDomainProperty",function(){return Nee}),r.d(oe,"independentScaleMeansIndependentGuide",function(){return Iee}),r.d(oe,"domainSortDropped",function(){return Fee}),r.d(oe,"MORE_THAN_ONE_SORT",function(){return Ree}),r.d(oe,"FACETED_INDEPENDENT_DIFFERENT_SOURCES",function(){return Pee}),r.d(oe,"FACETED_INDEPENDENT_SAME_FIELDS_DIFFERENT_SOURCES",function(){return Lee}),r.d(oe,"FACETED_INDEPENDENT_SAME_SOURCE",function(){return Bee}),r.d(oe,"INVALID_CHANNEL_FOR_AXIS",function(){return jee}),r.d(oe,"cannotStackRangedMark",function(){return zee}),r.d(oe,"cannotStackNonLinearScale",function(){return Uee}),r.d(oe,"stackNonSummativeAggregate",function(){return Wee}),r.d(oe,"invalidTimeUnit",function(){return Vee}),r.d(oe,"droppedDay",function(){return Hee}),r.d(oe,"errorBarCenterAndExtentAreNotNeeded",function(){return Gee}),r.d(oe,"errorBarCenterIsUsedWithWrongExtent",function(){return qee}),r.d(oe,"errorBarContinuousAxisHasCustomizedAggregate",function(){return $ee}),r.d(oe,"errorBarCenterIsNotNeeded",function(){return Xee}),r.d(oe,"errorBand1DNotSupport",function(){return Kee}),r.d(oe,"channelRequiredForBinned",function(){return Yee}),r.d(oe,"domainRequiredForThresholdScale",function(){return Jee});var ce={};r.d(ce,"compile",function(){return vie}),r.d(ce,"extractTransforms",function(){return bie}),r.d(ce,"normalize",function(){return x9}),r.d(ce,"version",function(){return xie});var be={};r.d(be,"dark",function(){return wie}),r.d(be,"excel",function(){return _ie}),r.d(be,"fivethirtyeight",function(){return Eie}),r.d(be,"ggplot2",function(){return Sie}),r.d(be,"googlecharts",function(){return Tie}),r.d(be,"latimes",function(){return kie}),r.d(be,"quartz",function(){return Cie}),r.d(be,"urbaninstitute",function(){return Oie}),r.d(be,"version",function(){return Mie}),r.d(be,"vox",function(){return Aie});var Ee=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,a){i.__proto__=a}||function(i,a){for(var f in a)a.hasOwnProperty(f)&&(i[f]=a[f])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)}}(),ve=Object.prototype.hasOwnProperty;function ge(e,t){return ve.call(e,t)}function Ge(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);t=[];for(var i in e)ge(e,i)&&t.push(i);return t}function ht(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function It(e){for(var t,n=0,i=e.length;n<i;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0}function St(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function we(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function bt(e,t){var n=[e];for(var i in t){var a=typeof t[i]=="object"?JSON.stringify(t[i],null,2):t[i];a!==void 0&&n.push(i+": "+a)}return n.join(`
`)}var jt=function(e){function t(n,i,a,f,g){var x=this.constructor,k=e.call(this,bt(n,{name:i,index:a,operation:f,tree:g}))||this;return k.name=i,k.index=a,k.operation=f,k.tree=g,Object.setPrototypeOf(k,x.prototype),k.message=bt(n,{name:i,index:a,operation:f,tree:g}),k}return Ee(t,e),t}(Error),Mt=jt,ze=ht,Ut={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var i=e[t];return delete e[t],{newDocument:n,removed:i}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:function(e,t,n){var i=pt(n,this.path);i&&(i=ht(i));var a=yt(n,{op:"remove",path:this.from}).removed;return yt(n,{op:"add",path:this.path,value:a}),{newDocument:n,removed:i}},copy:function(e,t,n){var i=pt(n,this.from);return yt(n,{op:"add",path:this.path,value:ht(i)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Fn(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},Ft={add:function(e,t,n){return It(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:Ut.move,copy:Ut.copy,test:Ut.test,_get:Ut._get};function pt(e,t){if(t=="")return e;var n={op:"_get",path:t};return yt(e,n),n.value}function yt(e,t,n,i,a,f){if(n===void 0&&(n=!1),i===void 0&&(i=!0),a===void 0&&(a=!0),f===void 0&&(f=0),n&&(typeof n=="function"?n(t,0,e,t.path):_t(t,0)),t.path===""){var g={newDocument:e};if(t.op==="add")return g.newDocument=t.value,g;if(t.op==="replace")return g.newDocument=t.value,g.removed=e,g;if(t.op==="move"||t.op==="copy")return g.newDocument=pt(e,t.from),t.op==="move"&&(g.removed=e),g;if(t.op==="test"){if(g.test=Fn(e,t.value),g.test===!1)throw new Mt("Test operation failed","TEST_OPERATION_FAILED",f,t,e);return g.newDocument=e,g}if(t.op==="remove")return g.removed=e,g.newDocument=null,g;if(t.op==="_get")return t.value=e,g;if(n)throw new Mt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",f,t,e);return g}i||(e=ht(e));var x=(t.path||"").split("/"),k=e,F=1,V=x.length,X=void 0,te=void 0,se=void 0;for(se=typeof n=="function"?n:_t;;){if((te=x[F])&&te.indexOf("~")!=-1&&(te=we(te)),a&&te=="__proto__")throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&X===void 0&&(k[te]===void 0?X=x.slice(0,F).join("/"):F==V-1&&(X=t.path),X!==void 0&&se(t,0,e,X)),F++,Array.isArray(k)){if(te==="-")te=k.length;else{if(n&&!It(te))throw new Mt("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",f,t,e);It(te)&&(te=~~te)}if(F>=V){if(n&&t.op==="add"&&te>k.length)throw new Mt("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",f,t,e);if((g=Ft[t.op].call(t,k,te,e)).test===!1)throw new Mt("Test operation failed","TEST_OPERATION_FAILED",f,t,e);return g}}else if(F>=V){if((g=Ut[t.op].call(t,k,te,e)).test===!1)throw new Mt("Test operation failed","TEST_OPERATION_FAILED",f,t,e);return g}if(k=k[te],n&&F<V&&(!k||typeof k!="object"))throw new Mt("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",f,t,e)}}function nn(e,t,n,i,a){if(i===void 0&&(i=!0),a===void 0&&(a=!0),n&&!Array.isArray(t))throw new Mt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=ht(e));for(var f=new Array(t.length),g=0,x=t.length;g<x;g++)f[g]=yt(e,t[g],n,!0,a,g),e=f[g].newDocument;return f.newDocument=e,f}function xt(e,t,n){var i=yt(e,t);if(i.test===!1)throw new Mt("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument}function _t(e,t,n,i){if(typeof e!="object"||e===null||Array.isArray(e))throw new Mt("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!Ut[e.op])throw new Mt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if(typeof e.path!="string")throw new Mt("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Mt('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Mt("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Mt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&function x(k){if(k===void 0)return!0;if(k){if(Array.isArray(k)){for(var F=0,V=k.length;F<V;F++)if(x(k[F]))return!0}else if(typeof k=="object"){var X=Ge(k),te=X.length;for(F=0;F<te;F++)if(x(k[X[F]]))return!0}}return!1}(e.value))throw new Mt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var a=e.path.split("/").length,f=i.split("/").length;if(a!==f+1&&a!==f)throw new Mt("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==i)throw new Mt("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var g=Yt([{op:"_get",path:e.from,value:void 0}],n);if(g&&g.name==="OPERATION_PATH_UNRESOLVABLE")throw new Mt("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}function Yt(e,t,n){try{if(!Array.isArray(e))throw new Mt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)nn(ht(t),ht(e),n||!0);else{n=n||_t;for(var i=0;i<e.length;i++)n(e[i],i,t,void 0)}}catch(a){if(a instanceof Mt)return a;throw a}}function Fn(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n,i,a,f=Array.isArray(e),g=Array.isArray(t);if(f&&g){if((i=e.length)!=t.length)return!1;for(n=i;n--!=0;)if(!Fn(e[n],t[n]))return!1;return!0}if(f!=g)return!1;var x=Object.keys(e);if((i=x.length)!==Object.keys(t).length)return!1;for(n=i;n--!=0;)if(!t.hasOwnProperty(x[n]))return!1;for(n=i;n--!=0;)if(!Fn(e[a=x[n]],t[a]))return!1;return!0}return e!=e&&t!=t}var Rn=new WeakMap,cn=function(){return function(e){this.observers=new Map,this.obj=e}}(),qe=function(){return function(e,t){this.callback=e,this.observer=t}}();function Qe(e,t){t.unobserve()}function $e(e,t){var n,i=function(x){return Rn.get(x)}(e);if(i){var a=function(x,k){return x.observers.get(k)}(i,t);n=a&&a.observer}else i=new cn(e),Rn.set(e,i);if(n)return n;if(n={},i.value=ht(e),t){n.callback=t,n.next=null;var f=function(){ft(n)},g=function(){clearTimeout(n.next),n.next=setTimeout(f)};typeof window<"u"&&(window.addEventListener("mouseup",g),window.addEventListener("keyup",g),window.addEventListener("mousedown",g),window.addEventListener("keydown",g),window.addEventListener("change",g))}return n.patches=[],n.object=e,n.unobserve=function(){ft(n),clearTimeout(n.next),function(x,k){x.observers.delete(k.callback)}(i,n),typeof window<"u"&&(window.removeEventListener("mouseup",g),window.removeEventListener("keyup",g),window.removeEventListener("mousedown",g),window.removeEventListener("keydown",g),window.removeEventListener("change",g))},i.observers.set(t,new qe(t,n)),n}function ft(e,t){t===void 0&&(t=!1);var n=Rn.get(e.object);Jt(n.value,e.object,e.patches,"",t),e.patches.length&&nn(n.value,e.patches);var i=e.patches;return i.length>0&&(e.patches=[],e.callback&&e.callback(i)),i}function Jt(e,t,n,i,a){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var f=Ge(t),g=Ge(e),x=!1,k=g.length-1;k>=0;k--){var F=e[X=g[k]];if(!ge(t,X)||t[X]===void 0&&F!==void 0&&Array.isArray(t)===!1)Array.isArray(e)===Array.isArray(t)?(a&&n.push({op:"test",path:i+"/"+St(X),value:ht(F)}),n.push({op:"remove",path:i+"/"+St(X)}),x=!0):(a&&n.push({op:"test",path:i,value:e}),n.push({op:"replace",path:i,value:t}));else{var V=t[X];typeof F=="object"&&F!=null&&typeof V=="object"&&V!=null&&Array.isArray(F)===Array.isArray(V)?Jt(F,V,n,i+"/"+St(X),a):F!==V&&(a&&n.push({op:"test",path:i+"/"+St(X),value:ht(F)}),n.push({op:"replace",path:i+"/"+St(X),value:ht(V)}))}}if(x||f.length!=g.length)for(k=0;k<f.length;k++){var X;ge(e,X=f[k])||t[X]===void 0||n.push({op:"add",path:i+"/"+St(X),value:ht(t[X])})}}}function Qt(e,t,n){n===void 0&&(n=!1);var i=[];return Jt(e,t,i,"",n),i}Object.assign({},l,C,{JsonPatchError:jt,deepClone:ht,escapePathComponent:St,unescapePathComponent:we});var Pn=r(133),kn=r.n(Pn),Qn=r(179),ke=r(1),ar=r(63),Tr=r(44);function rn(e){const t=e||ke.y,n=[],i={};return n.add=a=>{const f=t(a);return i[f]||(i[f]=1,n.push(a)),n},n.remove=a=>{const f=t(a);if(i[f]){i[f]=0;const g=n.indexOf(a);g>=0&&n.splice(g,1)}return n},n}async function Ht(e,t){try{await t(e)}catch(n){e.error(n)}}const Gn=Symbol("vega_id");let Xt=1;function Wt(e){return!(!e||!Zt(e))}function Zt(e){return e[Gn]}function Vn(e,t){return e[Gn]=t,e}function xn(e){const t=e===Object(e)?e:{data:e};return Zt(t)?t:Vn(t,Xt++)}function Un(e){return ur(e,xn({}))}function ur(e,t){for(const n in e)t[n]=e[n];return t}function sr(e,t){return Vn(t,Zt(e))}function Er(e,t){return e?t?(n,i)=>e(n,i)||Zt(t(n))-Zt(t(i)):(n,i)=>e(n,i)||Zt(n)-Zt(i):null}function Mr(e){return e&&e.constructor===pr}function pr(){const e=[],t=[],n=[],i=[],a=[];let f=null,g=!1;return{constructor:pr,insert(x){const k=Object(ke.i)(x),F=k.length;for(let V=0;V<F;++V)e.push(k[V]);return this},remove(x){const k=Object(ke.E)(x)?i:t,F=Object(ke.i)(x),V=F.length;for(let X=0;X<V;++X)k.push(F[X]);return this},modify(x,k,F){const V={field:k,value:Object(ke.m)(F)};return Object(ke.E)(x)?(V.filter=x,a.push(V)):(V.tuple=x,n.push(V)),this},encode(x,k){return Object(ke.E)(x)?a.push({filter:x,field:k}):n.push({tuple:x,field:k}),this},clean(x){return f=x,this},reflow(){return g=!0,this},pulse(x,k){const F={},V={};let X,te,se,he,ye,Pe;for(X=0,te=k.length;X<te;++X)F[Zt(k[X])]=1;for(X=0,te=t.length;X<te;++X)F[Zt(ye=t[X])]=-1;for(X=0,te=i.length;X<te;++X)he=i[X],k.forEach(We=>{he(We)&&(F[Zt(We)]=-1)});for(X=0,te=e.length;X<te;++X)Pe=Zt(ye=e[X]),F[Pe]?F[Pe]=1:x.add.push(xn(e[X]));for(X=0,te=k.length;X<te;++X)ye=k[X],F[Zt(ye)]<0&&x.rem.push(ye);function Ue(We,at,st){st?We[at]=st(We):x.encode=at,g||(V[Zt(We)]=We)}for(X=0,te=n.length;X<te;++X)ye=(se=n[X]).tuple,he=se.field,(Pe=F[Zt(ye)])>0&&(Ue(ye,he,se.value),x.modifies(he));for(X=0,te=a.length;X<te;++X)se=a[X],he=se.filter,k.forEach(We=>{he(We)&&F[Zt(We)]>0&&Ue(We,se.field,se.value)}),x.modifies(se.field);if(g)x.mod=t.length||i.length?k.filter(We=>F[Zt(We)]>0):k.slice();else for(Pe in V)x.mod.push(V[Pe]);return(f||f==null&&(t.length||i.length))&&x.clean(!0),x}}}const ri="_:mod:_";function Kr(){Object.defineProperty(this,ri,{writable:!0,value:{}})}Kr.prototype={set(e,t,n,i){const a=this,f=a[e],g=a[ri];return t!=null&&t>=0?(f[t]!==n||i)&&(f[t]=n,g[t+":"+e]=-1,g[e]=-1):(f!==n||i)&&(a[e]=n,g[e]=Object(ke.B)(n)?1+n.length:-1),a},modified(e,t){const n=this[ri];if(!arguments.length){for(const i in n)if(n[i])return!0;return!1}if(Object(ke.B)(e)){for(let i=0;i<e.length;++i)if(n[e[i]])return!0;return!1}return t!=null&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[ri]={},this}};let ti=0;const jn=new Kr;function ir(e,t,n,i){this.id=++ti,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,i)}function Cr(e){return function(t){const n=this.flags;return arguments.length===0?!!(n&e):(this.flags=t?n|e:n&~e,this)}}ir.prototype={targets(){return this._targets||(this._targets=rn(ke.x))},set(e){return this.value!==e?(this.value=e,1):0},skip:Cr(1),modified:Cr(2),parameters(e,t,n){t=t!==!1;const i=this._argval=this._argval||new Kr,a=this._argops=this._argops||[],f=[];let g,x,k,F;const V=(X,te,se)=>{se instanceof ir?(se!==this&&(t&&se.targets().add(this),f.push(se)),a.push({op:se,name:X,index:te})):i.set(X,te,se)};for(g in e)if(x=e[g],g==="pulse")Object(ke.i)(x).forEach(X=>{X instanceof ir?X!==this&&(X.targets().add(this),f.push(X)):Object(ke.o)("Pulse parameters must be operator instances.")}),this.source=x;else if(Object(ke.B)(x))for(i.set(g,-1,Array(k=x.length)),F=0;F<k;++F)V(g,F,x[F]);else V(g,-1,x);return this.marshall().clear(),n&&(a.initonly=!0),f},marshall(e){const t=this._argval||jn,n=this._argops;let i,a,f,g;if(n){const x=n.length;for(a=0;a<x;++a)g=(f=(i=n[a]).op).modified()&&f.stamp===e,t.set(i.name,i.index,f.value,g);if(n.initonly){for(a=0;a<x;++a)(i=n[a]).op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,i;if(e)for(t=0,n=e.length;t<n;++t)(i=e[t].op)._targets&&i._targets.remove(this);this.pulse=null,this.source=null},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),i=t.call(this,n,e);if(n.clear(),i!==this.value)this.value=i;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};let Hr=0;function qr(e,t,n){this.id=++Hr,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function Ot(e,t,n){return new qr(e,t,n)}qr.prototype={_filter:ke.Ia,_apply:ke.y,targets(){return this._targets||(this._targets=rn(ke.x))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,i=n?n.length:0;for(let a=0;a<i;++a)n[a].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=Ot(e);return this.targets().add(t),t},apply(e){const t=Ot(null,e);return this.targets().add(t),t},merge(){const e=Ot();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter(()=>{const n=Date.now();return n-t>e?(t=n,1):0})},debounce(e){const t=Ot();return this.targets().add(Ot(null,null,Object(ke.n)(e,n=>{const i=n.dataflow;t.receive(n),i&&i.run&&i.run()}))),t},between(e,t){let n=!1;return e.targets().add(Ot(null,null,()=>n=!0)),t.targets().add(Ot(null,null,()=>n=!1)),this.filter(()=>n)},detach(){this._filter=ke.Ia,this._targets=null}};const Fr={skip:!0};function $t(e,t,n,i,a,f){const g=Object(ke.p)({},f,Fr);let x,k;Object(ke.E)(n)||(n=Object(ke.m)(n)),i===void 0?x=F=>e.touch(n(F)):Object(ke.E)(i)?(k=new ir(null,i,a,!1),x=F=>{k.evaluate(F);const V=n(F),X=k.value;Mr(X)?e.pulse(V,X,f):e.update(V,X,g)}):x=F=>e.update(n(F),i,g),t.apply(x)}function Se(e,t,n,i,a,f){if(i===void 0)t.targets().add(n);else{const g=f||{},x=new ir(null,function(k,F){return F=Object(ke.E)(F)?F:Object(ke.m)(F),k?function(V,X){const te=F(V,X);return k.skip()||(k.skip(te!==this.value).value=te),te}:F}(n,i),a,!1);x.modified(g.force),x.rank=t.rank,t.targets().add(x),n&&(x.skip(!0),x.value=n.value,x.targets().add(n),e.connect(n,[x]))}}const me={};function Ce(e,t,n){this.dataflow=e,this.stamp=t??-1,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function Me(e,t){const n=[];return Object(ke.Ka)(e,t,i=>n.push(i)),n}function rt(e,t){const n={};return e.visit(t,i=>{n[Zt(i)]=1}),i=>n[Zt(i)]?null:i}function kt(e,t){return e?(n,i)=>e(n,i)&&t(n,i):t}function en(e,t,n,i){const a=this,f=n.length;let g=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=i||null,this.pulses=n;for(let x=0;x<f;++x){const k=n[x];if(k.stamp===t){if(k.fields){const F=a.fields||(a.fields={});for(const V in k.fields)F[V]=1}k.changed(a.ADD)&&(g|=a.ADD),k.changed(a.REM)&&(g|=a.REM),k.changed(a.MOD)&&(g|=a.MOD)}}this.changes=g}function En(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}Ce.prototype={StopPropagation:me,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork(e){return new Ce(this.dataflow).init(this,e)},clone(){const e=this.fork(7);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(23)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||((e=new Ce(this.dataflow).init(this)).add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,!e.fields||64&t||(n.fields=e.fields),1&t?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),2&t?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),4&t?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),32&t?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||7;return 1&t&&this.add.length||2&t&&this.rem.length||4&t&&this.mod.length},reflow(e){if(e)return this.fork(7).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(4,rt(this,1))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return Object(ke.B)(e)?e.forEach(n=>t[n]=!0):t[e]=!0,this},modified(e,t){const n=this.fields;return!(!t&&!this.mod.length||!n)&&(arguments.length?Object(ke.B)(e)?e.some(i=>n[i]):n[e]:!!n)},filter(e,t){const n=this;return 1&e&&(n.addF=kt(n.addF,t)),2&e&&(n.remF=kt(n.remF,t)),4&e&&(n.modF=kt(n.modF,t)),16&e&&(n.srcF=kt(n.srcF,t)),n},materialize(e){const t=this;return 1&(e=e||7)&&t.addF&&(t.add=Me(t.add,t.addF),t.addF=null),2&e&&t.remF&&(t.rem=Me(t.rem,t.remF),t.remF=null),4&e&&t.modF&&(t.mod=Me(t.mod,t.modF),t.modF=null),16&e&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,i=t;if(16&e)return Object(ke.Ka)(n.source,n.srcF,i),n;1&e&&Object(ke.Ka)(n.add,n.addF,i),2&e&&Object(ke.Ka)(n.rem,n.remF,i),4&e&&Object(ke.Ka)(n.mod,n.modF,i);const a=n.source;if(8&e&&a){const f=n.add.length+n.mod.length;f===a.length||(f?Object(ke.Ka)(a,rt(n,5),i):Object(ke.Ka)(a,n.srcF,i))}return n}},Object(ke.z)(en,Ce,{fork(e){const t=new Ce(this.dataflow).init(this,e&this.NO_FIELDS);return e!==void 0&&(e&t.ADD&&this.visit(t.ADD,n=>t.add.push(n)),e&t.REM&&this.visit(t.REM,n=>t.rem.push(n)),e&t.MOD&&this.visit(t.MOD,n=>t.mod.push(n))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?Object(ke.B)(e)?e.some(i=>n[i]):n[e]:0},filter(){Object(ke.o)("MultiPulse does not support filtering.")},materialize(){Object(ke.o)("MultiPulse does not support materialization.")},visit(e,t){const n=this,i=n.pulses,a=i.length;let f=0;if(e&n.SOURCE)for(;f<a;++f)i[f].visit(e,t);else for(;f<a;++f)i[f].stamp===n.stamp&&i[f].visit(e,t);return n}});const Nt={skip:!1,force:!1};function Kt(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),hn(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let i;return t.length?(i=t[0],t[0]=n,function(a,f,g){const x=f,k=a.length,F=a[f];let V,X=1+(f<<1);for(;X<k;)(V=X+1)<k&&g(a[X],a[V])>=0&&(X=V),a[f]=a[X],X=1+((f=X)<<1);a[f]=F,hn(a,x,f,g)}(t,0,e)):i=n,i}}}function hn(e,t,n,i){let a,f;const g=e[n];for(;n>t&&i(g,a=e[f=n-1>>1])<0;)e[n]=a,n=f;return e[n]=g}function un(){this.logger(Object(ke.M)()),this.logLevel(ke.b),this._clock=0,this._rank=0,this._locale=Object(Tr.a)();try{this._loader=Object(ar.e)()}catch{}this._touched=rn(ke.x),this._input={},this._pulse=null,this._heap=Kt((e,t)=>e.qrank-t.qrank),this._postrun=[]}function mt(e){return function(){return this._log[e].apply(this,arguments)}}function Tt(e,t){ir.call(this,e,null,t)}un.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:mt("error"),warn:mt("warn"),info:mt("info"),debug:mt("debug"),logLevel:mt("level"),cleanThreshold:1e4,add:function(e,t,n,i){let a,f=1;return e instanceof ir?a=e:e&&e.prototype instanceof ir?a=new e:Object(ke.E)(e)?a=new ir(null,e):(f=0,a=new ir(e,t)),this.rank(a),f&&(i=n,n=t),n&&this.connect(a,a.parameters(n,i)),this.touch(a),a},connect:function(e,t){const n=e.rank,i=t.length;for(let a=0;a<i;++a)if(n<t[a].rank)return void this.rerank(e)},rank:function(e){e.rank=++this._rank},rerank:function(e){const t=[e];let n,i,a;for(;t.length;)if(this.rank(n=t.pop()),i=n._targets)for(a=i.length;--a>=0;)t.push(n=i[a]),n===e&&Object(ke.o)("Cycle detected in dataflow graph.")},pulse:function(e,t,n){this.touch(e,n||Nt);const i=new Ce(this,this._clock+(this._pulse?0:1)),a=e.pulse&&e.pulse.source||[];return i.target=e,this._input[e.id]=t.pulse(i,a),this},touch:function(e,t){const n=t||Nt;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this},update:function(e,t,n){const i=n||Nt;return(e.set(t)||i.force)&&this.touch(e,i),this},changeset:pr,ingest:function(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))},parse:function(e,t){const n=this.locale();return Object(ar.f)(e,t,n.timeParse,n.utcParse)},preload:async function(e,t,n){const i=this,a=i._pending||function(g){let x;const k=new Promise(F=>x=F);return k.requests=0,k.done=()=>{--k.requests==0&&(g._pending=null,x(g))},g._pending=k}(i);a.requests+=1;const f=await i.request(t,n);return i.pulse(e,i.changeset().remove(ke.Ia).insert(f.data||[])),a.done(),f},request:async function(e,t){const n=this;let i,a=0;try{i=await n.loader().load(e,{context:"dataflow",response:Object(ar.g)(t&&t.type)});try{i=n.parse(i,t)}catch(f){a=-2,n.warn("Data ingestion failed",e,f)}}catch(f){a=-1,n.warn("Loading failed",e,f)}return{data:i,status:a}},events:function(e,t,n,i){const a=this,f=Ot(n,i),g=function(F){F.dataflow=a;try{f.receive(F)}catch(V){a.error(V)}finally{a.run()}};let x;const k=(x=typeof e=="string"&&typeof document<"u"?document.querySelectorAll(e):Object(ke.i)(e)).length;for(let F=0;F<k;++F)x[F].addEventListener(t,g);return f},on:function(e,t,n,i,a){return(e instanceof ir?Se:$t)(this,e,t,n,i,a),this},evaluate:async function(e,t,n){const i=this,a=[];if(i._pulse)return En(i);if(i._pending&&await i._pending,t&&await Ht(i,t),!i._touched.length)return i.debug("Dataflow invoked, but nothing to do."),i;const f=++i._clock;i._pulse=new Ce(i,f,e),i._touched.forEach(V=>i._enqueue(V,!0)),i._touched=rn(ke.x);let g,x,k,F=0;try{for(;i._heap.size()>0;)(g=i._heap.pop()).rank===g.qrank?((x=g.run(i._getPulse(g,e))).then?x=await x:x.async&&(a.push(x.async),x=me),x!==me&&g._targets&&g._targets.forEach(V=>i._enqueue(V)),++F):i._enqueue(g,!0)}catch(V){i._heap.clear(),k=V}if(i._input={},i._pulse=null,i.debug(`Pulse ${f}: ${F} operators`),k&&(i._postrun=[],i.error(k)),i._postrun.length){const V=i._postrun.sort((X,te)=>te.priority-X.priority);i._postrun=[];for(let X=0;X<V.length;++X)await Ht(i,V[X].callback)}return n&&await Ht(i,n),a.length&&Promise.all(a).then(V=>i.runAsync(null,()=>{V.forEach(X=>{try{X(i)}catch(te){i.error(te)}})})),i},run:function(e,t,n){return this._pulse?En(this):(this.evaluate(e,t,n),this)},runAsync:async function(e,t,n){for(;this._running;)await this._running;const i=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(i,i),this._running},runAfter:function(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(i){this.error(i)}},_enqueue:function(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))},_getPulse:function(e,t){const n=e.source,i=this._clock;return n&&Object(ke.B)(n)?new en(this,i,n.map(a=>a.pulse),t):this._input[e.id]||function(a,f){return f&&f.stamp===a.stamp?f:(a=a.fork(),f&&f!==me&&(a.source=f.source),a)}(this._pulse,n&&n.pulse)}},Object(ke.z)(Tt,ir,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),(t=t||e).then?t=t.then(n=>this.pulse=n):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const fn={};function tn(e){const t=Ve(e);return t&&t.Definition||null}function Ve(e){return e=e&&e.toLowerCase(),Object(ke.w)(fn,e)?fn[e]:null}var Ln=r(87);function Xn(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n<i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let a of e)(a=t(a,++i,e))!=null&&(n<a||n===void 0&&a>=a)&&(n=a)}return n}function Zn(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n>i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let a of e)(a=t(a,++i,e))!=null&&(n>a||n===void 0&&a>=a)&&(n=a)}return n}function cr(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}var Br=function(e){return e===null?NaN:+e};function Sr(e,t,n){if(i=(e=Float64Array.from(function*(x,k){if(k===void 0)for(let F of x)F!=null&&(F=+F)>=F&&(yield F);else{let F=-1;for(let V of x)(V=k(V,++F,x))!=null&&(V=+V)>=V&&(yield V)}}(e,n))).length){if((t=+t)<=0||i<2)return Zn(e);if(t>=1)return Xn(e);var i,a=(i-1)*t,f=Math.floor(a),g=Xn(function x(k,F,V=0,X=k.length-1,te=Ln.a){for(;X>V;){if(X-V>600){const Pe=X-V+1,Ue=F-V+1,We=Math.log(Pe),at=.5*Math.exp(2*We/3),st=.5*Math.sqrt(We*at*(Pe-at)/Pe)*(Ue-Pe/2<0?-1:1);x(k,F,Math.max(V,Math.floor(F-Ue*at/Pe+st)),Math.min(X,Math.floor(F+(Pe-Ue)*at/Pe+st)),te)}const se=k[F];let he=V,ye=X;for(cr(k,V,F),te(k[X],se)>0&&cr(k,V,X);he<ye;){for(cr(k,he,ye),++he,--ye;te(k[he],se)<0;)++he;for(;te(k[ye],se)>0;)--ye}te(k[V],se)===0?cr(k,V,ye):cr(k,++ye,X),ye<=F&&(V=ye+1),F<=ye&&(X=ye-1)}return k}(e,f).subarray(0,f+1));return g+(Zn(e.subarray(f+1))-g)*(a-f)}}function yi(e,t,n=Br){if(i=e.length){if((t=+t)<=0||i<2)return+n(e[0],0,e);if(t>=1)return+n(e[i-1],i-1,e);var i,a=(i-1)*t,f=Math.floor(a),g=+n(e[f],f,e);return g+(+n(e[f+1],f+1,e)-g)*(a-f)}}var ki=function(e,t){return Sr(e,.5,t)};function*Zr(e,t){if(t==null)for(let n of e)n!=null&&n!==""&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)(i=t(i,++n,e))!=null&&i!==""&&(i=+i)>=i&&(yield i)}}function Zi(e,t,n){const i=Float64Array.from(Zr(e,n));return i.sort(Ln.a),t.map(a=>yi(i,a))}function gi(e,t){return Zi(e,[.25,.5,.75],t)}function ei(e,t){const n=e.length,i=function(g,x){const k=function(F,V){let X,te=0,se=0,he=0;if(V===void 0)for(let ye of F)ye!=null&&(ye=+ye)>=ye&&(he+=(X=ye-se)*(ye-(se+=X/++te)));else{let ye=-1;for(let Pe of F)(Pe=V(Pe,++ye,F))!=null&&(Pe=+Pe)>=Pe&&(he+=(X=Pe-se)*(Pe-(se+=X/++te)))}if(te>1)return he/(te-1)}(g,x);return k&&Math.sqrt(k)}(e,t),a=gi(e,t),f=(a[2]-a[0])/1.34;return 1.06*(Math.min(i,f)||i||Math.abs(a[0])||1)*Math.pow(n,-.2)}function Xr(e){const t=e.maxbins||20,n=e.base||10,i=Math.log(n),a=e.divide||[5,2];let f,g,x,k,F,V,X=e.extent[0],te=e.extent[1];const se=e.span||te-X||Math.abs(X)||1;if(e.step)f=e.step;else if(e.steps){for(k=se/t,F=0,V=e.steps.length;F<V&&e.steps[F]<k;++F);f=e.steps[Math.max(0,F-1)]}else{for(g=Math.ceil(Math.log(t)/i),x=e.minstep||0,f=Math.max(x,Math.pow(n,Math.round(Math.log(se)/i)-g));Math.ceil(se/f)>t;)f*=n;for(F=0,V=a.length;F<V;++F)(k=f/a[F])>=x&&se/k<=t&&(f=k)}const he=(k=Math.log(f))>=0?0:1+~~(-k/i),ye=Math.pow(n,-he-1);return(e.nice||e.nice===void 0)&&(X=X<(k=Math.floor(X/f+ye)*f)?k-f:k,te=Math.ceil(te/f)*f),{start:X,stop:te===X?X+f:te,step:f}}var Kn=Math.random;function di(e){Kn=e}function Ei(e,t,n,i){if(!e.length)return[void 0,void 0];const a=Float64Array.from(Zr(e,i)),f=a.length,g=t;let x,k,F,V;for(F=0,V=Array(g);F<g;++F){for(x=0,k=0;k<f;++k)x+=a[~~(Kn()*f)];V[F]=x/f}return V.sort(Ln.a),[Sr(V,n/2),Sr(V,1-n/2)]}function zr(e,t,n,i){i=i||(te=>te);const a=e.length,f=new Float64Array(a);let g,x=0,k=1,F=i(e[0]),V=F,X=F+t;for(;k<a;++k){if((g=i(e[k]))>=X){for(V=(F+V)/2;x<k;++x)f[x]=V;X=g+t,F=g}V=g}for(V=(F+V)/2;x<k;++x)f[x]=V;return n?function(te,se){const he=te.length;let ye,Pe,Ue=0,We=1;for(;te[Ue]===te[We];)++We;for(;We<he;){for(ye=We+1;te[We]===te[ye];)++ye;if(te[We]-te[We-1]<se){for(Pe=We+(Ue+ye-We-We>>1);Pe<We;)te[Pe++]=te[We];for(;Pe>We;)te[Pe--]=te[Ue]}Ue=We,We=ye}return te}(f,t+t/4):f}function oo(e){return function(){return(e=(1103515245*e+12345)%2147483647)/2147483647}}function zi(e,t){let n,i,a;t==null&&(t=e,e=0);const f={min(g){return arguments.length?(a=i-(n=g||0),f):n},max(g){return arguments.length?(a=(i=g||0)-n,f):i},sample:()=>n+Math.floor(a*Kn()),pdf:g=>g===Math.floor(g)&&g>=n&&g<i?1/a:0,cdf(g){const x=Math.floor(g);return x<n?0:x>=i?1:(x-n+1)/a},icdf:g=>g>=0&&g<=1?n-1+Math.floor(g*a):NaN};return f.min(e).max(t)}const eo=Math.sqrt(2*Math.PI),wo=Math.SQRT2;let ba=NaN;function Ts(e,t){e=e||0,t=t??1;let n,i,a=0,f=0;if(ba==ba)a=ba,ba=NaN;else{do n=(a=2*Kn()-1)*a+(f=2*Kn()-1)*f;while(n===0||n>1);a*=i=Math.sqrt(-2*Math.log(n)/n),ba=f*i}return e+a*t}function xh(e,t,n){n=n??1;const i=(e-(t||0))/n;return Math.exp(-.5*i*i)/(n*eo)}function to(e,t,n){const i=(e-(t=t||0))/(n=n??1),a=Math.abs(i);let f;if(a>37)f=0;else{const g=Math.exp(-a*a/2);a<7.07106781186547?(f=g*((((((.0352624965998911*a+.700383064443688)*a+6.37396220353165)*a+33.912866078383)*a+112.079291497871)*a+221.213596169931)*a+220.206867912376),f/=((((((.0883883476483184*a+1.75566716318264)*a+16.064177579207)*a+86.7807322029461)*a+296.564248779674)*a+637.333633378831)*a+793.826512519948)*a+440.413735824752):f=g/(a+1/(a+2/(a+3/(a+4/(a+.65)))))/2.506628274631}return i>0?1-f:f}function Cc(e,t,n){return e<0||e>1?NaN:(t||0)+(n??1)*wo*function(i){let a,f=-Math.log((1-i)*(1+i));return f<6.25?a=1.6536545626831027+(a=.24015818242558962+(a=(a=(a=.00018673420803405714+(a=(a=(a=42347877827932404e-23+(a=(a=(a=10512122733215323e-25+(a=(a=(a=26335093153082323e-28+(a=(a=(a=6637638134358324e-30+(a=20972767875968562e-33+(a=(a=11157877678025181e-33+(a=128584807152564e-32+(a=(a=-364441206401782e-35)*(f-=3.125)-16850591381820166e-35)*f)*f)*f-1333171662854621e-31)*f)*f)*f-4054566272975207e-29)*f-8151934197605472e-29)*f)*f-12975133253453532e-27)*f-5415412054294628e-26)*f)*f-4112633980346984e-24)*f-29070369957882005e-24)*f)*f-13654692000834679e-22)*f-13882523362786469e-21)*f)*f-.000740702534166267)*f-.006033670871430149)*f)*f:f<16?(f=Math.sqrt(f)-3.25,a=3.0838856104922208+(a=1.0052589676941592+(a=.005370914553590064+(a=(a=.002491442096107851+(a=(a=.0009532893797373805+(a=(a=24031110387097894e-21+(a=6828485145957318e-20+(a=(a=12475304481671779e-21+(a=29234449089955446e-22+(a=(a=15027403968909828e-22+(a=18239629214389228e-24+(a=(a=9075656193888539e-23+(a=22137376921775787e-25)*f)*f-27517406297064545e-23)*f)*f)*f-4013867526981546e-21)*f)*f)*f-47318229009055734e-21)*f)*f)*f-.0003550375203628475)*f)*f-.0016882755560235047)*f)*f-.003751208507569241)*f)*f)*f):Number.isFinite(f)?(f=Math.sqrt(f)-5,a=4.849906401408584+(a=1.0103004648645344+(a=(a=(a=7599527703001776e-20+(a=(a=4526062597223154e-21+(a=(a=22900482228026655e-23+(a=(a=2914795345090108e-23+(a=(a=761570120807834e-23+(a=(a=15076572693500548e-25+(a=(a=-27109920616438573e-27)*f-2555641816996525e-25)*f)*f-3789465440126737e-24)*f)*f-1496002662714924e-23)*f)*f-6771199775845234e-23)*f)*f-99298272942317e-20)*f)*f-1968177810553167e-20)*f)*f-.00021503011930044477)*f-.00013871931833623122)*f)*f):a=1/0,a*i}(2*e-1)}function Uu(e,t){let n,i;const a={mean(f){return arguments.length?(n=f||0,a):n},stdev(f){return arguments.length?(i=f??1,a):i},sample:()=>Ts(n,i),pdf:f=>xh(f,n,i),cdf:f=>to(f,n,i),icdf:f=>Cc(f,n,i)};return a.mean(e).stdev(t)}function Yc(e,t){const n=Uu();let i=0;const a={data(f){return arguments.length?(e=f,i=f?f.length:0,a.bandwidth(t)):e},bandwidth(f){return arguments.length?(!(t=f)&&e&&(t=ei(e)),a):t},sample:()=>e[~~(Kn()*i)]+t*n.sample(),pdf(f){let g=0,x=0;for(;x<i;++x)g+=n.pdf((f-e[x])/t);return g/t/i},cdf(f){let g=0,x=0;for(;x<i;++x)g+=n.cdf((f-e[x])/t);return g/i},icdf(){throw Error("KDE icdf not supported.")}};return a.data(e)}function sc(e,t){return e=e||0,t=t??1,Math.exp(e+Ts()*t)}function Jc(e,t,n){if(e<=0)return 0;t=t||0,n=n??1;const i=(Math.log(e)-t)/n;return Math.exp(-.5*i*i)/(n*eo*e)}function Rp(e,t,n){return to(Math.log(e),t,n)}function ys(e,t,n){return Math.exp(Cc(e,t,n))}function sd(e,t){let n,i;const a={mean(f){return arguments.length?(n=f||0,a):n},stdev(f){return arguments.length?(i=f??1,a):i},sample:()=>sc(n,i),pdf:f=>Jc(f,n,i),cdf:f=>Rp(f,n,i),icdf:f=>ys(f,n,i)};return a.mean(e).stdev(t)}function Pp(e,t){let n,i=0;const a={weights(f){return arguments.length?(n=function(g){const x=[];let k,F=0;for(k=0;k<i;++k)F+=x[k]=g[k]==null?1:+g[k];for(k=0;k<i;++k)x[k]/=F;return x}(t=f||[]),a):t},distributions(f){return arguments.length?(f?(i=f.length,e=f):(i=0,e=[]),a.weights(t)):e},sample(){const f=Kn();let g=e[i-1],x=n[0],k=0;for(;k<i-1;x+=n[++k])if(f<x){g=e[k];break}return g.sample()},pdf(f){let g=0,x=0;for(;x<i;++x)g+=n[x]*e[x].pdf(f);return g},cdf(f){let g=0,x=0;for(;x<i;++x)g+=n[x]*e[x].cdf(f);return g},icdf(){throw Error("Mixture icdf not supported.")}};return a.distributions(e).weights(t)}function uc(e,t){return t==null&&(t=e??1,e=0),e+(t-e)*Kn()}function ud(e,t,n){return n==null&&(n=t??1,t=0),e>=t&&e<=n?1/(n-t):0}function wh(e,t,n){return n==null&&(n=t??1,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function Qc(e,t,n){return n==null&&(n=t??1,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function uf(e,t){let n,i;const a={min(f){return arguments.length?(n=f||0,a):n},max(f){return arguments.length?(i=f??1,a):i},sample:()=>uc(n,i),pdf:f=>ud(f,n,i),cdf:f=>wh(f,n,i),icdf:f=>Qc(f,n,i)};return t==null&&(t=e??1,e=0),a.min(e).max(t)}function Ua(e,t,n,i){const a=i-e*e,f=Math.abs(a)<1e-24?0:(n-e*t)/a;return[t-f*e,f]}function Sl(e,t,n,i){e=e.filter(se=>{let he=t(se),ye=n(se);return he!=null&&(he=+he)>=he&&ye!=null&&(ye=+ye)>=ye}),i&&e.sort((se,he)=>t(se)-t(he));const a=e.length,f=new Float64Array(a),g=new Float64Array(a);let x,k,F,V=0,X=0,te=0;for(F of e)f[V]=x=+t(F),g[V]=k=+n(F),X+=(x-X)/++V,te+=(k-te)/V;for(V=0;V<a;++V)f[V]-=X,g[V]-=te;return[f,g,X,te]}function ga(e,t,n,i){let a,f,g=-1;for(const x of e)a=t(x),f=n(x),a!=null&&(a=+a)>=a&&f!=null&&(f=+f)>=f&&i(a,f,++g)}function Ac(e,t,n,i,a){let f=0,g=0;return ga(e,t,n,(x,k)=>{const F=k-a(x),V=k-i;f+=F*F,g+=V*V}),1-f/g}function bs(e,t,n){let i=0,a=0,f=0,g=0,x=0;ga(e,t,n,(V,X)=>{i+=(V-i)/++x,a+=(X-a)/x,f+=(V*X-f)/x,g+=(V*V-g)/x});const k=Ua(i,a,f,g),F=V=>k[0]+k[1]*V;return{coef:k,predict:F,rSquared:Ac(e,t,n,a,F)}}function Fa(e,t,n){let i=0,a=0,f=0,g=0,x=0;ga(e,t,n,(V,X)=>{++x,V=Math.log(V),i+=(V-i)/x,a+=(X-a)/x,f+=(V*X-f)/x,g+=(V*V-g)/x});const k=Ua(i,a,f,g),F=V=>k[0]+k[1]*Math.log(V);return{coef:k,predict:F,rSquared:Ac(e,t,n,a,F)}}function Oc(e,t,n){const[i,a,f,g]=Sl(e,t,n);let x,k,F,V=0,X=0,te=0,se=0,he=0;ga(e,t,n,(We,at)=>{x=i[he++],k=Math.log(at),V+=(at*k-V)/he,X+=((F=x*at)-X)/he,te+=(F*k-te)/he,se+=(x*F-se)/he});const[ye,Pe]=Ua(X/g,V/g,te/g,se/g),Ue=We=>Math.exp(ye+Pe*(We-f));return{coef:[Math.exp(ye-Pe*f),Pe],predict:Ue,rSquared:Ac(e,t,n,g,Ue)}}function cf(e,t,n){let i=0,a=0,f=0,g=0,x=0,k=0;ga(e,t,n,(X,te)=>{const se=Math.log(X),he=Math.log(te);i+=(se-i)/++k,a+=(he-a)/k,f+=(se*he-f)/k,g+=(se*se-g)/k,x+=(te-x)/k});const F=Ua(i,a,f,g),V=X=>F[0]*Math.pow(X,F[1]);return F[0]=Math.exp(F[0]),{coef:F,predict:V,rSquared:Ac(e,t,n,x,V)}}function Tc(e,t,n){const[i,a,f,g]=Sl(e,t,n),x=i.length;let k,F,V,X,te=0,se=0,he=0,ye=0,Pe=0;for(k=0;k<x;)F=i[k],V=a[k++],te+=((X=F*F)-te)/k,se+=(X*F-se)/k,he+=(X*X-he)/k,ye+=(F*V-ye)/k,Pe+=(X*V-Pe)/k;const Ue=he-te*te,We=te*Ue-se*se,at=(Pe*te-ye*se)/We,st=(ye*Ue-Pe*se)/We,lt=-at*te,ct=Ct=>at*(Ct-=f)*Ct+st*Ct+lt+g;return{coef:[lt-st*f+at*f*f+g,st-2*at*f,at],predict:ct,rSquared:Ac(e,t,n,g,ct)}}function Mu(e,t,n,i){if(i===1)return bs(e,t,n);if(i===2)return Tc(e,t,n);const[a,f,g,x]=Sl(e,t,n),k=a.length,F=[],V=[],X=i+1;let te,se,he,ye,Pe;for(te=0;te<X;++te){for(he=0,ye=0;he<k;++he)ye+=Math.pow(a[he],te)*f[he];for(F.push(ye),Pe=new Float64Array(X),se=0;se<X;++se){for(he=0,ye=0;he<k;++he)ye+=Math.pow(a[he],te+se);Pe[se]=ye}V.push(Pe)}V.push(F);const Ue=function(at){const st=at.length-1,lt=[];let ct,Ct,Et,gn,An;for(ct=0;ct<st;++ct){for(gn=ct,Ct=ct+1;Ct<st;++Ct)Math.abs(at[ct][Ct])>Math.abs(at[ct][gn])&&(gn=Ct);for(Et=ct;Et<st+1;++Et)An=at[Et][ct],at[Et][ct]=at[Et][gn],at[Et][gn]=An;for(Ct=ct+1;Ct<st;++Ct)for(Et=st;Et>=ct;Et--)at[Et][Ct]-=at[Et][ct]*at[ct][Ct]/at[ct][ct]}for(Ct=st-1;Ct>=0;--Ct){for(An=0,Et=Ct+1;Et<st;++Et)An+=at[Et][Ct]*lt[Et];lt[Ct]=(at[st][Ct]-An)/at[Ct][Ct]}return lt}(V),We=at=>{at-=g;let st=x+Ue[0]+Ue[1]*at+Ue[2]*at*at;for(te=3;te<X;++te)st+=Ue[te]*Math.pow(at,te);return st};return{coef:function(at,st,lt,ct){const Ct=Array(at);let Et,gn,An,wn;for(Et=0;Et<at;++Et)Ct[Et]=0;for(Et=at-1;Et>=0;--Et)for(An=st[Et],wn=1,Ct[Et]+=An,gn=1;gn<=Et;++gn)wn*=(Et+1-gn)/gn,Ct[Et-gn]+=An*Math.pow(lt,gn)*wn;return Ct[0]+=ct,Ct}(X,Ue,-g,x),predict:We,rSquared:Ac(e,t,n,x,We)}}const _h=2,cd=1e-12;function ld(e,t,n,i){const[a,f,g,x]=Sl(e,t,n,!0),k=a.length,F=Math.max(2,~~(i*k)),V=new Float64Array(k),X=new Float64Array(k),te=new Float64Array(k).fill(1);for(let se=-1;++se<=_h;){const he=[0,F-1];for(let Pe=0;Pe<k;++Pe){const Ue=a[Pe],We=he[0],at=he[1],st=Ue-a[We]>a[at]-Ue?We:at;let lt=0,ct=0,Ct=0,Et=0,gn=0;const An=1/Math.abs(a[st]-Ue||1);for(let qn=We;qn<=at;++qn){const er=a[qn],rr=f[qn],lr=xa(Math.abs(Ue-er)*An)*te[qn],Or=er*lr;lt+=lr,ct+=Or,Ct+=rr*lr,Et+=rr*Or,gn+=er*Or}const[wn,$n]=Ua(ct/lt,Ct/lt,Et/lt,gn/lt);V[Pe]=wn+$n*Ue,X[Pe]=Math.abs(f[Pe]-V[Pe]),Eh(a,Pe+1,he)}if(se===_h)break;const ye=ki(X);if(Math.abs(ye)<cd)break;for(let Pe,Ue,We=0;We<k;++We)Pe=X[We]/(6*ye),te[We]=Pe>=1?cd:(Ue=1-Pe*Pe)*Ue}return function(se,he,ye,Pe){const Ue=se.length,We=[];let at,st=0,lt=0,ct=[];for(;st<Ue;++st)at=se[st]+ye,ct[0]===at?ct[1]+=(he[st]-ct[1])/++lt:(lt=0,ct[1]+=Pe,ct=[at,he[st]],We.push(ct));return ct[1]+=Pe,We}(a,V,g,x)}function xa(e){return(e=1-e*e*e)*e*e}function Eh(e,t,n){const i=e[t];let a=n[0],f=n[1]+1;if(!(f>=e.length))for(;t>a&&e[f]-i<=i-e[a];)n[0]=++a,n[1]=f,++f}const Lp=.5*Math.PI/180;function fd(e,t,n,i){n=n||25,i=Math.max(n,i||200);const a=ye=>[ye,e(ye)],f=t[0],g=t[1],x=g-f,k=x/i,F=[a(f)],V=[];if(n===i){for(let ye=1;ye<i;++ye)F.push(a(f+ye/n*x));return F.push(a(g)),F}V.push(a(g));for(let ye=n;--ye>0;)V.push(a(f+ye/n*x));let X=F[0],te=V[V.length-1];const se=1/x,he=function(ye,Pe){let Ue=ye,We=ye;const at=Pe.length;for(let st=0;st<at;++st){const lt=Pe[st][1];lt<Ue&&(Ue=lt),lt>We&&(We=lt)}return 1/(We-Ue)}(X[1],V);for(;te;){const ye=a((X[0]+te[0])/2);ye[0]-X[0]>=k&&dd(X,ye,te,se,he)>Lp?V.push(ye):(X=te,F.push(te),V.pop()),te=V[V.length-1]}return F}function dd(e,t,n,i,a){const f=Math.atan2(a*(n[1]-e[1]),i*(n[0]-e[0])),g=Math.atan2(a*(t[1]-e[1]),i*(t[0]-e[0]));return Math.abs(f-g)}var Ms=function(e,t,n){e=+e,t=+t,n=(a=arguments.length)<2?(t=e,e=0,1):a<3?1:+n;for(var i=-1,a=0|Math.max(0,Math.ceil((t-e)/n)),f=new Array(a);++i<a;)f[i]=e+i*n;return f},hd=r(108),yr=r(11);function Wu(e){return e&&e.length?e.length===1?e[0]:function(t){return n=>{const i=t.length;let a=1,f=String(t[0](n));for(;a<i;++a)f+="|"+t[a](n);return f}}(e):function(){return""}}function $m(e,t,n){return n||e+(t?"_"+t:"")}const Xm=()=>{},pd={init:Xm,add:Xm,rem:Xm,idx:0},lf={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||e.min===void 0)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||e.max===void 0)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},Bp=Object.keys(lf);function Sh(e,t){return lf[e](t)}function kh(e,t){return e.idx-t.idx}function Hi(){this.valid=0,this.missing=0,this._ops.forEach(e=>e.init(this))}function Lo(e,t){e!=null&&e!==""?e==e&&(++this.valid,this._ops.forEach(n=>n.add(this,e,t))):++this.missing}function Ch(e,t){e!=null&&e!==""?e==e&&(--this.valid,this._ops.forEach(n=>n.rem(this,e,t))):--this.missing}function Gg(e){return this._out.forEach(t=>e[t.out]=t.value(this)),e}function md(e,t){const n=t||ke.y,i=function(g){const x={};g.forEach(F=>x[F.name]=F);const k=F=>{F.req&&F.req.forEach(V=>{x[V]||k(x[V]=lf[V]())})};return g.forEach(k),Object.values(x).sort(kh)}(e),a=e.slice().sort(kh);function f(g){this._ops=i,this._out=a,this.cell=g,this.init()}return f.prototype.init=Hi,f.prototype.add=Lo,f.prototype.rem=Ch,f.prototype.set=Gg,f.prototype.get=n,f.fields=e.map(g=>g.out),f}function jp(e){this._key=e?Object(ke.u)(e):Zt,this.reset()}Bp.forEach(e=>{lf[e]=function(t,n){return i=>Object(ke.p)({name:t,out:i||t},pd,n)}(e,lf[e])});const Ds=jp.prototype;function Mc(e){Tt.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}Ds.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},Ds.add=function(e){this._add.push(e)},Ds.rem=function(e){this._rem.push(e)},Ds.values=function(){if(this._get=null,this._rem.length===0)return this._add;const e=this._add,t=this._rem,n=this._key,i=e.length,a=t.length,f=Array(i-a),g={};let x,k,F;for(x=0;x<a;++x)g[n(t[x])]=1;for(x=0,k=0;x<i;++x)g[n(F=e[x])]?g[n(F)]=0:f[k++]=F;return this._rem=[],this._add=f},Ds.distinct=function(e){const t=this.values(),n={};let i,a=t.length,f=0;for(;--a>=0;)i=e(t[a])+"",Object(ke.w)(n,i)||(n[i]=1,++f);return f},Ds.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=Object(ke.r)(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},Ds.argmin=function(e){return this.extent(e)[0]||{}},Ds.argmax=function(e){return this.extent(e)[1]||{}},Ds.min=function(e){const t=this.extent(e)[0];return t!=null?e(t):void 0},Ds.max=function(e){const t=this.extent(e)[1];return t!=null?e(t):void 0},Ds.quartile=function(e){return this._get===e&&this._q||(this._q=gi(this.values(),e),this._get=e),this._q},Ds.q1=function(e){return this.quartile(e)[0]},Ds.q2=function(e){return this.quartile(e)[1]},Ds.q3=function(e){return this.quartile(e)[2]},Ds.ci=function(e){return this._get===e&&this._ci||(this._ci=Ei(this.values(),1e3,.05,e),this._get=e),this._ci},Ds.ci0=function(e){return this.ci(e)[0]},Ds.ci1=function(e){return this.ci(e)[1]},Mc.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Bp},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},Object(ke.z)(Mc,Tt,{transform(e,t){const n=this,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=e.modified();return n.stamp=i.stamp,n.value&&(a||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=a?n.init(e):{},t.visit(t.SOURCE,f=>n.add(f))):(n.value=n.value||n.init(e),t.visit(t.REM,f=>n.rem(f)),t.visit(t.ADD,f=>n.add(f))),i.modifies(n._outputs),n._drop=e.drop!==!1,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&i.clean(!0).runAfter(()=>this.clean()),n.changes(i)},cross(){const e=this,t=e.value,n=e._dnames,i=n.map(()=>({})),a=n.length;function f(g){let x,k,F,V;for(x in g)for(F=g[x].tuple,k=0;k<a;++k)i[k][V=F[n[k]]]=V}f(e._prev),f(t),function g(x,k,F){const V=n[F],X=i[F++];for(const te in X){const se=x?x+"|"+te:te;k[V]=X[te],F<a?g(se,k,F):t[se]||e.cell(se,k)}}("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],i={};function a(Pe){const Ue=Object(ke.i)(Object(ke.g)(Pe)),We=Ue.length;let at,st=0;for(;st<We;++st)i[at=Ue[st]]||(i[at]=1,t.push(at))}this._dims=Object(ke.i)(e.groupby),this._dnames=this._dims.map(Pe=>{const Ue=Object(ke.h)(Pe);return a(Pe),n.push(Ue),Ue}),this.cellkey=e.key?e.key:Wu(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const f=e.fields||[null],g=e.ops||["count"],x=e.as||[],k=f.length,F={};let V,X,te,se,he,ye;for(k!==g.length&&Object(ke.o)("Unmatched number of fields and aggregate ops."),ye=0;ye<k;++ye)V=f[ye],X=g[ye],V==null&&X!=="count"&&Object(ke.o)("Null aggregate field specified."),he=$m(X,se=Object(ke.h)(V),x[ye]),n.push(he),X!=="count"?((te=F[se])||(a(V),(te=F[se]=[]).field=V,this._measures.push(te)),X!=="count"&&(this._countOnly=!1),te.push(Sh(X,he))):this._counts.push(he);return this._measures=this._measures.map(Pe=>md(Pe,Pe.field)),{}},cellkey:Wu(),cell(e,t){let n=this.value[e];return n?n.num===0&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const i=this._measures,a=i.length;n.agg=Array(a);for(let f=0;f<a;++f)n.agg[f]=new i[f](n)}return n.store&&(n.data=new jp),n},newtuple(e,t){const n=this._dnames,i=this._dims,a=i.length,f={};for(let g=0;g<a;++g)f[n[g]]=i[g](e);return t?sr(t.tuple,f):xn(f)},clean(){const e=this.value;for(const t in e)e[t].num===0&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const i=n.agg;for(let a=0,f=i.length;a<f;++a)i[a].add(i[a].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const i=n.agg;for(let a=0,f=i.length;a<f;++a)i[a].rem(i[a].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let i=0,a=n.length;i<a;++i)t[n[i]]=e.num;if(!this._countOnly){const i=e.agg;for(let a=0,f=i.length;a<f;++a)i[a].set(t)}return t},changes(e){const t=this._adds,n=this._mods,i=this._prev,a=this._drop,f=e.add,g=e.rem,x=e.mod;let k,F,V,X;if(i)for(F in i)k=i[F],a&&!k.num||g.push(k.tuple);for(V=0,X=this._alen;V<X;++V)f.push(this.celltuple(t[V])),t[V]=null;for(V=0,X=this._mlen;V<X;++V)((k=n[V]).num===0&&a?g:x).push(this.celltuple(k)),n[V]=null;return this._alen=this._mlen=0,this._prev=null,e}});function zp(e){Tt.call(this,null,e)}function Km(e,t,n){const i=e;let a=t||[],f=n||[],g={},x=0;return{add:k=>f.push(k),remove:k=>g[i(k)]=++x,size:()=>a.length,data:(k,F)=>(x&&(a=a.filter(V=>!g[i(V)]),g={},x=0),F&&k&&a.sort(k),f.length&&(a=k?Object(ke.O)(k,a,f.sort(k)):a.concat(f),f=[]),a)}}function Ym(e){Tt.call(this,[],e)}function qg(e){ir.call(this,null,$g,e)}function $g(e){return this.value&&!e.modified()?this.value:Object(ke.l)(e.fields,e.orders)}function kl(e){Tt.call(this,null,e)}function Ka(e){Tt.call(this,null,e)}zp.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},Object(ke.z)(zp,Tt,{transform(e,t){const n=e.interval!==!1,i=this._bins(e),a=i.start,f=i.step,g=e.as||["bin0","bin1"],x=g[0],k=g[1];let F;return F=e.modified()?(t=t.reflow(!0)).SOURCE:t.modified(Object(ke.g)(e.field))?t.ADD_MOD:t.ADD,t.visit(F,n?V=>{const X=i(V);V[x]=X,V[k]=X==null?null:a+f*(1+(X-a)/f)}:V=>V[x]=i(V)),t.modifies(n?g:x)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=Xr(e),i=n.step;let a,f,g=n.start,x=g+Math.ceil((n.stop-g)/i)*i;(a=e.anchor)!=null&&(f=a-(g+i*Math.floor((a-g)/i)),g+=f,x+=f);const k=function(F){let V=Object(ke.Ea)(t(F));return V==null?null:V<g?-1/0:V>x?1/0:(V=Math.max(g,Math.min(V,x-i)),g+i*Math.floor(1e-14+(V-g)/i))};return k.start=g,k.stop=n.stop,k.step=i,this.value=Object(ke.f)(k,Object(ke.g)(t),e.name||"bin_"+Object(ke.h)(t))}}),Ym.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},Object(ke.z)(Ym,Tt,{transform(e,t){const n=t.fork(t.ALL),i=Km(Zt,this.value,n.materialize(n.ADD).add),a=e.sort,f=t.changed()||a&&(e.modified("sort")||t.modified(a.fields));return n.visit(n.REM,i.remove),this.modified(f),this.value=n.source=i.data(Er(a),f),t.source&&t.source.root&&(this.value.root=t.source.root),n}}),Object(ke.z)(qg,ir),kl.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]},Object(ke.z)(kl,Tt,{transform(e,t){const n=X=>te=>{for(var se,he=function(Ue,We,at){switch(We){case"upper":Ue=Ue.toUpperCase();break;case"lower":Ue=Ue.toLowerCase()}return Ue.match(at)}(x(te),e.case,f)||[],ye=0,Pe=he.length;ye<Pe;++ye)g.test(se=he[ye])||X(se)},i=this._parameterCheck(e,t),a=this._counts,f=this._match,g=this._stop,x=e.field,k=e.as||["text","count"],F=n(X=>a[X]=1+(a[X]||0)),V=n(X=>a[X]-=1);return i?t.visit(t.SOURCE,F):(t.visit(t.ADD,F),t.visit(t.REM,V)),this._finish(t,k)},_parameterCheck(e,t){let n=!1;return!e.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),!e.modified("pattern")&&this._match||(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,i=this._tuples||(this._tuples={}),a=t[0],f=t[1],g=e.fork(e.NO_SOURCE|e.NO_FIELDS);let x,k,F;for(x in n)k=i[x],F=n[x]||0,!k&&F?(i[x]=k=xn({}),k[a]=x,k[f]=F,g.add.push(k)):F===0?(k&&g.rem.push(k),n[x]=null,i[x]=null):k[f]!==F&&(k[f]=F,g.mod.push(k));return g.modifies(t)}}),Ka.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},Object(ke.z)(Ka,Tt,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.as||["a","b"],a=i[0],f=i[1],g=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let x=this.value;return g?(x&&(n.rem=x),x=t.materialize(t.SOURCE).source,n.add=this.value=function(k,F,V,X){for(var te,se,he=[],ye={},Pe=k.length,Ue=0;Ue<Pe;++Ue)for(ye[F]=se=k[Ue],te=0;te<Pe;++te)ye[V]=k[te],X(ye)&&(he.push(xn(ye)),(ye={})[F]=se);return he}(x,a,f,e.filter||ke.Ia)):n.mod=x,n.source=this.value,n.modifies(i)}});const Ah={kde:Yc,mixture:Pp,normal:Uu,lognormal:sd,uniform:uf},Ze="distributions",cc="function",gd="field";function Up(e){Tt.call(this,null,e)}const Io=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],Fo={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:Io},{name:"weights",type:"number",array:!0}]};function ta(e,t){return e?e.map((n,i)=>t[i]||Object(ke.h)(n)):null}function Ra(e,t,n){const i=[],a=X=>X(k);let f,g,x,k,F,V;if(t==null)i.push(e.map(n));else for(f={},g=0,x=e.length;g<x;++g)k=e[g],(V=f[F=t.map(a)])||(f[F]=V=[],V.dims=F,i.push(V)),V.push(n(k));return i}Up.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:Io.concat(Fo)},{name:"as",type:"string",array:!0,default:["value","density"]}]},Object(ke.z)(Up,Tt,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=function F(V,X){const te=V[cc];Object(ke.w)(Ah,te)||Object(ke.o)("Unknown distribution function: "+te);const se=Ah[te]();for(const he in V)he===gd?se.data((V.from||X()).map(V[he])):he===Ze?se[he](V[he].map(ye=>F(ye,X))):typeof se[he]===cc&&se[he](V[he]);return se}(e.distribution,function(F){return()=>F.materialize(F.SOURCE).source}(t)),a=e.steps||e.minsteps||25,f=e.steps||e.maxsteps||200;let g=e.method||"pdf";g!=="pdf"&&g!=="cdf"&&Object(ke.o)("Invalid density method: "+g),e.extent||i.data||Object(ke.o)("Missing density extent parameter."),g=i[g];const x=e.as||["value","density"],k=fd(g,e.extent||Object(ke.q)(i.data()),a,f).map(F=>{const V={};return V[x[0]]=F[0],V[x[1]]=F[1],xn(V)});this.value&&(n.rem=this.value),this.value=n.add=n.source=k}return n}});function Vu(e){Tt.call(this,null,e)}Vu.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]};function Pa(e){ir.call(this,null,Zc,e),this.modified(!0)}function Zc(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:Object(ke.f)(n=>t(n,e),Object(ke.g)(t),Object(ke.h)(t))}function bu(e){Tt.call(this,[void 0,void 0],e)}function Pt(e,t){ir.call(this,e),this.parent=t,this.count=0}function _o(e){Tt.call(this,{},e),this._keys=Object(ke.t)();const t=this._targets=[];t.active=0,t.forEach=n=>{for(let i=0,a=t.active;i<a;++i)n(t[i],i,t)}}function va(e){ir.call(this,null,Ya,e)}function Ya(e){return this.value&&!e.modified()?this.value:Object(ke.B)(e.name)?Object(ke.i)(e.name).map(t=>Object(ke.u)(t)):Object(ke.u)(e.name,e.as)}function To(e){Tt.call(this,Object(ke.t)(),e)}function Ns(e){Tt.call(this,[],e)}function kr(e){Tt.call(this,[],e)}function ru(e){Tt.call(this,null,e)}function xu(e){Tt.call(this,[],e)}Object(ke.z)(Vu,Tt,{transform(e,t){if(this.value&&!e.modified()&&!t.changed())return t;const n=t.materialize(t.SOURCE).source,i=Ra(t.source,e.groupby,ke.y),a=e.smooth||!1,f=e.field,g=e.step||((he,ye)=>Object(ke.Z)(Object(ke.q)(he,ye))/30)(n,f),x=Er((he,ye)=>f(he)-f(ye)),k=e.as||"bin",F=i.length;let V,X=1/0,te=-1/0,se=0;for(;se<F;++se){const he=i[se].sort(x);V=-1;for(const ye of zr(he,g,a,f))ye<X&&(X=ye),ye>te&&(te=ye),he[++V][k]=ye}return this.value={start:X,stop:te,step:g},t.reflow(!0).modifies(k)}}),Object(ke.z)(Pa,ir),bu.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},Object(ke.z)(bu,Tt,{transform(e,t){const n=this.value,i=e.field,a=t.changed()||t.modified(i.fields)||e.modified("field");let f=n[0],g=n[1];if((a||f==null)&&(f=1/0,g=-1/0),t.visit(a?t.SOURCE:t.ADD,x=>{const k=Object(ke.Ea)(i(x));k!=null&&(k<f&&(f=k),k>g&&(g=k))}),!Number.isFinite(f)||!Number.isFinite(g)){let x=Object(ke.h)(i);x&&(x=` for field "${x}"`),t.dataflow.warn(`Infinite extent${x}: [${f}, ${g}]`),f=g=void 0}this.value=[f,g]}}),Object(ke.z)(Pt,ir,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}}),Object(ke.z)(_o,Tt,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,i){const a=this.value;let f,g,x=Object(ke.w)(a,e)&&a[e];return x?x.value.stamp<n.stamp&&(x.init(n),this.activate(x)):(g=i||(g=this._group[e])&&g.tuple,f=n.dataflow,x=new Pt(n.fork(n.NO_SOURCE),this),f.add(x).connect(t(f,e,g)),a[e]=x,this.activate(x)),x},clean(){const e=this.value;let t=0;for(const n in e)if(e[n].count===0){const i=e[n].detachSubflow;i&&i(),delete e[n],++t}if(t){const n=this._targets.filter(i=>i&&i.count>0);this.initTargets(n)}},initTargets(e){const t=this._targets,n=t.length,i=e?e.length:0;let a=0;for(;a<i;++a)t[a]=e[a];for(;a<n&&t[a]!=null;++a)t[a]=null;t.active=i},transform(e,t){const n=t.dataflow,i=e.key,a=e.subflow,f=this._keys,g=e.modified("key"),x=k=>this.subflow(k,a,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,k=>{const F=Zt(k),V=f.get(F);V!==void 0&&(f.delete(F),x(V).rem(k))}),t.visit(t.ADD,k=>{const F=i(k);f.set(Zt(k),F),x(F).add(k)}),g||t.modified(i.fields)?t.visit(t.MOD,k=>{const F=Zt(k),V=f.get(F),X=i(k);V===X?x(X).mod(k):(f.set(F,X),x(V).rem(k),x(X).add(k))}):t.changed(t.MOD)&&t.visit(t.MOD,k=>{x(f.get(Zt(k))).mod(k)}),g&&t.visit(t.REFLOW,k=>{const F=Zt(k),V=f.get(F),X=i(k);V!==X&&(f.set(F,X),x(V).rem(k),x(X).add(k))}),t.clean()?n.runAfter(()=>{this.clean(),f.clean()}):f.empty>n.cleanThreshold&&n.runAfter(f.clean),t}}),Object(ke.z)(va,ir),To.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},Object(ke.z)(To,Tt,{transform(e,t){const n=t.dataflow,i=this.value,a=t.fork(),f=a.add,g=a.rem,x=a.mod,k=e.expr;let F=!0;function V(X){const te=Zt(X),se=k(X,e),he=i.get(te);se&&he?(i.delete(te),f.push(X)):se||he?F&&se&&!he&&x.push(X):(i.set(te,1),g.push(X))}return t.visit(t.REM,X=>{const te=Zt(X);i.has(te)?i.delete(te):g.push(X)}),t.visit(t.ADD,X=>{k(X,e)?f.push(X):i.set(Zt(X),1)}),t.visit(t.MOD,V),e.modified()&&(F=!1,t.visit(t.REFLOW,V)),i.empty>n.cleanThreshold&&n.runAfter(i.clean),a}}),Ns.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},Object(ke.z)(Ns,Tt,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,a=ta(i,e.as||[]),f=e.index||null,g=a.length;return n.rem=this.value,t.visit(t.SOURCE,x=>{const k=i.map(he=>he(x)),F=k.reduce((he,ye)=>Math.max(he,ye.length),0);let V,X,te,se=0;for(;se<F;++se){for(X=Un(x),V=0;V<g;++V)X[a[V]]=(te=k[V][se])==null?null:te;f&&(X[f]=se),n.add.push(X)}}),this.value=n.source=n.add,f&&n.modifies(f),n.modifies(a)}}),kr.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},Object(ke.z)(kr,Tt,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,a=i.map(ke.h),f=e.as||["key","value"],g=f[0],x=f[1],k=i.length;return n.rem=this.value,t.visit(t.SOURCE,F=>{for(let V,X=0;X<k;++X)(V=Un(F))[g]=a[X],V[x]=i[X](F),n.add.push(V)}),this.value=n.source=n.add,n.modifies(f)}}),ru.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},Object(ke.z)(ru,Tt,{transform(e,t){const n=e.expr,i=e.as,a=e.modified(),f=e.initonly?t.ADD:a?t.SOURCE:t.modified(n.fields)||t.modified(i)?t.ADD_MOD:t.ADD;return a&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(i),t.visit(f,g=>g[i]=n(g,e))}}),Object(ke.z)(xu,Tt,{transform(e,t){const n=t.fork(t.ALL),i=e.generator;let a,f,g,x=this.value,k=e.size-x.length;if(k>0){for(a=[];--k>=0;)a.push(g=xn(i(e))),x.push(g);n.add=n.add.length?n.materialize(n.ADD).add.concat(a):a}else f=x.slice(0,-k),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(f):f,x=x.slice(-k);return n.source=this.value=x,n}});const Cl={value:"value",median:ki,mean:function(e,t){let n=0,i=0;if(t===void 0)for(let a of e)a!=null&&(a=+a)>=a&&(++n,i+=a);else{let a=-1;for(let f of e)(f=t(f,++a,e))!=null&&(f=+f)>=f&&(++n,i+=f)}if(n)return i/n},min:Zn,max:Xn},iu=[];function Oh(e){Tt.call(this,[],e)}function Wp(e){Mc.call(this,e)}function Vp(e){Tt.call(this,null,e)}function Du(e){ir.call(this,null,ao,e)}function ao(e){return this.value&&!e.modified()?this.value:Object(ke.K)(e.fields,e.flat)}function Is(e){Tt.call(this,[],e),this._pending=null}function Th(e,t,n){n.forEach(xn);const i=t.fork(t.NO_FIELDS&t.NO_SOURCE);return i.rem=e.value,e.value=i.source=i.add=n,e._pending=null,i.rem.length&&i.clean(!0),i}function Dc(e){Tt.call(this,{},e)}function xs(e){ir.call(this,null,mi,e)}function mi(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let i,a,f=1/0,g=-1/0;for(i=0;i<n;++i)(a=t[i])[0]<f&&(f=a[0]),a[1]>g&&(g=a[1]);return[f,g]}function Ho(e){ir.call(this,null,Mh,e)}function Mh(e){return this.value&&!e.modified()?this.value:e.values.reduce((t,n)=>t.concat(n),[])}function Hp(e){Tt.call(this,null,e)}function ff(e){Mc.call(this,e)}function Dh(e){_o.call(this,e)}function Gi(e){Tt.call(this,null,e)}function Di(e){Tt.call(this,null,e)}function da(e){Tt.call(this,null,e)}Oh.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},Object(ke.z)(Oh,Tt,{transform(e,t){var n,i,a,f,g,x,k,F,V,X,te=t.fork(t.ALL),se=function(ct){var Ct,Et=ct.method||Cl.value;if(Cl[Et]!=null)return Et===Cl.value?(Ct=ct.value!==void 0?ct.value:0,()=>Ct):Cl[Et];Object(ke.o)("Unrecognized imputation method: "+Et)}(e),he=function(ct){const Ct=ct.field;return Et=>Et?Ct(Et):NaN}(e),ye=Object(ke.h)(e.field),Pe=Object(ke.h)(e.key),Ue=(e.groupby||[]).map(ke.h),We=function(ct,Ct,Et,gn){var An,wn,$n,qn,er,rr,lr,Or,Jr=Ji=>Ji(Or),Lr=[],li=gn?gn.slice():[],Ai={},Ti={};for(li.forEach((Ji,Ii)=>Ai[Ji]=Ii+1),qn=0,lr=ct.length;qn<lr;++qn)Or=ct[qn],rr=Et(Or),er=Ai[rr]||(Ai[rr]=li.push(rr)),wn=(An=Ct?Ct.map(Jr):iu)+"",($n=Ti[wn])||($n=Ti[wn]=[],Lr.push($n),$n.values=An),$n[er-1]=Or;return Lr.domain=li,Lr}(t.source,e.groupby,e.key,e.keyvals),at=[],st=this.value,lt=We.domain.length;for(g=0,F=We.length;g<F;++g)for(a=(n=We[g]).values,i=NaN,k=0;k<lt;++k)if(n[k]==null){for(f=We.domain[k],X={_impute:!0},x=0,V=a.length;x<V;++x)X[Ue[x]]=a[x];X[Pe]=f,X[ye]=Number.isNaN(i)?i=se(n,he):i,at.push(xn(X))}return at.length&&(te.add=te.materialize(te.ADD).add.concat(at)),st.length&&(te.rem=te.materialize(te.REM).rem.concat(st)),this.value=at,te}}),Wp.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:Bp},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},Object(ke.z)(Wp,Mc,{transform(e,t){const n=this,i=e.modified();let a;return n.value&&(i||t.modified(n._inputs,!0))?(a=n.value=i?n.init(e):{},t.visit(t.SOURCE,f=>n.add(f))):(a=n.value=n.value||this.init(e),t.visit(t.REM,f=>n.rem(f)),t.visit(t.ADD,f=>n.add(f))),n.changes(),t.visit(t.SOURCE,f=>{Object(ke.p)(f,a[n.cellkey(f)].tuple)}),t.reflow(i).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,i;for(n=0,i=this._alen;n<i;++n)this.celltuple(e[n]),e[n]=null;for(n=0,i=this._mlen;n<i;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}}),Vp.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},Object(ke.z)(Vp,Tt,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,a=Ra(i,e.groupby,e.field),f=(e.groupby||[]).map(ke.h),g=e.bandwidth,x=e.cumulative?"cdf":"pdf",k=e.as||["value","density"],F=[];let V=e.extent,X=e.steps||e.minsteps||25,te=e.steps||e.maxsteps||200;x!=="pdf"&&x!=="cdf"&&Object(ke.o)("Invalid density method: "+x),e.resolve==="shared"&&(V||(V=Object(ke.q)(i,e.field)),X=te=e.steps||te),a.forEach(se=>{const he=Yc(se,g)[x],ye=e.counts?se.length:1;fd(he,V||Object(ke.q)(se),X,te).forEach(Pe=>{const Ue={};for(let We=0;We<f.length;++We)Ue[f[We]]=se.dims[We];Ue[k[0]]=Pe[0],Ue[k[1]]=Pe[1]*ye,F.push(xn(Ue))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=F}return n}}),Object(ke.z)(Du,ir),Object(ke.z)(Is,Tt,{transform(e,t){const n=t.dataflow;return this._pending?Th(this,t,this._pending):function(i){return i.modified("async")&&!(i.modified("values")||i.modified("url")||i.modified("format"))}(e)?t.StopPropagation:e.values?Th(this,t,n.parse(e.values,e.format)):e.async?{async:n.request(e.url,e.format).then(i=>(this._pending=Object(ke.i)(i.data),a=>a.touch(this)))}:n.request(e.url,e.format).then(i=>Th(this,t,Object(ke.i)(i.data)))}}),Dc.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},Object(ke.z)(Dc,Tt,{transform(e,t){const n=e.fields,i=e.index,a=e.values,f=e.default==null?null:e.default,g=e.modified(),x=n.length;let k,F,V=g?t.SOURCE:t.ADD,X=t,te=e.as;return a?(F=a.length,x>1&&!te&&Object(ke.o)('Multi-field lookup requires explicit "as" parameter.'),te&&te.length!==x*F&&Object(ke.o)('The "as" parameter has too few output field names.'),te=te||a.map(ke.h),k=function(se){for(var he,ye,Pe=0,Ue=0;Pe<x;++Pe)if((ye=i.get(n[Pe](se)))==null)for(he=0;he<F;++he,++Ue)se[te[Ue]]=f;else for(he=0;he<F;++he,++Ue)se[te[Ue]]=a[he](ye)}):(te||Object(ke.o)("Missing output field names."),k=function(se){for(var he,ye=0;ye<x;++ye)he=i.get(n[ye](se)),se[te[ye]]=he??f}),g?X=t.reflow(!0):V|=n.some(se=>t.modified(se.fields))?t.MOD:0,t.visit(V,k),X.modifies(te)}}),Object(ke.z)(xs,ir),Object(ke.z)(Ho,ir),Object(ke.z)(Hp,Tt,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),ff.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:Bp,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},Object(ke.z)(ff,Mc,{_transform:Mc.prototype.transform,transform(e,t){return this._transform(function(n,i){const a=n.field,f=n.value,g=(n.op==="count"?"__count__":n.op)||"sum",x=Object(ke.g)(a).concat(Object(ke.g)(f)),k=function(F,V,X){const te={},se=[];return X.visit(X.SOURCE,he=>{const ye=F(he);te[ye]||(te[ye]=1,se.push(ye))}),se.sort(ke.j),V?se.slice(0,V):se}(a,n.limit||0,i);return i.changed()&&n.set("__pivot__",null,null,!0),{key:n.key,groupby:n.groupby,ops:k.map(()=>g),fields:k.map(F=>function(V,X,te,se){return Object(ke.f)(he=>X(he)===V?te(he):NaN,se,V+"")}(F,a,f,x)),as:k.map(F=>F+""),modified:n.modified.bind(n)}}(e,t),t)}}),Object(ke.z)(Dh,_o,{transform(e,t){const n=e.subflow,i=e.field,a=f=>this.subflow(Zt(f),n,t,f);return(e.modified("field")||i&&t.modified(Object(ke.g)(i)))&&Object(ke.o)("PreFacet does not support field modification."),this.initTargets(),i?(t.visit(t.MOD,f=>{const g=a(f);i(f).forEach(x=>g.mod(x))}),t.visit(t.ADD,f=>{const g=a(f);i(f).forEach(x=>g.add(xn(x)))}),t.visit(t.REM,f=>{const g=a(f);i(f).forEach(x=>g.rem(x))})):(t.visit(t.MOD,f=>a(f).mod(f)),t.visit(t.ADD,f=>a(f).add(f)),t.visit(t.REM,f=>a(f).rem(f))),t.clean()&&t.runAfter(()=>this.clean()),t}}),Gi.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},Object(ke.z)(Gi,Tt,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,a=ta(e.fields,e.as||[]),f=i?(x,k)=>function(F,V,X,te){for(let se=0,he=X.length;se<he;++se)V[te[se]]=X[se](F);return V}(x,k,i,a):ur;let g;return this.value?g=this.value:(t=t.addAll(),g=this.value={}),t.visit(t.REM,x=>{const k=Zt(x);n.rem.push(g[k]),g[k]=null}),t.visit(t.ADD,x=>{const k=f(x,xn({}));g[Zt(x)]=k,n.add.push(k)}),t.visit(t.MOD,x=>{n.mod.push(f(x,g[Zt(x)]))}),n}}),Object(ke.z)(Di,Tt,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}}),da.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};function Gp(e){Tt.call(this,null,e)}function qp(e){Tt.call(this,[],e),this.count=0}function $p(e){Tt.call(this,null,e)}function Jm(e){Tt.call(this,null,e),this.modified(!0)}function lc(e){Tt.call(this,null,e)}Object(ke.z)(da,Tt,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const a=Ra(t.materialize(t.SOURCE).source,e.groupby,e.field),f=(e.groupby||[]).map(ke.h),g=[],x=e.step||.01,k=e.probs||Ms(x/2,1-1e-14,x),F=k.length;return a.forEach(V=>{const X=Zi(V,k);for(let te=0;te<F;++te){const se={};for(let he=0;he<f.length;++he)se[f[he]]=V.dims[he];se[i[0]]=k[te],se[i[1]]=X[te],g.push(xn(se))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=g,n}}),Object(ke.z)(Gp,Tt,{transform(e,t){let n,i;return this.value?i=this.value:(n=t=t.addAll(),i=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,a=>{const f=Zt(a);n.rem.push(i[f]),i[f]=null}),t.visit(t.ADD,a=>{const f=Un(a);i[Zt(a)]=f,n.add.push(f)}),t.visit(t.MOD,a=>{const f=i[Zt(a)];for(const g in a)f[g]=a[g],n.modifies(g);n.mod.push(f)})),n}}),qp.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},Object(ke.z)(qp,Tt,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.modified("size"),a=e.size,f=this.value.reduce((V,X)=>(V[Zt(X)]=1,V),{});let g=this.value,x=this.count,k=0;function F(V){let X,te;g.length<a?g.push(V):(te=~~((x+1)*Kn()))<g.length&&te>=k&&(X=g[te],f[Zt(X)]&&n.rem.push(X),g[te]=V),++x}if(t.rem.length&&(t.visit(t.REM,V=>{const X=Zt(V);f[X]&&(f[X]=-1,n.rem.push(V)),--x}),g=g.filter(V=>f[Zt(V)]!==-1)),(t.rem.length||i)&&g.length<a&&t.source&&(k=x=g.length,t.visit(t.SOURCE,V=>{f[Zt(V)]||F(V)}),k=-1),i&&g.length>a){const V=g.length-a;for(let X=0;X<V;++X)f[Zt(g[X])]=-1,n.rem.push(g[X]);g=g.slice(V)}return t.mod.length&&t.visit(t.MOD,V=>{f[Zt(V)]&&n.mod.push(V)}),t.add.length&&t.visit(t.ADD,F),(t.add.length||k<0)&&(n.add=g.filter(V=>!f[Zt(V)])),this.count=x,this.value=n.source=g,n}}),$p.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},Object(ke.z)($p,Tt,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),i=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=Ms(e.start,e.stop,e.step||1).map(a=>{const f={};return f[i]=a,xn(f)}),n.add=t.add.concat(this.value),n}}),Object(ke.z)(Jm,Tt,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});const Fs=["unit0","unit1"];function Al(e){Tt.call(this,Object(ke.t)(),e)}function qs(e){Tt.call(this,null,e)}lc.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:yr.j,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:Fs}]},Object(ke.z)(lc,Tt,{transform(e,t){const n=e.field,i=e.interval!==!1,a=e.timezone==="utc",f=this._floor(e,t),g=(a?yr.v:yr.p)(f.unit).offset,x=e.as||Fs,k=x[0],F=x[1],V=f.step;let X=f.start||1/0,te=f.stop||-1/0,se=t.ADD;return(e.modified()||t.modified(Object(ke.g)(n)))&&(se=(t=t.reflow(!0)).SOURCE,X=1/0,te=-1/0),t.visit(se,he=>{const ye=n(he);let Pe,Ue;ye==null?(he[k]=null,i&&(he[F]=null)):(he[k]=Pe=Ue=f(ye),i&&(he[F]=Ue=g(Pe,V)),Pe<X&&(X=Pe),Ue>te&&(te=Ue))}),f.start=X,f.stop=te,t.modifies(i?x:k)},_floor(e,t){const n=e.timezone==="utc",{units:i,step:a}=e.units?{units:e.units,step:e.step||1}:Object(yr.n)({extent:e.extent||Object(ke.q)(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),f=Object(yr.t)(i),g=this.value||{},x=(n?yr.u:yr.o)(f,a);return x.unit=Object(ke.W)(f),x.units=f,x.step=a,x.start=g.start,x.stop=g.stop,this.value=x}}),Object(ke.z)(Al,Tt,{transform(e,t){const n=t.dataflow,i=e.field,a=this.value,f=x=>a.set(i(x),x);let g=!0;return e.modified("field")||t.modified(i.fields)?(a.clear(),t.visit(t.SOURCE,f)):t.changed()?(t.visit(t.REM,x=>a.delete(i(x))),t.visit(t.ADD,f)):g=!1,this.modified(g),a.empty>n.cleanThreshold&&n.runAfter(a.clean),t.fork()}}),Object(ke.z)(qs,Tt,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(Er(e.sort)):t.source).map(e.field))}});const wu={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?++e:e}}},percent_rank:function(){const e=wu.rank(),t=e.next;return{init:e.init,next:n=>(t(n)-1)/(n.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,i=t.compare;let a=t.index;if(e<a){for(;a+1<n.length&&!i(n[a],n[a+1]);)++a;e=a}return(1+e)/n.length}}},ntile:function(e,t){(t=+t)>0||Object(ke.o)("ntile num must be greater than zero.");const n=wu.cume_dist(),i=n.next;return{init:n.init,next:a=>Math.ceil(t*i(a))}},lag:function(e,t){return t=+t||1,{next:n=>{const i=n.index-t;return i>=0?e(n.data[i]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const i=n.index+t,a=n.data;return i<a.length?e(a[i]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return(t=+t)>0||Object(ke.o)("nth_value nth must be greater than zero."),{next:n=>{const i=n.i0+(t-1);return i<n.i1?e(n.data[i]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const i=e(n.data[n.index]);return i!=null?t=i:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:i=>{const a=i.data;return i.index<=n?t:(n=function(f,g,x){for(let k=g.length;x<k;++x)if(f(g[x])!=null)return x;return-1}(e,a,i.index))<0?(n=a.length,t=null):t=e(a[n])}}}},Nh=Object.keys(wu);function Wi(e){const t=Object(ke.i)(e.ops),n=Object(ke.i)(e.fields),i=Object(ke.i)(e.params),a=Object(ke.i)(e.as),f=this.outputs=[],g=this.windows=[],x={},k={},F=[],V=[];let X=!0;function te(se){Object(ke.i)(Object(ke.g)(se)).forEach(he=>x[he]=1)}te(e.sort),t.forEach((se,he)=>{const ye=n[he],Pe=Object(ke.h)(ye),Ue=$m(se,Pe,a[he]);if(te(ye),f.push(Ue),Object(ke.w)(wu,se))g.push(function(We,at,st,lt){const ct=wu[We](at,st);return{init:ct.init||ke.Ma,update:function(Ct,Et){Et[lt]=ct.next(Ct)}}}(se,n[he],i[he],Ue));else{if(ye==null&&se!=="count"&&Object(ke.o)("Null aggregate field specified."),se==="count")return void F.push(Ue);X=!1;let We=k[Pe];We||((We=k[Pe]=[]).field=ye,V.push(We)),We.push(Sh(se,Ue))}}),(F.length||V.length)&&(this.cell=function(se,he,ye){se=se.map(lt=>md(lt,lt.field));const Pe={num:0,agg:null,store:!1,count:he};if(!ye)for(var Ue=se.length,We=Pe.agg=Array(Ue),at=0;at<Ue;++at)We[at]=new se[at](Pe);if(Pe.store)var st=Pe.data=new jp;return Pe.add=function(lt){if(Pe.num+=1,!ye){st&&st.add(lt);for(let ct=0;ct<Ue;++ct)We[ct].add(We[ct].get(lt),lt)}},Pe.rem=function(lt){if(Pe.num-=1,!ye){st&&st.rem(lt);for(let ct=0;ct<Ue;++ct)We[ct].rem(We[ct].get(lt),lt)}},Pe.set=function(lt){let ct,Ct;for(st&&st.values(),ct=0,Ct=he.length;ct<Ct;++ct)lt[he[ct]]=Pe.num;if(!ye)for(ct=0,Ct=We.length;ct<Ct;++ct)We[ct].set(lt)},Pe.init=function(){Pe.num=0,st&&st.reset();for(let lt=0;lt<Ue;++lt)We[lt].init()},Pe}(V,F,X)),this.inputs=Object.keys(x)}const vd=Wi.prototype;function Ol(e){Tt.call(this,{},e),this._mlen=0,this._mods=[]}function df(e,t,n,i){const a=i.sort,f=a&&!i.ignorePeers,g=i.frame||[null,0],x=e.data(n),k=x.length,F=f?Object(hd.a)(a):null,V={i0:0,i1:0,p0:0,p1:0,index:0,data:x,compare:a||Object(ke.m)(-1)};t.init();for(let X=0;X<k;++X)Xp(V,g,X,k),f&&Qm(V,F),t.update(V,x[X])}function Xp(e,t,n,i){e.p0=e.i0,e.p1=e.i1,e.i0=t[0]==null?0:Math.max(0,n-Math.abs(t[0])),e.i1=t[1]==null?i:Math.min(i,n+Math.abs(t[1])+1),e.index=n}function Qm(e,t){const n=e.i0,i=e.i1-1,a=e.compare,f=e.data,g=f.length-1;n>0&&!a(f[n],f[n-1])&&(e.i0=t.left(f,f[n])),i<g&&!a(f[i],f[i+1])&&(e.i1=t.right(f,f[i]))}function hf(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function Ih(e){this._context=e}vd.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()},vd.update=function(e,t){const n=this.cell,i=this.windows,a=e.data,f=i&&i.length;let g;if(n){for(g=e.p0;g<e.i0;++g)n.rem(a[g]);for(g=e.p1;g<e.i1;++g)n.add(a[g]);n.set(t)}for(g=0;g<f;++g)i[g].update(e,t)},Ol.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Nh.concat(Bp)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},Object(ke.z)(Ol,Tt,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),i=Er(e.sort),a=Wu(e.groupby),f=x=>this.group(a(x));let g=this.state;g&&!n||(g=this.state=new Wi(e)),n||t.modified(g.inputs)?(this.value={},t.visit(t.SOURCE,x=>f(x).add(x))):(t.visit(t.REM,x=>f(x).remove(x)),t.visit(t.ADD,x=>f(x).add(x)));for(let x=0,k=this._mlen;x<k;++x)df(this._mods[x],g,i,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(g.outputs)},group(e){let t=this.value[e];return t||((t=this.value[e]=Km(Zt)).stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}}),Ih.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:hf(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:hf(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};var Go=function(){};function Fh(e){this._context=e}Fh.prototype={areaStart:Go,areaEnd:Go,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:hf(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function pf(e){this._context=e}pf.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,i=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 3:this._point=4;default:hf(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Rh(e,t){this._basis=new Ih(e),this._beta=t}Rh.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var i,a=e[0],f=t[0],g=e[n]-a,x=t[n]-f,k=-1;++k<=n;)i=k/n,this._basis.point(this._beta*e[k]+(1-this._beta)*(a+i*g),this._beta*t[k]+(1-this._beta)*(f+i*x));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};var mf=function e(t){function n(i){return t===1?new Ih(i):new Rh(i,t)}return n.beta=function(i){return e(+i)},n}(.85);function Tl(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function el(e,t){this._context=e,this._k=(1-t)/6}el.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Tl(this,this._x1,this._y1)}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:Tl(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Ph=function e(t){function n(i){return new el(i,t)}return n.tension=function(i){return e(+i)},n}(0);function yd(e,t){this._context=e,this._k=(1-t)/6}yd.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Tl(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var gf=function e(t){function n(i){return new yd(i,t)}return n.tension=function(i){return e(+i)},n}(0);function tl(e,t){this._context=e,this._k=(1-t)/6}tl.prototype={areaStart:Go,areaEnd:Go,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Tl(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Xg=function e(t){function n(i){return new tl(i,t)}return n.tension=function(i){return e(+i)},n}(0),vf=Math.abs,la=Math.atan2,La=Math.cos,Wa=Math.max,qi=Math.min,Rs=Math.sin,nl=Math.sqrt,Va=1e-12,rl=Math.PI,fc=rl/2,bd=2*rl;function xd(e){return e>=1?fc:e<=-1?-fc:Math.asin(e)}function Ml(e,t,n){var i=e._x1,a=e._y1,f=e._x2,g=e._y2;if(e._l01_a>Va){var x=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,k=3*e._l01_a*(e._l01_a+e._l12_a);i=(i*x-e._x0*e._l12_2a+e._x2*e._l01_2a)/k,a=(a*x-e._y0*e._l12_2a+e._y2*e._l01_2a)/k}if(e._l23_a>Va){var F=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,V=3*e._l23_a*(e._l23_a+e._l12_a);f=(f*F+e._x1*e._l23_2a-t*e._l12_2a)/V,g=(g*F+e._y1*e._l23_2a-n*e._l12_2a)/V}e._context.bezierCurveTo(i,a,f,g,e._x2,e._y2)}function Kp(e,t){this._context=e,this._alpha=t}Kp.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:Ml(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var dc=function e(t){function n(i){return t?new Kp(i,t):new el(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function Kg(e,t){this._context=e,this._alpha=t}Kg.prototype={areaStart:Go,areaEnd:Go,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Ml(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Yp=function e(t){function n(i){return t?new Kg(i,t):new tl(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function yf(e,t){this._context=e,this._alpha=t}yf.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Ml(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Zm=function e(t){function n(i){return t?new yf(i,t):new yd(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function wd(e){this._context=e}wd.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};var Dl=function(e){return new wd(e)};function Jp(e){this._context=e}Jp.prototype={areaStart:Go,areaEnd:Go,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function Lh(e){return e<0?-1:1}function Oa(e,t,n){var i=e._x1-e._x0,a=t-e._x1,f=(e._y1-e._y0)/(i||a<0&&-0),g=(n-e._y1)/(a||i<0&&-0),x=(f*a+g*i)/(i+a);return(Lh(f)+Lh(g))*Math.min(Math.abs(f),Math.abs(g),.5*Math.abs(x))||0}function bf(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Ps(e,t,n){var i=e._x0,a=e._y0,f=e._x1,g=e._y1,x=(f-i)/3;e._context.bezierCurveTo(i+x,a+x*t,f-x,g-x*n,f,g)}function xf(e){this._context=e}function _d(e){this._context=new Bh(e)}function Bh(e){this._context=e}function Qp(e){this._context=e}function Ed(e){var t,n,i=e.length-1,a=new Array(i),f=new Array(i),g=new Array(i);for(a[0]=0,f[0]=2,g[0]=e[0]+2*e[1],t=1;t<i-1;++t)a[t]=1,f[t]=4,g[t]=4*e[t]+2*e[t+1];for(a[i-1]=2,f[i-1]=7,g[i-1]=8*e[i-1]+e[i],t=1;t<i;++t)n=a[t]/f[t-1],f[t]-=n,g[t]-=n*g[t-1];for(a[i-1]=g[i-1]/f[i-1],t=i-2;t>=0;--t)a[t]=(g[t]-a[t+1])/f[t];for(f[i-1]=(e[i]+a[i-1])/2,t=0;t<i-1;++t)f[t]=2*e[t+1]-a[t+1];return[a,f]}xf.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Ps(this,this._t0,bf(this,this._t0))}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Ps(this,bf(this,n=Oa(this,e,t)),n);break;default:Ps(this,this._t0,n=Oa(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}},(_d.prototype=Object.create(xf.prototype)).point=function(e,t){xf.prototype.point.call(this,t,e)},Bh.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,i,a,f){this._context.bezierCurveTo(t,e,i,n,f,a)}},Qp.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var i=Ed(e),a=Ed(t),f=0,g=1;g<n;++f,++g)this._context.bezierCurveTo(i[0][f],a[0][f],i[1][f],a[1][f],e[g],t[g]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function wf(e,t){this._context=e,this._t=t}wf.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}}this._x=e,this._y=t}};const Zp=Math.PI,em=2*Zp,vn=em-1e-6;function ou(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function tr(){return new ou}ou.prototype=tr.prototype={constructor:ou,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,i){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(e,t,n,i,a,f){this._+="C"+ +e+","+ +t+","+ +n+","+ +i+","+(this._x1=+a)+","+(this._y1=+f)},arcTo:function(e,t,n,i,a){e=+e,t=+t,n=+n,i=+i,a=+a;var f=this._x1,g=this._y1,x=n-e,k=i-t,F=f-e,V=g-t,X=F*F+V*V;if(a<0)throw new Error("negative radius: "+a);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(X>1e-6)if(Math.abs(V*x-k*F)>1e-6&&a){var te=n-f,se=i-g,he=x*x+k*k,ye=te*te+se*se,Pe=Math.sqrt(he),Ue=Math.sqrt(X),We=a*Math.tan((Zp-Math.acos((he+X-ye)/(2*Pe*Ue)))/2),at=We/Ue,st=We/Pe;Math.abs(at-1)>1e-6&&(this._+="L"+(e+at*F)+","+(t+at*V)),this._+="A"+a+","+a+",0,0,"+ +(V*te>F*se)+","+(this._x1=e+st*x)+","+(this._y1=t+st*k)}else this._+="L"+(this._x1=e)+","+(this._y1=t)},arc:function(e,t,n,i,a,f){e=+e,t=+t,f=!!f;var g=(n=+n)*Math.cos(i),x=n*Math.sin(i),k=e+g,F=t+x,V=1^f,X=f?i-a:a-i;if(n<0)throw new Error("negative radius: "+n);this._x1===null?this._+="M"+k+","+F:(Math.abs(this._x1-k)>1e-6||Math.abs(this._y1-F)>1e-6)&&(this._+="L"+k+","+F),n&&(X<0&&(X=X%em+em),X>vn?this._+="A"+n+","+n+",0,1,"+V+","+(e-g)+","+(t-x)+"A"+n+","+n+",0,1,"+V+","+(this._x1=k)+","+(this._y1=F):X>1e-6&&(this._+="A"+n+","+n+",0,"+ +(X>=Zp)+","+V+","+(this._x1=e+n*Math.cos(a))+","+(this._y1=t+n*Math.sin(a))))},rect:function(e,t,n,i){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};var Ls=tr,mo=function(e){return function(){return e}};function _f(e){return e.innerRadius}function Sd(e){return e.outerRadius}function mr(e){return e.startAngle}function ts(e){return e.endAngle}function Ta(e){return e&&e.padAngle}function no(e,t,n,i,a,f,g){var x=e-n,k=t-i,F=(g?f:-f)/nl(x*x+k*k),V=F*k,X=-F*x,te=e+V,se=t+X,he=n+V,ye=i+X,Pe=(te+he)/2,Ue=(se+ye)/2,We=he-te,at=ye-se,st=We*We+at*at,lt=a-f,ct=te*ye-he*se,Ct=(at<0?-1:1)*nl(Wa(0,lt*lt*st-ct*ct)),Et=(ct*at-We*Ct)/st,gn=(-ct*We-at*Ct)/st,An=(ct*at+We*Ct)/st,wn=(-ct*We+at*Ct)/st,$n=Et-Pe,qn=gn-Ue,er=An-Pe,rr=wn-Ue;return $n*$n+qn*qn>er*er+rr*rr&&(Et=An,gn=wn),{cx:Et,cy:gn,x01:-V,y01:-X,x11:Et*(a/lt-1),y11:gn*(a/lt-1)}}var Hu=function(e){return typeof e=="object"&&"length"in e?e:Array.from(e)};function Nc(e){return e[0]}function au(e){return e[1]}var Ic=function(e,t){var n=mo(!0),i=null,a=Dl,f=null;function g(x){var k,F,V,X=(x=Hu(x)).length,te=!1;for(i==null&&(f=a(V=Ls())),k=0;k<=X;++k)!(k<X&&n(F=x[k],k,x))===te&&((te=!te)?f.lineStart():f.lineEnd()),te&&f.point(+e(F,k,x),+t(F,k,x));if(V)return f=null,V+""||null}return e=typeof e=="function"?e:e===void 0?Nc:mo(e),t=typeof t=="function"?t:t===void 0?au:mo(t),g.x=function(x){return arguments.length?(e=typeof x=="function"?x:mo(+x),g):e},g.y=function(x){return arguments.length?(t=typeof x=="function"?x:mo(+x),g):t},g.defined=function(x){return arguments.length?(n=typeof x=="function"?x:mo(!!x),g):n},g.curve=function(x){return arguments.length?(a=x,i!=null&&(f=a(i)),g):a},g.context=function(x){return arguments.length?(x==null?i=f=null:f=a(i=x),g):i},g},na=function(e,t,n){var i=null,a=mo(!0),f=null,g=Dl,x=null;function k(V){var X,te,se,he,ye,Pe=(V=Hu(V)).length,Ue=!1,We=new Array(Pe),at=new Array(Pe);for(f==null&&(x=g(ye=Ls())),X=0;X<=Pe;++X){if(!(X<Pe&&a(he=V[X],X,V))===Ue)if(Ue=!Ue)te=X,x.areaStart(),x.lineStart();else{for(x.lineEnd(),x.lineStart(),se=X-1;se>=te;--se)x.point(We[se],at[se]);x.lineEnd(),x.areaEnd()}Ue&&(We[X]=+e(he,X,V),at[X]=+t(he,X,V),x.point(i?+i(he,X,V):We[X],n?+n(he,X,V):at[X]))}if(ye)return x=null,ye+""||null}function F(){return Ic().defined(a).curve(g).context(f)}return e=typeof e=="function"?e:e===void 0?Nc:mo(+e),t=typeof t=="function"?t:mo(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?au:mo(+n),k.x=function(V){return arguments.length?(e=typeof V=="function"?V:mo(+V),i=null,k):e},k.x0=function(V){return arguments.length?(e=typeof V=="function"?V:mo(+V),k):e},k.x1=function(V){return arguments.length?(i=V==null?null:typeof V=="function"?V:mo(+V),k):i},k.y=function(V){return arguments.length?(t=typeof V=="function"?V:mo(+V),n=null,k):t},k.y0=function(V){return arguments.length?(t=typeof V=="function"?V:mo(+V),k):t},k.y1=function(V){return arguments.length?(n=V==null?null:typeof V=="function"?V:mo(+V),k):n},k.lineX0=k.lineY0=function(){return F().x(e).y(t)},k.lineY1=function(){return F().x(e).y(n)},k.lineX1=function(){return F().x(i).y(t)},k.defined=function(V){return arguments.length?(a=typeof V=="function"?V:mo(!!V),k):a},k.curve=function(V){return arguments.length?(g=V,f!=null&&(x=g(f)),k):g},k.context=function(V){return arguments.length?(V==null?f=x=null:x=g(f=V),k):f},k},hc={draw:function(e,t){var n=Math.sqrt(t/rl);e.moveTo(n,0),e.arc(0,0,n,0,bd)}};function su(e,t){if(typeof document<"u"&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}const vo=()=>typeof Image<"u"?Image:null,ws=Object(hd.a)(Ln.a),Ba=ws.right,_s=ws.left;Object(hd.a)(Br).center;var ra=Ba;function uu(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function Gu(e,t){switch(arguments.length){case 0:break;case 1:typeof e=="function"?this.interpolator(e):this.range(e);break;default:this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t)}return this}const pc=Symbol("implicit");function Fc(){var e=new Map,t=[],n=[],i=pc;function a(f){var g=f+"",x=e.get(g);if(!x){if(i!==pc)return i;e.set(g,x=t.push(f))}return n[(x-1)%n.length]}return a.domain=function(f){if(!arguments.length)return t.slice();t=[],e=new Map;for(const g of f){const x=g+"";e.has(x)||e.set(x,t.push(g))}return a},a.range=function(f){return arguments.length?(n=Array.from(f),a):n.slice()},a.unknown=function(f){return arguments.length?(i=f,a):i},a.copy=function(){return Fc(t,n).unknown(i)},uu.apply(a,arguments),a}var qu=r(45),Nl=r(50);function Il(e,t,n,i){var a,f=Object(qu.c)(e,t,n);switch((i=Object(Nl.formatSpecifier)(i??",f")).type){case"s":var g=Math.max(Math.abs(e),Math.abs(t));return i.precision!=null||isNaN(a=Object(Nl.precisionPrefix)(f,g))||(i.precision=a),Object(Nl.formatPrefix)(i,g);case"":case"e":case"g":case"p":case"r":i.precision!=null||isNaN(a=Object(Nl.precisionRound)(f,Math.max(Math.abs(e),Math.abs(t))))||(i.precision=a-(i.type==="e"));break;case"f":case"%":i.precision!=null||isNaN(a=Object(Nl.precisionFixed)(f))||(i.precision=a-2*(i.type==="%"))}return Object(Nl.format)(i)}var jh=function(e,t,n){e.prototype=t.prototype=n,n.constructor=e};function Fl(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function cu(){}var $u="\\s*([+-]?\\d+)\\s*",Xu="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",_u="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",zh=/^#([0-9a-f]{3,8})$/,kd=new RegExp("^rgb\\("+[$u,$u,$u]+"\\)$"),Cd=new RegExp("^rgb\\("+[_u,_u,_u]+"\\)$"),Ef=new RegExp("^rgba\\("+[$u,$u,$u,Xu]+"\\)$"),Ad=new RegExp("^rgba\\("+[_u,_u,_u,Xu]+"\\)$"),ae=new RegExp("^hsl\\("+[Xu,_u,_u]+"\\)$"),ne=new RegExp("^hsla\\("+[Xu,_u,_u,Xu]+"\\)$"),D={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function H(){return this.rgb().formatHex()}function ue(){return this.rgb().formatRgb()}function je(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=zh.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Je(t):n===3?new dt(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):n===8?vt(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):n===4?vt(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=kd.exec(e))?new dt(t[1],t[2],t[3],1):(t=Cd.exec(e))?new dt(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Ef.exec(e))?vt(t[1],t[2],t[3],t[4]):(t=Ad.exec(e))?vt(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=ae.exec(e))?nr(t[1],t[2]/100,t[3]/100,1):(t=ne.exec(e))?nr(t[1],t[2]/100,t[3]/100,t[4]):D.hasOwnProperty(e)?Je(D[e]):e==="transparent"?new dt(NaN,NaN,NaN,0):null}function Je(e){return new dt(e>>16&255,e>>8&255,255&e,1)}function vt(e,t,n,i){return i<=0&&(e=t=n=NaN),new dt(e,t,n,i)}function Gt(e){return e instanceof cu||(e=je(e)),e?new dt((e=e.rgb()).r,e.g,e.b,e.opacity):new dt}function on(e,t,n,i){return arguments.length===1?Gt(e):new dt(e,t,n,i??1)}function dt(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}function Mn(){return"#"+Hn(this.r)+Hn(this.g)+Hn(this.b)}function zn(){var e=this.opacity;return((e=isNaN(e)?1:Math.max(0,Math.min(1,e)))===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function Hn(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function nr(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new gr(e,t,n,i)}function Yn(e){if(e instanceof gr)return new gr(e.h,e.s,e.l,e.opacity);if(e instanceof cu||(e=je(e)),!e)return new gr;if(e instanceof gr)return e;var t=(e=e.rgb()).r/255,n=e.g/255,i=e.b/255,a=Math.min(t,n,i),f=Math.max(t,n,i),g=NaN,x=f-a,k=(f+a)/2;return x?(g=t===f?(n-i)/x+6*(n<i):n===f?(i-t)/x+2:(t-n)/x+4,x/=k<.5?f+a:2-f-a,g*=60):x=k>0&&k<1?0:g,new gr(g,x,k,e.opacity)}function dr(e,t,n,i){return arguments.length===1?Yn(e):new gr(e,t,n,i??1)}function gr(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function Ar(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function Gr(e,t,n,i,a){var f=e*e,g=f*e;return((1-3*e+3*f-g)*t+(4-6*f+3*g)*n+(1+3*e+3*f-3*g)*i+g*a)/6}jh(cu,je,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:H,formatHex:H,formatHsl:function(){return Yn(this).formatHsl()},formatRgb:ue,toString:ue}),jh(dt,on,Fl(cu,{brighter:function(e){return e=e==null?1/.7:Math.pow(1/.7,e),new dt(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?.7:Math.pow(.7,e),new dt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Mn,formatHex:Mn,formatRgb:zn,toString:zn})),jh(gr,dr,Fl(cu,{brighter:function(e){return e=e==null?1/.7:Math.pow(1/.7,e),new gr(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?.7:Math.pow(.7,e),new gr(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,a=2*n-i;return new dt(Ar(e>=240?e-240:e+120,a,i),Ar(e,a,i),Ar(e<120?e+240:e-120,a,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return((e=isNaN(e)?1:Math.max(0,Math.min(1,e)))===1?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(e===1?")":", "+e+")")}}));var ii=function(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),a=e[i],f=e[i+1],g=i>0?e[i-1]:2*a-f,x=i<t-1?e[i+2]:2*f-a;return Gr((n-i/t)*t,g,a,f,x)}},Ir=function(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t),a=e[(i+t-1)%t],f=e[i%t],g=e[(i+1)%t],x=e[(i+2)%t];return Gr((n-i/t)*t,a,f,g,x)}},ai=e=>()=>e;function ni(e,t){return function(n){return e+n*t}}function bi(e,t){var n=t-e;return n?ni(e,n>180||n<-180?n-360*Math.round(n/360):n):ai(isNaN(e)?t:e)}function _i(e){return(e=+e)==1?oi:function(t,n){return n-t?function(i,a,f){return i=Math.pow(i,f),a=Math.pow(a,f)-i,f=1/f,function(g){return Math.pow(i+g*a,f)}}(t,n,e):ai(isNaN(t)?n:t)}}function oi(e,t){var n=t-e;return n?ni(e,n):ai(isNaN(e)?t:e)}var pi=function e(t){var n=_i(t);function i(a,f){var g=n((a=on(a)).r,(f=on(f)).r),x=n(a.g,f.g),k=n(a.b,f.b),F=oi(a.opacity,f.opacity);return function(V){return a.r=g(V),a.g=x(V),a.b=k(V),a.opacity=F(V),a+""}}return i.gamma=e,i}(1);function fo(e){return function(t){var n,i,a=t.length,f=new Array(a),g=new Array(a),x=new Array(a);for(n=0;n<a;++n)i=on(t[n]),f[n]=i.r||0,g[n]=i.g||0,x[n]=i.b||0;return f=e(f),g=e(g),x=e(x),i.opacity=1,function(k){return i.r=f(k),i.g=g(k),i.b=x(k),i+""}}}var lo=fo(ii),qo=fo(Ir),$i=function(e,t){t||(t=[]);var n,i=e?Math.min(t.length,e.length):0,a=t.slice();return function(f){for(n=0;n<i;++n)a[n]=e[n]*(1-f)+t[n]*f;return a}};function ho(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}var fa=function(e,t){return(ho(t)?$i:Wo)(e,t)};function Wo(e,t){var n,i=t?t.length:0,a=e?Math.min(i,e.length):0,f=new Array(a),g=new Array(i);for(n=0;n<a;++n)f[n]=ha(e[n],t[n]);for(;n<i;++n)g[n]=t[n];return function(x){for(n=0;n<a;++n)g[n]=f[n](x);return g}}var ia=function(e,t){var n=new Date;return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}},Vi=function(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}},Ui=function(e,t){var n,i={},a={};for(n in e!==null&&typeof e=="object"||(e={}),t!==null&&typeof t=="object"||(t={}),t)n in e?i[n]=ha(e[n],t[n]):a[n]=t[n];return function(f){for(n in i)a[n]=i[n](f);return a}},So=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ya=new RegExp(So.source,"g"),wa=function(e,t){var n,i,a,f=So.lastIndex=ya.lastIndex=0,g=-1,x=[],k=[];for(e+="",t+="";(n=So.exec(e))&&(i=ya.exec(t));)(a=i.index)>f&&(a=t.slice(f,a),x[g]?x[g]+=a:x[++g]=a),(n=n[0])===(i=i[0])?x[g]?x[g]+=i:x[++g]=i:(x[++g]=null,k.push({i:g,x:Vi(n,i)})),f=ya.lastIndex;return f<t.length&&(a=t.slice(f),x[g]?x[g]+=a:x[++g]=a),x.length<2?k[0]?function(F){return function(V){return F(V)+""}}(k[0].x):function(F){return function(){return F}}(t):(t=k.length,function(F){for(var V,X=0;X<t;++X)x[(V=k[X]).i]=V.x(F);return x.join("")})},ha=function(e,t){var n,i=typeof t;return t==null||i==="boolean"?ai(t):(i==="number"?Vi:i==="string"?(n=je(t))?(t=n,pi):wa:t instanceof je?pi:t instanceof Date?ia:ho(t)?$i:Array.isArray(t)?Wo:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Ui:Vi)(e,t)},oa=function(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}};function ls(e){return+e}var _a=[0,1];function ko(e){return e}function Ma(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(n){return function(){return n}}(isNaN(t)?NaN:.5)}function Ku(e,t,n){var i=e[0],a=e[1],f=t[0],g=t[1];return a<i?(i=Ma(a,i),f=n(g,f)):(i=Ma(i,a),f=n(f,g)),function(x){return f(i(x))}}function Es(e,t,n){var i=Math.min(e.length,t.length)-1,a=new Array(i),f=new Array(i),g=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++g<i;)a[g]=Ma(e[g],e[g+1]),f[g]=n(t[g],t[g+1]);return function(x){var k=ra(e,x,1,i)-1;return f[k](a[k](x))}}function Ha(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Bo(){var e,t,n,i,a,f,g=_a,x=_a,k=ha,F=ko;function V(){var te=Math.min(g.length,x.length);return F!==ko&&(F=function(se,he){var ye;return se>he&&(ye=se,se=he,he=ye),function(Pe){return Math.max(se,Math.min(he,Pe))}}(g[0],g[te-1])),i=te>2?Es:Ku,a=f=null,X}function X(te){return te==null||isNaN(te=+te)?n:(a||(a=i(g.map(e),x,k)))(e(F(te)))}return X.invert=function(te){return F(t((f||(f=i(x,g.map(e),Vi)))(te)))},X.domain=function(te){return arguments.length?(g=Array.from(te,ls),V()):g.slice()},X.range=function(te){return arguments.length?(x=Array.from(te),V()):x.slice()},X.rangeRound=function(te){return x=Array.from(te),k=oa,V()},X.clamp=function(te){return arguments.length?(F=!!te||ko,V()):F!==ko},X.interpolate=function(te){return arguments.length?(k=te,V()):k},X.unknown=function(te){return arguments.length?(n=te,X):n},function(te,se){return e=te,t=se,V()}}function Rc(){return Bo()(ko,ko)}function lu(e){var t=e.domain;return e.ticks=function(n){var i=t();return Object(qu.a)(i[0],i[i.length-1],n??10)},e.tickFormat=function(n,i){var a=t();return Il(a[0],a[a.length-1],n??10,i)},e.nice=function(n){n==null&&(n=10);var i,a,f=t(),g=0,x=f.length-1,k=f[g],F=f[x],V=10;for(F<k&&(a=k,k=F,F=a,a=g,g=x,x=a);V-- >0;){if((a=Object(qu.b)(k,F,n))===i)return f[g]=k,f[x]=F,t(f);if(a>0)k=Math.floor(k/a)*a,F=Math.ceil(F/a)*a;else{if(!(a<0))break;k=Math.ceil(k*a)/a,F=Math.floor(F*a)/a}i=a}return e},e}function $s(e,t){var n,i=0,a=(e=e.slice()).length-1,f=e[i],g=e[a];return g<f&&(n=i,i=a,a=n,n=f,f=g,g=n),e[i]=t.floor(f),e[a]=t.ceil(g),e}function aa(e){return Math.log(e)}function Xs(e){return Math.exp(e)}function jo(e){return-Math.log(-e)}function Bs(e){return-Math.exp(-e)}function Ss(e){return isFinite(e)?+("1e"+e):e<0?0:e}function go(e){return function(t){return-e(-t)}}function js(e){var t,n,i=e(aa,Xs),a=i.domain,f=10;function g(){return t=function(x){return x===Math.E?Math.log:x===10&&Math.log10||x===2&&Math.log2||(x=Math.log(x),function(k){return Math.log(k)/x})}(f),n=function(x){return x===10?Ss:x===Math.E?Math.exp:function(k){return Math.pow(x,k)}}(f),a()[0]<0?(t=go(t),n=go(n),e(jo,Bs)):e(aa,Xs),i}return i.base=function(x){return arguments.length?(f=+x,g()):f},i.domain=function(x){return arguments.length?(a(x),g()):a()},i.ticks=function(x){var k,F=a(),V=F[0],X=F[F.length-1];(k=X<V)&&(ye=V,V=X,X=ye);var te,se,he,ye=t(V),Pe=t(X),Ue=x==null?10:+x,We=[];if(!(f%1)&&Pe-ye<Ue){if(ye=Math.floor(ye),Pe=Math.ceil(Pe),V>0){for(;ye<=Pe;++ye)for(se=1,te=n(ye);se<f;++se)if(!((he=te*se)<V)){if(he>X)break;We.push(he)}}else for(;ye<=Pe;++ye)for(se=f-1,te=n(ye);se>=1;--se)if(!((he=te*se)<V)){if(he>X)break;We.push(he)}2*We.length<Ue&&(We=Object(qu.a)(V,X,Ue))}else We=Object(qu.a)(ye,Pe,Math.min(Pe-ye,Ue)).map(n);return k?We.reverse():We},i.tickFormat=function(x,k){if(k==null&&(k=f===10?".0e":","),typeof k!="function"&&(k=Object(Nl.format)(k)),x===1/0)return k;x==null&&(x=10);var F=Math.max(1,f*x/i.ticks().length);return function(V){var X=V/n(Math.round(t(V)));return X*f<f-.5&&(X*=f),X<=F?k(V):""}},i.nice=function(){return a($s(a(),{floor:function(x){return n(Math.floor(t(x)))},ceil:function(x){return n(Math.ceil(t(x)))}}))},i}function ns(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function fu(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function il(e){return e<0?-e*e:e*e}function $o(e){var t=e(ko,ko),n=1;return t.exponent=function(i){return arguments.length?(n=+i)==1?e(ko,ko):n===.5?e(fu,il):e(ns(n),ns(1/n)):n},lu(t)}function fs(){var e=$o(Bo());return e.copy=function(){return Ha(e,fs()).exponent(e.exponent())},uu.apply(e,arguments),e}function Ga(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function Pc(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function Rl(e){var t=1,n=e(Ga(t),Pc(t));return n.constant=function(i){return arguments.length?e(Ga(t=+i),Pc(t)):t},lu(n)}var wi=r(12),tm=r(182),Pl=r(69),Sf=r(183),rv=r(184),iv=r(72),Yg=r(40),Jg=r(135),ov=r(70),Qg=r(180),av=r(181),Od=r(71),nm=r(39),sv=r(134),uv=r(68);function cv(e,t,n,i,a,f){const g=[[Pl.a,1,wi.e],[Pl.a,5,5*wi.e],[Pl.a,15,15*wi.e],[Pl.a,30,30*wi.e],[f,1,wi.c],[f,5,5*wi.c],[f,15,15*wi.c],[f,30,30*wi.c],[a,1,wi.b],[a,3,3*wi.b],[a,6,6*wi.b],[a,12,12*wi.b],[i,1,wi.a],[i,2,2*wi.a],[n,1,wi.f],[t,1,wi.d],[t,3,3*wi.d],[e,1,wi.g]];function x(k,F,V){const X=Math.abs(F-k)/V,te=Object(hd.a)(([,,ye])=>ye).right(g,X);if(te===g.length)return e.every(Object(qu.c)(k/wi.g,F/wi.g,V));if(te===0)return tm.a.every(Math.max(Object(qu.c)(k,F,V),1));const[se,he]=g[X/g[te-1][2]<g[te][2]/X?te-1:te];return se.every(he)}return[function(k,F,V){const X=F<k;X&&([k,F]=[F,k]);const te=V&&typeof V.range=="function"?V:x(k,F,V),se=te?te.range(k,+F+1):[];return X?se.reverse():se},x]}const[ol,Td]=cv(uv.a,sv.a,nm.b,Od.a,av.a,Qg.a),[rm,Zg]=cv(ov.a,Jg.a,Yg.b,iv.a,rv.a,Sf.a);var e0=r(100);function Sy(e){return new Date(e)}function t0(e){return e instanceof Date?+e:+new Date(+e)}function Uh(e,t,n,i,a,f,g,x,k,F){var V=Rc(),X=V.invert,te=V.domain,se=F(".%L"),he=F(":%S"),ye=F("%I:%M"),Pe=F("%I %p"),Ue=F("%a %d"),We=F("%b %d"),at=F("%B"),st=F("%Y");function lt(ct){return(k(ct)<ct?se:x(ct)<ct?he:g(ct)<ct?ye:f(ct)<ct?Pe:i(ct)<ct?a(ct)<ct?Ue:We:n(ct)<ct?at:st)(ct)}return V.invert=function(ct){return new Date(X(ct))},V.domain=function(ct){return arguments.length?te(Array.from(ct,t0)):te().map(Sy)},V.ticks=function(ct){var Ct=te();return e(Ct[0],Ct[Ct.length-1],ct??10)},V.tickFormat=function(ct,Ct){return Ct==null?lt:F(Ct)},V.nice=function(ct){var Ct=te();return ct&&typeof ct.range=="function"||(ct=t(Ct[0],Ct[Ct.length-1],ct??10)),ct?te($s(Ct,ct)):V},V.copy=function(){return Ha(V,Uh(e,t,n,i,a,f,g,x,k,F))},V}function Md(){var e,t,n,i,a,f=0,g=1,x=ko,k=!1;function F(X){return X==null||isNaN(X=+X)?a:x(n===0?.5:(X=(i(X)-e)*n,k?Math.max(0,Math.min(1,X)):X))}function V(X){return function(te){var se,he;return arguments.length?([se,he]=te,x=X(se,he),F):[x(0),x(1)]}}return F.domain=function(X){return arguments.length?([f,g]=X,e=i(f=+f),t=i(g=+g),n=e===t?0:1/(t-e),F):[f,g]},F.clamp=function(X){return arguments.length?(k=!!X,F):k},F.interpolator=function(X){return arguments.length?(x=X,F):x},F.range=V(ha),F.rangeRound=V(oa),F.unknown=function(X){return arguments.length?(a=X,F):a},function(X){return i=X,e=X(f),t=X(g),n=e===t?0:1/(t-e),F}}function al(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function n0(){var e=lu(Md()(ko));return e.copy=function(){return al(e,n0())},Gu.apply(e,arguments)}function r0(){var e=$o(Md());return e.copy=function(){return al(e,r0()).exponent(e.exponent())},Gu.apply(e,arguments)}function Yu(e,t){t===void 0&&(t=e,e=ha);for(var n=0,i=t.length-1,a=t[0],f=new Array(i<0?0:i);n<i;)f[n]=e(a,a=t[++n]);return function(g){var x=Math.max(0,Math.min(i-1,Math.floor(g*=i)));return f[x](g-x)}}function i0(){var e,t,n,i,a,f,g,x=0,k=.5,F=1,V=1,X=ko,te=!1;function se(ye){return isNaN(ye=+ye)?g:(ye=.5+((ye=+f(ye))-t)*(V*ye<V*t?i:a),X(te?Math.max(0,Math.min(1,ye)):ye))}function he(ye){return function(Pe){var Ue,We,at;return arguments.length?([Ue,We,at]=Pe,X=Yu(ye,[Ue,We,at]),se):[X(0),X(.5),X(1)]}}return se.domain=function(ye){return arguments.length?([x,k,F]=ye,e=f(x=+x),t=f(k=+k),n=f(F=+F),i=e===t?0:.5/(t-e),a=t===n?0:.5/(n-t),V=t<e?-1:1,se):[x,k,F]},se.clamp=function(ye){return arguments.length?(te=!!ye,se):te},se.interpolator=function(ye){return arguments.length?(X=ye,se):X},se.range=he(ha),se.rangeRound=he(oa),se.unknown=function(ye){return arguments.length?(g=ye,se):g},function(ye){return f=ye,e=ye(x),t=ye(k),n=ye(F),i=e===t?0:.5/(t-e),a=t===n?0:.5/(n-t),V=t<e?-1:1,se}}function Wh(){var e=$o(i0());return e.copy=function(){return al(e,Wh()).exponent(e.exponent())},Gu.apply(e,arguments)}var im,ky=function(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}},om=function(e,t){var n=bi(+e,+t);return function(i){var a=n(i);return a-360*Math.floor(a/360)}},sl=180/Math.PI,am={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},lv=function(e,t,n,i,a,f){var g,x,k;return(g=Math.sqrt(e*e+t*t))&&(e/=g,t/=g),(k=e*n+t*i)&&(n-=e*k,i-=t*k),(x=Math.sqrt(n*n+i*i))&&(n/=x,i/=x,k/=x),e*i<t*n&&(e=-e,t=-t,k=-k,g=-g),{translateX:a,translateY:f,rotate:Math.atan2(t,e)*sl,skewX:Math.atan(k)*sl,scaleX:g,scaleY:x}};function fv(e,t,n,i){function a(f){return f.length?f.pop()+" ":""}return function(f,g){var x=[],k=[];return f=e(f),g=e(g),function(F,V,X,te,se,he){if(F!==X||V!==te){var ye=se.push("translate(",null,t,null,n);he.push({i:ye-4,x:Vi(F,X)},{i:ye-2,x:Vi(V,te)})}else(X||te)&&se.push("translate("+X+t+te+n)}(f.translateX,f.translateY,g.translateX,g.translateY,x,k),function(F,V,X,te){F!==V?(F-V>180?V+=360:V-F>180&&(F+=360),te.push({i:X.push(a(X)+"rotate(",null,i)-2,x:Vi(F,V)})):V&&X.push(a(X)+"rotate("+V+i)}(f.rotate,g.rotate,x,k),function(F,V,X,te){F!==V?te.push({i:X.push(a(X)+"skewX(",null,i)-2,x:Vi(F,V)}):V&&X.push(a(X)+"skewX("+V+i)}(f.skewX,g.skewX,x,k),function(F,V,X,te,se,he){if(F!==X||V!==te){var ye=se.push(a(se)+"scale(",null,",",null,")");he.push({i:ye-4,x:Vi(F,X)},{i:ye-2,x:Vi(V,te)})}else X===1&&te===1||se.push(a(se)+"scale("+X+","+te+")")}(f.scaleX,f.scaleY,g.scaleX,g.scaleY,x,k),f=g=null,function(F){for(var V,X=-1,te=k.length;++X<te;)x[(V=k[X]).i]=V.x(F);return x.join("")}}}var o0=fv(function(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?am:lv(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),D1=fv(function(e){return e==null?am:(im||(im=document.createElementNS("http://www.w3.org/2000/svg","g")),im.setAttribute("transform",e),(e=im.transform.baseVal.consolidate())?(e=e.matrix,lv(e.a,e.b,e.c,e.d,e.e,e.f)):am)},", ",")",")"),N1=1e-12;function yo(e){return((e=Math.exp(e))+1/e)/2}var dv=function e(t,n,i){function a(f,g){var x,k,F=f[0],V=f[1],X=f[2],te=g[0],se=g[1],he=g[2],ye=te-F,Pe=se-V,Ue=ye*ye+Pe*Pe;if(Ue<N1)k=Math.log(he/X)/t,x=function(Ct){return[F+Ct*ye,V+Ct*Pe,X*Math.exp(t*Ct*k)]};else{var We=Math.sqrt(Ue),at=(he*he-X*X+i*Ue)/(2*X*n*We),st=(he*he-X*X-i*Ue)/(2*he*n*We),lt=Math.log(Math.sqrt(at*at+1)-at),ct=Math.log(Math.sqrt(st*st+1)-st);k=(ct-lt)/t,x=function(Ct){var Et=Ct*k,gn=yo(lt),An=X/(n*We)*(gn*function(wn){return((wn=Math.exp(2*wn))-1)/(wn+1)}(t*Et+lt)-function(wn){return((wn=Math.exp(wn))-1/wn)/2}(lt));return[F+An*ye,V+An*Pe,X*gn/yo(t*Et+lt)]}}return x.duration=1e3*k*t/Math.SQRT2,x}return a.rho=function(f){var g=Math.max(.001,+f),x=g*g;return e(g,x,x*x)},a}(Math.SQRT2,2,4);function hv(e){return function(t,n){var i=e((t=dr(t)).h,(n=dr(n)).h),a=oi(t.s,n.s),f=oi(t.l,n.l),g=oi(t.opacity,n.opacity);return function(x){return t.h=i(x),t.s=a(x),t.l=f(x),t.opacity=g(x),t+""}}}var eg=hv(bi),pv=hv(oi);const sm=Math.PI/180,Ll=180/Math.PI,Bl=.96422,mv=1,gv=.82521,Vh=4/29,Dd=6/29,Hh=3*Dd*Dd,I1=Dd*Dd*Dd;function tg(e){if(e instanceof Ju)return new Ju(e.l,e.a,e.b,e.opacity);if(e instanceof mc)return yv(e);e instanceof dt||(e=Gt(e));var t,n,i=vv(e.r),a=vv(e.g),f=vv(e.b),g=kf((.2225045*i+.7168786*a+.0606169*f)/mv);return i===a&&a===f?t=n=g:(t=kf((.4360747*i+.3850649*a+.1430804*f)/Bl),n=kf((.0139322*i+.0971045*a+.7141733*f)/gv)),new Ju(116*g-16,500*(t-g),200*(g-n),e.opacity)}function jl(e,t,n,i){return arguments.length===1?tg(e):new Ju(e,t,n,i??1)}function Ju(e,t,n,i){this.l=+e,this.a=+t,this.b=+n,this.opacity=+i}function kf(e){return e>I1?Math.pow(e,1/3):e/Hh+Vh}function Cf(e){return e>Dd?e*e*e:Hh*(e-Vh)}function Af(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function vv(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function ng(e){if(e instanceof mc)return new mc(e.h,e.c,e.l,e.opacity);if(e instanceof Ju||(e=tg(e)),e.a===0&&e.b===0)return new mc(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*Ll;return new mc(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function Qu(e,t,n,i){return arguments.length===1?ng(e):new mc(e,t,n,i??1)}function mc(e,t,n,i){this.h=+e,this.c=+t,this.l=+n,this.opacity=+i}function yv(e){if(isNaN(e.h))return new Ju(e.l,0,0,e.opacity);var t=e.h*sm;return new Ju(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}function um(e,t){var n=oi((e=jl(e)).l,(t=jl(t)).l),i=oi(e.a,t.a),a=oi(e.b,t.b),f=oi(e.opacity,t.opacity);return function(g){return e.l=n(g),e.a=i(g),e.b=a(g),e.opacity=f(g),e+""}}function a0(e){return function(t,n){var i=e((t=Qu(t)).h,(n=Qu(n)).h),a=oi(t.c,n.c),f=oi(t.l,n.l),g=oi(t.opacity,n.opacity);return function(x){return t.h=i(x),t.c=a(x),t.l=f(x),t.opacity=g(x),t+""}}}jh(Ju,jl,Fl(cu,{brighter:function(e){return new Ju(this.l+18*(e??1),this.a,this.b,this.opacity)},darker:function(e){return new Ju(this.l-18*(e??1),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new dt(Af(3.1338561*(t=Bl*Cf(t))-1.6168667*(e=mv*Cf(e))-.4906146*(n=gv*Cf(n))),Af(-.9787684*t+1.9161415*e+.033454*n),Af(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),jh(mc,Qu,Fl(cu,{brighter:function(e){return new mc(this.h,this.c,this.l+18*(e??1),this.opacity)},darker:function(e){return new mc(this.h,this.c,this.l-18*(e??1),this.opacity)},rgb:function(){return yv(this).rgb()}}));var F1=a0(bi),Cy=a0(oi),Of=-.29227,Gh=-.90649,Nd=1.97294,Id=Nd*Gh,bv=1.78277*Nd,s0=1.78277*Of- -.14861*Gh;function Fd(e,t,n,i){return arguments.length===1?function(a){if(a instanceof po)return new po(a.h,a.s,a.l,a.opacity);a instanceof dt||(a=Gt(a));var f=a.r/255,g=a.g/255,x=a.b/255,k=(s0*x+Id*f-bv*g)/(s0+Id-bv),F=x-k,V=(Nd*(g-k)-Of*F)/Gh,X=Math.sqrt(V*V+F*F)/(Nd*k*(1-k)),te=X?Math.atan2(V,F)*Ll-120:NaN;return new po(te<0?te+360:te,X,k,a.opacity)}(e):new po(e,t,n,i??1)}function po(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function Tf(e){return function t(n){function i(a,f){var g=e((a=Fd(a)).h,(f=Fd(f)).h),x=oi(a.s,f.s),k=oi(a.l,f.l),F=oi(a.opacity,f.opacity);return function(V){return a.h=g(V),a.s=x(V),a.l=k(Math.pow(V,n)),a.opacity=F(V),a+""}}return n=+n,i.gamma=t,i}(1)}jh(po,Fd,Fl(cu,{brighter:function(e){return e=e==null?1/.7:Math.pow(1/.7,e),new po(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?.7:Math.pow(.7,e),new po(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*sm,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),i=Math.cos(e),a=Math.sin(e);return new dt(255*(t+n*(-.14861*i+1.78277*a)),255*(t+n*(Of*i+Gh*a)),255*(t+n*(Nd*i)),this.opacity)}}));var qh=Tf(bi),Ay=Tf(oi),Oy=function(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e(i/(t-1));return n};function rg(e,t,n){const i=e-t+2*n;return e?i>0?i:1:0}const Mf="linear",zl="log",cm="pow",$h="sqrt",Rd="symlog",Df="time",Nf="utc",Zu="sequential",Xh="diverging",Pd="quantile",Ul="quantize",ul="threshold",Ld="ordinal",ig="point",Bd="band",cl="bin-ordinal",ds="continuous",Lc="discrete",ec="discretizing",Nu="interpolating",Kh="temporal";function og(){const e=Fc().unknown(void 0),t=e.domain,n=e.range;let i,a,f=[0,1],g=!1,x=0,k=0,F=.5;function V(){const X=t().length,te=f[1]<f[0],se=f[1-te],he=rg(X,x,k);let ye=f[te-0];i=(se-ye)/(he||1),g&&(i=Math.floor(i)),ye+=(se-ye-i*(X-x))*F,a=i*(1-x),g&&(ye=Math.round(ye),a=Math.round(a));const Pe=Ms(X).map(Ue=>ye+i*Ue);return n(te?Pe.reverse():Pe)}return delete e.unknown,e.domain=function(X){return arguments.length?(t(X),V()):t()},e.range=function(X){return arguments.length?(f=[+X[0],+X[1]],V()):f.slice()},e.rangeRound=function(X){return f=[+X[0],+X[1]],g=!0,V()},e.bandwidth=function(){return a},e.step=function(){return i},e.round=function(X){return arguments.length?(g=!!X,V()):g},e.padding=function(X){return arguments.length?(k=Math.max(0,Math.min(1,X)),x=k,V()):x},e.paddingInner=function(X){return arguments.length?(x=Math.max(0,Math.min(1,X)),V()):x},e.paddingOuter=function(X){return arguments.length?(k=Math.max(0,Math.min(1,X)),V()):k},e.align=function(X){return arguments.length?(F=Math.max(0,Math.min(1,X)),V()):F},e.invertRange=function(X){if(X[0]==null||X[1]==null)return;const te=f[1]<f[0],se=te?n().reverse():n(),he=se.length-1;let ye,Pe,Ue,We=+X[0],at=+X[1];return We!=We||at!=at||(at<We&&(Ue=We,We=at,at=Ue),at<se[0]||We>f[1-te])?void 0:(ye=Math.max(0,Ba(se,We)-1),Pe=We===at?ye:Ba(se,at)-1,We-se[ye]>a+1e-10&&++ye,te&&(Ue=ye,ye=he-Pe,Pe=he-Ue),ye>Pe?void 0:t().slice(ye,Pe+1))},e.invert=function(X){const te=e.invertRange([X,X]);return te&&te[0]},e.copy=function(){return og().domain(t()).range(f).round(g).paddingInner(x).paddingOuter(k).align(F)},V()}var u0=Array.prototype.map;const c0=Array.prototype.slice,lm={};function zo(e,t,n){return arguments.length>1?(lm[e]=function(i,a,f){const g=function(){const x=a();return x.invertRange||(x.invertRange=x.invert?function(k){return function(F){let V,X=F[0],te=F[1];return te<X&&(V=X,X=te,te=V),[k.invert(X),k.invert(te)]}}(x):x.invertExtent?function(k){return function(F){const V=k.range();let X,te,se,he,ye=F[0],Pe=F[1],Ue=-1;for(Pe<ye&&(te=ye,ye=Pe,Pe=te),se=0,he=V.length;se<he;++se)V[se]>=ye&&V[se]<=Pe&&(Ue<0&&(Ue=se),X=se);if(!(Ue<0))return ye=k.invertExtent(V[Ue]),Pe=k.invertExtent(V[X]),[ye[0]===void 0?ye[1]:ye[0],Pe[1]===void 0?Pe[0]:Pe[1]]}}(x):void 0),x.type=i,x};return g.metadata=Object(ke.Fa)(Object(ke.i)(f)),g}(e,t,n),this):fm(e)?lm[e]:void 0}function fm(e){return Object(ke.w)(lm,e)}function Bc(e,t){const n=lm[e];return n&&n.metadata[t]}function jd(e){return Bc(e,ds)}function zd(e){return Bc(e,Lc)}function dm(e){return Bc(e,ec)}function ag(e){return Bc(e,zl)}function sg(e){return Bc(e,Nu)}function ug(e){return Bc(e,Pd)}zo("identity",function e(t){var n;function i(a){return a==null||isNaN(a=+a)?n:a}return i.invert=i,i.domain=i.range=function(a){return arguments.length?(t=Array.from(a,ls),i):t.slice()},i.unknown=function(a){return arguments.length?(n=a,i):n},i.copy=function(){return e(t).unknown(n)},t=arguments.length?Array.from(t,ls):[0,1],lu(i)}),zo(Mf,function e(){var t=Rc();return t.copy=function(){return Ha(t,e())},uu.apply(t,arguments),lu(t)},ds),zo(zl,function e(){var t=js(Bo()).domain([1,10]);return t.copy=function(){return Ha(t,e()).base(t.base())},uu.apply(t,arguments),t},[ds,zl]),zo(cm,fs,ds),zo($h,function(){return fs.apply(null,arguments).exponent(.5)},ds),zo(Rd,function e(){var t=Rl(Bo());return t.copy=function(){return Ha(t,e()).constant(t.constant())},uu.apply(t,arguments)},ds),zo(Df,function(){return uu.apply(Uh(rm,Zg,ov.a,Jg.a,Yg.b,iv.a,rv.a,Sf.a,Pl.a,e0.a).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)},[ds,Kh]),zo(Nf,function(){return uu.apply(Uh(ol,Td,uv.a,sv.a,nm.b,Od.a,av.a,Qg.a,Pl.a,e0.c).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)},[ds,Kh]),zo(Zu,n0,[ds,Nu]),zo("".concat(Zu,"-").concat(Mf),n0,[ds,Nu]),zo("".concat(Zu,"-").concat(zl),function e(){var t=js(Md()).domain([1,10]);return t.copy=function(){return al(t,e()).base(t.base())},Gu.apply(t,arguments)},[ds,Nu,zl]),zo("".concat(Zu,"-").concat(cm),r0,[ds,Nu]),zo("".concat(Zu,"-").concat($h),function(){return r0.apply(null,arguments).exponent(.5)},[ds,Nu]),zo("".concat(Zu,"-").concat(Rd),function e(){var t=Rl(Md());return t.copy=function(){return al(t,e()).constant(t.constant())},Gu.apply(t,arguments)},[ds,Nu]),zo("".concat(Xh,"-").concat(Mf),function e(){var t=lu(i0()(ko));return t.copy=function(){return al(t,e())},Gu.apply(t,arguments)},[ds,Nu]),zo("".concat(Xh,"-").concat(zl),function e(){var t=js(i0()).domain([.1,1,10]);return t.copy=function(){return al(t,e()).base(t.base())},Gu.apply(t,arguments)},[ds,Nu,zl]),zo("".concat(Xh,"-").concat(cm),Wh,[ds,Nu]),zo("".concat(Xh,"-").concat($h),function(){return Wh.apply(null,arguments).exponent(.5)},[ds,Nu]),zo("".concat(Xh,"-").concat(Rd),function e(){var t=Rl(i0());return t.copy=function(){return al(t,e()).constant(t.constant())},Gu.apply(t,arguments)},[ds,Nu]),zo(Pd,function e(){var t,n=[],i=[],a=[];function f(){var x=0,k=Math.max(1,i.length);for(a=new Array(k-1);++x<k;)a[x-1]=yi(n,x/k);return g}function g(x){return x==null||isNaN(x=+x)?t:i[ra(a,x)]}return g.invertExtent=function(x){var k=i.indexOf(x);return k<0?[NaN,NaN]:[k>0?a[k-1]:n[0],k<a.length?a[k]:n[n.length-1]]},g.domain=function(x){if(!arguments.length)return n.slice();n=[];for(let k of x)k==null||isNaN(k=+k)||n.push(k);return n.sort(Ln.a),f()},g.range=function(x){return arguments.length?(i=Array.from(x),f()):i.slice()},g.unknown=function(x){return arguments.length?(t=x,g):t},g.quantiles=function(){return a.slice()},g.copy=function(){return e().domain(n).range(i).unknown(t)},uu.apply(g,arguments)},[ec,Pd]),zo(Ul,function e(){var t,n=0,i=1,a=1,f=[.5],g=[0,1];function x(F){return F!=null&&F<=F?g[ra(f,F,0,a)]:t}function k(){var F=-1;for(f=new Array(a);++F<a;)f[F]=((F+1)*i-(F-a)*n)/(a+1);return x}return x.domain=function(F){return arguments.length?([n,i]=F,n=+n,i=+i,k()):[n,i]},x.range=function(F){return arguments.length?(a=(g=Array.from(F)).length-1,k()):g.slice()},x.invertExtent=function(F){var V=g.indexOf(F);return V<0?[NaN,NaN]:V<1?[n,f[0]]:V>=a?[f[a-1],i]:[f[V-1],f[V]]},x.unknown=function(F){return arguments.length&&(t=F),x},x.thresholds=function(){return f.slice()},x.copy=function(){return e().domain([n,i]).range(g).unknown(t)},uu.apply(lu(x),arguments)},ec),zo(ul,function e(){var t,n=[.5],i=[0,1],a=1;function f(g){return g!=null&&g<=g?i[ra(n,g,0,a)]:t}return f.domain=function(g){return arguments.length?(n=Array.from(g),a=Math.min(n.length,i.length-1),f):n.slice()},f.range=function(g){return arguments.length?(i=Array.from(g),a=Math.min(n.length,i.length-1),f):i.slice()},f.invertExtent=function(g){var x=i.indexOf(g);return[n[x-1],n[x]]},f.unknown=function(g){return arguments.length?(t=g,f):t},f.copy=function(){return e().domain(n).range(i).unknown(t)},uu.apply(f,arguments)},ec),zo(cl,function e(){let t=[],n=[];function i(a){return a==null||a!=a?void 0:n[(ra(t,a)-1)%n.length]}return i.domain=function(a){return arguments.length?(t=function(f){return u0.call(f,ke.Ea)}(a),i):t.slice()},i.range=function(a){return arguments.length?(n=c0.call(a),i):n.slice()},i.tickFormat=function(a,f){return Il(t[0],Object(ke.W)(t),a??10,f)},i.copy=function(){return e().domain(i.domain()).range(i.range())},i},[Lc,ec]),zo(Ld,Fc,Lc),zo(Bd,og,Lc),zo(ig,function(){return function e(t){const n=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,t.copy=function(){return e(n())},t}(og().paddingInner(1))},Lc);const xv=["clamp","base","constant","exponent"];function cg(e,t){const n=t[0],i=Object(ke.W)(t)-n;return function(a){return e(n+a*i)}}function If(e,t,n){return Yu(fg(t||"rgb",n),e)}function lg(e,t){const n=new Array(t),i=t+1;for(let a=0;a<t;)n[a]=e(++a/i);return n}function Yh(e,t,n){const i=n-t;let a,f,g;return i&&Number.isFinite(i)?(a=(f=e.type).indexOf("-"),f=a<0?f:f.slice(a+1),g=zo(f)().domain([t,n]).range([0,1]),xv.forEach(x=>e[x]?g[x](e[x]()):0),g):Object(ke.m)(.5)}function fg(e,t){const n=O[function(i){return"interpolate"+i.toLowerCase().split("-").map(a=>a[0].toUpperCase()+a.slice(1)).join("")}(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function l0(e){const t=e.length/6|0,n=new Array(t);for(let i=0;i<t;)n[i]="#"+e.slice(6*i,6*++i);return n}function f0(e,t){for(const n in e)d0(n,t(e[n]))}const hm={};function d0(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(hm[e]=t,this):hm[e]}f0({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},l0),f0({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},e=>If(l0(e)));const dg="symbol",wv="discrete",Wl=e=>Object(ke.B)(e)?e.map(t=>String(t)):String(e),Ty=(e,t)=>e[1]-t[1],_v=(e,t)=>t[1]-e[1];function pm(e,t,n){let i;return Object(ke.G)(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),n!=null&&(t=Math.min(t,Math.floor(Object(ke.Z)(e.domain())/n||1)))),Object(ke.H)(t)&&(i=t.step,t=t.interval),Object(ke.J)(t)&&(t=e.type===Df?Object(yr.p)(t):e.type==Nf?Object(yr.v)(t):Object(ke.o)("Only time and utc scales accept interval strings."),i&&(t=t.every(i))),t}function Ev(e,t,n){let i=e.range(),a=i[0],f=Object(ke.W)(i),g=Ty;if(a>f&&(i=f,f=a,a=i,g=_v),a=Math.floor(a),f=Math.ceil(f),t=t.map(x=>[x,e(x)]).filter(x=>a<=x[1]&&x[1]<=f).sort(g).map(x=>x[0]),n>0&&t.length>1){const x=[t[0],Object(ke.W)(t)];for(;t.length>n&&t.length>=3;)t=t.filter((k,F)=>!(F%2));t.length<3&&(t=x)}return t}function Ff(e,t){return e.bins?Ev(e,e.bins):e.ticks?e.ticks(t):e.domain()}function Sv(e,t,n,i,a,f){const g=t.type;let x=Wl;if(g===Df||a===Df)x=e.timeFormat(i);else if(g===Nf||a===Nf)x=e.utcFormat(i);else if(ag(g)){const k=e.formatFloat(i);if(f||t.bins)x=k;else{const F=mm(t,n,!1);x=V=>F(V)?k(V):""}}else if(t.tickFormat){const k=t.domain();x=e.formatSpan(k[0],k[k.length-1],n,i)}else i&&(x=e.format(i));return x}function mm(e,t,n){const i=Ff(e,t),a=e.base(),f=Math.log(a),g=Math.max(1,a*t/i.length),x=k=>{let F=k/Math.pow(a,Math.round(Math.log(k)/f));return F*a<a-.5&&(F*=a),F<=g};return n?i.filter(x):x}const hg={[Pd]:"quantiles",[Ul]:"thresholds",[ul]:"domain"},kv={[Pd]:"quantiles",[Ul]:"domain"};function Cv(e,t){return e.bins?function(n){const i=n.slice(0,-1);return i.max=Object(ke.W)(n),i}(e.bins):e.type===zl?mm(e,t,!0):hg[e.type]?function(n){const i=[-1/0].concat(n);return i.max=1/0,i}(e[hg[e.type]]()):Ff(e,t)}const h0=e=>hg[e.type]||e.bins;function Av(e,t,n,i,a,f,g){const x=kv[t.type]&&f!==Df&&f!==Nf?function(k,F,V){const X=F[kv[F.type]](),te=X.length;let se,he=te>1?X[1]-X[0]:X[0];for(se=1;se<te;++se)he=Math.min(he,X[se]-X[se-1]);return k.formatSpan(0,he,30,V)}(e,t,a):Sv(e,t,n,a,f,g);return i===dg&&h0(t)?Ov(x):i===wv?My(x):Tv(x)}const Ov=e=>(t,n,i)=>{const a=Ud(i[n+1],Ud(i.max,1/0)),f=Vl(t,e),g=Vl(a,e);return f&&g?f+"  "+g:g?"< "+g:" "+f},Ud=(e,t)=>e??t,My=e=>(t,n)=>n?e(t):null,Tv=e=>t=>e(t),Vl=(e,t)=>Number.isFinite(e)?t(e):null;function p0(e,t,n,i){const a=i||t.type;return Object(ke.J)(n)&&function(f){return Bc(f,Kh)}(a)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||a!==Df?n||a!==Nf?Av(e,t,5,null,n,i,!0):e.utcFormat("%A, %d %B %Y, %X UTC"):e.timeFormat("%A, %d %B %Y, %X")}function Mv(e,t,n){n=n||{};const i=Math.max(3,n.maxlen||7),a=p0(e,t,n.format,n.formatType);if(dm(t.type)){const f=Cv(t).slice(1).map(a),g=f.length;return"".concat(g," boundar").concat(g===1?"y":"ies",": ").concat(f.join(", "))}if(zd(t.type)){const f=t.domain(),g=f.length,x=g>i?f.slice(0,i-2).map(a).join(", ")+", ending with "+f.slice(-1).map(a):f.map(a).join(", ");return"".concat(g," value").concat(g===1?"":"s",": ").concat(x)}{const f=t.domain();return"values from ".concat(a(f[0])," to ").concat(a(Object(ke.W)(f)))}}let Wd=0;const Hl="p_";function pg(e){return e&&e.gradient}function m0(e,t,n){const i=e.gradient;let a=e.id,f=i==="radial"?Hl:"";return a||(a=e.id="gradient_"+Wd++,i==="radial"?(e.x1=jc(e.x1,.5),e.y1=jc(e.y1,.5),e.r1=jc(e.r1,0),e.x2=jc(e.x2,.5),e.y2=jc(e.y2,.5),e.r2=jc(e.r2,.5),f=Hl):(e.x1=jc(e.x1,0),e.y1=jc(e.y1,0),e.x2=jc(e.x2,1),e.y2=jc(e.y2,0))),t[a]=e,"url("+(n||"")+"#"+f+a+")"}function jc(e,t){return e??t}function g0(e,t){var n,i=[];return n={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:i,stop:function(a,f){return i.push({offset:a,color:f}),n}}}const Dv={basis:{curve:function(e){return new Ih(e)}},"basis-closed":{curve:function(e){return new Fh(e)}},"basis-open":{curve:function(e){return new pf(e)}},bundle:{curve:mf,tension:"beta",value:.85},cardinal:{curve:Ph,tension:"tension",value:0},"cardinal-open":{curve:gf,tension:"tension",value:0},"cardinal-closed":{curve:Xg,tension:"tension",value:0},"catmull-rom":{curve:dc,tension:"alpha",value:.5},"catmull-rom-closed":{curve:Yp,tension:"alpha",value:.5},"catmull-rom-open":{curve:Zm,tension:"alpha",value:.5},linear:{curve:Dl},"linear-closed":{curve:function(e){return new Jp(e)}},monotone:{horizontal:function(e){return new _d(e)},vertical:function(e){return new xf(e)}},natural:{curve:function(e){return new Qp(e)}},step:{curve:function(e){return new wf(e,.5)}},"step-after":{curve:function(e){return new wf(e,1)}},"step-before":{curve:function(e){return new wf(e,0)}}};function Rf(e,t,n){var i=Object(ke.w)(Dv,e)&&Dv[e],a=null;return i&&(a=i.curve||i[t||"vertical"],i.tension&&n!=null&&(a=a[i.tension](n))),a}const Dy={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},Jh=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function Qh(e){const t=[];let n,i,a,f,g,x,k,F,V,X;const te=e.slice().replace(Jh[0],"###$1").split(Jh[1]).slice(1);for(k=0,V=te.length;k<V;++k){for(i=(n=te[k]).slice(1).trim().replace(Jh[2],"$1###$2").replace(Jh[3],"$1###$2").split(Jh[4]),a=[g=n.charAt(0)],F=0,X=i.length;F<X;++F)(f=+i[F])===f&&a.push(f);if(x=Dy[g.toLowerCase()],a.length-1>x){const se=a.length;for(F=1,t.push([g].concat(a.slice(F,F+=x))),g=g==="M"?"L":g==="m"?"l":g;F<se;F+=x)t.push([g].concat(a.slice(F,F+x)))}else t.push(a)}return t}const Pf=Math.PI/180,Nv=1e-14,Vd=Math.PI/2,zc=2*Math.PI,Zh=Math.sqrt(3)/2;var gm={},mg={},v0=[].join;function Iv(e){const t=v0.call(e);if(mg[t])return mg[t];var n=e[0],i=e[1],a=e[2],f=e[3],g=e[4],x=e[5],k=e[6],F=e[7];const V=F*g,X=-k*x,te=k*g,se=F*x,he=Math.cos(a),ye=Math.sin(a),Pe=Math.cos(f),Ue=Math.sin(f),We=.5*(f-a),at=Math.sin(.5*We),st=8/3*at*at/Math.sin(We),lt=n+he-st*ye,ct=i+ye+st*he,Ct=n+Pe,Et=i+Ue,gn=Ct+st*Ue,An=Et-st*Pe;return mg[t]=[V*lt+X*ct,te*lt+se*ct,V*gn+X*An,te*gn+se*An,V*Ct+X*Et,te*Ct+se*Et]}const hs=["l",0,0,0,0,0,0,0];function Fv(e,t,n){const i=hs[0]=e[0];if(i==="a"||i==="A")hs[1]=t*e[1],hs[2]=n*e[2],hs[3]=e[3],hs[4]=e[4],hs[5]=e[5],hs[6]=t*e[6],hs[7]=n*e[7];else if(i==="h"||i==="H")hs[1]=t*e[1];else if(i==="v"||i==="V")hs[1]=n*e[1];else for(var a=1,f=e.length;a<f;++a)hs[a]=(a%2==1?t:n)*e[a];return hs}function ep(e,t,n,i,a,f){var g,x,k,F,V,X=null,te=0,se=0,he=0,ye=0;n==null&&(n=0),i==null&&(i=0),a==null&&(a=1),f==null&&(f=a),e.beginPath&&e.beginPath();for(var Pe=0,Ue=t.length;Pe<Ue;++Pe){switch(g=t[Pe],a===1&&f===1||(g=Fv(g,a,f)),g[0]){case"l":te+=g[1],se+=g[2],e.lineTo(te+n,se+i);break;case"L":te=g[1],se=g[2],e.lineTo(te+n,se+i);break;case"h":te+=g[1],e.lineTo(te+n,se+i);break;case"H":te=g[1],e.lineTo(te+n,se+i);break;case"v":se+=g[1],e.lineTo(te+n,se+i);break;case"V":se=g[1],e.lineTo(te+n,se+i);break;case"m":te+=g[1],se+=g[2],e.moveTo(te+n,se+i);break;case"M":te=g[1],se=g[2],e.moveTo(te+n,se+i);break;case"c":x=te+g[5],k=se+g[6],he=te+g[3],ye=se+g[4],e.bezierCurveTo(te+g[1]+n,se+g[2]+i,he+n,ye+i,x+n,k+i),te=x,se=k;break;case"C":te=g[5],se=g[6],he=g[3],ye=g[4],e.bezierCurveTo(g[1]+n,g[2]+i,he+n,ye+i,te+n,se+i);break;case"s":x=te+g[3],k=se+g[4],he=2*te-he,ye=2*se-ye,e.bezierCurveTo(he+n,ye+i,te+g[1]+n,se+g[2]+i,x+n,k+i),he=te+g[1],ye=se+g[2],te=x,se=k;break;case"S":x=g[3],k=g[4],he=2*te-he,ye=2*se-ye,e.bezierCurveTo(he+n,ye+i,g[1]+n,g[2]+i,x+n,k+i),te=x,se=k,he=g[1],ye=g[2];break;case"q":x=te+g[3],k=se+g[4],he=te+g[1],ye=se+g[2],e.quadraticCurveTo(he+n,ye+i,x+n,k+i),te=x,se=k;break;case"Q":x=g[3],k=g[4],e.quadraticCurveTo(g[1]+n,g[2]+i,x+n,k+i),te=x,se=k,he=g[1],ye=g[2];break;case"t":x=te+g[1],k=se+g[2],X[0].match(/[QqTt]/)===null?(he=te,ye=se):X[0]==="t"?(he=2*te-F,ye=2*se-V):X[0]==="q"&&(he=2*te-he,ye=2*se-ye),F=he,V=ye,e.quadraticCurveTo(he+n,ye+i,x+n,k+i),se=k,he=(te=x)+g[1],ye=se+g[2];break;case"T":x=g[1],k=g[2],he=2*te-he,ye=2*se-ye,e.quadraticCurveTo(he+n,ye+i,x+n,k+i),te=x,se=k;break;case"a":Rv(e,te+n,se+i,[g[1],g[2],g[3],g[4],g[5],g[6]+te+n,g[7]+se+i]),te+=g[6],se+=g[7];break;case"A":Rv(e,te+n,se+i,[g[1],g[2],g[3],g[4],g[5],g[6]+n,g[7]+i]),te=g[6],se=g[7];break;case"z":case"Z":e.closePath()}X=g}}function Rv(e,t,n,i){const a=function(f,g,x,k,F,V,X,te,se){const he=v0.call(arguments);if(gm[he])return gm[he];const ye=X*Pf,Pe=Math.sin(ye),Ue=Math.cos(ye),We=Ue*(te-f)*.5+Pe*(se-g)*.5,at=Ue*(se-g)*.5-Pe*(te-f)*.5;let st=We*We/((x=Math.abs(x))*x)+at*at/((k=Math.abs(k))*k);st>1&&(x*=st=Math.sqrt(st),k*=st);const lt=Ue/x,ct=Pe/x,Ct=-Pe/k,Et=Ue/k,gn=lt*te+ct*se,An=Ct*te+Et*se,wn=lt*f+ct*g,$n=Ct*f+Et*g;let qn=1/((wn-gn)*(wn-gn)+($n-An)*($n-An))-.25;qn<0&&(qn=0);let er=Math.sqrt(qn);V==F&&(er=-er);const rr=.5*(gn+wn)-er*($n-An),lr=.5*(An+$n)+er*(wn-gn),Or=Math.atan2(An-lr,gn-rr);let Jr=Math.atan2($n-lr,wn-rr)-Or;Jr<0&&V===1?Jr+=zc:Jr>0&&V===0&&(Jr-=zc);const Lr=Math.ceil(Math.abs(Jr/(Vd+.001))),li=[];for(let Ai=0;Ai<Lr;++Ai){const Ti=Or+Ai*Jr/Lr,Ji=Or+(Ai+1)*Jr/Lr;li[Ai]=[rr,lr,Ti,Ji,x,k,Pe,Ue]}return gm[he]=li}(i[5],i[6],i[0],i[1],i[3],i[4],i[2],t,n);for(let f=0;f<a.length;++f){const g=Iv(a[f]);e.bezierCurveTo(g[0],g[1],g[2],g[3],g[4],g[5])}}const gg={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,zc)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/2.5;e.moveTo(-n,-i),e.lineTo(-n,i),e.lineTo(-i,i),e.lineTo(-i,n),e.lineTo(i,n),e.lineTo(i,i),e.lineTo(n,i),e.lineTo(n,-i),e.lineTo(i,-i),e.lineTo(i,-n),e.lineTo(-i,-n),e.lineTo(-i,-i),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),i=-n/2;e.rect(i,i,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/7,a=n/2.5,f=n/8;e.moveTo(-i,n),e.lineTo(i,n),e.lineTo(i,-f),e.lineTo(a,-f),e.lineTo(0,-n),e.lineTo(-a,-f),e.lineTo(-i,-f),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,i=Zh*n,a=i-.5773502691896257*n,f=n/4;e.moveTo(0,-i-a),e.lineTo(-f,i-a),e.lineTo(f,i-a),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,i=Zh*n,a=i-.5773502691896257*n;e.moveTo(0,-i-a),e.lineTo(-n,i-a),e.lineTo(n,i-a),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Zh*n;e.moveTo(0,-i),e.lineTo(-n,i),e.lineTo(n,i),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Zh*n;e.moveTo(0,i),e.lineTo(-n,-i),e.lineTo(n,-i),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Zh*n;e.moveTo(i,0),e.lineTo(-i,-n),e.lineTo(-i,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Zh*n;e.moveTo(-i,0),e.lineTo(i,-n),e.lineTo(i,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function Lf(e){return Object(ke.w)(gg,e)?gg[e]:function(t){if(!Object(ke.w)(vm,t)){const n=Qh(t);vm[t]={draw:function(i,a){ep(i,n,0,0,Math.sqrt(a)/2)}}}return vm[t]}(e)}var vm={};const Gl=.448084975506;function Pv(e){return e.x}function vg(e){return e.y}function yg(e){return e.width}function y0(e){return e.height}function ll(e){return typeof e=="function"?e:()=>+e}function bg(e,t,n){return Math.max(t,Math.min(e,n))}function Lv(){var e=Pv,t=vg,n=yg,i=y0,a=ll(0),f=a,g=a,x=a,k=null;function F(V,X,te){var se,he=X??+e.call(this,V),ye=te??+t.call(this,V),Pe=+n.call(this,V),Ue=+i.call(this,V),We=Math.min(Pe,Ue)/2,at=bg(+a.call(this,V),0,We),st=bg(+f.call(this,V),0,We),lt=bg(+g.call(this,V),0,We),ct=bg(+x.call(this,V),0,We);if(k||(k=se=Ls()),at<=0&&st<=0&&lt<=0&&ct<=0)k.rect(he,ye,Pe,Ue);else{var Ct=he+Pe,Et=ye+Ue;k.moveTo(he+at,ye),k.lineTo(Ct-st,ye),k.bezierCurveTo(Ct-Gl*st,ye,Ct,ye+Gl*st,Ct,ye+st),k.lineTo(Ct,Et-ct),k.bezierCurveTo(Ct,Et-Gl*ct,Ct-Gl*ct,Et,Ct-ct,Et),k.lineTo(he+lt,Et),k.bezierCurveTo(he+Gl*lt,Et,he,Et-Gl*lt,he,Et-lt),k.lineTo(he,ye+at),k.bezierCurveTo(he,ye+Gl*at,he+Gl*at,ye,he+at,ye),k.closePath()}if(se)return k=null,se+""||null}return F.x=function(V){return arguments.length?(e=ll(V),F):e},F.y=function(V){return arguments.length?(t=ll(V),F):t},F.width=function(V){return arguments.length?(n=ll(V),F):n},F.height=function(V){return arguments.length?(i=ll(V),F):i},F.cornerRadius=function(V,X,te,se){return arguments.length?(a=ll(V),f=X!=null?ll(X):a,x=te!=null?ll(te):a,g=se!=null?ll(se):f,F):a},F.context=function(V){return arguments.length?(k=V??null,F):k},F}function ql(){var e,t,n,i,a,f,g,x,k=null;function F(X,te,se){const he=se/2;if(a){var ye=g-te,Pe=X-f;if(ye||Pe){var Ue=Math.sqrt(ye*ye+Pe*Pe),We=(ye/=Ue)*x,at=(Pe/=Ue)*x,st=Math.atan2(Pe,ye);k.moveTo(f-We,g-at),k.lineTo(X-ye*he,te-Pe*he),k.arc(X,te,he,st-Math.PI,st),k.lineTo(f+We,g+at),k.arc(f,g,x,st,st+Math.PI)}else k.arc(X,te,he,0,zc);k.closePath()}else a=1;f=X,g=te,x=he}function V(X){var te,se,he,ye=X.length,Pe=!1;for(k==null&&(k=he=Ls()),te=0;te<=ye;++te)!(te<ye&&i(se=X[te],te,X))===Pe&&(Pe=!Pe)&&(a=0),Pe&&F(+e(se,te,X),+t(se,te,X),+n(se,te,X));if(he)return k=null,he+""||null}return V.x=function(X){return arguments.length?(e=X,V):e},V.y=function(X){return arguments.length?(t=X,V):t},V.size=function(X){return arguments.length?(n=X,V):n},V.defined=function(X){return arguments.length?(i=X,V):i},V.context=function(X){return arguments.length?(k=X??null,V):k},V}function ym(e,t){return e??t}const Hd=e=>e.x||0,bm=e=>e.y||0,ps=e=>e.defined!==!1,xg=function(){var e=_f,t=Sd,n=mo(0),i=null,a=mr,f=ts,g=Ta,x=null;function k(){var F,V,X=+e.apply(this,arguments),te=+t.apply(this,arguments),se=a.apply(this,arguments)-fc,he=f.apply(this,arguments)-fc,ye=vf(he-se),Pe=he>se;if(x||(x=F=Ls()),te<X&&(V=te,te=X,X=V),te>Va)if(ye>bd-Va)x.moveTo(te*La(se),te*Rs(se)),x.arc(0,0,te,se,he,!Pe),X>Va&&(x.moveTo(X*La(he),X*Rs(he)),x.arc(0,0,X,he,se,Pe));else{var Ue,We,at=se,st=he,lt=se,ct=he,Ct=ye,Et=ye,gn=g.apply(this,arguments)/2,An=gn>Va&&(i?+i.apply(this,arguments):nl(X*X+te*te)),wn=qi(vf(te-X)/2,+n.apply(this,arguments)),$n=wn,qn=wn;if(An>Va){var er=xd(An/X*Rs(gn)),rr=xd(An/te*Rs(gn));(Ct-=2*er)>Va?(lt+=er*=Pe?1:-1,ct-=er):(Ct=0,lt=ct=(se+he)/2),(Et-=2*rr)>Va?(at+=rr*=Pe?1:-1,st-=rr):(Et=0,at=st=(se+he)/2)}var lr=te*La(at),Or=te*Rs(at),Jr=X*La(ct),Lr=X*Rs(ct);if(wn>Va){var li,Ai=te*La(st),Ti=te*Rs(st),Ji=X*La(lt),Ii=X*Rs(lt);if(ye<rl&&(li=function(Aa,es,Vs,Hs,Os,rf,lA,KN){var n2=Vs-Aa,d1=Hs-es,r2=lA-Os,wb=KN-rf,dh=wb*n2-r2*d1;if(!(dh*dh<Va))return[Aa+(dh=(r2*(es-rf)-wb*(Aa-Os))/dh)*n2,es+dh*d1]}(lr,Or,Ji,Ii,Ai,Ti,Jr,Lr))){var Mi=lr-li[0],ji=Or-li[1],Co=Ai-li[0],ca=Ti-li[1],Qi=1/Rs(function(Aa){return Aa>1?0:Aa<-1?rl:Math.acos(Aa)}((Mi*Co+ji*ca)/(nl(Mi*Mi+ji*ji)*nl(Co*Co+ca*ca)))/2),Ca=nl(li[0]*li[0]+li[1]*li[1]);$n=qi(wn,(X-Ca)/(Qi-1)),qn=qi(wn,(te-Ca)/(Qi+1))}}Et>Va?qn>Va?(Ue=no(Ji,Ii,lr,Or,te,qn,Pe),We=no(Ai,Ti,Jr,Lr,te,qn,Pe),x.moveTo(Ue.cx+Ue.x01,Ue.cy+Ue.y01),qn<wn?x.arc(Ue.cx,Ue.cy,qn,la(Ue.y01,Ue.x01),la(We.y01,We.x01),!Pe):(x.arc(Ue.cx,Ue.cy,qn,la(Ue.y01,Ue.x01),la(Ue.y11,Ue.x11),!Pe),x.arc(0,0,te,la(Ue.cy+Ue.y11,Ue.cx+Ue.x11),la(We.cy+We.y11,We.cx+We.x11),!Pe),x.arc(We.cx,We.cy,qn,la(We.y11,We.x11),la(We.y01,We.x01),!Pe))):(x.moveTo(lr,Or),x.arc(0,0,te,at,st,!Pe)):x.moveTo(lr,Or),X>Va&&Ct>Va?$n>Va?(Ue=no(Jr,Lr,Ai,Ti,X,-$n,Pe),We=no(lr,Or,Ji,Ii,X,-$n,Pe),x.lineTo(Ue.cx+Ue.x01,Ue.cy+Ue.y01),$n<wn?x.arc(Ue.cx,Ue.cy,$n,la(Ue.y01,Ue.x01),la(We.y01,We.x01),!Pe):(x.arc(Ue.cx,Ue.cy,$n,la(Ue.y01,Ue.x01),la(Ue.y11,Ue.x11),!Pe),x.arc(0,0,X,la(Ue.cy+Ue.y11,Ue.cx+Ue.x11),la(We.cy+We.y11,We.cx+We.x11),Pe),x.arc(We.cx,We.cy,$n,la(We.y11,We.x11),la(We.y01,We.x01),!Pe))):x.arc(0,0,X,ct,lt,Pe):x.lineTo(Jr,Lr)}else x.moveTo(0,0);if(x.closePath(),F)return x=null,F+""||null}return k.centroid=function(){var F=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,V=(+a.apply(this,arguments)+ +f.apply(this,arguments))/2-rl/2;return[La(V)*F,Rs(V)*F]},k.innerRadius=function(F){return arguments.length?(e=typeof F=="function"?F:mo(+F),k):e},k.outerRadius=function(F){return arguments.length?(t=typeof F=="function"?F:mo(+F),k):t},k.cornerRadius=function(F){return arguments.length?(n=typeof F=="function"?F:mo(+F),k):n},k.padRadius=function(F){return arguments.length?(i=F==null?null:typeof F=="function"?F:mo(+F),k):i},k.startAngle=function(F){return arguments.length?(a=typeof F=="function"?F:mo(+F),k):a},k.endAngle=function(F){return arguments.length?(f=typeof F=="function"?F:mo(+F),k):f},k.padAngle=function(F){return arguments.length?(g=typeof F=="function"?F:mo(+F),k):g},k.context=function(F){return arguments.length?(x=F??null,k):x},k}().startAngle(e=>e.startAngle||0).endAngle(e=>e.endAngle||0).padAngle(e=>e.padAngle||0).innerRadius(e=>e.innerRadius||0).outerRadius(e=>e.outerRadius||0).cornerRadius(e=>e.cornerRadius||0),b0=na().x(Hd).y1(bm).y0(e=>(e.y||0)+(e.height||0)).defined(ps),xm=na().y(bm).x1(Hd).x0(e=>(e.x||0)+(e.width||0)).defined(ps),wm=Ic().x(Hd).y(bm).defined(ps),x0=Lv().x(Hd).y(bm).width(e=>e.width||0).height(e=>e.height||0).cornerRadius(e=>ym(e.cornerRadiusTopLeft,e.cornerRadius)||0,e=>ym(e.cornerRadiusTopRight,e.cornerRadius)||0,e=>ym(e.cornerRadiusBottomRight,e.cornerRadius)||0,e=>ym(e.cornerRadiusBottomLeft,e.cornerRadius)||0),Bv=function(e,t){var n=null;function i(){var a;if(n||(n=a=Ls()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),a)return n=null,a+""||null}return e=typeof e=="function"?e:mo(e||hc),t=typeof t=="function"?t:mo(t===void 0?64:+t),i.type=function(a){return arguments.length?(e=typeof a=="function"?a:mo(a),i):e},i.size=function(a){return arguments.length?(t=typeof a=="function"?a:mo(+a),i):t},i.context=function(a){return arguments.length?(n=a??null,i):n},i}().type(e=>Lf(e.shape||"circle")).size(e=>ym(e.size,64)),Ny=ql().x(Hd).y(bm).defined(ps).size(e=>e.size||1);function fl(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function Gd(e,t,n,i){return x0.context(e)(t,n,i)}var Iy=1;function jv(){Iy=1}function dl(e,t,n){var i=t.clip,a=e._defs,f=t.clip_id||(t.clip_id="clip"+Iy++),g=a.clipping[f]||(a.clipping[f]={id:f});return Object(ke.E)(i)?g.path=i(null):fl(n)?g.path=Gd(null,n,0,0):(g.width=n.width||0,g.height=n.height||0),"url(#"+f+")"}function rs(e){this.clear(),e&&this.union(e)}function tp(e){this.mark=e,this.bounds=this.bounds||new rs}function _m(e){tp.call(this,e),this.items=this.items||[]}function wg(e){this._pending=0,this._loader=e||Object(ar.e)()}function zv(e){e._pending+=1}function _g(e){e._pending-=1}function Bf(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){const i=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(i+(n?function(a,f){return a.strokeJoin&&a.strokeJoin!=="miter"?0:f}(t,i):0))}return e}rs.prototype={clone(){return new rs(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,i){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),i<t?(this.y2=t,this.y1=i):(this.y1=t,this.y2=i),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const i=this.rotatedPoints(e,t,n);return this.clear().add(i[0],i[1]).add(i[2],i[3]).add(i[4],i[5]).add(i[6],i[7])},rotatedPoints(e,t,n){var{x1:i,y1:a,x2:f,y2:g}=this,x=Math.cos(e),k=Math.sin(e),F=t-t*x+n*k,V=n-t*k-n*x;return[x*i-k*a+F,k*i+x*a+V,x*i-k*g+F,k*i+x*g+V,x*f-k*a+F,k*f+x*a+V,x*f-k*g+F,k*f+x*g+V]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},Object(ke.z)(_m,tp),wg.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return zv(t),t._loader.sanitize(e,{context:"href"}).then(n=>(_g(t),n)).catch(()=>(_g(t),null))},loadImage(e){const t=this,n=vo();return zv(t),t._loader.sanitize(e,{context:"image"}).then(i=>{const a=i.href;if(!a||!n)throw{url:a};const f=new n,g=Object(ke.w)(i,"crossOrigin")?i.crossOrigin:"anonymous";return g!=null&&(f.crossOrigin=g),f.onload=()=>_g(t),f.onerror=()=>_g(t),f.src=a,f}).catch(i=>(_g(t),{complete:!1,width:0,height:0,src:i&&i.url||""}))},ready(){const e=this;return new Promise(t=>{(function n(i){e.pending()?setTimeout(()=>{n(!0)},10):t(i)})(!1)})}};const R1=zc-1e-8;let Eg,Ja,Em,qd,Sg,Sm,w0,_0;const jf=(e,t)=>Eg.add(e,t),gc=(e,t)=>jf(Ja=e,Em=t),Uv=e=>jf(e,Eg.y1),Wv=e=>jf(Eg.x1,e),np=(e,t)=>Sg*e+w0*t,km=(e,t)=>Sm*e+_0*t,Fy=(e,t)=>jf(np(e,t),km(e,t)),E0=(e,t)=>gc(np(e,t),km(e,t));function kg(e,t){return Eg=e,t?(qd=t*Pf,Sg=_0=Math.cos(qd),Sm=Math.sin(qd),w0=-Sm):(Sg=_0=1,qd=Sm=w0=0),$r}const $r={beginPath(){},closePath(){},moveTo:E0,lineTo:E0,rect(e,t,n,i){qd?(Fy(e+n,t),Fy(e+n,t+i),Fy(e,t+i),E0(e,t)):(jf(e+n,t+i),gc(e,t))},quadraticCurveTo(e,t,n,i){const a=np(e,t),f=km(e,t),g=np(n,i),x=km(n,i);$(Ja,a,g,Uv),$(Em,f,x,Wv),gc(g,x)},bezierCurveTo(e,t,n,i,a,f){const g=np(e,t),x=km(e,t),k=np(n,i),F=km(n,i),V=np(a,f),X=km(a,f);M(Ja,g,k,V,Uv),M(Em,x,F,X,Wv),gc(V,X)},arc(e,t,n,i,a,f){if(i+=qd,a+=qd,Ja=n*Math.cos(a)+e,Em=n*Math.sin(a)+t,Math.abs(a-i)>R1)jf(e-n,t-n),jf(e+n,t+n);else{const g=F=>jf(n*Math.cos(F)+e,n*Math.sin(F)+t);let x,k;if(g(i),g(a),a!==i)if((i%=zc)<0&&(i+=zc),(a%=zc)<0&&(a+=zc),a<i&&(f=!f,x=i,i=a,a=x),f)for(a-=zc,x=i-i%Vd,k=0;k<4&&x>a;++k,x-=Vd)g(x);else for(x=i-i%Vd+Vd,k=0;k<4&&x<a;++k,x+=Vd)g(x)}}};function $(e,t,n,i){const a=(e-t)/(e+n-2*t);0<a&&a<1&&i(e+(t-e)*a)}function M(e,t,n,i,a){const f=i-e+3*t-3*n,g=e+n-2*t,x=e-t;let k,F=0,V=0;Math.abs(f)>Nv?(k=g*g+x*f)>=0&&(F=(-g+(k=Math.sqrt(k)))/f,V=(-g-k)/f):F=.5*x/g,0<F&&F<1&&a(T(F,e,t,n,i)),0<V&&V<1&&a(T(V,e,t,n,i))}function T(e,t,n,i,a){const f=1-e,g=f*f,x=e*e;return g*f*t+3*g*e*n+3*f*x*i+x*e*a}var A=(A=su(1,1))?A.getContext("2d"):null;const P=new rs;function J(e){return function(t,n){if(!A)return!0;e(A,t),P.clear().union(t.bounds).intersect(n).round();const{x1:i,y1:a,x2:f,y2:g}=P;for(let x=a;x<=g;++x)for(let k=i;k<=f;++k)if(A.isPointInPath(k,x))return!0;return!1}}function ie(e,t){return t.contains(e.x||0,e.y||0)}function pe(e,t){const n=e.x||0,i=e.y||0,a=e.width||0,f=e.height||0;return t.intersects(P.set(n,i,n+a,i+f))}function Ae(e,t){const n=e.x||0,i=e.y||0;return Ie(t,n,i,e.x2!=null?e.x2:n,e.y2!=null?e.y2:i)}function Ie(e,t,n,i,a){const{x1:f,y1:g,x2:x,y2:k}=e,F=i-t,V=a-n;let X,te,se,he,ye=0,Pe=1;for(he=0;he<4;++he){if(he===0&&(X=-F,te=-(f-t)),he===1&&(X=F,te=x-t),he===2&&(X=-V,te=-(g-n)),he===3&&(X=V,te=k-n),Math.abs(X)<1e-10&&te<0)return!1;if(se=te/X,X<0){if(se>Pe)return!1;se>ye&&(ye=se)}else if(X>0){if(se<ye)return!1;se<Pe&&(Pe=se)}}return!0}function De(e,t){e.globalCompositeOperation=t.blend||"source-over"}function et(e,t){return e??t}function ot(e,t){const n=t.length;for(let i=0;i<n;++i)e.addColorStop(t[i].offset,t[i].color);return e}function Bt(e,t,n){return pg(n)?function(i,a,f){const g=f.width(),x=f.height();let k;if(a.gradient==="radial")k=i.createRadialGradient(f.x1+et(a.x1,.5)*g,f.y1+et(a.y1,.5)*x,Math.max(g,x)*et(a.r1,0),f.x1+et(a.x2,.5)*g,f.y1+et(a.y2,.5)*x,Math.max(g,x)*et(a.r2,.5));else{const F=et(a.x1,0),V=et(a.y1,0),X=et(a.x2,1),te=et(a.y2,0);if(F!==X&&V!==te&&g!==x){const se=su(Math.ceil(g),Math.ceil(x)),he=se.getContext("2d");return he.scale(g,x),he.fillStyle=ot(he.createLinearGradient(F,V,X,te),a.stops),he.fillRect(0,0,g,x),i.createPattern(se,"no-repeat")}k=i.createLinearGradient(f.x1+F*g,f.y1+V*x,f.x1+X*g,f.y1+te*x)}return ot(k,a.stops)}(e,n,t.bounds):n}function Vt(e,t,n){return(n*=t.fillOpacity==null?1:t.fillOpacity)>0&&(e.globalAlpha=n,e.fillStyle=Bt(e,t,t.fill),!0)}var yn=[];function _n(e,t,n){var i=(i=t.strokeWidth)!=null?i:1;return!(i<=0)&&(n*=t.strokeOpacity==null?1:t.strokeOpacity)>0&&(e.globalAlpha=n,e.strokeStyle=Bt(e,t,t.stroke),e.lineWidth=i,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||yn),e.lineDashOffset=t.strokeDashOffset||0),!0)}function Dn(e,t){return e.zindex-t.zindex||e.index-t.index}function Nn(e){if(!e.zdirty)return e.zitems;var t,n,i,a=e.items,f=[];for(n=0,i=a.length;n<i;++n)(t=a[n]).index=n,t.zindex&&f.push(t);return e.zdirty=!1,e.zitems=f.sort(Dn)}function Wn(e,t){var n,i,a=e.items;if(!a||!a.length)return;const f=Nn(e);if(f&&f.length){for(n=0,i=a.length;n<i;++n)a[n].zindex||t(a[n]);a=f}for(n=0,i=a.length;n<i;++n)t(a[n])}function Jn(e,t){var n,i,a=e.items;if(!a||!a.length)return null;const f=Nn(e);for(f&&f.length&&(a=f),i=a.length;--i>=0;)if(n=t(a[i]))return n;if(a===f){for(i=(a=e.items).length;--i>=0;)if(!a[i].zindex&&(n=t(a[i])))return n}return null}function Cn(e){return function(t,n,i){Wn(n,a=>{i&&!i.intersects(a.bounds)||wr(e,t,a,a)})}}function wr(e,t,n,i){var a=n.opacity==null?1:n.opacity;a!==0&&(e(t,i)||(De(t,n),n.fill&&Vt(t,n,a)&&t.fill(),n.stroke&&_n(t,n,a)&&t.stroke()))}function Dr(e){return e=e||ke.Ia,function(t,n,i,a,f,g){return i*=t.pixelRatio,a*=t.pixelRatio,Jn(n,x=>{const k=x.bounds;if((!k||k.contains(f,g))&&k)return e(t,x,i,a,f,g)?x:void 0})}}function Nr(e,t){return function(n,i,a,f){var g,x,k=Array.isArray(i)?i[0]:i,F=t??k.fill,V=k.stroke&&n.isPointInStroke;return V&&(g=k.strokeWidth,x=k.strokeCap,n.lineWidth=g??1,n.lineCap=x??"butt"),!e(n,i)&&(F&&n.isPointInPath(a,f)||V&&n.isPointInStroke(a,f))}}function Yr(e){return Dr(Nr(e))}function jr(e,t){return"translate("+e+","+t+")"}function Si(e){return"rotate("+e+")"}function Fi(e){return jr(e.x||0,e.y||0)}function Ni(e,t,n){function i(a,f){var g=f.x||0,x=f.y||0,k=f.angle||0;a.translate(g,x),k&&a.rotate(k*=Pf),a.beginPath(),t(a,f),k&&a.rotate(-k),a.translate(-g,-x)}return{type:e,tag:"path",nested:!1,attr:function(a,f){a("transform",function(g){return jr(g.x||0,g.y||0)+(g.angle?" "+Si(g.angle):"")}(f)),a("d",t(null,f))},bound:function(a,f){return t(kg(a,f.angle),f),Bf(a,f).translate(f.x||0,f.y||0)},draw:Cn(i),pick:Yr(i),isect:n||J(i)}}var Ao=Ni("arc",function(e,t){return xg.context(e)(t)});function Xo(e,t,n){function i(f,g){f.beginPath(),t(f,g)}const a=Nr(i);return{type:e,tag:"path",nested:!0,attr:function(f,g){var x=g.mark.items;x.length&&f("d",t(null,x))},bound:function(f,g){var x=g.items;return x.length===0?f:(t(kg(f),x),Bf(f,x[0]))},draw:function(f){return function(g,x,k){!x.items.length||k&&!k.intersects(x.bounds)||wr(f,g,x.items[0],x.items)}}(i),pick:function(f,g,x,k,F,V){var X=g.items,te=g.bounds;return!X||!X.length||te&&!te.contains(F,V)?null:(x*=f.pixelRatio,k*=f.pixelRatio,a(f,X,x,k)?X[0]:null)},isect:ie,tip:n}}var Po=Xo("area",function(e,t){const n=t[0],i=n.interpolate||"linear";return(n.orient==="horizontal"?xm:b0).curve(Rf(i,n.orient,n.tension)).context(e)(t)},function(e,t){for(var n,i,a=e[0].orient==="horizontal"?t[1]:t[0],f=e[0].orient==="horizontal"?"y":"x",g=e.length,x=1/0;--g>=0;)e[g].defined!==!1&&(i=Math.abs(e[g][f]-a))<x&&(x=i,n=e[g]);return n});function Ro(e,t){e.beginPath(),fl(t)?Gd(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function Uo(e){const t=et(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function sa(e,t){const n=Uo(t);e("d",Gd(null,t,n,n))}function pa(e,t,n,i){const a=Uo(t);e.beginPath(),Gd(e,t,(n||0)+a,(i||0)+a)}const Da=Nr(pa),du=Nr(pa,!1),Ri=Nr(pa,!0);var Qa={type:"group",tag:"g",nested:!1,attr:function(e,t){e("transform",Fi(t))},bound:function(e,t){if(!t.clip&&t.items){const n=t.items,i=n.length;for(let a=0;a<i;++a)e.union(n[a].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),Bf(e,t),e.translate(t.x||0,t.y||0)},draw:function(e,t,n){Wn(t,i=>{const a=i.x||0,f=i.y||0,g=i.strokeForeground,x=i.opacity==null?1:i.opacity;(i.stroke||i.fill)&&x&&(pa(e,i,a,f),De(e,i),i.fill&&Vt(e,i,x)&&e.fill(),i.stroke&&!g&&_n(e,i,x)&&e.stroke()),e.save(),e.translate(a,f),i.clip&&Ro(e,i),n&&n.translate(-a,-f),Wn(i,k=>{this.draw(e,k,n)}),n&&n.translate(a,f),e.restore(),g&&i.stroke&&x&&(pa(e,i,a,f),De(e,i),_n(e,i,x)&&e.stroke())})},pick:function(e,t,n,i,a,f){if(t.bounds&&!t.bounds.contains(a,f)||!t.items)return null;const g=n*e.pixelRatio,x=i*e.pixelRatio;return Jn(t,k=>{let F,V,X;const te=k.bounds;if(te&&!te.contains(a,f))return;V=k.x||0,X=k.y||0;const se=V+(k.width||0),he=X+(k.height||0),ye=k.clip;if(ye&&(a<V||a>se||f<X||f>he))return;if(e.save(),e.translate(V,X),V=a-V,X=f-X,ye&&fl(k)&&!Ri(e,k,g,x))return e.restore(),null;const Pe=k.strokeForeground,Ue=t.interactive!==!1;return Ue&&Pe&&k.stroke&&du(e,k,g,x)?(e.restore(),k):(!(F=Jn(k,We=>function(at,st,lt){return(at.interactive!==!1||at.marktype==="group")&&at.bounds&&at.bounds.contains(st,lt)}(We,V,X)?this.pick(We,n,i,V,X):null))&&Ue&&(k.fill||!Pe&&k.stroke)&&Da(e,k,g,x)&&(F=k),e.restore(),F||null)})},isect:pe,content:function(e,t,n){e("clip-path",t.clip?dl(n,t,t):null)},background:function(e,t){e("class","background"),e("aria-hidden",!0),sa(e,t)},foreground:function(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?sa(e,t):e("d","")}},is={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function hu(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(i=>{e.image=i,e.image.url=e.url})),n}function zs(e,t){return e.width!=null?e.width:t&&t.width?e.aspect!==!1&&e.height?e.height*t.width/t.height:t.width:0}function Iu(e,t){return e.height!=null?e.height:t&&t.height?e.aspect!==!1&&e.width?e.width*t.height/t.width:t.height:0}function Fu(e,t){return e==="center"?t/2:e==="right"?t:0}function Ru(e,t){return e==="middle"?t/2:e==="bottom"?t:0}var rp={type:"image",tag:"image",nested:!1,attr:function(e,t,n){const i=hu(t,n),a=zs(t,i),f=Iu(t,i),g=(t.x||0)-Fu(t.align,a),x=(t.y||0)-Ru(t.baseline,f);e("href",!i.src&&i.toDataURL?i.toDataURL():i.src||"",is["xmlns:xlink"],"xlink:href"),e("transform",jr(g,x)),e("width",a),e("height",f),e("preserveAspectRatio",t.aspect===!1?"none":"xMidYMid")},bound:function(e,t){const n=t.image,i=zs(t,n),a=Iu(t,n),f=(t.x||0)-Fu(t.align,i),g=(t.y||0)-Ru(t.baseline,a);return e.set(f,g,f+i,g+a)},draw:function(e,t,n){Wn(t,i=>{if(n&&!n.intersects(i.bounds))return;const a=hu(i,this);let f=zs(i,a),g=Iu(i,a);if(f===0||g===0)return;let x,k,F,V,X=(i.x||0)-Fu(i.align,f),te=(i.y||0)-Ru(i.baseline,g);i.aspect!==!1&&(k=a.width/a.height,F=i.width/i.height,k==k&&F==F&&k!==F&&(F<k?(te+=(g-(V=f/k))/2,g=V):(X+=(f-(V=g*k))/2,f=V))),(a.complete||a.toDataURL)&&(De(e,i),e.globalAlpha=(x=i.opacity)!=null?x:1,e.imageSmoothingEnabled=i.smooth!==!1,e.drawImage(a,X,te,f,g))})},pick:Dr(),isect:ke.Ia,get:hu,xOffset:Fu,yOffset:Ru},$d=Xo("line",function(e,t){const n=t[0],i=n.interpolate||"linear";return wm.curve(Rf(i,n.orient,n.tension)).context(e)(t)},function(e,t){for(var n,i,a=Math.pow(e[0].strokeWidth||1,2),f=e.length;--f>=0;)if(e[f].defined!==!1&&(n=e[f].x-t[0])*n+(i=e[f].y-t[1])*i<a)return e[f];return null});function $l(e,t){var n=t.path;if(n==null)return!0;var i=t.x||0,a=t.y||0,f=t.scaleX||1,g=t.scaleY||1,x=(t.angle||0)*Pf,k=t.pathCache;k&&k.path===n||((t.pathCache=k=Qh(n)).path=n),x&&e.rotate&&e.translate?(e.translate(i,a),e.rotate(x),ep(e,k,0,0,f,g),e.rotate(-x),e.translate(-i,-a)):ep(e,k,i,a,f,g)}var zf={type:"path",tag:"path",nested:!1,attr:function(e,t){var n=t.scaleX||1,i=t.scaleY||1;n===1&&i===1||e("vector-effect","non-scaling-stroke"),e("transform",function(a){return jr(a.x||0,a.y||0)+(a.angle?" "+Si(a.angle):"")+(a.scaleX||a.scaleY?" "+function(f,g){return"scale("+f+","+g+")"}(a.scaleX||1,a.scaleY||1):"")}(t)),e("d",t.path)},bound:function(e,t){return $l(kg(e,t.angle),t)?e.set(0,0,0,0):Bf(e,t,!0)},draw:Cn($l),pick:Yr($l),isect:J($l)};function Xl(e,t){e.beginPath(),Gd(e,t)}var vc={type:"rect",tag:"path",nested:!1,attr:function(e,t){e("d",Gd(null,t))},bound:function(e,t){var n,i;return Bf(e.set(n=t.x||0,i=t.y||0,n+t.width||0,i+t.height||0),t)},draw:Cn(Xl),pick:Yr(Xl),isect:pe};function qa(e,t,n){var i,a,f,g;return!(!t.stroke||!_n(e,t,n))&&(i=t.x||0,a=t.y||0,f=t.x2!=null?t.x2:i,g=t.y2!=null?t.y2:a,e.beginPath(),e.moveTo(i,a),e.lineTo(f,g),!0)}var Uf={type:"rule",tag:"line",nested:!1,attr:function(e,t){e("transform",Fi(t)),e("x2",t.x2!=null?t.x2-(t.x||0):0),e("y2",t.y2!=null?t.y2-(t.y||0):0)},bound:function(e,t){var n,i;return Bf(e.set(n=t.x||0,i=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:i),t)},draw:function(e,t,n){Wn(t,i=>{if(!n||n.intersects(i.bounds)){var a=i.opacity==null?1:i.opacity;a&&qa(e,i,a)&&(De(e,i),e.stroke())}})},pick:Dr(function(e,t,n,i){return!!e.isPointInStroke&&qa(e,t,1)&&e.isPointInStroke(n,i)}),isect:Ae},Xd=Ni("shape",function(e,t){return(t.mark.shape||t.shape).context(e)(t)}),ip=Ni("symbol",function(e,t){return Bv.context(e)(t)},ie);const Wf=Object(ke.N)();var ks={height:yc,measureWidth:hl,estimateWidth:op,width:op,canvas:Kd};function Kd(e){ks.width=e&&A?hl:op}function op(e,t){return ap(Kl(e,t),yc(e))}function ap(e,t){return~~(.8*e.length*t)}function hl(e,t){return yc(e)<=0||!(t=Kl(e,t))?0:Cm(t,sp(e))}function Cm(e,t){const n=`(${t}) ${e}`;let i=Wf.get(n);return i===void 0&&(A.font=t,i=A.measureText(e).width,Wf.set(n,i)),i}function yc(e){return e.fontSize!=null?+e.fontSize||0:11}function Us(e){return e.lineHeight!=null?e.lineHeight:yc(e)+2}function tc(e){return function(t){return Object(ke.B)(t)?t.length>1?t:t[0]:t}(e.lineBreak&&e.text&&!Object(ke.B)(e.text)?e.text.split(e.lineBreak):e.text)}function Cs(e){const t=tc(e);return(Object(ke.B)(t)?t.length-1:0)*Us(e)}function Kl(e,t){const n=t==null?"":(t+"").trim();return e.limit>0&&n.length?function(i,a){var f=+i.limit,g=function(te){if(ks.width===hl){const se=sp(te);return he=>Cm(he,se)}{const se=yc(te);return he=>ap(he,se)}}(i);if(g(a)<f)return a;var x,k=i.ellipsis||"",F=i.dir==="rtl",V=0,X=a.length;if(f-=g(k),F){for(;V<X;)x=V+X>>>1,g(a.slice(x))>f?V=x+1:X=x;return k+a.slice(V)}for(;V<X;)x=1+(V+X>>>1),g(a.slice(0,x))<f?V=x:X=x-1;return a.slice(0,V)+k}(e,n):n}function Yd(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function sp(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+yc(e)+"px "+Yd(e,t)}function Jd(e){var t=e.baseline,n=yc(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*Us(e):t==="line-bottom"?.29*n-.5*Us(e):0)}Kd(!0);const Am={left:"start",center:"middle",right:"end"},Yl=new rs;function Eu(e){var t,n=e.x||0,i=e.y||0,a=e.radius||0;return a&&(t=(e.theta||0)-Vd,n+=a*Math.cos(t),i+=a*Math.sin(t)),Yl.x1=n,Yl.y1=i,Yl}function P1(e,t,n){var i,a=ks.height(t),f=t.align,g=Eu(t),x=g.x1,k=g.y1,F=t.dx||0,V=(t.dy||0)+Jd(t)-Math.round(.8*a),X=tc(t);if(Object(ke.B)(X)?(a+=Us(t)*(X.length-1),i=X.reduce((te,se)=>Math.max(te,ks.width(t,se)),0)):i=ks.width(t,X),f==="center"?F-=i/2:f==="right"&&(F-=i),e.set(F+=x,V+=k,F+i,V+a),t.angle&&!n)e.rotate(t.angle*Pf,x,k);else if(n===2)return e.rotatedPoints(t.angle*Pf,x,k);return e}var Jl={arc:Ao,area:Po,group:Qa,image:rp,line:$d,path:zf,rect:vc,rule:Uf,shape:Xd,symbol:ip,text:{type:"text",tag:"text",nested:!1,attr:function(e,t){var n,i=t.dx||0,a=(t.dy||0)+Jd(t),f=Eu(t),g=f.x1,x=f.y1,k=t.angle||0;e("text-anchor",Am[t.align]||"start"),k?(n=jr(g,x)+" "+Si(k),(i||a)&&(n+=" "+jr(i,a))):n=jr(g+i,x+a),e("transform",n)},bound:P1,draw:function(e,t,n){Wn(t,i=>{var a,f,g,x,k,F,V,X=i.opacity==null?1:i.opacity;if(!(n&&!n.intersects(i.bounds)||X===0||i.fontSize<=0||i.text==null||i.text.length===0)){if(e.font=sp(i),e.textAlign=i.align||"left",f=(a=Eu(i)).x1,g=a.y1,i.angle&&(e.save(),e.translate(f,g),e.rotate(i.angle*Pf),f=g=0),f+=i.dx||0,g+=(i.dy||0)+Jd(i),F=tc(i),De(e,i),Object(ke.B)(F))for(k=Us(i),x=0;x<F.length;++x)V=Kl(i,F[x]),i.fill&&Vt(e,i,X)&&e.fillText(V,f,g),i.stroke&&_n(e,i,X)&&e.strokeText(V,f,g),g+=k;else V=Kl(i,F),i.fill&&Vt(e,i,X)&&e.fillText(V,f,g),i.stroke&&_n(e,i,X)&&e.strokeText(V,f,g);i.angle&&e.restore()}})},pick:Dr(function(e,t,n,i,a,f){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var g=Eu(t),x=g.x1,k=g.y1,F=P1(Yl,t,1),V=-t.angle*Pf,X=Math.cos(V),te=Math.sin(V),se=X*a-te*f+(x-X*x+te*k),he=te*a+X*f+(k-te*x-X*k);return F.contains(se,he)}),isect:function(e,t){const n=P1(Yl,e,2);return Ie(t,n[0],n[1],n[2],n[3])||Ie(t,n[0],n[1],n[4],n[5])||Ie(t,n[4],n[5],n[6],n[7])||Ie(t,n[2],n[3],n[6],n[7])}},trail:Xo("trail",function(e,t){return Ny.context(e)(t)},function(e,t){for(var n,i,a=e.length;--a>=0;)if(e[a].defined!==!1&&(n=e[a].x-t[0])*n+(i=e[a].y-t[1])*i<(n=e[a].size||1)*n)return e[a];return null})};function up(e,t,n){var i=Jl[e.mark.marktype],a=t||i.bound;return i.nested&&(e=e.mark),a(e.bounds||(e.bounds=new rs),e,n)}var L1={mark:null};function B1(e,t,n){var i,a,f,g,x=Jl[e.marktype],k=x.bound,F=e.items,V=F&&F.length;if(x.nested)return V?f=F[0]:(L1.mark=e,f=L1),g=up(f,k,n),t=t&&t.union(g)||g;if(t=t||e.bounds&&e.bounds.clear()||new rs,V)for(i=0,a=F.length;i<a;++i)t.union(up(F[i],k,n));return e.bounds=t}const j1=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function Vv(e,t){return JSON.stringify(e,j1,t)}function Ry(e){return function t(n){var i,a,f,g=n.marktype,x=n.items;if(x)for(a=0,f=x.length;a<f;++a)i=g?"mark":"group",x[a][i]=n,x[a].zindex&&(x[a][i].zdirty=!0),(g||i)==="group"&&t(x[a]);return g&&B1(n),n}(typeof e=="string"?JSON.parse(e):e)}function Hv(e){arguments.length?this.root=Ry(e):(this.root=Py({marktype:"group",name:"root",role:"frame"}),this.root.items=[new _m(this.root)])}function Py(e,t){const n={bounds:new rs,clip:!!e.clip,group:t,interactive:e.interactive!==!1,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return e.aria!=null&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function Uc(e,t,n){return!e&&typeof document<"u"&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function z1(e,t){t=t.toLowerCase();for(var n=e.childNodes,i=0,a=n.length;i<a;++i)if(n[i].tagName.toLowerCase()===t)return n[i]}function bc(e,t,n,i){var a,f=e.childNodes[t];return f&&f.tagName.toLowerCase()===n.toLowerCase()||(a=f||null,f=Uc(e.ownerDocument,n,i),e.insertBefore(f,a)),f}function Vf(e,t){for(var n=e.childNodes,i=n.length;i>t;)e.removeChild(n[--i]);return e}function _(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function v(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function d(e,t){this._active=null,this._handlers={},this._loader=e||Object(ar.e)(),this._tooltip=t||y}function y(e,t,n,i){e.element().setAttribute("title",i||"")}function E(e){this._el=null,this._bgcolor=null,this._loader=new wg(e)}Hv.prototype={toJSON(e){return Vv(this.root,e||0)},mark(e,t,n){const i=Py(e,t=t||this.root.items[0]);return t.items[n]=i,i.zindex&&(i.group.zdirty=!0),i}},d.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let i=e?e.length:0;--i>=0;)if(e[i].type===t&&(!n||e[i].handler===n))return i;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const i in t)n.push(...t[i]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then(i=>{const a=new MouseEvent(e.type,e),f=Uc(null,"a");for(const g in i)f.setAttribute(g,i[g]);f.dispatchEvent(a)}).catch(()=>{})},handleTooltip(e,t,n){if(t&&t.tooltip!=null){t=function(a,f,g,x){var k,F,V=a&&a.mark;if(V&&(k=Jl[V.marktype]).tip){for((F=v(f,g))[0]-=x[0],F[1]-=x[1];a=a.mark.group;)F[0]-=a.x||0,F[1]-=a.y||0;a=k.tip(V.items,F)}return a}(t,e,this.canvas(),this._origin);const i=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,i)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),i=this._origin,a=e.bounds,f=a.width(),g=a.height();let x=a.x1+i[0]+n.left,k=a.y1+i[1]+n.top;for(;e.mark&&(e=e.mark.group);)x+=e.x||0,k+=e.y||0;return{x,y:k,width:f,height:g,left:x,top:k,right:x+f,bottom:k+g}}},E.prototype={initialize(e,t,n,i,a){return this._el=e,this.resize(t,n,i,a)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return arguments.length===0?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,i){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=i||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then(()=>t):Promise.resolve(t)},_load(e,t){var n=this,i=n._loader[e](t);if(!n._ready){const a=n._call;n._ready=n._loader.ready().then(f=>{f&&a(),n._ready=null})}return i},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const B="dragleave",Q="mousedown",re="mousemove",fe="mouseout",xe="click",Oe=["keydown","keypress","keyup","dragenter",B,"dragover",Q,"mouseup",re,fe,"mouseover",xe,"dblclick","wheel","mousewheel","touchstart","touchmove","touchend"],Re=re,Le=fe,Be=xe;function Xe(e,t){d.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}const nt=e=>e==="touchstart"||e==="touchmove"||e==="touchend"?["touchstart","touchmove","touchend"]:[e];function tt(e,t){nt(t).forEach(n=>function(i,a){const f=i.canvas();f&&!i._events[a]&&(i._events[a]=1,f.addEventListener(a,i[a]?g=>i[a](g):g=>i.fire(a,g)))}(e,n))}function ut(e,t,n){return function(i){const a=this._active,f=this.pickEvent(i);f===a?this.fire(e,i):(a&&a.exit||this.fire(n,i),this._active=f,this.fire(t,i),this.fire(e,i))}}function Dt(e){return function(t){this.fire(e,t),this._active=null}}Object(ke.z)(Xe,d,{initialize(e,t,n){return this._canvas=e&&z1(e,"canvas"),[xe,Q,re,fe,B].forEach(i=>tt(this,i)),d.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:Oe,DOMMouseScroll(e){this.fire("mousewheel",e)},mousemove:ut(re,"mouseover",fe),dragover:ut("dragover","dragenter",B),mouseout:Dt(fe),dragleave:Dt(B),mousedown(e){this._down=this._active,this.fire(Q,e)},click(e){this._down===this._active&&(this.fire(xe,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire("touchstart",e,!0)},touchmove(e){this.fire("touchmove",e,!0)},touchend(e){this.fire("touchend",e,!0),this._touch=null},fire(e,t,n){const i=n?this._touch:this._active,a=this._handlers[e];if(t.vegaType=e,e===Be&&i&&i.href?this.handleHref(t,i,i.href):e!==Re&&e!==Le||this.handleTooltip(t,i,e!==Le),a)for(let f=0,g=a.length;f<g;++f)a[f].handler.call(this._obj,t,i)},on(e,t){const n=this.eventName(e),i=this._handlers;return this._handlerIndex(i[n],e,t)<0&&(tt(this,e),(i[n]||(i[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),i=this._handlers[n],a=this._handlerIndex(i,e,t);return a>=0&&i.splice(a,1),this},pickEvent(e){const t=v(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,i,a){const f=this.context();return Jl[e.marktype].pick.call(this,f,e,t,n,i,a)}});var Rt=typeof window<"u"&&window.devicePixelRatio||1;function Lt(e){E.call(this,e),this._options={},this._redraw=!1,this._dirty=new rs,this._tempb=new rs}const qt=E.prototype;function pn(e,t){d.call(this,e,t);const n=this;n._hrefHandler=bn(n,(i,a)=>{a&&a.href&&n.handleHref(i,a,a.href)}),n._tooltipHandler=bn(n,(i,a)=>{n.handleTooltip(i,a,i.type!==Le)})}Object(ke.z)(Lt,E,{initialize(e,t,n,i,a,f){return this._options=f||{},this._canvas=this._options.externalContext?null:su(1,1,this._options.type),e&&this._canvas&&(Vf(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),qt.initialize.call(this,e,t,n,i,a)},resize(e,t,n,i){if(qt.resize.call(this,e,t,n,i),this._canvas)(function(a,f,g,x,k,F){const V=typeof HTMLElement<"u"&&a instanceof HTMLElement&&a.parentNode!=null,X=a.getContext("2d"),te=V?Rt:k;a.width=f*te,a.height=g*te;for(const se in F)X[se]=F[se];V&&te!==1&&(a.style.width=f+"px",a.style.height=g+"px"),X.pixelRatio=te,X.setTransform(te,0,0,te,te*x[0],te*x[1])})(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const a=this._options.externalContext;a||Object(ke.o)("CanvasRenderer is missing a valid canvas or context"),a.scale(this._scale,this._scale),a.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,i=this._width,a=this._height,f=this._dirty,g=((k,F,V)=>new rs().set(0,0,F,V).translate(-k[0],-k[1]))(n,i,a);t.save();const x=this._redraw||f.empty()?(this._redraw=!1,g.expand(1)):function(k,F,V){return F.expand(1).round(),k.pixelRatio%1&&F.scale(k.pixelRatio).round().scale(1/k.pixelRatio),F.translate(-V[0]%1,-V[1]%1),k.beginPath(),k.rect(F.x1,F.y1,F.width(),F.height()),k.clip(),F}(t,g.intersect(f),n);return this.clear(-n[0],-n[1],i,a),this.draw(t,e,x),t.restore(),f.clear(),this},draw(e,t,n){const i=Jl[t.marktype];t.clip&&function(a,f){var g=f.clip;a.save(),Object(ke.E)(g)?(a.beginPath(),g(a),a.clip()):Ro(a,f.group)}(e,t),i.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,i){const a=this._options,f=this.context();a.type==="pdf"||a.externalContext||f.clearRect(e,t,n,i),this._bgcolor!=null&&(f.fillStyle=this._bgcolor,f.fillRect(e,t,n,i))}});const bn=(e,t)=>n=>{let i=n.target.__data__;i=Array.isArray(i)?i[0]:i,n.vegaType=n.type,t.call(e._obj,n,i)};Object(ke.z)(pn,d,{initialize(e,t,n){let i=this._svg;return i&&(i.removeEventListener(Be,this._hrefHandler),i.removeEventListener(Re,this._tooltipHandler),i.removeEventListener(Le,this._tooltipHandler)),this._svg=i=e&&z1(e,"svg"),i&&(i.addEventListener(Be,this._hrefHandler),i.addEventListener(Re,this._tooltipHandler),i.addEventListener(Le,this._tooltipHandler)),d.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),i=this._handlers;if(this._handlerIndex(i[n],e,t)<0){const a={type:e,handler:t,listener:bn(this,t)};(i[n]||(i[n]=[])).push(a),this._svg&&this._svg.addEventListener(n,a.listener)}return this},off(e,t){const n=this.eventName(e),i=this._handlers[n],a=this._handlerIndex(i,e,t);return a>=0&&(this._svg&&this._svg.removeEventListener(n,i[a].listener),i.splice(a,1)),this}});const mn="aria-hidden",Sn="aria-label",On="role",b="aria-roledescription",h="graphics-object",c="graphics-symbol",m=(e,t,n)=>({[On]:e,[b]:t,[Sn]:n||void 0}),w=Object(ke.Fa)(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),R={axis:{desc:"axis",caption:function(e){const t=e.datum,n=e.orient,i=t.title?_e(e):null,a=e.context,f=a.scales[t.scale].value,g=a.dataflow.locale(),x=f.type;return`${n==="left"||n==="right"?"Y":"X"}-axis`+(i?` titled '${i}'`:"")+` for a ${zd(x)?"discrete":x} scale with ${Mv(g,f,e)}`}},legend:{desc:"legend",caption:function(e){const t=e.datum,n=t.title?_e(e):null,i=`${t.type||""} legend`.trim(),a=t.scales,f=Object.keys(a),g=e.context,x=g.scales[a[f[0]]].value,k=g.dataflow.locale();return function(F){return F.length?F[0].toUpperCase()+F.slice(1):F}(i)+(n?` titled '${n}'`:"")+` for ${function(F){return(F=F.map(V=>V+(V==="fill"||V==="stroke"?" color":""))).length<2?F[0]:F.slice(0,-1).join(", ")+" and "+Object(ke.W)(F)}(f)} with ${Mv(k,x,e)}`}},"title-text":{desc:"title",caption:e=>`Title text '${de(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${de(e)}'`}},K={ariaRole:On,ariaRoleDescription:b,description:Sn};function ee(e,t){const n=t.aria===!1;if(e(mn,n||void 0),n||t.description==null)for(const i in K)e(K[i],void 0);else{const i=t.mark.marktype;e(Sn,t.description),e(On,t.ariaRole||(i==="group"?h:c)),e(b,t.ariaRoleDescription||`${i} mark`)}}function le(e){return e.aria===!1?{[mn]:!0}:w[e.role]?null:R[e.role]?function(t,n){try{const i=t.items[0],a=n.caption||(()=>"");return m(n.role||c,n.desc,i.description||a(i))}catch{return null}}(e,R[e.role]):function(t){const n=t.marktype,i=n==="group"||n==="text"||t.items.some(a=>a.description!=null&&a.aria!==!1);return m(i?h:c,`${n} mark container`,t.description)}(e)}function de(e){return Object(ke.i)(e.text).join(" ")}function _e(e){try{return Object(ke.i)(Object(ke.W)(e.items).items[0].text).join(" ")}catch{return null}}const Te=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),Ne=e=>Te(e).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function Fe(){let e="",t="",n="";const i=[],a=()=>t=n="",f=(x,k)=>(k!=null&&(t+=` ${x}="${Ne(k)}"`),g),g={open(x,...k){(F=>{t&&(e+=`${t}>${n}`,a()),i.push(F)})(x),t="<"+x;for(const F of k)for(const V in F)f(V,F[V]);return g},close(){const x=i.pop();return e+=t?t+(n?`>${n}</${x}>`:"/>"):`</${x}>`,a(),g},attr:f,text:x=>(n+=Te(x),g),toString:()=>e};return g}const He=e=>function t(n,i){if(n.open(i.tagName),i.hasAttributes()){const a=i.attributes,f=a.length;for(let g=0;g<f;++g)n.attr(a[g].name,a[g].value)}if(i.hasChildNodes()){const a=i.childNodes,f=a.length;for(let g=0;g<f;g++){const x=a[g];x.nodeType===3?n.text(x.nodeValue):t(n,x)}}return n.close()}(Fe(),e)+"",Ye={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},Ke={fill:"none","stroke-miterlimit":10},it=is.xmlns;function gt(e){E.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const wt=E.prototype;function At(e,t){for(;e&&e.dirty!==t;e=e.mark.group){if(e.dirty=t,!e.mark||e.mark.dirty===t)return;e.mark.dirty=t}}function zt(e,t,n){let i,a,f;if(t.gradient==="radial"){let g=bc(e,n++,"pattern",it);or(g,{id:Hl+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),or(g=bc(g,0,"rect",it),{width:1,height:1,fill:`url(${br()}#${t.id})`}),or(e=bc(e,n++,"radialGradient",it),{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else or(e=bc(e,n++,"linearGradient",it),{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(i=0,a=t.stops.length;i<a;++i)(f=bc(e,i,"stop",it)).setAttribute("offset",t.stops[i].offset),f.setAttribute("stop-color",t.stops[i].color);return Vf(e,i),n}function an(e,t,n){return(e=bc(e,n,"clipPath",it)).setAttribute("id",t.id),t.path?bc(e,0,"path",it).setAttribute("d",t.path):or(bc(e,0,"rect",it),{x:0,y:0,width:t.width,height:t.height}),Vf(e,1),n+1}function dn(e,t,n,i,a){let f,g=e._svg;if(!g&&(g=Uc(f=t.ownerDocument,i,it),e._svg=g,e.mark&&(g.__data__=e,g.__values__={fill:"default"},i==="g"))){const x=Uc(f,"path",it);g.appendChild(x),x.__data__=e;const k=Uc(f,"g",it);g.appendChild(k),k.__data__=e;const F=Uc(f,"path",it);g.appendChild(F),F.__data__=e,F.__values__={fill:"default"}}return(g.ownerSVGElement!==a||function(x,k){return x.parentNode&&x.parentNode.childNodes.length>1&&x.previousSibling!=k}(g,n))&&t.insertBefore(g,n?n.nextSibling:t.firstChild),g}Object(ke.z)(gt,E,{initialize(e,t,n,i,a){return this._defs={},this._clearDefs(),e&&(this._svg=bc(e,0,"svg",it),this._svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns",it),this._svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink",is["xmlns:xlink"]),this._svg.setAttribute("version",is.version),this._svg.setAttribute("class","marks"),Vf(e,1),this._root=bc(this._svg,0,"g",it),or(this._root,Ke),Vf(this._svg,1)),this.background(this._bgcolor),wt.initialize.call(this,e,t,n,i,a)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),wt.background.apply(this,arguments)},resize(e,t,n,i){return wt.resize.call(this,e,t,n,i),this._svg&&(or(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),or(n=bc(e,0,"rect",it),{width:this._width,height:this._height,fill:t}));const i=He(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),i},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),Vf(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,i,a,f,g,x,k;for(g=0,x=e.length;g<x;++g)(i=(n=e[g]).mark).marktype!==a&&(a=i.marktype,f=Jl[a]),i.zdirty&&i.dirty!==t&&(this._dirtyAll=!1,At(n,t),i.items.forEach(F=>{F.dirty=t})),i.zdirty||(n.exit?(f.nested&&i.items.length?(k=i.items[0])._svg&&this._update(f,k._svg,k):n._svg&&(k=n._svg.parentNode)&&k.removeChild(n._svg),n._svg=null):(n=f.nested?i.items[0]:n)._update!==t&&(n._svg&&n._svg.ownerSVGElement?this._update(f,n._svg,n):(this._dirtyAll=!1,At(n,t)),n._update=t));return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const i=this._svg,a=Jl[t.marktype],f=t.interactive===!1?"none":null,g=a.tag==="g";let x=null,k=0;const F=dn(t,e,n,"g",i);F.setAttribute("class",_(t));const V=le(t);for(const te in V)fr(F,te,V[te]);g||fr(F,"pointer-events",f),fr(F,"clip-path",t.clip?dl(this,t,t.group):null);const X=te=>{const se=this.isDirty(te),he=dn(te,F,x,a.tag,i);se&&(this._update(a,he,te),g&&function(ye,Pe,Ue){Pe=Pe.lastChild.previousSibling;let We,at=0;Wn(Ue,st=>{We=ye.mark(Pe,st,We),++at}),Vf(Pe,1+at)}(this,he,te)),x=he,++k};return a.nested?t.items.length&&X(t.items[0]):Wn(t,X),Vf(F,k),F},_update(e,t,n){sn=t,ln=t.__values__,ee(Bn,n),e.attr(Bn,n,this);const i=Tn[e.type];i&&i.call(this,e,t,n),sn&&this.style(sn,n)},style(e,t){if(t!=null)for(const n in Ye){let i=n==="font"?Yd(t):t[n];if(i===ln[n])continue;const a=Ye[n];i==null?e.removeAttribute(a):(pg(i)&&(i=m0(i,this._defs.gradient,br())),e.setAttribute(a,i+"")),ln[n]=i}},defs(){const e=this._svg,t=this._defs;let n=t.el,i=0;for(const a in t.gradient)n||(t.el=n=bc(e,1,"defs",it)),i=zt(n,t.gradient[a],i);for(const a in t.clipping)n||(t.el=n=bc(e,1,"defs",it)),i=an(n,t.clipping[a],i);n&&(i===0?(e.removeChild(n),t.el=null):Vf(n,i))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});let sn=null,ln=null;const Tn={group(e,t,n){const i=sn=t.childNodes[2];ln=i.__values__,e.foreground(Bn,n,this),ln=t.__values__,sn=t.childNodes[1],e.content(Bn,n,this);const a=sn=t.childNodes[0];e.background(Bn,n,this);const f=n.mark.interactive===!1?"none":null;if(f!==ln.events&&(fr(i,"pointer-events",f),fr(a,"pointer-events",f),ln.events=f),n.strokeForeground&&n.stroke){const g=n.fill;fr(i,"display",null),this.style(a,n),fr(a,"stroke",null),g&&(n.fill=null),ln=i.__values__,this.style(i,n),g&&(n.fill=g),sn=null}else fr(i,"display","none")},image(e,t,n){n.smooth===!1?(In(t,"image-rendering","optimizeSpeed"),In(t,"image-rendering","pixelated")):In(t,"image-rendering",null)},text(e,t,n){const i=tc(n);let a,f,g,x;Object(ke.B)(i)?(a=(f=i.map(k=>Kl(n,k))).join(`
`))!==ln.text&&(Vf(t,0),g=t.ownerDocument,x=Us(n),f.forEach((k,F)=>{const V=Uc(g,"tspan",it);V.__data__=n,V.textContent=k,F&&(V.setAttribute("x",0),V.setAttribute("dy",x)),t.appendChild(V)}),ln.text=a):(f=Kl(n,i))!==ln.text&&(t.textContent=f,ln.text=f),fr(t,"font-family",Yd(n)),fr(t,"font-size",yc(n)+"px"),fr(t,"font-style",n.fontStyle),fr(t,"font-variant",n.fontVariant),fr(t,"font-weight",n.fontWeight)}};function Bn(e,t,n){t!==ln[e]&&(n?function(i,a,f,g){f!=null?i.setAttributeNS(g,a,f):i.removeAttributeNS(g,a)}(sn,e,t,n):fr(sn,e,t),ln[e]=t)}function In(e,t,n){n!==ln[t]&&(n==null?e.style.removeProperty(t):e.style.setProperty(t,n+""),ln[t]=n)}function or(e,t){for(const n in t)fr(e,n,t[n])}function fr(e,t,n){n!=null?e.setAttribute(t,n):e.removeAttribute(t)}function br(){let e;return typeof window>"u"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function _r(e){E.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}Object(ke.z)(_r,E,{svg(){return this._text},_render(e){const t=Fe();t.open("svg",Object(ke.p)({},is,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&n!=="transparent"&&n!=="none"&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",Ke,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=Jl[t.marktype],i=n.tag,a=[ee,n.attr];e.open("g",{class:_(t),"clip-path":t.clip?dl(this,t,t.group):null},le(t),{"pointer-events":i!=="g"&&t.interactive===!1?"none":null});const f=g=>{const x=this.href(g);if(x&&e.open("a",x),e.open(i,this.attr(t,g,a,i!=="g"?i:null)),i==="text"){const k=tc(g);if(Object(ke.B)(k)){const F={x:0,dy:Us(g)};for(let V=0;V<k.length;++V)e.open("tspan",V?F:null).text(Kl(g,k[V])).close()}else e.text(Kl(g,k))}else if(i==="g"){const k=g.strokeForeground,F=g.fill,V=g.stroke;k&&V&&(g.stroke=null),e.open("path",this.attr(t,g,n.background,"bgrect")).close(),e.open("g",this.attr(t,g,n.content)),Wn(g,X=>this.mark(e,X)),e.close(),k&&V?(F&&(g.fill=null),g.stroke=V,e.open("path",this.attr(t,g,n.foreground,"bgrect")).close(),F&&(g.fill=F)):e.open("path",this.attr(t,g,n.foreground,"bgfore")).close()}e.close(),x&&e.close()};return n.nested?t.items&&t.items.length&&f(t.items[0]):Wn(t,f),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then(i=>{i["xlink:href"]=i.href,i.href=null,(this._hrefs||(this._hrefs={}))[t]=i})}return null},attr(e,t,n,i){const a={},f=(g,x,k,F)=>{a[F||g]=x};return Array.isArray(n)?n.forEach(g=>g(f,t,this)):n(f,t,this),i&&function(g,x,k,F,V){if(x==null||(F==="bgrect"&&k.interactive===!1&&(g["pointer-events"]="none"),F==="bgfore"&&(k.interactive===!1&&(g["pointer-events"]="none"),g.display="none",x.fill!==null)))return g;F==="image"&&x.smooth===!1&&(g.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),F==="text"&&(g["font-family"]=Yd(x),g["font-size"]=yc(x)+"px",g["font-style"]=x.fontStyle,g["font-variant"]=x.fontVariant,g["font-weight"]=x.fontWeight);for(const X in Ye){let te=x[X];const se=Ye[X];(te!=="transparent"||se!=="fill"&&se!=="stroke")&&te!=null&&(pg(te)&&(te=m0(te,V.gradient,"")),g[se]=te)}}(a,t,e,i,this._defs),a},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(Object.keys(t).length+Object.keys(n).length!==0){e.open("defs");for(const i in t){const a=t[i],f=a.stops;a.gradient==="radial"?(e.open("pattern",{id:Hl+i,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+i+")"}).close(),e.close(),e.open("radialGradient",{id:i,fx:a.x1,fy:a.y1,fr:a.r1,cx:a.x2,cy:a.y2,r:a.r2})):e.open("linearGradient",{id:i,x1:a.x1,x2:a.x2,y1:a.y1,y2:a.y2});for(let g=0;g<f.length;++g)e.open("stop",{offset:f[g].offset,"stop-color":f[g].color}).close();e.close()}for(const i in n){const a=n[i];e.open("clipPath",{id:i}),a.path?e.open("path",{d:a.path}).close():e.open("rect",{x:0,y:0,width:a.width,height:a.height}).close(),e.close()}e.close()}}});const xr={Canvas:"canvas",PNG:"png",SVG:"svg",None:"none"},vr={};function Pr(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(vr[e]=t,this):vr[e]}function Rr(e,t,n){const i=[],a=new rs().union(t),f=e.marktype;return f?Qr(e,a,n,i):f==="group"?fi(e,a,n,i):Object(ke.o)("Intersect scene must be mark node or group item.")}function Qr(e,t,n,i){if(function(a,f,g){return a.bounds&&f.intersects(a.bounds)&&(a.marktype==="group"||a.interactive!==!1&&(!g||g(a)))}(e,t,n)){const a=e.items,f=e.marktype,g=a.length;let x=0;if(f==="group")for(;x<g;++x)fi(a[x],t,n,i);else for(const k=Jl[f].isect;x<g;++x){const F=a[x];Ci(F,t,k)&&i.push(F)}}return i}function fi(e,t,n,i){n&&n(e.mark)&&Ci(e,t,Jl.group.isect)&&i.push(e);const a=e.items,f=a&&a.length;if(f){const g=e.x||0,x=e.y||0;t.translate(-g,-x);for(let k=0;k<f;++k)Qr(a[k],t,n,i);t.translate(g,x)}return i}function Ci(e,t,n){const i=e.bounds;return t.encloses(i)||t.intersects(i)&&n(e,t)}vr.canvas=vr.png={renderer:Lt,headless:Lt,handler:Xe},vr.svg={renderer:gt,headless:_r,handler:pn},vr.none={};const bo=new rs;function xo(e){const t=e.clip;if(Object(ke.E)(t))t(kg(bo.clear()));else{if(!t)return;bo.set(0,0,e.group.width,e.group.height)}e.bounds.intersect(bo)}const Mo=1e-9;function Oo(e,t,n){return e===t||(n==="path"?Vo(e,t):e instanceof Date&&t instanceof Date?+e==+t:Object(ke.G)(e)&&Object(ke.G)(t)?Math.abs(e-t)<=Mo:e&&t&&(Object(ke.H)(e)||Object(ke.H)(t))?function(i,a){var f,g,x=Object.keys(i),k=Object.keys(a);if(x.length!==k.length)return!1;for(x.sort(),k.sort(),g=x.length-1;g>=0;g--)if(x[g]!=k[g])return!1;for(g=x.length-1;g>=0;g--)if(f=x[g],!Oo(i[f],a[f],f))return!1;return typeof i==typeof a}(e,t):e==t)}function Vo(e,t){return Oo(Qh(e),Qh(t))}function ua(){jv(),Wd=0}const $a="top",so="left",Do="right",Ko="bottom",Su="top-left",Ks="top-right",Ys="bottom-left",cp="bottom-right",lp="start",Om="middle",Pu="end",S0="x",Gv="y",fp="group",qv="axis",Tm="title",e3="frame",U1="scope",dp="legend",fw="row-header",t3="row-footer",n3="row-title",dw="column-header",hw="column-footer",pw="column-title",zG="padding",UG="symbol",a5="fit",WG="fit-x",VG="fit-y",HG="pad",oT="none",r3="all",aT="each",sT="flush",W1="column",V1="row";function s5(e){Tt.call(this,null,e)}function i3(e,t,n){return t(e.bounds.clear(),e,n)}Object(ke.z)(s5,Tt,{transform(e,t){const n=t.dataflow,i=e.mark,a=i.marktype,f=Jl[a],g=f.bound;let x,k=i.bounds;if(f.nested)i.items.length&&n.dirty(i.items[0]),k=i3(i,g),i.items.forEach(F=>{F.bounds.clear().union(k)});else if(a===fp||e.modified())switch(t.visit(t.MOD,F=>n.dirty(F)),k.clear(),i.items.forEach(F=>k.union(i3(F,g))),i.role){case qv:case dp:case Tm:t.reflow()}else x=t.changed(t.REM),t.visit(t.ADD,F=>{k.union(i3(F,g))}),t.visit(t.MOD,F=>{x=x||k.alignsWith(F.bounds),n.dirty(F),k.union(i3(F,g))}),x&&(k.clear(),i.items.forEach(F=>k.union(F.bounds)));return xo(i),t.modifies("bounds")}});const u5=":vega_identifier:";function uT(e){Tt.call(this,0,e)}function c5(e){Tt.call(this,null,e)}function l5(e){Tt.call(this,null,e)}uT.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},Object(ke.z)(uT,Tt,{transform(e,t){const n=function(f){return f._signals[u5]||(f._signals[u5]=f.add(0))}(t.dataflow),i=e.as;let a=n.value;return t.visit(t.ADD,f=>f[i]=f[i]||++a),n.set(this.value=a),t}}),Object(ke.z)(c5,Tt,{transform(e,t){let n=this.value;n||((n=t.dataflow.scenegraph().mark(e.markdef,function(a){const f=a.groups,g=a.parent;return f&&f.size===1?f.get(Object.keys(f.object)[0]):f&&g?f.lookup(g):null}(e),e.index)).group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const i=n.marktype===fp?_m:tp;return t.visit(t.ADD,a=>i.call(a,n)),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});const f5={parity:e=>e.filter((t,n)=>n%2?t.opacity=0:1),greedy:(e,t)=>{let n;return e.filter((i,a)=>a&&d5(n.bounds,i.bounds,t)?i.opacity=0:(n=i,1))}},d5=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),h5=(e,t)=>{for(var n,i=1,a=e.length,f=e[0].bounds;i<a;f=n,++i)if(d5(f,n=e[i].bounds,t))return!0},GG=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},p5=e=>(e.forEach(t=>t.opacity=1),e),m5=(e,t)=>e.reflow(t.modified()).modifies("opacity");function g5(e){Tt.call(this,null,e)}Object(ke.z)(l5,Tt,{transform(e,t){const n=f5[e.method]||f5.parity,i=e.separation||0;let a,f,g=t.materialize(t.SOURCE).source;if(!g||!g.length)return;if(!e.method)return e.modified("method")&&(p5(g),t=m5(t,e)),t;if(!(g=g.filter(GG)).length)return;if(e.sort&&(g=g.slice().sort(e.sort)),a=p5(g),t=m5(t,e),a.length>=3&&h5(a,i)){do a=n(a,i);while(a.length>=3&&h5(a,i));a.length<3&&!Object(ke.W)(g).opacity&&(a.length>1&&(Object(ke.W)(a).opacity=0),Object(ke.W)(g).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(f=((k,F,V)=>{var X=k.range(),te=new rs;return F===$a||F===Ko?te.set(X[0],-1/0,X[1],1/0):te.set(-1/0,X[0],1/0,X[1]),te.expand(V||1),se=>te.encloses(se.bounds)})(e.boundScale,e.boundOrient,+e.boundTolerance),g.forEach(k=>{f(k)||(k.opacity=0)}));const x=a[0].mark.bounds.clear();return g.forEach(k=>{k.opacity&&x.union(k.bounds)}),t}}),Object(ke.z)(g5,Tt,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,i=>n.dirty(i)),t.fields&&t.fields.zindex){const i=t.source&&t.source[0];i&&(i.mark.zdirty=!0)}}});const Hf=new rs;function mw(e,t,n){return e[t]===n?0:(e[t]=n,1)}function qG(e){var t=e.items[0].orient;return t===so||t===Do}function $G(e,t,n,i){var a,f,g=t.items[0],x=g.datum,k=g.translate!=null?g.translate:.5,F=g.orient,V=function(ct){let Ct=+ct.grid;return[ct.ticks?Ct++:-1,ct.labels?Ct++:-1,Ct+ +ct.domain]}(x),X=g.range,te=g.offset,se=g.position,he=g.minExtent,ye=g.maxExtent,Pe=x.title&&g.items[V[2]].items[0],Ue=g.titlePadding,We=g.bounds,at=Pe&&Cs(Pe),st=0,lt=0;switch(Hf.clear().union(We),We.clear(),(a=V[0])>-1&&We.union(g.items[a].bounds),(a=V[1])>-1&&We.union(g.items[a].bounds),F){case $a:st=se||0,lt=-te,f=Math.max(he,Math.min(ye,-We.y1)),We.add(0,-f).add(X,0),Pe&&o3(e,Pe,f,Ue,at,0,-1,We);break;case so:st=-te,lt=se||0,f=Math.max(he,Math.min(ye,-We.x1)),We.add(-f,0).add(0,X),Pe&&o3(e,Pe,f,Ue,at,1,-1,We);break;case Do:st=n+te,lt=se||0,f=Math.max(he,Math.min(ye,We.x2)),We.add(0,0).add(f,X),Pe&&o3(e,Pe,f,Ue,at,1,1,We);break;case Ko:st=se||0,lt=i+te,f=Math.max(he,Math.min(ye,We.y2)),We.add(0,0).add(X,f),Pe&&o3(e,Pe,f,Ue,0,0,1,We);break;default:st=g.x,lt=g.y}return Bf(We.translate(st,lt),g),mw(g,"x",st+k)|mw(g,"y",lt+k)&&(g.bounds=Hf,e.dirty(g),g.bounds=We,e.dirty(g)),g.mark.bounds.clear().union(We)}function o3(e,t,n,i,a,f,g,x){const k=t.bounds;if(t.auto){const F=g*(n+a+i);let V=0,X=0;e.dirty(t),f?V=(t.x||0)-(t.x=F):X=(t.y||0)-(t.y=F),t.mark.bounds.clear().union(k.translate(-V,-X)),e.dirty(t)}x.union(k)}const v5=(e,t)=>Math.floor(Math.min(e,t)),y5=(e,t)=>Math.ceil(Math.max(e,t));function XG(e){return new rs().set(0,0,e.width||0,e.height||0)}function KG(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function pu(e,t,n){const i=Object(ke.H)(e)?e[t]:e;return i??(n!==void 0?n:0)}function b5(e){return e<0?Math.ceil(-e):0}function x5(e,t,n){var i,a,f,g,x,k,F,V,X,te,se,he=!n.nodirty,ye=n.bounds===sT?XG:KG,Pe=Hf.set(0,0,0,0),Ue=pu(n.align,W1),We=pu(n.align,V1),at=pu(n.padding,W1),st=pu(n.padding,V1),lt=n.columns||t.length,ct=lt<=0?1:Math.ceil(t.length/lt),Ct=t.length,Et=Array(Ct),gn=Array(lt),An=0,wn=Array(Ct),$n=Array(ct),qn=0,er=Array(Ct),rr=Array(Ct),lr=Array(Ct);for(a=0;a<lt;++a)gn[a]=0;for(a=0;a<ct;++a)$n[a]=0;for(a=0;a<Ct;++a)k=t[a],x=lr[a]=ye(k),k.x=k.x||0,er[a]=0,k.y=k.y||0,rr[a]=0,f=a%lt,g=~~(a/lt),An=Math.max(An,F=Math.ceil(x.x2)),qn=Math.max(qn,V=Math.ceil(x.y2)),gn[f]=Math.max(gn[f],F),$n[g]=Math.max($n[g],V),Et[a]=at+b5(x.x1),wn[a]=st+b5(x.y1),he&&e.dirty(t[a]);for(a=0;a<Ct;++a)a%lt==0&&(Et[a]=0),a<lt&&(wn[a]=0);if(Ue===aT)for(f=1;f<lt;++f){for(se=0,a=f;a<Ct;a+=lt)se<Et[a]&&(se=Et[a]);for(a=f;a<Ct;a+=lt)Et[a]=se+gn[f-1]}else if(Ue===r3){for(se=0,a=0;a<Ct;++a)a%lt&&se<Et[a]&&(se=Et[a]);for(a=0;a<Ct;++a)a%lt&&(Et[a]=se+An)}else for(Ue=!1,f=1;f<lt;++f)for(a=f;a<Ct;a+=lt)Et[a]+=gn[f-1];if(We===aT)for(g=1;g<ct;++g){for(se=0,i=(a=g*lt)+lt;a<i;++a)se<wn[a]&&(se=wn[a]);for(a=g*lt;a<i;++a)wn[a]=se+$n[g-1]}else if(We===r3){for(se=0,a=lt;a<Ct;++a)se<wn[a]&&(se=wn[a]);for(a=lt;a<Ct;++a)wn[a]=se+qn}else for(We=!1,g=1;g<ct;++g)for(i=(a=g*lt)+lt;a<i;++a)wn[a]+=$n[g-1];for(X=0,a=0;a<Ct;++a)X=Et[a]+(a%lt?X:0),er[a]+=X-t[a].x;for(f=0;f<lt;++f)for(te=0,a=f;a<Ct;a+=lt)te+=wn[a],rr[a]+=te-t[a].y;if(Ue&&pu(n.center,W1)&&ct>1)for(a=0;a<Ct;++a)(X=(x=Ue===r3?An:gn[a%lt])-lr[a].x2-t[a].x-er[a])>0&&(er[a]+=X/2);if(We&&pu(n.center,V1)&&lt!==1)for(a=0;a<Ct;++a)(te=(x=We===r3?qn:$n[~~(a/lt)])-lr[a].y2-t[a].y-rr[a])>0&&(rr[a]+=te/2);for(a=0;a<Ct;++a)Pe.union(lr[a].translate(er[a],rr[a]));switch(X=pu(n.anchor,S0),te=pu(n.anchor,Gv),pu(n.anchor,W1)){case Pu:X-=Pe.width();break;case Om:X-=Pe.width()/2}switch(pu(n.anchor,V1)){case Pu:te-=Pe.height();break;case Om:te-=Pe.height()/2}for(X=Math.round(X),te=Math.round(te),Pe.clear(),a=0;a<Ct;++a)t[a].mark.bounds.clear();for(a=0;a<Ct;++a)(k=t[a]).x+=er[a]+=X,k.y+=rr[a]+=te,Pe.union(k.mark.bounds.union(k.bounds.translate(er[a],rr[a]))),he&&e.dirty(k);return Pe}function YG(e,t,n){var i,a,f,g,x,k,F,V=function(We){var at,st,lt=We.items,ct=lt.length,Ct=0;const Et={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;Ct<ct;++Ct)if(st=(at=lt[Ct]).items,at.marktype===fp)switch(at.role){case qv:case dp:case Tm:break;case fw:Et.rowheaders.push(...st);break;case t3:Et.rowfooters.push(...st);break;case dw:Et.colheaders.push(...st);break;case hw:Et.colfooters.push(...st);break;case n3:Et.rowtitle=st[0];break;case pw:Et.coltitle=st[0];break;default:Et.marks.push(...st)}return Et}(t),X=V.marks,te=n.bounds===sT?JG:QG,se=n.offset,he=n.columns||X.length,ye=he<=0?1:Math.ceil(X.length/he),Pe=ye*he;const Ue=x5(e,X,n);Ue.empty()&&Ue.set(0,0,0,0),V.rowheaders&&(k=pu(n.headerBand,V1,null),i=a3(e,V.rowheaders,X,he,ye,-pu(se,"rowHeader"),v5,0,te,"x1",0,he,1,k)),V.colheaders&&(k=pu(n.headerBand,W1,null),a=a3(e,V.colheaders,X,he,he,-pu(se,"columnHeader"),v5,1,te,"y1",0,1,he,k)),V.rowfooters&&(k=pu(n.footerBand,V1,null),f=a3(e,V.rowfooters,X,he,ye,pu(se,"rowFooter"),y5,0,te,"x2",he-1,he,1,k)),V.colfooters&&(k=pu(n.footerBand,W1,null),g=a3(e,V.colfooters,X,he,he,pu(se,"columnFooter"),y5,1,te,"y2",Pe-he,1,he,k)),V.rowtitle&&(x=pu(n.titleAnchor,V1),F=pu(se,"rowTitle"),F=x===Pu?f+F:i-F,k=pu(n.titleBand,V1,.5),w5(e,V.rowtitle,F,0,Ue,k)),V.coltitle&&(x=pu(n.titleAnchor,W1),F=pu(se,"columnTitle"),F=x===Pu?g+F:a-F,k=pu(n.titleBand,W1,.5),w5(e,V.coltitle,F,1,Ue,k))}function JG(e,t){return t==="x1"?e.x||0:t==="y1"?e.y||0:t==="x2"?(e.x||0)+(e.width||0):t==="y2"?(e.y||0)+(e.height||0):void 0}function QG(e,t){return e.bounds[t]}function a3(e,t,n,i,a,f,g,x,k,F,V,X,te,se){var he,ye,Pe,Ue,We,at,st,lt,ct,Ct=n.length,Et=0,gn=0;if(!Ct)return Et;for(he=V;he<Ct;he+=X)n[he]&&(Et=g(Et,k(n[he],F)));if(!t.length)return Et;for(t.length>a&&(e.warn("Grid headers exceed limit: "+a),t=t.slice(0,a)),Et+=f,ye=0,Ue=t.length;ye<Ue;++ye)e.dirty(t[ye]),t[ye].mark.bounds.clear();for(he=V,ye=0,Ue=t.length;ye<Ue;++ye,he+=X){for(We=(at=t[ye]).mark.bounds,Pe=he;Pe>=0&&(st=n[Pe])==null;Pe-=te);x?(lt=se==null?st.x:Math.round(st.bounds.x1+se*st.bounds.width()),ct=Et):(lt=Et,ct=se==null?st.y:Math.round(st.bounds.y1+se*st.bounds.height())),We.union(at.bounds.translate(lt-(at.x||0),ct-(at.y||0))),at.x=lt,at.y=ct,e.dirty(at),gn=g(gn,We[F])}return gn}function w5(e,t,n,i,a,f){if(t){e.dirty(t);var g=n,x=n;i?g=Math.round(a.x1+f*a.width()):x=Math.round(a.y1+f*a.height()),t.bounds.translate(g-(t.x||0),x-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=g,t.y=x,e.dirty(t)}}function ZG(e,t,n,i,a,f,g){const x=function(te,se){const he=te[se]||{};return(ye,Pe)=>he[ye]!=null?he[ye]:te[ye]!=null?te[ye]:Pe}(n,t),k=function(te,se){let he=-1/0;return te.forEach(ye=>{ye.offset!=null&&(he=Math.max(he,ye.offset))}),he>-1/0?he:se}(e,x("offset",0)),F=x("anchor",lp),V=F===Pu?1:F===Om?.5:0,X={align:aT,bounds:x("bounds",sT),columns:x("direction")==="vertical"?1:e.length,padding:x("margin",8),center:x("center"),nodirty:!0};switch(t){case so:X.anchor={x:Math.floor(i.x1)-k,column:Pu,y:V*(g||i.height()+2*i.y1),row:F};break;case Do:X.anchor={x:Math.ceil(i.x2)+k,y:V*(g||i.height()+2*i.y1),row:F};break;case $a:X.anchor={y:Math.floor(a.y1)-k,row:Pu,x:V*(f||a.width()+2*a.x1),column:F};break;case Ko:X.anchor={y:Math.ceil(a.y2)+k,x:V*(f||a.width()+2*a.x1),column:F};break;case Su:X.anchor={x:k,y:k};break;case Ks:X.anchor={x:f-k,y:k,column:Pu};break;case Ys:X.anchor={x:k,y:g-k,row:Pu};break;case cp:X.anchor={x:f-k,y:g-k,column:Pu,row:Pu}}return X}function eq(e,t){var n,i,a=t.items[0],f=a.datum,g=a.orient,x=a.bounds,k=a.x,F=a.y;return a._bounds?a._bounds.clear().union(x):a._bounds=x.clone(),x.clear(),function(V,X,te){var se=X.padding,he=se-te.x,ye=se-te.y;if(X.datum.title){var Pe=X.items[1].items[0],Ue=Pe.anchor,We=X.titlePadding||0,at=se-Pe.x,st=se-Pe.y;switch(Pe.orient){case so:he+=Math.ceil(Pe.bounds.width())+We;break;case Do:case Ko:break;default:ye+=Pe.bounds.height()+We}switch((he||ye)&&r_(V,te,he,ye),Pe.orient){case so:st+=gw(X,te,Pe,Ue,1,1);break;case Do:at+=gw(X,te,Pe,Pu,0,0)+We,st+=gw(X,te,Pe,Ue,1,1);break;case Ko:at+=gw(X,te,Pe,Ue,0,0),st+=gw(X,te,Pe,Pu,-1,0,1)+We;break;default:at+=gw(X,te,Pe,Ue,0,0)}(at||st)&&r_(V,Pe,at,st),(at=Math.round(Pe.bounds.x1-se))<0&&(r_(V,te,-at,0),r_(V,Pe,-at,0))}else(he||ye)&&r_(V,te,he,ye)}(e,a,a.items[0].items[0]),x=function(V,X){return V.items.forEach(te=>X.union(te.bounds)),X.x1=V.padding,X.y1=V.padding,X}(a,x),n=2*a.padding,i=2*a.padding,x.empty()||(n=Math.ceil(x.width()+n),i=Math.ceil(x.height()+i)),f.type===UG&&function(V){const X=V.reduce((te,se)=>(te[se.column]=Math.max(se.bounds.x2-se.x,te[se.column]||0),te),{});V.forEach(te=>{te.width=X[te.column],te.height=te.bounds.y2-te.y})}(a.items[0].items[0].items[0].items),g!==oT&&(a.x=k=0,a.y=F=0),a.width=n,a.height=i,Bf(x.set(k,F,k+n,F+i),a),a.mark.bounds.clear().union(x),a}function gw(e,t,n,i,a,f,g){const x=e.datum.type!=="symbol",k=n.datum.vgrad,F=(!x||!f&&k||g?t:t.items[0]).bounds[a?"y2":"x2"]-e.padding,V=k&&f?F:0,X=k&&f?0:F,te=a<=0?0:Cs(n);return Math.round(i===lp?V:i===Pu?X-te:.5*(F-te))}function r_(e,t,n,i){t.x+=n,t.y+=i,t.bounds.translate(n,i),t.mark.bounds.translate(n,i),e.dirty(t)}function _5(e){Tt.call(this,null,e)}function E5(e,t){let n=0;if(t===void 0)for(let i of e)(i=+i)&&(n+=i);else{let i=-1;for(let a of e)(a=+t(a,++i,e))&&(n+=a)}return n}function S5(e){Tt.call(this,null,e)}function k5(e){Tt.call(this,null,e)}function tq(){return xn({})}function C5(e){Tt.call(this,null,e)}function A5(e){Tt.call(this,[],e)}Object(ke.z)(_5,Tt,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach(i=>{e.layout&&YG(n,i,e.layout),function(a,f,g){var x,k,F,V,X,te=f.items,se=Math.max(0,f.width||0),he=Math.max(0,f.height||0),ye=new rs().set(0,0,se,he),Pe=ye.clone(),Ue=ye.clone(),We=[];for(V=0,X=te.length;V<X;++V)switch((k=te[V]).role){case qv:(qG(k)?Pe:Ue).union($G(a,k,se,he));break;case Tm:x=k;break;case dp:We.push(eq(a,k));break;case e3:case U1:case fw:case t3:case n3:case dw:case hw:case pw:Pe.union(k.bounds),Ue.union(k.bounds);break;default:ye.union(k.bounds)}if(We.length){const at={};We.forEach(st=>{(F=st.orient||Do)!==oT&&(at[F]||(at[F]=[])).push(st)});for(const st in at){const lt=at[st];x5(a,lt,ZG(lt,st,g.legends,Pe,Ue,se,he))}We.forEach(st=>{const lt=st.bounds;if(lt.equals(st._bounds)||(st.bounds=st._bounds,a.dirty(st),st.bounds=lt,a.dirty(st)),g.autosize&&g.autosize.type===a5)switch(st.orient){case so:case Do:ye.add(lt.x1,0).add(lt.x2,0);break;case $a:case Ko:ye.add(0,lt.y1).add(0,lt.y2)}else ye.union(lt)})}ye.union(Pe).union(Ue),x&&ye.union(function(at,st,lt,ct,Ct){var Et,gn=st.items[0],An=gn.frame,wn=gn.orient,$n=gn.anchor,qn=gn.offset,er=gn.padding,rr=gn.items[0].items[0],lr=gn.items[1]&&gn.items[1].items[0],Or=wn===so||wn===Do?ct:lt,Jr=0,Lr=0,li=0,Ai=0,Ti=0;if(An!==fp?wn===so?(Jr=Ct.y2,Or=Ct.y1):wn===Do?(Jr=Ct.y1,Or=Ct.y2):(Jr=Ct.x1,Or=Ct.x2):wn===so&&(Jr=ct,Or=0),Et=$n===lp?Jr:$n===Pu?Or:(Jr+Or)/2,lr&&lr.text){switch(wn){case $a:case Ko:Ti=rr.bounds.height()+er;break;case so:Ai=rr.bounds.width()+er;break;case Do:Ai=-rr.bounds.width()-er}Hf.clear().union(lr.bounds),Hf.translate(Ai-(lr.x||0),Ti-(lr.y||0)),mw(lr,"x",Ai)|mw(lr,"y",Ti)&&(at.dirty(lr),lr.bounds.clear().union(Hf),lr.mark.bounds.clear().union(Hf),at.dirty(lr)),Hf.clear().union(lr.bounds)}else Hf.clear();switch(Hf.union(rr.bounds),wn){case $a:Lr=Et,li=Ct.y1-Hf.height()-qn;break;case so:Lr=Ct.x1-Hf.width()-qn,li=Et;break;case Do:Lr=Ct.x2+Hf.width()+qn,li=Et;break;case Ko:Lr=Et,li=Ct.y2+qn;break;default:Lr=gn.x,li=gn.y}return mw(gn,"x",Lr)|mw(gn,"y",li)&&(Hf.translate(Lr,li),at.dirty(gn),gn.bounds.clear().union(Hf),st.bounds.clear().union(Hf),at.dirty(gn)),gn.bounds}(a,x,se,he,ye)),f.clip&&ye.set(0,0,f.width||0,f.height||0),function(at,st,lt,ct){const Ct=ct.autosize||{},Et=Ct.type;if(at._autosize<1||!Et)return;let gn=at._width,An=at._height,wn=Math.max(0,st.width||0),$n=Math.max(0,Math.ceil(-lt.x1)),qn=Math.max(0,st.height||0),er=Math.max(0,Math.ceil(-lt.y1));const rr=Math.max(0,Math.ceil(lt.x2-wn)),lr=Math.max(0,Math.ceil(lt.y2-qn));if(Ct.contains===zG){const Or=at.padding();gn-=Or.left+Or.right,An-=Or.top+Or.bottom}Et===oT?($n=0,er=0,wn=gn,qn=An):Et===a5?(wn=Math.max(0,gn-$n-rr),qn=Math.max(0,An-er-lr)):Et===WG?(wn=Math.max(0,gn-$n-rr),An=qn+er+lr):Et===VG?(gn=wn+$n+rr,qn=Math.max(0,An-er-lr)):Et===HG&&(gn=wn+$n+rr,An=qn+er+lr),at._resizeView(gn,An,wn,qn,[$n,er],Ct.resize)}(a,f,ye,g)}(n,i,e)}),function(i){return i&&i.mark.role!=="legend-entry"}(e.mark.group)?t.reflow():t}}),Object(ke.z)(S5,Tt,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=this.value,f=e.scale,g=pm(f,e.count==null?e.values?e.values.length:10:e.count,e.minstep),x=e.format||Sv(n,f,g,e.formatSpecifier,e.formatType,!!e.values),k=e.values?Ev(f,e.values,g):Ff(f,g);return a&&(i.rem=a),a=k.map((F,V)=>xn({index:V/(k.length-1||1),value:F,label:x(F)})),e.extra&&a.length&&a.push(xn({index:-1,extra:{value:a[0].value},label:""})),i.source=a,i.add=a,this.value=a,i}}),Object(ke.z)(k5,Tt,{transform(e,t){var n=t.dataflow,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=e.item||tq,f=e.key||Zt,g=this.value;return Object(ke.B)(i.encode)&&(i.encode=null),g&&(e.modified("key")||t.modified(f))&&Object(ke.o)("DataJoin does not support modified key function or fields."),g||(t=t.addAll(),this.value=g=function(x){const k=Object(ke.t)().test(F=>F.exit);return k.lookup=F=>k.get(x(F)),k}(f)),t.visit(t.ADD,x=>{const k=f(x);let F=g.get(k);F?F.exit?(g.empty--,i.add.push(F)):i.mod.push(F):(F=a(x),g.set(k,F),i.add.push(F)),F.datum=x,F.exit=!1}),t.visit(t.MOD,x=>{const k=f(x),F=g.get(k);F&&(F.datum=x,i.mod.push(F))}),t.visit(t.REM,x=>{const k=f(x),F=g.get(k);x!==F.datum||F.exit||(i.rem.push(F),F.exit=!0,++g.empty)}),t.changed(t.ADD_MOD)&&i.modifies("datum"),(t.clean()||e.clean&&g.empty>n.cleanThreshold)&&n.runAfter(g.clean),i}}),Object(ke.z)(C5,Tt,{transform(e,t){var n=t.fork(t.ADD_REM),i=e.mod||!1,a=e.encoders,f=t.encode;if(Object(ke.B)(f)){if(!n.changed()&&!f.every(X=>a[X]))return t.StopPropagation;f=f[0],n.encode=null}var g=f==="enter",x=a.update||ke.s,k=a.enter||ke.s,F=a.exit||ke.s,V=(f&&!g?a[f]:x)||ke.s;if(t.changed(t.ADD)&&(t.visit(t.ADD,X=>{k(X,e),x(X,e)}),n.modifies(k.output),n.modifies(x.output),V!==ke.s&&V!==x&&(t.visit(t.ADD,X=>{V(X,e)}),n.modifies(V.output))),t.changed(t.REM)&&F!==ke.s&&(t.visit(t.REM,X=>{F(X,e)}),n.modifies(F.output)),g||V!==ke.s){const X=t.MOD|(e.modified()?t.REFLOW:0);g?(t.visit(X,te=>{const se=k(te,e)||i;(V(te,e)||se)&&n.mod.push(te)}),n.mod.length&&n.modifies(k.output)):t.visit(X,te=>{(V(te,e)||i)&&n.mod.push(te)}),n.mod.length&&n.modifies(V.output)}return n.changed()?n:t.StopPropagation}}),Object(ke.z)(A5,Tt,{transform(e,t){if(this.value!=null&&!e.modified())return t.StopPropagation;var n,i,a,f,g,x=t.dataflow.locale(),k=t.fork(t.NO_SOURCE|t.NO_FIELDS),F=this.value,V=e.type||dg,X=e.scale,te=+e.limit,se=pm(X,e.count==null?5:e.count,e.minstep),he=!!e.values||V===dg,ye=e.format||Av(x,X,se,V,e.formatSpecifier,e.formatType,he),Pe=e.values||Cv(X,se);return F&&(k.rem=F),V===dg?(te&&Pe.length>te?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),F=Pe.slice(0,te-1),g=!0):F=Pe,Object(ke.E)(a=e.size)?(e.values||X(F[0])!==0||(F=F.slice(1)),f=F.reduce((Ue,We)=>Math.max(Ue,a(We,e)),0)):a=Object(ke.m)(f=a||8),F=F.map((Ue,We)=>xn({index:We,label:ye(Ue,We,F),value:Ue,offset:f,size:a(Ue,e)})),g&&(g=Pe[F.length],F.push(xn({index:F.length,label:"".concat(Pe.length-F.length," entries"),value:g,offset:f,size:a(g,e)})))):V==="gradient"?(n=X.domain(),i=Yh(X,n[0],Object(ke.W)(n)),Pe.length<3&&!e.values&&n[0]!==Object(ke.W)(n)&&(Pe=[n[0],Object(ke.W)(n)]),F=Pe.map((Ue,We)=>xn({index:We,label:ye(Ue,We,Pe),value:Ue,perc:i(Ue)}))):(a=Pe.length-1,i=function(Ue){const We=Ue.domain(),at=We.length-1;let st=+We[0],lt=+Object(ke.W)(We),ct=lt-st;if(Ue.type===ul){const Ct=at?ct/at:.1;ct=(lt+=Ct)-(st-=Ct)}return Ct=>(Ct-st)/ct}(X),F=Pe.map((Ue,We)=>xn({index:We,label:ye(Ue,We,Pe),value:Ue,perc:We?i(Ue):0,perc2:We===a?1:i(Pe[We+1])}))),k.source=F,k.add=F,this.value=F,k}});const nq=e=>e.source.x,rq=e=>e.source.y,iq=e=>e.target.x,oq=e=>e.target.y;function cT(e){Tt.call(this,{},e)}cT.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},Object(ke.z)(cT,Tt,{transform(e,t){var n=e.sourceX||nq,i=e.sourceY||rq,a=e.targetX||iq,f=e.targetY||oq,g=e.as||"path",x=e.orient||"vertical",k=e.shape||"line",F=D5.get(k+"-"+x)||D5.get(k);return F||Object(ke.o)("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,V=>{V[g]=F(n(V),i(V),a(V),f(V))}),t.reflow(e.modified()).modifies(g)}});const O5=(e,t,n,i)=>"M"+e+","+t+"L"+n+","+i,T5=(e,t,n,i)=>{var a=n-e,f=i-t,g=Math.sqrt(a*a+f*f)/2;return"M"+e+","+t+"A"+g+","+g+" "+180*Math.atan2(f,a)/Math.PI+" 0 1 "+n+","+i},M5=(e,t,n,i)=>{const a=n-e,f=i-t,g=.2*(a+f),x=.2*(f-a);return"M"+e+","+t+"C"+(e+g)+","+(t+x)+" "+(n+x)+","+(i-g)+" "+n+","+i},D5=Object(ke.t)({line:O5,"line-radial":(e,t,n,i)=>O5(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),arc:T5,"arc-radial":(e,t,n,i)=>T5(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),curve:M5,"curve-radial":(e,t,n,i)=>M5(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),"orthogonal-horizontal":(e,t,n,i)=>"M"+e+","+t+"V"+i+"H"+n,"orthogonal-vertical":(e,t,n,i)=>"M"+e+","+t+"H"+n+"V"+i,"orthogonal-radial":(e,t,n,i)=>{const a=Math.cos(e),f=Math.sin(e),g=Math.cos(n),x=Math.sin(n);return"M"+t*a+","+t*f+"A"+t+","+t+" 0 0,"+((Math.abs(n-e)>Math.PI?n<=e:n>e)?1:0)+" "+t*g+","+t*x+"L"+i*g+","+i*x},"diagonal-horizontal":(e,t,n,i)=>{const a=(e+n)/2;return"M"+e+","+t+"C"+a+","+t+" "+a+","+i+" "+n+","+i},"diagonal-vertical":(e,t,n,i)=>{const a=(t+i)/2;return"M"+e+","+t+"C"+e+","+a+" "+n+","+a+" "+n+","+i},"diagonal-radial":(e,t,n,i)=>{const a=Math.cos(e),f=Math.sin(e),g=Math.cos(n),x=Math.sin(n),k=(t+i)/2;return"M"+t*a+","+t*f+"C"+k*a+","+k*f+" "+k*g+","+k*x+" "+i*g+","+i*x}});function lT(e){Tt.call(this,null,e)}lT.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},Object(ke.z)(lT,Tt,{transform(e,t){var n,i,a,f=e.as||["startAngle","endAngle"],g=f[0],x=f[1],k=e.field||ke.Q,F=e.startAngle||0,V=e.endAngle!=null?e.endAngle:2*Math.PI,X=t.source,te=X.map(k),se=te.length,he=F,ye=(V-F)/E5(te),Pe=Ms(se);for(e.sort&&Pe.sort((Ue,We)=>te[Ue]-te[We]),n=0;n<se;++n)a=te[Pe[n]],(i=X[Pe[n]])[g]=he,i[x]=he+=a*ye;return this.value=te,t.reflow(e.modified()).modifies(f)}});const aq=5;function N5(e){return jd(e)&&e!==Zu}const sq=Object(ke.Fa)(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function I5(e){Tt.call(this,null,e),this.modified(!0)}function F5(e,t,n){return ag(e)&&Math.abs(t.reduce((i,a)=>i+(a<0?-1:a>0?1:0),0))!==t.length&&n.warn("Log scale domain includes zero: "+Object(ke.Ba)(t)),t}function R5(e,t,n){return Object(ke.E)(e)&&(t||n)?cg(e,fT(t||[0,1],n)):e}function fT(e,t){return t?e.slice().reverse():e}function P5(e){Tt.call(this,null,e)}Object(ke.z)(I5,Tt,{transform(e,t){var n=t.dataflow,i=this.value,a=function(f){var g,x=f.type,k="";return x===Zu?Zu+"-"+Mf:(function(F){const V=F.type;return jd(V)&&V!==Df&&V!==Nf&&(F.scheme||F.range&&F.range.length&&F.range.every(ke.J))}(f)&&(g=f.rawDomain?f.rawDomain.length:f.domain?f.domain.length+ +(f.domainMid!=null):0,k=g===2?Zu+"-":g===3?Xh+"-":""),(k+x||Mf).toLowerCase())}(e);for(a in i&&a===i.type||(this.value=i=zo(a)()),e)if(!sq[a]){if(a==="padding"&&N5(i.type))continue;Object(ke.E)(i[a])?i[a](e[a]):n.warn("Unsupported scale property: "+a)}return function(f,g,x){var k=f.type,F=g.round||!1,V=g.range;if(g.rangeStep!=null)V=function(X,te,se){X!==Bd&&X!==ig&&Object(ke.o)("Only band and point scales support rangeStep.");var he=(te.paddingOuter!=null?te.paddingOuter:te.padding)||0,ye=X===ig?1:(te.paddingInner!=null?te.paddingInner:te.padding)||0;return[0,te.rangeStep*rg(se,ye,he)]}(k,g,x);else if(g.scheme&&(V=function(X,te,se){var he,ye,Pe=te.schemeExtent;return Object(ke.B)(te.scheme)?ye=If(te.scheme,te.interpolate,te.interpolateGamma):(he=te.scheme.toLowerCase(),(ye=d0(he))||Object(ke.o)("Unrecognized scheme name: ".concat(te.scheme))),se=X===ul?se+1:X===cl?se-1:X===Pd||X===Ul?+te.schemeCount||aq:se,sg(X)?R5(ye,Pe,te.reverse):Object(ke.E)(ye)?lg(R5(ye,Pe),se):X===Ld?ye:ye.slice(0,se)}(k,g,x),Object(ke.E)(V))){if(f.interpolator)return f.interpolator(V);Object(ke.o)("Scale type ".concat(k," does not support interpolating color schemes."))}if(V&&sg(k))return f.interpolator(If(fT(V,g.reverse),g.interpolate,g.interpolateGamma));V&&g.interpolate&&f.interpolate?f.interpolate(fg(g.interpolate,g.interpolateGamma)):Object(ke.E)(f.round)?f.round(F):Object(ke.E)(f.rangeRound)&&f.interpolate(F?oa:ha),V&&f.range(fT(V,g.reverse))}(i,e,function(f,g,x){let k=g.bins;if(k&&!Object(ke.B)(k)){const F=f.domain(),V=F[0],X=Object(ke.W)(F),te=k.step;let se=k.start==null?V:k.start,he=k.stop==null?X:k.stop;te||Object(ke.o)("Scale bins parameter missing step property."),se<V&&(se=te*Math.ceil(V/te)),he>X&&(he=te*Math.floor(X/te)),k=Ms(se,he+te/2,te)}return k?f.bins=k:f.bins&&delete f.bins,f.type===cl&&(k?g.domain||g.domainRaw||(f.domain(k),x=k.length):f.bins=f.domain()),x}(i,e,function(f,g,x){const k=function(he,ye,Pe){return ye?(he.domain(F5(he.type,ye,Pe)),ye.length):-1}(f,g.domainRaw,x);if(k>-1)return k;var F,V,X=g.domain,te=f.type,se=g.zero||g.zero===void 0&&function(he){const ye=he.type;return!he.bins&&(ye===Mf||ye===cm||ye===$h)}(f);if(!X)return 0;if(N5(te)&&g.padding&&X[0]!==Object(ke.W)(X)&&(X=function(he,ye,Pe,Ue,We,at){var st=Math.abs(Object(ke.W)(Pe)-Pe[0]),lt=st/(st-2*Ue),ct=he===zl?Object(ke.Oa)(ye,null,lt):he===$h?Object(ke.Pa)(ye,null,lt,.5):he===cm?Object(ke.Pa)(ye,null,lt,We||1):he===Rd?Object(ke.Qa)(ye,null,lt,at||1):Object(ke.Na)(ye,null,lt);return(ye=ye.slice())[0]=ct[0],ye[ye.length-1]=ct[1],ye}(te,X,g.range,g.padding,g.exponent,g.constant)),(se||g.domainMin!=null||g.domainMax!=null||g.domainMid!=null)&&(F=(X=X.slice()).length-1||1,se&&(X[0]>0&&(X[0]=0),X[F]<0&&(X[F]=0)),g.domainMin!=null&&(X[0]=g.domainMin),g.domainMax!=null&&(X[F]=g.domainMax),g.domainMid!=null)){const he=(V=g.domainMid)>X[F]?F+1:V<X[0]?0:F;he!==F&&x.warn("Scale domainMid exceeds domain min or max.",V),X.splice(he,0,V)}return f.domain(F5(te,X,x)),te===Ld&&f.unknown(g.domainImplicit?pc:void 0),g.nice&&f.nice&&f.nice(g.nice!==!0&&pm(f,g.nice)||null),X.length}(i,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),Object(ke.z)(P5,Tt,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(Er(e.sort)),this.modified(n),t}});const L5=["y0","y1"];function dT(e){Tt.call(this,null,e)}function uq(e,t,n,i,a){for(var f,g=(t-e.sum)/2,x=e.length,k=0;k<x;++k)(f=e[k])[i]=g,f[a]=g+=Math.abs(n(f))}function cq(e,t,n,i,a){for(var f,g=1/e.sum,x=0,k=e.length,F=0,V=0;F<k;++F)(f=e[F])[i]=x,f[a]=x=g*(V+=Math.abs(n(f)))}function lq(e,t,n,i,a){for(var f,g,x=0,k=0,F=e.length,V=0;V<F;++V)(f=+n(g=e[V]))<0?(g[i]=k,g[a]=k+=f):(g[i]=x,g[a]=x+=f)}dT.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:"zero",values:["zero","center","normalize"]},{name:"as",type:"string",array:!0,length:2,default:L5}]},Object(ke.z)(dT,Tt,{transform(e,t){var n,i,a,f,g=e.as||L5,x=g[0],k=g[1],F=Er(e.sort),V=e.field||ke.Q,X=e.offset==="center"?uq:e.offset==="normalize"?cq:lq;for(n=function(te,se,he,ye){var Pe,Ue,We,at,st,lt,ct,Ct,Et,gn=[],An=wn=>wn(st);if(se==null)gn.push(te.slice());else for(Pe={},Ue=0,We=te.length;Ue<We;++Ue)st=te[Ue],lt=se.map(An),(ct=Pe[lt])||(Pe[lt]=ct=[],gn.push(ct)),ct.push(st);for(lt=0,Et=0,at=gn.length;lt<at;++lt){for(ct=gn[lt],Ue=0,Ct=0,We=ct.length;Ue<We;++Ue)Ct+=Math.abs(ye(ct[Ue]));ct.sum=Ct,Ct>Et&&(Et=Ct),he&&ct.sort(he)}return gn.max=Et,gn}(t.source,e.groupby,F,V),i=0,a=n.length,f=n.max;i<a;++i)X(n[i],f,V,x,k);return t.reflow(e.modified()).modifies(g)}});var i_=e=>e;function s3(e,t){e&&j5.hasOwnProperty(e.type)&&j5[e.type](e,t)}var B5={Feature:function(e,t){s3(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,a=n.length;++i<a;)s3(n[i].geometry,t)}},j5={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,a=n.length;++i<a;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){hT(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,a=n.length;++i<a;)hT(n[i],t,0)},Polygon:function(e,t){z5(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,a=n.length;++i<a;)z5(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,a=n.length;++i<a;)s3(n[i],t)}};function hT(e,t,n){var i,a=-1,f=e.length-n;for(t.lineStart();++a<f;)i=e[a],t.point(i[0],i[1],i[2]);t.lineEnd()}function z5(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)hT(e[n],t,1);t.polygonEnd()}var Ly=function(e,t){e&&B5.hasOwnProperty(e.type)?B5[e.type](e,t):s3(e,t)};class Qd{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let i=0;for(let a=0;a<this._n&&a<32;a++){const f=n[a],g=t+f,x=Math.abs(t)<Math.abs(f)?t-(g-f):f-(g-t);x&&(n[i++]=x),t=g}return n[i]=t,this._n=i+1,this}valueOf(){const t=this._partials;let n,i,a,f=this._n,g=0;if(f>0){for(g=t[--f];f>0&&(n=g,!(a=(i=t[--f])-((g=n+i)-n))););f>0&&(a<0&&t[f-1]<0||a>0&&t[f-1]>0)&&(i=2*a)==(n=g+i)-g&&(g=n)}return g}}var ro=1e-6,Yo=Math.PI,Lu=Yo/2,u3=Yo/4,Zd=2*Yo,nc=180/Yo,Jo=Yo/180,Ea=Math.abs,vw=Math.atan,Cg=Math.atan2,uo=Math.cos,c3=Math.ceil,U5=Math.exp,pT=Math.hypot,l3=Math.log,mT=Math.pow,Xi=Math.sin,Ag=Math.sign||function(e){return e>0?1:e<0?-1:0},eh=Math.sqrt,gT=Math.tan;function W5(e){return e>1?0:e<-1?Yo:Math.acos(e)}function hp(e){return e>1?Lu:e<-1?-Lu:Math.asin(e)}function Ql(){}var V5,H5,vT,yT,bT=new Qd,xT=new Qd,H1={point:Ql,lineStart:Ql,lineEnd:Ql,polygonStart:function(){H1.lineStart=fq,H1.lineEnd=hq},polygonEnd:function(){H1.lineStart=H1.lineEnd=H1.point=Ql,bT.add(Ea(xT)),xT=new Qd},result:function(){var e=bT/2;return bT=new Qd,e}};function fq(){H1.point=dq}function dq(e,t){H1.point=G5,V5=vT=e,H5=yT=t}function G5(e,t){xT.add(yT*e-vT*t),vT=e,yT=t}function hq(){G5(V5,H5)}var q5=H1,yw=1/0,f3=yw,o_=-yw,d3=o_,$5,X5,$v,Xv,h3={point:function(e,t){e<yw&&(yw=e),e>o_&&(o_=e),t<f3&&(f3=t),t>d3&&(d3=t)},lineStart:Ql,lineEnd:Ql,polygonStart:Ql,polygonEnd:Ql,result:function(){var e=[[yw,f3],[o_,d3]];return o_=d3=-(f3=yw=1/0),e}},wT=0,_T=0,a_=0,p3=0,m3=0,bw=0,ET=0,ST=0,s_=0,k0={point:$b,lineStart:K5,lineEnd:Y5,polygonStart:function(){k0.lineStart=gq,k0.lineEnd=vq},polygonEnd:function(){k0.point=$b,k0.lineStart=K5,k0.lineEnd=Y5},result:function(){var e=s_?[ET/s_,ST/s_]:bw?[p3/bw,m3/bw]:a_?[wT/a_,_T/a_]:[NaN,NaN];return wT=_T=a_=p3=m3=bw=ET=ST=s_=0,e}};function $b(e,t){wT+=e,_T+=t,++a_}function K5(){k0.point=pq}function pq(e,t){k0.point=mq,$b($v=e,Xv=t)}function mq(e,t){var n=e-$v,i=t-Xv,a=eh(n*n+i*i);p3+=a*($v+e)/2,m3+=a*(Xv+t)/2,bw+=a,$b($v=e,Xv=t)}function Y5(){k0.point=$b}function gq(){k0.point=yq}function vq(){J5($5,X5)}function yq(e,t){k0.point=J5,$b($5=$v=e,X5=Xv=t)}function J5(e,t){var n=e-$v,i=t-Xv,a=eh(n*n+i*i);p3+=a*($v+e)/2,m3+=a*(Xv+t)/2,bw+=a,ET+=(a=Xv*e-$v*t)*($v+e),ST+=a*(Xv+t),s_+=3*a,$b($v=e,Xv=t)}var Q5=k0;function Z5(e){this._context=e}Z5.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Zd)}},result:Ql};var kT,e6,t6,u_,c_,CT=new Qd,g3={point:Ql,lineStart:function(){g3.point=bq},lineEnd:function(){kT&&n6(e6,t6),g3.point=Ql},polygonStart:function(){kT=!0},polygonEnd:function(){kT=null},result:function(){var e=+CT;return CT=new Qd,e}};function bq(e,t){g3.point=n6,e6=u_=e,t6=c_=t}function n6(e,t){u_-=e,c_-=t,CT.add(eh(u_*u_+c_*c_)),u_=e,c_=t}var r6=g3;function i6(){this._string=[]}function o6(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}i6.prototype={_radius:4.5,_circle:o6(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._string.push("M",e,",",t),this._point=1;break;case 1:this._string.push("L",e,",",t);break;default:this._circle==null&&(this._circle=o6(this._radius)),this._string.push("M",e,",",t,this._circle)}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}return null}};var a6=function(e,t){var n,i,a=4.5;function f(g){return g&&(typeof a=="function"&&i.pointRadius(+a.apply(this,arguments)),Ly(g,n(i))),i.result()}return f.area=function(g){return Ly(g,n(q5)),q5.result()},f.measure=function(g){return Ly(g,n(r6)),r6.result()},f.bounds=function(g){return Ly(g,n(h3)),h3.result()},f.centroid=function(g){return Ly(g,n(Q5)),Q5.result()},f.projection=function(g){return arguments.length?(n=g==null?(e=null,i_):(e=g).stream,f):e},f.context=function(g){return arguments.length?(i=g==null?(t=null,new i6):new Z5(t=g),typeof a!="function"&&i.pointRadius(a),f):t},f.pointRadius=function(g){return arguments.length?(a=typeof g=="function"?g:(i.pointRadius(+g),+g),f):a},f.projection(e).context(t)},s6=function(){var e,t=[];return{point:function(n,i,a){e.push([n,i,a])},lineStart:function(){t.push(e=[])},lineEnd:Ql,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}},v3=function(e,t){return Ea(e[0]-t[0])<ro&&Ea(e[1]-t[1])<ro};function y3(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}var u6=function(e,t,n,i,a){var f,g,x=[],k=[];if(e.forEach(function(he){if(!((ye=he.length-1)<=0)){var ye,Pe,Ue=he[0],We=he[ye];if(v3(Ue,We)){if(!Ue[2]&&!We[2]){for(a.lineStart(),f=0;f<ye;++f)a.point((Ue=he[f])[0],Ue[1]);return void a.lineEnd()}We[0]+=2*ro}x.push(Pe=new y3(Ue,he,null,!0)),k.push(Pe.o=new y3(Ue,null,Pe,!1)),x.push(Pe=new y3(We,he,null,!1)),k.push(Pe.o=new y3(We,null,Pe,!0))}}),x.length){for(k.sort(t),c6(x),c6(k),f=0,g=k.length;f<g;++f)k[f].e=n=!n;for(var F,V,X=x[0];;){for(var te=X,se=!0;te.v;)if((te=te.n)===X)return;F=te.z,a.lineStart();do{if(te.v=te.o.v=!0,te.e){if(se)for(f=0,g=F.length;f<g;++f)a.point((V=F[f])[0],V[1]);else i(te.x,te.n.x,1,a);te=te.n}else{if(se)for(F=te.p.z,f=F.length-1;f>=0;--f)a.point((V=F[f])[0],V[1]);else i(te.x,te.p.x,-1,a);te=te.p}F=(te=te.o).z,se=!se}while(!te.v);a.lineEnd()}}};function c6(e){if(t=e.length){for(var t,n,i=0,a=e[0];++i<t;)a.n=n=e[i],n.p=a,a=n;a.n=n=e[0],n.p=a}}function b3(e){return[Cg(e[1],e[0]),hp(e[2])]}function Xb(e){var t=e[0],n=e[1],i=uo(n);return[i*uo(t),i*Xi(t),Xi(n)]}function x3(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function xw(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function AT(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function w3(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function _3(e){var t=eh(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function OT(e){return Ea(e[0])<=Yo?e[0]:Ag(e[0])*((Ea(e[0])+Yo)%Zd-Yo)}function l6(e){return Array.from(function*(t){for(const n of t)yield*n}(e))}var f6=function(e,t,n,i){return function(a){var f,g,x,k=t(a),F=s6(),V=t(F),X=!1,te={point:se,lineStart:ye,lineEnd:Pe,polygonStart:function(){te.point=Ue,te.lineStart=We,te.lineEnd=at,g=[],f=[]},polygonEnd:function(){te.point=se,te.lineStart=ye,te.lineEnd=Pe,g=l6(g);var st=function(lt,ct){var Ct=OT(ct),Et=ct[1],gn=Xi(Et),An=[Xi(Ct),-uo(Ct),0],wn=0,$n=0,qn=new Qd;gn===1?Et=Lu+ro:gn===-1&&(Et=-Lu-ro);for(var er=0,rr=lt.length;er<rr;++er)if(Or=(lr=lt[er]).length)for(var lr,Or,Jr=lr[Or-1],Lr=OT(Jr),li=Jr[1]/2+u3,Ai=Xi(li),Ti=uo(li),Ji=0;Ji<Or;++Ji,Lr=Mi,Ai=Co,Ti=ca,Jr=Ii){var Ii=lr[Ji],Mi=OT(Ii),ji=Ii[1]/2+u3,Co=Xi(ji),ca=uo(ji),Qi=Mi-Lr,Ca=Qi>=0?1:-1,Aa=Ca*Qi,es=Aa>Yo,Vs=Ai*Co;if(qn.add(Cg(Vs*Ca*Xi(Aa),Ti*ca+Vs*uo(Aa))),wn+=es?Qi+Ca*Zd:Qi,es^Lr>=Ct^Mi>=Ct){var Hs=xw(Xb(Jr),Xb(Ii));_3(Hs);var Os=xw(An,Hs);_3(Os);var rf=(es^Qi>=0?-1:1)*hp(Os[2]);(Et>rf||Et===rf&&(Hs[0]||Hs[1]))&&($n+=es^Qi>=0?1:-1)}}return(wn<-ro||wn<ro&&qn<-1e-12)^1&$n}(f,i);g.length?(X||(a.polygonStart(),X=!0),u6(g,wq,st,n,a)):st&&(X||(a.polygonStart(),X=!0),a.lineStart(),n(null,null,1,a),a.lineEnd()),X&&(a.polygonEnd(),X=!1),g=f=null},sphere:function(){a.polygonStart(),a.lineStart(),n(null,null,1,a),a.lineEnd(),a.polygonEnd()}};function se(st,lt){e(st,lt)&&a.point(st,lt)}function he(st,lt){k.point(st,lt)}function ye(){te.point=he,k.lineStart()}function Pe(){te.point=se,k.lineEnd()}function Ue(st,lt){x.push([st,lt]),V.point(st,lt)}function We(){V.lineStart(),x=[]}function at(){Ue(x[0][0],x[0][1]),V.lineEnd();var st,lt,ct,Ct,Et=V.clean(),gn=F.result(),An=gn.length;if(x.pop(),f.push(x),x=null,An)if(1&Et){if((lt=(ct=gn[0]).length-1)>0){for(X||(a.polygonStart(),X=!0),a.lineStart(),st=0;st<lt;++st)a.point((Ct=ct[st])[0],Ct[1]);a.lineEnd()}}else An>1&&2&Et&&gn.push(gn.pop().concat(gn.shift())),g.push(gn.filter(xq))}return te}};function xq(e){return e.length>1}function wq(e,t){return((e=e.x)[0]<0?e[1]-Lu-ro:Lu-e[1])-((t=t.x)[0]<0?t[1]-Lu-ro:Lu-t[1])}var d6=f6(function(){return!0},function(e){var t,n=NaN,i=NaN,a=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(f,g){var x=f>0?Yo:-Yo,k=Ea(f-n);Ea(k-Yo)<ro?(e.point(n,i=(i+g)/2>0?Lu:-Lu),e.point(a,i),e.lineEnd(),e.lineStart(),e.point(x,i),e.point(f,i),t=0):a!==x&&k>=Yo&&(Ea(n-a)<ro&&(n-=a*ro),Ea(f-x)<ro&&(f-=x*ro),i=function(F,V,X,te){var se,he,ye=Xi(F-X);return Ea(ye)>ro?vw((Xi(V)*(he=uo(te))*Xi(X)-Xi(te)*(se=uo(V))*Xi(F))/(se*he*ye)):(V+te)/2}(n,i,f,g),e.point(a,i),e.lineEnd(),e.lineStart(),e.point(x,i),t=0),e.point(n=f,i=g),a=x},lineEnd:function(){e.lineEnd(),n=i=NaN},clean:function(){return 2-t}}},function(e,t,n,i){var a;if(e==null)a=n*Lu,i.point(-Yo,a),i.point(0,a),i.point(Yo,a),i.point(Yo,0),i.point(Yo,-a),i.point(0,-a),i.point(-Yo,-a),i.point(-Yo,0),i.point(-Yo,a);else if(Ea(e[0]-t[0])>ro){var f=e[0]<t[0]?Yo:-Yo;a=n*f/2,i.point(-f,a),i.point(0,a),i.point(f,a)}else i.point(t[0],t[1])},[-Yo,-Lu]),TT=function(e,t){function n(i,a){return i=e(i,a),t(i[0],i[1])}return e.invert&&t.invert&&(n.invert=function(i,a){return(i=t.invert(i,a))&&e.invert(i[0],i[1])}),n};function MT(e,t){return[Ea(e)>Yo?e+Math.round(-e/Zd)*Zd:e,t]}function h6(e,t,n){return(e%=Zd)?t||n?TT(m6(e),g6(t,n)):m6(e):t||n?g6(t,n):MT}function p6(e){return function(t,n){return[(t+=e)>Yo?t-Zd:t<-Yo?t+Zd:t,n]}}function m6(e){var t=p6(e);return t.invert=p6(-e),t}function g6(e,t){var n=uo(e),i=Xi(e),a=uo(t),f=Xi(t);function g(x,k){var F=uo(k),V=uo(x)*F,X=Xi(x)*F,te=Xi(k),se=te*n+V*i;return[Cg(X*a-se*f,V*n-te*i),hp(se*a+X*f)]}return g.invert=function(x,k){var F=uo(k),V=uo(x)*F,X=Xi(x)*F,te=Xi(k),se=te*a-X*f;return[Cg(X*a+te*f,V*n+se*i),hp(se*n-V*i)]},g}MT.invert=MT;var _q=function(e){function t(n){return(n=e(n[0]*Jo,n[1]*Jo))[0]*=nc,n[1]*=nc,n}return e=h6(e[0]*Jo,e[1]*Jo,e.length>2?e[2]*Jo:0),t.invert=function(n){return(n=e.invert(n[0]*Jo,n[1]*Jo))[0]*=nc,n[1]*=nc,n},t};function Eq(e,t,n,i,a,f){if(n){var g=uo(t),x=Xi(t),k=i*n;a==null?(a=t+i*Zd,f=t-k/2):(a=v6(g,a),f=v6(g,f),(i>0?a<f:a>f)&&(a+=i*Zd));for(var F,V=a;i>0?V>f:V<f;V-=k)F=b3([g,-x*uo(V),-x*Xi(V)]),e.point(F[0],F[1])}}function v6(e,t){(t=Xb(t))[0]-=e,_3(t);var n=W5(-t[1]);return((-t[2]<0?-n:n)+Zd-ro)%Zd}var Sq=function(e){var t=uo(e),n=6*Jo,i=t>0,a=Ea(t)>ro;function f(k,F){return uo(k)*uo(F)>t}function g(k,F,V){var X=[1,0,0],te=xw(Xb(k),Xb(F)),se=x3(te,te),he=te[0],ye=se-he*he;if(!ye)return!V&&k;var Pe=t*se/ye,Ue=-t*he/ye,We=xw(X,te),at=w3(X,Pe);AT(at,w3(te,Ue));var st=We,lt=x3(at,st),ct=x3(st,st),Ct=lt*lt-ct*(x3(at,at)-1);if(!(Ct<0)){var Et=eh(Ct),gn=w3(st,(-lt-Et)/ct);if(AT(gn,at),gn=b3(gn),!V)return gn;var An,wn=k[0],$n=F[0],qn=k[1],er=F[1];$n<wn&&(An=wn,wn=$n,$n=An);var rr=$n-wn,lr=Ea(rr-Yo)<ro;if(!lr&&er<qn&&(An=qn,qn=er,er=An),lr||rr<ro?lr?qn+er>0^gn[1]<(Ea(gn[0]-wn)<ro?qn:er):qn<=gn[1]&&gn[1]<=er:rr>Yo^(wn<=gn[0]&&gn[0]<=$n)){var Or=w3(st,(-lt+Et)/ct);return AT(Or,at),[gn,b3(Or)]}}}function x(k,F){var V=i?e:Yo-e,X=0;return k<-V?X|=1:k>V&&(X|=2),F<-V?X|=4:F>V&&(X|=8),X}return f6(f,function(k){var F,V,X,te,se;return{lineStart:function(){te=X=!1,se=1},point:function(he,ye){var Pe,Ue=[he,ye],We=f(he,ye),at=i?We?0:x(he,ye):We?x(he+(he<0?Yo:-Yo),ye):0;if(!F&&(te=X=We)&&k.lineStart(),We!==X&&(!(Pe=g(F,Ue))||v3(F,Pe)||v3(Ue,Pe))&&(Ue[2]=1),We!==X)se=0,We?(k.lineStart(),Pe=g(Ue,F),k.point(Pe[0],Pe[1])):(Pe=g(F,Ue),k.point(Pe[0],Pe[1],2),k.lineEnd()),F=Pe;else if(a&&F&&i^We){var st;at&V||!(st=g(Ue,F,!0))||(se=0,i?(k.lineStart(),k.point(st[0][0],st[0][1]),k.point(st[1][0],st[1][1]),k.lineEnd()):(k.point(st[1][0],st[1][1]),k.lineEnd(),k.lineStart(),k.point(st[0][0],st[0][1],3)))}!We||F&&v3(F,Ue)||k.point(Ue[0],Ue[1]),F=Ue,X=We,V=at},lineEnd:function(){X&&k.lineEnd(),F=null},clean:function(){return se|(te&&X)<<1}}},function(k,F,V,X){Eq(X,e,n,V,k,F)},i?[0,-e]:[-Yo,e-Yo])},kq=function(e,t,n,i,a,f){var g,x=e[0],k=e[1],F=0,V=1,X=t[0]-x,te=t[1]-k;if(g=n-x,X||!(g>0)){if(g/=X,X<0){if(g<F)return;g<V&&(V=g)}else if(X>0){if(g>V)return;g>F&&(F=g)}if(g=a-x,X||!(g<0)){if(g/=X,X<0){if(g>V)return;g>F&&(F=g)}else if(X>0){if(g<F)return;g<V&&(V=g)}if(g=i-k,te||!(g>0)){if(g/=te,te<0){if(g<F)return;g<V&&(V=g)}else if(te>0){if(g>V)return;g>F&&(F=g)}if(g=f-k,te||!(g<0)){if(g/=te,te<0){if(g>V)return;g>F&&(F=g)}else if(te>0){if(g<F)return;g<V&&(V=g)}return F>0&&(e[0]=x+F*X,e[1]=k+F*te),V<1&&(t[0]=x+V*X,t[1]=k+V*te),!0}}}}},l_=1e9,E3=-l_;function y6(e,t,n,i){function a(F,V){return e<=F&&F<=n&&t<=V&&V<=i}function f(F,V,X,te){var se=0,he=0;if(F==null||(se=g(F,X))!==(he=g(V,X))||k(F,V)<0^X>0)do te.point(se===0||se===3?e:n,se>1?i:t);while((se=(se+X+4)%4)!==he);else te.point(V[0],V[1])}function g(F,V){return Ea(F[0]-e)<ro?V>0?0:3:Ea(F[0]-n)<ro?V>0?2:1:Ea(F[1]-t)<ro?V>0?1:0:V>0?3:2}function x(F,V){return k(F.x,V.x)}function k(F,V){var X=g(F,1),te=g(V,1);return X!==te?X-te:X===0?V[1]-F[1]:X===1?F[0]-V[0]:X===2?F[1]-V[1]:V[0]-F[0]}return function(F){var V,X,te,se,he,ye,Pe,Ue,We,at,st,lt=F,ct=s6(),Ct={point:Et,lineStart:function(){Ct.point=gn,X&&X.push(te=[]),at=!0,We=!1,Pe=Ue=NaN},lineEnd:function(){V&&(gn(se,he),ye&&We&&ct.rejoin(),V.push(ct.result())),Ct.point=Et,We&&lt.lineEnd()},polygonStart:function(){lt=ct,V=[],X=[],st=!0},polygonEnd:function(){var An=function(){for(var qn=0,er=0,rr=X.length;er<rr;++er)for(var lr,Or,Jr=X[er],Lr=1,li=Jr.length,Ai=Jr[0],Ti=Ai[0],Ji=Ai[1];Lr<li;++Lr)lr=Ti,Or=Ji,Ai=Jr[Lr],Ti=Ai[0],Ji=Ai[1],Or<=i?Ji>i&&(Ti-lr)*(i-Or)>(Ji-Or)*(e-lr)&&++qn:Ji<=i&&(Ti-lr)*(i-Or)<(Ji-Or)*(e-lr)&&--qn;return qn}(),wn=st&&An,$n=(V=l6(V)).length;(wn||$n)&&(F.polygonStart(),wn&&(F.lineStart(),f(null,null,1,F),F.lineEnd()),$n&&u6(V,x,An,f,F),F.polygonEnd()),lt=F,V=X=te=null}};function Et(An,wn){a(An,wn)&&lt.point(An,wn)}function gn(An,wn){var $n=a(An,wn);if(X&&te.push([An,wn]),at)se=An,he=wn,ye=$n,at=!1,$n&&(lt.lineStart(),lt.point(An,wn));else if($n&&We)lt.point(An,wn);else{var qn=[Pe=Math.max(E3,Math.min(l_,Pe)),Ue=Math.max(E3,Math.min(l_,Ue))],er=[An=Math.max(E3,Math.min(l_,An)),wn=Math.max(E3,Math.min(l_,wn))];kq(qn,er,e,t,n,i)?(We||(lt.lineStart(),lt.point(qn[0],qn[1])),lt.point(er[0],er[1]),$n||lt.lineEnd(),st=!1):$n&&(lt.lineStart(),lt.point(An,wn),st=!1)}Pe=An,Ue=wn,We=$n}return Ct}}function S3(e){return function(t){var n=new DT;for(var i in e)n[i]=e[i];return n.stream=t,n}}function DT(){}function NT(e,t,n){var i=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),i!=null&&e.clipExtent(null),Ly(n,e.stream(h3)),t(h3.result()),i!=null&&e.clipExtent(i),e}function k3(e,t,n){return NT(e,function(i){var a=t[1][0]-t[0][0],f=t[1][1]-t[0][1],g=Math.min(a/(i[1][0]-i[0][0]),f/(i[1][1]-i[0][1])),x=+t[0][0]+(a-g*(i[1][0]+i[0][0]))/2,k=+t[0][1]+(f-g*(i[1][1]+i[0][1]))/2;e.scale(150*g).translate([x,k])},n)}function IT(e,t,n){return k3(e,[[0,0],t],n)}function FT(e,t,n){return NT(e,function(i){var a=+t,f=a/(i[1][0]-i[0][0]),g=(a-f*(i[1][0]+i[0][0]))/2,x=-f*i[0][1];e.scale(150*f).translate([g,x])},n)}function RT(e,t,n){return NT(e,function(i){var a=+t,f=a/(i[1][1]-i[0][1]),g=-f*i[0][0],x=(a-f*(i[1][1]+i[0][1]))/2;e.scale(150*f).translate([g,x])},n)}DT.prototype={constructor:DT,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var b6=16,Cq=uo(30*Jo),x6=function(e,t){return+t?function(n,i){function a(f,g,x,k,F,V,X,te,se,he,ye,Pe,Ue,We){var at=X-f,st=te-g,lt=at*at+st*st;if(lt>4*i&&Ue--){var ct=k+he,Ct=F+ye,Et=V+Pe,gn=eh(ct*ct+Ct*Ct+Et*Et),An=hp(Et/=gn),wn=Ea(Ea(Et)-1)<ro||Ea(x-se)<ro?(x+se)/2:Cg(Ct,ct),$n=n(wn,An),qn=$n[0],er=$n[1],rr=qn-f,lr=er-g,Or=st*rr-at*lr;(Or*Or/lt>i||Ea((at*rr+st*lr)/lt-.5)>.3||k*he+F*ye+V*Pe<Cq)&&(a(f,g,x,k,F,V,qn,er,wn,ct/=gn,Ct/=gn,Et,Ue,We),We.point(qn,er),a(qn,er,wn,ct,Ct,Et,X,te,se,he,ye,Pe,Ue,We))}}return function(f){var g,x,k,F,V,X,te,se,he,ye,Pe,Ue,We={point:at,lineStart:st,lineEnd:ct,polygonStart:function(){f.polygonStart(),We.lineStart=Ct},polygonEnd:function(){f.polygonEnd(),We.lineStart=st}};function at(An,wn){An=n(An,wn),f.point(An[0],An[1])}function st(){se=NaN,We.point=lt,f.lineStart()}function lt(An,wn){var $n=Xb([An,wn]),qn=n(An,wn);a(se,he,te,ye,Pe,Ue,se=qn[0],he=qn[1],te=An,ye=$n[0],Pe=$n[1],Ue=$n[2],b6,f),f.point(se,he)}function ct(){We.point=at,f.lineEnd()}function Ct(){st(),We.point=Et,We.lineEnd=gn}function Et(An,wn){lt(g=An,wn),x=se,k=he,F=ye,V=Pe,X=Ue,We.point=lt}function gn(){a(se,he,te,ye,Pe,Ue,x,k,g,F,V,X,b6,f),We.lineEnd=ct,ct()}return We}}(e,t):function(n){return S3({point:function(i,a){i=n(i,a),this.stream.point(i[0],i[1])}})}(e)},Aq=S3({point:function(e,t){this.stream.point(e*Jo,t*Jo)}});function w6(e,t,n,i,a,f){if(!f)return function(ye,Pe,Ue,We,at){function st(lt,ct){return[Pe+ye*(lt*=We),Ue-ye*(ct*=at)]}return st.invert=function(lt,ct){return[(lt-Pe)/ye*We,(Ue-ct)/ye*at]},st}(e,t,n,i,a);var g=uo(f),x=Xi(f),k=g*e,F=x*e,V=g/e,X=x/e,te=(x*n-g*t)/e,se=(x*t+g*n)/e;function he(ye,Pe){return[k*(ye*=i)-F*(Pe*=a)+t,n-F*ye-k*Pe]}return he.invert=function(ye,Pe){return[i*(V*ye-X*Pe+te),a*(se-X*ye-V*Pe)]},he}function Kv(e){return _6(function(){return e})()}function _6(e){var t,n,i,a,f,g,x,k,F,V,X=150,te=480,se=250,he=0,ye=0,Pe=0,Ue=0,We=0,at=0,st=1,lt=1,ct=null,Ct=d6,Et=null,gn=i_,An=.5;function wn(rr){return k(rr[0]*Jo,rr[1]*Jo)}function $n(rr){return(rr=k.invert(rr[0],rr[1]))&&[rr[0]*nc,rr[1]*nc]}function qn(){var rr=w6(X,0,0,st,lt,at).apply(null,t(he,ye)),lr=w6(X,te-rr[0],se-rr[1],st,lt,at);return n=h6(Pe,Ue,We),x=TT(t,lr),k=TT(n,x),g=x6(x,An),er()}function er(){return F=V=null,wn}return wn.stream=function(rr){return F&&V===rr?F:F=Aq(function(lr){return S3({point:function(Or,Jr){var Lr=lr(Or,Jr);return this.stream.point(Lr[0],Lr[1])}})}(n)(Ct(g(gn(V=rr)))))},wn.preclip=function(rr){return arguments.length?(Ct=rr,ct=void 0,er()):Ct},wn.postclip=function(rr){return arguments.length?(gn=rr,Et=i=a=f=null,er()):gn},wn.clipAngle=function(rr){return arguments.length?(Ct=+rr?Sq(ct=rr*Jo):(ct=null,d6),er()):ct*nc},wn.clipExtent=function(rr){return arguments.length?(gn=rr==null?(Et=i=a=f=null,i_):y6(Et=+rr[0][0],i=+rr[0][1],a=+rr[1][0],f=+rr[1][1]),er()):Et==null?null:[[Et,i],[a,f]]},wn.scale=function(rr){return arguments.length?(X=+rr,qn()):X},wn.translate=function(rr){return arguments.length?(te=+rr[0],se=+rr[1],qn()):[te,se]},wn.center=function(rr){return arguments.length?(he=rr[0]%360*Jo,ye=rr[1]%360*Jo,qn()):[he*nc,ye*nc]},wn.rotate=function(rr){return arguments.length?(Pe=rr[0]%360*Jo,Ue=rr[1]%360*Jo,We=rr.length>2?rr[2]%360*Jo:0,qn()):[Pe*nc,Ue*nc,We*nc]},wn.angle=function(rr){return arguments.length?(at=rr%360*Jo,qn()):at*nc},wn.reflectX=function(rr){return arguments.length?(st=rr?-1:1,qn()):st<0},wn.reflectY=function(rr){return arguments.length?(lt=rr?-1:1,qn()):lt<0},wn.precision=function(rr){return arguments.length?(g=x6(x,An=rr*rr),er()):eh(An)},wn.fitExtent=function(rr,lr){return k3(wn,rr,lr)},wn.fitSize=function(rr,lr){return IT(wn,rr,lr)},wn.fitWidth=function(rr,lr){return FT(wn,rr,lr)},wn.fitHeight=function(rr,lr){return RT(wn,rr,lr)},function(){return t=e.apply(this,arguments),wn.invert=t.invert&&$n,qn()}}function PT(e){var t=0,n=Yo/3,i=_6(e),a=i(t,n);return a.parallels=function(f){return arguments.length?i(t=f[0]*Jo,n=f[1]*Jo):[t*nc,n*nc]},a}function Oq(e,t){var n=Xi(e),i=(n+Xi(t))/2;if(Ea(i)<ro)return function(x){var k=uo(x);function F(V,X){return[V*k,Xi(X)/k]}return F.invert=function(V,X){return[V/k,hp(X*k)]},F}(e);var a=1+n*(2*i-n),f=eh(a)/i;function g(x,k){var F=eh(a-2*i*Xi(k))/i;return[F*Xi(x*=i),f-F*uo(x)]}return g.invert=function(x,k){var F=f-k,V=Cg(x,Ea(F))*Ag(F);return F*i<0&&(V-=Yo*Ag(x)*Ag(F)),[V/i,hp((a-(x*x+F*F)*i*i)/(2*i))]},g}var C3=function(){return PT(Oq).scale(155.424).center([0,33.6442])},E6=function(){return C3().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])};function S6(e){return function(t,n){var i=uo(t),a=uo(n),f=e(i*a);return f===1/0?[2,0]:[f*a*Xi(t),f*Xi(n)]}}function f_(e){return function(t,n){var i=eh(t*t+n*n),a=e(i),f=Xi(a),g=uo(a);return[Cg(t*f,i*g),hp(i&&n*f/i)]}}var k6=S6(function(e){return eh(2/(1+e))});k6.invert=f_(function(e){return 2*hp(e/2)});var C6=S6(function(e){return(e=W5(e))&&e/Xi(e)});C6.invert=f_(function(e){return e});function A3(e,t){return[e,l3(gT((Lu+t)/2))]}A3.invert=function(e,t){return[e,2*vw(U5(t))-Lu]};function A6(e){var t,n,i,a=Kv(e),f=a.center,g=a.scale,x=a.translate,k=a.clipExtent,F=null;function V(){var X=Yo*g(),te=a(_q(a.rotate()).invert([0,0]));return k(F==null?[[te[0]-X,te[1]-X],[te[0]+X,te[1]+X]]:e===A3?[[Math.max(te[0]-X,F),t],[Math.min(te[0]+X,n),i]]:[[F,Math.max(te[1]-X,t)],[n,Math.min(te[1]+X,i)]])}return a.scale=function(X){return arguments.length?(g(X),V()):g()},a.translate=function(X){return arguments.length?(x(X),V()):x()},a.center=function(X){return arguments.length?(f(X),V()):f()},a.clipExtent=function(X){return arguments.length?(X==null?F=t=n=i=null:(F=+X[0][0],t=+X[0][1],n=+X[1][0],i=+X[1][1]),V()):F==null?null:[[F,t],[n,i]]},V()}function O3(e){return gT((Lu+e)/2)}function Tq(e,t){var n=uo(e),i=e===t?Xi(e):l3(n/uo(t))/l3(O3(t)/O3(e)),a=n*mT(O3(e),i)/i;if(!i)return A3;function f(g,x){a>0?x<-Lu+ro&&(x=-Lu+ro):x>Lu-ro&&(x=Lu-ro);var k=a/mT(O3(x),i);return[k*Xi(i*g),a-k*uo(i*g)]}return f.invert=function(g,x){var k=a-x,F=Ag(i)*eh(g*g+k*k),V=Cg(g,Ea(k))*Ag(k);return k*i<0&&(V-=Yo*Ag(g)*Ag(k)),[V/i,2*vw(mT(a/F,1/i))-Lu]},f}function T3(e,t){return[e,t]}T3.invert=T3;function Mq(e,t){var n=uo(e),i=e===t?Xi(e):(n-uo(t))/(t-e),a=n/i+e;if(Ea(i)<ro)return T3;function f(g,x){var k=a-x,F=i*g;return[k*Xi(F),a-k*uo(F)]}return f.invert=function(g,x){var k=a-x,F=Cg(g,Ea(k))*Ag(k);return k*i<0&&(F-=Yo*Ag(g)*Ag(k)),[F/i,a-Ag(i)*eh(g*g+k*k)]},f}var d_=1.340264,h_=-.081106,p_=893e-6,m_=.003796,M3=eh(3)/2;function O6(e,t){var n=hp(M3*Xi(t)),i=n*n,a=i*i*i;return[e*uo(n)/(M3*(d_+3*h_*i+a*(7*p_+9*m_*i))),n*(d_+h_*i+a*(p_+m_*i))]}O6.invert=function(e,t){for(var n,i=t,a=i*i,f=a*a*a,g=0;g<12&&(f=(a=(i-=n=(i*(d_+h_*a+f*(p_+m_*a))-t)/(d_+3*h_*a+f*(7*p_+9*m_*a)))*i)*a*a,!(Ea(n)<1e-12));++g);return[M3*e*(d_+3*h_*a+f*(7*p_+9*m_*a))/uo(i),hp(Xi(i)/M3)]};function T6(e,t){var n=uo(t),i=uo(e)*n;return[n*Xi(e)/i,Xi(t)/i]}T6.invert=f_(vw);function M6(e,t){var n=t*t,i=n*n;return[e*(.8707-.131979*n+i*(i*(.003971*n-.001529*i)-.013791)),t*(1.007226+n*(.015085+i*(.028874*n-.044475-.005916*i)))]}M6.invert=function(e,t){var n,i=t,a=25;do{var f=i*i,g=f*f;i-=n=(i*(1.007226+f*(.015085+g*(.028874*f-.044475-.005916*g)))-t)/(1.007226+f*(.045255+g*(.259866*f-.311325-.005916*11*g)))}while(Ea(n)>ro&&--a>0);return[e/(.8707+(f=i*i)*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979)),i]};function D6(e,t){return[uo(t)*Xi(e),Xi(t)]}D6.invert=f_(hp);function N6(e,t){var n=uo(t),i=1+uo(e)*n;return[n*Xi(e)/i,Xi(t)/i]}N6.invert=f_(function(e){return 2*vw(e)});function I6(e,t){return[l3(gT((Lu+t)/2)),-e]}I6.invert=function(e,t){return[-t,2*vw(U5(e))-Lu]};var Dq=Math.abs,LT=Math.cos,D3=Math.sin,Nq=1e-6,F6=Math.PI,BT=F6/2,R6=Iq(2);function P6(e){return e>1?BT:e<-1?-BT:Math.asin(e)}function Iq(e){return e>0?Math.sqrt(e):0}var Fq=function(e,t,n){function i(a,f){return[e*a*LT(f=function(g,x){var k,F=g*D3(x),V=30;do x-=k=(x+D3(x)-F)/(1+LT(x));while(Dq(k)>Nq&&--V>0);return x/2}(n,f)),t*D3(f)]}return i.invert=function(a,f){return f=P6(f/t),[a/(e*LT(f)),P6((2*f+D3(2*f))/n)]},i}(R6/BT,R6,F6);const Rq=a6(),jT=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function zT(e,t){if(!e||typeof e!="string")throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(N3[e]=function(n,i){return function a(){const f=i();return f.type=n,f.path=a6().projection(f),f.copy=f.copy||function(){const g=a();return jT.forEach(x=>{f[x]&&g[x](f[x]())}),g.path.pointRadius(f.path.pointRadius()),g},f}}(e,t),this):N3[e]||null}function L6(e){return e&&e.path||Rq}const N3={albers:E6,albersusa:function(){var e,t,n,i,a,f,g=E6(),x=C3().rotate([154,0]).center([-2,58.5]).parallels([55,65]),k=C3().rotate([157,0]).center([-3,19.9]).parallels([8,18]),F={point:function(te,se){f=[te,se]}};function V(te){var se=te[0],he=te[1];return f=null,n.point(se,he),f||(i.point(se,he),f)||(a.point(se,he),f)}function X(){return e=t=null,V}return V.invert=function(te){var se=g.scale(),he=g.translate(),ye=(te[0]-he[0])/se,Pe=(te[1]-he[1])/se;return(Pe>=.12&&Pe<.234&&ye>=-.425&&ye<-.214?x:Pe>=.166&&Pe<.234&&ye>=-.214&&ye<-.115?k:g).invert(te)},V.stream=function(te){return e&&t===te?e:e=function(se){var he=se.length;return{point:function(ye,Pe){for(var Ue=-1;++Ue<he;)se[Ue].point(ye,Pe)},sphere:function(){for(var ye=-1;++ye<he;)se[ye].sphere()},lineStart:function(){for(var ye=-1;++ye<he;)se[ye].lineStart()},lineEnd:function(){for(var ye=-1;++ye<he;)se[ye].lineEnd()},polygonStart:function(){for(var ye=-1;++ye<he;)se[ye].polygonStart()},polygonEnd:function(){for(var ye=-1;++ye<he;)se[ye].polygonEnd()}}}([g.stream(t=te),x.stream(te),k.stream(te)])},V.precision=function(te){return arguments.length?(g.precision(te),x.precision(te),k.precision(te),X()):g.precision()},V.scale=function(te){return arguments.length?(g.scale(te),x.scale(.35*te),k.scale(te),V.translate(g.translate())):g.scale()},V.translate=function(te){if(!arguments.length)return g.translate();var se=g.scale(),he=+te[0],ye=+te[1];return n=g.translate(te).clipExtent([[he-.455*se,ye-.238*se],[he+.455*se,ye+.238*se]]).stream(F),i=x.translate([he-.307*se,ye+.201*se]).clipExtent([[he-.425*se+ro,ye+.12*se+ro],[he-.214*se-ro,ye+.234*se-ro]]).stream(F),a=k.translate([he-.205*se,ye+.212*se]).clipExtent([[he-.214*se+ro,ye+.166*se+ro],[he-.115*se-ro,ye+.234*se-ro]]).stream(F),X()},V.fitExtent=function(te,se){return k3(V,te,se)},V.fitSize=function(te,se){return IT(V,te,se)},V.fitWidth=function(te,se){return FT(V,te,se)},V.fitHeight=function(te,se){return RT(V,te,se)},V.scale(1070)},azimuthalequalarea:function(){return Kv(k6).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return Kv(C6).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return PT(Tq).scale(109.5).parallels([30,30])},conicequalarea:C3,conicequidistant:function(){return PT(Mq).scale(131.154).center([0,13.9389])},equalEarth:function(){return Kv(O6).scale(177.158)},equirectangular:function(){return Kv(T3).scale(152.63)},gnomonic:function(){return Kv(T6).scale(144.049).clipAngle(60)},identity:function(){var e,t,n,i,a,f,g,x=1,k=0,F=0,V=1,X=1,te=0,se=null,he=1,ye=1,Pe=S3({point:function(st,lt){var ct=at([st,lt]);this.stream.point(ct[0],ct[1])}}),Ue=i_;function We(){return he=x*V,ye=x*X,f=g=null,at}function at(st){var lt=st[0]*he,ct=st[1]*ye;if(te){var Ct=ct*e-lt*t;lt=lt*e+ct*t,ct=Ct}return[lt+k,ct+F]}return at.invert=function(st){var lt=st[0]-k,ct=st[1]-F;if(te){var Ct=ct*e+lt*t;lt=lt*e-ct*t,ct=Ct}return[lt/he,ct/ye]},at.stream=function(st){return f&&g===st?f:f=Pe(Ue(g=st))},at.postclip=function(st){return arguments.length?(Ue=st,se=n=i=a=null,We()):Ue},at.clipExtent=function(st){return arguments.length?(Ue=st==null?(se=n=i=a=null,i_):y6(se=+st[0][0],n=+st[0][1],i=+st[1][0],a=+st[1][1]),We()):se==null?null:[[se,n],[i,a]]},at.scale=function(st){return arguments.length?(x=+st,We()):x},at.translate=function(st){return arguments.length?(k=+st[0],F=+st[1],We()):[k,F]},at.angle=function(st){return arguments.length?(t=Xi(te=st%360*Jo),e=uo(te),We()):te*nc},at.reflectX=function(st){return arguments.length?(V=st?-1:1,We()):V<0},at.reflectY=function(st){return arguments.length?(X=st?-1:1,We()):X<0},at.fitExtent=function(st,lt){return k3(at,st,lt)},at.fitSize=function(st,lt){return IT(at,st,lt)},at.fitWidth=function(st,lt){return FT(at,st,lt)},at.fitHeight=function(st,lt){return RT(at,st,lt)},at},mercator:function(){return A6(A3).scale(961/Zd)},mollweide:function(){return Kv(Fq).scale(169.529)},naturalEarth1:function(){return Kv(M6).scale(175.295)},orthographic:function(){return Kv(D6).scale(249.5).clipAngle(90+ro)},stereographic:function(){return Kv(N6).scale(250).clipAngle(142)},transversemercator:function(){var e=A6(I6),t=e.center,n=e.rotate;return e.center=function(i){return arguments.length?t([-i[1],i[0]]):[(i=t())[1],-i[0]]},e.rotate=function(i){return arguments.length?n([i[0],i[1],i.length>2?i[2]+90:90]):[(i=n())[0],i[1],i[2]-90]},n([0,0,90]).scale(159.155)}};for(const e in N3)zT(e,N3[e]);function B6(e,t,n){var i=Ms(e,t-ro,n).concat(t);return function(a){return i.map(function(f){return[a,f]})}}function j6(e,t,n){var i=Ms(e,t-ro,n).concat(t);return function(a){return i.map(function(f){return[f,a]})}}function Pq(){var e,t,n,i,a,f,g,x,k,F,V,X,te=10,se=te,he=90,ye=360,Pe=2.5;function Ue(){return{type:"MultiLineString",coordinates:We()}}function We(){return Ms(c3(i/he)*he,n,he).map(V).concat(Ms(c3(x/ye)*ye,g,ye).map(X)).concat(Ms(c3(t/te)*te,e,te).filter(function(at){return Ea(at%he)>ro}).map(k)).concat(Ms(c3(f/se)*se,a,se).filter(function(at){return Ea(at%ye)>ro}).map(F))}return Ue.lines=function(){return We().map(function(at){return{type:"LineString",coordinates:at}})},Ue.outline=function(){return{type:"Polygon",coordinates:[V(i).concat(X(g).slice(1),V(n).reverse().slice(1),X(x).reverse().slice(1))]}},Ue.extent=function(at){return arguments.length?Ue.extentMajor(at).extentMinor(at):Ue.extentMinor()},Ue.extentMajor=function(at){return arguments.length?(i=+at[0][0],n=+at[1][0],x=+at[0][1],g=+at[1][1],i>n&&(at=i,i=n,n=at),x>g&&(at=x,x=g,g=at),Ue.precision(Pe)):[[i,x],[n,g]]},Ue.extentMinor=function(at){return arguments.length?(t=+at[0][0],e=+at[1][0],f=+at[0][1],a=+at[1][1],t>e&&(at=t,t=e,e=at),f>a&&(at=f,f=a,a=at),Ue.precision(Pe)):[[t,f],[e,a]]},Ue.step=function(at){return arguments.length?Ue.stepMajor(at).stepMinor(at):Ue.stepMinor()},Ue.stepMajor=function(at){return arguments.length?(he=+at[0],ye=+at[1],Ue):[he,ye]},Ue.stepMinor=function(at){return arguments.length?(te=+at[0],se=+at[1],Ue):[te,se]},Ue.precision=function(at){return arguments.length?(Pe=+at,k=B6(f,a,90),F=j6(t,e,Pe),V=B6(x,g,90),X=j6(i,n,Pe),Ue):Pe},Ue.extentMajor([[-180,-90+ro],[180,90-ro]]).extentMinor([[-180,-80-ro],[180,80+ro]])}function Lq(){}const By=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function z6(){var e=1,t=1,n=g;function i(x,k){return k.map(F=>a(x,F))}function a(x,k){var F=[],V=[];return function(X,te,se){var he,ye,Pe,Ue,We,at,st=new Array,lt=new Array;for(he=ye=-1,Ue=X[0]>=te,By[Ue<<1].forEach(ct);++he<e-1;)Pe=Ue,Ue=X[he+1]>=te,By[Pe|Ue<<1].forEach(ct);for(By[Ue<<0].forEach(ct);++ye<t-1;){for(he=-1,Ue=X[ye*e+e]>=te,We=X[ye*e]>=te,By[Ue<<1|We<<2].forEach(ct);++he<e-1;)Pe=Ue,Ue=X[ye*e+e+he+1]>=te,at=We,We=X[ye*e+he+1]>=te,By[Pe|Ue<<1|We<<2|at<<3].forEach(ct);By[Ue|We<<3].forEach(ct)}for(he=-1,We=X[ye*e]>=te,By[We<<2].forEach(ct);++he<e-1;)at=We,We=X[ye*e+he+1]>=te,By[We<<2|at<<3].forEach(ct);function ct(Ct){var Et,gn,An=[Ct[0][0]+he,Ct[0][1]+ye],wn=[Ct[1][0]+he,Ct[1][1]+ye],$n=f(An),qn=f(wn);(Et=lt[$n])?(gn=st[qn])?(delete lt[Et.end],delete st[gn.start],Et===gn?(Et.ring.push(wn),se(Et.ring)):st[Et.start]=lt[gn.end]={start:Et.start,end:gn.end,ring:Et.ring.concat(gn.ring)}):(delete lt[Et.end],Et.ring.push(wn),lt[Et.end=qn]=Et):(Et=st[qn])?(gn=lt[$n])?(delete st[Et.start],delete lt[gn.end],Et===gn?(Et.ring.push(wn),se(Et.ring)):st[gn.start]=lt[Et.end]={start:gn.start,end:Et.end,ring:gn.ring.concat(Et.ring)}):(delete st[Et.start],Et.ring.unshift(An),st[Et.start=$n]=Et):st[$n]=lt[qn]={start:$n,end:qn,ring:[An,wn]}}By[We<<3].forEach(ct)}(x,k,X=>{n(X,x,k),function(te){for(var se=0,he=te.length,ye=te[he-1][1]*te[0][0]-te[he-1][0]*te[0][1];++se<he;)ye+=te[se-1][1]*te[se][0]-te[se-1][0]*te[se][1];return ye}(X)>0?F.push([X]):V.push(X)}),V.forEach(X=>{for(var te,se=0,he=F.length;se<he;++se)if(Bq((te=F[se])[0],X)!==-1)return void te.push(X)}),{type:"MultiPolygon",value:k,coordinates:F}}function f(x){return 2*x[0]+x[1]*(e+1)*4}function g(x,k,F){x.forEach(V=>{var X,te=V[0],se=V[1],he=0|te,ye=0|se,Pe=k[ye*e+he];te>0&&te<e&&he===te&&(X=k[ye*e+he-1],V[0]=te+(F-X)/(Pe-X)-.5),se>0&&se<t&&ye===se&&(X=k[(ye-1)*e+he],V[1]=se+(F-X)/(Pe-X)-.5)})}return i.contour=a,i.size=function(x){if(!arguments.length)return[e,t];var k=Math.floor(x[0]),F=Math.floor(x[1]);return k>=0&&F>=0||Object(ke.o)("invalid size"),e=k,t=F,i},i.smooth=function(x){return arguments.length?(n=x?g:Lq,i):n===g},i}function Bq(e,t){for(var n,i=-1,a=t.length;++i<a;)if(n=jq(e,t[i]))return n;return 0}function jq(e,t){for(var n=t[0],i=t[1],a=-1,f=0,g=e.length,x=g-1;f<g;x=f++){var k=e[f],F=k[0],V=k[1],X=e[x],te=X[0],se=X[1];if(zq(k,X,t))return 0;V>i!=se>i&&n<(te-F)*(i-V)/(se-V)+F&&(a=-a)}return a}function zq(e,t,n){var i;return function(a,f,g){return(f[0]-a[0])*(g[1]-a[1])==(g[0]-a[0])*(f[1]-a[1])}(e,t,n)&&function(a,f,g){return a<=f&&f<=g||g<=f&&f<=a}(e[i=+(e[0]===t[0])],n[i],t[i])}function U6(e,t,n){return function(i){var a=Object(ke.q)(i),f=n?Math.min(a[0],0):a[0],g=a[1],x=g-f,k=t?Object(qu.c)(f,g,e):x/(e+1);return Ms(f+k,g,k)}}function UT(e){Tt.call(this,null,e)}function W6(e,t,n,i,a){const f=e.x1||0,g=e.y1||0,x=t*n<0;function k(X){X.forEach(F)}function F(X){x&&X.reverse(),X.forEach(V)}function V(X){X[0]=(X[0]-f)*t+i,X[1]=(X[1]-g)*n+a}return function(X){return X.coordinates.forEach(k),X}}function V6(e,t,n){const i=e>=0?e:ei(t,n);return Math.round((Math.sqrt(4*i*i+1)-1)/2)}function WT(e){return Object(ke.E)(e)?e:Object(ke.m)(+e)}function H6(){var e=k=>k[0],t=k=>k[1],n=ke.Q,i=[-1,-1],a=960,f=500,g=2;function x(k,F){const V=V6(i[0],k,e)>>g,X=V6(i[1],k,t)>>g,te=V?V+2:0,se=X?X+2:0,he=2*te+(a>>g),ye=2*se+(f>>g),Pe=new Float32Array(he*ye),Ue=new Float32Array(he*ye);let We=Pe;k.forEach(st=>{const lt=te+(+e(st)>>g),ct=se+(+t(st)>>g);lt>=0&&lt<he&&ct>=0&&ct<ye&&(Pe[lt+ct*he]+=+n(st))}),V>0&&X>0?(ww(he,ye,Pe,Ue,V),_w(he,ye,Ue,Pe,X),ww(he,ye,Pe,Ue,V),_w(he,ye,Ue,Pe,X),ww(he,ye,Pe,Ue,V),_w(he,ye,Ue,Pe,X)):V>0?(ww(he,ye,Pe,Ue,V),ww(he,ye,Ue,Pe,V),ww(he,ye,Pe,Ue,V),We=Ue):X>0&&(_w(he,ye,Pe,Ue,X),_w(he,ye,Ue,Pe,X),_w(he,ye,Pe,Ue,X),We=Ue);const at=F?Math.pow(2,-2*g):1/E5(We);for(let st=0,lt=he*ye;st<lt;++st)We[st]*=at;return{values:We,scale:1<<g,width:he,height:ye,x1:te,y1:se,x2:te+(a>>g),y2:se+(f>>g)}}return x.x=function(k){return arguments.length?(e=WT(k),x):e},x.y=function(k){return arguments.length?(t=WT(k),x):t},x.weight=function(k){return arguments.length?(n=WT(k),x):n},x.size=function(k){if(!arguments.length)return[a,f];var F=+k[0],V=+k[1];return F>=0&&V>=0||Object(ke.o)("invalid size"),a=F,f=V,x},x.cellSize=function(k){return arguments.length?((k=+k)>=1||Object(ke.o)("invalid cell size"),g=Math.floor(Math.log(k)/Math.LN2),x):1<<g},x.bandwidth=function(k){return arguments.length?((k=Object(ke.i)(k)).length===1&&(k=[+k[0],+k[0]]),k.length!==2&&Object(ke.o)("invalid bandwidth"),i=k,x):i},x}function ww(e,t,n,i,a){const f=1+(a<<1);for(let g=0;g<t;++g)for(let x=0,k=0;x<e+a;++x)x<e&&(k+=n[x+g*e]),x>=a&&(x>=f&&(k-=n[x-f+g*e]),i[x-a+g*e]=k/Math.min(x+1,e-1+f-x,f))}function _w(e,t,n,i,a){const f=1+(a<<1);for(let g=0;g<e;++g)for(let x=0,k=0;x<t+a;++x)x<t&&(k+=n[g+x*e]),x>=a&&(x>=f&&(k-=n[g+(x-f)*e]),i[g+(x-a)*e]=k/Math.min(x+1,t-1+f-x,f))}function VT(e){Tt.call(this,null,e)}UT.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},Object(ke.z)(UT,Tt,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,a=e.field||ke.y,f=z6().smooth(e.smooth!==!1),g=e.thresholds||function(F,V,X){const te=U6(X.levels||10,X.nice,X.zero!==!1);return X.resolve!=="shared"?te:te(F.map(se=>Xn(V(se).values)))}(i,a,e),x=e.as===null?null:e.as||"contour",k=[];return i.forEach(F=>{const V=a(F),X=f.size([V.width,V.height])(V.values,Object(ke.B)(g)?g:g(V.values));(function(te,se,he,ye){let Pe=ye.scale||se.scale,Ue=ye.translate||se.translate;if(Object(ke.E)(Pe)&&(Pe=Pe(he,ye)),Object(ke.E)(Ue)&&(Ue=Ue(he,ye)),(Pe===1||Pe==null)&&!Ue)return;const We=(Object(ke.G)(Pe)?Pe:Pe[0])||1,at=(Object(ke.G)(Pe)?Pe:Pe[1])||1,st=Ue&&Ue[0]||0,lt=Ue&&Ue[1]||0;te.forEach(W6(se,We,at,st,lt))})(X,V,F,e),X.forEach(te=>{k.push(ur(F,xn(x!=null?{[x]:te}:te)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=k,n}}),VT.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const Uq=["x","y","weight","size","cellSize","bandwidth"];function G6(e,t){return Uq.forEach(n=>t[n]!=null?e[n](t[n]):0),e}function HT(e){Tt.call(this,null,e)}Object(ke.z)(VT,Tt,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=function(k,F){var V,X,te,se,he,ye,Pe=[],Ue=We=>We(se);if(F==null)Pe.push(k);else for(V={},X=0,te=k.length;X<te;++X)se=k[X],he=F.map(Ue),(ye=V[he])||(V[he]=ye=[],ye.dims=he,Pe.push(ye)),ye.push(se);return Pe}(t.materialize(t.SOURCE).source,e.groupby),f=(e.groupby||[]).map(ke.h),g=G6(H6(),e),x=e.as||"grid";return n=a.map(k=>xn(function(F,V){for(let X=0;X<f.length;++X)F[f[X]]=V[X];return F}({[x]:g(k,e.counts)},k.dims))),this.value&&(i.rem=this.value),this.value=i.source=i.add=n,i}}),HT.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},Object(ke.z)(HT,Tt,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,i,a=t.fork(t.NO_SOURCE|t.NO_FIELDS),f=z6().smooth(e.smooth!==!1),g=e.values,x=e.thresholds||U6(e.count||10,e.nice,!!g),k=e.size;return g||(g=t.materialize(t.SOURCE).source,i=W6(n=G6(H6(),e)(g,!0),n.scale||1,n.scale||1,0,0),k=[n.width,n.height],g=n.values),x=Object(ke.B)(x)?x:x(g),g=f.size(k)(g,x),i&&g.forEach(i),this.value&&(a.rem=this.value),this.value=a.source=a.add=(g||[]).map(xn),a}});const GT="Feature",qT="FeatureCollection";function $T(e){Tt.call(this,null,e)}function XT(e){Tt.call(this,null,e)}function KT(e){Tt.call(this,null,e)}function YT(e){Tt.call(this,null,e)}function JT(e){Tt.call(this,[],e),this.generator=Pq()}function QT(e){Tt.call(this,null,e)}function q6(e){if(!Object(ke.E)(e))return!1;const t=Object(ke.Fa)(Object(ke.g)(e));return t.$x||t.$y||t.$value||t.$max}function $6(e){Tt.call(this,null,e),this.modified(!0)}function X6(e,t,n){Object(ke.E)(e[t])&&e[t](n)}$T.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},Object(ke.z)($T,Tt,{transform(e,t){var n,i=this._features,a=this._points,f=e.fields,g=f&&f[0],x=f&&f[1],k=e.geojson||!f&&ke.y,F=t.ADD;n=e.modified()||t.changed(t.REM)||t.modified(Object(ke.g)(k))||g&&t.modified(Object(ke.g)(g))||x&&t.modified(Object(ke.g)(x)),this.value&&!n||(F=t.SOURCE,this._features=i=[],this._points=a=[]),k&&t.visit(F,V=>i.push(k(V))),g&&x&&(t.visit(F,V=>{var X=g(V),te=x(V);X!=null&&te!=null&&(X=+X)===X&&(te=+te)===te&&a.push([X,te])}),i=i.concat({type:GT,geometry:{type:"MultiPoint",coordinates:a}})),this.value={type:qT,features:i}}}),XT.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},Object(ke.z)(XT,Tt,{transform(e,t){var n=t.fork(t.ALL),i=this.value,a=e.field||ke.y,f=e.as||"path",g=n.SOURCE;!i||e.modified()?(this.value=i=L6(e.projection),n.materialize().reflow()):g=a===ke.y||t.modified(a.fields)?n.ADD_MOD:n.ADD;const x=function(k,F){const V=k.pointRadius();return k.context(null),F!=null&&k.pointRadius(F),V}(i,e.pointRadius);return n.visit(g,k=>k[f]=i(a(k))),i.pointRadius(x),n.modifies(f)}}),KT.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},Object(ke.z)(KT,Tt,{transform(e,t){var n,i=e.projection,a=e.fields[0],f=e.fields[1],g=e.as||["x","y"],x=g[0],k=g[1];function F(V){const X=i([a(V),f(V)]);X?(V[x]=X[0],V[k]=X[1]):(V[x]=void 0,V[k]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,F):(n=t.modified(a.fields)||t.modified(f.fields),t.visit(n?t.ADD_MOD:t.ADD,F)),t.modifies(g)}}),YT.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},Object(ke.z)(YT,Tt,{transform(e,t){var n=t.fork(t.ALL),i=this.value,a=e.as||"shape",f=n.ADD;return i&&!e.modified()||(this.value=i=function(g,x,k){const F=k==null?V=>g(x(V)):V=>{var X=g.pointRadius(),te=g.pointRadius(k)(x(V));return g.pointRadius(X),te};return F.context=V=>(g.context(V),F),F}(L6(e.projection),e.field||Object(ke.u)("datum"),e.pointRadius),n.materialize().reflow(),f=n.SOURCE),n.visit(f,g=>g[a]=i),n.modifies(a)}}),JT.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},Object(ke.z)(JT,Tt,{transform(e,t){var n,i=this.value,a=this.generator;if(!i.length||e.modified())for(const f in e)Object(ke.E)(a[f])&&a[f](e[f]);return n=a(),i.length?t.mod.push(sr(i[0],n)):t.add.push(xn(n)),i[0]=n,t}}),QT.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},Object(ke.z)(QT,Tt,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,i=e.resolve==="shared",a=e.field||ke.y,f=function(F,V){let X;return Object(ke.E)(F)?(X=te=>F(te,V)).dep=q6(F):F?X=Object(ke.m)(F):(X=te=>te.$value/te.$max||0).dep=!0,X}(e.opacity,e),g=function(F,V){let X;return Object(ke.E)(F)?(X=te=>on(F(te,V))).dep=q6(F):X=Object(ke.m)(on(F||"#888")),X}(e.color,e),x=e.as||"image",k={$x:0,$y:0,$value:0,$max:i?Xn(n.map(F=>Xn(a(F).values))):0};return n.forEach(F=>{const V=a(F),X=Object(ke.p)({},F,k);i||(X.$max=Xn(V.values||[])),F[x]=function(te,se,he,ye){const Pe=te.width,Ue=te.height,We=te.x1||0,at=te.y1||0,st=te.x2||Pe,lt=te.y2||Ue,ct=te.values,Ct=ct?$n=>ct[$n]:ke.Ma,Et=su(st-We,lt-at),gn=Et.getContext("2d"),An=gn.getImageData(0,0,st-We,lt-at),wn=An.data;for(let $n=at,qn=0;$n<lt;++$n){se.$y=$n-at;for(let er=We,rr=$n*Pe;er<st;++er,qn+=4){se.$x=er-We,se.$value=Ct(er+rr);const lr=he(se);wn[qn+0]=lr.r,wn[qn+1]=lr.g,wn[qn+2]=lr.b,wn[qn+3]=~~(255*ye(se))}}return gn.putImageData(An,0,0),Et}(V,X,g.dep?g:Object(ke.m)(g(X)),f.dep?f:Object(ke.m)(f(X)))}),t.reflow(!0).modifies(x)}}),Object(ke.z)($6,Tt,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=function(i){const a=zT((i||"mercator").toLowerCase());return a||Object(ke.o)("Unrecognized projection type: "+i),a()}(e.type),jT.forEach(i=>{e[i]!=null&&X6(n,i,e[i])})):jT.forEach(i=>{e.modified(i)&&X6(n,i,e[i])}),e.pointRadius!=null&&n.path.pointRadius(e.pointRadius),e.fit&&function(i,a){const f=function(g){return(g=Object(ke.i)(g)).length===1?g[0]:{type:qT,features:g.reduce((x,k)=>x.concat(function(F){return F.type===qT?F.features:Object(ke.i)(F).filter(V=>V!=null).map(V=>V.type===GT?V:{type:GT,geometry:V})}(k)),[])}}(a.fit);a.extent?i.fitExtent(a.extent,f):a.size&&i.fitSize(a.size,f)}(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function K6(e,t,n,i){if(isNaN(t)||isNaN(n))return e;var a,f,g,x,k,F,V,X,te,se=e._root,he={data:i},ye=e._x0,Pe=e._y0,Ue=e._x1,We=e._y1;if(!se)return e._root=he,e;for(;se.length;)if((F=t>=(f=(ye+Ue)/2))?ye=f:Ue=f,(V=n>=(g=(Pe+We)/2))?Pe=g:We=g,a=se,!(se=se[X=V<<1|F]))return a[X]=he,e;if(x=+e._x.call(null,se.data),k=+e._y.call(null,se.data),t===x&&n===k)return he.next=se,a?a[X]=he:e._root=he,e;do a=a?a[X]=new Array(4):e._root=new Array(4),(F=t>=(f=(ye+Ue)/2))?ye=f:Ue=f,(V=n>=(g=(Pe+We)/2))?Pe=g:We=g;while((X=V<<1|F)==(te=(k>=g)<<1|x>=f));return a[te]=se,a[X]=he,e}var th=function(e,t,n,i,a){this.node=e,this.x0=t,this.y0=n,this.x1=i,this.y1=a};function Wq(e){return e[0]}function Vq(e){return e[1]}function ZT(e,t,n){var i=new eM(t??Wq,n??Vq,NaN,NaN,NaN,NaN);return e==null?i:i.addAll(e)}function eM(e,t,n,i,a,f){this._x=e,this._y=t,this._x0=n,this._y0=i,this._x1=a,this._y1=f,this._root=void 0}function Y6(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var nh=ZT.prototype=eM.prototype;nh.copy=function(){var e,t,n=new eM(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root;if(!i)return n;if(!i.length)return n._root=Y6(i),n;for(e=[{source:i,target:n._root=new Array(4)}];i=e.pop();)for(var a=0;a<4;++a)(t=i.source[a])&&(t.length?e.push({source:t,target:i.target[a]=new Array(4)}):i.target[a]=Y6(t));return n},nh.add=function(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return K6(this.cover(t,n),t,n,e)},nh.addAll=function(e){var t,n,i,a,f=e.length,g=new Array(f),x=new Array(f),k=1/0,F=1/0,V=-1/0,X=-1/0;for(n=0;n<f;++n)isNaN(i=+this._x.call(null,t=e[n]))||isNaN(a=+this._y.call(null,t))||(g[n]=i,x[n]=a,i<k&&(k=i),i>V&&(V=i),a<F&&(F=a),a>X&&(X=a));if(k>V||F>X)return this;for(this.cover(k,F).cover(V,X),n=0;n<f;++n)K6(this,g[n],x[n],e[n]);return this},nh.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,i=this._y0,a=this._x1,f=this._y1;if(isNaN(n))a=(n=Math.floor(e))+1,f=(i=Math.floor(t))+1;else{for(var g,x,k=a-n||1,F=this._root;n>e||e>=a||i>t||t>=f;)switch(x=(t<i)<<1|e<n,(g=new Array(4))[x]=F,F=g,k*=2,x){case 0:a=n+k,f=i+k;break;case 1:n=a-k,f=i+k;break;case 2:a=n+k,i=f-k;break;case 3:n=a-k,i=f-k}this._root&&this._root.length&&(this._root=F)}return this._x0=n,this._y0=i,this._x1=a,this._y1=f,this},nh.data=function(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e},nh.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},nh.find=function(e,t,n){var i,a,f,g,x,k,F,V=this._x0,X=this._y0,te=this._x1,se=this._y1,he=[],ye=this._root;for(ye&&he.push(new th(ye,V,X,te,se)),n==null?n=1/0:(V=e-n,X=t-n,te=e+n,se=t+n,n*=n);k=he.pop();)if(!(!(ye=k.node)||(a=k.x0)>te||(f=k.y0)>se||(g=k.x1)<V||(x=k.y1)<X))if(ye.length){var Pe=(a+g)/2,Ue=(f+x)/2;he.push(new th(ye[3],Pe,Ue,g,x),new th(ye[2],a,Ue,Pe,x),new th(ye[1],Pe,f,g,Ue),new th(ye[0],a,f,Pe,Ue)),(F=(t>=Ue)<<1|e>=Pe)&&(k=he[he.length-1],he[he.length-1]=he[he.length-1-F],he[he.length-1-F]=k)}else{var We=e-+this._x.call(null,ye.data),at=t-+this._y.call(null,ye.data),st=We*We+at*at;if(st<n){var lt=Math.sqrt(n=st);V=e-lt,X=t-lt,te=e+lt,se=t+lt,i=ye.data}}return i},nh.remove=function(e){if(isNaN(f=+this._x.call(null,e))||isNaN(g=+this._y.call(null,e)))return this;var t,n,i,a,f,g,x,k,F,V,X,te,se=this._root,he=this._x0,ye=this._y0,Pe=this._x1,Ue=this._y1;if(!se)return this;if(se.length)for(;;){if((F=f>=(x=(he+Pe)/2))?he=x:Pe=x,(V=g>=(k=(ye+Ue)/2))?ye=k:Ue=k,t=se,!(se=se[X=V<<1|F]))return this;if(!se.length)break;(t[X+1&3]||t[X+2&3]||t[X+3&3])&&(n=t,te=X)}for(;se.data!==e;)if(i=se,!(se=se.next))return this;return(a=se.next)&&delete se.next,i?(a?i.next=a:delete i.next,this):t?(a?t[X]=a:delete t[X],(se=t[0]||t[1]||t[2]||t[3])&&se===(t[3]||t[2]||t[1]||t[0])&&!se.length&&(n?n[te]=se:this._root=se),this):(this._root=a,this)},nh.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},nh.root=function(){return this._root},nh.size=function(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e},nh.visit=function(e){var t,n,i,a,f,g,x=[],k=this._root;for(k&&x.push(new th(k,this._x0,this._y0,this._x1,this._y1));t=x.pop();)if(!e(k=t.node,i=t.x0,a=t.y0,f=t.x1,g=t.y1)&&k.length){var F=(i+f)/2,V=(a+g)/2;(n=k[3])&&x.push(new th(n,F,V,f,g)),(n=k[2])&&x.push(new th(n,i,V,F,g)),(n=k[1])&&x.push(new th(n,F,a,f,V)),(n=k[0])&&x.push(new th(n,i,a,F,V))}return this},nh.visitAfter=function(e){var t,n=[],i=[];for(this._root&&n.push(new th(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var a=t.node;if(a.length){var f,g=t.x0,x=t.y0,k=t.x1,F=t.y1,V=(g+k)/2,X=(x+F)/2;(f=a[0])&&n.push(new th(f,g,x,V,X)),(f=a[1])&&n.push(new th(f,V,x,k,X)),(f=a[2])&&n.push(new th(f,g,X,V,F)),(f=a[3])&&n.push(new th(f,V,X,k,F))}i.push(t)}for(;t=i.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},nh.x=function(e){return arguments.length?(this._x=e,this):this._x},nh.y=function(e){return arguments.length?(this._y=e,this):this._y};var rh=function(e){return function(){return e}},G1=function(e){return 1e-6*(e()-.5)};function Hq(e){return e.x+e.vx}function Gq(e){return e.y+e.vy}var qq={value:()=>{}};function J6(){for(var e,t=0,n=arguments.length,i={};t<n;++t){if(!(e=arguments[t]+"")||e in i||/[\s.]/.test(e))throw new Error("illegal type: "+e);i[e]=[]}return new I3(i)}function I3(e){this._=e}function $q(e,t){for(var n,i=0,a=e.length;i<a;++i)if((n=e[i]).name===t)return n.value}function Q6(e,t,n){for(var i=0,a=e.length;i<a;++i)if(e[i].name===t){e[i]=qq,e=e.slice(0,i).concat(e.slice(i+1));break}return n!=null&&e.push({name:t,value:n}),e}I3.prototype=J6.prototype={constructor:I3,on:function(e,t){var n,i=this._,a=function(x,k){return x.trim().split(/^|\s+/).map(function(F){var V="",X=F.indexOf(".");if(X>=0&&(V=F.slice(X+1),F=F.slice(0,X)),F&&!k.hasOwnProperty(F))throw new Error("unknown type: "+F);return{type:F,name:V}})}(e+"",i),f=-1,g=a.length;if(!(arguments.length<2)){if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++f<g;)if(n=(e=a[f]).type)i[n]=Q6(i[n],e.name,t);else if(t==null)for(n in i)i[n]=Q6(i[n],e.name,null);return this}for(;++f<g;)if((n=(e=a[f]).type)&&(n=$q(i[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new I3(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,i,a=new Array(n),f=0;f<n;++f)a[f]=arguments[f+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(f=0,n=(i=this._[e]).length;f<n;++f)i[f].value.apply(t,a)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],a=0,f=i.length;a<f;++a)i[a].value.apply(t,n)}};var F3,g_,Xq=J6,Ew=0,v_=0,y_=0,Z6=1e3,R3=0,Kb=0,P3=0,b_=typeof performance=="object"&&performance.now?performance:Date,eP=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function tM(){return Kb||(eP(Kq),Kb=b_.now()+P3)}function Kq(){Kb=0}function L3(){this._call=this._time=this._next=null}function tP(e,t,n){var i=new L3;return i.restart(e,t,n),i}function nP(){Kb=(R3=b_.now())+P3,Ew=v_=0;try{(function(){tM(),++Ew;for(var e,t=F3;t;)(e=Kb-t._time)>=0&&t._call.call(null,e),t=t._next;--Ew})()}finally{Ew=0,function(){for(var e,t,n=F3,i=1/0;n;)n._call?(i>n._time&&(i=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:F3=t);g_=e,nM(i)}(),Kb=0}}function Yq(){var e=b_.now(),t=e-R3;t>Z6&&(P3-=t,R3=e)}function nM(e){Ew||(v_&&(v_=clearTimeout(v_)),e-Kb>24?(e<1/0&&(v_=setTimeout(nP,e-b_.now()-P3)),y_&&(y_=clearInterval(y_))):(y_||(R3=b_.now(),y_=setInterval(Yq,Z6)),Ew=1,eP(nP)))}L3.prototype=tP.prototype={constructor:L3,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?tM():+n)+(t==null?0:+t),this._next||g_===this||(g_?g_._next=this:F3=this,g_=this),this._call=e,this._time=n,nM()},stop:function(){this._call&&(this._call=null,this._time=1/0,nM())}};function Jq(e){return e.x}function Qq(e){return e.y}var Zq=10,e$=Math.PI*(3-Math.sqrt(5)),t$=function(e){var t,n=1,i=.001,a=1-Math.pow(i,1/300),f=0,g=.6,x=new Map,k=tP(X),F=Xq("tick","end"),V=function(){let ye=1;return()=>(ye=(1664525*ye+1013904223)%4294967296)/4294967296}();function X(){te(),F.call("tick",t),n<i&&(k.stop(),F.call("end",t))}function te(ye){var Pe,Ue,We=e.length;ye===void 0&&(ye=1);for(var at=0;at<ye;++at)for(n+=(f-n)*a,x.forEach(function(st){st(n)}),Pe=0;Pe<We;++Pe)(Ue=e[Pe]).fx==null?Ue.x+=Ue.vx*=g:(Ue.x=Ue.fx,Ue.vx=0),Ue.fy==null?Ue.y+=Ue.vy*=g:(Ue.y=Ue.fy,Ue.vy=0);return t}function se(){for(var ye,Pe=0,Ue=e.length;Pe<Ue;++Pe){if((ye=e[Pe]).index=Pe,ye.fx!=null&&(ye.x=ye.fx),ye.fy!=null&&(ye.y=ye.fy),isNaN(ye.x)||isNaN(ye.y)){var We=Zq*Math.sqrt(.5+Pe),at=Pe*e$;ye.x=We*Math.cos(at),ye.y=We*Math.sin(at)}(isNaN(ye.vx)||isNaN(ye.vy))&&(ye.vx=ye.vy=0)}}function he(ye){return ye.initialize&&ye.initialize(e,V),ye}return e==null&&(e=[]),se(),t={tick:te,restart:function(){return k.restart(X),t},stop:function(){return k.stop(),t},nodes:function(ye){return arguments.length?(e=ye,se(),x.forEach(he),t):e},alpha:function(ye){return arguments.length?(n=+ye,t):n},alphaMin:function(ye){return arguments.length?(i=+ye,t):i},alphaDecay:function(ye){return arguments.length?(a=+ye,t):+a},alphaTarget:function(ye){return arguments.length?(f=+ye,t):f},velocityDecay:function(ye){return arguments.length?(g=1-ye,t):1-g},randomSource:function(ye){return arguments.length?(V=ye,x.forEach(he),t):V},force:function(ye,Pe){return arguments.length>1?(Pe==null?x.delete(ye):x.set(ye,he(Pe)),t):x.get(ye)},find:function(ye,Pe,Ue){var We,at,st,lt,ct,Ct=0,Et=e.length;for(Ue==null?Ue=1/0:Ue*=Ue,Ct=0;Ct<Et;++Ct)(st=(We=ye-(lt=e[Ct]).x)*We+(at=Pe-lt.y)*at)<Ue&&(ct=lt,Ue=st);return ct},on:function(ye,Pe){return arguments.length>1?(F.on(ye,Pe),t):F.on(ye)}}};function n$(e){return e.index}function rP(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}const iP={center:function(e,t){var n,i=1;function a(){var f,g,x=n.length,k=0,F=0;for(f=0;f<x;++f)k+=(g=n[f]).x,F+=g.y;for(k=(k/x-e)*i,F=(F/x-t)*i,f=0;f<x;++f)(g=n[f]).x-=k,g.y-=F}return e==null&&(e=0),t==null&&(t=0),a.initialize=function(f){n=f},a.x=function(f){return arguments.length?(e=+f,a):e},a.y=function(f){return arguments.length?(t=+f,a):t},a.strength=function(f){return arguments.length?(i=+f,a):i},a},collide:function(e){var t,n,i,a=1,f=1;function g(){for(var F,V,X,te,se,he,ye,Pe=t.length,Ue=0;Ue<f;++Ue)for(V=ZT(t,Hq,Gq).visitAfter(x),F=0;F<Pe;++F)X=t[F],he=n[X.index],ye=he*he,te=X.x+X.vx,se=X.y+X.vy,V.visit(We);function We(at,st,lt,ct,Ct){var Et=at.data,gn=at.r,An=he+gn;if(!Et)return st>te+An||ct<te-An||lt>se+An||Ct<se-An;if(Et.index>X.index){var wn=te-Et.x-Et.vx,$n=se-Et.y-Et.vy,qn=wn*wn+$n*$n;qn<An*An&&(wn===0&&(qn+=(wn=G1(i))*wn),$n===0&&(qn+=($n=G1(i))*$n),qn=(An-(qn=Math.sqrt(qn)))/qn*a,X.vx+=(wn*=qn)*(An=(gn*=gn)/(ye+gn)),X.vy+=($n*=qn)*An,Et.vx-=wn*(An=1-An),Et.vy-=$n*An)}}}function x(F){if(F.data)return F.r=n[F.data.index];for(var V=F.r=0;V<4;++V)F[V]&&F[V].r>F.r&&(F.r=F[V].r)}function k(){if(t){var F,V,X=t.length;for(n=new Array(X),F=0;F<X;++F)V=t[F],n[V.index]=+e(V,F,t)}}return typeof e!="function"&&(e=rh(e==null?1:+e)),g.initialize=function(F,V){t=F,i=V,k()},g.iterations=function(F){return arguments.length?(f=+F,g):f},g.strength=function(F){return arguments.length?(a=+F,g):a},g.radius=function(F){return arguments.length?(e=typeof F=="function"?F:rh(+F),k(),g):e},g},nbody:function(){var e,t,n,i,a,f=rh(-30),g=1,x=1/0,k=.81;function F(se){var he,ye=e.length,Pe=ZT(e,Jq,Qq).visitAfter(X);for(i=se,he=0;he<ye;++he)t=e[he],Pe.visit(te)}function V(){if(e){var se,he,ye=e.length;for(a=new Array(ye),se=0;se<ye;++se)he=e[se],a[he.index]=+f(he,se,e)}}function X(se){var he,ye,Pe,Ue,We,at=0,st=0;if(se.length){for(Pe=Ue=We=0;We<4;++We)(he=se[We])&&(ye=Math.abs(he.value))&&(at+=he.value,st+=ye,Pe+=ye*he.x,Ue+=ye*he.y);se.x=Pe/st,se.y=Ue/st}else{(he=se).x=he.data.x,he.y=he.data.y;do at+=a[he.data.index];while(he=he.next)}se.value=at}function te(se,he,ye,Pe){if(!se.value)return!0;var Ue=se.x-t.x,We=se.y-t.y,at=Pe-he,st=Ue*Ue+We*We;if(at*at/k<st)return st<x&&(Ue===0&&(st+=(Ue=G1(n))*Ue),We===0&&(st+=(We=G1(n))*We),st<g&&(st=Math.sqrt(g*st)),t.vx+=Ue*se.value*i/st,t.vy+=We*se.value*i/st),!0;if(!(se.length||st>=x)){(se.data!==t||se.next)&&(Ue===0&&(st+=(Ue=G1(n))*Ue),We===0&&(st+=(We=G1(n))*We),st<g&&(st=Math.sqrt(g*st)));do se.data!==t&&(at=a[se.data.index]*i/st,t.vx+=Ue*at,t.vy+=We*at);while(se=se.next)}}return F.initialize=function(se,he){e=se,n=he,V()},F.strength=function(se){return arguments.length?(f=typeof se=="function"?se:rh(+se),V(),F):f},F.distanceMin=function(se){return arguments.length?(g=se*se,F):Math.sqrt(g)},F.distanceMax=function(se){return arguments.length?(x=se*se,F):Math.sqrt(x)},F.theta=function(se){return arguments.length?(k=se*se,F):Math.sqrt(k)},F},link:function(e){var t,n,i,a,f,g,x=n$,k=function(ye){return 1/Math.min(a[ye.source.index],a[ye.target.index])},F=rh(30),V=1;function X(ye){for(var Pe=0,Ue=e.length;Pe<V;++Pe)for(var We,at,st,lt,ct,Ct,Et,gn=0;gn<Ue;++gn)at=(We=e[gn]).source,lt=(st=We.target).x+st.vx-at.x-at.vx||G1(g),ct=st.y+st.vy-at.y-at.vy||G1(g),lt*=Ct=((Ct=Math.sqrt(lt*lt+ct*ct))-n[gn])/Ct*ye*t[gn],ct*=Ct,st.vx-=lt*(Et=f[gn]),st.vy-=ct*Et,at.vx+=lt*(Et=1-Et),at.vy+=ct*Et}function te(){if(i){var ye,Pe,Ue=i.length,We=e.length,at=new Map(i.map((st,lt)=>[x(st,lt,i),st]));for(ye=0,a=new Array(Ue);ye<We;++ye)(Pe=e[ye]).index=ye,typeof Pe.source!="object"&&(Pe.source=rP(at,Pe.source)),typeof Pe.target!="object"&&(Pe.target=rP(at,Pe.target)),a[Pe.source.index]=(a[Pe.source.index]||0)+1,a[Pe.target.index]=(a[Pe.target.index]||0)+1;for(ye=0,f=new Array(We);ye<We;++ye)Pe=e[ye],f[ye]=a[Pe.source.index]/(a[Pe.source.index]+a[Pe.target.index]);t=new Array(We),se(),n=new Array(We),he()}}function se(){if(i)for(var ye=0,Pe=e.length;ye<Pe;++ye)t[ye]=+k(e[ye],ye,e)}function he(){if(i)for(var ye=0,Pe=e.length;ye<Pe;++ye)n[ye]=+F(e[ye],ye,e)}return e==null&&(e=[]),X.initialize=function(ye,Pe){i=ye,g=Pe,te()},X.links=function(ye){return arguments.length?(e=ye,te(),X):e},X.id=function(ye){return arguments.length?(x=ye,X):x},X.iterations=function(ye){return arguments.length?(V=+ye,X):V},X.strength=function(ye){return arguments.length?(k=typeof ye=="function"?ye:rh(+ye),se(),X):k},X.distance=function(ye){return arguments.length?(F=typeof ye=="function"?ye:rh(+ye),he(),X):F},X},x:function(e){var t,n,i,a=rh(.1);function f(x){for(var k,F=0,V=t.length;F<V;++F)(k=t[F]).vx+=(i[F]-k.x)*n[F]*x}function g(){if(t){var x,k=t.length;for(n=new Array(k),i=new Array(k),x=0;x<k;++x)n[x]=isNaN(i[x]=+e(t[x],x,t))?0:+a(t[x],x,t)}}return typeof e!="function"&&(e=rh(e==null?0:+e)),f.initialize=function(x){t=x,g()},f.strength=function(x){return arguments.length?(a=typeof x=="function"?x:rh(+x),g(),f):a},f.x=function(x){return arguments.length?(e=typeof x=="function"?x:rh(+x),g(),f):e},f},y:function(e){var t,n,i,a=rh(.1);function f(x){for(var k,F=0,V=t.length;F<V;++F)(k=t[F]).vy+=(i[F]-k.y)*n[F]*x}function g(){if(t){var x,k=t.length;for(n=new Array(k),i=new Array(k),x=0;x<k;++x)n[x]=isNaN(i[x]=+e(t[x],x,t))?0:+a(t[x],x,t)}}return typeof e!="function"&&(e=rh(e==null?0:+e)),f.initialize=function(x){t=x,g()},f.strength=function(x){return arguments.length?(a=typeof x=="function"?x:rh(+x),g(),f):a},f.y=function(x){return arguments.length?(e=typeof x=="function"?x:rh(+x),g(),f):e},f}},x_="forces",rM=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],r$=["static","iterations"],oP=["x","y","vx","vy"];function iM(e){Tt.call(this,null,e)}function aP(e,t,n,i){var a,f,g,x,k=Object(ke.i)(t.forces);for(a=0,f=rM.length;a<f;++a)(g=rM[a])!==x_&&t.modified(g)&&e[g](t[g]);for(a=0,f=k.length;a<f;++a)x=x_+a,(g=n||t.modified(x_,a)?o$(k[a]):i&&i$(k[a],i)?e.force(x):null)&&e.force(x,g);for(f=e.numForces||0;a<f;++a)e.force(x_+a,null);return e.numForces=k.length,e}function i$(e,t){var n,i;for(n in e)if(Object(ke.E)(i=e[n])&&t.modified(Object(ke.g)(i)))return 1;return 0}function o$(e){var t,n;for(n in Object(ke.w)(iP,e.force)||Object(ke.o)("Unrecognized force: "+e.force),t=iP[e.force](),e)Object(ke.E)(t[n])&&a$(t[n],e[n],e);return t}function a$(e,t,n){e(Object(ke.E)(t)?i=>t(i,n):t)}function s$(e){var t=0,n=e.children,i=n&&n.length;if(i)for(;--i>=0;)t+=n[i].value;else t=1;e.value=t}iM.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:oP}]},Object(ke.z)(iM,Tt,{transform(e,t){var n=this.value,i=t.changed(t.ADD_REM),a=e.modified(rM),f=e.iterations||300;if(n?(i&&(t.modifies("index"),n.nodes(t.source)),(a||t.changed(t.MOD))&&aP(n,e,0,t)):(this.value=n=function(g,x){const k=t$(g),F=k.stop,V=k.restart;let X=!1;return k.stopped=()=>X,k.restart=()=>(X=!1,V()),k.stop=()=>(X=!0,F()),aP(k,x,!0).on("end",()=>X=!0)}(t.source,e),n.on("tick",function(g,x){return()=>g.touch(x).run()}(t.dataflow,this)),e.static||(i=!0,n.tick()),t.modifies("index")),a||i||e.modified(r$)||t.changed()&&e.restart){if(n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/f)),e.static)for(n.stop();--f>=0;)n.tick();else if(n.stopped()&&n.restart(),!i)return t.StopPropagation}return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let x,k=this._argops,F=0,V=k.length;F<V;++F)if((x=k[F]).name===x_&&x.op._argval.force==="link"){for(var i,a=x.op._argops,f=0,g=a.length;f<g;++f)if(a[f].name==="links"&&(i=a[f].op.source)){n.pulse(i,n.changeset().reflow());break}}return t.reflow(e.modified()).modifies(oP)}});function oM(e,t){e instanceof Map?(e=[void 0,e],t===void 0&&(t=c$)):t===void 0&&(t=u$);for(var n,i,a,f,g,x=new Sw(e),k=[x];n=k.pop();)if((a=t(n.data))&&(g=(a=Array.from(a)).length))for(n.children=a,f=g-1;f>=0;--f)k.push(i=a[f]=new Sw(a[f])),i.parent=n,i.depth=n.depth+1;return x.eachBefore(sP)}function u$(e){return e.children}function c$(e){return Array.isArray(e)?e[1]:null}function l$(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function sP(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function Sw(e){this.data=e,this.depth=this.height=0,this.parent=null}Sw.prototype=oM.prototype={constructor:Sw,count:function(){return this.eachAfter(s$)},each:function(e,t){let n=-1;for(const i of this)e.call(t,i,++n,this);return this},eachAfter:function(e,t){for(var n,i,a,f=this,g=[f],x=[],k=-1;f=g.pop();)if(x.push(f),n=f.children)for(i=0,a=n.length;i<a;++i)g.push(n[i]);for(;f=x.pop();)e.call(t,f,++k,this);return this},eachBefore:function(e,t){for(var n,i,a=this,f=[a],g=-1;a=f.pop();)if(e.call(t,a,++g,this),n=a.children)for(i=n.length-1;i>=0;--i)f.push(n[i]);return this},find:function(e,t){let n=-1;for(const i of this)if(e.call(t,i,++n,this))return i},sum:function(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,i=t.children,a=i&&i.length;--a>=0;)n+=i[a].value;t.value=n})},sort:function(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})},path:function(e){for(var t=this,n=function(f,g){if(f===g)return f;var x=f.ancestors(),k=g.ancestors(),F=null;for(f=x.pop(),g=k.pop();f===g;)F=f,f=x.pop(),g=k.pop();return F}(t,e),i=[t];t!==n;)t=t.parent,i.push(t);for(var a=i.length;e!==n;)i.splice(a,0,e),e=e.parent;return i},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e},links:function(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t},copy:function(){return oM(this).eachBefore(l$)},[Symbol.iterator]:function*(){var e,t,n,i,a=this,f=[a];do for(e=f.reverse(),f=[];a=e.pop();)if(yield a,t=a.children)for(n=0,i=t.length;n<i;++n)f.push(t[n]);while(f.length)}};var f$=function(e){return typeof e=="object"&&"length"in e?e:Array.from(e)},d$=function(e){for(var t,n,i=0,a=(e=function(g){for(var x,k,F=g.length;F;)k=Math.random()*F--|0,x=g[F],g[F]=g[k],g[k]=x;return g}(Array.from(e))).length,f=[];i<a;)t=e[i],n&&uP(n,t)?++i:(n=p$(f=h$(f,t)),i=0);return n};function h$(e,t){var n,i;if(aM(t,e))return[t];for(n=0;n<e.length;++n)if(B3(t,e[n])&&aM(w_(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(i=n+1;i<e.length;++i)if(B3(w_(e[n],e[i]),t)&&B3(w_(e[n],t),e[i])&&B3(w_(e[i],t),e[n])&&aM(cP(e[n],e[i],t),e))return[e[n],e[i],t];throw new Error}function B3(e,t){var n=e.r-t.r,i=t.x-e.x,a=t.y-e.y;return n<0||n*n<i*i+a*a}function uP(e,t){var n=e.r-t.r+1e-9*Math.max(e.r,t.r,1),i=t.x-e.x,a=t.y-e.y;return n>0&&n*n>i*i+a*a}function aM(e,t){for(var n=0;n<t.length;++n)if(!uP(e,t[n]))return!1;return!0}function p$(e){switch(e.length){case 1:return function(t){return{x:t.x,y:t.y,r:t.r}}(e[0]);case 2:return w_(e[0],e[1]);case 3:return cP(e[0],e[1],e[2])}}function w_(e,t){var n=e.x,i=e.y,a=e.r,f=t.x,g=t.y,x=t.r,k=f-n,F=g-i,V=x-a,X=Math.sqrt(k*k+F*F);return{x:(n+f+k/X*V)/2,y:(i+g+F/X*V)/2,r:(X+a+x)/2}}function cP(e,t,n){var i=e.x,a=e.y,f=e.r,g=t.x,x=t.y,k=t.r,F=n.x,V=n.y,X=n.r,te=i-g,se=i-F,he=a-x,ye=a-V,Pe=k-f,Ue=X-f,We=i*i+a*a-f*f,at=We-g*g-x*x+k*k,st=We-F*F-V*V+X*X,lt=se*he-te*ye,ct=(he*st-ye*at)/(2*lt)-i,Ct=(ye*Pe-he*Ue)/lt,Et=(se*at-te*st)/(2*lt)-a,gn=(te*Ue-se*Pe)/lt,An=Ct*Ct+gn*gn-1,wn=2*(f+ct*Ct+Et*gn),$n=ct*ct+Et*Et-f*f,qn=-(An?(wn+Math.sqrt(wn*wn-4*An*$n))/(2*An):$n/wn);return{x:i+ct+Ct*qn,y:a+Et+gn*qn,r:qn}}function lP(e,t,n){var i,a,f,g,x=e.x-t.x,k=e.y-t.y,F=x*x+k*k;F?(a=t.r+n.r,a*=a,g=e.r+n.r,a>(g*=g)?(i=(F+g-a)/(2*F),f=Math.sqrt(Math.max(0,g/F-i*i)),n.x=e.x-i*x-f*k,n.y=e.y-i*k+f*x):(i=(F+a-g)/(2*F),f=Math.sqrt(Math.max(0,a/F-i*i)),n.x=t.x+i*x-f*k,n.y=t.y+i*k+f*x)):(n.x=t.x+n.r,n.y=t.y)}function fP(e,t){var n=e.r+t.r-1e-6,i=t.x-e.x,a=t.y-e.y;return n>0&&n*n>i*i+a*a}function dP(e){var t=e._,n=e.next._,i=t.r+n.r,a=(t.x*n.r+n.x*t.r)/i,f=(t.y*n.r+n.y*t.r)/i;return a*a+f*f}function j3(e){this._=e,this.next=null,this.previous=null}function m$(e){if(!(a=(e=f$(e)).length))return 0;var t,n,i,a,f,g,x,k,F,V,X;if((t=e[0]).x=0,t.y=0,!(a>1))return t.r;if(n=e[1],t.x=-n.r,n.x=t.r,n.y=0,!(a>2))return t.r+n.r;lP(n,t,i=e[2]),t=new j3(t),n=new j3(n),i=new j3(i),t.next=i.previous=n,n.next=t.previous=i,i.next=n.previous=t;e:for(x=3;x<a;++x){lP(t._,n._,i=e[x]),i=new j3(i),k=n.next,F=t.previous,V=n._.r,X=t._.r;do if(V<=X){if(fP(k._,i._)){n=k,t.next=n,n.previous=t,--x;continue e}V+=k._.r,k=k.next}else{if(fP(F._,i._)){(t=F).next=n,n.previous=t,--x;continue e}X+=F._.r,F=F.previous}while(k!==F.next);for(i.previous=t,i.next=n,t.next=n.previous=n=i,f=dP(t);(i=i.next)!==n;)(g=dP(i))<f&&(t=i,f=g);n=t.next}for(t=[n._],i=n;(i=i.next)!==n;)t.push(i._);for(i=d$(t),x=0;x<a;++x)(t=e[x]).x-=i.x,t.y-=i.y;return i.r}function z3(e){if(typeof e!="function")throw new Error;return e}function Yb(){return 0}var kw=function(e){return function(){return e}};function g$(e){return Math.sqrt(e.value)}function hP(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function sM(e,t){return function(n){if(i=n.children){var i,a,f,g=i.length,x=e(n)*t||0;if(x)for(a=0;a<g;++a)i[a].r+=x;if(f=m$(i),x)for(a=0;a<g;++a)i[a].r-=x;n.r=f+x}}}function pP(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}var mP=function(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)},__=function(e,t,n,i,a){for(var f,g=e.children,x=-1,k=g.length,F=e.value&&(i-t)/e.value;++x<k;)(f=g[x]).y0=n,f.y1=a,f.x0=t,f.x1=t+=f.value*F},v$={depth:-1},gP={};function y$(e){return e.id}function b$(e){return e.parentId}var vP=function(){var e=y$,t=b$;function n(i){var a,f,g,x,k,F,V,X=Array.from(i),te=X.length,se=new Map;for(f=0;f<te;++f)a=X[f],k=X[f]=new Sw(a),(F=e(a,f,i))!=null&&(F+="")&&(V=k.id=F,se.set(V,se.has(V)?gP:k)),(F=t(a,f,i))!=null&&(F+="")&&(k.parent=F);for(f=0;f<te;++f)if(F=(k=X[f]).parent){if(!(x=se.get(F)))throw new Error("missing: "+F);if(x===gP)throw new Error("ambiguous: "+F);x.children?x.children.push(k):x.children=[k],k.parent=x}else{if(g)throw new Error("multiple roots");g=k}if(!g)throw new Error("no root");if(g.parent=v$,g.eachBefore(function(he){he.depth=he.parent.depth+1,--te}).eachBefore(sP),g.parent=null,te>0)throw new Error("cycle");return g}return n.id=function(i){return arguments.length?(e=z3(i),n):e},n.parentId=function(i){return arguments.length?(t=z3(i),n):t},n};function x$(e,t){return e.parent===t.parent?1:2}function uM(e){var t=e.children;return t?t[0]:e.t}function cM(e){var t=e.children;return t?t[t.length-1]:e.t}function w$(e,t,n){var i=n/(t.i-e.i);t.c-=i,t.s+=n,e.c+=i,t.z+=n,t.m+=n}function _$(e,t,n){return e.a.parent===t.parent?e.a:n}function U3(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}U3.prototype=Object.create(Sw.prototype);function E$(e,t){return e.parent===t.parent?1:2}function S$(e,t){return e+t.x}function k$(e,t){return Math.max(e,t.y)}var W3=function(e,t,n,i,a){for(var f,g=e.children,x=-1,k=g.length,F=e.value&&(a-n)/e.value;++x<k;)(f=g[x]).x0=t,f.x1=i,f.y0=n,f.y1=n+=f.value*F},yP=(1+Math.sqrt(5))/2;function bP(e,t,n,i,a,f){for(var g,x,k,F,V,X,te,se,he,ye,Pe,Ue=[],We=t.children,at=0,st=0,lt=We.length,ct=t.value;at<lt;){k=a-n,F=f-i;do V=We[st++].value;while(!V&&st<lt);for(X=te=V,Pe=V*V*(ye=Math.max(F/k,k/F)/(ct*e)),he=Math.max(te/Pe,Pe/X);st<lt;++st){if(V+=x=We[st].value,x<X&&(X=x),x>te&&(te=x),Pe=V*V*ye,(se=Math.max(te/Pe,Pe/X))>he){V-=x;break}he=se}Ue.push(g={value:V,dice:k<F,children:We.slice(at,st)}),g.dice?__(g,n,i,a,ct?i+=F*V/ct:f):W3(g,n,i,ct?n+=k*V/ct:a,f),ct-=V,at=st}return Ue}var xP=function e(t){function n(i,a,f,g,x){bP(t,i,a,f,g,x)}return n.ratio=function(i){return e((i=+i)>1?i:1)},n}(yP),C$=function e(t){function n(i,a,f,g,x){if((k=i._squarify)&&k.ratio===t)for(var k,F,V,X,te,se=-1,he=k.length,ye=i.value;++se<he;){for(V=(F=k[se]).children,X=F.value=0,te=V.length;X<te;++X)F.value+=V[X].value;F.dice?__(F,a,f,g,ye?f+=(x-f)*F.value/ye:x):W3(F,a,f,ye?a+=(g-a)*F.value/ye:g,x),ye-=F.value}else i._squarify=k=bP(t,i,a,f,g,x),k.ratio=t}return n.ratio=function(i){return e((i=+i)>1?i:1)},n}(yP);function lM(e,t,n){const i={};return e.each(a=>{const f=a.data;n(f)&&(i[t(f)]=a)}),e.lookup=i,e}function fM(e){Tt.call(this,null,e)}fM.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const A$=e=>e.values;function jy(e){Tt.call(this,null,e)}Object(ke.z)(fM,Tt,{transform(e,t){t.source||Object(ke.o)("Nest transform requires an upstream data source.");var n=e.generate,i=e.modified(),a=t.clone(),f=this.value;return(!f||i||t.changed())&&(f&&f.each(g=>{g.children&&Wt(g.data)&&a.rem.push(g.data)}),this.value=f=oM({values:Object(ke.i)(e.keys).reduce((g,x)=>(g.key(x),g),function(){const g=[],x={entries:k=>function F(V,X){if(++X>g.length)return V;const te=[];for(const se in V)te.push({key:se,values:F(V[se],X)});return te}(function F(V,X){if(X>=g.length)return V;const te=V.length,se=g[X++],he={},ye={};let Pe,Ue,We,at=-1;for(;++at<te;)Pe=se(Ue=V[at])+"",(We=he[Pe])?We.push(Ue):he[Pe]=[Ue];for(Pe in he)ye[Pe]=F(he[Pe],X);return ye}(k,0),0),key:k=>(g.push(k),x)};return x}()).entries(a.source)},A$),n&&f.each(g=>{g.children&&(g=xn(g.data),a.add.push(g),a.source.push(g))}),lM(f,Zt,Zt)),a.source.root=f,a}});const O$=(e,t)=>e.parent===t.parent?1:2;Object(ke.z)(jy,Tt,{transform(e,t){t.source&&t.source.root||Object(ke.o)(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),i=this.fields,a=t.source.root,f=e.as||i;e.field?a.sum(e.field):a.count(),e.sort&&a.sort(Er(e.sort,g=>g.data)),function(g,x,k){for(let F,V=0,X=x.length;V<X;++V)(F=x[V])in k&&g[F](k[F])}(n,this.params,e),n.separation&&n.separation(e.separation!==!1?O$:ke.Q);try{this.value=n(a)}catch(g){Object(ke.o)(g)}return a.each(g=>function(x,k,F){const V=x.data,X=k.length-1;for(let te=0;te<X;++te)V[F[te]]=x[k[te]];V[F[X]]=x.children?x.children.length:0}(g,i,f)),t.reflow(e.modified()).modifies(f).modifies("leaf")}});const dM=["x","y","r","depth","children"];function hM(e){jy.call(this,e)}hM.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:dM.length,default:dM}]},Object(ke.z)(hM,jy,{layout:function(){var e=null,t=1,n=1,i=Yb;function a(f){return f.x=t/2,f.y=n/2,e?f.eachBefore(hP(e)).eachAfter(sM(i,.5)).eachBefore(pP(1)):f.eachBefore(hP(g$)).eachAfter(sM(Yb,1)).eachAfter(sM(i,f.r/Math.min(t,n))).eachBefore(pP(Math.min(t,n)/(2*f.r))),f}return a.radius=function(f){return arguments.length?(e=function(g){return g==null?null:z3(g)}(f),a):e},a.size=function(f){return arguments.length?(t=+f[0],n=+f[1],a):[t,n]},a.padding=function(f){return arguments.length?(i=typeof f=="function"?f:kw(+f),a):i},a},params:["radius","size","padding"],fields:dM});const pM=["x0","y0","x1","y1","depth","children"];function mM(e){jy.call(this,e)}function gM(e){Tt.call(this,null,e)}mM.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:pM.length,default:pM}]},Object(ke.z)(mM,jy,{layout:function(){var e=1,t=1,n=0,i=!1;function a(f){var g=f.height+1;return f.x0=f.y0=n,f.x1=e,f.y1=t/g,f.eachBefore(function(x,k){return function(F){F.children&&__(F,F.x0,x*(F.depth+1)/k,F.x1,x*(F.depth+2)/k);var V=F.x0,X=F.y0,te=F.x1-n,se=F.y1-n;te<V&&(V=te=(V+te)/2),se<X&&(X=se=(X+se)/2),F.x0=V,F.y0=X,F.x1=te,F.y1=se}}(t,g)),i&&f.eachBefore(mP),f}return a.round=function(f){return arguments.length?(i=!!f,a):i},a.size=function(f){return arguments.length?(e=+f[0],t=+f[1],a):[e,t]},a.padding=function(f){return arguments.length?(n=+f,a):n},a},params:["size","round","padding"],fields:pM}),gM.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},Object(ke.z)(gM,Tt,{transform(e,t){t.source||Object(ke.o)("Stratify transform requires an upstream data source.");let n=this.value;const i=e.modified(),a=t.fork(t.ALL).materialize(t.SOURCE),f=!n||i||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return a.source=a.source.slice(),f&&(n=a.source.length?lM(vP().id(e.key).parentId(e.parentKey)(a.source),e.key,ke.Ia):lM(vP()([{}]),e.key,e.key)),a.source.root=this.value=n,a}});const wP={tidy:function(){var e=x$,t=1,n=1,i=null;function a(k){var F=function(Ue){for(var We,at,st,lt,ct,Ct=new U3(Ue,0),Et=[Ct];We=Et.pop();)if(st=We._.children)for(We.children=new Array(ct=st.length),lt=ct-1;lt>=0;--lt)Et.push(at=We.children[lt]=new U3(st[lt],lt)),at.parent=We;return(Ct.parent=new U3(null,0)).children=[Ct],Ct}(k);if(F.eachAfter(f),F.parent.m=-F.z,F.eachBefore(g),i)k.eachBefore(x);else{var V=k,X=k,te=k;k.eachBefore(function(Ue){Ue.x<V.x&&(V=Ue),Ue.x>X.x&&(X=Ue),Ue.depth>te.depth&&(te=Ue)});var se=V===X?1:e(V,X)/2,he=se-V.x,ye=t/(X.x+se+he),Pe=n/(te.depth||1);k.eachBefore(function(Ue){Ue.x=(Ue.x+he)*ye,Ue.y=Ue.depth*Pe})}return k}function f(k){var F=k.children,V=k.parent.children,X=k.i?V[k.i-1]:null;if(F){(function(se){for(var he,ye=0,Pe=0,Ue=se.children,We=Ue.length;--We>=0;)(he=Ue[We]).z+=ye,he.m+=ye,ye+=he.s+(Pe+=he.c)})(k);var te=(F[0].z+F[F.length-1].z)/2;X?(k.z=X.z+e(k._,X._),k.m=k.z-te):k.z=te}else X&&(k.z=X.z+e(k._,X._));k.parent.A=function(se,he,ye){if(he){for(var Pe,Ue=se,We=se,at=he,st=Ue.parent.children[0],lt=Ue.m,ct=We.m,Ct=at.m,Et=st.m;at=cM(at),Ue=uM(Ue),at&&Ue;)st=uM(st),(We=cM(We)).a=se,(Pe=at.z+Ct-Ue.z-lt+e(at._,Ue._))>0&&(w$(_$(at,se,ye),se,Pe),lt+=Pe,ct+=Pe),Ct+=at.m,lt+=Ue.m,Et+=st.m,ct+=We.m;at&&!cM(We)&&(We.t=at,We.m+=Ct-ct),Ue&&!uM(st)&&(st.t=Ue,st.m+=lt-Et,ye=se)}return ye}(k,X,k.parent.A||V[0])}function g(k){k._.x=k.z+k.parent.m,k.m+=k.parent.m}function x(k){k.x*=t,k.y=k.depth*n}return a.separation=function(k){return arguments.length?(e=k,a):e},a.size=function(k){return arguments.length?(i=!1,t=+k[0],n=+k[1],a):i?null:[t,n]},a.nodeSize=function(k){return arguments.length?(i=!0,t=+k[0],n=+k[1],a):i?[t,n]:null},a},cluster:function(){var e=E$,t=1,n=1,i=!1;function a(f){var g,x=0;f.eachAfter(function(te){var se=te.children;se?(te.x=function(he){return he.reduce(S$,0)/he.length}(se),te.y=function(he){return 1+he.reduce(k$,0)}(se)):(te.x=g?x+=e(te,g):0,te.y=0,g=te)});var k=function(te){for(var se;se=te.children;)te=se[0];return te}(f),F=function(te){for(var se;se=te.children;)te=se[se.length-1];return te}(f),V=k.x-e(k,F)/2,X=F.x+e(F,k)/2;return f.eachAfter(i?function(te){te.x=(te.x-f.x)*t,te.y=(f.y-te.y)*n}:function(te){te.x=(te.x-V)/(X-V)*t,te.y=(1-(f.y?te.y/f.y:1))*n})}return a.separation=function(f){return arguments.length?(e=f,a):e},a.size=function(f){return arguments.length?(i=!1,t=+f[0],n=+f[1],a):i?null:[t,n]},a.nodeSize=function(f){return arguments.length?(i=!0,t=+f[0],n=+f[1],a):i?[t,n]:null},a}},vM=["x","y","depth","children"];function yM(e){jy.call(this,e)}function bM(e){Tt.call(this,[],e)}yM.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:vM.length,default:vM}]},Object(ke.z)(yM,jy,{layout(e){const t=e||"tidy";if(Object(ke.w)(wP,t))return wP[t]();Object(ke.o)("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:vM}),bM.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},Object(ke.z)(bM,Tt,{transform(e,t){const n=this.value,i=t.source&&t.source.root,a=t.fork(t.NO_SOURCE),f={};return i||Object(ke.o)("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(a.rem=n,t.visit(t.SOURCE,g=>f[Zt(g)]=1),i.each(g=>{const x=g.data,k=g.parent&&g.parent.data;k&&f[Zt(x)]&&f[Zt(k)]&&a.add.push(xn({source:k,target:x}))}),this.value=a.add):t.changed(t.MOD)&&(t.visit(t.MOD,g=>f[Zt(g)]=1),n.forEach(g=>{(f[Zt(g.source)]||f[Zt(g.target)])&&a.mod.push(g)})),a}});const _P={binary:function(e,t,n,i,a){var f,g,x=e.children,k=x.length,F=new Array(k+1);for(F[0]=g=f=0;f<k;++f)F[f+1]=g+=x[f].value;(function V(X,te,se,he,ye,Pe,Ue){if(X>=te-1){var We=x[X];return We.x0=he,We.y0=ye,We.x1=Pe,void(We.y1=Ue)}for(var at=F[X],st=se/2+at,lt=X+1,ct=te-1;lt<ct;){var Ct=lt+ct>>>1;F[Ct]<st?lt=Ct+1:ct=Ct}st-F[lt-1]<F[lt]-st&&X+1<lt&&--lt;var Et=F[lt]-at,gn=se-Et;if(Pe-he>Ue-ye){var An=se?(he*gn+Pe*Et)/se:Pe;V(X,lt,Et,he,ye,An,Ue),V(lt,te,gn,An,ye,Pe,Ue)}else{var wn=se?(ye*gn+Ue*Et)/se:Ue;V(X,lt,Et,he,ye,Pe,wn),V(lt,te,gn,he,wn,Pe,Ue)}})(0,k,e.value,t,n,i,a)},dice:__,slice:W3,slicedice:function(e,t,n,i,a){(1&e.depth?W3:__)(e,t,n,i,a)},squarify:xP,resquarify:C$},xM=["x0","y0","x1","y1","depth","children"];function wM(e){jy.call(this,e)}wM.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:xM.length,default:xM}]},Object(ke.z)(wM,jy,{layout(){const e=function(){var t=xP,n=!1,i=1,a=1,f=[0],g=Yb,x=Yb,k=Yb,F=Yb,V=Yb;function X(se){return se.x0=se.y0=0,se.x1=i,se.y1=a,se.eachBefore(te),f=[0],n&&se.eachBefore(mP),se}function te(se){var he=f[se.depth],ye=se.x0+he,Pe=se.y0+he,Ue=se.x1-he,We=se.y1-he;Ue<ye&&(ye=Ue=(ye+Ue)/2),We<Pe&&(Pe=We=(Pe+We)/2),se.x0=ye,se.y0=Pe,se.x1=Ue,se.y1=We,se.children&&(he=f[se.depth+1]=g(se)/2,ye+=V(se)-he,Pe+=x(se)-he,Ue-=k(se)-he,We-=F(se)-he,Ue<ye&&(ye=Ue=(ye+Ue)/2),We<Pe&&(Pe=We=(Pe+We)/2),t(se,ye,Pe,Ue,We))}return X.round=function(se){return arguments.length?(n=!!se,X):n},X.size=function(se){return arguments.length?(i=+se[0],a=+se[1],X):[i,a]},X.tile=function(se){return arguments.length?(t=z3(se),X):t},X.padding=function(se){return arguments.length?X.paddingInner(se).paddingOuter(se):X.paddingInner()},X.paddingInner=function(se){return arguments.length?(g=typeof se=="function"?se:kw(+se),X):g},X.paddingOuter=function(se){return arguments.length?X.paddingTop(se).paddingRight(se).paddingBottom(se).paddingLeft(se):X.paddingTop()},X.paddingTop=function(se){return arguments.length?(x=typeof se=="function"?se:kw(+se),X):x},X.paddingRight=function(se){return arguments.length?(k=typeof se=="function"?se:kw(+se),X):k},X.paddingBottom=function(se){return arguments.length?(F=typeof se=="function"?se:kw(+se),X):F},X.paddingLeft=function(se){return arguments.length?(V=typeof se=="function"?se:kw(+se),X):V},X}();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{Object(ke.w)(_P,t)?e.tile(_P[t]):Object(ke.o)("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:xM});const T$=4278190080,M$=268435456,D$=.0625;function N$(e,t,n,i){const a=e.width,f=e.height,g=n||i,x=su(a,f).getContext("2d");t.forEach(Pe=>function Ue(We,at,st){if(!at.length)return;const lt=at[0].mark.marktype;lt==="group"?at.forEach(ct=>{ct.items.forEach(Ct=>Ue(We,Ct.items,st))}):Jl[lt].draw(We,{items:st?at.map(I$):at})}(x,Pe,g));const k=new Uint32Array(x.getImageData(0,0,a,f).data.buffer),F=e.bitmap(),V=g&&e.bitmap();let X,te,se,he,ye;for(te=0;te<f;++te)for(X=0;X<a;++X)(ye=k[te*a+X]&T$)&&(se=e(X),he=e(te),i||F.set(se,he),g&&ye^M$&&V.set(se,he));return[F,V]}function I$(e){const t=ur(e,{});return t.stroke&&(t.strokeOpacity=1),t.fill&&(t.fillOpacity=D$,t.stroke="#000",t.strokeOpacity=1,t.strokeWidth=2),t}const zy=5,ih=31,E_=32,q1=new Uint32Array(E_+1),C0=new Uint32Array(E_+1);C0[0]=0,q1[0]=~C0[0];for(let e=1;e<=E_;++e)C0[e]=C0[e-1]<<1|1,q1[e]=~C0[e];function F$(e,t,n){const i=Math.max(1,Math.sqrt(e*t/1e6)),a=~~((e+2*n+i)/i),f=~~((t+2*n+i)/i),g=x=>~~((x+n)/i);return g.invert=x=>x*i-n,g.bitmap=()=>function(x,k){const F=new Uint32Array(~~((x*k+E_)/E_));function V(te,se){F[te]|=se}function X(te,se){F[te]&=se}return{array:F,get:(te,se)=>{const he=se*x+te;return F[he>>>zy]&1<<(he&ih)},set:(te,se)=>{const he=se*x+te;V(he>>>zy,1<<(he&ih))},clear:(te,se)=>{const he=se*x+te;X(he>>>zy,~(1<<(he&ih)))},getRange:(te,se,he,ye)=>{let Pe,Ue,We,at,st=ye;for(;st>=se;--st)if((We=(Pe=st*x+te)>>>zy)==(at=(Ue=st*x+he)>>>zy)){if(F[We]&q1[Pe&ih]&C0[1+(Ue&ih)])return!0}else{if(F[We]&q1[Pe&ih]||F[at]&C0[1+(Ue&ih)])return!0;for(let lt=We+1;lt<at;++lt)if(F[lt])return!0}return!1},setRange:(te,se,he,ye)=>{let Pe,Ue,We,at,st;for(;se<=ye;++se)if((We=(Pe=se*x+te)>>>zy)==(at=(Ue=se*x+he)>>>zy))V(We,q1[Pe&ih]&C0[1+(Ue&ih)]);else for(V(We,q1[Pe&ih]),V(at,C0[1+(Ue&ih)]),st=We+1;st<at;++st)V(st,4294967295)},clearRange:(te,se,he,ye)=>{let Pe,Ue,We,at,st;for(;se<=ye;++se)if((We=(Pe=se*x+te)>>>zy)==(at=(Ue=se*x+he)>>>zy))X(We,C0[Pe&ih]|q1[1+(Ue&ih)]);else for(X(We,C0[Pe&ih]),X(at,q1[1+(Ue&ih)]),st=We+1;st<at;++st)X(st,0)},outOfBounds:(te,se,he,ye)=>te<0||se<0||ye>=k||he>=x}}(a,f),g.ratio=i,g.padding=n,g.width=e,g.height=t,g}function V3(e,t,n,i,a,f){let g=n/2;return e-g<0||e+g>a||t-(g=i/2)<0||t+g>f}function $1(e,t,n,i,a,f,g,x){const k=a*f/(2*i),F=e(t-k),V=e(t+k),X=e(n-(f/=2)),te=e(n+f);return g.outOfBounds(F,X,V,te)||g.getRange(F,X,V,te)||x&&x.getRange(F,X,V,te)}const R$=[-1,-1,1,1],P$=[-1,1,-1,1],L$=["right","center","left"],B$=["bottom","middle","top"];function EP(e,t,n,i,a,f,g,x,k,F,V,X){return!(a.outOfBounds(e,n,t,i)||(X&&f?f.getRange(e,n,t,i)||!function(te,se,he,ye,Pe){return Pe[0]<=te&&he<=Pe[2]&&Pe[3]<=se&&ye<=Pe[5]}(g,k,x,F,V):a.getRange(e,n,t,i)))}const j$={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},z$={naive:function(e,t,n,i){const a=e.width,f=e.height;return function(g){const x=g.datum.datum.items[i].items,k=x.length,F=g.datum.fontSize,V=ks.width(g.datum,g.datum.text);let X,te,se,he,ye,Pe,Ue,We=0;for(let at=0;at<k;++at)X=x[at].x,se=x[at].y,ye=(X+(te=x[at].x2===void 0?X:x[at].x2))/2,Pe=(se+(he=x[at].y2===void 0?se:x[at].y2))/2,(Ue=Math.abs(te-X+he-se))>=We&&(We=Ue,g.x=ye,g.y=Pe);return ye=V/2,Pe=F/2,X=g.x-ye,te=g.x+ye,se=g.y-Pe,he=g.y+Pe,g.align="center",X<0&&te<=a?g.align="left":0<=X&&a<te&&(g.align="right"),g.baseline="middle",se<0&&he<=f?g.baseline="top":0<=se&&f<he&&(g.baseline="bottom"),!0}},"reduced-search":function(e,t,n,i){const a=e.width,f=e.height,g=t[0],x=t[1];function k(F,V,X,te,se){const he=e.invert(F),ye=e.invert(V);let Pe,Ue=X,We=f;if(!V3(he,ye,te,se,a,f)&&!$1(e,he,ye,se,te,Ue,g,x)&&!$1(e,he,ye,se,te,se,g,null)){for(;We-Ue>=1;)$1(e,he,ye,se,te,Pe=(Ue+We)/2,g,x)?We=Pe:Ue=Pe;if(Ue>X)return[he,ye,Ue,!0]}}return function(F){const V=F.datum.datum.items[i].items,X=V.length,te=F.datum.fontSize,se=ks.width(F.datum,F.datum.text);let he,ye,Pe,Ue,We,at,st,lt,ct,Ct,Et,gn,An,wn,$n,qn,er,rr=n?te:0,lr=!1,Or=!1,Jr=0;for(let Lr=0;Lr<X;++Lr){for(he=V[Lr].x,Pe=V[Lr].y,ye=V[Lr].x2===void 0?he:V[Lr].x2,Ue=V[Lr].y2===void 0?Pe:V[Lr].y2,he>ye&&(er=he,he=ye,ye=er),Pe>Ue&&(er=Pe,Pe=Ue,Ue=er),Ct=~~(((ct=e(he))+(Et=e(ye)))/2),An=~~(((gn=e(Pe))+(wn=e(Ue)))/2),st=Ct;st>=ct;--st)for(lt=An;lt>=gn;--lt)(qn=k(st,lt,rr,se,te))&&([F.x,F.y,rr,lr]=qn);for(st=Ct;st<=Et;++st)for(lt=An;lt<=wn;++lt)(qn=k(st,lt,rr,se,te))&&([F.x,F.y,rr,lr]=qn);lr||n||(We=(he+ye)/2,at=(Pe+Ue)/2,($n=Math.abs(ye-he+Ue-Pe))>=Jr&&!V3(We,at,se,te,a,f)&&!$1(e,We,at,te,se,te,g,null)&&(Jr=$n,F.x=We,F.y=at,Or=!0))}return!(!lr&&!Or||(We=se/2,at=te/2,g.setRange(e(F.x-We),e(F.y-at),e(F.x+We),e(F.y+at)),F.align="center",F.baseline="middle",0))}},floodfill:function(e,t,n,i){const a=e.width,f=e.height,g=t[0],x=t[1],k=e.bitmap();return function(F){const V=F.datum.datum.items[i].items,X=V.length,te=F.datum.fontSize,se=ks.width(F.datum,F.datum.text),he=[];let ye,Pe,Ue,We,at,st,lt,ct,Ct,Et,gn,An,wn=n?te:0,$n=!1,qn=!1,er=0;for(let rr=0;rr<X;++rr){for(ye=V[rr].x,Ue=V[rr].y,Pe=V[rr].x2===void 0?ye:V[rr].x2,We=V[rr].y2===void 0?Ue:V[rr].y2,he.push([e((ye+Pe)/2),e((Ue+We)/2)]);he.length;)if([lt,ct]=he.pop(),!(g.get(lt,ct)||x.get(lt,ct)||k.get(lt,ct))){k.set(lt,ct);for(let lr=0;lr<4;++lr)at=lt+R$[lr],st=ct+P$[lr],k.outOfBounds(at,st,at,st)||he.push([at,st]);if(at=e.invert(lt),st=e.invert(ct),Ct=wn,Et=f,!V3(at,st,se,te,a,f)&&!$1(e,at,st,te,se,Ct,g,x)&&!$1(e,at,st,te,se,te,g,null)){for(;Et-Ct>=1;)$1(e,at,st,te,se,gn=(Ct+Et)/2,g,x)?Et=gn:Ct=gn;Ct>wn&&(F.x=at,F.y=st,wn=Ct,$n=!0)}}$n||n||(at=(ye+Pe)/2,st=(Ue+We)/2,(An=Math.abs(Pe-ye+We-Ue))>=er&&!V3(at,st,se,te,a,f)&&!$1(e,at,st,te,se,te,g,null)&&(er=An,F.x=at,F.y=st,qn=!0))}return!(!$n&&!qn||(at=se/2,st=te/2,g.setRange(e(F.x-at),e(F.y-st),e(F.x+at),e(F.y+st)),F.align="center",F.baseline="middle",0))}}};function U$(e,t,n,i,a,f,g,x,k,F,V){if(!e.length)return e;const X=Math.max(i.length,a.length),te=function(Ct,Et){const gn=new Float64Array(Et),An=Ct.length;for(let wn=0;wn<An;++wn)gn[wn]=Ct[wn]||0;for(let wn=An;wn<Et;++wn)gn[wn]=gn[An-1];return gn}(i,X),se=function(Ct,Et){const gn=new Int8Array(Et),An=Ct.length;for(let wn=0;wn<An;++wn)gn[wn]|=j$[Ct[wn]];for(let wn=An;wn<Et;++wn)gn[wn]=gn[An-1];return gn}(a,X),he=function(Ct){return Ct&&Ct.mark&&Ct.mark.marktype}(e[0].datum),ye=he==="group"&&e[0].datum.items[k].marktype,Pe=ye==="area",Ue=function(Ct,Et,gn,An){const wn=$n=>[$n.x,$n.x,$n.x,$n.y,$n.y,$n.y];return Ct?Ct==="line"||Ct==="area"?$n=>wn($n.datum):Et==="line"?$n=>{const qn=$n.datum.items[An].items;return wn(qn.length?qn[gn==="start"?0:qn.length-1]:{x:NaN,y:NaN})}:$n=>{const qn=$n.datum.bounds;return[qn.x1,(qn.x1+qn.x2)/2,qn.x2,qn.y1,(qn.y1+qn.y2)/2,qn.y2]}:wn}(he,ye,x,k),We=F$(t[0],t[1],F),at=Pe&&V==="naive",st=e.map(Ct=>({datum:Ct,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:Ue(Ct)}));let lt;if(!at){n&&st.sort((Et,gn)=>n(Et.datum,gn.datum));let Ct=!1;for(let Et=0;Et<se.length&&!Ct;++Et)Ct=se[Et]===5||te[Et]<0;he&&(g||Pe)&&(f=[e.map(Et=>Et.datum)].concat(f)),lt=f.length?N$(We,f,Ct,Pe):function(Et,gn){const An=Et.bitmap();return(gn||[]).forEach(wn=>An.set(Et(wn.boundary[0]),Et(wn.boundary[3]))),[An,void 0]}(We,g&&st)}const ct=Pe?z$[V](We,lt,g,k):function(Ct,Et,gn,An){const wn=Ct.width,$n=Ct.height,qn=Et[0],er=Et[1],rr=An.length;return function(lr){const Or=lr.boundary,Jr=lr.datum.fontSize;if(Or[2]<0||Or[5]<0||Or[0]>wn||Or[3]>$n)return!1;let Lr,li,Ai,Ti,Ji,Ii,Mi,ji,Co,ca,Qi,Ca,Aa,es,Vs,Hs=0;for(let Os=0;Os<rr;++Os){if(Lr=(3&gn[Os])-1,li=(gn[Os]>>>2&3)-1,Ai=Lr===0&&li===0||An[Os]<0,Ti=Lr&&li?Math.SQRT1_2:1,Ji=An[Os]<0?-1:1,Ii=Or[1+Lr]+An[Os]*Lr*Ti,ji=(Qi=Or[4+li]+Ji*Jr*li/2+An[Os]*li*Ti)-Jr/2,Co=Qi+Jr/2,Ca=Ct(Ii),es=Ct(ji),Vs=Ct(Co),!Hs){if(!EP(Ca,Ca,es,Vs,qn,er,Ii,Ii,ji,Co,Or,Ai))continue;Hs=ks.width(lr.datum,lr.datum.text)}if(Mi=(ca=Ii+Ji*Hs*Lr/2)+Hs/2,EP(Ca=Ct(Ii=ca-Hs/2),Aa=Ct(Mi),es,Vs,qn,er,Ii,Mi,ji,Co,Or,Ai))return lr.x=Lr?Lr*Ji<0?Mi:Ii:ca,lr.y=li?li*Ji<0?Co:ji:Qi,lr.align=L$[Lr*Ji+1],lr.baseline=B$[li*Ji+1],qn.setRange(Ca,es,Aa,Vs),!0}return!1}}(We,lt,se,te);return st.forEach(Ct=>Ct.opacity=+ct(Ct)),st}const _M=["x","y","opacity","align","baseline"],SP=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function EM(e){Tt.call(this,null,e)}function kP(e,t){var n,i,a,f,g,x,k=[],F=function(V){return V(f)};if(t==null)k.push(e);else for(n={},i=0,a=e.length;i<a;++i)f=e[i],(x=n[g=t.map(F)])||(n[g]=x=[],x.dims=g,k.push(x)),x.push(f);return k}function SM(e){Tt.call(this,null,e)}EM.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:SP},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:_M.length,default:_M}]},Object(ke.z)(EM,Tt,{transform(e,t){const n=e.modified();if(!(n||t.changed(t.ADD_REM)||function(a){const f=e[a];return Object(ke.E)(f)&&t.modified(f.fields)}("sort")))return;e.size&&e.size.length===2||Object(ke.o)("Size parameter should be specified as a [width, height] array.");const i=e.as||_M;return U$(t.materialize(t.SOURCE).source,e.size,e.sort,Object(ke.i)(e.offset||1),Object(ke.i)(e.anchor||SP),e.avoidMarks||[],e.avoidBaseMark!==!1,e.lineAnchor||"end",e.markIndex||0,e.padding||0,e.method||"naive").forEach(a=>{const f=a.datum;f[i[0]]=a.x,f[i[1]]=a.y,f[i[2]]=a.opacity,f[i[3]]=a.align,f[i[4]]=a.baseline}),t.reflow(n).modifies(i)}}),SM.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},Object(ke.z)(SM,Tt,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=kP(t.materialize(t.SOURCE).source,e.groupby),a=(e.groupby||[]).map(ke.h),f=a.length,g=e.as||[Object(ke.h)(e.x),Object(ke.h)(e.y)],x=[];i.forEach(k=>{ld(k,e.x,e.y,e.bandwidth||.3).forEach(F=>{const V={};for(let X=0;X<f;++X)V[a[X]]=k.dims[X];V[g[0]]=F[0],V[g[1]]=F[1],x.push(xn(V))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=x}return n}});const kM={linear:bs,log:Fa,exp:Oc,pow:cf,quad:Tc,poly:Mu};function CM(e){Tt.call(this,null,e)}CM.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(kM)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},Object(ke.z)(CM,Tt,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=kP(t.materialize(t.SOURCE).source,e.groupby),a=(e.groupby||[]).map(ke.h),f=e.method||"linear",g=e.order||3,x=((te,se)=>te==="poly"?se:te==="quad"?2:1)(f,g),k=e.as||[Object(ke.h)(e.x),Object(ke.h)(e.y)],F=kM[f],V=[];let X=e.extent;Object(ke.w)(kM,f)||Object(ke.o)("Invalid regression method: "+f),X!=null&&f==="log"&&X[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),X=null),i.forEach(te=>{if(te.length<=x)return void t.dataflow.warn("Skipping regression with more parameters than data points.");const se=F(te,e.x,e.y,g);if(e.params)return void V.push(xn({keys:te.dims,coef:se.coef,rSquared:se.rSquared}));const he=X||Object(ke.q)(te,e.x),ye=Pe=>{const Ue={};for(let We=0;We<a.length;++We)Ue[a[We]]=te.dims[We];Ue[k[0]]=Pe[0],Ue[k[1]]=Pe[1],V.push(xn(Ue))};f==="linear"?he.forEach(Pe=>ye([Pe,se.predict(Pe)])):fd(se.predict,he,25,200).forEach(ye)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=V}return n}});const CP=Math.pow(2,-52),H3=new Uint32Array(512);class G3{static from(t,n=function(a){return a[0]},i=function(a){return a[1]}){const a=t.length,f=new Float64Array(2*a);for(let g=0;g<a;g++){const x=t[g];f[2*g]=n(x),f[2*g+1]=i(x)}return new G3(f)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const i=Math.max(2*n-5,0);this._triangles=new Uint32Array(3*i),this._halfedges=new Int32Array(3*i),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:i,_hullTri:a,_hullHash:f}=this,g=t.length>>1;let x=1/0,k=1/0,F=-1/0,V=-1/0;for(let An=0;An<g;An++){const wn=t[2*An],$n=t[2*An+1];wn<x&&(x=wn),$n<k&&(k=$n),wn>F&&(F=wn),$n>V&&(V=$n),this._ids[An]=An}const X=(x+F)/2,te=(k+V)/2;let se,he,ye,Pe=1/0;for(let An=0;An<g;An++){const wn=AM(X,te,t[2*An],t[2*An+1]);wn<Pe&&(se=An,Pe=wn)}const Ue=t[2*se],We=t[2*se+1];Pe=1/0;for(let An=0;An<g;An++){if(An===se)continue;const wn=AM(Ue,We,t[2*An],t[2*An+1]);wn<Pe&&wn>0&&(he=An,Pe=wn)}let at=t[2*he],st=t[2*he+1],lt=1/0;for(let An=0;An<g;An++){if(An===se||An===he)continue;const wn=V$(Ue,We,at,st,t[2*An],t[2*An+1]);wn<lt&&(ye=An,lt=wn)}let ct=t[2*ye],Ct=t[2*ye+1];if(lt===1/0){for(let $n=0;$n<g;$n++)this._dists[$n]=t[2*$n]-t[0]||t[2*$n+1]-t[1];Cw(this._ids,this._dists,0,g-1);const An=new Uint32Array(g);let wn=0;for(let $n=0,qn=-1/0;$n<g;$n++){const er=this._ids[$n];this._dists[er]>qn&&(An[wn++]=er,qn=this._dists[er])}return this.hull=An.subarray(0,wn),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(q3(Ue,We,at,st,ct,Ct)){const An=he,wn=at,$n=st;he=ye,at=ct,st=Ct,ye=An,ct=wn,Ct=$n}const Et=function(An,wn,$n,qn,er,rr){const lr=$n-An,Or=qn-wn,Jr=er-An,Lr=rr-wn,li=lr*lr+Or*Or,Ai=Jr*Jr+Lr*Lr,Ti=.5/(lr*Lr-Or*Jr);return{x:An+(Lr*li-Or*Ai)*Ti,y:wn+(lr*Ai-Jr*li)*Ti}}(Ue,We,at,st,ct,Ct);this._cx=Et.x,this._cy=Et.y;for(let An=0;An<g;An++)this._dists[An]=AM(t[2*An],t[2*An+1],Et.x,Et.y);Cw(this._ids,this._dists,0,g-1),this._hullStart=se;let gn=3;i[se]=n[ye]=he,i[he]=n[se]=ye,i[ye]=n[he]=se,a[se]=0,a[he]=1,a[ye]=2,f.fill(-1),f[this._hashKey(Ue,We)]=se,f[this._hashKey(at,st)]=he,f[this._hashKey(ct,Ct)]=ye,this.trianglesLen=0,this._addTriangle(se,he,ye,-1,-1,-1);for(let An,wn,$n=0;$n<this._ids.length;$n++){const qn=this._ids[$n],er=t[2*qn],rr=t[2*qn+1];if($n>0&&Math.abs(er-An)<=CP&&Math.abs(rr-wn)<=CP||(An=er,wn=rr,qn===se||qn===he||qn===ye))continue;let lr=0;for(let Ai=0,Ti=this._hashKey(er,rr);Ai<this._hashSize&&((lr=f[(Ti+Ai)%this._hashSize])===-1||lr===i[lr]);Ai++);let Or,Jr=lr=n[lr];for(;Or=i[Jr],!q3(er,rr,t[2*Jr],t[2*Jr+1],t[2*Or],t[2*Or+1]);)if((Jr=Or)===lr){Jr=-1;break}if(Jr===-1)continue;let Lr=this._addTriangle(Jr,qn,i[Jr],-1,-1,a[Jr]);a[qn]=this._legalize(Lr+2),a[Jr]=Lr,gn++;let li=i[Jr];for(;Or=i[li],q3(er,rr,t[2*li],t[2*li+1],t[2*Or],t[2*Or+1]);)Lr=this._addTriangle(li,qn,Or,a[qn],-1,a[li]),a[qn]=this._legalize(Lr+2),i[li]=li,gn--,li=Or;if(Jr===lr)for(;q3(er,rr,t[2*(Or=n[Jr])],t[2*Or+1],t[2*Jr],t[2*Jr+1]);)Lr=this._addTriangle(Or,qn,Jr,-1,a[Jr],a[Or]),this._legalize(Lr+2),a[Or]=Lr,i[Jr]=Jr,gn--,Jr=Or;this._hullStart=n[qn]=Jr,i[Jr]=n[li]=qn,i[qn]=li,f[this._hashKey(er,rr)]=qn,f[this._hashKey(t[2*Jr],t[2*Jr+1])]=Jr}this.hull=new Uint32Array(gn);for(let An=0,wn=this._hullStart;An<gn;An++)this.hull[An]=wn,wn=i[wn];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(function(i,a){const f=i/(Math.abs(i)+Math.abs(a));return(a>0?3-f:1+f)/4}(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:i,coords:a}=this;let f=0,g=0;for(;;){const x=i[t],k=t-t%3;if(g=k+(t+2)%3,x===-1){if(f===0)break;t=H3[--f];continue}const F=x-x%3,V=k+(t+1)%3,X=F+(x+2)%3,te=n[g],se=n[t],he=n[V],ye=n[X];if(W$(a[2*te],a[2*te+1],a[2*se],a[2*se+1],a[2*he],a[2*he+1],a[2*ye],a[2*ye+1])){n[t]=ye,n[x]=te;const Pe=i[X];if(Pe===-1){let We=this._hullStart;do{if(this._hullTri[We]===X){this._hullTri[We]=t;break}We=this._hullPrev[We]}while(We!==this._hullStart)}this._link(t,Pe),this._link(x,i[g]),this._link(g,X);const Ue=F+(x+1)%3;f<H3.length&&(H3[f++]=Ue)}else{if(f===0)break;t=H3[--f]}}return g}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,i,a,f,g){const x=this.trianglesLen;return this._triangles[x]=t,this._triangles[x+1]=n,this._triangles[x+2]=i,this._link(x,a),this._link(x+1,f),this._link(x+2,g),this.trianglesLen+=3,x}}function AM(e,t,n,i){const a=e-n,f=t-i;return a*a+f*f}function OM(e,t,n,i,a,f){const g=(i-t)*(a-e),x=(n-e)*(f-t);return Math.abs(g-x)>=33306690738754716e-32*Math.abs(g+x)?g-x:0}function q3(e,t,n,i,a,f){return(OM(a,f,e,t,n,i)||OM(e,t,n,i,a,f)||OM(n,i,a,f,e,t))<0}function W$(e,t,n,i,a,f,g,x){const k=e-g,F=t-x,V=n-g,X=i-x,te=a-g,se=f-x,he=V*V+X*X,ye=te*te+se*se;return k*(X*ye-he*se)-F*(V*ye-he*te)+(k*k+F*F)*(V*se-X*te)<0}function V$(e,t,n,i,a,f){const g=n-e,x=i-t,k=a-e,F=f-t,V=g*g+x*x,X=k*k+F*F,te=.5/(g*F-x*k),se=(F*V-x*X)*te,he=(g*X-k*V)*te;return se*se+he*he}function Cw(e,t,n,i){if(i-n<=20)for(let a=n+1;a<=i;a++){const f=e[a],g=t[f];let x=a-1;for(;x>=n&&t[e[x]]>g;)e[x+1]=e[x--];e[x+1]=f}else{let a=n+1,f=i;S_(e,n+i>>1,a),t[e[n]]>t[e[i]]&&S_(e,n,i),t[e[a]]>t[e[i]]&&S_(e,a,i),t[e[n]]>t[e[a]]&&S_(e,n,a);const g=e[a],x=t[g];for(;;){do a++;while(t[e[a]]<x);do f--;while(t[e[f]]>x);if(f<a)break;S_(e,a,f)}e[n+1]=e[f],e[f]=g,i-a+1>=f-n?(Cw(e,t,a,i),Cw(e,t,n,f-1)):(Cw(e,t,n,f-1),Cw(e,t,a,i))}}function S_(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}const AP=1e-6;class Jb{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,i){const a=(t=+t)+(i=+i),f=n=+n;if(i<0)throw new Error("negative radius");this._x1===null?this._+=`M${a},${f}`:(Math.abs(this._x1-a)>AP||Math.abs(this._y1-f)>AP)&&(this._+="L"+a+","+f),i&&(this._+=`A${i},${i},0,1,1,${t-i},${n}A${i},${i},0,1,1,${this._x1=a},${this._y1=f}`)}rect(t,n,i,a){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+i}v${+a}h${-i}Z`}value(){return this._||null}}class TM{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}class H${constructor(t,[n,i,a,f]=[0,0,960,500]){if(!((a=+a)>=(n=+n)&&(f=+f)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=a,this.xmin=n,this.ymax=f,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:i},vectors:a}=this,f=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let se,he,ye=0,Pe=0,Ue=i.length;ye<Ue;ye+=3,Pe+=2){const We=2*i[ye],at=2*i[ye+1],st=2*i[ye+2],lt=t[We],ct=t[We+1],Ct=t[at],Et=t[at+1],gn=t[st],An=t[st+1],wn=Ct-lt,$n=Et-ct,qn=gn-lt,er=An-ct,rr=wn*wn+$n*$n,lr=qn*qn+er*er,Or=2*(wn*er-$n*qn);if(Or)if(Math.abs(Or)<1e-8)se=(lt+gn)/2,he=(ct+An)/2;else{const Jr=1/Or;se=lt+(er*rr-$n*lr)*Jr,he=ct+(wn*lr-qn*rr)*Jr}else se=(lt+gn)/2-1e8*er,he=(ct+An)/2+1e8*qn;f[Pe]=se,f[Pe+1]=he}let g,x,k,F=n[n.length-1],V=4*F,X=t[2*F],te=t[2*F+1];a.fill(0);for(let se=0;se<n.length;++se)g=V,x=X,k=te,V=4*(F=n[se]),X=t[2*F],te=t[2*F+1],a[g+2]=a[V]=k-te,a[g+3]=a[V+1]=X-x}render(t){const n=t==null?t=new Jb:void 0,{delaunay:{halfedges:i,inedges:a,hull:f},circumcenters:g,vectors:x}=this;if(f.length<=1)return null;for(let V=0,X=i.length;V<X;++V){const te=i[V];if(te<V)continue;const se=2*Math.floor(V/3),he=2*Math.floor(te/3),ye=g[se],Pe=g[se+1],Ue=g[he],We=g[he+1];this._renderSegment(ye,Pe,Ue,We,t)}let k,F=f[f.length-1];for(let V=0;V<f.length;++V){k=F,F=f[V];const X=2*Math.floor(a[F]/3),te=g[X],se=g[X+1],he=4*k,ye=this._project(te,se,x[he+2],x[he+3]);ye&&this._renderSegment(te,se,ye[0],ye[1],t)}return n&&n.value()}renderBounds(t){const n=t==null?t=new Jb:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const i=n==null?n=new Jb:void 0,a=this._clip(t);if(a===null||!a.length)return;n.moveTo(a[0],a[1]);let f=a.length;for(;a[0]===a[f-2]&&a[1]===a[f-1]&&f>1;)f-=2;for(let g=2;g<f;g+=2)a[g]===a[g-2]&&a[g+1]===a[g-1]||n.lineTo(a[g],a[g+1]);return n.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,i=t.length/2;n<i;++n){const a=this.cellPolygon(n);a&&(a.index=n,yield a)}}cellPolygon(t){const n=new TM;return this.renderCell(t,n),n.value()}_renderSegment(t,n,i,a,f){let g;const x=this._regioncode(t,n),k=this._regioncode(i,a);x===0&&k===0?(f.moveTo(t,n),f.lineTo(i,a)):(g=this._clipSegment(t,n,i,a,x,k))&&(f.moveTo(g[0],g[1]),f.lineTo(g[2],g[3]))}contains(t,n,i){return(n=+n)==n&&(i=+i)==i&&this.delaunay._step(t,n,i)===t}*neighbors(t){const n=this._clip(t);if(n)for(const i of this.delaunay.neighbors(t)){const a=this._clip(i);if(a){e:for(let f=0,g=n.length;f<g;f+=2)for(let x=0,k=a.length;x<k;x+=2)if(n[f]==a[x]&&n[f+1]==a[x+1]&&n[(f+2)%g]==a[(x+k-2)%k]&&n[(f+3)%g]==a[(x+k-1)%k]){yield i;break e}}}}_cell(t){const{circumcenters:n,delaunay:{inedges:i,halfedges:a,triangles:f}}=this,g=i[t];if(g===-1)return null;const x=[];let k=g;do{const F=Math.floor(k/3);if(x.push(n[2*F],n[2*F+1]),f[k=k%3==2?k-2:k+1]!==t)break;k=a[k]}while(k!==g&&k!==-1);return x}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(n===null)return null;const{vectors:i}=this,a=4*t;return i[a]||i[a+1]?this._clipInfinite(t,n,i[a],i[a+1],i[a+2],i[a+3]):this._clipFinite(t,n)}_clipFinite(t,n){const i=n.length;let a,f,g,x,k,F=null,V=n[i-2],X=n[i-1],te=this._regioncode(V,X);for(let se=0;se<i;se+=2)if(a=V,f=X,V=n[se],X=n[se+1],g=te,te=this._regioncode(V,X),g===0&&te===0)x=k,k=0,F?F.push(V,X):F=[V,X];else{let he,ye,Pe,Ue,We;if(g===0){if((he=this._clipSegment(a,f,V,X,g,te))===null)continue;[ye,Pe,Ue,We]=he}else{if((he=this._clipSegment(V,X,a,f,te,g))===null)continue;[Ue,We,ye,Pe]=he,x=k,k=this._edgecode(ye,Pe),x&&k&&this._edge(t,x,k,F,F.length),F?F.push(ye,Pe):F=[ye,Pe]}x=k,k=this._edgecode(Ue,We),x&&k&&this._edge(t,x,k,F,F.length),F?F.push(Ue,We):F=[Ue,We]}if(F)x=k,k=this._edgecode(F[0],F[1]),x&&k&&this._edge(t,x,k,F,F.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return F}_clipSegment(t,n,i,a,f,g){for(;;){if(f===0&&g===0)return[t,n,i,a];if(f&g)return null;let x,k,F=f||g;8&F?(x=t+(i-t)*(this.ymax-n)/(a-n),k=this.ymax):4&F?(x=t+(i-t)*(this.ymin-n)/(a-n),k=this.ymin):2&F?(k=n+(a-n)*(this.xmax-t)/(i-t),x=this.xmax):(k=n+(a-n)*(this.xmin-t)/(i-t),x=this.xmin),f?(t=x,n=k,f=this._regioncode(t,n)):(i=x,a=k,g=this._regioncode(i,a))}}_clipInfinite(t,n,i,a,f,g){let x,k=Array.from(n);if((x=this._project(k[0],k[1],i,a))&&k.unshift(x[0],x[1]),(x=this._project(k[k.length-2],k[k.length-1],f,g))&&k.push(x[0],x[1]),k=this._clipFinite(t,k))for(let F,V=0,X=k.length,te=this._edgecode(k[X-2],k[X-1]);V<X;V+=2)F=te,te=this._edgecode(k[V],k[V+1]),F&&te&&(V=this._edge(t,F,te,k,V),X=k.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(k=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return k}_edge(t,n,i,a,f){for(;n!==i;){let g,x;switch(n){case 5:n=4;continue;case 4:n=6,g=this.xmax,x=this.ymin;break;case 6:n=2;continue;case 2:n=10,g=this.xmax,x=this.ymax;break;case 10:n=8;continue;case 8:n=9,g=this.xmin,x=this.ymax;break;case 9:n=1;continue;case 1:n=5,g=this.xmin,x=this.ymin}a[f]===g&&a[f+1]===x||!this.contains(t,g,x)||(a.splice(f,0,g,x),f+=2)}if(a.length>4)for(let g=0;g<a.length;g+=2){const x=(g+2)%a.length,k=(g+4)%a.length;(a[g]===a[x]&&a[x]===a[k]||a[g+1]===a[x+1]&&a[x+1]===a[k+1])&&(a.splice(x,2),g-=2)}return f}_project(t,n,i,a){let f,g,x,k=1/0;if(a<0){if(n<=this.ymin)return null;(f=(this.ymin-n)/a)<k&&(x=this.ymin,g=t+(k=f)*i)}else if(a>0){if(n>=this.ymax)return null;(f=(this.ymax-n)/a)<k&&(x=this.ymax,g=t+(k=f)*i)}if(i>0){if(t>=this.xmax)return null;(f=(this.xmax-t)/i)<k&&(g=this.xmax,x=n+(k=f)*a)}else if(i<0){if(t<=this.xmin)return null;(f=(this.xmin-t)/i)<k&&(g=this.xmin,x=n+(k=f)*a)}return[g,x]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}}const G$=2*Math.PI,Aw=Math.pow;function q$(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class MM{static from(t,n=function(f){return f[0]},i=function(f){return f[1]},a){return new MM("length"in t?function(f,g,x,k){const F=f.length,V=new Float64Array(2*F);for(let X=0;X<F;++X){const te=f[X];V[2*X]=g.call(k,te,X,f),V[2*X+1]=x.call(k,te,X,f)}return V}(t,n,i,a):Float64Array.from(function*(f,g,x,k){let F=0;for(const V of f)yield g.call(k,V,F,f),yield x.call(k,V,F,f),++F}(t,n,i,a)))}constructor(t){this._delaunator=new G3(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&function(k){const{triangles:F,coords:V}=k;for(let X=0;X<F.length;X+=3){const te=2*F[X],se=2*F[X+1],he=2*F[X+2];if((V[he]-V[te])*(V[se+1]-V[te+1])-(V[se]-V[te])*(V[he+1]-V[te+1])>1e-10)return!1}return!0}(t)){this.collinear=Int32Array.from({length:n.length/2},(te,se)=>se).sort((te,se)=>n[2*te]-n[2*se]||n[2*te+1]-n[2*se+1]);const k=this.collinear[0],F=this.collinear[this.collinear.length-1],V=[n[2*k],n[2*k+1],n[2*F],n[2*F+1]],X=1e-8*Math.hypot(V[3]-V[1],V[2]-V[0]);for(let te=0,se=n.length/2;te<se;++te){const he=q$(n[2*te],n[2*te+1],X);n[2*te]=he[0],n[2*te+1]=he[1]}this._delaunator=new G3(n)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,a=this.hull=this._delaunator.hull,f=this.triangles=this._delaunator.triangles,g=this.inedges.fill(-1),x=this._hullIndex.fill(-1);for(let k=0,F=i.length;k<F;++k){const V=f[k%3==2?k-2:k+1];i[k]!==-1&&g[V]!==-1||(g[V]=k)}for(let k=0,F=a.length;k<F;++k)x[a[k]]=k;a.length<=2&&a.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=a[0],this.triangles[1]=a[1],this.triangles[2]=a[1],g[a[0]]=1,a.length===2&&(g[a[1]]=0))}voronoi(t){return new H$(this,t)}*neighbors(t){const{inedges:n,hull:i,_hullIndex:a,halfedges:f,triangles:g,collinear:x}=this;if(x){const X=x.indexOf(t);return X>0&&(yield x[X-1]),void(X<x.length-1&&(yield x[X+1]))}const k=n[t];if(k===-1)return;let F=k,V=-1;do{if(yield V=g[F],g[F=F%3==2?F-2:F+1]!==t)return;if((F=f[F])===-1){const X=i[(a[t]+1)%i.length];return void(X!==V&&(yield X))}}while(F!==k)}find(t,n,i=0){if((t=+t)!=t||(n=+n)!=n)return-1;const a=i;let f;for(;(f=this._step(i,t,n))>=0&&f!==i&&f!==a;)i=f;return f}_step(t,n,i){const{inedges:a,hull:f,_hullIndex:g,halfedges:x,triangles:k,points:F}=this;if(a[t]===-1||!F.length)return(t+1)%(F.length>>1);let V=t,X=Aw(n-F[2*t],2)+Aw(i-F[2*t+1],2);const te=a[t];let se=te;do{let he=k[se];const ye=Aw(n-F[2*he],2)+Aw(i-F[2*he+1],2);if(ye<X&&(X=ye,V=he),k[se=se%3==2?se-2:se+1]!==t)break;if((se=x[se])===-1){if((se=f[(g[t]+1)%f.length])!==he&&Aw(n-F[2*se],2)+Aw(i-F[2*se+1],2)<X)return se;break}}while(se!==te);return V}render(t){const n=t==null?t=new Jb:void 0,{points:i,halfedges:a,triangles:f}=this;for(let g=0,x=a.length;g<x;++g){const k=a[g];if(k<g)continue;const F=2*f[g],V=2*f[k];t.moveTo(i[F],i[F+1]),t.lineTo(i[V],i[V+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n=2){const i=t==null?t=new Jb:void 0,{points:a}=this;for(let f=0,g=a.length;f<g;f+=2){const x=a[f],k=a[f+1];t.moveTo(x+n,k),t.arc(x,k,n,0,G$)}return i&&i.value()}renderHull(t){const n=t==null?t=new Jb:void 0,{hull:i,points:a}=this,f=2*i[0],g=i.length;t.moveTo(a[f],a[f+1]);for(let x=1;x<g;++x){const k=2*i[x];t.lineTo(a[k],a[k+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new TM;return this.renderHull(t),t.value()}renderTriangle(t,n){const i=n==null?n=new Jb:void 0,{points:a,triangles:f}=this,g=2*f[t*=3],x=2*f[t+1],k=2*f[t+2];return n.moveTo(a[g],a[g+1]),n.lineTo(a[x],a[x+1]),n.lineTo(a[k],a[k+1]),n.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,i=t.length/3;n<i;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new TM;return this.renderTriangle(t,n),n.value()}}function DM(e){Tt.call(this,null,e)}DM.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const $$=[-1e5,-1e5,1e5,1e5];function X$(e){const t=e[0][0],n=e[0][1];let i=e.length-1;for(;e[i][0]===t&&e[i][1]===n;--i);return"M"+e.slice(0,i+1).join("L")+"Z"}Object(ke.z)(DM,Tt,{transform(e,t){const n=e.as||"path",i=t.source;if(!i||!i.length)return t;let a=e.size;a=a?[0,0,a[0],a[1]]:(a=e.extent)?[a[0][0],a[0][1],a[1][0],a[1][1]]:$$;const f=this.value=MM.from(i,e.x,e.y).voronoi(a);for(let g=0,x=i.length;g<x;++g){const k=f.cellPolygon(g);i[g][n]=k?X$(k):null}return t.reflow(e.modified()).modifies(n)}});var NM=Math.PI/180,k_=64,$3=2048;function K$(){var e,t,n,i,a,f,g,x=[256,256],k=OP,F=[],V=Math.random,X={};function te(se,he,ye){for(var Pe,Ue,We,at=he.x,st=he.y,lt=Math.sqrt(x[0]*x[0]+x[1]*x[1]),ct=k(x),Ct=V()<.5?1:-1,Et=-Ct;(Pe=ct(Et+=Ct))&&(Ue=~~Pe[0],We=~~Pe[1],!(Math.min(Math.abs(Ue),Math.abs(We))>=lt));)if(he.x=at+Ue,he.y=st+We,!(he.x+he.x0<0||he.y+he.y0<0||he.x+he.x1>x[0]||he.y+he.y1>x[1])&&(!ye||!J$(he,se,x[0]))&&(!ye||Z$(he,ye))){for(var gn,An=he.sprite,wn=he.width>>5,$n=x[0]>>5,qn=he.x-(wn<<4),er=127&qn,rr=32-er,lr=he.y1-he.y0,Or=(he.y+he.y0)*$n+(qn>>5),Jr=0;Jr<lr;Jr++){gn=0;for(var Lr=0;Lr<=wn;Lr++)se[Or+Lr]|=gn<<rr|(Lr<wn?(gn=An[Jr*wn+Lr])>>>er:0);Or+=$n}return he.sprite=null,!0}return!1}return X.layout=function(){for(var se=function(lt){lt.width=lt.height=1;var ct=Math.sqrt(lt.getContext("2d").getImageData(0,0,1,1).data.length>>2);lt.width=(k_<<5)/ct,lt.height=$3/ct;var Ct=lt.getContext("2d");return Ct.fillStyle=Ct.strokeStyle="red",Ct.textAlign="center",{context:Ct,ratio:ct}}(su()),he=function(lt){for(var ct=[],Ct=-1;++Ct<lt;)ct[Ct]=0;return ct}((x[0]>>5)*x[1]),ye=null,Pe=F.length,Ue=-1,We=[],at=F.map(lt=>({text:e(lt),font:t(lt),style:i(lt),weight:a(lt),rotate:f(lt),size:~~(n(lt)+1e-14),padding:g(lt),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:lt})).sort((lt,ct)=>ct.size-lt.size);++Ue<Pe;){var st=at[Ue];st.x=x[0]*(V()+.5)>>1,st.y=x[1]*(V()+.5)>>1,Y$(se,st,at,Ue),st.hasText&&te(he,st,ye)&&(We.push(st),ye?Q$(ye,st):ye=[{x:st.x+st.x0,y:st.y+st.y0},{x:st.x+st.x1,y:st.y+st.y1}],st.x-=x[0]>>1,st.y-=x[1]>>1)}return We},X.words=function(se){return arguments.length?(F=se,X):F},X.size=function(se){return arguments.length?(x=[+se[0],+se[1]],X):x},X.font=function(se){return arguments.length?(t=Qb(se),X):t},X.fontStyle=function(se){return arguments.length?(i=Qb(se),X):i},X.fontWeight=function(se){return arguments.length?(a=Qb(se),X):a},X.rotate=function(se){return arguments.length?(f=Qb(se),X):f},X.text=function(se){return arguments.length?(e=Qb(se),X):e},X.spiral=function(se){return arguments.length?(k=eX[se]||se,X):k},X.fontSize=function(se){return arguments.length?(n=Qb(se),X):n},X.padding=function(se){return arguments.length?(g=Qb(se),X):g},X.random=function(se){return arguments.length?(V=se,X):V},X}function Y$(e,t,n,i){if(!t.sprite){var a=e.context,f=e.ratio;a.clearRect(0,0,(k_<<5)/f,$3/f);var g,x,k,F,V,X=0,te=0,se=0,he=n.length;for(--i;++i<he;){if(t=n[i],a.save(),a.font=t.style+" "+t.weight+" "+~~((t.size+1)/f)+"px "+t.font,g=a.measureText(t.text+"m").width*f,k=t.size<<1,t.rotate){var ye=Math.sin(t.rotate*NM),Pe=Math.cos(t.rotate*NM),Ue=g*Pe,We=g*ye,at=k*Pe,st=k*ye;g=Math.max(Math.abs(Ue+st),Math.abs(Ue-st))+31>>5<<5,k=~~Math.max(Math.abs(We+at),Math.abs(We-at))}else g=g+31>>5<<5;if(k>se&&(se=k),X+g>=k_<<5&&(X=0,te+=se,se=0),te+k>=$3)break;a.translate((X+(g>>1))/f,(te+(k>>1))/f),t.rotate&&a.rotate(t.rotate*NM),a.fillText(t.text,0,0),t.padding&&(a.lineWidth=2*t.padding,a.strokeText(t.text,0,0)),a.restore(),t.width=g,t.height=k,t.xoff=X,t.yoff=te,t.x1=g>>1,t.y1=k>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,X+=g}for(var lt=a.getImageData(0,0,(k_<<5)/f,$3/f).data,ct=[];--i>=0;)if((t=n[i]).hasText){for(x=(g=t.width)>>5,k=t.y1-t.y0,F=0;F<k*x;F++)ct[F]=0;if((X=t.xoff)==null)return;te=t.yoff;var Ct=0,Et=-1;for(V=0;V<k;V++){for(F=0;F<g;F++){var gn=x*V+(F>>5),An=lt[(te+V)*(k_<<5)+(X+F)<<2]?1<<31-F%32:0;ct[gn]|=An,Ct|=An}Ct?Et=V:(t.y0++,k--,V--,te++)}t.y1=t.y0+Et,t.sprite=ct.slice(0,(t.y1-t.y0)*x)}}}function J$(e,t,n){n>>=5;for(var i,a=e.sprite,f=e.width>>5,g=e.x-(f<<4),x=127&g,k=32-x,F=e.y1-e.y0,V=(e.y+e.y0)*n+(g>>5),X=0;X<F;X++){i=0;for(var te=0;te<=f;te++)if((i<<k|(te<f?(i=a[X*f+te])>>>x:0))&t[V+te])return!0;V+=n}return!1}function Q$(e,t){var n=e[0],i=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>i.x&&(i.x=t.x+t.x1),t.y+t.y1>i.y&&(i.y=t.y+t.y1)}function Z$(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function OP(e){var t=e[0]/e[1];return function(n){return[t*(n*=.1)*Math.cos(n),n*Math.sin(n)]}}function Qb(e){return typeof e=="function"?e:function(){return e}}var eX={archimedean:OP,rectangular:function(e){var t=4*e[0]/e[1],n=0,i=0;return function(a){var f=a<0?-1:1;switch(Math.sqrt(1+4*f*a)-f&3){case 0:n+=t;break;case 1:i+=4;break;case 2:n-=t;break;default:i-=4}return[n,i]}}};const TP=["x","y","font","fontSize","fontStyle","fontWeight","angle"],tX=["text","font","rotate","fontSize","fontStyle","fontWeight"];function IM(e){Tt.call(this,K$(),e)}IM.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:TP}]},Object(ke.z)(IM,Tt,{transform(e,t){!e.size||e.size[0]&&e.size[1]||Object(ke.o)("Wordcloud size dimensions must be non-zero.");const n=e.modified();if(!(n||t.changed(t.ADD_REM)||tX.some(function(se){const he=e[se];return Object(ke.E)(he)&&t.modified(he.fields)})))return;const i=t.materialize(t.SOURCE).source,a=this.value,f=e.as||TP;let g,x=e.fontSize||14;if(Object(ke.E)(x)?g=e.fontSizeRange:x=Object(ke.m)(x),g){const se=x,he=zo("sqrt")().domain(Object(ke.q)(i,se)).range(g);x=ye=>he(se(ye))}i.forEach(se=>{se[f[0]]=NaN,se[f[1]]=NaN,se[f[3]]=0});const k=a.words(i).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(x).random(Kn).layout(),F=a.size(),V=F[0]>>1,X=F[1]>>1,te=k.length;for(let se,he,ye=0;ye<te;++ye)(he=(se=k[ye]).datum)[f[0]]=se.x+V,he[f[1]]=se.y+X,he[f[2]]=se.font,he[f[3]]=se.size,he[f[4]]=se.style,he[f[5]]=se.weight,he[f[6]]=se.rotate;return t.reflow(n).modifies(f)}});var nX=function(e,t){return Array.from(t,n=>e[n])};const rX=e=>new Uint8Array(e),iX=e=>new Uint16Array(e),C_=e=>new Uint32Array(e);function X3(e,t,n){const i=(t<257?rX:t<65537?iX:C_)(e);return n&&i.set(n),i}function MP(e,t,n){const i=1<<t;return{one:i,zero:~i,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(a,f){const g=this.bisect(this.range,a.value),x=a.index,k=g[0],F=g[1],V=x.length;let X;for(X=0;X<k;++X)f[x[X]]|=i;for(X=F;X<V;++X)f[x[X]]|=i;return this}}}function DP(){let e=C_(0),t=[],n=0;return{insert:function(i,a,f){if(!a.length)return[];const g=n,x=a.length,k=C_(x);let F,V,X,te=Array(x);for(X=0;X<x;++X)te[X]=i(a[X]),k[X]=X;if(te=function(se,he){return se.sort.call(he,(ye,Pe)=>{const Ue=se[ye],We=se[Pe];return Ue<We?-1:Ue>We?1:0}),nX(se,he)}(te,k),g)F=t,V=e,t=Array(g+x),e=C_(g+x),function(se,he,ye,Pe,Ue,We,at,st,lt){let ct,Ct=0,Et=0;for(ct=0;Ct<Pe&&Et<at;++ct)he[Ct]<Ue[Et]?(st[ct]=he[Ct],lt[ct]=ye[Ct++]):(st[ct]=Ue[Et],lt[ct]=We[Et++]+se);for(;Ct<Pe;++Ct,++ct)st[ct]=he[Ct],lt[ct]=ye[Ct];for(;Et<at;++Et,++ct)st[ct]=Ue[Et],lt[ct]=We[Et]+se}(f,F,V,g,te,k,x,t,e);else{if(f>0)for(X=0;X<x;++X)k[X]+=f;t=te,e=k}return n=g+x,{index:k,value:te}},remove:function(i,a){const f=n;let g,x,k;for(x=0;!a[e[x]]&&x<f;++x);for(k=x;x<f;++x)a[g=e[x]]||(e[k]=g,t[k]=t[x],++k);n=f-i},bisect:function(i,a){let f;return a?f=a.length:(a=t,f=n),[_s(a,i[0],0,f),Ba(a,i[1],0,f)]},reindex:function(i){for(let a=0,f=n;a<f;++a)e[a]=i[e[a]]},index:()=>e,size:()=>n}}function FM(e){Tt.call(this,function(){let t=8,n=[],i=C_(0),a=X3(0,t),f=X3(0,t);return{data:()=>n,seen:()=>i=function(g,x,k){return g.length>=x?g:((k=k||new g.constructor(x)).set(g),k)}(i,n.length),add(g){for(let x,k=0,F=n.length,V=g.length;k<V;++k)(x=g[k])._index=F++,n.push(x)},remove(g,x){const k=n.length,F=Array(k-g),V=n;let X,te,se;for(te=0;!x[te]&&te<k;++te)F[te]=n[te],V[te]=te;for(se=te;te<k;++te)X=n[te],x[te]?V[te]=-1:(V[te]=se,a[se]=a[te],f[se]=f[te],F[se]=X,X._index=se++),a[te]=0;return n=F,V},size:()=>n.length,curr:()=>a,prev:()=>f,reset:g=>f[g]=a[g],all:()=>t<257?255:t<65537?65535:4294967295,set(g,x){a[g]|=x},clear(g,x){a[g]&=~x},resize(g,x){(g>a.length||x>t)&&(t=Math.max(x,t),a=X3(g,t,a),f=X3(g,t))}}}(),e),this._indices=null,this._dims=null}function RM(e){Tt.call(this,null,e)}FM.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},Object(ke.z)(FM,Tt,{transform(e,t){return this._dims?e.modified("fields")||e.fields.some(n=>t.modified(n.fields))?this.reinit(e,t):this.eval(e,t):this.init(e,t)},init(e,t){const n=e.fields,i=e.query,a=this._indices={},f=this._dims=[],g=i.length;let x,k,F=0;for(;F<g;++F)k=a[x=n[F].fname]||(a[x]=DP()),f.push(MP(k,F,i[F]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),i=e.fields,a=e.query,f=this._indices,g=this._dims,x=this.value,k=x.curr(),F=x.prev(),V=x.all(),X=n.rem=n.add,te=n.mod,se=a.length,he={};let ye,Pe,Ue,We,at,st,lt,ct,Ct;if(F.set(k),t.rem.length&&(at=this.remove(e,t,n)),t.add.length&&x.add(t.add),t.mod.length)for(st={},lt=0,ct=(We=t.mod).length;lt<ct;++lt)st[We[lt]._index]=1;for(lt=0;lt<se;++lt)Ct=i[lt],(!g[lt]||e.modified("fields",lt)||t.modified(Ct.fields))&&((ye=he[Ue=Ct.fname])||(f[Ue]=Pe=DP(),he[Ue]=ye=Pe.insert(Ct,t.source,0)),g[lt]=MP(Pe,lt,a[lt]).onAdd(ye,k));for(lt=0,ct=x.data().length;lt<ct;++lt)at[lt]||(F[lt]!==k[lt]?X.push(lt):st[lt]&&k[lt]!==V&&te.push(lt));return x.mask=(1<<se)-1,n},eval(e,t){const n=t.materialize().fork(),i=this._dims.length;let a=0;return t.rem.length&&(this.remove(e,t,n),a|=(1<<i)-1),e.modified("query")&&!e.modified("fields")&&(a|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),a|=(1<<i)-1),t.mod.length&&(this.modify(t,n),a|=(1<<i)-1),this.value.mask=a,n},insert(e,t,n){const i=t.add,a=this.value,f=this._dims,g=this._indices,x=e.fields,k={},F=n.add,V=a.size()+i.length,X=f.length;let te,se,he,ye=a.size();a.resize(V,X),a.add(i);const Pe=a.curr(),Ue=a.prev(),We=a.all();for(te=0;te<X;++te)he=k[se=x[te].fname]||(k[se]=g[se].insert(x[te],i,ye)),f[te].onAdd(he,Pe);for(;ye<V;++ye)Ue[ye]=We,Pe[ye]!==We&&F.push(ye)},modify(e,t){const n=t.mod,i=this.value,a=i.curr(),f=i.all(),g=e.mod;let x,k,F;for(x=0,k=g.length;x<k;++x)a[F=g[x]._index]!==f&&n.push(F)},remove(e,t,n){const i=this._indices,a=this.value,f=a.curr(),g=a.prev(),x=a.all(),k={},F=n.rem,V=t.rem;let X,te,se,he;for(X=0,te=V.length;X<te;++X)k[se=V[X]._index]=1,g[se]=he=f[se],f[se]=x,he!==x&&F.push(se);for(se in i)i[se].remove(te,k);return this.reindex(t,te,k),k},reindex(e,t,n){const i=this._indices,a=this.value;e.runAfter(()=>{const f=a.remove(t,n);for(const g in i)i[g].reindex(f)})},update(e,t,n){const i=this._dims,a=e.query,f=t.stamp,g=i.length;let x,k,F=0;for(n.filters=0,k=0;k<g;++k)e.modified("query",k)&&(x=k,++F);if(F===1)F=i[x].one,this.incrementOne(i[x],a[x],n.add,n.rem);else for(k=0,F=0;k<g;++k)e.modified("query",k)&&(F|=i[k].one,this.incrementAll(i[k],a[k],f,n.add),n.rem=n.add);return F},incrementAll(e,t,n,i){const a=this.value,f=a.seen(),g=a.curr(),x=a.prev(),k=e.index(),F=e.bisect(e.range),V=e.bisect(t),X=V[0],te=V[1],se=F[0],he=F[1],ye=e.one;let Pe,Ue,We;if(X<se)for(Pe=X,Ue=Math.min(se,te);Pe<Ue;++Pe)f[We=k[Pe]]!==n&&(x[We]=g[We],f[We]=n,i.push(We)),g[We]^=ye;else if(X>se)for(Pe=se,Ue=Math.min(X,he);Pe<Ue;++Pe)f[We=k[Pe]]!==n&&(x[We]=g[We],f[We]=n,i.push(We)),g[We]^=ye;if(te>he)for(Pe=Math.max(X,he),Ue=te;Pe<Ue;++Pe)f[We=k[Pe]]!==n&&(x[We]=g[We],f[We]=n,i.push(We)),g[We]^=ye;else if(te<he)for(Pe=Math.max(se,te),Ue=he;Pe<Ue;++Pe)f[We=k[Pe]]!==n&&(x[We]=g[We],f[We]=n,i.push(We)),g[We]^=ye;e.range=t.slice()},incrementOne(e,t,n,i){const a=this.value.curr(),f=e.index(),g=e.bisect(e.range),x=e.bisect(t),k=x[0],F=x[1],V=g[0],X=g[1],te=e.one;let se,he,ye;if(k<V)for(se=k,he=Math.min(V,F);se<he;++se)a[ye=f[se]]^=te,n.push(ye);else if(k>V)for(se=V,he=Math.min(k,X);se<he;++se)a[ye=f[se]]^=te,i.push(ye);if(F>X)for(se=Math.max(k,X),he=F;se<he;++se)a[ye=f[se]]^=te,n.push(ye);else if(F<X)for(se=Math.max(V,F),he=X;se<he;++se)a[ye=f[se]]^=te,i.push(ye);e.range=t.slice()}}),RM.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},Object(ke.z)(RM,Tt,{transform(e,t){const n=~(e.ignore||0),i=e.filter,a=i.mask;if(!(a&n))return t.StopPropagation;const f=t.fork(t.ALL),g=i.data(),x=i.curr(),k=i.prev(),F=V=>x[V]&n?null:g[V];return f.filter(f.MOD,F),a&a-1?(f.filter(f.ADD,V=>{const X=x[V]&n;return!X&&X^k[V]&n?g[V]:null}),f.filter(f.REM,V=>{const X=x[V]&n;return X&&!(X^X^k[V]&n)?g[V]:null})):(f.filter(f.ADD,F),f.filter(f.REM,V=>(x[V]&n)===a?g[V]:null)),f.filter(f.SOURCE,V=>F(V._index))}});const oX="RawCode",Ow="Literal",aX="Property",sX="Identifier",uX="ArrayExpression",cX="BinaryExpression",NP="CallExpression",lX="ConditionalExpression",fX="LogicalExpression",dX="MemberExpression",hX="ObjectExpression",pX="UnaryExpression";function A0(e){this.type=e}var Uy,Pi,Ur,Gf,os;A0.prototype.visit=function(e){let t,n,i;if(e(this))return 1;for(n=0,i=(t=function(a){switch(a.type){case uX:return a.elements;case cX:case fX:return[a.left,a.right];case NP:return[a.callee].concat(a.arguments);case lX:return[a.test,a.consequent,a.alternate];case dX:return[a.object,a.property];case hX:return a.properties;case aX:return[a.key,a.value];case pX:return[a.argument];case sX:case Ow:case oX:default:return[]}}(this)).length;n<i;++n)if(t[n].visit(e))return 1};var K3=1,A_=2,Zb=3,X1=4,Y3=5,ex=6,pp=7,O_=8;(Uy={})[K3]="Boolean",Uy[A_]="<end>",Uy[Zb]="Identifier",Uy[X1]="Keyword",Uy[Y3]="Null",Uy[ex]="Numeric",Uy[pp]="Punctuator",Uy[O_]="String",Uy[9]="RegularExpression";var mX="ArrayExpression",gX="BinaryExpression",vX="CallExpression",yX="ConditionalExpression",IP="Identifier",bX="Literal",xX="LogicalExpression",wX="MemberExpression",_X="ObjectExpression",EX="Property",SX="UnaryExpression",pl="Unexpected token %0",kX="Unexpected number",CX="Unexpected string",AX="Unexpected identifier",OX="Unexpected reserved word",TX="Unexpected end of input",PM="Invalid regular expression",LM="Invalid regular expression: missing /",FP="Octal literals are not allowed in strict mode.",MX="Duplicate data property in object literal not allowed in strict mode",Zl="ILLEGAL",T_="Disabled.",DX=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),NX=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function J3(e,t){if(!e)throw new Error("ASSERT: "+t)}function Wy(e){return e>=48&&e<=57}function BM(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function M_(e){return"01234567".indexOf(e)>=0}function IX(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function D_(e){return e===10||e===13||e===8232||e===8233}function N_(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&DX.test(String.fromCharCode(e))}function Q3(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&NX.test(String.fromCharCode(e))}const FX={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function RP(){for(;Ur<Gf;){const e=Pi.charCodeAt(Ur);if(!IX(e)&&!D_(e))break;++Ur}}function jM(e){var t,n,i,a=0;for(n=e==="u"?4:2,t=0;t<n;++t)Ur<Gf&&BM(Pi[Ur])?(i=Pi[Ur++],a=16*a+"0123456789abcdef".indexOf(i.toLowerCase())):ja({},pl,Zl);return String.fromCharCode(a)}function RX(){var e,t,n,i;for(t=0,(e=Pi[Ur])==="}"&&ja({},pl,Zl);Ur<Gf&&BM(e=Pi[Ur++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&ja({},pl,Zl),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),i=56320+(t-65536&1023),String.fromCharCode(n,i))}function PP(){var e,t;for(e=Pi.charCodeAt(Ur++),t=String.fromCharCode(e),e===92&&(Pi.charCodeAt(Ur)!==117&&ja({},pl,Zl),++Ur,(e=jM("u"))&&e!=="\\"&&N_(e.charCodeAt(0))||ja({},pl,Zl),t=e);Ur<Gf&&Q3(e=Pi.charCodeAt(Ur));)++Ur,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),Pi.charCodeAt(Ur)!==117&&ja({},pl,Zl),++Ur,(e=jM("u"))&&e!=="\\"&&Q3(e.charCodeAt(0))||ja({},pl,Zl),t+=e);return t}function PX(){var e,t;return e=Ur,{type:(t=Pi.charCodeAt(Ur)===92?PP():function(){var n,i;for(n=Ur++;Ur<Gf;){if((i=Pi.charCodeAt(Ur))===92)return Ur=n,PP();if(!Q3(i))break;++Ur}return Pi.slice(n,Ur)}()).length===1?Zb:FX.hasOwnProperty(t)?X1:t==="null"?Y3:t==="true"||t==="false"?K3:Zb,value:t,start:e,end:Ur}}function zM(){var e,t,n,i,a=Ur,f=Pi.charCodeAt(Ur),g=Pi[Ur];switch(f){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Ur,{type:pp,value:String.fromCharCode(f),start:a,end:Ur};default:if((e=Pi.charCodeAt(Ur+1))===61)switch(f){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Ur+=2,{type:pp,value:String.fromCharCode(f)+String.fromCharCode(e),start:a,end:Ur};case 33:case 61:return Ur+=2,Pi.charCodeAt(Ur)===61&&++Ur,{type:pp,value:Pi.slice(a,Ur),start:a,end:Ur}}}return(i=Pi.substr(Ur,4))===">>>="?{type:pp,value:i,start:a,end:Ur+=4}:(n=i.substr(0,3))===">>>"||n==="<<="||n===">>="?{type:pp,value:n,start:a,end:Ur+=3}:g===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(g)>=0||t==="=>"?{type:pp,value:t,start:a,end:Ur+=2}:(t==="//"&&ja({},pl,Zl),"<>=!+-*%&|^/".indexOf(g)>=0?{type:pp,value:g,start:a,end:++Ur}:void ja({},pl,Zl))}function LP(){var e,t,n;if(J3(Wy((n=Pi[Ur]).charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=Ur,e="",n!=="."){if(e=Pi[Ur++],n=Pi[Ur],e==="0"){if(n==="x"||n==="X")return++Ur,function(i){let a="";for(;Ur<Gf&&BM(Pi[Ur]);)a+=Pi[Ur++];return a.length===0&&ja({},pl,Zl),N_(Pi.charCodeAt(Ur))&&ja({},pl,Zl),{type:ex,value:parseInt("0x"+a,16),start:i,end:Ur}}(t);if(M_(n))return function(i){let a="0"+Pi[Ur++];for(;Ur<Gf&&M_(Pi[Ur]);)a+=Pi[Ur++];return(N_(Pi.charCodeAt(Ur))||Wy(Pi.charCodeAt(Ur)))&&ja({},pl,Zl),{type:ex,value:parseInt(a,8),octal:!0,start:i,end:Ur}}(t);n&&Wy(n.charCodeAt(0))&&ja({},pl,Zl)}for(;Wy(Pi.charCodeAt(Ur));)e+=Pi[Ur++];n=Pi[Ur]}if(n==="."){for(e+=Pi[Ur++];Wy(Pi.charCodeAt(Ur));)e+=Pi[Ur++];n=Pi[Ur]}if(n==="e"||n==="E")if(e+=Pi[Ur++],(n=Pi[Ur])!=="+"&&n!=="-"||(e+=Pi[Ur++]),Wy(Pi.charCodeAt(Ur)))for(;Wy(Pi.charCodeAt(Ur));)e+=Pi[Ur++];else ja({},pl,Zl);return N_(Pi.charCodeAt(Ur))&&ja({},pl,Zl),{type:ex,value:parseFloat(e),start:t,end:Ur}}function LX(){var e,t,n,i;return os=null,RP(),e=Ur,t=function(){var a,f,g,x;for(J3((a=Pi[Ur])==="/","Regular expression literal must start with a slash"),f=Pi[Ur++],g=!1,x=!1;Ur<Gf;)if(f+=a=Pi[Ur++],a==="\\")D_((a=Pi[Ur++]).charCodeAt(0))&&ja({},LM),f+=a;else if(D_(a.charCodeAt(0)))ja({},LM);else if(g)a==="]"&&(g=!1);else{if(a==="/"){x=!0;break}a==="["&&(g=!0)}return x||ja({},LM),{value:f.substr(1,f.length-2),literal:f}}(),n=function(){var a,f,g;for(f="",g="";Ur<Gf&&Q3((a=Pi[Ur]).charCodeAt(0));)++Ur,a==="\\"&&Ur<Gf?ja({},pl,Zl):(g+=a,f+=a);return g.search(/[^gimuy]/g)>=0&&ja({},PM,g),{value:g,literal:f}}(),i=function(a,f){let g=a;f.indexOf("u")>=0&&(g=g.replace(/\\u\{([0-9a-fA-F]+)\}/g,(x,k)=>{if(parseInt(k,16)<=1114111)return"x";ja({},PM)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(g)}catch{ja({},PM)}try{return new RegExp(a,f)}catch{return null}}(t.value,n.value),{literal:t.literal+n.literal,value:i,regex:{pattern:t.value,flags:n.value},start:e,end:Ur}}function BP(){if(RP(),Ur>=Gf)return{type:A_,start:Ur,end:Ur};const e=Pi.charCodeAt(Ur);return N_(e)?PX():e===40||e===41||e===59?zM():e===39||e===34?function(){var t,n,i,a,f="",g=!1;for(J3((t=Pi[Ur])==="'"||t==='"',"String literal must starts with a quote"),n=Ur,++Ur;Ur<Gf;){if((i=Pi[Ur++])===t){t="";break}if(i==="\\")if((i=Pi[Ur++])&&D_(i.charCodeAt(0)))i==="\r"&&Pi[Ur]===`
`&&++Ur;else switch(i){case"u":case"x":Pi[Ur]==="{"?(++Ur,f+=RX()):f+=jM(i);break;case"n":f+=`
`;break;case"r":f+="\r";break;case"t":f+="	";break;case"b":f+="\b";break;case"f":f+="\f";break;case"v":f+="\v";break;default:M_(i)?((a="01234567".indexOf(i))!==0&&(g=!0),Ur<Gf&&M_(Pi[Ur])&&(g=!0,a=8*a+"01234567".indexOf(Pi[Ur++]),"0123".indexOf(i)>=0&&Ur<Gf&&M_(Pi[Ur])&&(a=8*a+"01234567".indexOf(Pi[Ur++]))),f+=String.fromCharCode(a)):f+=i}else{if(D_(i.charCodeAt(0)))break;f+=i}}return t!==""&&ja({},pl,Zl),{type:O_,value:f,octal:g,start:n,end:Ur}}():e===46?Wy(Pi.charCodeAt(Ur+1))?LP():zM():Wy(e)?LP():zM()}function mp(){const e=os;return Ur=e.end,os=BP(),Ur=e.end,e}function jP(){const e=Ur;os=BP(),Ur=e}function zP(e,t,n){const i=new A0(e==="||"||e==="&&"?xX:gX);return i.operator=e,i.left=t,i.right=n,i}function BX(e,t){const n=new A0(vX);return n.callee=e,n.arguments=t,n}function UM(e){const t=new A0(IP);return t.name=e,t}function I_(e){const t=new A0(bX);return t.value=e.value,t.raw=Pi.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function UP(e,t,n){const i=new A0(wX);return i.computed=e==="[",i.object=t,i.property=n,i.computed||(n.member=!0),i}function WP(e,t,n){const i=new A0(EX);return i.key=t,i.value=n,i.kind=e,i}function ja(e,t){var n,i=Array.prototype.slice.call(arguments,2),a=t.replace(/%(\d)/g,(f,g)=>(J3(g<i.length,"Message reference must be in range"),i[g]));throw(n=new Error(a)).index=Ur,n.description=a,n}function Z3(e){e.type===A_&&ja(e,TX),e.type===ex&&ja(e,kX),e.type===O_&&ja(e,CX),e.type===Zb&&ja(e,AX),e.type===X1&&ja(e,OX),ja(e,pl,e.value)}function qf(e){const t=mp();t.type===pp&&t.value===e||Z3(t)}function Js(e){return os.type===pp&&os.value===e}function WM(e){return os.type===X1&&os.value===e}function jX(){const e=[];for(Ur=os.start,qf("[");!Js("]");)Js(",")?(mp(),e.push(null)):(e.push(tx()),Js("]")||qf(","));return mp(),function(t){const n=new A0(mX);return n.elements=t,n}(e)}function VP(){Ur=os.start;const e=mp();return e.type===O_||e.type===ex?(e.octal&&ja(e,FP),I_(e)):UM(e.value)}function zX(){var e,t,n;return Ur=os.start,(e=os).type===Zb?(n=VP(),qf(":"),WP("init",n,tx())):e.type!==A_&&e.type!==pp?(t=VP(),qf(":"),WP("init",t,tx())):void Z3(e)}function UX(){var e,t,n=[],i={},a=String;for(Ur=os.start,qf("{");!Js("}");)t="$"+((e=zX()).key.type===IP?e.key.name:a(e.key.value)),Object.prototype.hasOwnProperty.call(i,t)?ja({},MX):i[t]=!0,n.push(e),Js("}")||qf(",");return qf("}"),function(f){const g=new A0(_X);return g.properties=f,g}(n)}const WX={if:1};function VX(){var e,t,n;if(Js("("))return function(){qf("(");const i=VM();return qf(")"),i}();if(Js("["))return jX();if(Js("{"))return UX();if(e=os.type,Ur=os.start,e===Zb||WX[os.value])n=UM(mp().value);else if(e===O_||e===ex)os.octal&&ja(os,FP),n=I_(mp());else{if(e===X1)throw new Error(T_);e===K3?((t=mp()).value=t.value==="true",n=I_(t)):e===Y3?((t=mp()).value=null,n=I_(t)):Js("/")||Js("/=")?(n=I_(LX()),jP()):Z3(mp())}return n}function HX(){const e=[];if(qf("("),!Js(")"))for(;Ur<Gf&&(e.push(tx()),!Js(")"));)qf(",");return qf(")"),e}function GX(){Ur=os.start;const e=mp();return function(t){return t.type===Zb||t.type===X1||t.type===K3||t.type===Y3}(e)||Z3(e),UM(e.value)}function qX(){qf("[");const e=VM();return qf("]"),e}function HP(){const e=function(){var t;for(t=VX();;)if(Js("."))qf("."),t=UP(".",t,GX());else if(Js("("))t=BX(t,HX());else{if(!Js("["))break;t=UP("[",t,qX())}return t}();if(os.type===pp&&(Js("++")||Js("--")))throw new Error(T_);return e}function ek(){var e,t;if(os.type!==pp&&os.type!==X1)t=HP();else{if(Js("++")||Js("--"))throw new Error(T_);if(Js("+")||Js("-")||Js("~")||Js("!"))e=mp(),t=ek(),t=function(n,i){const a=new A0(SX);return a.operator=n,a.argument=i,a.prefix=!0,a}(e.value,t);else{if(WM("delete")||WM("void")||WM("typeof"))throw new Error(T_);t=HP()}}return t}function GP(e){let t=0;if(e.type!==pp&&e.type!==X1)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function tx(){var e,t;return e=function(){var n,i,a,f,g,x,k,F,V,X;if(n=os,V=ek(),(g=GP(f=os))===0)return V;for(f.prec=g,mp(),i=[n,os],x=[V,f,k=ek()];(g=GP(os))>0;){for(;x.length>2&&g<=x[x.length-2].prec;)k=x.pop(),F=x.pop().value,V=x.pop(),i.pop(),a=zP(F,V,k),x.push(a);(f=mp()).prec=g,x.push(f),i.push(os),a=ek(),x.push(a)}for(a=x[X=x.length-1],i.pop();X>1;)i.pop(),a=zP(x[X-1].value,x[X-2],a),X-=2;return a}(),Js("?")&&(mp(),t=tx(),qf(":"),e=function(n,i,a){const f=new A0(yX);return f.test=n,f.consequent=i,f.alternate=a,f}(e,t,tx())),e}function VM(){const e=tx();if(Js(","))throw new Error(T_);return e}var qP={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function $P(e){function t(i,a,f){return g=>function(x,k,F,V){let X=e(k[0]);return F&&(X=F+"("+X+")",F.lastIndexOf("new ",0)===0&&(X="("+X+")")),X+"."+x+(V<0?"":V===0?"()":"("+k.slice(1).map(e).join(",")+")")}(i,g,a,f)}const n="new Date";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(i){i.length<3&&Object(ke.o)("Missing arguments to clamp function."),i.length>3&&Object(ke.o)("Too many arguments to clamp function.");const a=i.map(e);return"Math.max("+a[1]+", Math.min("+a[2]+","+a[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase","String",0),lower:t("toLowerCase","String",0),substring:t("substring","String"),split:t("split","String"),trim:t("trim","String",0),regexp:"RegExp",test:t("test","RegExp"),if:function(i){i.length<3&&Object(ke.o)("Missing arguments to if function."),i.length>3&&Object(ke.o)("Too many arguments to if function.");const a=i.map(e);return"("+a[0]+"?"+a[1]+":"+a[2]+")"}}}var XP,KP,HM,GM,qM,tk=new Qd,nk=new Qd,Yv={point:Ql,lineStart:Ql,lineEnd:Ql,polygonStart:function(){tk=new Qd,Yv.lineStart=$X,Yv.lineEnd=XX},polygonEnd:function(){var e=+tk;nk.add(e<0?Zd+e:e),this.lineStart=this.lineEnd=this.point=Ql},sphere:function(){nk.add(Zd)}};function $X(){Yv.point=KX}function XX(){YP(XP,KP)}function KX(e,t){Yv.point=YP,XP=e,KP=t,HM=e*=Jo,GM=uo(t=(t*=Jo)/2+u3),qM=Xi(t)}function YP(e,t){t=(t*=Jo)/2+u3;var n=(e*=Jo)-HM,i=n>=0?1:-1,a=i*n,f=uo(t),g=Xi(t),x=qM*g,k=GM*f+x*uo(a),F=x*i*Xi(a);tk.add(Cg(F,k)),HM=e,GM=f,qM=g}var ku,gp,Bu,Mm,nx,JP,QP,Tw,F_,K1,Vy,Hy={point:$M,lineStart:eL,lineEnd:tL,polygonStart:function(){Hy.point=nL,Hy.lineStart=YX,Hy.lineEnd=JX,F_=new Qd,Yv.polygonStart()},polygonEnd:function(){Yv.polygonEnd(),Hy.point=$M,Hy.lineStart=eL,Hy.lineEnd=tL,tk<0?(ku=-(Bu=180),gp=-(Mm=90)):F_>ro?Mm=90:F_<-ro&&(gp=-90),Vy[0]=ku,Vy[1]=Bu},sphere:function(){ku=-(Bu=180),gp=-(Mm=90)}};function $M(e,t){K1.push(Vy=[ku=e,Bu=e]),t<gp&&(gp=t),t>Mm&&(Mm=t)}function ZP(e,t){var n=Xb([e*Jo,t*Jo]);if(Tw){var i=xw(Tw,n),a=xw([i[1],-i[0],0],i);_3(a),a=b3(a);var f,g=e-nx,x=g>0?1:-1,k=a[0]*nc*x,F=Ea(g)>180;F^(x*nx<k&&k<x*e)?(f=a[1]*nc)>Mm&&(Mm=f):F^(x*nx<(k=(k+360)%360-180)&&k<x*e)?(f=-a[1]*nc)<gp&&(gp=f):(t<gp&&(gp=t),t>Mm&&(Mm=t)),F?e<nx?Dm(ku,e)>Dm(ku,Bu)&&(Bu=e):Dm(e,Bu)>Dm(ku,Bu)&&(ku=e):Bu>=ku?(e<ku&&(ku=e),e>Bu&&(Bu=e)):e>nx?Dm(ku,e)>Dm(ku,Bu)&&(Bu=e):Dm(e,Bu)>Dm(ku,Bu)&&(ku=e)}else K1.push(Vy=[ku=e,Bu=e]);t<gp&&(gp=t),t>Mm&&(Mm=t),Tw=n,nx=e}function eL(){Hy.point=ZP}function tL(){Vy[0]=ku,Vy[1]=Bu,Hy.point=$M,Tw=null}function nL(e,t){if(Tw){var n=e-nx;F_.add(Ea(n)>180?n+(n>0?360:-360):n)}else JP=e,QP=t;Yv.point(e,t),ZP(e,t)}function YX(){Yv.lineStart()}function JX(){nL(JP,QP),Yv.lineEnd(),Ea(F_)>ro&&(ku=-(Bu=180)),Vy[0]=ku,Vy[1]=Bu,Tw=null}function Dm(e,t){return(t-=e)<0?t+360:t}function QX(e,t){return e[0]-t[0]}function rL(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var rk,ik,ok,ak,sk,uk,ck,lk,XM,KM,YM,iL,oL,oh,ah,sh,O0={sphere:Ql,point:JM,lineStart:aL,lineEnd:sL,polygonStart:function(){O0.lineStart=tK,O0.lineEnd=nK},polygonEnd:function(){O0.lineStart=aL,O0.lineEnd=sL}};function JM(e,t){e*=Jo;var n=uo(t*=Jo);R_(n*uo(e),n*Xi(e),Xi(t))}function R_(e,t,n){ok+=(e-ok)/++rk,ak+=(t-ak)/rk,sk+=(n-sk)/rk}function aL(){O0.point=ZX}function ZX(e,t){e*=Jo;var n=uo(t*=Jo);oh=n*uo(e),ah=n*Xi(e),sh=Xi(t),O0.point=eK,R_(oh,ah,sh)}function eK(e,t){e*=Jo;var n=uo(t*=Jo),i=n*uo(e),a=n*Xi(e),f=Xi(t),g=Cg(eh((g=ah*f-sh*a)*g+(g=sh*i-oh*f)*g+(g=oh*a-ah*i)*g),oh*i+ah*a+sh*f);ik+=g,uk+=g*(oh+(oh=i)),ck+=g*(ah+(ah=a)),lk+=g*(sh+(sh=f)),R_(oh,ah,sh)}function sL(){O0.point=JM}function tK(){O0.point=rK}function nK(){uL(iL,oL),O0.point=JM}function rK(e,t){iL=e,oL=t,e*=Jo,t*=Jo,O0.point=uL;var n=uo(t);oh=n*uo(e),ah=n*Xi(e),sh=Xi(t),R_(oh,ah,sh)}function uL(e,t){e*=Jo;var n=uo(t*=Jo),i=n*uo(e),a=n*Xi(e),f=Xi(t),g=ah*f-sh*a,x=sh*i-oh*f,k=oh*a-ah*i,F=pT(g,x,k),V=hp(F),X=F&&-V/F;XM.add(X*g),KM.add(X*x),YM.add(X*k),ik+=V,uk+=V*(oh+(oh=i)),ck+=V*(ah+(ah=a)),lk+=V*(sh+(sh=f)),R_(oh,ah,sh)}const iK="Literal";var Gy,oK=1,aK=2,sK=3,uK=4,cK=5,lK=6,fK=7,dK=8;(Gy={})[oK]="Boolean",Gy[aK]="<end>",Gy[sK]="Identifier",Gy[uK]="Keyword",Gy[cK]="Null",Gy[lK]="Numeric",Gy[fK]="Punctuator",Gy[dK]="String",Gy[9]="RegularExpression";const QM="intersect",cL="union",hK="vlMulti",pK="vlPoint",lL="or",mK="and",gK="E",vK="R",yK="R-E",bK="R-LE",xK="R-RE",fk="index:unit";function fL(e,t){for(var n,i,a=t.fields,f=t.values,g=a.length,x=0;x<g;++x)if((i=a[x]).getter=ke.u.getter||Object(ke.u)(i.field),n=i.getter(e),Object(ke.D)(n)&&(n=Object(ke.Ea)(n)),Object(ke.D)(f[x])&&(f[x]=Object(ke.Ea)(f[x])),Object(ke.D)(f[x][0])&&(f[x]=f[x].map(ke.Ea)),i.type===gK){if(Object(ke.B)(f[x])?f[x].indexOf(n)<0:n!==f[x])return!1}else if(i.type===vK){if(!Object(ke.A)(n,f[x]))return!1}else if(i.type===xK){if(!Object(ke.A)(n,f[x],!0,!1))return!1}else if(i.type===yK){if(!Object(ke.A)(n,f[x],!1,!1))return!1}else if(i.type===bK&&!Object(ke.A)(n,f[x],!1,!0))return!1;return!0}const ZM=Object(ke.u)("_vgsid_"),dL=function(e){let t=e,n=e;function i(a,f,g,x){for(g==null&&(g=0),x==null&&(x=a.length);g<x;){const k=g+x>>>1;n(a[k],f)<0?g=k+1:x=k}return g}return e.length===1&&(t=(a,f)=>e(a)-f,n=function(a){return(f,g)=>function(x,k){return x<k?-1:x>k?1:x>=k?0:NaN}(a(f),g)}(e)),{left:i,center:function(a,f,g,x){g==null&&(g=0),x==null&&(x=a.length);const k=i(a,f,g,x-1);return k>g&&t(a[k-1],f)>-t(a[k],f)?k-1:k},right:function(a,f,g,x){for(g==null&&(g=0),x==null&&(x=a.length);g<x;){const k=g+x>>>1;n(a[k],f)>0?x=k:g=k+1}return g}}}(ZM),wK=dL.left,_K=dL.right;var hL={E_union:function(e,t){if(!e.length)return t;for(var n=0,i=t.length;n<i;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter(n=>t.indexOf(n)>=0):t},R_union:function(e,t){var n=Object(ke.Ea)(t[0]),i=Object(ke.Ea)(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<i&&(e[1]=i),e):[n,i]},R_intersect:function(e,t){var n=Object(ke.Ea)(t[0]),i=Object(ke.Ea)(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?i<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>i&&(e[1]=i),e):[n,i]}};const EK=":",SK="@";function eD(e,t,n,i){t[0].type!==iK&&Object(ke.o)("First argument to selection functions must be a string literal.");const a=t[0].value,f=t.length>=2&&Object(ke.W)(t).value,g=SK+"unit",x=EK+a;f!==QM||Object(ke.w)(i,g)||(i[g]=n.getData(a).indataRef(n,"unit")),Object(ke.w)(i,x)||(i[x]=n.getData(a).tuplesRef())}function pL(e){const t=this.context.data[e];return t?t.values.value:[]}const P_=e=>function(t,n){return this.context.dataflow.locale()[e](n)(t)},kK=P_("format"),mL=P_("timeFormat"),CK=P_("utcFormat"),AK=P_("timeParse"),OK=P_("utcParse"),dk=new Date(2e3,0,1);function hk(e,t,n){return Number.isInteger(e)&&Number.isInteger(t)?(dk.setYear(2e3),dk.setMonth(e),dk.setDate(t),mL.call(this,dk,n)):""}const TK=":",MK="@",tD="%",gL="$";function nD(e,t,n,i){t[0].type!==Ow&&Object(ke.o)("First argument to data functions must be a string literal.");const a=t[0].value,f=TK+a;if(!Object(ke.w)(f,i))try{i[f]=n.getData(a).tuplesRef()}catch{}}function vp(e,t,n,i){if(t[0].type===Ow)vL(n,i,t[0].value);else for(e in n.scales)vL(n,i,e)}function vL(e,t,n){const i=tD+n;if(!Object(ke.w)(t,i))try{t[i]=e.scaleRef(n)}catch{}}function qy(e,t){let n;return Object(ke.E)(e)?e:Object(ke.J)(e)?(n=t.scales[e])&&n.value:void 0}function rD(e,t){return function(n,i,a){if(n){const f=qy(n,(a||this).context);return f&&f.path[e](i)}return t(i)}}const DK=rD("area",function(e){return nk=new Qd,Ly(e,Yv),2*nk}),NK=rD("bounds",function(e){var t,n,i,a,f,g,x;if(Mm=Bu=-(ku=gp=1/0),K1=[],Ly(e,Hy),n=K1.length){for(K1.sort(QX),t=1,f=[i=K1[0]];t<n;++t)rL(i,(a=K1[t])[0])||rL(i,a[1])?(Dm(i[0],a[1])>Dm(i[0],i[1])&&(i[1]=a[1]),Dm(a[0],i[1])>Dm(i[0],i[1])&&(i[0]=a[0])):f.push(i=a);for(g=-1/0,t=0,i=f[n=f.length-1];t<=n;i=a,++t)a=f[t],(x=Dm(i[1],a[0]))>g&&(g=x,ku=a[0],Bu=i[1])}return K1=Vy=null,ku===1/0||gp===1/0?[[NaN,NaN],[NaN,NaN]]:[[ku,gp],[Bu,Mm]]}),IK=rD("centroid",function(e){rk=ik=ok=ak=sk=uk=ck=lk=0,XM=new Qd,KM=new Qd,YM=new Qd,Ly(e,O0);var t=+XM,n=+KM,i=+YM,a=pT(t,n,i);return a<1e-12&&(t=uk,n=ck,i=lk,ik<ro&&(t=ok,n=ak,i=sk),(a=pT(t,n,i))<1e-12)?[NaN,NaN]:[Cg(n,t)*nc,hp(i/a)*nc]});function iD(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(i){e.warn(i)}return n[n.length-1]}function oD(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function aD(e){const t=on(e);return .2126*oD(t.r)+.7152*oD(t.g)+.0722*oD(t.b)}function yL(e,t){return e===t||e!=e&&t!=t||(Object(ke.B)(e)?!(!Object(ke.B)(t)||e.length!==t.length)&&function(n,i){for(let a=0,f=n.length;a<f;++a)if(!yL(n[a],i[a]))return!1;return!0}(e,t):!(!Object(ke.H)(e)||!Object(ke.H)(t))&&bL(e,t))}function bL(e,t){for(const n in e)if(!yL(e[n],t[n]))return!1;return!0}function xL(e){return t=>bL(e,t)}const wL={};function sD(e){return Object(ke.B)(e)||ArrayBuffer.isView(e)?e:null}function uD(e){return sD(e)||(Object(ke.J)(e)?e:null)}const _L=e=>e.data;function EL(e,t){const n=pL.call(t,e);return n.root&&n.root.lookup||{}}const SL=()=>typeof window<"u"&&window||null,L_={random:()=>Kn(),cumulativeNormal:to,cumulativeLogNormal:Rp,cumulativeUniform:wh,densityNormal:xh,densityLogNormal:Jc,densityUniform:ud,quantileNormal:Cc,quantileLogNormal:ys,quantileUniform:Qc,sampleNormal:Ts,sampleLogNormal:sc,sampleUniform:uc,isArray:ke.B,isBoolean:ke.C,isDate:ke.D,isDefined:e=>e!==void 0,isNumber:ke.G,isObject:ke.H,isRegExp:ke.I,isString:ke.J,isTuple:Wt,isValid:e=>e!=null&&e==e,toBoolean:ke.Ca,toDate:ke.Da,toNumber:ke.Ea,toString:ke.Ga,indexof:function(e,...t){return uD(e).indexOf(...t)},join:function(e,...t){return sD(e).join(...t)},lastindexof:function(e,...t){return uD(e).lastIndexOf(...t)},replace:function(e,t,n){return Object(ke.E)(n)&&Object(ke.o)("Function argument passed to replace."),String(e).replace(t,n)},reverse:function(e){return sD(e).slice().reverse()},slice:function(e,...t){return uD(e).slice(...t)},flush:ke.v,lerp:ke.L,merge:function(){const e=[].slice.call(arguments);return e.unshift({}),Object(ke.p)(...e)},pad:ke.R,peek:ke.W,pluck:function(e,t){const n=wL[t]||(wL[t]=Object(ke.u)(t));return Object(ke.B)(e)?e.map(n):n(e)},span:ke.Z,inrange:ke.A,truncate:ke.Ha,rgb:on,lab:jl,hcl:Qu,hsl:dr,luminance:aD,contrast:function(e,t){const n=aD(e),i=aD(t);return(Math.max(n,i)+.05)/(Math.min(n,i)+.05)},sequence:Ms,format:kK,utcFormat:CK,utcParse:OK,utcOffset:yr.w,utcSequence:yr.x,timeFormat:mL,timeParse:AK,timeOffset:yr.q,timeSequence:yr.r,timeUnitSpecifier:yr.s,monthFormat:function(e){return hk.call(this,e,1,"%B")},monthAbbrevFormat:function(e){return hk.call(this,e,1,"%b")},dayFormat:function(e){return hk.call(this,0,2+e,"%A")},dayAbbrevFormat:function(e){return hk.call(this,0,2+e,"%a")},quarter:ke.X,utcquarter:ke.Ja,week:yr.A,utcweek:yr.z,dayofyear:yr.m,utcdayofyear:yr.y,warn:function(){return iD(this.context.dataflow,"warn",arguments)},info:function(){return iD(this.context.dataflow,"info",arguments)},debug:function(){return iD(this.context.dataflow,"debug",arguments)},extent:ke.q,inScope:function(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},intersect:function(e,t,n){if(!e)return[];const[i,a]=e,f=new rs().set(i[0],i[1],a[0],a[1]);return Rr(n||this.context.dataflow.scenegraph().root,f,function(g){let x=null;if(g){const k=Object(ke.i)(g.marktype),F=Object(ke.i)(g.markname);x=V=>(!k.length||k.some(X=>V.marktype===X))&&(!F.length||F.some(X=>V.name===X))}return x}(t))},clampRange:ke.k,pinchDistance:function(e){const t=e.touches,n=t[0].clientX-t[1].clientX,i=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+i*i)},pinchAngle:function(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)},screen:function(){const e=SL();return e?e.screen:{}},containerSize:function(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]},windowSize:function(){const e=SL();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]},bandspace:function(e,t,n){return rg(e||0,t||0,n||0)},setdata:function(e,t){const n=this.context.dataflow,i=this.context.data[e].input;return n.pulse(i,n.changeset().remove(ke.Ia).insert(t)),1},pathShape:function(e){let t=null;return function(n){return n?ep(n,t=t||Qh(e)):e}},panLinear:ke.S,panLog:ke.T,panPow:ke.U,panSymlog:ke.V,zoomLinear:ke.Na,zoomLog:ke.Oa,zoomPow:ke.Pa,zoomSymlog:ke.Qa,encode:function(e,t,n){if(e){const i=this.context.dataflow,a=e.mark.source;i.pulse(a,i.changeset().encode(e,t))}return n!==void 0?n:e},modify:function(e,t,n,i,a,f){const g=this.context.dataflow,x=this.context.data[e],k=x.input,F=g.stamp();let V,X,te=x.changes;if(g._trigger===!1||!(k.value.length||t||i))return 0;if((!te||te.stamp<F)&&(x.changes=te=g.changeset(),te.stamp=F,g.runAfter(()=>{x.modified=!0,g.pulse(k,te).run()},!0,1)),n&&(V=n===!0?ke.Ia:Object(ke.B)(n)||Wt(n)?n:xL(n),te.remove(V)),t&&te.insert(t),i&&(V=xL(i),k.value.some(V)?te.remove(V):te.insert(i)),a)for(X in f)te.modify(a,X,f[X]);return 1}},FK=["view","item","group","xy","x","y"],RK="event.vega.",kL="this.",cD={},CL={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>`_[${Object(ke.Ba)(gL+e)}]`,functions:function(e){const t=$P(e);FK.forEach(n=>t[n]=RK+n);for(const n in L_)t[n]=kL+n;return Object(ke.p)(t,function(n,i,a){i.__bandwidth=g=>g&&g.bandwidth?g.bandwidth():0,a._bandwidth=vp,a._range=vp,a._scale=vp;const f=g=>"_["+(g.type===Ow?Object(ke.Ba)(tD+g.value):Object(ke.Ba)(tD)+"+"+n(g))+"]";return{_bandwidth:g=>`this.__bandwidth(${f(g[0])})`,_range:g=>`${f(g[0])}.range()`,_scale:g=>`${f(g[0])}(${n(g[1])})`}}(e,L_,cD)),t},constants:qP,visitors:cD},lD=function(e){const t=(e=e||{}).allowed?Object(ke.Fa)(e.allowed):{},n=e.forbidden?Object(ke.Fa)(e.forbidden):{},i=e.constants||qP,a=(e.functions||$P)(X),f=e.globalvar,g=e.fieldvar,x=Object(ke.E)(f)?f:he=>`${f}["${he}"]`;let k={},F={},V=0;function X(he){if(Object(ke.J)(he))return he;const ye=te[he.type];return ye==null&&Object(ke.o)("Unsupported type: "+he.type),ye(he)}const te={Literal:he=>he.raw,Identifier:he=>{const ye=he.name;return V>0?ye:Object(ke.w)(n,ye)?Object(ke.o)("Illegal identifier: "+ye):Object(ke.w)(i,ye)?i[ye]:Object(ke.w)(t,ye)?ye:(k[ye]=1,x(ye))},MemberExpression:he=>{const ye=!he.computed,Pe=X(he.object);ye&&(V+=1);const Ue=X(he.property);return Pe===g&&(F[function(We){const at=We&&We.length-1;return at&&(We[0]==='"'&&We[at]==='"'||We[0]==="'"&&We[at]==="'")?We.slice(1,-1):We}(Ue)]=1),ye&&(V-=1),Pe+(ye?"."+Ue:"["+Ue+"]")},CallExpression:he=>{he.callee.type!=="Identifier"&&Object(ke.o)("Illegal callee type: "+he.callee.type);const ye=he.callee.name,Pe=he.arguments,Ue=Object(ke.w)(a,ye)&&a[ye];return Ue||Object(ke.o)("Unrecognized function: "+ye),Object(ke.E)(Ue)?Ue(Pe):Ue+"("+Pe.map(X).join(",")+")"},ArrayExpression:he=>"["+he.elements.map(X).join(",")+"]",BinaryExpression:he=>"("+X(he.left)+" "+he.operator+" "+X(he.right)+")",UnaryExpression:he=>"("+he.operator+X(he.argument)+")",ConditionalExpression:he=>"("+X(he.test)+"?"+X(he.consequent)+":"+X(he.alternate)+")",LogicalExpression:he=>"("+X(he.left)+he.operator+X(he.right)+")",ObjectExpression:he=>"{"+he.properties.map(X).join(",")+"}",Property:he=>{V+=1;const ye=X(he.key);return V-=1,ye+":"+X(he.value)}};function se(he){const ye={code:X(he),globals:Object.keys(k),fields:Object.keys(F)};return k={},F={},ye}return se.functions=a,se.constants=i,se}(CL);function xc(e,t,n){return arguments.length===1?L_[e]:(L_[e]=t,n&&(cD[e]=n),lD&&(lD.functions[e]=kL+e),this)}function Jv(e,t){const n={};let i;try{i=function(f){Ur=0,Gf=(Pi=f).length,os=null,jP();const g=VM();if(os.type!==A_)throw new Error("Unexpect token after expression.");return g}(e=Object(ke.J)(e)?e:Object(ke.Ba)(e)+"")}catch{Object(ke.o)("Expression parse error: "+e)}i.visit(f=>{if(f.type!==NP)return;const g=f.callee.name,x=CL.visitors[g];x&&x(g,f.arguments,t,n)});const a=lD(i);return a.globals.forEach(f=>{const g=gL+f;!Object(ke.w)(n,g)&&t.getSignal(f)&&(n[g]=t.signalRef(f))}),{$expr:Object(ke.p)({code:a.code},t.options.ast?{ast:i}:null),$fields:a.fields,$params:n}}xc("bandwidth",function(e,t){const n=qy(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0},vp),xc("copy",function(e,t){const n=qy(e,(t||this).context);return n?n.copy():void 0},vp),xc("domain",function(e,t){const n=qy(e,(t||this).context);return n?n.domain():[]},vp),xc("range",function(e,t){const n=qy(e,(t||this).context);return n&&n.range?n.range():[]},vp),xc("invert",function(e,t,n){const i=qy(e,(n||this).context);return i?Object(ke.B)(t)?(i.invertRange||i.invert)(t):(i.invert||i.invertExtent)(t):void 0},vp),xc("scale",function(e,t,n){const i=qy(e,(n||this).context);return i?i(t):void 0},vp),xc("gradient",function(e,t,n,i,a){e=qy(e,(a||this).context);const f=g0(t,n);let g=e.domain(),x=g[0],k=Object(ke.W)(g),F=ke.y;return k-x?F=Yh(e,x,k):e=(e.interpolator?zo("sequential")().interpolator(e.interpolator()):zo("linear")().interpolate(e.interpolate()).range(e.range())).domain([x=0,k=1]),e.ticks&&(x!==(g=e.ticks(+i||15))[0]&&g.unshift(x),k!==Object(ke.W)(g)&&g.push(k)),g.forEach(V=>f.stop(F(V),e(V))),f},vp),xc("geoArea",DK,vp),xc("geoBounds",NK,vp),xc("geoCentroid",IK,vp),xc("geoShape",function(e,t,n){const i=qy(e,(n||this).context);return function(a){return i?i.path.context(a)(t):""}},vp),xc("indata",function(e,t,n){const i=this.context.data[e]["index:"+t],a=i?i.value.get(n):void 0;return a&&a.count},function(e,t,n,i){t[0].type!==Ow&&Object(ke.o)("First argument to indata must be a string literal."),t[1].type!==Ow&&Object(ke.o)("Second argument to indata must be a string literal.");const a=t[0].value,f=t[1].value,g=MK+f;Object(ke.w)(g,i)||(i[g]=n.getData(a).indataRef(n,f))}),xc("data",pL,nD),xc("treePath",function(e,t,n){const i=EL(e,this),a=i[t],f=i[n];return a&&f?a.path(f).map(_L):void 0},nD),xc("treeAncestors",function(e,t){const n=EL(e,this)[t];return n?n.ancestors().map(_L):void 0},nD),xc("vlSelectionTest",function(e,t,n){for(var i,a,f,g,x,k=this.context.data[e],F=k?k.values.value:[],V=k?k[fk]&&k[fk].value:void 0,X=n===QM,te=F.length,se=0;se<te;++se)if(i=F[se],V&&X){if((f=(a=a||{})[g=i.unit]||0)===-1)continue;if(x=fL(t,i),a[g]=x?-1:++f,x&&V.size===1)return!0;if(!x&&f===V.get(g).count)return!1}else if(X^(x=fL(t,i)))return x;return te&&X},eD),xc("vlSelectionIdTest",function(e,t,n){const i=this.context.data[e],a=i?i.values.value:[],f=i?i[fk]&&i[fk].value:void 0,g=n===QM,x=ZM(t),k=wK(a,x);if(k===a.length||ZM(a[k])!==x)return!1;if(f&&g){if(f.size===1)return!0;if(_K(a,x)-k<f.size)return!1}return!0},eD),xc("vlSelectionResolve",function(e,t,n,i){for(var a,f,g,x,k,F,V,X,te,se,he,ye=this.context.data[e],Pe=ye?ye.values.value:[],Ue={},We={},at={},st=Pe.length,lt=0;lt<st;++lt){for(x=(a=Pe[lt]).unit,f=a.fields,g=a.values,se=0,he=f.length;se<he;++se)k=f[se],V=(F=Ue[k.field]||(Ue[k.field]={}))[x]||(F[x]=[]),at[k.field]=X=k.type.charAt(0),te=hL[X+"_union"],F[x]=te(V,Object(ke.i)(g[se]));n&&(V=We[x]||(We[x]=[])).push(Object(ke.i)(g).reduce((ct,Ct,Et)=>(ct[f[Et].field]=Ct,ct),{}))}return t=t||cL,Object.keys(Ue).forEach(ct=>{Ue[ct]=Object.keys(Ue[ct]).map(Ct=>Ue[ct][Ct]).reduce((Ct,Et)=>Ct===void 0?Et:hL[at[ct]+"_"+t](Ct,Et))}),Pe=Object.keys(We),n&&Pe.length&&(Ue[i?pK:hK]=t===cL?{[lL]:Pe.reduce((ct,Ct)=>(ct.push(...We[Ct]),ct),[])}:{[mK]:Pe.map(ct=>({[lL]:We[ct]}))}),Ue},eD),xc("vlSelectionTuples",function(e,t){return e.map(n=>Object(ke.p)({values:t.fields.map(i=>(i.getter||(i.getter=Object(ke.u)(i.field)))(n.datum))},t))});const PK=Object(ke.Fa)(["rule"]),AL=Object(ke.Fa)(["group","image","rect"]);function fD(e){return(e+"").toLowerCase()}function B_(e,t,n){n[n.length-1]!==";"&&(n="return("+n+");");const i=Function(...t.concat(n));return e&&e.functions?i.bind(e.functions):i}var LK={operator:(e,t)=>B_(e,["_"],t.code),parameter:(e,t)=>B_(e,["datum","_"],t.code),event:(e,t)=>B_(e,["event"],t.code),handler:(e,t)=>B_(e,["_","event"],"var datum=event.item&&event.item.datum;return ".concat(t.code,";")),encode:(e,t)=>{const{marktype:n,channels:i}=t;let a="var o=item,datum=o.datum,m=0,$;";for(const f in i){const g="o["+Object(ke.Ba)(f)+"]";a+="$=".concat(i[f].code,";if(").concat(g,"!==$)").concat(g,"=$,m=1;")}return a+=function(f,g){let x="";return PK[g]||(f.x2&&(f.x?(AL[g]&&(x+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),x+="o.width=o.x2-o.x;"):x+="o.x=o.x2-(o.width||0);"),f.xc&&(x+="o.x=o.xc-(o.width||0)/2;"),f.y2&&(f.y?(AL[g]&&(x+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),x+="o.height=o.y2-o.y;"):x+="o.y=o.y2-(o.height||0);"),f.yc&&(x+="o.y=o.yc-(o.height||0)/2;")),x}(i,n),B_(e,["item","_"],a+="return m;")},codegen:{get(e){const t="[".concat(e.map(ke.Ba).join("]["),"]"),n=Function("_","return _".concat(t,";"));return n.path=t,n},comparator(e,t){let n;const i=Function("a","b","var u, v; return "+e.map((a,f)=>{const g=t[f];let x,k;return a.path?(x="a".concat(a.path),k="b".concat(a.path)):((n=n||{})["f"+f]=a,x="this.f".concat(f,"(a)"),k="this.f".concat(f,"(b)")),function(F,V,X,te){return"((u = ".concat(F,") < (v = ").concat(V,") || u == null) && v != null ? ").concat(X,`
  : (u > v || v == null) && u != null ? `).concat(te,`
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? `).concat(X,`
  : v !== v && u === u ? `).concat(te," : ")}(x,k,-g,g)}).join("")+"0;");return n?i.bind(n):i}}};function OL(e,t,n){if(!e||!Object(ke.H)(e))return e;for(let i,a=0,f=TL.length;a<f;++a)if(i=TL[a],Object(ke.w)(e,i.key))return i.parse(e,t,n);return e}var TL=[{key:"$ref",parse:function(e,t){return t.get(e.$ref)||Object(ke.o)("Operator not defined: "+e.$ref)}},{key:"$key",parse:function(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=Object(ke.K)(e.$key,e.$flat,t.expr.codegen))}},{key:"$expr",parse:function(e,t,n){e.$params&&t.parseParameters(e.$params,n);const i="e:"+e.$expr.code+"_"+e.$name;return t.fn[i]||(t.fn[i]=Object(ke.f)(t.parameterExpression(e.$expr),e.$fields,e.$name))}},{key:"$field",parse:function(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=Object(ke.u)(e.$field,e.$name,t.expr.codegen))}},{key:"$encode",parse:function(e,t){const n=e.$encode,i={};for(const a in n){const f=n[a];i[a]=Object(ke.f)(t.encodeExpression(f.$expr),f.$fields),i[a].output=f.$output}return i}},{key:"$compare",parse:function(e,t){const n="c:"+e.$compare+"_"+e.$order,i=Object(ke.i)(e.$compare).map(a=>a&&a.$tupleid?Zt:a);return t.fn[n]||(t.fn[n]=Object(ke.l)(i,e.$order,t.expr.codegen))}},{key:"$context",parse:function(e,t){return t}},{key:"$subflow",parse:function(e,t){const n=e.$subflow;return function(i,a,f){const g=t.fork().parse(n),x=g.get(n.operators[0].id),k=g.signals.parent;return k&&k.set(f),x.detachSubflow=()=>t.detach(g),x}}},{key:"$tupleid",parse:function(){return Zt}}];const BK={skip:!0};function ML(e,t,n,i){return new DL(e,t,n,i)}function DL(e,t,n,i){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=i||LK,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function NL(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}DL.prototype=NL.prototype={fork(){const e=new NL(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter(n=>n!==e);const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,i=n.dataflow,a=e.value;if(n.set(e.id,t),function(f){return fD(f)==="collect"}(e.type)&&a&&(a.$ingest?i.ingest(t,a.$ingest,a.$format):a.$request?i.preload(t,a.$request,a.$format):i.pulse(t,i.changeset().insert(a))),e.root&&(n.root=t),e.parent){let f=n.get(e.parent.$ref);f?(i.connect(f,[t]),t.targets().add(f)):(n.unresolved=n.unresolved||[]).push(()=>{f=n.get(e.parent.$ref),i.connect(f,[t]),t.targets().add(f)})}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const f in e.data){const g=n.data[f]||(n.data[f]={});e.data[f].forEach(x=>g[x]=t)}},resolve(){return(this.unresolved||[]).forEach(e=>e()),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[fD(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,i,a){this.dataflow.on(t,n,i,a,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:function(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach(i=>t.parseOperator(i)),n.forEach(i=>t.parseOperatorParameters(i)),(e.streams||[]).forEach(i=>t.parseStream(i)),(e.updates||[]).forEach(i=>t.parseUpdate(i)),t.resolve()},parseOperator:function(e){const t=this;!function(n){return fD(n)==="operator"}(e.type)&&e.type?t.transform(e,e.type):t.operator(e,e.update?t.operatorExpression(e.update):null)},parseOperatorParameters:function(e){const t=this;if(e.params){const n=t.get(e.id);n||Object(ke.o)("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}},parseParameters:function(e,t){t=t||{};const n=this;for(const i in e){const a=e[i];t[i]=Object(ke.B)(a)?a.map(f=>OL(f,n,t)):OL(a,n,t)}return t},parseStream:function(e){var t,n=this,i=e.filter!=null?n.eventExpression(e.filter):void 0,a=e.stream!=null?n.get(e.stream):void 0;e.source?a=n.events(e.source,e.type,i):e.merge&&(a=(t=e.merge.map(f=>n.get(f)))[0].merge.apply(t[0],t.slice(1))),e.between&&(t=e.between.map(f=>n.get(f)),a=a.between(t[0],t[1])),e.filter&&(a=a.filter(i)),e.throttle!=null&&(a=a.throttle(+e.throttle)),e.debounce!=null&&(a=a.debounce(+e.debounce)),a==null&&Object(ke.o)("Invalid stream definition: "+JSON.stringify(e)),e.consume&&a.consume(!0),n.stream(e,a)},parseUpdate:function(e){var t,n=Object(ke.H)(n=e.source)?n.$ref:n,i=this.get(n),a=e.update,f=void 0;i||Object(ke.o)("Source not defined: "+e.source),t=e.target&&e.target.$expr?this.eventExpression(e.target.$expr):this.get(e.target),a&&a.$expr&&(a.$params&&(f=this.parseParameters(a.$params)),a=this.handlerExpression(a.$expr)),this.update(e,i,t,a,f)},getState:function(e){var t=this,n={};if(e.signals){var i=n.signals={};Object.keys(t.signals).forEach(f=>{const g=t.signals[f];e.signals(f,g)&&(i[f]=g.value)})}if(e.data){var a=n.data={};Object.keys(t.data).forEach(f=>{const g=t.data[f];e.data(f,g)&&(a[f]=g.input.value)})}return t.subcontext&&e.recurse!==!1&&(n.subcontext=t.subcontext.map(f=>f.getState(e))),n},setState:function(e){var t=this,n=t.dataflow,i=e.data,a=e.signals;Object.keys(a||{}).forEach(f=>{n.update(t.signals[f],a[f],BK)}),Object.keys(i||{}).forEach(f=>{n.pulse(t.data[f].input,n.changeset().remove(ke.Ia).insert(i[f]))}),(e.subcontext||[]).forEach((f,g)=>{const x=t.subcontext[g];x&&x.setState(f)})}};var jK=function(e,t,n){var i=new L3,a=t;return t==null?(i.restart(e,t,n),i):(i._restart=i.restart,i.restart=function(f,g,x){g=+g,x=x==null?tM():+x,i._restart(function k(F){F+=a,i._restart(k,a+=g,x),f(F)},g,x)},i.restart(e,t,n),i)};function IL(e,t){e&&(t==null?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}const dD="default";function hD(e,t){const n=e.globalCursor()?typeof document<"u"&&document.body:e.container();if(n)return t==null?n.style.removeProperty("cursor"):n.style.cursor=t}function pk(e,t){var n=e._runtime.data;return Object(ke.w)(n,t)||Object(ke.o)("Unrecognized data set: "+t),n[t]}function mk(e,t){Mr(t)||Object(ke.o)("Second argument to changes must be a changeset.");const n=pk(this,e);return n.modified=!0,this.pulse(n.input,t)}function FL(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function RL(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function gk(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function zK(e,t,n){var i,a,f=e._renderer,g=f&&f.canvas();return g&&(a=gk(e),(i=v(t.changedTouches?t.changedTouches[0]:t,g))[0]-=a[0],i[1]-=a[1]),t.dataflow=e,t.item=n,t.vega=function(x,k,F){const V=k?k.mark.marktype==="group"?k:k.mark.group:null;function X(se){var he,ye=V;if(se){for(he=k;he;he=he.mark.group)if(he.mark.name===se){ye=he;break}}return ye&&ye.mark&&ye.mark.interactive?ye:{}}function te(se){if(!se)return F;Object(ke.J)(se)&&(se=X(se));const he=F.slice();for(;se;)he[0]-=se.x||0,he[1]-=se.y||0,se=se.mark&&se.mark.group;return he}return{view:Object(ke.m)(x),item:Object(ke.m)(k||{}),group:X,xy:te,x:se=>te(se)[0],y:se=>te(se)[1]}}(e,n,i),t}const PL="view",UK="timer",WK="window",VK={trap:!1};function LL(e,t,n,i){e._eventListeners.push({type:n,sources:Object(ke.i)(t),handler:i})}function vk(e,t,n){const i=e._eventConfig&&e._eventConfig[t];return!(i===!1||Object(ke.H)(i)&&!i[n])||(e.warn(`Blocked ${t} ${n} event listener.`),!1)}function BL(e){return e.item}function jL(e){return e.item.mark.source}function zL(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function Nm(e,t,n){const i=document.createElement(e);for(const a in t)i.setAttribute(a,t[a]);return n!=null&&(i.textContent=n),i}const HK="vega-bind",GK="vega-bind-name",qK="vega-bind-radio";function $K(e,t,n,i){const a=n.event||"input",f=()=>e.update(t.value);i.signal(n.signal,t.value),t.addEventListener(a,f),LL(i,t,a,f),e.set=g=>{t.value=g,t.dispatchEvent(function(x){return typeof Event<"u"?new Event(x):{type:x}}(a))}}function XK(e,t,n,i){const a=i.signal(n.signal),f=Nm("div",{class:HK}),g=n.input==="radio"?f:f.appendChild(Nm("label"));g.appendChild(Nm("span",{class:GK},n.name||n.signal)),t.appendChild(f);let x=KK;switch(n.input){case"checkbox":x=YK;break;case"select":x=JK;break;case"radio":x=QK;break;case"range":x=ZK}x(e,g,n,a)}function KK(e,t,n,i){const a=Nm("input");for(const f in n)f!=="signal"&&f!=="element"&&a.setAttribute(f==="input"?"type":f,n[f]);a.setAttribute("name",n.signal),a.value=i,t.appendChild(a),a.addEventListener("input",()=>e.update(a.value)),e.elements=[a],e.set=f=>a.value=f}function YK(e,t,n,i){const a={type:"checkbox",name:n.signal};i&&(a.checked=!0);const f=Nm("input",a);t.appendChild(f),f.addEventListener("change",()=>e.update(f.checked)),e.elements=[f],e.set=g=>f.checked=!!g||null}function JK(e,t,n,i){const a=Nm("select",{name:n.signal}),f=n.labels||[];n.options.forEach((g,x)=>{const k={value:g};yk(g,i)&&(k.selected=!0),a.appendChild(Nm("option",k,(f[x]||g)+""))}),t.appendChild(a),a.addEventListener("change",()=>{e.update(n.options[a.selectedIndex])}),e.elements=[a],e.set=g=>{for(let x=0,k=n.options.length;x<k;++x)if(yk(n.options[x],g))return void(a.selectedIndex=x)}}function QK(e,t,n,i){const a=Nm("span",{class:qK}),f=n.labels||[];t.appendChild(a),e.elements=n.options.map((g,x)=>{const k={type:"radio",name:n.signal,value:g};yk(g,i)&&(k.checked=!0);const F=Nm("input",k);F.addEventListener("change",()=>e.update(g));const V=Nm("label",{},(f[x]||g)+"");return V.prepend(F),a.appendChild(V),F}),e.set=g=>{const x=e.elements,k=x.length;for(let F=0;F<k;++F)yk(x[F].value,g)&&(x[F].checked=!0)}}function ZK(e,t,n,i){i=i!==void 0?i:(+n.max+ +n.min)/2;const a=n.max!=null?n.max:Math.max(100,+i)||100,f=n.min||Math.min(0,a,+i)||0,g=n.step||Object(qu.c)(f,a,100),x=Nm("input",{type:"range",name:n.signal,min:f,max:a,step:g});x.value=i;const k=Nm("span",{},+i);t.appendChild(x),t.appendChild(k);const F=()=>{k.textContent=x.value,e.update(+x.value)};x.addEventListener("input",F),x.addEventListener("change",F),e.elements=[x],e.set=V=>{x.value=V,k.textContent=V}}function yk(e,t){return e===t||e+""==t+""}function UL(e,t,n,i,a,f){return(t=t||new i(e.loader())).initialize(n,FL(e),RL(e),gk(e),a,f).background(e.background())}function pD(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null}function mD(e,t,n){if(typeof t=="string"){if(typeof document>"u")return e.error("DOM document instance not found."),null;if(!(t=document.querySelector(t)))return e.error("Signal bind element not found: "+t),null}if(t&&n)try{t.innerHTML=""}catch(i){t=null,e.error(i)}return t}const j_=e=>+e||0,eY=e=>({top:e,bottom:e,left:e,right:e});function WL(e){return Object(ke.H)(e)?{top:j_(e.top),bottom:j_(e.bottom),left:j_(e.left),right:j_(e.right)}:eY(j_(e))}async function gD(e,t,n,i){const a=Pr(t),f=a&&a.headless;return f||Object(ke.o)("Unrecognized renderer type: "+t),await e.runAsync(),UL(e,null,null,f,n,i).renderAsync(e._scenegraph.root)}var VL="width",HL="height",vD="padding",GL={skip:!0};function qL(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===vD?i.left+i.right:0)}function $L(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===vD?i.top+i.bottom:0)}function tY(e,t){return t.modified&&Object(ke.B)(t.input.value)&&e.indexOf("_:vega:_")}function nY(e,t){return!(e==="parent"||t instanceof fn.proxy)}function rY(e,t,n,i){const a=e.element();a&&a.setAttribute("title",function(f){return f==null?"":Object(ke.B)(f)?XL(f):Object(ke.H)(f)&&!Object(ke.D)(f)?function(g){return Object.keys(g).map(x=>{const k=g[x];return x+": "+(Object(ke.B)(k)?XL(k):KL(k))}).join(`
`)}(f):f+""}(i))}function XL(e){return"["+e.map(KL).join(", ")+"]"}function KL(e){return Object(ke.B)(e)?"[]":Object(ke.H)(e)&&!Object(ke.D)(e)?"{}":e}function YL(e,t){const n=this;if(t=t||{},un.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),t.logLevel!=null&&n.logLevel(t.logLevel),t.locale||e.locale){const f=Object(ke.p)({},e.locale,t.locale);n.locale(Object(Tr.b)(f.number,f.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||xr.Canvas,n._scenegraph=new Hv;const i=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||rY,n._redraw=!0,n._handler=new Xe().scene(i),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=function(f){const g=Object(ke.p)({defaults:{}},f),x=(k,F)=>{F.forEach(V=>{Object(ke.B)(k[V])&&(k[V]=Object(ke.Fa)(k[V]))})};return x(g.defaults,["prevent","allow"]),x(g,["view","window","selector"]),g}(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const a=function(f,g,x){return ML(f,fn,L_,x).parse(g)}(n,e,t.expr);n._runtime=a,n._signals=a.signals,n._bind=(e.bindings||[]).map(f=>({state:null,param:Object(ke.p)({},f)})),a.root&&a.root.set(i),i.source=a.data.root.input,n.pulse(a.data.root.input,n.changeset().insert(i.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=qL(n,n._width),n._viewHeight=$L(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(f){var g=f._signals,x=g[VL],k=g[HL],F=g[vD];function V(){f._autosize=f._resize=1}f._resizeWidth=f.add(null,te=>{f._width=te.size,f._viewWidth=qL(f,te.size),V()},{size:x}),f._resizeHeight=f.add(null,te=>{f._height=te.size,f._viewHeight=$L(f,te.size),V()},{size:k});const X=f.add(null,V,{pad:F});f._resizeWidth.rank=x.rank+1,f._resizeHeight.rank=k.rank+1,X.rank=F.rank+1}(n),function(f){f.add(null,g=>(f._background=g.bg,f._resize=1,g.bg),{bg:f._signals.background})}(n),function(f){const g=f._signals.cursor||(f._signals.cursor=f.add({user:dD,item:null}));f.on(f.events("view","mousemove"),g,(x,k)=>{const F=g.value,V=F?Object(ke.J)(F)?F:F.user:dD,X=k.item&&k.item.cursor||null;return F&&V===F.user&&X==F.item?F:{user:V,item:X}}),f.add(null,function(x){let k=x.cursor,F=this.value;return Object(ke.J)(k)||(F=k.item,k=k.user),hD(f,k&&k!==dD?k:F||k),F},{cursor:g})}(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function bk(e,t){return Object(ke.w)(e._signals,t)?e._signals[t]:Object(ke.o)("Unrecognized signal name: "+Object(ke.Ba)(t))}function JL(e,t){const n=(e._targets||[]).filter(i=>i._update&&i._update.handler===t);return n.length?n[0]:null}function QL(e,t,n,i){let a=JL(n,i);return a||((a=pD(e,()=>i(t,n.value))).handler=i,e.on(n,null,a)),e}function ZL(e,t,n){const i=JL(t,n);return i&&t._targets.remove(i),e}Object(ke.z)(YL,un,{async evaluate(e,t,n){if(await un.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,function(i){var a=gk(i),f=FL(i),g=RL(i);i._renderer.background(i.background()),i._renderer.resize(f,g,a),i._handler.origin(a),i._resizeListeners.forEach(x=>{try{x(f,g)}catch(k){i.error(k)}})}(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(i){this.error(i)}return n&&Ht(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=e!=null?e+"":null;return t!==this._desc&&IL(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const i=bk(this,e);return arguments.length===1?i.value:this.update(i,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",WL(e)):WL(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(Pr(e)||Object(ke.o)("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(un.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(bk(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:function(e,t,n,i,a,f){this.runAfter(g=>{let x=0;g._autosize=0,g.width()!==n&&(x=1,g.signal(VL,n,GL),g._resizeWidth.skip(!0)),g.height()!==i&&(x=1,g.signal(HL,i,GL),g._resizeHeight.skip(!0)),g._viewWidth!==e&&(g._resize=1,g._viewWidth=e),g._viewHeight!==t&&(g._resize=1,g._viewHeight=t),g._origin[0]===a[0]&&g._origin[1]===a[1]||(g._resize=1,g._origin=a),x&&g.run("enter"),f&&g.runAfter(k=>k.resize())},!1,1)},addEventListener(e,t,n){let i=t;return n&&n.trap===!1||((i=pD(this,t)).raw=t),this._handler.on(e,i),this},removeEventListener(e,t){for(var n,i,a=this._handler.handlers(e),f=a.length;--f>=0;)if(i=a[f].type,n=a[f].handler,e===i&&(t===n||t===n.raw)){this._handler.off(i,n);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return QL(this,e,bk(this,e),t)},removeSignalListener(e,t){return ZL(this,bk(this,e),t)},addDataListener(e,t){return QL(this,e,pk(this,e).values,t)},removeDataListener(e,t){return ZL(this,pk(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=hD(this,null);this._globalCursor=!!e,t&&hD(this,t)}return this}return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:function(e,t){this._timers.push(jK(function(n){e({timestamp:Date.now(),elapsed:n})},t))},events:function(e,t,n){var i,a=this,f=new qr(n),g=function(F,V){a.runAsync(null,()=>{e===PL&&function(X,te){var se=X._eventConfig.defaults,he=se.prevent,ye=se.allow;return he!==!1&&ye!==!0&&(he===!0||ye===!1||(he?he[te]:ye?!ye[te]:X.preventDefault()))}(a,t)&&F.preventDefault(),f.receive(zK(a,F,V))})};if(e===UK)vk(a,"timer",t)&&a.timer(g,t);else if(e===PL)vk(a,"view",t)&&a.addEventListener(t,g,VK);else if(e===WK?vk(a,"window",t)&&typeof window<"u"&&(i=[window]):typeof document<"u"&&vk(a,"selector",t)&&(i=document.querySelectorAll(e)),i){for(var x=0,k=i.length;x<k;++x)i[x].addEventListener(t,g);LL(a,i,t,g)}else a.warn("Can not resolve event source: "+e);return f},finalize:function(){var e,t,n,i=this._tooltip,a=this._timers,f=this._eventListeners;for(e=a.length;--e>=0;)a[e].stop();for(e=f.length;--e>=0;)for(t=(n=f[e]).sources.length;--t>=0;)n.sources[t].removeEventListener(n.type,n.handler);return i&&i.call(this,this._handler,null,null,null),this},hover:function(e,t){return e=[e||"hover"],t=[t||"update",e[0]],this.on(this.events("view","mouseover",BL),jL,zL(e)),this.on(this.events("view","mouseout",BL),jL,zL(t)),this},data:function(e,t){return arguments.length<2?pk(this,e).values.value:mk.call(this,e,pr().remove(ke.Ia).insert(t))},change:mk,insert:function(e,t){return mk.call(this,e,pr().insert(t))},remove:function(e,t){return mk.call(this,e,pr().remove(t))},scale:function(e){var t=this._runtime.scales;return Object(ke.w)(t,e)||Object(ke.o)("Unrecognized scale or projection: "+e),t[e].value},initialize:function(e,t){const n=this,i=n._renderType,a=n._eventConfig.bind,f=Pr(i);e=n._el=e?mD(n,e,!0):null,function(k){const F=k.container();F&&(F.setAttribute("role","graphics-document"),F.setAttribute("aria-roleDescription","visualization"),IL(F,k.description()))}(n),f||n.error("Unrecognized renderer type: "+i);const g=f.handler||Xe,x=e?f.renderer:f.headless;return n._renderer=x?UL(n,n._renderer,e,x):null,n._handler=function(k,F,V,X){const te=new X(k.loader(),pD(k,k.tooltip())).scene(k.scenegraph().root).initialize(V,gk(k),k);return F&&F.handlers().forEach(se=>{te.on(se.type,se.handler)}),te}(n,n._handler,e,g),n._redraw=!0,e&&a!=="none"&&(t=t?n._elBind=mD(n,t,!0):e.appendChild(Nm("form",{class:"vega-bindings"})),n._bind.forEach(k=>{k.param.element&&a!=="container"&&(k.element=mD(n,k.param.element,!!k.param.input))}),n._bind.forEach(k=>{(function(F,V,X){if(!V)return;const te=X.param;let se=X.state;se||(se=X.state={elements:null,active:!1,set:null,update:he=>{he!=F.signal(te.signal)&&F.runAsync(null,()=>{se.source=!0,F.signal(te.signal,he)})}},te.debounce&&(se.update=Object(ke.n)(te.debounce,se.update))),(te.input==null&&te.element?$K:XK)(se,V,te,F),se.active||(F.on(F._signals[te.signal],null,()=>{se.source?se.source=!1:se.set(F.signal(te.signal))}),se.active=!0)})(n,k.element||t,k)})),n},toImageURL:async function(e,t){e!==xr.Canvas&&e!==xr.SVG&&e!==xr.PNG&&Object(ke.o)("Unrecognized image type: "+e);const n=await gD(this,e,t);return e===xr.SVG?function(i,a){const f=new Blob([i],{type:a});return window.URL.createObjectURL(f)}(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")},toCanvas:async function(e,t){return(await gD(this,xr.Canvas,e,t)).canvas()},toSVG:async function(e){return(await gD(this,xr.SVG,e)).svg()},getState:function(e){return this._runtime.getState(e||{data:tY,signals:nY,recurse:!0})},setState:function(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},t=>{t._trigger=!0}),this}});const iY="view",xk="[",wk="]",eB="{",tB="}",oY=":",nB=",",aY="@",sY=">",uY=/[[\]{}]/,cY={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let rB,iB;function z_(e,t,n,i,a){const f=e.length;let g,x=0;for(;t<f;++t){if(g=e[t],!x&&g===n)return t;a&&a.indexOf(g)>=0?--x:i&&i.indexOf(g)>=0&&++x}return t}function oB(e){const t=[],n=e.length;let i=0,a=0;for(;a<n;)a=z_(e,a,nB,xk+eB,wk+tB),t.push(e.substring(i,a).trim()),i=++a;if(t.length===0)throw"Empty event selector: "+e;return t}function yD(e){return e[0]==="["?function(t){const n=t.length;let i,a=1;if((a=z_(t,a,wk,xk,wk))===n)throw"Empty between selector: "+t;if((i=oB(t.substring(1,a))).length!==2)throw"Between selector must have two elements: "+t;if((t=t.slice(a+1).trim())[0]!==sY)throw"Expected '>' after between selector: "+t;i=i.map(yD);const f=yD(t.slice(1).trim());return f.between?{between:i,stream:f}:(f.between=i,f)}(e):function(t){const n={source:rB},i=[];let a,f,g=[0,0],x=0,k=0,F=t.length,V=0;if(t[F-1]===tB){if(!((V=t.lastIndexOf(eB))>=0))throw"Unmatched right brace: "+t;try{g=function(X){const te=X.split(nB);if(!X.length||te.length>2)throw X;return te.map(se=>{const he=+se;if(he!=he)throw X;return he})}(t.substring(V+1,F-1))}catch{throw"Invalid throttle specification: "+t}t=t.slice(0,V).trim(),F=t.length,V=0}if(!F)throw t;if(t[0]===aY&&(x=++V),(a=z_(t,V,oY))<F&&(i.push(t.substring(k,a).trim()),k=V=++a),(V=z_(t,V,xk))===F)i.push(t.substring(k,F).trim());else if(i.push(t.substring(k,V).trim()),f=[],(k=++V)===F)throw"Unmatched left bracket: "+t;for(;V<F;){if((V=z_(t,V,wk))===F)throw"Unmatched left bracket: "+t;if(f.push(t.substring(k,V).trim()),V<F-1&&t[++V]!==xk)throw"Expected left bracket: "+t;k=++V}if(!(F=i.length)||uY.test(i[F-1]))throw"Invalid event selector: "+t;return F>1?(n.type=i[1],x?n.markname=i[0].slice(1):function(X){return iB[X]}(i[0])?n.marktype=i[0]:n.source=i[0]):n.type=i[0],n.type.slice(-1)==="!"&&(n.consume=!0,n.type=n.type.slice(0,-1)),f!=null&&(n.filter=f),g[0]&&(n.throttle=g[0]),g[1]&&(n.debounce=g[1]),n}(e)}const U_=e=>+e||0,lY=e=>({top:e,bottom:e,left:e,right:e}),ml=e=>Object(ke.H)(e)&&!Object(ke.B)(e)?Object(ke.p)({},e):{value:e};function aB(e,t,n,i){return n!=null?(Object(ke.H)(n)&&!Object(ke.B)(n)||Object(ke.B)(n)&&n.length&&Object(ke.H)(n[0])?e.update[t]=n:e[i||"enter"][t]={value:n},1):0}function ef(e,t,n){for(const i in t)aB(e,i,t[i]);for(const i in n)aB(e,i,n[i],"update")}function Mw(e,t,n){for(const i in t)n&&Object(ke.w)(n,i)||(e[i]=Object(ke.p)(e[i]||{},t[i]));return e}function Dw(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const bD="mark",xD="frame",wD="scope",fY="axis",dY="axis-domain",hY="axis-grid",pY="axis-label",mY="axis-tick",gY="axis-title",vY="legend",yY="legend-band",bY="legend-entry",xY="legend-gradient",sB="legend-label",wY="legend-symbol",_Y="legend-title",EY="title",SY="title-text",kY="title-subtitle";function _D(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const uB=e=>Object(ke.J)(e)?Object(ke.Ba)(e):e.signal?`(${e.signal})`:cB(e);function _k(e){if(e.gradient!=null)return function(n){const i=[n.start,n.stop,n.count].map(a=>a==null?null:Object(ke.Ba)(a));for(;i.length&&Object(ke.W)(i)==null;)i.pop();return i.unshift(uB(n.gradient)),`gradient(${i.join(",")})`}(e);let t=e.signal?`(${e.signal})`:e.color?function(n){return n.c?Ek("hcl",n.h,n.c,n.l):n.h||n.s?Ek("hsl",n.h,n.s,n.l):n.l||n.a?Ek("lab",n.l,n.a,n.b):n.r||n.g||n.b?Ek("rgb",n.r,n.g,n.b):null}(e.color):e.field!=null?cB(e.field):e.value!==void 0?Object(ke.Ba)(e.value):void 0;return e.scale!=null&&(t=function(n,i){const a=uB(n.scale);return n.range!=null?i=`lerp(_range(${a}), ${+n.range})`:(i!==void 0&&(i=`_scale(${a}, ${i})`),n.band&&(i=(i?i+"+":"")+`_bandwidth(${a})`+(+n.band==1?"":"*"+Sk(n.band)),n.extra&&(i=`(datum.extra ? _scale(${a}, datum.extra.value) : ${i})`)),i==null&&(i="0")),i}(e,t)),t===void 0&&(t=null),e.exponent!=null&&(t=`pow(${t},${Sk(e.exponent)})`),e.mult!=null&&(t+=`*${Sk(e.mult)}`),e.offset!=null&&(t+=`+${Sk(e.offset)}`),e.round&&(t=`round(${t})`),t}const Ek=(e,t,n,i)=>`(${e}(${[t,n,i].map(_k).join(",")})+'')`;function Sk(e){return Object(ke.H)(e)?"("+_k(e)+")":e}function cB(e){return function t(n){let i,a,f;if(n.signal)i="datum",f=n.signal;else if(n.group||n.parent){for(a=Math.max(1,n.level||1),i="item";a-- >0;)i+=".mark.group";n.parent?(f=n.parent,i+=".datum"):f=n.group}else n.datum?(i="datum",f=n.datum):Object(ke.o)("Invalid field reference: "+Object(ke.Ba)(n));return n.signal||(f=Object(ke.J)(f)?Object(ke.Aa)(f).map(ke.Ba).join("]["):t(f)),i+"["+f+"]"}(Object(ke.H)(e)?e:{datum:e})}function lB(e,t,n,i,a,f){const g={};(f=f||{}).encoders={$encode:g},e=function(x,k,F,V,X){const te={},se={};let he,ye,Pe;for(ye in ye="lineBreak",k!=="text"||X[ye]==null||Dw(ye,x)||_D(te,ye,X[ye]),(F=="legend"||String(F).startsWith("axis"))&&(F=null),Pe=F===xD?X.group:F===bD?Object(ke.p)({},X.mark,X[k]):null)Dw(ye,x)||(ye==="fill"||ye==="stroke")&&(Dw("fill",x)||Dw("stroke",x))||_D(te,ye,Pe[ye]);for(ye in Object(ke.i)(V).forEach(Ue=>{const We=X.style&&X.style[Ue];for(const at in We)Dw(at,x)||_D(te,at,We[at])}),x=Object(ke.p)({},x),te)(Pe=te[ye]).signal?(he=he||{})[ye]=Pe:se[ye]=Pe;return x.enter=Object(ke.p)(se,x.enter),he&&(x.update=Object(ke.p)(he,x.update)),x}(e,t,n,i,a.config);for(const x in e)g[x]=CY(e[x],t,f,a);return f}function CY(e,t,n,i){const a={},f={};for(const g in e)e[g]!=null&&(a[g]=OY(AY(e[g]),i,n,f));return{$expr:{marktype:t,channels:a},$fields:Object.keys(f),$output:Object.keys(e)}}function AY(e){return Object(ke.B)(e)?function(t){let n="";return t.forEach(i=>{const a=_k(i);n+=i.test?`(${i.test})?${a}:`:a}),Object(ke.W)(n)===":"&&(n+="null"),n}(e):_k(e)}function OY(e,t,n,i){const a=Jv(e,t);return a.$fields.forEach(f=>i[f]=1),Object(ke.p)(n,a.$params),a.$expr}const TY="outer",MY=["value","update","init","react","bind"];function fB(e,t){Object(ke.o)(e+' for "outer" push: '+Object(ke.Ba)(t))}function dB(e,t){const n=e.name;if(e.push===TY)t.signals[n]||fB("No prior signal definition",n),MY.forEach(i=>{e[i]!==void 0&&fB("Invalid property ",i)});else{const i=t.addSignal(n,e.value);e.react===!1&&(i.react=!1),e.bind&&t.addBinding(n,e.bind)}}function ED(e,t,n,i){this.id=-1,this.type=e,this.value=t,this.params=n,i&&(this.parent=i)}function kk(e,t,n,i){return new ED(e,t,n,i)}function Ck(e,t){return kk("operator",e,t)}function Ki(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function W_(e,t){return t?{$field:e,$name:t}:{$field:e}}const SD=W_("key");function hB(e,t){return{$compare:e,$order:t}}const DY="descending";function Ak(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const kD="scope",CD="view";function Wc(e){return e&&e.signal}function Ok(e){if(Wc(e))return!0;if(Object(ke.H)(e)){for(const t in e)if(Ok(e[t]))return!0}return!1}function T0(e,t){return e??t}function rx(e){return e&&e.signal||e}const pB="timer";function V_(e,t){return(e.merge?NY:e.stream?IY:e.type?FY:Object(ke.o)("Invalid stream specification: "+Object(ke.Ba)(e)))(e,t)}function NY(e,t){const n=AD({merge:e.merge.map(i=>V_(i,t))},e,t);return t.addStream(n).id}function IY(e,t){const n=AD({stream:V_(e.stream,t)},e,t);return t.addStream(n).id}function FY(e,t){let n;e.type===pB?(n=t.event(pB,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(function(a){return a===kD?CD:a||CD}(e.source),e.type);const i=AD({stream:n},e,t);return Object.keys(i).length===1?n:t.addStream(i).id}function AD(e,t,n){let i=t.between;return i&&(i.length!==2&&Object(ke.o)('Stream "between" parameter must have 2 entries: '+Object(ke.Ba)(t)),e.between=[V_(i[0],n),V_(i[1],n)]),i=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&i.push(function(a,f,g){const x="event.item";return x+(a&&a!=="*"?"&&"+x+".mark.marktype==='"+a+"'":"")+(g?"&&"+x+".mark.role==='"+g+"'":"")+(f?"&&"+x+".mark.name==='"+f+"'":"")}(t.marktype,t.markname,t.markrole)),t.source===kD&&i.push("inScope(event.item)"),i.length&&(e.filter=Jv("("+i.join(")&&(")+")",n).$expr),(i=t.throttle)!=null&&(e.throttle=+i),(i=t.debounce)!=null&&(e.debounce=+i),t.consume&&(e.consume=!0),e}const RY={code:"_.$value",ast:{type:"Identifier",value:"value"}};function PY(e,t,n){const i=e.encode,a={target:n};let f=e.events,g=e.update,x=[];f||Object(ke.o)("Signal update missing events specification."),Object(ke.J)(f)&&(f=function(k,F,V){return rB=F||iY,iB=V||cY,oB(k.trim()).map(yD)}(f,t.isSubscope()?kD:CD)),f=Object(ke.i)(f).filter(k=>k.signal||k.scale?(x.push(k),0):1),x.length>1&&(x=[function(k){return{signal:"["+k.map(F=>F.scale?'scale("'+F.scale+'")':F.signal)+"]"}}(x)]),f.length&&x.push(f.length>1?{merge:f}:f[0]),i!=null&&(g&&Object(ke.o)("Signal encode and update are mutually exclusive."),g="encode(item(),"+Object(ke.Ba)(i)+")"),a.update=Object(ke.J)(g)?Jv(g,t):g.expr!=null?Jv(g.expr,t):g.value!=null?g.value:g.signal!=null?{$expr:RY,$params:{$value:t.signalRef(g.signal)}}:Object(ke.o)("Invalid signal update specification."),e.force&&(a.options={force:!0}),x.forEach(k=>t.addUpdate(Object(ke.p)(function(F,V){return{source:F.signal?V.signalRef(F.signal):F.scale?V.scaleRef(F.scale):V_(F,V)}}(k,t),a)))}const ms=e=>(t,n,i)=>kk(e,n,t||void 0,i),mB=ms("aggregate"),LY=ms("axisticks"),gB=ms("bound"),M0=ms("collect"),vB=ms("compare"),BY=ms("datajoin"),yB=ms("encode"),jY=ms("expression"),zY=ms("facet"),UY=ms("field"),WY=ms("key"),VY=ms("legendentries"),HY=ms("load"),GY=ms("mark"),qY=ms("multiextent"),$Y=ms("multivalues"),XY=ms("overlap"),KY=ms("params"),bB=ms("prefacet"),YY=ms("projection"),JY=ms("proxy"),QY=ms("relay"),xB=ms("render"),ZY=ms("scale"),ix=ms("sieve"),eJ=ms("sortitems"),wB=ms("viewlayout"),tJ=ms("values");let nJ=0;const _B={min:"min",max:"max",count:"sum"};function rJ(e,t){const n=t.getScale(e.name).params;let i;for(i in n.domain=EB(e.domain,e,t),e.range!=null&&(n.range=function a(f,g,x){const k=g.config.range;let F=f.range;if(F.signal)return g.signalRef(F.signal);if(Object(ke.J)(F)){if(k&&Object(ke.w)(k,F))return f=Object(ke.p)({},f,{range:k[F]}),a(f,g,x);F==="width"?F=[0,{signal:"width"}]:F==="height"?F=zd(f.type)?[0,{signal:"height"}]:[{signal:"height"},0]:Object(ke.o)("Unrecognized scale range value: "+Object(ke.Ba)(F))}else{if(F.scheme)return x.scheme=Object(ke.B)(F.scheme)?Tk(F.scheme,g):Og(F.scheme,g),F.extent&&(x.schemeExtent=Tk(F.extent,g)),void(F.count&&(x.schemeCount=Og(F.count,g)));if(F.step)return void(x.rangeStep=Og(F.step,g));if(zd(f.type)&&!Object(ke.B)(F))return EB(F,f,g);Object(ke.B)(F)||Object(ke.o)("Unsupported range type: "+Object(ke.Ba)(F))}return F.map(V=>(Object(ke.B)(V)?Tk:Og)(V,g))}(e,t,n)),e.interpolate!=null&&function(a,f){f.interpolate=Og(a.type||a),a.gamma!=null&&(f.interpolateGamma=Og(a.gamma))}(e.interpolate,n),e.nice!=null&&(n.nice=function(a){return Object(ke.H)(a)?{interval:Og(a.interval),step:Og(a.step)}:Og(a)}(e.nice)),e.bins!=null&&(n.bins=function(a,f){return a.signal||Object(ke.B)(a)?Tk(a,f):f.objectProperty(a)}(e.bins,t)),e)Object(ke.w)(n,i)||i==="name"||(n[i]=Og(e[i],t))}function Og(e,t){return Object(ke.H)(e)?e.signal?t.signalRef(e.signal):Object(ke.o)("Unsupported object: "+Object(ke.Ba)(e)):e}function Tk(e,t){return e.signal?t.signalRef(e.signal):e.map(n=>Og(n,t))}function Mk(e){Object(ke.o)("Can not find data set: "+Object(ke.Ba)(e))}function EB(e,t,n){if(e)return e.signal?n.signalRef(e.signal):(Object(ke.B)(e)?function(i,a,f){return i.map(g=>Og(g,f))}:e.fields?function(i,a,f){const g=i.data,x=i.fields.reduce((k,F)=>(F=Object(ke.J)(F)?{data:g,field:F}:Object(ke.B)(F)||F.signal?function(V,X){const te="_:vega:_"+nJ++,se=M0({});if(Object(ke.B)(V))se.value={$ingest:V};else if(V.signal){const he="setdata("+Object(ke.Ba)(te)+","+V.signal+")";se.params.input=X.signalRef(he)}return X.addDataPipeline(te,[se,ix({})]),{data:te,field:"data"}}(F,f):F,k.push(F),k),[]);return(zd(a.type)?function(k,F,V){const X=SB(k.sort,!0);let te,se;const he=V.map(Ue=>{const We=F.getData(Ue.data);return We||Mk(Ue.data),We.countsRef(F,Ue.field,X)}),ye={groupby:SD,pulse:he};X&&(te=X.op||"count",se=X.field?Ak(te,X.field):"count",ye.ops=[_B[te]],ye.fields=[F.fieldRef(se)],ye.as=[se]),te=F.add(mB(ye));const Pe=F.add(M0({pulse:Ki(te)}));return Ki(se=F.add(tJ({field:SD,sort:F.sortRef(X),pulse:Ki(Pe)})))}:ug(a.type)?function(k,F,V){const X=V.map(te=>{const se=F.getData(te.data);return se||Mk(te.data),se.domainRef(F,te.field)});return Ki(F.add($Y({values:X})))}:function(k,F,V){const X=V.map(te=>{const se=F.getData(te.data);return se||Mk(te.data),se.extentRef(F,te.field)});return Ki(F.add(qY({extents:X})))})(i,f,x)}:function(i,a,f){const g=f.getData(i.data);return g||Mk(i.data),zd(a.type)?g.valuesRef(f,i.field,SB(i.sort,!1)):ug(a.type)?g.domainRef(f,i.field):g.extentRef(f,i.field)})(e,t,n);t.domainMin==null&&t.domainMax==null||Object(ke.o)("No scale domain defined for domainMin/domainMax to override.")}function SB(e,t){return e&&(e.field||e.op?e.field||e.op==="count"?t&&e.field&&e.op&&!_B[e.op]&&Object(ke.o)("Multiple domain scales can not be sorted using "+e.op):Object(ke.o)("No field provided for sort aggregate op: "+e.op):Object(ke.H)(e)?e.field="key":e={field:"key"}),e}function OD(e,t,n){return Object(ke.B)(e)?e.map(i=>OD(i,t,n)):Object(ke.H)(e)?e.signal?n.signalRef(e.signal):t==="fit"?e:Object(ke.o)("Unsupported parameter object: "+Object(ke.Ba)(e)):e}const D0="top",Y1="bottom",iJ="vertical",oJ="start",aJ="end",TD="index",MD="label",sJ="offset",Nw="perc",uJ="perc2",Tg="value",H_="guide-label",DD="guide-title",cJ="group-title",lJ="group-subtitle",kB="symbol",Dk="gradient",ND="discrete",ID="size",FD=[ID,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],G_={name:1,style:1,interactive:1},Sa={value:0},Mg={value:1},Nk="group",CB="rect",RD="rule",fJ="symbol",ox="text";function q_(e){return e.type=Nk,e.interactive=e.interactive||!1,e}function yp(e,t){const n=(i,a)=>T0(e[i],T0(t[i],a));return n.isVertical=i=>iJ===T0(e.direction,t.direction||(i?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>T0(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>T0(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>T0(e.columns,T0(t.columns,+n.isVertical(!0))),n}function AB(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function Ik(e,t,n){return`item.anchor === '${oJ}' ? ${e} : item.anchor === '${aJ}' ? ${t} : ${n}`}const PD=Ik(Object(ke.Ba)("left"),Object(ke.Ba)("right"),Object(ke.Ba)("center"));function Im(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=Mw(e.encode,t,G_)):e.interactive=!1,e}const dJ=`datum.${Nw}<=0?"left":datum.${Nw}>=1?"right":"center"`,hJ=`datum.${Nw}<=0?"${Y1}":datum.${Nw}>=1?"${D0}":"middle"`;function OB(e,t,n,i){const a=yp(e,t),f=a.isVertical(),g=ml(a.gradientThickness()),x=a.gradientLength();let k,F,V,X,te=a("labelOverlap"),se="";const he={enter:k={opacity:Sa},update:F={opacity:Mg,text:{field:MD}},exit:{opacity:Sa}};return ef(he,{fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontStyle:a("labelFontStyle"),fontWeight:a("labelFontWeight"),limit:T0(e.labelLimit,t.gradientLabelLimit)}),f?(k.align={value:"left"},k.baseline=F.baseline={signal:hJ},V="y",X="x",se="1-"):(k.align=F.align={signal:dJ},k.baseline={value:"top"},V="x",X="y"),k[V]=F[V]={signal:se+"datum."+Nw,mult:x},k[X]=F[X]=g,g.offset=T0(e.labelOffset,t.gradientLabelOffset)||0,te=te?{separation:a("labelSeparation"),method:te,order:"datum."+TD}:void 0,Im({type:ox,role:sB,style:H_,key:Tg,from:i,encode:he,overlap:te},n)}const Fk='(item.orient === "left" || item.orient === "right")',pJ=`datum.vgrad && ${Fk}`,mJ=Ik('"top"','"bottom"','"middle"'),gJ=`datum.vgrad && item.orient === "right" ? (${Ik('"right"','"left"','"center"')}) : (${Fk} && !(datum.vgrad && item.orient === "left")) ? "left" : ${PD}`,vJ=`item._anchor || (${Fk} ? "middle" : "start")`,yJ=`${pJ} ? (item.orient === "left" ? -90 : 90) : 0`,bJ=`${Fk} ? (datum.vgrad ? (item.orient === "right" ? "bottom" : "top") : ${mJ}) : "top"`;function TB(e){return Object(ke.H)(e)&&e.signal?e.signal:Object(ke.Ba)(e)}function MB(e){const t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")&&t.indexOf("title")?e.type===Nk?wD:t||bD:t}function LD(e,t){const n=tn(e.type);n||Object(ke.o)("Unrecognized transform type: "+Object(ke.Ba)(e.type));const i=kk(n.type.toLowerCase(),null,DB(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(i)),i.metadata=n.metadata||{},i}function DB(e,t,n){const i={},a=e.params.length;for(let f=0;f<a;++f){const g=e.params[f];i[g.name]=xJ(g,t,n)}return i}function xJ(e,t,n){const i=e.type,a=t[e.name];return i==="index"?function(f,g,x){return Object(ke.J)(g.from)||Object(ke.o)('Lookup "from" parameter must be a string literal.'),x.getData(g.from).lookupRef(x,g.key)}(0,t,n):a!==void 0?i==="param"?function(f,g,x){const k=g[f.name];return f.array?(Object(ke.B)(k)||Object(ke.o)("Expected an array of sub-parameters. Instead: "+Object(ke.Ba)(k)),k.map(F=>IB(f,F,x))):IB(f,k,x)}(e,t,n):i==="projection"?n.projectionRef(t[e.name]):e.array&&!Wc(a)?a.map(f=>NB(e,f,n)):NB(e,a,n):void(e.required&&Object(ke.o)("Missing required "+Object(ke.Ba)(t.type)+" parameter: "+Object(ke.Ba)(e.name)))}function NB(e,t,n){const i=e.type;if(Wc(t))return FB(i)?Object(ke.o)("Expression references can not be signals."):BD(i)?n.fieldRef(t):RB(i)?n.compareRef(t):n.signalRef(t.signal);{const a=e.expr||BD(i);return a&&wJ(t)?n.exprRef(t.expr,t.as):a&&_J(t)?W_(t.field,t.as):FB(i)?Jv(t,n):EJ(i)?Ki(n.getData(t).values):BD(i)?W_(t):RB(i)?n.compareRef(t):t}}function IB(e,t,n){const i=e.params.length;let a;for(let g=0;g<i;++g){a=e.params[g];for(const x in a.key)if(a.key[x]!==t[x]){a=null;break}if(a)break}a||Object(ke.o)("Unsupported parameter: "+Object(ke.Ba)(t));const f=Object(ke.p)(DB(a,t,n),a.key);return Ki(n.add(KY(f)))}const wJ=e=>e&&e.expr,_J=e=>e&&e.field,EJ=e=>e==="data",FB=e=>e==="expr",BD=e=>e==="field",RB=e=>e==="compare";function Rk(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:Ki(t.getData(e.data).output)}function ax(e,t,n,i,a){this.scope=e,this.input=t,this.output=n,this.values=i,this.aggregate=a,this.index={}}function PB(e){return Object(ke.J)(e)?e:null}function LB(e,t,n){const i=Ak(n.op,n.field);let a;if(t.ops){for(let f=0,g=t.as.length;f<g;++f)if(t.as[f]===i)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((a=n.op.signal)?e.signalRef(a):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(i))}function $_(e,t,n,i,a,f,g){const x=t[n]||(t[n]={}),k=function(te){return Object(ke.H)(te)?(te.order===DY?"-":"+")+Ak(te.op,te.field):""}(f);let F,V,X=PB(a);if(X!=null&&(e=t.scope,F=x[X+=k?"|"+k:""]),!F){const te=f?{field:SD,pulse:t.countsRef(e,a,f)}:{field:e.fieldRef(a),pulse:Ki(t.output)};k&&(te.sort=e.sortRef(f)),V=e.add(kk(i,void 0,te)),g&&(t.index[a]=V),F=Ki(V),X!=null&&(x[X]=F)}return F}function BB(e,t,n){const i=e.remove,a=e.insert,f=e.toggle,g=e.modify,x=e.values,k=t.add(Ck()),F=Jv("if("+e.trigger+',modify("'+n+'",'+[a,i,f,g,x].map(V=>V??"null").join(",")+"),0)",t);k.update=F.$expr,k.params=F.$params}function Pk(e,t){const n=MB(e),i=e.type===Nk,a=e.from&&e.from.facet,f=e.overlap;let g,x,k,F,V,X,te,se=e.layout||n===wD||n===xD;const he=n===bD||se||a,ye=function(ct,Ct,Et){let gn,An,wn,$n,qn;return ct?(gn=ct.facet)&&(Ct||Object(ke.o)("Only group marks can be faceted."),gn.field!=null?$n=qn=Rk(gn,Et):(ct.data?qn=Ki(Et.getData(ct.data).aggregate):((wn=LD(Object(ke.p)({type:"aggregate",groupby:Object(ke.i)(gn.groupby)},gn.aggregate),Et)).params.key=Et.keyRef(gn.groupby),wn.params.pulse=Rk(gn,Et),$n=qn=Ki(Et.add(wn))),An=Et.keyRef(gn.groupby,!0))):$n=Ki(Et.add(M0(null,[{}]))),$n||($n=Rk(ct,Et)),{key:An,pulse:$n,parent:qn}}(e.from,i,t),Pe=Ki(x=t.add(BY({key:ye.key||(e.key?W_(e.key):void 0),pulse:ye.pulse,clean:!i})));x=k=t.add(M0({pulse:Pe}));const Ue=Ki(x=t.add(GY({markdef:function(ct){return{marktype:ct.type,name:ct.name||void 0,role:ct.role||MB(ct),zindex:+ct.zindex||void 0,aria:ct.aria,description:ct.description}}(e),interactive:function(ct,Ct){return ct&&ct.signal?Ct.signalRef(ct.signal):ct!==!1}(e.interactive,t),clip:function(ct,Ct){let Et;return Object(ke.H)(ct)&&(ct.signal?Et=ct.signal:ct.path?Et="pathShape("+TB(ct.path)+")":ct.sphere&&(Et="geoShape("+TB(ct.sphere)+', {type: "Sphere"})')),Et?Ct.signalRef(Et):!!ct}(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:Ki(x)})));(x=F=t.add(yB(lB(e.encode,e.type,n,e.style,t,{mod:!1,pulse:Ue})))).params.parent=t.encode(),e.transform&&e.transform.forEach(ct=>{const Ct=LD(ct,t),Et=Ct.metadata;(Et.generates||Et.changes)&&Object(ke.o)("Mark transforms should not generate new data."),Et.nomod||(F.params.mod=!0),Ct.params.pulse=Ki(x),t.add(x=Ct)}),e.sort&&(x=t.add(eJ({sort:t.compareRef(e.sort),pulse:Ki(x)})));const We=Ki(x);(a||se)&&(X=Ki(se=t.add(wB({layout:t.objectProperty(e.layout),legends:t.legends,mark:Ue,pulse:We}))));const at=t.add(gB({mark:Ue,pulse:X||We}));te=Ki(at),i&&(he&&((g=t.operators).pop(),se&&g.pop()),t.pushState(We,X||te,Pe),a?function(ct,Ct,Et){const gn=ct.from.facet,An=gn.name,wn=Rk(gn,Ct);let $n;gn.name||Object(ke.o)("Facet must have a name: "+Object(ke.Ba)(gn)),gn.data||Object(ke.o)("Facet must reference a data set: "+Object(ke.Ba)(gn)),gn.field?$n=Ct.add(bB({field:Ct.fieldRef(gn.field),pulse:wn})):gn.groupby?$n=Ct.add(zY({key:Ct.keyRef(gn.groupby),group:Ki(Ct.proxy(Et.parent)),pulse:wn})):Object(ke.o)("Facet must specify groupby or field: "+Object(ke.Ba)(gn));const qn=Ct.fork(),er=qn.add(M0()),rr=qn.add(ix({pulse:Ki(er)}));qn.addData(An,new ax(qn,er,er,rr)),qn.addSignal("parent",null),$n.params.subflow={$subflow:qn.parse(ct).toRuntime()}}(e,t,ye):he?function(ct,Ct,Et){const gn=Ct.add(bB({pulse:Et.pulse})),An=Ct.fork();An.add(ix()),An.addSignal("parent",null),gn.params.subflow={$subflow:An.parse(ct).toRuntime()}}(e,t,ye):t.parse(e),t.popState(),he&&(se&&g.push(se),g.push(at))),f&&(te=function(ct,Ct,Et){const gn=ct.method,An=ct.bound,wn=ct.separation,$n={separation:Wc(wn)?Et.signalRef(wn.signal):wn,method:Wc(gn)?Et.signalRef(gn.signal):gn,pulse:Ct};if(ct.order&&($n.sort=Et.compareRef({field:ct.order})),An){const qn=An.tolerance;$n.boundTolerance=Wc(qn)?Et.signalRef(qn.signal):+qn,$n.boundScale=Et.scaleRef(An.scale),$n.boundOrient=An.orient}return Ki(Et.add(XY($n)))}(f,te,t));const st=t.add(xB({pulse:te})),lt=t.add(ix({pulse:Ki(st)},void 0,t.parent()));e.name!=null&&(V=e.name,t.addData(V,new ax(t,k,st,lt)),e.on&&e.on.forEach(ct=>{(ct.insert||ct.remove||ct.toggle)&&Object(ke.o)("Marks only support modify triggers."),BB(ct,t,V)}))}function SJ(e,t){const n=t.config.legend,i=e.encode||{},a=yp(e,n),f=i.legend||{},g=f.name||void 0,x=f.interactive,k=f.style,F={};let V,X,te,se=0;FD.forEach(We=>e[We]?(F[We]=e[We],se=se||e[We]):0),se||Object(ke.o)("Missing valid scale for legend.");const he=function(We,at){let st=We.type||kB;return We.type||function(lt){return FD.reduce((ct,Ct)=>ct+(lt[Ct]?1:0),0)}(We)!==1||!We.fill&&!We.stroke||(st=jd(at)?Dk:dm(at)?ND:kB),st!==Dk?st:dm(at)?ND:Dk}(e,t.scaleType(se)),ye={title:e.title!=null,scales:F,type:he,vgrad:he!=="symbol"&&a.isVertical()},Pe=Ki(t.add(M0(null,[ye]))),Ue=Ki(t.add(VY(X={type:he,scale:t.scaleRef(se),count:t.objectProperty(a("tickCount")),limit:t.property(a("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return he===Dk?(te=[function(We,at,st,lt){const ct=yp(We,st),Ct=ct.isVertical(),Et=ct.gradientThickness(),gn=ct.gradientLength();let An,wn,$n,qn,er;Ct?(wn=[0,1],$n=[0,0],qn=Et,er=gn):(wn=[0,0],$n=[1,0],qn=gn,er=Et);const rr={enter:An={opacity:Sa,x:Sa,y:Sa,width:ml(qn),height:ml(er)},update:Object(ke.p)({},An,{opacity:Mg,fill:{gradient:at,start:wn,stop:$n}}),exit:{opacity:Sa}};return ef(rr,{stroke:ct("gradientStrokeColor"),strokeWidth:ct("gradientStrokeWidth")},{opacity:ct("gradientOpacity")}),Im({type:CB,role:xY,encode:rr},lt)}(e,se,n,i.gradient),OB(e,n,i.labels,Ue)],X.count=X.count||t.signalRef(`max(2,2*floor((${rx(a.gradientLength())})/100))`)):he===ND?te=[function(We,at,st,lt,ct){const Ct=yp(We,st),Et=Ct.isVertical(),gn=Ct.gradientThickness(),An=Ct.gradientLength();let wn,$n,qn,er,rr="";Et?(wn="y",qn="y2",$n="x",er="width",rr="1-"):(wn="x",qn="x2",$n="y",er="height");const lr={opacity:Sa,fill:{scale:at,field:Tg}};lr[wn]={signal:rr+"datum."+Nw,mult:An},lr[$n]=Sa,lr[qn]={signal:rr+"datum."+uJ,mult:An},lr[er]=ml(gn);const Or={enter:lr,update:Object(ke.p)({},lr,{opacity:Mg}),exit:{opacity:Sa}};return ef(Or,{stroke:Ct("gradientStrokeColor"),strokeWidth:Ct("gradientStrokeWidth")},{opacity:Ct("gradientOpacity")}),Im({type:CB,role:yY,key:Tg,from:ct,encode:Or},lt)}(e,se,n,i.gradient,Ue),OB(e,n,i.labels,Ue)]:(V=function(We,at){const st=yp(We,at);return{align:st("gridAlign"),columns:st.entryColumns(),center:{row:!0,column:!1},padding:{row:st("rowPadding"),column:st("columnPadding")}}}(e,n),te=[function(We,at,st,lt,ct){const Ct=yp(We,at),Et=st.entries,gn=!(!Et||!Et.interactive),An=Et?Et.name:void 0,wn=Ct("clipHeight"),$n=Ct("symbolOffset"),qn={data:"value"},er=`(${ct}) ? datum.${sJ} : datum.${ID}`,rr=wn?ml(wn):{field:ID},lr=`datum.${TD}`,Or=`max(1, ${ct})`;let Jr,Lr,li,Ai,Ti;rr.mult=.5,Jr={enter:Lr={opacity:Sa,x:{signal:er,mult:.5,offset:$n},y:rr},update:li={opacity:Mg,x:Lr.x,y:Lr.y},exit:{opacity:Sa}};let Ji=null,Ii=null;We.fill||(Ji=at.symbolBaseFillColor,Ii=at.symbolBaseStrokeColor),ef(Jr,{fill:Ct("symbolFillColor",Ji),shape:Ct("symbolType"),size:Ct("symbolSize"),stroke:Ct("symbolStrokeColor",Ii),strokeDash:Ct("symbolDash"),strokeDashOffset:Ct("symbolDashOffset"),strokeWidth:Ct("symbolStrokeWidth")},{opacity:Ct("symbolOpacity")}),FD.forEach(ca=>{We[ca]&&(li[ca]=Lr[ca]={scale:We[ca],field:Tg})});const Mi=Im({type:fJ,role:wY,key:Tg,from:qn,clip:!!wn||void 0,encode:Jr},st.symbols),ji=ml($n);ji.offset=Ct("labelOffset"),ef(Jr={enter:Lr={opacity:Sa,x:{signal:er,offset:ji},y:rr},update:li={opacity:Mg,text:{field:MD},x:Lr.x,y:Lr.y},exit:{opacity:Sa}},{align:Ct("labelAlign"),baseline:Ct("labelBaseline"),fill:Ct("labelColor"),fillOpacity:Ct("labelOpacity"),font:Ct("labelFont"),fontSize:Ct("labelFontSize"),fontStyle:Ct("labelFontStyle"),fontWeight:Ct("labelFontWeight"),limit:Ct("labelLimit")});const Co=Im({type:ox,role:sB,style:H_,key:Tg,from:qn,encode:Jr},st.labels);return Jr={enter:{noBound:{value:!wn},width:Sa,height:wn?ml(wn):Sa,opacity:Sa},exit:{opacity:Sa},update:li={opacity:Mg,row:{signal:null},column:{signal:null}}},Ct.isVertical(!0)?(Ai=`ceil(item.mark.items.length / ${Or})`,li.row.signal=`${lr}%${Ai}`,li.column.signal=`floor(${lr} / ${Ai})`,Ti={field:["row",lr]}):(li.row.signal=`floor(${lr} / ${Or})`,li.column.signal=`${lr} % ${Or}`,Ti={field:lr}),li.column.signal=`(${ct})?${li.column.signal}:${lr}`,q_({role:wD,from:lt={facet:{data:lt,name:"value",groupby:TD}},encode:Mw(Jr,Et,G_),marks:[Mi,Co],name:An,interactive:gn,sort:Ti})}(e,n,i,Ue,rx(V.columns))],X.size=function(We,at,st){const lt=rx(jB("size",We,st)),ct=rx(jB("strokeWidth",We,st)),Ct=rx(function(Et,gn,An){return AB("fontSize",Et)||function(wn,$n,qn){const er=$n.config.style[qn];return er&&er[wn]}("fontSize",gn,An)}(st[1].encode,at,H_));return Jv(`max(ceil(sqrt(${lt})+${ct}),${Ct})`,at)}(e,t,te[0].marks)),te=[q_({role:bY,from:Pe,encode:{enter:{x:{value:0},y:{value:0}}},marks:te,layout:V,interactive:x})],ye.title&&te.push(function(We,at,st,lt){const ct=yp(We,at),Ct={enter:{opacity:Sa},update:{opacity:Mg,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:Sa}};return ef(Ct,{orient:ct("titleOrient"),_anchor:ct("titleAnchor"),anchor:{signal:vJ},angle:{signal:yJ},align:{signal:gJ},baseline:{signal:bJ},text:We.title,fill:ct("titleColor"),fillOpacity:ct("titleOpacity"),font:ct("titleFont"),fontSize:ct("titleFontSize"),fontStyle:ct("titleFontStyle"),fontWeight:ct("titleFontWeight"),limit:ct("titleLimit"),lineHeight:ct("titleLineHeight")},{align:ct("titleAlign"),baseline:ct("titleBaseline")}),Im({type:ox,role:_Y,style:DD,from:lt,encode:Ct},st)}(e,n,i.title,Pe)),Pk(q_({role:vY,from:Pe,encode:Mw(function(We,at,st){const lt={enter:{},update:{}};return ef(lt,{orient:We("orient"),offset:We("offset"),padding:We("padding"),titlePadding:We("titlePadding"),cornerRadius:We("cornerRadius"),fill:We("fillColor"),stroke:We("strokeColor"),strokeWidth:st.strokeWidth,strokeDash:st.strokeDash,x:We("legendX"),y:We("legendY"),format:at.format,formatType:at.formatType}),lt}(a,e,n),f,G_),marks:te,aria:a("aria"),description:a("description"),zindex:a("zindex"),name:g,interactive:x,style:k}),t)}function jB(e,t,n){return t[e]?`scale("${t[e]}",datum)`:AB(e,n[0].encode)}ax.fromEntries=function(e,t){const n=t.length,i=t[n-1],a=t[n-2];let f=t[0],g=null,x=1;for(f&&f.type==="load"&&(f=t[1]),e.add(t[0]);x<n;++x)t[x].params.pulse=Ki(t[x-1]),e.add(t[x]),t[x].type==="aggregate"&&(g=t[x]);return new ax(e,f,a,i,g)},ax.prototype={countsRef(e,t,n){const i=this,a=i.counts||(i.counts={}),f=PB(t);let g,x,k;return f!=null&&(e=i.scope,g=a[f]),g?n&&n.field&&LB(e,g.agg.params,n):(k={groupby:e.fieldRef(t,"key"),pulse:Ki(i.output)},n&&n.field&&LB(e,k,n),g={agg:x=e.add(mB(k)),ref:Ki(g=e.add(M0({pulse:Ki(x)})))},f!=null&&(a[f]=g)),g.ref},tuplesRef(){return Ki(this.values)},extentRef(e,t){return $_(e,this,"extent","extent",t,!1)},domainRef(e,t){return $_(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return $_(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return $_(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return $_(e,this,"indata","tupleindex",t,!0,!0)}};const kJ='item.orient==="left"?-90:item.orient==="right"?90:0';function CJ(e,t){const n=yp(e=Object(ke.J)(e)?{text:e}:e,t.config.title),i=e.encode||{},a=i.group||{},f=a.name||void 0,g=a.interactive,x=a.style,k=[],F=Ki(t.add(M0(null,[{}])));return k.push(function(V,X,te,se){const he={value:0},ye=V.text,Pe={enter:{opacity:he},update:{opacity:{value:1}},exit:{opacity:he}};return ef(Pe,{text:ye,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:X("dx"),dy:X("dy"),fill:X("color"),font:X("font"),fontSize:X("fontSize"),fontStyle:X("fontStyle"),fontWeight:X("fontWeight"),lineHeight:X("lineHeight")},{align:X("align"),angle:X("angle"),baseline:X("baseline")}),Im({type:ox,role:SY,style:cJ,from:se,encode:Pe},te)}(e,n,function(V){const X=V.encode;return X&&X.title||Object(ke.p)({name:V.name,interactive:V.interactive,style:V.style},X)}(e),F)),e.subtitle&&k.push(function(V,X,te,se){const he={value:0},ye=V.subtitle,Pe={enter:{opacity:he},update:{opacity:{value:1}},exit:{opacity:he}};return ef(Pe,{text:ye,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:X("dx"),dy:X("dy"),fill:X("subtitleColor"),font:X("subtitleFont"),fontSize:X("subtitleFontSize"),fontStyle:X("subtitleFontStyle"),fontWeight:X("subtitleFontWeight"),lineHeight:X("subtitleLineHeight")},{align:X("align"),angle:X("angle"),baseline:X("baseline")}),Im({type:ox,role:kY,style:lJ,from:se,encode:Pe},te)}(e,n,i.subtitle,F)),Pk(q_({role:EY,from:F,encode:function(V,X){const te={enter:{},update:{}};return ef(te,{orient:V("orient"),anchor:V("anchor"),align:{signal:PD},angle:{signal:kJ},limit:V("limit"),frame:V("frame"),offset:V("offset")||0,padding:V("subtitlePadding")}),Mw(te,X,G_)}(n,a),marks:k,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:f,interactive:g,style:x}),t)}function AJ(e,t){const n=[];e.transform&&e.transform.forEach(i=>{n.push(LD(i,t))}),e.on&&e.on.forEach(i=>{BB(i,t,e.name)}),t.addDataPipeline(e.name,function(i,a,f){const g=[];let x,k,F,V,X,te=null,se=!1,he=!1;for(i.values?Wc(i.values)||Ok(i.format)?(g.push(zB(a,i)),g.push(te=sx())):g.push(te=sx({$ingest:i.values,$format:i.format})):i.url?Ok(i.url)||Ok(i.format)?(g.push(zB(a,i)),g.push(te=sx())):g.push(te=sx({$request:i.url,$format:i.format})):i.source&&(te=x=Object(ke.i)(i.source).map(ye=>Ki(a.getData(ye).output)),g.push(null)),k=0,F=f.length;k<F;++k)V=f[k],X=V.metadata,te||X.source||g.push(te=sx()),g.push(V),X.generates&&(he=!0),X.modifies&&!he&&(se=!0),X.source?te=V:X.changes&&(te=null);return x&&(F=x.length-1,g[0]=QY({derive:se,pulse:F?x:x[0]}),(se||F)&&g.splice(1,0,sx())),te||g.push(sx()),g.push(ix({})),g}(e,t,n))}function sx(e){const t=M0({},e);return t.metadata={source:!0},t}function zB(e,t){return HY({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const UB=e=>e===Y1||e===D0,Lk=(e,t,n)=>Wc(e)?DJ(e.signal,t,n):e==="left"||e===D0?t:n,gl=(e,t,n)=>Wc(e)?TJ(e.signal,t,n):UB(e)?t:n,N0=(e,t,n)=>Wc(e)?MJ(e.signal,t,n):UB(e)?n:t,WB=(e,t,n)=>Wc(e)?NJ(e.signal,t,n):e===D0?{value:t}:{value:n},OJ=(e,t,n)=>Wc(e)?IJ(e.signal,t,n):e==="right"?{value:t}:{value:n},TJ=(e,t,n)=>VB(`${e} === '${D0}' || ${e} === '${Y1}'`,t,n),MJ=(e,t,n)=>VB(`${e} !== '${D0}' && ${e} !== '${Y1}'`,t,n),DJ=(e,t,n)=>jD(`${e} === 'left' || ${e} === '${D0}'`,t,n),NJ=(e,t,n)=>jD(`${e} === '${D0}'`,t,n),IJ=(e,t,n)=>jD(`${e} === 'right'`,t,n),VB=(e,t,n)=>(t=t!=null?ml(t):t,n=n!=null?ml(n):n,HB(t)&&HB(n)?{signal:`${e} ? (${t=t?t.signal||Object(ke.Ba)(t.value):null}) : (${n=n?n.signal||Object(ke.Ba)(n.value):null})`}:[Object(ke.p)({test:e},t)].concat(n||[])),HB=e=>e==null||Object.keys(e).length===1,jD=(e,t,n)=>({signal:`${e} ? (${Iw(t)}) : (${Iw(n)})`}),FJ=(e,t,n,i,a)=>({signal:(i!=null?`${e} === 'left' ? (${Iw(i)}) : `:"")+(n!=null?`${e} === '${Y1}' ? (${Iw(n)}) : `:"")+(a!=null?`${e} === 'right' ? (${Iw(a)}) : `:"")+(t!=null?`${e} === '${D0}' ? (${Iw(t)}) : `:"")+"(null)"}),Iw=e=>Wc(e)?e.signal:e==null?null:Object(ke.Ba)(e),RJ=(e,t)=>t===0?0:Wc(e)?{signal:`(${e.signal}) * ${t}`}:{value:e*t},Fw=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function Rw(e,t,n,i){let a;if(t&&Object(ke.w)(t,e))return t[e];if(Object(ke.w)(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":a="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":a=e[5].toLowerCase()+e.slice(6)}return i[DD][a]}if(e.startsWith("label")){switch(e){case"labelColor":a="fill";break;case"labelFont":case"labelFontSize":a=e[5].toLowerCase()+e.slice(6)}return i[H_][a]}return null}function GB(e){const t={};for(const n of e)if(n)for(const i in n)t[i]=1;return Object.keys(t)}function qB(e,t){return{scale:e.scale,range:t}}function PJ(e,t,n,i,a){const f=yp(e,t),g=e.orient,x=e.gridScale,k=Lk(g,1,-1),F=function(We,at){if(at!==1)if(Object(ke.H)(We)){let st=We=Object(ke.p)({},We);for(;st.mult!=null;){if(!Object(ke.H)(st.mult))return st.mult=Wc(at)?{signal:`(${st.mult}) * (${at.signal})`}:st.mult*at,We;st=st.mult=Object(ke.p)({},st.mult)}st.mult=at}else We=Wc(at)?{signal:`(${at.signal}) * (${We||0})`}:at*(We||0);return We}(e.offset,k);let V,X,te;const se={enter:V={opacity:Sa},update:te={opacity:Mg},exit:X={opacity:Sa}};ef(se,{stroke:f("gridColor"),strokeCap:f("gridCap"),strokeDash:f("gridDash"),strokeDashOffset:f("gridDashOffset"),strokeOpacity:f("gridOpacity"),strokeWidth:f("gridWidth")});const he={scale:e.scale,field:Tg,band:a.band,extra:a.extra,offset:a.offset,round:f("tickRound")},ye=gl(g,{signal:"height"},{signal:"width"}),Pe=x?{scale:x,range:0,mult:k,offset:F}:{value:0,offset:F},Ue=x?{scale:x,range:1,mult:k,offset:F}:Object(ke.p)(ye,{mult:k,offset:F});return V.x=te.x=gl(g,he,Pe),V.y=te.y=N0(g,he,Pe),V.x2=te.x2=N0(g,Ue),V.y2=te.y2=gl(g,Ue),X.x=gl(g,he),X.y=N0(g,he),Im({type:RD,role:hY,key:Tg,from:i,encode:se},n)}function zD(e,t,n,i,a){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+i+","+a+")"}}function LJ(e,t,n,i,a,f){const g=yp(e,t),x=e.orient,k=e.scale,F=Lk(x,-1,1),V=rx(g("labelFlush")),X=rx(g("labelFlushOffset")),te=g("labelAlign"),se=g("labelBaseline");let he,ye=V===0||!!V;const Pe=ml(a);Pe.mult=F,Pe.offset=ml(g("labelPadding")||0),Pe.offset.mult=F;const Ue={scale:k,field:Tg,band:.5,offset:function gn(An,wn){return wn?An?Object(ke.H)(An)?Object.assign({},An,{offset:gn(An.offset,wn)}):{value:An,offset:wn}:wn:An}(f.offset,g("labelOffset"))},We=gl(x,ye?zD(k,V,'"left"','"right"','"center"'):{value:"center"},OJ(x,"left","right")),at=gl(x,WB(x,"bottom","top"),ye?zD(k,V,'"top"','"bottom"','"middle"'):{value:"middle"}),st=zD(k,V,`-(${X})`,X,0);ye=ye&&X;const lt={opacity:Sa,x:gl(x,Ue,Pe),y:N0(x,Ue,Pe)},ct={enter:lt,update:he={opacity:Mg,text:{field:MD},x:lt.x,y:lt.y,align:We,baseline:at},exit:{opacity:Sa,x:lt.x,y:lt.y}};ef(ct,{dx:!te&&ye?gl(x,st):null,dy:!se&&ye?N0(x,st):null}),ef(ct,{angle:g("labelAngle"),fill:g("labelColor"),fillOpacity:g("labelOpacity"),font:g("labelFont"),fontSize:g("labelFontSize"),fontWeight:g("labelFontWeight"),fontStyle:g("labelFontStyle"),limit:g("labelLimit"),lineHeight:g("labelLineHeight")},{align:te,baseline:se});const Ct=g("labelBound");let Et=g("labelOverlap");return Et=Et||Ct?{separation:g("labelSeparation"),method:Et,order:"datum.index",bound:Ct?{scale:k,orient:x,tolerance:Ct}:null}:void 0,he.align!==We&&(he.align=Fw(he.align,We)),he.baseline!==at&&(he.baseline=Fw(he.baseline,at)),Im({type:ox,role:pY,style:H_,key:Tg,from:i,encode:ct,overlap:Et},n)}function BJ(e,t,n,i){const a=yp(e,t),f=e.orient,g=Lk(f,-1,1);let x,k;const F={enter:x={opacity:Sa,anchor:ml(a("titleAnchor",null)),align:{signal:PD}},update:k=Object(ke.p)({},x,{opacity:Mg,text:ml(e.title)}),exit:{opacity:Sa}},V={signal:`lerp(range("${e.scale}"), ${Ik(0,1,.5)})`};return k.x=gl(f,V),k.y=N0(f,V),x.angle=gl(f,Sa,RJ(g,90)),x.baseline=gl(f,WB(f,Y1,D0),{value:Y1}),k.angle=x.angle,k.baseline=x.baseline,ef(F,{fill:a("titleColor"),fillOpacity:a("titleOpacity"),font:a("titleFont"),fontSize:a("titleFontSize"),fontStyle:a("titleFontStyle"),fontWeight:a("titleFontWeight"),limit:a("titleLimit"),lineHeight:a("titleLineHeight")},{align:a("titleAlign"),angle:a("titleAngle"),baseline:a("titleBaseline")}),function(X,te,se,he){const ye=(We,at)=>We!=null?(se.update[at]=Fw(ml(We),se.update[at]),!1):!Dw(at,he),Pe=ye(X("titleX"),"x"),Ue=ye(X("titleY"),"y");se.enter.auto=Ue===Pe?ml(Ue):gl(te,ml(Ue),ml(Pe))}(a,f,F,n),F.update.align=Fw(F.update.align,x.align),F.update.angle=Fw(F.update.angle,x.angle),F.update.baseline=Fw(F.update.baseline,x.baseline),Im({type:ox,role:gY,style:DD,from:i,encode:F},n)}function jJ(e,t){const n=function(ye,Pe){var Ue,We,at,st=Pe.config,lt=st.style,ct=st.axis,Ct=Pe.scaleType(ye.scale)==="band"&&st.axisBand,Et=ye.orient;if(Wc(Et)){const gn=GB([st.axisX,st.axisY]),An=GB([st.axisTop,st.axisBottom,st.axisLeft,st.axisRight]);for(at of(Ue={},gn))Ue[at]=gl(Et,Rw(at,st.axisX,ct,lt),Rw(at,st.axisY,ct,lt));for(at of(We={},An))We[at]=FJ(Et.signal,Rw(at,st.axisTop,ct,lt),Rw(at,st.axisBottom,ct,lt),Rw(at,st.axisLeft,ct,lt),Rw(at,st.axisRight,ct,lt))}else Ue=Et===D0||Et===Y1?st.axisX:st.axisY,We=st["axis"+Et[0].toUpperCase()+Et.slice(1)];return Ue||We||Ct?Object(ke.p)({},ct,Ue,We,Ct):ct}(e,t),i=e.encode||{},a=i.axis||{},f=a.name||void 0,g=a.interactive,x=a.style,k=yp(e,n),F=function(ye){const Pe=ye("tickBand");let Ue,We,at=ye("tickOffset");return Pe?Pe.signal?(Ue={signal:`(${Pe.signal}) === 'extent' ? 1 : 0.5`},We={signal:`(${Pe.signal}) === 'extent'`},Object(ke.H)(at)||(at={signal:`(${Pe.signal}) === 'extent' ? 0 : ${at}`})):Pe==="extent"?(Ue=1,We=!0,at=0):(Ue=.5,We=!1):(Ue=ye("bandPosition"),We=ye("tickExtra")),{extra:We,band:Ue,offset:at}}(k),V={scale:e.scale,ticks:!!k("ticks"),labels:!!k("labels"),grid:!!k("grid"),domain:!!k("domain"),title:e.title!=null},X=Ki(t.add(M0({},[V]))),te=Ki(t.add(LY({scale:t.scaleRef(e.scale),extra:t.property(F.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),se=[];let he;return V.grid&&se.push(PJ(e,n,i.grid,te,F)),V.ticks&&(he=k("tickSize"),se.push(function(ye,Pe,Ue,We,at,st){const lt=yp(ye,Pe),ct=ye.orient,Ct=Lk(ct,-1,1);let Et,gn,An;const wn={enter:Et={opacity:Sa},update:An={opacity:Mg},exit:gn={opacity:Sa}};ef(wn,{stroke:lt("tickColor"),strokeCap:lt("tickCap"),strokeDash:lt("tickDash"),strokeDashOffset:lt("tickDashOffset"),strokeOpacity:lt("tickOpacity"),strokeWidth:lt("tickWidth")});const $n=ml(at);$n.mult=Ct;const qn={scale:ye.scale,field:Tg,band:st.band,extra:st.extra,offset:st.offset,round:lt("tickRound")};return An.y=Et.y=gl(ct,Sa,qn),An.y2=Et.y2=gl(ct,$n),gn.x=gl(ct,qn),An.x=Et.x=N0(ct,Sa,qn),An.x2=Et.x2=N0(ct,$n),gn.y=N0(ct,qn),Im({type:RD,role:mY,key:Tg,from:We,encode:wn},Ue)}(e,n,i.ticks,te,he,F))),V.labels&&(he=V.ticks?he:0,se.push(LJ(e,n,i.labels,te,he,F))),V.domain&&se.push(function(ye,Pe,Ue,We){const at=yp(ye,Pe),st=ye.orient;let lt,ct;const Ct={enter:lt={opacity:Sa},update:ct={opacity:Mg},exit:{opacity:Sa}};ef(Ct,{stroke:at("domainColor"),strokeCap:at("domainCap"),strokeDash:at("domainDash"),strokeDashOffset:at("domainDashOffset"),strokeWidth:at("domainWidth"),strokeOpacity:at("domainOpacity")});const Et=qB(ye,0),gn=qB(ye,1);return lt.x=ct.x=gl(st,Et,Sa),lt.x2=ct.x2=gl(st,gn),lt.y=ct.y=N0(st,Et,Sa),lt.y2=ct.y2=N0(st,gn),Im({type:RD,role:dY,from:We,encode:Ct},Ue)}(e,n,i.domain,X)),V.title&&se.push(BJ(e,n,i.title,X)),Pk(q_({role:fY,from:X,encode:Mw(function(ye,Pe){const Ue={enter:{},update:{}};return ef(Ue,{orient:ye("orient"),offset:ye("offset")||0,position:T0(Pe.position,0),titlePadding:ye("titlePadding"),minExtent:ye("minExtent"),maxExtent:ye("maxExtent"),range:{signal:`abs(span(range("${Pe.scale}")))`},translate:ye("translate"),format:Pe.format,formatType:Pe.formatType}),Ue}(k,e),a,G_),marks:se,aria:k("aria"),description:k("description"),zindex:k("zindex"),name:f,interactive:g,style:x}),t)}function $B(e,t,n){const i=Object(ke.i)(e.signals),a=Object(ke.i)(e.scales);return n||i.forEach(f=>dB(f,t)),Object(ke.i)(e.projections).forEach(f=>function(g,x){const k=x.config.projection||{},F={};for(const V in g)V!=="name"&&(F[V]=OD(g[V],V,x));for(const V in k)F[V]==null&&(F[V]=OD(k[V],V,x));x.addProjection(g.name,F)}(f,t)),a.forEach(f=>function(g,x){const k=g.type||"linear";fm(k)||Object(ke.o)("Unrecognized scale type: "+Object(ke.Ba)(k)),x.addScale(g.name,{type:k,domain:void 0})}(f,t)),Object(ke.i)(e.data).forEach(f=>AJ(f,t)),a.forEach(f=>rJ(f,t)),(n||i).forEach(f=>function(g,x){const k=x.getSignal(g.name);let F=g.update;g.init&&(F?Object(ke.o)("Signals can not include both init and update expressions."):(F=g.init,k.initonly=!0)),F&&(F=Jv(F,x),k.update=F.$expr,k.params=F.$params),g.on&&g.on.forEach(V=>PY(V,x,k.id))}(f,t)),Object(ke.i)(e.axes).forEach(f=>jJ(f,t)),Object(ke.i)(e.marks).forEach(f=>Pk(f,t)),Object(ke.i)(e.legends).forEach(f=>SJ(f,t)),e.title&&CJ(e.title,t),t.parseLambdas(),t}const zJ=e=>Mw({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e);function UJ(e,t){const n=t.config,i=Ki(t.root=t.add(Ck())),a=function(F,V){const X=ye=>T0(F[ye],V[ye]),te=[X_("background",X("background")),X_("autosize",function(ye){return Object(ke.H)(ye)?ye:{type:ye||"pad"}}(X("autosize"))),X_("padding",function(ye){return Object(ke.H)(ye)?ye.signal?ye:{top:U_(ye.top),bottom:U_(ye.bottom),left:U_(ye.left),right:U_(ye.right)}:lY(U_(ye))}(X("padding"))),X_("width",X("width")||0),X_("height",X("height")||0)],se=te.reduce((ye,Pe)=>(ye[Pe.name]=Pe,ye),{}),he={};return Object(ke.i)(F.signals).forEach(ye=>{Object(ke.w)(se,ye.name)?ye=Object(ke.p)(se[ye.name],ye):te.push(ye),he[ye.name]=ye}),Object(ke.i)(V.signals).forEach(ye=>{Object(ke.w)(he,ye.name)||Object(ke.w)(se,ye.name)||te.push(ye)}),te}(e,n);a.forEach(F=>dB(F,t)),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const f=t.add(M0()),g=t.add(yB(lB(zJ(e.encode),Nk,xD,e.style,t,{pulse:Ki(f)}))),x=t.add(wB({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:i,pulse:Ki(g)}));t.operators.pop(),t.pushState(Ki(g),Ki(x),null),$B(e,t,a),t.operators.push(x);let k=t.add(gB({mark:i,pulse:Ki(x)}));return k=t.add(xB({pulse:Ki(k)})),k=t.add(ix({pulse:Ki(k)})),t.addData("root",new ax(t,f,f,k)),t}function X_(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function XB(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function KB(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function UD(e){return(Object(ke.B)(e)?function(t){const n=t.length;let i="[";for(let a=0;a<n;++a){const f=t[a];i+=(a>0?",":"")+(Object(ke.H)(f)?f.signal||UD(f):Object(ke.Ba)(f))}return i+"]"}:function(t){let n,i,a="{",f=0;for(n in t)i=t[n],a+=(++f>1?",":"")+Object(ke.Ba)(n)+":"+(Object(ke.H)(i)?i.signal||UD(i):Object(ke.Ba)(i));return a+"}"})(e)}function WJ(e,t,n){return Object(ke.H)(e)||Object(ke.o)("Input Vega specification must be an object."),UJ(e,new XB(t=Object(ke.P)({description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:"#4c78a8"},area:{fill:"#4c78a8"},image:null,line:{stroke:"#4c78a8",strokeWidth:2},path:{stroke:"#4c78a8"},rect:{fill:"#4c78a8"},rule:{stroke:"#000"},shape:{stroke:"#4c78a8"},symbol:{fill:"#4c78a8",size:64},text:{fill:"#000",font:"sans-serif",fontSize:11},trail:{fill:"#4c78a8",size:2},style:{"guide-label":{fill:"#000",font:"sans-serif",fontSize:10},"guide-title":{fill:"#000",font:"sans-serif",fontSize:11,fontWeight:"bold"},"group-title":{fill:"#000",font:"sans-serif",fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:"#000",font:"sans-serif",fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:"#ddd"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:"#888",grid:!1,gridWidth:1,gridColor:"#ddd",labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:"#888",tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:"#ddd",gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:"#888",titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}},t,e.config),n)).toRuntime()}XB.prototype=KB.prototype={parse(e){return $B(e,this)},fork(){return new KB(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(t=>{t.$ref=e.id}),e.refs=null),e},proxy(e){const t=e instanceof ED?Ki(e):e;return this.add(JY({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(i,a,f){let g;i&&((g=i.data||(i.data={}))[a]||(g[a]=[])).push(f)}for(e in this.data){n((t=this.data[e]).input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const i in t.index)n(t.index[i],e,"index:"+i)}return this},pushState(e,t,n){this._encode.push(Ki(this.add(ix({pulse:e})))),this._parent.push(t),this._lookup.push(n?Ki(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return Object(ke.W)(this._parent)},encode(){return Object(ke.W)(this._encode)},lookup(){return Object(ke.W)(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(Object(ke.J)(e))return W_(e,t);e.signal||Object(ke.o)("Unsupported field reference: "+Object(ke.Ba)(e));const n=e.signal;let i=this.field[n];if(!i){const a={name:this.signalRef(n)};t&&(a.as=t),this.field[n]=i=Ki(this.add(UY(a)))}return i},compareRef(e){let t=!1;const n=f=>Wc(f)?(t=!0,this.signalRef(f.signal)):function(g){return g&&g.expr}(f)?(t=!0,this.exprRef(f.expr)):f,i=Object(ke.i)(e.field).map(n),a=Object(ke.i)(e.order).map(n);return t?Ki(this.add(vB({fields:i,orders:a}))):hB(i,a)},keyRef(e,t){let n=!1;const i=this.signals;return e=Object(ke.i)(e).map(a=>Wc(a)?(n=!0,Ki(i[a.signal])):a),n?Ki(this.add(WY({fields:e,flat:t}))):function(a,f){const g={$key:a};return f&&(g.$flat=!0),g}(e,t)},sortRef(e){if(!e)return e;const t=Ak(e.op,e.field),n=e.order||"ascending";return n.signal?Ki(this.add(vB({fields:t,orders:this.signalRef(n.signal)}))):hB(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const i=this.id();this.streams.push({id:i,source:e,type:t}),this.events[n]=i}return this.events[n]},hasOwnSignal(e){return Object(ke.w)(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&Object(ke.o)("Duplicate signal name: "+Object(ke.Ba)(e));const n=t instanceof ED?t:this.add(Ck(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||Object(ke.o)("Unrecognized signal name: "+Object(ke.Ba)(e)),this.signals[e]},signalRef(e){return this.signals[e]?Ki(this.signals[e]):(Object(ke.w)(this.lambdas,e)||(this.lambdas[e]=this.add(Ck(null))),Ki(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const i=e[t],a=Jv(i,this),f=this.lambdas[i];f.params=a.$params,f.update=a.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return e&&Object(ke.H)(e)?this.signalRef(e.signal||UD(e)):e},exprRef(e,t){const n={expr:Jv(e,this)};return t&&(n.expr.$name=t),Ki(this.add(jY(n)))},addBinding(e,t){this.bindings||Object(ke.o)("Nested signals do not support binding: "+Object(ke.Ba)(e)),this.bindings.push(Object(ke.p)({signal:e},t))},addScaleProj(e,t){Object(ke.w)(this.scales,e)&&Object(ke.o)("Duplicate scale or projection name: "+Object(ke.Ba)(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,ZY(t))},addProjection(e,t){this.addScaleProj(e,YY(t))},getScale(e){return this.scales[e]||Object(ke.o)("Unrecognized scale name: "+Object(ke.Ba)(e)),this.scales[e]},scaleRef(e){return Ki(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return Object(ke.w)(this.data,e)&&Object(ke.o)("Duplicate data set name: "+Object(ke.Ba)(e)),this.data[e]=t},getData(e){return this.data[e]||Object(ke.o)("Undefined data set name: "+Object(ke.Ba)(e)),this.data[e]},addDataPipeline(e,t){return Object(ke.w)(this.data,e)&&Object(ke.o)("Duplicate data set name: "+Object(ke.Ba)(e)),this.addData(e,ax.fromEntries(this,t))}};const VJ="RawCode",HJ="Literal",GJ="Property",qJ="Identifier",$J="ArrayExpression",XJ="BinaryExpression",KJ="CallExpression",YJ="ConditionalExpression",JJ="LogicalExpression",QJ="MemberExpression",ZJ="ObjectExpression",eQ="UnaryExpression";function I0(e){this.type=e}var $y,Li,Wr,$f,as;I0.prototype.visit=function(e){let t,n,i;if(e(this))return 1;for(n=0,i=(t=function(a){switch(a.type){case $J:return a.elements;case XJ:case JJ:return[a.left,a.right];case KJ:return[a.callee].concat(a.arguments);case YJ:return[a.test,a.consequent,a.alternate];case QJ:return[a.object,a.property];case ZJ:return a.properties;case GJ:return[a.key,a.value];case eQ:return[a.argument];case qJ:case HJ:case VJ:default:return[]}}(this)).length;n<i;++n)if(t[n].visit(e))return 1};var Bk=1,K_=2,ux=3,J1=4,jk=5,cx=6,bp=7,Y_=8;($y={})[Bk]="Boolean",$y[K_]="<end>",$y[ux]="Identifier",$y[J1]="Keyword",$y[jk]="Null",$y[cx]="Numeric",$y[bp]="Punctuator",$y[Y_]="String",$y[9]="RegularExpression";var tQ="ArrayExpression",nQ="BinaryExpression",rQ="CallExpression",iQ="ConditionalExpression",YB="Identifier",oQ="Literal",aQ="LogicalExpression",sQ="MemberExpression",uQ="ObjectExpression",cQ="Property",lQ="UnaryExpression",vl="Unexpected token %0",fQ="Unexpected number",dQ="Unexpected string",hQ="Unexpected identifier",pQ="Unexpected reserved word",mQ="Unexpected end of input",WD="Invalid regular expression",VD="Invalid regular expression: missing /",JB="Octal literals are not allowed in strict mode.",gQ="Duplicate data property in object literal not allowed in strict mode",tf="ILLEGAL",J_="Disabled.",vQ=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),yQ=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function zk(e,t){if(!e)throw new Error("ASSERT: "+t)}function Xy(e){return e>=48&&e<=57}function HD(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function Q_(e){return"01234567".indexOf(e)>=0}function bQ(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function Z_(e){return e===10||e===13||e===8232||e===8233}function eE(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&vQ.test(String.fromCharCode(e))}function Uk(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&yQ.test(String.fromCharCode(e))}const xQ={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function QB(){for(;Wr<$f;){const e=Li.charCodeAt(Wr);if(!bQ(e)&&!Z_(e))break;++Wr}}function GD(e){var t,n,i,a=0;for(n=e==="u"?4:2,t=0;t<n;++t)Wr<$f&&HD(Li[Wr])?(i=Li[Wr++],a=16*a+"0123456789abcdef".indexOf(i.toLowerCase())):za({},vl,tf);return String.fromCharCode(a)}function wQ(){var e,t,n,i;for(t=0,(e=Li[Wr])==="}"&&za({},vl,tf);Wr<$f&&HD(e=Li[Wr++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&za({},vl,tf),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),i=56320+(t-65536&1023),String.fromCharCode(n,i))}function ZB(){var e,t;for(e=Li.charCodeAt(Wr++),t=String.fromCharCode(e),e===92&&(Li.charCodeAt(Wr)!==117&&za({},vl,tf),++Wr,(e=GD("u"))&&e!=="\\"&&eE(e.charCodeAt(0))||za({},vl,tf),t=e);Wr<$f&&Uk(e=Li.charCodeAt(Wr));)++Wr,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),Li.charCodeAt(Wr)!==117&&za({},vl,tf),++Wr,(e=GD("u"))&&e!=="\\"&&Uk(e.charCodeAt(0))||za({},vl,tf),t+=e);return t}function _Q(){var e,t;return e=Wr,{type:(t=Li.charCodeAt(Wr)===92?ZB():function(){var n,i;for(n=Wr++;Wr<$f;){if((i=Li.charCodeAt(Wr))===92)return Wr=n,ZB();if(!Uk(i))break;++Wr}return Li.slice(n,Wr)}()).length===1?ux:xQ.hasOwnProperty(t)?J1:t==="null"?jk:t==="true"||t==="false"?Bk:ux,value:t,start:e,end:Wr}}function qD(){var e,t,n,i,a=Wr,f=Li.charCodeAt(Wr),g=Li[Wr];switch(f){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Wr,{type:bp,value:String.fromCharCode(f),start:a,end:Wr};default:if((e=Li.charCodeAt(Wr+1))===61)switch(f){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Wr+=2,{type:bp,value:String.fromCharCode(f)+String.fromCharCode(e),start:a,end:Wr};case 33:case 61:return Wr+=2,Li.charCodeAt(Wr)===61&&++Wr,{type:bp,value:Li.slice(a,Wr),start:a,end:Wr}}}return(i=Li.substr(Wr,4))===">>>="?{type:bp,value:i,start:a,end:Wr+=4}:(n=i.substr(0,3))===">>>"||n==="<<="||n===">>="?{type:bp,value:n,start:a,end:Wr+=3}:g===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(g)>=0||t==="=>"?{type:bp,value:t,start:a,end:Wr+=2}:(t==="//"&&za({},vl,tf),"<>=!+-*%&|^/".indexOf(g)>=0?{type:bp,value:g,start:a,end:++Wr}:void za({},vl,tf))}function e8(){var e,t,n;if(zk(Xy((n=Li[Wr]).charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=Wr,e="",n!=="."){if(e=Li[Wr++],n=Li[Wr],e==="0"){if(n==="x"||n==="X")return++Wr,function(i){let a="";for(;Wr<$f&&HD(Li[Wr]);)a+=Li[Wr++];return a.length===0&&za({},vl,tf),eE(Li.charCodeAt(Wr))&&za({},vl,tf),{type:cx,value:parseInt("0x"+a,16),start:i,end:Wr}}(t);if(Q_(n))return function(i){let a="0"+Li[Wr++];for(;Wr<$f&&Q_(Li[Wr]);)a+=Li[Wr++];return(eE(Li.charCodeAt(Wr))||Xy(Li.charCodeAt(Wr)))&&za({},vl,tf),{type:cx,value:parseInt(a,8),octal:!0,start:i,end:Wr}}(t);n&&Xy(n.charCodeAt(0))&&za({},vl,tf)}for(;Xy(Li.charCodeAt(Wr));)e+=Li[Wr++];n=Li[Wr]}if(n==="."){for(e+=Li[Wr++];Xy(Li.charCodeAt(Wr));)e+=Li[Wr++];n=Li[Wr]}if(n==="e"||n==="E")if(e+=Li[Wr++],(n=Li[Wr])!=="+"&&n!=="-"||(e+=Li[Wr++]),Xy(Li.charCodeAt(Wr)))for(;Xy(Li.charCodeAt(Wr));)e+=Li[Wr++];else za({},vl,tf);return eE(Li.charCodeAt(Wr))&&za({},vl,tf),{type:cx,value:parseFloat(e),start:t,end:Wr}}function EQ(){var e,t,n,i;return as=null,QB(),e=Wr,t=function(){var a,f,g,x;for(zk((a=Li[Wr])==="/","Regular expression literal must start with a slash"),f=Li[Wr++],g=!1,x=!1;Wr<$f;)if(f+=a=Li[Wr++],a==="\\")Z_((a=Li[Wr++]).charCodeAt(0))&&za({},VD),f+=a;else if(Z_(a.charCodeAt(0)))za({},VD);else if(g)a==="]"&&(g=!1);else{if(a==="/"){x=!0;break}a==="["&&(g=!0)}return x||za({},VD),{value:f.substr(1,f.length-2),literal:f}}(),n=function(){var a,f,g;for(f="",g="";Wr<$f&&Uk((a=Li[Wr]).charCodeAt(0));)++Wr,a==="\\"&&Wr<$f?za({},vl,tf):(g+=a,f+=a);return g.search(/[^gimuy]/g)>=0&&za({},WD,g),{value:g,literal:f}}(),i=function(a,f){let g=a;f.indexOf("u")>=0&&(g=g.replace(/\\u\{([0-9a-fA-F]+)\}/g,(x,k)=>{if(parseInt(k,16)<=1114111)return"x";za({},WD)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(g)}catch{za({},WD)}try{return new RegExp(a,f)}catch{return null}}(t.value,n.value),{literal:t.literal+n.literal,value:i,regex:{pattern:t.value,flags:n.value},start:e,end:Wr}}function t8(){if(QB(),Wr>=$f)return{type:K_,start:Wr,end:Wr};const e=Li.charCodeAt(Wr);return eE(e)?_Q():e===40||e===41||e===59?qD():e===39||e===34?function(){var t,n,i,a,f="",g=!1;for(zk((t=Li[Wr])==="'"||t==='"',"String literal must starts with a quote"),n=Wr,++Wr;Wr<$f;){if((i=Li[Wr++])===t){t="";break}if(i==="\\")if((i=Li[Wr++])&&Z_(i.charCodeAt(0)))i==="\r"&&Li[Wr]===`
`&&++Wr;else switch(i){case"u":case"x":Li[Wr]==="{"?(++Wr,f+=wQ()):f+=GD(i);break;case"n":f+=`
`;break;case"r":f+="\r";break;case"t":f+="	";break;case"b":f+="\b";break;case"f":f+="\f";break;case"v":f+="\v";break;default:Q_(i)?((a="01234567".indexOf(i))!==0&&(g=!0),Wr<$f&&Q_(Li[Wr])&&(g=!0,a=8*a+"01234567".indexOf(Li[Wr++]),"0123".indexOf(i)>=0&&Wr<$f&&Q_(Li[Wr])&&(a=8*a+"01234567".indexOf(Li[Wr++]))),f+=String.fromCharCode(a)):f+=i}else{if(Z_(i.charCodeAt(0)))break;f+=i}}return t!==""&&za({},vl,tf),{type:Y_,value:f,octal:g,start:n,end:Wr}}():e===46?Xy(Li.charCodeAt(Wr+1))?e8():qD():Xy(e)?e8():qD()}function xp(){const e=as;return Wr=e.end,as=t8(),Wr=e.end,e}function n8(){const e=Wr;as=t8(),Wr=e}function r8(e,t,n){const i=new I0(e==="||"||e==="&&"?aQ:nQ);return i.operator=e,i.left=t,i.right=n,i}function SQ(e,t){const n=new I0(rQ);return n.callee=e,n.arguments=t,n}function $D(e){const t=new I0(YB);return t.name=e,t}function tE(e){const t=new I0(oQ);return t.value=e.value,t.raw=Li.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function i8(e,t,n){const i=new I0(sQ);return i.computed=e==="[",i.object=t,i.property=n,i.computed||(n.member=!0),i}function o8(e,t,n){const i=new I0(cQ);return i.key=t,i.value=n,i.kind=e,i}function za(e,t){var n,i=Array.prototype.slice.call(arguments,2),a=t.replace(/%(\d)/g,(f,g)=>(zk(g<i.length,"Message reference must be in range"),i[g]));throw(n=new Error(a)).index=Wr,n.description=a,n}function Wk(e){e.type===K_&&za(e,mQ),e.type===cx&&za(e,fQ),e.type===Y_&&za(e,dQ),e.type===ux&&za(e,hQ),e.type===J1&&za(e,pQ),za(e,vl,e.value)}function Xf(e){const t=xp();t.type===bp&&t.value===e||Wk(t)}function Qs(e){return as.type===bp&&as.value===e}function XD(e){return as.type===J1&&as.value===e}function kQ(){const e=[];for(Wr=as.start,Xf("[");!Qs("]");)Qs(",")?(xp(),e.push(null)):(e.push(lx()),Qs("]")||Xf(","));return xp(),function(t){const n=new I0(tQ);return n.elements=t,n}(e)}function a8(){Wr=as.start;const e=xp();return e.type===Y_||e.type===cx?(e.octal&&za(e,JB),tE(e)):$D(e.value)}function CQ(){var e,t,n;return Wr=as.start,(e=as).type===ux?(n=a8(),Xf(":"),o8("init",n,lx())):e.type!==K_&&e.type!==bp?(t=a8(),Xf(":"),o8("init",t,lx())):void Wk(e)}function AQ(){var e,t,n=[],i={},a=String;for(Wr=as.start,Xf("{");!Qs("}");)t="$"+((e=CQ()).key.type===YB?e.key.name:a(e.key.value)),Object.prototype.hasOwnProperty.call(i,t)?za({},gQ):i[t]=!0,n.push(e),Qs("}")||Xf(",");return Xf("}"),function(f){const g=new I0(uQ);return g.properties=f,g}(n)}const OQ={if:1};function TQ(){var e,t,n;if(Qs("("))return function(){Xf("(");const i=KD();return Xf(")"),i}();if(Qs("["))return kQ();if(Qs("{"))return AQ();if(e=as.type,Wr=as.start,e===ux||OQ[as.value])n=$D(xp().value);else if(e===Y_||e===cx)as.octal&&za(as,JB),n=tE(xp());else{if(e===J1)throw new Error(J_);e===Bk?((t=xp()).value=t.value==="true",n=tE(t)):e===jk?((t=xp()).value=null,n=tE(t)):Qs("/")||Qs("/=")?(n=tE(EQ()),n8()):Wk(xp())}return n}function MQ(){const e=[];if(Xf("("),!Qs(")"))for(;Wr<$f&&(e.push(lx()),!Qs(")"));)Xf(",");return Xf(")"),e}function DQ(){Wr=as.start;const e=xp();return function(t){return t.type===ux||t.type===J1||t.type===Bk||t.type===jk}(e)||Wk(e),$D(e.value)}function NQ(){Xf("[");const e=KD();return Xf("]"),e}function s8(){const e=function(){var t;for(t=TQ();;)if(Qs("."))Xf("."),t=i8(".",t,DQ());else if(Qs("("))t=SQ(t,MQ());else{if(!Qs("["))break;t=i8("[",t,NQ())}return t}();if(as.type===bp&&(Qs("++")||Qs("--")))throw new Error(J_);return e}function Vk(){var e,t;if(as.type!==bp&&as.type!==J1)t=s8();else{if(Qs("++")||Qs("--"))throw new Error(J_);if(Qs("+")||Qs("-")||Qs("~")||Qs("!"))e=xp(),t=Vk(),t=function(n,i){const a=new I0(lQ);return a.operator=n,a.argument=i,a.prefix=!0,a}(e.value,t);else{if(XD("delete")||XD("void")||XD("typeof"))throw new Error(J_);t=s8()}}return t}function u8(e){let t=0;if(e.type!==bp&&e.type!==J1)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function lx(){var e,t;return e=function(){var n,i,a,f,g,x,k,F,V,X;if(n=as,V=Vk(),(g=u8(f=as))===0)return V;for(f.prec=g,xp(),i=[n,as],x=[V,f,k=Vk()];(g=u8(as))>0;){for(;x.length>2&&g<=x[x.length-2].prec;)k=x.pop(),F=x.pop().value,V=x.pop(),i.pop(),a=r8(F,V,k),x.push(a);(f=xp()).prec=g,x.push(f),i.push(as),a=Vk(),x.push(a)}for(a=x[X=x.length-1],i.pop();X>1;)i.pop(),a=r8(x[X-1].value,x[X-2],a),X-=2;return a}(),Qs("?")&&(xp(),t=lx(),Xf(":"),e=function(n,i,a){const f=new I0(iQ);return f.test=n,f.consequent=i,f.alternate=a,f}(e,t,lx())),e}function KD(){const e=lx();if(Qs(","))throw new Error(J_);return e}function IQ(e){Wr=0,$f=(Li=e).length,as=null,n8();const t=KD();if(as.type!==K_)throw new Error("Unexpect token after expression.");return t}var FQ={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function RQ(e){function t(i,a,f){return g=>function(x,k,F,V){let X=e(k[0]);return F&&(X=F+"("+X+")",F.lastIndexOf("new ",0)===0&&(X="("+X+")")),X+"."+x+(V<0?"":V===0?"()":"("+k.slice(1).map(e).join(",")+")")}(i,g,a,f)}const n="new Date";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(i){i.length<3&&Object(ke.o)("Missing arguments to clamp function."),i.length>3&&Object(ke.o)("Too many arguments to clamp function.");const a=i.map(e);return"Math.max("+a[1]+", Math.min("+a[2]+","+a[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase","String",0),lower:t("toLowerCase","String",0),substring:t("substring","String"),split:t("split","String"),trim:t("trim","String",0),regexp:"RegExp",test:t("test","RegExp"),if:function(i){i.length<3&&Object(ke.o)("Missing arguments to if function."),i.length>3&&Object(ke.o)("Too many arguments to if function.");const a=i.map(e);return"("+a[0]+"?"+a[1]+":"+a[2]+")"}}}function PQ(e){const t=(e=e||{}).allowed?Object(ke.Fa)(e.allowed):{},n=e.forbidden?Object(ke.Fa)(e.forbidden):{},i=e.constants||FQ,a=(e.functions||RQ)(X),f=e.globalvar,g=e.fieldvar,x=Object(ke.E)(f)?f:he=>"".concat(f,'["').concat(he,'"]');let k={},F={},V=0;function X(he){if(Object(ke.J)(he))return he;const ye=te[he.type];return ye==null&&Object(ke.o)("Unsupported type: "+he.type),ye(he)}const te={Literal:he=>he.raw,Identifier:he=>{const ye=he.name;return V>0?ye:Object(ke.w)(n,ye)?Object(ke.o)("Illegal identifier: "+ye):Object(ke.w)(i,ye)?i[ye]:Object(ke.w)(t,ye)?ye:(k[ye]=1,x(ye))},MemberExpression:he=>{const ye=!he.computed,Pe=X(he.object);ye&&(V+=1);const Ue=X(he.property);return Pe===g&&(F[function(We){const at=We&&We.length-1;return at&&(We[0]==='"'&&We[at]==='"'||We[0]==="'"&&We[at]==="'")?We.slice(1,-1):We}(Ue)]=1),ye&&(V-=1),Pe+(ye?"."+Ue:"["+Ue+"]")},CallExpression:he=>{he.callee.type!=="Identifier"&&Object(ke.o)("Illegal callee type: "+he.callee.type);const ye=he.callee.name,Pe=he.arguments,Ue=Object(ke.w)(a,ye)&&a[ye];return Ue||Object(ke.o)("Unrecognized function: "+ye),Object(ke.E)(Ue)?Ue(Pe):Ue+"("+Pe.map(X).join(",")+")"},ArrayExpression:he=>"["+he.elements.map(X).join(",")+"]",BinaryExpression:he=>"("+X(he.left)+" "+he.operator+" "+X(he.right)+")",UnaryExpression:he=>"("+he.operator+X(he.argument)+")",ConditionalExpression:he=>"("+X(he.test)+"?"+X(he.consequent)+":"+X(he.alternate)+")",LogicalExpression:he=>"("+X(he.left)+he.operator+X(he.right)+")",ObjectExpression:he=>"{"+he.properties.map(X).join(",")+"}",Property:he=>{V+=1;const ye=X(he.key);return V-=1,ye+":"+X(he.value)}};function se(he){const ye={code:X(he),globals:Object.keys(k),fields:Object.keys(F)};return k={},F={},ye}return se.functions=a,se.constants=i,se}const LQ="view",Hk="[",Gk="]",c8="{",l8="}",BQ=":",f8=",",jQ="@",zQ=">",UQ=/[[\]{}]/,WQ={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let d8,h8;function fx(e,t,n){return d8=t||LQ,h8=n||WQ,p8(e.trim()).map(YD)}function nE(e,t,n,i,a){const f=e.length;let g,x=0;for(;t<f;++t){if(g=e[t],!x&&g===n)return t;a&&a.indexOf(g)>=0?--x:i&&i.indexOf(g)>=0&&++x}return t}function p8(e){const t=[],n=e.length;let i=0,a=0;for(;a<n;)a=nE(e,a,f8,Hk+c8,Gk+l8),t.push(e.substring(i,a).trim()),i=++a;if(t.length===0)throw"Empty event selector: "+e;return t}function YD(e){return e[0]==="["?function(t){const n=t.length;let i,a=1;if((a=nE(t,a,Gk,Hk,Gk))===n)throw"Empty between selector: "+t;if((i=p8(t.substring(1,a))).length!==2)throw"Between selector must have two elements: "+t;if((t=t.slice(a+1).trim())[0]!==zQ)throw"Expected '>' after between selector: "+t;i=i.map(YD);const f=YD(t.slice(1).trim());return f.between?{between:i,stream:f}:(f.between=i,f)}(e):function(t){const n={source:d8},i=[];let a,f,g=[0,0],x=0,k=0,F=t.length,V=0;if(t[F-1]===l8){if(!((V=t.lastIndexOf(c8))>=0))throw"Unmatched right brace: "+t;try{g=function(X){const te=X.split(f8);if(!X.length||te.length>2)throw X;return te.map(se=>{const he=+se;if(he!=he)throw X;return he})}(t.substring(V+1,F-1))}catch{throw"Invalid throttle specification: "+t}t=t.slice(0,V).trim(),F=t.length,V=0}if(!F)throw t;if(t[0]===jQ&&(x=++V),(a=nE(t,V,BQ))<F&&(i.push(t.substring(k,a).trim()),k=V=++a),(V=nE(t,V,Hk))===F)i.push(t.substring(k,F).trim());else if(i.push(t.substring(k,V).trim()),f=[],(k=++V)===F)throw"Unmatched left bracket: "+t;for(;V<F;){if((V=nE(t,V,Gk))===F)throw"Unmatched left bracket: "+t;if(f.push(t.substring(k,V).trim()),V<F-1&&t[++V]!==Hk)throw"Expected left bracket: "+t;k=++V}if(!(F=i.length)||UQ.test(i[F-1]))throw"Invalid event selector: "+t;return F>1?(n.type=i[1],x?n.markname=i[0].slice(1):function(X){return h8[X]}(i[0])?n.marktype=i[0]:n.source=i[0]):n.type=i[0],n.type.slice(-1)==="!"&&(n.consume=!0,n.type=n.type.slice(0,-1)),f!=null&&(n.filter=f),g[0]&&(n.throttle=g[0]),g[1]&&(n.debounce=g[1]),n}(e)}var VQ="5.20.0";Object(ke.p)(fn,S,U,j,N,L,z,W,q,I,Z,Y);const HQ=VQ;var GQ=r(245),Pw=function(e,t,n){return e.fields=t||[],e.fname=n,e},qQ=function(e){return e.length===1?$Q(e[0]):XQ(e)};const $Q=e=>function(t){return t[e]},XQ=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};var JD=function(e){throw Error(e)},dx=function(e){var t,n,i,a=[],f=null,g=0,x=e.length,k="";function F(){a.push(k+e.substring(t,n)),k="",t=n+1}for(e+="",t=n=0;n<x;++n)if((i=e[n])==="\\")k+=e.substring(t,n),k+=e.substring(++n,++n),t=n;else if(i===f)F(),f=null,g=-1;else{if(f)continue;t===g&&i==='"'||t===g&&i==="'"?(t=n+1,f=i):i!=="."||g?i==="["?(n>t&&F(),g=t=n+1):i==="]"&&(g||JD("Access path missing open bracket: "+e),g>0&&F(),g=0,t=n+1):n>t?F():t=n+1}return g&&JD("Access path missing closing bracket: "+e),f&&JD("Access path missing closing quote: "+e),n>t&&(n++,F()),a},KQ=function(e,t,n){const i=dx(e);return e=i.length===1?i[0]:e,Pw((n&&n.get||qQ)(i),[e],t||e)},rE=[],YQ=(KQ("id"),Pw(function(e){return e},rE,"identity"));Pw(function(){return 0},rE,"zero"),Pw(function(){return 1},rE,"one"),Pw(function(){return!0},rE,"true"),Pw(function(){return!1},rE,"false");function qk(e,t,n){var i=[t].concat([].slice.call(n));console[e].apply(console,i)}var io=Array.isArray,yl=function(e){return e===Object(e)};const m8=e=>e!=="__proto__";function g8(...e){return e.reduce((t,n)=>{for(var i in n)if(i==="signals")t.signals=JQ(t.signals,n.signals);else{var a=i==="legend"?{layout:1}:i==="style"||null;QD(t,i,n[i],a)}return t},{})}function QD(e,t,n,i){var a,f;if(m8(t))if(yl(n)&&!io(n))for(a in f=yl(e[t])?e[t]:e[t]={},n)i&&(i===!0||i[a])?QD(f,a,n[a]):m8(a)&&(f[a]=n[a]);else e[t]=n}function JQ(e,t){if(e==null)return t;const n={},i=[];function a(f){n[f.name]||(n[f.name]=1,i.push(f))}return t.forEach(a),e.forEach(a),i}var rc=function(e){return e!=null?io(e)?e:[e]:[]},QQ=function(e){return typeof e=="function"};const ZQ=Object.prototype.hasOwnProperty;var hx=function(e,t){return ZQ.call(e,t)},iE=function(e){return typeof e=="boolean"},wc=function(e){return typeof e=="number"},Qo=function(e){return typeof e=="string"};function ka(e){return io(e)?"["+e.map(ka)+"]":yl(e)||Qo(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}var px=function(e){for(var t={},n=0,i=e.length;n<i;++n)t[e[n]]=!0;return t};function Yi(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function"){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(n[i[a]]=e[i[a]])}return n}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,function(n,i){return Array.isArray(i)?n.push.apply(n,e.call(i,t-1)):n.push(i),n},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var eZ=r(244),tZ=r.n(eZ),nZ=r(243),rZ=r.n(nZ),iZ=r(86),oE=r.n(iZ);function ZD(e){return!!e.or}function e4(e){return!!e.and}function t4(e){return!!e.not}const aE=rZ.a,Zo=tZ.a;function sE(e,t){const n={};for(const i of t)hx(e,i)&&(n[i]=e[i]);return n}function Ky(e,t){const n=Object.assign({},e);for(const i of t)delete n[i];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>oE()(e)).join(",")})`};const mu=oE.a;function Na(e){if(wc(e))return e;const t=Qo(e)?e:oE()(e);if(t.length<250)return t;let n=0;for(let i=0;i<t.length;i++)n=(n<<5)-n+t.charCodeAt(i),n&=n;return n}function v8(e){return e===!1||e===null}function co(e,t){return e.indexOf(t)>-1}function uE(e,t){let n=0;for(const[i,a]of e.entries())if(t(a,i,n++))return!0;return!1}function y8(e,t){let n=0;for(const[i,a]of e.entries())if(!t(a,i,n++))return!1;return!0}function oZ(e,t){for(const n of ci(t))QD(e,n,t[n],!0)}function Q1(e,t){const n=[],i={};let a;for(const f of e)(a=t(f))in i||(i[a]=1,n.push(f));return n}function b8(e,t){for(const n of e)if(t.has(n))return!0;return!1}function x8(e){const t=new Set;for(const n of e){const i=dx(n).map((f,g)=>g===0?f:`[${f}]`),a=i.map((f,g)=>i.slice(0,g+1).join(""));for(const f of a)t.add(f)}return t}function w8(e,t){return e===void 0||t===void 0||b8(x8(e),x8(t))}function As(e){return ci(e).length===0}const ci=Object.keys,Z1=Object.values;function _8(e){const t=[];for(const n in e)hx(e,n)&&t.push({key:n,value:e[n]});return t}function $k(e){return e===!0||e===!1}function gu(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function cE(e,t){return t4(e)?"!("+cE(e.not,t)+")":e4(e)?"("+e.and.map(n=>cE(n,t)).join(") && (")+")":ZD(e)?"("+e.or.map(n=>cE(n,t)).join(") || (")+")":t(e)}function n4(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&n4(e[n],t)&&delete e[n],As(e)}function Xk(e){return e.charAt(0).toUpperCase()+e.substr(1)}function E8(e,t="datum"){const n=dx(e),i=[];for(let a=1;a<=n.length;a++){const f=`[${n.slice(0,a).map(ka).join("][")}]`;i.push(`${t}${f}`)}return i.join(" && ")}function aZ(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function eb(e){return`${dx(e).map(aZ).join("\\.")}`}function Lw(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function S8(e){return`${dx(e).join(".")}`}function lE(e){return e?dx(e).length:0}function _c(...e){for(const t of e)if(t!==void 0)return t}let sZ=42;function uZ(e){const t=++sZ;return e?String(e)+t:t}function Kk(e){if(e!==void 0)return(e%360+360)%360}function r4(e){return!!wc(e)||!isNaN(e)&&!isNaN(parseFloat(e))}const k8={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDash"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDash"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function i4(e){return e&&e.condition}const C8=["domain","grid","labels","ticks","title"],cZ={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},A8={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},lZ=Object.assign(Object.assign({},A8),{style:1,labelExpr:1,encoding:1});function O8(e){return!!lZ[e]}const uh={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},T8=uh.arc,Yk=uh.area,Jk=uh.bar,fZ=uh.image,Qk=uh.line,Zk=uh.point,dZ=uh.rect,eC=uh.rule,M8=uh.text,o4=uh.tick,hZ=uh.trail,a4=uh.circle,s4=uh.square,D8=uh.geoshape;function mx(e){return co(["line","area","trail"],e)}function N8(e){return co(["rect","bar","image","arc"],e)}const I8=ci(uh);function Qv(e){return e.type}px(I8);const pZ=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],F8=ci({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),mZ={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},gZ={binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},vZ={binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5};function Yy(e){return"mark"in e}class tC{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return!!Yy(t)&&function(n){return Qv(n)?n.type:n}(t.mark)===this.name}}const yZ={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},bZ={count:1,min:1,max:1};function tb(e){return!!e&&!!e.argmin}function gx(e){return!!e&&!!e.argmax}function u4(e){return Qo(e)&&!!yZ[e]}const xZ=["count","valid","missing","distinct"];function R8(e){return Qo(e)&&co(xZ,e)}const wZ=["count","sum","distinct","valid","missing"],_Z=px(["mean","average","median","q1","q3","min","max"]),Jy="row",Qy="column",nC="facet",Cu="x",Vc="y",F0="x2",Zv="y2",ey="radius",Zy="radius2",R0="theta",e1="theta2",ty="latitude",ny="longitude",P0="latitude2",Dg="longitude2",wp="color",ry="fill",iy="stroke",_p="shape",t1="size",vx="angle",n1="opacity",nb="fillOpacity",rb="strokeOpacity",ib="strokeWidth",ob="strokeDash",fE="text",dE="order",hE="detail",rC="key",yx="tooltip",iC="href",oC="url",aC="description",P8={theta:1,theta2:1,radius:1,radius2:1};function L8(e){return e in P8}const c4={longitude:1,longitude2:1,latitude:1,latitude2:1},EZ=ci(c4),B8=Object.assign(Object.assign(Object.assign(Object.assign({},{x:1,y:1,x2:1,y2:1}),P8),c4),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function Bw(e){return e===wp||e===ry||e===iy}const j8={row:1,column:1,facet:1},Ng=ci(j8),l4=Object.assign(Object.assign({},B8),j8),z8=ci(l4),SZ=Yi(l4,["order","detail","tooltip"]),kZ=Yi(SZ,["row","column","facet"]);function CZ(e){return!!kZ[e]}function U8(e){return!!l4[e]}const AZ=[F0,Zv,P0,Dg,e1,Zy];function W8(e){return bx(e)!==e}function bx(e){switch(e){case F0:return Cu;case Zv:return Vc;case P0:return ty;case Dg:return ny;case e1:return R0;case Zy:return ey}return e}function ab(e){if(L8(e))switch(e){case R0:return"startAngle";case e1:return"endAngle";case ey:return"outerRadius";case Zy:return"innerRadius"}return e}function oy(e){switch(e){case Cu:return F0;case Vc:return Zv;case ty:return P0;case ny:return Dg;case R0:return e1;case ey:return Zy}}function ay(e){switch(e){case Cu:case F0:return"width";case Vc:case Zv:return"height"}}const f4=Yi(B8,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),OZ=ci(f4),sb={x:1,y:1},Ig=ci(sb);function sy(e){return e in sb}const d4={theta:1,radius:1},TZ=ci(d4);function sC(e){return e==="width"?Cu:Vc}const V8=Yi(f4,["text","tooltip","href","url","description","detail","key","order"]),MZ=ci(V8),H8=Object.assign(Object.assign(Object.assign({},sb),d4),V8),uC=ci(H8);function ub(e){return!!H8[e]}function DZ(e,t){return function(n){switch(n){case wp:case ry:case iy:case aC:case hE:case rC:case yx:case iC:case dE:case n1:case nb:case rb:case ib:case nC:case Jy:case Qy:return G8;case Cu:case Vc:case ty:case ny:return NZ;case F0:case Zv:case P0:case Dg:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case t1:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case ob:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case _p:return{point:"always",geoshape:"always"};case fE:return{text:"always"};case vx:return{point:"always",square:"always",text:"always"};case oC:return{image:"always"};case R0:case ey:return{text:"always",arc:"always"};case e1:case Zy:return{arc:"always"}}}(e)[t]}const G8={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},NZ=Yi(G8,["geoshape"]);function cC(e){switch(e){case Cu:case Vc:case R0:case ey:case t1:case vx:case ib:case n1:case nb:case rb:case F0:case Zv:case e1:case Zy:return;case nC:case Jy:case Qy:case _p:case ob:case fE:case yx:case iC:case oC:case aC:return"discrete";case wp:case ry:case iy:return"flexible";case ty:case ny:case P0:case Dg:case hE:case rC:case dE:return}}function q8(e){return iE(e)&&(e=xC(e,void 0)),"bin"+ci(e).map(t=>lC(e[t])?gu(`_${t}_${Object.entries(e[t])}`):gu(`_${t}_${e[t]}`)).join("")}function Ws(e){return e===!0||pE(e)&&!e.binned}function ch(e){return e==="binned"||pE(e)&&e.binned===!0}function pE(e){return yl(e)}function lC(e){return e==null?void 0:e.selection}function $8(e){switch(e){case Jy:case Qy:case t1:case wp:case ry:case iy:case ib:case n1:case nb:case rb:case _p:return 6;case ob:return 4;default:return 10}}function IZ(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const FZ='Autosize "fit" only works for single views and layered views.';function RZ(e){return`${e=="width"?"Width":"Height"} "container" only works for single views and layered views.`}function PZ(e){return`${e=="width"?"Width":"Height"} "container" only works well with autosize "fit" or "fit-${e=="width"?"x":"y"}".`}function LZ(e){return e?`Dropping "fit-${e}" because spec has discrete ${ay(e)}.`:'Dropping "fit" because spec has discrete size.'}function BZ(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function jZ(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function zZ(e){return`The "nearest" transform is not supported for ${e} marks.`}function UZ(e){return`Selection not supported for ${e} yet.`}function WZ(e){return`Cannot find a selection named "${e}".`}const VZ="Scale bindings are currently only supported for scales with unbinned, continuous domains.",HZ="Legend bindings are only supported for selections over an individual field or encoding channel.";function GZ(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}function qZ(e){return`Unknown repeated value "${e}".`}function $Z(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const XZ="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function KZ(e){return`Unrecognized parse "${e}".`}function YZ(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function JZ(e){return`Ignoring an invalid transform: ${mu(e)}.`}const QZ='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function ZZ(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function eee(e){return`Layer's shared ${e.join(",")} channel ${e.length===1?"is":"are"} overriden.`}function tee(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${mu(t)} is overridden by a child projection ${mu(n)}.`}const nee="Arc marks uses theta channel rather than angle, replacing angle with theta.";function ree(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${mu(n)}}.`}function iee(e){return`Invalid field type "${e}".`}function oee(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function aee(e){return`Invalid aggregation operator "${e}".`}function see(e,t){return`Missing type for channel "${e}", using "${t}" instead.`}function uee(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function cee(e,t){return`Dropping ${mu(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}function lee(e,t,n){return`${e}-encoding with type ${t} is deprecated. Replacing with ${n}-encoding.`}const fee="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function dee(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function hee(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function pee(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function mee(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function gee(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function vee(e,t){return`Line mark is for continuous lines and thus cannot be used with ${e&&t?"x2 and y2":e?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function yee(e,t){return`Specified orient "${e}" overridden with "${t}".`}const bee="Custom domain scale cannot be unioned with default field-based domain.",xee=`Scale's "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.`;function wee(e){return`Cannot use the scale property "${e}" with non-color channel.`}function _ee(e){return`Using unaggregated domain with raw field has no effect (${mu(e)}).`}function Eee(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function See(e){return`Unaggregated domain is currently unsupported for log scale (${mu(e)}).`}function kee(e){return`Cannot apply size to non-oriented mark "${e}".`}function Cee(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function Aee(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function Oee(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function Tee(e,t){return`Scale type "${t}" does not work with mark "${e}".`}function Mee(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function Dee(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${mu(n)} and ${mu(i)}). Using ${mu(n)}.`}function Nee(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${mu(n)} and ${mu(i)}). Using the union of the two domains.`}function Iee(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function Fee(e){return`Dropping sort property ${mu(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const Ree="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",Pee="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",Lee="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",Bee="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.",jee="Invalid channel for axis.";function zee(e){return`Cannot stack "${e}" if there is already "${e}2".`}function Uee(e){return`Cannot stack non-linear scale (${e}).`}function Wee(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function Vee(e,t){return`Invalid ${e}: ${mu(t)}.`}function Hee(e){return`Dropping day from datetime ${mu(e)} as day cannot be combined with other units.`}function Gee(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function qee(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function $ee(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function Xee(e,t){return`Center is not needed to be specified in ${t} when extent is ${e}.`}function Kee(e){return`1D error band does not support ${e}.`}function Yee(e){return`Channel ${e} is required for "binned" bin.`}function Jee(e){return`Domain for ${e} is required for threshold scale.`}const X8=function(e,t){var n=e||0;return{level:function(i){return arguments.length?(n=+i,this):n},error:function(){return n>=1&&qk(t||"error","ERROR",arguments),this},warn:function(){return n>=2&&qk(t||"warn","WARN",arguments),this},info:function(){return n>=3&&qk(t||"log","INFO",arguments),this},debug:function(){return n>=4&&qk(t||"log","DEBUG",arguments),this}}}(2);let fC=X8;function Qee(){return fC=X8}function si(...e){fC.warn(...e)}function jw(e){if(e&&yl(e)){for(const t of p4)if(t in e)return!0}return!1}const K8=["january","february","march","april","may","june","july","august","september","october","november","december"],Zee=K8.map(e=>e.substr(0,3)),Y8=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],ete=Y8.map(e=>e.substr(0,3));function h4(e,t){const n=[];if(t&&e.day!==void 0&&ci(e).length>1&&(si(oe.droppedDay(e)),delete(e=Zo(e)).day),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const i=t?function(a){if(r4(a)&&(a=+a),wc(a))return a-1;{const f=a.toLowerCase(),g=K8.indexOf(f);if(g!==-1)return g;const x=f.substr(0,3),k=Zee.indexOf(x);if(k!==-1)return k;throw new Error(oe.invalidTimeUnit("month",a))}}(e.month):e.month;n.push(i)}else if(e.quarter!==void 0){const i=t?function(a){if(r4(a)&&(a=+a),wc(a))return a>4&&si(oe.invalidTimeUnit("quarter",a)),a-1;throw new Error(oe.invalidTimeUnit("quarter",a))}(e.quarter):e.quarter;n.push(wc(i)?3*i:i+"*3")}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const i=t?function(a){if(r4(a)&&(a=+a),wc(a))return a%7;{const f=a.toLowerCase(),g=Y8.indexOf(f);if(g!==-1)return g;const x=f.substr(0,3),k=ete.indexOf(x);if(k!==-1)return k;throw new Error(oe.invalidTimeUnit("day",a))}}(e.day):e.day;n.push(wc(i)?i+1:i+"+1")}else n.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const a=e[i];n.push(a===void 0?0:a)}return n}function mE(e){const t=h4(e,!0).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}const J8={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},p4=ci(J8);function m4(e){return e.startsWith("utc")}const tte={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function g4(e){const t=[];for(const n of p4)Q8(e,n)&&t.push(n);return t}function Q8(e,t){const n=e.indexOf(t);return!(n<0)&&!(n>0&&t==="seconds"&&e.charAt(n-1)==="i")&&!(e.length>n+3&&t==="day"&&e.charAt(n+3)==="o")&&!(n>0&&t==="year"&&e.charAt(n-1)==="f")}function nte(e,t,{end:n}={end:!1}){const i=E8(t),a=m4(e)?"utc":"";function f(k){return k==="quarter"?`(${a}quarter(${i})-1)`:`${a}${k}(${i})`}let g;const x={};for(const k of p4)Q8(e,k)&&(x[k]=f(k),g=k);return n&&(x[g]+="+1"),function(k){const F=h4(k,!1).join(", ");return k.utc?`utc(${F})`:`datetime(${F})`}(x)}function Z8(e){if(!e)return;const t=g4(e);return`timeUnitSpecifier(${oE()(t)}, ${oE()(tte)})`}function lh(e){if(!e)return;let t;return Qo(e)?t={unit:e}:yl(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),m4(t.unit)&&(t.utc=!0,t.unit=function(n){return n.substr(3)}(t.unit)),t}function Eo(e){return e&&!!e.signal}function cb(e){return!!e.step}function lb(e){return!io(e)&&"field"in e&&"data"in e}const rte=ci({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1}),ite={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},v4=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function y4(e){return e&&!!e.field&&e.equal!==void 0}function ej(e){return e&&!!e.field&&e.lt!==void 0}function tj(e){return e&&!!e.field&&e.lte!==void 0}function nj(e){return e&&!!e.field&&e.gt!==void 0}function rj(e){return e&&!!e.field&&e.gte!==void 0}function b4(e){return!!(e&&e.field&&(io(e.range)&&e.range.length===2||Eo(e.range)))}function x4(e){return e&&!!e.field&&(io(e.oneOf)||io(e.in))}function ij(e){return x4(e)||y4(e)||b4(e)||ej(e)||nj(e)||tj(e)||rj(e)}function uy(e,t){return B4(e,{timeUnit:t,wrapTime:!0})}function oj(e,t=!0){var n;const{field:i}=e,a=(n=lh(e.timeUnit))===null||n===void 0?void 0:n.unit,f=a?"time("+nte(a,i)+")":hi(e,{expr:"datum"});if(y4(e))return f+"==="+uy(e.equal,a);if(ej(e))return`${f}<${uy(e.lt,a)}`;if(nj(e))return`${f}>${uy(e.gt,a)}`;if(tj(e))return`${f}<=${uy(e.lte,a)}`;if(rj(e))return`${f}>=${uy(e.gte,a)}`;if(x4(e))return`indexof([${function(g,x){return g.map(k=>uy(k,x))}(e.oneOf,a).join(",")}], ${f}) !== -1`;if(function(g){return g&&!!g.field&&g.valid!==void 0}(e))return w4(f,e.valid);if(b4(e)){const{range:g}=e,x=Eo(g)?{signal:`${g.signal}[0]`}:g[0],k=Eo(g)?{signal:`${g.signal}[1]`}:g[1];if(x!==null&&k!==null&&t)return"inrange("+f+", ["+uy(x,a)+", "+uy(k,a)+"])";const F=[];return x!==null&&F.push(`${f} >= ${uy(x,a)}`),k!==null&&F.push(`${f} <= ${uy(k,a)}`),F.length>0?F.join(" && "):"true"}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function w4(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function ote(e){var t;return ij(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:(t=lh(e.timeUnit))===null||t===void 0?void 0:t.unit}):e}const zw={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},xx=zw.quantitative,_4=zw.ordinal,Uw=zw.temporal,E4=zw.nominal,Ww=zw.geojson,ate=ci(zw),Ec={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},S4={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},ste=ci(S4);function ute(e,t){const n=S4[e],i=S4[t];return n===i||n==="ordinal-position"&&i==="time"||i==="ordinal-position"&&n==="time"}const cte={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function aj(e){return cte[e]}const sj=["linear","log","pow","sqrt","symlog","time","utc"],lte=px(sj),fte=px(["linear","log","pow","sqrt","symlog"]),dte=px(["quantile","quantize","threshold"]),hte=px(sj.concat(["quantile","quantize","threshold","sequential","identity"])),pte=px(["ordinal","bin-ordinal","point","band"]);function Ep(e){return e in pte}function Fg(e){return e in hte}function L0(e){return e in lte}function dC(e){return e in dte}function uj(e){return e==null?void 0:e.selection}const mte={type:1,domain:1,domainMid:1,align:1,range:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},gte=Yi(mte,["type","domain","range","scheme"]),vte=ci(gte);(function(){var e;const t={};for(const n of z8)for(const i of ate)for(const a of ste){const f=yte(n,i);dj(n,a)&&fj(a,i)&&(t[f]=(e=t[f])!==null&&e!==void 0?e:[],t[f].push(a))}})();function cj(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!co(["point","band","identity"],e);case"bins":return!co(["point","band","identity","ordinal"],e);case"round":return L0(e)||e==="band"||e==="point";case"padding":return L0(e)||co(["point","band"],e);case"paddingOuter":case"align":return co(["point","band"],e);case"paddingInner":return e==="band";case"domainMid":case"clamp":return L0(e);case"nice":return L0(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return Fg(e)&&!co(["log","time","utc","threshold","quantile"],e)}}function lj(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return Bw(e)?void 0:oe.cannotUseScalePropertyWithNonColor(e);case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"reverse":case"round":case"clamp":case"zero":return}}function fj(e,t){return co([_4,E4],t)?e===void 0||Ep(e):t===Uw?co([Ec.TIME,Ec.UTC,void 0],e):t!==xx||co([Ec.LOG,Ec.POW,Ec.SQRT,Ec.SYMLOG,Ec.QUANTILE,Ec.QUANTIZE,Ec.THRESHOLD,Ec.LINEAR,void 0],e)}function dj(e,t){if(!ub(e))return!1;switch(e){case Cu:case Vc:case R0:case ey:return L0(t)||co(["band","point"],t);case t1:case ib:case n1:case nb:case rb:case vx:return L0(t)||dC(t)||co(["band","point","ordinal"],t);case wp:case ry:case iy:return t!=="band";case ob:return t==="ordinal"||dC(t);case _p:return t==="ordinal"}}function yte(e,t){return e+"_"+t}function k4(e){const{channel:t,channelDef:n,markDef:i,scale:a,config:f}=e,g=pj(e);return xi(n)&&!R8(n.aggregate)&&a&&L0(a.get("type"))&&a.get("zero")===!1?hj({fieldDef:n,channel:t,markDef:i,ref:g,config:f}):g}function hj({fieldDef:e,channel:t,markDef:n,ref:i,config:a}){return mx(n.type)||Za("invalid",n,a)===null?i:[function(f,g){const x=C4(f,!0),k=bx(g)==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:x},k)}(e,t),i]}function C4(e,t=!0){return w4(Qo(e)?e:hi(e,{expr:"datum"}),!t)}function wx(e,t,n,i){const a={};if(t&&(a.scale=t),db(e)){const{datum:f}=e;jw(f)?a.signal=mE(f):Eo(f)?a.signal=f.signal:a.value=f}else a.field=hi(e,n);if(i){const{offset:f,band:g}=i;f&&(a.offset=f),g&&(a.band=g)}return a}function hC({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:a,band:f=.5}){const g=0<f&&f<1?"datum":void 0,x=hi(t,{expr:g,suffix:a}),k=n!==void 0?hi(n,{expr:g}):hi(t,{suffix:"end",expr:g}),F={};if(f===0||f===1){F.scale=e;const V=f===0?x:k;F.field=V}else{const V=`${f} * ${x} + ${1-f} * ${k}`;F.signal=`scale("${e}", ${V})`}return i&&(F.offset=i),F}function pj({channel:e,channelDef:t,channel2Def:n,markDef:i,config:a,scaleName:f,scale:g,stack:x,offset:k,defaultRef:F,band:V}){var X;if(t){if(No(t)){if(Fm(t)){V=V??yE({channel:e,fieldDef:t,fieldDef2:n,markDef:i,stack:x,config:a,isMidPoint:!0});const{bin:se,timeUnit:he,type:ye}=t;if(Ws(se)||V&&he&&ye===Uw)return x&&x.impute?wx(t,f,{binSuffix:"mid"},{offset:k}):V?hC({scaleName:f,fieldOrDatumDef:t,band:V,offset:k}):wx(t,f,bE(t,e)?{binSuffix:"range"}:{},{offset:k});if(ch(se)){if(xi(n))return hC({scaleName:f,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:V,offset:k});{const Pe=e===Cu?F0:Zv;si(oe.channelRequiredForBinned(Pe))}}}const te=g==null?void 0:g.get("type");return wx(t,f,Ep(te)?{binSuffix:"range"}:{},{offset:k,band:te==="band"?(X=V??t.band)!==null&&X!==void 0?X:.5:void 0})}if(r1(t)){const te=t.value,se=k?{offset:k}:{};return Object.assign(Object.assign({},gE(e,te)),se)}}return QQ(F)&&(F=F()),F&&Object.assign(Object.assign({},F),k?{offset:k}:{})}function gE(e,t){return co(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:co(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:ic(t)}function _x(e){return e&&e!=="number"&&e!=="time"}function mj(e,t,n){return`${e}(${t}${n?`, ${JSON.stringify(n)}`:""})`}const bte="  ";function A4({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:a,config:f}){var g,x;if(_x(n))return O4({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:f});const k=gj(e,i,a);if(wC(e)){const F=function(V,X,te,se,he){return!X||te?(te=Qo(te)?te:se,`${he?"utc":"time"}Format(${V}, '${te}')`):function(ye,Pe,Ue){if(!ye)return;const We=Z8(ye);return`${Ue||m4(ye)?"utc":"time"}Format(${Pe}, ${We})`}(X,V,he)}(k,xi(e)?(g=lh(e.timeUnit))===null||g===void 0?void 0:g.unit:void 0,t,f.timeFormat,F4(e)&&((x=e.scale)===null||x===void 0?void 0:x.type)===Ec.UTC);return F?{signal:F}:void 0}return t=bj(fb(e),t,f),xi(e)&&Ws(e.bin)?{signal:pC(k,hi(e,{expr:i,binSuffix:"end"}),t,n,f)}:t||fb(e)==="quantitative"?{signal:`${xj(k,t)}`}:{signal:`isValid(${k}) ? ${k} : ""+${k}`}}function gj(e,t,n){return xi(e)?n?`${hi(e,{expr:t,suffix:"end"})}-${hi(e,{expr:t,suffix:"start"})}`:hi(e,{expr:t}):function(i){const{datum:a}=i;return jw(a)?mE(a):`${JSON.stringify(a)}`}(e)}function O4({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:a,config:f,field:g}){return g=g??gj(e,i,a),xi(e)&&Ws(e.bin)?{signal:pC(g,hi(e,{expr:i,binSuffix:"end"}),t,n,f)}:{signal:mj(n,g,t)}}function vj(e,t,n,i,a,f){var g;if(!_x(i))return wC(e)?function(x,k,F,V){return x||(k?{signal:Z8(k)}:V?void 0:F.timeFormat)}(n,xi(e)?(g=lh(e.timeUnit))===null||g===void 0?void 0:g.unit:void 0,a,f):bj(t,n,a)}function yj(e,t,n){return e&&(Eo(e)||e==="number"||e==="time")?e:wC(t)&&n!=="time"&&n!=="utc"?"time":void 0}function bj(e,t,n){return Qo(t)?t:e===xx?n.numberFormat:void 0}function xj(e,t){return`format(${e}, "${t||""}")`}function wj(e,t,n,i){var a;return _x(n)?mj(n,e,t):xj(e,(a=Qo(t)?t:void 0)!==null&&a!==void 0?a:i.numberFormat)}function pC(e,t,n,i,a){const f=wj(e,n,i,a),g=wj(t,n,i,a);return`${w4(e,!1)} ? "null" : ${f} + "${bte}" + ${g}`}const mC="min",xte={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function _j(e){return e in xte}function Ej(e){return!!e&&!!e.encoding}function cy(e){return!(!e||e.op!=="count"&&!e.field)}function Sj(e){return!!e&&io(e)}function vE(e){return"row"in e||"column"in e}function T4(e){return!!e&&"header"in e}function gC(e){return"facet"in e}function kj(e){const{field:t,timeUnit:n,bin:i,aggregate:a}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),i?{bin:i}:{}),a?{aggregate:a}:{}),{field:t})}function Cj(e){return Fm(e)&&"sort"in e}function yE({channel:e,fieldDef:t,fieldDef2:n,markDef:i,stack:a,config:f,isMidPoint:g}){if(No(t)&&t.band!==void 0)return t.band;if(xi(t)){const{timeUnit:x,bin:k}=t;if(x&&!n)return g?kx("timeUnitBandPosition",i,f):N8(i.type)?kx("timeUnitBand",i,f):0;if(Ws(k))return N8(i.type)&&!g?1:.5}return(a==null?void 0:a.fieldChannel)===e&&g?.5:void 0}function M4(e,t,n,i,a,f){return!!(Ws(t.bin)||t.timeUnit&&Fm(t)&&t.type==="temporal")&&!!yE({channel:e,fieldDef:t,fieldDef2:n,stack:i,markDef:a,config:f})}function D4(e){return!!e&&"condition"in e}function vC(e){const t=e&&e.condition;return!!t&&!io(t)&&xi(t)}function N4(e){const t=e&&e.condition;return!!t&&!io(t)&&No(t)}function xi(e){return!(!e||!e.field&&e.aggregate!=="count")}function fb(e){return e&&e.type}function db(e){return!!e&&"datum"in e}function ly(e){return Fm(e)&&Mj(e)||I4(e)}function I4(e){return db(e)&&wc(e.datum)}function No(e){return xi(e)||db(e)}function Fm(e){return!!e&&("field"in e&&"type"in e||e.aggregate==="count")}function r1(e){return e&&"value"in e&&"value"in e}function F4(e){return!!e&&("scale"in e||"sort"in e)}function R4(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function Aj(e){return!!e&&"legend"in e}function Oj(e){return!!e&&("format"in e||"formatType"in e)}function hi(e,t={}){var n,i,a;let f=e.field;const g=t.prefix;let x=t.suffix,k="";if(function(F){return F.aggregate==="count"}(e))f=function(F){return function(V){return V.indexOf("__")===0}(F)?F:`__${F}`}("count");else{let F;if(!t.nofn)if(function(V){return"op"in V}(e))F=e.op;else{const{bin:V,aggregate:X,timeUnit:te}=e;Ws(V)?(F=q8(V),x=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((i=t.suffix)!==null&&i!==void 0?i:"")):X?gx(X)?(k=`["${f}"]`,f=`argmax_${X.argmax}`):tb(X)?(k=`["${f}"]`,f=`argmin_${X.argmin}`):F=String(X):te&&(F=function(se){const he=lh(se),{utc:ye}=he,Pe=Yi(he,["utc"]);return Pe.unit?(ye?"utc":"")+ci(Pe).map(Ue=>gu(`${Ue==="unit"?"":`_${Ue}_`}${Pe[Ue]}`)).join(""):(ye?"utc":"")+"timeunit"+ci(Pe).map(Ue=>gu(`_${Ue}_${Pe[Ue]}`)).join("")}(te),x=(!co(["range","mid"],t.binSuffix)&&t.binSuffix||"")+((a=t.suffix)!==null&&a!==void 0?a:""))}F&&(f=f?`${F}_${f}`:F)}return x&&(f=`${f}_${x}`),g&&(f=`${g}_${f}`),t.forAs?S8(f):t.expr?function(F,V="datum"){return`${V}[${ka(dx(F).join("."))}]`}(f,t.expr)+k:eb(f)+k}function Tj(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return xi(e)&&!!e.bin;case"temporal":return!1}throw new Error(oe.invalidFieldType(e.type))}function Mj(e){return!Tj(e)}const Dj=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return function(n){const{aggregate:i,bin:a,timeUnit:f,field:g}=n;if(gx(i))return`${g} for argmax(${i.argmax})`;if(tb(i))return`${g} for argmin(${i.argmin})`;const x=lh(f),k=i||(x==null?void 0:x.unit)||(x==null?void 0:x.maxbins)&&"timeunit"||Ws(a)&&"bin";return k?k.toUpperCase()+"("+g+")":g}(e);default:return function(n,i){var a;const{field:f,bin:g,timeUnit:x,aggregate:k}=n;if(k==="count")return i.countTitle;if(Ws(g))return`${f} (binned)`;if(x){const F=(a=lh(x))===null||a===void 0?void 0:a.unit;if(F)return`${f} (${g4(F).join("-")})`}else if(k)return gx(k)?`${f} for max ${k.argmax}`:tb(k)?`${f} for min ${k.argmin}`:`${Xk(k)} of ${f}`;return f}(e,t)}};let Nj=Dj;function Ij(e){Nj=e}function Ex(e,t,{allowDisabling:n,includeDefault:i=!0}){var a,f;const g=((a=P4(e))!==null&&a!==void 0?a:{}).title;if(!xi(e))return g;const x=e,k=i?Fj(x,t):void 0;return n?_c(g,x.title,k):(f=g??x.title)!==null&&f!==void 0?f:k}function P4(e){return R4(e)&&e.axis?e.axis:Aj(e)&&e.legend?e.legend:T4(e)&&e.header?e.header:void 0}function Fj(e,t){return Nj(e,t)}function yC(e){var t;if(Oj(e)){const{format:n,formatType:i}=e;return{format:n,formatType:i}}{const n=(t=P4(e))!==null&&t!==void 0?t:{},{format:i,formatType:a}=n;return{format:i,formatType:a}}}function fy(e){return xi(e)?e:vC(e)?e.condition:void 0}function Hc(e){return No(e)?e:N4(e)?e.condition:void 0}function L4(e,t,n){if(Qo(e)||wc(e)||iE(e)){const i=Qo(e)?"string":wc(e)?"number":"boolean";return si(oe.primitiveChannelDef(t,i,e)),{value:e}}return No(e)?bC(e,t,n):N4(e)?Object.assign(Object.assign({},e),{condition:bC(e.condition,t,n)}):e}function bC(e,t,n){if(Oj(e)){const{format:i,formatType:a}=e,f=Yi(e,["format","formatType"]);if(_x(a)&&!n.customFormatTypes)return si(oe.customFormatTypeNotAllowed(t)),bC(f,t,n)}else{const i=R4(e)?"axis":Aj(e)?"legend":T4(e)?"header":null;if(i&&e[i]){const a=e[i],{format:f,formatType:g}=a,x=Yi(a,["format","formatType"]);if(_x(g)&&!n.customFormatTypes)return si(oe.customFormatTypeNotAllowed(t)),bC(Object.assign(Object.assign({},e),{[i]:x}),t,n)}}return xi(e)?Rj(e,t):function(i){let a=i.type;if(a)return i;const{datum:f}=i;return a=wc(f)?"quantitative":Qo(f)?"nominal":jw(f)?"temporal":void 0,Object.assign(Object.assign({},i),{type:a})}(e)}function Rj(e,t){const{aggregate:n,timeUnit:i,bin:a,field:f}=e,g=Object.assign({},e);if(!n||u4(n)||gx(n)||tb(n)||(si(oe.invalidAggregate(n)),delete g.aggregate),i&&(g.timeUnit=lh(i)),f&&(g.field=`${f}`),Ws(a)&&(g.bin=xC(a,t)),ch(a)&&!sy(t)&&si(`Channel ${t} should not be used with "binned" bin.`),Fm(g)){const{type:x}=g,k=function(F){if(F)switch(F=F.toLowerCase()){case"q":case xx:return"quantitative";case"t":case Uw:return"temporal";case"o":case _4:return"ordinal";case"n":case E4:return"nominal";case Ww:return"geojson"}}(x);x!==k&&(g.type=k),x!=="quantitative"&&R8(n)&&(si(oe.invalidFieldTypeForCountAggregate(x,n)),g.type="quantitative")}else if(!W8(t)){const x=function(k,F){if(k.timeUnit)return"temporal";if(Ws(k.bin))return"quantitative";switch(cC(F)){case"continuous":return"quantitative";case"discrete":case"flexible":return"nominal";default:return"quantitative"}}(g,t);si(oe.missingFieldType(t,x)),g.type=x}if(Fm(g)){const{compatible:x,warning:k}=function(F,V){const X=F.type;if(X==="geojson"&&V!=="shape")return{compatible:!1,warning:`Channel ${V} should not be used with a geojson data.`};switch(V){case Jy:case Qy:case nC:return Mj(F)?{compatible:!1,warning:oe.facetChannelShouldBeDiscrete(V)}:Sx;case Cu:case Vc:case wp:case ry:case iy:case fE:case hE:case rC:case yx:case iC:case oC:case vx:case R0:case ey:case aC:return Sx;case ny:case Dg:case ty:case P0:return X!==xx?{compatible:!1,warning:`Channel ${V} should be used with a quantitative field only, not ${F.type} field.`}:Sx;case n1:case nb:case rb:case ib:case t1:case e1:case Zy:case F0:case Zv:return X!=="nominal"||F.sort?Sx:{compatible:!1,warning:`Channel ${V} should not be used with an unsorted discrete field.`};case ob:return co(["ordinal","nominal"],F.type)?Sx:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case _p:return co(["ordinal","nominal","geojson"],F.type)?Sx:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case dE:return F.type!=="nominal"||"sort"in F?Sx:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}(g,t);x||si(k)}if(Cj(g)&&Qo(g.sort)){const{sort:x}=g;if(_j(x))return Object.assign(Object.assign({},g),{sort:{encoding:x}});const k=x.substr(1);if(x.charAt(0)==="-"&&_j(k))return Object.assign(Object.assign({},g),{sort:{encoding:k,order:"descending"}})}if(T4(g)){const{header:x}=g,{orient:k}=x,F=Yi(x,["orient"]);if(k)return Object.assign(Object.assign({},g),{header:Object.assign(Object.assign({},F),{labelOrient:x.labelOrient||k,titleOrient:x.titleOrient||k})})}return g}function xC(e,t){return iE(e)?{maxbins:$8(t)}:e==="binned"?{binned:!0}:e.maxbins||e.step?e:Object.assign(Object.assign({},e),{maxbins:$8(t)})}const Sx={compatible:!0};function wC(e){const{formatType:t}=yC(e);return t==="time"||!t&&function(n){return n&&(n.type==="temporal"||xi(n)&&!!n.timeUnit)}(e)}function B4(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:a}){var f;const g=t&&((f=lh(t))===null||f===void 0?void 0:f.unit);let x,k=g||n==="temporal";return Eo(e)?x=e.signal:jw(e)?(k=!0,x=mE(e)):(Qo(e)||wc(e))&&k&&(x=`datetime(${JSON.stringify(e)})`,function(F){return!!J8[F]}(g)&&(wc(e)&&e<1e4||Qo(e)&&isNaN(Date.parse(e)))&&(x=mE({[g]:e}))),x?i&&k?`time(${x})`:x:a?void 0:JSON.stringify(e)}function Pj(e,t){const{type:n}=e;return t.map(i=>{const a=B4(i,{timeUnit:xi(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return a!==void 0?{signal:a}:i})}function bE(e,t){return Ws(e.bin)?ub(t)&&co(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}function Lj(e){const{anchor:t,frame:n,offset:i,orient:a,color:f,subtitleColor:g,subtitleFont:x,subtitleFontSize:k,subtitleFontStyle:F,subtitleFontWeight:V,subtitleLineHeight:X,subtitlePadding:te}=e,se=Yi(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),he=Object.assign(Object.assign({},se),f?{fill:f}:{}),ye=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),i?{offset:i}:{}),a?{orient:a}:{}),Pe=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},g?{subtitleColor:g}:{}),x?{subtitleFont:x}:{}),k?{subtitleFontSize:k}:{}),F?{subtitleFontStyle:F}:{}),V?{subtitleFontWeight:V}:{}),X?{subtitleLineHeight:X}:{}),te?{subtitlePadding:te}:{});return{titleMarkConfig:he,subtitleMarkConfig:sE(he,["align","baseline","dx","dy","limit"]),nonMark:ye,subtitle:Pe}}function hb(e){return Qo(e)||io(e)&&Qo(e[0])}function ic(e){return Eo(e)?e:e!==void 0?{value:e}:void 0}function Bj(e){return Eo(e)?e.signal:ka(e.value)}function xE(e){return Eo(e)?e.signal:e==null?null:ka(e)}function jj(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function Za(e,t,n,i={}){const{vgChannel:a,ignoreVgConfig:f}=i;return a&&t[a]!==void 0?t[a]:t[e]!==void 0?t[e]:!f||a&&a!==e?kx(e,t,n,i):void 0}function kx(e,t,n,{vgChannel:i}={}){return _c(i?_C(e,t,n.style):void 0,_C(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function _C(e,t,n){return zj(e,jj(t),n)}function zj(e,t,n){let i;t=rc(t);for(const a of t){const f=n[a];f&&f[e]!==void 0&&(i=f[e])}return i}function Uj(e,t){return rc(e).reduce((n,i)=>{var a;return n.field.push(hi(i,t)),n.order.push((a=i.sort)!==null&&a!==void 0?a:"ascending"),n},{field:[],order:[]})}function Wj(e,t){const n=[...e];return t.forEach(i=>{for(const a of n)if(aE(a,i))return;n.push(i)}),n}function Vj(e,t){return aE(e,t)||!t?e:e?[...rc(e),...rc(t)].join(", "):t}function Hj(e,t){const n=e.value,i=t.value;if(n==null||i===null)return{explicit:e.explicit,value:null};if((hb(n)||Eo(n))&&(hb(i)||Eo(i)))return{explicit:e.explicit,value:Vj(n,i)};if(hb(n)||Eo(n))return{explicit:e.explicit,value:n};if(hb(i)||Eo(i))return{explicit:e.explicit,value:i};if(!(hb(n)||Eo(n)||hb(i)||Eo(i)))return{explicit:e.explicit,value:Wj(n,i)};throw new Error("It should never reach here")}function Cx(e,t){const n=e&&e[t];return!!n&&(io(n)?uE(n,i=>!!i.field):xi(n)||vC(n))}function j4(e){return uE(z8,t=>{if(Cx(e,t)){const n=e[t];if(io(n))return uE(n,i=>!!i.aggregate);{const i=fy(n);return i&&!!i.aggregate}}return!1})}function z4(e,t){const n=[],i=[],a=[],f=[],g={};return U4(e,(x,k)=>{if(xi(x)){const{field:F,aggregate:V,bin:X,timeUnit:te}=x,se=Yi(x,["field","aggregate","bin","timeUnit"]);if(V||te||X){const he=P4(x),ye=he&&he.title;let Pe=hi(x,{forAs:!0});const Ue=Object.assign(Object.assign(Object.assign({},ye?[]:{title:Ex(x,t,{allowDisabling:!0})}),se),{field:Pe});if(V){let We;if(gx(V)?(We="argmax",Pe=hi({op:"argmax",field:V.argmax},{forAs:!0}),Ue.field=`${Pe}.${F}`):tb(V)?(We="argmin",Pe=hi({op:"argmin",field:V.argmin},{forAs:!0}),Ue.field=`${Pe}.${F}`):V!=="boxplot"&&V!=="errorbar"&&V!=="errorband"&&(We=V),We){const at={op:We,as:Pe};F&&(at.field=F),f.push(at)}}else if(n.push(Pe),Fm(x)&&Ws(X)){if(i.push({bin:X,field:F,as:Pe}),n.push(hi(x,{binSuffix:"end"})),bE(x,k)&&n.push(hi(x,{binSuffix:"range"})),sy(k)){const We={field:Pe+"_end"};g[k+"2"]=We}Ue.bin="binned",W8(k)||(Ue.type=xx)}else if(te){a.push({timeUnit:te,field:F,as:Pe});const We=Fm(x)&&x.type!==Uw&&"time";We&&(k===fE||k===yx?Ue.formatType=We:function(at){return!!f4[at]}(k)?Ue.legend=Object.assign({formatType:We},Ue.legend):sy(k)&&(Ue.axis=Object.assign({formatType:We},Ue.axis)))}g[k]=Ue}else n.push(F),g[k]=e[k]}else g[k]=e[k]}),{bins:i,timeUnits:a,aggregate:f,groupby:n,encoding:g}}function wte(e,t,n){const i=t.type;return ci(e).reduce((a,f)=>{if(!U8(f))return si(oe.invalidEncodingChannel(f)),a;const g=e[f];if(f!=="angle"||i!=="arc"||e.theta||(si(oe.REPLACE_ANGLE_WITH_THETA),f=R0),!function(x,k,F){const V=DZ(k,F);if(!V)return!1;if(V==="binned"){const X=x[k===F0?Cu:Vc];return!!(xi(X)&&xi(x[k])&&ch(X.bin))}return!0}(e,f,i))return si(oe.incompatibleChannel(f,i)),a;if(f===t1&&i==="line"){const x=fy(e[f]);if(x!=null&&x.aggregate)return si(oe.LINE_WITH_VARYING_SIZE),a}if(f===wp&&(t.filled?"fill"in e:"stroke"in e))return si(oe.droppingColor("encoding",{fill:"fill"in e,stroke:"stroke"in e})),a;if(f===hE||f===dE&&!io(g)&&!r1(g)||f===yx&&io(g))g&&(a[f]=rc(g).reduce((x,k)=>(xi(k)?x.push(Rj(k,f)):si(oe.emptyFieldDef(k,f)),x),[]));else{if(f===yx&&g===null)a[f]=null;else if(!(xi(g)||db(g)||r1(g)||D4(g)||Eo(g)))return si(oe.emptyFieldDef(g,f)),a;a[f]=L4(g,f,n)}return a},{})}function U4(e,t,n){if(e)for(const i of ci(e)){const a=e[i];if(io(a))for(const f of a)t.call(n,f,i);else t.call(n,a,i)}}function Gj(e,t,n,i){return e?ci(e).reduce((a,f)=>{const g=e[f];return io(g)?g.reduce((x,k)=>t.call(i,x,k,f),a):t.call(i,a,g,f)},n):n}function qj(e,t){return ci(t).reduce((n,i)=>{switch(i){case Cu:case Vc:case iC:case aC:case oC:case F0:case Zv:case R0:case e1:case ey:case Zy:case ty:case ny:case P0:case Dg:case fE:case _p:case vx:case yx:return n;case dE:if(e==="line"||e==="trail")return n;case hE:case rC:{const a=t[i];if(io(a)||xi(a))for(const f of rc(a))f.aggregate||n.push(hi(f,{}));return n}case t1:if(e==="trail")return n;case wp:case ry:case iy:case n1:case nb:case rb:case ob:case ib:{const a=fy(t[i]);return a&&!a.aggregate&&n.push(hi(a,{})),n}}},[])}function W4(e,t,n,i=!0){return"tooltip"in n?{tooltip:n.tooltip}:{tooltip:[...e.map(({fieldPrefix:a,titlePrefix:f})=>{const g=i?` of ${t.field}`:"";return{field:a+t.field,type:t.type,title:Eo(f)?{signal:f+`"${escape(g)}"`}:f+g}}),...function(a){const f=[];for(const g of ci(a))if(Cx(a,g)){const x=a[g],k=rc(x);for(const F of k)xi(F)?f.push(F):vC(F)&&f.push(F.condition)}return f}(n)]}}function $j(e){const{axis:t,title:n,field:i}=e;return t&&t.title!==void 0?void 0:_c(n,i)}function V4(e,t,n,i,a){const{scale:f,axis:g}=n;return({partName:x,mark:k,positionPrefix:F,endPositionPrefix:V,aria:X,extraEncoding:te={}})=>{const se=$j(n);return Xj(e,x,a,X,{mark:k,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:F+"_"+n.field,type:n.type},se!==void 0?{title:se}:{}),f!==void 0?{scale:f}:{}),g!==void 0?{axis:g}:{})},Qo(V)?{[t+"2"]:{field:V+"_"+n.field}}:{}),i),te)})}}function Xj(e,t,n,i,a){const{clip:f,color:g,opacity:x}=e,k=e.type;return e[t]||e[t]===void 0&&n[t]?[Object.assign(Object.assign({},a),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),f?{clip:f}:{}),g?{color:g}:{}),x?{opacity:x}:{}),Qv(a.mark)?a.mark:{type:a.mark}),{style:`${k}-${t}`}),iE(e[t])?{}:e[t]),i===!1?{aria:i}:{})})]:[]}function Kj(e,t,n){const{encoding:i}=e,a=t==="vertical"?"y":"x",f=i[a],g=i[a+"2"],x=i[a+"Error"],k=i[a+"Error2"];return{continuousAxisChannelDef:EC(f,n),continuousAxisChannelDef2:EC(g,n),continuousAxisChannelDefError:EC(x,n),continuousAxisChannelDefError2:EC(k,n),continuousAxis:a}}function EC(e,t){if(e&&e.aggregate){const{aggregate:n}=e,i=Yi(e,["aggregate"]);return n!==t&&si(oe.errorBarContinuousAxisHasCustomizedAggregate(n,t)),i}return e}function Yj(e,t){const{mark:n,encoding:i}=e,{x:a,y:f}=i;if(ly(a)){if(ly(f)){const g=xi(a)&&a.aggregate,x=xi(f)&&f.aggregate;if(g||x!==t){if(x||g!==t){if(g===t&&x===t)throw new Error("Both x and y cannot have aggregate");return Qv(n)&&n.orient?n.orient:"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(ly(f))return"vertical";throw new Error("Need a valid continuous axis for "+t+"s")}const SC="boxplot",_te=new tC(SC,Qj);function Jj(e){return wc(e)?"tukey":e}function Qj(e,{config:t}){var n,i;const{mark:a,encoding:f,selection:g,projection:x}=e,k=Yi(e,["mark","encoding","selection","projection"]),F=Qv(a)?a:{type:a};g&&si(oe.selectionNotSupported("boxplot"));const V=(n=F.extent)!==null&&n!==void 0?n:t.boxplot.extent,X=Za("size",F,t),te=Jj(V),{transform:se,continuousAxisChannelDef:he,continuousAxis:ye,groupby:Pe,aggregate:Ue,encodingWithoutContinuousAxis:We,ticksOrient:at,boxOrient:st,customTooltipWithoutAggregatedField:lt}=function(Lr,li,Ai){const Ti=Yj(Lr,SC),{continuousAxisChannelDef:Ji,continuousAxis:Ii}=Kj(Lr,Ti,SC),Mi=Ji.field,ji=Jj(li),Co=[...Zj(Mi),{op:"median",field:Mi,as:"mid_box_"+Mi},{op:"min",field:Mi,as:(ji==="min-max"?"lower_whisker_":"min_")+Mi},{op:"max",field:Mi,as:(ji==="min-max"?"upper_whisker_":"max_")+Mi}],ca=ji==="min-max"||ji==="tukey"?[]:[{calculate:`datum["upper_box_${Mi}"] - datum["lower_box_${Mi}"]`,as:"iqr_"+Mi},{calculate:`min(datum["upper_box_${Mi}"] + datum["iqr_${Mi}"] * ${li}, datum["max_${Mi}"])`,as:"upper_whisker_"+Mi},{calculate:`max(datum["lower_box_${Mi}"] - datum["iqr_${Mi}"] * ${li}, datum["min_${Mi}"])`,as:"lower_whisker_"+Mi}],Qi=Lr.encoding,Ca=Ii,Aa=(Qi[Ca],Yi(Qi,[typeof Ca=="symbol"?Ca:Ca+""])),{customTooltipWithoutAggregatedField:es,filteredEncoding:Vs}=function(n2){const{tooltip:d1}=n2,r2=Yi(n2,["tooltip"]);if(!d1)return{filteredEncoding:n2};let wb,dh;if(io(d1)){for(const YN of d1)YN.aggregate?(wb||(wb=[]),wb.push(YN)):(dh||(dh=[]),dh.push(YN));wb&&(r2.tooltip=wb)}else d1.aggregate?r2.tooltip=d1:dh=d1;return io(dh)&&dh.length===1&&(dh=dh[0]),{customTooltipWithoutAggregatedField:dh,filteredEncoding:r2}}(Aa),{bins:Hs,timeUnits:Os,aggregate:rf,groupby:lA,encoding:KN}=z4(Vs,Ai);return{transform:[...Hs,...Os,{aggregate:[...rf,...Co],groupby:lA},...ca],groupby:lA,aggregate:rf,continuousAxisChannelDef:Ji,continuousAxis:Ii,encodingWithoutContinuousAxis:KN,ticksOrient:Ti==="vertical"?"horizontal":"vertical",boxOrient:Ti,customTooltipWithoutAggregatedField:es}}(e,V,t),{color:ct,size:Ct}=We,Et=Yi(We,["color","size"]),gn=Lr=>V4(F,ye,he,Lr,t.boxplot),An=gn(Et),wn=gn(We),$n=gn(Object.assign(Object.assign({},Et),Ct?{size:Ct}:{})),qn=W4([{fieldPrefix:te==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:te==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],he,We),er={type:"tick",color:"black",opacity:1,orient:at,invalid:null},rr=te==="min-max"?qn:W4([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],he,We),lr=[...An({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",aria:!1,extraEncoding:rr}),...An({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",aria:!1,extraEncoding:rr}),...An({partName:"ticks",mark:er,positionPrefix:"lower_whisker",aria:!1,extraEncoding:rr}),...An({partName:"ticks",mark:er,positionPrefix:"upper_whisker",aria:!1,extraEncoding:rr})],Or=[...te!=="tukey"?lr:[],...wn({partName:"box",mark:Object.assign(Object.assign({type:"bar"},X?{size:X}:{}),{orient:st,invalid:null}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",aria:!1,extraEncoding:qn}),...$n({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},yl(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),X?{size:X}:{}),{orient:at,ariaRoleDescription:"box"}),positionPrefix:"mid_box",extraEncoding:qn})];let Jr;if(te!=="min-max"){const Lr=`datum["lower_box_${he.field}"]`,li=`datum["upper_box_${he.field}"]`,Ai=`(${li} - ${Lr})`,Ti=`${Lr} - ${V} * ${Ai}`,Ji=`${li} + ${V} * ${Ai}`,Ii=`datum["${he.field}"]`,Mi={joinaggregate:Zj(he.field),groupby:Pe};let ji;te==="tukey"&&(ji={transform:[{filter:`(${Ti} <= ${Ii}) && (${Ii} <= ${Ji})`},{aggregate:[{op:"min",field:he.field,as:"lower_whisker_"+he.field},{op:"max",field:he.field,as:"upper_whisker_"+he.field},{op:"min",field:"lower_box_"+he.field,as:"lower_box_"+he.field},{op:"max",field:"upper_box_"+he.field,as:"upper_box_"+he.field},...Ue],groupby:Pe}],layer:lr});const Co=Yi(Et,["tooltip"]),{scale:ca,axis:Qi}=he,Ca=$j(he),Aa=Xj(F,"outliers",t.boxplot,!0,{transform:[{filter:`(${Ii} < ${Ti}) || (${Ii} > ${Ji})`}],mark:"point",encoding:Object.assign(Object.assign({[ye]:Object.assign(Object.assign(Object.assign({field:he.field,type:he.type},Ca!==void 0?{title:Ca}:{}),ca!==void 0?{scale:ca}:{}),Qi!==void 0?{axis:Qi}:{})},Co),lt?{tooltip:lt}:{})})[0];Aa&&ji?Jr={transform:[Mi],layer:[Aa,ji]}:Aa?(Jr=Aa).transform.unshift(Mi):ji&&(Jr=ji).transform.unshift(Mi)}return Jr?Object.assign(Object.assign({},k),{layer:[Jr,{transform:se,layer:Or}]}):Object.assign(Object.assign({},k),{transform:((i=k.transform)!==null&&i!==void 0?i:[]).concat(se),layer:Or})}function Zj(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}const H4="errorbar",Ete=new tC(H4,e9);function e9(e,{config:t}){const{transform:n,continuousAxisChannelDef:i,continuousAxis:a,encodingWithoutContinuousAxis:f,ticksOrient:g,markDef:x,outerSpec:k,tooltipEncoding:F}=t9(e,H4,t),V=V4(x,a,i,f,t.errorbar),X={type:"tick",orient:g},te=[...V({partName:"ticks",mark:X,positionPrefix:"lower",aria:!1,extraEncoding:F}),...V({partName:"ticks",mark:X,positionPrefix:"upper",aria:!1,extraEncoding:F}),...V({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar"},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:F})];return Object.assign(Object.assign(Object.assign({},k),{transform:n}),te.length>1?{layer:te}:Object.assign({},te[0]))}function Ste(e,t){const{encoding:n}=e;if(function(x){return(No(x.x)||No(x.y))&&!No(x.x2)&&!No(x.y2)&&!No(x.xError)&&!No(x.xError2)&&!No(x.yError)&&!No(x.yError2)}(n))return{orient:Yj(e,t),inputType:"raw"};const i=function(x){return No(x.x2)||No(x.y2)}(n),a=function(x){return No(x.xError)||No(x.xError2)||No(x.yError)||No(x.yError2)}(n),f=n.x,g=n.y;if(i){if(a)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const x=n.x2,k=n.y2;if(No(x)&&No(k))throw new Error(`${t} cannot have both x2 and y2`);if(No(x)){if(ly(f))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}if(No(k)){if(ly(g))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}{const x=n.xError,k=n.xError2,F=n.yError,V=n.yError2;if(No(k)&&!No(x))throw new Error(`${t} cannot have xError2 without xError`);if(No(V)&&!No(F))throw new Error(`${t} cannot have yError2 without yError`);if(No(x)&&No(F))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(No(x)){if(ly(f))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(No(F)){if(ly(g))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function t9(e,t,n){var i;const{mark:a,encoding:f,selection:g,projection:x}=e,k=Yi(e,["mark","encoding","selection","projection"]),F=Qv(a)?a:{type:a};g&&si(oe.selectionNotSupported(t));const{orient:V,inputType:X}=Ste(e,t),{continuousAxisChannelDef:te,continuousAxisChannelDef2:se,continuousAxisChannelDefError:he,continuousAxisChannelDefError2:ye,continuousAxis:Pe}=Kj(e,V,t),{errorBarSpecificAggregate:Ue,postAggregateCalculates:We,tooltipSummary:at,tooltipTitleWithFieldName:st}=function(Lr,li,Ai,Ti,Ji,Ii,Mi,ji){let Co=[],ca=[];const Qi=li.field;let Ca,Aa=!1;if(Ii==="raw"){const es=Lr.center?Lr.center:Lr.extent?Lr.extent==="iqr"?"median":"mean":ji.errorbar.center,Vs=Lr.extent?Lr.extent:es==="mean"?"stderr":"iqr";if(es==="median"!=(Vs==="iqr")&&si(oe.errorBarCenterIsUsedWithWrongExtent(es,Vs,Mi)),Vs==="stderr"||Vs==="stdev")Co=[{op:Vs,field:Qi,as:"extent_"+Qi},{op:es,field:Qi,as:"center_"+Qi}],ca=[{calculate:`datum["center_${Qi}"] + datum["extent_${Qi}"]`,as:"upper_"+Qi},{calculate:`datum["center_${Qi}"] - datum["extent_${Qi}"]`,as:"lower_"+Qi}],Ca=[{fieldPrefix:"center_",titlePrefix:Xk(es)},{fieldPrefix:"upper_",titlePrefix:n9(es,Vs,"+")},{fieldPrefix:"lower_",titlePrefix:n9(es,Vs,"-")}],Aa=!0;else{let Hs,Os,rf;Lr.center&&Lr.extent&&si(oe.errorBarCenterIsNotNeeded(Lr.extent,Mi)),Vs==="ci"?(Hs="mean",Os="ci0",rf="ci1"):(Hs="median",Os="q1",rf="q3"),Co=[{op:Os,field:Qi,as:"lower_"+Qi},{op:rf,field:Qi,as:"upper_"+Qi},{op:Hs,field:Qi,as:"center_"+Qi}],Ca=[{fieldPrefix:"upper_",titlePrefix:Ex({field:Qi,aggregate:rf,type:"quantitative"},ji,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:Ex({field:Qi,aggregate:Os,type:"quantitative"},ji,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:Ex({field:Qi,aggregate:Hs,type:"quantitative"},ji,{allowDisabling:!1})}]}}else{(Lr.center||Lr.extent)&&si(oe.errorBarCenterAndExtentAreNotNeeded(Lr.center,Lr.extent)),Ii==="aggregated-upper-lower"?(Ca=[],ca=[{calculate:`datum["${Ai.field}"]`,as:"upper_"+Qi},{calculate:`datum["${Qi}"]`,as:"lower_"+Qi}]):Ii==="aggregated-error"&&(Ca=[{fieldPrefix:"",titlePrefix:Qi}],ca=[{calculate:`datum["${Qi}"] + datum["${Ti.field}"]`,as:"upper_"+Qi}],Ji?ca.push({calculate:`datum["${Qi}"] + datum["${Ji.field}"]`,as:"lower_"+Qi}):ca.push({calculate:`datum["${Qi}"] - datum["${Ti.field}"]`,as:"lower_"+Qi}));for(const es of ca)Ca.push({fieldPrefix:es.as.substring(0,6),titlePrefix:Lw(Lw(es.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:ca,errorBarSpecificAggregate:Co,tooltipSummary:Ca,tooltipTitleWithFieldName:Aa}}(F,te,se,he,ye,X,t,n),lt=f,ct=Pe,Ct=(lt[ct],Pe==="x"?"x2":"y2"),Et=(lt[Ct],Pe==="x"?"xError":"yError"),gn=(lt[Et],Pe==="x"?"xError2":"yError2"),An=(lt[gn],Yi(lt,[typeof ct=="symbol"?ct:ct+"",typeof Ct=="symbol"?Ct:Ct+"",typeof Et=="symbol"?Et:Et+"",typeof gn=="symbol"?gn:gn+""])),{bins:wn,timeUnits:$n,aggregate:qn,groupby:er,encoding:rr}=z4(An,n),lr=[...qn,...Ue],Or=X!=="raw"?[]:er,Jr=W4(at,te,rr,st);return{transform:[...(i=k.transform)!==null&&i!==void 0?i:[],...wn,...$n,...lr.length===0?[]:[{aggregate:lr,groupby:Or}],...We],groupby:Or,continuousAxisChannelDef:te,continuousAxis:Pe,encodingWithoutContinuousAxis:rr,ticksOrient:V==="vertical"?"horizontal":"vertical",markDef:F,outerSpec:k,tooltipEncoding:Jr}}function n9(e,t,n){return Xk(e)+" "+n+" "+t}const G4="errorband",kte=new tC(G4,r9);function r9(e,{config:t}){const{transform:n,continuousAxisChannelDef:i,continuousAxis:a,encodingWithoutContinuousAxis:f,markDef:g,outerSpec:x,tooltipEncoding:k}=t9(e,G4,t),F=g,V=V4(F,a,i,f,t.errorband),X=e.encoding.x!==void 0&&e.encoding.y!==void 0;let te={type:X?"area":"rect"},se={type:X?"line":"rule"};const he=Object.assign(Object.assign({},F.interpolate?{interpolate:F.interpolate}:{}),F.tension&&F.interpolate?{tension:F.tension}:{});return X?(te=Object.assign(Object.assign(Object.assign({},te),he),{ariaRoleDescription:"errorband"}),se=Object.assign(Object.assign({},se),he)):F.interpolate?si(oe.errorBand1DNotSupport("interpolate")):F.tension&&si(oe.errorBand1DNotSupport("tension")),Object.assign(Object.assign({},x),{transform:n,layer:[...V({partName:"band",mark:te,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:k}),...V({partName:"borders",mark:se,positionPrefix:"lower",aria:!1,extraEncoding:k}),...V({partName:"borders",mark:se,positionPrefix:"upper",aria:!1,extraEncoding:k})]})}const i9={};function q4(e,t,n){const i=new tC(e,t);i9[e]={normalizer:i,parts:n}}q4(SC,Qj,["box","median","outliers","rule","ticks"]),q4(H4,e9,["ticks","rule"]),q4(G4,r9,["band","borders"]);const Cte=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],o9=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],Ate={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},Ote={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},Vw="_vgsid_",Tte={single:{on:"click",fields:[Vw],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[Vw],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function $4(e){return!(!e||e!=="legend"&&!e.legend)}function X4(e){return $4(e)&&yl(e)}function K4(e){return"concat"in e}function kC(e){return"vconcat"in e}function Y4(e){return"hconcat"in e}function dy(e){return yl(e)&&e.step!==void 0}function a9(e){return e.view||e.width||e.height}const Mte=ci({align:1,bounds:1,center:1,columns:1,spacing:1});function J4(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function CC(e,t){const n=wE(e,t);return dy(n)?n.step:Q4}function wE(e,t){var n;return _c((n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"],{step:e.step})}const Q4=20,Dte={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:Q4},mark:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},arc:{},area:{},bar:gZ,circle:{},geoshape:{},image:{},line:{},point:{},rect:vZ,rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:Tte,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},i1=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],s9={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},u9={blue:i1[0],orange:i1[1],red:i1[2],teal:i1[3],green:i1[4],yellow:i1[5],purple:i1[6],pink:i1[7],brown:i1[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function c9(e={}){const{color:t,font:n,fontSize:i}=e,a=Yi(e,["color","font","fontSize"]);return g8({},Dte,n?function(f){return{text:{font:f},style:{"guide-label":{font:f},"guide-title":{font:f},"group-title":{font:f},"group-subtitle":{font:f}}}}(n):{},t?function(f={}){return{signals:[{name:"color",value:yl(f)?Object.assign(Object.assign({},u9),f):u9}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(t):{},i?function(f){return{signals:[{name:"fontSize",value:yl(f)?Object.assign(Object.assign({},s9),f):s9}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}(i):{},a||{})}const Nte=["view",...I8],Ite=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],Fte=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]});function Rte(e){e=Zo(e);for(const t of Ite)delete e[t];if(e.axis)for(const t in e.axis)i4(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of Cte)delete e.legend[t];if(e.mark){for(const t of F8)delete e.mark[t];e.mark.tooltip&&yl(e.mark.tooltip)&&delete e.mark.tooltip}for(const t of Nte){for(const i of F8)delete e[t][i];const n=Fte[t];if(n)for(const i of n)delete e[t][i];Pte(e,t)}for(const t of ci(i9))delete e[t];(function(t){const{titleMarkConfig:n,subtitleMarkConfig:i,subtitle:a}=Lj(t.title);As(n)||(t.style["group-title"]=Object.assign(Object.assign({},t.style["group-title"]),n)),As(i)||(t.style["group-subtitle"]=Object.assign(Object.assign({},t.style["group-subtitle"]),i)),As(a)?delete t.title:t.title=a})(e);for(const t in e)yl(e[t])&&As(e[t])&&delete e[t];return As(e)?void 0:e}function Pte(e,t,n,i){const a=i?e[t][i]:e[t];t==="view"&&(n="cell");const f=Object.assign(Object.assign({},a),e.style[n??t]);As(f)||(e.style[n??t]=f),i||delete e[t]}function AC(e){return"layer"in e}class l9{map(t,n){return gC(t)?this.mapFacet(t,n):function(i){return"repeat"in i}(t)?this.mapRepeat(t,n):Y4(t)?this.mapHConcat(t,n):kC(t)?this.mapVConcat(t,n):K4(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(AC(t))return this.mapLayer(t,n);if(Yy(t))return this.mapUnit(t,n);throw new Error(oe.invalidSpec(t))}mapLayer(t,n){return Object.assign(Object.assign({},t),{layer:t.layer.map(i=>this.mapLayerOrUnit(i,n))})}mapHConcat(t,n){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map(i=>this.map(i,n))})}mapVConcat(t,n){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map(i=>this.map(i,n))})}mapConcat(t,n){const{concat:i}=t,a=Yi(t,["concat"]);return Object.assign(Object.assign({},a),{concat:i.map(f=>this.map(f,n))})}mapFacet(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}mapRepeat(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}}const Lte={zero:1,center:1,normalize:1},Bte=new Set([T8,Jk,Yk,eC,Zk,a4,s4,Qk,M8,o4]),jte=new Set([Jk,Yk,T8]);function f9(e,t){var n,i;const a=t==="x"?"y":"radius",f=e[t],g=e[a];if(xi(f)&&xi(g))if(fb(f)==="quantitative"&&fb(g)==="quantitative"){if(f.stack)return t;if(g.stack)return a;const x=xi(f)&&!!f.aggregate;if(x!==(xi(g)&&!!g.aggregate))return x?t:a;{const k=(n=f.scale)===null||n===void 0?void 0:n.type,F=(i=g.scale)===null||i===void 0?void 0:i.type;if(k&&k!=="linear")return a;if(F&&F!=="linear")return t}}else{if(fb(f)==="quantitative")return t;if(fb(g)==="quantitative")return a}else{if(fb(f)==="quantitative")return t;if(fb(g)==="quantitative")return a}}function d9(e,t,n={}){const i=Qv(e)?e.type:e;if(!Bte.has(i))return null;const a=f9(t,"x")||f9(t,"theta");if(!a)return null;const f=t[a],g=xi(f)?hi(f,{}):void 0;let x=function(te){switch(te){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(a),k=t[x],F=xi(k)?hi(k,{}):void 0;F===g&&(F=void 0,k=void 0,x=void 0);const V=OZ.reduce((te,se)=>{if(se!=="tooltip"&&Cx(t,se)){const he=t[se];for(const ye of rc(he)){const Pe=fy(ye);if(Pe.aggregate)continue;const Ue=hi(Pe,{});Ue&&Ue===F||te.push({channel:se,fieldDef:Pe})}}return te},[]);let X;if(f.stack!==void 0?X=iE(f.stack)?f.stack?"zero":null:f.stack:V.length>0&&jte.has(i)&&(X="zero"),!X||!function(te){return te in Lte}(X)||j4(t)&&V.length===0)return null;if(f.scale&&f.scale.type&&f.scale.type!==Ec.LINEAR){if(n.disallowNonLinearStack)return null;si(oe.cannotStackNonLinearScale(f.scale.type))}return No(t[oy(a)])?(f.stack!==void 0&&si(oe.cannotStackRangedMark(a)),null):(xi(f)&&f.aggregate&&!co(wZ,f.aggregate)&&si(oe.stackNonSummativeAggregate(f.aggregate)),{groupbyChannel:k?x:void 0,groupbyField:F,fieldChannel:a,impute:f.impute!==null&&mx(i),stackBy:V,offset:X})}function Z4(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?yl(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?yl(t.point)?t.point:{}:void 0}function h9(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class zte{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(Yy(t)){const{mark:i,encoding:a}=t,f=Qv(i)?i:{type:i};switch(f.type){case"line":case"rule":case"trail":return!!Z4(f,n[f.type],a);case"area":return!!Z4(f,n[f.type],a)||!!h9(f,n[f.type])}}return!1}run(t,n,i){const{config:a}=n,{selection:f,projection:g,encoding:x,mark:k}=t,F=Yi(t,["selection","projection","encoding","mark"]),V=Qv(k)?k:{type:k},X=Z4(V,a[V.type],x),te=V.type==="area"&&h9(V,a[V.type]),se=[Object.assign(Object.assign({},f?{selection:f}:{}),{mark:function(Pe){const Ue=Yi(Pe,["point","line"]);return ci(Ue).length>1?Ue:Ue.type}(Object.assign(Object.assign({},V.type==="area"&&V.opacity===void 0&&V.fillOpacity===void 0?{opacity:.7}:{}),V)),encoding:Ky(x,["shape"])})],he=d9(V,x);let ye=x;if(he){const{fieldChannel:Pe,offset:Ue}=he;ye=Object.assign(Object.assign({},x),{[Pe]:Object.assign(Object.assign({},x[Pe]),Ue?{stack:Ue}:{})})}return te&&se.push(Object.assign(Object.assign({},g?{projection:g}:{}),{mark:Object.assign(Object.assign({type:"line"},sE(V,["clip","interpolate","tension","tooltip"])),te),encoding:ye})),X&&se.push(Object.assign(Object.assign({},g?{projection:g}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},sE(V,["clip","tooltip"])),X),encoding:ye})),i(Object.assign(Object.assign({},F),{layer:se}),Object.assign(Object.assign({},n),{config:function(Pe){for(const Ue of["line","area","rule","trail"])Pe[Ue]&&(Pe=Object.assign(Object.assign({},Pe),{[Ue]:Ky(Pe[Ue],["point","line"])}));return Pe}(a)}))}}class Ute{constructor(){this.name="RangeStep"}hasMatchingType(t){var n;if(Yy(t)&&t.encoding)for(const i of Ig){const a=t.encoding[i];if(a&&No(a)&&(!((n=a==null?void 0:a.scale)===null||n===void 0)&&n.rangeStep))return!0}return!1}run(t){var n;const i={};let a=Object.assign({},t.encoding);for(const f of Ig){const g=ay(f),x=a[f];if(x&&No(x)&&(!((n=x==null?void 0:x.scale)===null||n===void 0)&&n.rangeStep)){const{scale:k}=x,F=Yi(x,["scale"]),V=k,X=Yi(V,["rangeStep"]);i[g]={step:k.rangeStep},si(oe.RANGE_STEP_DEPRECATED),a=Object.assign(Object.assign({},a),{[f]:Object.assign(Object.assign({},F),As(X)?{}:{scale:X})})}}return Object.assign(Object.assign(Object.assign({},i),t),{encoding:a})}}function eN(e,t){return t?v9(e,t):e}function tN(e,t,n){const i=t[e];return function(a){return a&&!Qo(a)&&"repeat"in a}(i)?i.repeat in n?Object.assign(Object.assign({},t),{[e]:n[i.repeat]}):void si(oe.noSuchRepeatedValue(i.repeat)):t}function p9(e,t){if((e=tN("field",e,t))!==void 0){if(e===null)return null;if(Cj(e)&&cy(e.sort)){const n=tN("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function m9(e,t){if(xi(e))return p9(e,t);{const n=tN("datum",e,t);return n===e||n.type||(n.type="nominal"),n}}function g9(e,t){if(!No(e)){if(N4(e)){const n=m9(e.condition,t);return n?Object.assign(Object.assign({},e),{condition:n}):Yi(e,["condition"])}return e}{const n=m9(e,t);if(n)return n;if(D4(e))return{condition:e.condition}}}function v9(e,t){const n={};for(const i in e)if(hx(e,i)){const a=e[i];if(io(a))n[i]=a.map(f=>g9(f,t)).filter(f=>f);else{const f=g9(a,t);f!==void 0&&(n[i]=f)}}return n}class Wte{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(Yy(t)){const{encoding:n,mark:i}=t;if(i==="line")for(const a of AZ){const f=n[bx(a)];if(n[a]&&(xi(f)&&!ch(f.bin)||db(f)))return!0}}return!1}run(t,n,i){const{encoding:a}=t;return si(oe.lineWithRange(!!a.x2,!!a.y2)),i(Object.assign(Object.assign({},t),{mark:"rule"}),n)}}function y9(e){const{parentEncoding:t,encoding:n}=e;if(t&&n){const a=ci(t).reduce((f,g)=>(n[g]&&f.push(g),f),[]);a.length>0&&si(oe.encodingOverridden(a))}const i=Object.assign(Object.assign({},t??{}),n??{});return As(i)?void 0:i}function b9(e){const{parentProjection:t,projection:n}=e;return t&&n&&si(oe.projectionOverridden({parentProjection:t,projection:n})),n??t}function x9(e,t){t===void 0&&(t=c9(e.config));const n=function(g,x={}){return Vte.map(g,{config:x})}(e,t),{width:i,height:a}=e,f=function(g,x,k){let{width:F,height:V}=x;const X=Yy(g)||AC(g),te={};X?F=="container"&&V=="container"?(te.type="fit",te.contains="padding"):F=="container"?(te.type="fit-x",te.contains="padding"):V=="container"&&(te.type="fit-y",te.contains="padding"):(F=="container"&&(si(oe.containerSizeNonSingle("width")),F=void 0),V=="container"&&(si(oe.containerSizeNonSingle("height")),V=void 0));const se=Object.assign(Object.assign(Object.assign({type:"pad"},te),k?w9(k.autosize):{}),w9(g.autosize));if(se.type!=="fit"||X||(si(oe.FIT_NON_SINGLE),se.type="pad"),F=="container"&&se.type!="fit"&&se.type!="fit-x"&&si(oe.containerSizeNotCompatibleWithAutosize("width")),V=="container"&&se.type!="fit"&&se.type!="fit-y"&&si(oe.containerSizeNotCompatibleWithAutosize("height")),!aE(se,{type:"pad"}))return se}(n,{width:i,height:a,autosize:e.autosize},t);return Object.assign(Object.assign({},n),f?{autosize:f}:{})}const Vte=new class extends l9{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[_te,Ete,kte,new zte,new Wte,new Ute]}map(e,t){if(Yy(e)){const n=Cx(e.encoding,Jy),i=Cx(e.encoding,Qy),a=Cx(e.encoding,nC);if(n||i||a)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:i}=t,a=Object.assign(Object.assign({},e),{encoding:eN(e.encoding,t.repeater)});if(n||i)return this.mapUnitWithParentEncodingOrProjection(a,t);const f=this.mapLayerOrUnit.bind(this);for(const g of this.nonFacetUnitNormalizers)if(g.hasMatchingType(a,t.config))return g.run(a,t,f);return a}mapRepeat(e,t){return function(n){return!io(n.repeat)&&n.repeat.layer}(e)?this.mapLayerRepeat(e,t):this.mapNonLayerRepeat(e,t)}mapLayerRepeat(e,t){const{repeat:n,spec:i}=e,a=Yi(e,["repeat","spec"]),{row:f,column:g,layer:x}=n,{repeater:k={},repeaterPrefix:F=""}=t;return f||g?this.mapRepeat(Object.assign(Object.assign({},e),{repeat:Object.assign(Object.assign({},f?{row:f}:{}),g?{column:g}:{}),spec:{repeat:{layer:x},spec:i}}),t):Object.assign(Object.assign({},a),{layer:x.map(V=>{const X=Object.assign(Object.assign({},k),{layer:V}),te=(i.name||"")+F+`child__layer_${gu(V)}`,se=this.mapLayerOrUnit(i,Object.assign(Object.assign({},t),{repeater:X,repeaterPrefix:te}));return se.name=te,se})})}mapNonLayerRepeat(e,t){var n;const{repeat:i,spec:a,data:f}=e,g=Yi(e,["repeat","spec","data"]);!io(i)&&e.columns&&(e=Ky(e,["columns"]),si(oe.columnsNotSupportByRowCol("repeat")));const x=[],{repeater:k={},repeaterPrefix:F=""}=t,V=!io(i)&&i.row||[k?k.row:null],X=!io(i)&&i.column||[k?k.column:null],te=io(i)&&i||[k?k.repeat:null];for(const he of te)for(const ye of V)for(const Pe of X){const Ue={repeat:he,row:ye,column:Pe,layer:k.layer},We=(a.name||"")+F+"child__"+(io(i)?`${gu(he)}`:(i.row?`row_${gu(ye)}`:"")+(i.column?`column_${gu(Pe)}`:"")),at=this.map(a,Object.assign(Object.assign({},t),{repeater:Ue,repeaterPrefix:We}));at.name=We,x.push(Ky(at,["data"]))}const se=io(i)?e.columns:i.column?i.column.length:1;return Object.assign(Object.assign({data:(n=a.data)!==null&&n!==void 0?n:f,align:"all"},g),{columns:se,concat:x})}mapFacet(e,t){const{facet:n}=e;return vE(n)&&e.columns&&(e=Ky(e,["columns"]),si(oe.columnsNotSupportByRowCol("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:i}=e,{parentEncoding:a,parentProjection:f,config:g}=t,x=b9({parentProjection:f,projection:i}),k=y9({parentEncoding:a,encoding:eN(n,t.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),x?{projection:x}:{}),k?{encoding:k}:{}),{config:g})}mapFacetedUnit(e,t){const n=e.encoding,{row:i,column:a,facet:f}=n,g=Yi(n,["row","column","facet"]),{mark:x,width:k,projection:F,height:V,view:X,selection:te,encoding:se}=e,he=Yi(e,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:ye,layout:Pe}=this.getFacetMappingAndLayout({row:i,column:a,facet:f},t),Ue=eN(g,t.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},he),Pe),{facet:ye,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},k?{width:k}:{}),V?{height:V}:{}),X?{view:X}:{}),F?{projection:F}:{}),{mark:x,encoding:Ue}),te?{selection:te}:{})}),t)}getFacetMappingAndLayout(e,t){var n;const{row:i,column:a,facet:f}=e;if(i||a){f&&si(oe.facetChannelDropped([...i?[Jy]:[],...a?[Qy]:[]]));const g={},x={};for(const k of[Jy,Qy]){const F=e[k];if(F){const V=Yi(F,["align","center","spacing","columns"]);g[k]=V;for(const X of["align","center","spacing"])F[X]!==void 0&&(x[X]=(n=x[X])!==null&&n!==void 0?n:{},x[X][k]=F[X])}}return{facetMapping:g,layout:x}}{const{align:g,center:x,spacing:k,columns:F}=f;return{facetMapping:function(V,X){return X?vE(V)?v9(V,X):p9(V,X):V}(Yi(f,["align","center","spacing","columns"]),t.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},g?{align:g}:{}),x?{center:x}:{}),k?{spacing:k}:{}),F?{columns:F}:{})}}}mapLayer(e,t){var{parentEncoding:n,parentProjection:i}=t,a=Yi(t,["parentEncoding","parentProjection"]);const{encoding:f,projection:g}=e,x=Yi(e,["encoding","projection"]),k=Object.assign(Object.assign({},a),{parentEncoding:y9({parentEncoding:n,encoding:f}),parentProjection:b9({parentProjection:i,projection:g})});return super.mapLayer(x,k)}};function w9(e){return Qo(e)?{type:e}:e??{}}const Hte=["background","padding"];function _9(e){return Hte.reduce((t,n)=>(e&&e[n]!==void 0&&(t[n]=e[n]),t),{})}class o1{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new o1(Zo(this.explicit),Zo(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return _c(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,n){n.value!==void 0&&this.set(t,n.value,n.explicit)}set(t,n,i){return delete this[i?"implicit":"explicit"][t],this[i?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,n){n.explicit[t]!==void 0?this.set(t,n.explicit[t],!0):n.implicit[t]!==void 0&&this.set(t,n.implicit[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of ci(t.combine())){const i=t.getWithExplicit(n);this.setWithExplicit(n,i)}}}function Ax(e){return{explicit:!0,value:e}}function B0(e){return{explicit:!1,value:e}}function E9(e){return(t,n,i,a)=>{const f=e(t.value,n.value);return f>0?t:f<0?n:OC(t,n,i,a)}}function OC(e,t,n,i){return e.explicit&&t.explicit&&si(oe.mergeConflictingProperty(n,i,e.value,t.value)),e}function pb(e,t,n,i,a=OC){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:aE(e.value,t.value)?e:a(e,t,n,i)}class Gte extends o1{constructor(t={},n={},i=!1){super(t,n),this.explicit=t,this.implicit=n,this.parseNothing=i}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function _E(e){return"url"in e}function TC(e){return"values"in e}function S9(e){return"name"in e&&!_E(e)&&!TC(e)&&!Ox(e)}function Ox(e){return e&&(k9(e)||C9(e)||nN(e))}function k9(e){return"sequence"in e}function C9(e){return"sphere"in e}function nN(e){return"graticule"in e}const Kf="main",MC="raw";function A9(e){return"filter"in e}function qte(e){return"lookup"in e}function $te(e){return"pivot"in e}function Xte(e){return"density"in e}function Kte(e){return"quantile"in e}function Yte(e){return"regression"in e}function Jte(e){return"loess"in e}function Qte(e){return"sample"in e}function Zte(e){return"window"in e}function ene(e){return"joinaggregate"in e}function tne(e){return"flatten"in e}function nne(e){return"calculate"in e}function rne(e){return"bin"in e}function ine(e){return"impute"in e}function one(e){return"timeUnit"in e}function ane(e){return"aggregate"in e}function sne(e){return"stack"in e}function une(e){return"fold"in e}function cne(e){return e.map(t=>A9(t)?{filter:function n(i,a){return t4(i)?{not:n(i.not,a)}:e4(i)?{and:i.and.map(f=>n(f,a))}:ZD(i)?{or:i.or.map(f=>n(f,a))}:a(i)}(t.filter,ote)}:t)}function EE(e,t,n,i){const a=D4(t)&&t.condition,f=i(t);return a?{[n]:[...rc(a).map(g=>{const x=i(g),k=function(F){return F.selection}(g)?fz(e,g.selection):WC(e,g.test);return Object.assign({test:k},x)}),...f!==void 0?[f]:[]]}:f!==void 0?{[n]:f}:{}}function rN(e,t="text"){const n=e.encoding[t];return EE(e,n,t,i=>DC(i,e.config))}function DC(e,t,n="datum"){if(e){if(r1(e))return ic(e.value);if(No(e)){const{format:i,formatType:a}=yC(e);return A4({fieldOrDatumDef:e,format:i,formatType:a,expr:n,config:t})}}}function O9(e,t={}){const{encoding:n,markDef:i,config:a,stack:f}=e,g=n.tooltip;if(io(g))return{tooltip:M9({tooltip:g},f,a,t)};{const x=t.reactiveGeom?"datum.datum":"datum";return EE(e,g,"tooltip",k=>{const F=DC(k,a,x);if(F)return F;if(k===null)return;let V=Za("tooltip",i,a);return V===!0&&(V={content:"encoding"}),Qo(V)?{value:V}:yl(V)?V.content==="encoding"?M9(n,f,a,t):{signal:x}:void 0})}}function T9(e,t,n,{reactiveGeom:i}={}){const a={},f=i?"datum.datum":"datum",g=[];function x(F,V){const X=bx(V),te=Fm(F)?F:Object.assign(Object.assign({},F),{type:e[X].type}),se=rc(Ex(te,n,{allowDisabling:!1})).join(", ");let he;if(sy(V)){const ye=V==="x"?"x2":"y2",Pe=fy(e[ye]);if(ch(te.bin)&&Pe){const Ue=hi(te,{expr:f}),We=hi(Pe,{expr:f}),{format:at,formatType:st}=yC(te);he=pC(Ue,We,at,st,n),a[ye]=!0}else if(t&&t.fieldChannel===V&&t.offset==="normalize"){const{format:Ue,formatType:We}=yC(te);he=A4({fieldOrDatumDef:te,format:Ue,formatType:We,expr:f,config:n,normalizeStack:!0}).signal}}he=he??DC(te,n,f).signal,g.push({channel:V,key:se,value:he})}U4(e,(F,V)=>{xi(F)?x(F,V):vC(F)&&x(F.condition,V)});const k={};for(const{channel:F,key:V,value:X}of g)a[F]||k[V]||(k[ka(V)]=X);return k}function M9(e,t,n,{reactiveGeom:i}={}){const a=_8(T9(e,t,n,{reactiveGeom:i})).map(({key:f,value:g})=>`${f}: ${g}`);return a.length>0?{signal:`{${a.join(", ")}}`}:void 0}function lne(e){const{markDef:t,config:n}=e,i=Za("aria",t,n);return i===!1?{}:Object.assign(Object.assign(Object.assign({},i?{aria:i}:{}),function(a){const{mark:f,markDef:g,config:x}=a;if(x.aria===!1)return{};const k=Za("ariaRoleDescription",g,x);return k!=null?{ariaRoleDescription:{value:k}}:f in ite?{}:{ariaRoleDescription:{value:f}}}(e)),function(a){const{encoding:f,markDef:g,config:x,stack:k}=a,F=f.description;if(F)return EE(a,F,"description",te=>DC(te,a.config));const V=Za("description",g,x);if(V!=null)return{description:ic(V)};if(x.aria===!1)return{};const X=T9(f,k,x);if(!As(X))return{description:{signal:_8(X).map(({key:te,value:se})=>`${te} + ": " + (${se})`).join(' + "; " + ')}}}(e))}function bl(e,t,n={}){const{markDef:i,encoding:a,config:f}=t,{vgChannel:g}=n;let{defaultRef:x,defaultValue:k}=n;x===void 0&&(k=k??Za(e,i,f,{vgChannel:g,ignoreVgConfig:!0}))!==void 0&&(x=ic(k));const F=a[e];return EE(t,F,g??e,V=>pj({channel:e,channelDef:V,markDef:i,config:f,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:x}))}function D9(e,t={filled:void 0}){var n,i,a,f;const{markDef:g,encoding:x,config:k}=e,{type:F}=g,V=(n=t.filled)!==null&&n!==void 0?n:Za("filled",g,k),X=co(["bar","point","circle","square","geoshape"],F)?"transparent":void 0,te=(a=(i=Za(V===!0?"color":void 0,g,k,{vgChannel:"fill"}))!==null&&i!==void 0?i:k.mark[V===!0&&"color"])!==null&&a!==void 0?a:X,se=(f=Za(V===!1?"color":void 0,g,k,{vgChannel:"stroke"}))!==null&&f!==void 0?f:k.mark[V===!1&&"color"],he=V?"fill":"stroke",ye=Object.assign(Object.assign({},te?{fill:ic(te)}:{}),se?{stroke:ic(se)}:{});return g.color&&(V?g.fill:g.stroke)&&si(oe.droppingColor("property",{fill:"fill"in g,stroke:"stroke"in g})),Object.assign(Object.assign(Object.assign(Object.assign({},ye),bl("color",e,{vgChannel:he,defaultValue:V?te:se})),bl("fill",e,{defaultValue:x.fill?te:void 0})),bl("stroke",e,{defaultValue:x.stroke?se:void 0}))}function NC(e,t){const n=t[function(i){switch(i){case Cu:return"xOffset";case Vc:return"yOffset";case F0:return"x2Offset";case Zv:return"y2Offset";case R0:return"thetaOffset";case ey:return"radiusOffset";case e1:return"theta2Offset";case Zy:return"radius2Offset"}}(e)];if(n)return n}function Yf(e,t,{defaultPos:n,vgChannel:i,isMidPoint:a}){const{encoding:f,markDef:g,config:x,stack:k}=t,F=f[e],V=f[oy(e)],X=t.scaleName(e),te=t.getScaleComponent(e),se=NC(e,g),he=iN({model:t,defaultPos:n,channel:e,scaleName:X,scale:te}),ye=!F&&sy(e)&&(f.latitude||f.longitude)?{field:t.getName(e)}:function(Pe){const{channel:Ue,channelDef:We,isMidPoint:at,scaleName:st,stack:lt,offset:ct,markDef:Ct,config:Et}=Pe;if(No(We)&&lt&&Ue===lt.fieldChannel){if(xi(We)){const gn=yE({channel:Ue,fieldDef:We,isMidPoint:at,markDef:Ct,stack:lt,config:Et});if(gn!==void 0)return hC({scaleName:st,fieldOrDatumDef:We,startSuffix:"start",band:gn,offset:ct})}return wx(We,st,{suffix:"end"},{offset:ct})}return k4(Pe)}({channel:e,channelDef:F,channel2Def:V,markDef:g,config:x,isMidPoint:a,scaleName:X,scale:te,stack:k,offset:se,defaultRef:he});return ye?{[i||e]:ye}:void 0}function iN({model:e,defaultPos:t,channel:n,scaleName:i,scale:a}){const{markDef:f,config:g}=e;return()=>{const x=bx(n),k=ab(n),F=Za(n,f,g,{vgChannel:k});if(F!==void 0)return gE(n,F);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){const V=a.get("type");if(!co([Ec.LOG,Ec.TIME,Ec.UTC],V)){if(a.domainDefinitelyIncludesZero())return{scale:i,value:0}}}if(t==="zeroOrMin")return x==="y"?{field:{group:"height"}}:{value:0};switch(x){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const V=e[ay(n)];return Object.assign(Object.assign({},V),{mult:.5})}}}}const fne={left:"x",center:"xc",right:"x2"},dne={top:"y",middle:"yc",bottom:"y2"};function N9(e,t,n,i="middle"){if(e==="radius"||e==="theta")return ab(e);const a=Za(e==="x"?"align":"baseline",t,n);return e==="x"?fne[a||(i==="top"?"left":"center")]:dne[a||i]}function IC(e,t,{defaultPos:n,defaultPos2:i,range:a}){return a?I9(e,t,{defaultPos:n,defaultPos2:i}):Yf(e,t,{defaultPos:n})}function I9(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:a,config:f}=t,g=oy(e),x=ay(e),k=function(V,X,te){const{encoding:se,mark:he,markDef:ye,stack:Pe,config:Ue}=V,We=bx(te),at=ay(te),st=ab(te),lt=se[We],ct=V.scaleName(We),Ct=V.getScaleComponent(We),Et=NC(te in se||te in ye?te:We,V.markDef);if(!lt&&(te==="x2"||te==="y2")&&(se.latitude||se.longitude))return{[st]:{field:V.getName(te)}};const gn=function({channel:An,channelDef:wn,channel2Def:$n,markDef:qn,config:er,scaleName:rr,scale:lr,stack:Or,offset:Jr,defaultRef:Lr}){return No(wn)&&Or&&An.charAt(0)===Or.fieldChannel.charAt(0)?wx(wn,rr,{suffix:"start"},{offset:Jr}):k4({channel:An,channelDef:$n,scaleName:rr,scale:lr,stack:Or,markDef:qn,config:er,offset:Jr,defaultRef:Lr})}({channel:te,channelDef:lt,channel2Def:se[te],markDef:ye,config:Ue,scaleName:ct,scale:Ct,stack:Pe,offset:Et,defaultRef:void 0});return gn!==void 0?{[st]:gn}:FC(te,ye)||FC(te,{[te]:_C(te,ye,Ue.style),[at]:_C(at,ye,Ue.style)})||FC(te,Ue[he])||FC(te,Ue.mark)||{[st]:iN({model:V,defaultPos:X,channel:te,scaleName:ct,scale:Ct})()}}(t,i,g),F=k[x]?N9(e,a,f):ab(e);return Object.assign(Object.assign({},Yf(e,t,{defaultPos:n,vgChannel:F})),k)}function FC(e,t){const n=ay(e),i=ab(e);return t[i]!==void 0?{[i]:gE(e,t[i])}:t[e]!==void 0?{[i]:gE(e,t[e])}:t[n]?{[n]:gE(e,t[n])}:void 0}function mb(e,t,n){var i,a,f,g;const{config:x,encoding:k,markDef:F,stack:V}=e,X=oy(t),te=ay(t),se=k[t],he=k[X],ye=e.getScaleComponent(t),Pe=ye?ye.get("type"):void 0,Ue=e.scaleName(t),We=F.orient,at=(a=(i=k[te])!==null&&i!==void 0?i:k.size)!==null&&a!==void 0?a:Za("size",F,x,{vgChannel:te}),st=n==="bar"&&(t==="x"?We==="vertical":We==="horizontal");if(xi(se)&&(Ws(se.bin)||ch(se.bin)||se.timeUnit&&!he)&&!at&&!Ep(Pe)){const lt=yE({channel:t,fieldDef:se,stack:V,markDef:F,config:x}),ct=(f=e.component.axes[t])===null||f===void 0?void 0:f[0];return function({fieldDef:Ct,fieldDef2:Et,channel:gn,band:An,scaleName:wn,markDef:$n,spacing:qn=0,axisTranslate:er,reverse:rr,config:lr}){const Or=oy(gn),Jr=ab(gn),Lr=ab(Or),li=NC(gn,$n);if(Ws(Ct.bin)||Ct.timeUnit)return{[Lr]:F9({channel:gn,fieldDef:Ct,scaleName:wn,markDef:$n,band:(1-An)/2,offset:SE(Or,qn,rr,er,li),config:lr}),[Jr]:F9({channel:gn,fieldDef:Ct,scaleName:wn,markDef:$n,band:1-(1-An)/2,offset:SE(gn,qn,rr,er,li),config:lr})};if(ch(Ct.bin)){const Ai=wx(Ct,wn,{},{offset:SE(Or,qn,rr,er,li)});if(xi(Et))return{[Lr]:Ai,[Jr]:wx(Et,wn,{},{offset:SE(gn,qn,rr,er,li)})};if(pE(Ct.bin)&&Ct.bin.step)return{[Lr]:Ai,[Jr]:{signal:`scale("${wn}", ${hi(Ct,{expr:"datum"})} + ${Ct.bin.step})`,offset:SE(gn,qn,rr,er,li)}}}return void si(oe.channelRequiredForBinned(Or))}({fieldDef:se,fieldDef2:he,channel:t,markDef:F,scaleName:Ue,band:lt,axisTranslate:(g=ct==null?void 0:ct.get("translate"))!==null&&g!==void 0?g:.5,spacing:sy(t)?Za("binSpacing",F,x):void 0,reverse:ye.get("reverse"),config:x})}return(No(se)&&Ep(Pe)||st)&&!he?function(lt,ct,Ct,Et){var gn;const{markDef:An,encoding:wn,config:$n,stack:qn}=Et,er=An.orient,rr=Et.scaleName(Ct),lr=Et.getScaleComponent(Ct),Or=ay(Ct),Jr=oy(Ct),Lr=er==="horizontal"&&Ct==="y"||er==="vertical"&&Ct==="x",li=Za(Lr?"size":Or,An,$n,{vgChannel:Or});let Ai;(wn.size||li!==void 0)&&(Lr?Ai=bl("size",Et,{vgChannel:Or,defaultValue:li}):si(oe.cannotApplySizeToNonOrientedMark(An.type)));const Ti=(gn=No(ct)?yE({channel:Ct,fieldDef:ct,markDef:An,stack:qn,config:$n}):void 0)!==null&&gn!==void 0?gn:1;Ai=Ai||{[Or]:function(Co,ca,Qi,Ca,Aa,es){if(Ca){const Os=Ca.get("type");if(Os==="point"||Os==="band"){if(Aa[Co].discreteBandSize!==void 0)return{value:Aa[Co].discreteBandSize};if(Os===Ec.POINT){const rf=Ca.get("range");return cb(rf)&&wc(rf.step)?{value:rf.step-2}:{value:Q4-2}}return{scale:Qi,band:es}}return{value:Aa[Co].continuousBandSize}}const Vs=CC(Aa.view,ca),Hs=_c(Aa[Co].discreteBandSize,Vs-2);return Hs!==void 0?{value:Hs}:void 0}(lt,Or,rr,lr,$n,Ti)};const Ji=(lr==null?void 0:lr.get("type"))!=="band"||!("band"in Ai[Or]),Ii=N9(Ct,An,$n,Ji?"middle":"top"),Mi=NC(Ct,An),ji=k4({channel:Ct,channelDef:ct,markDef:An,config:$n,scaleName:rr,scale:lr,stack:qn,offset:Mi,defaultRef:iN({model:Et,defaultPos:"mid",channel:Ct,scaleName:rr,scale:lr}),band:Ji?.5:(1-Ti)/2});if(Or)return Object.assign({[Ii]:ji},Ai);{const Co=ab(Jr),ca=Ai[Or],Qi=Mi?Object.assign(Object.assign({},ca),{offset:Mi}):ca;return{[Ii]:ji,[Co]:io(ji)?[ji[0],Object.assign(Object.assign({},ji[1]),{offset:Qi})]:Object.assign(Object.assign({},ji),{offset:Qi})}}}(n,se,t,e):I9(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function SE(e,t,n,i,a){if(L8(e))return 0;const f=e==="x"||e==="y2"?-t/2:t/2;if(Eo(n)){const g=xE(a);return{signal:`${n.signal} ? ${i-f}${g?"-"+g:""} : ${i+f}${g?"+"+g:""}`}}if(Eo(a)){const g=i+(n?-f:f);return{signal:`${g||""}${n?" - ":g?" + ":""}${a.signal}`}}return a=a||0,i+(n?-a-f:+a+f)}function F9({channel:e,fieldDef:t,scaleName:n,markDef:i,band:a,offset:f,config:g}){return hj({fieldDef:t,channel:e,markDef:i,ref:hC({scaleName:n,fieldOrDatumDef:t,band:a,offset:f}),config:g})}const hne=new Set(["aria"]);function Rg(e,t){const{fill:n,stroke:i}=t.color==="include"?D9(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},function(a,f){return rte.reduce((g,x)=>(hne.has(x)||a[x]===void 0||f[x]==="ignore"||(g[x]=ic(a[x])),g),{})}(e.markDef,t)),R9(e,"fill",n)),R9(e,"stroke",i)),bl("opacity",e)),bl("fillOpacity",e)),bl("strokeOpacity",e)),bl("strokeWidth",e)),bl("strokeDash",e)),O9(e)),rN(e,"href")),lne(e))}function R9(e,t,n){const{config:i,mark:a,markDef:f}=e;if(Za("invalid",f,i)==="hide"&&n&&!mx(a)){const g=function(x,{invalid:k=!1,channels:F}){const V=F.reduce((te,se)=>{const he=x.getScaleComponent(se);if(he){const ye=he.get("type"),Pe=x.vgField(se,{expr:"datum"});Pe&&Fg(ye)&&(te[Pe]=!0)}return te},{}),X=ci(V);if(X.length>0){const te=k?"||":"&&";return X.map(se=>C4(se,k)).join(` ${te} `)}}(e,{invalid:!0,channels:uC});if(g)return{[t]:[{test:g,value:null},...rc(n)]}}return n?{[t]:n}:{}}function oN(e){const{config:t,markDef:n}=e;if(Za("invalid",n,t)){const i=function(a,{invalid:f=!1,channels:g}){const x=g.reduce((F,V)=>{const X=a.getScaleComponent(V);if(X){const te=X.get("type"),se=a.vgField(V,{expr:"datum"});se&&Fg(te)&&(F[se]=!0)}return F},{}),k=ci(x);if(k.length>0){const F=f?"||":"&&";return k.map(V=>C4(V,f)).join(` ${F} `)}}(e,{channels:Ig});if(i)return{defined:{signal:i}}}return{}}function P9(e,t){if(t!==void 0)return{[e]:ic(t)}}var L9={has:e=>e.type!=="interval"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName("voronoi")},marks:(e,t,n)=>{const{x:i,y:a}=t.project.hasChannel,f=e.mark;if(mx(f))return si(oe.nearestNotSupportForContinuous(f)),n;const g={name:e.getName("voronoi"),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},O9(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!a?"datum.datum.x || 0":"0"},y:{expr:a||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let x=0,k=!1;return n.forEach((F,V)=>{var X;const te=(X=F.name)!==null&&X!==void 0?X:"";te===e.component.mark[0].name?x=V:te.indexOf("voronoi")>=0&&(k=!0)}),k||n.splice(x+1,0,g),n}};class gs{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){this._children.indexOf(t)>-1?console.warn("Attempt to add the same child twice."):n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const i of this._children)i.parent=t;this._children=[],t.removeChild(this),t.parent.removeChild(t),this.parent=n,t.parent=this}}class fh extends gs{constructor(t,n,i,a){super(t,n),this.type=i,this.refCounts=a,this._source=this._name=n,!this.refCounts||this._name in this.refCounts||(this.refCounts[this._name]=0)}clone(){const t=new this.constructor;return t.debugName="clone_"+this.debugName,t._source=this._source,t._name="clone_"+this._name,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${uZ()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}class hy extends gs{constructor(t,n){super(t),this.formula=n}clone(){return new hy(null,Zo(this.formula))}static makeFromEncoding(t,n){const i=n.reduceFieldDef((a,f,g)=>{const{field:x,timeUnit:k}=f,F=ju(n)?n.encoding[oy(g)]:void 0,V=ju(n)&&M4(g,f,F,n.stack,n.markDef,n.config);if(k){const X=hi(f,{forAs:!0});a[Na({as:X,field:x,timeUnit:k})]=Object.assign({as:X,field:x,timeUnit:k},V?{band:!0}:{})}return a},{});return As(i)?null:new hy(t,i)}static makeFromTransform(t,n){const i=Object.assign({},n),{timeUnit:a}=i,f=Yi(i,["timeUnit"]),g=lh(a),x=Object.assign(Object.assign({},f),{timeUnit:g});return new hy(t,{[Na(x)]:x})}merge(t){this.formula=Object.assign({},this.formula);for(const n in t.formula)this.formula[n]&&!t.formula[n].band||(this.formula[n]=t.formula[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}producedFields(){return new Set(Z1(this.formula).map(t=>t.as))}dependentFields(){return new Set(Z1(this.formula).map(t=>t.field))}hash(){return`TimeUnit ${Na(this.formula)}`}assemble(){const t=[];for(const n of Z1(this.formula)){const{field:i,as:a,timeUnit:f}=n,g=lh(f),{unit:x,utc:k}=g,F=Yi(g,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:eb(i),type:"timeunit"},x?{units:g4(x)}:{}),k?{timezone:"utc"}:{}),F),{as:[a,`${a}_end`]}))}return t}}const kE="_tuple_fields";var B9={has:e=>e.type==="single"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!$4(e.bind),parse:(e,t,n,i)=>{i.on||delete t.events,i.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const i=t.name,a=t.project,f=t.bind,g=t.init&&t.init[0],x=L9.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return a.items.forEach((k,F)=>{var V,X;const te=gu(`${i}_${k.field}`);n.filter(se=>se.name===te).length||n.unshift(Object.assign(Object.assign({name:te},g?{init:Hw(g[F])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${x}[${ka(k.field)}] : null`}]:[],bind:(X=(V=f[k.field])!==null&&V!==void 0?V:f[k.channel])!==null&&X!==void 0?X:f}))}),n},signals:(e,t,n)=>{const i=t.name,a=t.project,f=n.filter(F=>F.name===i+py)[0],g=i+kE,x=a.items.map(F=>gu(`${i}_${F.field}`)),k=x.map(F=>`${F} !== null`).join(" && ");return x.length&&(f.update=`${k} ? {fields: ${g}, values: [${x.join(", ")}]} : null`),delete f.value,delete f.on,n}},j9={has:e=>e.type==="multi"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+"_toggle",value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+py,i=t.name+"_toggle";return`${i} ? null : ${n}, `+(t.resolve==="global"?`${i} ? null : true, `:`${i} ? null : {unit: ${a1(e)}}, `)+`${i} ? ${n} : null`}},gb={has:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const a=i.channel;if(!ub(a))continue;const f=e.getScaleComponent(a),g=f?f.get("type"):void 0;if(!f||!Fg(g)){si(oe.SCALE_BINDINGS_CONTINUOUS);continue}const x={selection:t.name,field:i.field};f.set("selectionExtent",x,!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(g=>n.filter(x=>x.name===g.signals.data).length===0);if(!e.parent||sN(e)||i.length===0)return n;const a=n.filter(g=>g.name===t.name)[0];let f=a.update;if(f.indexOf(Y9)>=0)a.update=`{${i.map(g=>`${ka(g.field)}: ${g.signals.data}`).join(", ")}}`;else{for(const g of i){const x=`${ka(g.field)}: ${g.signals.data}`;f.indexOf(x)<0&&(f=`${f.substring(0,f.length-1)}, ${x}}`)}a.update=f}return n.concat(i.map(g=>({name:g.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!sN(e))for(const i of t.scales){const a=n.filter(f=>f.name===i.signals.data)[0];a.push="outer",delete a.value,delete a.update}return n}};function aN(e,t){return`domain(${ka(e.scaleName(t))})`}function sN(e){var t;return e.parent&&Zw(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:sN(e.parent.parent))}const z9={has:e=>{const t=e.resolve==="global"&&e.bind&&$4(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==Vw;return t&&!n&&si(oe.LEGEND_BINDINGS_PROJECT_LENGTH),t&&n},parse:(e,t,n,i)=>{var a;if(i.on||delete t.events,i.clear||delete t.clear,i.on||i.clear){const x='event.item && indexof(event.item.mark.role, "legend") < 0';for(const k of t.events)k.filter=rc((a=k.filter)!==null&&a!==void 0?a:[]),k.filter.indexOf(x)<0&&k.filter.push(x)}const f=X4(t.bind)?t.bind.legend:"click",g=Qo(f)?fx(f,"view"):rc(f);t.bind={legend:{merge:g}}},topLevelSignals:(e,t,n)=>{const i=t.name,a=X4(t.bind)&&t.bind.legend,f=g=>x=>{const k=Zo(x);return k.markname=g,k};for(const g of t.project.items){if(!g.hasLegend)continue;const x=`${gu(g.field)}_legend`,k=`${i}_${x}`;if(n.filter(F=>F.name===k).length===0){const F=a.merge.map(f(`${x}_symbols`)).concat(a.merge.map(f(`${x}_labels`))).concat(a.merge.map(f(`${x}_entries`)));n.unshift(Object.assign(Object.assign({name:k},t.init?{}:{value:null}),{on:[{events:F,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:a.merge,update:`!event.item || !datum ? null : ${k}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const i=t.name,a=t.project,f=n.find(X=>X.name===i+py),g=i+kE,x=a.items.filter(X=>X.hasLegend).map(X=>gu(`${i}_${gu(X.field)}_legend`)),k=`${x.map(X=>`${X} !== null`).join(" && ")} ? {fields: ${g}, values: [${x.join(", ")}]} : null`;t.events&&x.length>0?f.on.push({events:x.map(X=>({signal:X})),update:k}):x.length>0&&(f.update=k,delete f.value,delete f.on);const F=n.find(X=>X.name===i+"_toggle"),V=X4(t.bind)&&t.bind.legend;return F&&(t.events?F.on.push(Object.assign(Object.assign({},F.on[0]),{events:V})):F.on[0].events=V),n}},U9="_translate_anchor",W9="_translate_delta";function V9(e,t,n,i,a){var f;const g=t.name,x=g+U9,k=g+W9,F=n.channel,V=gb.has(t),X=a.filter(Ue=>Ue.name===n.signals[V?"data":"visual"])[0],te=e.getSizeSignalRef(i).signal,se=e.getScaleComponent(F),he=se.get("type"),ye=`${x}.extent_${F}`,Pe=`${V?he==="log"?"panLog":he==="pow"?"panPow":"panLinear":"panLinear"}(${ye}, ${`${V&&F===Cu?"-":""}${k}.${F} / `+(V?`${te}`:`span(${ye})`)}`+(V&&he==="pow"?`, ${(f=se.get("exponent"))!==null&&f!==void 0?f:1}`:"")+")";X.on.push({events:{signal:k},update:V?Pe:`clampRange(${Pe}, 0, ${te})`})}const H9="_zoom_anchor",G9="_zoom_delta";function q9(e,t,n,i,a){var f;const g=t.name,x=n.channel,k=gb.has(t),F=a.filter(Pe=>Pe.name===n.signals[k?"data":"visual"])[0],V=e.getSizeSignalRef(i).signal,X=e.getScaleComponent(x),te=X.get("type"),se=k?aN(e,x):F.name,he=g+G9,ye=`${k?te==="log"?"zoomLog":te==="pow"?"zoomPow":"zoomLinear":"zoomLinear"}(${se}, ${`${g}${H9}.${x}`}, ${he}`+(k&&te==="pow"?`, ${(f=X.get("exponent"))!==null&&f!==void 0?f:1}`:"")+")";F.on.push({events:{signal:he},update:k?ye:`clampRange(${ye}, 0, ${V})`})}const pne=[{has:()=>!0,parse:(e,t,n)=>{var i,a,f;const g=t.name,x=(i=t.project)!==null&&i!==void 0?i:t.project=new class{constructor(...te){this.items=te,this.hasChannel={},this.hasField={}}},k={},F={},V=new Set,X=(te,se)=>{const he=se==="visual"?te.channel:te.field;let ye=gu(`${g}_${he}`);for(let Pe=1;V.has(ye);Pe++)ye=gu(`${g}_${he}_${Pe}`);return V.add(ye),{[se]:ye}};if(!n.fields&&!n.encodings){const te=e.config.selection[n.type];if(n.init)for(const se of rc(n.init))for(const he of ci(se))CZ(he)?(n.encodings||(n.encodings=[])).push(he):n.type==="interval"?(si('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=te.encodings):(n.fields||(n.fields=[])).push(he);else n.encodings=te.encodings,n.fields=te.fields}for(const te of(a=n.fields)!==null&&a!==void 0?a:[]){const se={type:"E",field:te};se.signals=Object.assign({},X(se,"data")),x.items.push(se),x.hasField[te]=se}for(const te of(f=n.encodings)!==null&&f!==void 0?f:[]){const se=e.fieldDef(te);if(se){let he=se.field;if(se.aggregate){si(oe.cannotProjectAggregate(te,se.aggregate));continue}if(!he){si(oe.cannotProjectOnChannelWithoutField(te));continue}if(se.timeUnit){he=e.vgField(te);const ye={timeUnit:se.timeUnit,as:he,field:se.field};F[Na(ye)]=ye}if(!k[he]){let ye="E";t.type==="interval"?Fg(e.getScaleComponent(te).get("type"))&&(ye="R"):se.bin&&(ye="R-RE");const Pe={field:he,channel:te,type:ye};Pe.signals=Object.assign(Object.assign({},X(Pe,"data")),X(Pe,"visual")),x.items.push(k[he]=Pe),x.hasField[he]=x.hasChannel[te]=k[he]}}else si(oe.cannotProjectOnChannelWithoutField(te))}if(n.init){const te=se=>x.items.map(he=>se[he.channel]!==void 0?se[he.channel]:se[he.field]);if(n.type==="interval")t.init=te(n.init);else{const se=rc(n.init);t.init=se.map(te)}}As(F)||(x.timeUnit=new hy(null,F))},signals:(e,t,n)=>{const i=t.name+kE;return n.filter(a=>a.name===i).length>0?n:n.concat({name:i,value:t.project.items.map(a=>{const f=Yi(a,["signals","hasLegend"]);return f.field=eb(f.field),f})})}},j9,gb,z9,{has:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const i=t.name,a=gb.has(t),f=i+U9,{x:g,y:x}=t.project.hasChannel;let k=fx(t.translate,"scope");return a||(k=k.map(F=>(F.between[0].markname=i+CE,F))),n.push({name:f,value:{},on:[{events:k.map(F=>F.between[0]),update:"{x: x(unit), y: y(unit)"+(g!==void 0?", extent_x: "+(a?aN(e,Cu):`slice(${g.signals.visual})`):"")+(x!==void 0?", extent_y: "+(a?aN(e,Vc):`slice(${x.signals.visual})`):"")+"}"}]},{name:i+W9,value:{},on:[{events:k,update:`{x: ${f}.x - x(unit), y: ${f}.y - y(unit)}`}]}),g!==void 0&&V9(e,t,g,"width",n),x!==void 0&&V9(e,t,x,"height",n),n}},{has:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const i=t.name,a=gb.has(t),f=i+G9,{x:g,y:x}=t.project.hasChannel,k=ka(e.scaleName(Cu)),F=ka(e.scaleName(Vc));let V=fx(t.zoom,"scope");return a||(V=V.map(X=>(X.markname=i+CE,X))),n.push({name:i+H9,on:[{events:V,update:a?"{"+[k?`x: invert(${k}, x(unit))`:"",F?`y: invert(${F}, y(unit))`:""].filter(X=>!!X).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:f,on:[{events:V,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),g!==void 0&&q9(e,t,g,"width",n),x!==void 0&&q9(e,t,x,"height",n),n}},B9,L9,{has:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t,n)=>{n.clear&&(t.clear=Qo(n.clear)?fx(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(B9.has(t))for(const i of t.project.items){const a=n.findIndex(f=>f.name===gu(`${t.name}_${i.field}`));a!==-1&&n[a].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(a,f){a!==-1&&n[a].on&&n[a].on.push({events:t.clear,update:f})}if(t.type==="interval")for(const a of t.project.items){const f=n.findIndex(g=>g.name===a.signals.visual);i(f,"[0, 0]"),f===-1&&i(n.findIndex(g=>g.name===a.signals.data),"null")}else{let a=n.findIndex(f=>f.name===t.name+py);i(a,"null"),j9.has(t)&&i(a=n.findIndex(f=>f.name===t.name+"_toggle"),"false")}return n}}];function RC(e,t){for(const n of pne)n.has(e)&&t(n)}function Hw(e,t=!0,n=YQ){if(io(e)){const i=e.map(a=>Hw(a,t,n));return t?`[${i.join(", ")}]`:i}return jw(e)?n(t?mE(e):function(i){const a=h4(i,!0);return i.utc?+new Date(Date.UTC(...a)):+new Date(...a)}(e)):t?n(JSON.stringify(e)):e}function $9(e,t){return Mx(e,(n,i)=>{t=i.marks?i.marks(e,n,t):t,RC(n,a=>{a.marks&&(t=a.marks(e,n,t))})}),t}function uN(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}const CE="_brush",cN="_scale_trigger",mne={signals:(e,t)=>{const n=t.name,i=n+kE,a=gb.has(t),f=[],g=[],x=[];if(t.translate&&!a){const V=`!event.item || event.item.mark.name !== ${ka(n+CE)}`;X9(t,(X,te)=>{var se;const he=rc((se=te.between[0].filter)!==null&&se!==void 0?se:te.between[0].filter=[]);return he.indexOf(V)<0&&he.push(V),X})}t.project.items.forEach((V,X)=>{const te=V.channel;if(te!==Cu&&te!==Vc)return void si("Interval selections only support x and y encoding channels.");const se=t.init?t.init[X]:null,he=function(at,st,lt,ct){const Ct=lt.channel,Et=lt.signals.visual,gn=lt.signals.data,An=gb.has(st),wn=ka(at.scaleName(Ct)),$n=at.getScaleComponent(Ct),qn=$n?$n.get("type"):void 0,er=Jr=>`scale(${wn}, ${Jr})`,rr=at.getSizeSignalRef(Ct===Cu?"width":"height").signal,lr=`${Ct}(unit)`,Or=X9(st,(Jr,Lr)=>[...Jr,{events:Lr.between[0],update:`[${lr}, ${lr}]`},{events:Lr,update:`[${Et}[0], clamp(${lr}, 0, ${rr})]`}]);return Or.push({events:{signal:st.name+cN},update:Fg(qn)?`[${er(`${gn}[0]`)}, ${er(`${gn}[1]`)}]`:"[0, 0]"}),An?[{name:gn,on:[]}]:[Object.assign(Object.assign({name:Et},ct?{init:Hw(ct,!0,er)}:{value:[]}),{on:Or}),Object.assign(Object.assign({name:gn},ct?{init:Hw(ct)}:{}),{on:[{events:{signal:Et},update:`${Et}[0] === ${Et}[1] ? null : invert(${wn}, ${Et})`}]})]}(e,t,V,se),ye=V.signals.data,Pe=V.signals.visual,Ue=ka(e.scaleName(te)),We=Fg(e.getScaleComponent(te).get("type"))?"+":"";f.push(...he),g.push(ye),x.push({scaleName:e.scaleName(te),expr:`(!isArray(${ye}) || (${We}invert(${Ue}, ${Pe})[0] === ${We}${ye}[0] && ${We}invert(${Ue}, ${Pe})[1] === ${We}${ye}[1]))`})}),a||f.push({name:n+cN,value:{},on:[{events:x.map(V=>({scale:V.scaleName})),update:x.map(V=>V.expr).join(" && ")+` ? ${n+cN} : {}`}]});const k=t.init,F=`unit: ${a1(e)}, fields: ${i}, values`;return f.concat(Object.assign(Object.assign({name:n+py},k?{init:`{${F}: ${Hw(k)}}`}:{}),{on:[{events:[{signal:g.join(" || ")}],update:g.join(" && ")+` ? {${F}: [${g}]} : null`}]}))},modifyExpr:(e,t)=>t.name+py+", "+(t.resolve==="global"?"true":`{unit: ${a1(e)}}`),marks:(e,t,n)=>{const i=t.name,{x:a,y:f}=t.project.hasChannel,g=a&&a.signals.visual,x=f&&f.signals.visual,k=`data(${ka(t.name+Tx)})`;if(gb.has(t))return n;const F={x:a!==void 0?{signal:`${g}[0]`}:{value:0},y:f!==void 0?{signal:`${x}[0]`}:{value:0},x2:a!==void 0?{signal:`${g}[1]`}:{field:{group:"width"}},y2:f!==void 0?{signal:`${x}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const Pe of ci(F))F[Pe]=[Object.assign({test:`${k}.length && ${k}[0].unit === ${a1(e)}`},F[Pe]),{value:0}];const V=t.mark,{fill:X,fillOpacity:te,cursor:se}=V,he=Yi(V,["fill","fillOpacity","cursor"]),ye=ci(he).reduce((Pe,Ue)=>(Pe[Ue]=[{test:[a!==void 0&&`${g}[0] !== ${g}[1]`,f!==void 0&&`${x}[0] !== ${x}[1]`].filter(We=>We).join(" && "),value:he[Ue]},{value:null}],Pe),{});return[{name:i+CE+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:X},fillOpacity:{value:te}},update:F}},...n,{name:i+CE,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},se?{cursor:{value:se}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},F),ye)}}]}};function X9(e,t){return e.events.reduce((n,i)=>i.between?t(n,i):(si(`${i} is not an ordered event stream for interval selections.`),n),[])}function K9(e,t){const n=t.name,i=n+kE,a="(item().isVoronoi ? datum.datum : datum)",f=t.project.items.map(k=>{const F=e.fieldDef(k.channel);return F&&F.bin?`[${a}[${ka(e.vgField(k.channel,{}))}], ${a}[${ka(e.vgField(k.channel,{binSuffix:"end"}))}]]`:`${a}[${ka(k.field)}]`}).join(", "),g=`unit: ${a1(e)}, fields: ${i}, values`,x=t.events;return[{name:n+py,on:x?[{events:x,update:`datum && item().mark.marktype !== 'group' ? {${g}: [${f}]} : null`,force:!0}]:[]}]}const gne={signals:K9,modifyExpr:(e,t)=>t.name+py+", "+(t.resolve==="global"?"null":`{unit: ${a1(e)}}`)},vne={signals:K9,modifyExpr:(e,t)=>t.name+py+", "+(t.resolve==="global"?"true":`{unit: ${a1(e)}}`)},Tx="_store",py="_tuple",yne="_modify",Y9="vlSelectionResolve",bne={single:vne,multi:gne,interval:mne};function Mx(e,t){const n=e.component.selection;if(n){for(const i of Z1(n))if(t(i,bne[i.type])===!0)break}}function a1(e,{escape:t}={escape:!0}){let n=t?ka(e.name):e.name;const i=function(a){let f=a.parent;for(;f&&!W0(f);)f=f.parent;return f}(e);if(i){const{facet:a}=i;for(const f of Ng)a[f]&&(n+=` + '__facet_${f}_' + (facet[${ka(i.vgField(f))}])`)}return n}function lN(e){let t=!1;return Mx(e,n=>{t=t||n.project.items.some(i=>i.field===Vw)}),t}const xne="RawCode",wne="Literal",_ne="Property",Ene="Identifier",Sne="ArrayExpression",kne="BinaryExpression",Cne="CallExpression",Ane="ConditionalExpression",One="LogicalExpression",Tne="MemberExpression",Mne="ObjectExpression",Dne="UnaryExpression";function j0(e){this.type=e}var s1,Bi,Vr,Jf,ss;j0.prototype.visit=function(e){let t,n,i;if(e(this))return 1;for(n=0,i=(t=function(a){switch(a.type){case Sne:return a.elements;case kne:case One:return[a.left,a.right];case Cne:return[a.callee].concat(a.arguments);case Ane:return[a.test,a.consequent,a.alternate];case Tne:return[a.object,a.property];case Mne:return a.properties;case _ne:return[a.key,a.value];case Dne:return[a.argument];case Ene:case wne:case xne:default:return[]}}(this)).length;n<i;++n)if(t[n].visit(e))return 1};var PC=1,AE=2,Dx=3,vb=4,LC=5,Nx=6,Sp=7,OE=8;(s1={})[PC]="Boolean",s1[AE]="<end>",s1[Dx]="Identifier",s1[vb]="Keyword",s1[LC]="Null",s1[Nx]="Numeric",s1[Sp]="Punctuator",s1[OE]="String",s1[9]="RegularExpression";var Nne="ArrayExpression",Ine="BinaryExpression",Fne="CallExpression",Rne="ConditionalExpression",J9="Identifier",Pne="Literal",Lne="LogicalExpression",Bne="MemberExpression",jne="ObjectExpression",zne="Property",Une="UnaryExpression",nf="Unexpected token %0",Wne="Unexpected number",Vne="Unexpected string",Hne="Unexpected identifier",Gne="Unexpected reserved word",qne="Unexpected end of input",fN="Invalid regular expression",dN="Invalid regular expression: missing /",Q9="Octal literals are not allowed in strict mode.",$ne="Duplicate data property in object literal not allowed in strict mode",Qf="ILLEGAL",TE="Disabled.",Xne=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),Kne=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function BC(e,t){if(!e)throw new Error("ASSERT: "+t)}function u1(e){return e>=48&&e<=57}function hN(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function ME(e){return"01234567".indexOf(e)>=0}function Yne(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function DE(e){return e===10||e===13||e===8232||e===8233}function NE(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&Xne.test(String.fromCharCode(e))}function jC(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&Kne.test(String.fromCharCode(e))}var Jne={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function Z9(){for(var e;Vr<Jf&&(Yne(e=Bi.charCodeAt(Vr))||DE(e));)++Vr}function pN(e){var t,n,i,a=0;for(n=e==="u"?4:2,t=0;t<n;++t)Vr<Jf&&hN(Bi[Vr])?(i=Bi[Vr++],a=16*a+"0123456789abcdef".indexOf(i.toLowerCase())):Xa({},nf,Qf);return String.fromCharCode(a)}function Qne(){var e,t,n,i;for(t=0,(e=Bi[Vr])==="}"&&Xa({},nf,Qf);Vr<Jf&&hN(e=Bi[Vr++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&Xa({},nf,Qf),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),i=56320+(t-65536&1023),String.fromCharCode(n,i))}function ez(){var e,t;for(e=Bi.charCodeAt(Vr++),t=String.fromCharCode(e),e===92&&(Bi.charCodeAt(Vr)!==117&&Xa({},nf,Qf),++Vr,(e=pN("u"))&&e!=="\\"&&NE(e.charCodeAt(0))||Xa({},nf,Qf),t=e);Vr<Jf&&jC(e=Bi.charCodeAt(Vr));)++Vr,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),Bi.charCodeAt(Vr)!==117&&Xa({},nf,Qf),++Vr,(e=pN("u"))&&e!=="\\"&&jC(e.charCodeAt(0))||Xa({},nf,Qf),t+=e);return t}function Zne(){var e,t;return e=Vr,{type:(t=Bi.charCodeAt(Vr)===92?ez():function(){var n,i;for(n=Vr++;Vr<Jf;){if((i=Bi.charCodeAt(Vr))===92)return Vr=n,ez();if(!jC(i))break;++Vr}return Bi.slice(n,Vr)}()).length===1?Dx:Jne.hasOwnProperty(t)?vb:t==="null"?LC:t==="true"||t==="false"?PC:Dx,value:t,start:e,end:Vr}}function mN(){var e,t,n,i,a=Vr,f=Bi.charCodeAt(Vr),g=Bi[Vr];switch(f){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Vr,{type:Sp,value:String.fromCharCode(f),start:a,end:Vr};default:if((e=Bi.charCodeAt(Vr+1))===61)switch(f){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Vr+=2,{type:Sp,value:String.fromCharCode(f)+String.fromCharCode(e),start:a,end:Vr};case 33:case 61:return Vr+=2,Bi.charCodeAt(Vr)===61&&++Vr,{type:Sp,value:Bi.slice(a,Vr),start:a,end:Vr}}}return(i=Bi.substr(Vr,4))===">>>="?{type:Sp,value:i,start:a,end:Vr+=4}:(n=i.substr(0,3))===">>>"||n==="<<="||n===">>="?{type:Sp,value:n,start:a,end:Vr+=3}:g===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(g)>=0||t==="=>"?{type:Sp,value:t,start:a,end:Vr+=2}:"<>=!+-*%&|^/".indexOf(g)>=0?{type:Sp,value:g,start:a,end:++Vr}:void Xa({},nf,Qf)}function tz(){var e,t,n;if(BC(u1((n=Bi[Vr]).charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=Vr,e="",n!=="."){if(e=Bi[Vr++],n=Bi[Vr],e==="0"){if(n==="x"||n==="X")return++Vr,function(i){for(var a="";Vr<Jf&&hN(Bi[Vr]);)a+=Bi[Vr++];return a.length===0&&Xa({},nf,Qf),NE(Bi.charCodeAt(Vr))&&Xa({},nf,Qf),{type:Nx,value:parseInt("0x"+a,16),start:i,end:Vr}}(t);if(ME(n))return function(i){for(var a="0"+Bi[Vr++];Vr<Jf&&ME(Bi[Vr]);)a+=Bi[Vr++];return(NE(Bi.charCodeAt(Vr))||u1(Bi.charCodeAt(Vr)))&&Xa({},nf,Qf),{type:Nx,value:parseInt(a,8),octal:!0,start:i,end:Vr}}(t);n&&u1(n.charCodeAt(0))&&Xa({},nf,Qf)}for(;u1(Bi.charCodeAt(Vr));)e+=Bi[Vr++];n=Bi[Vr]}if(n==="."){for(e+=Bi[Vr++];u1(Bi.charCodeAt(Vr));)e+=Bi[Vr++];n=Bi[Vr]}if(n==="e"||n==="E")if(e+=Bi[Vr++],(n=Bi[Vr])!=="+"&&n!=="-"||(e+=Bi[Vr++]),u1(Bi.charCodeAt(Vr)))for(;u1(Bi.charCodeAt(Vr));)e+=Bi[Vr++];else Xa({},nf,Qf);return NE(Bi.charCodeAt(Vr))&&Xa({},nf,Qf),{type:Nx,value:parseFloat(e),start:t,end:Vr}}function ere(){var e,t,n,i;return ss=null,Z9(),e=Vr,t=function(){var a,f,g,x;for(BC((a=Bi[Vr])==="/","Regular expression literal must start with a slash"),f=Bi[Vr++],g=!1,x=!1;Vr<Jf;)if(f+=a=Bi[Vr++],a==="\\")DE((a=Bi[Vr++]).charCodeAt(0))&&Xa({},dN),f+=a;else if(DE(a.charCodeAt(0)))Xa({},dN);else if(g)a==="]"&&(g=!1);else{if(a==="/"){x=!0;break}a==="["&&(g=!0)}return x||Xa({},dN),{value:f.substr(1,f.length-2),literal:f}}(),n=function(){var a,f,g;for(f="",g="";Vr<Jf&&jC((a=Bi[Vr]).charCodeAt(0));)++Vr,a==="\\"&&Vr<Jf?Xa({},nf,Qf):(g+=a,f+=a);return g.search(/[^gimuy]/g)>=0&&Xa({},fN,g),{value:g,literal:f}}(),i=function(a,f){var g=a;f.indexOf("u")>=0&&(g=g.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(x,k){if(parseInt(k,16)<=1114111)return"x";Xa({},fN)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(g)}catch{Xa({},fN)}try{return new RegExp(a,f)}catch{return null}}(t.value,n.value),{literal:t.literal+n.literal,value:i,regex:{pattern:t.value,flags:n.value},start:e,end:Vr}}function nz(){var e;return Z9(),Vr>=Jf?{type:AE,start:Vr,end:Vr}:NE(e=Bi.charCodeAt(Vr))?Zne():e===40||e===41||e===59?mN():e===39||e===34?function(){var t,n,i,a,f="",g=!1;for(BC((t=Bi[Vr])==="'"||t==='"',"String literal must starts with a quote"),n=Vr,++Vr;Vr<Jf;){if((i=Bi[Vr++])===t){t="";break}if(i==="\\")if((i=Bi[Vr++])&&DE(i.charCodeAt(0)))i==="\r"&&Bi[Vr]===`
`&&++Vr;else switch(i){case"u":case"x":Bi[Vr]==="{"?(++Vr,f+=Qne()):f+=pN(i);break;case"n":f+=`
`;break;case"r":f+="\r";break;case"t":f+="	";break;case"b":f+="\b";break;case"f":f+="\f";break;case"v":f+="\v";break;default:ME(i)?((a="01234567".indexOf(i))!==0&&(g=!0),Vr<Jf&&ME(Bi[Vr])&&(g=!0,a=8*a+"01234567".indexOf(Bi[Vr++]),"0123".indexOf(i)>=0&&Vr<Jf&&ME(Bi[Vr])&&(a=8*a+"01234567".indexOf(Bi[Vr++]))),f+=String.fromCharCode(a)):f+=i}else{if(DE(i.charCodeAt(0)))break;f+=i}}return t!==""&&Xa({},nf,Qf),{type:OE,value:f,octal:g,start:n,end:Vr}}():e===46?u1(Bi.charCodeAt(Vr+1))?tz():mN():u1(e)?tz():mN()}function kp(){var e;return Vr=(e=ss).end,ss=nz(),Vr=e.end,e}function rz(){var e;e=Vr,ss=nz(),Vr=e}function iz(e,t,n){var i=new j0(e==="||"||e==="&&"?Lne:Ine);return i.operator=e,i.left=t,i.right=n,i}function tre(e,t){var n=new j0(Fne);return n.callee=e,n.arguments=t,n}function gN(e){var t=new j0(J9);return t.name=e,t}function IE(e){var t=new j0(Pne);return t.value=e.value,t.raw=Bi.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function oz(e,t,n){var i=new j0(Bne);return i.computed=e==="[",i.object=t,i.property=n,i.computed||(n.member=!0),i}function az(e,t,n){var i=new j0(zne);return i.key=t,i.value=n,i.kind=e,i}function Xa(e,t){var n,i=Array.prototype.slice.call(arguments,2),a=t.replace(/%(\d)/g,function(f,g){return BC(g<i.length,"Message reference must be in range"),i[g]});throw(n=new Error(a)).index=Vr,n.description=a,n}function zC(e){e.type===AE&&Xa(e,qne),e.type===Nx&&Xa(e,Wne),e.type===OE&&Xa(e,Vne),e.type===Dx&&Xa(e,Hne),e.type===vb&&Xa(e,Gne),Xa(e,nf,e.value)}function Zf(e){var t=kp();t.type===Sp&&t.value===e||zC(t)}function Zs(e){return ss.type===Sp&&ss.value===e}function vN(e){return ss.type===vb&&ss.value===e}function nre(){var e=[];for(Vr=ss.start,Zf("[");!Zs("]");)Zs(",")?(kp(),e.push(null)):(e.push(Ix()),Zs("]")||Zf(","));return kp(),function(t){var n=new j0(Nne);return n.elements=t,n}(e)}function sz(){var e;return Vr=ss.start,(e=kp()).type===OE||e.type===Nx?(e.octal&&Xa(e,Q9),IE(e)):gN(e.value)}function rre(){var e,t,n;return Vr=ss.start,(e=ss).type===Dx?(n=sz(),Zf(":"),az("init",n,Ix())):e.type!==AE&&e.type!==Sp?(t=sz(),Zf(":"),az("init",t,Ix())):void zC(e)}function ire(){var e,t,n=[],i={},a=String;for(Vr=ss.start,Zf("{");!Zs("}");)t="$"+((e=rre()).key.type===J9?e.key.name:a(e.key.value)),Object.prototype.hasOwnProperty.call(i,t)?Xa({},$ne):i[t]=!0,n.push(e),Zs("}")||Zf(",");return Zf("}"),function(f){var g=new j0(jne);return g.properties=f,g}(n)}var ore={if:1};function are(){var e,t,n;if(Zs("("))return function(){var i;return Zf("("),i=yN(),Zf(")"),i}();if(Zs("["))return nre();if(Zs("{"))return ire();if(e=ss.type,Vr=ss.start,e===Dx||ore[ss.value])n=gN(kp().value);else if(e===OE||e===Nx)ss.octal&&Xa(ss,Q9),n=IE(kp());else{if(e===vb)throw new Error(TE);e===PC?((t=kp()).value=t.value==="true",n=IE(t)):e===LC?((t=kp()).value=null,n=IE(t)):Zs("/")||Zs("/=")?(n=IE(ere()),rz()):zC(kp())}return n}function sre(){var e=[];if(Zf("("),!Zs(")"))for(;Vr<Jf&&(e.push(Ix()),!Zs(")"));)Zf(",");return Zf(")"),e}function ure(){var e;return Vr=ss.start,function(t){return t.type===Dx||t.type===vb||t.type===PC||t.type===LC}(e=kp())||zC(e),gN(e.value)}function cre(){var e;return Zf("["),e=yN(),Zf("]"),e}function uz(){var e=function(){var t;for(t=are();;)if(Zs("."))Zf("."),t=oz(".",t,ure());else if(Zs("("))t=tre(t,sre());else{if(!Zs("["))break;t=oz("[",t,cre())}return t}();if(ss.type===Sp&&(Zs("++")||Zs("--")))throw new Error(TE);return e}function UC(){var e,t;if(ss.type!==Sp&&ss.type!==vb)t=uz();else{if(Zs("++")||Zs("--"))throw new Error(TE);if(Zs("+")||Zs("-")||Zs("~")||Zs("!"))e=kp(),t=UC(),t=function(n,i){var a=new j0(Une);return a.operator=n,a.argument=i,a.prefix=!0,a}(e.value,t);else{if(vN("delete")||vN("void")||vN("typeof"))throw new Error(TE);t=uz()}}return t}function cz(e){var t=0;if(e.type!==Sp&&e.type!==vb)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function Ix(){var e,t;return e=function(){var n,i,a,f,g,x,k,F,V,X;if(n=ss,V=UC(),(g=cz(f=ss))===0)return V;for(f.prec=g,kp(),i=[n,ss],x=[V,f,k=UC()];(g=cz(ss))>0;){for(;x.length>2&&g<=x[x.length-2].prec;)k=x.pop(),F=x.pop().value,V=x.pop(),i.pop(),a=iz(F,V,k),x.push(a);(f=kp()).prec=g,x.push(f),i.push(ss),a=UC(),x.push(a)}for(a=x[X=x.length-1],i.pop();X>1;)i.pop(),a=iz(x[X-1].value,x[X-2],a),X-=2;return a}(),Zs("?")&&(kp(),t=Ix(),Zf(":"),e=function(n,i,a){var f=new j0(Rne);return f.test=n,f.consequent=i,f.alternate=a,f}(e,t,Ix())),e}function yN(){var e=Ix();if(Zs(","))throw new Error(TE);return e}var lre=function(e){Vr=0,Jf=(Bi=e).length,ss=null,rz();var t=yN();if(ss.type!==AE)throw new Error("Unexpect token after expression.");return t};function Gw(e,t,n){return e.fields=t||[],e.fname=n,e}function fre(e){return e.length===1?dre(e[0]):hre(e)}const dre=e=>function(t){return t[e]},hre=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};function bN(e){throw Error(e)}function pre(e){const t=[],n=e.length;let i,a,f,g=null,x=0,k="";function F(){t.push(k+e.substring(i,a)),k="",i=a+1}for(e+="",i=a=0;a<n;++a)if((f=e[a])==="\\")k+=e.substring(i,a),k+=e.substring(++a,++a),i=a;else if(f===g)F(),g=null,x=-1;else{if(g)continue;i===x&&f==='"'||i===x&&f==="'"?(i=a+1,g=f):f!=="."||x?f==="["?(a>i&&F(),x=i=a+1):f==="]"&&(x||bN("Access path missing open bracket: "+e),x>0&&F(),x=0,i=a+1):a>i?F():i=a+1}return x&&bN("Access path missing closing bracket: "+e),g&&bN("Access path missing closing quote: "+e),a>i&&(a++,F()),t}function mre(e,t,n){const i=pre(e);return e=i.length===1?i[0]:e,Gw((n&&n.get||fre)(i),[e],t||e)}mre("id"),Gw(e=>e,[],"identity"),Gw(()=>0,[],"zero"),Gw(()=>1,[],"one"),Gw(()=>!0,[],"true"),Gw(()=>!1,[],"false");function lz(e){const t=lre(e),n=new Set;return t.visit(i=>{i.type==="MemberExpression"&&function a(f){return f.object.type==="MemberExpression"?a(f.object):f.object.name==="datum"}(i)&&n.add(function a(f){const g=[];return f.type==="Identifier"?[f.name]:f.type==="Literal"?[f.value]:(f.type==="MemberExpression"&&(g.push(...a(f.object)),g.push(...a(f.property))),g)}(i).slice(1).join("."))}),n}class qw extends gs{constructor(t,n,i){super(t),this.model=n,this.filter=i,this.expr=WC(this.model,this.filter,this),this._dependentFields=lz(this.expr)}clone(){return new qw(null,this.model,Zo(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function fz(e,t,n,i="datum"){const a=[],f=cE(t,function(g){const x=gu(g),k=e.getSelectionComponent(x,g),F=ka(x+Tx);if(k.project.timeUnit){const V=n??e.component.data.raw,X=k.project.timeUnit.clone();V.parent?X.insertAsParentOf(V):V.parent=X}return k.empty!=="none"&&a.push(F),`vlSelectionTest(${F}, ${i}`+(k.resolve==="global"?")":`, ${ka(k.resolve)})`)});return(a.length?"!("+a.map(g=>`length(data(${g}))`).join(" || ")+") || ":"")+`(${f})`}function dz(e,t){const n=t.encoding;let i=t.field;if(n||i){if(n&&!i){const a=e.project.items.filter(f=>f.channel===n);!a.length||a.length>1?(i=e.project.items[0].field,si((a.length?"Multiple ":"No ")+`matching ${ka(n)} encoding found for selection ${ka(t.selection)}. Using "field": ${ka(i)}.`)):i=a[0].field}}else i=e.project.items[0].field,e.project.items.length>1&&si(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${ka(i)}.`);return`${e.name}[${ka(i)}]`}function WC(e,t,n){return cE(t,i=>Qo(i)?i:function(a){return a==null?void 0:a.selection}(i)?fz(e,i.selection,n):oj(i))}function xN(e,t,n,i){var a,f,g;e.encode=(a=e.encode)!==null&&a!==void 0?a:{},e.encode[t]=(f=e.encode[t])!==null&&f!==void 0?f:{},e.encode[t].update=(g=e.encode[t].update)!==null&&g!==void 0?g:{},e.encode[t].update[n]=i}function FE(e,t,n,i={header:!1}){var a,f;const g=e.combine(),{disable:x,orient:k,scale:F,labelExpr:V,title:X,zindex:te}=g,se=Yi(g,["disable","orient","scale","labelExpr","title","zindex"]);if(!x){for(const he in se){const ye=cZ[he],Pe=se[he];if(ye&&ye!==t&&ye!=="both")delete se[he];else if(i4(Pe)){const{condition:Ue}=Pe,We=Yi(Pe,["condition"]),at=rc(Ue),st=k8[he];if(st){const{vgProp:lt,part:ct}=st;xN(se,ct,lt,[...at.map(Ct=>{const{test:Et}=Ct,gn=Yi(Ct,["test"]);return Object.assign({test:WC(null,Et)},gn)}),We]),delete se[he]}else if(st===null){const lt={signal:at.map(ct=>{const{test:Ct}=ct,Et=Yi(ct,["test"]);return`${WC(null,Ct)} ? ${Bj(Et)} : `}).join("")+Bj(We)};se[he]=lt}}else if(Eo(Pe)){const Ue=k8[he];if(Ue){const{vgProp:We,part:at}=Ue;xN(se,at,We,Pe),delete se[he]}}}if(t==="grid"){if(!se.grid)return;if(se.encode){const{grid:he}=se.encode;se.encode=Object.assign({},he?{grid:he}:{}),As(se.encode)&&delete se.encode}return Object.assign(Object.assign({scale:F,orient:k},se),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:_c(te,0)})}{if(!i.header&&e.mainExtracted)return;if(V!==void 0){let ye=V;!((f=(a=se.encode)===null||a===void 0?void 0:a.labels)===null||f===void 0)&&f.update&&Eo(se.encode.labels.update.text)&&(ye=Lw(V,"datum.label",se.encode.labels.update.text.signal)),xN(se,"labels","text",{signal:ye})}if(se.labelAlign===null&&delete se.labelAlign,se.encode){for(const ye of C8)e.hasAxisPart(ye)||delete se.encode[ye];As(se.encode)&&delete se.encode}const he=function(ye,Pe){if(ye)return io(ye)&&!hb(ye)?ye.map(Ue=>Fj(Ue,Pe)).join(", "):ye}(X,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:F,orient:k,grid:!1},he?{title:he}:{}),se),n.aria===!1?{aria:!1}:{}),{zindex:_c(te,0)})}}}function hz(e){const{axes:t}=e.component,n=[];for(const i of Ig)if(t[i]){for(const a of t[i])if(!a.get("disable")&&!a.get("gridScale")){const f=i==="x"?"height":"width",g=e.getSizeSignalRef(f).signal;f!==g&&n.push({name:f,update:g})}}return n}const pz={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},mz={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},gre=ci(pz),vre=ci(mz);function gz(e,t,n,i){return Object.assign.apply(null,[{},...e.map(a=>{if(a==="axisOrient"){const f=n==="x"?"bottom":"left",g=t[n==="x"?"axisBottom":"axisLeft"]||{},x=t[n==="x"?"axisTop":"axisRight"]||{},k=new Set([...ci(g),...ci(x)]),F={};for(const V of k.values())F[V]={signal:`${i.signal} === "${f}" ? ${xE(g[V])} : ${xE(x[V])}`};return F}return t[a]})])}function yre(e,t,n,i){const a=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:function(F){return F in fte}(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],f=e==="x"?"axisX":"axisY",g=Eo(n)?"axisOrient":"axis"+Xk(n),x=[...a,...a.map(F=>f+F.substr(4))],k=["axis",g,f];return{vlOnlyAxisConfig:gz(x,i,e,n),vgAxisConfig:gz(k,i,e,n),axisConfigStyle:function(F,V){var X;const te=[{}];for(const se of F){let he=(X=V[se])===null||X===void 0?void 0:X.style;if(he){he=rc(he);for(const ye of he)te.push(V.style[ye])}}return Object.assign.apply(null,te)}([...k,...x],i)}}function wN(e,t,n,i={}){var a;const f=zj(e,n,t.style);if(f!==void 0)return{configFrom:"style",configValue:f};for(const g of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((a=i[g])===null||a===void 0?void 0:a[e])!==void 0)return{configFrom:g,configValue:i[g][e]};return{}}const vz={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:i,formatType:a}=n;return vj(e,e.type,i,a,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return yj(i,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var i;return(!xi(e)||!ch(e.bin))&&((i=t.grid)!==null&&i!==void 0?i:function(a,f){return!Ep(a)&&xi(f)&&!Ws(f==null?void 0:f.bin)}(n,e))},gridScale:({model:e,channel:t})=>function(n,i){const a=i==="x"?"y":"x";if(n.getScaleComponent(a))return n.scaleName(a)}(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||bz(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||yz(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var i;return(i=e.labelFlush)!==null&&i!==void 0?i:function(a,f){if(f==="x"&&co(["quantitative","temporal"],a))return!0}(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var i;return(i=e.labelOverlap)!==null&&i!==void 0?i:function(a,f){if(a!=="nominal")return f!=="log"||"greedy"}(t.type,n)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:a})=>{var f;const g=e==="x"?"width":e==="y"?"height":void 0,x=g?t.getSizeSignalRef(g):void 0;return(f=n.tickCount)!==null&&f!==void 0?f:function({fieldOrDatumDef:k,scaleType:F,size:V,values:X}){var te;if(!X&&!Ep(F)&&F!=="log"){if(xi(k)){if(Ws(k.bin))return{signal:`ceil(${V.signal}/10)`};if(k.timeUnit&&co(["month","hours","day","quarter"],(te=lh(k.timeUnit))===null||te===void 0?void 0:te.unit))return}return{signal:`ceil(${V.signal}/40)`}}}({fieldOrDatumDef:i,scaleType:a,size:x,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const i=xz(t,n);if(i!==void 0)return i;const a=t.typedFieldDef(n),f=n==="x"?"x2":"y2",g=t.fieldDef(f);return Wj(a?[kj(a)]:[],xi(g)?[kj(g)]:[])},values:({axis:e,fieldOrDatumDef:t})=>function(n,i){const a=n.values;if(io(a))return Pj(i,a);if(Eo(a))return a}(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var i;return(i=e.zindex)!==null&&i!==void 0?i:function(a,f){return a==="rect"&&Tj(f)?1:0}(n,t)}};function _N(e){return`(((${e.signal} % 360) + 360) % 360)`}function yz(e,t,n,i){if(e!==void 0){if(n==="x"){if(Eo(e)){const a=_N(e);return{signal:`(45 < ${a} && ${a} < 135) || (225 < ${a} && ${a} < 315) ? "middle" :(${a} <= 45 || 315 <= ${a}) === ${Eo(t)?`(${t.signal} === "top")`:t==="top"} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(Eo(t)){const a=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${a} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==(t==="top")?"bottom":"top"}if(Eo(e)){const a=_N(e),f=Eo(t)?`(${t.signal} === "left")`:t==="left";return{signal:`${a} <= 45 || 315 <= ${a} || (135 <= ${a} && ${a} <= 225) ? ${i?'"middle"':"null"} : (45 <= ${a} && ${a} <= 135) === ${f} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(Eo(t)){const a=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${a} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==(t==="left")?"top":"bottom"}}function bz(e,t,n){if(e===void 0)return;const i=n==="x",a=i?0:90,f=i?"bottom":"left";if(Eo(e)){const g=_N(e),x=Eo(t)?`(${t.signal} === "${f}")`:t===f;return{signal:`(${a?"("+g+" + 90)":g} % 180 === 0) ? ${i?null:'"center"'} :(${a} < ${g} && ${g} < ${180+a}) === ${x} ? "left" : "right"`}}if((e+a)%180==0)return i?null:"center";if(Eo(t)){const g=a<e&&e<180+a?"===":"!==";return{signal:`${`${t.signal} ${g} "${f}"`} ? "left" : "right"`}}return(a<e&&e<180+a)==(t===f)?"left":"right"}function xz(e,t){const n=t==="x"?"x2":"y2",i=e.fieldDef(t),a=e.fieldDef(n),f=i?i.title:void 0,g=a?a.title:void 0;return f&&g?Vj(f,g):f||g||(f!==void 0?f:g!==void 0?g:void 0)}class $w extends gs{constructor(t,n){super(t),this.transform=n,this._dependentFields=lz(this.transform.calculate)}clone(){return new $w(null,Zo(this.transform))}static parseAllForSortIndex(t,n){return n.forEachFieldDef((i,a)=>{if(F4(i)&&Sj(i.sort)){const{field:f,timeUnit:g}=i,x=i.sort,k=x.map((F,V)=>`${oj({field:f,timeUnit:g,equal:F})} ? ${V} : `).join("")+x.length;t=new $w(t,{calculate:k,as:Xw(i,a,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${Na(this.transform)}`}}function Xw(e,t,n){return hi(e,Object.assign({prefix:t,suffix:"sort_index"},n??{}))}function VC(e,t){return co(["top","bottom"],t)?"column":co(["left","right"],t)||e==="row"?"row":"column"}function Kw(e,t,n,i){const a=i==="row"?n.headerRow:i==="column"?n.headerColumn:n.headerFacet;return _c(((t==null?void 0:t.header)||{})[e],a[e],n.header[e])}function HC(e,t,n,i){const a={};for(const f of e){const g=Kw(f,t,n,i);g!==void 0&&(a[f]=g)}return a}const EN=["row","column"],SN=["header","footer"];function bre(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,a=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:f,titleAngle:g,titleOrient:x}=HC(["titleAnchor","titleAngle","titleOrient"],a,i,t),k=VC(t,x),F=Kk(g);return{name:`${t}-title`,type:"group",role:`${k}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),_z(F,k)),wz(k,F,f)),Ez(i,a,t,gre,pz))}}function wz(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=bz(t,e==="row"?"left":"top",e==="row"?"y":"x");return i?{align:i}:{}}function _z(e,t){const n=yz(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function xre(e,t){const n=e.component.layoutHeaders[t],i=[];for(const a of SN)if(n[a])for(const f of n[a]){const g=wre(e,t,a,n,f);g!=null&&i.push(g)}return i}function kN(e,t,n){const{format:i,formatType:a,labelAngle:f,labelAnchor:g,labelOrient:x,labelExpr:k}=HC(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e,n,t),F=A4({fieldOrDatumDef:e,format:i,formatType:a,expr:"parent",config:n}).signal,V=VC(t,x);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:k?Lw(Lw(k,"datum.label",F),"datum.value",hi(e,{expr:"parent"})):F}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),_z(f,V)),wz(V,f,g)),Ez(n,e,t,vre,mz))}function wre(e,t,n,i,a){if(a){let f=null;const{facetFieldDef:g}=i,x=e.config?e.config:void 0;if(g&&a.labels){const{labelOrient:X}=HC(["labelOrient"],g,x,t);(t==="row"&&!co(["top","bottom"],X)||t==="column"&&!co(["left","right"],X))&&(f=kN(g,t,x))}const k=W0(e)&&!vE(e.facet),F=a.axes,V=(F==null?void 0:F.length)>0;if(f||V){const X=t==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},i.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:function(te,se){var he;const{sort:ye}=te;return cy(ye)?{field:hi(ye,{expr:"datum"}),order:(he=ye.order)!==null&&he!==void 0?he:"ascending"}:io(ye)?{field:Xw(te,se,{expr:"datum"}),order:"ascending"}:{field:hi(te,{expr:"datum"}),order:ye??"ascending"}}(g,t)}:{}),V&&k?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),f?{title:f}:{}),a.sizeSignal?{encode:{update:{[X]:a.sizeSignal}}}:{}),V?{axes:F}:{})}}return null}const _re={column:{start:0,end:1},row:{start:1,end:0}};function Ere(e,t){return _re[t][e]}function Ez(e,t,n,i,a){const f={};for(const g of i){if(!a[g])continue;const x=Kw(g,t,e,n);x!==void 0&&(f[a[g]]=x)}return f}function CN(e){return[...GC(e,"width"),...GC(e,"height"),...GC(e,"childWidth"),...GC(e,"childHeight")]}function GC(e,t){const n=t==="width"?"x":"y",i=e.component.layoutSize.get(t);if(!i||i==="merged")return[];const a=e.getSizeSignalRef(t).signal;if(i==="step"){const f=e.getScaleComponent(n);if(f){const g=f.get("type"),x=f.get("range");if(Ep(g)&&cb(x)){const k=e.scaleName(n);return W0(e.parent)&&e.parent.component.resolve.scale[n]==="independent"?[Sz(k,x)]:[Sz(k,x),{name:a,update:kz(k,f,`domain('${k}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}if(i=="container"){const f=a.endsWith("width"),g=f?"containerSize()[0]":"containerSize()[1]",x=`isFinite(${g}) ? ${g} : ${J4(e.config.view,f?"width":"height")}`;return[{name:a,init:x,on:[{update:x,events:"window:resize"}]}]}return[{name:a,value:i}]}function Sz(e,t){return{name:e+"_step",value:t.step}}function kz(e,t,n){const i=t.get("type"),a=t.get("padding"),f=_c(t.get("paddingOuter"),a);let g=t.get("paddingInner");return`bandspace(${n}, ${g=i==="band"?g!==void 0?g:a:1}, ${f}) * ${e}_step`}function Cz(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function Az(e,t){return ci(e).reduce((n,i)=>{const a=e[i];return Object.assign(Object.assign({},n),EE(t,a,i,f=>Eo(f)?f:{value:f.value}))},{})}function Sre(e,t){if(Zw(t)||W0(t))return"shared";if(jN(t))return sy(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function AN(e,t){const n=e.scale[t],i=sy(t)?"axis":"legend";return n==="independent"?(e[i][t]==="shared"&&si(oe.independentScaleMeansIndependentGuide(t)),"independent"):e[i][t]||"shared"}const kre=Object.assign(Object.assign({},Ote),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),Oz=ci(kre);class Cre extends o1{}const Tz={symbols:function(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:a,legendType:f}){var g,x,k,F,V;if(f!=="symbol")return;const{markDef:X,encoding:te,config:se,mark:he}=n,ye=X.filled&&he!=="trail";let Pe=Object.assign(Object.assign({},function(We,at,st){for(const lt of st){const ct=kx(lt,at.markDef,at.config);ct!==void 0&&(We[lt]=ic(ct))}return We}({},n,pZ)),D9(n,{filled:ye}));const Ue=(g=Mz(te.opacity))!==null&&g!==void 0?g:X.opacity;if(Pe.fill){if(i==="fill"||ye&&i===wp)delete Pe.fill;else if(Pe.fill.field)a.get("symbolFillColor")?delete Pe.fill:(Pe.fill=ic((x=se.legend.symbolBaseFillColor)!==null&&x!==void 0?x:"black"),Pe.fillOpacity=ic(Ue??1));else if(io(Pe.fill)){const We=(V=(F=ON((k=te.fill)!==null&&k!==void 0?k:te.color))!==null&&F!==void 0?F:X.fill)!==null&&V!==void 0?V:ye&&X.color;We&&(Pe.fill=ic(We))}}if(Pe.stroke){if(i==="stroke"||!ye&&i===wp)delete Pe.stroke;else if(Pe.stroke.field)delete Pe.stroke;else if(io(Pe.stroke)){const We=_c(ON(te.stroke||te.color),X.stroke,ye?X.color:void 0);We&&(Pe.stroke={value:We})}}if(i!==n1){const We=xi(t)&&Nz(n,a,t);We?Pe.opacity=[Object.assign({test:We},ic(Ue??1)),ic(se.legend.unselectedOpacity)]:Ue&&(Pe.opacity=ic(Ue))}return As(Pe=Object.assign(Object.assign({},Pe),e))?void 0:Pe},gradient:function(e,{model:t,legendType:n}){if(n!=="gradient")return;let i={};const a=Mz(t.encoding.opacity)||t.markDef.opacity;return a&&(i.opacity=ic(a)),As(i=Object.assign(Object.assign({},i),e))?void 0:i},labels:function(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:a}){const f=n.legend(i)||{},g=n.config,x=xi(t)?Nz(n,a,t):void 0,k=x?[{test:x,value:1},{value:g.legend.unselectedOpacity}]:void 0,{format:F,formatType:V}=f,X=_x(V)?O4({fieldOrDatumDef:t,field:"datum.value",format:F,formatType:V,config:g}):void 0,te=Object.assign(Object.assign(Object.assign({},k?{opacity:k}:{}),X?{text:X}:{}),e);return As(te)?void 0:te},entries:function(e,{legendCmpt:t}){const n=t.get("selections");return n!=null&&n.length?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}};function Mz(e){return Dz(e,(t,n)=>Math.max(t,n.value))}function ON(e){return Dz(e,(t,n)=>_c(t,n.value))}function Dz(e,t){return function(n){const i=n&&n.condition;return!!i&&(io(i)||r1(i))}(e)?rc(e.condition).reduce(t,e.value):r1(e)?e.value:void 0}function Nz(e,t,n){const i=t.get("selections");if(!(i!=null&&i.length))return;const a=ka(n.field);return i.map(f=>`(!length(data(${ka(gu(f)+Tx)})) || (${f}[${a}] && indexof(${f}[${a}], datum.value) >= 0))`).join(" || ")}const Iz={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:a}=t;return vj(e,e.type,i,a,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return yj(i,t,n)},gradientLength:e=>{var t,n;const{legend:i,legendConfig:a}=e;return(n=(t=i.gradientLength)!==null&&t!==void 0?t:a.gradientLength)!==null&&n!==void 0?n:function({legendConfig:f,model:g,direction:x,orient:k,scaleType:F}){const{gradientHorizontalMaxLength:V,gradientHorizontalMinLength:X,gradientVerticalMaxLength:te,gradientVerticalMinLength:se}=f;if(L0(F))return x==="horizontal"?k==="top"||k==="bottom"?Fz(g,"width",X,V):X:Fz(g,"height",se,te)}(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var i,a;return(a=(i=e.labelOverlap)!==null&&i!==void 0?i:t.labelOverlap)!==null&&a!==void 0?a:function(f){if(co(["quantile","threshold","log"],f))return"greedy"}(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>{var a;return(a=e.symbolType)!==null&&a!==void 0?a:function(f,g,x,k){var F;if(g!=="shape"){const V=(F=ON(x))!==null&&F!==void 0?F:k;if(V)return V}switch(f){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(t.type,n,i.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>Ex(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(Bw(n)&&L0(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>function(n,i){const a=n.values;if(io(a))return Pj(i,a);if(Eo(a))return a}(t,e)};function Are(e){const{legend:t}=e;return _c(t.type,function({channel:n,timeUnit:i,scaleType:a}){if(Bw(n)){if(co(["quarter","month","day"],i))return"symbol";if(L0(a))return"gradient"}return"symbol"}(e))}function Ore({legendConfig:e,legendType:t,orient:n,legend:i}){var a,f;return(f=(a=i.direction)!==null&&a!==void 0?a:e[t?"gradientDirection":"symbolDirection"])!==null&&f!==void 0?f:function(g,x){switch(g){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return x==="gradient"?"horizontal":void 0}}(n,t)}function Fz(e,t,n,i){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${i})`}}function Rz(e){const t=ju(e)?function(n){const{encoding:i}=n,a={};for(const f of[wp,...o9]){const g=Hc(i[f]);g&&n.getScaleComponent(f)&&(f===_p&&xi(g)&&g.type===Ww||(a[f]=Mre(n,f)))}return a}(e):function(n){const{legends:i,resolve:a}=n.component;for(const f of n.children){Rz(f);for(const g of ci(f.component.legends))a.legend[g]=AN(n.component.resolve,g),a.legend[g]==="shared"&&(i[g]=Pz(i[g],f.component.legends[g]),i[g]||(a.legend[g]="independent",delete i[g]))}for(const f of ci(i))for(const g of n.children)g.component.legends[f]&&a.legend[f]==="shared"&&delete g.component.legends[f];return i}(e);return e.component.legends=t,t}function Tre(e,t,n,i){switch(t){case"disable":return n!==void 0;case"values":return!!(n!=null&&n.values);case"title":if(t==="title"&&e===(i==null?void 0:i.title))return!0}return e===(n||{})[t]}function Mre(e,t){var n,i,a;let f=e.legend(t);const{markDef:g,encoding:x,config:k}=e,F=k.legend,V=new Cre({},function(ct,Ct){const Et=ct.scaleName(Ct);if(ct.mark==="trail"){if(Ct==="color")return{stroke:Et};if(Ct==="size")return{strokeWidth:Et}}return Ct==="color"?ct.markDef.filled?{fill:Et}:{stroke:Et}:{[Ct]:Et}}(e,t));(function(ct,Ct,Et){var gn;const An=(gn=ct.fieldDef(Ct))===null||gn===void 0?void 0:gn.field;Mx(ct,wn=>{var $n,qn;const er=($n=wn.project.hasField[An])!==null&&$n!==void 0?$n:wn.project.hasChannel[Ct];if(er&&z9.has(wn)){const rr=(qn=Et.get("selections"))!==null&&qn!==void 0?qn:[];rr.push(wn.name),Et.set("selections",rr,!1),er.hasLegend=!0}})})(e,t,V);const X=f!==void 0?!f:F.disable;if(V.set("disable",X,f!==void 0),X)return V;f=f||{};const te=e.getScaleComponent(t).get("type"),se=Hc(x[t]),he=xi(se)?(n=lh(se.timeUnit))===null||n===void 0?void 0:n.unit:void 0,ye=f.orient||k.legend.orient||"right",Pe=Are({legend:f,channel:t,timeUnit:he,scaleType:te}),Ue={legend:f,channel:t,model:e,markDef:g,encoding:x,fieldOrDatumDef:se,legendConfig:F,config:k,scaleType:te,orient:ye,legendType:Pe,direction:Ore({legend:f,legendType:Pe,orient:ye,legendConfig:F})};for(const ct of Oz){const Ct=ct in Iz?Iz[ct](Ue):f[ct];if(Ct!==void 0){const Et=Tre(Ct,ct,f,e.fieldDef(t));(Et||k.legend[ct]===void 0)&&V.set(ct,Ct,Et)}}const We=(i=f==null?void 0:f.encoding)!==null&&i!==void 0?i:{},at=V.get("selections"),st={},lt={fieldOrDatumDef:se,model:e,channel:t,legendCmpt:V,legendType:Pe};for(const ct of["labels","legend","title","symbols","gradient","entries"]){const Ct=Az((a=We[ct])!==null&&a!==void 0?a:{},e),Et=ct in Tz?Tz[ct](Ct,lt):Ct;Et===void 0||As(Et)||(st[ct]=Object.assign(Object.assign(Object.assign({},at!=null&&at.length&&xi(se)?{name:`${gu(se.field)}_legend_${ct}`}:{}),at!=null&&at.length?{interactive:!!at}:{}),{update:Et}))}return As(st)||V.set("encode",st,!!(f!=null&&f.encoding)),V}function Pz(e,t){var n,i,a,f;if(!e)return t.clone();const g=e.getWithExplicit("orient"),x=t.getWithExplicit("orient");if(g.explicit&&x.explicit&&g.value!==x.value)return;let k=!1;for(const F of Oz){const V=pb(e.getWithExplicit(F),t.getWithExplicit(F),F,"legend",(X,te)=>{switch(F){case"symbolType":return Dre(X,te);case"title":return Hj(X,te);case"type":return k=!0,B0("symbol")}return OC(X,te,F,"legend")});e.setWithExplicit(F,V)}return k&&(!((i=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||i===void 0)&&i.gradient&&n4(e.implicit,["encode","gradient"]),!((f=(a=e.explicit)===null||a===void 0?void 0:a.encode)===null||f===void 0)&&f.gradient&&n4(e.explicit,["encode","gradient"])),e}function Dre(e,t){return t.value==="circle"?t:e}function Lz(e,t,n,i){var a,f,g;e.encode=(a=e.encode)!==null&&a!==void 0?a:{},e.encode[t]=(f=e.encode[t])!==null&&f!==void 0?f:{},e.encode[t].update=(g=e.encode[t].update)!==null&&g!==void 0?g:{},e.encode[t].update[n]=i}function Bz(e){const t=e.component.legends,n={};for(const i of ci(t)){const a=e.getScaleComponent(i),f=mu(a.get("domains"));if(n[f])for(const g of n[f])Pz(g,t[i])||n[f].push(t[i]);else n[f]=[t[i].clone()]}return Z1(n).flat().map(i=>function(a,f){var g,x,k;const F=a.combine(),{disable:V,labelExpr:X,selections:te}=F,se=Yi(F,["disable","labelExpr","selections"]);if(!V){if(f.aria===!1&&se.aria==null&&(se.aria=!1),!((g=se.encode)===null||g===void 0)&&g.symbols){const he=se.encode.symbols.update;!he.fill||he.fill.value==="transparent"||he.stroke||se.stroke||(he.stroke={value:"transparent"});for(const ye of o9)se[ye]&&delete he[ye]}if(se.title||delete se.title,X!==void 0){let he=X;!((k=(x=se.encode)===null||x===void 0?void 0:x.labels)===null||k===void 0)&&k.update&&Eo(se.encode.labels.update.text)&&(he=Lw(X,"datum.label",se.encode.labels.update.text.signal)),Lz(se,"labels","text",{signal:he})}for(const he in se){const ye=se[he];if(Eo(ye)){const Pe=Ate[he];if(Pe){const{vgProp:Ue,part:We}=Pe;Lz(se,We,Ue,ye),delete se[he]}}}return se}}(i,e.config)).filter(i=>i!==void 0)}function Nre(e){return Zw(e)||jN(e)?function(t){return t.children.reduce((n,i)=>n.concat(i.assembleProjections()),jz(t))}(e):jz(e)}function jz(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const a={signal:`[${t.size.map(g=>g.signal).join(", ")}]`},f=t.data.reduce((g,x)=>{const k=Eo(x)?x.signal:`data('${e.lookupDataSource(x)}')`;return co(g,k)||g.push(k),g},[]);if(f.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:i,size:a,fit:{signal:f.length>1?`[${f.join(", ")}]`:f[0]}},n)]}return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const Ire=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class zz extends o1{constructor(t,n,i,a){super(Object.assign({},n),{name:t}),this.specifiedProjection=n,this.size=i,this.data=a,this.merged=!1}get isFit(){return!!this.data}}function Uz(e){e.component.projection=ju(e)?function(t){var n;if(t.hasProjection){const i=t.specifiedProjection,a=!(i&&(i.scale!=null||i.translate!=null)),f=a?[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]:void 0,g=a?function(x){const k=[],{encoding:F}=x;for(const V of[[ny,ty],[Dg,P0]])(Hc(F[V[0]])||Hc(F[V[1]]))&&k.push({signal:x.getName(`geojson_${k.length}`)});return x.channelHasField(_p)&&x.typedFieldDef(_p).type===Ww&&k.push({signal:x.getName(`geojson_${k.length}`)}),k.length===0&&k.push(x.requestDataName(Kf)),k}(t):void 0;return new zz(t.projectionName(!0),Object.assign(Object.assign({},(n=t.config.projection)!==null&&n!==void 0?n:{}),i??{}),f,g)}}(e):function(t){if(t.children.length===0)return;let n;for(const a of t.children)Uz(a);const i=y8(t.children,a=>{const f=a.component.projection;if(f){if(n){const g=function(x,k){const F=y8(Ire,V=>!hx(x.explicit,V)&&!hx(k.explicit,V)||!(!hx(x.explicit,V)||!hx(k.explicit,V)||mu(x.get(V))!==mu(k.get(V))));if(mu(x.size)===mu(k.size)){if(F)return x;if(mu(x.explicit)===mu({}))return k;if(mu(k.explicit)===mu({}))return x}return null}(n,f);return g&&(n=g),!!g}return n=f,!0}return!0});if(n&&i){const a=t.projectionName(!0),f=new zz(a,n.specifiedProjection,n.size,Zo(n.data));for(const g of t.children){const x=g.component.projection;x&&(x.isFit&&f.data.push(...g.component.projection.data),g.renameProjection(x.get("name"),a),x.merged=!0)}return f}}(e)}function Wz(e,t){return`${q8(e)}_${t}`}function TN(e,t,n){var i;const a=Wz((i=xC(n,void 0))!==null&&i!==void 0?i:{},t);return e.getName(`${a}_bins`)}function Vz(e,t,n){let i,a;i=function(F){return"as"in F}(e)?Qo(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:[hi(e,{forAs:!0}),hi(e,{binSuffix:"end",forAs:!0})];const f=Object.assign({},xC(t,void 0)),g=Wz(f,e.field),{signal:x,extentSignal:k}=function(F,V){return{signal:F.getName(`${V}_bins`),extentSignal:F.getName(`${V}_extent`)}}(n,g);if(lC(f.extent)){const F=f.extent,V=F.selection;a=dz(n.getSelectionComponent(gu(V),V),F),delete f.extent}return{key:g,binComponent:Object.assign(Object.assign(Object.assign({bin:f,field:e.field,as:[i]},x?{signal:x}:{}),k?{extentSignal:k}:{}),a?{span:a}:{})}}class my extends gs{constructor(t,n){super(t),this.bins=n}clone(){return new my(null,Zo(this.bins))}static makeFromEncoding(t,n){const i=n.reduceFieldDef((a,f,g)=>{if(Fm(f)&&Ws(f.bin)){const{key:x,binComponent:k}=Vz(f,f.bin,n);a[x]=Object.assign(Object.assign(Object.assign({},k),a[x]),function(F,V,X,te){var se,he;if(bE(V,X)){const ye=ju(F)&&(he=(se=F.axis(X))!==null&&se!==void 0?se:F.legend(X))!==null&&he!==void 0?he:{},Pe=hi(V,{expr:"datum"}),Ue=hi(V,{expr:"datum",binSuffix:"end"});return{formulaAs:hi(V,{binSuffix:"range",forAs:!0}),formula:pC(Pe,Ue,ye.format,ye.formatType,te)}}return{}}(n,f,g,n.config))}return a},{});return As(i)?null:new my(t,i)}static makeFromTransform(t,n,i){const{key:a,binComponent:f}=Vz(n,n.bin,i);return new my(t,{[a]:f})}merge(t,n){for(const i of ci(t.bins))i in this.bins?(n(t.bins[i].signal,this.bins[i].signal),this.bins[i].as=Q1([...this.bins[i].as,...t.bins[i].as],Na)):this.bins[i]=t.bins[i];for(const i of t.children)t.removeChild(i),i.parent=this;t.remove()}producedFields(){return new Set(Z1(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(Z1(this.bins).map(t=>t.field))}hash(){return`Bin ${Na(this.bins)}`}assemble(){return Z1(this.bins).flatMap(t=>{const n=[],[i,...a]=t.as,f=t.bin,{extent:g}=f,x=Yi(f,["extent"]),k=Object.assign(Object.assign(Object.assign({type:"bin",field:eb(t.field),as:i,signal:t.signal},lC(g)?{extent:null}:{extent:g}),t.span?{span:{signal:`span(${t.span})`}}:{}),x);!g&&t.extentSignal&&(n.push({type:"extent",field:eb(t.field),signal:t.extentSignal}),k.extent={signal:t.extentSignal}),n.push(k);for(const F of a)for(let V=0;V<2;V++)n.push({type:"formula",expr:hi({field:i[V]},{expr:"datum"}),as:F[V]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}class Yw extends gs{constructor(t){let n;if(super(null),Ox(t=t??{name:"source"})||(n=t.format?Object.assign({},Ky(t.format,["parse"])):{}),TC(t))this._data={values:t.values};else if(_E(t)){if(this._data={url:t.url},!n.type){let i=/(?:\.([^.]+))?$/.exec(t.url)[1];co(["json","csv","tsv","dsv","topojson"],i)||(i="json"),n.type=i}}else C9(t)?this._data={values:[{type:"Sphere"}]}:(S9(t)||Ox(t))&&(this._data={});this._generator=Ox(t),t.name&&(this._name=t.name),n&&!As(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}function MN(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return console.error("Dataflow graph is inconsistent.",t,n),!1;if(!MN(t.children))return!1}return!0}class RE extends gs{constructor(t,n){super(t),this.params=n}clone(){return new RE(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${Na(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class PE extends gs{constructor(t,n){super(t),this.params=n}clone(){return new PE(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([(t=this.params.as)!==null&&t!==void 0?t:"data"])}hash(){return`Hash ${Na(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}function qC(e){return e instanceof Yw||e instanceof RE||e instanceof PE}class Hz{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class c1 extends Hz{constructor(){super(),this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:t,mutatedFlag:n}){t&&this.setContinue(),n&&this.setMutated()}reset(){}optimizeNextFromLeaves(t){if(qC(t))return!1;const n=t.parent,{continueFlag:i}=this.run(t);return i&&this.optimizeNextFromLeaves(n),this.mutatedFlag}}class DN extends Hz{}function Fre(e,t,n,i){const a=ju(i)?i.encoding[oy(t)]:void 0;if(Fm(n)&&ju(i)&&M4(t,n,a,i.stack,i.markDef,i.config))e.add(hi(n,{})),e.add(hi(n,{suffix:"end"})),n.bin&&bE(n,t)&&e.add(hi(n,{binSuffix:"range"}));else if(function(f){return f in c4}(t)){const f=function(g){switch(g){case ty:return"y";case P0:return"y2";case ny:return"x";case Dg:return"x2"}}(t);e.add(i.getName(f))}else e.add(hi(n));return e}class z0 extends gs{constructor(t,n,i){super(t),this.dimensions=n,this.measures=i}clone(){return new z0(null,new Set(this.dimensions),Zo(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let i=!1;n.forEachFieldDef(g=>{g.aggregate&&(i=!0)});const a={},f=new Set;return i?(n.forEachFieldDef((g,x)=>{var k,F,V,X;const{aggregate:te,field:se}=g;if(te)if(te==="count")a["*"]=(k=a["*"])!==null&&k!==void 0?k:{},a["*"].count=new Set([hi(g,{forAs:!0})]);else{if(tb(te)||gx(te)){const he=tb(te)?"argmin":"argmax",ye=te[he];a[ye]=(F=a[ye])!==null&&F!==void 0?F:{},a[ye][he]=new Set([hi({op:he,field:ye},{forAs:!0})])}else a[se]=(V=a[se])!==null&&V!==void 0?V:{},a[se][te]=new Set([hi(g,{forAs:!0})]);ub(x)&&n.scaleDomain(x)==="unaggregated"&&(a[se]=(X=a[se])!==null&&X!==void 0?X:{},a[se].min=new Set([hi({field:se,aggregate:"min"},{forAs:!0})]),a[se].max=new Set([hi({field:se,aggregate:"max"},{forAs:!0})]))}else Fre(f,x,g,n)}),f.size+ci(a).length===0?null:new z0(t,f,a)):null}static makeFromTransform(t,n){var i,a,f;const g=new Set,x={};for(const k of n.aggregate){const{op:F,field:V,as:X}=k;F&&(F==="count"?(x["*"]=(i=x["*"])!==null&&i!==void 0?i:{},x["*"].count=new Set([X||hi(k,{forAs:!0})])):(x[V]=(a=x[V])!==null&&a!==void 0?a:{},x[V][F]=new Set([X||hi(k,{forAs:!0})])))}for(const k of(f=n.groupby)!==null&&f!==void 0?f:[])g.add(k);return g.size+ci(x).length===0?null:new z0(t,g,x)}merge(t){return function(n,i){if(n.size!==i.size)return!1;for(const a of n)if(!i.has(a))return!1;return!0}(this.dimensions,t.dimensions)?(function(n,i){var a;for(const f of ci(i)){const g=i[f];for(const x of ci(g))f in n?n[f][x]=new Set([...(a=n[f][x])!==null&&a!==void 0?a:[],...g[x]]):n[f]={[x]:g[x]}}}(this.measures,t.measures),!0):(function(...n){fC.debug(...n)}("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...ci(this.measures)])}producedFields(){const t=new Set;for(const n of ci(this.measures))for(const i of ci(this.measures[n])){const a=this.measures[n][i];a.size===0?t.add(`${i}_${n}`):a.forEach(t.add,t)}return t}hash(){return`Aggregate ${Na({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],n=[],i=[];for(const a of ci(this.measures))for(const f of ci(this.measures[a]))for(const g of this.measures[a][f])i.push(g),t.push(f),n.push(a==="*"?null:eb(a));return{type:"aggregate",groupby:[...this.dimensions].map(eb),ops:t,fields:n,as:i}}}class Jw extends gs{constructor(t,n,i,a){super(t),this.model=n,this.name=i,this.data=a;for(const f of Ng){const g=n.facet[f];if(g){const{bin:x,sort:k}=g;this[f]=Object.assign({name:n.getName(`${f}_domain`),fields:[hi(g),...Ws(x)?[hi(g,{binSuffix:"end"})]:[]]},cy(k)?{sortField:k}:io(k)?{sortIndexField:Xw(g,f)}:{})}}this.childModel=n.child}hash(){let t="Facet";for(const n of Ng)this[n]&&(t+=` ${n.charAt(0)}:${Na(this[n])}`);return t}get fields(){var t;const n=[];for(const i of Ng)!((t=this[i])===null||t===void 0)&&t.fields&&n.push(...this[i].fields);return n}dependentFields(){const t=new Set(this.fields);for(const n of Ng)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of Ig){const i=this.childModel.component.scales[n];if(i&&!i.merged){const a=i.get("type"),f=i.get("range");if(Ep(a)&&cb(f)){const g=LN(XC(this.childModel,n));g?t[n]=g:si(`Unknown field for ${n}. Cannot calculate view size.`)}}}return t}assembleRowColumnHeaderData(t,n,i){const a={row:"y",column:"x"}[t],f=[],g=[],x=[];i&&i[a]&&(n?(f.push(`distinct_${i[a]}`),g.push("max")):(f.push(i[a]),g.push("distinct")),x.push(`distinct_${i[a]}`));const{sortField:k,sortIndexField:F}=this[t];if(k){const{op:V=mC,field:X}=k;f.push(X),g.push(V),x.push(hi(k,{forAs:!0}))}else F&&(f.push(F),g.push("max"),x.push(F));return{name:this[t].name,source:n??this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},f.length?{fields:f,ops:g,as:x}:{})]}}assembleFacetHeaderData(t){var n,i;const{columns:a}=this.model.layout,{layoutHeaders:f}=this.model.component,g=[],x={};for(const V of EN){for(const X of SN){const te=(n=f[V]&&f[V][X])!==null&&n!==void 0?n:[];for(const se of te)if(((i=se.axes)===null||i===void 0?void 0:i.length)>0){x[V]=!0;break}}if(x[V]){const X=`length(data("${this.facet.name}"))`,te=V==="row"?a?{signal:`ceil(${X} / ${a})`}:1:a?{signal:`min(${X}, ${a})`}:{signal:X};g.push({name:`${this.facet.name}_${V}`,transform:[{type:"sequence",start:0,stop:te}]})}}const{row:k,column:F}=x;return(k||F)&&g.unshift(this.assembleRowColumnHeaderData("facet",null,t)),g}assemble(){var t,n;const i=[];let a=null;const f=this.getChildIndependentFieldsWithStep(),{column:g,row:x,facet:k}=this;if(g&&x&&(f.x||f.y)){a=`cross_${this.column.name}_${this.row.name}`;const F=[].concat((t=f.x)!==null&&t!==void 0?t:[],(n=f.y)!==null&&n!==void 0?n:[]),V=F.map(()=>"distinct");i.push({name:a,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:F,ops:V}]})}for(const F of[Qy,Jy])this[F]&&i.push(this.assembleRowColumnHeaderData(F,a,f));if(k){const F=this.assembleFacetHeaderData(f);F&&i.push(...F)}return i}}function Gz(e){return e[0]==="'"&&e[e.length-1]==="'"||e[0]==='"'&&e[e.length-1]==='"'?e.slice(1,-1):e}function Rre(e){const t={};return function n(i,a){if(t4(i))n(i.not,a);else if(e4(i))for(const f of i.and)n(f,a);else if(ZD(i))for(const f of i.or)n(f,a);else a(i)}(e.filter,n=>{var i;if(ij(n)){let a=null;y4(n)?a=n.equal:b4(n)?a=n.range[0]:x4(n)&&(a=((i=n.oneOf)!==null&&i!==void 0?i:n.in)[0]),a&&(jw(a)?t[n.field]="date":wc(a)?t[n.field]="number":Qo(a)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function Pre(e){const t={};function n(i){wC(i)?t[i.field]="date":i.type==="quantitative"&&function(a){return Qo(a)&&co(["min","max"],a)}(i.aggregate)?t[i.field]="number":lE(i.field)>1?i.field in t||(t[i.field]="flatten"):F4(i)&&cy(i.sort)&&lE(i.sort.field)>1&&(i.sort.field in t||(t[i.sort.field]="flatten"))}if((ju(e)||W0(e))&&e.forEachFieldDef((i,a)=>{if(Fm(i))n(i);else{const f=bx(a),g=e.fieldDef(f);n(Object.assign(Object.assign({},i),{type:g.type}))}}),ju(e)){const{mark:i,markDef:a,encoding:f}=e;if(mx(i)&&!e.encoding.order){const g=f[a.orient==="horizontal"?"y":"x"];!xi(g)||g.type!=="quantitative"||g.field in t||(t[g.field]="number")}}return t}class ed extends gs{constructor(t,n){super(t),this._parse=n}clone(){return new ed(null,Zo(this._parse))}hash(){return`Parse ${Na(this._parse)}`}static makeExplicit(t,n,i){let a={};const f=n.data;return!Ox(f)&&f&&f.format&&f.format.parse&&(a=f.format.parse),this.makeWithAncestors(t,a,{},i)}static makeWithAncestors(t,n,i,a){for(const x of ci(i)){const k=a.getWithExplicit(x);k.value!==void 0&&(k.explicit||k.value===i[x]||k.value==="derived"||i[x]==="flatten"?delete i[x]:si(oe.differentParse(x,i[x],k.value)))}for(const x of ci(n)){const k=a.get(x);k!==void 0&&(k===n[x]?delete n[x]:si(oe.differentParse(x,n[x],k)))}const f=new o1(n,i);a.copyAll(f);const g={};for(const x of ci(f.combine())){const k=f.get(x);k!==null&&(g[x]=k)}return ci(g).length===0||a.parseNothing?null:new ed(t,g)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse),t.remove()}assembleFormatParse(){const t={};for(const n of ci(this._parse)){const i=this._parse[n];lE(n)===1&&(t[n]=i)}return t}producedFields(){return new Set(ci(this._parse))}dependentFields(){return new Set(ci(this._parse))}assembleTransforms(t=!1){return ci(this._parse).filter(n=>!t||lE(n)>1).map(n=>{const i=function(a,f){const g=E8(a);return f==="number"?`toNumber(${g})`:f==="boolean"?`toBoolean(${g})`:f==="string"?`toString(${g})`:f==="date"?`toDate(${g})`:f==="flatten"?g:f.indexOf("date:")===0?`timeParse(${g},'${Gz(f.slice(5,f.length))}')`:f.indexOf("utc:")===0?`utcParse(${g},'${Gz(f.slice(4,f.length))}')`:(si(oe.unrecognizedParse(f)),null)}(n,this._parse[n]);return i?{type:"formula",expr:i,as:S8(n)}:null}).filter(n=>n!==null)}}class yb extends gs{clone(){return new yb(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([Vw])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:Vw}}}class Fx extends gs{constructor(t,n){super(t),this.transform=n}clone(){return new Fx(null,Zo(this.transform))}addDimensions(t){this.transform.groupby=Q1(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:hi(t)}hash(){return`JoinAggregateTransform ${Na(this.transform)}`}assemble(){const t=[],n=[],i=[];for(const f of this.transform.joinaggregate)n.push(f.op),i.push(this.getDefaultName(f)),t.push(f.field===void 0?null:f.field);const a=this.transform.groupby;return Object.assign({type:"joinaggregate",as:i,ops:n,fields:t},a!==void 0?{groupby:a}:{})}}class l1 extends gs{constructor(t,n){super(t),this._stack=n}clone(){return new l1(null,Zo(this._stack))}static makeFromTransform(t,n){const{stack:i,groupby:a,as:f,offset:g="zero"}=n,x=[],k=[];if(n.sort!==void 0)for(const X of n.sort)x.push(X.field),k.push(_c(X.order,"ascending"));const F={field:x,order:k};let V;return V=function(X){return io(X)&&X.every(te=>Qo(te))&&X.length>1}(f)?f:Qo(f)?[f,f+"_end"]:[n.stack+"_start",n.stack+"_end"],new l1(t,{stackField:i,groupby:a,offset:g,sort:F,facetby:[],as:V})}static makeFromEncoding(t,n){const i=n.stack,{encoding:a}=n;if(!i)return null;const{groupbyChannel:f,fieldChannel:g,offset:x,impute:k}=i;let F;f&&(F=fy(a[f]));const V=function(se){return se.stack.stackBy.reduce((he,ye)=>{const Pe=hi(ye.fieldDef);return Pe&&he.push(Pe),he},[])}(n),X=n.encoding.order;let te;return te=io(X)||xi(X)?Uj(X):V.reduce((se,he)=>(se.field.push(he),se.order.push(g==="y"?"descending":"ascending"),se),{field:[],order:[]}),new l1(t,{dimensionFieldDef:F,stackField:n.vgField(g),facetby:[],stackby:V,sort:te,offset:x,impute:k,as:[n.vgField(g,{suffix:"start",forAs:!0}),n.vgField(g,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${Na(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:t,impute:n,groupby:i}=this._stack;return t?t.bin?n?[hi(t,{binSuffix:"mid"})]:[hi(t,{}),hi(t,{binSuffix:"end"})]:[hi(t)]:i??[]}assemble(){const t=[],{facetby:n,dimensionFieldDef:i,stackField:a,stackby:f,sort:g,offset:x,impute:k,as:F}=this._stack;if(k&&i){const{band:V=.5,bin:X}=i;X&&t.push({type:"formula",expr:`${V}*`+hi(i,{expr:"datum"})+`+${1-V}*`+hi(i,{expr:"datum",binSuffix:"end"}),as:hi(i,{binSuffix:"mid",forAs:!0})}),t.push({type:"impute",field:a,groupby:[...f,...n],key:hi(i,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:a,sort:g,as:F,offset:x}),t}}class Qw extends gs{constructor(t,n){super(t),this.transform=n}clone(){return new Qw(null,Zo(this.transform))}addDimensions(t){this.transform.groupby=Q1(this.transform.groupby.concat(t),n=>n)}dependentFields(){var t,n;const i=new Set;return((t=this.transform.groupby)!==null&&t!==void 0?t:[]).forEach(i.add,i),((n=this.transform.sort)!==null&&n!==void 0?n:[]).forEach(a=>i.add(a.field)),this.transform.window.map(a=>a.field).filter(a=>a!==void 0).forEach(i.add,i),i}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:hi(t)}hash(){return`WindowTransform ${Na(this.transform)}`}assemble(){var t;const n=[],i=[],a=[],f=[];for(const te of this.transform.window)i.push(te.op),a.push(this.getDefaultName(te)),f.push(te.param===void 0?null:te.param),n.push(te.field===void 0?null:te.field);const g=this.transform.frame,x=this.transform.groupby;if(g&&g[0]===null&&g[1]===null&&i.every(te=>u4(te)))return Object.assign({type:"joinaggregate",as:a,ops:i,fields:n},x!==void 0?{groupby:x}:{});const k=[],F=[];if(this.transform.sort!==void 0)for(const te of this.transform.sort)k.push(te.field),F.push((t=te.order)!==null&&t!==void 0?t:"ascending");const V={field:k,order:F},X=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:f,as:a,ops:i,fields:n,sort:V},X!==void 0?{ignorePeers:X}:{}),x!==void 0?{groupby:x}:{}),g!==void 0?{frame:g}:{})}}class Lre extends c1{run(t){const n=t.parent;if(t instanceof ed){if(qC(n))return this.flags;if(n.numChildren()>1)return this.setContinue(),this.flags;if(n instanceof ed)this.setMutated(),n.merge(t);else{if(w8(n.producedFields(),t.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),t.swapWithParent()}}return this.setContinue(),this.flags}}class Bre extends DN{mergeNodes(t,n){const i=n.shift();for(const a of n)t.removeChild(a),a.parent=i,a.remove()}run(t){const n=t.children.map(a=>a.hash()),i={};for(let a=0;a<n.length;a++)i[n[a]]===void 0?i[n[a]]=[t.children[a]]:i[n[a]].push(t.children[a]);for(const a of ci(i))i[a].length>1&&(this.setMutated(),this.mergeNodes(t,i[a]));for(const a of t.children)this.run(a);return this.mutatedFlag}}class jre extends c1{run(t){return t instanceof fh||t.numChildren()>0||t instanceof Jw?this.flags:(this.setMutated(),t.remove(),this.flags)}}class zre extends c1{constructor(){super(...arguments),this.fields=new Set,this.prev=null}run(t){if(this.setContinue(),t instanceof hy){const n=t.producedFields();b8(n,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...n]),this.prev=t}return this.flags}reset(){this.fields.clear()}}class Ure extends c1{run(t){this.setContinue();const n=t.parent.children.filter(a=>a instanceof hy),i=n.pop();for(const a of n)this.setMutated(),i.merge(a);return this.flags}}function NN(e){if(e instanceof Jw)if(e.numChildren()!==1||e.children[0]instanceof fh){const t=e.model.component.data.main;(function a(f){if(f instanceof fh&&f.type===Kf&&f.numChildren()===1){const g=f.children[0];g instanceof Jw||(g.swapWithParent(),a(f))}})(t);const n=function(a){return function f(g){if(!(g instanceof Jw)){const x=g.clone();if(x instanceof fh){const k=IN+x.getSource();x.setSource(k),a.model.component.data.outputNodes[k]=x}else(x instanceof z0||x instanceof l1||x instanceof Qw||x instanceof Fx)&&x.addDimensions(a.fields);for(const k of g.children.flatMap(f))k.parent=x;return[x]}return g.children.flatMap(f)}}(e),i=e.children.map(n).flat();for(const a of i)a.parent=t}else{const t=e.children[0];(t instanceof z0||t instanceof l1||t instanceof Qw||t instanceof Fx)&&t.addDimensions(e.fields),t.swapWithParent(),NN(e)}else e.children.map(NN)}class Wre extends DN{constructor(){super()}run(t){t instanceof fh&&!t.isRequired()&&(this.setMutated(),t.remove());for(const n of t.children)this.run(n);return this.mutatedFlag}}class Vre extends DN{constructor(t){super(),this.requiresSelectionId=t&&lN(t)}run(t){t instanceof yb&&(this.requiresSelectionId&&(qC(t.parent)||t.parent instanceof z0||t.parent instanceof ed)||(this.setMutated(),t.remove()));for(const n of t.children)this.run(n);return this.mutatedFlag}}class Hre extends c1{run(t){const n=t.parent,i=[...n.children],a=n.children.filter(f=>f instanceof ed);if(n.numChildren()>1&&a.length>=1){const f={},g=new Set;for(const x of a){const k=x.parse;for(const F of ci(k))F in f?f[F]!==k[F]&&g.add(F):f[F]=k[F]}for(const x of g)delete f[x];if(!As(f)){this.setMutated();const x=new ed(n,f);for(const k of i){if(k instanceof ed)for(const F of ci(f))delete k.parse[F];n.removeChild(k),k.parent=x,k instanceof ed&&ci(k.parse).length===0&&k.remove()}}}return this.setContinue(),this.flags}}class Gre extends c1{run(t){const n=t.parent,i=n.children.filter(f=>f instanceof z0),a={};for(const f of i){const g=Na(f.groupBy);g in a||(a[g]=[]),a[g].push(f)}for(const f of ci(a)){const g=a[f];if(g.length>1){const x=g.pop();for(const k of g)x.merge(k)&&(n.removeChild(k),k.parent=x,k.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class qre extends c1{constructor(t){super(),this.model=t}run(t){const n=t.parent,i=!(qC(n)||n instanceof qw||n instanceof ed||n instanceof yb),a=[],f=[];for(const g of n.children)g instanceof my&&(i&&!w8(n.producedFields(),g.dependentFields())?a.push(g):f.push(g));if(a.length>0){const g=a.pop();for(const x of a)g.merge(x,this.model.renameSignal.bind(this.model));this.setMutated(),n instanceof my?n.merge(g,this.model.renameSignal.bind(this.model)):g.swapWithParent()}if(f.length>1){const g=f.pop();for(const x of f)g.merge(x,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class $re extends c1{run(t){const n=t.parent,i=[...n.children];if(!uE(i,g=>g instanceof fh)||n.numChildren()<=1)return this.setContinue(),this.flags;const a=[];let f;for(const g of i)if(g instanceof fh){let x=g;for(;x.numChildren()===1;){const k=x.children[0];if(!(k instanceof fh))break;x=k}a.push(...x.children),f?(n.removeChild(g),g.parent=f.parent,f.parent.removeChild(f),f.parent=x,this.setMutated()):f=x}else a.push(g);if(a.length){this.setMutated();for(const g of a)g.parent.removeChild(g),g.parent=f}return this.setContinue(),this.flags}}const IN="scale_",$C=5;function bb(e){const t=[];function n(i){if(i.numChildren()===0)t.push(i);else for(const a of i.children)n(a)}for(const i of e)n(i);return t}function Xre(e){return e}function U0(e,t){return t.map(n=>{if(e instanceof c1){const i=e.optimizeNextFromLeaves(n);return e.reset(),i}return e.run(n)}).some(Xre)}function qz(e,t){let n=e.sources;const i=new Set;return i.add(U0(new Wre,n)),i.add(U0(new Vre(t),n)),n=n.filter(a=>a.numChildren()>0),i.add(U0(new jre,bb(n))),n=n.filter(a=>a.numChildren()>0),i.add(U0(new Lre,bb(n))),i.add(U0(new qre(t),bb(n))),i.add(U0(new zre,bb(n))),i.add(U0(new Hre,bb(n))),i.add(U0(new Gre,bb(n))),i.add(U0(new Ure,bb(n))),i.add(U0(new Bre,n)),i.add(U0(new $re,bb(n))),e.sources=n,i.has(!0)}class Rm{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new Rm(()=>t(n))}}function $z(e){ju(e)?function(t){const n=t.component.scales;for(const i of ci(n)){const a=Kre(t,i);if(n[i].setWithExplicit("domains",a),Yre(t,i),t.component.data.isFaceted){let g=t;for(;!W0(g)&&g.parent;)g=g.parent;if(g.component.resolve.scale[i]==="shared")for(const k of a.value)lb(k)&&(k.data=IN+k.data.replace(IN,""))}}}(e):function(t){for(const i of t.children)$z(i);const n=t.component.scales;for(const i of ci(n)){let a,f=null;for(const g of t.children){const x=g.component.scales[i];if(x){a=a===void 0?x.getWithExplicit("domains"):pb(a,x.getWithExplicit("domains"),"domains","scale",PN);const k=x.get("selectionExtent");f&&k&&f.selection!==k.selection&&si("The same selection must be used to override scale domains in a layered view."),f=k}}n[i].setWithExplicit("domains",a),f&&n[i].set("selectionExtent",f,!0)}}(e)}function Kre(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,a=function(f,g,x,k){if(f==="unaggregated"){const{valid:F,reason:V}=Xz(g,x);if(!F)return void si(V)}else if(f===void 0&&k.useUnaggregatedDomain){const{valid:F}=Xz(g,x);if(F)return"unaggregated"}return f}(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return a!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:a})),t==="x"&&Hc(i.x2)?Hc(i.x)?pb(xb(n,a,e,"x"),xb(n,a,e,"x2"),"domain","scale",PN):xb(n,a,e,"x2"):t==="y"&&Hc(i.y2)?Hc(i.y)?pb(xb(n,a,e,"y"),xb(n,a,e,"y2"),"domain","scale",PN):xb(n,a,e,"y2"):xb(n,a,e,t)}function FN(e,t,n){var i;const a=(i=lh(n))===null||i===void 0?void 0:i.unit;return t==="temporal"||a?function(f,g,x){return f.map(k=>({signal:`{data: ${B4(k,{timeUnit:x,type:g})}}`}))}(e,t,a):[e]}function xb(e,t,n,i){const{encoding:a}=n,f=Hc(a[i]),{type:g}=f,x=f.timeUnit;if(function(X){return X&&X.unionWith}(t)){const X=xb(e,void 0,n,i),te=FN(t.unionWith,g,x);return Ax([...X.value,...te])}if(Eo(t))return Ax([t]);if(t&&t!=="unaggregated"&&!uj(t))return Ax(FN(t,g,x));const k=n.stack;if(k&&i===k.fieldChannel){if(k.offset==="normalize")return B0([[0,1]]);const X=n.requestDataName(Kf);return B0([{data:X,field:n.vgField(i,{suffix:"start"})},{data:X,field:n.vgField(i,{suffix:"end"})}])}const F=ub(i)&&xi(f)?function(X,te,se){if(!Ep(se))return;const he=X.fieldDef(te),ye=he.sort;if(Sj(ye))return{op:"min",field:Xw(he,te),order:"ascending"};const{stack:Pe}=X,Ue=Pe?[...Pe.groupbyField?[Pe.groupbyField]:[],...Pe.stackBy.map(We=>We.fieldDef.field)]:void 0;if(cy(ye)){const We=Pe&&!co(Ue,ye.field);return RN(ye,We)}if(Ej(ye)){const{encoding:We,order:at}=ye,st=X.fieldDef(We),{aggregate:lt,field:ct}=st,Ct=Pe&&!co(Ue,ct);if(tb(lt)||gx(lt))return RN({field:hi(st),order:at},Ct);if(u4(lt)||!lt)return RN({op:lt,field:ct,order:at},Ct)}else{if(ye==="descending")return{op:"min",field:X.vgField(te),order:"descending"};if(co(["ascending",void 0],ye))return!0}}(n,i,e):void 0;if(db(f))return B0(FN([f.datum],g,x));const V=f;if(t==="unaggregated"){const X=n.requestDataName(Kf),{field:te}=f;return B0([{data:X,field:hi({field:te,aggregate:"min"})},{data:X,field:hi({field:te,aggregate:"max"})}])}if(Ws(V.bin)){if(Ep(e))return B0(e==="bin-ordinal"?[]:[{data:$k(F)?n.requestDataName(Kf):n.requestDataName(MC),field:n.vgField(i,bE(V,i)?{binSuffix:"range"}:{}),sort:F!==!0&&yl(F)?F:{field:n.vgField(i,{}),op:"min"}}]);{const{bin:X}=V;if(Ws(X)){const te=TN(n,V.field,X);return B0([new Rm(()=>{const se=n.getSignalName(te);return`[${se}.start, ${se}.stop]`})])}return B0([{data:n.requestDataName(Kf),field:n.vgField(i,{})}])}}if(V.timeUnit&&co(["time","utc"],e)&&M4(i,V,ju(n)?n.encoding[oy(i)]:void 0,n.stack,n.markDef,n.config)){const X=n.requestDataName(Kf);return B0([{data:X,field:n.vgField(i)},{data:X,field:n.vgField(i,{suffix:"end"})}])}return B0(F?[{data:$k(F)?n.requestDataName(Kf):n.requestDataName(MC),field:n.vgField(i),sort:F}]:[{data:n.requestDataName(Kf),field:n.vgField(i)}])}function RN(e,t){const{op:n,field:i,order:a}=e;return Object.assign(Object.assign({op:n??(t?"sum":mC)},i?{field:eb(i)}:{}),a?{order:a}:{})}function Yre(e,t){var n;const i=e.component.scales[t],a=e.specifiedScales[t].domain,f=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin,g=uj(a)&&a,x=pE(f)&&lC(f.extent)&&f.extent;(g||x)&&i.set("selectionExtent",g??x,!0)}function Xz(e,t){const{aggregate:n,type:i}=e;return n?Qo(n)&&!_Z[n]?{valid:!1,reason:oe.unaggregateDomainWithNonSharedDomainOp(n)}:i==="quantitative"&&t==="log"?{valid:!1,reason:oe.unaggregatedDomainWithLogScale(e)}:{valid:!0}:{valid:!1,reason:oe.unaggregateDomainHasNoEffectForRawField(e)}}function PN(e,t,n,i){return e.explicit&&t.explicit&&si(oe.mergeConflictingDomainProperty(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function LN(e){if(lb(e)&&Qo(e.field))return e.field;if(function(t){return!io(t)&&"fields"in t&&!("data"in t)}(e)){let t;for(const n of e.fields)if(lb(n)&&Qo(n.field))if(t){if(t!==n.field)return si(oe.FACETED_INDEPENDENT_DIFFERENT_SOURCES),t}else t=n.field;return si(oe.FACETED_INDEPENDENT_SAME_FIELDS_DIFFERENT_SOURCES),t}if(function(t){return!io(t)&&"fields"in t&&"data"in t}(e)){si(oe.FACETED_INDEPENDENT_SAME_SOURCE);const t=e.fields[0];return Qo(t)?t:void 0}}function XC(e,t){return function(n){const i=Q1(n.map(k=>lb(k)?Yi(k,["sort"]):k),Na),a=Q1(n.map(k=>{if(lb(k)){const F=k.sort;return F===void 0||$k(F)||("op"in F&&F.op==="count"&&delete F.field,F.order==="ascending"&&delete F.order),F}}).filter(k=>k!==void 0),Na);if(i.length===0)return;if(i.length===1){const k=n[0];if(lb(k)&&a.length>0){let F=a[0];if(a.length>1)si(oe.MORE_THAN_ONE_SORT),F=!0;else if(yl(F)&&"field"in F){const V=F.field;k.field===V&&(F=!F.order||{order:F.order})}return Object.assign(Object.assign({},k),{sort:F})}return k}const f=Q1(a.map(k=>$k(k)||!("op"in k)||k.op in bZ?k:(si(oe.domainSortDropped(k)),!0)),Na);let g;f.length===1?g=f[0]:f.length>1&&(si(oe.MORE_THAN_ONE_SORT),g=!0);const x=Q1(n.map(k=>lb(k)?k.data:null),k=>k);return x.length===1&&x[0]!==null?Object.assign({data:x[0],fields:i.map(k=>k.field)},g?{sort:g}:{}):Object.assign({fields:i},g?{sort:g}:{})}(e.component.scales[t].get("domains").map(n=>(lb(n)&&(n.data=e.lookupDataSource(n.data)),n)))}function Kz(e){return ci(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const a=i.combine(),{name:f,type:g,selectionExtent:x,domains:k,range:F,reverse:V}=a,X=Yi(a,["name","type","selectionExtent","domains","range","reverse"]),te=function(ye,Pe,Ue){return sy(Ue)&&cb(ye)?{step:{signal:Pe+"_step"}}:ye}(a.range,f,n);let se;x&&(se=function(ye,Pe){const Ue=Pe.selection;return{signal:dz(ye.getSelectionComponent(Ue,gu(Ue)),Pe)}}(e,x));const he=XC(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:f,type:g},he?{domain:he}:{}),se?{domainRaw:se}:{}),{range:te}),V!==void 0?{reverse:V}:{}),X)),t},[])}class Yz extends o1{constructor(t,n){super({},{name:t}),this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1||uE(this.get("domains"),t=>io(t)&&t.length===2&&t[0]<=0&&t[1]>=0)}}const Jre=["range","scheme"];function Jz(e){return e==="x"?"width":e==="y"?"height":void 0}function Qz(e,t){const n=e.fieldDef(t);if(n&&n.bin&&Ws(n.bin)){const i=TN(e,n.field,n.bin),a=Jz(t),f=e.getName(a);return new Rm(()=>{const g=e.getSignalName(i),x=`(${g}.stop - ${g}.start) / ${g}.step`;return`${e.getSignalName(f)} / (${x})`})}}function Qre(e,t){const n=t.specifiedScales[e],{size:i}=t,a=t.getScaleComponent(e).get("type");for(const f of Jre)if(n[f]!==void 0){const g=cj(a,f),x=lj(e,f);if(g)if(x)si(x);else switch(f){case"range":return io(n.range)&&sy(e)?Ax(n.range.map(k=>{if(k==="width"||k==="height"){const F=t.getName(k),V=t.getSignalName.bind(t);return Rm.fromName(V,F)}return k})):Ax(n.range);case"scheme":return Ax(Zre(n[f]))}else si(oe.scalePropertyNotWorkWithScaleType(a,f,e))}if(e===Cu||e===Vc){const f=e===Cu?"width":"height",g=i[f];if(dy(g)){if(Ep(a))return Ax({step:g.step});si(oe.stepDropped(f))}}return B0(function(f,g){const{size:x,config:k,mark:F,encoding:V}=g,X=g.getSignalName.bind(g),{type:te}=Hc(V[f]),se=g.getScaleComponent(f).get("type"),{domain:he,domainMid:ye}=g.specifiedScales[f];switch(f){case Cu:case Vc:{if(co(["point","band"],se))if(f!==Cu||x.width){if(f===Vc&&!x.height){const We=wE(k.view,"height");if(dy(We))return We}}else{const We=wE(k.view,"width");if(dy(We))return We}const Pe=Jz(f),Ue=g.getName(Pe);return f===Vc&&Fg(se)?[Rm.fromName(X,Ue),0]:[0,Rm.fromName(X,Ue)]}case t1:{const Pe=g.component.scales[f].get("zero"),Ue=function at(st,lt,ct){if(lt)return Eo(lt)?{signal:`${lt.signal} ? 0 : ${at(st,!1,ct)}`}:0;switch(st){case"bar":case"tick":return ct.scale.minBandSize;case"line":case"trail":case"rule":return ct.scale.minStrokeWidth;case"text":return ct.scale.minFontSize;case"point":case"square":case"circle":return ct.scale.minSize}throw new Error(oe.incompatibleChannel("size",st))}(F,Pe,k),We=function(at,st,lt,ct){const Ct={x:Qz(lt,"x"),y:Qz(lt,"y")};switch(at){case"bar":case"tick":{if(ct.scale.maxBandSize!==void 0)return ct.scale.maxBandSize;const Et=e7(st,Ct,ct.view);return wc(Et)?Et-1:new Rm(()=>`${Et.signal} - 1`)}case"line":case"trail":case"rule":return ct.scale.maxStrokeWidth;case"text":return ct.scale.maxFontSize;case"point":case"square":case"circle":{if(ct.scale.maxSize)return ct.scale.maxSize;const Et=e7(st,Ct,ct.view);return wc(Et)?Math.pow(Zz*Et,2):new Rm(()=>`pow(${Zz} * ${Et.signal}, 2)`)}}throw new Error(oe.incompatibleChannel("size",at))}(F,x,g,k);return dC(se)?function(at,st,lt){const ct=()=>{const Ct=xE(st),Et=xE(at),gn=`(${Ct} - ${Et}) / (${lt} - 1)`;return`sequence(${Et}, ${Ct} + ${gn}, ${gn})`};return Eo(st)?new Rm(ct):{signal:ct()}}(Ue,We,function(at,st,lt,ct){switch(at){case"quantile":return st.scale.quantileCount;case"quantize":return st.scale.quantizeCount;case"threshold":return lt!==void 0&&io(lt)?lt.length+1:(si(oe.domainRequiredForThresholdScale(ct)),3)}}(se,k,he,f)):[Ue,We]}case R0:return[0,2*Math.PI];case vx:return[0,360];case ey:return[0,new Rm(()=>{const Pe=g.getSignalName("width"),Ue=g.getSignalName("height");return`min(${Pe},${Ue})/2`})];case ib:return[k.scale.minStrokeWidth,k.scale.maxStrokeWidth];case ob:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case _p:return"symbol";case wp:case ry:case iy:return se==="ordinal"?te==="nominal"?"category":"ordinal":ye!==void 0?"diverging":F==="rect"||F==="geoshape"?"heatmap":"ramp";case n1:case nb:case rb:return[k.scale.minOpacity,k.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${f}`)}(e,t))}function Zre(e){return function(t){return!Qo(t)&&!!t.name}(e)?Object.assign({scheme:e.name},Ky(e,["name"])):{scheme:e}}const Zz=.95;function e7(e,t,n){const i=dy(e.width)?e.width.step:CC(n,"width"),a=dy(e.height)?e.height.step:CC(n,"height");return t.x||t.y?new Rm(()=>`min(${[t.x?t.x.signal:i,t.y?t.y.signal:a].join(", ")})`):Math.min(i,a)}function t7(e,t){ju(e)?function(n,i){const a=n.component.scales,{config:f,encoding:g,markDef:x,specifiedScales:k}=n;for(const F of ci(a)){const V=k[F],X=a[F],te=n.getScaleComponent(F),se=Hc(g[F]),he=V[i],ye=te.get("type"),Pe=te.get("padding"),Ue=te.get("paddingInner"),We=cj(ye,i),at=lj(F,i);if(he!==void 0&&(We?at&&si(at):si(oe.scalePropertyNotWorkWithScaleType(ye,i,F))),We&&at===void 0)if(he!==void 0)X.copyKeyFromObject(i,V);else{const st=i in n7?n7[i]({model:n,channel:F,fieldOrDatumDef:se,scaleType:ye,scalePadding:Pe,scalePaddingInner:Ue,domain:V.domain,markDef:x,config:f}):f.scale[i];st!==void 0&&X.set(i,st,!1)}}}(e,t):i7(e,t)}const n7={bins:({model:e,fieldOrDatumDef:t})=>xi(t)?function(n,i){const a=i.bin;if(Ws(a)){const f=TN(n,i.field,a);return new Rm(()=>n.getSignalName(f))}if(ch(a)&&pE(a)&&a.step!==void 0)return{step:a.step}}(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>function(n,i){if(co([wp,ry,iy],n)&&i!=="nominal")return"hcl"}(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>function(i,a,f){var g;if(!(!((g=fy(f))===null||g===void 0)&&g.bin||co([Ec.TIME,Ec.UTC],i)))return a in sb||void 0}(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:a})=>function(f,g,x,k,F,V){if(f in sb){if(L0(g)){if(x.continuousPadding!==void 0)return x.continuousPadding;const{type:X,orient:te}=F;if(X==="bar"&&(!xi(k)||!k.bin&&!k.timeUnit)&&(te==="vertical"&&f==="x"||te==="horizontal"&&f==="y"))return V.continuousBandSize}if(g===Ec.POINT)return x.pointPadding}}(e,t,a.scale,n,i,a.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:i})=>function(a,f,g,x){if(a===void 0&&f in sb){const{bandPaddingInner:k,barBandPaddingInner:F,rectBandPaddingInner:V}=x;return _c(k,g==="bar"?F:V)}}(e,t,n.type,i.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:i,scalePaddingInner:a,config:f})=>function(g,x,k,F,V,X){if(g===void 0&&x in sb&&k===Ec.BAND){const{bandPaddingOuter:te}=X;return _c(te,Eo(V)?{signal:`${V.signal}/2`}:V/2)}}(e,t,n,i.type,a,f.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>function(a,f,g,x){if(g==="x"&&x.xReverse!==void 0)return Fg(a)&&f==="descending"?Eo(x.xReverse)?{signal:`!${x.xReverse.signal}`}:!x.xReverse:x.xReverse;if(Fg(a)&&f==="descending")return!0}(t,xi(e)?e.sort:void 0,n,i.scale),zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:a})=>function(f,g,x,k,F){if(x&&x!=="unaggregated"&&Fg(F)){if(io(x)){const V=x[0],X=x[x.length-1];if(V<=0&&X>=0)return!0}return!1}if(f==="size"&&g.type==="quantitative"&&!dC(F))return!0;if((!xi(g)||!g.bin)&&co([...Ig,...TZ],f)){const{orient:V,type:X}=k;return!co(["bar","area","line","trail"],X)||!(V==="horizontal"&&f==="y"||V==="vertical"&&f==="x")}return!1}(e,t,n,i,a)};function r7(e){ju(e)?function(t){const n=t.component.scales;for(const i of uC){const a=n[i];if(!a)continue;const f=Qre(i,t);a.setWithExplicit("range",f)}}(e):i7(e,"range")}function i7(e,t){const n=e.component.scales;for(const i of e.children)t==="range"?r7(i):t7(i,t);for(const i of ci(n)){let a;for(const f of e.children){const g=f.component.scales[i];g&&(a=pb(a,g.getWithExplicit(t),t,"scale",E9((x,k)=>{switch(t){case"range":return x.step&&k.step?x.step-k.step:0}return 0})))}n[i].setWithExplicit(t,a)}}function eie(e,t,n,i){const a=function(g,x,k){var F;switch(x.type){case"nominal":case"ordinal":if(Bw(g)||cC(g)==="discrete")return g==="shape"&&x.type==="ordinal"&&si(oe.discreteChannelCannotEncode(g,"ordinal")),"ordinal";if(g in sb){if(co(["rect","bar","image","rule"],k))return"band"}else if(k==="arc"&&g in d4)return"band";return x.band!==void 0||R4(x)&&(!((F=x.axis)===null||F===void 0)&&F.tickBand)?"band":"point";case"temporal":return Bw(g)?"time":cC(g)==="discrete"?(si(oe.discreteChannelCannotEncode(g,"temporal")),"ordinal"):xi(x)&&x.timeUnit&&lh(x.timeUnit).utc?"utc":"time";case"quantitative":return Bw(g)?xi(x)&&Ws(x.bin)?"bin-ordinal":"linear":cC(g)==="discrete"?(si(oe.discreteChannelCannotEncode(g,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(oe.invalidFieldType(x.type))}(t,n,i),{type:f}=e;return ub(t)?f!==void 0?dj(t,f)?xi(n)&&!fj(f,n.type)?(si(oe.scaleTypeNotWorkWithFieldDef(f,a)),a):f:(si(oe.scaleTypeNotWorkWithChannel(t,f,a)),a):a:null}function o7(e){ju(e)?e.component.scales=function(t){const{encoding:n,mark:i}=t;return uC.reduce((a,f)=>{const g=Hc(n[f]);if(g&&i===D8&&f===_p&&g.type===Ww)return a;let x=g&&g.scale;if(g&&x!==null&&x!==!1){const k=eie(x=x??{},f,g,i);a[f]=new Yz(t.scaleName(f+"",!0),{value:k,explicit:x.type===k})}return a},{})}(e):e.component.scales=function(t){var n;const i=t.component.scales={},a={},f=t.component.resolve;for(const g of t.children){o7(g);for(const x of ci(g.component.scales))if(f.scale[x]=(n=f.scale[x])!==null&&n!==void 0?n:Sre(x,t),f.scale[x]==="shared"){const k=a[x],F=g.component.scales[x].getWithExplicit("type");k?ute(k.value,F.value)?a[x]=pb(k,F,"type","scale",tie):(f.scale[x]="independent",delete a[x]):a[x]=F}}for(const g of ci(a)){const x=t.scaleName(g,!0),k=a[g];i[g]=new Yz(x,k);for(const F of t.children){const V=F.component.scales[g];V&&(F.renameScale(V.get("name"),x),V.merged=!0)}}return i}(e)}const tie=E9((e,t)=>aj(e)-aj(t));class BN{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function ju(e){return(e==null?void 0:e.type)==="unit"}function W0(e){return(e==null?void 0:e.type)==="facet"}function jN(e){return(e==null?void 0:e.type)==="concat"}function Zw(e){return(e==null?void 0:e.type)==="layer"}class zN{constructor(t,n,i,a,f,g,x){var k,F;this.type=n,this.parent=i,this.config=f,this.view=x,this.children=[],this.correctDataNames=V=>(V.from&&V.from.data&&(V.from.data=this.lookupDataSource(V.from.data)),V.from&&V.from.facet&&V.from.facet.data&&(V.from.facet.data=this.lookupDataSource(V.from.facet.data)),V),this.parent=i,this.config=f,this.name=(k=t.name)!==null&&k!==void 0?k:a,this.title=hb(t.title)?{text:t.title}:t.title,this.scaleNameMap=i?i.scaleNameMap:new BN,this.projectionNameMap=i?i.projectionNameMap:new BN,this.signalNameMap=i?i.signalNameMap:new BN,this.data=t.data,this.description=t.description,this.transforms=cne((F=t.transform)!==null&&F!==void 0?F:[]),this.layout=n==="layer"||n==="unit"?{}:function(V,X,te){var se,he;const ye=te[X],Pe={},{spacing:Ue,columns:We}=ye;Ue!==void 0&&(Pe.spacing=Ue),We!==void 0&&(gC(V)&&!vE(V.facet)||K4(V))&&(Pe.columns=We),kC(V)&&(Pe.columns=1);for(const at of Mte)if(V[at]!==void 0)if(at==="spacing"){const st=V[at];Pe[at]=wc(st)?st:{row:(se=st.row)!==null&&se!==void 0?se:Ue,column:(he=st.column)!==null&&he!==void 0?he:Ue}}else Pe[at]=V[at];return Pe}(t,n,f),this.component={data:{sources:i?i.component.data.sources:[],outputNodes:i?i.component.data.outputNodes:{},outputNodeRefCounts:i?i.component.data.outputNodeRefCounts:{},isFaceted:gC(t)||i&&i.component.data.isFaceted&&t.data===void 0},layoutSize:new o1,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},g?Zo(g):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){(function(t,{ignoreRange:n}={}){o7(t),$z(t);for(const i of vte)t7(t,i);n||r7(t)})(this)}parseProjection(){Uz(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){Rz(this)}assembleGroupStyle(){var t,n;if(this.type==="unit"||this.type==="layer")return(n=(t=this.view)===null||t===void 0?void 0:t.style)!==null&&n!==void 0?n:"cell"}assembleEncodeFromView(t){const n=Yi(t,["style"]),i={};for(const a of ci(n)){const f=n[a];f!==void 0&&(i[a]=ic(f))}return i}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),t||(this.description&&(n.description=ic(this.description)),this.type!=="unit"&&this.type!=="layer")?As(n)?void 0:n:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},n??{})}assembleLayout(){if(!this.layout)return;const t=this.layout,{spacing:n}=t,i=Yi(t,["spacing"]),{component:a,config:f}=this,g=function(x,k){const F={};for(const V of Ng){const X=x[V];if(X!=null&&X.facetFieldDef){const{titleAnchor:te,titleOrient:se}=HC(["titleAnchor","titleOrient"],X.facetFieldDef,k,V),he=VC(V,se),ye=Ere(te,he);ye!==void 0&&(F[he]=ye)}}return As(F)?void 0:F}(a.layoutHeaders,f);return Object.assign(Object.assign(Object.assign({padding:n},this.assembleDefaultLayout()),i),g?{titleBand:g}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const i of Ng)t[i].title&&n.push(bre(this,i));for(const i of EN)n=n.concat(xre(this,i));return n}assembleAxes(){return function(t,n){const{x:i=[],y:a=[]}=t;return[...i.map(f=>FE(f,"grid",n)),...a.map(f=>FE(f,"grid",n)),...i.map(f=>FE(f,"main",n)),...a.map(f=>FE(f,"main",n))].filter(f=>f)}(this.component.axes,this.config)}assembleLegends(){return Bz(this)}assembleProjections(){return Nre(this)}assembleTitle(){var t,n,i;const a=(t=this.title)!==null&&t!==void 0?t:{},{encoding:f}=a,g=Yi(a,["encoding"]),x=Object.assign(Object.assign(Object.assign({},Lj(this.config.title).nonMark),g),f?{encode:{update:f}}:{});if(x.text)return co(["unit","layer"],this.type)?co(["middle",void 0],x.anchor)&&(x.frame=(n=x.frame)!==null&&n!==void 0?n:"group"):x.anchor=(i=x.anchor)!==null&&i!==void 0?i:"start",As(x)?void 0:x}assembleGroup(t=[]){const n={};(t=t.concat(this.assembleSignals())).length>0&&(n.signals=t);const i=this.assembleLayout();i&&(n.layout=i),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const a=!this.parent||W0(this.parent)?function x(k){return Zw(k)||jN(k)?k.children.reduce((F,V)=>F.concat(x(V)),Kz(k)):Kz(k)}(this):[];a.length>0&&(n.scales=a);const f=this.assembleAxes();f.length>0&&(n.axes=f);const g=this.assembleLegends();return g.length>0&&(n.legends=g),n}getName(t){return gu((this.name?this.name+"_":"")+t)}requestDataName(t){var n;const i=this.getName(t),a=this.component.data.outputNodeRefCounts;return a[i]=((n=a[i])!==null&&n!==void 0?n:0)+1,i}getSizeSignalRef(t){if(W0(this.parent)){const n=sC(Cz(t)),i=this.component.scales[n];if(i&&!i.merged){const a=i.get("type"),f=i.get("range");if(Ep(a)&&cb(f)){const g=i.get("name"),x=LN(XC(this,n));return x?{signal:kz(g,i,hi({aggregate:"distinct",field:x},{expr:"datum"}))}:(si(`Unknown field for ${n}. Cannot calculate view size.`),null)}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){return n?this.getName(t):U8(t)&&ub(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t))?this.scaleNameMap.get(this.getName(t)):void 0}projectionName(t){return t?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,n){let i=this.component.selection[t];if(!i&&this.parent&&(i=this.parent.getSelectionComponent(t,n)),!i)throw new Error(oe.selectionNotFound(n));return i}hasAxisOrientSignalRef(){var t,n;return((t=this.component.axes.x)===null||t===void 0?void 0:t.some(i=>i.hasOrientSignalRef()))||((n=this.component.axes.y)===null||n===void 0?void 0:n.some(i=>i.hasOrientSignalRef()))}}class a7 extends zN{vgField(t,n={}){const i=this.fieldDef(t);if(i)return hi(i,n)}reduceFieldDef(t,n){return Gj(this.getMapping(),(i,a,f)=>{const g=fy(a);return g?t(i,g,f):i},n)}forEachFieldDef(t,n){U4(this.getMapping(),(i,a)=>{const f=fy(i);f&&t(f,a)},n)}}class KC extends gs{constructor(t,n){var i,a,f;super(t),this.transform=n,this.transform=Zo(n);const g=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(a=g[0])!==null&&a!==void 0?a:"value",(f=g[1])!==null&&f!==void 0?f:"density"]}clone(){return new KC(null,Zo(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${Na(this.transform)}`}assemble(){const t=this.transform,{density:n}=t,i=Yi(t,["density"]);return Object.assign({type:"kde",field:n},i)}}class LE extends gs{constructor(t,n){super(t),this.filter=n}clone(){return new LE(null,Object.assign({},this.filter))}static make(t,n){const{config:i,mark:a,markDef:f}=n;if(Za("invalid",f,i)!=="filter")return null;const g=n.reduceFieldDef((x,k,F)=>{const V=ub(F)&&n.getScaleComponent(F);return V&&Fg(V.get("type"))&&k.aggregate!=="count"&&!mx(a)&&(x[k.field]=k),x},{});return ci(g).length?new LE(t,g):null}dependentFields(){return new Set(ci(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${Na(this.filter)}`}assemble(){const t=ci(this.filter).reduce((n,i)=>{const a=this.filter[i],f=hi(a,{expr:"datum"});return a!==null&&(a.type==="temporal"?n.push(`(isDate(${f}) || (isValid(${f}) && isFinite(+${f})))`):a.type==="quantitative"&&(n.push(`isValid(${f})`),n.push(`isFinite(+${f})`))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class YC extends gs{constructor(t,n){super(t),this.transform=n,this.transform=Zo(n);const{flatten:i,as:a=[]}=this.transform;this.transform.as=i.map((f,g)=>{var x;return(x=a[g])!==null&&x!==void 0?x:f})}clone(){return new YC(this.parent,Zo(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${Na(this.transform)}`}assemble(){const{flatten:t,as:n}=this.transform;return{type:"flatten",fields:t,as:n}}}class JC extends gs{constructor(t,n){var i,a,f;super(t),this.transform=n,this.transform=Zo(n);const g=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(a=g[0])!==null&&a!==void 0?a:"key",(f=g[1])!==null&&f!==void 0?f:"value"]}clone(){return new JC(null,Zo(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${Na(this.transform)}`}assemble(){const{fold:t,as:n}=this.transform;return{type:"fold",fields:t,as:n}}}class e2 extends gs{constructor(t,n,i,a){super(t),this.fields=n,this.geojson=i,this.signal=a}clone(){return new e2(null,Zo(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let i=0;for(const a of[[ny,ty],[Dg,P0]]){const f=a.map(g=>{const x=Hc(n.encoding[g]);return xi(x)?x.field:db(x)?{expr:`${x.datum}`}:r1(x)?{expr:`${x.value}`}:void 0});(f[0]||f[1])&&(t=new e2(t,f,null,n.getName(`geojson_${i++}`)))}if(n.channelHasField(_p)){const a=n.typedFieldDef(_p);a.type===Ww&&(t=new e2(t,null,a.field,n.getName(`geojson_${i++}`)))}return t}dependentFields(){var t;const n=((t=this.fields)!==null&&t!==void 0?t:[]).filter(Qo);return new Set([...this.geojson?[this.geojson]:[],...n])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${Na(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class BE extends gs{constructor(t,n,i,a){super(t),this.projection=n,this.fields=i,this.as=a}clone(){return new BE(null,this.projection,Zo(this.fields),Zo(this.as))}static parseAll(t,n){if(!n.projectionName())return t;for(const i of[[ny,ty],[Dg,P0]]){const a=i.map(g=>{const x=Hc(n.encoding[g]);return xi(x)?x.field:db(x)?{expr:`${x.datum}`}:r1(x)?{expr:`${x.value}`}:void 0}),f=i[0]===Dg?"2":"";(a[0]||a[1])&&(t=new BE(t,n.projectionName(),a,[n.getName("x"+f),n.getName("y"+f)]))}return t}dependentFields(){return new Set(this.fields.filter(Qo))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${Na(this.fields)} ${Na(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Rx extends gs{constructor(t,n){super(t),this.transform=n}clone(){return new Rx(null,Zo(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:i,step:a}=t;return{signal:`sequence(${[n,i,...a?[a]:[]].join(",")})`}}static makeFromTransform(t,n){return new Rx(t,n)}static makeFromEncoding(t,n){const i=n.encoding,a=i.x,f=i.y;if(xi(a)&&xi(f)){const g=a.impute?a:f.impute?f:void 0;if(g===void 0)return;const x=a.impute?f:f.impute?a:void 0,{method:k,value:F,frame:V,keyvals:X}=g.impute,te=qj(n.mark,i);return new Rx(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:g.field,key:x.field},k?{method:k}:{}),F!==void 0?{value:F}:{}),V?{frame:V}:{}),X!==void 0?{keyvals:X}:{}),te.length?{groupby:te}:{}))}return null}hash(){return`Impute ${Na(this.transform)}`}assemble(){const{impute:t,key:n,keyvals:i,method:a,groupby:f,value:g,frame:x=[null,null]}=this.transform,k=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:n},i?{keyvals:function(F){return(F==null?void 0:F.stop)!==void 0}(i)?this.processSequence(i):i}:{}),{method:"value"}),f?{groupby:f}:{}),{value:a&&a!=="value"?null:g});return a&&a!=="value"?[k,Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[a],fields:[t],frame:x,ignorePeers:!1},f?{groupby:f}:{}),{type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t}]:[k]}}class QC extends gs{constructor(t,n){var i,a,f;super(t),this.transform=n,this.transform=Zo(n);const g=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(a=g[0])!==null&&a!==void 0?a:n.on,(f=g[1])!==null&&f!==void 0?f:n.loess]}clone(){return new QC(null,Zo(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${Na(this.transform)}`}assemble(){const t=this.transform,{loess:n,on:i}=t,a=Yi(t,["loess","on"]);return Object.assign({type:"loess",x:i,y:n},a)}}class jE extends gs{constructor(t,n,i){super(t),this.transform=n,this.secondary=i}clone(){return new jE(null,Zo(this.transform),this.secondary)}static make(t,n,i,a){const f=n.component.data.sources,{from:g}=i;let x=null;if(function(k){return"data"in k}(g)){let k=l7(g.data,f);k||(k=new Yw(g.data),f.push(k));const F=n.getName(`lookup_${a}`);x=new fh(k,F,"lookup",n.component.data.outputNodeRefCounts),n.component.data.outputNodes[F]=x}else if(function(k){return"selection"in k}(g)){const k=g.selection;if(i=Object.assign({as:k},i),!(x=n.getSelectionComponent(gu(k),k).materialized))throw new Error(oe.noSameUnitLookup(k))}return new jE(t,i,x.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?rc(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${Na({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:rc(this.transform.as)}:{});else{let n=this.transform.as;Qo(n)||(si(oe.NO_FIELDS_NEEDS_AS),n="_lookup"),t={as:[n]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}class ZC extends gs{constructor(t,n){var i,a,f;super(t),this.transform=n,this.transform=Zo(n);const g=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(a=g[0])!==null&&a!==void 0?a:"prob",(f=g[1])!==null&&f!==void 0?f:"value"]}clone(){return new ZC(null,Zo(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${Na(this.transform)}`}assemble(){const t=this.transform,{quantile:n}=t,i=Yi(t,["quantile"]);return Object.assign({type:"quantile",field:n},i)}}class eA extends gs{constructor(t,n){var i,a,f;super(t),this.transform=n,this.transform=Zo(n);const g=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(a=g[0])!==null&&a!==void 0?a:n.on,(f=g[1])!==null&&f!==void 0?f:n.regression]}clone(){return new eA(null,Zo(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${Na(this.transform)}`}assemble(){const t=this.transform,{regression:n,on:i}=t,a=Yi(t,["regression","on"]);return Object.assign({type:"regression",x:i,y:n},a)}}class tA extends gs{constructor(t,n){super(t),this.transform=n}clone(){return new tA(null,Zo(this.transform))}addDimensions(t){var n;this.transform.groupby=Q1(((n=this.transform.groupby)!==null&&n!==void 0?n:[]).concat(t),i=>i)}producedFields(){}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}hash(){return`PivotTransform ${Na(this.transform)}`}assemble(){const{pivot:t,value:n,groupby:i,limit:a,op:f}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:n},a!==void 0?{limit:a}:{}),f!==void 0?{op:f}:{}),i!==void 0?{groupby:i}:{})}}class nA extends gs{constructor(t,n){super(t),this.transform=n}clone(){return new nA(null,Zo(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${Na(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function s7(e){let t=0;return function n(i,a){var f;if(i instanceof Yw&&!i.isGenerator&&!_E(i.data)&&(e.push(a),a={name:null,source:a.name,transform:[]}),i instanceof ed&&(i.parent instanceof Yw&&!a.source?(a.format=Object.assign(Object.assign({},(f=a.format)!==null&&f!==void 0?f:{}),{parse:i.assembleFormatParse()}),a.transform.push(...i.assembleTransforms(!0))):a.transform.push(...i.assembleTransforms())),i instanceof Jw){a.name||(a.name=`data_${t++}`),!a.source||a.transform.length>0?(e.push(a),i.data=a.name):i.data=a.source;for(const g of i.assemble())e.push(g)}else switch((i instanceof RE||i instanceof PE||i instanceof LE||i instanceof qw||i instanceof $w||i instanceof BE||i instanceof e2||i instanceof z0||i instanceof jE||i instanceof Qw||i instanceof Fx||i instanceof JC||i instanceof YC||i instanceof KC||i instanceof QC||i instanceof ZC||i instanceof eA||i instanceof yb||i instanceof nA||i instanceof tA)&&a.transform.push(i.assemble()),(i instanceof my||i instanceof hy||i instanceof Rx||i instanceof l1)&&a.transform.push(...i.assemble()),i instanceof fh&&(a.source&&a.transform.length===0?i.setSource(a.source):i.parent instanceof fh?i.setSource(a.name):(a.name||(a.name=`data_${t++}`),i.setSource(a.name),i.numChildren()===1&&(e.push(a),a={name:null,source:a.name,transform:[]}))),i.numChildren()){case 0:i instanceof fh&&(!a.source||a.transform.length>0)&&e.push(a);break;case 1:n(i.children[0],a);break;default:{a.name||(a.name=`data_${t++}`);let g=a.name;!a.source||a.transform.length>0?e.push(a):g=a.source;for(const x of i.children)n(x,{name:null,source:g,transform:[]});break}}}}function nie(e){return e==="top"||e==="left"||Eo(e)?"header":"footer"}function rie(e,t){var n;const{facet:i,config:a,child:f,component:g}=e;if(e.channelHasField(t)){const x=i[t],k=Kw("title",null,a,t);let F=Ex(x,a,{allowDisabling:!0,includeDefault:k===void 0||!!k});f.component.layoutHeaders[t].title&&(F=io(F)?F.join(", "):F,F+=" / "+f.component.layoutHeaders[t].title,f.component.layoutHeaders[t].title=null);const V=Kw("labelOrient",x,a,t),X=_c(((n=x.header)!==null&&n!==void 0?n:{}).labels,a.header.labels,!0),te=co(["bottom","right"],V)?"footer":"header";g.layoutHeaders[t]={title:F,facetFieldDef:x,[te]:t==="facet"?[]:[u7(e,t,X)]}}}function u7(e,t,n){const i=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function c7(e,t){var n;const{child:i}=e;if(i.component.axes[t]){const{layoutHeaders:a,resolve:f}=e.component;if(f.axis[t]=AN(f,t),f.axis[t]==="shared"){const g=t==="x"?"column":"row",x=a[g];for(const k of i.component.axes[t]){const F=nie(k.get("orient"));x[F]=(n=x[F])!==null&&n!==void 0?n:[u7(e,g,!1)];const V=FE(k,"main",e.config,{header:!0});V&&x[F][0].axes.push(V),k.mainExtracted=!0}}}}function iie(e){UN(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";rA(e,t),rA(e,n)}function UN(e){for(const t of e.children)t.parseLayoutSize()}function rA(e,t){const n=Cz(t),i=sC(n),a=e.component.resolve,f=e.component.layoutSize;let g;for(const x of e.children){const k=x.component.layoutSize.getWithExplicit(n),F=a.scale[i];if(F==="independent"&&k.value==="step"){g=void 0;break}if(g){if(F==="independent"&&g.value!==k.value){g=void 0;break}g=pb(g,k,n,"")}else g=k}if(g){for(const x of e.children)e.renameSignal(x.getName(n),e.getName(t)),x.component.layoutSize.set(n,"merged",!1);f.setWithExplicit(t,g)}else f.setWithExplicit(t,{explicit:!1,value:void 0})}function oie(e,t){const n=t==="width"?"x":"y",i=e.config,a=e.getScaleComponent(n);if(a){const f=a.get("type"),g=a.get("range");if(Ep(f)){const x=wE(i.view,t);return cb(g)||dy(x)?"step":x}return J4(i.view,t)}if(e.hasProjection||e.mark==="arc")return J4(i.view,t);{const f=wE(i.view,t);return dy(f)?f.step:f}}function WN(e,t,n){return hi(t,Object.assign({suffix:`by_${hi(e)}`},n??{}))}class zE extends a7{constructor(t,n,i,a){super(t,"facet",n,i,a,t.resolve),this.child=qN(t.spec,this,this.getName("child"),void 0,a),this.children=[this.child],this.facet=this.initFacet(t.facet,a)}initFacet(t,n){return vE(t)?Gj(t,(i,a,f)=>co([Jy,Qy],f)?a.field===void 0?(si(oe.emptyFieldDef(a,f)),i):(i[f]=L4(a,f,n),i):(si(oe.incompatibleChannel(f,"facet")),i),{}):{facet:L4(t,"facet",n)}}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=iA(this),this.child.parseData()}parseLayoutSize(){UN(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(t){for(const n of Ng)rie(t,n);c7(t,"x"),c7(t,"y")}(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,n,i;const a={};for(const f of Ng)for(const g of SN){const x=this.component.layoutHeaders[f],k=x[g],{facetFieldDef:F}=x;if(F){const V=Kw("titleOrient",F,this.config,f);if(co(["right","bottom"],V)){const X=VC(f,V);a.titleAnchor=(t=a.titleAnchor)!==null&&t!==void 0?t:{},a.titleAnchor[X]="end"}}if(k!=null&&k[0]){const V=f==="row"?"height":"width",X=g==="header"?"headerBand":"footerBand";f==="facet"||this.child.component.layoutSize.get(V)||(a[X]=(n=a[X])!==null&&n!==void 0?n:{},a[X][f]=.5),x.title&&(a.offset=(i=a.offset)!==null&&i!==void 0?i:{},a.offset[f==="row"?"rowTitle":"columnTitle"]=10)}}return a}assembleDefaultLayout(){const{column:t,row:n}=this.facet,i=t?this.columnDistinctSignal():n?1:void 0;let a="all";return(n||this.component.resolve.scale.x!=="independent")&&(t||this.component.resolve.scale.y!=="independent")||(a="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),i?{columns:i}:{}),{bounds:"full",align:a})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof zE))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroup(t){return this.parent&&this.parent instanceof zE?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:hi(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t)):super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],i=[];if(this.child instanceof zE){if(this.child.channelHasField("column")){const a=hi(this.child.facet.column);t.push(a),n.push("distinct"),i.push(`distinct_${a}`)}}else for(const a of Ig){const f=this.child.component.scales[a];if(f&&!f.merged){const g=f.get("type"),x=f.get("range");if(Ep(g)&&cb(x)){const k=LN(XC(this.child,a));k?(t.push(k),n.push("distinct"),i.push(`distinct_${k}`)):si(`Unknown field for ${a}. Cannot calculate view size.`)}}}return{fields:t,ops:n,as:i}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:i,column:a}=this.facet,{fields:f,ops:g,as:x}=this.getCardinalityAggregateForChild(),k=[];for(const V of Ng){const X=this.facet[V];if(X){k.push(hi(X));const{bin:te,sort:se}=X;if(Ws(te)&&k.push(hi(X,{binSuffix:"end"})),cy(se)){const{field:he,op:ye=mC}=se,Pe=WN(X,se);i&&a?(f.push(Pe),g.push("max"),x.push(Pe)):(f.push(he),g.push(ye),x.push(Pe))}else if(io(se)){const he=Xw(X,V);f.push(he),g.push("max"),x.push(he)}}}const F=!!i&&!!a;return Object.assign({name:t,data:n,groupby:k},F||f.length>0?{aggregate:Object.assign(Object.assign({},F?{cross:F}:{}),f.length?{fields:f,ops:g,as:x}:{})}:{})}facetSortFields(t){const{facet:n}=this,i=n[t];return i?cy(i.sort)?[WN(i,i.sort,{expr:"datum"})]:io(i.sort)?[Xw(i,t,{expr:"datum"})]:[hi(i,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,i=n[t];if(i){const{sort:a}=i;return[(cy(a)?a.order:!io(a)&&a)||"ascending"]}return[]}assembleLabelTitle(){const{facet:t,config:n}=this;if(t.facet)return kN(t.facet,"facet",n);const i={row:["top","bottom"],column:["left","right"]};for(const a of EN)if(t[a]){const f=Kw("labelOrient",t[a],n,a);if(co(i[a],f))return kN(t[a],a,n)}}assembleMarks(){const{child:t}=this,n=function(g){const x=[],k=s7(x);for(const F of g.children)k(F,{source:g.name,name:null,transform:[]});return x}(this.component.data.facetRoot),i=t.assembleGroupEncodeEntry(!1),a=this.assembleLabelTitle()||t.assembleTitle(),f=t.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},a?{title:a}:{}),f?{style:f}:{}),{from:{facet:this.assembleFacet()},sort:{field:Ng.map(g=>this.facetSortFields(g)).flat(),order:Ng.map(g=>this.facetSortOrder(g)).flat()}}),n.length>0?{data:n}:{}),i?{encode:{update:i}}:{}),t.assembleGroup(function(g,x){if(g.component.selection&&ci(g.component.selection).length){const k=ka(g.getName("cell"));x.unshift({name:"facet",value:{},on:[{events:fx("mousemove","scope"),update:`isTuple(facet) ? facet : group(${k}).datum`}]})}return uN(x)}(this,[])))]}getMapping(){return this.facet}}function l7(e,t){var n,i,a,f,g,x,k,F,V,X;for(const te of t){const se=te.data;if((!e.name||!te.hasName()||e.name===te.dataName)&&!(!((n=e.format)===null||n===void 0)&&n.mesh&&(!((i=se.format)===null||i===void 0)&&i.feature)||(!((a=e.format)===null||a===void 0)&&a.feature||!((f=se.format)===null||f===void 0)&&f.feature)&&((g=e.format)===null||g===void 0?void 0:g.feature)!==((x=se.format)===null||x===void 0?void 0:x.feature)||(!((k=e.format)===null||k===void 0)&&k.mesh||!((F=se.format)===null||F===void 0)&&F.mesh)&&((V=e.format)===null||V===void 0?void 0:V.mesh)!==((X=se.format)===null||X===void 0?void 0:X.mesh))){if(TC(e)&&TC(se)){if(aE(e.values,se.values))return te}else if(_E(e)&&_E(se)){if(e.url===se.url)return te}else if(S9(e)&&e.name===te.dataName)return te}}return null}function aie(e,t){if(e.data||!e.parent){if(e.data===null){const i=new Yw({values:[]});return t.push(i),i}const n=l7(e.data,t);if(n)return Ox(e.data)||(n.data.format=function(i,...a){for(const f of a)oZ(i,f??{});return i}({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const i=new Yw(e.data);return t.push(i),i}}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function iA(e){var t,n,i,a,f,g,x,k,F,V;let X=aie(e,e.component.data.sources);const{outputNodes:te,outputNodeRefCounts:se}=e.component.data,he=e.parent?e.parent.component.data.ancestorParse.clone():new Gte,ye=e.data;Ox(ye)?(k9(ye)?X=new PE(X,ye.sequence):nN(ye)&&(X=new RE(X,ye.graticule)),he.parseNothing=!0):((t=ye==null?void 0:ye.format)===null||t===void 0?void 0:t.parse)===null&&(he.parseNothing=!0),X=(n=ed.makeExplicit(X,e,he))!==null&&n!==void 0?n:X,X=new yb(X);const Pe=e.parent&&Zw(e.parent);(ju(e)||W0(e))&&Pe&&(X=(i=my.makeFromEncoding(X,e))!==null&&i!==void 0?i:X),e.transforms.length>0&&(X=function(Et,gn,An){var wn,$n;let qn=0;for(const er of gn.transforms){let rr,lr;if(nne(er))rr=Et=new $w(Et,er),lr="derived";else if(A9(er)){const Or=Rre(er);rr=Et=(wn=ed.makeWithAncestors(Et,{},Or,An))!==null&&wn!==void 0?wn:Et,Et=new qw(Et,gn,er.filter)}else if(rne(er))rr=Et=my.makeFromTransform(Et,er,gn),lr="number";else if(one(er))lr="date",An.getWithExplicit(er.field).value===void 0&&(Et=new ed(Et,{[er.field]:lr}),An.set(er.field,lr,!1)),rr=Et=hy.makeFromTransform(Et,er);else if(ane(er))rr=Et=z0.makeFromTransform(Et,er),lr="number",lN(gn)&&(Et=new yb(Et));else if(qte(er))rr=Et=jE.make(Et,gn,er,qn++),lr="derived";else if(Zte(er))rr=Et=new Qw(Et,er),lr="number";else if(ene(er))rr=Et=new Fx(Et,er),lr="number";else if(sne(er))rr=Et=l1.makeFromTransform(Et,er),lr="derived";else if(une(er))rr=Et=new JC(Et,er),lr="derived";else if(tne(er))rr=Et=new YC(Et,er),lr="derived";else if($te(er))rr=Et=new tA(Et,er),lr="derived";else if(Qte(er))Et=new nA(Et,er);else if(ine(er))rr=Et=Rx.makeFromTransform(Et,er),lr="derived";else if(Xte(er))rr=Et=new KC(Et,er),lr="derived";else if(Kte(er))rr=Et=new ZC(Et,er),lr="derived";else if(Yte(er))rr=Et=new eA(Et,er),lr="derived";else{if(!Jte(er)){si(oe.invalidTransformIgnored(er));continue}rr=Et=new QC(Et,er),lr="derived"}if(rr&&lr!==void 0)for(const Or of($n=rr.producedFields())!==null&&$n!==void 0?$n:[])An.set(Or,lr,!1)}return Et}(X,e,he));const Ue=function(Et){const gn={};if(ju(Et)&&Et.component.selection)for(const An of ci(Et.component.selection)){const wn=Et.component.selection[An];for(const $n of wn.project.items)!$n.channel&&lE($n.field)>1&&(gn[$n.field]="flatten")}return gn}(e),We=Pre(e);X=(a=ed.makeWithAncestors(X,{},Object.assign(Object.assign({},Ue),We),he))!==null&&a!==void 0?a:X,ju(e)&&(X=e2.parseAll(X,e),X=BE.parseAll(X,e)),(ju(e)||W0(e))&&(Pe||(X=(f=my.makeFromEncoding(X,e))!==null&&f!==void 0?f:X),X=(g=hy.makeFromEncoding(X,e))!==null&&g!==void 0?g:X,X=$w.parseAllForSortIndex(X,e));const at=e.getName(MC),st=new fh(X,at,MC,se);if(te[at]=st,X=st,ju(e)){const Et=z0.makeFromEncoding(X,e);Et&&(X=Et,lN(e)&&(X=new yb(X))),X=(x=Rx.makeFromEncoding(X,e))!==null&&x!==void 0?x:X,X=(k=l1.makeFromEncoding(X,e))!==null&&k!==void 0?k:X}ju(e)&&(X=(F=LE.make(X,e))!==null&&F!==void 0?F:X);const lt=e.getName(Kf),ct=new fh(X,lt,Kf,se);te[lt]=ct,X=ct,ju(e)&&function(Et,gn){Mx(Et,An=>{const wn=An.name,$n=Et.getName(`lookup_${wn}`);Et.component.data.outputNodes[$n]=An.materialized=new fh(new qw(gn,Et,{selection:wn}),$n,"lookup",Et.component.data.outputNodeRefCounts)})}(e,ct);let Ct=null;if(W0(e)){const Et=e.getName("facet");X=(V=function(gn,An){const{row:wn,column:$n}=An;if(wn&&$n){let qn=null;for(const er of[wn,$n])if(cy(er.sort)){const{field:rr,op:lr=mC}=er.sort;gn=qn=new Fx(gn,{joinaggregate:[{op:lr,field:rr,as:WN(er,er.sort,{forAs:!0})}],groupby:[hi(er)]})}return qn}return null}(X,e.facet))!==null&&V!==void 0?V:X,Ct=new Jw(X,e,Et,ct.getSource()),te[Et]=Ct}return Object.assign(Object.assign({},e.component.data),{outputNodes:te,outputNodeRefCounts:se,raw:st,main:ct,facetRoot:Ct,ancestorParse:he})}class sie extends zN{constructor(t,n,i,a){var f,g,x,k;super(t,"concat",n,i,a,t.resolve),((g=(f=t.resolve)===null||f===void 0?void 0:f.axis)===null||g===void 0?void 0:g.x)!=="shared"&&((k=(x=t.resolve)===null||x===void 0?void 0:x.axis)===null||k===void 0?void 0:k.y)!=="shared"||si(oe.CONCAT_CANNOT_SHARE_AXIS),this.children=this.getChildren(t).map((F,V)=>qN(F,this,this.getName("concat_"+V),void 0,a))}parseData(){this.component.data=iA(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of ci(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return kC(t)?t.vconcat:Y4(t)?t.hconcat:t.concat}parseLayoutSize(){iie(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=CN(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),i=t.assembleGroupStyle(),a=t.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},n?{title:n}:{}),i?{style:i}:{}),a?{encode:{update:a}}:{}),t.assembleGroup())})}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},t!=null?{columns:t}:{}),{bounds:"full",align:"each"})}}const uie=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},A8),{labelExpr:1,encode:1}),f7=ci(uie);class VN extends o1{constructor(t={},n={},i=!1){super(),this.explicit=t,this.implicit=n,this.mainExtracted=i}clone(){return new VN(Zo(this.explicit),Zo(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"||(t==="grid"||t==="title"?!!this.get(t):!function(n){return n===!1||n===null}(this.get(t)))}hasOrientSignalRef(){return Eo(this.explicit.orient)}}function cie(e){return Ig.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[function(i,a){var f,g,x;let k=a.axis(i);const F=new VN,V=Hc(a.encoding[i]),{mark:X,config:te}=a,se=(k==null?void 0:k.orient)||((f=te[i==="x"?"axisX":"axisY"])===null||f===void 0?void 0:f.orient)||((g=te.axis)===null||g===void 0?void 0:g.orient)||function(lt){return lt==="x"?"bottom":"left"}(i),he=a.getScaleComponent(i).get("type"),ye=yre(i,he,se,a.config),Pe=k!==void 0?!k:wN("disable",te,k==null?void 0:k.style,ye).configValue;if(F.set("disable",Pe,k!==void 0),Pe)return F;const Ue=function(lt,ct,Ct,Et,gn){const An=ct==null?void 0:ct.labelAngle;if(An!==void 0)return Eo(An)?An:Kk(An);{const{configValue:wn}=wN("labelAngle",lt.config,ct==null?void 0:ct.style,gn);return wn!==void 0?Kk(wn):Ct===Cu&&co([E4,_4],Et.type)?270:void 0}}(a,k=k||{},i,V,ye),We={fieldOrDatumDef:V,axis:k,channel:i,model:a,scaleType:he,orient:se,labelAngle:Ue,mark:X,config:te};for(const lt of f7){const ct=lt in vz?vz[lt](We):O8(lt)?k[lt]:void 0,Ct=ct!==void 0,Et=hie(ct,lt,k,a,i);if(Ct&&Et)F.set(lt,ct,Et);else{const{configValue:gn,configFrom:An}=O8(lt)&&lt!=="values"?wN(lt,a.config,k.style,ye):{},wn=gn!==void 0;Ct&&!wn?F.set(lt,ct,Et):(An!=="vgAxisConfig"||pie.has(lt)&&wn||i4(gn)||Eo(gn))&&F.set(lt,gn,!1)}}const at=(x=k.encoding)!==null&&x!==void 0?x:{},st=C8.reduce((lt,ct)=>{var Ct;if(!F.hasAxisPart(ct))return lt;const Et=Az((Ct=at[ct])!==null&&Ct!==void 0?Ct:{},a),gn=ct==="labels"?function(An,wn,$n){var qn;const{encoding:er,config:rr}=An,lr=(qn=Hc(er[wn]))!==null&&qn!==void 0?qn:Hc(er[oy(wn)]),Or=An.axis(wn)||{},{format:Jr,formatType:Lr}=Or;return _x(Lr)?Object.assign({text:O4({fieldOrDatumDef:lr,field:"datum.value",format:Jr,formatType:Lr,config:rr})},$n):$n}(a,i,Et):Et;return gn===void 0||As(gn)||(lt[ct]={update:gn}),lt},{});return As(st)||F.set("encode",st,!!k.encoding||k.labelAngle!==void 0),F}(n,e)]),t),{})}const lie={bottom:"top",top:"bottom",left:"right",right:"left"};function fie(e,t){if(!e)return t.map(n=>n.clone());{if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const a=e[i],f=t[i];if(!!a!=!!f)return;if(a&&f){const g=a.getWithExplicit("orient"),x=f.getWithExplicit("orient");if(g.explicit&&x.explicit&&g.value!==x.value)return;e[i]=die(a,f)}}}return e}function die(e,t){for(const n of f7){const i=pb(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(a,f)=>{switch(n){case"title":return Hj(a,f);case"gridScale":return{explicit:a.explicit,value:_c(a.value,f.value)}}return OC(a,f,n,"axis")});e.setWithExplicit(n,i)}return e}function hie(e,t,n,i,a){if(t==="disable")return n!==void 0;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(Eo(n.labelAngle)?n.labelAngle:Kk(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===xz(i,a))return!0}return e===n[t]}const pie=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function mie(e,t,n,{graticule:i}){const a=Qv(e)?Object.assign({},e):{type:e},f=Za("orient",a,n);if(a.orient=function(g,x,k){switch(g){case Zk:case a4:case s4:case M8:case dZ:case fZ:return}const{x:F,y:V,x2:X,y2:te}=x;switch(g){case Jk:if(xi(F)&&(ch(F.bin)||xi(V)&&V.aggregate&&!F.aggregate))return"vertical";if(xi(V)&&(ch(V.bin)||xi(F)&&F.aggregate&&!V.aggregate))return"horizontal";if(te||X){if(k)return k;if(!X&&(xi(F)&&F.type===xx&&!Ws(F.bin)||I4(F)))return"horizontal";if(!te&&(xi(V)&&V.type===xx&&!Ws(V.bin)||I4(V)))return"vertical"}case eC:if(X&&(!xi(F)||!ch(F.bin))&&te&&(!xi(V)||!ch(V.bin)))return;case Yk:if(te)return xi(V)&&ch(V.bin)?"horizontal":"vertical";if(X)return xi(F)&&ch(F.bin)?"vertical":"horizontal";if(g===eC){if(F&&!V)return"vertical";if(V&&!F)return"horizontal"}case Qk:case o4:{const se=ly(F),he=ly(V);if(se&&!he)return g!=="tick"?"horizontal":"vertical";if(!se&&he)return g!=="tick"?"vertical":"horizontal";if(se&&he){const ye=F,Pe=V,Ue=ye.type===Uw,We=Pe.type===Uw;return Ue&&!We?g!=="tick"?"vertical":"horizontal":!Ue&&We?g!=="tick"?"horizontal":"vertical":!ye.aggregate&&Pe.aggregate?g!=="tick"?"vertical":"horizontal":ye.aggregate&&!Pe.aggregate?g!=="tick"?"horizontal":"vertical":k||"vertical"}return k||void 0}}return"vertical"}(a.type,t,f),f!==void 0&&f!==a.orient&&si(oe.orientOverridden(a.orient,f)),a.type==="bar"&&a.orient){const g=Za("cornerRadiusEnd",a,n);if(g!==void 0){const x=a.orient==="horizontal"&&t.x2||a.orient==="vertical"&&t.y2?["cornerRadius"]:mZ[a.orient];for(const k of x)a[k]=g;a.cornerRadiusEnd!==void 0&&delete a.cornerRadiusEnd}}return Za("opacity",a,n)===void 0&&(a.opacity=function(g,x){if(co([Zk,o4,a4,s4],g)&&!j4(x))return .7}(a.type,t)),a.filled===void 0&&(a.filled=!i&&function(g,x){const k=kx("filled",g,x),F=g.type;return _c(k,F!==Zk&&F!==Qk&&F!==eC)}(a,n)),Za("cursor",a,n)===void 0&&(a.cursor=function(g,x,k){return x.href||g.href||Za("href",g,k)?"pointer":g.cursor}(a,t,n)),a}function HN(e,t){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Rg(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Yf("x",e,{defaultPos:"mid"})),Yf("y",e,{defaultPos:"mid"})),bl("size",e)),bl("angle",e)),function(n,i,a){return a?{shape:{value:a}}:bl("shape",n)}(e,0,t))}const oA={arc:{vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Rg(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Yf("x",e,{defaultPos:"mid"})),Yf("y",e,{defaultPos:"mid"})),mb(e,"radius","arc")),mb(e,"theta","arc"))},area:{vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},Rg(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),IC("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),IC("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),oN(e))},bar:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},Rg(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),mb(e,"x","bar")),mb(e,"y","bar"))},circle:{vgMark:"symbol",encodeEntry:e=>HN(e,"circle")},geoshape:{vgMark:"shape",encodeEntry:e=>Object.assign({},Rg(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&xi(n)&&n.type===Ww?{field:hi(n,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},Rg(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),mb(e,"x","image")),mb(e,"y","image")),rN(e,"url"))},line:{vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Rg(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Yf("x",e,{defaultPos:"mid"})),Yf("y",e,{defaultPos:"mid"})),bl("size",e,{vgChannel:"strokeWidth"})),oN(e))},point:{vgMark:"symbol",encodeEntry:e=>HN(e)},rect:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},Rg(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),mb(e,"x","rect")),mb(e,"y","rect"))},rule:{vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?Object.assign(Object.assign(Object.assign(Object.assign({},Rg(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),IC("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),IC("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),bl("size",e,{vgChannel:"strokeWidth"})):{}}},square:{vgMark:"symbol",encodeEntry:e=>HN(e,"square")},text:{vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Rg(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),Yf("x",e,{defaultPos:"mid"})),Yf("y",e,{defaultPos:"mid"})),rN(e)),bl("size",e,{vgChannel:"fontSize"})),bl("angle",e)),P9("align",function(i,a,f){if(Za("align",i,f)===void 0)return"center"}(e.markDef,0,t))),P9("baseline",function(i,a,f){if(Za("baseline",i,f)===void 0)return"middle"}(e.markDef,0,t))),Yf("radius",e,{defaultPos:null,isMidPoint:!0})),Yf("theta",e,{defaultPos:null,isMidPoint:!0}))}},tick:{vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,a=i==="horizontal"?"width":"height",f=i==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Rg(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Yf("x",e,{defaultPos:"mid",vgChannel:"xc"})),Yf("y",e,{defaultPos:"mid",vgChannel:"yc"})),bl("size",e,{defaultValue:function(g){var x;const{config:k,markDef:F}=g,{orient:V}=F,X=V==="horizontal"?"width":"height",te=g.getScaleComponent(V==="horizontal"?"x":"y"),se=(x=Za("size",F,k,{vgChannel:X}))!==null&&x!==void 0?x:k.tick.bandSize;if(se!==void 0)return se;{const he=te?te.get("range"):void 0;return he&&cb(he)&&wc(he.step)?3*he.step/4:3*CC(k.view,X)/4}}(e),vgChannel:a})),{[f]:ic(Za("thickness",n,t))})}},trail:{vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Rg(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Yf("x",e,{defaultPos:"mid"})),Yf("y",e,{defaultPos:"mid"})),bl("size",e)),oN(e))}};function gie(e){return co([Qk,Yk,hZ],e.mark)?function(t){const n=qj(t.mark,t.encoding),i=aA(t,{fromPrefix:n.length>0?d7:""});return n.length>0?[{name:t.getName("pathgroup"),type:"group",from:{facet:{name:d7+t.requestDataName(Kf),data:t.requestDataName(Kf),groupby:n}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:i}]:i}(e):co([Jk],e.mark)?function(t){const n=v4.some(i=>Za(i,t.markDef,t.config));if(t.stack&&!t.fieldDef("size")&&n){const[i]=aA(t,{fromPrefix:h7}),a=t.scaleName(t.stack.fieldChannel),f=(te={})=>t.vgField(t.stack.fieldChannel,te),g=(te,se)=>{const he=[f({prefix:"min",suffix:"start",expr:se}),f({prefix:"max",suffix:"start",expr:se}),f({prefix:"min",suffix:"end",expr:se}),f({prefix:"max",suffix:"end",expr:se})];return`${te}(${he.map(ye=>`scale('${a}',${ye})`).join(",")})`};let x,k;t.stack.fieldChannel==="x"?(x=Object.assign(Object.assign({},sE(i.encode.update,["y","yc","y2","height",...v4])),{x:{signal:g("min","datum")},x2:{signal:g("max","datum")},clip:{value:!0}}),k={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},i.encode.update=Object.assign(Object.assign({},Ky(i.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(x=Object.assign(Object.assign({},sE(i.encode.update,["x","xc","x2","width"])),{y:{signal:g("min","datum")},y2:{signal:g("max","datum")},clip:{value:!0}}),k={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},i.encode.update=Object.assign(Object.assign({},Ky(i.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const te of v4){const se=kx(te,t.markDef,t.config);i.encode.update[te]?(x[te]=i.encode.update[te],delete i.encode.update[te]):se&&(x[te]=ic(se)),se&&(i.encode.update[te]={value:0})}const F=t.fieldDef(t.stack.groupbyChannel),V=hi(F)?[hi(F)]:[];return(F!=null&&F.bin||F!=null&&F.timeUnit)&&V.push(hi(F,{binSuffix:"end"})),(x=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((te,se)=>{if(i.encode.update[se])return Object.assign(Object.assign({},te),{[se]:i.encode.update[se]});{const he=kx(se,t.markDef,t.config);return he!==void 0?Object.assign(Object.assign({},te),{[se]:ic(he)}):te}},x)).stroke&&(x.strokeForeground={value:!0},x.strokeOffset={value:0}),[{type:"group",from:{facet:{data:t.requestDataName(Kf),name:h7+t.requestDataName(Kf),groupby:V,aggregate:{fields:[f({suffix:"start"}),f({suffix:"start"}),f({suffix:"end"}),f({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:x},marks:[{type:"group",encode:{update:k},marks:[i]}]}]}return aA(t)}(e):aA(e)}const d7="faceted_path_",h7="stack_group_";function aA(e,t={fromPrefix:""}){const{mark:n,markDef:i,config:a}=e,f=_c(i.clip,function(te){const se=te.getScaleComponent("x"),he=te.getScaleComponent("y");return!!(se&&se.get("selectionExtent")||he&&he.get("selectionExtent"))||void 0}(e),function(te){const se=te.component.projection;return!(!se||se.isFit)||void 0}(e)),g=jj(i),x=e.encoding.key,k=function(te){const{encoding:se,stack:he,mark:ye,markDef:Pe,config:Ue}=te,We=se.order;if(!(!io(We)&&r1(We)&&v8(We.value)||!We&&v8(Za("order",Pe,Ue)))){if((io(We)||xi(We))&&!he)return Uj(We,{expr:"datum"});if(mx(ye)){const at=Pe.orient==="horizontal"?"y":"x",st=se[at];if(xi(st)){const lt=st.sort;return io(lt)?{field:hi(st,{prefix:at,suffix:"sort_index",expr:"datum"})}:cy(lt)?{field:hi({aggregate:j4(te.encoding)?lt.op:void 0,field:lt.field},{expr:"datum"})}:Ej(lt)?{field:hi(te.fieldDef(lt.encoding),{expr:"datum"}),order:lt.order}:lt===null?void 0:{field:hi(st,{binSuffix:te.stack&&te.stack.impute?"mid":void 0,expr:"datum"})}}}}}(e),F=function(te){if(!te.component.selection)return null;const se=ci(te.component.selection).length;let he=se,ye=te.parent;for(;ye&&he===0;)he=ci(ye.component.selection).length,ye=ye.parent;return he?{interactive:se>0}:null}(e),V=Za("aria",i,a),X=oA[n].postEncodingTransform?oA[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:oA[n].vgMark},f?{clip:!0}:{}),g?{style:g}:{}),x?{key:x.field}:{}),k?{sort:k}:{}),F||{}),V===!1?{aria:V}:{}),{from:{data:t.fromPrefix+e.requestDataName(Kf)},encode:{update:oA[n].encodeEntry(e)}}),X?{transform:X}:{})]}class p7 extends a7{constructor(t,n,i,a={},f){var g,x;super(t,"unit",n,i,f,void 0,a9(t)?t.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const k=Qv(t.mark)?t.mark.type:t.mark;this.markDef=mie(t.mark,(g=t.encoding)!==null&&g!==void 0?g:{},f,{graticule:t.data&&nN(t.data)});const F=this.encoding=wte((x=t.encoding)!==null&&x!==void 0?x:{},this.markDef,f);this.size=function({encoding:V,size:X}){for(const te of Ig){const se=ay(te);dy(X[se])&&ly(V[te])&&(delete X[se],si(oe.stepDropped(se)))}return X}({encoding:F,size:a9(t)?Object.assign(Object.assign(Object.assign({},a),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):a}),this.stack=d9(k,F),this.specifiedScales=this.initScales(k,F),this.specifiedAxes=this.initAxes(F),this.specifiedLegends=this.initLegend(F),this.specifiedProjection=t.projection,this.selection=t.selection}get hasProjection(){const{encoding:t}=this,n=this.mark===D8,i=t&&EZ.some(a=>No(t[a]));return n||i}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return uC.reduce((i,a)=>{var f;const g=Hc(n[a]);return g&&(i[a]=(f=g.scale)!==null&&f!==void 0?f:{}),i},{})}initAxes(t){return Ig.reduce((n,i)=>{const a=t[i];if(No(a)||i===Cu&&No(t.x2)||i===Vc&&No(t.y2)){const f=No(a)?a.axis:void 0;n[i]=f&&Object.assign({},f)}return n},{})}initLegend(t){return MZ.reduce((n,i)=>{const a=Hc(t[i]);if(a&&function(f){switch(f){case wp:case ry:case iy:case t1:case _p:case n1:case ib:case ob:return!0;case nb:case rb:case vx:return!1}}(i)){const f=a.legend;n[i]=f&&Object.assign({},f)}return n},{})}parseData(){this.component.data=iA(this)}parseLayoutSize(){(function(t){const{size:n,component:i}=t;for(const a of Ig){const f=ay(a);if(n[f]){const g=n[f];i.layoutSize.set(f,dy(g)?"step":g,!0)}else{const g=oie(t,f);i.layoutSize.set(f,g,!1)}}})(this)}parseSelections(){this.component.selection=function(t,n){var i;const a={},f=t.config.selection;for(const g of ci(n??{})){const x=Zo(n[g]),k=f[x.type],F=Yi(k,["fields","encodings"]);for(const te in F)te==="encodings"&&x.fields||te==="fields"&&x.encodings||(te==="mark"&&(x[te]=Object.assign(Object.assign({},F[te]),x[te])),x[te]!==void 0&&x[te]!==!0||(x[te]=(i=F[te])!==null&&i!==void 0?i:x[te]));const V=gu(g),X=a[V]=Object.assign(Object.assign({},x),{name:V,events:Qo(x.on)?fx(x.on,"scope"):Zo(x.on)});RC(X,te=>{te.has(X)&&te.parse&&te.parse(t,X,x,n[g])})}return a}(this,this.selection)}parseMarkGroup(){this.component.mark=gie(this)}parseAxesAndHeaders(){this.component.axes=cie(this)}assembleSelectionTopLevelSignals(t){return function(n,i){let a=!1;return Mx(n,(f,g)=>{const x=f.name,k=ka(x+Tx);if(i.filter(F=>F.name===x).length===0){const F=f.resolve==="global"?"union":f.resolve,V=f.type==="multi"?", true)":")";i.push({name:f.name,update:`${Y9}(${k}, ${ka(F)}${V}`})}a=!0,g.topLevelSignals&&(i=g.topLevelSignals(n,f,i)),RC(f,F=>{F.topLevelSignals&&(i=F.topLevelSignals(n,f,i))})}),a&&i.filter(f=>f.name==="unit").length===0&&i.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),uN(i)}(this,t)}assembleSignals(){return[...hz(this),...function(t,n){return Mx(t,(i,a)=>{const f=i.name;let g=a.modifyExpr(t,i);n.push(...a.signals(t,i)),RC(i,x=>{x.signals&&(n=x.signals(t,i,n)),x.modifyExpr&&(g=x.modifyExpr(t,i,g))}),n.push({name:f+yne,on:[{events:{signal:i.name+py},update:`modify(${ka(i.name+Tx)}, ${g})`}]})}),uN(n)}(this,[])]}assembleSelectionData(t){return function(n,i){const a=[...i];return Mx(n,f=>{const g={name:f.name+Tx};if(f.init){const x=f.project.items.map(F=>Yi(F,["signals"])),k=f.init.map(F=>Hw(F,!1));g.values=f.type==="interval"?[{unit:a1(n,{escape:!1}),fields:x,values:k}]:k.map(F=>({unit:a1(n,{escape:!1}),fields:x,values:F}))}a.filter(x=>x.name===f.name+Tx).length||a.push(g)}),a}(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return CN(this)}assembleMarks(){var t;let n=(t=this.component.mark)!==null&&t!==void 0?t:[];return this.parent&&Zw(this.parent)||(n=$9(this,n)),n.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return Cx(this.encoding,t)}fieldDef(t){return fy(this.encoding[t])}typedFieldDef(t){const n=this.fieldDef(t);return Fm(n)?n:null}}class GN extends zN{constructor(t,n,i,a,f){super(t,"layer",n,i,f,t.resolve,t.view);const g=Object.assign(Object.assign(Object.assign({},a),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map((x,k)=>{if(AC(x))return new GN(x,this,this.getName("layer_"+k),g,f);if(Yy(x))return new p7(x,this,this.getName("layer_"+k),g,f);throw new Error(oe.invalidSpec(x))})}parseData(){this.component.data=iA(this);for(const t of this.children)t.parseData()}parseLayoutSize(){(function(t){UN(t),rA(t,"width"),rA(t,"height")})(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of ci(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){(function(t){var n;const{axes:i,resolve:a}=t.component,f={top:0,bottom:0,right:0,left:0};for(const g of t.children){g.parseAxesAndHeaders();for(const x of ci(g.component.axes))a.axis[x]=AN(t.component.resolve,x),a.axis[x]==="shared"&&(i[x]=fie(i[x],g.component.axes[x]),i[x]||(a.axis[x]="independent",delete i[x]))}for(const g of Ig){for(const x of t.children)if(x.component.axes[g]){if(a.axis[g]==="independent"){i[g]=((n=i[g])!==null&&n!==void 0?n:[]).concat(x.component.axes[g]);for(const k of x.component.axes[g]){const{value:F,explicit:V}=k.getWithExplicit("orient");if(!Eo(F)){if(f[F]>0&&!V){const X=lie[F];f[F]>f[X]&&k.set("orient",X,!1)}f[F]++}}}delete x.component.axes[g]}if(a.axis[g]==="independent"&&i[g]&&i[g].length>1)for(const x of i[g])x.get("grid")&&!x.explicit.grid&&(x.implicit.grid=!1)}})(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),hz(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),CN(this))}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle())return t}assembleLayout(){return null}assembleMarks(){return function(t,n){for(const i of t.children)ju(i)&&(n=$9(i,n));return n}(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),Bz(this))}}function qN(e,t,n,i,a){if(gC(e))return new zE(e,t,n,a);if(AC(e))return new GN(e,t,n,i,a);if(Yy(e))return new p7(e,t,n,i,a);if(function(f){return kC(f)||Y4(f)||K4(f)}(e))return new sie(e,t,n,a);throw new Error(oe.invalidSpec(e))}function vie(e,t={}){t.logger&&function(n){fC=n}(t.logger),t.fieldTitle&&Ij(t.fieldTitle);try{const n=c9(g8(t.config,e.config)),i=x9(e,n),a=qN(i,null,"",void 0,n);return a.parse(),function(f,g){MN(f.sources);let x=0,k=0;for(let F=0;F<$C&&qz(f,g);F++)x++;f.sources.map(NN);for(let F=0;F<$C&&qz(f,g);F++)k++;MN(f.sources),Math.max(x,k)===$C&&si(`Maximum optimization runs(${$C}) reached.`)}(a.component.data,a),{spec:function(f,g,x={},k){const F=f.config?Rte(f.config):void 0,V=[].concat(f.assembleSelectionData([]),function(Pe,Ue){var We,at;const st=[],lt=s7(st);let ct=0;for(const Et of Pe.sources)Et.hasName()||(Et.dataName=`source_${ct++}`),lt(Et,Et.assemble());for(const Et of st)Et.transform.length===0&&delete Et.transform;let Ct=0;for(const[Et,gn]of st.entries())((We=gn.transform)!==null&&We!==void 0?We:[]).length!==0||gn.source||st.splice(Ct++,0,st.splice(Et,1)[0]);for(const Et of st)for(const gn of(at=Et.transform)!==null&&at!==void 0?at:[])gn.type==="lookup"&&(gn.from=Pe.outputNodes[gn.from].getSource());for(const Et of st)Et.name in Ue&&(Et.values=Ue[Et.name]);return st}(f.component.data,x)),X=f.assembleProjections(),te=f.assembleTitle(),se=f.assembleGroupStyle(),he=f.assembleGroupEncodeEntry(!0);let ye=f.assembleLayoutSignals();return ye=ye.filter(Pe=>Pe.name!=="width"&&Pe.name!=="height"||Pe.value===void 0||(g[Pe.name]=+Pe.value,!1)),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},f.description?{description:f.description}:{}),g),te?{title:te}:{}),se?{style:se}:{}),he?{encode:{update:he}}:{}),{data:V}),X.length>0?{projections:X}:{}),f.assembleGroup([...ye,...f.assembleSelectionTopLevelSignals([])])),F?{config:F}:{}),k?{usermeta:k}:{})}(a,function(f,g,x,k){const F=k.component.layoutSize.get("width"),V=k.component.layoutSize.get("height");if(g===void 0?(g={type:"pad"},k.hasAxisOrientSignalRef()&&(g.resize=!0)):Qo(g)&&(g={type:g}),F&&V&&function(X){return X==="fit"||X==="fit-x"||X==="fit-y"}(g.type)){if(F==="step"&&V==="step")si(oe.droppingFit()),g.type="pad";else if(F==="step"||V==="step"){const X=F==="step"?"width":"height";si(oe.droppingFit(sC(X)));const te=X==="width"?"height":"width";g.type=function(se){return se?`fit-${sC(se)}`:"fit"}(te)}}return Object.assign(Object.assign(Object.assign({},ci(g).length===1&&g.type?g.type==="pad"?{}:{autosize:g.type}:{autosize:g}),_9(x)),_9(f))}(e,i.autosize,n,a),e.datasets,e.usermeta),normalized:i}}finally{t.logger&&Qee(),t.fieldTitle&&Ij(Dj)}}const yie=new class extends l9{mapUnit(e,{config:t}){if(e.encoding){const{encoding:n,transform:i}=e,{bins:a,timeUnits:f,aggregate:g,groupby:x,encoding:k}=z4(n,t),F=[...i||[],...a,...f,...g.length===0?[]:[{aggregate:g,groupby:x}]];return Object.assign(Object.assign(Object.assign({},e),F.length>0?{transform:F}:{}),{encoding:k})}return e}};function bie(e,t){return yie.map(e,{config:t})}const xie=GQ.version;var m7=function(e){const[t,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}};const wie={background:"#333",title:{color:"#fff",subtitleColor:"#fff"},style:{"guide-label":{fill:"#fff"},"guide-title":{fill:"#fff"}},axis:{domainColor:"#fff",gridColor:"#888",tickColor:"#fff"}},_ie={background:"#fff",arc:{fill:"#4572a7"},area:{fill:"#4572a7"},line:{stroke:"#4572a7",strokeWidth:2},path:{stroke:"#4572a7"},rect:{fill:"#4572a7"},shape:{stroke:"#4572a7"},symbol:{fill:"#4572a7",strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},Eie={arc:{fill:"#30a2da"},area:{fill:"#30a2da"},axis:{domainColor:"#cbcbcb",grid:!0,gridColor:"#cbcbcb",gridWidth:1,labelColor:"#999",labelFontSize:10,titleColor:"#333",tickColor:"#cbcbcb",tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:"#f0f0f0",group:{fill:"#f0f0f0"},legend:{labelColor:"#333",labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:"#333",titleFontSize:14,titlePadding:10},line:{stroke:"#30a2da",strokeWidth:2},path:{stroke:"#30a2da",strokeWidth:.5},rect:{fill:"#30a2da"},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:"#30a2da"},bar:{binSpacing:2,fill:"#30a2da",stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},Sie={group:{fill:"#e5e5e5"},arc:{fill:"#000"},area:{fill:"#000"},line:{stroke:"#000"},path:{stroke:"#000"},rect:{fill:"#000"},shape:{stroke:"#000"},symbol:{fill:"#000",size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},$N="Benton Gothic Bold, sans-serif",UE={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},kie={background:"#ffffff",title:{anchor:"start",color:"#000000",font:$N,fontSize:22,fontWeight:"normal"},arc:{fill:"#82c6df"},area:{fill:"#82c6df"},line:{stroke:"#82c6df",strokeWidth:2},path:{stroke:"#82c6df"},rect:{fill:"#82c6df"},shape:{stroke:"#82c6df"},symbol:{fill:"#82c6df",size:30},axis:{labelFont:"Benton Gothic, sans-serif",labelFontSize:11.5,labelFontWeight:"normal",titleFont:$N,titleFontSize:13,titleFontWeight:"normal"},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:"Benton Gothic, sans-serif",labelFontSize:11.5,symbolType:"square",titleFont:$N,titleFontSize:13,titleFontWeight:"normal"},range:{category:UE["category-6"],diverging:UE["fireandice-6"],heatmap:UE["fire-7"],ordinal:UE["fire-7"],ramp:UE["fire-7"]}},Cie={background:"#f9f9f9",arc:{fill:"#ab5787"},area:{fill:"#ab5787"},line:{stroke:"#ab5787"},path:{stroke:"#ab5787"},rect:{fill:"#ab5787"},shape:{stroke:"#ab5787"},symbol:{fill:"#ab5787",size:30},axis:{domainColor:"#979797",domainWidth:.5,gridWidth:.2,labelColor:"#979797",tickColor:"#979797",tickWidth:.2,titleColor:"#979797"},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},Aie={background:"#fff",arc:{fill:"#3e5c69"},area:{fill:"#3e5c69"},line:{stroke:"#3e5c69"},path:{stroke:"#3e5c69"},rect:{fill:"#3e5c69"},shape:{stroke:"#3e5c69"},symbol:{fill:"#3e5c69"},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},WE={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},Oie={background:"#FFFFFF",title:{anchor:"start",fontSize:18,font:"Lato"},axisX:{domain:!0,domainColor:"#000000",domainWidth:1,grid:!1,labelFontSize:12,labelFont:"Lato",labelAngle:0,tickColor:"#000000",tickSize:5,titleFontSize:12,titlePadding:10,titleFont:"Lato"},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:"#DEDDDD",gridWidth:1,labelFontSize:12,labelFont:"Lato",labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:"Lato",titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:"Lato",symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:"Lato",orient:"right",offset:10},view:{stroke:"transparent"},range:{category:WE["six-groups-cat-1"],diverging:WE["diverging-colors"],heatmap:WE["diverging-colors"],ordinal:WE["six-groups-seq"],ramp:WE["shades-blue"]},area:{fill:"#1696d2"},rect:{fill:"#1696d2"},line:{color:"#1696d2",stroke:"#1696d2",strokeWidth:5},trail:{color:"#1696d2",stroke:"#1696d2",strokeWidth:0,size:1},path:{stroke:"#1696d2",strokeWidth:.5},point:{filled:!0},text:{font:"Lato",color:"#1696d2",fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:"#1696d2",stroke:null}},arc:{fill:"#1696d2"},shape:{stroke:"#1696d2"},symbol:{fill:"#1696d2",size:30}},Tie={arc:{fill:"#3366CC"},area:{fill:"#3366CC"},path:{stroke:"#3366CC"},rect:{fill:"#3366CC"},shape:{stroke:"#3366CC"},symbol:{stroke:"#3366CC"},circle:{fill:"#3366CC"},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:"Arial, sans-serif",fontSize:12},"guide-title":{font:"Arial, sans-serif",fontSize:12},"group-title":{font:"Arial, sans-serif",fontSize:12}},title:{font:"Arial, sans-serif",fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:"#ccc",tickColor:"#ccc",domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},Mie="2.10.0";var Die=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black; }
  #vg-tooltip-element.visible {
    visibility: visible; }
  #vg-tooltip-element h2 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 13px; }
  #vg-tooltip-element img {
    max-width: 200px;
    max-height: 200px; }
  #vg-tooltip-element table {
    border-spacing: 0; }
    #vg-tooltip-element table tr {
      border: none; }
      #vg-tooltip-element table tr td {
        overflow: hidden;
        text-overflow: ellipsis;
        padding-top: 2px;
        padding-bottom: 2px; }
        #vg-tooltip-element table tr td.key {
          color: #808080;
          max-width: 150px;
          text-align: right;
          padding-right: 4px; }
        #vg-tooltip-element table tr td.value {
          display: block;
          max-width: 300px;
          max-height: 7em;
          text-align: left; }
  #vg-tooltip-element.dark-theme {
    background-color: rgba(32, 32, 32, 0.9);
    border: 1px solid #f5f5f5;
    color: white; }
    #vg-tooltip-element.dark-theme td.key {
      color: #bfbfbf; }
`;const g7="vg-tooltip-element",Nie={offsetX:10,offsetY:10,id:g7,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")},maxDepth:2};function Iie(e,t,n){if(Object(ke.B)(e))return`[${e.map(i=>t(Object(ke.J)(i)?i:v7(i,n))).join(", ")}]`;if(Object(ke.H)(e)){let i="";const a=e,{title:f,image:g}=a,x=function(F,V){var X={};for(var te in F)Object.prototype.hasOwnProperty.call(F,te)&&V.indexOf(te)<0&&(X[te]=F[te]);if(F!=null&&typeof Object.getOwnPropertySymbols=="function"){var se=0;for(te=Object.getOwnPropertySymbols(F);se<te.length;se++)V.indexOf(te[se])<0&&Object.prototype.propertyIsEnumerable.call(F,te[se])&&(X[te[se]]=F[te[se]])}return X}(a,["title","image"]);f&&(i+=`<h2>${t(f)}</h2>`),g&&(i+=`<img src="${t(g)}">`);const k=Object.keys(x);if(k.length>0){i+="<table>";for(const F of k){let V=x[F];V!==void 0&&(Object(ke.H)(V)&&(V=v7(V,n)),i+=`<tr><td class="key">${t(F)}:</td><td class="value">${t(V)}</td></tr>`)}i+="</table>"}return i||"{}"}return t(e)}function v7(e,t){return JSON.stringify(e,function(n){const i=[];return function(a,f){if(typeof f!="object"||f===null)return f;const g=i.indexOf(this)+1;return i.length=g,i.length>n?"[Object]":i.indexOf(f)>=0?"[Circular]":(i.push(f),f)}}(t))}class Fie{constructor(t){this.options=Object.assign(Object.assign({},Nie),t);const n=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const i=document.createElement("style");i.setAttribute("id",this.options.styleId),i.innerHTML=function(f){if(!/^[A-Za-z]+[-:.\w]*$/.test(f))throw new Error("Invalid HTML ID");return Die.toString().replace(g7,f)}(n);const a=document.head;a.childNodes.length>0?a.insertBefore(i,a.childNodes[0]):a.appendChild(i)}}tooltipHandler(t,n,i,a){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el)),(document.fullscreenElement!=null?document.fullscreenElement:document.body).appendChild(this.el),a==null||a==="")return void this.el.classList.remove("visible",`${this.options.theme}-theme`);this.el.innerHTML=Iie(a,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:f,y:g}=function(x,k,F,V){let X=x.clientX+F;X+k.width>window.innerWidth&&(X=+x.clientX-F-k.width);let te=x.clientY+V;return te+k.height>window.innerHeight&&(te=+x.clientY-V-k.height),{x:X,y:te}}(n,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${g}px; left: ${f}px`)}}function sA(e,t,n,i){return new(n||(n=Promise))(function(a,f){function g(F){try{k(i.next(F))}catch(V){f(V)}}function x(F){try{k(i.throw(F))}catch(V){f(V)}}function k(F){F.done?a(F.value):function(V){return V instanceof n?V:new n(function(X){X(V)})}(F.value).then(g,x)}k((i=i.apply(e,t||[])).next())})}r.d(s,"DEFAULT_ACTIONS",function(){return b7}),r.d(s,"guessMode",function(){return w7}),r.d(s,"vega",function(){return f1}),r.d(s,"vegaLite",function(){return t2});var XN,Rie=`.vega-embed {
  position: relative;
  display: inline-block;
  box-sizing: border-box; }
  .vega-embed.has-actions {
    padding-right: 38px; }
  .vega-embed details:not([open]) > :not(summary) {
    display: none !important; }
  .vega-embed summary {
    list-style: none;
    position: absolute;
    top: 0;
    right: 0;
    padding: 6px;
    z-index: 1000;
    background: white;
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
    color: #1b1e23;
    border: 1px solid #aaa;
    border-radius: 999px;
    opacity: 0.2;
    transition: opacity 0.4s ease-in;
    outline: none;
    cursor: pointer;
    line-height: 0px; }
    .vega-embed summary::-webkit-details-marker {
      display: none; }
    .vega-embed summary:active {
      box-shadow: #aaa 0px 0px 0px 1px inset; }
    .vega-embed summary svg {
      width: 14px;
      height: 14px; }
  .vega-embed details[open] summary {
    opacity: 0.7; }
  .vega-embed:hover summary,
  .vega-embed:focus summary {
    opacity: 1 !important;
    transition: opacity 0.2s ease; }
  .vega-embed .vega-actions {
    position: absolute;
    z-index: 1001;
    top: 35px;
    right: -9px;
    display: flex;
    flex-direction: column;
    padding-bottom: 8px;
    padding-top: 8px;
    border-radius: 4px;
    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
    border: 1px solid #d9d9d9;
    background: white;
    animation-duration: 0.15s;
    animation-name: scale-in;
    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
    text-align: left; }
    .vega-embed .vega-actions a {
      padding: 8px 16px;
      font-family: sans-serif;
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      color: #434a56;
      text-decoration: none; }
      .vega-embed .vega-actions a:hover {
        background-color: #f7f7f9;
        color: black; }
    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
      content: "";
      display: inline-block;
      position: absolute; }
    .vega-embed .vega-actions::before {
      left: auto;
      right: 14px;
      top: -16px;
      border: 8px solid #0000;
      border-bottom-color: #d9d9d9; }
    .vega-embed .vega-actions::after {
      left: auto;
      right: 15px;
      top: -14px;
      border: 7px solid #0000;
      border-bottom-color: #fff; }
  .vega-embed .chart-wrapper {
    width: 100%;
    height: 100%; }

.vega-embed-wrapper {
  max-width: 100%;
  overflow: auto;
  padding-right: 14px; }

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6); }
  to {
    opacity: 1;
    transform: scale(1); } }
`;function y7(e,...t){for(const n of t)Pie(e,n);return e}function Pie(e,t){for(const n of Object.keys(t))Object(ke.La)(e,n,t[n],!0)}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});const f1=G;let t2=ce;const uA=typeof window<"u"?window:void 0;t2===void 0&&(!((XN=uA==null?void 0:uA.vl)===null||XN===void 0)&&XN.compile)&&(t2=uA.vl);const b7={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},Lie={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},VE={vega:"Vega","vega-lite":"Vega-Lite"},cA={vega:f1.version,"vega-lite":t2?t2.version:"not available"},Bie={vega:e=>e,"vega-lite":(e,t)=>t2.compile(e,{config:t}).spec},jie=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`,zie="chart-wrapper";function x7(e,t,n,i){const a=`<html><head>${t}</head><body><pre><code class="json">`,f=`</code></pre>${n}</body></html>`,g=window.open("");g.document.write(a+e+f),g.document.title=`${VE[i]} JSON Source`}function w7(e,t){var n;if(e.$schema){const i=m7(e.$schema);t&&t!==i.library&&console.warn(`The given visualization spec is written in ${VE[i.library]}, but mode argument sets ${(n=VE[t])!==null&&n!==void 0?n:t}.`);const a=i.library;return Object(Qn.satisfies)(cA[a],`^${i.version.slice(1)}`)||console.warn(`The input spec uses ${VE[a]} ${i.version}, but the current version of ${VE[a]} is v${cA[a]}.`),a}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":t??"vega"}function _7(e){return function(t){return!!(t&&"load"in t)}(e)?e:f1.loader(e)}function E7(e){var t;return(t=e.usermeta&&e.usermeta.embedOptions)!==null&&t!==void 0?t:{}}function S7(e,t){var n;return sA(this,void 0,void 0,function*(){const i=Object(ke.J)(e.config)?JSON.parse(yield t.load(e.config)):(n=e.config)!==null&&n!==void 0?n:{},a=Object(ke.J)(e.patch)?JSON.parse(yield t.load(e.patch)):e.patch;return Object.assign(Object.assign(Object.assign({},e),a?{patch:a}:{}),i?{config:i}:{})})}s.default=function(e,t,n={}){var i,a,f;return sA(this,void 0,void 0,function*(){let g,x;Object(ke.J)(t)?(x=_7(n.loader),g=JSON.parse(yield x.load(t))):g=t;const k=E7(g).loader;x&&!k||(x=_7((i=n.loader)!==null&&i!==void 0?i:k));const F=yield S7(E7(g),x),V=yield S7(n,x),X=Object.assign(Object.assign({},y7(V,F)),{config:Object(ke.P)((a=V.config)!==null&&a!==void 0?a:{},(f=F.config)!==null&&f!==void 0?f:{})});return yield function(te,se,he={},ye){var Pe,Ue,We,at,st,lt;return sA(this,void 0,void 0,function*(){const ct=he.theme?Object(ke.P)(be[he.theme],(Pe=he.config)!==null&&Pe!==void 0?Pe:{}):he.config,Ct=Object(ke.C)(he.actions)?he.actions:y7({},b7,(Ue=he.actions)!==null&&Ue!==void 0?Ue:{}),Et=Object.assign(Object.assign({},Lie),he.i18n),gn=(We=he.renderer)!==null&&We!==void 0?We:"canvas",An=(at=he.logLevel)!==null&&at!==void 0?at:f1.Warn,wn=(st=he.downloadFileName)!==null&&st!==void 0?st:"visualization",$n=typeof te=="string"?document.querySelector(te):te;if(!$n)throw new Error(`${te} does not exist`);if(he.defaultStyle!==!1){const Ti="vega-embed-style",{root:Ji,rootContainer:Ii}=function(Mi){var ji;const Co=Mi.getRootNode?Mi.getRootNode():document;return Co instanceof ShadowRoot?{root:Co,rootContainer:Co}:{root:document,rootContainer:(ji=document.head)!==null&&ji!==void 0?ji:document.body}}($n);if(!Ji.getElementById(Ti)){const Mi=document.createElement("style");Mi.id=Ti,Mi.innerText=he.defaultStyle===void 0||he.defaultStyle===!0?Rie.toString():he.defaultStyle,Ii.appendChild(Mi)}}const qn=w7(se,he.mode);let er=Bie[qn](se,ct);if(qn==="vega-lite"&&er.$schema){const Ti=m7(er.$schema);Object(Qn.satisfies)(cA.vega,`^${Ti.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${Ti.version}, but current version is v${cA.vega}.`)}$n.classList.add("vega-embed"),Ct&&$n.classList.add("has-actions"),$n.innerHTML="";let rr=$n;if(Ct){const Ti=document.createElement("div");Ti.classList.add(zie),$n.appendChild(Ti),rr=Ti}const lr=he.patch;lr&&(er=lr instanceof Function?lr(er):nn(er,lr,!0,!1).newDocument),he.formatLocale&&f1.formatLocale(he.formatLocale),he.timeFormatLocale&&f1.timeFormatLocale(he.timeFormatLocale);const{ast:Or}=he,Jr=f1.parse(er,qn==="vega-lite"?{}:ct,{ast:Or}),Lr=new(he.viewClass||f1.View)(Jr,Object.assign({loader:ye,logLevel:An,renderer:gn},Or?{expr:f1.expressionInterpreter}:{}));if(he.tooltip!==!1){let Ti;Ti=function(Ji){return typeof Ji=="function"}(he.tooltip)?he.tooltip:new Fie(he.tooltip===!0?{}:he.tooltip).call,Lr.tooltip(Ti)}let li,{hover:Ai}=he;if(Ai===void 0&&(Ai=qn==="vega"),Ai){const{hoverSet:Ti,updateSet:Ji}=typeof Ai=="boolean"?{}:Ai;Lr.hover(Ti,Ji)}if(he&&(he.width!=null&&Lr.width(he.width),he.height!=null&&Lr.height(he.height),he.padding!=null&&Lr.padding(he.padding)),yield Lr.initialize(rr,he.bind).runAsync(),Ct!==!1){let Ti=$n;if(he.defaultStyle!==!1){const Ii=document.createElement("details");Ii.title=Et.CLICK_TO_VIEW_ACTIONS,$n.append(Ii),Ti=Ii;const Mi=document.createElement("summary");Mi.innerHTML=jie,Ii.append(Mi),li=ji=>{Ii.contains(ji.target)||Ii.removeAttribute("open")},document.addEventListener("click",li)}const Ji=document.createElement("div");if(Ti.append(Ji),Ji.classList.add("vega-actions"),Ct===!0||Ct.export!==!1){for(const Ii of["svg","png"])if(Ct===!0||Ct.export===!0||Ct.export[Ii]){const Mi=Et[`${Ii.toUpperCase()}_ACTION`],ji=document.createElement("a");ji.text=Mi,ji.href="#",ji.target="_blank",ji.download=`${wn}.${Ii}`,ji.addEventListener("mousedown",function(Co){return sA(this,void 0,void 0,function*(){Co.preventDefault();const ca=yield Lr.toImageURL(Ii,he.scaleFactor);this.href=ca})}),Ji.append(ji)}}if(Ct===!0||Ct.source!==!1){const Ii=document.createElement("a");Ii.text=Et.SOURCE_ACTION,Ii.href="#",Ii.addEventListener("click",function(Mi){var ji,Co;x7(kn()(se),(ji=he.sourceHeader)!==null&&ji!==void 0?ji:"",(Co=he.sourceFooter)!==null&&Co!==void 0?Co:"",qn),Mi.preventDefault()}),Ji.append(Ii)}if(qn==="vega-lite"&&(Ct===!0||Ct.compiled!==!1)){const Ii=document.createElement("a");Ii.text=Et.COMPILED_ACTION,Ii.href="#",Ii.addEventListener("click",function(Mi){var ji,Co;x7(kn()(er),(ji=he.sourceHeader)!==null&&ji!==void 0?ji:"",(Co=he.sourceFooter)!==null&&Co!==void 0?Co:"","vega"),Mi.preventDefault()}),Ji.append(Ii)}if(Ct===!0||Ct.editor!==!1){const Ii=(lt=he.editorUrl)!==null&&lt!==void 0?lt:"https://vega.github.io/editor/",Mi=document.createElement("a");Mi.text=Et.EDITOR_ACTION,Mi.href="#",Mi.addEventListener("click",function(ji){(function(Co,ca,Qi){const Ca=Co.open(ca),Aa=250,{origin:es}=new URL(ca);let Vs=~~(1e4/Aa);Co.addEventListener("message",function Hs(Os){Os.source===Ca&&(Vs=0,Co.removeEventListener("message",Hs,!1))},!1),setTimeout(function Hs(){Vs<=0||(Ca.postMessage(Qi,es),setTimeout(Hs,Aa),Vs-=1)},Aa)})(window,Ii,{config:ct,mode:qn,renderer:gn,spec:kn()(se)}),ji.preventDefault()}),Ji.append(Mi)}}return{view:Lr,spec:se,vgSpec:er,finalize:function(){li&&document.removeEventListener("click",li),Lr.finalize()}}})}(e,g,X,x)})}},function(u,s,r){const{MAX_LENGTH:l}=r(117),{re:C,t:S}=r(90),O=r(32),U=r(115);u.exports=(j,N)=>{if(N=U(N),j instanceof O)return j;if(typeof j!="string"||j.length>l||!(N.loose?C[S.LOOSE]:C[S.FULL]).test(j))return null;try{return new O(j,N)}catch{return null}}},function(u,s,r){const{MAX_SAFE_COMPONENT_LENGTH:l}=r(117),C=r(116),S=(s=u.exports={}).re=[],O=s.src=[],U=s.t={};let j=0;const N=(L,W,z)=>{const q=j++;C(q,W),U[L]=q,O[q]=W,S[q]=new RegExp(W,z?"g":void 0)};N("NUMERICIDENTIFIER","0|[1-9]\\d*"),N("NUMERICIDENTIFIERLOOSE","[0-9]+"),N("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),N("MAINVERSION",`(${O[U.NUMERICIDENTIFIER]})\\.(${O[U.NUMERICIDENTIFIER]})\\.(${O[U.NUMERICIDENTIFIER]})`),N("MAINVERSIONLOOSE",`(${O[U.NUMERICIDENTIFIERLOOSE]})\\.(${O[U.NUMERICIDENTIFIERLOOSE]})\\.(${O[U.NUMERICIDENTIFIERLOOSE]})`),N("PRERELEASEIDENTIFIER",`(?:${O[U.NUMERICIDENTIFIER]}|${O[U.NONNUMERICIDENTIFIER]})`),N("PRERELEASEIDENTIFIERLOOSE",`(?:${O[U.NUMERICIDENTIFIERLOOSE]}|${O[U.NONNUMERICIDENTIFIER]})`),N("PRERELEASE",`(?:-(${O[U.PRERELEASEIDENTIFIER]}(?:\\.${O[U.PRERELEASEIDENTIFIER]})*))`),N("PRERELEASELOOSE",`(?:-?(${O[U.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${O[U.PRERELEASEIDENTIFIERLOOSE]})*))`),N("BUILDIDENTIFIER","[0-9A-Za-z-]+"),N("BUILD",`(?:\\+(${O[U.BUILDIDENTIFIER]}(?:\\.${O[U.BUILDIDENTIFIER]})*))`),N("FULLPLAIN",`v?${O[U.MAINVERSION]}${O[U.PRERELEASE]}?${O[U.BUILD]}?`),N("FULL",`^${O[U.FULLPLAIN]}$`),N("LOOSEPLAIN",`[v=\\s]*${O[U.MAINVERSIONLOOSE]}${O[U.PRERELEASELOOSE]}?${O[U.BUILD]}?`),N("LOOSE",`^${O[U.LOOSEPLAIN]}$`),N("GTLT","((?:<|>)?=?)"),N("XRANGEIDENTIFIERLOOSE",`${O[U.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),N("XRANGEIDENTIFIER",`${O[U.NUMERICIDENTIFIER]}|x|X|\\*`),N("XRANGEPLAIN",`[v=\\s]*(${O[U.XRANGEIDENTIFIER]})(?:\\.(${O[U.XRANGEIDENTIFIER]})(?:\\.(${O[U.XRANGEIDENTIFIER]})(?:${O[U.PRERELEASE]})?${O[U.BUILD]}?)?)?`),N("XRANGEPLAINLOOSE",`[v=\\s]*(${O[U.XRANGEIDENTIFIERLOOSE]})(?:\\.(${O[U.XRANGEIDENTIFIERLOOSE]})(?:\\.(${O[U.XRANGEIDENTIFIERLOOSE]})(?:${O[U.PRERELEASELOOSE]})?${O[U.BUILD]}?)?)?`),N("XRANGE",`^${O[U.GTLT]}\\s*${O[U.XRANGEPLAIN]}$`),N("XRANGELOOSE",`^${O[U.GTLT]}\\s*${O[U.XRANGEPLAINLOOSE]}$`),N("COERCE",`(^|[^\\d])(\\d{1,${l}})(?:\\.(\\d{1,${l}}))?(?:\\.(\\d{1,${l}}))?(?:$|[^\\d])`),N("COERCERTL",O[U.COERCE],!0),N("LONETILDE","(?:~>?)"),N("TILDETRIM",`(\\s*)${O[U.LONETILDE]}\\s+`,!0),s.tildeTrimReplace="$1~",N("TILDE",`^${O[U.LONETILDE]}${O[U.XRANGEPLAIN]}$`),N("TILDELOOSE",`^${O[U.LONETILDE]}${O[U.XRANGEPLAINLOOSE]}$`),N("LONECARET","(?:\\^)"),N("CARETTRIM",`(\\s*)${O[U.LONECARET]}\\s+`,!0),s.caretTrimReplace="$1^",N("CARET",`^${O[U.LONECARET]}${O[U.XRANGEPLAIN]}$`),N("CARETLOOSE",`^${O[U.LONECARET]}${O[U.XRANGEPLAINLOOSE]}$`),N("COMPARATORLOOSE",`^${O[U.GTLT]}\\s*(${O[U.LOOSEPLAIN]})$|^$`),N("COMPARATOR",`^${O[U.GTLT]}\\s*(${O[U.FULLPLAIN]})$|^$`),N("COMPARATORTRIM",`(\\s*)${O[U.GTLT]}\\s*(${O[U.LOOSEPLAIN]}|${O[U.XRANGEPLAIN]})`,!0),s.comparatorTrimReplace="$1$2$3",N("HYPHENRANGE",`^\\s*(${O[U.XRANGEPLAIN]})\\s+-\\s+(${O[U.XRANGEPLAIN]})\\s*$`),N("HYPHENRANGELOOSE",`^\\s*(${O[U.XRANGEPLAINLOOSE]})\\s+-\\s+(${O[U.XRANGEPLAINLOOSE]})\\s*$`),N("STAR","(<|>)?=?\\s*\\*"),N("GTE0","^\\s*>=\\s*0.0.0\\s*$"),N("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(25),C=r(103),S=r(29),O=r(21),U=r(373),j=r(28);function N(z,q,I,Z){if(Z==null&&(Z=O.inferDtype(z)),Z==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!O.isTypedArray(z)&&!Array.isArray(z)&&typeof z!="number"&&typeof z!="boolean"&&typeof z!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(q!=null){O.assertNonNegativeIntegerDimensions(q);var Y=O.sizeFromShape(q),G=O.sizeFromShape(I);O.assert(Y===G,function(){return"Based on the provided shape, ["+q+"], the tensor should have "+Y+" values but has "+G});for(var oe=0;oe<I.length;++oe){var ce=I[oe],be=oe!==I.length-1||ce!==O.sizeFromShape(q.slice(oe));O.assert(I[oe]===q[oe]||!be,function(){return"Error creating a new Tensor. Inferred shape ("+I+") does not match the provided shape ("+q+"). "})}}return O.isTypedArray(z)||Array.isArray(z)||(z=[z]),q=q||I,z=Z!=="string"?O.toTypedArray(z,Z,C.env().getBool("DEBUG")):O.flatten(z,[],!0),l.ENGINE.makeTensor(z,q,Z)}function L(z,q){O.assertNonNull(z);var I=S.inferShape(z,q);if(I.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return N(z,null,I,q)}function W(z,q){if(q===void 0&&(q="float32"),q==="complex64"){var I=W(z,"float32"),Z=W(z,"float32");return U.complex(I,Z)}var Y=O.makeZerosTypedArray(O.sizeFromShape(z),q);return l.ENGINE.makeTensor(Y,z,q)}s.tensor=function(z,q,I){return N(z,q,S.inferShape(z,I),I)},s.scalar=function(z,q){if((O.isTypedArray(z)&&q!=="string"||Array.isArray(z))&&q!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(q==="string"&&O.isTypedArray(z)&&!(z instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return N(z,[],[],q)},s.tensor1d=L,s.tensor2d=function(z,q,I){if(O.assertNonNull(z),q!=null&&q.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var Z=S.inferShape(z,I);if(Z.length!==2&&Z.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(Z.length===1&&q==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return N(z,q,Z,I)},s.tensor3d=function(z,q,I){if(O.assertNonNull(z),q!=null&&q.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var Z=S.inferShape(z,I);if(Z.length!==3&&Z.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(Z.length===1&&q==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return N(z,q,Z,I)},s.tensor4d=function(z,q,I){if(O.assertNonNull(z),q!=null&&q.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var Z=S.inferShape(z,I);if(Z.length!==4&&Z.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(Z.length===1&&q==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return N(z,q,Z,I)},s.tensor5d=function(z,q,I){if(O.assertNonNull(z),q!=null&&q.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var Z=S.inferShape(z,I);if(Z.length!==5&&Z.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(Z.length===1&&q==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return N(z,q,Z,I)},s.tensor6d=function(z,q,I){if(O.assertNonNull(z),q!=null&&q.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var Z=S.inferShape(z,I);if(Z.length!==6&&Z.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(Z.length===1&&q==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return N(z,q=q||Z,Z,I)},s.variable=function(z,q,I,Z){return q===void 0&&(q=!0),l.ENGINE.makeVariable(z,q,I,Z)},s.ones=function z(q,I){if(I===void 0&&(I="float32"),I==="complex64"){var Z=z(q,"float32"),Y=W(q,"float32");return U.complex(Z,Y)}var G=O.makeOnesTypedArray(O.sizeFromShape(q),I);return l.ENGINE.makeTensor(G,q,I)},s.zeros=W,s.fill=function(z,q,I){return l.ENGINE.runKernelFunc(function(Z){return Z.fill(z,q,I)},{})},s.linspace=function(z,q,I){if(I<=0)throw new Error("The number of values should be positive.");return l.ENGINE.runKernelFunc(function(Z){return Z.linspace(z,q,I)},{})},s.range=function(z,q,I,Z){if(I===void 0&&(I=1),Z===void 0&&(Z="float32"),I===0)throw new Error("Cannot have a step of zero");if(z===q||z<q&&I<0||q<z&&I>1)return W([0],Z);var Y=Math.abs(Math.ceil((q-z)/I)),G=O.makeZerosTypedArray(Y,Z);q<z&&I===1&&(I=-1),G[0]=z;for(var oe=1;oe<G.length;oe++)G[oe]=G[oe-1]+I;return L(G,Z)},s.onesLike=j.op({onesLike_:function(z){var q=S.convertToTensor(z,"x","onesLike");if(q.dtype==="complex64"){var I=s.onesLike(U.real(q)),Z=s.zerosLike(U.imag(q));return U.complex(I,Z)}return l.ENGINE.runKernelFunc(function(Y){return Y.onesLike(q)},{x:q},function(Y,G){return{x:function(){return s.zerosLike(Y)}}},"OnesLike")}}),s.zerosLike=j.op({zerosLike_:function(z){var q=S.convertToTensor(z,"x","zerosLike");return l.ENGINE.runKernelFunc(function(I){return I.zerosLike(q)},{x:q},function(I,Z){return{x:function(){return s.zerosLike(I)}}},"ZerosLike")}})},function(u,s,r){(function(l){var C=r(394),S=r(393),O=r(392);function U(){return N.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function j(qe,Qe){if(U()<Qe)throw new RangeError("Invalid typed array length");return N.TYPED_ARRAY_SUPPORT?(qe=new Uint8Array(Qe)).__proto__=N.prototype:(qe===null&&(qe=new N(Qe)),qe.length=Qe),qe}function N(qe,Qe,$e){if(!(N.TYPED_ARRAY_SUPPORT||this instanceof N))return new N(qe,Qe,$e);if(typeof qe=="number"){if(typeof Qe=="string")throw new Error("If encoding is specified then the first argument must be a string");return z(this,qe)}return L(this,qe,Qe,$e)}function L(qe,Qe,$e,ft){if(typeof Qe=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&Qe instanceof ArrayBuffer?function(Jt,Qt,Pn,kn){if(Qt.byteLength,Pn<0||Qt.byteLength<Pn)throw new RangeError("'offset' is out of bounds");if(Qt.byteLength<Pn+(kn||0))throw new RangeError("'length' is out of bounds");return Qt=Pn===void 0&&kn===void 0?new Uint8Array(Qt):kn===void 0?new Uint8Array(Qt,Pn):new Uint8Array(Qt,Pn,kn),N.TYPED_ARRAY_SUPPORT?(Jt=Qt).__proto__=N.prototype:Jt=q(Jt,Qt),Jt}(qe,Qe,$e,ft):typeof Qe=="string"?function(Jt,Qt,Pn){if(typeof Pn=="string"&&Pn!==""||(Pn="utf8"),!N.isEncoding(Pn))throw new TypeError('"encoding" must be a valid string encoding');var kn=0|Z(Qt,Pn),Qn=(Jt=j(Jt,kn)).write(Qt,Pn);return Qn!==kn&&(Jt=Jt.slice(0,Qn)),Jt}(qe,Qe,$e):function(Jt,Qt){if(N.isBuffer(Qt)){var Pn=0|I(Qt.length);return(Jt=j(Jt,Pn)).length===0||Qt.copy(Jt,0,0,Pn),Jt}if(Qt){if(typeof ArrayBuffer<"u"&&Qt.buffer instanceof ArrayBuffer||"length"in Qt)return typeof Qt.length!="number"||function(kn){return kn!=kn}(Qt.length)?j(Jt,0):q(Jt,Qt);if(Qt.type==="Buffer"&&O(Qt.data))return q(Jt,Qt.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(qe,Qe)}function W(qe){if(typeof qe!="number")throw new TypeError('"size" argument must be a number');if(qe<0)throw new RangeError('"size" argument must not be negative')}function z(qe,Qe){if(W(Qe),qe=j(qe,Qe<0?0:0|I(Qe)),!N.TYPED_ARRAY_SUPPORT)for(var $e=0;$e<Qe;++$e)qe[$e]=0;return qe}function q(qe,Qe){var $e=Qe.length<0?0:0|I(Qe.length);qe=j(qe,$e);for(var ft=0;ft<$e;ft+=1)qe[ft]=255&Qe[ft];return qe}function I(qe){if(qe>=U())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+U().toString(16)+" bytes");return 0|qe}function Z(qe,Qe){if(N.isBuffer(qe))return qe.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(qe)||qe instanceof ArrayBuffer))return qe.byteLength;typeof qe!="string"&&(qe=""+qe);var $e=qe.length;if($e===0)return 0;for(var ft=!1;;)switch(Qe){case"ascii":case"latin1":case"binary":return $e;case"utf8":case"utf-8":case void 0:return Fn(qe).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*$e;case"hex":return $e>>>1;case"base64":return Rn(qe).length;default:if(ft)return Fn(qe).length;Qe=(""+Qe).toLowerCase(),ft=!0}}function Y(qe,Qe,$e){var ft=qe[Qe];qe[Qe]=qe[$e],qe[$e]=ft}function G(qe,Qe,$e,ft,Jt){if(qe.length===0)return-1;if(typeof $e=="string"?(ft=$e,$e=0):$e>2147483647?$e=2147483647:$e<-2147483648&&($e=-2147483648),$e=+$e,isNaN($e)&&($e=Jt?0:qe.length-1),$e<0&&($e=qe.length+$e),$e>=qe.length){if(Jt)return-1;$e=qe.length-1}else if($e<0){if(!Jt)return-1;$e=0}if(typeof Qe=="string"&&(Qe=N.from(Qe,ft)),N.isBuffer(Qe))return Qe.length===0?-1:oe(qe,Qe,$e,ft,Jt);if(typeof Qe=="number")return Qe&=255,N.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?Jt?Uint8Array.prototype.indexOf.call(qe,Qe,$e):Uint8Array.prototype.lastIndexOf.call(qe,Qe,$e):oe(qe,[Qe],$e,ft,Jt);throw new TypeError("val must be string, number or Buffer")}function oe(qe,Qe,$e,ft,Jt){var Qt,Pn=1,kn=qe.length,Qn=Qe.length;if(ft!==void 0&&((ft=String(ft).toLowerCase())==="ucs2"||ft==="ucs-2"||ft==="utf16le"||ft==="utf-16le")){if(qe.length<2||Qe.length<2)return-1;Pn=2,kn/=2,Qn/=2,$e/=2}function ke(Ht,Gn){return Pn===1?Ht[Gn]:Ht.readUInt16BE(Gn*Pn)}if(Jt){var ar=-1;for(Qt=$e;Qt<kn;Qt++)if(ke(qe,Qt)===ke(Qe,ar===-1?0:Qt-ar)){if(ar===-1&&(ar=Qt),Qt-ar+1===Qn)return ar*Pn}else ar!==-1&&(Qt-=Qt-ar),ar=-1}else for($e+Qn>kn&&($e=kn-Qn),Qt=$e;Qt>=0;Qt--){for(var Tr=!0,rn=0;rn<Qn;rn++)if(ke(qe,Qt+rn)!==ke(Qe,rn)){Tr=!1;break}if(Tr)return Qt}return-1}function ce(qe,Qe,$e,ft){$e=Number($e)||0;var Jt=qe.length-$e;ft?(ft=Number(ft))>Jt&&(ft=Jt):ft=Jt;var Qt=Qe.length;if(Qt%2!=0)throw new TypeError("Invalid hex string");ft>Qt/2&&(ft=Qt/2);for(var Pn=0;Pn<ft;++Pn){var kn=parseInt(Qe.substr(2*Pn,2),16);if(isNaN(kn))return Pn;qe[$e+Pn]=kn}return Pn}function be(qe,Qe,$e,ft){return cn(Fn(Qe,qe.length-$e),qe,$e,ft)}function Ee(qe,Qe,$e,ft){return cn(function(Jt){for(var Qt=[],Pn=0;Pn<Jt.length;++Pn)Qt.push(255&Jt.charCodeAt(Pn));return Qt}(Qe),qe,$e,ft)}function ve(qe,Qe,$e,ft){return Ee(qe,Qe,$e,ft)}function ge(qe,Qe,$e,ft){return cn(Rn(Qe),qe,$e,ft)}function Ge(qe,Qe,$e,ft){return cn(function(Jt,Qt){for(var Pn,kn,Qn,ke=[],ar=0;ar<Jt.length&&!((Qt-=2)<0);++ar)Pn=Jt.charCodeAt(ar),kn=Pn>>8,Qn=Pn%256,ke.push(Qn),ke.push(kn);return ke}(Qe,qe.length-$e),qe,$e,ft)}function ht(qe,Qe,$e){return Qe===0&&$e===qe.length?C.fromByteArray(qe):C.fromByteArray(qe.slice(Qe,$e))}function It(qe,Qe,$e){$e=Math.min(qe.length,$e);for(var ft=[],Jt=Qe;Jt<$e;){var Qt,Pn,kn,Qn,ke=qe[Jt],ar=null,Tr=ke>239?4:ke>223?3:ke>191?2:1;if(Jt+Tr<=$e)switch(Tr){case 1:ke<128&&(ar=ke);break;case 2:(192&(Qt=qe[Jt+1]))==128&&(Qn=(31&ke)<<6|63&Qt)>127&&(ar=Qn);break;case 3:Qt=qe[Jt+1],Pn=qe[Jt+2],(192&Qt)==128&&(192&Pn)==128&&(Qn=(15&ke)<<12|(63&Qt)<<6|63&Pn)>2047&&(Qn<55296||Qn>57343)&&(ar=Qn);break;case 4:Qt=qe[Jt+1],Pn=qe[Jt+2],kn=qe[Jt+3],(192&Qt)==128&&(192&Pn)==128&&(192&kn)==128&&(Qn=(15&ke)<<18|(63&Qt)<<12|(63&Pn)<<6|63&kn)>65535&&Qn<1114112&&(ar=Qn)}ar===null?(ar=65533,Tr=1):ar>65535&&(ar-=65536,ft.push(ar>>>10&1023|55296),ar=56320|1023&ar),ft.push(ar),Jt+=Tr}return function(rn){var Ht=rn.length;if(Ht<=St)return String.fromCharCode.apply(String,rn);for(var Gn="",Xt=0;Xt<Ht;)Gn+=String.fromCharCode.apply(String,rn.slice(Xt,Xt+=St));return Gn}(ft)}s.Buffer=N,s.SlowBuffer=function(qe){return+qe!=qe&&(qe=0),N.alloc(+qe)},s.INSPECT_MAX_BYTES=50,N.TYPED_ARRAY_SUPPORT=l.TYPED_ARRAY_SUPPORT!==void 0?l.TYPED_ARRAY_SUPPORT:function(){try{var qe=new Uint8Array(1);return qe.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},qe.foo()===42&&typeof qe.subarray=="function"&&qe.subarray(1,1).byteLength===0}catch{return!1}}(),s.kMaxLength=U(),N.poolSize=8192,N._augment=function(qe){return qe.__proto__=N.prototype,qe},N.from=function(qe,Qe,$e){return L(null,qe,Qe,$e)},N.TYPED_ARRAY_SUPPORT&&(N.prototype.__proto__=Uint8Array.prototype,N.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&N[Symbol.species]===N&&Object.defineProperty(N,Symbol.species,{value:null,configurable:!0})),N.alloc=function(qe,Qe,$e){return function(ft,Jt,Qt,Pn){return W(Jt),Jt<=0?j(ft,Jt):Qt!==void 0?typeof Pn=="string"?j(ft,Jt).fill(Qt,Pn):j(ft,Jt).fill(Qt):j(ft,Jt)}(null,qe,Qe,$e)},N.allocUnsafe=function(qe){return z(null,qe)},N.allocUnsafeSlow=function(qe){return z(null,qe)},N.isBuffer=function(qe){return!(qe==null||!qe._isBuffer)},N.compare=function(qe,Qe){if(!N.isBuffer(qe)||!N.isBuffer(Qe))throw new TypeError("Arguments must be Buffers");if(qe===Qe)return 0;for(var $e=qe.length,ft=Qe.length,Jt=0,Qt=Math.min($e,ft);Jt<Qt;++Jt)if(qe[Jt]!==Qe[Jt]){$e=qe[Jt],ft=Qe[Jt];break}return $e<ft?-1:ft<$e?1:0},N.isEncoding=function(qe){switch(String(qe).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},N.concat=function(qe,Qe){if(!O(qe))throw new TypeError('"list" argument must be an Array of Buffers');if(qe.length===0)return N.alloc(0);var $e;if(Qe===void 0)for(Qe=0,$e=0;$e<qe.length;++$e)Qe+=qe[$e].length;var ft=N.allocUnsafe(Qe),Jt=0;for($e=0;$e<qe.length;++$e){var Qt=qe[$e];if(!N.isBuffer(Qt))throw new TypeError('"list" argument must be an Array of Buffers');Qt.copy(ft,Jt),Jt+=Qt.length}return ft},N.byteLength=Z,N.prototype._isBuffer=!0,N.prototype.swap16=function(){var qe=this.length;if(qe%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var Qe=0;Qe<qe;Qe+=2)Y(this,Qe,Qe+1);return this},N.prototype.swap32=function(){var qe=this.length;if(qe%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var Qe=0;Qe<qe;Qe+=4)Y(this,Qe,Qe+3),Y(this,Qe+1,Qe+2);return this},N.prototype.swap64=function(){var qe=this.length;if(qe%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var Qe=0;Qe<qe;Qe+=8)Y(this,Qe,Qe+7),Y(this,Qe+1,Qe+6),Y(this,Qe+2,Qe+5),Y(this,Qe+3,Qe+4);return this},N.prototype.toString=function(){var qe=0|this.length;return qe===0?"":arguments.length===0?It(this,0,qe):function(Qe,$e,ft){var Jt=!1;if(($e===void 0||$e<0)&&($e=0),$e>this.length||((ft===void 0||ft>this.length)&&(ft=this.length),ft<=0)||(ft>>>=0)<=($e>>>=0))return"";for(Qe||(Qe="utf8");;)switch(Qe){case"hex":return jt(this,$e,ft);case"utf8":case"utf-8":return It(this,$e,ft);case"ascii":return we(this,$e,ft);case"latin1":case"binary":return bt(this,$e,ft);case"base64":return ht(this,$e,ft);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Mt(this,$e,ft);default:if(Jt)throw new TypeError("Unknown encoding: "+Qe);Qe=(Qe+"").toLowerCase(),Jt=!0}}.apply(this,arguments)},N.prototype.equals=function(qe){if(!N.isBuffer(qe))throw new TypeError("Argument must be a Buffer");return this===qe||N.compare(this,qe)===0},N.prototype.inspect=function(){var qe="",Qe=s.INSPECT_MAX_BYTES;return this.length>0&&(qe=this.toString("hex",0,Qe).match(/.{2}/g).join(" "),this.length>Qe&&(qe+=" ... ")),"<Buffer "+qe+">"},N.prototype.compare=function(qe,Qe,$e,ft,Jt){if(!N.isBuffer(qe))throw new TypeError("Argument must be a Buffer");if(Qe===void 0&&(Qe=0),$e===void 0&&($e=qe?qe.length:0),ft===void 0&&(ft=0),Jt===void 0&&(Jt=this.length),Qe<0||$e>qe.length||ft<0||Jt>this.length)throw new RangeError("out of range index");if(ft>=Jt&&Qe>=$e)return 0;if(ft>=Jt)return-1;if(Qe>=$e)return 1;if(Qe>>>=0,$e>>>=0,ft>>>=0,Jt>>>=0,this===qe)return 0;for(var Qt=Jt-ft,Pn=$e-Qe,kn=Math.min(Qt,Pn),Qn=this.slice(ft,Jt),ke=qe.slice(Qe,$e),ar=0;ar<kn;++ar)if(Qn[ar]!==ke[ar]){Qt=Qn[ar],Pn=ke[ar];break}return Qt<Pn?-1:Pn<Qt?1:0},N.prototype.includes=function(qe,Qe,$e){return this.indexOf(qe,Qe,$e)!==-1},N.prototype.indexOf=function(qe,Qe,$e){return G(this,qe,Qe,$e,!0)},N.prototype.lastIndexOf=function(qe,Qe,$e){return G(this,qe,Qe,$e,!1)},N.prototype.write=function(qe,Qe,$e,ft){if(Qe===void 0)ft="utf8",$e=this.length,Qe=0;else if($e===void 0&&typeof Qe=="string")ft=Qe,$e=this.length,Qe=0;else{if(!isFinite(Qe))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");Qe|=0,isFinite($e)?($e|=0,ft===void 0&&(ft="utf8")):(ft=$e,$e=void 0)}var Jt=this.length-Qe;if(($e===void 0||$e>Jt)&&($e=Jt),qe.length>0&&($e<0||Qe<0)||Qe>this.length)throw new RangeError("Attempt to write outside buffer bounds");ft||(ft="utf8");for(var Qt=!1;;)switch(ft){case"hex":return ce(this,qe,Qe,$e);case"utf8":case"utf-8":return be(this,qe,Qe,$e);case"ascii":return Ee(this,qe,Qe,$e);case"latin1":case"binary":return ve(this,qe,Qe,$e);case"base64":return ge(this,qe,Qe,$e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ge(this,qe,Qe,$e);default:if(Qt)throw new TypeError("Unknown encoding: "+ft);ft=(""+ft).toLowerCase(),Qt=!0}},N.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var St=4096;function we(qe,Qe,$e){var ft="";$e=Math.min(qe.length,$e);for(var Jt=Qe;Jt<$e;++Jt)ft+=String.fromCharCode(127&qe[Jt]);return ft}function bt(qe,Qe,$e){var ft="";$e=Math.min(qe.length,$e);for(var Jt=Qe;Jt<$e;++Jt)ft+=String.fromCharCode(qe[Jt]);return ft}function jt(qe,Qe,$e){var ft=qe.length;(!Qe||Qe<0)&&(Qe=0),(!$e||$e<0||$e>ft)&&($e=ft);for(var Jt="",Qt=Qe;Qt<$e;++Qt)Jt+=Yt(qe[Qt]);return Jt}function Mt(qe,Qe,$e){for(var ft=qe.slice(Qe,$e),Jt="",Qt=0;Qt<ft.length;Qt+=2)Jt+=String.fromCharCode(ft[Qt]+256*ft[Qt+1]);return Jt}function ze(qe,Qe,$e){if(qe%1!=0||qe<0)throw new RangeError("offset is not uint");if(qe+Qe>$e)throw new RangeError("Trying to access beyond buffer length")}function Ut(qe,Qe,$e,ft,Jt,Qt){if(!N.isBuffer(qe))throw new TypeError('"buffer" argument must be a Buffer instance');if(Qe>Jt||Qe<Qt)throw new RangeError('"value" argument is out of bounds');if($e+ft>qe.length)throw new RangeError("Index out of range")}function Ft(qe,Qe,$e,ft){Qe<0&&(Qe=65535+Qe+1);for(var Jt=0,Qt=Math.min(qe.length-$e,2);Jt<Qt;++Jt)qe[$e+Jt]=(Qe&255<<8*(ft?Jt:1-Jt))>>>8*(ft?Jt:1-Jt)}function pt(qe,Qe,$e,ft){Qe<0&&(Qe=4294967295+Qe+1);for(var Jt=0,Qt=Math.min(qe.length-$e,4);Jt<Qt;++Jt)qe[$e+Jt]=Qe>>>8*(ft?Jt:3-Jt)&255}function yt(qe,Qe,$e,ft,Jt,Qt){if($e+ft>qe.length)throw new RangeError("Index out of range");if($e<0)throw new RangeError("Index out of range")}function nn(qe,Qe,$e,ft,Jt){return Jt||yt(qe,0,$e,4),S.write(qe,Qe,$e,ft,23,4),$e+4}function xt(qe,Qe,$e,ft,Jt){return Jt||yt(qe,0,$e,8),S.write(qe,Qe,$e,ft,52,8),$e+8}N.prototype.slice=function(qe,Qe){var $e,ft=this.length;if(qe=~~qe,Qe=Qe===void 0?ft:~~Qe,qe<0?(qe+=ft)<0&&(qe=0):qe>ft&&(qe=ft),Qe<0?(Qe+=ft)<0&&(Qe=0):Qe>ft&&(Qe=ft),Qe<qe&&(Qe=qe),N.TYPED_ARRAY_SUPPORT)($e=this.subarray(qe,Qe)).__proto__=N.prototype;else{var Jt=Qe-qe;$e=new N(Jt,void 0);for(var Qt=0;Qt<Jt;++Qt)$e[Qt]=this[Qt+qe]}return $e},N.prototype.readUIntLE=function(qe,Qe,$e){qe|=0,Qe|=0,$e||ze(qe,Qe,this.length);for(var ft=this[qe],Jt=1,Qt=0;++Qt<Qe&&(Jt*=256);)ft+=this[qe+Qt]*Jt;return ft},N.prototype.readUIntBE=function(qe,Qe,$e){qe|=0,Qe|=0,$e||ze(qe,Qe,this.length);for(var ft=this[qe+--Qe],Jt=1;Qe>0&&(Jt*=256);)ft+=this[qe+--Qe]*Jt;return ft},N.prototype.readUInt8=function(qe,Qe){return Qe||ze(qe,1,this.length),this[qe]},N.prototype.readUInt16LE=function(qe,Qe){return Qe||ze(qe,2,this.length),this[qe]|this[qe+1]<<8},N.prototype.readUInt16BE=function(qe,Qe){return Qe||ze(qe,2,this.length),this[qe]<<8|this[qe+1]},N.prototype.readUInt32LE=function(qe,Qe){return Qe||ze(qe,4,this.length),(this[qe]|this[qe+1]<<8|this[qe+2]<<16)+16777216*this[qe+3]},N.prototype.readUInt32BE=function(qe,Qe){return Qe||ze(qe,4,this.length),16777216*this[qe]+(this[qe+1]<<16|this[qe+2]<<8|this[qe+3])},N.prototype.readIntLE=function(qe,Qe,$e){qe|=0,Qe|=0,$e||ze(qe,Qe,this.length);for(var ft=this[qe],Jt=1,Qt=0;++Qt<Qe&&(Jt*=256);)ft+=this[qe+Qt]*Jt;return ft>=(Jt*=128)&&(ft-=Math.pow(2,8*Qe)),ft},N.prototype.readIntBE=function(qe,Qe,$e){qe|=0,Qe|=0,$e||ze(qe,Qe,this.length);for(var ft=Qe,Jt=1,Qt=this[qe+--ft];ft>0&&(Jt*=256);)Qt+=this[qe+--ft]*Jt;return Qt>=(Jt*=128)&&(Qt-=Math.pow(2,8*Qe)),Qt},N.prototype.readInt8=function(qe,Qe){return Qe||ze(qe,1,this.length),128&this[qe]?-1*(255-this[qe]+1):this[qe]},N.prototype.readInt16LE=function(qe,Qe){Qe||ze(qe,2,this.length);var $e=this[qe]|this[qe+1]<<8;return 32768&$e?4294901760|$e:$e},N.prototype.readInt16BE=function(qe,Qe){Qe||ze(qe,2,this.length);var $e=this[qe+1]|this[qe]<<8;return 32768&$e?4294901760|$e:$e},N.prototype.readInt32LE=function(qe,Qe){return Qe||ze(qe,4,this.length),this[qe]|this[qe+1]<<8|this[qe+2]<<16|this[qe+3]<<24},N.prototype.readInt32BE=function(qe,Qe){return Qe||ze(qe,4,this.length),this[qe]<<24|this[qe+1]<<16|this[qe+2]<<8|this[qe+3]},N.prototype.readFloatLE=function(qe,Qe){return Qe||ze(qe,4,this.length),S.read(this,qe,!0,23,4)},N.prototype.readFloatBE=function(qe,Qe){return Qe||ze(qe,4,this.length),S.read(this,qe,!1,23,4)},N.prototype.readDoubleLE=function(qe,Qe){return Qe||ze(qe,8,this.length),S.read(this,qe,!0,52,8)},N.prototype.readDoubleBE=function(qe,Qe){return Qe||ze(qe,8,this.length),S.read(this,qe,!1,52,8)},N.prototype.writeUIntLE=function(qe,Qe,$e,ft){qe=+qe,Qe|=0,$e|=0,ft||Ut(this,qe,Qe,$e,Math.pow(2,8*$e)-1,0);var Jt=1,Qt=0;for(this[Qe]=255&qe;++Qt<$e&&(Jt*=256);)this[Qe+Qt]=qe/Jt&255;return Qe+$e},N.prototype.writeUIntBE=function(qe,Qe,$e,ft){qe=+qe,Qe|=0,$e|=0,ft||Ut(this,qe,Qe,$e,Math.pow(2,8*$e)-1,0);var Jt=$e-1,Qt=1;for(this[Qe+Jt]=255&qe;--Jt>=0&&(Qt*=256);)this[Qe+Jt]=qe/Qt&255;return Qe+$e},N.prototype.writeUInt8=function(qe,Qe,$e){return qe=+qe,Qe|=0,$e||Ut(this,qe,Qe,1,255,0),N.TYPED_ARRAY_SUPPORT||(qe=Math.floor(qe)),this[Qe]=255&qe,Qe+1},N.prototype.writeUInt16LE=function(qe,Qe,$e){return qe=+qe,Qe|=0,$e||Ut(this,qe,Qe,2,65535,0),N.TYPED_ARRAY_SUPPORT?(this[Qe]=255&qe,this[Qe+1]=qe>>>8):Ft(this,qe,Qe,!0),Qe+2},N.prototype.writeUInt16BE=function(qe,Qe,$e){return qe=+qe,Qe|=0,$e||Ut(this,qe,Qe,2,65535,0),N.TYPED_ARRAY_SUPPORT?(this[Qe]=qe>>>8,this[Qe+1]=255&qe):Ft(this,qe,Qe,!1),Qe+2},N.prototype.writeUInt32LE=function(qe,Qe,$e){return qe=+qe,Qe|=0,$e||Ut(this,qe,Qe,4,4294967295,0),N.TYPED_ARRAY_SUPPORT?(this[Qe+3]=qe>>>24,this[Qe+2]=qe>>>16,this[Qe+1]=qe>>>8,this[Qe]=255&qe):pt(this,qe,Qe,!0),Qe+4},N.prototype.writeUInt32BE=function(qe,Qe,$e){return qe=+qe,Qe|=0,$e||Ut(this,qe,Qe,4,4294967295,0),N.TYPED_ARRAY_SUPPORT?(this[Qe]=qe>>>24,this[Qe+1]=qe>>>16,this[Qe+2]=qe>>>8,this[Qe+3]=255&qe):pt(this,qe,Qe,!1),Qe+4},N.prototype.writeIntLE=function(qe,Qe,$e,ft){if(qe=+qe,Qe|=0,!ft){var Jt=Math.pow(2,8*$e-1);Ut(this,qe,Qe,$e,Jt-1,-Jt)}var Qt=0,Pn=1,kn=0;for(this[Qe]=255&qe;++Qt<$e&&(Pn*=256);)qe<0&&kn===0&&this[Qe+Qt-1]!==0&&(kn=1),this[Qe+Qt]=(qe/Pn>>0)-kn&255;return Qe+$e},N.prototype.writeIntBE=function(qe,Qe,$e,ft){if(qe=+qe,Qe|=0,!ft){var Jt=Math.pow(2,8*$e-1);Ut(this,qe,Qe,$e,Jt-1,-Jt)}var Qt=$e-1,Pn=1,kn=0;for(this[Qe+Qt]=255&qe;--Qt>=0&&(Pn*=256);)qe<0&&kn===0&&this[Qe+Qt+1]!==0&&(kn=1),this[Qe+Qt]=(qe/Pn>>0)-kn&255;return Qe+$e},N.prototype.writeInt8=function(qe,Qe,$e){return qe=+qe,Qe|=0,$e||Ut(this,qe,Qe,1,127,-128),N.TYPED_ARRAY_SUPPORT||(qe=Math.floor(qe)),qe<0&&(qe=255+qe+1),this[Qe]=255&qe,Qe+1},N.prototype.writeInt16LE=function(qe,Qe,$e){return qe=+qe,Qe|=0,$e||Ut(this,qe,Qe,2,32767,-32768),N.TYPED_ARRAY_SUPPORT?(this[Qe]=255&qe,this[Qe+1]=qe>>>8):Ft(this,qe,Qe,!0),Qe+2},N.prototype.writeInt16BE=function(qe,Qe,$e){return qe=+qe,Qe|=0,$e||Ut(this,qe,Qe,2,32767,-32768),N.TYPED_ARRAY_SUPPORT?(this[Qe]=qe>>>8,this[Qe+1]=255&qe):Ft(this,qe,Qe,!1),Qe+2},N.prototype.writeInt32LE=function(qe,Qe,$e){return qe=+qe,Qe|=0,$e||Ut(this,qe,Qe,4,2147483647,-2147483648),N.TYPED_ARRAY_SUPPORT?(this[Qe]=255&qe,this[Qe+1]=qe>>>8,this[Qe+2]=qe>>>16,this[Qe+3]=qe>>>24):pt(this,qe,Qe,!0),Qe+4},N.prototype.writeInt32BE=function(qe,Qe,$e){return qe=+qe,Qe|=0,$e||Ut(this,qe,Qe,4,2147483647,-2147483648),qe<0&&(qe=4294967295+qe+1),N.TYPED_ARRAY_SUPPORT?(this[Qe]=qe>>>24,this[Qe+1]=qe>>>16,this[Qe+2]=qe>>>8,this[Qe+3]=255&qe):pt(this,qe,Qe,!1),Qe+4},N.prototype.writeFloatLE=function(qe,Qe,$e){return nn(this,qe,Qe,!0,$e)},N.prototype.writeFloatBE=function(qe,Qe,$e){return nn(this,qe,Qe,!1,$e)},N.prototype.writeDoubleLE=function(qe,Qe,$e){return xt(this,qe,Qe,!0,$e)},N.prototype.writeDoubleBE=function(qe,Qe,$e){return xt(this,qe,Qe,!1,$e)},N.prototype.copy=function(qe,Qe,$e,ft){if($e||($e=0),ft||ft===0||(ft=this.length),Qe>=qe.length&&(Qe=qe.length),Qe||(Qe=0),ft>0&&ft<$e&&(ft=$e),ft===$e||qe.length===0||this.length===0)return 0;if(Qe<0)throw new RangeError("targetStart out of bounds");if($e<0||$e>=this.length)throw new RangeError("sourceStart out of bounds");if(ft<0)throw new RangeError("sourceEnd out of bounds");ft>this.length&&(ft=this.length),qe.length-Qe<ft-$e&&(ft=qe.length-Qe+$e);var Jt,Qt=ft-$e;if(this===qe&&$e<Qe&&Qe<ft)for(Jt=Qt-1;Jt>=0;--Jt)qe[Jt+Qe]=this[Jt+$e];else if(Qt<1e3||!N.TYPED_ARRAY_SUPPORT)for(Jt=0;Jt<Qt;++Jt)qe[Jt+Qe]=this[Jt+$e];else Uint8Array.prototype.set.call(qe,this.subarray($e,$e+Qt),Qe);return Qt},N.prototype.fill=function(qe,Qe,$e,ft){if(typeof qe=="string"){if(typeof Qe=="string"?(ft=Qe,Qe=0,$e=this.length):typeof $e=="string"&&(ft=$e,$e=this.length),qe.length===1){var Jt=qe.charCodeAt(0);Jt<256&&(qe=Jt)}if(ft!==void 0&&typeof ft!="string")throw new TypeError("encoding must be a string");if(typeof ft=="string"&&!N.isEncoding(ft))throw new TypeError("Unknown encoding: "+ft)}else typeof qe=="number"&&(qe&=255);if(Qe<0||this.length<Qe||this.length<$e)throw new RangeError("Out of range index");if($e<=Qe)return this;var Qt;if(Qe>>>=0,$e=$e===void 0?this.length:$e>>>0,qe||(qe=0),typeof qe=="number")for(Qt=Qe;Qt<$e;++Qt)this[Qt]=qe;else{var Pn=N.isBuffer(qe)?qe:Fn(new N(qe,ft).toString()),kn=Pn.length;for(Qt=0;Qt<$e-Qe;++Qt)this[Qt+Qe]=Pn[Qt%kn]}return this};var _t=/[^+\/0-9A-Za-z-_]/g;function Yt(qe){return qe<16?"0"+qe.toString(16):qe.toString(16)}function Fn(qe,Qe){var $e;Qe=Qe||1/0;for(var ft=qe.length,Jt=null,Qt=[],Pn=0;Pn<ft;++Pn){if(($e=qe.charCodeAt(Pn))>55295&&$e<57344){if(!Jt){if($e>56319){(Qe-=3)>-1&&Qt.push(239,191,189);continue}if(Pn+1===ft){(Qe-=3)>-1&&Qt.push(239,191,189);continue}Jt=$e;continue}if($e<56320){(Qe-=3)>-1&&Qt.push(239,191,189),Jt=$e;continue}$e=65536+(Jt-55296<<10|$e-56320)}else Jt&&(Qe-=3)>-1&&Qt.push(239,191,189);if(Jt=null,$e<128){if((Qe-=1)<0)break;Qt.push($e)}else if($e<2048){if((Qe-=2)<0)break;Qt.push($e>>6|192,63&$e|128)}else if($e<65536){if((Qe-=3)<0)break;Qt.push($e>>12|224,$e>>6&63|128,63&$e|128)}else{if(!($e<1114112))throw new Error("Invalid code point");if((Qe-=4)<0)break;Qt.push($e>>18|240,$e>>12&63|128,$e>>6&63|128,63&$e|128)}}return Qt}function Rn(qe){return C.toByteArray(function(Qe){if((Qe=function($e){return $e.trim?$e.trim():$e.replace(/^\s+|\s+$/g,"")}(Qe).replace(_t,"")).length<2)return"";for(;Qe.length%4!=0;)Qe+="=";return Qe}(qe))}function cn(qe,Qe,$e,ft){for(var Jt=0;Jt<ft&&!(Jt+$e>=Qe.length||Jt>=qe.length);++Jt)Qe[Jt+$e]=qe[Jt];return Jt}}).call(this,r(59))},function(u,s,r){var l=r(38);u.exports=function(C,S,O){for(var U in S)l(C,U,S[U],O);return C}},function(u,s){u.exports=function(r,l,C,S){if(!(r instanceof l)||S!==void 0&&S in r)throw TypeError(C+": incorrect invocation!");return r}},function(u,s,r){var l=r(16),C=r(26),S=r(27),O=r(19)("species");u.exports=function(U){var j=l[U];S&&j&&!j[O]&&C.f(j,O,{configurable:!0,get:function(){return this}})}},function(u,s){u.exports={}},function(u,s,r){var l=r(8),C=r(61),S=r(15),O=r(169),U="["+O+"]",j=RegExp("^"+U+U+"*"),N=RegExp(U+U+"*$"),L=function(z,q,I){var Z={},Y=S(function(){return!!O[z]()||""[z]()!=""}),G=Z[z]=Y?q(W):O[z];I&&(Z[I]=G),l(l.P+l.F*Y,"String",Z)},W=L.trim=function(z,q){return z=String(C(z)),1&q&&(z=z.replace(j,"")),2&q&&(z=z.replace(N,"")),z};u.exports=L},function(u,s,r){var l=r(26).f,C=r(43),S=r(19)("toStringTag");u.exports=function(O,U,j){O&&!C(O=j?O:O.prototype,S)&&l(O,S,{configurable:!0,value:U})}},function(u,s,r){var l,C=typeof Reflect=="object"?Reflect:null,S=C&&typeof C.apply=="function"?C.apply:function(G,oe,ce){return Function.prototype.apply.call(G,oe,ce)};l=C&&typeof C.ownKeys=="function"?C.ownKeys:Object.getOwnPropertySymbols?function(G){return Object.getOwnPropertyNames(G).concat(Object.getOwnPropertySymbols(G))}:function(G){return Object.getOwnPropertyNames(G)};var O=Number.isNaN||function(G){return G!=G};function U(){U.init.call(this)}u.exports=U,u.exports.once=function(G,oe){return new Promise(function(ce,be){function Ee(ge){G.removeListener(oe,ve),be(ge)}function ve(){typeof G.removeListener=="function"&&G.removeListener("error",Ee),ce([].slice.call(arguments))}Y(G,oe,ve,{once:!0}),oe!=="error"&&function(ge,Ge,ht){typeof ge.on=="function"&&Y(ge,"error",Ge,ht)}(G,Ee,{once:!0})})},U.EventEmitter=U,U.prototype._events=void 0,U.prototype._eventsCount=0,U.prototype._maxListeners=void 0;var j=10;function N(G){if(typeof G!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof G)}function L(G){return G._maxListeners===void 0?U.defaultMaxListeners:G._maxListeners}function W(G,oe,ce,be){var Ee,ve,ge;if(N(ce),(ve=G._events)===void 0?(ve=G._events=Object.create(null),G._eventsCount=0):(ve.newListener!==void 0&&(G.emit("newListener",oe,ce.listener?ce.listener:ce),ve=G._events),ge=ve[oe]),ge===void 0)ge=ve[oe]=ce,++G._eventsCount;else if(typeof ge=="function"?ge=ve[oe]=be?[ce,ge]:[ge,ce]:be?ge.unshift(ce):ge.push(ce),(Ee=L(G))>0&&ge.length>Ee&&!ge.warned){ge.warned=!0;var Ge=new Error("Possible EventEmitter memory leak detected. "+ge.length+" "+String(oe)+" listeners added. Use emitter.setMaxListeners() to increase limit");Ge.name="MaxListenersExceededWarning",Ge.emitter=G,Ge.type=oe,Ge.count=ge.length,function(ht){console&&console.warn&&console.warn(ht)}(Ge)}return G}function z(G,oe,ce){var be={fired:!1,wrapFn:void 0,target:G,type:oe,listener:ce},Ee=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}.bind(be);return Ee.listener=ce,be.wrapFn=Ee,Ee}function q(G,oe,ce){var be=G._events;if(be===void 0)return[];var Ee=be[oe];return Ee===void 0?[]:typeof Ee=="function"?ce?[Ee.listener||Ee]:[Ee]:ce?function(ve){for(var ge=new Array(ve.length),Ge=0;Ge<ge.length;++Ge)ge[Ge]=ve[Ge].listener||ve[Ge];return ge}(Ee):Z(Ee,Ee.length)}function I(G){var oe=this._events;if(oe!==void 0){var ce=oe[G];if(typeof ce=="function")return 1;if(ce!==void 0)return ce.length}return 0}function Z(G,oe){for(var ce=new Array(oe),be=0;be<oe;++be)ce[be]=G[be];return ce}function Y(G,oe,ce,be){if(typeof G.on=="function")be.once?G.once(oe,ce):G.on(oe,ce);else{if(typeof G.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof G);G.addEventListener(oe,function Ee(ve){be.once&&G.removeEventListener(oe,Ee),ce(ve)})}}Object.defineProperty(U,"defaultMaxListeners",{enumerable:!0,get:function(){return j},set:function(G){if(typeof G!="number"||G<0||O(G))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+G+".");j=G}}),U.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},U.prototype.setMaxListeners=function(G){if(typeof G!="number"||G<0||O(G))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+G+".");return this._maxListeners=G,this},U.prototype.getMaxListeners=function(){return L(this)},U.prototype.emit=function(G){for(var oe=[],ce=1;ce<arguments.length;ce++)oe.push(arguments[ce]);var be=G==="error",Ee=this._events;if(Ee!==void 0)be=be&&Ee.error===void 0;else if(!be)return!1;if(be){var ve;if(oe.length>0&&(ve=oe[0]),ve instanceof Error)throw ve;var ge=new Error("Unhandled error."+(ve?" ("+ve.message+")":""));throw ge.context=ve,ge}var Ge=Ee[G];if(Ge===void 0)return!1;if(typeof Ge=="function")S(Ge,this,oe);else{var ht=Ge.length,It=Z(Ge,ht);for(ce=0;ce<ht;++ce)S(It[ce],this,oe)}return!0},U.prototype.addListener=function(G,oe){return W(this,G,oe,!1)},U.prototype.on=U.prototype.addListener,U.prototype.prependListener=function(G,oe){return W(this,G,oe,!0)},U.prototype.once=function(G,oe){return N(oe),this.on(G,z(this,G,oe)),this},U.prototype.prependOnceListener=function(G,oe){return N(oe),this.prependListener(G,z(this,G,oe)),this},U.prototype.removeListener=function(G,oe){var ce,be,Ee,ve,ge;if(N(oe),(be=this._events)===void 0)return this;if((ce=be[G])===void 0)return this;if(ce===oe||ce.listener===oe)--this._eventsCount==0?this._events=Object.create(null):(delete be[G],be.removeListener&&this.emit("removeListener",G,ce.listener||oe));else if(typeof ce!="function"){for(Ee=-1,ve=ce.length-1;ve>=0;ve--)if(ce[ve]===oe||ce[ve].listener===oe){ge=ce[ve].listener,Ee=ve;break}if(Ee<0)return this;Ee===0?ce.shift():function(Ge,ht){for(;ht+1<Ge.length;ht++)Ge[ht]=Ge[ht+1];Ge.pop()}(ce,Ee),ce.length===1&&(be[G]=ce[0]),be.removeListener!==void 0&&this.emit("removeListener",G,ge||oe)}return this},U.prototype.off=U.prototype.removeListener,U.prototype.removeAllListeners=function(G){var oe,ce,be;if((ce=this._events)===void 0)return this;if(ce.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):ce[G]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete ce[G]),this;if(arguments.length===0){var Ee,ve=Object.keys(ce);for(be=0;be<ve.length;++be)(Ee=ve[be])!=="removeListener"&&this.removeAllListeners(Ee);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(oe=ce[G])=="function")this.removeListener(G,oe);else if(oe!==void 0)for(be=oe.length-1;be>=0;be--)this.removeListener(G,oe[be]);return this},U.prototype.listeners=function(G){return q(this,G,!0)},U.prototype.rawListeners=function(G){return q(this,G,!1)},U.listenerCount=function(G,oe){return typeof G.listenerCount=="function"?G.listenerCount(oe):I.call(G,oe)},U.prototype.listenerCount=I,U.prototype.eventNames=function(){return this._eventsCount>0?l(this._events):[]}},function(u,s,r){r.d(s,"a",function(){return C}),r.d(s,"b",function(){return S}),r.d(s,"c",function(){return O}),r.d(s,"d",function(){return U});var l,C,S,O,U,j=r(246);(function(N){l=Object(j.a)(N),C=l.format,S=l.parse,O=l.utcFormat,U=l.utcParse})({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]})},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(C){return typeof C=="string"&&l.test(C)};var l=/-webkit-|-moz-|-ms-/;u.exports=s.default},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.compose=s.merge=s.$=s.style=s.presets=s.keyframes=s.fontFace=s.insertGlobal=s.insertRule=s.plugins=s.styleSheet=void 0,s.speedy=function($e){return W.speedy($e)},s.simulations=function(){var $e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];Y=!!$e},s.simulate=function(){for(var $e=arguments.length,ft=Array($e),Jt=0;Jt<$e;Jt++)ft[Jt]=arguments[Jt];return(ft=(0,O.default)(ft))?Y?ft.reduce(function(Qt,Pn){return Qt["data-simulate-"+be(Pn)]="",Qt},{}):(G||(console.warn("can't simulate without once calling simulations(true)"),G=!0),q||I||oe||(console.warn("don't use simulation outside dev"),oe=!0),{}):{}},s.cssLabels=function($e){ce=!!$e},s.isLikeRule=ve,s.idFor=ge,s.css=Rn,s.rehydrate=function($e){(0,l.default)(jt,$e.reduce(function(ft,Jt){return ft[Jt]=!0,ft},{}))},s.flush=function(){jt=W.inserted={},Mt=W.registered={},Ut={},W.flush(),W.inject()},s.select=qe,s.parent=function($e){for(var ft=arguments.length,Jt=Array(ft>1?ft-1:0),Qt=1;Qt<ft;Qt++)Jt[Qt-1]=arguments[Qt];return Rn(L({},$e+" &",Jt))},s.media=function($e){for(var ft=arguments.length,Jt=Array(ft>1?ft-1:0),Qt=1;Qt<ft;Qt++)Jt[Qt-1]=arguments[Qt];return Rn(L({},"@media "+$e,Jt))},s.pseudo=Qe,s.active=function($e){return Qe(":active",$e)},s.any=function($e){return Qe(":any",$e)},s.checked=function($e){return Qe(":checked",$e)},s.disabled=function($e){return Qe(":disabled",$e)},s.empty=function($e){return Qe(":empty",$e)},s.enabled=function($e){return Qe(":enabled",$e)},s._default=function($e){return Qe(":default",$e)},s.first=function($e){return Qe(":first",$e)},s.firstChild=function($e){return Qe(":first-child",$e)},s.firstOfType=function($e){return Qe(":first-of-type",$e)},s.fullscreen=function($e){return Qe(":fullscreen",$e)},s.focus=function($e){return Qe(":focus",$e)},s.hover=function($e){return Qe(":hover",$e)},s.indeterminate=function($e){return Qe(":indeterminate",$e)},s.inRange=function($e){return Qe(":in-range",$e)},s.invalid=function($e){return Qe(":invalid",$e)},s.lastChild=function($e){return Qe(":last-child",$e)},s.lastOfType=function($e){return Qe(":last-of-type",$e)},s.left=function($e){return Qe(":left",$e)},s.link=function($e){return Qe(":link",$e)},s.onlyChild=function($e){return Qe(":only-child",$e)},s.onlyOfType=function($e){return Qe(":only-of-type",$e)},s.optional=function($e){return Qe(":optional",$e)},s.outOfRange=function($e){return Qe(":out-of-range",$e)},s.readOnly=function($e){return Qe(":read-only",$e)},s.readWrite=function($e){return Qe(":read-write",$e)},s.required=function($e){return Qe(":required",$e)},s.right=function($e){return Qe(":right",$e)},s.root=function($e){return Qe(":root",$e)},s.scope=function($e){return Qe(":scope",$e)},s.target=function($e){return Qe(":target",$e)},s.valid=function($e){return Qe(":valid",$e)},s.visited=function($e){return Qe(":visited",$e)},s.dir=function($e,ft){return Qe(":dir("+$e+")",ft)},s.lang=function($e,ft){return Qe(":lang("+$e+")",ft)},s.not=function($e,ft){var Jt=$e.split(",").map(function(Qt){return Qt.trim()}).map(function(Qt){return":not("+Qt+")"});return Jt.length===1?Qe(":not("+$e+")",ft):qe(Jt.join(""),ft)},s.nthChild=function($e,ft){return Qe(":nth-child("+$e+")",ft)},s.nthLastChild=function($e,ft){return Qe(":nth-last-child("+$e+")",ft)},s.nthLastOfType=function($e,ft){return Qe(":nth-last-of-type("+$e+")",ft)},s.nthOfType=function($e,ft){return Qe(":nth-of-type("+$e+")",ft)},s.after=function($e){return Qe("::after",$e)},s.before=function($e){return Qe("::before",$e)},s.firstLetter=function($e){return Qe("::first-letter",$e)},s.firstLine=function($e){return Qe("::first-line",$e)},s.selection=function($e){return Qe("::selection",$e)},s.backdrop=function($e){return Qe("::backdrop",$e)},s.placeholder=function($e){return Rn({"::placeholder":$e})},s.cssFor=function(){for(var $e=arguments.length,ft=Array($e),Jt=0;Jt<$e;Jt++)ft[Jt]=arguments[Jt];return(ft=(0,O.default)(ft))?ft.map(function(Qt){var Pn={label:[]};return nn(Pn,{src:Qt}),bt(Ee(Pn),we(Pn)).join("")}).join(""):""},s.attribsFor=function(){for(var $e=arguments.length,ft=Array($e),Jt=0;Jt<$e;Jt++)ft[Jt]=arguments[Jt];return(ft=(0,O.default)(ft))?ft.map(function(Qt){ge(Qt);var Pn=Object.keys(Qt)[0],kn=Qt[Pn];return Pn+'="'+(kn||"")+'"'}).join(" "):""};var l=N(r(139)),C=r(320),S=r(201),O=N(r(311)),U=r(310),j=N(r(293));function N($e){return $e&&$e.__esModule?$e:{default:$e}}function L($e,ft,Jt){return ft in $e?Object.defineProperty($e,ft,{value:Jt,enumerable:!0,configurable:!0,writable:!0}):$e[ft]=Jt,$e}var W=s.styleSheet=new C.StyleSheet;W.inject();var z=s.plugins=W.plugins=new U.PluginSet([U.prefixes,U.contentWrap,U.fallbacks]);z.media=new U.PluginSet,z.fontFace=new U.PluginSet,z.keyframes=new U.PluginSet([U.prefixes,U.fallbacks]);var q=!1,I=!1,Z=typeof window<"u",Y=q,G=!1,oe=!1,ce=q;function be($e){var ft=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return $e.toLowerCase().replace(/[^a-z0-9]/g,ft)}function Ee($e){var ft=JSON.stringify($e),Jt=(0,j.default)(ft).toString(36);return $e.label&&$e.label.length>0&&q?be($e.label.join("."),"-")+"-"+Jt:Jt}function ve($e){var ft=Object.keys($e).filter(function(Jt){return Jt!=="toString"});return ft.length===1&&!!/data\-css\-([a-zA-Z0-9\-_]+)/.exec(ft[0])}function ge($e){var ft=Object.keys($e).filter(function(Qt){return Qt!=="toString"});if(ft.length!==1)throw new Error("not a rule");var Jt=/data\-css\-([a-zA-Z0-9\-_]+)/.exec(ft[0]);if(!Jt)throw new Error("not a rule");return Jt[1]}var Ge=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g;function ht($e){if($e.indexOf(",")===-1)return[$e];for(var ft,Jt=[],Qt=[],Pn=0;ft=Ge.exec($e);)switch(ft[0]){case"(":Pn++;break;case")":Pn--;break;case",":if(Pn)break;Jt.push(ft.index)}for(ft=Jt.length;ft--;)Qt.unshift($e.slice(Jt[ft]+1)),$e=$e.slice(0,Jt[ft]);return Qt.unshift($e),Qt}function It($e,ft){if(!$e)return ft.replace(/\&/g,"");if(!ft)return".css-"+$e+",[data-css-"+$e+"]";var Jt=ht(ft).map(function(Qt){return Qt.indexOf("&")>=0?[Qt.replace(/\&/gm,".css-"+$e),Qt.replace(/\&/gm,"[data-css-"+$e+"]")].join(","):".css-"+$e+Qt+",[data-css-"+$e+"]"+Qt}).join(",");return Y&&/^\&\:/.exec(ft)&&!/\s/.exec(ft)&&(Jt+=",.css-"+$e+"[data-simulate-"+be(ft)+"],[data-css-"+$e+"][data-simulate-"+be(ft)+"]"),Jt}function St($e){var ft=$e.selector,Jt=$e.style,Qt=z.transform({selector:ft,style:Jt});return Qt.selector+"{"+(0,S.createMarkupForStyles)(Qt.style)+"}"}function we($e){var ft=void 0,Jt=void 0,Qt=void 0,Pn=void 0;return Object.keys($e).forEach(function(kn){kn.indexOf("&")>=0?(Jt=Jt||{})[kn]=$e[kn]:kn.indexOf("@media")===0?(Qt=Qt||{})[kn]=we($e[kn]):kn.indexOf("@supports")===0?(Pn=Pn||{})[kn]=we($e[kn]):kn==="label"?$e.label.length>0&&((ft=ft||{}).label=ce?$e.label.join("."):""):(ft=ft||{})[kn]=$e[kn]}),{plain:ft,selects:Jt,medias:Qt,supports:Pn}}function bt($e,ft){var Jt=[],Qt=ft.plain,Pn=ft.selects,kn=ft.medias,Qn=ft.supports;return Qt&&Jt.push(St({style:Qt,selector:It($e)})),Pn&&Object.keys(Pn).forEach(function(ke){return Jt.push(St({style:Pn[ke],selector:It($e,ke)}))}),kn&&Object.keys(kn).forEach(function(ke){return Jt.push(ke+"{"+bt($e,kn[ke]).join("")+"}")}),Qn&&Object.keys(Qn).forEach(function(ke){return Jt.push(ke+"{"+bt($e,Qn[ke]).join("")+"}")}),Jt}var jt=W.inserted={},Mt=W.registered={};function ze($e){Mt[$e.id]||(Mt[$e.id]=$e)}var Ut={};function Ft($e){if(ze($e),function(Jt){if(!jt[Jt.id]){jt[Jt.id]=!0;var Qt=we(Jt.style),Pn=bt(Jt.id,Qt);jt[Jt.id]=!!Z||Pn,Pn.forEach(function(kn){return W.insert(kn)})}}($e),Ut[$e.id])return Ut[$e.id];var ft=L({},"data-css-"+$e.id,ce&&$e.label||"");return Object.defineProperty(ft,"toString",{enumerable:!1,value:function(){return"css-"+$e.id}}),Ut[$e.id]=ft,ft}function pt($e,ft){var Jt=ht($e).map(function(Qt){return Qt.indexOf("&")>=0?Qt:"&"+Qt});return ht(ft).map(function(Qt){return Qt.indexOf("&")>=0?Qt:"&"+Qt}).reduce(function(Qt,Pn){return Qt.concat(Jt.map(function(kn){return Pn.replace(/\&/g,kn)}))},[]).join(",")}var yt={"::placeholder":["::-webkit-input-placeholder","::-moz-placeholder","::-ms-input-placeholder"],":fullscreen":[":-webkit-full-screen",":-moz-full-screen",":-ms-fullscreen"]};function nn($e,ft){var Jt=ft.selector,Qt=Jt===void 0?"":Jt,Pn=ft.mq,kn=Pn===void 0?"":Pn,Qn=ft.supp,ke=Qn===void 0?"":Qn,ar=ft.src,Tr=ar===void 0?{}:ar;Array.isArray(Tr)||(Tr=[Tr]),(Tr=function rn(Ht){for(var Gn=[],Xt=0;Xt<Ht.length;Xt++)Gn=Array.isArray(Ht[Xt])?Gn.concat(rn(Ht[Xt])):Gn.concat(Ht[Xt]);return Gn}(Tr)).forEach(function(rn){if(ve(rn)){var Ht=function(Gn){if(ve(Gn)){var Xt=Mt[ge(Gn)];if(Xt==null)throw new Error("[glamor] an unexpected rule cache miss occurred. This is probably a sign of multiple glamor instances in your app. See https://github.com/threepointone/glamor/issues/79");return Xt}return Gn}(rn);if(Ht.type!=="css")throw new Error("cannot merge this rule");rn=Ht.style}(rn=(0,O.default)(rn))&&rn.composes&&nn($e,{selector:Qt,mq:kn,supp:ke,src:rn.composes}),Object.keys(rn||{}).forEach(function(Gn){if(function(Wt){for(var Zt=[":",".","[",">"," "],Vn=!1,xn=Wt.charAt(0),Un=0;Un<Zt.length;Un++)if(xn===Zt[Un]){Vn=!0;break}return Vn||Wt.indexOf("&")>=0}(Gn))yt[Gn]&&yt[Gn].forEach(function(Wt){return nn($e,{selector:pt(Qt,Wt),mq:kn,supp:ke,src:rn[Gn]})}),nn($e,{selector:pt(Qt,Gn),mq:kn,supp:ke,src:rn[Gn]});else if(function(Wt){return Wt.indexOf("@media")===0}(Gn))nn($e,{selector:Qt,mq:function(Wt,Zt){return Wt?"@media "+Wt.substring(6)+" and "+Zt.substring(6):Zt}(kn,Gn),supp:ke,src:rn[Gn]});else if(function(Wt){return Wt.indexOf("@supports")===0}(Gn))nn($e,{selector:Qt,mq:kn,supp:function(Wt,Zt){return Wt?"@supports "+Wt.substring(9)+" and "+Zt.substring(9):Zt}(ke,Gn),src:rn[Gn]});else if(Gn!=="composes"){var Xt=$e;ke&&(Xt[ke]=Xt[ke]||{},Xt=Xt[ke]),kn&&(Xt[kn]=Xt[kn]||{},Xt=Xt[kn]),Qt&&(Xt[Qt]=Xt[Qt]||{},Xt=Xt[Qt]),Gn==="label"?ce&&($e.label=$e.label.concat(rn.label)):Xt[Gn]=rn[Gn]}})})}function xt($e){var ft={label:[]};return nn(ft,{src:$e}),Ft({id:Ee(ft),style:ft,label:ce?ft.label.join("."):"",type:"css"})}var _t={};Object.defineProperty(_t,"toString",{enumerable:!1,value:function(){return"css-nil"}});var Yt=typeof WeakMap<"u"?[_t,new WeakMap,new WeakMap,new WeakMap]:[_t],Fn=typeof WeakMap<"u"?function($e){return function(ft){if(Yt[ft.length]){for(var Jt=Yt[ft.length],Qt=0;Qt<ft.length-1;)Jt.has(ft[Qt])||Jt.set(ft[Qt],new WeakMap),Jt=Jt.get(ft[Qt]),Qt++;if(Jt.has(ft[ft.length-1])){var Pn=Jt.get(ft[Qt]);if(Mt[Pn.toString().substring(4)])return Pn}}var kn=$e(ft);if(Yt[ft.length]){for(var Qn=0,ke=Yt[ft.length];Qn<ft.length-1;)ke=ke.get(ft[Qn]),Qn++;try{ke.set(ft[Qn],kn)}catch{}}return kn}}(xt):xt;function Rn(){for(var $e=arguments.length,ft=Array($e),Jt=0;Jt<$e;Jt++)ft[Jt]=arguments[Jt];if(ft[0]&&ft[0].length&&ft[0].raw)throw new Error("you forgot to include glamor/babel in your babel plugins.");return(ft=(0,O.default)(ft))?Fn(ft):_t}Rn.insert=function($e){var ft={id:Ee($e),css:$e,type:"raw"};ze(ft),jt[ft.id]||(W.insert(ft.css),jt[ft.id]=!!Z||[ft.css])},s.insertRule=Rn.insert,Rn.global=function($e,ft){if(ft=(0,O.default)(ft))return Rn.insert(St({selector:$e,style:ft}))},s.insertGlobal=Rn.global,Rn.keyframes=function($e,ft){ft||(ft=$e,$e="animation");var Jt={id:Ee({name:$e,kfs:ft=(0,O.default)(ft)||{}}),type:"keyframes",name:$e,keyframes:ft};return ze(Jt),function(Qt){if(!jt[Qt.id]){var Pn=Object.keys(Qt.keyframes).map(function(Qn){var ke=z.keyframes.transform({id:Qt.id,name:Qn,style:Qt.keyframes[Qn]});return ke.name+"{"+(0,S.createMarkupForStyles)(ke.style)+"}"}).join(""),kn=["-webkit-","-moz-","-o-",""].map(function(Qn){return"@"+Qn+"keyframes "+Qt.name+"_"+Qt.id+"{"+Pn+"}"});kn.forEach(function(Qn){return W.insert(Qn)}),jt[Qt.id]=!!Z||kn}}(Jt),$e+"_"+Jt.id},Rn.fontFace=function($e){var ft={id:Ee($e=(0,O.default)($e)),type:"font-face",font:$e};return ze(ft),function(Jt){if(!jt[Jt.id]){var Qt="@font-face{"+(0,S.createMarkupForStyles)(Jt.font)+"}";W.insert(Qt),jt[Jt.id]=!!Z||[Qt]}}(ft),$e.fontFamily},s.fontFace=Rn.fontFace,s.keyframes=Rn.keyframes,s.presets={mobile:"(min-width: 400px)",Mobile:"@media (min-width: 400px)",phablet:"(min-width: 550px)",Phablet:"@media (min-width: 550px)",tablet:"(min-width: 750px)",Tablet:"@media (min-width: 750px)",desktop:"(min-width: 1000px)",Desktop:"@media (min-width: 1000px)",hd:"(min-width: 1200px)",Hd:"@media (min-width: 1200px)"};var cn=s.style=Rn;function qe($e){for(var ft=arguments.length,Jt=Array(ft>1?ft-1:0),Qt=1;Qt<ft;Qt++)Jt[Qt-1]=arguments[Qt];return $e?Rn(L({},$e,Jt)):cn(Jt)}s.$=qe,s.merge=Rn,s.compose=Rn;function Qe($e){for(var ft=arguments.length,Jt=Array(ft>1?ft-1:0),Qt=1;Qt<ft;Qt++)Jt[Qt-1]=arguments[Qt];return Rn(L({},$e,Jt))}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=function(){function S(O){this.global=O,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return S.prototype.setPlatform=function(O,U){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+U+"."),this.platformName=O,this.platform=U},S.prototype.registerFlag=function(O,U,j){if(this.flagRegistry[O]={evaluationFn:U,setHook:j},this.urlFlags[O]!=null){var N=this.urlFlags[O];console.warn("Setting feature override from URL "+O+": "+N+"."),this.set(O,N)}},S.prototype.get=function(O){return O in this.flags?this.flags[O]:(this.flags[O]=this.evaluateFlag(O),this.flags[O])},S.prototype.getNumber=function(O){return this.get(O)},S.prototype.getBool=function(O){return this.get(O)},S.prototype.getFlags=function(){return this.flags},Object.defineProperty(S.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),S.prototype.set=function(O,U){if(this.flagRegistry[O]==null)throw new Error("Cannot set flag "+O+" as it has not been registered.");this.flags[O]=U,this.flagRegistry[O].setHook!=null&&this.flagRegistry[O].setHook(U)},S.prototype.evaluateFlag=function(O){if(this.flagRegistry[O]==null)throw new Error("Cannot evaluate flag '"+O+"': no evaluation function found.");return this.flagRegistry[O].evaluationFn()},S.prototype.setFlags=function(O){this.flags=Object.assign({},O)},S.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},S.prototype.populateURLFlags=function(){var O=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var U=C(this.global.location.search);"tfjsflags"in U&&U.tfjsflags.split(",").forEach(function(j){var N=j.split(":"),L=N[0],W=N[1];O.urlFlags[L]=function(z,q){if((q=q.toLowerCase())==="true"||q==="false")return q==="true";if(""+ +q===q)return+q;throw new Error("Could not parse value flag value "+q+" for flag "+z+".")}(L,W)})}},S}();function C(S){var O={};return S.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(U){for(var j=[],N=1;N<arguments.length;N++)j[N-1]=arguments[N];return function(L,W,z){L[decodeURIComponent(W)]=decodeURIComponent(z||"")}(O,j[0],j[1]),j.join("=")}),O}s.Environment=l,s.getQueryParams=C,s.env=function(){return s.ENV},s.ENV=null,s.setEnvironmentGlobal=function(S){s.ENV=S}},function(u,s,r){var l=r(14),C=r(55),S=r(19)("species");u.exports=function(O,U){var j,N=l(O).constructor;return N===void 0||(j=l(N)[S])==null?U:C(j)}},function(u,s,r){var l=r(62),C=r(19)("toStringTag"),S=l(function(){return arguments}())=="Arguments";u.exports=function(O){var U,j,N;return O===void 0?"Undefined":O===null?"Null":typeof(j=function(L,W){try{return L[W]}catch{}}(U=Object(O),C))=="string"?j:S?l(U):(N=l(U))=="Object"&&typeof U.callee=="function"?"Arguments":N}},function(u,s){s.f={}.propertyIsEnumerable},function(u,s,r){var l=r(62);u.exports=Object("z").propertyIsEnumerable(0)?Object:function(C){return l(C)=="String"?C.split(""):Object(C)}},function(u,s,r){var l=r(87);s.a=function(C){let S=C,O=C;function U(j,N,L,W){for(L==null&&(L=0),W==null&&(W=j.length);L<W;){const z=L+W>>>1;O(j[z],N)<0?L=z+1:W=z}return L}return C.length===1&&(S=(j,N)=>C(j)-N,O=function(j){return(N,L)=>Object(l.a)(j(N),L)}(C)),{left:U,center:function(j,N,L,W){L==null&&(L=0),W==null&&(W=j.length);const z=U(j,N,L,W-1);return z>L&&S(j[z-1],N)>-S(j[z],N)?z-1:z},right:function(j,N,L,W){for(L==null&&(L=0),W==null&&(W=j.length);L<W;){const z=L+W>>>1;O(j[z],N)>0?W=z:L=z+1}return L}}}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});const l=r(50),C=r(247),S=r(102),O=r(46);s.table=function(j,N,L={}){if(N&&N.headers==null)throw new Error('Data to render must have a "headers" property');if(N&&N.values==null)throw new Error('Data to render must have a "values" property');const W=O.getDrawArea(j),z=Object.assign({},U,L);let q=C.select(W).select("table.tf-table");const I=S.css({fontSize:z.fontSize||".875rem",width:"100%",maxWidth:"64rem",marginRight:"auto",marginLeft:"auto"});if(q.size()===0&&((q=C.select(W).append("table")).attr("class",` ${I} tf-table`),q.append("thead").append("tr"),q.append("tbody")),q.size()!==1)throw new Error("Error inserting table");const Z=S.css({fontWeight:"600",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )",textAlign:"left",paddingBottom:"1rem",paddingRight:"1rem",backgroundColor:"#fff"}),Y=q.select("thead").select("tr").selectAll("th").data(N.headers),G=Y.enter().append("th").attr("class",`${Z}`);Y.merge(G).html(Ge=>Ge),Y.exit().remove();const oe=l.format(",.4~f"),ce=q.select("tbody").selectAll("tr").data(N.values),be=ce.enter().append("tr"),Ee=S.css({padding:"0.25rem",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )"}),ve=ce.merge(be).selectAll("td").data(Ge=>Ge),ge=ve.enter().append("td").attr("class",`${Ee}`);ve.merge(ge).html(Ge=>typeof Ge=="number"?oe(Ge):Ge),ve.exit().remove(),ce.exit().remove()};const U={fontSize:14}},function(u,s,r){var l=this&&this.__awaiter||function(O,U,j,N){return new(j||(j=Promise))(function(L,W){function z(Z){try{I(N.next(Z))}catch(Y){W(Y)}}function q(Z){try{I(N.throw(Z))}catch(Y){W(Y)}}function I(Z){Z.done?L(Z.value):new j(function(Y){Y(Z.value)}).then(z,q)}I((N=N.apply(O,U||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0});const C=r(0),S=r(111);s.arrayStats=function(O){if(!Array.isArray(O))throw new Error("input must be an array");if(O.length===0)return{numVals:0,numNans:0,numZeros:0,max:void 0,min:void 0};const U=O.length;let j=-1/0,N=1/0,L=0,W=0,z=0;for(let I=0;I<U;I++){const Z=O[I];Z>j&&(j=Z),Z<N&&(N=Z),Z===0&&(L+=1),isNaN(Z)?W+=1:isFinite(Z)||(z+=1)}const q={numVals:U,numZeros:L,numNans:W,max:j,min:N,numInfs:z};return q.max===-1/0&&(q.max=NaN),q.min===1/0&&(q.min=NaN),q},s.tensorStats=function(O){return l(this,void 0,void 0,function*(){const[U,j,N]=C.tidy(()=>{const L=C.scalar(0,O.dtype);return[O.min(),O.max(),O.equal(L).sum()]});return Promise.all([O.data(),U.data(),j.data(),N.data()]).then(([L,W,z,q])=>{const I=L.length;let Z=0,Y=0;for(let ce=0;ce<I;ce++){const be=L[ce];isNaN(be)?Z+=1:isFinite(be)||(Y+=1)}let G=W[0],oe=z[0];return Z===I&&(G=NaN,oe=NaN),{numVals:I,numZeros:q[0],numNans:Z,min:G,max:oe,numInfs:Y}})})},s.confusionMatrix=function(O,U,j,N){return l(this,void 0,void 0,function*(){S.assert(O.rank===1,"labels must be a 1D tensor"),S.assert(U.rank===1,"predictions must be a 1D tensor"),S.assert(O.size===U.size,"labels and predictions must be the same length"),N!=null&&S.assert(N.size===U.size,"labels and predictions must be the same length");const L=O.cast("int32"),W=U.cast("int32");j==null&&(j=C.tidy(()=>C.maximum(L.max(),W.max()).cast("int32").dataSync()[0]+1));let z=Promise.resolve(null);return N!=null&&(z=N.data()),Promise.all([L.data(),W.data(),z]).then(([q,I,Z])=>{const Y=Array(j).fill(0);for(let G=0;G<j;G++)Y[G]=Array(j).fill(0);for(let G=0;G<q.length;G++){const oe=q[G],ce=I[G];Y[oe][ce]+=Z!=null?Z[G]:1}return Y})})},s.accuracy=function(O,U){return l(this,void 0,void 0,function*(){S.assertShapesMatch(O.shape,U.shape,"Error computing accuracy.");const j=O.equal(U),N=j.mean(),L=(yield N.data())[0];return C.dispose([j,N]),L})},s.perClassAccuracy=function(O,U,j){return l(this,void 0,void 0,function*(){return S.assert(O.rank===1,"labels must be a 1D tensor"),S.assert(U.rank===1,"predictions must be a 1D tensor"),S.assert(O.size===U.size,"labels and predictions must be the same length"),j==null&&(j=C.tidy(()=>C.maximum(O.max(),U.max()).dataSync()[0]+1)),Promise.all([O.data(),U.data()]).then(([N,L])=>{const W=Array(j).fill(0),z=Array(j).fill(0);for(let I=0;I<N.length;I++){const Z=N[I],Y=L[I];W[Z]+=1,Z===Y&&(z[Z]+=1)}const q=[];for(let I=0;I<W.length;I++)q.push({count:W[I],accuracy:W[I]===0?0:z[I]/W[I]});return q})})}},function(u,s,r){function l(S,O){if(!S)throw new Error(typeof O=="string"?O:O())}function C(S,O){if(S.length!==O.length)return!1;for(let U=0;U<S.length;U++)if(S[U]!==O[U])return!1;return!0}Object.defineProperty(s,"__esModule",{value:!0}),s.assert=l,s.assertShapesMatch=function(S,O,U=""){l(C(S,O),U+` Shapes ${S} and ${O} must match`)},s.arraysEqual=C,s.DECIMAL_PLACES_TO_CHECK=4},function(u,s,r){const l=r(47);u.exports=(C,S,O)=>{try{S=new l(S,O)}catch{return!1}return S.test(C)}},function(u,s,r){const l=Symbol("SemVer ANY");class C{static get ANY(){return l}constructor(q,I){if(I=S(I),q instanceof C){if(q.loose===!!I.loose)return q;q=q.value}N("comparator",q,I),this.options=I,this.loose=!!I.loose,this.parse(q),this.semver===l?this.value="":this.value=this.operator+this.semver.version,N("comp",this)}parse(q){const I=this.options.loose?O[U.COMPARATORLOOSE]:O[U.COMPARATOR],Z=q.match(I);if(!Z)throw new TypeError(`Invalid comparator: ${q}`);this.operator=Z[1]!==void 0?Z[1]:"",this.operator==="="&&(this.operator=""),Z[2]?this.semver=new L(Z[2],this.options.loose):this.semver=l}toString(){return this.value}test(q){if(N("Comparator.test",q,this.options.loose),this.semver===l||q===l)return!0;if(typeof q=="string")try{q=new L(q,this.options)}catch{return!1}return j(q,this.operator,this.semver,this.options)}intersects(q,I){if(!(q instanceof C))throw new TypeError("a Comparator is required");if(I&&typeof I=="object"||(I={loose:!!I,includePrerelease:!1}),this.operator==="")return this.value===""||new W(q.value,I).test(this.value);if(q.operator==="")return q.value===""||new W(this.value,I).test(q.semver);const Z=!(this.operator!==">="&&this.operator!==">"||q.operator!==">="&&q.operator!==">"),Y=!(this.operator!=="<="&&this.operator!=="<"||q.operator!=="<="&&q.operator!=="<"),G=this.semver.version===q.semver.version,oe=!(this.operator!==">="&&this.operator!=="<="||q.operator!==">="&&q.operator!=="<="),ce=j(this.semver,"<",q.semver,I)&&(this.operator===">="||this.operator===">")&&(q.operator==="<="||q.operator==="<"),be=j(this.semver,">",q.semver,I)&&(this.operator==="<="||this.operator==="<")&&(q.operator===">="||q.operator===">");return Z||Y||G&&oe||ce||be}}u.exports=C;const S=r(115),{re:O,t:U}=r(90),j=r(203),N=r(116),L=r(32),W=r(47)},function(u,s,r){const l=r(48);u.exports=(C,S,O)=>l(C,S,O)>0},function(u,s){const r=["includePrerelease","loose","rtl"];u.exports=l=>l?typeof l!="object"?{loose:!0}:r.filter(C=>l[C]).reduce((C,S)=>(C[S]=!0,C),{}):{}},function(u,s,r){(function(l){const C=typeof l=="object"&&l.env&&l.env.NODE_DEBUG&&/\bsemver\b/i.test(l.env.NODE_DEBUG)?(...S)=>console.error("SEMVER",...S):()=>{};u.exports=C}).call(this,r(75))},function(u,s){const r=Number.MAX_SAFE_INTEGER||9007199254740991;u.exports={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:r,MAX_SAFE_COMPONENT_LENGTH:16}},function(u,s,r){for(var l,C=r(16),S=r(42),O=r(84),U=O("typed_array"),j=O("view"),N=!(!C.ArrayBuffer||!C.DataView),L=N,W=0,z="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");W<9;)(l=C[z[W++]])?(S(l.prototype,U,!0),S(l.prototype,j,!0)):L=!1;u.exports={ABV:N,CONSTR:L,TYPED:U,VIEW:j}},function(u,s,r){var l=r(16),C=r(8),S=r(38),O=r(93),U=r(65),j=r(121),N=r(94),L=r(13),W=r(15),z=r(125),q=r(98),I=r(168);u.exports=function(Z,Y,G,oe,ce,be){var Ee=l[Z],ve=Ee,ge=ce?"set":"add",Ge=ve&&ve.prototype,ht={},It=function(ze){var Ut=Ge[ze];S(Ge,ze,ze=="delete"?function(Ft){return!(be&&!L(Ft))&&Ut.call(this,Ft===0?0:Ft)}:ze=="has"?function(Ft){return!(be&&!L(Ft))&&Ut.call(this,Ft===0?0:Ft)}:ze=="get"?function(Ft){return be&&!L(Ft)?void 0:Ut.call(this,Ft===0?0:Ft)}:ze=="add"?function(Ft){return Ut.call(this,Ft===0?0:Ft),this}:function(Ft,pt){return Ut.call(this,Ft===0?0:Ft,pt),this})};if(typeof ve=="function"&&(be||Ge.forEach&&!W(function(){new ve().entries().next()}))){var St=new ve,we=St[ge](be?{}:-0,1)!=St,bt=W(function(){St.has(1)}),jt=z(function(ze){new ve(ze)}),Mt=!be&&W(function(){for(var ze=new ve,Ut=5;Ut--;)ze[ge](Ut,Ut);return!ze.has(-0)});jt||((ve=Y(function(ze,Ut){N(ze,ve,Z);var Ft=I(new Ee,ze,ve);return Ut!=null&&j(Ut,ce,Ft[ge],Ft),Ft})).prototype=Ge,Ge.constructor=ve),(bt||Mt)&&(It("delete"),It("has"),ce&&It("get")),(Mt||we)&&It(ge),be&&Ge.clear&&delete Ge.clear}else ve=oe.getConstructor(Y,Z,ce,ge),O(ve.prototype,G),U.NEED=!0;return q(ve,Z),ht[Z]=ve,C(C.G+C.W+C.F*(ve!=Ee),ht),be||oe.setStrong(ve,Z,ce),ve}},function(u,s,r){var l=r(16).navigator;u.exports=l&&l.userAgent||""},function(u,s,r){var l=r(56),C=r(225),S=r(159),O=r(14),U=r(22),j=r(157),N={},L={};(s=u.exports=function(W,z,q,I,Z){var Y,G,oe,ce,be=Z?function(){return W}:j(W),Ee=l(q,I,z?2:1),ve=0;if(typeof be!="function")throw TypeError(W+" is not iterable!");if(S(be)){for(Y=U(W.length);Y>ve;ve++)if((ce=z?Ee(O(G=W[ve])[0],G[1]):Ee(W[ve]))===N||ce===L)return ce}else for(oe=be.call(W);!(G=oe.next()).done;)if((ce=C(oe,Ee,G.value,z))===N||ce===L)return ce}).BREAK=N,s.RETURN=L},function(u,s,r){r(220);var l=r(38),C=r(42),S=r(15),O=r(61),U=r(19),j=r(154),N=U("species"),L=!S(function(){var z=/./;return z.exec=function(){var q=[];return q.groups={a:"7"},q},"".replace(z,"$<a>")!=="7"}),W=function(){var z=/(?:)/,q=z.exec;z.exec=function(){return q.apply(this,arguments)};var I="ab".split(z);return I.length===2&&I[0]==="a"&&I[1]==="b"}();u.exports=function(z,q,I){var Z=U(z),Y=!S(function(){var ve={};return ve[Z]=function(){return 7},""[z](ve)!=7}),G=Y?!S(function(){var ve=!1,ge=/a/;return ge.exec=function(){return ve=!0,null},z==="split"&&(ge.constructor={},ge.constructor[N]=function(){return ge}),ge[Z](""),!ve}):void 0;if(!Y||!G||z==="replace"&&!L||z==="split"&&!W){var oe=/./[Z],ce=I(O,Z,""[z],function(ve,ge,Ge,ht,It){return ge.exec===j?Y&&!It?{done:!0,value:oe.call(ge,Ge,ht)}:{done:!0,value:ve.call(Ge,ge,ht)}:{done:!1}}),be=ce[0],Ee=ce[1];l(String.prototype,z,be),C(RegExp.prototype,Z,q==2?function(ve,ge){return Ee.call(ve,this,ge)}:function(ve){return Ee.call(ve,this)})}}},function(u,s,r){var l=r(105),C=RegExp.prototype.exec;u.exports=function(S,O){var U=S.exec;if(typeof U=="function"){var j=U.call(S,O);if(typeof j!="object")throw new TypeError("RegExp exec method returned something other than an Object or null");return j}if(l(S)!=="RegExp")throw new TypeError("RegExp#exec called on incompatible receiver");return C.call(S,O)}},function(u,s,r){var l=r(14);u.exports=function(){var C=l(this),S="";return C.global&&(S+="g"),C.ignoreCase&&(S+="i"),C.multiline&&(S+="m"),C.unicode&&(S+="u"),C.sticky&&(S+="y"),S}},function(u,s,r){var l=r(19)("iterator"),C=!1;try{var S=[7][l]();S.return=function(){C=!0},Array.from(S,function(){throw 2})}catch{}u.exports=function(O,U){if(!U&&!C)return!1;var j=!1;try{var N=[7],L=N[l]();L.next=function(){return{done:j=!0}},N[l]=function(){return L},O(N)}catch{}return j}},function(u,s,r){var l=r(62);u.exports=Array.isArray||function(C){return l(C)=="Array"}},function(u,s){s.f=Object.getOwnPropertySymbols},function(u,s,r){var l=r(41),C=r(22),S=r(81);u.exports=function(O){return function(U,j,N){var L,W=l(U),z=C(W.length),q=S(N,z);if(O&&j!=j){for(;z>q;)if((L=W[q++])!=L)return!0}else for(;z>q;q++)if((O||q in W)&&W[q]===j)return O||q||0;return!O&&-1}}},function(u,s,r){var l=r(24),C=r(16),S=C["__core-js_shared__"]||(C["__core-js_shared__"]={});(u.exports=function(O,U){return S[O]||(S[O]=U!==void 0?U:{})})("versions",[]).push({version:l.version,mode:r(83)?"pure":"global",copyright:" 2020 Denis Pushkarev (zloirock.ru)"})},function(u,s,r){r.r(s),function(l,C){r.d(s,"array",function(){return Pn}),r.d(s,"Dataset",function(){return Jt}),r.d(s,"zip",function(){return kn}),r.d(s,"CSVDataset",function(){return Xt}),r.d(s,"TextLineDataset",function(){return ke}),r.d(s,"csv",function(){return ir}),r.d(s,"func",function(){return Cr}),r.d(s,"generator",function(){return Hr}),r.d(s,"microphone",function(){return Ot}),r.d(s,"webcam",function(){return qr}),r.d(s,"FileDataSource",function(){return ti}),r.d(s,"URLDataSource",function(){return jn}),r.d(s,"version_data",function(){return Fr});var S=r(0),O=function($t,Se){return(O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(me,Ce){me.__proto__=Ce}||function(me,Ce){for(var Me in Ce)Ce.hasOwnProperty(Me)&&(me[Me]=Ce[Me])})($t,Se)};function U($t,Se){function me(){this.constructor=$t}O($t,Se),$t.prototype=Se===null?Object.create(Se):(me.prototype=Se.prototype,new me)}function j($t,Se,me,Ce){return new(me||(me=Promise))(function(Me,rt){function kt(Nt){try{En(Ce.next(Nt))}catch(Kt){rt(Kt)}}function en(Nt){try{En(Ce.throw(Nt))}catch(Kt){rt(Kt)}}function En(Nt){Nt.done?Me(Nt.value):new me(function(Kt){Kt(Nt.value)}).then(kt,en)}En((Ce=Ce.apply($t,Se||[])).next())})}function N($t,Se){var me,Ce,Me,rt,kt={label:0,sent:function(){if(1&Me[0])throw Me[1];return Me[1]},trys:[],ops:[]};return rt={next:en(0),throw:en(1),return:en(2)},typeof Symbol=="function"&&(rt[Symbol.iterator]=function(){return this}),rt;function en(En){return function(Nt){return function(Kt){if(me)throw new TypeError("Generator is already executing.");for(;kt;)try{if(me=1,Ce&&(Me=2&Kt[0]?Ce.return:Kt[0]?Ce.throw||((Me=Ce.return)&&Me.call(Ce),0):Ce.next)&&!(Me=Me.call(Ce,Kt[1])).done)return Me;switch(Ce=0,Me&&(Kt=[2&Kt[0],Me.value]),Kt[0]){case 0:case 1:Me=Kt;break;case 4:return kt.label++,{value:Kt[1],done:!1};case 5:kt.label++,Ce=Kt[1],Kt=[0];continue;case 7:Kt=kt.ops.pop(),kt.trys.pop();continue;default:if(!(Me=(Me=kt.trys).length>0&&Me[Me.length-1])&&(Kt[0]===6||Kt[0]===2)){kt=0;continue}if(Kt[0]===3&&(!Me||Kt[1]>Me[0]&&Kt[1]<Me[3])){kt.label=Kt[1];break}if(Kt[0]===6&&kt.label<Me[1]){kt.label=Me[1],Me=Kt;break}if(Me&&kt.label<Me[2]){kt.label=Me[2],kt.ops.push(Kt);break}Me[2]&&kt.ops.pop(),kt.trys.pop();continue}Kt=Se.call($t,kt)}catch(hn){Kt=[6,hn],Ce=0}finally{me=Me=0}if(5&Kt[0])throw Kt[1];return{value:Kt[0]?Kt[1]:void 0,done:!0}}([En,Nt])}}}function L($t,Se){return $t(Se={exports:{}},Se.exports),Se.exports}var W=L(function($t){(function(Se,me,Ce){function Me(kt,en){return en.c=kt.c,en.s0=kt.s0,en.s1=kt.s1,en.s2=kt.s2,en}function rt(kt,en){var En=new function(hn){var un,mt=this,Tt=(un=4022871197,function(fn){fn=fn.toString();for(var tn=0;tn<fn.length;tn++){var Ve=.02519603282416938*(un+=fn.charCodeAt(tn));Ve-=un=Ve>>>0,un=(Ve*=un)>>>0,un+=4294967296*(Ve-=un)}return 23283064365386963e-26*(un>>>0)});mt.next=function(){var fn=2091639*mt.s0+23283064365386963e-26*mt.c;return mt.s0=mt.s1,mt.s1=mt.s2,mt.s2=fn-(mt.c=0|fn)},mt.c=1,mt.s0=Tt(" "),mt.s1=Tt(" "),mt.s2=Tt(" "),mt.s0-=Tt(hn),mt.s0<0&&(mt.s0+=1),mt.s1-=Tt(hn),mt.s1<0&&(mt.s1+=1),mt.s2-=Tt(hn),mt.s2<0&&(mt.s2+=1),Tt=null}(kt),Nt=en&&en.state,Kt=En.next;return Kt.int32=function(){return 4294967296*En.next()|0},Kt.double=function(){return Kt()+11102230246251565e-32*(2097152*Kt()|0)},Kt.quick=Kt,Nt&&(typeof Nt=="object"&&Me(Nt,En),Kt.state=function(){return Me(En,{})}),Kt}me&&me.exports?me.exports=rt:this.alea=rt})(0,$t)}),z=L(function($t){(function(Se,me,Ce){function Me(kt,en){return en.x=kt.x,en.y=kt.y,en.z=kt.z,en.w=kt.w,en}function rt(kt,en){var En=new function(hn){var un=this,mt="";un.x=0,un.y=0,un.z=0,un.w=0,un.next=function(){var fn=un.x^un.x<<11;return un.x=un.y,un.y=un.z,un.z=un.w,un.w^=un.w>>>19^fn^fn>>>8},hn===(0|hn)?un.x=hn:mt+=hn;for(var Tt=0;Tt<mt.length+64;Tt++)un.x^=0|mt.charCodeAt(Tt),un.next()}(kt),Nt=en&&en.state,Kt=function(){return(En.next()>>>0)/4294967296};return Kt.double=function(){do var hn=((En.next()>>>11)+(En.next()>>>0)/4294967296)/2097152;while(hn===0);return hn},Kt.int32=En.next,Kt.quick=Kt,Nt&&(typeof Nt=="object"&&Me(Nt,En),Kt.state=function(){return Me(En,{})}),Kt}me&&me.exports?me.exports=rt:this.xor128=rt})(0,$t)}),q=L(function($t){(function(Se,me,Ce){function Me(kt,en){return en.x=kt.x,en.y=kt.y,en.z=kt.z,en.w=kt.w,en.v=kt.v,en.d=kt.d,en}function rt(kt,en){var En=new function(hn){var un=this,mt="";un.next=function(){var fn=un.x^un.x>>>2;return un.x=un.y,un.y=un.z,un.z=un.w,un.w=un.v,(un.d=un.d+362437|0)+(un.v=un.v^un.v<<4^fn^fn<<1)|0},un.x=0,un.y=0,un.z=0,un.w=0,un.v=0,hn===(0|hn)?un.x=hn:mt+=hn;for(var Tt=0;Tt<mt.length+64;Tt++)un.x^=0|mt.charCodeAt(Tt),Tt==mt.length&&(un.d=un.x<<10^un.x>>>4),un.next()}(kt),Nt=en&&en.state,Kt=function(){return(En.next()>>>0)/4294967296};return Kt.double=function(){do var hn=((En.next()>>>11)+(En.next()>>>0)/4294967296)/2097152;while(hn===0);return hn},Kt.int32=En.next,Kt.quick=Kt,Nt&&(typeof Nt=="object"&&Me(Nt,En),Kt.state=function(){return Me(En,{})}),Kt}me&&me.exports?me.exports=rt:this.xorwow=rt})(0,$t)}),I=L(function($t){(function(Se,me,Ce){function Me(kt,en){return en.x=kt.x.slice(),en.i=kt.i,en}function rt(kt,en){kt==null&&(kt=+new Date);var En=new function(hn){var un=this;un.next=function(){var mt,Tt,fn=un.x,tn=un.i;return mt=fn[tn],Tt=(mt^=mt>>>7)^mt<<24,Tt^=(mt=fn[tn+1&7])^mt>>>10,Tt^=(mt=fn[tn+3&7])^mt>>>3,Tt^=(mt=fn[tn+4&7])^mt<<7,mt=fn[tn+7&7],Tt^=(mt^=mt<<13)^mt<<9,fn[tn]=Tt,un.i=tn+1&7,Tt},function(mt,Tt){var fn,tn=[];if(Tt===(0|Tt))tn[0]=Tt;else for(Tt=""+Tt,fn=0;fn<Tt.length;++fn)tn[7&fn]=tn[7&fn]<<15^Tt.charCodeAt(fn)+tn[fn+1&7]<<13;for(;tn.length<8;)tn.push(0);for(fn=0;fn<8&&tn[fn]===0;++fn);for(fn==8?tn[7]=-1:tn[fn],mt.x=tn,mt.i=0,fn=256;fn>0;--fn)mt.next()}(un,hn)}(kt),Nt=en&&en.state,Kt=function(){return(En.next()>>>0)/4294967296};return Kt.double=function(){do var hn=((En.next()>>>11)+(En.next()>>>0)/4294967296)/2097152;while(hn===0);return hn},Kt.int32=En.next,Kt.quick=Kt,Nt&&(Nt.x&&Me(Nt,En),Kt.state=function(){return Me(En,{})}),Kt}me&&me.exports?me.exports=rt:this.xorshift7=rt})(0,$t)}),Z=L(function($t){(function(Se,me,Ce){function Me(kt,en){return en.i=kt.i,en.w=kt.w,en.X=kt.X.slice(),en}function rt(kt,en){kt==null&&(kt=+new Date);var En=new function(hn){var un=this;un.next=function(){var mt,Tt,fn=un.w,tn=un.X,Ve=un.i;return un.w=fn=fn+1640531527|0,Tt=tn[Ve+34&127],mt=tn[Ve=Ve+1&127],Tt^=Tt<<13,mt^=mt<<17,Tt^=Tt>>>15,mt^=mt>>>12,Tt=tn[Ve]=Tt^mt,un.i=Ve,Tt+(fn^fn>>>16)|0},function(mt,Tt){var fn,tn,Ve,Ln,Xn,Zn=[],cr=128;for(Tt===(0|Tt)?(tn=Tt,Tt=null):(Tt+="\0",tn=0,cr=Math.max(cr,Tt.length)),Ve=0,Ln=-32;Ln<cr;++Ln)Tt&&(tn^=Tt.charCodeAt((Ln+32)%Tt.length)),Ln===0&&(Xn=tn),tn^=tn<<10,tn^=tn>>>15,tn^=tn<<4,tn^=tn>>>13,Ln>=0&&(Xn=Xn+1640531527|0,Ve=(fn=Zn[127&Ln]^=tn+Xn)==0?Ve+1:0);for(Ve>=128&&(Zn[127&(Tt&&Tt.length||0)]=-1),Ve=127,Ln=512;Ln>0;--Ln)tn=Zn[Ve+34&127],fn=Zn[Ve=Ve+1&127],tn^=tn<<13,fn^=fn<<17,tn^=tn>>>15,fn^=fn>>>12,Zn[Ve]=tn^fn;mt.w=Xn,mt.X=Zn,mt.i=Ve}(un,hn)}(kt),Nt=en&&en.state,Kt=function(){return(En.next()>>>0)/4294967296};return Kt.double=function(){do var hn=((En.next()>>>11)+(En.next()>>>0)/4294967296)/2097152;while(hn===0);return hn},Kt.int32=En.next,Kt.quick=Kt,Nt&&(Nt.X&&Me(Nt,En),Kt.state=function(){return Me(En,{})}),Kt}me&&me.exports?me.exports=rt:this.xor4096=rt})(0,$t)}),Y=L(function($t){(function(Se,me,Ce){function Me(kt,en){return en.a=kt.a,en.b=kt.b,en.c=kt.c,en.d=kt.d,en}function rt(kt,en){var En=new function(hn){var un=this,mt="";un.next=function(){var fn=un.b,tn=un.c,Ve=un.d,Ln=un.a;return fn=fn<<25^fn>>>7^tn,tn=tn-Ve|0,Ve=Ve<<24^Ve>>>8^Ln,Ln=Ln-fn|0,un.b=fn=fn<<20^fn>>>12^tn,un.c=tn=tn-Ve|0,un.d=Ve<<16^tn>>>16^Ln,un.a=Ln-fn|0},un.a=0,un.b=0,un.c=-1640531527,un.d=1367130551,hn===Math.floor(hn)?(un.a=hn/4294967296|0,un.b=0|hn):mt+=hn;for(var Tt=0;Tt<mt.length+20;Tt++)un.b^=0|mt.charCodeAt(Tt),un.next()}(kt),Nt=en&&en.state,Kt=function(){return(En.next()>>>0)/4294967296};return Kt.double=function(){do var hn=((En.next()>>>11)+(En.next()>>>0)/4294967296)/2097152;while(hn===0);return hn},Kt.int32=En.next,Kt.quick=Kt,Nt&&(typeof Nt=="object"&&Me(Nt,En),Kt.state=function(){return Me(En,{})}),Kt}me&&me.exports?me.exports=rt:this.tychei=rt})(0,$t)}),G=L(function($t){(function(Se,me){var Ce,Me=this,rt=256,kt=6,en="random",En=me.pow(rt,kt),Nt=me.pow(2,52),Kt=2*Nt,hn=rt-1;function un(tn,Ve,Ln){var Xn=[],Zn=Tt(function Sr(yi,ki){var Zr,Zi=[],gi=typeof yi;if(ki&&gi=="object")for(Zr in yi)try{Zi.push(Sr(yi[Zr],ki-1))}catch{}return Zi.length?Zi:gi=="string"?yi:yi+"\0"}((Ve=Ve==1?{entropy:!0}:Ve||{}).entropy?[tn,fn(Se)]:tn??function(){try{var Sr;return Ce&&(Sr=Ce.randomBytes)?Sr=Sr(rt):(Sr=new Uint8Array(rt),(Me.crypto||Me.msCrypto).getRandomValues(Sr)),fn(Sr)}catch{var yi=Me.navigator,ki=yi&&yi.plugins;return[+new Date,Me,ki,Me.screen,fn(Se)]}}(),3),Xn),cr=new function(Sr){var yi,ki=Sr.length,Zr=this,Zi=0,gi=Zr.i=Zr.j=0,ei=Zr.S=[];for(ki||(Sr=[ki++]);Zi<rt;)ei[Zi]=Zi++;for(Zi=0;Zi<rt;Zi++)ei[Zi]=ei[gi=hn&gi+Sr[Zi%ki]+(yi=ei[Zi])],ei[gi]=yi;(Zr.g=function(Xr){for(var Kn,di=0,Ei=Zr.i,zr=Zr.j,oo=Zr.S;Xr--;)Kn=oo[Ei=hn&Ei+1],di=di*rt+oo[hn&(oo[Ei]=oo[zr=hn&zr+Kn])+(oo[zr]=Kn)];return Zr.i=Ei,Zr.j=zr,di})(rt)}(Xn),Br=function(){for(var Sr=cr.g(kt),yi=En,ki=0;Sr<Nt;)Sr=(Sr+ki)*rt,yi*=rt,ki=cr.g(1);for(;Sr>=Kt;)Sr/=2,yi/=2,ki>>>=1;return(Sr+ki)/yi};return Br.int32=function(){return 0|cr.g(4)},Br.quick=function(){return cr.g(4)/4294967296},Br.double=Br,Tt(fn(cr.S),Se),(Ve.pass||Ln||function(Sr,yi,ki,Zr){return Zr&&(Zr.S&&mt(Zr,cr),Sr.state=function(){return mt(cr,{})}),ki?(me[en]=Sr,yi):Sr})(Br,Zn,"global"in Ve?Ve.global:this==me,Ve.state)}function mt(tn,Ve){return Ve.i=tn.i,Ve.j=tn.j,Ve.S=tn.S.slice(),Ve}function Tt(tn,Ve){for(var Ln,Xn=tn+"",Zn=0;Zn<Xn.length;)Ve[hn&Zn]=hn&(Ln^=19*Ve[hn&Zn])+Xn.charCodeAt(Zn++);return fn(Ve)}function fn(tn){return String.fromCharCode.apply(0,tn)}if(me["seed"+en]=un,Tt(me.random(),Se),$t.exports){$t.exports=un;try{Ce=r(387)}catch{}}})([],Math)});G.alea=W,G.xor128=z,G.xorwow=q,G.xorshift7=I,G.xor4096=Z,G.tychei=Y;var oe=G.alea;function ce($t,Se,me,Ce){if(me===void 0&&(me=new Map),Ce===void 0&&(Ce=new Set),$t==null)return null;if(Ce.has($t))throw new Error("Circular references are not supported.");if(me.has($t))return me.get($t);var Me=Se($t);if(Me.recurse&&Me.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(Me.recurse){if(ge($t)){var rt=Array.isArray($t)?[]:{};for(var kt in Ce.add($t),$t){var en=ce($t[kt],Se,me,Ce);rt[kt]=en}return Ce.delete($t),rt}throw new Error("Can't recurse into non-iterable type: "+$t)}return me.set($t,Me.value),Me.value}function be($t,Se){return Se===void 0&&(Se=Ee),function me(Ce,Me,rt){rt===void 0&&(rt=new Set);var kt=Ce[0];if(rt.has(kt))throw new Error("Circular references are not supported.");var en=Me(Ce);if(en.recurse&&en.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(en.recurse){if(ge(kt)){var En=Array.isArray(kt)?[]:{};rt.add(kt);var Nt=function(hn){var un=me(Ce.map(function(mt){return mt[hn]}),Me,rt);En[hn]=un};for(var Kt in kt)Nt(Kt);return rt.delete(kt),En}throw new Error("Can't recurse into non-iterable type: "+kt)}return en.value}($t,Se)}function Ee($t){return $t===null?null:ge($t[0])?{value:null,recurse:!0}:{value:$t,recurse:!1}}function ve($t,Se){return j(this,void 0,void 0,function(){var me,Ce,Me,rt,kt,en;return N(this,function(En){switch(En.label){case 0:me=new Map,ce($t,Se,me),Ce=0,Me=Array.from(me.keys()),En.label=1;case 1:return Ce<Me.length?(rt=Me[Ce],(kt=me.get(rt))instanceof Promise?[4,kt]:[3,3]):[3,4];case 2:en=En.sent(),me.set(rt,en),En.label=3;case 3:return Ce++,[3,1];case 4:return[2,ce($t,Se,me)]}})})}function ge($t){return $t!=null&&!ArrayBuffer.isView($t)&&(Array.isArray($t)||typeof $t=="object"&&!($t instanceof S.Tensor))}function Ge($t){return function(Se,me){return ce(Se,me)}($t,ht)}function ht($t){return $t instanceof S.Tensor?{value:$t.clone(),recurse:!1}:ge($t)?{value:null,recurse:!0}:{value:$t,recurse:!1}}var It=function(){function $t(Se){if(this.capacity=Se,this.begin=0,this.end=0,Se==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(Se<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(Se),this.doubledCapacity=2*Se}return $t.prototype.wrap=function(Se){for(;Se<0;)Se+=this.doubledCapacity;return Se%this.doubledCapacity},$t.prototype.get=function(Se){if(Se<0)throw new RangeError("Can't get item at a negative index.");return this.data[Se%this.capacity]},$t.prototype.set=function(Se,me){if(Se<0)throw new RangeError("Can't set item at a negative index.");this.data[Se%this.capacity]=me},$t.prototype.length=function(){var Se=this.end-this.begin;return Se<0&&(Se=this.doubledCapacity+Se),Se},$t.prototype.isFull=function(){return this.length()===this.capacity},$t.prototype.isEmpty=function(){return this.length()===0},$t.prototype.push=function(Se){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,Se),this.end=this.wrap(this.end+1)},$t.prototype.pushAll=function(Se){for(var me=0,Ce=Se;me<Ce.length;me++){var Me=Ce[me];this.push(Me)}},$t.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var Se=this.get(this.end);return this.set(this.end,void 0),Se},$t.prototype.unshift=function(Se){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,Se)},$t.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var Se=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),Se},$t.prototype.shuffleExcise=function(Se){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var me=this.wrap(this.begin+Se),Ce=this.get(me);return this.set(me,this.pop()),Ce},$t}(),St=function($t){function Se(){return $t.call(this,Se.INITIAL_CAPACITY)||this}return U(Se,$t),Se.prototype.isFull=function(){return!1},Se.prototype.push=function(me){$t.prototype.isFull.call(this)&&this.expand(),$t.prototype.push.call(this,me)},Se.prototype.unshift=function(me){$t.prototype.isFull.call(this)&&this.expand(),$t.prototype.unshift.call(this,me)},Se.prototype.expand=function(){for(var me=2*this.capacity,Ce=new Array(me),Me=this.length(),rt=0;rt<Me;rt++)Ce[rt]=this.get(this.wrap(this.begin+rt));this.data=Ce,this.capacity=me,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=Me},Se.INITIAL_CAPACITY=32,Se}(It);function we($t){return new ze($t)}function bt($t){return new Ut($t)}var jt,Mt=function(){function $t(){}return $t.prototype.toArray=function(){return j(this,void 0,void 0,function(){var Se,me;return N(this,function(Ce){switch(Ce.label){case 0:return Se=[],[4,this.next()];case 1:me=Ce.sent(),Ce.label=2;case 2:return me.done?[3,4]:(Se.push(me.value),[4,this.next()]);case 3:return me=Ce.sent(),[3,2];case 4:return[2,Se]}})})},$t.prototype.toArrayForTest=function(){return j(this,void 0,void 0,function(){var Se,me,Ce;return N(this,function(Me){switch(Me.label){case 0:return Se=this.prefetch(100),me=[],[4,Se.next()];case 1:Ce=Me.sent(),Me.label=2;case 2:return Ce.done?[3,4]:(me.push(Ce.value),[4,Se.next()]);case 3:return Ce=Me.sent(),[3,2];case 4:return[2,me]}})})},$t.prototype.resolveFully=function(){return j(this,void 0,void 0,function(){var Se;return N(this,function(me){switch(me.label){case 0:return[4,this.next()];case 1:Se=me.sent(),me.label=2;case 2:return Se.done?[3,4]:[4,this.next()];case 3:return Se=me.sent(),[3,2];case 4:return[2]}})})},$t.prototype.resolveWhile=function(Se){return j(this,void 0,void 0,function(){var me,Ce;return N(this,function(Me){switch(Me.label){case 0:return[4,this.next()];case 1:me=Me.sent(),Ce=Se(me.value),Me.label=2;case 2:return me.done||!Ce?[3,4]:[4,this.next()];case 3:return me=Me.sent(),Ce=Se(me.value),[3,2];case 4:return[2]}})})},$t.prototype.handleErrors=function(Se){return new Yt(this,Se)},$t.prototype.filter=function(Se){return new xt(this,Se)},$t.prototype.map=function(Se){return new _t(this,Se)},$t.prototype.mapAsync=function(Se){return new Fn(this,Se)},$t.prototype.serialMapAsync=function(Se){return new Fn(this,Se).serial()},$t.prototype.flatmap=function(Se){return new cn(this,Se)},$t.prototype.forEachAsync=function(Se){return j(this,void 0,void 0,function(){return N(this,function(me){return[2,this.map(Se).resolveFully()]})})},$t.prototype.serialForEach=function(Se){return j(this,void 0,void 0,function(){return N(this,function(me){return[2,this.serialMapAsync(Se).resolveWhile(function(Ce){return Ce===!0})]})})},$t.prototype.rowMajorBatch=function(Se,me){return me===void 0&&(me=!0),new nn(this,Se,me)},$t.prototype.columnMajorBatch=function(Se,me,Ce){return me===void 0&&(me=!0),Ce===void 0&&(Ce=Ee),this.rowMajorBatch(Se,me).map(function(Me){return be(Me,Ce)})},$t.prototype.concatenate=function(Se,me){return new qe(we([this,Se]),me)},$t.prototype.take=function(Se){return Se<0||Se==null?this:new yt(this,Se)},$t.prototype.skip=function(Se){return Se<0||Se==null?this:new pt(this,Se)},$t.prototype.prefetch=function(Se){return new $e(this,Se)},$t.prototype.shuffle=function(Se,me){return new ft(this,Se,me)},$t.prototype.serial=function(){return new Ft(this)},$t}(),ze=function($t){function Se(me){var Ce=$t.call(this)||this;return Ce.items=me,Ce.trav=0,Ce}return U(Se,$t),Se.prototype.summary=function(){return"Array of "+this.items.length+" items"},Se.prototype.next=function(){return j(this,void 0,void 0,function(){var me;return N(this,function(Ce){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(me=this.items[this.trav],this.trav++,[2,{value:Ge(me),done:!1}])})})},Se}(Mt),Ut=function($t){function Se(me){var Ce=$t.call(this)||this;return Ce.nextFn=me,Ce}return U(Se,$t),Se.prototype.summary=function(){return"Function call"},Se.prototype.next=function(){return j(this,void 0,void 0,function(){return N(this,function(me){try{return[2,this.nextFn()]}catch(Ce){throw Ce.message="Error thrown while iterating through a dataset: "+Ce.message,Ce}return[2]})})},Se}(Mt),Ft=function($t){function Se(me){var Ce=$t.call(this)||this;return Ce.upstream=me,Ce.lastRead=Promise.resolve({value:null,done:!1}),Ce}return U(Se,$t),Se.prototype.summary=function(){return this.upstream.summary()+" -> Serial"},Se.prototype.next=function(){return j(this,void 0,void 0,function(){var me=this;return N(this,function(Ce){return this.lastRead=this.lastRead.then(function(){return me.serialNext()}),[2,this.lastRead]})})},Se.prototype.serialNext=function(){return j(this,void 0,void 0,function(){return N(this,function(me){return[2,this.upstream.next()]})})},Se}(Mt),pt=function($t){function Se(me,Ce){var Me=$t.call(this)||this;return Me.upstream=me,Me.maxCount=Ce,Me.count=0,Me.lastRead=Promise.resolve({value:null,done:!1}),Me}return U(Se,$t),Se.prototype.summary=function(){return this.upstream.summary()+" -> Skip"},Se.prototype.next=function(){return j(this,void 0,void 0,function(){var me=this;return N(this,function(Ce){return this.lastRead=this.lastRead.then(function(){return me.serialNext()}),[2,this.lastRead]})})},Se.prototype.serialNext=function(){return j(this,void 0,void 0,function(){var me;return N(this,function(Ce){switch(Ce.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return(me=Ce.sent()).done?[2,me]:(Object(S.dispose)(me.value),[3,0]);case 2:return[2,this.upstream.next()]}})})},Se}(Mt),yt=function($t){function Se(me,Ce){var Me=$t.call(this)||this;return Me.upstream=me,Me.maxCount=Ce,Me.count=0,Me}return U(Se,$t),Se.prototype.summary=function(){return this.upstream.summary()+" -> Take"},Se.prototype.next=function(){return j(this,void 0,void 0,function(){return N(this,function(me){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]})})},Se}(Mt),nn=function($t){function Se(me,Ce,Me){Me===void 0&&(Me=!0);var rt=$t.call(this)||this;return rt.upstream=me,rt.batchSize=Ce,rt.enableSmallLastBatch=Me,rt.lastRead=Promise.resolve({value:null,done:!1}),rt}return U(Se,$t),Se.prototype.summary=function(){return this.upstream.summary()+" -> RowMajorBatch"},Se.prototype.next=function(){return j(this,void 0,void 0,function(){var me=this;return N(this,function(Ce){return this.lastRead=this.lastRead.then(function(){return me.serialNext()}),[2,this.lastRead]})})},Se.prototype.serialNext=function(){return j(this,void 0,void 0,function(){var me,Ce;return N(this,function(Me){switch(Me.label){case 0:me=[],Me.label=1;case 1:return me.length<this.batchSize?[4,this.upstream.next()]:[3,3];case 2:return(Ce=Me.sent()).done?this.enableSmallLastBatch&&me.length>0?[2,{value:me,done:!1}]:[2,{value:null,done:!0}]:(me.push(Ce.value),[3,1]);case 3:return[2,{value:me,done:!1}]}})})},Se}(Mt),xt=function($t){function Se(me,Ce){var Me=$t.call(this)||this;return Me.upstream=me,Me.predicate=Ce,Me.lastRead=Promise.resolve({value:null,done:!1}),Me}return U(Se,$t),Se.prototype.summary=function(){return this.upstream.summary()+" -> Filter"},Se.prototype.next=function(){return j(this,void 0,void 0,function(){var me=this;return N(this,function(Ce){return this.lastRead=this.lastRead.then(function(){return me.serialNext()}),[2,this.lastRead]})})},Se.prototype.serialNext=function(){return j(this,void 0,void 0,function(){var me;return N(this,function(Ce){switch(Ce.label){case 0:return[4,this.upstream.next()];case 1:return(me=Ce.sent()).done||this.predicate(me.value)?[2,me]:(Object(S.dispose)(me.value),[3,0]);case 2:return[2]}})})},Se}(Mt),_t=function($t){function Se(me,Ce){var Me=$t.call(this)||this;return Me.upstream=me,Me.transform=Ce,Me}return U(Se,$t),Se.prototype.summary=function(){return this.upstream.summary()+" -> Map"},Se.prototype.next=function(){return j(this,void 0,void 0,function(){var me,Ce,Me,rt,kt,en,En;return N(this,function(Nt){switch(Nt.label){case 0:return[4,this.upstream.next()];case 1:if((me=Nt.sent()).done)return[2,{value:null,done:!0}];for(Ce=S.tensor_util.getTensorsInContainer(me.value),Me=this.transform(me.value),rt=S.tensor_util.getTensorsInContainer(Me),kt=0,en=Ce;kt<en.length;kt++)En=en[kt],S.tensor_util.isTensorInList(En,rt)||En.dispose();return[2,{value:Me,done:!1}]}})})},Se}(Mt),Yt=function($t){function Se(me,Ce){var Me=$t.call(this)||this;return Me.upstream=me,Me.handler=Ce,Me.count=0,Me.lastRead=Promise.resolve({value:null,done:!1}),Me}return U(Se,$t),Se.prototype.summary=function(){return this.upstream.summary()+" -> handleErrors"},Se.prototype.next=function(){return j(this,void 0,void 0,function(){var me=this;return N(this,function(Ce){return this.lastRead=this.lastRead.then(function(){return me.serialNext()}),[2,this.lastRead]})})},Se.prototype.serialNext=function(){return j(this,void 0,void 0,function(){var me;return N(this,function(Ce){switch(Ce.label){case 0:Ce.label=1;case 1:return Ce.trys.push([1,3,,4]),[4,this.upstream.next()];case 2:return[2,Ce.sent()];case 3:return me=Ce.sent(),this.handler(me)?[3,4]:[2,{value:null,done:!0}];case 4:return[3,0];case 5:return[2]}})})},Se}(Mt),Fn=function($t){function Se(me,Ce){var Me=$t.call(this)||this;return Me.upstream=me,Me.transform=Ce,Me}return U(Se,$t),Se.prototype.summary=function(){return this.upstream.summary()+" -> AsyncMap"},Se.prototype.next=function(){return j(this,void 0,void 0,function(){var me,Ce,Me,rt,kt,en,En;return N(this,function(Nt){switch(Nt.label){case 0:return[4,this.upstream.next()];case 1:return(me=Nt.sent()).done?[2,{value:null,done:!0}]:(Ce=S.tensor_util.getTensorsInContainer(me.value),[4,this.transform(me.value)]);case 2:for(Me=Nt.sent(),rt=S.tensor_util.getTensorsInContainer(Me),kt=0,en=Ce;kt<en.length;kt++)En=en[kt],S.tensor_util.isTensorInList(En,rt)||En.dispose();return[2,{value:Me,done:!1}]}})})},Se}(Mt),Rn=function($t){function Se(){var me=$t.call(this)||this;return me.outputQueue=new St,me.lastRead=Promise.resolve({value:null,done:!1}),me}return U(Se,$t),Se.prototype.next=function(){return j(this,void 0,void 0,function(){var me=this;return N(this,function(Ce){return this.lastRead=this.lastRead.then(function(){return me.serialNext()}),[2,this.lastRead]})})},Se.prototype.serialNext=function(){return j(this,void 0,void 0,function(){return N(this,function(me){switch(me.label){case 0:return this.outputQueue.length()!==0?[3,2]:[4,this.pump()];case 1:return me.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}})})},Se}(Mt),cn=function($t){function Se(me,Ce){var Me=$t.call(this)||this;return Me.upstream=me,Me.transform=Ce,Me}return U(Se,$t),Se.prototype.summary=function(){return this.upstream.summary()+" -> Flatmap"},Se.prototype.pump=function(){return j(this,void 0,void 0,function(){var me,Ce,Me,rt,kt,en,En;return N(this,function(Nt){switch(Nt.label){case 0:return[4,this.upstream.next()];case 1:if((me=Nt.sent()).done)return[2,!1];for(Ce=S.tensor_util.getTensorsInContainer(me.value),Me=this.transform(me.value),rt=S.tensor_util.getTensorsInContainer(Me),this.outputQueue.pushAll(Me),kt=0,en=Ce;kt<en.length;kt++)En=en[kt],S.tensor_util.isTensorInList(En,rt)||En.dispose();return[2,!0]}})})},Se}(Rn),qe=function($t){function Se(me,Ce){var Me=$t.call(this)||this;return Me.baseErrorHandler=Ce,Me.lastRead=null,Me.iterator=null,Me.moreIterators=me,Me}return U(Se,$t),Se.prototype.summary=function(){return"TODO: fill in upstream of chained summaries -> Chained"},Se.prototype.next=function(){return j(this,void 0,void 0,function(){return N(this,function(me){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]})})},Se.prototype.readFromChain=function(me){return j(this,void 0,void 0,function(){var Ce,Me;return N(this,function(rt){switch(rt.label){case 0:return[4,me];case 1:return rt.sent(),this.iterator!=null?[3,3]:[4,this.moreIterators.next()];case 2:if((Ce=rt.sent()).done)return[2,{value:null,done:!0}];this.iterator=Ce.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler)),rt.label=3;case 3:return[4,this.iterator.next()];case 4:return(Me=rt.sent()).done?(this.iterator=null,[2,this.readFromChain(me)]):[2,Me]}})})},Se}(Mt);(function($t){$t[$t.FAIL=0]="FAIL",$t[$t.SHORTEST=1]="SHORTEST",$t[$t.LONGEST=2]="LONGEST"})(jt||(jt={}));var Qe=function($t){function Se(me,Ce){Ce===void 0&&(Ce=jt.FAIL);var Me=$t.call(this)||this;return Me.iterators=me,Me.mismatchMode=Ce,Me.count=0,Me.currentPromise=null,Me}return U(Se,$t),Se.prototype.summary=function(){return"{TODO: fill in upstream of zip summaries} -> Zip"},Se.prototype.nextState=function(me){return j(this,void 0,void 0,function(){function Ce(en){return en instanceof Mt?{value:en.next().then(function(En){return Me++,En.done&&rt++,En.value}),recurse:!1}:{value:null,recurse:!0}}var Me,rt,kt;return N(this,function(en){switch(en.label){case 0:return[4,me];case 1:return en.sent(),Me=0,rt=0,[4,ve(this.iterators,Ce)];case 2:if(kt=en.sent(),Me===rt)return[2,{value:null,done:!0}];if(rt>0)switch(this.mismatchMode){case jt.FAIL:throw new Error("Zipped streams should have the same length. Mismatched at element "+this.count+".");case jt.SHORTEST:return[2,{value:null,done:!0}];case jt.LONGEST:}return this.count++,[2,{value:kt,done:!1}]}})})},Se.prototype.next=function(){return j(this,void 0,void 0,function(){return N(this,function(me){return this.currentPromise=this.nextState(this.currentPromise),[2,this.currentPromise]})})},Se}(Mt),$e=function($t){function Se(me,Ce){var Me=$t.call(this)||this;return Me.upstream=me,Me.bufferSize=Ce,Me.buffer=new It(Ce),Me}return U(Se,$t),Se.prototype.summary=function(){return this.upstream.summary()+" -> Prefetch"},Se.prototype.refill=function(){for(;!this.buffer.isFull();){var me=this.upstream.next();this.buffer.push(me)}},Se.prototype.next=function(){return this.refill(),this.buffer.shift()},Se}(Mt),ft=function($t){function Se(me,Ce,Me){var rt=$t.call(this,me,Ce)||this;return rt.upstream=me,rt.windowSize=Ce,rt.upstreamExhausted=!1,rt.random=oe(Me||S.util.now().toString()),rt.lastRead=Promise.resolve({value:null,done:!1}),rt}return U(Se,$t),Se.prototype.next=function(){return j(this,void 0,void 0,function(){var me=this;return N(this,function(Ce){return this.lastRead=this.lastRead.then(function(){return me.serialNext()}),[2,this.lastRead]})})},Se.prototype.randomInt=function(me){return Math.floor(this.random()*me)},Se.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},Se.prototype.serialNext=function(){return j(this,void 0,void 0,function(){var me,Ce;return N(this,function(Me){switch(Me.label){case 0:this.upstreamExhausted||this.refill(),Me.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(me=this.chooseIndex(),[4,this.buffer.shuffleExcise(me)]);case 2:return(Ce=Me.sent()).done?(this.upstreamExhausted=!0,[3,1]):(this.refill(),[2,Ce]);case 3:return[2,{value:null,done:!0}]}})})},Se}($e),Jt=function(){function $t(){this.size=null}return $t.prototype.batch=function(Se,me){var Ce=this;me===void 0&&(me=!0);var Me=this;return S.util.assert(Se>0,function(){return`batchSize needs to be positive, but it is
      `+Se}),Qt(function(){return j(Ce,void 0,void 0,function(){return N(this,function(rt){switch(rt.label){case 0:return[4,Me.iterator()];case 1:return[2,rt.sent().columnMajorBatch(Se,me,Qn)]}})})},this.size===1/0||this.size==null?this.size:me?Math.ceil(this.size/Se):Math.floor(this.size/Se))},$t.prototype.concatenate=function(Se){var me=this,Ce=this;return Qt(function(){return j(me,void 0,void 0,function(){var Me,rt;return N(this,function(kt){switch(kt.label){case 0:return[4,Ce.iterator()];case 1:return rt=(Me=kt.sent()).concatenate,[4,Se.iterator()];case 2:return[2,rt.apply(Me,[kt.sent()])]}})})},this.size===1/0||Se.size===1/0?1/0:this.size!=null&&Se.size!=null?this.size+Se.size:null)},$t.prototype.filter=function(Se){var me=this,Ce=this;return Qt(function(){return j(me,void 0,void 0,function(){return N(this,function(Me){switch(Me.label){case 0:return[4,Ce.iterator()];case 1:return[2,Me.sent().filter(function(rt){return Object(S.tidy)(function(){return Se(rt)})})]}})})},this.size===1/0?1/0:null)},$t.prototype.forEachAsync=function(Se){return j(this,void 0,void 0,function(){return N(this,function(me){switch(me.label){case 0:return[4,this.iterator()];case 1:return[2,me.sent().forEachAsync(Se)]}})})},$t.prototype.forEach=function(Se){return j(this,void 0,void 0,function(){return N(this,function(me){return Object(S.deprecationWarn)("dataset.forEach() is deprecated and will be removed. Please use dataset.forEachAsync() instead"),[2,this.forEachAsync(Se)]})})},$t.prototype.map=function(Se){var me=this,Ce=this;return Qt(function(){return j(me,void 0,void 0,function(){return N(this,function(Me){switch(Me.label){case 0:return[4,Ce.iterator()];case 1:return[2,Me.sent().map(function(rt){return Object(S.tidy)(function(){return Se(rt)})})]}})})},this.size)},$t.prototype.mapAsync=function(Se){var me=this,Ce=this;return Qt(function(){return j(me,void 0,void 0,function(){return N(this,function(Me){switch(Me.label){case 0:return[4,Ce.iterator()];case 1:return[2,Me.sent().mapAsync(Se)]}})})},this.size)},$t.prototype.prefetch=function(Se){var me=this;if(Se==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var Ce=this;return Qt(function(){return j(me,void 0,void 0,function(){return N(this,function(Me){switch(Me.label){case 0:return[4,Ce.iterator()];case 1:return[2,Me.sent().prefetch(Se)]}})})},this.size)},$t.prototype.repeat=function(Se){var me=this,Ce=this;return Qt(function(){return j(me,void 0,void 0,function(){var Me=this;return N(this,function(rt){return[2,function(kt,en){return new qe(kt,en)}(bt(function(){return j(Me,void 0,void 0,function(){var kt;return N(this,function(en){switch(en.label){case 0:return kt={},[4,Ce.iterator()];case 1:return[2,(kt.value=en.sent(),kt.done=!1,kt)]}})})}).take(Se))]})})},this.size!=null&&Se>0?this.size*Se:Se===0?0:this.size!=null&&(Se===void 0||Se<0)?1/0:null)},$t.prototype.skip=function(Se){var me=this,Ce=this;return Qt(function(){return j(me,void 0,void 0,function(){return N(this,function(Me){switch(Me.label){case 0:return[4,Ce.iterator()];case 1:return[2,Me.sent().skip(Se)]}})})},this.size!=null&&Se>=0&&this.size>=Se?this.size-Se:this.size!=null&&(this.size<Se||Se===void 0||Se<0)?0:null)},$t.prototype.shuffle=function(Se,me,Ce){var Me=this;if(Ce===void 0&&(Ce=!0),Se==null||Se<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting bufferSize to the dataset size ("+this.size+" elements)");var rt=this,kt=oe(me||S.util.now().toString());return Qt(function(){return j(Me,void 0,void 0,function(){var en;return N(this,function(En){switch(En.label){case 0:return en=kt.int32(),Ce&&(en+=kt.int32()),[4,rt.iterator()];case 1:return[2,En.sent().shuffle(Se,en.toString())]}})})},this.size)},$t.prototype.take=function(Se){var me=this,Ce=this;return Qt(function(){return j(me,void 0,void 0,function(){return N(this,function(Me){switch(Me.label){case 0:return[4,Ce.iterator()];case 1:return[2,Me.sent().take(Se)]}})})},this.size!=null&&this.size>Se?Se:this.size!=null&&this.size<=Se?this.size:null)},$t.prototype.toArray=function(){return j(this,void 0,void 0,function(){return N(this,function(Se){switch(Se.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,Se.sent().toArray()]}})})},$t.prototype.toArrayForTest=function(){return j(this,void 0,void 0,function(){return N(this,function(Se){switch(Se.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,Se.sent().toArrayForTest()]}})})},$t.MAX_BUFFER_SIZE=1e4,$t}();function Qt($t,Se){return Se===void 0&&(Se=null),new(function(me){function Ce(){var Me=me!==null&&me.apply(this,arguments)||this;return Me.size=Se,Me}return U(Ce,me),Ce.prototype.iterator=function(){return j(this,void 0,void 0,function(){return N(this,function(Me){return[2,$t()]})})},Ce}(Jt))}function Pn($t){var Se=this;return Qt(function(){return j(Se,void 0,void 0,function(){return N(this,function(me){return[2,we($t)]})})},$t.length)}function kn($t){var Se,me=this;if(!ge($t))throw new Error("The argument to zip() must be an object or array.");if(Array.isArray($t))for(var Ce=0;Ce<$t.length;Ce++)Se=Se==null?$t[Ce].size:Math.min(Se,$t[Ce].size);else if($t instanceof Object)for(var Me in $t)Se=Se==null?$t[Me].size:Math.min(Se,$t[Me].size);return Qt(function(){return j(me,void 0,void 0,function(){return N(this,function(rt){switch(rt.label){case 0:return[4,ve($t,function(kt){if(kt instanceof Jt)return{value:kt.iterator(),recurse:!1};if(ge(kt))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")})];case 1:return[2,function(kt,en){return en===void 0&&(en=jt.FAIL),new Qe(kt,en)}(rt.sent(),jt.SHORTEST)]}})})},Se)}function Qn($t){return $t===null?null:function(Se){return Se==null||function(me){return me===null||typeof me!="object"&&typeof me!="function"}(Se)||Array.isArray(Se)||typeof Se=="object"&&Se instanceof S.Tensor||S.util.isTypedArray(Se)}($t[0])?{value:function(Se){if(Se.length===0)throw new Error("Can't make a batch of zero elements.");return Se[0]instanceof S.Tensor?Object(S.stack)(Se):Object(S.tensor)(Se)}($t),recurse:!1}:{value:null,recurse:!0}}var ke=function($t){function Se(me){var Ce=$t.call(this)||this;return Ce.input=me,Ce}return U(Se,$t),Se.prototype.iterator=function(){return j(this,void 0,void 0,function(){var me;return N(this,function(Ce){switch(Ce.label){case 0:return[4,this.input.iterator()];case 1:return me=Ce.sent(),[2,me.decodeUTF8().split(`
`).map(function(Me){return Me.endsWith("\r")&&(Me=Me.slice(0,-1)),Me})]}})})},Se}(Jt),ar=Symbol("out"),Tr=Symbol("field"),rn=Symbol("quote"),Ht=Symbol("quoteafterquote"),Gn=Symbol("quoteinquote"),Xt=function($t){function Se(me,Ce){var Me=$t.call(this)||this;return Me.input=me,Me.hasHeader=!0,Me.fullColumnNames=null,Me.columnNamesValidated=!1,Me.columnConfigs=null,Me.configuredColumnsOnly=!1,Me.delimiter=",",Me.delimWhitespace=!1,Me.base=new ke(me),Ce||(Ce={}),Me.hasHeader=Ce.hasHeader!==!1,Me.fullColumnNames=Ce.columnNames,Me.columnConfigs=Ce.columnConfigs,Me.configuredColumnsOnly=Ce.configuredColumnsOnly,Ce.delimWhitespace?(S.util.assert(Ce.delimiter==null,function(){return"Delimiter should not be provided when delimWhitespace is true."}),Me.delimWhitespace=!0,Me.delimiter=" "):Me.delimiter=Ce.delimiter?Ce.delimiter:",",Me}return U(Se,$t),Se.prototype.columnNames=function(){return j(this,void 0,void 0,function(){return N(this,function(me){switch(me.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:me.sent(),me.label=2;case 2:return[2,this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames]}})})},Se.prototype.setColumnNames=function(){return j(this,void 0,void 0,function(){var me,Ce,Me,rt,kt,en,En=this;return N(this,function(Nt){switch(Nt.label){case 0:return[4,this.maybeReadHeaderLine()];case 1:if(me=Nt.sent(),!this.fullColumnNames&&!me)throw new Error("Column names must be provided if there is no header line.");if(this.fullColumnNames&&me&&S.util.assert(me.length===this.fullColumnNames.length,function(){return"The length of provided columnNames ("+En.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+me.length.toString()+")."}),this.fullColumnNames||(this.fullColumnNames=me),Ce=this.fullColumnNames.reduce(function(Kt,hn){return Kt[hn]=Kt[hn]+1||1,Kt},{}),Me=Object.keys(Ce).filter(function(Kt){return Ce[Kt]>1}),S.util.assert(Me.length===0,function(){return"Duplicate column names found: "+Me.toString()}),this.columnConfigs){for(rt=0,kt=Object.keys(this.columnConfigs);rt<kt.length;rt++)if(en=kt[rt],this.fullColumnNames.indexOf(en)===-1)throw new Error('The key "'+en+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}return this.columnNamesValidated=!0,[2]}})})},Se.prototype.maybeReadHeaderLine=function(){return j(this,void 0,void 0,function(){var me,Ce;return N(this,function(Me){switch(Me.label){case 0:return this.hasHeader?[4,this.base.iterator()]:[3,3];case 1:return[4,Me.sent().next()];case 2:if((me=Me.sent()).done)throw new Error("No data was found for CSV parsing.");return Ce=me.value,[2,this.parseRow(Ce,!1)];case 3:return[2,null]}})})},Se.prototype.iterator=function(){return j(this,void 0,void 0,function(){var me,Ce=this;return N(this,function(Me){switch(Me.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:Me.sent(),Me.label=2;case 2:return[4,this.base.iterator()];case 3:return me=Me.sent(),this.hasHeader&&(me=me.skip(1)),[2,me.map(function(rt){return Ce.makeDataElement(rt)})]}})})},Se.prototype.makeDataElement=function(me){for(var Ce=this.parseRow(me),Me={},rt={},kt=0;kt<this.fullColumnNames.length;kt++){var en=this.fullColumnNames[kt],En=this.columnConfigs?this.columnConfigs[en]:null;if(!this.configuredColumnsOnly||En){var Nt=Ce[kt],Kt=null;if(Nt==="")if(En&&En.default!==void 0)Kt=En.default;else{if(En&&(En.required||En.isLabel))throw new Error("Required column "+en+" is empty in this line: "+me);Kt=void 0}else{var hn=Number(Nt);if(isNaN(hn))Kt=En&&En.dtype==="bool"?this.getBoolean(Nt):Nt;else if(En&&En.dtype)switch(En.dtype){case"float32":Kt=hn;break;case"int32":Kt=Math.floor(hn);break;case"bool":Kt=this.getBoolean(Nt);break;default:Kt=hn}else Kt=hn}En&&En.isLabel?rt[en]=Kt:Me[en]=Kt}}return Object.keys(rt).length===0?Me:{xs:Me,ys:rt}},Se.prototype.getBoolean=function(me){return me==="1"||me.toLowerCase()==="true"?1:0},Se.prototype.parseRow=function(me,Ce){Ce===void 0&&(Ce=!0);for(var Me=[],rt=0,kt=me.length,en=ar,En=0;En<kt;En++)switch(en){case ar:switch(me.charAt(En)){case'"':rt=En+1,en=rn;break;case this.delimiter:if(rt=En+1,this.delimiter===" "&&this.delimWhitespace)break;Me.push(""),en=ar;break;default:en=Tr,rt=En}break;case Tr:switch(me.charAt(En)){case this.delimiter:Me.push(me.substring(rt,En)),en=ar,rt=En+1}break;case rn:switch(me.charAt(En)){case'"':en=Ht}break;case Ht:switch(me.charAt(En)){case this.delimiter:Me.push(me.substring(rt,En-1)),en=ar,rt=En+1;break;case'"':en=rn;break;default:en=Gn}break;case Gn:switch(me.charAt(En)){case'"':en=rn}}if(en===Ht?Me.push(me.substring(rt,kt-1)):Me.push(me.substring(rt)),Ce&&Me.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have "+this.fullColumnNames.length+" elements in a row, but got "+Me);return Me},Se}(Jt),Wt=function($t){function Se(me){var Ce=$t.call(this)||this;Ce.microphoneConfig=me,Ce.isClosed=!1,Ce.fftSize=me.fftSize||1024;var Me=Math.log2(Ce.fftSize);if(Ce.fftSize<0||Me<4||Me>14||!Number.isInteger(Me))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got "+Ce.fftSize);if(Ce.numFrames=me.numFramesPerSpectrogram||43,Ce.sampleRateHz=me.sampleRateHz,Ce.columnTruncateLength=me.columnTruncateLength||Ce.fftSize,Ce.audioTrackConstraints=me.audioTrackConstraints,Ce.smoothingTimeConstant=me.smoothingTimeConstant||0,Ce.includeSpectrogram=me.includeSpectrogram!==!1,Ce.includeWaveform=me.includeWaveform===!0,!Ce.includeSpectrogram&&!Ce.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return Ce}return U(Se,$t),Se.prototype.summary=function(){return"microphone"},Se.create=function(me){return me===void 0&&(me={}),j(this,void 0,void 0,function(){var Ce;return N(this,function(Me){switch(Me.label){case 0:if(Object(S.env)().get("IS_NODE"))throw new Error("microphone API is only supported in browser environment.");return[4,(Ce=new Se(me)).start()];case 1:return Me.sent(),[2,Ce]}})})},Se.prototype.start=function(){return j(this,void 0,void 0,function(){var me,Ce,Me,rt;return N(this,function(kt){switch(kt.label){case 0:return kt.trys.push([0,2,,3]),me=this,[4,navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null||this.audioTrackConstraints,video:!1})];case 1:return me.stream=kt.sent(),[3,3];case 2:throw Ce=kt.sent(),new Error("Error thrown while initializing video stream: "+Ce.message);case 3:if(!this.stream)throw new Error("Could not obtain audio from microphone.");if(Me=window.AudioContext||window.webkitAudioContext,this.audioContext=new Me,this.sampleRateHz){if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error("Mismatch in sampling rate: Expected: "+this.sampleRateHz+"; Actual: "+this.audioContext.sampleRate)}else this.sampleRateHz=this.audioContext.sampleRate;return rt=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,rt.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),[2]}})})},Se.prototype.next=function(){return j(this,void 0,void 0,function(){var me,Ce,Me,rt,kt;return N(this,function(en){switch(en.label){case 0:return this.isClosed?[2,{value:null,done:!0}]:[4,this.getAudioData()];case 1:return Me=en.sent(),this.includeSpectrogram&&(rt=this.flattenQueue(Me.freqDataQueue),me=this.getTensorFromAudioDataArray(rt,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(kt=this.flattenQueue(Me.timeDataQueue),Ce=this.getTensorFromAudioDataArray(kt,[this.numFrames*this.fftSize,1])),[2,{value:{spectrogram:me,waveform:Ce},done:!1}]}})})},Se.prototype.capture=function(){return j(this,void 0,void 0,function(){return N(this,function(me){switch(me.label){case 0:return[4,this.next()];case 1:return[2,me.sent().value]}})})},Se.prototype.getAudioData=function(){return j(this,void 0,void 0,function(){var me,Ce,Me,rt=this;return N(this,function(kt){return me=[],Ce=[],Me=0,[2,new Promise(function(en){var En=setInterval(function(){rt.includeSpectrogram&&(rt.analyser.getFloatFrequencyData(rt.freqData),rt.freqData[0]===-1/0&&en({freqDataQueue:me,timeDataQueue:Ce}),me.push(rt.freqData.slice(0,rt.columnTruncateLength))),rt.includeWaveform&&(rt.analyser.getFloatTimeDomainData(rt.timeData),Ce.push(rt.timeData.slice())),++Me===rt.numFrames&&(clearInterval(En),en({freqDataQueue:me,timeDataQueue:Ce}))},rt.fftSize/rt.sampleRateHz*1e3)})]})})},Se.prototype.stop=function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())},Se.prototype.toArray=function(){throw new Error("Can not convert infinite audio stream to array.")},Se.prototype.getSampleRate=function(){return this.sampleRateHz},Se.prototype.flattenQueue=function(me){var Ce=me[0].length,Me=new Float32Array(me.length*Ce);return me.forEach(function(rt,kt){return Me.set(rt,kt*Ce)}),Me},Se.prototype.getTensorFromAudioDataArray=function(me,Ce){var Me=new Float32Array(S.util.sizeFromShape(Ce));return Me.set(me,Me.length-me.length),Object(S.tensor)(Me,Ce)},Se}(Mt),Zt=function($t){function Se(me,Ce){var Me=$t.call(this)||this;if(Me.webcamVideoElement=me,Me.webcamConfig=Ce,Me.isClosed=!0,Me.resize=!1,Me.needToResize())if(Me.resize=!0,Me.cropSize=[Me.webcamConfig.resizeHeight,Me.webcamConfig.resizeWidth],Me.cropBoxInd=Object(S.tensor1d)([0],"int32"),Me.webcamConfig.centerCrop){var rt=1*Me.webcamConfig.resizeWidth/Me.webcamVideoElement.width,kt=1*Me.webcamConfig.resizeHeight/Me.webcamVideoElement.height,en=(1-rt)/2,En=(1-kt)/2,Nt=en+rt,Kt=kt+En;Me.cropBox=Object(S.tensor2d)([En,en,Kt,Nt],[1,4])}else Me.cropBox=Object(S.tensor2d)([0,0,1,1],[1,4]);return Me}return U(Se,$t),Se.prototype.summary=function(){return"webcam"},Se.create=function(me,Ce){return Ce===void 0&&(Ce={}),j(this,void 0,void 0,function(){var Me;return N(this,function(rt){switch(rt.label){case 0:if(Object(S.env)().get("IS_NODE"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!me){if(me=document.createElement("video"),!Ce.resizeWidth||!Ce.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");me.width=Ce.resizeWidth,me.height=Ce.resizeHeight}return[4,(Me=new Se(me,Ce)).start()];case 1:return rt.sent(),[2,Me]}})})},Se.prototype.start=function(){return j(this,void 0,void 0,function(){var me,Ce,Me=this;return N(this,function(rt){switch(rt.label){case 0:this.webcamConfig.facingMode&&S.util.assert(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",function(){return"Invalid webcam facing mode: "+Me.webcamConfig.facingMode+". Please provide 'user' or 'environment'"}),rt.label=1;case 1:return rt.trys.push([1,3,,4]),me=this,[4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})];case 2:return me.stream=rt.sent(),[3,4];case 3:throw(Ce=rt.sent()).message="Error thrown while initializing video stream: "+Ce.message,Ce;case 4:if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(kt){console.log(kt),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,[2,new Promise(function(kt){Me.webcamVideoElement.onloadedmetadata=function(){kt()}})]}})})},Se.prototype.next=function(){return j(this,void 0,void 0,function(){var me;return N(this,function(Ce){if(this.isClosed)return[2,{value:null,done:!0}];try{me=S.browser.fromPixels(this.webcamVideoElement)}catch(Me){throw new Error("Error thrown converting video to pixels: "+JSON.stringify(Me))}if(!this.resize)return[2,{value:me,done:!1}];try{return[2,{value:this.cropAndResizeFrame(me),done:!1}]}catch(Me){throw new Error("Error thrown cropping the video: "+Me.message)}finally{me.dispose()}return[2]})})},Se.prototype.needToResize=function(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)},Se.prototype.cropAndResizeFrame=function(me){var Ce=this;return Object(S.tidy)(function(){var Me,rt=me.toFloat().expandDims(0),kt=(Me=S.image.cropAndResize(rt,Ce.cropBox,Ce.cropBoxInd,Ce.cropSize,"bilinear")).shape;return Me.reshape(kt.slice(1))})},Se.prototype.capture=function(){return j(this,void 0,void 0,function(){return N(this,function(me){switch(me.label){case 0:return[4,this.next()];case 1:return[2,me.sent().value]}})})},Se.prototype.stop=function(){this.stream.getTracks().forEach(function(me){return me.stop()});try{this.webcamVideoElement.srcObject=null}catch(me){console.log(me),this.webcamVideoElement.src=null}this.isClosed=!0},Se.prototype.toArray=function(){throw new Error("Can not convert infinite video stream to array.")},Se}(Mt),Vn=function(){},xn=function($t){function Se(){return $t!==null&&$t.apply(this,arguments)||this}return U(Se,$t),Se.prototype.split=function(me){return new Un(this,me)},Se}(Mt),Un=function($t){function Se(me,Ce){var Me=$t.call(this)||this;return Me.upstream=me,Me.impl=new ur(me,Ce),Me}return U(Se,$t),Se.prototype.summary=function(){return this.impl.summary()},Se.prototype.next=function(){return j(this,void 0,void 0,function(){return N(this,function(me){return[2,this.impl.next()]})})},Se}(xn),ur=function($t){function Se(me,Ce){var Me=$t.call(this)||this;return Me.upstream=me,Me.separator=Ce,Me.carryover="",Me}return U(Se,$t),Se.prototype.summary=function(){return this.upstream.summary()+" -> Split('"+this.separator+"')"},Se.prototype.pump=function(){return j(this,void 0,void 0,function(){var me,Ce,Me,rt,kt;return N(this,function(en){switch(en.label){case 0:return[4,this.upstream.next()];case 1:if((me=en.sent()).done)return this.carryover===""?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);for((Ce=me.value.split(this.separator))[0]=this.carryover+Ce[0],Me=0,rt=Ce.slice(0,-1);Me<rt.length;Me++)kt=rt[Me],this.outputQueue.push(kt);return this.carryover=Ce[Ce.length-1],[2,!0]}})})},Se}(Rn),sr=function($t){function Se(){return $t!==null&&$t.apply(this,arguments)||this}return U(Se,$t),Se.prototype.decodeUTF8=function(){return new Er(this)},Se}(Mt),Er=function($t){function Se(me){var Ce=$t.call(this)||this;return Ce.upstream=me,Ce.impl=new Mr(me),Ce}return U(Se,$t),Se.prototype.summary=function(){return this.impl.summary()},Se.prototype.next=function(){return j(this,void 0,void 0,function(){return N(this,function(me){return[2,this.impl.next()]})})},Se}(xn),Mr=function($t){function Se(me){var Ce=$t.call(this)||this;if(Ce.upstream=me,Object(S.env)().get("IS_BROWSER"))Ce.decoder=new TextDecoder("utf-8");else{var Me=r(386).StringDecoder;Ce.decoder=new Me("utf8")}return Ce}return U(Se,$t),Se.prototype.summary=function(){return this.upstream.summary()+" -> Utf8"},Se.prototype.pump=function(){return j(this,void 0,void 0,function(){var me,Ce,Me;return N(this,function(rt){switch(rt.label){case 0:return[4,this.upstream.next()];case 1:return(me=rt.sent()).done?[2,!1]:(Ce=me.value,Me=Object(S.env)().get("IS_BROWSER")?this.decoder.decode(Ce,{stream:!0}):this.decoder.write(C.from(Ce.buffer)),this.outputQueue.push(Me),[2,!0])}})})},Se}(Rn),pr=function($t){function Se(me,Ce){Ce===void 0&&(Ce={});var Me=$t.call(this)||this;return Me.file=me,Me.options=Ce,S.util.assert(me instanceof Uint8Array||!!Object(S.env)().get("IS_BROWSER")&&(me instanceof File||me instanceof Blob),function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."}),Me.offset=Ce.offset||0,Me.chunkSize=Ce.chunkSize||1048576,Me}return U(Se,$t),Se.prototype.summary=function(){return"FileChunks "+this.file},Se.prototype.next=function(){return j(this,void 0,void 0,function(){var me,Ce,Me=this;return N(this,function(rt){switch(rt.label){case 0:return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?[2,{value:null,done:!0}]:(me=new Promise(function(kt,en){var En=Me.offset+Me.chunkSize;if(Me.file instanceof Uint8Array)kt(new Uint8Array(Me.file.slice(Me.offset,En)));else{var Nt=new FileReader;Nt.onload=function(hn){var un=Nt.result;if(un instanceof ArrayBuffer&&(un=new Uint8Array(un)),!(un instanceof Uint8Array))return en(new TypeError("FileReader returned unknown type."));kt(un)},Nt.onabort=function(hn){return en(new Error("Aborted"))},Nt.onerror=function(hn){return en(new Error(hn.type))};var Kt=Me.file.slice(Me.offset,En);Nt.readAsArrayBuffer(Kt)}Me.offset=En}),Ce={},[4,me]);case 1:return[2,(Ce.value=rt.sent(),Ce.done=!1,Ce)]}})})},Se}(sr),ri=function($t){return{method:$t.method,headers:$t.headers,body:$t.body,mode:$t.mode,credentials:$t.credentials,cache:$t.cache,redirect:$t.redirect,referrer:$t.referrer,integrity:$t.integrity}};function Kr($t){return typeof $t=="string"&&$t.substr(0,7)==="file://"}var ti=function($t){function Se(me,Ce){Ce===void 0&&(Ce={});var Me=$t.call(this)||this;return Me.input=me,Me.options=Ce,Me}return U(Se,$t),Se.prototype.iterator=function(){return j(this,void 0,void 0,function(){var me;return N(this,function(Ce){return Kr(this.input)&&Object(S.env)().get("IS_NODE")&&(me=r(385),this.input=me.readFileSync(this.input.substr(7))),[2,new pr(this.input,this.options)]})})},Se}(Vn),jn=function($t){function Se(me,Ce){Ce===void 0&&(Ce={});var Me=$t.call(this)||this;return Me.url=me,Me.fileOptions=Ce,Me}return U(Se,$t),Se.prototype.iterator=function(){return j(this,void 0,void 0,function(){return N(this,function(me){return Kr(this.url)?[2,new ti(this.url,this.fileOptions).iterator()]:[2,function(Ce,Me){return Me===void 0&&(Me={}),j(this,void 0,void 0,function(){var rt,kt,en,En,Nt;return N(this,function(Kt){switch(Kt.label){case 0:return typeof Ce=="string"?rt=Ce:(rt=Ce.url,kt=ri(Ce)),[4,S.util.fetch(rt,kt)];case 1:return(en=Kt.sent()).ok?(Nt=Uint8Array.bind,[4,en.arrayBuffer()]):[3,3];case 2:return En=new(Nt.apply(Uint8Array,[void 0,Kt.sent()])),[2,new pr(En,Me)];case 3:throw new Error(en.statusText)}})})}(this.url,this.fileOptions)]})})},Se}(Vn);function ir($t,Se){return Se===void 0&&(Se={}),new Xt(new jn($t),Se)}function Cr($t){var Se=this,me=bt($t);return Qt(function(){return j(Se,void 0,void 0,function(){return N(this,function(Ce){return[2,me]})})})}function Hr($t){var Se=this;return Qt(function(){return j(Se,void 0,void 0,function(){var me;return N(this,function(Ce){switch(Ce.label){case 0:return[4,$t()];case 1:return me=Ce.sent(),[2,bt(function(){return me.next()})]}})})})}function qr($t,Se){return j(this,void 0,void 0,function(){return N(this,function(me){return[2,Zt.create($t,Se)]})})}function Ot($t){return j(this,void 0,void 0,function(){return N(this,function(Se){return[2,Wt.create($t)]})})}var Fr="1.7.4"}.call(this,r(59),r(92).Buffer)},function(u,s,r){function l(C){var S="";if(!C)try{C=r(185)}catch(O){S=O.toString()}return{readFile:C?function(O){return new Promise(function(U,j){C.readFile(O,function(N,L){return N?j(N):U(L)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+S)}}}r.d(s,"a",function(){return l})},function(u){u.exports={a:"0.12.2"}},function(u,s,r){var l=/("(?:[^\\"]|\\.)*")|[:,]/g;u.exports=function(C,S){var O,U,j;return S=S||{},O=JSON.stringify([1],void 0,S.indent===void 0?2:S.indent).slice(2,-3),U=O===""?1/0:S.maxLength===void 0?80:S.maxLength,j=S.replacer,function N(L,W,z){var q,I,Z,Y,G,oe,ce,be,Ee,ve,ge,Ge;if(L&&typeof L.toJSON=="function"&&(L=L.toJSON()),(ge=JSON.stringify(L,j))===void 0)return ge;if(ce=U-W.length-z,ge.length<=ce&&(Ee=ge.replace(l,function(ht,It){return It||ht+" "})).length<=ce)return Ee;if(j!=null&&(L=JSON.parse(ge),j=void 0),typeof L=="object"&&L!==null){if(be=W+O,Z=[],I=0,Array.isArray(L))for(ve="[",q="]",ce=L.length;I<ce;I++)Z.push(N(L[I],be,I===ce-1?0:1)||"null");else for(ve="{",q="}",ce=(oe=Object.keys(L)).length;I<ce;I++)Y=oe[I],G=JSON.stringify(Y)+": ",(Ge=N(L[Y],be,G.length+(I===ce-1?0:1)))!==void 0&&Z.push(G+Ge);if(Z.length>0)return[ve,O+Z.join(`,
`+be),q].join(`
`+W)}return ge}(C,"",0)}},function(u,s,r){var l=r(31),C=Object(l.a)(function(S){S.setUTCDate(1),S.setUTCHours(0,0,0,0)},function(S,O){S.setUTCMonth(S.getUTCMonth()+O)},function(S,O){return O.getUTCMonth()-S.getUTCMonth()+12*(O.getUTCFullYear()-S.getUTCFullYear())},function(S){return S.getUTCMonth()});s.a=C,C.range},function(u,s,r){var l=r(31),C=Object(l.a)(function(S){S.setDate(1),S.setHours(0,0,0,0)},function(S,O){S.setMonth(S.getMonth()+O)},function(S,O){return O.getMonth()-S.getMonth()+12*(O.getFullYear()-S.getFullYear())},function(S){return S.getMonth()});s.a=C,C.range},function(u,s,r){(function(l){var C=r(36),S=r(275),O=r(193),U={"Content-Type":"application/x-www-form-urlencoded"};function j(L,W){!C.isUndefined(L)&&C.isUndefined(L["Content-Type"])&&(L["Content-Type"]=W)}var N={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:function(){var L;return(typeof XMLHttpRequest<"u"||l!==void 0&&Object.prototype.toString.call(l)==="[object process]")&&(L=r(192)),L}(),transformRequest:[function(L,W){return S(W,"Accept"),S(W,"Content-Type"),C.isFormData(L)||C.isArrayBuffer(L)||C.isBuffer(L)||C.isStream(L)||C.isFile(L)||C.isBlob(L)?L:C.isArrayBufferView(L)?L.buffer:C.isURLSearchParams(L)?(j(W,"application/x-www-form-urlencoded;charset=utf-8"),L.toString()):C.isObject(L)||W&&W["Content-Type"]==="application/json"?(j(W,"application/json"),function(z,q,I){if(C.isString(z))try{return(q||JSON.parse)(z),C.trim(z)}catch(Z){if(Z.name!=="SyntaxError")throw Z}return(I||JSON.stringify)(z)}(L)):L}],transformResponse:[function(L){var W=this.transitional,z=W&&W.silentJSONParsing,q=W&&W.forcedJSONParsing,I=!z&&this.responseType==="json";if(I||q&&C.isString(L)&&L.length)try{return JSON.parse(L)}catch(Z){if(I)throw Z.name==="SyntaxError"?O(Z,this,"E_JSON_PARSE"):Z}return L}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(L){return L>=200&&L<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};C.forEach(["delete","get","head"],function(L){N.headers[L]={}}),C.forEach(["post","put","patch"],function(L){N.headers[L]=C.merge(U)}),u.exports=N}).call(this,r(75))},function(u,s,r){var l=this&&this.__awaiter||function(W,z,q,I){return new(q||(q=Promise))(function(Z,Y){function G(be){try{ce(I.next(be))}catch(Ee){Y(Ee)}}function oe(be){try{ce(I.throw(be))}catch(Ee){Y(Ee)}}function ce(be){be.done?Z(be.value):new q(function(Ee){Ee(be.value)}).then(G,oe)}ce((I=I.apply(W,z||[])).next())})},C=this&&this.__importDefault||function(W){return W&&W.__esModule?W:{default:W}};Object.defineProperty(s,"__esModule",{value:!0});const S=r(50),O=C(r(88)),U=r(64),j=r(110),N=r(109),L={maxBins:12,fontSize:11};s.histogram=function(W,z,q={}){return l(this,void 0,void 0,function*(){const I=function(ce){if(ce.length==null)throw new Error("input data must be an array");if(ce.length===0)return[];if(typeof ce[0]=="object"){if(ce[0].value==null)throw new Error("input data must have a value field");return ce}{const be=Array(ce.length);for(let Ee=0;Ee<ce.length;Ee++)be[Ee]={value:ce[Ee]};return be}}(z),Z=Object.assign({},L,q),Y=U.subSurface(W,"histogram");if(q.stats!==!1){const ce=U.subSurface(W,"stats",{prepend:!0});(function(be,Ee,ve){const ge=S.format(",.4~f"),Ge=S.format(".4~p"),ht=[],It=[];if(be.numVals!=null&&(ht.push("Num Vals"),It.push(ge(be.numVals))),be.min!=null&&(ht.push("Min"),It.push(ge(be.min))),be.max!=null&&(ht.push("Max"),It.push(ge(be.max))),be.numZeros!=null){ht.push("# Zeros");let St="";be.numVals&&(St=be.numZeros>0?`(${Ge(be.numZeros/be.numVals)})`:""),It.push(`${ge(be.numZeros)} ${St}`)}if(be.numNans!=null){ht.push("# NaNs");let St="";be.numVals&&(St=be.numNans>0?`(${Ge(be.numNans/be.numVals)})`:""),It.push(`${ge(be.numNans)} ${St}`)}if(be.numInfs!=null){ht.push("# Infinity");let St="";be.numVals&&(St=be.numInfs>0?`(${Ge(be.numInfs/be.numVals)})`:""),It.push(`${ge(be.numInfs)} ${St}`)}N.table(Ee,{headers:ht,values:[It]},ve)})(q.stats?q.stats:j.arrayStats(I.map(be=>be.value)),ce,{fontSize:Z.fontSize})}if(I.length===0)return;const G=[];for(let ce=0;ce<I.length;ce++){const be=I[ce].value;be!=null&&isFinite(be)&&G.push(I[ce])}const oe={width:Z.width||U.getDefaultWidth(Y),height:Z.height||U.getDefaultHeight(Y),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},data:{values:G},mark:{type:"bar",tooltip:!0},config:{axis:{labelFontSize:Z.fontSize,titleFontSize:Z.fontSize},text:{fontSize:Z.fontSize},legend:{labelFontSize:Z.fontSize,titleFontSize:Z.fontSize}},encoding:{x:{bin:{maxbins:Z.maxBins},field:"value",type:"quantitative"},y:{aggregate:"count",type:"quantitative"},color:{value:Z.color||"#001B44"}}};return O.default(Y,oe,{actions:!1,mode:"vega-lite",defaultStyle:!1})})}},function(u,s,r){r.r(s),r.d(s,"h",function(){return O}),r.d(s,"createElement",function(){return O}),r.d(s,"cloneElement",function(){return N}),r.d(s,"Component",function(){return pt}),r.d(s,"render",function(){return yt}),r.d(s,"rerender",function(){return q}),r.d(s,"options",function(){return l});var l={},C=[],S=[];function O(xt,_t){var Yt,Fn,Rn,cn,qe=S;for(cn=arguments.length;cn-- >2;)C.push(arguments[cn]);for(_t&&_t.children!=null&&(C.length||C.push(_t.children),delete _t.children);C.length;)if((Fn=C.pop())&&Fn.pop!==void 0)for(cn=Fn.length;cn--;)C.push(Fn[cn]);else typeof Fn=="boolean"&&(Fn=null),(Rn=typeof xt!="function")&&(Fn==null?Fn="":typeof Fn=="number"?Fn=String(Fn):typeof Fn!="string"&&(Rn=!1)),Rn&&Yt?qe[qe.length-1]+=Fn:qe===S?qe=[Fn]:qe.push(Fn),Yt=Rn;var Qe=new function(){};return Qe.nodeName=xt,Qe.children=qe,Qe.attributes=_t??void 0,Qe.key=_t==null?void 0:_t.key,l.vnode!==void 0&&l.vnode(Qe),Qe}function U(xt,_t){for(var Yt in _t)xt[Yt]=_t[Yt];return xt}var j=typeof Promise=="function"?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function N(xt,_t){return O(xt.nodeName,U(U({},xt.attributes),_t),arguments.length>2?[].slice.call(arguments,2):xt.children)}var L=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,W=[];function z(xt){!xt._dirty&&(xt._dirty=!0)&&W.push(xt)==1&&(l.debounceRendering||j)(q)}function q(){var xt,_t=W;for(W=[];xt=_t.pop();)xt._dirty&&Ut(xt)}function I(xt,_t,Yt){return typeof _t=="string"||typeof _t=="number"?xt.splitText!==void 0:typeof _t.nodeName=="string"?!xt._componentConstructor&&Z(xt,_t.nodeName):Yt||xt._componentConstructor===_t.nodeName}function Z(xt,_t){return xt.normalizedNodeName===_t||xt.nodeName.toLowerCase()===_t.toLowerCase()}function Y(xt){var _t=U({},xt.attributes);_t.children=xt.children;var Yt=xt.nodeName.defaultProps;if(Yt!==void 0)for(var Fn in Yt)_t[Fn]===void 0&&(_t[Fn]=Yt[Fn]);return _t}function G(xt){var _t=xt.parentNode;_t&&_t.removeChild(xt)}function oe(xt,_t,Yt,Fn,Rn){if(_t==="className"&&(_t="class"),_t!=="key")if(_t==="ref")Yt&&Yt(null),Fn&&Fn(xt);else if(_t!=="class"||Rn)if(_t==="style"){if(Fn&&typeof Fn!="string"&&typeof Yt!="string"||(xt.style.cssText=Fn||""),Fn&&typeof Fn=="object"){if(typeof Yt!="string")for(var cn in Yt)cn in Fn||(xt.style[cn]="");for(var cn in Fn)xt.style[cn]=typeof Fn[cn]=="number"&&L.test(cn)===!1?Fn[cn]+"px":Fn[cn]}}else if(_t==="dangerouslySetInnerHTML")Fn&&(xt.innerHTML=Fn.__html||"");else if(_t[0]=="o"&&_t[1]=="n"){var qe=_t!==(_t=_t.replace(/Capture$/,""));_t=_t.toLowerCase().substring(2),Fn?Yt||xt.addEventListener(_t,ce,qe):xt.removeEventListener(_t,ce,qe),(xt._listeners||(xt._listeners={}))[_t]=Fn}else if(_t!=="list"&&_t!=="type"&&!Rn&&_t in xt)(function($e,ft,Jt){try{$e[ft]=Jt}catch{}})(xt,_t,Fn??""),Fn!=null&&Fn!==!1||xt.removeAttribute(_t);else{var Qe=Rn&&_t!==(_t=_t.replace(/^xlink:?/,""));Fn==null||Fn===!1?Qe?xt.removeAttributeNS("http://www.w3.org/1999/xlink",_t.toLowerCase()):xt.removeAttribute(_t):typeof Fn!="function"&&(Qe?xt.setAttributeNS("http://www.w3.org/1999/xlink",_t.toLowerCase(),Fn):xt.setAttribute(_t,Fn))}else xt.className=Fn||""}function ce(xt){return this._listeners[xt.type](l.event&&l.event(xt)||xt)}var be=[],Ee=0,ve=!1,ge=!1;function Ge(){for(var xt;xt=be.pop();)l.afterMount&&l.afterMount(xt),xt.componentDidMount&&xt.componentDidMount()}function ht(xt,_t,Yt,Fn,Rn,cn){Ee++||(ve=Rn!=null&&Rn.ownerSVGElement!==void 0,ge=xt!=null&&!("__preactattr_"in xt));var qe=It(xt,_t,Yt,Fn,cn);return Rn&&qe.parentNode!==Rn&&Rn.appendChild(qe),--Ee||(ge=!1,cn||Ge()),qe}function It(xt,_t,Yt,Fn,Rn){var cn=xt,qe=ve;if(_t!=null&&typeof _t!="boolean"||(_t=""),typeof _t=="string"||typeof _t=="number")return xt&&xt.splitText!==void 0&&xt.parentNode&&(!xt._component||Rn)?xt.nodeValue!=_t&&(xt.nodeValue=_t):(cn=document.createTextNode(_t),xt&&(xt.parentNode&&xt.parentNode.replaceChild(cn,xt),St(xt,!0))),cn.__preactattr_=!0,cn;var Qe=_t.nodeName;if(typeof Qe=="function")return function(kn,Qn,ke,ar){for(var Tr=kn&&kn._component,rn=Tr,Ht=kn,Gn=Tr&&kn._componentConstructor===Qn.nodeName,Xt=Gn,Wt=Y(Qn);Tr&&!Xt&&(Tr=Tr._parentComponent);)Xt=Tr.constructor===Qn.nodeName;return Tr&&Xt&&(!ar||Tr._component)?(ze(Tr,Wt,3,ke,ar),kn=Tr.base):(rn&&!Gn&&(Ft(rn),kn=Ht=null),Tr=jt(Qn.nodeName,Wt,ke),kn&&!Tr.nextBase&&(Tr.nextBase=kn,Ht=null),ze(Tr,Wt,1,ke,ar),kn=Tr.base,Ht&&kn!==Ht&&(Ht._component=null,St(Ht,!1))),kn}(xt,_t,Yt,Fn);if(ve=Qe==="svg"||Qe!=="foreignObject"&&ve,Qe=String(Qe),(!xt||!Z(xt,Qe))&&(cn=function(kn,Qn){var ke=Qn?document.createElementNS("http://www.w3.org/2000/svg",kn):document.createElement(kn);return ke.normalizedNodeName=kn,ke}(Qe,ve),xt)){for(;xt.firstChild;)cn.appendChild(xt.firstChild);xt.parentNode&&xt.parentNode.replaceChild(cn,xt),St(xt,!0)}var $e=cn.firstChild,ft=cn.__preactattr_,Jt=_t.children;if(ft==null){ft=cn.__preactattr_={};for(var Qt=cn.attributes,Pn=Qt.length;Pn--;)ft[Qt[Pn].name]=Qt[Pn].value}return!ge&&Jt&&Jt.length===1&&typeof Jt[0]=="string"&&$e!=null&&$e.splitText!==void 0&&$e.nextSibling==null?$e.nodeValue!=Jt[0]&&($e.nodeValue=Jt[0]):(Jt&&Jt.length||$e!=null)&&function(kn,Qn,ke,ar,Tr){var rn,Ht,Gn,Xt,Wt,Zt=kn.childNodes,Vn=[],xn={},Un=0,ur=0,sr=Zt.length,Er=0,Mr=Qn?Qn.length:0;if(sr!==0)for(var pr=0;pr<sr;pr++){var ri=Zt[pr],Kr=ri.__preactattr_,ti=Mr&&Kr?ri._component?ri._component.__key:Kr.key:null;ti!=null?(Un++,xn[ti]=ri):(Kr||(ri.splitText!==void 0?!Tr||ri.nodeValue.trim():Tr))&&(Vn[Er++]=ri)}if(Mr!==0)for(var pr=0;pr<Mr;pr++){Xt=Qn[pr],Wt=null;var ti=Xt.key;if(ti!=null)Un&&xn[ti]!==void 0&&(Wt=xn[ti],xn[ti]=void 0,Un--);else if(!Wt&&ur<Er){for(rn=ur;rn<Er;rn++)if(Vn[rn]!==void 0&&I(Ht=Vn[rn],Xt,Tr)){Wt=Ht,Vn[rn]=void 0,rn===Er-1&&Er--,rn===ur&&ur++;break}}Wt=It(Wt,Xt,ke,ar),Gn=Zt[pr],Wt&&Wt!==kn&&Wt!==Gn&&(Gn==null?kn.appendChild(Wt):Wt===Gn.nextSibling?G(Gn):kn.insertBefore(Wt,Gn))}if(Un)for(var pr in xn)xn[pr]!==void 0&&St(xn[pr],!1);for(;ur<=Er;)(Wt=Vn[Er--])!==void 0&&St(Wt,!1)}(cn,Jt,Yt,Fn,ge||ft.dangerouslySetInnerHTML!=null),function(kn,Qn,ke){var ar;for(ar in ke)Qn&&Qn[ar]!=null||ke[ar]==null||oe(kn,ar,ke[ar],ke[ar]=void 0,ve);for(ar in Qn)ar==="children"||ar==="innerHTML"||ar in ke&&Qn[ar]===(ar==="value"||ar==="checked"?kn[ar]:ke[ar])||oe(kn,ar,ke[ar],ke[ar]=Qn[ar],ve)}(cn,_t.attributes,ft),ve=qe,cn}function St(xt,_t){var Yt=xt._component;Yt?Ft(Yt):(xt.__preactattr_!=null&&xt.__preactattr_.ref&&xt.__preactattr_.ref(null),_t!==!1&&xt.__preactattr_!=null||G(xt),we(xt))}function we(xt){for(xt=xt.lastChild;xt;){var _t=xt.previousSibling;St(xt,!0),xt=_t}}var bt={};function jt(xt,_t,Yt){var Fn,Rn=bt[xt.name];if(xt.prototype&&xt.prototype.render?(Fn=new xt(_t,Yt),pt.call(Fn,_t,Yt)):((Fn=new pt(_t,Yt)).constructor=xt,Fn.render=Mt),Rn){for(var cn=Rn.length;cn--;)if(Rn[cn].constructor===xt){Fn.nextBase=Rn[cn].nextBase,Rn.splice(cn,1);break}}return Fn}function Mt(xt,_t,Yt){return this.constructor(xt,Yt)}function ze(xt,_t,Yt,Fn,Rn){xt._disable||(xt._disable=!0,(xt.__ref=_t.ref)&&delete _t.ref,(xt.__key=_t.key)&&delete _t.key,!xt.base||Rn?xt.componentWillMount&&xt.componentWillMount():xt.componentWillReceiveProps&&xt.componentWillReceiveProps(_t,Fn),Fn&&Fn!==xt.context&&(xt.prevContext||(xt.prevContext=xt.context),xt.context=Fn),xt.prevProps||(xt.prevProps=xt.props),xt.props=_t,xt._disable=!1,Yt!==0&&(Yt!==1&&l.syncComponentUpdates===!1&&xt.base?z(xt):Ut(xt,1,Rn)),xt.__ref&&xt.__ref(xt))}function Ut(xt,_t,Yt,Fn){if(!xt._disable){var Rn,cn,qe,Qe=xt.props,$e=xt.state,ft=xt.context,Jt=xt.prevProps||Qe,Qt=xt.prevState||$e,Pn=xt.prevContext||ft,kn=xt.base,Qn=xt.nextBase,ke=kn||Qn,ar=xt._component,Tr=!1;if(kn&&(xt.props=Jt,xt.state=Qt,xt.context=Pn,_t!==2&&xt.shouldComponentUpdate&&xt.shouldComponentUpdate(Qe,$e,ft)===!1?Tr=!0:xt.componentWillUpdate&&xt.componentWillUpdate(Qe,$e,ft),xt.props=Qe,xt.state=$e,xt.context=ft),xt.prevProps=xt.prevState=xt.prevContext=xt.nextBase=null,xt._dirty=!1,!Tr){Rn=xt.render(Qe,$e,ft),xt.getChildContext&&(ft=U(U({},ft),xt.getChildContext()));var rn,Ht,Gn=Rn&&Rn.nodeName;if(typeof Gn=="function"){var Xt=Y(Rn);(cn=ar)&&cn.constructor===Gn&&Xt.key==cn.__key?ze(cn,Xt,1,ft,!1):(rn=cn,xt._component=cn=jt(Gn,Xt,ft),cn.nextBase=cn.nextBase||Qn,cn._parentComponent=xt,ze(cn,Xt,0,ft,!1),Ut(cn,1,Yt,!0)),Ht=cn.base}else qe=ke,(rn=ar)&&(qe=xt._component=null),(ke||_t===1)&&(qe&&(qe._component=null),Ht=ht(qe,Rn,ft,Yt||!kn,ke&&ke.parentNode,!0));if(ke&&Ht!==ke&&cn!==ar){var Wt=ke.parentNode;Wt&&Ht!==Wt&&(Wt.replaceChild(Ht,ke),rn||(ke._component=null,St(ke,!1)))}if(rn&&Ft(rn),xt.base=Ht,Ht&&!Fn){for(var Zt=xt,Vn=xt;Vn=Vn._parentComponent;)(Zt=Vn).base=Ht;Ht._component=Zt,Ht._componentConstructor=Zt.constructor}}if(!kn||Yt?be.unshift(xt):Tr||(xt.componentDidUpdate&&xt.componentDidUpdate(Jt,Qt,Pn),l.afterUpdate&&l.afterUpdate(xt)),xt._renderCallbacks!=null)for(;xt._renderCallbacks.length;)xt._renderCallbacks.pop().call(xt);Ee||Fn||Ge()}}function Ft(xt){l.beforeUnmount&&l.beforeUnmount(xt);var _t=xt.base;xt._disable=!0,xt.componentWillUnmount&&xt.componentWillUnmount(),xt.base=null;var Yt=xt._component;Yt?Ft(Yt):_t&&(_t.__preactattr_&&_t.__preactattr_.ref&&_t.__preactattr_.ref(null),xt.nextBase=_t,G(_t),function(Fn){var Rn=Fn.constructor.name;(bt[Rn]||(bt[Rn]=[])).push(Fn)}(xt),we(_t)),xt.__ref&&xt.__ref(null)}function pt(xt,_t){this._dirty=!0,this.context=_t,this.props=xt,this.state=this.state||{}}function yt(xt,_t,Yt){return ht(Yt,xt,{},!1,_t,!1)}U(pt.prototype,{setState:function(xt,_t){var Yt=this.state;this.prevState||(this.prevState=U({},Yt)),U(Yt,typeof xt=="function"?xt(Yt,this.props):xt),_t&&(this._renderCallbacks=this._renderCallbacks||[]).push(_t),z(this)},forceUpdate:function(xt){xt&&(this._renderCallbacks=this._renderCallbacks||[]).push(xt),Ut(this,2)},render:function(){}});var nn={h:O,createElement:O,cloneElement:N,Component:pt,render:yt,rerender:q,options:l};s.default=nn},function(u,s,r){var l=Object.getOwnPropertySymbols,C=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;u.exports=function(){try{if(!Object.assign)return!1;var O=new String("abc");if(O[5]="de",Object.getOwnPropertyNames(O)[0]==="5")return!1;for(var U={},j=0;j<10;j++)U["_"+String.fromCharCode(j)]=j;if(Object.getOwnPropertyNames(U).map(function(L){return U[L]}).join("")!=="0123456789")return!1;var N={};return"abcdefghijklmnopqrst".split("").forEach(function(L){N[L]=L}),Object.keys(Object.assign({},N)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}()?Object.assign:function(O,U){for(var j,N,L=function(I){if(I==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(I)}(O),W=1;W<arguments.length;W++){for(var z in j=Object(arguments[W]))C.call(j,z)&&(L[z]=j[z]);if(l){N=l(j);for(var q=0;q<N.length;q++)S.call(j,N[q])&&(L[N[q]]=j[N[q]])}}return L}},function(u,s,r){const l=r(32),C=r(113),{ANY:S}=C,O=r(47),U=r(112),j=r(114),N=r(143),L=r(141),W=r(142);u.exports=(z,q,I,Z)=>{let Y,G,oe,ce,be;switch(z=new l(z,Z),q=new O(q,Z),I){case">":Y=j,G=L,oe=N,ce=">",be=">=";break;case"<":Y=N,G=W,oe=j,ce="<",be="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(U(z,q,Z))return!1;for(let Ee=0;Ee<q.set.length;++Ee){let ve=null,ge=null;if(q.set[Ee].forEach(Ge=>{Ge.semver===S&&(Ge=new C(">=0.0.0")),ve=ve||Ge,ge=ge||Ge,Y(Ge.semver,ve.semver,Z)?ve=Ge:oe(Ge.semver,ge.semver,Z)&&(ge=Ge)}),ve.operator===ce||ve.operator===be||(!ge.operator||ge.operator===ce)&&G(z,ge.semver)||ge.operator===be&&oe(z,ge.semver))return!1}return!0}},function(u,s,r){const l=r(48);u.exports=(C,S,O)=>l(C,S,O)<=0},function(u,s,r){const l=r(48);u.exports=(C,S,O)=>l(C,S,O)>=0},function(u,s,r){const l=r(48);u.exports=(C,S,O)=>l(C,S,O)<0},function(u,s,r){const l=r(32);u.exports=(C,S,O)=>{const U=new l(C,O),j=new l(S,O);return U.compare(j)||U.compareBuild(j)}},function(u,s,r){const l=r(48);u.exports=(C,S,O)=>l(C,S,O)===0},function(u,s){const r=/^[0-9]+$/,l=(C,S)=>{const O=r.test(C),U=r.test(S);return O&&U&&(C=+C,S=+S),C===S?0:O&&!U?-1:U&&!O?1:C<S?-1:1};u.exports={compareIdentifiers:l,rcompareIdentifiers:(C,S)=>l(S,C)}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.getBroadcastDims=function(l,C){for(var S=l.length,O=[],U=0;U<S;U++){var j=S-1-U,N=l[j]||1;(C[C.length-1-U]||1)>1&&N===1&&O.unshift(j)}return O},s.getReductionAxes=function(l,C){for(var S=[],O=0;O<C.length;O++){var U=l[l.length-O-1],j=C.length-O-1,N=C[j];(U==null||U===1&&N>1)&&S.unshift(j)}return S},s.assertAndGetBroadcastShape=function(l,C){for(var S=[],O=Math.max(l.length,C.length),U=0;U<O;U++){var j=l[l.length-U-1];j==null&&(j=1);var N=C[C.length-U-1];if(N==null&&(N=1),j===1)S.unshift(N);else if(N===1)S.unshift(j);else{if(j!==N)throw Error("Operands could not be broadcast together with shapes "+l+" and "+C+".");S.unshift(j)}}return S}},function(u,s,r){u.exports=!r(208)(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7})},function(u,s){u.exports=function(r){return typeof r=="object"?r!==null:typeof r=="function"}},function(u,s){var r=u.exports=typeof window<"u"&&window.Math==Math?window:typeof self<"u"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=r)},function(u,s,r){var l=r(16),C=r(27),S=r(83),O=r(118),U=r(42),j=r(93),N=r(15),L=r(94),W=r(54),z=r(22),q=r(213),I=r(79).f,Z=r(26).f,Y=r(156),G=r(98),oe="prototype",ce="Wrong index!",be=l.ArrayBuffer,Ee=l.DataView,ve=l.Math,ge=l.RangeError,Ge=l.Infinity,ht=be,It=ve.abs,St=ve.pow,we=ve.floor,bt=ve.log,jt=ve.LN2,Mt=C?"_b":"buffer",ze=C?"_l":"byteLength",Ut=C?"_o":"byteOffset";function Ft(kn,Qn,ke){var ar,Tr,rn,Ht=new Array(ke),Gn=8*ke-Qn-1,Xt=(1<<Gn)-1,Wt=Xt>>1,Zt=Qn===23?St(2,-24)-St(2,-77):0,Vn=0,xn=kn<0||kn===0&&1/kn<0?1:0;for((kn=It(kn))!=kn||kn===Ge?(Tr=kn!=kn?1:0,ar=Xt):(ar=we(bt(kn)/jt),kn*(rn=St(2,-ar))<1&&(ar--,rn*=2),(kn+=ar+Wt>=1?Zt/rn:Zt*St(2,1-Wt))*rn>=2&&(ar++,rn/=2),ar+Wt>=Xt?(Tr=0,ar=Xt):ar+Wt>=1?(Tr=(kn*rn-1)*St(2,Qn),ar+=Wt):(Tr=kn*St(2,Wt-1)*St(2,Qn),ar=0));Qn>=8;Ht[Vn++]=255&Tr,Tr/=256,Qn-=8);for(ar=ar<<Qn|Tr,Gn+=Qn;Gn>0;Ht[Vn++]=255&ar,ar/=256,Gn-=8);return Ht[--Vn]|=128*xn,Ht}function pt(kn,Qn,ke){var ar,Tr=8*ke-Qn-1,rn=(1<<Tr)-1,Ht=rn>>1,Gn=Tr-7,Xt=ke-1,Wt=kn[Xt--],Zt=127&Wt;for(Wt>>=7;Gn>0;Zt=256*Zt+kn[Xt],Xt--,Gn-=8);for(ar=Zt&(1<<-Gn)-1,Zt>>=-Gn,Gn+=Qn;Gn>0;ar=256*ar+kn[Xt],Xt--,Gn-=8);if(Zt===0)Zt=1-Ht;else{if(Zt===rn)return ar?NaN:Wt?-Ge:Ge;ar+=St(2,Qn),Zt-=Ht}return(Wt?-1:1)*ar*St(2,Zt-Qn)}function yt(kn){return kn[3]<<24|kn[2]<<16|kn[1]<<8|kn[0]}function nn(kn){return[255&kn]}function xt(kn){return[255&kn,kn>>8&255]}function _t(kn){return[255&kn,kn>>8&255,kn>>16&255,kn>>24&255]}function Yt(kn){return Ft(kn,52,8)}function Fn(kn){return Ft(kn,23,4)}function Rn(kn,Qn,ke){Z(kn[oe],Qn,{get:function(){return this[ke]}})}function cn(kn,Qn,ke,ar){var Tr=q(+ke);if(Tr+Qn>kn[ze])throw ge(ce);var rn=kn[Mt]._b,Ht=Tr+kn[Ut],Gn=rn.slice(Ht,Ht+Qn);return ar?Gn:Gn.reverse()}function qe(kn,Qn,ke,ar,Tr,rn){var Ht=q(+ke);if(Ht+Qn>kn[ze])throw ge(ce);for(var Gn=kn[Mt]._b,Xt=Ht+kn[Ut],Wt=ar(+Tr),Zt=0;Zt<Qn;Zt++)Gn[Xt+Zt]=Wt[rn?Zt:Qn-Zt-1]}if(O.ABV){if(!N(function(){be(1)})||!N(function(){new be(-1)})||N(function(){return new be,new be(1.5),new be(NaN),be.name!="ArrayBuffer"})){for(var Qe,$e=(be=function(kn){return L(this,be),new ht(q(kn))})[oe]=ht[oe],ft=I(ht),Jt=0;ft.length>Jt;)(Qe=ft[Jt++])in be||U(be,Qe,ht[Qe]);S||($e.constructor=be)}var Qt=new Ee(new be(2)),Pn=Ee[oe].setInt8;Qt.setInt8(0,2147483648),Qt.setInt8(1,2147483649),!Qt.getInt8(0)&&Qt.getInt8(1)||j(Ee[oe],{setInt8:function(kn,Qn){Pn.call(this,kn,Qn<<24>>24)},setUint8:function(kn,Qn){Pn.call(this,kn,Qn<<24>>24)}},!0)}else be=function(kn){L(this,be,"ArrayBuffer");var Qn=q(kn);this._b=Y.call(new Array(Qn),0),this[ze]=Qn},Ee=function(kn,Qn,ke){L(this,Ee,"DataView"),L(kn,be,"DataView");var ar=kn[ze],Tr=W(Qn);if(Tr<0||Tr>ar)throw ge("Wrong offset!");if(Tr+(ke=ke===void 0?ar-Tr:z(ke))>ar)throw ge("Wrong length!");this[Mt]=kn,this[Ut]=Tr,this[ze]=ke},C&&(Rn(be,"byteLength","_l"),Rn(Ee,"buffer","_b"),Rn(Ee,"byteLength","_l"),Rn(Ee,"byteOffset","_o")),j(Ee[oe],{getInt8:function(kn){return cn(this,1,kn)[0]<<24>>24},getUint8:function(kn){return cn(this,1,kn)[0]},getInt16:function(kn){var Qn=cn(this,2,kn,arguments[1]);return(Qn[1]<<8|Qn[0])<<16>>16},getUint16:function(kn){var Qn=cn(this,2,kn,arguments[1]);return Qn[1]<<8|Qn[0]},getInt32:function(kn){return yt(cn(this,4,kn,arguments[1]))},getUint32:function(kn){return yt(cn(this,4,kn,arguments[1]))>>>0},getFloat32:function(kn){return pt(cn(this,4,kn,arguments[1]),23,4)},getFloat64:function(kn){return pt(cn(this,8,kn,arguments[1]),52,8)},setInt8:function(kn,Qn){qe(this,1,kn,nn,Qn)},setUint8:function(kn,Qn){qe(this,1,kn,nn,Qn)},setInt16:function(kn,Qn){qe(this,2,kn,xt,Qn,arguments[2])},setUint16:function(kn,Qn){qe(this,2,kn,xt,Qn,arguments[2])},setInt32:function(kn,Qn){qe(this,4,kn,_t,Qn,arguments[2])},setUint32:function(kn,Qn){qe(this,4,kn,_t,Qn,arguments[2])},setFloat32:function(kn,Qn){qe(this,4,kn,Fn,Qn,arguments[2])},setFloat64:function(kn,Qn){qe(this,8,kn,Yt,Qn,arguments[2])}});G(be,"ArrayBuffer"),G(Ee,"DataView"),U(Ee[oe],O.VIEW,!0),s.ArrayBuffer=be,s.DataView=Ee},function(u,s,r){var l,C,S,O=r(56),U=r(232),j=r(171),N=r(175),L=r(16),W=L.process,z=L.setImmediate,q=L.clearImmediate,I=L.MessageChannel,Z=L.Dispatch,Y=0,G={},oe=function(){var be=+this;if(G.hasOwnProperty(be)){var Ee=G[be];delete G[be],Ee()}},ce=function(be){oe.call(be.data)};z&&q||(z=function(be){for(var Ee=[],ve=1;arguments.length>ve;)Ee.push(arguments[ve++]);return G[++Y]=function(){U(typeof be=="function"?be:Function(be),Ee)},l(Y),Y},q=function(be){delete G[be]},r(62)(W)=="process"?l=function(be){W.nextTick(O(oe,be,1))}:Z&&Z.now?l=function(be){Z.now(O(oe,be,1))}:I?(S=(C=new I).port2,C.port1.onmessage=ce,l=O(S.postMessage,S,1)):L.addEventListener&&typeof postMessage=="function"&&!L.importScripts?(l=function(be){L.postMessage(be+"","*")},L.addEventListener("message",ce,!1)):l="onreadystatechange"in N("script")?function(be){j.appendChild(N("script")).onreadystatechange=function(){j.removeChild(this),oe.call(be)}}:function(be){setTimeout(O(oe,be,1),0)}),u.exports={set:z,clear:q}},function(u,s,r){var l=r(164)(!0);u.exports=function(C,S,O){return S+(O?l(C,S).length:1)}},function(u,s,r){var l=r(124),C=RegExp.prototype.exec,S=String.prototype.replace,O=C,U=function(){var N=/a/,L=/b*/g;return C.call(N,"a"),C.call(L,"a"),N.lastIndex!==0||L.lastIndex!==0}(),j=/()??/.exec("")[1]!==void 0;(U||j)&&(O=function(N){var L,W,z,q,I=this;return j&&(W=new RegExp("^"+I.source+"$(?!\\s)",l.call(I))),U&&(L=I.lastIndex),z=C.call(I,N),U&&z&&(I.lastIndex=I.global?z.index+z[0].length:L),j&&z&&z.length>1&&S.call(z[0],W,function(){for(q=1;q<arguments.length-2;q++)arguments[q]===void 0&&(z[q]=void 0)}),z}),u.exports=O},function(u,s,r){var l=r(77),C=r(221),S=r(96),O=r(41);u.exports=r(163)(Array,"Array",function(U,j){this._t=O(U),this._i=0,this._k=j},function(){var U=this._t,j=this._k,N=this._i++;return!U||N>=U.length?(this._t=void 0,C(1)):C(0,j=="keys"?N:j=="values"?U[N]:[N,U[N]])},"values"),S.Arguments=S.Array,l("keys"),l("values"),l("entries")},function(u,s,r){var l=r(34),C=r(81),S=r(22);u.exports=function(O){for(var U=l(this),j=S(U.length),N=arguments.length,L=C(N>1?arguments[1]:void 0,j),W=N>2?arguments[2]:void 0,z=W===void 0?j:C(W,j);z>L;)U[L++]=O;return U}},function(u,s,r){var l=r(105),C=r(19)("iterator"),S=r(96);u.exports=r(24).getIteratorMethod=function(O){if(O!=null)return O[C]||O["@@iterator"]||S[l(O)]}},function(u,s,r){var l=r(26),C=r(85);u.exports=function(S,O,U){O in S?l.f(S,O,C(0,U)):S[O]=U}},function(u,s,r){var l=r(96),C=r(19)("iterator"),S=Array.prototype;u.exports=function(O){return O!==void 0&&(l.Array===O||S[C]===O)}},function(u,s,r){var l=r(19)("match");u.exports=function(C){var S=/./;try{"/./"[C](S)}catch{try{return S[l]=!1,!"/./"[C](S)}catch{}}return!0}},function(u,s,r){var l=r(13),C=r(62),S=r(19)("match");u.exports=function(O){var U;return l(O)&&((U=O[S])!==void 0?!!U:C(O)=="RegExp")}},function(u,s,r){var l=r(161),C=r(61);u.exports=function(S,O,U){if(l(O))throw TypeError("String#"+U+" doesn't accept regex!");return String(C(S))}},function(u,s,r){var l=r(83),C=r(8),S=r(38),O=r(42),U=r(96),j=r(226),N=r(98),L=r(78),W=r(19)("iterator"),z=!([].keys&&"next"in[].keys()),q=function(){return this};u.exports=function(I,Z,Y,G,oe,ce,be){j(Y,Z,G);var Ee,ve,ge,Ge=function(Ut){if(!z&&Ut in we)return we[Ut];switch(Ut){case"keys":case"values":return function(){return new Y(this,Ut)}}return function(){return new Y(this,Ut)}},ht=Z+" Iterator",It=oe=="values",St=!1,we=I.prototype,bt=we[W]||we["@@iterator"]||oe&&we[oe],jt=bt||Ge(oe),Mt=oe?It?Ge("entries"):jt:void 0,ze=Z=="Array"&&we.entries||bt;if(ze&&(ge=L(ze.call(new I)))!==Object.prototype&&ge.next&&(N(ge,ht,!0),l||typeof ge[W]=="function"||O(ge,W,q)),It&&bt&&bt.name!=="values"&&(St=!0,jt=function(){return bt.call(this)}),l&&!be||!z&&!St&&we[W]||O(we,W,jt),U[Z]=jt,U[ht]=q,oe)if(Ee={values:It?jt:Ge("values"),keys:ce?jt:Ge("keys"),entries:Mt},be)for(ve in Ee)ve in we||S(we,ve,Ee[ve]);else C(C.P+C.F*(z||St),Z,Ee);return Ee}},function(u,s,r){var l=r(54),C=r(61);u.exports=function(S){return function(O,U){var j,N,L=String(C(O)),W=l(U),z=L.length;return W<0||W>=z?S?"":void 0:(j=L.charCodeAt(W))<55296||j>56319||W+1===z||(N=L.charCodeAt(W+1))<56320||N>57343?S?L.charAt(W):j:S?L.slice(W,W+2):N-56320+(j-55296<<10)+65536}}},function(u,s){var r=Math.expm1;u.exports=!r||r(10)>22025.465794806718||r(10)<22025.465794806718||r(-2e-17)!=-2e-17?function(l){return(l=+l)==0?l:l>-1e-6&&l<1e-6?l+l*l/2:Math.exp(l)-1}:r},function(u,s){u.exports=Math.sign||function(r){return(r=+r)==0||r!=r?r:r<0?-1:1}},function(u,s,r){var l=r(54),C=r(61);u.exports=function(S){var O=String(C(this)),U="",j=l(S);if(j<0||j==1/0)throw RangeError("Count can't be negative");for(;j>0;(j>>>=1)&&(O+=O))1&j&&(U+=O);return U}},function(u,s,r){var l=r(13),C=r(170).set;u.exports=function(S,O,U){var j,N=O.constructor;return N!==U&&typeof N=="function"&&(j=N.prototype)!==U.prototype&&l(j)&&C&&C(S,j),S}},function(u,s){u.exports=`	
\v\f\r \u2028\u2029\uFEFF`},function(u,s,r){var l=r(13),C=r(14),S=function(O,U){if(C(O),!l(U)&&U!==null)throw TypeError(U+": can't set as prototype!")};u.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(O,U,j){try{(j=r(56)(Function.call,r(53).f(Object.prototype,"__proto__").set,2))(O,[]),U=!(O instanceof Array)}catch{U=!0}return function(N,L){return S(N,L),U?N.__proto__=L:j(N,L),N}}({},!1):void 0),check:S}},function(u,s,r){var l=r(16).document;u.exports=l&&l.documentElement},function(u,s){u.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(u,s,r){var l=r(129)("keys"),C=r(84);u.exports=function(S){return l[S]||(l[S]=C(S))}},function(u,s,r){s.f=r(19)},function(u,s,r){var l=r(13),C=r(16).document,S=l(C)&&l(C.createElement);u.exports=function(O){return S?C.createElement(O):{}}},function(u,s,r){var l=function(ce){return ce},C=function(ce){if(ce==null)return l;var be,Ee,ve=ce.scale[0],ge=ce.scale[1],Ge=ce.translate[0],ht=ce.translate[1];return function(It,St){St||(be=Ee=0);var we=2,bt=It.length,jt=new Array(bt);for(jt[0]=(be+=It[0])*ve+Ge,jt[1]=(Ee+=It[1])*ge+ht;we<bt;)jt[we]=It[we],++we;return jt}},S=function(ce){var be,Ee=C(ce.transform),ve=1/0,ge=ve,Ge=-ve,ht=-ve;function It(we){(we=Ee(we))[0]<ve&&(ve=we[0]),we[0]>Ge&&(Ge=we[0]),we[1]<ge&&(ge=we[1]),we[1]>ht&&(ht=we[1])}function St(we){switch(we.type){case"GeometryCollection":we.geometries.forEach(St);break;case"Point":It(we.coordinates);break;case"MultiPoint":we.coordinates.forEach(It)}}for(be in ce.arcs.forEach(function(we){for(var bt,jt=-1,Mt=we.length;++jt<Mt;)(bt=Ee(we[jt],jt))[0]<ve&&(ve=bt[0]),bt[0]>Ge&&(Ge=bt[0]),bt[1]<ge&&(ge=bt[1]),bt[1]>ht&&(ht=bt[1])}),ce.objects)St(ce.objects[be]);return[ve,ge,Ge,ht]},O=function(ce,be){for(var Ee,ve=ce.length,ge=ve-be;ge<--ve;)Ee=ce[ge],ce[ge++]=ce[ve],ce[ve]=Ee},U=function(ce,be){return typeof be=="string"&&(be=ce.objects[be]),be.type==="GeometryCollection"?{type:"FeatureCollection",features:be.geometries.map(function(Ee){return j(ce,Ee)})}:j(ce,be)};function j(ce,be){var Ee=be.id,ve=be.bbox,ge=be.properties==null?{}:be.properties,Ge=N(ce,be);return Ee==null&&ve==null?{type:"Feature",properties:ge,geometry:Ge}:ve==null?{type:"Feature",id:Ee,properties:ge,geometry:Ge}:{type:"Feature",id:Ee,bbox:ve,properties:ge,geometry:Ge}}function N(ce,be){var Ee=C(ce.transform),ve=ce.arcs;function ge(we,bt){bt.length&&bt.pop();for(var jt=ve[we<0?~we:we],Mt=0,ze=jt.length;Mt<ze;++Mt)bt.push(Ee(jt[Mt],Mt));we<0&&O(bt,ze)}function Ge(we){return Ee(we)}function ht(we){for(var bt=[],jt=0,Mt=we.length;jt<Mt;++jt)ge(we[jt],bt);return bt.length<2&&bt.push(bt[0]),bt}function It(we){for(var bt=ht(we);bt.length<4;)bt.push(bt[0]);return bt}function St(we){return we.map(It)}return function we(bt){var jt,Mt=bt.type;switch(Mt){case"GeometryCollection":return{type:Mt,geometries:bt.geometries.map(we)};case"Point":jt=Ge(bt.coordinates);break;case"MultiPoint":jt=bt.coordinates.map(Ge);break;case"LineString":jt=ht(bt.arcs);break;case"MultiLineString":jt=bt.arcs.map(ht);break;case"Polygon":jt=St(bt.arcs);break;case"MultiPolygon":jt=bt.arcs.map(St);break;default:return null}return{type:Mt,coordinates:jt}}(be)}var L=function(ce,be){var Ee={},ve={},ge={},Ge=[],ht=-1;function It(St,we){for(var bt in St){var jt=St[bt];delete we[jt.start],delete jt.start,delete jt.end,jt.forEach(function(Mt){Ee[Mt<0?~Mt:Mt]=1}),Ge.push(jt)}}return be.forEach(function(St,we){var bt,jt=ce.arcs[St<0?~St:St];jt.length<3&&!jt[1][0]&&!jt[1][1]&&(bt=be[++ht],be[ht]=St,be[we]=bt)}),be.forEach(function(St){var we,bt,jt=function(pt){var yt,nn=ce.arcs[pt<0?~pt:pt],xt=nn[0];return ce.transform?(yt=[0,0],nn.forEach(function(_t){yt[0]+=_t[0],yt[1]+=_t[1]})):yt=nn[nn.length-1],pt<0?[yt,xt]:[xt,yt]}(St),Mt=jt[0],ze=jt[1];if(we=ge[Mt])if(delete ge[we.end],we.push(St),we.end=ze,bt=ve[ze]){delete ve[bt.start];var Ut=bt===we?we:we.concat(bt);ve[Ut.start=we.start]=ge[Ut.end=bt.end]=Ut}else ve[we.start]=ge[we.end]=we;else if(we=ve[ze])if(delete ve[we.start],we.unshift(St),we.start=Mt,bt=ge[Mt]){delete ge[bt.end];var Ft=bt===we?we:bt.concat(we);ve[Ft.start=bt.start]=ge[Ft.end=we.end]=Ft}else ve[we.start]=ge[we.end]=we;else ve[(we=[St]).start=Mt]=ge[we.end=ze]=we}),It(ge,ve),It(ve,ge),be.forEach(function(St){Ee[St<0?~St:St]||Ge.push([St])}),Ge},W=function(ce){return N(ce,z.apply(this,arguments))};function z(ce,be,Ee){var ve,ge,Ge;if(arguments.length>1)ve=function(ht,It,St){var we,bt=[],jt=[];function Mt(Ft){var pt=Ft<0?~Ft:Ft;(jt[pt]||(jt[pt]=[])).push({i:Ft,g:we})}function ze(Ft){Ft.forEach(Mt)}function Ut(Ft){Ft.forEach(ze)}return function Ft(pt){switch(we=pt,pt.type){case"GeometryCollection":pt.geometries.forEach(Ft);break;case"LineString":ze(pt.arcs);break;case"MultiLineString":case"Polygon":Ut(pt.arcs);break;case"MultiPolygon":(function(yt){yt.forEach(Ut)})(pt.arcs)}}(It),jt.forEach(St==null?function(Ft){bt.push(Ft[0].i)}:function(Ft){St(Ft[0].g,Ft[Ft.length-1].g)&&bt.push(Ft[0].i)}),bt}(0,be,Ee);else for(ge=0,ve=new Array(Ge=ce.arcs.length);ge<Ge;++ge)ve[ge]=ge;return{type:"MultiLineString",arcs:L(ce,ve)}}var q=function(ce){return N(ce,I.apply(this,arguments))};function I(ce,be){var Ee={},ve=[],ge=[];function Ge(It){It.forEach(function(St){St.forEach(function(we){(Ee[we=we<0?~we:we]||(Ee[we]=[])).push(It)})}),ve.push(It)}function ht(It){return function(St){for(var we,bt=-1,jt=St.length,Mt=St[jt-1],ze=0;++bt<jt;)we=Mt,Mt=St[bt],ze+=we[0]*Mt[1]-we[1]*Mt[0];return Math.abs(ze)}(N(ce,{type:"Polygon",arcs:[It]}).coordinates[0])}return be.forEach(function It(St){switch(St.type){case"GeometryCollection":St.geometries.forEach(It);break;case"Polygon":Ge(St.arcs);break;case"MultiPolygon":St.arcs.forEach(Ge)}}),ve.forEach(function(It){if(!It._){var St=[],we=[It];for(It._=1,ge.push(St);It=we.pop();)St.push(It),It.forEach(function(bt){bt.forEach(function(jt){Ee[jt<0?~jt:jt].forEach(function(Mt){Mt._||(Mt._=1,we.push(Mt))})})})}}),ve.forEach(function(It){delete It._}),{type:"MultiPolygon",arcs:ge.map(function(It){var St,we=[];if(It.forEach(function(Ut){Ut.forEach(function(Ft){Ft.forEach(function(pt){Ee[pt<0?~pt:pt].length<2&&we.push(pt)})})}),(St=(we=L(ce,we)).length)>1)for(var bt,jt,Mt=1,ze=ht(we[0]);Mt<St;++Mt)(bt=ht(we[Mt]))>ze&&(jt=we[0],we[0]=we[Mt],we[Mt]=jt,ze=bt);return we}).filter(function(It){return It.length>0})}}var Z=function(ce,be){for(var Ee=0,ve=ce.length;Ee<ve;){var ge=Ee+ve>>>1;ce[ge]<be?Ee=ge+1:ve=ge}return Ee},Y=function(ce){var be={},Ee=ce.map(function(){return[]});function ve(Ut,Ft){Ut.forEach(function(pt){pt<0&&(pt=~pt);var yt=be[pt];yt?yt.push(Ft):be[pt]=[Ft]})}function ge(Ut,Ft){Ut.forEach(function(pt){ve(pt,Ft)})}var Ge={LineString:ve,MultiLineString:ge,Polygon:ge,MultiPolygon:function(Ut,Ft){Ut.forEach(function(pt){ge(pt,Ft)})}};for(var ht in ce.forEach(function Ut(Ft,pt){Ft.type==="GeometryCollection"?Ft.geometries.forEach(function(yt){Ut(yt,pt)}):Ft.type in Ge&&Ge[Ft.type](Ft.arcs,pt)}),be)for(var It=be[ht],St=It.length,we=0;we<St;++we)for(var bt=we+1;bt<St;++bt){var jt,Mt=It[we],ze=It[bt];(jt=Ee[Mt])[ht=Z(jt,ze)]!==ze&&jt.splice(ht,0,ze),(jt=Ee[ze])[ht=Z(jt,Mt)]!==Mt&&jt.splice(ht,0,Mt)}return Ee},G=function(ce){if(ce==null)return l;var be,Ee,ve=ce.scale[0],ge=ce.scale[1],Ge=ce.translate[0],ht=ce.translate[1];return function(It,St){St||(be=Ee=0);var we=2,bt=It.length,jt=new Array(bt),Mt=Math.round((It[0]-Ge)/ve),ze=Math.round((It[1]-ht)/ge);for(jt[0]=Mt-be,be=Mt,jt[1]=ze-Ee,Ee=ze;we<bt;)jt[we]=It[we],++we;return jt}},oe=function(ce,be){if(ce.transform)throw new Error("already quantized");if(be&&be.scale)It=ce.bbox;else{if(!((Ee=Math.floor(be))>=2))throw new Error("n must be 2");var Ee,ve=(It=ce.bbox||S(ce))[0],ge=It[1],Ge=It[2],ht=It[3];be={scale:[Ge-ve?(Ge-ve)/(Ee-1):1,ht-ge?(ht-ge)/(Ee-1):1],translate:[ve,ge]}}var It,St,we=G(be),bt=ce.objects,jt={};function Mt(Ut){return we(Ut)}function ze(Ut){var Ft;switch(Ut.type){case"GeometryCollection":Ft={type:"GeometryCollection",geometries:Ut.geometries.map(ze)};break;case"Point":Ft={type:"Point",coordinates:Mt(Ut.coordinates)};break;case"MultiPoint":Ft={type:"MultiPoint",coordinates:Ut.coordinates.map(Mt)};break;default:return Ut}return Ut.id!=null&&(Ft.id=Ut.id),Ut.bbox!=null&&(Ft.bbox=Ut.bbox),Ut.properties!=null&&(Ft.properties=Ut.properties),Ft}for(St in bt)jt[St]=ze(bt[St]);return{type:"Topology",bbox:It,transform:be,objects:jt,arcs:ce.arcs.map(function(Ut){var Ft,pt=0,yt=1,nn=Ut.length,xt=new Array(nn);for(xt[0]=we(Ut[0],0);++pt<nn;)((Ft=we(Ut[pt],pt))[0]||Ft[1])&&(xt[yt++]=Ft);return yt===1&&(xt[yt++]=[0,0]),xt.length=yt,xt})}};r.d(s,!1,function(){return S}),r.d(s,"a",function(){return U}),r.d(s,"b",function(){return W}),r.d(s,!1,function(){return z}),r.d(s,!1,function(){return q}),r.d(s,!1,function(){return I}),r.d(s,!1,function(){return Y}),r.d(s,!1,function(){return oe}),r.d(s,!1,function(){return C}),r.d(s,!1,function(){return G})},function(u,s,r){(function(l,C){function S(){return typeof l=="object"&&u!==void 0&&C!==void 0&&!!C.version}r.d(s,"a",function(){return S})}).call(this,r(59),r(75))},function(u,s,r){(function(l){r.d(s,"a",function(){return O});var C=r(5),S=r(131);function O(){var U=l.Canvas||l.HTMLCanvasElement,j=l.Image||l.HTMLImageElement,N=l.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},L=Object(S.a)();return Object(C.a)({Canvas:U||function(){return function(){}}(),CanvasRenderingContext2D:l.CanvasRenderingContext2D||function(){return function(){}}(),Image:j||function(){return function(){}}(),ImageData:l.ImageData||function(){return function(){}}(),Video:l.HTMLVideoElement||function(){return function(){}}(),createCanvasElement:function(){if(U)return new U;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(j)return new j;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:N},L)}}).call(this,r(59))},function(u,s,r){const l=r(90);u.exports={re:l.re,src:l.src,tokens:l.t,SEMVER_SPEC_VERSION:r(117).SEMVER_SPEC_VERSION,SemVer:r(32),compareIdentifiers:r(146).compareIdentifiers,rcompareIdentifiers:r(146).rcompareIdentifiers,parse:r(89),valid:r(348),clean:r(347),inc:r(346),diff:r(345),major:r(344),minor:r(343),patch:r(342),prerelease:r(341),compare:r(48),rcompare:r(340),compareLoose:r(339),compareBuild:r(144),sort:r(338),rsort:r(337),gt:r(114),lt:r(143),eq:r(145),neq:r(204),gte:r(142),lte:r(141),cmp:r(203),coerce:r(336),Comparator:r(113),Range:r(47),satisfies:r(112),toComparators:r(332),maxSatisfying:r(331),minSatisfying:r(330),minVersion:r(329),validRange:r(328),outside:r(140),gtr:r(327),ltr:r(326),intersects:r(325),simplifyRange:r(324),subset:r(323)}},function(u,s,r){var l=r(31),C=r(12),S=Object(l.a)(function(O){O.setUTCSeconds(0,0)},function(O,U){O.setTime(+O+U*C.c)},function(O,U){return(U-O)/C.c},function(O){return O.getUTCMinutes()});s.a=S,S.range},function(u,s,r){var l=r(31),C=r(12),S=Object(l.a)(function(O){O.setUTCMinutes(0,0,0)},function(O,U){O.setTime(+O+U*C.b)},function(O,U){return(U-O)/C.b},function(O){return O.getUTCHours()});s.a=S,S.range},function(u,s,r){var l=r(31),C=Object(l.a)(function(){},function(S,O){S.setTime(+S+O)},function(S,O){return O-S});C.every=function(S){return S=Math.floor(S),isFinite(S)&&S>0?S>1?Object(l.a)(function(O){O.setTime(Math.floor(O/S)*S)},function(O,U){O.setTime(+O+U*S)},function(O,U){return(U-O)/S}):C:null},s.a=C,C.range},function(u,s,r){var l=r(31),C=r(12),S=Object(l.a)(function(O){O.setTime(O-O.getMilliseconds()-O.getSeconds()*C.e)},function(O,U){O.setTime(+O+U*C.c)},function(O,U){return(U-O)/C.c},function(O){return O.getMinutes()});s.a=S,S.range},function(u,s,r){var l=r(31),C=r(12),S=Object(l.a)(function(O){O.setTime(O-O.getMilliseconds()-O.getSeconds()*C.e-O.getMinutes()*C.c)},function(O,U){O.setTime(+O+U*C.b)},function(O,U){return(U-O)/C.b},function(O){return O.getHours()});s.a=S,S.range},function(u,s){},function(u,s){u.exports=function(r,l){(l==null||l>r.length)&&(l=r.length);for(var C=0,S=new Array(l);C<l;C++)S[C]=r[C];return S},u.exports.__esModule=!0,u.exports.default=u.exports},function(u,s,r){var l=r(186);u.exports=function(C,S){if(C){if(typeof C=="string")return l(C,S);var O=Object.prototype.toString.call(C).slice(8,-1);return O==="Object"&&C.constructor&&(O=C.constructor.name),O==="Map"||O==="Set"?Array.from(C):O==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(O)?l(C,S):void 0}},u.exports.__esModule=!0,u.exports.default=u.exports},function(u,s,r){function l(C){this.message=C}l.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},l.prototype.__CANCEL__=!0,u.exports=l},function(u,s,r){var l=r(36);u.exports=function(C,S){S=S||{};var O={},U=["url","method","data"],j=["headers","auth","proxy","params"],N=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],L=["validateStatus"];function W(Z,Y){return l.isPlainObject(Z)&&l.isPlainObject(Y)?l.merge(Z,Y):l.isPlainObject(Y)?l.merge({},Y):l.isArray(Y)?Y.slice():Y}function z(Z){l.isUndefined(S[Z])?l.isUndefined(C[Z])||(O[Z]=W(void 0,C[Z])):O[Z]=W(C[Z],S[Z])}l.forEach(U,function(Z){l.isUndefined(S[Z])||(O[Z]=W(void 0,S[Z]))}),l.forEach(j,z),l.forEach(N,function(Z){l.isUndefined(S[Z])?l.isUndefined(C[Z])||(O[Z]=W(void 0,C[Z])):O[Z]=W(void 0,S[Z])}),l.forEach(L,function(Z){Z in S?O[Z]=W(C[Z],S[Z]):Z in C&&(O[Z]=W(void 0,C[Z]))});var q=U.concat(j).concat(N).concat(L),I=Object.keys(C).concat(Object.keys(S)).filter(function(Z){return q.indexOf(Z)===-1});return l.forEach(I,z),O}},function(u,s,r){u.exports=function(l){return!(!l||!l.__CANCEL__)}},function(u,s,r){var l=r(193);u.exports=function(C,S,O,U,j){var N=new Error(C);return l(N,S,O,U,j)}},function(u,s,r){var l=r(36),C=r(274),S=r(273),O=r(194),U=r(272),j=r(269),N=r(268),L=r(191);u.exports=function(W){return new Promise(function(z,q){var I=W.data,Z=W.headers,Y=W.responseType;l.isFormData(I)&&delete Z["Content-Type"];var G=new XMLHttpRequest;if(W.auth){var oe=W.auth.username||"",ce=W.auth.password?unescape(encodeURIComponent(W.auth.password)):"";Z.Authorization="Basic "+btoa(oe+":"+ce)}var be=U(W.baseURL,W.url);function Ee(){if(G){var ge="getAllResponseHeaders"in G?j(G.getAllResponseHeaders()):null,Ge={data:Y&&Y!=="text"&&Y!=="json"?G.response:G.responseText,status:G.status,statusText:G.statusText,headers:ge,config:W,request:G};C(z,q,Ge),G=null}}if(G.open(W.method.toUpperCase(),O(be,W.params,W.paramsSerializer),!0),G.timeout=W.timeout,"onloadend"in G?G.onloadend=Ee:G.onreadystatechange=function(){G&&G.readyState===4&&(G.status!==0||G.responseURL&&G.responseURL.indexOf("file:")===0)&&setTimeout(Ee)},G.onabort=function(){G&&(q(L("Request aborted",W,"ECONNABORTED",G)),G=null)},G.onerror=function(){q(L("Network Error",W,null,G)),G=null},G.ontimeout=function(){var ge="timeout of "+W.timeout+"ms exceeded";W.timeoutErrorMessage&&(ge=W.timeoutErrorMessage),q(L(ge,W,W.transitional&&W.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",G)),G=null},l.isStandardBrowserEnv()){var ve=(W.withCredentials||N(be))&&W.xsrfCookieName?S.read(W.xsrfCookieName):void 0;ve&&(Z[W.xsrfHeaderName]=ve)}"setRequestHeader"in G&&l.forEach(Z,function(ge,Ge){I===void 0&&Ge.toLowerCase()==="content-type"?delete Z[Ge]:G.setRequestHeader(Ge,ge)}),l.isUndefined(W.withCredentials)||(G.withCredentials=!!W.withCredentials),Y&&Y!=="json"&&(G.responseType=W.responseType),typeof W.onDownloadProgress=="function"&&G.addEventListener("progress",W.onDownloadProgress),typeof W.onUploadProgress=="function"&&G.upload&&G.upload.addEventListener("progress",W.onUploadProgress),W.cancelToken&&W.cancelToken.promise.then(function(ge){G&&(G.abort(),q(ge),G=null)}),I||(I=null),G.send(I)})}},function(u,s,r){u.exports=function(l,C,S,O,U){return l.config=C,S&&(l.code=S),l.request=O,l.response=U,l.isAxiosError=!0,l.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},l}},function(u,s,r){var l=r(36);function C(S){return encodeURIComponent(S).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}u.exports=function(S,O,U){if(!O)return S;var j;if(U)j=U(O);else if(l.isURLSearchParams(O))j=O.toString();else{var N=[];l.forEach(O,function(W,z){W!=null&&(l.isArray(W)?z+="[]":W=[W],l.forEach(W,function(q){l.isDate(q)?q=q.toISOString():l.isObject(q)&&(q=JSON.stringify(q)),N.push(C(z)+"="+C(q))}))}),j=N.join("&")}if(j){var L=S.indexOf("#");L!==-1&&(S=S.slice(0,L)),S+=(S.indexOf("?")===-1?"?":"&")+j}return S}},function(u,s,r){u.exports=function(l,C){return function(){for(var S=new Array(arguments.length),O=0;O<S.length;O++)S[O]=arguments[O];return l.apply(C,S)}}},function(u,s,r){var l=this&&this.__awaiter||function(L,W,z,q){return new(z||(z=Promise))(function(I,Z){function Y(ce){try{oe(q.next(ce))}catch(be){Z(be)}}function G(ce){try{oe(q.throw(ce))}catch(be){Z(be)}}function oe(ce){ce.done?I(ce.value):new z(function(be){be(ce.value)}).then(Y,G)}oe((q=q.apply(L,W||[])).next())})},C=this&&this.__importDefault||function(L){return L&&L.__esModule?L:{default:L}};Object.defineProperty(s,"__esModule",{value:!0});const S=C(r(88)),O=r(64),U=r(111),j=r(46);s.linechart=function(L,W,z={}){return l(this,void 0,void 0,function*(){const q=Array.isArray(W.values[0])?W.values:[W.values],I=q[0].length,Z=W.series?W.series:q.map((ve,ge)=>`Series ${ge+1}`);U.assert(Z.length===q.length,"Must have an equal number of series labels as there are data series"),z.seriesColors!=null&&U.assert(z.seriesColors.length===q.length,"Must have an equal number of series colors as there are data series");const Y=[];for(let ve=0;ve<I;ve++){const ge={x:ve};Z.forEach((Ge,ht)=>{const It=q[ht][ve].y;ge[Ge]=It,ge[`${Ge}-name`]=Ge}),Y.push(ge)}const G=Object.assign({},N,z),oe={x:{field:"x",type:G.xType,title:G.xLabel},tooltip:[{field:"x",type:"quantitative"},...Z.map(ve=>({field:ve,type:"quantitative"}))]},ce=Z.map(ve=>({data:void 0,mark:{type:"line",clip:!0},encoding:{y:{field:ve,type:G.yType,title:G.yLabel,scale:G.zoomToFit?{zero:!1}:G.yAxisDomain!=null?{domain:G.yAxisDomain}:void 0},color:{field:`${ve}-name`,type:"nominal",legend:{values:Z,title:null},scale:{range:G.seriesColors}}}})),be=j.getDrawArea(L),Ee={width:G.width||O.getDefaultWidth(be),height:G.height||O.getDefaultHeight(be),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:G.fontSize,titleFontSize:G.fontSize},text:{fontSize:G.fontSize},legend:{labelFontSize:G.fontSize,titleFontSize:G.fontSize}},data:{values:Y},encoding:oe,layer:[...ce,{mark:"rule",selection:{hover:{type:"single",on:"mouseover",nearest:!0,clear:"mouseout"}},encoding:{color:{value:"grey",condition:{selection:{not:"hover"},value:"transparent"}}}}]};return yield S.default(be,Ee,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()})};const N={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});const l=r(292);let C;const S="Visor",O="tfjs-visor-container";s.visor=function(){if(typeof document>"u")throw new Error("No document defined. This library needs a browser/dom to work");if(document.getElementById(O)&&C!=null)return C;let j,N=document.getElementById(O);function L(q,I){let Z=null;return j=l.VisorComponent.render(q,j,{ref:Y=>Z=Y,surfaceList:Array.from(I.values())}),Z}N==null&&((N=document.createElement("div")).id=O,document.body.appendChild(N));const W=new Map,z=L(N,W);return C=new U(z,N,W,L)};class U{constructor(N,L,W,z){this.visorComponent=N,this.el=L,this.surfaceList=W,this.renderVisor=z}surface(N){const{name:L}=N,W=N.tab==null?S:N.tab;if(L==null||!(typeof L=="string"||L instanceof String))throw new Error("You must pass a config object with a 'name' property to create or retrieve a surface");const z=Object.assign({},N,{tab:W}),q=`${L}-${W}`;return this.surfaceList.has(q)||this.surfaceList.set(q,z),this.renderVisor(this.el,this.surfaceList),this.visorComponent.getSurface(L,W)}isFullscreen(){return this.visorComponent.isFullscreen()}isOpen(){return this.visorComponent.isOpen()}close(){return this.visorComponent.close()}open(){return this.visorComponent.open()}toggle(){return this.visorComponent.toggle()}toggleFullScreen(){return this.visorComponent.toggleFullScreen()}bindKeys(){return this.visorComponent.bindKeys()}unbindKeys(){return this.visorComponent.unbindKeys()}setActiveTab(N){if(!this.visorComponent.state.tabs.has(N))throw new Error(`Tab '${N}' does not exist`);this.visorComponent.setState({activeTab:N})}}s.Visor=U},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.isSurfaceInfo=function(l){return l.name!=null},s.isSurface=function(l){return l.drawArea instanceof HTMLElement}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(l){return l.charAt(0).toUpperCase()+l.slice(1)},u.exports=s.default},function(u,s,r){var l=r(315);u.exports=l},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.processStyleName=void 0,s.createMarkupForStyles=function(j,N){var L="";for(var W in j){var z=W.indexOf("--")===0;if(j.hasOwnProperty(W)&&W!=="label"){var q=j[W];q!=null&&(z?L+=W+":"+q+";":(L+=U(W)+":",L+=(0,l.default)(W,q,N)+";"))}}return L||null},O(r(319));var l=O(r(317)),C=O(r(314)),S=O(r(312));O(r(200));function O(j){return j&&j.__esModule?j:{default:j}}var U=s.processStyleName=(0,S.default)(C.default)},function(u,s,r){r.r(s),r.d(s,"default",function(){return O}),r.d(s,"point",function(){return U});var l=r(null),C=r(null),S=r(null);function O(){var j,N,L=Object(S.a)().unknown(void 0),W=L.domain,z=L.range,q=0,I=1,Z=!1,Y=0,G=0,oe=.5;function ce(){var be=W().length,Ee=I<q,ve=Ee?I:q,ge=Ee?q:I;j=(ge-ve)/Math.max(1,be-Y+2*G),Z&&(j=Math.floor(j)),ve+=(ge-ve-j*(be-Y))*oe,N=j*(1-Y),Z&&(ve=Math.round(ve),N=Math.round(N));var Ge=Object(l.a)(be).map(function(ht){return ve+j*ht});return z(Ee?Ge.reverse():Ge)}return delete L.unknown,L.domain=function(be){return arguments.length?(W(be),ce()):W()},L.range=function(be){return arguments.length?([q,I]=be,q=+q,I=+I,ce()):[q,I]},L.rangeRound=function(be){return[q,I]=be,q=+q,I=+I,Z=!0,ce()},L.bandwidth=function(){return N},L.step=function(){return j},L.round=function(be){return arguments.length?(Z=!!be,ce()):Z},L.padding=function(be){return arguments.length?(Y=Math.min(1,G=+be),ce()):Y},L.paddingInner=function(be){return arguments.length?(Y=Math.min(1,be),ce()):Y},L.paddingOuter=function(be){return arguments.length?(G=+be,ce()):G},L.align=function(be){return arguments.length?(oe=Math.max(0,Math.min(1,be)),ce()):oe},L.copy=function(){return O(W(),[q,I]).round(Z).paddingInner(Y).paddingOuter(G).align(oe)},C.a.apply(ce(),arguments)}function U(){return function j(N){var L=N.copy;return N.padding=N.paddingOuter,delete N.paddingInner,delete N.paddingOuter,N.copy=function(){return j(L())},N}(O.apply(null,arguments).paddingInner(1))}},function(u,s,r){const l=r(145),C=r(204),S=r(114),O=r(142),U=r(143),j=r(141);u.exports=(N,L,W,z)=>{switch(L){case"===":return typeof N=="object"&&(N=N.version),typeof W=="object"&&(W=W.version),N===W;case"!==":return typeof N=="object"&&(N=N.version),typeof W=="object"&&(W=W.version),N!==W;case"":case"=":case"==":return l(N,W,z);case"!=":return C(N,W,z);case">":return S(N,W,z);case">=":return O(N,W,z);case"<":return U(N,W,z);case"<=":return j(N,W,z);default:throw new TypeError(`Invalid operator: ${L}`)}}},function(u,s,r){const l=r(48);u.exports=(C,S,O)=>l(C,S,O)!==0},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(25),C=r(73),S=r(74),O=r(29),U=r(374),j=r(28);s.div=j.op({div_:function(N,L){var W,z=O.convertToTensor(N,"a","div"),q=O.convertToTensor(L,"b","div");if(W=S.makeTypesMatch(z,q),z=W[0],q=W[1],z.dtype==="int32"&&q.dtype==="int32")return U.floorDiv(z,q);var I={a:z,b:q};return l.ENGINE.runKernelFunc(function(Z,Y){var G=Z.realDivide(z,q);return Y([z,q]),G},I,null,C.Div,{})}})},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(25),C=r(73),S=r(74),O=r(29),U=r(28);s.add=U.op({add_:function(j,N){var L,W=O.convertToTensor(j,"a","add"),z=O.convertToTensor(N,"b","add");L=S.makeTypesMatch(W,z),W=L[0],z=L[1];var q={a:W,b:z};return l.ENGINE.runKernelFunc(function(I,Z){var Y=I.add(W,z);return Z([W,z]),Y},q,null,C.Add)}})},function(u,s,r){(function(l){var C=l!==void 0&&l||typeof self<"u"&&self||window,S=Function.prototype.apply;function O(U,j){this._id=U,this._clearFn=j}s.setTimeout=function(){return new O(S.call(setTimeout,C,arguments),clearTimeout)},s.setInterval=function(){return new O(S.call(setInterval,C,arguments),clearInterval)},s.clearTimeout=s.clearInterval=function(U){U&&U.close()},O.prototype.unref=O.prototype.ref=function(){},O.prototype.close=function(){this._clearFn.call(C,this._id)},s.enroll=function(U,j){clearTimeout(U._idleTimeoutId),U._idleTimeout=j},s.unenroll=function(U){clearTimeout(U._idleTimeoutId),U._idleTimeout=-1},s._unrefActive=s.active=function(U){clearTimeout(U._idleTimeoutId);var j=U._idleTimeout;j>=0&&(U._idleTimeoutId=setTimeout(function(){U._onTimeout&&U._onTimeout()},j))},r(391),s.setImmediate=typeof self<"u"&&self.setImmediate||l!==void 0&&l.setImmediate||this&&this.setImmediate,s.clearImmediate=typeof self<"u"&&self.clearImmediate||l!==void 0&&l.clearImmediate||this&&this.clearImmediate}).call(this,r(59))},function(u,s){u.exports=function(r){try{return!!r()}catch{return!0}}},function(u,s){var r=u.exports={version:"2.6.12"};typeof __e=="number"&&(__e=r)},function(u,s,r){var l=r(27),C=r(82),S=r(41),O=r(106).f;u.exports=function(U){return function(j){for(var N,L=S(j),W=C(L),z=W.length,q=0,I=[];z>q;)N=W[q++],l&&!O.call(L,N)||I.push(U?[N,L[N]]:L[N]);return I}}},function(u,s,r){var l=r(22),C=r(167),S=r(61);u.exports=function(O,U,j,N){var L=String(S(O)),W=L.length,z=j===void 0?" ":String(j),q=l(U);if(q<=W||z=="")return L;var I=q-W,Z=C.call(z,Math.ceil(I/z.length));return Z.length>I&&(Z=Z.slice(0,I)),N?Z+L:L+Z}},function(u,s,r){var l=r(79),C=r(127),S=r(14),O=r(16).Reflect;u.exports=O&&O.ownKeys||function(U){var j=l.f(S(U)),N=C.f;return N?j.concat(N(U)):j}},function(u,s,r){var l=r(54),C=r(22);u.exports=function(S){if(S===void 0)return 0;var O=l(S),U=C(O);if(O!==U)throw RangeError("Wrong length!");return U}},function(u,s,r){var l=r(93),C=r(65).getWeak,S=r(14),O=r(13),U=r(94),j=r(121),N=r(51),L=r(43),W=r(76),z=N(5),q=N(6),I=0,Z=function(oe){return oe._l||(oe._l=new Y)},Y=function(){this.a=[]},G=function(oe,ce){return z(oe.a,function(be){return be[0]===ce})};Y.prototype={get:function(oe){var ce=G(this,oe);if(ce)return ce[1]},has:function(oe){return!!G(this,oe)},set:function(oe,ce){var be=G(this,oe);be?be[1]=ce:this.a.push([oe,ce])},delete:function(oe){var ce=q(this.a,function(be){return be[0]===oe});return~ce&&this.a.splice(ce,1),!!~ce}},u.exports={getConstructor:function(oe,ce,be,Ee){var ve=oe(function(ge,Ge){U(ge,ve,ce,"_i"),ge._t=ce,ge._i=I++,ge._l=void 0,Ge!=null&&j(Ge,be,ge[Ee],ge)});return l(ve.prototype,{delete:function(ge){if(!O(ge))return!1;var Ge=C(ge);return Ge===!0?Z(W(this,ce)).delete(ge):Ge&&L(Ge,this._i)&&delete Ge[this._i]},has:function(ge){if(!O(ge))return!1;var Ge=C(ge);return Ge===!0?Z(W(this,ce)).has(ge):Ge&&L(Ge,this._i)}}),ve},def:function(oe,ce,be){var Ee=C(S(ce),!0);return Ee===!0?Z(oe).set(ce,be):Ee[oe._i]=be,oe},ufstore:Z}},function(u,s,r){var l=r(26).f,C=r(80),S=r(93),O=r(56),U=r(94),j=r(121),N=r(163),L=r(221),W=r(95),z=r(27),q=r(65).fastKey,I=r(76),Z=z?"_s":"size",Y=function(G,oe){var ce,be=q(oe);if(be!=="F")return G._i[be];for(ce=G._f;ce;ce=ce.n)if(ce.k==oe)return ce};u.exports={getConstructor:function(G,oe,ce,be){var Ee=G(function(ve,ge){U(ve,Ee,oe,"_i"),ve._t=oe,ve._i=C(null),ve._f=void 0,ve._l=void 0,ve[Z]=0,ge!=null&&j(ge,ce,ve[be],ve)});return S(Ee.prototype,{clear:function(){for(var ve=I(this,oe),ge=ve._i,Ge=ve._f;Ge;Ge=Ge.n)Ge.r=!0,Ge.p&&(Ge.p=Ge.p.n=void 0),delete ge[Ge.i];ve._f=ve._l=void 0,ve[Z]=0},delete:function(ve){var ge=I(this,oe),Ge=Y(ge,ve);if(Ge){var ht=Ge.n,It=Ge.p;delete ge._i[Ge.i],Ge.r=!0,It&&(It.n=ht),ht&&(ht.p=It),ge._f==Ge&&(ge._f=ht),ge._l==Ge&&(ge._l=It),ge[Z]--}return!!Ge},forEach:function(ve){I(this,oe);for(var ge,Ge=O(ve,arguments.length>1?arguments[1]:void 0,3);ge=ge?ge.n:this._f;)for(Ge(ge.v,ge.k,this);ge&&ge.r;)ge=ge.p},has:function(ve){return!!Y(I(this,oe),ve)}}),z&&l(Ee.prototype,"size",{get:function(){return I(this,oe)[Z]}}),Ee},def:function(G,oe,ce){var be,Ee,ve=Y(G,oe);return ve?ve.v=ce:(G._l=ve={i:Ee=q(oe,!0),k:oe,v:ce,p:be=G._l,n:void 0,r:!1},G._f||(G._f=ve),be&&(be.n=ve),G[Z]++,Ee!=="F"&&(G._i[Ee]=ve)),G},getEntry:Y,setStrong:function(G,oe,ce){N(G,oe,function(be,Ee){this._t=I(be,oe),this._k=Ee,this._l=void 0},function(){for(var be=this._k,Ee=this._l;Ee&&Ee.r;)Ee=Ee.p;return this._t&&(this._l=Ee=Ee?Ee.n:this._t._f)?L(0,be=="keys"?Ee.k:be=="values"?Ee.v:[Ee.k,Ee.v]):(this._t=void 0,L(1))},ce?"entries":"values",!ce,!0),W(oe)}}},function(u,s,r){var l=r(14),C=r(13),S=r(217);u.exports=function(O,U){if(l(O),C(U)&&U.constructor===O)return U;var j=S.f(O);return(0,j.resolve)(U),j.promise}},function(u,s,r){var l=r(55);u.exports.f=function(C){return new function(S){var O,U;this.promise=new S(function(j,N){if(O!==void 0||U!==void 0)throw TypeError("Bad Promise constructor");O=j,U=N}),this.resolve=l(O),this.reject=l(U)}(C)}},function(u,s,r){var l,C,S,O,U=r(83),j=r(16),N=r(56),L=r(105),W=r(8),z=r(13),q=r(55),I=r(94),Z=r(121),Y=r(104),G=r(152).set,oe=r(466)(),ce=r(217),be=r(465),Ee=r(120),ve=r(216),ge=j.TypeError,Ge=j.process,ht=Ge&&Ge.versions,It=ht&&ht.v8||"",St=j.Promise,we=L(Ge)=="process",bt=function(){},jt=C=ce.f,Mt=!!function(){try{var _t=St.resolve(1),Yt=(_t.constructor={})[r(19)("species")]=function(Fn){Fn(bt,bt)};return(we||typeof PromiseRejectionEvent=="function")&&_t.then(bt)instanceof Yt&&It.indexOf("6.6")!==0&&Ee.indexOf("Chrome/66")===-1}catch{}}(),ze=function(_t){var Yt;return!(!z(_t)||typeof(Yt=_t.then)!="function")&&Yt},Ut=function(_t,Yt){if(!_t._n){_t._n=!0;var Fn=_t._c;oe(function(){for(var Rn=_t._v,cn=_t._s==1,qe=0,Qe=function($e){var ft,Jt,Qt,Pn=cn?$e.ok:$e.fail,kn=$e.resolve,Qn=$e.reject,ke=$e.domain;try{Pn?(cn||(_t._h==2&&yt(_t),_t._h=1),Pn===!0?ft=Rn:(ke&&ke.enter(),ft=Pn(Rn),ke&&(ke.exit(),Qt=!0)),ft===$e.promise?Qn(ge("Promise-chain cycle")):(Jt=ze(ft))?Jt.call(ft,kn,Qn):kn(ft)):Qn(Rn)}catch(ar){ke&&!Qt&&ke.exit(),Qn(ar)}};Fn.length>qe;)Qe(Fn[qe++]);_t._c=[],_t._n=!1,Yt&&!_t._h&&Ft(_t)})}},Ft=function(_t){G.call(j,function(){var Yt,Fn,Rn,cn=_t._v,qe=pt(_t);if(qe&&(Yt=be(function(){we?Ge.emit("unhandledRejection",cn,_t):(Fn=j.onunhandledrejection)?Fn({promise:_t,reason:cn}):(Rn=j.console)&&Rn.error&&Rn.error("Unhandled promise rejection",cn)}),_t._h=we||pt(_t)?2:1),_t._a=void 0,qe&&Yt.e)throw Yt.v})},pt=function(_t){return _t._h!==1&&(_t._a||_t._c).length===0},yt=function(_t){G.call(j,function(){var Yt;we?Ge.emit("rejectionHandled",_t):(Yt=j.onrejectionhandled)&&Yt({promise:_t,reason:_t._v})})},nn=function(_t){var Yt=this;Yt._d||(Yt._d=!0,(Yt=Yt._w||Yt)._v=_t,Yt._s=2,Yt._a||(Yt._a=Yt._c.slice()),Ut(Yt,!0))},xt=function(_t){var Yt,Fn=this;if(!Fn._d){Fn._d=!0,Fn=Fn._w||Fn;try{if(Fn===_t)throw ge("Promise can't be resolved itself");(Yt=ze(_t))?oe(function(){var Rn={_w:Fn,_d:!1};try{Yt.call(_t,N(xt,Rn,1),N(nn,Rn,1))}catch(cn){nn.call(Rn,cn)}}):(Fn._v=_t,Fn._s=1,Ut(Fn,!1))}catch(Rn){nn.call({_w:Fn,_d:!1},Rn)}}};Mt||(St=function(_t){I(this,St,"Promise","_h"),q(_t),l.call(this);try{_t(N(xt,this,1),N(nn,this,1))}catch(Yt){nn.call(this,Yt)}},(l=function(_t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(93)(St.prototype,{then:function(_t,Yt){var Fn=jt(Y(this,St));return Fn.ok=typeof _t!="function"||_t,Fn.fail=typeof Yt=="function"&&Yt,Fn.domain=we?Ge.domain:void 0,this._c.push(Fn),this._a&&this._a.push(Fn),this._s&&Ut(this,!1),Fn.promise},catch:function(_t){return this.then(void 0,_t)}}),S=function(){var _t=new l;this.promise=_t,this.resolve=N(xt,_t,1),this.reject=N(nn,_t,1)},ce.f=jt=function(_t){return _t===St||_t===O?new S(_t):C(_t)}),W(W.G+W.W+W.F*!Mt,{Promise:St}),r(98)(St,"Promise"),r(95)("Promise"),O=r(24).Promise,W(W.S+W.F*!Mt,"Promise",{reject:function(_t){var Yt=jt(this);return(0,Yt.reject)(_t),Yt.promise}}),W(W.S+W.F*(U||!Mt),"Promise",{resolve:function(_t){return ve(U&&this===O?St:this,_t)}}),W(W.S+W.F*!(Mt&&r(125)(function(_t){St.all(_t).catch(bt)})),"Promise",{all:function(_t){var Yt=this,Fn=jt(Yt),Rn=Fn.resolve,cn=Fn.reject,qe=be(function(){var Qe=[],$e=0,ft=1;Z(_t,!1,function(Jt){var Qt=$e++,Pn=!1;Qe.push(void 0),ft++,Yt.resolve(Jt).then(function(kn){Pn||(Pn=!0,Qe[Qt]=kn,--ft||Rn(Qe))},cn)}),--ft||Rn(Qe)});return qe.e&&cn(qe.v),Fn.promise},race:function(_t){var Yt=this,Fn=jt(Yt),Rn=Fn.reject,cn=be(function(){Z(_t,!1,function(qe){Yt.resolve(qe).then(Fn.resolve,Rn)})});return cn.e&&Rn(cn.v),Fn.promise}})},function(u,s,r){r(27)&&/./g.flags!="g"&&r(26).f(RegExp.prototype,"flags",{configurable:!0,get:r(124)})},function(u,s,r){var l=r(154);r(8)({target:"RegExp",proto:!0,forced:l!==/./.exec},{exec:l})},function(u,s){u.exports=function(r,l){return{value:l,done:!!r}}},function(u,s,r){var l=r(34),C=r(81),S=r(22);u.exports=[].copyWithin||function(O,U){var j=l(this),N=S(j.length),L=C(O,N),W=C(U,N),z=arguments.length>2?arguments[2]:void 0,q=Math.min((z===void 0?N:C(z,N))-W,N-L),I=1;for(W<L&&L<W+q&&(I=-1,W+=q-1,L+=q-1);q-- >0;)W in j?j[L]=j[W]:delete j[L],L+=I,W+=I;return j}},function(u,s,r){var l=r(55),C=r(34),S=r(107),O=r(22);u.exports=function(U,j,N,L,W){l(j);var z=C(U),q=S(z),I=O(z.length),Z=W?I-1:0,Y=W?-1:1;if(N<2)for(;;){if(Z in q){L=q[Z],Z+=Y;break}if(Z+=Y,W?Z<0:I<=Z)throw TypeError("Reduce of empty array with no initial value")}for(;W?Z>=0:I>Z;Z+=Y)Z in q&&(L=j(L,q[Z],Z,z));return L}},function(u,s,r){var l=r(486);u.exports=function(C,S){return new(l(C))(S)}},function(u,s,r){var l=r(14);u.exports=function(C,S,O,U){try{return U?S(l(O)[0],O[1]):S(O)}catch(N){var j=C.return;throw j!==void 0&&l(j.call(C)),N}}},function(u,s,r){var l=r(80),C=r(85),S=r(98),O={};r(42)(O,r(19)("iterator"),function(){return this}),u.exports=function(U,j,N){U.prototype=l(O,{next:C(1,N)}),S(U,j+" Iterator")}},function(u,s){u.exports=Math.log1p||function(r){return(r=+r)>-1e-8&&r<1e-8?r-r*r/2:Math.log(1+r)}},function(u,s,r){var l=r(13),C=Math.floor;u.exports=function(S){return!l(S)&&isFinite(S)&&C(S)===S}},function(u,s,r){var l=r(62);u.exports=function(C,S){if(typeof C!="number"&&l(C)!="Number")throw TypeError(S);return+C}},function(u,s,r){var l=r(16).parseFloat,C=r(97).trim;u.exports=1/l(r(169)+"-0")!=-1/0?function(S){var O=C(String(S),3),U=l(O);return U===0&&O.charAt(0)=="-"?-0:U}:l},function(u,s,r){var l=r(16).parseInt,C=r(97).trim,S=r(169),O=/^[-+]?0[xX]/;u.exports=l(S+"08")!==8||l(S+"0x16")!==22?function(U,j){var N=C(String(U),3);return l(N,j>>>0||(O.test(N)?16:10))}:l},function(u,s){u.exports=function(r,l,C){var S=C===void 0;switch(l.length){case 0:return S?r():r.call(C);case 1:return S?r(l[0]):r.call(C,l[0]);case 2:return S?r(l[0],l[1]):r.call(C,l[0],l[1]);case 3:return S?r(l[0],l[1],l[2]):r.call(C,l[0],l[1],l[2]);case 4:return S?r(l[0],l[1],l[2],l[3]):r.call(C,l[0],l[1],l[2],l[3])}return r.apply(C,l)}},function(u,s,r){var l=r(55),C=r(13),S=r(232),O=[].slice,U={};u.exports=Function.bind||function(j){var N=l(this),L=O.call(arguments,1),W=function(){var z=L.concat(O.call(arguments));return this instanceof W?function(q,I,Z){if(!(I in U)){for(var Y=[],G=0;G<I;G++)Y[G]="a["+G+"]";U[I]=Function("F,a","return new F("+Y.join(",")+")")}return U[I](q,Z)}(N,z.length,z):S(N,z,j)};return C(N.prototype)&&(W.prototype=N.prototype),W}},function(u,s){u.exports=Object.is||function(r,l){return r===l?r!==0||1/r==1/l:r!=r&&l!=l}},function(u,s,r){var l=r(27),C=r(82),S=r(127),O=r(106),U=r(34),j=r(107),N=Object.assign;u.exports=!N||r(15)(function(){var L={},W={},z=Symbol(),q="abcdefghijklmnopqrst";return L[z]=7,q.split("").forEach(function(I){W[I]=I}),N({},L)[z]!=7||Object.keys(N({},W)).join("")!=q})?function(L,W){for(var z=U(L),q=arguments.length,I=1,Z=S.f,Y=O.f;q>I;)for(var G,oe=j(arguments[I++]),ce=Z?C(oe).concat(Z(oe)):C(oe),be=ce.length,Ee=0;be>Ee;)G=ce[Ee++],l&&!Y.call(oe,G)||(z[G]=oe[G]);return z}:N},function(u,s,r){var l=r(41),C=r(79).f,S={}.toString,O=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];u.exports.f=function(U){return O&&S.call(U)=="[object Window]"?function(j){try{return C(j)}catch{return O.slice()}}(U):C(l(U))}},function(u,s,r){var l=r(26),C=r(14),S=r(82);u.exports=r(27)?Object.defineProperties:function(O,U){C(O);for(var j,N=S(U),L=N.length,W=0;L>W;)l.f(O,j=N[W++],U[j]);return O}},function(u,s,r){var l=r(43),C=r(41),S=r(128)(!1),O=r(173)("IE_PROTO");u.exports=function(U,j){var N,L=C(U),W=0,z=[];for(N in L)N!=O&&l(L,N)&&z.push(N);for(;j.length>W;)l(L,N=j[W++])&&(~S(z,N)||z.push(N));return z}},function(u,s,r){var l=r(16),C=r(24),S=r(83),O=r(174),U=r(26).f;u.exports=function(j){var N=C.Symbol||(C.Symbol=S?{}:l.Symbol||{});j.charAt(0)=="_"||j in N||U(N,j,{value:O.f(j)})}},function(u,s,r){u.exports=!r(27)&&!r(15)(function(){return Object.defineProperty(r(175)("div"),"a",{get:function(){return 7}}).a!=7})},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(2);s.tf=l,function(C){for(var S in C)s.hasOwnProperty(S)||(s[S]=C[S])}(r(257))},function(u,s,r){(function(l,C,S){const O={1:{name:"/m/01g317",id:1,displayName:"person"},2:{name:"/m/0199g",id:2,displayName:"bicycle"},3:{name:"/m/0k4j",id:3,displayName:"car"},4:{name:"/m/04_sv",id:4,displayName:"motorcycle"},5:{name:"/m/05czz6l",id:5,displayName:"airplane"},6:{name:"/m/01bjv",id:6,displayName:"bus"},7:{name:"/m/07jdr",id:7,displayName:"train"},8:{name:"/m/07r04",id:8,displayName:"truck"},9:{name:"/m/019jd",id:9,displayName:"boat"},10:{name:"/m/015qff",id:10,displayName:"traffic light"},11:{name:"/m/01pns0",id:11,displayName:"fire hydrant"},13:{name:"/m/02pv19",id:13,displayName:"stop sign"},14:{name:"/m/015qbp",id:14,displayName:"parking meter"},15:{name:"/m/0cvnqh",id:15,displayName:"bench"},16:{name:"/m/015p6",id:16,displayName:"bird"},17:{name:"/m/01yrx",id:17,displayName:"cat"},18:{name:"/m/0bt9lr",id:18,displayName:"dog"},19:{name:"/m/03k3r",id:19,displayName:"horse"},20:{name:"/m/07bgp",id:20,displayName:"sheep"},21:{name:"/m/01xq0k1",id:21,displayName:"cow"},22:{name:"/m/0bwd_0j",id:22,displayName:"elephant"},23:{name:"/m/01dws",id:23,displayName:"bear"},24:{name:"/m/0898b",id:24,displayName:"zebra"},25:{name:"/m/03bk1",id:25,displayName:"giraffe"},27:{name:"/m/01940j",id:27,displayName:"backpack"},28:{name:"/m/0hnnb",id:28,displayName:"umbrella"},31:{name:"/m/080hkjn",id:31,displayName:"handbag"},32:{name:"/m/01rkbr",id:32,displayName:"tie"},33:{name:"/m/01s55n",id:33,displayName:"suitcase"},34:{name:"/m/02wmf",id:34,displayName:"frisbee"},35:{name:"/m/071p9",id:35,displayName:"skis"},36:{name:"/m/06__v",id:36,displayName:"snowboard"},37:{name:"/m/018xm",id:37,displayName:"sports ball"},38:{name:"/m/02zt3",id:38,displayName:"kite"},39:{name:"/m/03g8mr",id:39,displayName:"baseball bat"},40:{name:"/m/03grzl",id:40,displayName:"baseball glove"},41:{name:"/m/06_fw",id:41,displayName:"skateboard"},42:{name:"/m/019w40",id:42,displayName:"surfboard"},43:{name:"/m/0dv9c",id:43,displayName:"tennis racket"},44:{name:"/m/04dr76w",id:44,displayName:"bottle"},46:{name:"/m/09tvcd",id:46,displayName:"wine glass"},47:{name:"/m/08gqpm",id:47,displayName:"cup"},48:{name:"/m/0dt3t",id:48,displayName:"fork"},49:{name:"/m/04ctx",id:49,displayName:"knife"},50:{name:"/m/0cmx8",id:50,displayName:"spoon"},51:{name:"/m/04kkgm",id:51,displayName:"bowl"},52:{name:"/m/09qck",id:52,displayName:"banana"},53:{name:"/m/014j1m",id:53,displayName:"apple"},54:{name:"/m/0l515",id:54,displayName:"sandwich"},55:{name:"/m/0cyhj_",id:55,displayName:"orange"},56:{name:"/m/0hkxq",id:56,displayName:"broccoli"},57:{name:"/m/0fj52s",id:57,displayName:"carrot"},58:{name:"/m/01b9xk",id:58,displayName:"hot dog"},59:{name:"/m/0663v",id:59,displayName:"pizza"},60:{name:"/m/0jy4k",id:60,displayName:"donut"},61:{name:"/m/0fszt",id:61,displayName:"cake"},62:{name:"/m/01mzpv",id:62,displayName:"chair"},63:{name:"/m/02crq1",id:63,displayName:"couch"},64:{name:"/m/03fp41",id:64,displayName:"potted plant"},65:{name:"/m/03ssj5",id:65,displayName:"bed"},67:{name:"/m/04bcr3",id:67,displayName:"dining table"},70:{name:"/m/09g1w",id:70,displayName:"toilet"},72:{name:"/m/07c52",id:72,displayName:"tv"},73:{name:"/m/01c648",id:73,displayName:"laptop"},74:{name:"/m/020lf",id:74,displayName:"mouse"},75:{name:"/m/0qjjc",id:75,displayName:"remote"},76:{name:"/m/01m2v",id:76,displayName:"keyboard"},77:{name:"/m/050k8",id:77,displayName:"cell phone"},78:{name:"/m/0fx9l",id:78,displayName:"microwave"},79:{name:"/m/029bxz",id:79,displayName:"oven"},80:{name:"/m/01k6s3",id:80,displayName:"toaster"},81:{name:"/m/0130jx",id:81,displayName:"sink"},82:{name:"/m/040b_t",id:82,displayName:"refrigerator"},84:{name:"/m/0bt_c3",id:84,displayName:"book"},85:{name:"/m/01x3z",id:85,displayName:"clock"},86:{name:"/m/02s195",id:86,displayName:"vase"},87:{name:"/m/01lsmm",id:87,displayName:"scissors"},88:{name:"/m/0kmg4",id:88,displayName:"teddy bear"},89:{name:"/m/03wvsk",id:89,displayName:"hair drier"},90:{name:"/m/012xff",id:90,displayName:"toothbrush"}};class U{constructor(N,L){this.modelPath=L||`https://storage.googleapis.com/tfjs-models/savedmodel/${this.getPrefix(N)}/model.json`}getPrefix(N){return N==="lite_mobilenet_v2"?`ssd${N}`:`ssd_${N}`}async load(){this.model=await C.loadGraphModel(this.modelPath);const N=S.zeros([1,300,300,3],"int32"),L=await this.model.executeAsync(N);await Promise.all(L.map(W=>W.data())),L.map(W=>W.dispose()),N.dispose()}async infer(N,L,W){const z=S.tidy(()=>(N instanceof S.Tensor||(N=S.browser.fromPixels(N)),S.expandDims(N))),q=z.shape[1],I=z.shape[2],Z=await this.model.executeAsync(z),Y=Z[0].dataSync(),G=Z[1].dataSync();z.dispose(),S.dispose(Z);const[oe,ce]=this.calculateMaxScores(Y,Z[0].shape[1],Z[0].shape[2]),be=S.getBackend();S.getBackend()==="webgl"&&S.setBackend("cpu");const Ee=S.tidy(()=>{const ge=S.tensor2d(G,[Z[1].shape[1],Z[1].shape[3]]);return S.image.nonMaxSuppression(ge,oe,L,W,W)}),ve=Ee.dataSync();return Ee.dispose(),be!==S.getBackend()&&S.setBackend(be),this.buildDetectedObjects(I,q,G,oe,ve,ce)}buildDetectedObjects(N,L,W,z,q,I){const Z=q.length,Y=[];for(let G=0;G<Z;G++){const oe=[];for(let ge=0;ge<4;ge++)oe[ge]=W[4*q[G]+ge];const ce=oe[0]*L,be=oe[1]*N,Ee=oe[2]*L,ve=oe[3]*N;oe[0]=be,oe[1]=ce,oe[2]=ve-be,oe[3]=Ee-ce,Y.push({bbox:oe,class:O[I[q[G]]+1].displayName,score:z[q[G]]})}return Y}calculateMaxScores(N,L,W){const z=[],q=[];for(let I=0;I<L;I++){let Z=Number.MIN_VALUE,Y=-1;for(let G=0;G<W;G++)N[I*W+G]>Z&&(Z=N[I*W+G],Y=G);z[I]=Z,q[I]=Y}return[z,q]}async detect(N,L=20,W=.5){return this.infer(N,L,W)}dispose(){this.model!=null&&this.model.dispose()}}l.ObjectDetection=U,l.load=async function(j={}){if(S==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");const N=j.base||"lite_mobilenet_v2",L=j.modelUrl;if(["mobilenet_v1","mobilenet_v2","lite_mobilenet_v2"].indexOf(N)===-1)throw new Error(`ObjectDetection constructed with invalid base model ${N}. Valid names are 'mobilenet_v1', 'mobilenet_v2' and 'lite_mobilenet_v2'.`);const W=new U(N,L);return await W.load(),W},l.version="2.2.2",Object.defineProperty(l,"__esModule",{value:!0})})(s,r(20),r(0))},function(u,s,r){u.exports=function l(C,S){if(C===S)return!0;if(C&&S&&typeof C=="object"&&typeof S=="object"){if(C.constructor!==S.constructor)return!1;var O,U,j;if(Array.isArray(C)){if((O=C.length)!=S.length)return!1;for(U=O;U--!=0;)if(!l(C[U],S[U]))return!1;return!0}if(C.constructor===RegExp)return C.source===S.source&&C.flags===S.flags;if(C.valueOf!==Object.prototype.valueOf)return C.valueOf()===S.valueOf();if(C.toString!==Object.prototype.toString)return C.toString()===S.toString();if((O=(j=Object.keys(C)).length)!==Object.keys(S).length)return!1;for(U=O;U--!=0;)if(!Object.prototype.hasOwnProperty.call(S,j[U]))return!1;for(U=O;U--!=0;){var N=j[U];if(!l(C[N],S[N]))return!1}return!0}return C!=C&&S!=S}},function(u,s,r){(function(l){var C=function(){function S(z,q){return q!=null&&z instanceof q}var O,U,j;try{O=Map}catch{O=function(){}}try{U=Set}catch{U=function(){}}try{j=Promise}catch{j=function(){}}function N(z,q,I,Z,Y){typeof q=="object"&&(I=q.depth,Z=q.prototype,Y=q.includeNonEnumerable,q=q.circular);var G=[],oe=[],ce=l!==void 0;return q===void 0&&(q=!0),I===void 0&&(I=1/0),function be(Ee,ve){if(Ee===null)return null;if(ve===0)return Ee;var ge,Ge;if(typeof Ee!="object")return Ee;if(S(Ee,O))ge=new O;else if(S(Ee,U))ge=new U;else if(S(Ee,j))ge=new j(function(Ut,Ft){Ee.then(function(pt){Ut(be(pt,ve-1))},function(pt){Ft(be(pt,ve-1))})});else if(N.__isArray(Ee))ge=[];else if(N.__isRegExp(Ee))ge=new RegExp(Ee.source,W(Ee)),Ee.lastIndex&&(ge.lastIndex=Ee.lastIndex);else if(N.__isDate(Ee))ge=new Date(Ee.getTime());else{if(ce&&l.isBuffer(Ee))return ge=l.allocUnsafe?l.allocUnsafe(Ee.length):new l(Ee.length),Ee.copy(ge),ge;S(Ee,Error)?ge=Object.create(Ee):Z===void 0?(Ge=Object.getPrototypeOf(Ee),ge=Object.create(Ge)):(ge=Object.create(Z),Ge=Z)}if(q){var ht=G.indexOf(Ee);if(ht!=-1)return oe[ht];G.push(Ee),oe.push(ge)}for(var It in S(Ee,O)&&Ee.forEach(function(Ut,Ft){var pt=be(Ft,ve-1),yt=be(Ut,ve-1);ge.set(pt,yt)}),S(Ee,U)&&Ee.forEach(function(Ut){var Ft=be(Ut,ve-1);ge.add(Ft)}),Ee){var St;Ge&&(St=Object.getOwnPropertyDescriptor(Ge,It)),St&&St.set==null||(ge[It]=be(Ee[It],ve-1))}if(Object.getOwnPropertySymbols){var we=Object.getOwnPropertySymbols(Ee);for(It=0;It<we.length;It++){var bt=we[It];(!(Mt=Object.getOwnPropertyDescriptor(Ee,bt))||Mt.enumerable||Y)&&(ge[bt]=be(Ee[bt],ve-1),Mt.enumerable||Object.defineProperty(ge,bt,{enumerable:!1}))}}if(Y){var jt=Object.getOwnPropertyNames(Ee);for(It=0;It<jt.length;It++){var Mt,ze=jt[It];(Mt=Object.getOwnPropertyDescriptor(Ee,ze))&&Mt.enumerable||(ge[ze]=be(Ee[ze],ve-1),Object.defineProperty(ge,ze,{enumerable:!1}))}}return ge}(z,I)}function L(z){return Object.prototype.toString.call(z)}function W(z){var q="";return z.global&&(q+="g"),z.ignoreCase&&(q+="i"),z.multiline&&(q+="m"),q}return N.clonePrototype=function(z){if(z===null)return null;var q=function(){};return q.prototype=z,new q},N.__objToStr=L,N.__isDate=function(z){return typeof z=="object"&&L(z)==="[object Date]"},N.__isArray=function(z){return typeof z=="object"&&L(z)==="[object Array]"},N.__isRegExp=function(z){return typeof z=="object"&&L(z)==="[object RegExp]"},N.__getRegExpFlags=W,N}();typeof u=="object"&&u.exports&&(u.exports=C)}).call(this,r(92).Buffer)},function(u){u.exports={name:"vega-lite",author:'Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',version:"4.13.1",collaborators:["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],homepage:"https://vega.github.io/vega-lite/",description:"Vega-Lite is a concise high-level language for interactive visualization.",main:"build/vega-lite.js",unpkg:"build/vega-lite.min.js",jsdelivr:"build/vega-lite.min.js",module:"build/src/index",types:"build/src/index.d.ts",bin:{vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"},directories:{test:"test"},scripts:{changelog:"conventional-changelog -p angular -r 2",build:"yarn build:only","build:only":"yarn tsc:src && rollup -c",postbuild:"terser build/vega-lite.js -cm --source-map content=build/vega-lite.js.map,filename=build/vega-lite.min.js.map -o build/vega-lite.min.js && yarn schema && babel build/vega-lite.js --out-dir build-es5 --config-file ./babel.config.js","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"yarn tsc:site && rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"find build ! -name 'vega-lite-schema.json' -type f -delete && rm -rf site/data/* && rm -f examples/compiled/*.png && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"pushd site && bundle exec jekyll serve -I -l && popd","tsc:src":"tsc -b src/tsconfig.src.json","tsc:site":"tsc -b site/tsconfig.site.json",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",test:"jest test/ && yarn lint && yarn schema && jest examples/ && yarn test:runtime","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand test","test:runtime":"TZ=America/Los_Angeles jest test-runtime/","test:runtime:generate":"yarn build:only && rm -Rf test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime","watch:build":"yarn build:only && concurrently --kill-others -n Typescript,Rollup 'yarn tsc:src -w' 'rollup -c -w'","watch:site":"concurrently --kill-others -n Typescript,Rollup 'yarn tsc:site -w' 'rollup -c site/rollup.config.js -w'","watch:test":"jest --watch"},repository:{type:"git",url:"https://github.com/vega/vega-lite.git"},license:"BSD-3-Clause",bugs:{url:"https://github.com/vega/vega-lite/issues"},devDependencies:{"@babel/cli":"^7.10.1","@babel/core":"^7.10.1","@babel/preset-env":"^7.10.1","@rollup/plugin-commonjs":"12.0.0","@rollup/plugin-json":"^4.0.3","@rollup/plugin-node-resolve":"^8.0.0","@types/chai":"^4.2.11","@types/d3":"^5.7.2","@types/jest":"^25.2.3","@types/mkdirp":"^1.0.0","@types/puppeteer":"^3.0.0","@typescript-eslint/eslint-plugin":"^3.0.2","@typescript-eslint/parser":"^3.0.2",ajv:"^6.12.2",chai:"^4.2.0",cheerio:"^1.0.0-rc.3",codecov:"^3.7.0",concurrently:"^5.2.0","conventional-changelog-cli":"^2.0.34",d3:"^5.16.0",eslint:"^7.1.0","eslint-config-prettier":"^6.11.0","eslint-plugin-jest":"^23.13.2","eslint-plugin-prettier":"^3.1.3","gh-pages":"^2.2.0","highlight.js":"^10.0.3","http-server":"^0.12.3",jest:"^26.0.1","jest-puppeteer":"^4.4.0",mkdirp:"^1.0.4",prettier:"^2.0.5",puppeteer:"^3.1.0",rollup:"^2.11.0","rollup-plugin-sourcemaps":"^0.6.2","rollup-plugin-terser":"^6.1.0","svg2png-many":"^0.0.7",terser:"^4.7.0","ts-jest":"^26.0.0","ts-json-schema-generator":"^0.68.1",typescript:"~3.9.3","vega-cli":"^5.12.1","vega-datasets":"^1.30.2","vega-embed":"^6.8.0","vega-tooltip":"^0.23.0","vega-typings":"^0.17.0","yaml-front-matter":"^4.1.0"},dependencies:{"@types/clone":"~0.1.30","@types/fast-json-stable-stringify":"^2.0.0","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.1","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~2.0.0",tslib:"~2.0.0","vega-event-selector":"~2.0.3","vega-expression":"~2.6.5","vega-util":"~1.14.0",yargs:"~15.3.1"},peerDependencies:{vega:"^5.12.1"},jest:{preset:"jest-puppeteer",transform:{"^.+\\.tsx?$":"ts-jest"},testRegex:"(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$",moduleFileExtensions:["ts","tsx","js","jsx","json","node"],testPathIgnorePatterns:["<rootDir>/node_modules","<rootDir>/build","<rootDir>/_site","<rootDir>/src"],coverageDirectory:"./coverage/",collectCoverage:!1}}},function(u,s,r){r.d(s,"a",function(){return z});var l=r(39),C=r(71),S=r(40),O=r(72),U=r(70),j=r(68);function N(Me){if(0<=Me.y&&Me.y<100){var rt=new Date(-1,Me.m,Me.d,Me.H,Me.M,Me.S,Me.L);return rt.setFullYear(Me.y),rt}return new Date(Me.y,Me.m,Me.d,Me.H,Me.M,Me.S,Me.L)}function L(Me){if(0<=Me.y&&Me.y<100){var rt=new Date(Date.UTC(-1,Me.m,Me.d,Me.H,Me.M,Me.S,Me.L));return rt.setUTCFullYear(Me.y),rt}return new Date(Date.UTC(Me.y,Me.m,Me.d,Me.H,Me.M,Me.S,Me.L))}function W(Me,rt,kt){return{y:Me,m:rt,d:kt,H:0,M:0,S:0,L:0}}function z(Me){var rt=Me.dateTime,kt=Me.date,en=Me.time,En=Me.periods,Nt=Me.days,Kt=Me.shortDays,hn=Me.months,un=Me.shortMonths,mt=ce(En),Tt=be(En),fn=ce(Nt),tn=be(Nt),Ve=ce(Kt),Ln=be(Kt),Xn=ce(hn),Zn=be(hn),cr=ce(un),Br=be(un),Sr={a:function(ei){return Kt[ei.getDay()]},A:function(ei){return Nt[ei.getDay()]},b:function(ei){return un[ei.getMonth()]},B:function(ei){return hn[ei.getMonth()]},c:null,d:Fn,e:Fn,f:$e,g:Ht,G:Xt,H:Rn,I:cn,j:qe,L:Qe,m:ft,M:Jt,p:function(ei){return En[+(ei.getHours()>=12)]},q:function(ei){return 1+~~(ei.getMonth()/3)},Q:me,s:Ce,S:Qt,u:Pn,U:kn,V:ke,w:ar,W:Tr,x:null,X:null,y:rn,Y:Gn,Z:Wt,"%":Se},yi={a:function(ei){return Kt[ei.getUTCDay()]},A:function(ei){return Nt[ei.getUTCDay()]},b:function(ei){return un[ei.getUTCMonth()]},B:function(ei){return hn[ei.getUTCMonth()]},c:null,d:Zt,e:Zt,f:sr,g:qr,G:Fr,H:Vn,I:xn,j:Un,L:ur,m:Er,M:Mr,p:function(ei){return En[+(ei.getUTCHours()>=12)]},q:function(ei){return 1+~~(ei.getUTCMonth()/3)},Q:me,s:Ce,S:pr,u:ri,U:Kr,V:jn,w:ir,W:Cr,x:null,X:null,y:Hr,Y:Ot,Z:$t,"%":Se},ki={a:function(ei,Xr,Kn){var di=Ve.exec(Xr.slice(Kn));return di?(ei.w=Ln.get(di[0].toLowerCase()),Kn+di[0].length):-1},A:function(ei,Xr,Kn){var di=fn.exec(Xr.slice(Kn));return di?(ei.w=tn.get(di[0].toLowerCase()),Kn+di[0].length):-1},b:function(ei,Xr,Kn){var di=cr.exec(Xr.slice(Kn));return di?(ei.m=Br.get(di[0].toLowerCase()),Kn+di[0].length):-1},B:function(ei,Xr,Kn){var di=Xn.exec(Xr.slice(Kn));return di?(ei.m=Zn.get(di[0].toLowerCase()),Kn+di[0].length):-1},c:function(ei,Xr,Kn){return gi(ei,rt,Xr,Kn)},d:Mt,e:Mt,f:nn,g:St,G:It,H:Ut,I:Ut,j:ze,L:yt,m:jt,M:Ft,p:function(ei,Xr,Kn){var di=mt.exec(Xr.slice(Kn));return di?(ei.p=Tt.get(di[0].toLowerCase()),Kn+di[0].length):-1},q:bt,Q:_t,s:Yt,S:pt,u:ve,U:ge,V:Ge,w:Ee,W:ht,x:function(ei,Xr,Kn){return gi(ei,kt,Xr,Kn)},X:function(ei,Xr,Kn){return gi(ei,en,Xr,Kn)},y:St,Y:It,Z:we,"%":xt};function Zr(ei,Xr){return function(Kn){var di,Ei,zr,oo=[],zi=-1,eo=0,wo=ei.length;for(Kn instanceof Date||(Kn=new Date(+Kn));++zi<wo;)ei.charCodeAt(zi)===37&&(oo.push(ei.slice(eo,zi)),(Ei=q[di=ei.charAt(++zi)])!=null?di=ei.charAt(++zi):Ei=di==="e"?" ":"0",(zr=Xr[di])&&(di=zr(Kn,Ei)),oo.push(di),eo=zi+1);return oo.push(ei.slice(eo,zi)),oo.join("")}}function Zi(ei,Xr){return function(Kn){var di,Ei,zr=W(1900,void 0,1);if(gi(zr,ei,Kn+="",0)!=Kn.length)return null;if("Q"in zr)return new Date(zr.Q);if("s"in zr)return new Date(1e3*zr.s+("L"in zr?zr.L:0));if(!Xr||"Z"in zr||(zr.Z=0),"p"in zr&&(zr.H=zr.H%12+12*zr.p),zr.m===void 0&&(zr.m="q"in zr?zr.q:0),"V"in zr){if(zr.V<1||zr.V>53)return null;"w"in zr||(zr.w=1),"Z"in zr?(di=(Ei=(di=L(W(zr.y,0,1))).getUTCDay())>4||Ei===0?l.a.ceil(di):Object(l.a)(di),di=C.a.offset(di,7*(zr.V-1)),zr.y=di.getUTCFullYear(),zr.m=di.getUTCMonth(),zr.d=di.getUTCDate()+(zr.w+6)%7):(di=(Ei=(di=N(W(zr.y,0,1))).getDay())>4||Ei===0?S.a.ceil(di):Object(S.a)(di),di=O.a.offset(di,7*(zr.V-1)),zr.y=di.getFullYear(),zr.m=di.getMonth(),zr.d=di.getDate()+(zr.w+6)%7)}else("W"in zr||"U"in zr)&&("w"in zr||(zr.w="u"in zr?zr.u%7:"W"in zr?1:0),Ei="Z"in zr?L(W(zr.y,0,1)).getUTCDay():N(W(zr.y,0,1)).getDay(),zr.m=0,zr.d="W"in zr?(zr.w+6)%7+7*zr.W-(Ei+5)%7:zr.w+7*zr.U-(Ei+6)%7);return"Z"in zr?(zr.H+=zr.Z/100|0,zr.M+=zr.Z%100,L(zr)):N(zr)}}function gi(ei,Xr,Kn,di){for(var Ei,zr,oo=0,zi=Xr.length,eo=Kn.length;oo<zi;){if(di>=eo)return-1;if((Ei=Xr.charCodeAt(oo++))===37){if(Ei=Xr.charAt(oo++),!(zr=ki[Ei in q?Xr.charAt(oo++):Ei])||(di=zr(ei,Kn,di))<0)return-1}else if(Ei!=Kn.charCodeAt(di++))return-1}return di}return Sr.x=Zr(kt,Sr),Sr.X=Zr(en,Sr),Sr.c=Zr(rt,Sr),yi.x=Zr(kt,yi),yi.X=Zr(en,yi),yi.c=Zr(rt,yi),{format:function(ei){var Xr=Zr(ei+="",Sr);return Xr.toString=function(){return ei},Xr},parse:function(ei){var Xr=Zi(ei+="",!1);return Xr.toString=function(){return ei},Xr},utcFormat:function(ei){var Xr=Zr(ei+="",yi);return Xr.toString=function(){return ei},Xr},utcParse:function(ei){var Xr=Zi(ei+="",!0);return Xr.toString=function(){return ei},Xr}}}var q={"-":"",_:" ",0:"0"},I=/^\s*\d+/,Z=/^%/,Y=/[\\^$*+?|[\]().{}]/g;function G(Me,rt,kt){var en=Me<0?"-":"",En=(en?-Me:Me)+"",Nt=En.length;return en+(Nt<kt?new Array(kt-Nt+1).join(rt)+En:En)}function oe(Me){return Me.replace(Y,"\\$&")}function ce(Me){return new RegExp("^(?:"+Me.map(oe).join("|")+")","i")}function be(Me){return new Map(Me.map((rt,kt)=>[rt.toLowerCase(),kt]))}function Ee(Me,rt,kt){var en=I.exec(rt.slice(kt,kt+1));return en?(Me.w=+en[0],kt+en[0].length):-1}function ve(Me,rt,kt){var en=I.exec(rt.slice(kt,kt+1));return en?(Me.u=+en[0],kt+en[0].length):-1}function ge(Me,rt,kt){var en=I.exec(rt.slice(kt,kt+2));return en?(Me.U=+en[0],kt+en[0].length):-1}function Ge(Me,rt,kt){var en=I.exec(rt.slice(kt,kt+2));return en?(Me.V=+en[0],kt+en[0].length):-1}function ht(Me,rt,kt){var en=I.exec(rt.slice(kt,kt+2));return en?(Me.W=+en[0],kt+en[0].length):-1}function It(Me,rt,kt){var en=I.exec(rt.slice(kt,kt+4));return en?(Me.y=+en[0],kt+en[0].length):-1}function St(Me,rt,kt){var en=I.exec(rt.slice(kt,kt+2));return en?(Me.y=+en[0]+(+en[0]>68?1900:2e3),kt+en[0].length):-1}function we(Me,rt,kt){var en=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(rt.slice(kt,kt+6));return en?(Me.Z=en[1]?0:-(en[2]+(en[3]||"00")),kt+en[0].length):-1}function bt(Me,rt,kt){var en=I.exec(rt.slice(kt,kt+1));return en?(Me.q=3*en[0]-3,kt+en[0].length):-1}function jt(Me,rt,kt){var en=I.exec(rt.slice(kt,kt+2));return en?(Me.m=en[0]-1,kt+en[0].length):-1}function Mt(Me,rt,kt){var en=I.exec(rt.slice(kt,kt+2));return en?(Me.d=+en[0],kt+en[0].length):-1}function ze(Me,rt,kt){var en=I.exec(rt.slice(kt,kt+3));return en?(Me.m=0,Me.d=+en[0],kt+en[0].length):-1}function Ut(Me,rt,kt){var en=I.exec(rt.slice(kt,kt+2));return en?(Me.H=+en[0],kt+en[0].length):-1}function Ft(Me,rt,kt){var en=I.exec(rt.slice(kt,kt+2));return en?(Me.M=+en[0],kt+en[0].length):-1}function pt(Me,rt,kt){var en=I.exec(rt.slice(kt,kt+2));return en?(Me.S=+en[0],kt+en[0].length):-1}function yt(Me,rt,kt){var en=I.exec(rt.slice(kt,kt+3));return en?(Me.L=+en[0],kt+en[0].length):-1}function nn(Me,rt,kt){var en=I.exec(rt.slice(kt,kt+6));return en?(Me.L=Math.floor(en[0]/1e3),kt+en[0].length):-1}function xt(Me,rt,kt){var en=Z.exec(rt.slice(kt,kt+1));return en?kt+en[0].length:-1}function _t(Me,rt,kt){var en=I.exec(rt.slice(kt));return en?(Me.Q=+en[0],kt+en[0].length):-1}function Yt(Me,rt,kt){var en=I.exec(rt.slice(kt));return en?(Me.s=+en[0],kt+en[0].length):-1}function Fn(Me,rt){return G(Me.getDate(),rt,2)}function Rn(Me,rt){return G(Me.getHours(),rt,2)}function cn(Me,rt){return G(Me.getHours()%12||12,rt,2)}function qe(Me,rt){return G(1+O.a.count(Object(U.a)(Me),Me),rt,3)}function Qe(Me,rt){return G(Me.getMilliseconds(),rt,3)}function $e(Me,rt){return Qe(Me,rt)+"000"}function ft(Me,rt){return G(Me.getMonth()+1,rt,2)}function Jt(Me,rt){return G(Me.getMinutes(),rt,2)}function Qt(Me,rt){return G(Me.getSeconds(),rt,2)}function Pn(Me){var rt=Me.getDay();return rt===0?7:rt}function kn(Me,rt){return G(S.b.count(Object(U.a)(Me)-1,Me),rt,2)}function Qn(Me){var rt=Me.getDay();return rt>=4||rt===0?Object(S.c)(Me):S.c.ceil(Me)}function ke(Me,rt){return Me=Qn(Me),G(S.c.count(Object(U.a)(Me),Me)+(Object(U.a)(Me).getDay()===4),rt,2)}function ar(Me){return Me.getDay()}function Tr(Me,rt){return G(S.a.count(Object(U.a)(Me)-1,Me),rt,2)}function rn(Me,rt){return G(Me.getFullYear()%100,rt,2)}function Ht(Me,rt){return G((Me=Qn(Me)).getFullYear()%100,rt,2)}function Gn(Me,rt){return G(Me.getFullYear()%1e4,rt,4)}function Xt(Me,rt){var kt=Me.getDay();return G((Me=kt>=4||kt===0?Object(S.c)(Me):S.c.ceil(Me)).getFullYear()%1e4,rt,4)}function Wt(Me){var rt=Me.getTimezoneOffset();return(rt>0?"-":(rt*=-1,"+"))+G(rt/60|0,"0",2)+G(rt%60,"0",2)}function Zt(Me,rt){return G(Me.getUTCDate(),rt,2)}function Vn(Me,rt){return G(Me.getUTCHours(),rt,2)}function xn(Me,rt){return G(Me.getUTCHours()%12||12,rt,2)}function Un(Me,rt){return G(1+C.a.count(Object(j.a)(Me),Me),rt,3)}function ur(Me,rt){return G(Me.getUTCMilliseconds(),rt,3)}function sr(Me,rt){return ur(Me,rt)+"000"}function Er(Me,rt){return G(Me.getUTCMonth()+1,rt,2)}function Mr(Me,rt){return G(Me.getUTCMinutes(),rt,2)}function pr(Me,rt){return G(Me.getUTCSeconds(),rt,2)}function ri(Me){var rt=Me.getUTCDay();return rt===0?7:rt}function Kr(Me,rt){return G(l.b.count(Object(j.a)(Me)-1,Me),rt,2)}function ti(Me){var rt=Me.getUTCDay();return rt>=4||rt===0?Object(l.c)(Me):l.c.ceil(Me)}function jn(Me,rt){return Me=ti(Me),G(l.c.count(Object(j.a)(Me),Me)+(Object(j.a)(Me).getUTCDay()===4),rt,2)}function ir(Me){return Me.getUTCDay()}function Cr(Me,rt){return G(l.a.count(Object(j.a)(Me)-1,Me),rt,2)}function Hr(Me,rt){return G(Me.getUTCFullYear()%100,rt,2)}function qr(Me,rt){return G((Me=ti(Me)).getUTCFullYear()%100,rt,2)}function Ot(Me,rt){return G(Me.getUTCFullYear()%1e4,rt,4)}function Fr(Me,rt){var kt=Me.getUTCDay();return G((Me=kt>=4||kt===0?Object(l.c)(Me):l.c.ceil(Me)).getUTCFullYear()%1e4,rt,4)}function $t(){return"+0000"}function Se(){return"%"}function me(Me){return+Me}function Ce(Me){return Math.floor(+Me/1e3)}},function(u,s,r){r.r(s);var l="http://www.w3.org/1999/xhtml",C={svg:"http://www.w3.org/2000/svg",xhtml:l,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},S=function(Xt){var Wt=Xt+="",Zt=Wt.indexOf(":");return Zt>=0&&(Wt=Xt.slice(0,Zt))!=="xmlns"&&(Xt=Xt.slice(Zt+1)),C.hasOwnProperty(Wt)?{space:C[Wt],local:Xt}:Xt},O=function(Xt){var Wt=S(Xt);return(Wt.local?function(Zt){return function(){return this.ownerDocument.createElementNS(Zt.space,Zt.local)}}:function(Zt){return function(){var Vn=this.ownerDocument,xn=this.namespaceURI;return xn===l&&Vn.documentElement.namespaceURI===l?Vn.createElement(Zt):Vn.createElementNS(xn,Zt)}})(Wt)};function U(){}var j=function(Xt){return Xt==null?U:function(){return this.querySelector(Xt)}};function N(){return[]}var L=function(Xt){return Xt==null?N:function(){return this.querySelectorAll(Xt)}},W=function(Xt){return function(){return this.matches(Xt)}};if(typeof document<"u"){var z=document.documentElement;if(!z.matches){var q=z.webkitMatchesSelector||z.msMatchesSelector||z.mozMatchesSelector||z.oMatchesSelector;W=function(Xt){return function(){return q.call(this,Xt)}}}}var I=W,Z=function(Xt){return new Array(Xt.length)};function Y(Xt,Wt){this.ownerDocument=Xt.ownerDocument,this.namespaceURI=Xt.namespaceURI,this._next=null,this._parent=Xt,this.__data__=Wt}Y.prototype={constructor:Y,appendChild:function(Xt){return this._parent.insertBefore(Xt,this._next)},insertBefore:function(Xt,Wt){return this._parent.insertBefore(Xt,Wt)},querySelector:function(Xt){return this._parent.querySelector(Xt)},querySelectorAll:function(Xt){return this._parent.querySelectorAll(Xt)}};var G="$";function oe(Xt,Wt,Zt,Vn,xn,Un){for(var ur,sr=0,Er=Wt.length,Mr=Un.length;sr<Mr;++sr)(ur=Wt[sr])?(ur.__data__=Un[sr],Vn[sr]=ur):Zt[sr]=new Y(Xt,Un[sr]);for(;sr<Er;++sr)(ur=Wt[sr])&&(xn[sr]=ur)}function ce(Xt,Wt,Zt,Vn,xn,Un,ur){var sr,Er,Mr,pr={},ri=Wt.length,Kr=Un.length,ti=new Array(ri);for(sr=0;sr<ri;++sr)(Er=Wt[sr])&&(ti[sr]=Mr=G+ur.call(Er,Er.__data__,sr,Wt),Mr in pr?xn[sr]=Er:pr[Mr]=Er);for(sr=0;sr<Kr;++sr)(Er=pr[Mr=G+ur.call(Xt,Un[sr],sr,Un)])?(Vn[sr]=Er,Er.__data__=Un[sr],pr[Mr]=null):Zt[sr]=new Y(Xt,Un[sr]);for(sr=0;sr<ri;++sr)(Er=Wt[sr])&&pr[ti[sr]]===Er&&(xn[sr]=Er)}function be(Xt,Wt){return Xt<Wt?-1:Xt>Wt?1:Xt>=Wt?0:NaN}var Ee=function(Xt){return Xt.ownerDocument&&Xt.ownerDocument.defaultView||Xt.document&&Xt||Xt.defaultView};function ve(Xt,Wt){return Xt.style.getPropertyValue(Wt)||Ee(Xt).getComputedStyle(Xt,null).getPropertyValue(Wt)}function ge(Xt){return Xt.trim().split(/^|\s+/)}function Ge(Xt){return Xt.classList||new ht(Xt)}function ht(Xt){this._node=Xt,this._names=ge(Xt.getAttribute("class")||"")}function It(Xt,Wt){for(var Zt=Ge(Xt),Vn=-1,xn=Wt.length;++Vn<xn;)Zt.add(Wt[Vn])}function St(Xt,Wt){for(var Zt=Ge(Xt),Vn=-1,xn=Wt.length;++Vn<xn;)Zt.remove(Wt[Vn])}ht.prototype={add:function(Xt){this._names.indexOf(Xt)<0&&(this._names.push(Xt),this._node.setAttribute("class",this._names.join(" ")))},remove:function(Xt){var Wt=this._names.indexOf(Xt);Wt>=0&&(this._names.splice(Wt,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(Xt){return this._names.indexOf(Xt)>=0}};function we(){this.textContent=""}function bt(){this.innerHTML=""}function jt(){this.nextSibling&&this.parentNode.appendChild(this)}function Mt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ze(){return null}function Ut(){var Xt=this.parentNode;Xt&&Xt.removeChild(this)}function Ft(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function pt(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}var yt={},nn=null;typeof document<"u"&&("onmouseenter"in document.documentElement||(yt={mouseenter:"mouseover",mouseleave:"mouseout"}));function xt(Xt,Wt,Zt){return Xt=_t(Xt,Wt,Zt),function(Vn){var xn=Vn.relatedTarget;xn&&(xn===this||8&xn.compareDocumentPosition(this))||Xt.call(this,Vn)}}function _t(Xt,Wt,Zt){return function(Vn){var xn=nn;nn=Vn;try{Xt.call(this,this.__data__,Wt,Zt)}finally{nn=xn}}}function Yt(Xt){return function(){var Wt=this.__on;if(Wt){for(var Zt,Vn=0,xn=-1,Un=Wt.length;Vn<Un;++Vn)Zt=Wt[Vn],Xt.type&&Zt.type!==Xt.type||Zt.name!==Xt.name?Wt[++xn]=Zt:this.removeEventListener(Zt.type,Zt.listener,Zt.capture);++xn?Wt.length=xn:delete this.__on}}}function Fn(Xt,Wt,Zt){var Vn=yt.hasOwnProperty(Xt.type)?xt:_t;return function(xn,Un,ur){var sr,Er=this.__on,Mr=Vn(Wt,Un,ur);if(Er){for(var pr=0,ri=Er.length;pr<ri;++pr)if((sr=Er[pr]).type===Xt.type&&sr.name===Xt.name)return this.removeEventListener(sr.type,sr.listener,sr.capture),this.addEventListener(sr.type,sr.listener=Mr,sr.capture=Zt),void(sr.value=Wt)}this.addEventListener(Xt.type,Mr,Zt),sr={type:Xt.type,name:Xt.name,value:Wt,listener:Mr,capture:Zt},Er?Er.push(sr):this.__on=[sr]}}function Rn(Xt,Wt,Zt,Vn){var xn=nn;Xt.sourceEvent=nn,nn=Xt;try{return Wt.apply(Zt,Vn)}finally{nn=xn}}function cn(Xt,Wt,Zt){var Vn=Ee(Xt),xn=Vn.CustomEvent;typeof xn=="function"?xn=new xn(Wt,Zt):(xn=Vn.document.createEvent("Event"),Zt?(xn.initEvent(Wt,Zt.bubbles,Zt.cancelable),xn.detail=Zt.detail):xn.initEvent(Wt,!1,!1)),Xt.dispatchEvent(xn)}var qe=[null];function Qe(Xt,Wt){this._groups=Xt,this._parents=Wt}function $e(){return new Qe([[document.documentElement]],qe)}Qe.prototype=$e.prototype={constructor:Qe,select:function(Xt){typeof Xt!="function"&&(Xt=j(Xt));for(var Wt=this._groups,Zt=Wt.length,Vn=new Array(Zt),xn=0;xn<Zt;++xn)for(var Un,ur,sr=Wt[xn],Er=sr.length,Mr=Vn[xn]=new Array(Er),pr=0;pr<Er;++pr)(Un=sr[pr])&&(ur=Xt.call(Un,Un.__data__,pr,sr))&&("__data__"in Un&&(ur.__data__=Un.__data__),Mr[pr]=ur);return new Qe(Vn,this._parents)},selectAll:function(Xt){typeof Xt!="function"&&(Xt=L(Xt));for(var Wt=this._groups,Zt=Wt.length,Vn=[],xn=[],Un=0;Un<Zt;++Un)for(var ur,sr=Wt[Un],Er=sr.length,Mr=0;Mr<Er;++Mr)(ur=sr[Mr])&&(Vn.push(Xt.call(ur,ur.__data__,Mr,sr)),xn.push(ur));return new Qe(Vn,xn)},filter:function(Xt){typeof Xt!="function"&&(Xt=I(Xt));for(var Wt=this._groups,Zt=Wt.length,Vn=new Array(Zt),xn=0;xn<Zt;++xn)for(var Un,ur=Wt[xn],sr=ur.length,Er=Vn[xn]=[],Mr=0;Mr<sr;++Mr)(Un=ur[Mr])&&Xt.call(Un,Un.__data__,Mr,ur)&&Er.push(Un);return new Qe(Vn,this._parents)},data:function(Xt,Wt){if(!Xt)return ti=new Array(this.size()),Mr=-1,this.each(function($t){ti[++Mr]=$t}),ti;var Zt=Wt?ce:oe,Vn=this._parents,xn=this._groups;typeof Xt!="function"&&(Xt=function($t){return function(){return $t}}(Xt));for(var Un=xn.length,ur=new Array(Un),sr=new Array(Un),Er=new Array(Un),Mr=0;Mr<Un;++Mr){var pr=Vn[Mr],ri=xn[Mr],Kr=ri.length,ti=Xt.call(pr,pr&&pr.__data__,Mr,Vn),jn=ti.length,ir=sr[Mr]=new Array(jn),Cr=ur[Mr]=new Array(jn);Zt(pr,ri,ir,Cr,Er[Mr]=new Array(Kr),ti,Wt);for(var Hr,qr,Ot=0,Fr=0;Ot<jn;++Ot)if(Hr=ir[Ot]){for(Ot>=Fr&&(Fr=Ot+1);!(qr=Cr[Fr])&&++Fr<jn;);Hr._next=qr||null}}return(ur=new Qe(ur,Vn))._enter=sr,ur._exit=Er,ur},enter:function(){return new Qe(this._enter||this._groups.map(Z),this._parents)},exit:function(){return new Qe(this._exit||this._groups.map(Z),this._parents)},merge:function(Xt){for(var Wt=this._groups,Zt=Xt._groups,Vn=Wt.length,xn=Zt.length,Un=Math.min(Vn,xn),ur=new Array(Vn),sr=0;sr<Un;++sr)for(var Er,Mr=Wt[sr],pr=Zt[sr],ri=Mr.length,Kr=ur[sr]=new Array(ri),ti=0;ti<ri;++ti)(Er=Mr[ti]||pr[ti])&&(Kr[ti]=Er);for(;sr<Vn;++sr)ur[sr]=Wt[sr];return new Qe(ur,this._parents)},order:function(){for(var Xt=this._groups,Wt=-1,Zt=Xt.length;++Wt<Zt;)for(var Vn,xn=Xt[Wt],Un=xn.length-1,ur=xn[Un];--Un>=0;)(Vn=xn[Un])&&(ur&&ur!==Vn.nextSibling&&ur.parentNode.insertBefore(Vn,ur),ur=Vn);return this},sort:function(Xt){function Wt(ri,Kr){return ri&&Kr?Xt(ri.__data__,Kr.__data__):!ri-!Kr}Xt||(Xt=be);for(var Zt=this._groups,Vn=Zt.length,xn=new Array(Vn),Un=0;Un<Vn;++Un){for(var ur,sr=Zt[Un],Er=sr.length,Mr=xn[Un]=new Array(Er),pr=0;pr<Er;++pr)(ur=sr[pr])&&(Mr[pr]=ur);Mr.sort(Wt)}return new Qe(xn,this._parents).order()},call:function(){var Xt=arguments[0];return arguments[0]=this,Xt.apply(null,arguments),this},nodes:function(){var Xt=new Array(this.size()),Wt=-1;return this.each(function(){Xt[++Wt]=this}),Xt},node:function(){for(var Xt=this._groups,Wt=0,Zt=Xt.length;Wt<Zt;++Wt)for(var Vn=Xt[Wt],xn=0,Un=Vn.length;xn<Un;++xn){var ur=Vn[xn];if(ur)return ur}return null},size:function(){var Xt=0;return this.each(function(){++Xt}),Xt},empty:function(){return!this.node()},each:function(Xt){for(var Wt=this._groups,Zt=0,Vn=Wt.length;Zt<Vn;++Zt)for(var xn,Un=Wt[Zt],ur=0,sr=Un.length;ur<sr;++ur)(xn=Un[ur])&&Xt.call(xn,xn.__data__,ur,Un);return this},attr:function(Xt,Wt){var Zt=S(Xt);if(arguments.length<2){var Vn=this.node();return Zt.local?Vn.getAttributeNS(Zt.space,Zt.local):Vn.getAttribute(Zt)}return this.each((Wt==null?Zt.local?function(xn){return function(){this.removeAttributeNS(xn.space,xn.local)}}:function(xn){return function(){this.removeAttribute(xn)}}:typeof Wt=="function"?Zt.local?function(xn,Un){return function(){var ur=Un.apply(this,arguments);ur==null?this.removeAttributeNS(xn.space,xn.local):this.setAttributeNS(xn.space,xn.local,ur)}}:function(xn,Un){return function(){var ur=Un.apply(this,arguments);ur==null?this.removeAttribute(xn):this.setAttribute(xn,ur)}}:Zt.local?function(xn,Un){return function(){this.setAttributeNS(xn.space,xn.local,Un)}}:function(xn,Un){return function(){this.setAttribute(xn,Un)}})(Zt,Wt))},style:function(Xt,Wt,Zt){return arguments.length>1?this.each((Wt==null?function(Vn){return function(){this.style.removeProperty(Vn)}}:typeof Wt=="function"?function(Vn,xn,Un){return function(){var ur=xn.apply(this,arguments);ur==null?this.style.removeProperty(Vn):this.style.setProperty(Vn,ur,Un)}}:function(Vn,xn,Un){return function(){this.style.setProperty(Vn,xn,Un)}})(Xt,Wt,Zt??"")):ve(this.node(),Xt)},property:function(Xt,Wt){return arguments.length>1?this.each((Wt==null?function(Zt){return function(){delete this[Zt]}}:typeof Wt=="function"?function(Zt,Vn){return function(){var xn=Vn.apply(this,arguments);xn==null?delete this[Zt]:this[Zt]=xn}}:function(Zt,Vn){return function(){this[Zt]=Vn}})(Xt,Wt)):this.node()[Xt]},classed:function(Xt,Wt){var Zt=ge(Xt+"");if(arguments.length<2){for(var Vn=Ge(this.node()),xn=-1,Un=Zt.length;++xn<Un;)if(!Vn.contains(Zt[xn]))return!1;return!0}return this.each((typeof Wt=="function"?function(ur,sr){return function(){(sr.apply(this,arguments)?It:St)(this,ur)}}:Wt?function(ur){return function(){It(this,ur)}}:function(ur){return function(){St(this,ur)}})(Zt,Wt))},text:function(Xt){return arguments.length?this.each(Xt==null?we:(typeof Xt=="function"?function(Wt){return function(){var Zt=Wt.apply(this,arguments);this.textContent=Zt??""}}:function(Wt){return function(){this.textContent=Wt}})(Xt)):this.node().textContent},html:function(Xt){return arguments.length?this.each(Xt==null?bt:(typeof Xt=="function"?function(Wt){return function(){var Zt=Wt.apply(this,arguments);this.innerHTML=Zt??""}}:function(Wt){return function(){this.innerHTML=Wt}})(Xt)):this.node().innerHTML},raise:function(){return this.each(jt)},lower:function(){return this.each(Mt)},append:function(Xt){var Wt=typeof Xt=="function"?Xt:O(Xt);return this.select(function(){return this.appendChild(Wt.apply(this,arguments))})},insert:function(Xt,Wt){var Zt=typeof Xt=="function"?Xt:O(Xt),Vn=Wt==null?ze:typeof Wt=="function"?Wt:j(Wt);return this.select(function(){return this.insertBefore(Zt.apply(this,arguments),Vn.apply(this,arguments)||null)})},remove:function(){return this.each(Ut)},clone:function(Xt){return this.select(Xt?pt:Ft)},datum:function(Xt){return arguments.length?this.property("__data__",Xt):this.node().__data__},on:function(Xt,Wt,Zt){var Vn,xn,Un=function(ri){return ri.trim().split(/^|\s+/).map(function(Kr){var ti="",jn=Kr.indexOf(".");return jn>=0&&(ti=Kr.slice(jn+1),Kr=Kr.slice(0,jn)),{type:Kr,name:ti}})}(Xt+""),ur=Un.length;if(!(arguments.length<2)){for(sr=Wt?Fn:Yt,Zt==null&&(Zt=!1),Vn=0;Vn<ur;++Vn)this.each(sr(Un[Vn],Wt,Zt));return this}var sr=this.node().__on;if(sr){for(var Er,Mr=0,pr=sr.length;Mr<pr;++Mr)for(Vn=0,Er=sr[Mr];Vn<ur;++Vn)if((xn=Un[Vn]).type===Er.type&&xn.name===Er.name)return Er.value}},dispatch:function(Xt,Wt){return this.each((typeof Wt=="function"?function(Zt,Vn){return function(){return cn(this,Zt,Vn.apply(this,arguments))}}:function(Zt,Vn){return function(){return cn(this,Zt,Vn)}})(Xt,Wt))}};var ft=$e,Jt=function(Xt){return typeof Xt=="string"?new Qe([[document.querySelector(Xt)]],[document.documentElement]):new Qe([[Xt]],qe)},Qt=function(Xt){return Jt(O(Xt).call(document.documentElement))},Pn=0;function kn(){return new Qn}function Qn(){this._="@"+(++Pn).toString(36)}Qn.prototype=kn.prototype={constructor:Qn,get:function(Xt){for(var Wt=this._;!(Wt in Xt);)if(!(Xt=Xt.parentNode))return;return Xt[Wt]},set:function(Xt,Wt){return Xt[this._]=Wt},remove:function(Xt){return this._ in Xt&&delete Xt[this._]},toString:function(){return this._}};var ke=function(){for(var Xt,Wt=nn;Xt=Wt.sourceEvent;)Wt=Xt;return Wt},ar=function(Xt,Wt){var Zt=Xt.ownerSVGElement||Xt;if(Zt.createSVGPoint){var Vn=Zt.createSVGPoint();return Vn.x=Wt.clientX,Vn.y=Wt.clientY,[(Vn=Vn.matrixTransform(Xt.getScreenCTM().inverse())).x,Vn.y]}var xn=Xt.getBoundingClientRect();return[Wt.clientX-xn.left-Xt.clientLeft,Wt.clientY-xn.top-Xt.clientTop]},Tr=function(Xt){var Wt=ke();return Wt.changedTouches&&(Wt=Wt.changedTouches[0]),ar(Xt,Wt)},rn=function(Xt){return typeof Xt=="string"?new Qe([document.querySelectorAll(Xt)],[document.documentElement]):new Qe([Xt??[]],qe)},Ht=function(Xt,Wt,Zt){arguments.length<3&&(Zt=Wt,Wt=ke().changedTouches);for(var Vn,xn=0,Un=Wt?Wt.length:0;xn<Un;++xn)if((Vn=Wt[xn]).identifier===Zt)return ar(Xt,Vn);return null},Gn=function(Xt,Wt){Wt==null&&(Wt=ke().touches);for(var Zt=0,Vn=Wt?Wt.length:0,xn=new Array(Vn);Zt<Vn;++Zt)xn[Zt]=ar(Xt,Wt[Zt]);return xn};r.d(s,"create",function(){return Qt}),r.d(s,"creator",function(){return O}),r.d(s,"local",function(){return kn}),r.d(s,"matcher",function(){return I}),r.d(s,"mouse",function(){return Tr}),r.d(s,"namespace",function(){return S}),r.d(s,"namespaces",function(){return C}),r.d(s,"clientPoint",function(){return ar}),r.d(s,"select",function(){return Jt}),r.d(s,"selectAll",function(){return rn}),r.d(s,"selection",function(){return ft}),r.d(s,"selector",function(){return j}),r.d(s,"selectorAll",function(){return L}),r.d(s,"style",function(){return ve}),r.d(s,"touch",function(){return Ht}),r.d(s,"touches",function(){return Gn}),r.d(s,"window",function(){return Ee}),r.d(s,"event",function(){return nn}),r.d(s,"customEvent",function(){return Rn})},function(u,s,r){r.r(s);var l={};r.d(l,"load",function(){return xt});var C={};r.d(C,"Darknet",function(){return $e}),r.d(C,"load",function(){return ft});var S={};r.d(S,"Doodlenet",function(){return ar}),r.d(S,"load",function(){return Tr});var O={};r.d(O,"array3DToImage",function(){return Xt}),r.d(O,"processVideo",function(){return Gn}),r.d(O,"cropImage",function(){return Wt}),r.d(O,"imgToTensor",function(){return Vn}),r.d(O,"isInstanceOfSupportedElement",function(){return xn}),r.d(O,"flipImage",function(){return Zt}),r.d(O,"imgToPixelArray",function(){return Un});var U={};r.d(U,"SpeechCommands",function(){return cr}),r.d(U,"load",function(){return Br});var j={};r.d(j,"isTensor",function(){return mo}),r.d(j,"isTensor1D",function(){return _f}),r.d(j,"isTensor2D",function(){return Sd}),r.d(j,"isTensor3D",function(){return mr}),r.d(j,"isTensor4D",function(){return ts}),r.d(j,"isFloat",function(){return Ta}),r.d(j,"isEven",function(){return no}),r.d(j,"round",function(){return Hu}),r.d(j,"isDimensions",function(){return Nc}),r.d(j,"computeReshapedDimensions",function(){return au}),r.d(j,"getCenterPoint",function(){return Ic}),r.d(j,"range",function(){return na}),r.d(j,"isValidNumber",function(){return hc}),r.d(j,"isValidProbablitiy",function(){return su});var N={};r.d(N,"drawContour",function(){return ou}),r.d(N,"drawDetections",function(){return dr}),r.d(N,"drawFaceExpressions",function(){return fu}),r.d(N,"DrawBoxOptions",function(){return nr}),r.d(N,"DrawBox",function(){return Yn}),r.d(N,"DrawFaceLandmarksOptions",function(){return fs}),r.d(N,"DrawFaceLandmarks",function(){return Ga}),r.d(N,"drawFaceLandmarks",function(){return Pc}),r.d(N,"AnchorPosition",function(){return Gt}),r.d(N,"DrawTextFieldOptions",function(){return zn}),r.d(N,"DrawTextField",function(){return Hn});var L={};r.d(L,"draw",function(){return N}),r.d(L,"utils",function(){return j}),r.d(L,"tf",function(){return vn}),r.d(L,"env",function(){return on}),r.d(L,"FaceLandmarkNet",function(){return av}),r.d(L,"createFaceRecognitionNet",function(){return Zg}),r.d(L,"createMtcnn",function(){return d0}),r.d(L,"sigmoid",function(){return Il}),r.d(L,"inverseSigmoid",function(){return jh}),r.d(L,"createSsdMobilenetv1",function(){return lv}),r.d(L,"createFaceDetectionNet",function(){return fv}),r.d(L,"FaceDetectionNet",function(){return D1}),r.d(L,"createTinyFaceDetector",function(){return dg}),r.d(L,"TinyYolov2",function(){return Hh}),r.d(L,"createTinyYolov2",function(){return I1}),r.d(L,"euclideanDistance",function(){return f0}),r.d(L,"NeuralNetwork",function(){return Ui}),r.d(L,"resizeResults",function(){return wv}),r.d(L,"AgeGenderNet",function(){return iv}),r.d(L,"Gender",function(){return Sf}),r.d(L,"BoundingBox",function(){return Ba}),r.d(L,"Box",function(){return ws}),r.d(L,"Dimensions",function(){return Ls}),r.d(L,"FaceDetection",function(){return ra}),r.d(L,"FaceLandmarks",function(){return cu}),r.d(L,"FaceLandmarks5",function(){return $u}),r.d(L,"FaceLandmarks68",function(){return Xu}),r.d(L,"FaceMatch",function(){return _u}),r.d(L,"LabeledBox",function(){return zh}),r.d(L,"LabeledFaceDescriptors",function(){return kd}),r.d(L,"ObjectDetection",function(){return _s}),r.d(L,"Point",function(){return vo}),r.d(L,"PredictedBox",function(){return Cd}),r.d(L,"Rect",function(){return Fl}),r.d(L,"awaitMediaLoaded",function(){return Ar}),r.d(L,"bufferToImage",function(){return Gr}),r.d(L,"createCanvas",function(){return Ir}),r.d(L,"createCanvasFromMedia",function(){return ai}),r.d(L,"extractFaces",function(){return fo}),r.d(L,"extractFaceTensors",function(){return lo}),r.d(L,"fetchImage",function(){return $i}),r.d(L,"fetchJson",function(){return ho}),r.d(L,"fetchNetWeights",function(){return fa}),r.d(L,"fetchOrThrow",function(){return qo}),r.d(L,"getContext2dOrThrow",function(){return Mn}),r.d(L,"getMediaDimensions",function(){return ii}),r.d(L,"imageTensorToCanvas",function(){return ni}),r.d(L,"imageToSquare",function(){return _i}),r.d(L,"isMediaElement",function(){return bi}),r.d(L,"isMediaLoaded",function(){return gr}),r.d(L,"loadWeightMap",function(){return ia}),r.d(L,"matchDimensions",function(){return Vi}),r.d(L,"NetInput",function(){return oi}),r.d(L,"resolveInput",function(){return dt}),r.d(L,"toNetInput",function(){return pi}),r.d(L,"FaceExpressionNet",function(){return go}),r.d(L,"FACE_EXPRESSION_LABELS",function(){return Bs}),r.d(L,"FaceExpressions",function(){return Ss}),r.d(L,"FaceLandmark68Net",function(){return Jg}),r.d(L,"FaceLandmark68TinyNet",function(){return Qg}),r.d(L,"FaceRecognitionNet",function(){return rm}),r.d(L,"extendWithFaceDescriptor",function(){return e0}),r.d(L,"isWithFaceDetection",function(){return Ef}),r.d(L,"extendWithFaceDetection",function(){return Ad}),r.d(L,"isWithFaceExpressions",function(){return js}),r.d(L,"extendWithFaceExpressions",function(){return ns}),r.d(L,"isWithFaceLandmarks",function(){return il}),r.d(L,"extendWithFaceLandmarks",function(){return $o}),r.d(L,"isWithAge",function(){return Sy}),r.d(L,"extendWithAge",function(){return t0}),r.d(L,"isWithGender",function(){return Uh}),r.d(L,"extendWithGender",function(){return Md}),r.d(L,"allFacesSsdMobilenetv1",function(){return lg}),r.d(L,"allFacesTinyYolov2",function(){return Yh}),r.d(L,"allFacesMtcnn",function(){return fg}),r.d(L,"allFaces",function(){return l0}),r.d(L,"ComposableTask",function(){return jl}),r.d(L,"ComputeFaceDescriptorsTaskBase",function(){return fm}),r.d(L,"ComputeAllFaceDescriptorsTask",function(){return Bc}),r.d(L,"ComputeSingleFaceDescriptorTask",function(){return jd}),r.d(L,"detectSingleFace",function(){return cg}),r.d(L,"detectAllFaces",function(){return If}),r.d(L,"DetectFacesTaskBase",function(){return sg}),r.d(L,"DetectAllFacesTask",function(){return ug}),r.d(L,"DetectSingleFaceTask",function(){return xv}),r.d(L,"DetectFaceLandmarksTaskBase",function(){return zd}),r.d(L,"DetectAllFaceLandmarksTask",function(){return dm}),r.d(L,"DetectSingleFaceLandmarksTask",function(){return ag}),r.d(L,"FaceMatcher",function(){return hm}),r.d(L,"nets",function(){return po}),r.d(L,"ssdMobilenetv1",function(){return Tf}),r.d(L,"tinyFaceDetector",function(){return qh}),r.d(L,"tinyYolov2",function(){return Ay}),r.d(L,"mtcnn",function(){return Oy}),r.d(L,"detectFaceLandmarks",function(){return rg}),r.d(L,"detectFaceLandmarksTiny",function(){return Mf}),r.d(L,"computeFaceDescriptor",function(){return zl}),r.d(L,"recognizeFaceExpressions",function(){return cm}),r.d(L,"predictAgeAndGender",function(){return $h}),r.d(L,"loadSsdMobilenetv1Model",function(){return Rd}),r.d(L,"loadTinyFaceDetectorModel",function(){return Df}),r.d(L,"loadMtcnnModel",function(){return Nf}),r.d(L,"loadTinyYolov2Model",function(){return Zu}),r.d(L,"loadFaceLandmarkModel",function(){return Xh}),r.d(L,"loadFaceLandmarkTinyModel",function(){return Pd}),r.d(L,"loadFaceRecognitionModel",function(){return Ul}),r.d(L,"loadFaceExpressionModel",function(){return ul}),r.d(L,"loadAgeGenderModel",function(){return Ld}),r.d(L,"loadFaceDetectionModel",function(){return ig}),r.d(L,"locateFaces",function(){return Bd}),r.d(L,"detectLandmarks",function(){return cl}),r.d(L,"Mtcnn",function(){return Nd}),r.d(L,"MtcnnOptions",function(){return al}),r.d(L,"iou",function(){return uu}),r.d(L,"minBbox",function(){return Gu}),r.d(L,"nonMaxSuppression",function(){return pc}),r.d(L,"normalize",function(){return Fc}),r.d(L,"padToSquare",function(){return qu}),r.d(L,"shuffleArray",function(){return Nl}),r.d(L,"SsdMobilenetv1",function(){return am}),r.d(L,"SsdMobilenetv1Options",function(){return sl}),r.d(L,"TinyFaceDetector",function(){return Fd}),r.d(L,"TinyFaceDetectorOptions",function(){return tg}),r.d(L,"TinyYolov2SizeType",function(){return o0}),r.d(L,"TinyYolov2Options",function(){return Vh}),r.d(L,"validateConfig",function(){return pv});var W={};r.d(W,"getRobin",function(){return km}),r.d(W,"getImageData",function(){return Fy});var z=r(18),q=r.n(z),I=r(2),Z=r(67),Y=r(6),G=r.n(Y),oe=r(10),ce=r.n(oe),be=r(9),Ee=r.n(be),ve=r(4),ge=r.n(ve);function Ge($,M){return M?new Promise(function(T,A){$.then(function(P){M(void 0,P),T(P)}).catch(function(P){M(P),A(P)})}):$}var ht=function(){function $(M,T,A,P){ce()(this,$),this.model=M,this.audioContext=T,this.stream=A,this.frequency=null,this.ready=Ge(this.loadModel(M),P)}return Ee()($,[{key:"loadModel",value:function(){var M=G()(ge.a.mark(function T(A){return ge.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,I.loadLayersModel("".concat(A,"/model.json"));case 2:if(this.model=P.sent,!this.audioContext){P.next=8;break}return P.next=6,this.processStream();case 6:P.next=9;break;case 8:throw new Error("Could not access microphone - getUserMedia not available");case 9:return P.abrupt("return",this);case 10:case"end":return P.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"processStream",value:function(){var M=G()(ge.a.mark(function T(){var A,P,J,ie,pe;return ge.a.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:return Ae.next=2,I.nextFrame();case 2:for(A=this.audioContext.createMediaStreamSource(this.stream),P=this.audioContext.sampleRate/16e3*1024,J=4;J<P;)J*=2;(ie=this.audioContext.createScriptProcessor(J,1,1)).onaudioprocess=this.processMicrophoneBuffer.bind(this),(pe=this.audioContext.createGain()).gain.setValueAtTime(0,this.audioContext.currentTime),A.connect(ie),ie.connect(pe),pe.connect(this.audioContext.destination),this.audioContext.state!=="running"&&console.warn("User gesture needed to start AudioContext, please click");case 14:case"end":return Ae.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"processMicrophoneBuffer",value:function(){var M=G()(ge.a.mark(function T(A){var P=this;return ge.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,I.nextFrame();case 2:this.results={},$.resample(A.inputBuffer,function(ie){I.tidy(function(){var pe=I.add(I.linspace(0,7180,360),I.tensor(1997.379408437619));P.running=!0;var Ae=I.tensor(ie.slice(0,1024)),Ie=I.sub(Ae,I.mean(Ae)),De=I.tensor(I.norm(Ie).dataSync()/Math.sqrt(1024)),et=I.div(Ie,De).reshape([1,1024]),ot=P.model.predict([et]).reshape([360]),Bt=ot.max().dataSync()[0],Vt=ot.argMax().dataSync()[0];P.results.confidence=Bt.toFixed(3);var yn=Math.max(0,Vt-4),_n=Math.min(360,Vt+5),Dn=ot.slice([yn],[_n-yn]),Nn=pe.slice([yn],[_n-yn]),Wn=I.mul(Dn,Nn).dataSync().reduce(function(wr,Dr){return wr+Dr},0)/Dn.dataSync().reduce(function(wr,Dr){return wr+Dr},0),Jn=10*Math.pow(2,Wn/1200),Cn=Bt>.5?Jn:null;P.frequency=Cn})});case 4:case"end":return J.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"getPitch",value:function(){var M=G()(ge.a.mark(function T(A){var P;return ge.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,this.ready;case 2:return J.next=4,I.nextFrame();case 4:return P=this.frequency,A&&A(void 0,P),J.abrupt("return",P);case 7:case"end":return J.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()}],[{key:"resample",value:function(M,T){for(var A=M.sampleRate%16e3!=0,P=M.sampleRate/16e3,J=M.getChannelData(0),ie=new Float32Array(1024),pe=0;pe<1024;pe+=1)if(A){var Ae=Math.floor(pe*P),Ie=Ae+1,De=pe*P-Ae;ie[pe]=(1-De)*J[Ae]+De*J[Ie]}else ie[pe]=J[pe*P];T(ie)}}]),$}(),It=function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"./",M=arguments.length>1?arguments[1]:void 0,T=arguments.length>2?arguments[2]:void 0,A=arguments.length>3?arguments[3]:void 0;return new ht($,M,T,A)},St=r(7),we=r.n(St),bt=r(17),jt=r.n(bt),Mt=r(20),ze=r(0);function Ut($,M,T,A){return new(T||(T=Promise))(function(P,J){function ie(Ie){try{Ae(A.next(Ie))}catch(De){J(De)}}function pe(Ie){try{Ae(A.throw(Ie))}catch(De){J(De)}}function Ae(Ie){Ie.done?P(Ie.value):new T(function(De){De(Ie.value)}).then(ie,pe)}Ae((A=A.apply($,M||[])).next())})}function Ft($,M){var T,A,P,J,ie={label:0,sent:function(){if(1&P[0])throw P[1];return P[1]},trys:[],ops:[]};return J={next:pe(0),throw:pe(1),return:pe(2)},typeof Symbol=="function"&&(J[Symbol.iterator]=function(){return this}),J;function pe(Ae){return function(Ie){return function(De){if(T)throw new TypeError("Generator is already executing.");for(;ie;)try{if(T=1,A&&(P=2&De[0]?A.return:De[0]?A.throw||((P=A.return)&&P.call(A),0):A.next)&&!(P=P.call(A,De[1])).done)return P;switch(A=0,P&&(De=[2&De[0],P.value]),De[0]){case 0:case 1:P=De;break;case 4:return ie.label++,{value:De[1],done:!1};case 5:ie.label++,A=De[1],De=[0];continue;case 7:De=ie.ops.pop(),ie.trys.pop();continue;default:if(!(P=(P=ie.trys).length>0&&P[P.length-1])&&(De[0]===6||De[0]===2)){ie=0;continue}if(De[0]===3&&(!P||De[1]>P[0]&&De[1]<P[3])){ie.label=De[1];break}if(De[0]===6&&ie.label<P[1]){ie.label=P[1],P=De;break}if(P&&ie.label<P[2]){ie.label=P[2],ie.ops.push(De);break}P[2]&&ie.ops.pop(),ie.trys.pop();continue}De=M.call($,ie)}catch(et){De=[6,et],A=0}finally{T=P=0}if(5&De[0])throw De[1];return{value:De[0]?De[1]:void 0,done:!0}}([Ae,Ie])}}}var pt={0:"tench, Tinca tinca",1:"goldfish, Carassius auratus",2:"great white shark, white shark, man-eater, man-eating shark, Carcharodon carcharias",3:"tiger shark, Galeocerdo cuvieri",4:"hammerhead, hammerhead shark",5:"electric ray, crampfish, numbfish, torpedo",6:"stingray",7:"cock",8:"hen",9:"ostrich, Struthio camelus",10:"brambling, Fringilla montifringilla",11:"goldfinch, Carduelis carduelis",12:"house finch, linnet, Carpodacus mexicanus",13:"junco, snowbird",14:"indigo bunting, indigo finch, indigo bird, Passerina cyanea",15:"robin, American robin, Turdus migratorius",16:"bulbul",17:"jay",18:"magpie",19:"chickadee",20:"water ouzel, dipper",21:"kite",22:"bald eagle, American eagle, Haliaeetus leucocephalus",23:"vulture",24:"great grey owl, great gray owl, Strix nebulosa",25:"European fire salamander, Salamandra salamandra",26:"common newt, Triturus vulgaris",27:"eft",28:"spotted salamander, Ambystoma maculatum",29:"axolotl, mud puppy, Ambystoma mexicanum",30:"bullfrog, Rana catesbeiana",31:"tree frog, tree-frog",32:"tailed frog, bell toad, ribbed toad, tailed toad, Ascaphus trui",33:"loggerhead, loggerhead turtle, Caretta caretta",34:"leatherback turtle, leatherback, leathery turtle, Dermochelys coriacea",35:"mud turtle",36:"terrapin",37:"box turtle, box tortoise",38:"banded gecko",39:"common iguana, iguana, Iguana iguana",40:"American chameleon, anole, Anolis carolinensis",41:"whiptail, whiptail lizard",42:"agama",43:"frilled lizard, Chlamydosaurus kingi",44:"alligator lizard",45:"Gila monster, Heloderma suspectum",46:"green lizard, Lacerta viridis",47:"African chameleon, Chamaeleo chamaeleon",48:"Komodo dragon, Komodo lizard, dragon lizard, giant lizard, Varanus komodoensis",49:"African crocodile, Nile crocodile, Crocodylus niloticus",50:"American alligator, Alligator mississipiensis",51:"triceratops",52:"thunder snake, worm snake, Carphophis amoenus",53:"ringneck snake, ring-necked snake, ring snake",54:"hognose snake, puff adder, sand viper",55:"green snake, grass snake",56:"king snake, kingsnake",57:"garter snake, grass snake",58:"water snake",59:"vine snake",60:"night snake, Hypsiglena torquata",61:"boa constrictor, Constrictor constrictor",62:"rock python, rock snake, Python sebae",63:"Indian cobra, Naja naja",64:"green mamba",65:"sea snake",66:"horned viper, cerastes, sand viper, horned asp, Cerastes cornutus",67:"diamondback, diamondback rattlesnake, Crotalus adamanteus",68:"sidewinder, horned rattlesnake, Crotalus cerastes",69:"trilobite",70:"harvestman, daddy longlegs, Phalangium opilio",71:"scorpion",72:"black and gold garden spider, Argiope aurantia",73:"barn spider, Araneus cavaticus",74:"garden spider, Aranea diademata",75:"black widow, Latrodectus mactans",76:"tarantula",77:"wolf spider, hunting spider",78:"tick",79:"centipede",80:"black grouse",81:"ptarmigan",82:"ruffed grouse, partridge, Bonasa umbellus",83:"prairie chicken, prairie grouse, prairie fowl",84:"peacock",85:"quail",86:"partridge",87:"African grey, African gray, Psittacus erithacus",88:"macaw",89:"sulphur-crested cockatoo, Kakatoe galerita, Cacatua galerita",90:"lorikeet",91:"coucal",92:"bee eater",93:"hornbill",94:"hummingbird",95:"jacamar",96:"toucan",97:"drake",98:"red-breasted merganser, Mergus serrator",99:"goose",100:"black swan, Cygnus atratus",101:"tusker",102:"echidna, spiny anteater, anteater",103:"platypus, duckbill, duckbilled platypus, duck-billed platypus, Ornithorhynchus anatinus",104:"wallaby, brush kangaroo",105:"koala, koala bear, kangaroo bear, native bear, Phascolarctos cinereus",106:"wombat",107:"jelly fish",108:"sea anemone, anemone",109:"brain coral",110:"flatworm, platyhelminth",111:"nematode, nematode worm, roundworm",112:"conch",113:"snail",114:"slug",115:"sea slug, nudibranch",116:"chiton, coat-of-mail shell, sea cradle, polyplacophore",117:"chambered nautilus, pearly nautilus, nautilus",118:"Dungeness crab, Cancer magister",119:"rock crab, Cancer irroratus",120:"fiddler crab",121:"king crab, Alaska crab, Alaskan king crab, Alaska king crab, Paralithodes camtschatica",122:"American lobster, Northern lobster, Maine lobster, Homarus americanus",123:"spiny lobster, langouste, rock lobster, crawfish, crayfish, sea crawfish",124:"crayfish, crawfish, crawdad, crawdaddy",125:"hermit crab",126:"isopod",127:"white stork, Ciconia ciconia",128:"black stork, Ciconia nigra",129:"spoonbill",130:"flamingo",131:"little blue heron, Egretta caerulea",132:"American egret, great white heron, Egretta albus",133:"bittern",134:"crane",135:"limpkin, Aramus pictus",136:"European gallinule, Porphyrio porphyrio",137:"American coot, marsh hen, mud hen, water hen, Fulica americana",138:"bustard",139:"ruddy turnstone, Arenaria interpres",140:"red-backed sandpiper, dunlin, Erolia alpina",141:"redshank, Tringa totanus",142:"dowitcher",143:"oystercatcher, oyster catcher",144:"pelican",145:"king penguin, Aptenodytes patagonica",146:"albatross, mollymawk",147:"grey whale, gray whale, devilfish, Eschrichtius gibbosus, Eschrichtius robustus",148:"killer whale, killer, orca, grampus, sea wolf, Orcinus orca",149:"dugong, Dugong dugon",150:"sea lion",151:"Chihuahua",152:"Japanese spaniel",153:"Maltese dog, Maltese terrier, Maltese",154:"Pekinese, Pekingese, Peke",155:"Shih-Tzu",156:"Blenheim spaniel",157:"papillon",158:"toy terrier",159:"Rhodesian ridgeback",160:"Afghan hound, Afghan",161:"basset, basset hound",162:"beagle",163:"bloodhound, sleuthhound",164:"bluetick",165:"black-and-tan coonhound",166:"Walker hound, Walker foxhound",167:"English foxhound",168:"redbone",169:"borzoi, Russian wolfhound",170:"Irish wolfhound",171:"Italian greyhound",172:"whippet",173:"Ibizan hound, Ibizan Podenco",174:"Norwegian elkhound, elkhound",175:"otterhound, otter hound",176:"Saluki, gazelle hound",177:"Scottish deerhound, deerhound",178:"Weimaraner",179:"Staffordshire bullterrier, Staffordshire bull terrier",180:"American Staffordshire terrier, Staffordshire terrier, American pit bull terrier, pit bull terrier",181:"Bedlington terrier",182:"Border terrier",183:"Kerry blue terrier",184:"Irish terrier",185:"Norfolk terrier",186:"Norwich terrier",187:"Yorkshire terrier",188:"wire-haired fox terrier",189:"Lakeland terrier",190:"Sealyham terrier, Sealyham",191:"Airedale, Airedale terrier",192:"cairn, cairn terrier",193:"Australian terrier",194:"Dandie Dinmont, Dandie Dinmont terrier",195:"Boston bull, Boston terrier",196:"miniature schnauzer",197:"giant schnauzer",198:"standard schnauzer",199:"Scotch terrier, Scottish terrier, Scottie",200:"Tibetan terrier, chrysanthemum dog",201:"silky terrier, Sydney silky",202:"soft-coated wheaten terrier",203:"West Highland white terrier",204:"Lhasa, Lhasa apso",205:"flat-coated retriever",206:"curly-coated retriever",207:"golden retriever",208:"Labrador retriever",209:"Chesapeake Bay retriever",210:"German short-haired pointer",211:"vizsla, Hungarian pointer",212:"English setter",213:"Irish setter, red setter",214:"Gordon setter",215:"Brittany spaniel",216:"clumber, clumber spaniel",217:"English springer, English springer spaniel",218:"Welsh springer spaniel",219:"cocker spaniel, English cocker spaniel, cocker",220:"Sussex spaniel",221:"Irish water spaniel",222:"kuvasz",223:"schipperke",224:"groenendael",225:"malinois",226:"briard",227:"kelpie",228:"komondor",229:"Old English sheepdog, bobtail",230:"Shetland sheepdog, Shetland sheep dog, Shetland",231:"collie",232:"Border collie",233:"Bouvier des Flandres, Bouviers des Flandres",234:"Rottweiler",235:"German shepherd, German shepherd dog, German police dog, alsatian",236:"Doberman, Doberman pinscher",237:"miniature pinscher",238:"Greater Swiss Mountain dog",239:"Bernese mountain dog",240:"Appenzeller",241:"EntleBucher",242:"boxer",243:"bull mastiff",244:"Tibetan mastiff",245:"French bulldog",246:"Great Dane",247:"Saint Bernard, St Bernard",248:"Eskimo dog, husky",249:"malamute, malemute, Alaskan malamute",250:"Siberian husky",251:"dalmatian, coach dog, carriage dog",252:"affenpinscher, monkey pinscher, monkey dog",253:"basenji",254:"pug, pug-dog",255:"Leonberg",256:"Newfoundland, Newfoundland dog",257:"Great Pyrenees",258:"Samoyed, Samoyede",259:"Pomeranian",260:"chow, chow chow",261:"keeshond",262:"Brabancon griffon",263:"Pembroke, Pembroke Welsh corgi",264:"Cardigan, Cardigan Welsh corgi",265:"toy poodle",266:"miniature poodle",267:"standard poodle",268:"Mexican hairless",269:"timber wolf, grey wolf, gray wolf, Canis lupus",270:"white wolf, Arctic wolf, Canis lupus tundrarum",271:"red wolf, maned wolf, Canis rufus, Canis niger",272:"coyote, prairie wolf, brush wolf, Canis latrans",273:"dingo, warrigal, warragal, Canis dingo",274:"dhole, Cuon alpinus",275:"African hunting dog, hyena dog, Cape hunting dog, Lycaon pictus",276:"hyena, hyaena",277:"red fox, Vulpes vulpes",278:"kit fox, Vulpes macrotis",279:"Arctic fox, white fox, Alopex lagopus",280:"grey fox, gray fox, Urocyon cinereoargenteus",281:"tabby, tabby cat",282:"tiger cat",283:"Persian cat",284:"Siamese cat, Siamese",285:"Egyptian cat",286:"cougar, puma, catamount, mountain lion, painter, panther, Felis concolor",287:"lynx, catamount",288:"leopard, Panthera pardus",289:"snow leopard, ounce, Panthera uncia",290:"jaguar, panther, Panthera onca, Felis onca",291:"lion, king of beasts, Panthera leo",292:"tiger, Panthera tigris",293:"cheetah, chetah, Acinonyx jubatus",294:"brown bear, bruin, Ursus arctos",295:"American black bear, black bear, Ursus americanus, Euarctos americanus",296:"ice bear, polar bear, Ursus Maritimus, Thalarctos maritimus",297:"sloth bear, Melursus ursinus, Ursus ursinus",298:"mongoose",299:"meerkat, mierkat",300:"tiger beetle",301:"ladybug, ladybeetle, lady beetle, ladybird, ladybird beetle",302:"ground beetle, carabid beetle",303:"long-horned beetle, longicorn, longicorn beetle",304:"leaf beetle, chrysomelid",305:"dung beetle",306:"rhinoceros beetle",307:"weevil",308:"fly",309:"bee",310:"ant, emmet, pismire",311:"grasshopper, hopper",312:"cricket",313:"walking stick, walkingstick, stick insect",314:"cockroach, roach",315:"mantis, mantid",316:"cicada, cicala",317:"leafhopper",318:"lacewing, lacewing fly",319:"dragonfly, darning needle, devil's darning needle, sewing needle, snake feeder, snake doctor, mosquito hawk, skeeter hawk",320:"damselfly",321:"admiral",322:"ringlet, ringlet butterfly",323:"monarch, monarch butterfly, milkweed butterfly, Danaus plexippus",324:"cabbage butterfly",325:"sulphur butterfly, sulfur butterfly",326:"lycaenid, lycaenid butterfly",327:"starfish, sea star",328:"sea urchin",329:"sea cucumber, holothurian",330:"wood rabbit, cottontail, cottontail rabbit",331:"hare",332:"Angora, Angora rabbit",333:"hamster",334:"porcupine, hedgehog",335:"fox squirrel, eastern fox squirrel, Sciurus niger",336:"marmot",337:"beaver",338:"guinea pig, Cavia cobaya",339:"sorrel",340:"zebra",341:"hog, pig, grunter, squealer, Sus scrofa",342:"wild boar, boar, Sus scrofa",343:"warthog",344:"hippopotamus, hippo, river horse, Hippopotamus amphibius",345:"ox",346:"water buffalo, water ox, Asiatic buffalo, Bubalus bubalis",347:"bison",348:"ram, tup",349:"bighorn, bighorn sheep, cimarron, Rocky Mountain bighorn, Rocky Mountain sheep, Ovis canadensis",350:"ibex, Capra ibex",351:"hartebeest",352:"impala, Aepyceros melampus",353:"gazelle",354:"Arabian camel, dromedary, Camelus dromedarius",355:"llama",356:"weasel",357:"mink",358:"polecat, fitch, foulmart, foumart, Mustela putorius",359:"black-footed ferret, ferret, Mustela nigripes",360:"otter",361:"skunk, polecat, wood pussy",362:"badger",363:"armadillo",364:"three-toed sloth, ai, Bradypus tridactylus",365:"orangutan, orang, orangutang, Pongo pygmaeus",366:"gorilla, Gorilla gorilla",367:"chimpanzee, chimp, Pan troglodytes",368:"gibbon, Hylobates lar",369:"siamang, Hylobates syndactylus, Symphalangus syndactylus",370:"guenon, guenon monkey",371:"patas, hussar monkey, Erythrocebus patas",372:"baboon",373:"macaque",374:"langur",375:"colobus, colobus monkey",376:"proboscis monkey, Nasalis larvatus",377:"marmoset",378:"capuchin, ringtail, Cebus capucinus",379:"howler monkey, howler",380:"titi, titi monkey",381:"spider monkey, Ateles geoffroyi",382:"squirrel monkey, Saimiri sciureus",383:"Madagascar cat, ring-tailed lemur, Lemur catta",384:"indri, indris, Indri indri, Indri brevicaudatus",385:"Indian elephant, Elephas maximus",386:"African elephant, Loxodonta africana",387:"lesser panda, red panda, panda, bear cat, cat bear, Ailurus fulgens",388:"giant panda, panda, panda bear, coon bear, Ailuropoda melanoleuca",389:"barracouta, snoek",390:"eel",391:"coho, cohoe, coho salmon, blue jack, silver salmon, Oncorhynchus kisutch",392:"rock beauty, Holocanthus tricolor",393:"anemone fish",394:"sturgeon",395:"gar, garfish, garpike, billfish, Lepisosteus osseus",396:"lionfish",397:"puffer, pufferfish, blowfish, globefish",398:"abacus",399:"abaya",400:"academic gown, academic robe, judge's robe",401:"accordion, piano accordion, squeeze box",402:"acoustic guitar",403:"aircraft carrier, carrier, flattop, attack aircraft carrier",404:"airliner",405:"airship, dirigible",406:"altar",407:"ambulance",408:"amphibian, amphibious vehicle",409:"analog clock",410:"apiary, bee house",411:"apron",412:"ashcan, trash can, garbage can, wastebin, ash bin, ash-bin, ashbin, dustbin, trash barrel, trash bin",413:"assault rifle, assault gun",414:"backpack, back pack, knapsack, packsack, rucksack, haversack",415:"bakery, bakeshop, bakehouse",416:"balance beam, beam",417:"balloon",418:"ballpoint, ballpoint pen, ballpen, Biro",419:"Band Aid",420:"banjo",421:"bannister, banister, balustrade, balusters, handrail",422:"barbell",423:"barber chair",424:"barbershop",425:"barn",426:"barometer",427:"barrel, cask",428:"barrow, garden cart, lawn cart, wheelbarrow",429:"baseball",430:"basketball",431:"bassinet",432:"bassoon",433:"bathing cap, swimming cap",434:"bath towel",435:"bathtub, bathing tub, bath, tub",436:"beach wagon, station wagon, wagon, estate car, beach waggon, station waggon, waggon",437:"beacon, lighthouse, beacon light, pharos",438:"beaker",439:"bearskin, busby, shako",440:"beer bottle",441:"beer glass",442:"bell cote, bell cot",443:"bib",444:"bicycle-built-for-two, tandem bicycle, tandem",445:"bikini, two-piece",446:"binder, ring-binder",447:"binoculars, field glasses, opera glasses",448:"birdhouse",449:"boathouse",450:"bobsled, bobsleigh, bob",451:"bolo tie, bolo, bola tie, bola",452:"bonnet, poke bonnet",453:"bookcase",454:"bookshop, bookstore, bookstall",455:"bottlecap",456:"bow",457:"bow tie, bow-tie, bowtie",458:"brass, memorial tablet, plaque",459:"brassiere, bra, bandeau",460:"breakwater, groin, groyne, mole, bulwark, seawall, jetty",461:"breastplate, aegis, egis",462:"broom",463:"bucket, pail",464:"buckle",465:"bulletproof vest",466:"bullet train, bullet",467:"butcher shop, meat market",468:"cab, hack, taxi, taxicab",469:"caldron, cauldron",470:"candle, taper, wax light",471:"cannon",472:"canoe",473:"can opener, tin opener",474:"cardigan",475:"car mirror",476:"carousel, carrousel, merry-go-round, roundabout, whirligig",477:"carpenter's kit, tool kit",478:"carton",479:"car wheel",480:"cash machine, cash dispenser, automated teller machine, automatic teller machine, automated teller, automatic teller, ATM",481:"cassette",482:"cassette player",483:"castle",484:"catamaran",485:"CD player",486:"cello, violoncello",487:"cellular telephone, cellular phone, cellphone, cell, mobile phone",488:"chain",489:"chainlink fence",490:"chain mail, ring mail, mail, chain armor, chain armour, ring armor, ring armour",491:"chain saw, chainsaw",492:"chest",493:"chiffonier, commode",494:"chime, bell, gong",495:"china cabinet, china closet",496:"Christmas stocking",497:"church, church building",498:"cinema, movie theater, movie theatre, movie house, picture palace",499:"cleaver, meat cleaver, chopper",500:"cliff dwelling",501:"cloak",502:"clog, geta, patten, sabot",503:"cocktail shaker",504:"coffee mug",505:"coffeepot",506:"coil, spiral, volute, whorl, helix",507:"combination lock",508:"computer keyboard, keypad",509:"confectionery, confectionary, candy store",510:"container ship, containership, container vessel",511:"convertible",512:"corkscrew, bottle screw",513:"cornet, horn, trumpet, trump",514:"cowboy boot",515:"cowboy hat, ten-gallon hat",516:"cradle",517:"crane",518:"crash helmet",519:"crate",520:"crib, cot",521:"Crock Pot",522:"croquet ball",523:"crutch",524:"cuirass",525:"dam, dike, dyke",526:"desk",527:"desktop computer",528:"dial telephone, dial phone",529:"diaper, nappy, napkin",530:"digital clock",531:"digital watch",532:"dining table, board",533:"dishrag, dishcloth",534:"dishwasher, dish washer, dishwashing machine",535:"disk brake, disc brake",536:"dock, dockage, docking facility",537:"dogsled, dog sled, dog sleigh",538:"dome",539:"doormat, welcome mat",540:"drilling platform, offshore rig",541:"drum, membranophone, tympan",542:"drumstick",543:"dumbbell",544:"Dutch oven",545:"electric fan, blower",546:"electric guitar",547:"electric locomotive",548:"entertainment center",549:"envelope",550:"espresso maker",551:"face powder",552:"feather boa, boa",553:"file, file cabinet, filing cabinet",554:"fireboat",555:"fire engine, fire truck",556:"fire screen, fireguard",557:"flagpole, flagstaff",558:"flute, transverse flute",559:"folding chair",560:"football helmet",561:"forklift",562:"fountain",563:"fountain pen",564:"four-poster",565:"freight car",566:"French horn, horn",567:"frying pan, frypan, skillet",568:"fur coat",569:"garbage truck, dustcart",570:"gasmask, respirator, gas helmet",571:"gas pump, gasoline pump, petrol pump, island dispenser",572:"goblet",573:"go-kart",574:"golf ball",575:"golfcart, golf cart",576:"gondola",577:"gong, tam-tam",578:"gown",579:"grand piano, grand",580:"greenhouse, nursery, glasshouse",581:"grille, radiator grille",582:"grocery store, grocery, food market, market",583:"guillotine",584:"hair slide",585:"hair spray",586:"half track",587:"hammer",588:"hamper",589:"hand blower, blow dryer, blow drier, hair dryer, hair drier",590:"hand-held computer, hand-held microcomputer",591:"handkerchief, hankie, hanky, hankey",592:"hard disc, hard disk, fixed disk",593:"harmonica, mouth organ, harp, mouth harp",594:"harp",595:"harvester, reaper",596:"hatchet",597:"holster",598:"home theater, home theatre",599:"honeycomb",600:"hook, claw",601:"hoopskirt, crinoline",602:"horizontal bar, high bar",603:"horse cart, horse-cart",604:"hourglass",605:"iPod",606:"iron, smoothing iron",607:"jack-o'-lantern",608:"jean, blue jean, denim",609:"jeep, landrover",610:"jersey, T-shirt, tee shirt",611:"jigsaw puzzle",612:"jinrikisha, ricksha, rickshaw",613:"joystick",614:"kimono",615:"knee pad",616:"knot",617:"lab coat, laboratory coat",618:"ladle",619:"lampshade, lamp shade",620:"laptop, laptop computer",621:"lawn mower, mower",622:"lens cap, lens cover",623:"letter opener, paper knife, paperknife",624:"library",625:"lifeboat",626:"lighter, light, igniter, ignitor",627:"limousine, limo",628:"liner, ocean liner",629:"lipstick, lip rouge",630:"Loafer",631:"lotion",632:"loudspeaker, speaker, speaker unit, loudspeaker system, speaker system",633:"loupe, jeweler's loupe",634:"lumbermill, sawmill",635:"magnetic compass",636:"mailbag, postbag",637:"mailbox, letter box",638:"maillot",639:"maillot, tank suit",640:"manhole cover",641:"maraca",642:"marimba, xylophone",643:"mask",644:"matchstick",645:"maypole",646:"maze, labyrinth",647:"measuring cup",648:"medicine chest, medicine cabinet",649:"megalith, megalithic structure",650:"microphone, mike",651:"microwave, microwave oven",652:"military uniform",653:"milk can",654:"minibus",655:"miniskirt, mini",656:"minivan",657:"missile",658:"mitten",659:"mixing bowl",660:"mobile home, manufactured home",661:"Model T",662:"modem",663:"monastery",664:"monitor",665:"moped",666:"mortar",667:"mortarboard",668:"mosque",669:"mosquito net",670:"motor scooter, scooter",671:"mountain bike, all-terrain bike, off-roader",672:"mountain tent",673:"mouse, computer mouse",674:"mousetrap",675:"moving van",676:"muzzle",677:"nail",678:"neck brace",679:"necklace",680:"nipple",681:"notebook, notebook computer",682:"obelisk",683:"oboe, hautboy, hautbois",684:"ocarina, sweet potato",685:"odometer, hodometer, mileometer, milometer",686:"oil filter",687:"organ, pipe organ",688:"oscilloscope, scope, cathode-ray oscilloscope, CRO",689:"overskirt",690:"oxcart",691:"oxygen mask",692:"packet",693:"paddle, boat paddle",694:"paddlewheel, paddle wheel",695:"padlock",696:"paintbrush",697:"pajama, pyjama, pj's, jammies",698:"palace",699:"panpipe, pandean pipe, syrinx",700:"paper towel",701:"parachute, chute",702:"parallel bars, bars",703:"park bench",704:"parking meter",705:"passenger car, coach, carriage",706:"patio, terrace",707:"pay-phone, pay-station",708:"pedestal, plinth, footstall",709:"pencil box, pencil case",710:"pencil sharpener",711:"perfume, essence",712:"Petri dish",713:"photocopier",714:"pick, plectrum, plectron",715:"pickelhaube",716:"picket fence, paling",717:"pickup, pickup truck",718:"pier",719:"piggy bank, penny bank",720:"pill bottle",721:"pillow",722:"ping-pong ball",723:"pinwheel",724:"pirate, pirate ship",725:"pitcher, ewer",726:"plane, carpenter's plane, woodworking plane",727:"planetarium",728:"plastic bag",729:"plate rack",730:"plow, plough",731:"plunger, plumber's helper",732:"Polaroid camera, Polaroid Land camera",733:"pole",734:"police van, police wagon, paddy wagon, patrol wagon, wagon, black Maria",735:"poncho",736:"pool table, billiard table, snooker table",737:"pop bottle, soda bottle",738:"pot, flowerpot",739:"potter's wheel",740:"power drill",741:"prayer rug, prayer mat",742:"printer",743:"prison, prison house",744:"projectile, missile",745:"projector",746:"puck, hockey puck",747:"punching bag, punch bag, punching ball, punchball",748:"purse",749:"quill, quill pen",750:"quilt, comforter, comfort, puff",751:"racer, race car, racing car",752:"racket, racquet",753:"radiator",754:"radio, wireless",755:"radio telescope, radio reflector",756:"rain barrel",757:"recreational vehicle, RV, R.V.",758:"reel",759:"reflex camera",760:"refrigerator, icebox",761:"remote control, remote",762:"restaurant, eating house, eating place, eatery",763:"revolver, six-gun, six-shooter",764:"rifle",765:"rocking chair, rocker",766:"rotisserie",767:"rubber eraser, rubber, pencil eraser",768:"rugby ball",769:"rule, ruler",770:"running shoe",771:"safe",772:"safety pin",773:"saltshaker, salt shaker",774:"sandal",775:"sarong",776:"sax, saxophone",777:"scabbard",778:"scale, weighing machine",779:"school bus",780:"schooner",781:"scoreboard",782:"screen, CRT screen",783:"screw",784:"screwdriver",785:"seat belt, seatbelt",786:"sewing machine",787:"shield, buckler",788:"shoe shop, shoe-shop, shoe store",789:"shoji",790:"shopping basket",791:"shopping cart",792:"shovel",793:"shower cap",794:"shower curtain",795:"ski",796:"ski mask",797:"sleeping bag",798:"slide rule, slipstick",799:"sliding door",800:"slot, one-armed bandit",801:"snorkel",802:"snowmobile",803:"snowplow, snowplough",804:"soap dispenser",805:"soccer ball",806:"sock",807:"solar dish, solar collector, solar furnace",808:"sombrero",809:"soup bowl",810:"space bar",811:"space heater",812:"space shuttle",813:"spatula",814:"speedboat",815:"spider web, spider's web",816:"spindle",817:"sports car, sport car",818:"spotlight, spot",819:"stage",820:"steam locomotive",821:"steel arch bridge",822:"steel drum",823:"stethoscope",824:"stole",825:"stone wall",826:"stopwatch, stop watch",827:"stove",828:"strainer",829:"streetcar, tram, tramcar, trolley, trolley car",830:"stretcher",831:"studio couch, day bed",832:"stupa, tope",833:"submarine, pigboat, sub, U-boat",834:"suit, suit of clothes",835:"sundial",836:"sunglass",837:"sunglasses, dark glasses, shades",838:"sunscreen, sunblock, sun blocker",839:"suspension bridge",840:"swab, swob, mop",841:"sweatshirt",842:"swimming trunks, bathing trunks",843:"swing",844:"switch, electric switch, electrical switch",845:"syringe",846:"table lamp",847:"tank, army tank, armored combat vehicle, armoured combat vehicle",848:"tape player",849:"teapot",850:"teddy, teddy bear",851:"television, television system",852:"tennis ball",853:"thatch, thatched roof",854:"theater curtain, theatre curtain",855:"thimble",856:"thresher, thrasher, threshing machine",857:"throne",858:"tile roof",859:"toaster",860:"tobacco shop, tobacconist shop, tobacconist",861:"toilet seat",862:"torch",863:"totem pole",864:"tow truck, tow car, wrecker",865:"toyshop",866:"tractor",867:"trailer truck, tractor trailer, trucking rig, rig, articulated lorry, semi",868:"tray",869:"trench coat",870:"tricycle, trike, velocipede",871:"trimaran",872:"tripod",873:"triumphal arch",874:"trolleybus, trolley coach, trackless trolley",875:"trombone",876:"tub, vat",877:"turnstile",878:"typewriter keyboard",879:"umbrella",880:"unicycle, monocycle",881:"upright, upright piano",882:"vacuum, vacuum cleaner",883:"vase",884:"vault",885:"velvet",886:"vending machine",887:"vestment",888:"viaduct",889:"violin, fiddle",890:"volleyball",891:"waffle iron",892:"wall clock",893:"wallet, billfold, notecase, pocketbook",894:"wardrobe, closet, press",895:"warplane, military plane",896:"washbasin, handbasin, washbowl, lavabo, wash-hand basin",897:"washer, automatic washer, washing machine",898:"water bottle",899:"water jug",900:"water tower",901:"whiskey jug",902:"whistle",903:"wig",904:"window screen",905:"window shade",906:"Windsor tie",907:"wine bottle",908:"wing",909:"wok",910:"wooden spoon",911:"wool, woolen, woollen",912:"worm fence, snake fence, snake-rail fence, Virginia fence",913:"wreck",914:"yawl",915:"yurt",916:"web site, website, internet site, site",917:"comic book",918:"crossword puzzle, crossword",919:"street sign",920:"traffic light, traffic signal, stoplight",921:"book jacket, dust cover, dust jacket, dust wrapper",922:"menu",923:"plate",924:"guacamole",925:"consomme",926:"hot pot, hotpot",927:"trifle",928:"ice cream, icecream",929:"ice lolly, lolly, lollipop, popsicle",930:"French loaf",931:"bagel, beigel",932:"pretzel",933:"cheeseburger",934:"hotdog, hot dog, red hot",935:"mashed potato",936:"head cabbage",937:"broccoli",938:"cauliflower",939:"zucchini, courgette",940:"spaghetti squash",941:"acorn squash",942:"butternut squash",943:"cucumber, cuke",944:"artichoke, globe artichoke",945:"bell pepper",946:"cardoon",947:"mushroom",948:"Granny Smith",949:"strawberry",950:"orange",951:"lemon",952:"fig",953:"pineapple, ananas",954:"banana",955:"jackfruit, jak, jack",956:"custard apple",957:"pomegranate",958:"hay",959:"carbonara",960:"chocolate sauce, chocolate syrup",961:"dough",962:"meat loaf, meatloaf",963:"pizza, pizza pie",964:"potpie",965:"burrito",966:"red wine",967:"espresso",968:"cup",969:"eggnog",970:"alp",971:"bubble",972:"cliff, drop, drop-off",973:"coral reef",974:"geyser",975:"lakeside, lakeshore",976:"promontory, headland, head, foreland",977:"sandbar, sand bar",978:"seashore, coast, seacoast, sea-coast",979:"valley, vale",980:"volcano",981:"ballplayer, baseball player",982:"groom, bridegroom",983:"scuba diver",984:"rapeseed",985:"daisy",986:"yellow lady's slipper, yellow lady-slipper, Cypripedium calceolus, Cypripedium parviflorum",987:"corn",988:"acorn",989:"hip, rose hip, rosehip",990:"buckeye, horse chestnut, conker",991:"coral fungus",992:"agaric",993:"gyromitra",994:"stinkhorn, carrion fungus",995:"earthstar",996:"hen-of-the-woods, hen of the woods, Polyporus frondosus, Grifola frondosa",997:"bolete",998:"ear, spike, capitulum",999:"toilet tissue, toilet paper, bathroom tissue"},yt={"1.00":"module_apply_default/MobilenetV1/Logits/global_pool","2.00":"module_apply_default/MobilenetV2/Logits/AvgPool"},nn={"1.00":{.25:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_025_224/classification/1",inputRange:[0,1]},"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_050_224/classification/1",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_075_224/classification/1",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_100_224/classification/1",inputRange:[0,1]}},"2.00":{"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_050_224/classification/2",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_075_224/classification/2",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/classification/2",inputRange:[0,1]}}};function xt($){return $===void 0&&($={version:1,alpha:1}),Ut(this,void 0,void 0,function(){var M,T,A,P,J,ie;return Ft(this,function(pe){switch(pe.label){case 0:if(ze==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");if(T=$.version.toFixed(2),A=$.alpha?$.alpha.toFixed(2):"",P=-1,J=1,$.modelUrl==null){if(!(T in nn))throw new Error("Invalid version of MobileNet. Valid versions are: "+Object.keys(nn));if(!(A in nn[T]))throw new Error("MobileNet constructed with invalid alpha "+$.alpha+". Valid multipliers for this version are: "+Object.keys(nn[T])+".");M=nn[T][A].inputRange,P=M[0],J=M[1]}return[4,(ie=new _t(T,A,$.modelUrl,P,J)).load()];case 1:return pe.sent(),[2,ie]}})})}var _t=function(){function $(M,T,A,P,J){P===void 0&&(P=-1),J===void 0&&(J=1),this.version=M,this.alpha=T,this.modelUrl=A,this.inputMin=P,this.inputMax=J,this.inputRange=J-P}return $.prototype.load=function(){return Ut(this,void 0,void 0,function(){var M,T,A,P,J=this;return Ft(this,function(ie){switch(ie.label){case 0:return this.modelUrl?(M=this,[4,Object(Mt.loadGraphModel)(this.modelUrl)]):[3,2];case 1:return M.model=ie.sent(),[3,4];case 2:return T=nn[this.version][this.alpha].url,A=this,[4,Object(Mt.loadGraphModel)(T,{fromTFHub:!0})];case 3:A.model=ie.sent(),ie.label=4;case 4:return[4,(P=Object(ze.tidy)(function(){return J.model.predict(Object(ze.zeros)([1,224,224,3]))})).data()];case 5:return ie.sent(),P.dispose(),[2]}})})},$.prototype.infer=function(M,T){var A=this;return T===void 0&&(T=!1),Object(ze.tidy)(function(){M instanceof ze.Tensor||(M=ze.browser.fromPixels(M));var P=M.toFloat().mul(A.inputRange).add(A.inputMin),J=P;M.shape[0]===224&&M.shape[1]===224||(J=ze.image.resizeBilinear(P,[224,224],!0));var ie,pe=J.reshape([-1,224,224,3]);if(T){var Ae=yt[A.version];ie=A.model.execute(pe,Ae).squeeze([1,2])}else ie=A.model.predict(pe).slice([0,1],[-1,1e3]);return ie})},$.prototype.classify=function(M,T){return T===void 0&&(T=3),Ut(this,void 0,void 0,function(){var A,P;return Ft(this,function(J){switch(J.label){case 0:return[4,function(ie,pe){return Ut(this,void 0,void 0,function(){var Ae,Ie,De,et,ot,Bt,Vt;return Ft(this,function(yn){switch(yn.label){case 0:return[4,(Ae=ie.softmax()).data()];case 1:for(Ie=yn.sent(),Ae.dispose(),De=[],Vt=0;Vt<Ie.length;Vt++)De.push({value:Ie[Vt],index:Vt});for(De.sort(function(_n,Dn){return Dn.value-_n.value}),et=new Float32Array(pe),ot=new Int32Array(pe),Vt=0;Vt<pe;Vt++)et[Vt]=De[Vt].value,ot[Vt]=De[Vt].index;for(Bt=[],Vt=0;Vt<ot.length;Vt++)Bt.push({className:pt[ot[Vt]],probability:et[Vt]});return[2,Bt]}})})}(A=this.infer(M),T)];case 1:return P=J.sent(),A.dispose(),[2,P]}})})},$}();function Yt($,M,T){for(var A=[],P=0;P<$.length;P+=1)A.push({value:$[P],index:P});A.sort(function(De,et){return et.value-De.value});for(var J=new Float32Array(M),ie=new Int32Array(M),pe=0;pe<M;pe+=1)J[pe]=A[pe].value,ie[pe]=A[pe].index;for(var Ae=[],Ie=0;Ie<ie.length;Ie+=1)Ae.push({className:T[ie[Ie]],probability:J[Ie]});return Ae}function Fn($,M,T){return Rn.apply(this,arguments)}function Rn(){return(Rn=G()(ge.a.mark(function $(M,T,A){var P;return ge.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,M.data();case 2:return P=J.sent,J.abrupt("return",Yt(P,T,A));case 4:case"end":return J.stop()}},$)}))).apply(this,arguments)}var cn=["kit fox","English setter","Siberian husky","Australian terrier","English springer","grey whale","lesser panda","Egyptian cat","ibex","Persian cat","cougar","gazelle","porcupine","sea lion","malamute","badger","Great Dane","Walker hound","Welsh springer spaniel","whippet","Scottish deerhound","killer whale","mink","African elephant","Weimaraner","soft-coated wheaten terrier","Dandie Dinmont","red wolf","Old English sheepdog","jaguar","otterhound","bloodhound","Airedale","hyena","meerkat","giant schnauzer","titi","three-toed sloth","sorrel","black-footed ferret","dalmatian","black-and-tan coonhound","papillon","skunk","Staffordshire bullterrier","Mexican hairless","Bouvier des Flandres","weasel","miniature poodle","Cardigan","malinois","bighorn","fox squirrel","colobus","tiger cat","Lhasa","impala","coyote","Yorkshire terrier","Newfoundland","brown bear","red fox","Norwegian elkhound","Rottweiler","hartebeest","Saluki","grey fox","schipperke","Pekinese","Brabancon griffon","West Highland white terrier","Sealyham terrier","guenon","mongoose","indri","tiger","Irish wolfhound","wild boar","EntleBucher","zebra","ram","French bulldog","orangutan","basenji","leopard","Bernese mountain dog","Maltese dog","Norfolk terrier","toy terrier","vizsla","cairn","squirrel monkey","groenendael","clumber","Siamese cat","chimpanzee","komondor","Afghan hound","Japanese spaniel","proboscis monkey","guinea pig","white wolf","ice bear","gorilla","borzoi","toy poodle","Kerry blue terrier","ox","Scotch terrier","Tibetan mastiff","spider monkey","Doberman","Boston bull","Greater Swiss Mountain dog","Appenzeller","Shih-Tzu","Irish water spaniel","Pomeranian","Bedlington terrier","warthog","Arabian camel","siamang","miniature schnauzer","collie","golden retriever","Irish terrier","affenpinscher","Border collie","hare","boxer","silky terrier","beagle","Leonberg","German short-haired pointer","patas","dhole","baboon","macaque","Chesapeake Bay retriever","bull mastiff","kuvasz","capuchin","pug","curly-coated retriever","Norwich terrier","flat-coated retriever","hog","keeshond","Eskimo dog","Brittany spaniel","standard poodle","Lakeland terrier","snow leopard","Gordon setter","dingo","standard schnauzer","hamster","Tibetan terrier","Arctic fox","wire-haired fox terrier","basset","water buffalo","American black bear","Angora","bison","howler monkey","hippopotamus","chow","giant panda","American Staffordshire terrier","Shetland sheepdog","Great Pyrenees","Chihuahua","tabby","marmoset","Labrador retriever","Saint Bernard","armadillo","Samoyed","bluetick","redbone","polecat","marmot","kelpie","gibbon","llama","miniature pinscher","wood rabbit","Italian greyhound","lion","cocker spaniel","Irish setter","dugong","Indian elephant","beaver","Sussex spaniel","Pembroke","Blenheim spaniel","Madagascar cat","Rhodesian ridgeback","lynx","African hunting dog","langur","Ibizan hound","timber wolf","cheetah","English foxhound","briard","sloth bear","Border terrier","German shepherd","otter","koala","tusker","echidna","wallaby","platypus","wombat","revolver","umbrella","schooner","soccer ball","accordion","ant","starfish","chambered nautilus","grand piano","laptop","strawberry","airliner","warplane","airship","balloon","space shuttle","fireboat","gondola","speedboat","lifeboat","canoe","yawl","catamaran","trimaran","container ship","liner","pirate","aircraft carrier","submarine","wreck","half track","tank","missile","bobsled","dogsled","bicycle-built-for-two","mountain bike","freight car","passenger car","barrow","shopping cart","motor scooter","forklift","electric locomotive","steam locomotive","amphibian","ambulance","beach wagon","cab","convertible","jeep","limousine","minivan","Model T","racer","sports car","go-kart","golfcart","moped","snowplow","fire engine","garbage truck","pickup","tow truck","trailer truck","moving van","police van","recreational vehicle","streetcar","snowmobile","tractor","mobile home","tricycle","unicycle","horse cart","jinrikisha","oxcart","bassinet","cradle","crib","four-poster","bookcase","china cabinet","medicine chest","chiffonier","table lamp","file","park bench","barber chair","throne","folding chair","rocking chair","studio couch","toilet seat","desk","pool table","dining table","entertainment center","wardrobe","Granny Smith","orange","lemon","fig","pineapple","banana","jackfruit","custard apple","pomegranate","acorn","hip","ear","rapeseed","corn","buckeye","organ","upright","chime","drum","gong","maraca","marimba","steel drum","banjo","cello","violin","harp","acoustic guitar","electric guitar","cornet","French horn","trombone","harmonica","ocarina","panpipe","bassoon","oboe","sax","flute","daisy","yellow lady's slipper","cliff","valley","alp","volcano","promontory","sandbar","coral reef","lakeside","seashore","geyser","hatchet","cleaver","letter opener","plane","power drill","lawn mower","hammer","corkscrew","can opener","plunger","screwdriver","shovel","plow","chain saw","cock","hen","ostrich","brambling","goldfinch","house finch","junco","indigo bunting","robin","bulbul","jay","magpie","chickadee","water ouzel","kite","bald eagle","vulture","great grey owl","black grouse","ptarmigan","ruffed grouse","prairie chicken","peacock","quail","partridge","African grey","macaw","sulphur-crested cockatoo","lorikeet","coucal","bee eater","hornbill","hummingbird","jacamar","toucan","drake","red-breasted merganser","goose","black swan","white stork","black stork","spoonbill","flamingo","American egret","little blue heron","bittern","crane","limpkin","American coot","bustard","ruddy turnstone","red-backed sandpiper","redshank","dowitcher","oystercatcher","European gallinule","pelican","king penguin","albatross","great white shark","tiger shark","hammerhead","electric ray","stingray","barracouta","coho","tench","goldfish","eel","rock beauty","anemone fish","lionfish","puffer","sturgeon","gar","loggerhead","leatherback turtle","mud turtle","terrapin","box turtle","banded gecko","common iguana","American chameleon","whiptail","agama","frilled lizard","alligator lizard","Gila monster","green lizard","African chameleon","Komodo dragon","triceratops","African crocodile","American alligator","thunder snake","ringneck snake","hognose snake","green snake","king snake","garter snake","water snake","vine snake","night snake","boa constrictor","rock python","Indian cobra","green mamba","sea snake","horned viper","diamondback","sidewinder","European fire salamander","common newt","eft","spotted salamander","axolotl","bullfrog","tree frog","tailed frog","whistle","wing","paintbrush","hand blower","oxygen mask","snorkel","loudspeaker","microphone","screen","mouse","electric fan","oil filter","strainer","space heater","stove","guillotine","barometer","rule","odometer","scale","analog clock","digital clock","wall clock","hourglass","sundial","parking meter","stopwatch","digital watch","stethoscope","syringe","magnetic compass","binoculars","projector","sunglasses","loupe","radio telescope","bow","cannon","assault rifle","rifle","projectile","computer keyboard","typewriter keyboard","crane","lighter","abacus","cash machine","slide rule","desktop computer","hand-held computer","notebook","web site","harvester","thresher","printer","slot","vending machine","sewing machine","joystick","switch","hook","car wheel","paddlewheel","pinwheel","potter's wheel","gas pump","carousel","swing","reel","radiator","puck","hard disc","sunglass","pick","car mirror","solar dish","remote control","disk brake","buckle","hair slide","knot","combination lock","padlock","nail","safety pin","screw","muzzle","seat belt","ski","candle","jack-o'-lantern","spotlight","torch","neck brace","pier","tripod","maypole","mousetrap","spider web","trilobite","harvestman","scorpion","black and gold garden spider","barn spider","garden spider","black widow","tarantula","wolf spider","tick","centipede","isopod","Dungeness crab","rock crab","fiddler crab","king crab","American lobster","spiny lobster","crayfish","hermit crab","tiger beetle","ladybug","ground beetle","long-horned beetle","leaf beetle","dung beetle","rhinoceros beetle","weevil","fly","bee","grasshopper","cricket","walking stick","cockroach","mantis","cicada","leafhopper","lacewing","dragonfly","damselfly","admiral","ringlet","monarch","cabbage butterfly","sulphur butterfly","lycaenid","jellyfish","sea anemone","brain coral","flatworm","nematode","conch","snail","slug","sea slug","chiton","sea urchin","sea cucumber","iron","espresso maker","microwave","Dutch oven","rotisserie","toaster","waffle iron","vacuum","dishwasher","refrigerator","washer","Crock Pot","frying pan","wok","caldron","coffeepot","teapot","spatula","altar","triumphal arch","patio","steel arch bridge","suspension bridge","viaduct","barn","greenhouse","palace","monastery","library","apiary","boathouse","church","mosque","stupa","planetarium","restaurant","cinema","home theater","lumbermill","coil","obelisk","totem pole","castle","prison","grocery store","bakery","barbershop","bookshop","butcher shop","confectionery","shoe shop","tobacco shop","toyshop","fountain","cliff dwelling","yurt","dock","brass","megalith","bannister","breakwater","dam","chainlink fence","picket fence","worm fence","stone wall","grille","sliding door","turnstile","mountain tent","scoreboard","honeycomb","plate rack","pedestal","beacon","mashed potato","bell pepper","head cabbage","broccoli","cauliflower","zucchini","spaghetti squash","acorn squash","butternut squash","cucumber","artichoke","cardoon","mushroom","shower curtain","jean","carton","handkerchief","sandal","ashcan","safe","plate","necklace","croquet ball","fur coat","thimble","pajama","running shoe","cocktail shaker","chest","manhole cover","modem","tub","tray","balance beam","bagel","prayer rug","kimono","hot pot","whiskey jug","knee pad","book jacket","spindle","ski mask","beer bottle","crash helmet","bottlecap","tile roof","mask","maillot","Petri dish","football helmet","bathing cap","teddy","holster","pop bottle","photocopier","vestment","crossword puzzle","golf ball","trifle","suit","water tower","feather boa","cloak","red wine","drumstick","shield","Christmas stocking","hoopskirt","menu","stage","bonnet","meat loaf","baseball","face powder","scabbard","sunscreen","beer glass","hen-of-the-woods","guacamole","lampshade","wool","hay","bow tie","mailbag","water jug","bucket","dishrag","soup bowl","eggnog","mortar","trench coat","paddle","chain","swab","mixing bowl","potpie","wine bottle","shoji","bulletproof vest","drilling platform","binder","cardigan","sweatshirt","pot","birdhouse","hamper","ping-pong ball","pencil box","pay-phone","consomme","apron","punching bag","backpack","groom","bearskin","pencil sharpener","broom","mosquito net","abaya","mortarboard","poncho","crutch","Polaroid camera","space bar","cup","racket","traffic light","quill","radio","dough","cuirass","military uniform","lipstick","shower cap","monitor","oscilloscope","mitten","brassiere","French loaf","vase","milk can","rugby ball","paper towel","earthstar","envelope","miniskirt","cowboy hat","trolleybus","perfume","bathtub","hotdog","coral fungus","bullet train","pillow","toilet tissue","cassette","carpenter's kit","ladle","stinkhorn","lotion","hair spray","academic gown","dome","crate","wig","burrito","pill bottle","chain mail","theater curtain","window shade","barrel","washbasin","ballpoint","basketball","bath towel","cowboy boot","gown","window screen","agaric","cellular telephone","nipple","barbell","mailbox","lab coat","fire screen","minibus","packet","maze","pole","horizontal bar","sombrero","pickelhaube","rain barrel","wallet","cassette player","comic book","piggy bank","street sign","bell cote","fountain pen","Windsor tie","volleyball","overskirt","sarong","purse","bolo tie","bib","parachute","sleeping bag","television","swimming trunks","measuring cup","espresso","pizza","breastplate","shopping basket","wooden spoon","saltshaker","chocolate sauce","ballplayer","goblet","gyromitra","stretcher","water bottle","dial telephone","soap dispenser","jersey","school bus","jigsaw puzzle","plastic bag","reflex camera","diaper","Band Aid","ice lolly","velvet","tennis ball","gasmask","doormat","Loafer","ice cream","pretzel","quilt","maillot","tape player","clog","iPod","bolete","scuba diver","pitcher","matchstick","bikini","sock","CD player","lens cap","thatch","vault","beaker","bubble","cheeseburger","parallel bars","flagpole","coffee mug","rubber eraser","stole","carbonara","dumbbell"],qe={DARKNET_URL:"https://cdn.jsdelivr.net/gh/ml5js/ml5-data-and-models@master/models/darknetclassifier/darknetreference/model.json",DARKNET_TINY_URL:"https://cdn.jsdelivr.net/gh/ml5js/ml5-data-and-models@master/models/darknetclassifier/darknettiny/model.json",IMAGE_SIZE_DARKNET:256,IMAGE_SIZE_DARKNET_TINY:224};function Qe($,M){var T;$ instanceof I.Tensor?T=$:$ instanceof HTMLImageElement||$ instanceof HTMLVideoElement||$ instanceof HTMLCanvasElement||$ instanceof ImageData?T=I.browser.fromPixels($):we()($)==="object"&&($.elt instanceof HTMLImageElement||$.elt instanceof HTMLVideoElement||$.elt instanceof HTMLCanvasElement||$.elt instanceof ImageData)&&(T=I.browser.fromPixels($.elt));var A=T.toFloat().div(I.scalar(255)),P=A;return(A.shape[0]!==M||A.shape[1]!==M)&&(P=I.image.resizeBilinear(A,[M,M],!0)),P.reshape([1,M,M,3])}var $e=function(){function $(M){switch(ce()(this,$),this.version=M,this.version){case"reference":this.imgSize=qe.IMAGE_SIZE_DARKNET;break;case"tiny":this.imgSize=qe.IMAGE_SIZE_DARKNET_TINY}}return Ee()($,[{key:"load",value:function(){var M=G()(ge.a.mark(function T(){var A,P=this;return ge.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:J.t0=this.version,J.next=J.t0==="reference"?3:J.t0==="tiny"?7:11;break;case 3:return J.next=5,I.loadLayersModel(qe.DARKNET_URL);case 5:return this.model=J.sent,J.abrupt("break",12);case 7:return J.next=9,I.loadLayersModel(qe.DARKNET_TINY_URL);case 9:return this.model=J.sent,J.abrupt("break",12);case 11:return J.abrupt("break",12);case 12:return A=I.tidy(function(){return P.model.predict(I.zeros([1,P.imgSize,P.imgSize,3]))}),J.next=15,A.data();case 15:A.dispose();case 16:case"end":return J.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"classify",value:function(){var M=G()(ge.a.mark(function T(A){var P,J,ie,pe=this,Ae=arguments;return ge.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return P=Ae.length>1&&Ae[1]!==void 0?Ae[1]:3,J=I.tidy(function(){var De=Qe(A,pe.imgSize),et=pe.model.predict(De);return I.softmax(et)}),Ie.next=4,Fn(J,P,cn);case 4:return ie=Ie.sent,J.dispose(),Ie.abrupt("return",ie);case 7:case"end":return Ie.stop()}},T)}));return function(T){return M.apply(this,arguments)}}()}]),$}();function ft($){return Jt.apply(this,arguments)}function Jt(){return(Jt=G()(ge.a.mark(function $(M){var T,A;return ge.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if((T=M.version)==="reference"||T==="tiny"){P.next=3;break}throw new Error("Please select a version: darknet-reference or darknet-tiny");case 3:return A=new $e(T),P.next=6,A.load();case 6:return P.abrupt("return",A);case 7:case"end":return P.stop()}},$)}))).apply(this,arguments)}var Qt=r(23),Pn=r.n(Qt),kn=["flashlight","belt","mushroom","pond","strawberry","pineapple","sun","cow","ear","bush","pliers","watermelon","apple","baseball","feather","shoe","leaf","lollipop","crown","ocean","horse","mountain","mosquito","mug","hospital","saw","castle","angel","underwear","traffic_light","cruise_ship","marker","blueberry","flamingo","face","hockey_stick","bucket","campfire","asparagus","skateboard","door","suitcase","skull","cloud","paint_can","hockey_puck","steak","house_plant","sleeping_bag","bench","snowman","arm","crayon","fan","shovel","leg","washing_machine","harp","toothbrush","tree","bear","rake","megaphone","knee","guitar","calculator","hurricane","grapes","paintbrush","couch","nose","square","wristwatch","penguin","bridge","octagon","submarine","screwdriver","rollerskates","ladder","wine_bottle","cake","bracelet","broom","yoga","finger","fish","line","truck","snake","bus","stitches","snorkel","shorts","bowtie","pickup_truck","tooth","snail","foot","crab","school_bus","train","dresser","sock","tractor","map","hedgehog","coffee_cup","computer","matches","beard","frog","crocodile","bathtub","rain","moon","bee","knife","boomerang","lighthouse","chandelier","jail","pool","stethoscope","frying_pan","cell_phone","binoculars","purse","lantern","birthday_cake","clarinet","palm_tree","aircraft_carrier","vase","eraser","shark","skyscraper","bicycle","sink","teapot","circle","tornado","bird","stereo","mouth","key","hot_dog","spoon","laptop","cup","bottlecap","The_Great_Wall_of_China","The_Mona_Lisa","smiley_face","waterslide","eyeglasses","ceiling_fan","lobster","moustache","carrot","garden","police_car","postcard","necklace","helmet","blackberry","beach","golf_club","car","panda","alarm_clock","t-shirt","dog","bread","wine_glass","lighter","flower","bandage","drill","butterfly","swan","owl","raccoon","squiggle","calendar","giraffe","elephant","trumpet","rabbit","trombone","sheep","onion","church","flip_flops","spreadsheet","pear","clock","roller_coaster","parachute","kangaroo","duck","remote_control","compass","monkey","rainbow","tennis_racquet","lion","pencil","string_bean","oven","star","cat","pizza","soccer_ball","syringe","flying_saucer","eye","cookie","floor_lamp","mouse","toilet","toaster","The_Eiffel_Tower","airplane","stove","cello","stop_sign","tent","diving_board","light_bulb","hammer","scorpion","headphones","basket","spider","paper_clip","sweater","ice_cream","envelope","sea_turtle","donut","hat","hourglass","broccoli","jacket","backpack","book","lightning","drums","snowflake","radio","banana","camel","canoe","toothpaste","chair","picture_frame","parrot","sandwich","lipstick","pants","violin","brain","power_outlet","triangle","hamburger","dragon","bulldozer","cannon","dolphin","zebra","animal_migration","camouflage","scissors","basketball","elbow","umbrella","windmill","table","rifle","hexagon","potato","anvil","sword","peanut","axe","television","rhinoceros","baseball_bat","speedboat","sailboat","zigzag","garden_hose","river","house","pillow","ant","tiger","stairs","cooler","see_saw","piano","fireplace","popsicle","dumbbell","mailbox","barn","hot_tub","teddy-bear","fork","dishwasher","peas","hot_air_balloon","keyboard","microwave","wheel","fire_hydrant","van","camera","whale","candle","octopus","pig","swing_set","helicopter","saxophone","passport","bat","ambulance","diamond","goatee","fence","grass","mermaid","motorbike","microphone","toe","cactus","nail","telephone","hand","squirrel","streetlight","bed","firetruck"],Qn={DOODLENET_URL:"https://cdn.jsdelivr.net/gh/ml5js/ml5-data-and-models@master/models/doodlenet/model.json",IMAGE_SIZE_DOODLENET:28};function ke($,M){var T;$ instanceof I.Tensor?T=$:$ instanceof HTMLImageElement||$ instanceof HTMLVideoElement||$ instanceof HTMLCanvasElement||$ instanceof ImageData?T=I.browser.fromPixels($):we()($)==="object"&&($.elt instanceof HTMLImageElement||$.elt instanceof HTMLVideoElement||$.elt instanceof HTMLCanvasElement||$.elt instanceof ImageData)&&(T=I.browser.fromPixels($.elt));var A=I.scalar(1).sub(T.toFloat().div(I.scalar(255))),P=A;A.shape[0]===M&&A.shape[1]===M||(P=I.image.resizeBilinear(A,[M,M]));var J=I.split(P,3,3),ie=Pn()(J,3),pe=ie[0],Ae=ie[1],Ie=ie[2];return pe.add(Ae).add(Ie).div(I.scalar(3)).floor().reshape([1,M,M,1])}var ar=function(){function $(){ce()(this,$),this.imgSize=Qn.IMAGE_SIZE_DOODLENET}return Ee()($,[{key:"load",value:function(){var M=G()(ge.a.mark(function T(){var A,P=this;return ge.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,I.loadLayersModel(Qn.DOODLENET_URL);case 2:return this.model=J.sent,A=I.tidy(function(){return P.model.predict(I.zeros([1,P.imgSize,P.imgSize,1]))}),J.next=6,A.data();case 6:A.dispose();case 7:case"end":return J.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"classify",value:function(){var M=G()(ge.a.mark(function T(A){var P,J,ie,pe=this,Ae=arguments;return ge.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return P=Ae.length>1&&Ae[1]!==void 0?Ae[1]:10,J=I.tidy(function(){var De=ke(A,pe.imgSize);return pe.model.predict(De)}),Ie.next=4,Fn(J,P,kn);case 4:return ie=Ie.sent,J.dispose(),Ie.abrupt("return",ie);case 7:case"end":return Ie.stop()}},T)}));return function(T){return M.apply(this,arguments)}}()}]),$}();function Tr(){return rn.apply(this,arguments)}function rn(){return(rn=G()(ge.a.mark(function $(){var M;return ge.a.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return M=new ar,T.next=3,M.load();case 3:return T.abrupt("return",M);case 4:case"end":return T.stop()}},$)}))).apply(this,arguments)}var Ht=new(function(){function $(){ce()(this,$),typeof window<"u"&&(this.m_p5Instance=window)}return Ee()($,[{key:"setP5Instance",value:function(M){this.m_p5Instance=M}},{key:"p5Instance",get:function(){return this.m_p5Instance!==void 0&&typeof this.m_p5Instance.loadImage=="function"?this.m_p5Instance:this.m_p5Instance.p5!==void 0&&this.m_p5Instance.p5.Image!==void 0&&typeof this.m_p5Instance.p5.Image=="function"?this.m_p5Instance.p5:void 0}},{key:"checkP5",value:function(){return!!this.p5Instance}},{key:"getBlob",value:function(M){return new Promise(function(T,A){M.toBlob(function(P){P?T(P):A(new Error("Canvas could not be converted to Blob."))})})}},{key:"loadAsync",value:function(M){var T=this;return new Promise(function(A,P){T.p5Instance.loadImage(M,function(J){A(J)},function(){P(new Error("Could not load image from url ".concat(M)))})})}},{key:"rawToBlob",value:function(){var M=G()(ge.a.mark(function T(A,P,J){var ie,pe,Ae,Ie,De,et;return ge.a.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:for(ie=Array.from(A),pe=document.createElement("canvas"),Ae=pe.getContext("2d"),pe.width=P,pe.height=J,Ie=Ae.createImageData(P,J),De=Ie.data,et=0;et<P*J*4;et+=1)De[et]=ie[et];return Ae.putImageData(Ie,0,0),ot.abrupt("return",this.getBlob(pe));case 10:case"end":return ot.stop()}},T,this)}));return function(T,A,P){return M.apply(this,arguments)}}()},{key:"blobToP5Image",value:function(){var M=G()(ge.a.mark(function T(A){return ge.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(!this.checkP5()||typeof URL>"u"){P.next=2;break}return P.abrupt("return",this.loadAsync(URL.createObjectURL(A)));case 2:return P.abrupt("return",null);case 3:case"end":return P.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()}]),$}()),Gn=function($,M){var T=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){},A=$,P=document.createElement("video");return A.onplay=function(){var J=A.captureStream();P.srcObject=J,P.width=M,P.height=M,P.autoplay=!0,P.playsinline=!0,P.muted=!0,T()},P},Xt=function($){var M=Pn()($.shape,2),T=M[0],A=M[1],P=$.dataSync(),J=document.createElement("canvas");J.width=A,J.height=T;for(var ie=J.getContext("2d"),pe=ie.getImageData(0,0,J.width,J.height),Ae=0;Ae<A*T;Ae+=1){var Ie=4*Ae,De=3*Ae;pe.data[Ie+0]=Math.floor(256*P[De+0]),pe.data[Ie+1]=Math.floor(256*P[De+1]),pe.data[Ie+2]=Math.floor(256*P[De+2]),pe.data[Ie+3]=255}ie.putImageData(pe,0,0);var et=J.toDataURL(),ot=document.createElement("img");return ot.src=et,ot.style.width=A,ot.style.height=T,$.dispose(),ot},Wt=function($){var M=Math.min($.shape[0],$.shape[1]),T=$.shape[0]/2-M/2,A=$.shape[1]/2-M/2;return $.slice([T,A,0],[M,M,3])},Zt=function($){var M,T,A;if(A=$ instanceof HTMLImageElement||$ instanceof HTMLCanvasElement||$ instanceof HTMLVideoElement||$ instanceof ImageData?$:we()($)==="object"&&($.elt instanceof HTMLImageElement||$.elt instanceof HTMLCanvasElement||$.elt instanceof HTMLVideoElement||$.elt instanceof ImageData)?$.elt:we()($)==="object"&&$.canvas instanceof HTMLCanvasElement?$.canvas:$,M=A.width,T=A.height,Ht.checkP5()){var P=Ht.p5Instance.createGraphics(M,T);return P.push(),P.translate(M,0),P.scale(-1,1),P.image($,0,0,M,T),P.pop(),P}var J=document.createElement("canvas");J.width=M,J.height=T;var ie=J.getContext("2d");return ie.drawImage(A,0,0,M,T),ie.translate(M,0),ie.scale(-1,1),ie.drawImage(J,-1*M,0,M,T),J};function Vn($){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return I.tidy(function(){var T=I.browser.fromPixels($);return M&&(T=I.image.resizeBilinear(T,M)),Wt(T).expandDims(0).toFloat().div(I.scalar(127)).sub(I.scalar(1))})}function xn($){return $ instanceof HTMLVideoElement||$ instanceof HTMLImageElement||$ instanceof HTMLCanvasElement||$ instanceof ImageData}function Un($){var M,T,A;A=$ instanceof HTMLImageElement||$ instanceof HTMLCanvasElement||$ instanceof HTMLVideoElement||$ instanceof ImageData?$:we()($)==="object"&&($.elt instanceof HTMLImageElement||$.elt instanceof HTMLCanvasElement||$.elt instanceof HTMLVideoElement||$.elt instanceof ImageData)?$.elt:we()($)==="object"&&$.canvas instanceof HTMLCanvasElement?$.canvas:$,M=A.width,T=A.height;var P=document.createElement("canvas");P.width=M,P.height=T;var J=P.getContext("2d");J.drawImage(A,0,0,M,T);var ie=J.getImageData(0,0,M,T);return Array.from(ie.data)}var ur={mobilenet:{version:2,alpha:1,topk:3}},sr=["mobilenet","darknet","darknet-tiny","doodlenet"],Er=function(){function $(M,T,A,P){if(ce()(this,$),this.video=T,this.model=null,this.mapStringToIndex=[],typeof M=="string")if(sr.includes(M))switch(this.modelName=M,this.modelUrl=null,this.modelName){case"mobilenet":this.modelToUse=l,this.version=A.version||ur.mobilenet.version,this.alpha=A.alpha||ur.mobilenet.alpha,this.topk=A.topk||ur.mobilenet.topk;break;case"darknet":this.version="reference",this.modelToUse=C;break;case"darknet-tiny":this.version="tiny",this.modelToUse=C;break;case"doodlenet":this.modelToUse=S;break;default:this.modelToUse=null}else this.modelUrl=M,this.modelUrl.endsWith("/")&&(this.modelUrl+="model.json");this.ready=Ge(this.loadModel(this.modelUrl),P)}return Ee()($,[{key:"loadModel",value:function(){var M=G()(ge.a.mark(function T(A){return ge.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(!A){P.next=6;break}return P.next=3,this.loadModelFrom(A);case 3:this.model=P.sent,P.next=9;break;case 6:return P.next=8,this.modelToUse.load({version:this.version,alpha:this.alpha});case 8:this.model=P.sent;case 9:return P.abrupt("return",this);case 10:case"end":return P.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"loadModelFrom",value:function(){var M=G()(ge.a.mark(function T(){var A,P,J,ie,pe,Ae,Ie,De,et=arguments;return ge.a.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:if(A=et.length>0&&et[0]!==void 0?et[0]:null,ot.prev=1,A===null){ot.next=7;break}return ot.next=5,jt.a.get(A);case 5:J=ot.sent,P=J.data;case 7:if(P.ml5Specs&&(this.mapStringToIndex=P.ml5Specs.mapStringToIndex),this.mapStringToIndex.length!==0){ot.next=16;break}return ie=A.split("/"),pe=ie.slice(0,ie.length-1).join("/"),Ae="".concat(pe,"/metadata.json"),ot.next=14,jt.a.get(Ae).catch(function(Bt){console.log("Tried to fetch metadata.json, but it seems to be missing.",Bt)});case 14:(Ie=ot.sent)&&(De=Ie.data).labels&&(this.mapStringToIndex=De.labels);case 16:return ot.next=18,I.loadLayersModel(A);case 18:return this.model=ot.sent,ot.abrupt("return",this.model);case 22:return ot.prev=22,ot.t0=ot.catch(1),console.error(ot.t0),ot.abrupt("return",ot.t0);case 26:case"end":return ot.stop()}},T,this,[[1,22]])}));return function(){return M.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var M=G()(ge.a.mark(function T(A,P){var J,ie,pe,Ae,Ie,De,et=this;return ge.a.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:return ot.next=2,this.ready;case 2:return ot.next=4,I.nextFrame();case 4:if(!(A instanceof HTMLVideoElement&&A.readyState===0)){ot.next=8;break}return J=A,ot.next=8,new Promise(function(Bt){J.onloadeddata=function(){return Bt()}});case 8:if(!this.video||this.video.readyState!==0){ot.next=11;break}return ot.next=11,new Promise(function(Bt){et.video.onloadeddata=function(){return Bt()}});case 11:if(ie=[224,224],!this.modelUrl){ot.next=20;break}return ot.next=15,I.nextFrame();case 15:return pe=I.tidy(function(){var Bt=Vn(A,ie),Vt=et.model.predict(Bt);return Array.from(Vt.as1D().dataSync())}),ot.next=18,pe.map(function(Bt,Vt){return{label:et.mapStringToIndex.length>0&&et.mapStringToIndex[Vt]?et.mapStringToIndex[Vt]:Vt,confidence:Bt}}).sort(function(Bt,Vt){return Vt.confidence-Bt.confidence});case 18:return Ae=ot.sent,ot.abrupt("return",Ae);case 20:return Ie=Vn(A,ie),De=this.model.classify(Ie,P).then(function(Bt){return Bt.map(function(Vt){return{label:Vt.className,confidence:Vt.probability}})}),Ie.dispose(),ot.abrupt("return",De);case 24:case"end":return ot.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()},{key:"classify",value:function(){var M=G()(ge.a.mark(function T(A){var P,J,ie,pe,Ae,Ie=arguments;return ge.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(P=Ie.length>1&&Ie[1]!==void 0?Ie[1]:null,J=Ie.length>2?Ie[2]:void 0,ie=this.video,pe=this.topk,typeof A!="function"){De.next=9;break}ie=this.video,Ae=A,De.next=28;break;case 9:if(typeof A!="number"){De.next=14;break}ie=this.video,pe=A,De.next=28;break;case 14:if(!(A instanceof HTMLVideoElement||A instanceof HTMLImageElement||A instanceof HTMLCanvasElement||A instanceof ImageData)){De.next=18;break}ie=A,De.next=28;break;case 18:if(we()(A)!=="object"||!(A.elt instanceof HTMLVideoElement||A.elt instanceof HTMLImageElement||A.elt instanceof HTMLCanvasElement||A.elt instanceof ImageData)){De.next=22;break}ie=A.elt,De.next=28;break;case 22:if(!(we()(A)==="object"&&A.canvas instanceof HTMLCanvasElement)){De.next=26;break}ie=A.canvas,De.next=28;break;case 26:if(this.video instanceof HTMLVideoElement){De.next=28;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 28:return typeof P=="number"?pe=P:typeof P=="function"&&(Ae=P),typeof J=="function"&&(Ae=J),De.abrupt("return",Ge(this.classifyInternal(ie,pe),Ae));case 31:case"end":return De.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"predict",value:function(){var M=G()(ge.a.mark(function T(A,P,J){return ge.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.abrupt("return",this.classify(A,P||null,J));case 1:case"end":return ie.stop()}},T,this)}));return function(T,A,P){return M.apply(this,arguments)}}()}]),$}(),Mr=function($,M,T,A){var P,J={},ie=A,pe=$;if(typeof pe!="string")throw new Error('Please specify a model to use. E.g: "MobileNet"');pe.indexOf("http")===-1&&(pe=$.toLowerCase()),M instanceof HTMLVideoElement?P=M:we()(M)==="object"&&M.elt instanceof HTMLVideoElement?P=M.elt:we()(M)==="object"?J=M:typeof M=="function"&&(ie=M),we()(T)==="object"?J=T:typeof T=="function"&&(ie=T);var Ae=new Er(pe,P,J,ie);return ie?Ae:Ae.ready},pr=function($,M){return(pr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,A){T.__proto__=A}||function(T,A){for(var P in A)A.hasOwnProperty(P)&&(T[P]=A[P])})($,M)},ri=function(){return(ri=Object.assign||function($){for(var M,T=1,A=arguments.length;T<A;T++)for(var P in M=arguments[T])Object.prototype.hasOwnProperty.call(M,P)&&($[P]=M[P]);return $}).apply(this,arguments)};function Kr($,M,T,A){return new(T||(T=Promise))(function(P,J){function ie(Ie){try{Ae(A.next(Ie))}catch(De){J(De)}}function pe(Ie){try{Ae(A.throw(Ie))}catch(De){J(De)}}function Ae(Ie){Ie.done?P(Ie.value):new T(function(De){De(Ie.value)}).then(ie,pe)}Ae((A=A.apply($,M||[])).next())})}function ti($,M){var T,A,P,J,ie={label:0,sent:function(){if(1&P[0])throw P[1];return P[1]},trys:[],ops:[]};return J={next:pe(0),throw:pe(1),return:pe(2)},typeof Symbol=="function"&&(J[Symbol.iterator]=function(){return this}),J;function pe(Ae){return function(Ie){return function(De){if(T)throw new TypeError("Generator is already executing.");for(;ie;)try{if(T=1,A&&(P=2&De[0]?A.return:De[0]?A.throw||((P=A.return)&&P.call(A),0):A.next)&&!(P=P.call(A,De[1])).done)return P;switch(A=0,P&&(De=[2&De[0],P.value]),De[0]){case 0:case 1:P=De;break;case 4:return ie.label++,{value:De[1],done:!1};case 5:ie.label++,A=De[1],De=[0];continue;case 7:De=ie.ops.pop(),ie.trys.pop();continue;default:if(!(P=(P=ie.trys).length>0&&P[P.length-1])&&(De[0]===6||De[0]===2)){ie=0;continue}if(De[0]===3&&(!P||De[1]>P[0]&&De[1]<P[3])){ie.label=De[1];break}if(De[0]===6&&ie.label<P[1]){ie.label=P[1],P=De;break}if(P&&ie.label<P[2]){ie.label=P[2],ie.ops.push(De);break}P[2]&&ie.ops.pop(),ie.trys.pop();continue}De=M.call($,ie)}catch(et){De=[6,et],A=0}finally{T=P=0}if(5&De[0])throw De[1];return{value:De[0]?De[1]:void 0,done:!0}}([Ae,Ie])}}}function jn($){var M=typeof Symbol=="function"&&$[Symbol.iterator],T=0;return M?M.call($):{next:function(){return $&&T>=$.length&&($=void 0),{value:$&&$[T++],done:!$}}}}function ir($,M){var T=typeof Symbol=="function"&&$[Symbol.iterator];if(!T)return $;var A,P,J=T.call($),ie=[];try{for(;(M===void 0||M-- >0)&&!(A=J.next()).done;)ie.push(A.value)}catch(pe){P={error:pe}}finally{try{A&&!A.done&&(T=J.return)&&T.call(J)}finally{if(P)throw P.error}}return ie}function Cr(){for(var $=[],M=0;M<arguments.length;M++)$=$.concat(ir(arguments[M]));return $}var Hr=null;function qr($){return Hr==null&&(Hr=Object(I.backend)().epsilon()),Object(I.tidy)(function(){var M=Object(I.moments)($),T=M.mean,A=M.variance;return $.sub(T).div(A.sqrt().add(Hr))})}var Ot=function(){function $(M){var T=this;if(M==null)throw new Error("Required configuration object is missing for BrowserFftFeatureExtractor constructor");if(M.spectrogramCallback==null)throw new Error("spectrogramCallback cannot be null or undefined");if(!(M.numFramesPerSpectrogram>0))throw new Error("Invalid value in numFramesPerSpectrogram: "+M.numFramesPerSpectrogram);if(M.suppressionTimeMillis<0)throw new Error("Expected suppressionTimeMillis to be >= 0, but got "+M.suppressionTimeMillis);if(this.suppressionTimeMillis=M.suppressionTimeMillis,this.spectrogramCallback=M.spectrogramCallback,this.numFrames=M.numFramesPerSpectrogram,this.sampleRateHz=M.sampleRateHz||44100,this.fftSize=M.fftSize||1024,this.frameDurationMillis=this.fftSize/this.sampleRateHz*1e3,this.columnTruncateLength=M.columnTruncateLength||this.fftSize,this.overlapFactor=M.overlapFactor,this.includeRawAudio=M.includeRawAudio,I.util.assert(this.overlapFactor>=0&&this.overlapFactor<1,function(){return"Expected overlapFactor to be >= 0 and < 1, but got "+T.overlapFactor}),this.columnTruncateLength>this.fftSize)throw new Error("columnTruncateLength "+this.columnTruncateLength+" exceeds fftSize ("+this.fftSize+").");this.audioContextConstructor=window.AudioContext||window.webkitAudioContext}return $.prototype.start=function(M){return Kr(this,void 0,void 0,function(){var T,A,P;return ti(this,function(J){switch(J.label){case 0:if(this.frameIntervalTask!=null)throw new Error("Cannot start already-started BrowserFftFeatureExtractor");return T=this,[4,function(ie){return Kr(this,void 0,void 0,function(){return ti(this,function(pe){switch(pe.label){case 0:return[4,navigator.mediaDevices.getUserMedia({audio:ie==null||ie,video:!1})];case 1:return[2,pe.sent()]}})})}(M)];case 1:return T.stream=J.sent(),this.audioContext=new this.audioContextConstructor,this.audioContext.sampleRate!==this.sampleRateHz&&console.warn("Mismatch in sampling rate: Expected: "+this.sampleRateHz+"; Actual: "+this.audioContext.sampleRate),A=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=0,A.connect(this.analyser),this.freqDataQueue=[],this.freqData=new Float32Array(this.fftSize),this.includeRawAudio&&(this.timeDataQueue=[],this.timeData=new Float32Array(this.fftSize)),P=Math.max(1,Math.round(this.numFrames*(1-this.overlapFactor))),this.tracker=new Se(P,Math.round(this.suppressionTimeMillis/this.frameDurationMillis)),this.frameIntervalTask=setInterval(this.onAudioFrame.bind(this),this.fftSize/this.sampleRateHz*1e3),[2]}})})},$.prototype.onAudioFrame=function(){return Kr(this,void 0,void 0,function(){var M,T,A,P;return ti(this,function(J){switch(J.label){case 0:return this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0?[2]:(this.freqDataQueue.push(this.freqData.slice(0,this.columnTruncateLength)),this.includeRawAudio&&(this.analyser.getFloatTimeDomainData(this.timeData),this.timeDataQueue.push(this.timeData.slice())),this.freqDataQueue.length>this.numFrames&&this.freqDataQueue.shift(),this.tracker.tick()?(M=Fr(this.freqDataQueue),T=$t(M,[1,this.numFrames,this.columnTruncateLength,1]),A=void 0,this.includeRawAudio&&(P=Fr(this.timeDataQueue),A=$t(P,[1,this.numFrames*this.fftSize])),[4,this.spectrogramCallback(T,A)]):[3,2]);case 1:J.sent()&&this.tracker.suppress(),Object(I.dispose)([T,A]),J.label=2;case 2:return[2]}})})},$.prototype.stop=function(){return Kr(this,void 0,void 0,function(){return ti(this,function(M){if(this.frameIntervalTask==null)throw new Error("Cannot stop because there is no ongoing streaming activity.");return clearInterval(this.frameIntervalTask),this.frameIntervalTask=null,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop(),[2]})})},$.prototype.setConfig=function(M){throw new Error("setConfig() is not implemented for BrowserFftFeatureExtractor.")},$.prototype.getFeatures=function(){throw new Error("getFeatures() is not implemented for BrowserFftFeatureExtractor. Use the spectrogramCallback field of the constructor config instead.")},$}();function Fr($){var M=$[0].length,T=new Float32Array($.length*M);return $.forEach(function(A,P){return T.set(A,P*M)}),T}function $t($,M){var T=new Float32Array(I.util.sizeFromShape(M));return T.set($,T.length-$.length),Object(I.tensor)(T,M)}var Se=function(){function $(M,T){var A=this;this.period=M,this.suppressionTime=T??0,this.counter=0,I.util.assert(this.period>0,function(){return"Expected period to be positive, but got "+A.period})}return $.prototype.tick=function(){return this.counter++,this.counter%this.period==0&&(this.suppressionOnset==null||this.counter-this.suppressionOnset>this.suppressionTime)},$.prototype.suppress=function(){this.suppressionOnset=this.counter},$}();function me($){var M=0;$.forEach(function(P){M+=P.byteLength});var T=new Uint8Array(M),A=0;return $.forEach(function(P){T.set(new Uint8Array(P),A),A+=P.byteLength}),T.buffer}function Ce($){var M=0;$.forEach(function(P){return M+=P.length});var T=new Float32Array(M),A=0;return $.forEach(function(P){T.set(P,A),A+=P.length}),T}function Me($){if($==null)throw new Error("Received null or undefind string");for(var M=unescape(encodeURIComponent($)),T=new Uint8Array(M.length),A=0;A<M.length;++A)T[A]=M.charCodeAt(A);return T.buffer}function rt($){if($==null)throw new Error("Received null or undefind buffer");var M=new Uint8Array($);return decodeURIComponent(escape(String.fromCharCode.apply(String,Cr(M))))}var kt="TFJSSCDS",en=1,En=function(){function $(M){if(this.examples={},this.label2Ids={},M!=null)for(var T=function(pe){I.util.assert(pe!=null,function(){return"Received null or undefined buffer"});var Ae=0,Ie=rt(pe.slice(Ae,kt.length));I.util.assert(Ie===kt,function(){return"Deserialization error: Invalid descriptor"}),Ae+=kt.length,Ae+=4;var De=new Uint32Array(pe,Ae,1),et=Ae+=4;Ae=et+De[0];var ot=rt(pe.slice(et,Ae));return{manifest:JSON.parse(ot),data:pe.slice(Ae)}}(M),A=0,P=0;P<T.manifest.length;++P){var J=T.manifest[P],ie=J.spectrogramNumFrames*J.spectrogramFrameSize;J.rawAudioNumSamples!=null&&(ie+=J.rawAudioNumSamples),ie*=4,this.addExample(Kt({spec:J,data:T.data.slice(A,A+ie)})),A+=ie}}return $.prototype.addExample=function(M){I.util.assert(M!=null,function(){return"Got null or undefined example"}),I.util.assert(M.label!=null&&M.label.length>0,function(){return"Expected label to be a non-empty string, but got "+JSON.stringify(M.label)});var T=function(){function A(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return A()+A()+"-"+A()+"-"+A()+"-"+A()+"-"+A()+A()+A()}();return this.examples[T]=M,M.label in this.label2Ids||(this.label2Ids[M.label]=[]),this.label2Ids[M.label].push(T),T},$.prototype.merge=function(M){var T,A,P,J;I.util.assert(M!==this,function(){return"Cannot merge a dataset into itself"});var ie=M.getVocabulary();try{for(var pe=jn(ie),Ae=pe.next();!Ae.done;Ae=pe.next()){var Ie=Ae.value,De=M.getExamples(Ie);try{for(var et=jn(De),ot=et.next();!ot.done;ot=et.next()){var Bt=ot.value;this.addExample(Bt.example)}}catch(Vt){P={error:Vt}}finally{try{ot&&!ot.done&&(J=et.return)&&J.call(et)}finally{if(P)throw P.error}}}}catch(Vt){T={error:Vt}}finally{try{Ae&&!Ae.done&&(A=pe.return)&&A.call(pe)}finally{if(T)throw T.error}}},$.prototype.getExampleCounts=function(){var M={};for(var T in this.examples){var A=this.examples[T];A.label in M||(M[A.label]=0),M[A.label]++}return M},$.prototype.getExamples=function(M){var T=this;I.util.assert(M!=null,function(){return"Expected label to be a string, but got "+JSON.stringify(M)}),I.util.assert(M in this.label2Ids,function(){return'No example of label "'+M+'" exists in dataset'});var A=[];return this.label2Ids[M].forEach(function(P){A.push({uid:P,example:T.examples[P]})}),A},$.prototype.getData=function(M,T){var A=this;I.util.assert(this.size()>0,function(){return"Cannot get spectrograms as tensors because the dataset is empty"});var P=this.getVocabulary();M!=null?I.util.assert(P.indexOf(M)!==-1,function(){return"Label "+M+" is not in the vocabulary ("+JSON.stringify(P)+")"}):I.util.assert(P.length>1,function(){return"One-hot encoding of labels requires the vocabulary to have at least two words, but it has only "+P.length+" word."}),T==null&&(T={});var J,ie,pe=this.getSortedUniqueNumFrames();pe.length===1?(J=T.numFrames==null?pe[0]:T.numFrames,ie=T.hopFrames==null?1:T.hopFrames):(J=T.numFrames,I.util.assert(J!=null&&Number.isInteger(J)&&J>0,function(){return"There are "+pe.length+" unique lengths among the "+A.size()+" examples of this Dataset, hence numFrames is required. But it is not provided."}),I.util.assert(J<=pe[0],function(){return"numFrames ("+J+") exceeds the minimum numFrames ("+pe[0]+") among the examples of the Dataset."}),ie=T.hopFrames,I.util.assert(ie!=null&&Number.isInteger(ie)&&ie>0,function(){return"There are "+pe.length+" unique lengths among the "+A.size()+" examples of this Dataset, hence hopFrames is required. But it is not provided."}));var Ae=T.normalize==null||T.normalize;return Object(I.tidy)(function(){for(var Ie,De,et,ot=[],Bt=[],Vt=[],yn=0;yn<P.length;++yn){var _n=P[yn];if(M==null||_n===M){var Dn=A.label2Ids[_n],Nn=function(Ri){var Qa,is,hu=A.examples[Ri].spectrogram,zs=hu.frameSize;et==null?et=zs:I.util.assert(zs===et,function(){return"Mismatch in frameSize  ("+zs+" vs "+et+")"});var Iu=hu.data.length/zs,Fu=null;_n!=="_background_noise_"&&(Fu=hu.keyFrameIndex==null?un(hu).dataSync()[0]:hu.keyFrameIndex);var Ru=Object(I.tensor3d)(hu.data,[Iu,zs,1]),rp=hn(Iu,Fu,J,ie),$d=function(Xl){var vc=Object(I.tidy)(function(){var qa=Ru.slice([Xl[0],0,0],[Xl[1]-Xl[0],-1,-1]);return Ae?qr(qa):qa});T.getDataset?Bt.push(vc.dataSync()):ot.push(vc),M==null&&Vt.push(yn)};try{for(var $l=jn(rp),zf=$l.next();!zf.done;zf=$l.next())$d(zf.value)}catch(Xl){Qa={error:Xl}}finally{try{zf&&!zf.done&&(is=$l.return)&&is.call($l)}finally{if(Qa)throw Qa.error}}Object(I.dispose)(Ru)};try{for(var Wn=jn(Dn),Jn=Wn.next();!Jn.done;Jn=Wn.next())Nn(Jn.value)}catch(Ri){Ie={error:Ri}}finally{try{Jn&&!Jn.done&&(De=Wn.return)&&De.call(Wn)}finally{if(Ie)throw Ie.error}}}}T.augmentByMixingNoiseRatio!=null&&A.augmentByMixingNoise(T.getDataset?Bt:ot,Vt,T.augmentByMixingNoiseRatio);var Cn=T.shuffle==null||T.shuffle;if(T.getDataset){var wr=T.datasetBatchSize==null?32:T.datasetBatchSize,Dr=T.datasetValidationSplit==null?.15:T.datasetValidationSplit;I.util.assert(Dr>0&&Dr<1,function(){return"Invalid dataset validation split: "+Dr});var Nr=Bt.map(function(Ri,Qa){return[Ri,Vt[Qa]]});I.util.shuffle(Nr),Bt=Nr.map(function(Ri){return Ri[0]});var Yr=Nr.map(function(Ri){return Ri[1]}),jr=function(Ri,Qa,is){var hu,zs,Iu,Fu,Ru,rp,$d,$l;I.util.assert(is>0&&is<1,function(){return"validationSplit is expected to be >0 and <1, but got "+is});for(var zf=!Array.isArray(Ri[0]),Xl=Qa,vc=[],qa=0;qa<Xl.length;++qa){var Uf=Xl[qa];vc[Uf]==null&&(vc[Uf]=[]),vc[Uf].push(qa)}var Xd=vc.length,ip=[],Wf=[];for(vc.map(function(Eu){return I.util.shuffle(Eu)}),qa=0;qa<Xd;++qa)for(var ks=vc[qa],Kd=Math.round(ks.length*(1-is)),op=0;op<ks.length;++op)op<Kd?ip.push(ks[op]):Wf.push(ks[op]);if(zf){var ap=[],hl=[],Cm=[],yc=[];try{for(var Us=jn(ip),tc=Us.next();!tc.done;tc=Us.next()){var Cs=tc.value;ap.push(Ri[Cs]),hl.push(Qa[Cs])}}catch(Eu){hu={error:Eu}}finally{try{tc&&!tc.done&&(zs=Us.return)&&zs.call(Us)}finally{if(hu)throw hu.error}}try{for(var Kl=jn(Wf),Yd=Kl.next();!Yd.done;Yd=Kl.next())Cs=Yd.value,Cm.push(Ri[Cs]),yc.push(Qa[Cs])}catch(Eu){Iu={error:Eu}}finally{try{Yd&&!Yd.done&&(Fu=Kl.return)&&Fu.call(Kl)}finally{if(Iu)throw Iu.error}}return{trainXs:ap,trainYs:hl,valXs:Cm,valYs:yc}}ap=[],hl=[],Cm=[],yc=[];try{for(var sp=jn(ip),Jd=sp.next();!Jd.done;Jd=sp.next())Cs=Jd.value,ap.push(Ri[Cs]),hl.push(Qa[Cs])}catch(Eu){Ru={error:Eu}}finally{try{Jd&&!Jd.done&&(rp=sp.return)&&rp.call(sp)}finally{if(Ru)throw Ru.error}}try{for(var Am=jn(Wf),Yl=Am.next();!Yl.done;Yl=Am.next())Cs=Yl.value,Cm.push(Ri[Cs]),yc.push(Qa[Cs])}catch(Eu){$d={error:Eu}}finally{try{Yl&&!Yl.done&&($l=Am.return)&&$l.call(Am)}finally{if($d)throw $d.error}}return{trainXs:ap,trainYs:hl,valXs:Cm,valYs:yc}}(Bt,Yr,Dr),Si=jr.trainXs,Fi=jr.trainYs,Ni=jr.valXs,Ao=jr.valYs,Xo=I.data.array(Si).map(function(Ri){return Object(I.tensor3d)(Ri,[J,et,1])}),Po=I.data.array(Fi).map(function(Ri){return Object(I.oneHot)([Ri],P.length).squeeze([0])}),Ro=I.data.zip({xs:Xo,ys:Po});Cn&&(Ro=Ro.shuffle(Bt.length)),Ro=Ro.batch(wr).prefetch(4);var Uo=I.data.array(Ni).map(function(Ri){return Object(I.tensor3d)(Ri,[J,et,1])}),sa=I.data.array(Ao).map(function(Ri){return Object(I.oneHot)([Ri],P.length).squeeze([0])}),pa=I.data.zip({xs:Uo,ys:sa});return[Ro,pa=pa.batch(wr).prefetch(4)]}if(Cn){var Da=[];ot.forEach(function(Ri,Qa){Da.push({x:Ri,y:Vt[Qa]})}),I.util.shuffle(Da),ot=Da.map(function(Ri){return Ri.x}),Vt=Da.map(function(Ri){return Ri.y})}var du=M==null?Object(I.oneHot)(Object(I.tensor1d)(Vt,"int32"),P.length).asType("float32"):void 0;return{xs:Object(I.stack)(ot),ys:du}})},$.prototype.augmentByMixingNoise=function(M,T,A){var P,J;if(M==null||M.length===0)throw new Error("Cannot perform augmentation because data is null or empty");for(var ie=M[0]instanceof Float32Array,pe=this.getVocabulary(),Ae=[],Ie=[],De=0;De<T.length;++De)pe[T[De]]==="_background_noise_"?Ae.push(De):Ie.push(De);if(Ae.length===0)throw new Error("Cannot perform augmentation by mixing with noise when there is no example with label _background_noise_");var et=[],ot=[],Bt=function(_n){var Dn=Ae[function(Cn,wr){return Math.floor((wr-Cn)*Math.random())+Cn}(0,Ae.length)],Nn=ie?Object(I.tensor1d)(M[_n]):M[_n],Wn=ie?Object(I.tensor1d)(M[Dn]):M[Dn],Jn=Object(I.tidy)(function(){return qr(Nn.add(Wn.mul(A)))});ie?et.push(Jn.dataSync()):et.push(Jn),ot.push(T[_n])};try{for(var Vt=jn(Ie),yn=Vt.next();!yn.done;yn=Vt.next())Bt(yn.value)}catch(_n){P={error:_n}}finally{try{yn&&!yn.done&&(J=Vt.return)&&J.call(Vt)}finally{if(P)throw P.error}}console.log("Data augmentation: mixing noise: added "+et.length+" examples"),et.forEach(function(_n){return M.push(_n)}),T.push.apply(T,Cr(ot))},$.prototype.getSortedUniqueNumFrames=function(){for(var M,T,A=new Set,P=this.getVocabulary(),J=0;J<P.length;++J){var ie=P[J],pe=this.label2Ids[ie];try{for(var Ae=jn(pe),Ie=Ae.next();!Ie.done;Ie=Ae.next()){var De=Ie.value,et=this.examples[De].spectrogram,ot=et.data.length/et.frameSize;A.add(ot)}}catch(Vt){M={error:Vt}}finally{try{Ie&&!Ie.done&&(T=Ae.return)&&T.call(Ae)}finally{if(M)throw M.error}}}var Bt=Cr(A);return Bt.sort(),Bt},$.prototype.removeExample=function(M){if(!(M in this.examples))throw new Error("Nonexistent example UID: "+M);var T=this.examples[M].label;delete this.examples[M];var A=this.label2Ids[T].indexOf(M);this.label2Ids[T].splice(A,1),this.label2Ids[T].length===0&&delete this.label2Ids[T]},$.prototype.setExampleKeyFrameIndex=function(M,T){if(!(M in this.examples))throw new Error("Nonexistent example UID: "+M);var A=this.examples[M].spectrogram,P=A.data.length/A.frameSize;I.util.assert(T>=0&&T<P&&Number.isInteger(T),function(){return"Invalid keyFrameIndex: "+T+". Must be >= 0, < "+P+", and an integer."}),A.keyFrameIndex=T},$.prototype.size=function(){return Object.keys(this.examples).length},$.prototype.durationMillis=function(){var M=0;for(var T in this.examples){var A=this.examples[T].spectrogram,P=23.22|A.frameDurationMillis;M+=A.data.length/A.frameSize*P}return M},$.prototype.empty=function(){return this.size()===0},$.prototype.clear=function(){this.examples={}},$.prototype.getVocabulary=function(){var M=new Set;for(var T in this.examples){var A=this.examples[T];M.add(A.label)}var P=Cr(M);return P.sort(),P},$.prototype.serialize=function(M){var T,A,P,J,ie=this.getVocabulary();I.util.assert(!this.empty(),function(){return"Cannot serialize empty Dataset"}),M!=null&&(Array.isArray(M)||(M=[M]),M.forEach(function(Dn){if(ie.indexOf(Dn)===-1)throw new Error('Word label "'+Dn+'" does not exist in the vocabulary of this dataset. The vocabulary is: '+JSON.stringify(ie)+".")}));var pe=[],Ae=[];try{for(var Ie=jn(ie),De=Ie.next();!De.done;De=Ie.next()){var et=De.value;if(M==null||M.indexOf(et)!==-1){var ot=this.label2Ids[et];try{for(var Bt=jn(ot),Vt=Bt.next();!Vt.done;Vt=Bt.next()){var yn=Vt.value,_n=Nt(this.examples[yn]);pe.push(_n.spec),Ae.push(_n.data)}}catch(Dn){P={error:Dn}}finally{try{Vt&&!Vt.done&&(J=Bt.return)&&J.call(Bt)}finally{if(P)throw P.error}}}}}catch(Dn){T={error:Dn}}finally{try{De&&!De.done&&(A=Ie.return)&&A.call(Ie)}finally{if(T)throw T.error}}return function(Dn){var Nn=Me(JSON.stringify(Dn.manifest)),Wn=Me(kt),Jn=new Uint32Array([en]),Cn=new Uint32Array([Nn.byteLength]);return me([me([Wn,Jn.buffer,Cn.buffer]),Nn,Dn.data])}({manifest:pe,data:me(Ae)})},$}();function Nt($){var M=$.rawAudio!=null,T={label:$.label,spectrogramNumFrames:$.spectrogram.data.length/$.spectrogram.frameSize,spectrogramFrameSize:$.spectrogram.frameSize};$.spectrogram.keyFrameIndex!=null&&(T.spectrogramKeyFrameIndex=$.spectrogram.keyFrameIndex);var A=$.spectrogram.data.buffer.slice(0);return M&&(T.rawAudioNumSamples=$.rawAudio.data.length,T.rawAudioSampleRateHz=$.rawAudio.sampleRateHz,A=me([A,$.rawAudio.data.buffer])),{spec:T,data:A}}function Kt($){var M={frameSize:$.spec.spectrogramFrameSize,data:new Float32Array($.data.slice(0,4*$.spec.spectrogramFrameSize*$.spec.spectrogramNumFrames))};$.spec.spectrogramKeyFrameIndex!=null&&(M.keyFrameIndex=$.spec.spectrogramKeyFrameIndex);var T={label:$.spec.label,spectrogram:M};return $.spec.rawAudioNumSamples!=null&&(T.rawAudio={sampleRateHz:$.spec.rawAudioSampleRateHz,data:new Float32Array($.data.slice(4*$.spec.spectrogramFrameSize*$.spec.spectrogramNumFrames))}),T}function hn($,M,T,A){if(I.util.assert(Number.isInteger($)&&$>0,function(){return"snippetLength must be a positive integer, but got "+$}),M!=null&&I.util.assert(Number.isInteger(M)&&M>=0,function(){return"focusIndex must be a non-negative integer, but got "+M}),I.util.assert(Number.isInteger(T)&&T>0,function(){return"windowLength must be a positive integer, but got "+T}),I.util.assert(Number.isInteger(A)&&A>0,function(){return"windowHop must be a positive integer, but got "+A}),I.util.assert(T<=$,function(){return"windowLength ("+T+") exceeds snippetLength ("+$+")"}),I.util.assert(M<$,function(){return"focusIndex ("+M+") equals or exceeds snippetLength ("+$+")"}),T===$)return[[0,$]];var P=[];if(M==null){for(var J=0;J+T<=$;)P.push([J,J+T]),J+=A;return P}var ie=Math.floor(T/2),pe=M-ie;for(pe<0?pe=0:pe+T>$&&(pe=$-T);!(pe-A<0||M>=pe-A+T);)pe-=A;for(;pe+T<=$&&!(M<pe);)P.push([pe,pe+T]),pe+=A;return P}function un($){return Object(I.tidy)(function(){return function(M){return Object(I.tidy)(function(){var T=M.data.length/M.frameSize;return Object(I.tensor2d)(M.data,[T,M.frameSize]).mean(-1)})}($).argMax()})}var mt="0.3.9",Tt="tfjs-speech-commands-saved-model-metadata",fn="indexeddb://tfjs-speech-commands-model/",tn={localStorage:typeof window>"u"?null:window.localStorage},Ve=function(){function $(M,T,A){this.MODEL_URL_PREFIX="https://storage.googleapis.com/tfjs-models/tfjs/speech-commands/v"+function(P){return P.split(".").slice(0,2).join(".")}(mt)+"/browser_fft",this.SAMPLE_RATE_HZ=44100,this.FFT_SIZE=1024,this.DEFAULT_SUPPRESSION_TIME_MILLIS=0,this.streaming=!1,this.transferRecognizers={},I.util.assert(T==null&&A==null||T!=null&&A!=null,function(){return"modelURL and metadataURL must be both provided or both not provided."}),T==null?(M==null?M=$.DEFAULT_VOCABULARY_NAME:I.util.assert($.VALID_VOCABULARY_NAMES.indexOf(M)!==-1,function(){return"Invalid vocabulary name: '"+M+"'"}),this.vocabulary=M,this.modelArtifactsOrURL=this.MODEL_URL_PREFIX+"/"+this.vocabulary+"/model.json",this.metadataOrURL=this.MODEL_URL_PREFIX+"/"+this.vocabulary+"/metadata.json"):(I.util.assert(M==null,function(){return"vocabulary name must be null or undefined when modelURL is provided"}),this.modelArtifactsOrURL=T,this.metadataOrURL=A),this.parameters={sampleRateHz:this.SAMPLE_RATE_HZ,fftSize:this.FFT_SIZE}}return $.prototype.listen=function(M,T){return Kr(this,void 0,void 0,function(){var A,P,J,ie,pe,Ae=this;return ti(this,function(Ie){switch(Ie.label){case 0:if(this.streaming)throw new Error("Cannot start streaming again when streaming is ongoing.");return[4,this.ensureModelLoaded()];case 1:if(Ie.sent(),T==null&&(T={}),A=T.probabilityThreshold==null?0:T.probabilityThreshold,T.includeEmbedding&&(A=0),I.util.assert(A>=0&&A<=1,function(){return"Invalid probabilityThreshold value: "+A}),P=T.invokeCallbackOnNoiseAndUnknown!=null&&T.invokeCallbackOnNoiseAndUnknown,T.includeEmbedding&&(P=!0),T.suppressionTimeMillis<0)throw new Error("suppressionTimeMillis is expected to be >= 0, but got "+T.suppressionTimeMillis);return J=T.overlapFactor==null?.5:T.overlapFactor,I.util.assert(J>=0&&J<1,function(){return"Expected overlapFactor to be >= 0 and < 1, but got "+J}),ie=function(De,et){return Kr(Ae,void 0,void 0,function(){var ot,Bt,Vt,yn,_n,Dn,Nn,Wn,Jn,Cn,wr;return ti(this,function(Dr){switch(Dr.label){case 0:return Bt=qr(De),T.includeEmbedding?[4,this.ensureModelWithEmbeddingOutputCreated()]:[3,2];case 1:return Dr.sent(),ot=ir(this.modelWithEmbeddingOutput.predict(Bt),2),Vt=ot[0],yn=ot[1],[3,3];case 2:Vt=this.model.predict(Bt),Dr.label=3;case 3:return[4,Vt.data()];case 4:return _n=Dr.sent(),[4,(Dn=Vt.argMax(-1)).data()];case 5:return Nn=Dr.sent()[0],Wn=Math.max.apply(Math,Cr(_n)),Object(I.dispose)([Vt,Dn,Bt]),Wn<A?[2,!1]:[3,6];case 6:return Jn=void 0,T.includeSpectrogram?(Cn={},[4,De.data()]):[3,8];case 7:Cn.data=Dr.sent(),Cn.frameSize=this.nonBatchInputShape[1],Jn=Cn,Dr.label=8;case 8:return wr=!0,P||this.words[Nn]!=="_background_noise_"&&this.words[Nn]!=="_unknown_"||(wr=!1),wr&&M({scores:_n,spectrogram:Jn,embedding:yn}),[2,wr]}})})},pe=T.suppressionTimeMillis==null?this.DEFAULT_SUPPRESSION_TIME_MILLIS:T.suppressionTimeMillis,this.audioDataExtractor=new Ot({sampleRateHz:this.parameters.sampleRateHz,numFramesPerSpectrogram:this.nonBatchInputShape[0],columnTruncateLength:this.nonBatchInputShape[1],suppressionTimeMillis:pe,spectrogramCallback:ie,overlapFactor:J}),[4,this.audioDataExtractor.start(T.audioTrackConstraints)];case 2:return Ie.sent(),this.streaming=!0,[2]}})})},$.prototype.ensureModelLoaded=function(){return Kr(this,void 0,void 0,function(){var M,T,A,P,J=this;return ti(this,function(ie){switch(ie.label){case 0:return this.model!=null?[2]:[4,this.ensureMetadataLoaded()];case 1:return ie.sent(),typeof this.modelArtifactsOrURL!="string"?[3,3]:[4,Object(I.loadLayersModel)(this.modelArtifactsOrURL)];case 2:return M=ie.sent(),[3,5];case 3:return[4,Object(I.loadLayersModel)(I.io.fromMemory(this.modelArtifactsOrURL.modelTopology,this.modelArtifactsOrURL.weightSpecs,this.modelArtifactsOrURL.weightData))];case 4:M=ie.sent(),ie.label=5;case 5:if(M.inputs.length!==1)throw new Error("Expected model to have 1 input, but got a model with "+M.inputs.length+" inputs");if(M.inputs[0].shape.length!==4)throw new Error("Expected model to have an input shape of rank 4, but got an input shape of rank "+M.inputs[0].shape.length);if(M.inputs[0].shape[3]!==1)throw new Error("Expected model to have an input shape with 1 as the last dimension, but got input shape"+JSON.stringify(M.inputs[0].shape[3])+"}");if((T=M.outputShape).length!==2)throw new Error("Expected loaded model to have an output shape of rank 2,but received shape "+JSON.stringify(T));if(T[1]!==this.words.length)throw new Error("Mismatch between the last dimension of model's output shape ("+T[1]+") and number of words ("+this.words.length+").");return this.model=M,this.freezeModel(),this.nonBatchInputShape=M.inputs[0].shape.slice(1),this.elementsPerExample=1,M.inputs[0].shape.slice(1).forEach(function(pe){return J.elementsPerExample*=pe}),this.warmUpModel(),A=this.parameters.fftSize/this.parameters.sampleRateHz*1e3,P=M.inputs[0].shape[1],this.parameters.spectrogramDurationMillis=P*A,[2]}})})},$.prototype.ensureModelWithEmbeddingOutputCreated=function(){return Kr(this,void 0,void 0,function(){var M,T;return ti(this,function(A){switch(A.label){case 0:return this.modelWithEmbeddingOutput!=null?[2]:[4,this.ensureModelLoaded()];case 1:for(A.sent(),T=this.model.layers.length-2;T>=0;--T)if(this.model.layers[T].getClassName()==="Dense"){M=this.model.layers[T];break}if(M==null)throw new Error("Failed to find second last dense layer in the original model.");return this.modelWithEmbeddingOutput=Object(I.model)({inputs:this.model.inputs,outputs:[this.model.outputs[0],M.output]}),[2]}})})},$.prototype.warmUpModel=function(){var M=this;Object(I.tidy)(function(){for(var T=Object(I.zeros)([1].concat(M.nonBatchInputShape)),A=0;A<3;++A)M.model.predict(T)})},$.prototype.ensureMetadataLoaded=function(){return Kr(this,void 0,void 0,function(){var M,T,A;return ti(this,function(P){switch(P.label){case 0:return this.words!=null?[2]:typeof this.metadataOrURL!="string"?[3,2]:[4,function(J){return Kr(this,void 0,void 0,function(){return ti(this,function(ie){return[2,new Promise(function(pe,Ae){J.indexOf("http://")===0||J.indexOf("https://")===0?fetch(J).then(function(Ie){Ie.json().then(function(De){return pe(De)})}):J.indexOf("file://")===0?r(185).readFile(J.slice(7),{encoding:"utf-8"},function(Ie,De){return pe(JSON.parse(De))}):Ae(new Error("Unsupported URL scheme in metadata URL: "+J+". Supported schemes are: http://, https://, and (node.js-only) file://"))})]})})}(this.metadataOrURL)];case 1:return T=P.sent(),[3,3];case 2:T=this.metadataOrURL,P.label=3;case 3:if((M=T).wordLabels==null){if((A=M.words)==null)throw new Error('Cannot find field "words" or "wordLabels" in metadata JSON file');this.words=A}else this.words=M.wordLabels;return[2]}})})},$.prototype.stopListening=function(){return Kr(this,void 0,void 0,function(){return ti(this,function(M){switch(M.label){case 0:if(!this.streaming)throw new Error("Cannot stop streaming when streaming is not ongoing.");return[4,this.audioDataExtractor.stop()];case 1:return M.sent(),this.streaming=!1,[2]}})})},$.prototype.isListening=function(){return this.streaming},$.prototype.wordLabels=function(){return this.words},$.prototype.params=function(){return this.parameters},$.prototype.modelInputShape=function(){if(this.model==null)throw new Error("Model has not been loaded yet. Load model by calling ensureModelLoaded(), recognize(), or listen().");return this.model.inputs[0].shape},$.prototype.recognize=function(M,T){return Kr(this,void 0,void 0,function(){var A,P,J,ie,pe,Ae,Ie,De,et,ot,Bt,Vt,yn;return ti(this,function(_n){switch(_n.label){case 0:return T==null&&(T={}),[4,this.ensureModelLoaded()];case 1:return _n.sent(),M!=null?[3,3]:[4,this.recognizeOnline()];case 2:A=_n.sent(),M=A.data,_n.label=3;case 3:if(M instanceof I.Tensor)this.checkInputTensorShape(M),J=M,P=M.shape[0];else{if((M=M).length%this.elementsPerExample)throw new Error("The length of the input Float32Array "+M.length+" is not divisible by the number of tensor elements per per example expected by the model "+this.elementsPerExample+".");P=M.length/this.elementsPerExample,J=Object(I.tensor4d)(M,[P].concat(this.nonBatchInputShape))}return pe={scores:null},T.includeEmbedding?[4,this.ensureModelWithEmbeddingOutputCreated()]:[3,5];case 4:return _n.sent(),Ae=this.modelWithEmbeddingOutput.predict(J),ie=Ae[0],pe.embedding=Ae[1],[3,6];case 5:ie=this.model.predict(J),_n.label=6;case 6:return P!==1?[3,8]:(Ie=pe,[4,ie.data()]);case 7:return Ie.scores=_n.sent(),[3,10];case 8:return De=Object(I.unstack)(ie),et=De.map(function(Dn){return Dn.data()}),ot=pe,[4,Promise.all(et)];case 9:ot.scores=_n.sent(),Object(I.dispose)(De),_n.label=10;case 10:return T.includeSpectrogram?(Bt=pe,Vt={},M instanceof I.Tensor?[4,M.data()]:[3,12]):[3,14];case 11:return yn=_n.sent(),[3,13];case 12:yn=M,_n.label=13;case 13:Bt.spectrogram=(Vt.data=yn,Vt.frameSize=this.nonBatchInputShape[1],Vt),_n.label=14;case 14:return[2,pe]}})})},$.prototype.recognizeOnline=function(){return Kr(this,void 0,void 0,function(){var M=this;return ti(this,function(T){return[2,new Promise(function(A,P){M.audioDataExtractor=new Ot({sampleRateHz:M.parameters.sampleRateHz,numFramesPerSpectrogram:M.nonBatchInputShape[0],columnTruncateLength:M.nonBatchInputShape[1],suppressionTimeMillis:0,spectrogramCallback:function(J){return Kr(M,void 0,void 0,function(){var ie,pe,Ae;return ti(this,function(Ie){switch(Ie.label){case 0:return ie=qr(J),[4,this.audioDataExtractor.stop()];case 1:return Ie.sent(),pe=A,Ae={},[4,ie.data()];case 2:return pe.apply(void 0,[(Ae.data=Ie.sent(),Ae.frameSize=this.nonBatchInputShape[1],Ae)]),ie.dispose(),[2,!1]}})})},overlapFactor:0}),M.audioDataExtractor.start()})]})})},$.prototype.createTransfer=function(M){if(this.model==null)throw new Error("Model has not been loaded yet. Load model by calling ensureModelLoaded(), recognizer(), or listen().");I.util.assert(M!=null&&typeof M=="string"&&M.length>1,function(){return"Expected the name for a transfer-learning recognized to be a non-empty string, but got "+JSON.stringify(M)}),I.util.assert(this.transferRecognizers[M]==null,function(){return"There is already a transfer-learning model named '"+M+"'"});var T=new Ln(M,this.parameters,this.model);return this.transferRecognizers[M]=T,T},$.prototype.freezeModel=function(){var M,T;try{for(var A=jn(this.model.layers),P=A.next();!P.done;P=A.next())P.value.trainable=!1}catch(J){M={error:J}}finally{try{P&&!P.done&&(T=A.return)&&T.call(A)}finally{if(M)throw M.error}}},$.prototype.checkInputTensorShape=function(M){var T=this.model.inputs[0].shape.length;if(M.shape.length!==T)throw new Error("Expected input Tensor to have rank "+T+", but got rank "+M.shape.length+" that differs ");var A=M.shape.slice(1),P=this.model.inputs[0].shape.slice(1);if(!I.util.arraysEqual(A,P))throw new Error("Expected input to have shape [null,"+P+"], but got shape [null,"+A+"]")},$.VALID_VOCABULARY_NAMES=["18w","directional4w"],$.DEFAULT_VOCABULARY_NAME="18w",$}(),Ln=function($){function M(T,A,P){var J=$.call(this)||this;return J.name=T,J.parameters=A,J.baseModel=P,I.util.assert(T!=null&&typeof T=="string"&&T.length>0,function(){return"The name of a transfer model must be a non-empty string, but got "+JSON.stringify(T)}),J.nonBatchInputShape=J.baseModel.inputs[0].shape.slice(1),J.words=null,J.dataset=new En,J}return function(T,A){function P(){this.constructor=T}pr(T,A),T.prototype=A===null?Object.create(A):(P.prototype=A.prototype,new P)}(M,$),M.prototype.collectExample=function(T,A){return Kr(this,void 0,void 0,function(){var P,J,ie,pe,Ae=this;return ti(this,function(Ie){if(I.util.assert(!this.streaming,function(){return"Cannot start collection of transfer-learning example because a streaming recognition or transfer-learning example collection is ongoing"}),I.util.assert(T!=null&&typeof T=="string"&&T.length>0,function(){return"Must provide a non-empty string when collecting transfer-learning example"}),A==null&&(A={}),A.durationMultiplier!=null&&A.durationSec!=null)throw new Error("durationMultiplier and durationSec are mutually exclusive, but are both specified.");return A.durationSec!=null?(I.util.assert(A.durationSec>0,function(){return"Expected durationSec to be > 0, but got "+A.durationSec}),J=this.parameters.fftSize/this.parameters.sampleRateHz,P=Math.ceil(A.durationSec/J)):A.durationMultiplier!=null?(I.util.assert(A.durationMultiplier>=1,function(){return"Expected duration multiplier to be >= 1, but got "+A.durationMultiplier}),P=Math.round(this.nonBatchInputShape[0]*A.durationMultiplier)):P=this.nonBatchInputShape[0],A.snippetDurationSec!=null&&(I.util.assert(A.snippetDurationSec>0,function(){return"snippetDurationSec is expected to be > 0, but got "+A.snippetDurationSec}),I.util.assert(A.onSnippet!=null,function(){return"onSnippet must be provided if snippetDurationSec is provided."})),A.onSnippet!=null&&I.util.assert(A.snippetDurationSec!=null,function(){return"snippetDurationSec must be provided if onSnippet is provided."}),ie=this.parameters.fftSize/this.parameters.sampleRateHz,pe=ie*P,this.streaming=!0,[2,new Promise(function(De){var et=A.snippetDurationSec==null?1:A.snippetDurationSec/pe,ot=1-et,Bt=Math.round(1/et),Vt=0,yn=-1,_n=[];Ae.audioDataExtractor=new Ot({sampleRateHz:Ae.parameters.sampleRateHz,numFramesPerSpectrogram:P,columnTruncateLength:Ae.nonBatchInputShape[1],suppressionTimeMillis:0,spectrogramCallback:function(Dn,Nn){return Kr(Ae,void 0,void 0,function(){var Wn,Jn,Cn,wr,Dr,Nr,Yr,jr,Si,Fi,Ni,Ao,Xo,Po,Ro,Uo,sa,pa,Da,du;return ti(this,function(Ri){switch(Ri.label){case 0:return A.onSnippet!=null?[3,7]:(Wn=qr(Dn),Cn=(Jn=this.dataset).addExample,wr={label:T},Dr={},[4,Wn.data()]);case 1:return wr.spectrogram=(Dr.data=Ri.sent(),Dr.frameSize=this.nonBatchInputShape[1],Dr),A.includeRawAudio?(Yr={},[4,Nn.data()]):[3,3];case 2:return Yr.data=Ri.sent(),Yr.sampleRateHz=this.audioDataExtractor.sampleRateHz,Nr=Yr,[3,4];case 3:Nr=void 0,Ri.label=4;case 4:return Cn.apply(Jn,[(wr.rawAudio=Nr,wr)]),Wn.dispose(),[4,this.audioDataExtractor.stop()];case 5:return Ri.sent(),this.streaming=!1,this.collateTransferWords(),jr=De,Si={},[4,Dn.data()];case 6:return jr.apply(void 0,[(Si.data=Ri.sent(),Si.frameSize=this.nonBatchInputShape[1],Si)]),[3,13];case 7:return[4,Dn.data()];case 8:for(Fi=Ri.sent(),yn===-1&&(yn=Fi.length),Ni=yn-1;Fi[Ni]!==0&&Ni>=0;)Ni--;return Ao=yn-Ni-1,yn=Ni+1,Xo=Fi.slice(Fi.length-Ao,Fi.length),_n.push(Xo),A.onSnippet!=null&&A.onSnippet({data:Xo,frameSize:this.nonBatchInputShape[1]}),Vt++!==Bt?[3,13]:[4,this.audioDataExtractor.stop()];case 9:return Ri.sent(),this.streaming=!1,this.collateTransferWords(),Po=function(Qa){if(Qa.length<2)throw new Error("Cannot normalize a Float32Array with fewer than 2 elements.");return Hr==null&&(Hr=Object(I.backend)().epsilon()),Object(I.tidy)(function(){var is=Object(I.moments)(Object(I.tensor1d)(Qa)),hu=is.mean,zs=is.variance,Iu=hu.arraySync(),Fu=Math.sqrt(zs.arraySync()),Ru=Array.from(Qa).map(function(rp){return(rp-Iu)/(Fu+Hr)});return new Float32Array(Ru)})}(Ce(_n)),Ro={data:Po,frameSize:this.nonBatchInputShape[1]},sa=(Uo=this.dataset).addExample,pa={label:T,spectrogram:Ro},A.includeRawAudio?(du={},[4,Nn.data()]):[3,11];case 10:return du.data=Ri.sent(),du.sampleRateHz=this.audioDataExtractor.sampleRateHz,Da=du,[3,12];case 11:Da=void 0,Ri.label=12;case 12:sa.apply(Uo,[(pa.rawAudio=Da,pa)]),De(Ro),Ri.label=13;case 13:return[2,!1]}})})},overlapFactor:ot,includeRawAudio:A.includeRawAudio}),Ae.audioDataExtractor.start(A.audioTrackConstraints)})]})})},M.prototype.clearExamples=function(){var T=this;I.util.assert(this.words!=null&&this.words.length>0&&!this.dataset.empty(),function(){return"No transfer learning examples exist for model name "+T.name}),this.dataset.clear(),this.words=null},M.prototype.countExamples=function(){if(this.dataset.empty())throw new Error("No examples have been collected for transfer-learning model named '"+this.name+"' yet.");return this.dataset.getExampleCounts()},M.prototype.getExamples=function(T){return this.dataset.getExamples(T)},M.prototype.setExampleKeyFrameIndex=function(T,A){this.dataset.setExampleKeyFrameIndex(T,A)},M.prototype.removeExample=function(T){this.dataset.removeExample(T),this.collateTransferWords()},M.prototype.isDatasetEmpty=function(){return this.dataset.empty()},M.prototype.loadExamples=function(T,A){var P,J,ie,pe;A===void 0&&(A=!1);var Ae=new En(T);A&&this.clearExamples();var Ie=Ae.getVocabulary();try{for(var De=jn(Ie),et=De.next();!et.done;et=De.next()){var ot=et.value,Bt=Ae.getExamples(ot);try{for(var Vt=jn(Bt),yn=Vt.next();!yn.done;yn=Vt.next()){var _n=yn.value;this.dataset.addExample(_n.example)}}catch(Dn){ie={error:Dn}}finally{try{yn&&!yn.done&&(pe=Vt.return)&&pe.call(Vt)}finally{if(ie)throw ie.error}}}}catch(Dn){P={error:Dn}}finally{try{et&&!et.done&&(J=De.return)&&J.call(De)}finally{if(P)throw P.error}}this.collateTransferWords()},M.prototype.serializeExamples=function(T){return this.dataset.serialize(T)},M.prototype.collateTransferWords=function(){this.words=this.dataset.getVocabulary()},M.prototype.collectTransferDataAsTensors=function(T,A){var P=this.nonBatchInputShape[0];T=T||.25;var J=Math.round(T*P),ie=this.dataset.getData(null,ri({numFrames:P,hopFrames:J},A));return{xs:ie.xs,ys:ie.ys}},M.prototype.collectTransferDataAsTfDataset=function(T,A,P,J){A===void 0&&(A=.15),P===void 0&&(P=32);var ie=this.nonBatchInputShape[0];T=T||.25;var pe=Math.round(T*ie);return this.dataset.getData(null,ri({numFrames:ie,hopFrames:pe,getDataset:!0,datasetBatchSize:P,datasetValidationSplit:A},J))},M.prototype.train=function(T){return Kr(this,void 0,void 0,function(){var A,P=this;return ti(this,function(J){switch(J.label){case 0:return I.util.assert(this.words!=null&&this.words.length>0,function(){return"Cannot train transfer-learning model '"+P.name+"' because no transfer learning example has been collected."}),I.util.assert(this.words.length>1,function(){return"Cannot train transfer-learning model '"+P.name+"' because only 1 word label ('"+JSON.stringify(P.words)+"') has been collected for transfer learning. Requires at least 2."}),T.fineTuningEpochs!=null&&I.util.assert(T.fineTuningEpochs>=0&&Number.isInteger(T.fineTuningEpochs),function(){return"If specified, fineTuningEpochs must be a non-negative integer, but received "+T.fineTuningEpochs}),T==null&&(T={}),this.model==null&&this.createTransferModelFromBaseModel(),this.secondLastBaseDenseLayer.trainable=!1,this.model.compile({loss:"categoricalCrossentropy",optimizer:T.optimizer||"sgd",metrics:["acc"]}),A=T.fitDatasetDurationMillisThreshold==null?6e4:T.fitDatasetDurationMillisThreshold,this.dataset.durationMillis()>A?(console.log("Detected large dataset: total duration = "+this.dataset.durationMillis()+" ms > "+A+" ms. Training transfer model using fitDataset() instead of fit()"),[4,this.trainOnDataset(T)]):[3,2];case 1:return[2,J.sent()];case 2:return[4,this.trainOnTensors(T)];case 3:return[2,J.sent()]}})})},M.prototype.trainOnDataset=function(T){return Kr(this,void 0,void 0,function(){var A,P,J,ie,pe,Ae,Ie,De,et;return ti(this,function(ot){switch(ot.label){case 0:return I.util.assert(T.epochs>0,function(){return"Invalid config.epochs"}),A=T.batchSize==null?32:T.batchSize,P=T.windowHopRatio||.25,J=ir(this.collectTransferDataAsTfDataset(P,T.validationSplit,A,{augmentByMixingNoiseRatio:T.augmentByMixingNoiseRatio}),2),ie=J[0],pe=J[1],Ae=I.util.now(),[4,this.model.fitDataset(ie,{epochs:T.epochs,validationData:T.validationSplit>0?pe:null,callbacks:T.callback==null?null:[T.callback]})];case 1:return Ie=ot.sent(),console.log("fitDataset() took "+(I.util.now()-Ae).toFixed(2)+" ms"),T.fineTuningEpochs!=null&&T.fineTuningEpochs>0?(De=I.util.now(),[4,this.fineTuningUsingTfDatasets(T,ie,pe)]):[3,3];case 2:return et=ot.sent(),console.log("fitDataset() (fine-tuning) took "+(I.util.now()-De).toFixed(2)+" ms"),[2,[Ie,et]];case 3:return[2,Ie]}})})},M.prototype.trainOnTensors=function(T){return Kr(this,void 0,void 0,function(){var A,P,J,ie,pe,Ae,Ie,De,et,ot;return ti(this,function(Bt){switch(Bt.label){case 0:A=T.windowHopRatio||.25,P=this.collectTransferDataAsTensors(A,{augmentByMixingNoiseRatio:T.augmentByMixingNoiseRatio}),J=P.xs,ie=P.ys,console.log("Training data: xs.shape = "+J.shape+", ys.shape = "+ie.shape),Bt.label=1;case 1:return Bt.trys.push([1,,6,7]),T.validationSplit!=null?(De=function(Vt,yn,_n){return I.util.assert(_n>0&&_n<1,function(){return"validationSplit is expected to be >0 and <1, but got "+_n}),Object(I.tidy)(function(){for(var Dn=yn.argMax(-1).dataSync(),Nn=[],Wn=0;Wn<Dn.length;++Wn){var Jn=Dn[Wn];Nn[Jn]==null&&(Nn[Jn]=[]),Nn[Jn].push(Wn)}var Cn=Nn.length,wr=[],Dr=[];for(Nn.map(function(Si){return I.util.shuffle(Si)}),Wn=0;Wn<Cn;++Wn)for(var Nr=Nn[Wn],Yr=Math.round(Nr.length*(1-_n)),jr=0;jr<Nr.length;++jr)jr<Yr?wr.push(Nr[jr]):Dr.push(Nr[jr]);return{trainXs:Object(I.gather)(Vt,wr),trainYs:Object(I.gather)(yn,wr),valXs:Object(I.gather)(Vt,Dr),valYs:Object(I.gather)(yn,Dr)}})}(J,ie,T.validationSplit),pe=De.trainXs,Ae=De.trainYs,Ie=[De.valXs,De.valYs]):(pe=J,Ae=ie),[4,this.model.fit(pe,Ae,{epochs:T.epochs==null?20:T.epochs,validationData:Ie,batchSize:T.batchSize,callbacks:T.callback==null?null:[T.callback]})];case 2:return et=Bt.sent(),T.fineTuningEpochs!=null&&T.fineTuningEpochs>0?[4,this.fineTuningUsingTensors(T,pe,Ae,Ie)]:[3,4];case 3:return ot=Bt.sent(),[2,[et,ot]];case 4:return[2,et];case 5:return[3,7];case 6:return Object(I.dispose)([J,ie,pe,Ae,Ie]),[7];case 7:return[2]}})})},M.prototype.fineTuningUsingTfDatasets=function(T,A,P){return Kr(this,void 0,void 0,function(){var J,ie,pe;return ti(this,function(Ae){switch(Ae.label){case 0:return J=this.secondLastBaseDenseLayer.trainable,this.secondLastBaseDenseLayer.trainable=!0,ie=T.fineTuningOptimizer==null?"sgd":T.fineTuningOptimizer,this.model.compile({loss:"categoricalCrossentropy",optimizer:ie,metrics:["acc"]}),[4,this.model.fitDataset(A,{epochs:T.fineTuningEpochs,validationData:P,callbacks:T.callback==null?null:[T.callback]})];case 1:return pe=Ae.sent(),this.secondLastBaseDenseLayer.trainable=J,[2,pe]}})})},M.prototype.fineTuningUsingTensors=function(T,A,P,J){return Kr(this,void 0,void 0,function(){var ie,pe,Ae;return ti(this,function(Ie){switch(Ie.label){case 0:return ie=this.secondLastBaseDenseLayer.trainable,this.secondLastBaseDenseLayer.trainable=!0,pe=T.fineTuningOptimizer==null?"sgd":T.fineTuningOptimizer,this.model.compile({loss:"categoricalCrossentropy",optimizer:pe,metrics:["acc"]}),[4,this.model.fit(A,P,{epochs:T.fineTuningEpochs,validationData:J,batchSize:T.batchSize,callbacks:T.fineTuningCallback==null?null:[T.fineTuningCallback]})];case 1:return Ae=Ie.sent(),this.secondLastBaseDenseLayer.trainable=ie,[2,Ae]}})})},M.prototype.evaluate=function(T){return Kr(this,void 0,void 0,function(){var A,P=this;return ti(this,function(J){return I.util.assert(T.wordProbThresholds!=null&&T.wordProbThresholds.length>0,function(){return"Received null or empty wordProbThresholds"}),A=0,I.util.assert(this.words[A]==="_background_noise_",function(){return"Cannot perform evaluation when the first tag is not _background_noise_"}),[2,Object(I.tidy)(function(){for(var ie=[],pe=0,Ae=P.collectTransferDataAsTensors(T.windowHopRatio),Ie=Ae.xs,De=Ae.ys.argMax(-1).dataSync(),et=P.model.predict(Ie),ot=et.slice([0,1],[et.shape[0],et.shape[1]-1]).max(-1),Bt=et.shape[0],Vt=0;Vt<T.wordProbThresholds.length;++Vt){for(var yn=T.wordProbThresholds[Vt],_n=ot.greater(Object(I.scalar)(yn)).dataSync(),Dn=0,Nn=0,Wn=0,Jn=0,Cn=0;Cn<Bt;++Cn)De[Cn]===A?(Dn++,_n[Cn]&&Wn++):(Nn++,_n[Cn]&&Jn++);var wr=Wn/Dn,Dr=Jn/Nn;ie.push({probThreshold:yn,fpr:wr,tpr:Dr}),console.log("ROC thresh="+yn+": fpr="+wr.toFixed(4)+", tpr="+Dr.toFixed(4)),Vt>0&&(pe+=Math.abs(ie[Vt-1].fpr-ie[Vt].fpr)*(ie[Vt-1].tpr+ie[Vt].tpr)/2)}return{rocCurve:ie,auc:pe}})]})})},M.prototype.createTransferModelFromBaseModel=function(){var T=this;I.util.assert(this.words!=null,function(){return"No word example is available for tranfer-learning model of name "+T.name});for(var A=this.baseModel.layers,P=A.length-2;P>=0&&A[P].getClassName().toLowerCase()!=="dense";)P--;if(P<0)throw new Error("Cannot find a hidden dense layer in the base model.");this.secondLastBaseDenseLayer=A[P];var J=this.secondLastBaseDenseLayer.output;this.transferHead=Object(I.sequential)(),this.transferHead.add(I.layers.dense({units:this.words.length,activation:"softmax",inputShape:J.shape.slice(1),name:"NewHeadDense"}));var ie=this.transferHead.apply(J);this.model=Object(I.model)({inputs:this.baseModel.inputs,outputs:ie})},M.prototype.modelInputShape=function(){return this.baseModel.inputs[0].shape},M.prototype.getMetadata=function(){return{tfjsSpeechCommandsVersion:mt,modelName:this.name,timeStamp:new Date().toISOString(),wordLabels:this.wordLabels()}},M.prototype.save=function(T){return Kr(this,void 0,void 0,function(){var A,P,J;return ti(this,function(ie){return A=T!=null,T=T||Xn(this.name),A||(P=tn.localStorage.getItem(Tt),(J=P==null?{}:JSON.parse(P))[this.name]=this.getMetadata(),tn.localStorage.setItem(Tt,JSON.stringify(J))),console.log("Saving model to "+T),[2,this.model.save(T)]})})},M.prototype.load=function(T){return Kr(this,void 0,void 0,function(){var A,P,J;return ti(this,function(ie){switch(ie.label){case 0:if(A=T!=null,T=T||Xn(this.name),!A){if((P=JSON.parse(tn.localStorage.getItem(Tt)))==null||P[this.name]==null)throw new Error("Cannot find metadata for transfer model named "+this.name+'"');this.words=P[this.name].wordLabels,console.log("Loaded word list for model named "+this.name+": "+this.words)}return J=this,[4,Object(I.loadLayersModel)(T)];case 1:return J.model=ie.sent(),console.log("Loaded model from "+T+":"),this.model.summary(),[2]}})})},M.prototype.createTransfer=function(T){throw new Error("Creating transfer-learned recognizer from a transfer-learned recognizer is not supported.")},M}(Ve);function Xn($){return""+fn+$}function Zn($,M,T,A){if(I.util.assert(T==null&&A==null||T!=null&&A!=null,function(){return"customModelURL and customMetadataURL must be both provided or both not provided."}),T!=null&&I.util.assert(M==null,function(){return"vocabulary name must be null or undefined when modelURL is provided."}),$==="BROWSER_FFT")return new Ve(M,T,A);throw $==="SOFT_FFT"?new Error("SOFT_FFT SpeechCommandRecognizer has not been implemented yet."):new Error("Invalid fftType: '"+$+"'")}var cr=function(){function $(M){ce()(this,$),this.options=M}return Ee()($,[{key:"load",value:function(){var M=G()(ge.a.mark(function T(A){var P,J,ie;return ge.a.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return A?(P=A.split("/"),J=P.slice(0,P.length-1).join("/"),ie="".concat(J,"/metadata.json"),this.model=Zn("BROWSER_FFT",void 0,A,ie)):this.model=Zn("BROWSER_FFT"),pe.next=3,this.model.ensureModelLoaded();case 3:this.allLabels=this.model.wordLabels();case 4:case"end":return pe.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"classify",value:function(){var M=this,T=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.allLabels.length,A=arguments.length>1?arguments[1]:void 0;return this.model.listen(function(P){if(P.scores){var J=Yt(P.scores,T,M.allLabels).map(function(ie){return{label:ie.className,confidence:ie.probability}});return A(null,J)}return A("ERROR: Cannot find scores in result: ".concat(P))},this.options).catch(function(P){return A("ERROR: ".concat(P.message))})}}]),$}();function Br($,M){return Sr.apply(this,arguments)}function Sr(){return(Sr=G()(ge.a.mark(function $(M,T){var A;return ge.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return A=new cr(M),P.next=3,A.load(T);case 3:return P.abrupt("return",A);case 4:case"end":return P.stop()}},$)}))).apply(this,arguments)}var yi=["speechcommands18w"],ki=function(){function $(M,T,A){if(ce()(this,$),this.model=null,this.options=T,typeof M=="string")if(yi.includes(M))switch(this.modelName=M,this.modelUrl=null,this.modelName){case"speechcommands18w":this.modelToUse=U;break;default:this.modelToUse=null}else this.modelToUse=U,this.modelUrl=M;this.ready=Ge(this.loadModel(T,this.modelUrl),A)}return Ee()($,[{key:"loadModel",value:function(){var M=G()(ge.a.mark(function T(A){return ge.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,this.modelToUse.load(A,this.modelUrl);case 2:return this.model=P.sent,P.abrupt("return",this);case 4:case"end":return P.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var M=G()(ge.a.mark(function T(A,P){return ge.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,this.ready;case 2:return J.next=4,I.nextFrame();case 4:return J.abrupt("return",this.model.classify(A,P));case 5:case"end":return J.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()},{key:"classify",value:function(){var M=G()(ge.a.mark(function T(){var A,P,J,ie,pe=arguments;return ge.a.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:return A=pe.length>0&&pe[0]!==void 0?pe[0]:null,P=pe.length>1?pe[1]:void 0,J=this.topk,typeof A=="number"?J=A:typeof A=="function"&&(ie=A),typeof P=="function"&&(ie=P),Ae.abrupt("return",this.classifyInternal(J,ie));case 6:case"end":return Ae.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()}]),$}(),Zr=function($,M,T){var A={},P=T,J=$;if(typeof J!="string")throw new Error('Please specify a model to use. E.g: "SpeechCommands18w"');J.indexOf("http")===-1&&(J=$.toLowerCase()),we()(M)==="object"?A=M:typeof M=="function"&&(P=M);var ie=new ki(J,A,P);return P?ie:ie.ready};function Zi($,M){return $==null&&M==null?null:$==null?M.clone():M===null?$.clone():$.concat(M,0)}function gi($,M){for(var T=[],A=0;A<$.length;A++)T.push({value:$[A],index:A});T.sort(function(ie,pe){return pe.value-ie.value});var P=new Float32Array(M),J=new Int32Array(M);for(A=0;A<M;A++)P[A]=T[A].value,J[A]=T[A].index;return{values:P,indices:J}}var ei=function(){function $(){this.classDatasetMatrices={},this.classExampleCount={},this.labelToClassId={},this.nextClassId=0}return $.prototype.addExample=function(M,T){var A=this;if(this.exampleShape==null&&(this.exampleShape=M.shape),!ze.util.arraysEqual(this.exampleShape,M.shape))throw new Error("Example shape provided, "+M.shape+" does not match previously provided example shapes "+this.exampleShape+".");this.clearTrainDatasetMatrix(),T in this.labelToClassId||(this.labelToClassId[T]=this.nextClassId++),Object(ze.tidy)(function(){var P=A.normalizeVectorToUnitLength(M.flatten()),J=P.shape[0];if(A.classDatasetMatrices[T]==null)A.classDatasetMatrices[T]=P.as2D(1,J);else{var ie=A.classDatasetMatrices[T].as2D(A.classExampleCount[T],J).concat(P.as2D(1,J),0);A.classDatasetMatrices[T].dispose(),A.classDatasetMatrices[T]=ie}Object(ze.keep)(A.classDatasetMatrices[T]),A.classExampleCount[T]==null&&(A.classExampleCount[T]=0),A.classExampleCount[T]++})},$.prototype.similarities=function(M){var T=this;return Object(ze.tidy)(function(){var A=T.normalizeVectorToUnitLength(M.flatten()),P=A.shape[0];if(T.trainDatasetMatrix==null){var J=null;for(var ie in T.classDatasetMatrices)J=Zi(J,T.classDatasetMatrices[ie]);T.trainDatasetMatrix=J}if(T.trainDatasetMatrix==null)return console.warn("Cannot predict without providing training examples."),null;Object(ze.keep)(T.trainDatasetMatrix);var pe=T.getNumExamples();return T.trainDatasetMatrix.as2D(pe,P).matMul(A.as2D(P,1)).as1D()})},$.prototype.predictClass=function(M,T){return T===void 0&&(T=3),function(A,P,J,ie){return new(J||(J=Promise))(function(pe,Ae){function Ie(ot){try{et(ie.next(ot))}catch(Bt){Ae(Bt)}}function De(ot){try{et(ie.throw(ot))}catch(Bt){Ae(Bt)}}function et(ot){ot.done?pe(ot.value):new J(function(Bt){Bt(ot.value)}).then(Ie,De)}et((ie=ie.apply(A,P||[])).next())})}(this,void 0,void 0,function(){var A,P,J,ie,pe=this;return function(Ae,Ie){var De,et,ot,Bt,Vt={label:0,sent:function(){if(1&ot[0])throw ot[1];return ot[1]},trys:[],ops:[]};return Bt={next:yn(0),throw:yn(1),return:yn(2)},typeof Symbol=="function"&&(Bt[Symbol.iterator]=function(){return this}),Bt;function yn(_n){return function(Dn){return function(Nn){if(De)throw new TypeError("Generator is already executing.");for(;Vt;)try{if(De=1,et&&(ot=2&Nn[0]?et.return:Nn[0]?et.throw||((ot=et.return)&&ot.call(et),0):et.next)&&!(ot=ot.call(et,Nn[1])).done)return ot;switch(et=0,ot&&(Nn=[2&Nn[0],ot.value]),Nn[0]){case 0:case 1:ot=Nn;break;case 4:return Vt.label++,{value:Nn[1],done:!1};case 5:Vt.label++,et=Nn[1],Nn=[0];continue;case 7:Nn=Vt.ops.pop(),Vt.trys.pop();continue;default:if(!(ot=(ot=Vt.trys).length>0&&ot[ot.length-1])&&(Nn[0]===6||Nn[0]===2)){Vt=0;continue}if(Nn[0]===3&&(!ot||Nn[1]>ot[0]&&Nn[1]<ot[3])){Vt.label=Nn[1];break}if(Nn[0]===6&&Vt.label<ot[1]){Vt.label=ot[1],ot=Nn;break}if(ot&&Vt.label<ot[2]){Vt.label=ot[2],Vt.ops.push(Nn);break}ot[2]&&Vt.ops.pop(),Vt.trys.pop();continue}Nn=Ie.call(Ae,Vt)}catch(Wn){Nn=[6,Wn],et=0}finally{De=ot=0}if(5&Nn[0])throw Nn[1];return{value:Nn[0]?Nn[1]:void 0,done:!0}}([_n,Dn])}}}(this,function(Ae){switch(Ae.label){case 0:if(T<1)throw new Error("Please provide a positive integer k value to predictClass.");if(this.getNumExamples()===0)throw new Error("You have not added any examples to the KNN classifier. Please add examples before calling predictClass.");return A=Object(ze.tidy)(function(){return pe.similarities(M).asType("float32")}),P=Math.min(T,this.getNumExamples()),ie=gi,[4,A.data()];case 1:return J=ie.apply(void 0,[Ae.sent(),P]).indices,A.dispose(),[2,this.calculateTopClass(J,P)]}})})},$.prototype.clearClass=function(M){if(this.classDatasetMatrices[M]==null)throw new Error("Cannot clear invalid class "+M);delete this.classDatasetMatrices[M],delete this.classExampleCount[M],this.clearTrainDatasetMatrix()},$.prototype.clearAllClasses=function(){for(var M in this.classDatasetMatrices)this.clearClass(M)},$.prototype.getClassExampleCount=function(){return this.classExampleCount},$.prototype.getClassifierDataset=function(){return this.classDatasetMatrices},$.prototype.getNumClasses=function(){return Object.keys(this.classExampleCount).length},$.prototype.setClassifierDataset=function(M){for(var T in this.clearTrainDatasetMatrix(),this.classDatasetMatrices=M,M)this.classExampleCount[T]=M[T].shape[0]},$.prototype.calculateTopClass=function(M,T){var A,P={};if(M==null)return{classIndex:this.labelToClassId[A],label:A,confidences:P};var J={},ie=0;for(var pe in this.classDatasetMatrices)ie+=this.classExampleCount[pe],J[pe]=ie;var Ae={};for(var pe in this.classDatasetMatrices)Ae[pe]=0;for(var Ie=0;Ie<M.length;Ie++){var De=M[Ie];for(var pe in this.classDatasetMatrices)if(De<J[pe]){Ae[pe]++;break}}var et=0;for(var pe in this.classDatasetMatrices){var ot=Ae[pe]/T;ot>et&&(et=ot,A=pe),P[pe]=ot}return{classIndex:this.labelToClassId[A],label:A,confidences:P}},$.prototype.clearTrainDatasetMatrix=function(){this.trainDatasetMatrix!=null&&(this.trainDatasetMatrix.dispose(),this.trainDatasetMatrix=null)},$.prototype.normalizeVectorToUnitLength=function(M){return Object(ze.tidy)(function(){var T=M.norm();return Object(ze.div)(M,T)})},$.prototype.getNumExamples=function(){var M=0;for(var T in this.classDatasetMatrices)M+=this.classExampleCount[T];return M},$.prototype.dispose=function(){for(var M in this.clearTrainDatasetMatrix(),this.classDatasetMatrices)this.classDatasetMatrices[M].dispose()},$}(),Xr=function(){var $=G()(ge.a.mark(function M(T,A,P){var J,ie;return ge.a.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:(J=document.createElement("a")).style.display="none",document.body.appendChild(J),ie=new Blob([T],{type:P}),J.href=URL.createObjectURL(ie),J.download=A,J.click();case 7:case"end":return pe.stop()}},M)}));return function(M,T,A){return $.apply(this,arguments)}}(),Kn=function(){var $=G()(ge.a.mark(function M(T,A){return ge.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.abrupt("return",jt.a.get(T).then(function(J){return J.data}).then(function(J){return A&&A(null,J),J}).catch(function(J){throw A&&A(J),console.error("There has been a problem loading the file: ".concat(J.message)),J}));case 1:case"end":return P.stop()}},M)}));return function(M,T){return $.apply(this,arguments)}}(),di=function(){function $(){ce()(this,$),this.knnClassifier=new ei,this.mapStringToIndex=[]}return Ee()($,[{key:"addExample",value:function(M,T){var A,P;typeof T=="string"?A=this.mapStringToIndex.includes(T)?this.mapStringToIndex.indexOf(T):this.mapStringToIndex.push(T)-1:typeof T=="number"&&(A=T),P=Array.isArray(M)?I.tensor(M):M,this.knnClassifier.addExample(P,A)}},{key:"classify",value:function(){var M=G()(ge.a.mark(function T(A,P,J){var ie,pe,Ae;return ge.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return ie=3,pe=J,typeof P=="number"?ie=P:typeof P=="function"&&(pe=P),Ae=Array.isArray(A)?I.tensor(A):A,Ie.abrupt("return",Ge(this.classifyInternal(Ae,ie),pe));case 5:case"end":return Ie.stop()}},T,this)}));return function(T,A,P){return M.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var M=G()(ge.a.mark(function T(A,P){var J,ie,pe,Ae=this;return ge.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:if(!(this.knnClassifier.getNumClasses()<=0)){Ie.next=5;break}throw new Error("There is no example in any class");case 5:return Ie.next=7,this.knnClassifier.predictClass(A,P);case 7:return J=Ie.sent,this.mapStringToIndex.length>0&&((J.classIndex||J.classIndex===0)&&(ie=this.mapStringToIndex[J.classIndex])&&(J.label=ie),J.confidences&&(J.confidencesByLabel={},pe=J.confidences,Object.keys(pe).forEach(function(De){var et=Ae.mapStringToIndex[De];J.confidencesByLabel[et]=pe[De]}))),Ie.abrupt("return",J);case 10:case"end":return Ie.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()},{key:"clearLabel",value:function(M){var T;typeof M=="string"?this.mapStringToIndex.includes(M)&&(T=this.mapStringToIndex.indexOf(M)):typeof M=="number"&&(T=M),this.knnClassifier.clearClass(T)}},{key:"clearAllLabels",value:function(){this.mapStringToIndex=[],this.knnClassifier.clearAllClasses()}},{key:"getCountByLabel",value:function(){var M=this,T=this.knnClassifier.getClassExampleCount();if(this.mapStringToIndex.length>0){var A={};return Object.keys(T).forEach(function(P){if(M.mapStringToIndex[P]){var J=M.mapStringToIndex[P];A[J]=T[P]}}),A}return T}},{key:"getCount",value:function(){return this.knnClassifier.getClassExampleCount()}},{key:"getClassifierDataset",value:function(){return this.knnClassifier.getClassifierDataset()}},{key:"setClassifierDataset",value:function(M){this.knnClassifier.setClassifierDataset(M)}},{key:"getNumLabels",value:function(){return this.knnClassifier.getNumClasses()}},{key:"dispose",value:function(){this.knnClassifier.dispose()}},{key:"save",value:function(){var M=G()(ge.a.mark(function T(A){var P,J,ie,pe=this;return ge.a.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:return P=this.knnClassifier.getClassifierDataset(),this.mapStringToIndex.length>0&&Object.keys(P).forEach(function(Ie){pe.mapStringToIndex[Ie]&&(P[Ie].label=pe.mapStringToIndex[Ie])}),J=Object.keys(P).map(function(Ie){var De=P[Ie];return De?De.dataSync():null}),ie="myKNN.json",A&&(ie=A.endsWith(".json")?A:"".concat(A,".json")),Ae.next=7,Xr(JSON.stringify({dataset:P,tensors:J}),ie,"application/octet-stream");case 7:case"end":return Ae.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"load",value:function(){var M=G()(ge.a.mark(function T(A,P){var J,ie,pe,Ae,Ie;return ge.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(we()(A)!=="object"){De.next=4;break}J=A,De.next=7;break;case 4:return De.next=6,Kn(A);case 6:J=De.sent;case 7:J&&(pe=(ie=J).dataset,Ae=ie.tensors,this.mapStringToIndex=Object.keys(pe).map(function(et){return pe[et].label}),Ie=Ae.map(function(et,ot){if(et){var Bt=Object.keys(et).map(function(Vt){return et[Vt]});return I.tensor(Bt,pe[ot].shape,pe[ot].dtype)}return null}).reduce(function(et,ot,Bt){return et[Bt]=ot,et},{}),this.knnClassifier.setClassifierDataset(Ie),P&&P());case 8:case"end":return De.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()}]),$}(),Ei=function(){return new di},zr=function(){function $(M,T){ce()(this,$),this.videoElt=null,this.size=T,this.videoReady=!1,typeof HTMLVideoElement<"u"&&(M instanceof HTMLVideoElement?this.videoElt=M:M!==null&&we()(M)==="object"&&M.elt instanceof HTMLVideoElement&&(this.videoElt=M.elt))}return Ee()($,[{key:"loadVideo",value:function(){var M=G()(ge.a.mark(function T(){var A,P=this;return ge.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.abrupt("return",new Promise(function(ie,pe){P.videoElt||pe(new Error("No video was passed to the constructor.")),P.video=document.createElement("video");var Ae=navigator.userAgent;A=Ae.indexOf("Firefox")>-1?P.videoElt.mozCaptureStream():P.videoElt.captureStream(),P.video.srcObject=A,P.size&&(P.video.width=P.size,P.video.height=P.size),P.video.autoplay=!0,P.video.playsinline=!0,P.video.muted=!0;var Ie=P.video.play();Ie!==void 0&&Ie.then(function(){P.videoReady=!0,ie(P.video)})}));case 1:case"end":return J.stop()}},T)}));return function(){return M.apply(this,arguments)}}()}]),$}(),oo=224,zi=[oo,oo],eo="https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v",wo={version:1,alpha:.25,topk:3,learningRate:1e-4,hiddenUnits:100,epochs:20,numLabels:2,batchSize:.4,layer:"conv_pw_13_relu"},ba={1:{.25:"https://tfhub.dev/google/imagenet/mobilenet_v1_025_224/classification/1",.5:"https://tfhub.dev/google/imagenet/mobilenet_v1_050_224/classification/1",.75:"https://tfhub.dev/google/imagenet/mobilenet_v1_075_224/classification/1",1:"https://tfhub.dev/google/imagenet/mobilenet_v1_100_224/classification/1"},2:{.5:"https://tfhub.dev/google/imagenet/mobilenet_v2_050_224/classification/2",.75:"https://tfhub.dev/google/imagenet/mobilenet_v2_075_224/classification/2",1:"https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/classification/2"}},Ts={1:"module_apply_default/MobilenetV1/Logits/global_pool",2:"module_apply_default/MobilenetV2/Logits/AvgPool"},xh=function(){function $(M,T){ce()(this,$),this.mobilenet=null,this.topKPredictions=10,this.hasAnyTrainedClass=!1,this.customModel=null,this.jointModel=null,this.config={epochs:M.epochs||wo.epochs,version:M.version||wo.version,hiddenUnits:M.hiddenUnits||wo.hiddenUnits,numLabels:M.numLabels||wo.numLabels,learningRate:M.learningRate||wo.learningRate,batchSize:M.batchSize||wo.batchSize,layer:M.layer||wo.layer,alpha:M.alpha||wo.alpha},this.model=null,this.url=ba[this.config.version][this.config.alpha],this.normalizationOffset=I.scalar(127.5),this.mobilenetURL=M.mobilenetURL||"".concat(eo).concat(this.config.version,"_").concat(this.config.alpha,"_").concat(oo,"/model.json"),this.graphModelURL=M.graphModelURL||this.url,this.isPredicting=!1,this.mapStringToIndex=[],this.usageType=null,this.ready=Ge(this.loadModel(),T)}return Ee()($,[{key:"loadModel",value:function(){var M=G()(ge.a.mark(function T(){var A;return ge.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,I.loadLayersModel(this.mobilenetURL);case 2:if(this.mobilenet=P.sent,!this.graphModelURL.includes("https://tfhub.dev/")){P.next=9;break}return P.next=6,I.loadGraphModel(this.graphModelURL,{fromTFHub:!0});case 6:this.model=P.sent,P.next=12;break;case 9:return P.next=11,I.loadGraphModel(this.graphModelURL,{fromTFHub:!1});case 11:this.model=P.sent;case 12:return A=this.mobilenet.getLayer(this.config.layer),P.next=15,I.model({inputs:this.mobilenet.inputs,outputs:A.output});case 15:if(this.mobilenetFeatures=P.sent,!this.video){P.next=19;break}return P.next=19,this.mobilenetFeatures.predict(Vn(this.video,zi));case 19:return P.abrupt("return",this);case 20:case"end":return P.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"classification",value:function(M){var T,A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,P=arguments.length>2?arguments[2]:void 0;return this.usageType="classifier",we()(A)==="object"?Object.assign(this.config,A):typeof A=="function"&&(T=A),typeof P=="function"&&(T=P),M&&Ge(this.loadVideo(M),T),this}},{key:"regression",value:function(M,T){return this.usageType="regressor",M&&Ge(this.loadVideo(M),T),this}},{key:"loadVideo",value:function(){var M=G()(ge.a.mark(function T(A){var P,J;return ge.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(P=null,A instanceof HTMLVideoElement?P=A:we()(A)==="object"&&A.elt instanceof HTMLVideoElement&&(P=A.elt),!P){ie.next=7;break}return J=new zr(P,oo),ie.next=6,J.loadVideo();case 6:this.video=ie.sent;case 7:return ie.abrupt("return",this);case 8:case"end":return ie.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"addImage",value:function(){var M=G()(ge.a.mark(function T(A,P,J){var ie,pe,Ae;return ge.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return Ae=J,A instanceof HTMLImageElement||A instanceof HTMLVideoElement||A instanceof HTMLCanvasElement||A.elt instanceof ImageData?ie=A:we()(A)==="object"&&(A.elt instanceof HTMLImageElement||A.elt instanceof HTMLVideoElement||A.elt instanceof HTMLCanvasElement||A.elt instanceof ImageData)?ie=A.elt:typeof A!="string"&&typeof A!="number"||(ie=this.video,pe=A),typeof P=="string"||typeof P=="number"?pe=P:typeof P=="function"&&(Ae=P),typeof pe=="string"&&(pe=this.mapStringToIndex.includes(pe)?this.mapStringToIndex.indexOf(pe):this.mapStringToIndex.push(pe)-1),Ie.abrupt("return",Ge(this.addImageInternal(ie,pe),Ae));case 5:case"end":return Ie.stop()}},T,this)}));return function(T,A,P){return M.apply(this,arguments)}}()},{key:"addImageInternal",value:function(){var M=G()(ge.a.mark(function T(A,P){var J=this;return ge.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.next=2,this.ready;case 2:return I.tidy(function(){var pe,Ae=Vn(A,zi),Ie=J.mobilenetFeatures.predict(Ae);if(J.usageType==="classifier"?pe=I.tidy(function(){return I.oneHot(I.tensor1d([P],"int32"),J.config.numLabels)}):J.usageType==="regressor"&&(pe=I.tensor2d([[P]])),J.xs==null)J.xs=I.keep(Ie),J.ys=I.keep(pe),J.hasAnyTrainedClass=!0;else{var De=J.xs;J.xs=I.keep(De.concat(Ie,0));var et=J.ys;J.ys=I.keep(et.concat(pe,0)),De.dispose(),et.dispose(),pe.dispose()}}),ie.abrupt("return",this);case 4:case"end":return ie.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()},{key:"train",value:function(){var M=G()(ge.a.mark(function T(A){var P,J;return ge.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(this.hasAnyTrainedClass){ie.next=2;break}throw new Error("Add some examples before training!");case 2:if(this.isPredicting=!1,this.usageType==="classifier"?(this.loss="categoricalCrossentropy",this.customModel=I.sequential({layers:[I.layers.flatten({inputShape:[7,7,256]}),I.layers.dense({units:this.config.hiddenUnits,activation:"relu",kernelInitializer:"varianceScaling",useBias:!0}),I.layers.dense({units:this.config.numLabels,kernelInitializer:"varianceScaling",useBias:!1,activation:"softmax"})]})):this.usageType==="regressor"&&(this.loss="meanSquaredError",this.customModel=I.sequential({layers:[I.layers.flatten({inputShape:[7,7,256]}),I.layers.dense({units:this.config.hiddenUnits,activation:"relu",kernelInitializer:"varianceScaling",useBias:!0}),I.layers.dense({units:1,useBias:!1,kernelInitializer:"Zeros",activation:"linear"})]})),this.jointModel=I.sequential(),this.jointModel.add(this.mobilenetFeatures),this.jointModel.add(this.customModel),P=I.train.adam(this.config.learningRate),this.customModel.compile({optimizer:P,loss:this.loss}),(J=Math.floor(this.xs.shape[0]*this.config.batchSize))>0){ie.next=12;break}throw new Error("Batch size is 0 or NaN. Please choose a non-zero fraction.");case 12:return ie.abrupt("return",this.customModel.fit(this.xs,this.ys,{batchSize:J,epochs:this.config.epochs,callbacks:{onBatchEnd:function(){var pe=G()(ge.a.mark(function Ae(Ie,De){return ge.a.wrap(function(et){for(;;)switch(et.prev=et.next){case 0:return A(De.loss.toFixed(5)),et.next=3,I.nextFrame();case 3:case"end":return et.stop()}},Ae)}));return function(Ae,Ie){return pe.apply(this,arguments)}}(),onTrainEnd:function(){return A(null)}}}));case 13:case"end":return ie.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"classify",value:function(){var M=G()(ge.a.mark(function T(A,P){var J,ie;return ge.a.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return A instanceof HTMLImageElement||A instanceof HTMLVideoElement||A instanceof HTMLCanvasElement||A instanceof ImageData?J=A:we()(A)==="object"&&(A.elt instanceof HTMLImageElement||A.elt instanceof HTMLVideoElement||A.elt instanceof HTMLCanvasElement||A.elt instanceof ImageData)?J=A.elt:typeof A=="function"&&(J=this.video,ie=A),typeof P=="function"&&(ie=P),pe.abrupt("return",Ge(this.classifyInternal(J),ie));case 3:case"end":return pe.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()},{key:"classifyInternal",value:function(){var M=G()(ge.a.mark(function T(A){var P,J,ie=this;return ge.a.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:if(this.usageType==="classifier"){pe.next=2;break}throw new Error("Mobilenet Feature Extraction has not been set to be a classifier.");case 2:return pe.next=4,I.nextFrame();case 4:return this.isPredicting=!0,P=I.tidy(function(){var Ae=Vn(A,zi),Ie=ie.jointModel.predict(Ae);return Array.from(Ie.as1D().dataSync())}),pe.next=8,P.map(function(Ae,Ie){return{label:ie.mapStringToIndex.length>0&&ie.mapStringToIndex[Ie]?ie.mapStringToIndex[Ie]:Ie,confidence:Ae}}).sort(function(Ae,Ie){return Ie.confidence-Ae.confidence});case 8:return J=pe.sent,pe.abrupt("return",J);case 10:case"end":return pe.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"predict",value:function(){var M=G()(ge.a.mark(function T(A,P){var J,ie;return ge.a.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return A instanceof HTMLImageElement||A instanceof HTMLVideoElement||A instanceof HTMLCanvasElement||A instanceof ImageData?J=A:we()(A)==="object"&&(A.elt instanceof HTMLImageElement||A.elt instanceof HTMLVideoElement||A.elt instanceof HTMLCanvasElement||A.elt instanceof ImageData)?J=A.elt:typeof A=="function"&&(J=this.video,ie=A),typeof P=="function"&&(ie=P),pe.abrupt("return",Ge(this.predictInternal(J),ie));case 3:case"end":return pe.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()},{key:"predictInternal",value:function(){var M=G()(ge.a.mark(function T(A){var P,J,ie=this;return ge.a.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:if(this.usageType==="regressor"){pe.next=2;break}throw new Error("Mobilenet Feature Extraction has not been set to be a regressor.");case 2:return pe.next=4,I.nextFrame();case 4:return this.isPredicting=!0,P=I.tidy(function(){var Ae=Vn(A,zi);return ie.jointModel.predict(Ae).as1D()}),pe.next=8,P.data();case 8:return J=pe.sent,P.dispose(),pe.abrupt("return",{value:J[0]});case 11:case"end":return pe.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"load",value:function(){var M=G()(ge.a.mark(function T(){var A,P,J,ie,pe,Ae,Ie=this,De=arguments;return ge.a.wrap(function(et){for(;;)switch(et.prev=et.next){case 0:if(A=De.length>0&&De[0]!==void 0?De[0]:null,P=De.length>1?De[1]:void 0,typeof A=="string"){et.next=11;break}return J=null,ie=null,Array.from(A).forEach(function(ot){if(ot.name.includes(".json")){J=ot;var Bt=new FileReader;Bt.onload=function(Vt){JSON.parse(Vt.target.result).ml5Specs&&(Ie.mapStringToIndex=JSON.parse(Vt.target.result).ml5Specs.mapStringToIndex)},Bt.readAsText(ot)}else ot.name.includes(".bin")&&(ie=ot)}),et.next=8,I.loadLayersModel(I.io.browserFiles([J,ie]));case 8:this.jointModel=et.sent,et.next=20;break;case 11:return et.next=13,jt.a.get(A);case 13:return pe=et.sent,(Ae=pe.data).ml5Specs&&(this.mapStringToIndex=Ae.ml5Specs.mapStringToIndex),et.next=18,I.loadLayersModel(A);case 18:this.jointModel=et.sent,P&&P();case 20:return et.abrupt("return",this.jointModel);case 21:case"end":return et.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"save",value:function(){var M=G()(ge.a.mark(function T(A,P){var J=this;return ge.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(this.jointModel){ie.next=2;break}throw new Error("No model found.");case 2:this.jointModel.save(I.io.withSaveHandler(function(){var pe=G()(ge.a.mark(function Ae(Ie){var De;return ge.a.wrap(function(et){for(;;)switch(et.prev=et.next){case 0:return De="model",P&&(De=P),J.weightsManifest={modelTopology:Ie.modelTopology,weightsManifest:[{paths:["./".concat(De,".weights.bin")],weights:Ie.weightSpecs}],ml5Specs:{mapStringToIndex:J.mapStringToIndex}},et.next=5,Xr(Ie.weightData,"".concat(De,".weights.bin"),"application/octet-stream");case 5:return et.next=7,Xr(JSON.stringify(J.weightsManifest),"".concat(De,".json"),"text/plain");case 7:A&&A();case 8:case"end":return et.stop()}},Ae)}));return function(Ae){return pe.apply(this,arguments)}}()));case 3:case"end":return ie.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()},{key:"mobilenetInfer",value:function(M){var T=this,A=arguments.length>1&&arguments[1]!==void 0&&arguments[1],P=M;return P instanceof I.Tensor||P instanceof ImageData||P instanceof HTMLImageElement||P instanceof HTMLCanvasElement||P instanceof HTMLVideoElement?I.tidy(function(){P instanceof I.Tensor||(P=I.browser.fromPixels(P));var J=P.toFloat().sub(T.normalizationOffset).div(T.normalizationOffset),ie=J;(P.shape[0]!==oo||P.shape[1]!==oo)&&(ie=I.image.resizeBilinear(J,zi,!0));var pe,Ae=ie.reshape([-1,oo,oo,3]);if(A){var Ie=Ts[T.config.version];pe=T.model.execute(Ae,Ie).squeeze([1,2])}else pe=T.model.predict(Ae).slice([0,1],[-1,1e3]);return pe}):null}},{key:"infer",value:function(M,T){var A,P;if(M instanceof HTMLImageElement||M instanceof HTMLVideoElement||M instanceof HTMLCanvasElement||M instanceof ImageData)A=M;else{if(we()(M)!=="object"||!(M.elt instanceof HTMLImageElement||M.elt instanceof HTMLVideoElement||M.elt instanceof HTMLCanvasElement||M.elt instanceof ImageData))throw new Error("No input image found.");A=M.elt}return P=T&&typeof T=="string"?T:"conv_preds",this.mobilenetInfer(A,P)}}]),$}(),to=function($,M,T){var A;if(typeof $!="string")throw new Error('Please specify a model to use. E.g: "MobileNet"');A=$.toLowerCase();var P={},J=T;if(we()(M)==="object"?P=M:typeof M=="function"&&(J=M),A==="mobilenet")return new xh(P,J);throw new Error("".concat(A," is not a valid model."))},Cc=function(){console.log("%cword2vec has been disabled","color: #A155FF; font-size: 16px"),console.log("We've intentionally disabled the word2vec function after recognizing it has the potential to produce harmful outputs while using the model files included in our examples. We'll consider reenabling the word2vec function along with changes to address these issues in a future release of ml5.js. You can find further updates about this topic on our Twitter account (https://twitter.com/ml5js/status/1445762321444315147) and GitHub (https://github.com/ml5js/ml5-library/issues/1238).")},Uu=r(58),Yc=r.n(Uu),sc=r(57),Jc=r.n(sc),Rp=r(35),ys=r.n(Rp),sd=["person","bicycle","car","motorbike","aeroplane","bus","train","truck","boat","traffic light","fire hydrant","stop sign","parking meter","bench","bird","cat","dog","horse","sheep","cow","elephant","bear","zebra","giraffe","backpack","umbrella","handbag","tie","suitcase","frisbee","skis","snowboard","sports ball","kite","baseball bat","baseball glove","skateboard","surfboard","tennis racket","bottle","wine glass","cup","fork","knife","spoon","bowl","banana","apple","sandwich","orange","broccoli","carrot","hot dog","pizza","donut","cake","chair","sofa","pottedplant","bed","diningtable","toilet","tvmonitor","laptop","mouse","remote","keyboard","cell phone","microwave","oven","toaster","sink","refrigerator","book","clock","vase","scissors","teddy bear","hair drier","toothbrush"];function Pp($){return new RegExp("^(?:[a-z]+:)?//","i").test($)}var uc={isAbsoluteURL:Pp,getModelPath:function($){return Pp($)||typeof window>"u"?$:window.location.pathname+$}},ud=function($,M){var T=Math.min($[3],M[3])-Math.max($[1],M[1]),A=Math.min($[2],M[2])-Math.max($[0],M[0]);return T<0||A<0?0:T*A},wh=function($,M){return ud($,M)/function(T,A){var P=ud(T,A);return(T[3]-T[1])*(T[2]-T[0])+(A[3]-A[1])*(A[2]-A[0])-P}($,M)};function Qc($,M,T,A){return uf.apply(this,arguments)}function uf(){return(uf=G()(ge.a.mark(function $(M,T,A,P){return ge.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.abrupt("return",I.tidy(function(){for(var ie=I.mul(T,A),pe=I.argMax(ie,-1),Ae=I.max(ie,-1),Ie=I.greaterEqual(Ae,I.scalar(P)).dataSync(),De=[],et=0;et<Ie.length;et+=1)Ie[et]&&De.push(et);if(De.length===0)return[null,null,null];var ot=I.tensor1d(De,"int32");return[I.gather(M.reshape([Ie.length,4]),ot),I.gather(Ae.flatten(),ot),I.gather(pe.flatten(),ot)]}));case 1:case"end":return J.stop()}},$)}))).apply(this,arguments)}var Ua=function($,M){return I.tidy(function(){var T=I.tensor1d([2]),A=I.sub($,I.div(M,T)),P=I.add($,I.div(M,T)),J=[A.shape[0],A.shape[1],A.shape[2],1];return I.concat([A.slice([0,0,0,1],J),A.slice([0,0,0,0],J),P.slice([0,0,0,1],J),P.slice([0,0,0,0],J)],3)})},Sl=function($,M,T){return I.tidy(function(){for(var A=[],P=0;P<M.length;P+=1)A.push([M[P],[$[4*P],$[4*P+1],$[4*P+2],$[4*P+3]],P]);var J=[];return A.sort(function(ie,pe){return pe[0]-ie[0]}).forEach(function(ie){for(var pe=!0,Ae=0;Ae<J.length;Ae+=1)if(wh(ie[1],J[Ae][1])>T){pe=!1;break}pe&&J.push(ie)}),[J.map(function(ie){return ie[2]}),J.map(function(ie){return ie[1]}),J.map(function(ie){return ie[0]})]})};function ga($,M,T){return I.tidy(function(){var A=M.shape[0],P=I.reshape(M,[1,1,A,2]),J=$.shape.slice(1,3),ie=J[0],pe=J[1],Ae=I.range(0,J[0]),Ie=I.range(0,J[1]);Ae=I.tile(Ae,[J[1]]),Ie=I.tile(I.expandDims(Ie,0),[J[0],1]),Ie=I.transpose(Ie).flatten();var De=I.transpose(I.stack([Ae,Ie]));De=I.reshape(De,[J[0],J[1],1,2]),De=I.cast(De,$.dtype),$=I.reshape($,[J[0],J[1],A,T+5]),J=I.cast(I.reshape(I.tensor1d(J),[1,1,1,2]),$.dtype);var et=I.sigmoid($.slice([0,0,0,0],[ie,pe,A,2])),ot=I.exp($.slice([0,0,0,2],[ie,pe,A,2])),Bt=I.sigmoid($.slice([0,0,0,4],[ie,pe,A,1])),Vt=I.softmax($.slice([0,0,0,5],[ie,pe,A,T]));return[et=I.div(I.add(et,De),J),ot=I.div(I.mul(ot,P),J),Bt,Vt]})}function Ac($){var M=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var T,A=ys()($);if(M){var P=ys()(this).constructor;T=Reflect.construct(A,arguments,P)}else T=A.apply(this,arguments);return Jc()(this,T)}}var bs={modelUrl:"https://raw.githubusercontent.com/ml5js/ml5-data-and-training/master/models/YOLO/model.json",filterBoxesThreshold:.01,IOUThreshold:.4,classProbThreshold:.4},Fa=416,Oc=function($){Yc()(T,$);var M=Ac(T);function T(A,P,J){var ie;return ce()(this,T),(ie=M.call(this,A,Fa)).modelUrl=P.modelUrl||bs.modelUrl,ie.filterBoxesThreshold=P.filterBoxesThreshold||bs.filterBoxesThreshold,ie.IOUThreshold=P.IOUThreshold||bs.IOUThreshold,ie.classProbThreshold=P.classProbThreshold||bs.classProbThreshold,ie.modelReady=!1,ie.isPredicting=!1,ie.callback=J,ie.ready=Ge(ie.loadModel(),ie.callback),P.disableDeprecationNotice||console.warn("WARNING! Function YOLO has been deprecated, please use the new ObjectDetector function instead"),ie}return Ee()(T,[{key:"loadModel",value:function(){var A=G()(ge.a.mark(function P(){var J;return ge.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(!this.videoElt||this.video){ie.next=4;break}return ie.next=3,this.loadVideo();case 3:this.video=ie.sent;case 4:if(uc.isAbsoluteURL(this.modelUrl)!==!0){ie.next=10;break}return ie.next=7,I.loadLayersModel(this.modelUrl);case 7:this.model=ie.sent,ie.next=15;break;case 10:return J=uc.getModelPath(this.modelUrl),this.modelUrl="".concat(J,"/model.json"),ie.next=14,I.loadLayersModel(this.modelUrl);case 14:this.model=ie.sent;case 15:return this.modelReady=!0,ie.abrupt("return",this);case 17:case"end":return ie.stop()}},P,this)}));return function(){return A.apply(this,arguments)}}()},{key:"detect",value:function(){var A=G()(ge.a.mark(function P(J,ie){var pe,Ae;return ge.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return Ie.next=2,this.ready;case 2:if(Ae=ie,!xn(J)){Ie.next=7;break}pe=J,Ie.next=21;break;case 7:if(we()(J)!=="object"||!xn(J.elt)){Ie.next=11;break}pe=J.elt,Ie.next=21;break;case 11:if(we()(J)!=="object"||!xn(J.canvas)){Ie.next=15;break}pe=J.canvas,Ie.next=21;break;case 15:if(typeof J!="function"){Ie.next=20;break}pe=this.video,Ae=J,Ie.next=21;break;case 20:throw new Error("Detection subject not supported");case 21:return Ie.abrupt("return",Ge(this.detectInternal(pe),Ae));case 22:case"end":return Ie.stop()}},P,this)}));return function(P,J){return A.apply(this,arguments)}}()},{key:"detectInternal",value:function(){var A=G()(ge.a.mark(function P(J){var ie,pe,Ae,Ie,De,et,ot,Bt,Vt,yn,_n,Dn=this;return ge.a.wrap(function(Nn){for(;;)switch(Nn.prev=Nn.next){case 0:return Nn.next=2,this.ready;case 2:return Nn.next=4,I.nextFrame();case 4:return ie=I.tensor2d([[.57273,.677385],[1.87446,2.06253],[3.33843,5.47434],[7.88282,3.52778],[9.77052,9.16828]]),this.isPredicting=!0,pe=I.tidy(function(){var Wn=Vn(J,[Fa,Fa]),Jn=ga(Dn.model.predict(Wn),ie,80),Cn=Pn()(Jn,4),wr=Cn[0],Dr=Cn[1],Nr=Cn[2],Yr=Cn[3];return[Ua(wr,Dr),Nr,Yr]}),Ae=Pn()(pe,3),Ie=Ae[0],De=Ae[1],et=Ae[2],Nn.next=9,Qc(Ie,De,et,this.filterBoxesThreshold);case 9:if(ot=Nn.sent,Bt=Pn()(ot,3),Vt=Bt[0],yn=Bt[1],_n=Bt[2],Ie.dispose(),De.dispose(),et.dispose(),Vt!=null){Nn.next=19;break}return Nn.abrupt("return",[]);case 19:return Nn.abrupt("return",I.tidy(function(){var Wn=I.scalar(Fa),Jn=I.scalar(Fa),Cn=I.stack([Jn,Wn,Jn,Wn]).reshape([1,4]),wr=I.mul(Vt,Cn),Dr=wr.dataSync(),Nr=yn.dataSync(),Yr=Sl(Dr,Nr,Dn.IOUThreshold),jr=Pn()(Yr,3),Si=jr[0],Fi=jr[1],Ni=jr[2],Ao=[];return _n.gather(I.tensor1d(Si,"int32")).dataSync().forEach(function(Xo,Po){var Ro=Ni[Po];if(!(Ro<Dn.classProbThreshold)){var Uo=sd[Xo],sa=Pn()(Fi[Po],4),pa=sa[0],Da=sa[1],du=sa[2],Ri=sa[3];pa=Math.max(0,pa),Da=Math.max(0,Da),du=Math.min(Fa,du)-pa;var Qa={label:Uo,confidence:Ro,x:Da,y:pa,width:Ri=Math.min(Fa,Ri)-Da,height:du,normalized:{x:Da/Fa,y:pa/Fa,width:Ri/Fa,height:du/Fa}};Ao.push(Qa)}}),Dn.isPredicting=!1,Wn.dispose(),Jn.dispose(),Cn.dispose(),wr.dispose(),Vt.dispose(),yn.dispose(),_n.dispose(),ie.dispose(),Ao}));case 20:case"end":return Nn.stop()}},P,this)}));return function(P){return A.apply(this,arguments)}}()}]),T}(zr),cf=function($,M,T){var A=null,P={},J=T;return $ instanceof HTMLVideoElement?A=$:we()($)==="object"&&$.elt instanceof HTMLVideoElement?A=$.elt:typeof $=="function"?J=$:we()($)==="object"&&(P=$),we()(M)==="object"?P=M:typeof M=="function"&&(J=M),new Oc(A,P,J)},Tc=r(242),Mu={base:"lite_mobilenet_v2",modelUrl:void 0},_h=function(){function $(M,T,A){ce()(this,$),this.video=M||null,this.modelReady=!1,this.isPredicting=!1,this.config={base:T.base||Mu.base,modelUrl:T.modelUrl||Mu.modelUrl},this.callback=A,this.ready=Ge(this.loadModel(),this.callback)}return Ee()($,[{key:"loadModel",value:function(){var M=G()(ge.a.mark(function T(){return ge.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,Tc.load(this.config);case 2:return this.model=A.sent,this.modelReady=!0,A.abrupt("return",this);case 5:case"end":return A.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"detectInternal",value:function(){var M=G()(ge.a.mark(function T(A){var P,J;return ge.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return this.isPredicting=!0,ie.next=3,this.model.detect(A);case 3:return P=ie.sent,J=P.map(function(pe){return{label:pe.class,confidence:pe.score,x:pe.bbox[0],y:pe.bbox[1],width:pe.bbox[2],height:pe.bbox[3],normalized:{x:pe.bbox[0]/A.width,y:pe.bbox[1]/A.height,width:pe.bbox[2]/A.width,height:pe.bbox[3]/A.height}}}),this.isPredicting=!1,ie.abrupt("return",J);case 7:case"end":return ie.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"detect",value:function(){var M=G()(ge.a.mark(function T(A,P){var J,ie;return ge.a.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return pe.next=2,this.ready;case 2:return pe.next=4,I.nextFrame();case 4:if(ie=P,!xn(A)){pe.next=9;break}J=A,pe.next=23;break;case 9:if(we()(A)!=="object"||!xn(A.elt)){pe.next=13;break}J=A.elt,pe.next=23;break;case 13:if(we()(A)!=="object"||!xn(A.canvas)){pe.next=17;break}J=A.canvas,pe.next=23;break;case 17:if(typeof A!="function"){pe.next=22;break}J=this.video,ie=A,pe.next=23;break;case 22:throw new Error("Detection subject not supported");case 23:return pe.abrupt("return",Ge(this.detectInternal(J),ie));case 24:case"end":return pe.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()}]),$}(),cd=function($,M,T){var A=null,P={},J=T;return $ instanceof HTMLVideoElement?A=$:we()($)==="object"&&$.elt instanceof HTMLVideoElement?A=$.elt:typeof $=="function"?J=$:we()($)==="object"&&(P=$),we()(M)==="object"?P=M:typeof M=="function"&&(J=M),new _h(A,P,J)};function ld($,M){var T=Object.keys($);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols($);M&&(A=A.filter(function(P){return Object.getOwnPropertyDescriptor($,P).enumerable})),T.push.apply(T,A)}return T}var xa=Ee()(function $(M,T,A,P){switch(ce()(this,$),this.video=T,this.modelNameOrUrl=M,this.options=A||{},this.callback=P,M){case"yolo":return this.model=new cf(this.video,function(J){for(var ie=1;ie<arguments.length;ie++){var pe=arguments[ie]!=null?arguments[ie]:{};ie%2?ld(Object(pe),!0).forEach(function(Ae){q()(J,Ae,pe[Ae])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(pe)):ld(Object(pe)).forEach(function(Ae){Object.defineProperty(J,Ae,Object.getOwnPropertyDescriptor(pe,Ae))})}return J}({disableDeprecationNotice:!0},this.options),P),this;case"cocossd":default:return this.model=new cd(this.video,this.options,P),this}}),Eh=function($,M,T,A){var P,J={},ie=A,pe=$;if(typeof pe!="string")throw new Error('Please specify a model to use. E.g: "YOLO"');pe.indexOf("http")===-1&&(pe=$.toLowerCase()),M instanceof HTMLVideoElement?P=M:we()(M)==="object"&&M.elt instanceof HTMLVideoElement?P=M.elt:we()(M)==="object"?J=M:typeof M=="function"&&(ie=M),we()(T)==="object"?J=T:typeof T=="function"&&(ie=T);var Ae=new xa(pe,P,J,ie);return Ae.model.callback?Ae.model:Ae.model.ready},Lp=r(99),fd=r.n(Lp),dd=function($,M){return(dd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,A){T.__proto__=A}||function(T,A){for(var P in A)A.hasOwnProperty(P)&&(T[P]=A[P])})($,M)};function Ms($,M){function T(){this.constructor=$}dd($,M),$.prototype=M===null?Object.create(M):(T.prototype=M.prototype,new T)}var hd=function(){return(hd=Object.assign||function($){for(var M,T=1,A=arguments.length;T<A;T++)for(var P in M=arguments[T])Object.prototype.hasOwnProperty.call(M,P)&&($[P]=M[P]);return $}).apply(this,arguments)};function yr($,M,T,A){return new(T||(T=Promise))(function(P,J){function ie(Ie){try{Ae(A.next(Ie))}catch(De){J(De)}}function pe(Ie){try{Ae(A.throw(Ie))}catch(De){J(De)}}function Ae(Ie){Ie.done?P(Ie.value):new T(function(De){De(Ie.value)}).then(ie,pe)}Ae((A=A.apply($,M||[])).next())})}function Wu($,M){var T,A,P,J,ie={label:0,sent:function(){if(1&P[0])throw P[1];return P[1]},trys:[],ops:[]};return J={next:pe(0),throw:pe(1),return:pe(2)},typeof Symbol=="function"&&(J[Symbol.iterator]=function(){return this}),J;function pe(Ae){return function(Ie){return function(De){if(T)throw new TypeError("Generator is already executing.");for(;ie;)try{if(T=1,A&&(P=2&De[0]?A.return:De[0]?A.throw||((P=A.return)&&P.call(A),0):A.next)&&!(P=P.call(A,De[1])).done)return P;switch(A=0,P&&(De=[2&De[0],P.value]),De[0]){case 0:case 1:P=De;break;case 4:return ie.label++,{value:De[1],done:!1};case 5:ie.label++,A=De[1],De=[0];continue;case 7:De=ie.ops.pop(),ie.trys.pop();continue;default:if(!(P=(P=ie.trys).length>0&&P[P.length-1])&&(De[0]===6||De[0]===2)){ie=0;continue}if(De[0]===3&&(!P||De[1]>P[0]&&De[1]<P[3])){ie.label=De[1];break}if(De[0]===6&&ie.label<P[1]){ie.label=P[1],P=De;break}if(P&&ie.label<P[2]){ie.label=P[2],ie.ops.push(De);break}P[2]&&ie.ops.pop(),ie.trys.pop();continue}De=M.call($,ie)}catch(et){De=[6,et],A=0}finally{T=P=0}if(5&De[0])throw De[1];return{value:De[0]?De[1]:void 0,done:!0}}([Ae,Ie])}}}var $m=function(){function $(M,T){this.model=M,this.outputStride=T;var A=this.model.inputs[0].shape;ze.util.assert(A[1]===-1&&A[2]===-1,function(){return"Input shape ["+A[1]+", "+A[2]+"] must both be equal to or -1"})}return $.prototype.predict=function(M){var T=this;return Object(ze.tidy)(function(){var A=T.preprocessInput(Object(ze.cast)(M,"float32")),P=Object(ze.expandDims)(A,0),J=T.model.predict(P).map(function(pe){return Object(ze.squeeze)(pe,[0])}),ie=T.nameOutputResults(J);return{heatmapScores:Object(ze.sigmoid)(ie.heatmap),offsets:ie.offsets,displacementFwd:ie.displacementFwd,displacementBwd:ie.displacementBwd}})},$.prototype.dispose=function(){this.model.dispose()},$}(),Xm=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Ms(M,$),M.prototype.preprocessInput=function(T){return Object(ze.tidy)(function(){return Object(ze.sub)(Object(ze.div)(T,127.5),1)})},M.prototype.nameOutputResults=function(T){return{offsets:T[0],heatmap:T[1],displacementFwd:T[2],displacementBwd:T[3]}},M}($m);function pd($){return Math.floor($/2)}var lf=function(){function $(M,T){this.priorityQueue=new Array(M),this.numberOfElements=-1,this.getElementValue=T}return $.prototype.enqueue=function(M){this.priorityQueue[++this.numberOfElements]=M,this.swim(this.numberOfElements)},$.prototype.dequeue=function(){var M=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,M},$.prototype.empty=function(){return this.numberOfElements===-1},$.prototype.size=function(){return this.numberOfElements+1},$.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},$.prototype.max=function(){return this.priorityQueue[0]},$.prototype.swim=function(M){for(;M>0&&this.less(pd(M),M);)this.exchange(M,pd(M)),M=pd(M)},$.prototype.sink=function(M){for(;2*M<=this.numberOfElements;){var T=2*M;if(T<this.numberOfElements&&this.less(T,T+1)&&T++,!this.less(M,T))break;this.exchange(M,T),M=T}},$.prototype.getValueAt=function(M){return this.getElementValue(this.priorityQueue[M])},$.prototype.less=function(M,T){return this.getValueAt(M)<this.getValueAt(T)},$.prototype.exchange=function(M,T){var A=this.priorityQueue[M];this.priorityQueue[M]=this.priorityQueue[T],this.priorityQueue[T]=A},$}();function Bp($,M,T,A,P,J){for(var ie=J.shape,pe=ie[0],Ae=ie[1],Ie=!0,De=Math.max(T-P,0),et=Math.min(T+P+1,pe),ot=De;ot<et;++ot){for(var Bt=Math.max(A-P,0),Vt=Math.min(A+P+1,Ae),yn=Bt;yn<Vt;++yn)if(J.get(ot,yn,$)>M){Ie=!1;break}if(!Ie)break}return Ie}var Sh=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],kh=Sh.length,Hi=Sh.reduce(function($,M,T){return $[M]=T,$},{}),Lo=[["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]].map(function($){var M=$[0],T=$[1];return[Hi[M],Hi[T]]});function Ch($,M,T,A){return{y:A.get($,M,T),x:A.get($,M,T+kh)}}function Gg($,M,T){var A=Ch($.heatmapY,$.heatmapX,$.id,T),P=A.y,J=A.x;return{x:$.heatmapX*M+J,y:$.heatmapY*M+P}}function md($,M,T){return $<M?M:$>T?T:$}function jp($,M){return{x:$.x+M.x,y:$.y+M.y}}var Ds=[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]].map(function($){var M=$[0],T=$[1];return[Hi[M],Hi[T]]}),Mc=Ds.map(function($){return $[1]}),zp=Ds.map(function($){return $[0]});function Km($,M,T,A){return{y:md(Math.round($.y/M),0,T-1),x:md(Math.round($.x/M),0,A-1)}}function Ym($,M,T,A,P,J,ie,pe){pe===void 0&&(pe=2);for(var Ae=A.shape,Ie=Ae[0],De=Ae[1],et=function(Nn,Wn,Jn){var Cn=Jn.shape[2]/2;return{y:Jn.get(Wn.y,Wn.x,Nn),x:Jn.get(Wn.y,Wn.x,Cn+Nn)}}($,Km(M.position,J,Ie,De),ie),ot=jp(M.position,et),Bt=0;Bt<pe;Bt++){var Vt=Km(ot,J,Ie,De),yn=Ch(Vt.y,Vt.x,T,P);ot=jp({x:Vt.x*J,y:Vt.y*J},{x:yn.x,y:yn.y})}var _n=Km(ot,J,Ie,De),Dn=A.get(_n.y,_n.x,T);return{position:ot,part:Sh[T],score:Dn}}function qg($,M,T,A,P,J){var ie=M.shape[2],pe=Mc.length,Ae=new Array(ie),Ie=$.part,De=$.score,et=Gg(Ie,A,T);Ae[Ie.id]={score:De,part:Sh[Ie.id],position:et};for(var ot=pe-1;ot>=0;--ot){var Bt=Mc[ot],Vt=zp[ot];Ae[Bt]&&!Ae[Vt]&&(Ae[Vt]=Ym(ot,Ae[Bt],Vt,M,T,A,J))}for(ot=0;ot<pe;++ot)Bt=zp[ot],Vt=Mc[ot],Ae[Bt]&&!Ae[Vt]&&(Ae[Vt]=Ym(ot,Ae[Bt],Vt,M,T,A,P));return Ae}function $g($,M,T,A){var P=T.x,J=T.y;return $.some(function(ie){var pe=ie.keypoints[A].position;return function(Ae,Ie,De,et){var ot=De-Ae,Bt=et-Ie;return ot*ot+Bt*Bt}(J,P,pe.y,pe.x)<=M})}function kl($,M,T){return T.reduce(function(A,P,J){var ie=P.position,pe=P.score;return $g($,M,ie,J)||(A+=pe),A},0)/T.length}var Ka=1;function Ah($,M,T,A,P,J,ie,pe){ie===void 0&&(ie=.5),pe===void 0&&(pe=20);for(var Ae=[],Ie=function(Vt,yn,_n){for(var Dn=_n.shape,Nn=Dn[0],Wn=Dn[1],Jn=Dn[2],Cn=new lf(Nn*Wn*Jn,function(jr){return jr.score}),wr=0;wr<Nn;++wr)for(var Dr=0;Dr<Wn;++Dr)for(var Nr=0;Nr<Jn;++Nr){var Yr=_n.get(wr,Dr,Nr);Yr<Vt||Bp(Nr,Yr,wr,Dr,yn,_n)&&Cn.enqueue({score:Yr,part:{heatmapY:wr,heatmapX:Dr,id:Nr}})}return Cn}(ie,Ka,$),De=pe*pe;Ae.length<J&&!Ie.empty();){var et=Ie.dequeue();if(!$g(Ae,De,Gg(et.part,P,M),et.part.id)){var ot=qg(et,$,M,P,T,A),Bt=kl(Ae,De,ot);Ae.push({keypoints:ot,score:Bt})}}return Ae}function Ze($){var M=$.shape,T=M[0],A=M[1],P=M[2];return Object(ze.tidy)(function(){var J=Object(ze.reshape)($,[T*A,P]),ie=Object(ze.argMax)(J,0),pe=Object(ze.expandDims)(Object(ze.div)(ie,Object(ze.scalar)(A,"int32")),1),Ae=Object(ze.expandDims)(function(Ie,De){return Object(ze.tidy)(function(){var et=Object(ze.div)(Ie,Object(ze.scalar)(De,"int32"));return Object(ze.sub)(Ie,Object(ze.mul)(et,Object(ze.scalar)(De,"int32")))})}(ie,A),1);return Object(ze.concat)([pe,Ae],1)})}function cc($,M,T,A){return{y:A.get($,M,T),x:A.get($,M,T+kh)}}function gd($,M,T){return Object(ze.tidy)(function(){var A=function(P,J){for(var ie=[],pe=0;pe<kh;pe++){var Ae=cc(P.get(pe,0).valueOf(),P.get(pe,1).valueOf(),pe,J),Ie=Ae.x,De=Ae.y;ie.push(De),ie.push(Ie)}return Object(ze.tensor2d)(ie,[kh,2])}($,T);return Object(ze.add)(Object(ze.cast)(Object(ze.mul)($.toTensor(),Object(ze.scalar)(M,"int32")),"float32"),A)})}function Up($,M,T){return yr(this,void 0,void 0,function(){var A,P,J,ie,pe,Ae,Ie,De,et,ot;return Wu(this,function(Bt){switch(Bt.label){case 0:return A=0,P=Ze($),[4,Promise.all([$.buffer(),M.buffer(),P.buffer()])];case 1:return J=Bt.sent(),ie=J[0],pe=J[1],Ae=J[2],[4,(Ie=gd(Ae,T,pe)).buffer()];case 2:return De=Bt.sent(),et=Array.from(function(Vt,yn){for(var _n=yn.shape[0],Dn=new Float32Array(_n),Nn=0;Nn<_n;Nn++){var Wn=yn.get(Nn,0),Jn=yn.get(Nn,1);Dn[Nn]=Vt.get(Wn,Jn,Nn)}return Dn}(ie,Ae)),ot=et.map(function(Vt,yn){return A+=Vt,{position:{y:De.get(yn,0),x:De.get(yn,1)},part:Sh[yn],score:Vt}}),P.dispose(),Ie.dispose(),[2,{keypoints:ot,score:A/ot.length}]}})})}var Io="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/mobilenet/",Fo="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/resnet50/",ta=[-123.15,-115.9,-103.06],Ra=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Ms(M,$),M.prototype.preprocessInput=function(T){return Object(ze.add)(T,ta)},M.prototype.nameOutputResults=function(T){var A=T[0],P=T[1];return{offsets:T[2],heatmap:T[3],displacementFwd:A,displacementBwd:P}},M}($m);function Vu($,M){return Pt($,M)?$:Math.floor($/M)*M+1}function Pa($){ze.util.assert(typeof $=="number"||typeof $=="object",function(){return"Invalid inputResolution "+$+". Should be a number or an object with width and height"}),typeof $=="object"&&(ze.util.assert(typeof $.width=="number",function(){return"inputResolution.width has a value of "+$.width+" which is invalid; it must be a number"}),ze.util.assert(typeof $.height=="number",function(){return"inputResolution.height has a value of "+$.height+" which is invalid; it must be a number"}))}function Zc($,M){return Pa($),typeof $=="object"?[Vu($.height,M),Vu($.width,M)]:[Vu($,M),Vu($,M)]}var bu=[8,16,32];function Pt($,M){return($-1)%M==0}function _o($){return $ instanceof ze.Tensor?[$.shape[0],$.shape[1]]:[$.height,$.width]}function va($,M){var T=M[0],A=M[1],P=_o($),J=P[0],ie=P[1],pe=A/T,Ae=[0,0,0,0],Ie=Ae[0],De=Ae[1],et=Ae[2],ot=Ae[3];return ie/J<pe?(Ie=0,De=0,et=Math.round(.5*(pe*J-ie)),ot=Math.round(.5*(pe*J-ie))):(Ie=Math.round(.5*(1/pe*ie-J)),De=Math.round(.5*(1/pe*ie-J)),et=0,ot=0),{resized:Object(ze.tidy)(function(){var Bt=function(Vt){return Vt instanceof ze.Tensor?Vt:ze.browser.fromPixels(Vt)}($);return Bt=Object(ze.pad3d)(Bt,[[Ie,De],[et,ot],[0,0]]),ze.image.resizeBilinear(Bt,[T,A])}),padding:{top:Ie,left:et,right:ot,bottom:De}}}function Ya($,M,T,A,P){var J=M[0],ie=M[1],pe=T[0],Ae=T[1],Ie=function(De,et,ot,Bt,Vt){return Bt===void 0&&(Bt=0),Vt===void 0&&(Vt=0),ot===1&&et===1&&Bt===0&&Vt===0?De:De.map(function(yn){return function(_n,Dn,Nn,Wn,Jn){return Wn===void 0&&(Wn=0),Jn===void 0&&(Jn=0),{score:_n.score,keypoints:_n.keypoints.map(function(Cn){var wr=Cn.score,Dr=Cn.part,Nr=Cn.position;return{score:wr,part:Dr,position:{x:Nr.x*Nn+Jn,y:Nr.y*Dn+Wn}}})}}(yn,et,ot,Bt,Vt)})}($,(J+A.top+A.bottom)/pe,(ie+A.left+A.right)/Ae,-A.top,-A.left);return P?function(De,et){return et<=0?De:De.map(function(ot){return function(Bt,Vt){return{score:Bt.score,keypoints:Bt.keypoints.map(function(yn){var _n=yn.score,Dn=yn.part,Nn=yn.position;return{score:_n,part:Dn,position:{x:Vt-1-Nn.x,y:Nn.y}}})}}(ot,et)})}(Ie,ie):Ie}var To={architecture:"MobileNetV1",outputStride:16,multiplier:.75,inputResolution:257},Ns=["MobileNetV1","ResNet50"],kr={MobileNetV1:[8,16,32],ResNet50:[32,16]},ru={MobileNetV1:[.5,.75,1],ResNet50:[1]},xu=[1,2,4],Cl={flipHorizontal:!1},iu={flipHorizontal:!1,maxDetections:5,scoreThreshold:.5,nmsRadius:20},Oh=function(){function $(M,T){(function(A){ze.util.assert(typeof A=="number",function(){return"outputStride is not a number"}),ze.util.assert(bu.indexOf(A)>=0,function(){return"outputStride of "+A+" is invalid. It must be either 8, 16, or 32"})})(M.outputStride),function(A,P){ze.util.assert(typeof A[0]=="number"&&typeof A[1]=="number",function(){return"both resolution values must be a number but had values "+A}),ze.util.assert(Pt(A[0],P),function(){return"height of "+A[0]+" is invalid for output stride "+P+"."}),ze.util.assert(Pt(A[1],P),function(){return"width of "+A[1]+" is invalid for output stride "+P+"."})}(T,M.outputStride),this.baseModel=M,this.inputResolution=T}return $.prototype.estimateMultiplePoses=function(M,T){return T===void 0&&(T=iu),yr(this,void 0,void 0,function(){var A,P,J,ie,pe,Ae,Ie,De,et,ot,Bt,Vt,yn,_n,Dn,Nn,Wn,Jn,Cn,wr,Dr;return Wu(this,function(Nr){switch(Nr.label){case 0:return A=hd({},iu,T),function(Yr){var jr=Yr.maxDetections,Si=Yr.scoreThreshold,Fi=Yr.nmsRadius;if(jr<=0)throw new Error("Invalid maxDetections "+jr+". Should be > 0");if(Si<0||Si>1)throw new Error("Invalid scoreThreshold "+Si+". Should be in range [0.0, 1.0]");if(Fi<=0)throw new Error("Invalid nmsRadius "+Fi+".")}(T),P=this.baseModel.outputStride,J=this.inputResolution,ie=_o(M),pe=ie[0],Ae=ie[1],Ie=va(M,J),De=Ie.resized,et=Ie.padding,ot=this.baseModel.predict(De),Bt=ot.heatmapScores,Vt=ot.offsets,yn=ot.displacementFwd,_n=ot.displacementBwd,[4,function(Yr){return yr(this,void 0,void 0,function(){return Wu(this,function(jr){return[2,Promise.all(Yr.map(function(Si){return Si.buffer()}))]})})}([Bt,Vt,yn,_n])];case 1:return Dn=Nr.sent(),Nn=Dn[0],Wn=Dn[1],Jn=Dn[2],Cn=Dn[3],[4,Ah(Nn,Wn,Jn,Cn,P,A.maxDetections,A.scoreThreshold,A.nmsRadius)];case 2:return wr=Nr.sent(),Dr=Ya(wr,[pe,Ae],J,et,A.flipHorizontal),Bt.dispose(),Vt.dispose(),yn.dispose(),_n.dispose(),De.dispose(),[2,Dr]}})})},$.prototype.estimateSinglePose=function(M,T){return T===void 0&&(T=Cl),yr(this,void 0,void 0,function(){var A,P,J,ie,pe,Ae,Ie,De,et,ot,Bt,Vt,yn,_n,Dn,Nn;return Wu(this,function(Wn){switch(Wn.label){case 0:return A=hd({},Cl,T),P=this.baseModel.outputStride,J=this.inputResolution,ie=_o(M),pe=ie[0],Ae=ie[1],Ie=va(M,J),De=Ie.resized,et=Ie.padding,ot=this.baseModel.predict(De),Bt=ot.heatmapScores,Vt=ot.offsets,yn=ot.displacementFwd,_n=ot.displacementBwd,[4,Up(Bt,Vt,P)];case 1:return Dn=Wn.sent(),Nn=Ya([Dn],[pe,Ae],J,et,A.flipHorizontal),Bt.dispose(),Vt.dispose(),yn.dispose(),_n.dispose(),De.dispose(),[2,Nn[0]]}})})},$.prototype.estimatePoses=function(M,T){return yr(this,void 0,void 0,function(){return Wu(this,function(A){switch(A.label){case 0:return T.decodingMethod!=="single-person"?[3,2]:[4,this.estimateSinglePose(M,T)];case 1:return[2,[A.sent()]];case 2:return[2,this.estimateMultiplePoses(M,T)]}})})},$.prototype.dispose=function(){this.baseModel.dispose()},$}();function Wp($){return yr(this,void 0,void 0,function(){var M,T,A,P,J,ie,pe;return Wu(this,function(Ae){switch(Ae.label){case 0:if(M=$.outputStride,T=$.quantBytes,A=$.multiplier,ze==null)throw new Error(`Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this
        model.`);return P=function(Ie,De,et){var ot={1:"100",.75:"075",.5:"050"},Bt="model-stride"+Ie+".json";return et===4?Io+"float/"+ot[De]+"/"+Bt:Io+"quant"+et+"/"+ot[De]+"/"+Bt}(M,A,T),[4,Object(Mt.loadGraphModel)($.modelUrl||P)];case 1:return J=Ae.sent(),ie=new Xm(J,M),pe=Zc($.inputResolution,ie.outputStride),[2,new Oh(ie,pe)]}})})}function Vp($){return yr(this,void 0,void 0,function(){var M,T,A,P,J,ie;return Wu(this,function(pe){switch(pe.label){case 0:if(M=$.outputStride,T=$.quantBytes,ze==null)throw new Error(`Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this
        model.`);return A=function(Ae,Ie){var De="model-stride"+Ae+".json";return Ie===4?Fo+"float/"+De:Fo+"quant"+Ie+"/"+De}(M,T),[4,Object(Mt.loadGraphModel)($.modelUrl||A)];case 1:return P=pe.sent(),J=new Ra(P,M),ie=Zc($.inputResolution,J.outputStride),[2,new Oh(J,ie)]}})})}function Du($){return $===void 0&&($=To),yr(this,void 0,void 0,function(){return Wu(this,function(M){return($=function(T){if((T=T||To).architecture==null&&(T.architecture="MobileNetV1"),Ns.indexOf(T.architecture)<0)throw new Error("Invalid architecture "+T.architecture+". Should be one of "+Ns);if(T.inputResolution==null&&(T.inputResolution=257),Pa(T.inputResolution),T.outputStride==null&&(T.outputStride=16),kr[T.architecture].indexOf(T.outputStride)<0)throw new Error("Invalid outputStride "+T.outputStride+". Should be one of "+kr[T.architecture]+" for architecture "+T.architecture+".");if(T.multiplier==null&&(T.multiplier=1),ru[T.architecture].indexOf(T.multiplier)<0)throw new Error("Invalid multiplier "+T.multiplier+". Should be one of "+ru[T.architecture]+" for architecture "+T.architecture+".");if(T.quantBytes==null&&(T.quantBytes=4),xu.indexOf(T.quantBytes)<0)throw new Error("Invalid quantBytes "+T.quantBytes+". Should be one of "+xu+" for architecture "+T.architecture+".");if(T.architecture==="MobileNetV1"&&T.outputStride===32&&T.multiplier!==1)throw new Error("When using an output stride of 32, you must select 1 as the multiplier.");return T}($)).architecture==="ResNet50"?[2,Vp($)]:$.architecture==="MobileNetV1"?[2,Wp($)]:[2,null]})})}function ao($){var M=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var T,A=ys()($);if(M){var P=ys()(this).constructor;T=Reflect.construct(A,arguments,P)}else T=A.apply(this,arguments);return Jc()(this,T)}}var Is={architecture:"MobileNetV1",outputStride:16,flipHorizontal:!1,minConfidence:.5,maxPoseDetections:5,scoreThreshold:.5,nmsRadius:20,detectionType:"multiple",inputResolution:256,multiplier:.75,quantBytes:2,modelUrl:null},Th=function($){Yc()(T,$);var M=ao(T);function T(A,P,J,ie){var pe;return ce()(this,T),(pe=M.call(this)).video=A,pe.modelUrl=P.modelUrl||null,pe.architecture=P.architecture||Is.architecture,pe.detectionType=J||P.detectionType||Is.detectionType,pe.outputStride=P.outputStride||Is.outputStride,pe.flipHorizontal=P.flipHorizontal||Is.flipHorizontal,pe.scoreThreshold=P.scoreThreshold||Is.scoreThreshold,pe.minConfidence=P.minConfidence||Is.minConfidence,pe.maxPoseDetections=P.maxPoseDetections||Is.maxPoseDetections,pe.multiplier=P.multiplier||Is.multiplier,pe.inputResolution=P.inputResolution||Is.inputResolution,pe.quantBytes=P.quantBytes||Is.quantBytes,pe.nmsRadius=P.nmsRadius||Is.nmsRadius,pe.ready=Ge(pe.load(),ie),pe}return Ee()(T,[{key:"load",value:function(){var A=G()(ge.a.mark(function P(){var J,ie=this;return ge.a.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return J=this.architecture.toLowerCase()==="mobilenetv1"?{architecture:this.architecture,outputStride:this.outputStride,inputResolution:this.inputResolution,multiplier:this.multiplier,quantBytes:this.quantBytes,modelUrl:this.modelUrl}:{architecture:this.architecture,outputStride:this.outputStride,inputResolution:this.inputResolution,quantBytes:this.quantBytes},pe.next=3,Du(J);case 3:if(this.net=pe.sent,!this.video){pe.next=9;break}if(this.video.readyState!==0){pe.next=8;break}return pe.next=8,new Promise(function(Ae){ie.video.onloadeddata=function(){return Ae()}});case 8:this.detectionType==="single"?this.singlePose():this.multiPose();case 9:return pe.abrupt("return",this);case 10:case"end":return pe.stop()}},P,this)}));return function(){return A.apply(this,arguments)}}()},{key:"skeleton",value:function(A){return function(P,J){return Lo.reduce(function(ie,pe){var Ae=pe[0],Ie=pe[1];return function(De,et,ot){return De<ot||et<ot}(P[Ae].score,P[Ie].score,J)||ie.push([P[Ae],P[Ie]]),ie},[])}(A,arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.minConfidence)}},{key:"mapParts",value:function(A){var P=JSON.parse(JSON.stringify(A));return P.keypoints.forEach(function(J){P[J.part]={x:J.position.x,y:J.position.y,confidence:J.score}}),P}},{key:"getInput",value:function(A){return A instanceof HTMLImageElement||A instanceof HTMLVideoElement||A instanceof HTMLCanvasElement||A instanceof ImageData?A:we()(A)==="object"&&(A.elt instanceof HTMLImageElement||A.elt instanceof HTMLVideoElement||A.elt instanceof ImageData)?A.elt:we()(A)==="object"&&A.canvas instanceof HTMLCanvasElement?A.canvas:this.video}},{key:"singlePose",value:function(){var A=G()(ge.a.mark(function P(J,ie){var pe,Ae,Ie,De,et=this;return ge.a.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:return pe=this.getInput(J),ot.next=3,this.net.estimateSinglePose(pe,{flipHorizontal:this.flipHorizontal});case 3:if(Ae=ot.sent,Ie=this.mapParts(Ae),De=[{pose:Ie,skeleton:this.skeleton(Ae.keypoints)}],this.emit("pose",De),!this.video){ot.next=9;break}return ot.abrupt("return",I.nextFrame().then(function(){return et.singlePose()}));case 9:return typeof ie=="function"&&ie(De),ot.abrupt("return",De);case 11:case"end":return ot.stop()}},P,this)}));return function(P,J){return A.apply(this,arguments)}}()},{key:"multiPose",value:function(){var A=G()(ge.a.mark(function P(J,ie){var pe,Ae,Ie,De,et=this;return ge.a.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:return pe=this.getInput(J),ot.next=3,this.net.estimateMultiplePoses(pe,{flipHorizontal:this.flipHorizontal,maxDetections:this.maxPoseDetections,scoreThreshold:this.scoreThreshold,nmsRadius:this.nmsRadius});case 3:if(Ae=ot.sent,Ie=Ae.map(function(Bt){return et.mapParts(Bt)}),De=Ie.map(function(Bt){return{pose:Bt,skeleton:et.skeleton(Bt.keypoints)}}),this.emit("pose",De),!this.video){ot.next=9;break}return ot.abrupt("return",I.nextFrame().then(function(){return et.multiPose()}));case 9:return typeof ie=="function"&&ie(De),ot.abrupt("return",De);case 11:case"end":return ot.stop()}},P,this)}));return function(P,J){return A.apply(this,arguments)}}()}]),T}(fd.a),Dc=function($,M,T){var A,P={},J=T,ie=null;return $ instanceof HTMLVideoElement?A=$:we()($)==="object"&&$.elt instanceof HTMLVideoElement?A=$.elt:we()($)==="object"?P=$:typeof $=="function"&&(J=$),we()(M)==="object"?P=M:typeof M=="string"&&(ie=M),typeof M=="function"&&(J=M),new Th(A,P,ie,J)},xs=function(){function $(M){ce()(this,$),this.urlPath=M.endsWith("/")?M:"".concat(M,"/"),this.variables={}}return Ee()($,[{key:"loadManifest",value:function(){var M=G()(ge.a.mark(function T(){var A;return ge.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.prev=0,P.next=3,jt.a.get(this.urlPath+"manifest.json");case 3:return A=P.sent,P.abrupt("return",A.data);case 7:throw P.prev=7,P.t0=P.catch(0),new Error("".concat("manifest.json"," not found at ").concat(this.urlPath,". ").concat(P.t0));case 10:case"end":return P.stop()}},T,this,[[0,7]])}));return function(){return M.apply(this,arguments)}}()},{key:"loadVariable",value:function(){var M=G()(ge.a.mark(function T(A){var P,J,ie,pe,Ae,Ie,De;return ge.a.wrap(function(et){for(;;)switch(et.prev=et.next){case 0:return et.next=2,this.getCheckpointManifest();case 2:if(P=et.sent,A in P){et.next=5;break}throw new Error("Cannot load non-existent variable ".concat(A));case 5:return J=P[A],ie=J.filename,pe=J.shape,Ae=this.urlPath+ie,et.prev=7,et.next=10,jt.a.get(Ae,{responseType:"arraybuffer"});case 10:return Ie=et.sent,De=new Float32Array(Ie.data),et.abrupt("return",I.tensor(De,pe));case 15:throw et.prev=15,et.t0=et.catch(7),new Error("Error loading variable ".concat(A," from URL ").concat(Ae,": ").concat(et.t0));case 18:case"end":return et.stop()}},T,this,[[7,15]])}));return function(T){return M.apply(this,arguments)}}()},{key:"getCheckpointManifest",value:function(){var M=G()(ge.a.mark(function T(){return ge.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(this.checkpointManifest){A.next=4;break}return A.next=3,this.loadManifest();case 3:this.checkpointManifest=A.sent;case 4:return A.abrupt("return",this.checkpointManifest);case 5:case"end":return A.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"getKeys",value:function(){var M=G()(ge.a.mark(function T(){var A;return ge.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,this.getCheckpointManifest();case 2:return A=P.sent,P.abrupt("return",Object.keys(A));case 4:case"end":return P.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"getAllVariables",value:function(){var M=G()(ge.a.mark(function T(){var A,P,J=this;return ge.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.next=2,this.getKeys();case 2:return A=ie.sent,P=A.map(function(pe){return J.getVariable(pe)}),ie.next=6,Promise.all(P);case 6:return ie.abrupt("return",this.variables);case 7:case"end":return ie.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"getVariable",value:function(){var M=G()(ge.a.mark(function T(A){return ge.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(this.variables[A]){P.next=4;break}return P.next=3,this.loadVariable(A);case 3:this.variables[A]=P.sent;case 4:return P.abrupt("return",this.variables[A]);case 5:case"end":return P.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()}]),$}();function mi($){var M=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var T,A=ys()($);if(M){var P=ys()(this).constructor;T=Reflect.construct(A,arguments,P)}else T=A.apply(this,arguments);return Jc()(this,T)}}var Ho=200,Mh=function($){return new Promise(function(M){var T=new Image(Ho,Ho);T.onload=function(){return M(T)},T.src=$.toDataURL()})},Hp=function($){Yc()(T,$);var M=mi(T);function T(A,P,J){var ie;return ce()(this,T),(ie=M.call(this,P,Ho)).ready=!1,ie.variableDictionary={},ie.timesScalar=I.scalar(150),ie.plusScalar=I.scalar(127.5),ie.epsilonScalar=I.scalar(.001),ie.video=null,ie.ready=Ge(ie.load(A),J),ie}return Ee()(T,[{key:"load",value:function(){var A=G()(ge.a.mark(function P(J){return ge.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(!this.videoElt){ie.next=3;break}return ie.next=3,this.loadVideo();case 3:return ie.next=5,this.loadCheckpoints(J);case 5:return ie.abrupt("return",this);case 6:case"end":return ie.stop()}},P,this)}));return function(P){return A.apply(this,arguments)}}()},{key:"loadCheckpoints",value:function(){var A=G()(ge.a.mark(function P(J){var ie;return ge.a.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return ie=new xs(J),pe.next=3,ie.getAllVariables();case 3:this.variables=pe.sent;case 4:case"end":return pe.stop()}},P,this)}));return function(P){return A.apply(this,arguments)}}()},{key:"instanceNorm",value:function(A,P){var J=this;return I.tidy(function(){var ie=Pn()(A.shape,3),pe=ie[0],Ae=ie[1],Ie=ie[2],De=I.moments(A,[0,1]),et=De.mean,ot=De.variance,Bt=J.variables[T.getVariableName(P)],Vt=J.variables[T.getVariableName(P+1)],yn=J.epsilonScalar,_n=I.div(I.sub(A.asType("float32"),et),I.sqrt(I.add(ot,yn)));return I.add(I.mul(Vt,_n),Bt).as3D(pe,Ae,Ie)})}},{key:"convLayer",value:function(A,P,J,ie){var pe=I.conv2d(A,this.variables[T.getVariableName(ie)],[P,P],"same"),Ae=this.instanceNorm(pe,ie+1);return J?I.relu(Ae):Ae}},{key:"residualBlock",value:function(A,P){var J=this.convLayer(A,1,!0,P),ie=this.convLayer(J,1,!1,P+3);return I.add(ie,A)}},{key:"convTransposeLayer",value:function(A,P,J,ie){var pe=Pn()(A.shape,2),Ae=[pe[0]*J,pe[1]*J,P],Ie=I.conv2dTranspose(A,this.variables[T.getVariableName(ie)],Ae,[J,J],"same"),De=this.instanceNorm(Ie,ie+1);return I.relu(De)}},{key:"transfer",value:function(){var A=G()(ge.a.mark(function P(J,ie){var pe,Ae;return ge.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:if(Ae=ie,!(J instanceof HTMLVideoElement||J instanceof HTMLImageElement||J instanceof ImageData)){Ie.next=5;break}pe=J,Ie.next=18;break;case 5:if(!(J instanceof HTMLCanvasElement)){Ie.next=11;break}return Ie.next=8,Mh(J);case 8:pe=Ie.sent,Ie.next=18;break;case 11:if(!(we()(J)==="object"&&J.elt instanceof HTMLCanvasElement)){Ie.next=17;break}return Ie.next=14,Mh(J.elt);case 14:pe=Ie.sent,Ie.next=18;break;case 17:we()(J)==="object"&&(J.elt instanceof HTMLVideoElement||J.elt instanceof HTMLImageElement||J.elt instanceof ImageData)?pe=J.elt:typeof J=="function"&&(pe=this.video,Ae=J);case 18:return Ie.abrupt("return",Ge(this.transferInternal(pe),Ae));case 19:case"end":return Ie.stop()}},P,this)}));return function(P,J){return A.apply(this,arguments)}}()},{key:"transferInternal",value:function(){var A=G()(ge.a.mark(function P(J){var ie,pe,Ae=this;return ge.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return ie=I.browser.fromPixels(J),pe=Xt(I.tidy(function(){var De=Ae.convLayer(ie,1,!0,0),et=Ae.convLayer(De,2,!0,3),ot=Ae.convLayer(et,2,!0,6),Bt=Ae.residualBlock(ot,9),Vt=Ae.residualBlock(Bt,15),yn=Ae.residualBlock(Vt,21),_n=Ae.residualBlock(yn,27),Dn=Ae.residualBlock(_n,33),Nn=Ae.convTransposeLayer(Dn,64,2,39),Wn=Ae.convTransposeLayer(Nn,32,2,42),Jn=Ae.convLayer(Wn,1,!1,45),Cn=I.tanh(Jn),wr=I.mul(Ae.timesScalar,Cn),Dr=I.add(Ae.plusScalar,wr),Nr=I.clipByValue(Dr,0,255);return I.div(Nr,I.scalar(255))})),ie.dispose(),Ie.next=5,I.nextFrame();case 5:return Ie.abrupt("return",pe);case 6:case"end":return Ie.stop()}},P)}));return function(P){return A.apply(this,arguments)}}()}],[{key:"getVariableName",value:function(A){return A===0?"Variable":"Variable_".concat(A)}}]),T}(zr),ff=function($,M,T){var A=T;typeof M=="function"&&(A=M);var P=new Hp($,M,A);return A?P:P.ready},Dh=function($){for(var M,T=Math.random(),A=0,P=0;P<$.length;P+=1)if(T<(A+=$[P])){M=P;break}return M},Gi=/cell_[0-9]|lstm_[0-9]/gi,Di=/weights|weight|kernel|kernels|w/gi,da=/softmax/gi,Gp=function(){function $(M,T){ce()(this,$),this.ready=!1,this.model={},this.cellsAmount=0,this.cells=[],this.zeroState={c:[],h:[]},this.state={c:[],h:[]},this.vocab={},this.vocabSize=0,this.probabilities=[],this.defaults={seed:"a",length:20,temperature:.5,stateful:!1},this.ready=Ge(this.loadCheckpoints(M),T)}return Ee()($,[{key:"resetState",value:function(){this.state=this.zeroState}},{key:"setState",value:function(M){this.state=M}},{key:"getState",value:function(){return this.state}},{key:"loadCheckpoints",value:function(){var M=G()(ge.a.mark(function T(A){var P,J,ie=this;return ge.a.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return P=new xs(A),pe.next=3,P.getAllVariables();case 3:return J=pe.sent,Object.keys(J).forEach(function(Ae){Ae.match(Gi)?Ae.match(Di)?(ie.model["Kernel_".concat(Ae.match(/[0-9]/)[0])]=J[Ae],ie.cellsAmount+=1):ie.model["Bias_".concat(Ae.match(/[0-9]/)[0])]=J[Ae]:Ae.match(da)?Ae.match(Di)?ie.model.fullyConnectedWeights=J[Ae]:ie.model.fullyConnectedBiases=J[Ae]:ie.model[Ae]=J[Ae]}),pe.next=7,this.loadVocab(A);case 7:return pe.next=9,this.initCells();case 9:return pe.abrupt("return",this);case 10:case"end":return pe.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"loadVocab",value:function(){var M=G()(ge.a.mark(function T(A){var P,J;return ge.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.prev=0,ie.next=3,jt.a.get("".concat(A,"/vocab.json"));case 3:return P=ie.sent,J=P.data,this.vocab=J,this.vocabSize=Object.keys(J).length,ie.abrupt("return",this.vocab);case 10:return ie.prev=10,ie.t0=ie.catch(0),ie.abrupt("return",ie.t0);case 13:case"end":return ie.stop()}},T,this,[[0,10]])}));return function(T){return M.apply(this,arguments)}}()},{key:"initCells",value:function(){var M=G()(ge.a.mark(function T(){var A,P,J,ie=this;return ge.a.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:for(this.cells=[],this.zeroState={c:[],h:[]},A=I.tensor(1),P=function(Ae){return function(Ie,De,et){return I.basicLSTMCell(A,ie.model["Kernel_".concat(Ae)],ie.model["Bias_".concat(Ae)],Ie,De,et)}},J=0;J<this.cellsAmount;J+=1)this.zeroState.c.push(I.zeros([1,this.model["Bias_".concat(J)].shape[0]/4])),this.zeroState.h.push(I.zeros([1,this.model["Bias_".concat(J)].shape[0]/4])),this.cells.push(P(J));this.state=this.zeroState;case 6:case"end":return pe.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"generateInternal",value:function(){var M=G()(ge.a.mark(function T(A){var P,J,ie,pe,Ae,Ie,De,et,ot,Bt,Vt,yn,_n,Dn,Nn,Wn,Jn,Cn,wr,Dr=this;return ge.a.wrap(function(Nr){for(;;)switch(Nr.prev=Nr.next){case 0:return Nr.next=2,this.ready;case 2:P=A.seed||this.defaults.seed,J=+A.length||this.defaults.length,ie=+A.temperature||this.defaults.temperature,A.stateful||this.defaults.stateful||(this.state=this.zeroState),pe=[],Ae=Array.from(P),Ie=[],Ae.forEach(function(Yr){Ie.push(Dr.vocab[Yr])}),De=Ie[0],et=[],ot=0;case 14:if(!(ot<Ae.length+J+-1)){Nr.next=36;break}return Nr.next=17,I.buffer([1,this.vocabSize]);case 17:return(Bt=Nr.sent).set(1,0,De),Vt=Bt.toTensor(),yn=void 0,this.model.embedding?(_n=I.matMul(Vt,this.model.embedding),yn=I.multiRNNCell(this.cells,_n,this.state.c,this.state.h)):yn=I.multiRNNCell(this.cells,Vt,this.state.c,this.state.h),this.state.c=yn[0],this.state.h=yn[1],Dn=this.state.h[1],Nn=I.matMul(Dn,this.model.fullyConnectedWeights),Wn=I.add(Nn,this.model.fullyConnectedBiases),Jn=I.div(Wn,I.tensor(ie)),Cn=I.exp(Jn),Nr.next=31,I.div(Cn,I.sum(Cn)).data();case 31:et=Nr.sent,ot<Ae.length-1?De=Ie[ot+1]:(De=Dh(et),pe.push(De));case 33:ot+=1,Nr.next=14;break;case 36:return wr="",pe.forEach(function(Yr){var jr=Object.keys(Dr.vocab).find(function(Si){return Dr.vocab[Si]===Yr});jr&&(wr+=jr)}),this.probabilities=et,Nr.abrupt("return",{sample:wr,state:this.state});case 40:case"end":return Nr.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"reset",value:function(){this.state=this.zeroState}},{key:"generate",value:function(){var M=G()(ge.a.mark(function T(A,P){return ge.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return this.reset(),J.abrupt("return",Ge(this.generateInternal(A),P));case 2:case"end":return J.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()},{key:"predict",value:function(){var M=G()(ge.a.mark(function T(A,P){var J,ie,pe,Ae,Ie,De,et,ot,Bt,Vt,yn=this;return ge.a.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:return J=[],ie=A>0?A:.1,pe=this.state.h[1],Ae=I.matMul(pe,this.model.fullyConnectedWeights),Ie=I.add(Ae,this.model.fullyConnectedBiases),De=I.div(Ie,I.tensor(ie)),et=I.exp(De),_n.next=9,I.div(et,I.sum(et)).data();case 9:return J=_n.sent,ot=Dh(J),Bt=Object.keys(this.vocab).find(function(Dn){return yn.vocab[Dn]===ot}),this.probabilities=J,P&&P(Bt),Vt=Object.keys(this.vocab).map(function(Dn){return{char:Dn,probability:yn.probabilities[yn.vocab[Dn]]}}),_n.abrupt("return",{sample:Bt,probabilities:Vt});case 16:case"end":return _n.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()},{key:"feed",value:function(){var M=G()(ge.a.mark(function T(A,P){var J,ie,pe,Ae,Ie,De,et,ot,Bt=this;return ge.a.wrap(function(Vt){for(;;)switch(Vt.prev=Vt.next){case 0:return Vt.next=2,this.ready;case 2:J=Array.from(A),ie=[],J.forEach(function(yn){ie.push(Bt.vocab[yn])}),pe=ie[0],Ae=0;case 7:if(!(Ae<J.length)){Vt.next=21;break}return Vt.next=10,I.buffer([1,this.vocabSize]);case 10:(Ie=Vt.sent).set(1,0,pe),De=Ie.toTensor(),et=void 0,this.model.embedding?(ot=I.matMul(De,this.model.embedding),et=I.multiRNNCell(this.cells,ot,this.state.c,this.state.h)):et=I.multiRNNCell(this.cells,De,this.state.c,this.state.h),this.state.c=et[0],this.state.h=et[1],pe=ie[Ae];case 18:Ae+=1,Vt.next=7;break;case 21:P&&P();case 22:case"end":return Vt.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()}]),$}(),qp=function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"./",M=arguments.length>1?arguments[1]:void 0;return new Gp($,M)},$p=function(){function $(M){ce()(this,$),this.urlPath=M}return Ee()($,[{key:"getAllVariables",value:function(){var M=G()(ge.a.mark(function T(){var A,P,J,ie,pe,Ae,Ie,De,et,ot;return ge.a.wrap(function(Bt){for(;;)switch(Bt.prev=Bt.next){case 0:return Bt.next=2,jt.a.get(this.urlPath,{responseType:"arraybuffer"}).catch(function(Vt){throw new Error("No model found. Failed with error ".concat(Vt))});case 2:for(A=Bt.sent,P=A.data,J=[],ie=0;ie<P.byteLength;)pe=new Uint8Array(P.slice(ie,ie+4)),ie+=4,Ae=(pe[0]<<24)+(pe[1]<<16)+(pe[2]<<8)+pe[3],J.push(P.slice(ie,ie+Ae)),ie+=Ae;return Ie=JSON.parse(new TextDecoder("utf8").decode(J[0])),De=new Float32Array(J[1]),et=new Uint8Array(J[2]),ot={},ie=0,Ie.forEach(function(Vt){var yn=Vt.shape,_n=Vt.name,Dn=yn.reduce(function(Jn,Cn){return Jn*Cn}),Nn=et.slice(ie,ie+Dn),Wn=new Float32Array(Nn.length);Nn.forEach(function(Jn,Cn){Wn[Cn]=De[Jn]}),ot[_n]=I.tensor(Wn,yn,"float32"),ie+=Dn}),Bt.abrupt("return",ot);case 14:case"end":return Bt.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()}]),$}(),Jm=function(){function $(M,T){ce()(this,$),this.ready=Ge(this.loadCheckpoints(M),T)}return Ee()($,[{key:"loadCheckpoints",value:function(){var M=G()(ge.a.mark(function T(A){var P;return ge.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return P=new $p(A),J.next=3,P.getAllVariables();case 3:return this.variables=J.sent,J.abrupt("return",this);case 5:case"end":return J.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"transfer",value:function(){var M=G()(ge.a.mark(function T(A,P){return ge.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.abrupt("return",Ge(this.transferInternal(A),P));case 1:case"end":return J.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()},{key:"transferInternal",value:function(){var M=G()(ge.a.mark(function T(A){var P,J=this;return ge.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return P=Xt(I.tidy(function(){var pe=I.browser.fromPixels(A),Ae=pe.dataSync(),Ie=I.tensor3d(Ae,pe.shape),De=I.div(Ie,I.scalar(255)),et=$.preprocess(De),ot=[],Bt=J.variables["generator/encoder_1/conv2d/kernel"],Vt=J.variables["generator/encoder_1/conv2d/bias"],yn=$.conv2d(et,Bt,Vt);ot.push(yn);for(var _n=2;_n<=8;_n+=1){var Dn="generator/encoder_".concat(_n.toString());Bt=J.variables["".concat(Dn,"/conv2d/kernel")];var Nn=J.variables["".concat(Dn,"/conv2d/bias")],Wn=ot[ot.length-1],Jn=I.leakyRelu(Wn,.2);yn=$.conv2d(Jn,Bt,Nn);var Cn=J.variables["".concat(Dn,"/batch_normalization/gamma")],wr=J.variables["".concat(Dn,"/batch_normalization/beta")],Dr=$.batchnorm(yn,Cn,wr);ot.push(Dr)}for(var Nr=8;Nr>=2;Nr-=1){var Yr=void 0;if(Nr===8)Yr=ot[ot.length-1];else{var jr=Nr-1;Yr=I.concat([ot[ot.length-1],ot[jr]],2)}var Si=I.relu(Yr),Fi="generator/decoder_".concat(Nr.toString());Bt=J.variables["".concat(Fi,"/conv2d_transpose/kernel")],Vt=J.variables["".concat(Fi,"/conv2d_transpose/bias")],yn=$.deconv2d(Si,Bt,Vt);var Ni=J.variables["".concat(Fi,"/batch_normalization/gamma")],Ao=J.variables["".concat(Fi,"/batch_normalization/beta")],Xo=$.batchnorm(yn,Ni,Ao);ot.push(Xo)}var Po=I.concat([ot[ot.length-1],ot[0]],2),Ro=I.relu(Po);Bt=J.variables["generator/decoder_1/conv2d_transpose/kernel"];var Uo=J.variables["generator/decoder_1/conv2d_transpose/bias"];yn=$.deconv2d(Ro,Bt,Uo),Ro=I.tanh(yn),ot.push(Ro);var sa=ot[ot.length-1];return $.deprocess(sa)})),ie.next=3,I.nextFrame();case 3:return ie.abrupt("return",P);case 4:case"end":return ie.stop()}},T)}));return function(T){return M.apply(this,arguments)}}()}],[{key:"preprocess",value:function(M){var T=I.tidy(function(){return I.sub(I.mul(M,I.scalar(2)),I.scalar(1))});return M.dispose(),T}},{key:"deprocess",value:function(M){var T=I.tidy(function(){return I.div(I.add(M,I.scalar(1)),I.scalar(2))});return M.dispose(),T}},{key:"batchnorm",value:function(M,T,A){var P=I.tidy(function(){var J=I.moments(M,[0,1]);return I.batchNorm(M,J.mean,J.variance,A,T,1e-5)});return M.dispose(),P}},{key:"conv2d",value:function(M,T){var A=T.clone(),P=I.tidy(function(){return I.conv2d(M,A,[2,2],"same")});return M.dispose(),A.dispose(),P}},{key:"deconv2d",value:function(M,T,A){var P=I.tidy(function(){var J=I.conv2dTranspose(M,T,[2*M.shape[0],2*M.shape[1],T.shape[2]],[2,2],"same");return I.add(J,A)});return M.dispose(),T.dispose(),A.dispose(),P}}]),$}(),lc=function($,M){var T=new Jm($,M);return M?T:T.ready},Fs=r(241),Al=new Set(["alarm_clock","ambulance","angel","ant","antyoga","backpack","barn","basket","bear","bee","beeflower","bicycle","bird","book","brain","bridge","bulldozer","bus","butterfly","cactus","calendar","castle","cat","catbus","catpig","chair","couch","crab","crabchair","crabrabbitfacepig","cruise_ship","diving_board","dog","dogbunny","dolphin","duck","elephant","elephantpig","eye","face","fan","fire_hydrant","firetruck","flamingo","flower","floweryoga","frog","frogsofa","garden","hand","hedgeberry","hedgehog","helicopter","kangaroo","key","lantern","lighthouse","lion","lionsheep","lobster","map","mermaid","monapassport","monkey","mosquito","octopus","owl","paintbrush","palm_tree","parrot","passport","peas","penguin","pig","pigsheep","pineapple","pool","postcard","power_outlet","rabbit","rabbitturtle","radio","radioface","rain","rhinoceros","rifle","roller_coaster","sandwich","scorpion","sea_turtle","sheep","skull","snail","snowflake","speedboat","spider","squirrel","steak","stove","strawberry","swan","swing_set","the_mona_lisa","tiger","toothbrush","toothpaste","tractor","trombone","truck","whale","windmill","yoga","yogabicycle","everything"]),qs={modelPath:"https://storage.googleapis.com/quickdraw-models/sketchRNN/large_models/",modelPath_large:"https://storage.googleapis.com/quickdraw-models/sketchRNN/models/",modelPath_small:"https://storage.googleapis.com/quickdraw-models/sketchRNN/models/",PATH_END:".gen.json",temperature:.65,pixelFactor:3},wu=function(){function $(M,T){var A=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];ce()(this,$);var P=M;if(this.config={temperature:.65,pixelFactor:3,modelPath:qs.modelPath,modelPath_small:qs.modelPath_small,modelPath_large:qs.modelPath_large,PATH_END:qs.PATH_END},uc.isAbsoluteURL(P)===!0){var J=uc.getModelPath(P);this.config.modelPath=J}else{if(!Al.has(P))return console.log("no model found!"),this;P=(A?this.config.modelPath:this.config.modelPath_small)+P+this.config.PATH_END,this.config.modelPath=P}this.model=new Fs.SketchRNN(this.config.modelPath),this.penState=this.model.zeroInput(),this.ready=Ge(this.model.initialize(),T)}return Ee()($,[{key:"generateInternal",value:function(){var M=G()(ge.a.mark(function T(A,P){var J,ie,pe,Ae;return ge.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return J=+A.temperature||this.config.temperature,ie=+A.pixelFactor||this.config.pixelFactor,Ie.next=4,this.ready;case 4:return this.rnnState||(this.rnnState=this.model.zeroState(),this.model.setPixelFactor(ie)),Array.isArray(P)&&P.length&&(this.rnnState=this.model.updateStrokes(P,this.rnnState)),this.rnnState=this.model.update(this.penState,this.rnnState),pe=this.model.getPDF(this.rnnState,J),this.penState=this.model.sample(pe),Ae={dx:this.penState[0],dy:this.penState[1]},this.penState[2]===1?Ae.pen="down":this.penState[3]===1?Ae.pen="up":this.penState[4]===1&&(Ae.pen="end"),Ie.abrupt("return",Ae);case 12:case"end":return Ie.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()},{key:"generate",value:function(){var M=G()(ge.a.mark(function T(A,P,J){var ie,pe,Ae,Ie;return ge.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return typeof A=="function"?(pe={},Ae=[],ie=A):Array.isArray(A)?(pe={},Ae=A,ie=P):typeof P=="function"?(pe=A||{},Ae=[],ie=P):(pe=A||{},Ae=P||[],ie=J),Ie=Ae.map(function(et){var ot=et.pen==="up"?1:0,Bt=et.pen==="down"?1:0,Vt=et.pen==="end"?1:0;return[et.dx,et.dy,Bt,ot,Vt]}),De.abrupt("return",Ge(this.generateInternal(pe,Ie),ie));case 3:case"end":return De.stop()}},T,this)}));return function(T,A,P){return M.apply(this,arguments)}}()},{key:"reset",value:function(){this.penState=this.model.zeroInput(),this.rnnState&&(this.rnnState=this.model.zeroState())}}]),$}(),Nh=function($,M){var T=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];return new wu($,M,T)},Wi={modelPath:"https://raw.githubusercontent.com/zaidalyafeai/HostedModels/master/unet-128/model.json",imageSize:128,returnTensors:!1},vd=function(){function $(M,T,A){ce()(this,$),this.modelReady=!1,this.isPredicting=!1,this.config={modelPath:T.modelPath!==void 0?T.modelPath:Wi.modelPath,imageSize:T.imageSize!==void 0?T.imageSize:Wi.imageSize,returnTensors:T.returnTensors!==void 0?T.returnTensors:Wi.returnTensors},this.ready=Ge(this.loadModel(),A)}return Ee()($,[{key:"loadModel",value:function(){var M=G()(ge.a.mark(function T(){return ge.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,I.loadLayersModel(this.config.modelPath);case 2:return this.model=A.sent,this.modelReady=!0,A.abrupt("return",this);case 5:case"end":return A.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"segment",value:function(){var M=G()(ge.a.mark(function T(A,P){var J,ie;return ge.a.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return pe.next=2,this.ready;case 2:return ie=P,A instanceof HTMLImageElement||A instanceof HTMLVideoElement||A instanceof HTMLCanvasElement||A instanceof ImageData?J=A:we()(A)==="object"&&(A.elt instanceof HTMLImageElement||A.elt instanceof HTMLVideoElement||A.elt instanceof HTMLCanvasElement||A.elt instanceof ImageData)?J=A.elt:typeof A=="function"&&(J=this.video,ie=A),pe.abrupt("return",Ge(this.segmentInternal(J),ie));case 5:case"end":return pe.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()},{key:"convertToP5Image",value:function(){var M=G()(ge.a.mark(function T(A){var P,J;return ge.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.next=2,Ht.rawToBlob(A,this.config.imageSize,this.config.imageSize);case 2:return P=ie.sent,ie.next=5,Ht.blobToP5Image(P);case 5:return J=ie.sent,ie.abrupt("return",J);case 7:case"end":return ie.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"segmentInternal",value:function(){var M=G()(ge.a.mark(function T(A){var P,J,ie,pe,Ae,Ie,De,et,ot,Bt,Vt,yn,_n,Dn,Nn=this;return ge.a.wrap(function(Wn){for(;;)switch(Wn.prev=Wn.next){case 0:return Wn.next=2,this.ready;case 2:if(!(A instanceof HTMLVideoElement)){Wn.next=5;break}return Wn.next=5,I.nextFrame();case 5:return this.isPredicting=!0,P=I.tidy(function(){var Jn=I.browser.fromPixels(A).toFloat(),Cn=I.image.resizeBilinear(Jn,[Nn.config.imageSize,Nn.config.imageSize]).div(I.scalar(255)),wr=Cn.expandDims(0),Dr=Nn.model.predict(wr),Nr=I.ones([128,128,1]).tile([1,1,1]);Cn=Cn.concat(Nr,2);var Yr=Dr.squeeze([0]),jr=(Yr=(Yr=Yr.tile([1,1,4])).sub(.3).sign().relu().neg().add(1)).mul(Cn),Si=Dr.squeeze([0]),Fi=(Si=(Si=Si.tile([1,1,4])).sub(.3).sign().relu()).mul(Cn),Ni=I.ones([128,128,1]).tile([1,1,1]).mul(255),Ao=Dr.squeeze([0]);return{featureMask:jr,backgroundMask:Fi,segmentation:Ao=(Ao=I.cast(Ao.tile([1,1,3]).sub(.3).sign().relu().mul(255),"int32")).concat(Ni,2)}}),J=P.featureMask,ie=P.backgroundMask,pe=P.segmentation,this.isPredicting=!1,Wn.next=10,I.browser.toPixels(J);case 10:return Ae=Wn.sent,Wn.next=13,I.browser.toPixels(ie);case 13:return Ie=Wn.sent,Wn.next=16,I.browser.toPixels(pe);case 16:if(De=Wn.sent,et=Xt(J),ot=Xt(ie),Bt=$.dataURLtoBlob(et.src),Vt=$.dataURLtoBlob(ot.src),!Ht.checkP5()){Wn.next=31;break}return Wn.next=24,this.convertToP5Image(Ae);case 24:return yn=Wn.sent,Wn.next=27,this.convertToP5Image(Ie);case 27:return _n=Wn.sent,Wn.next=30,this.convertToP5Image(De);case 30:Dn=Wn.sent;case 31:return this.config.returnTensors||(J.dispose(),ie.dispose(),pe.dispose()),Wn.abrupt("return",{segmentation:De,blob:{featureMask:Bt,backgroundMask:Vt},tensor:{featureMask:J,backgroundMask:ie},raw:{featureMask:Ae,backgroundMask:Ie},featureMask:yn,backgroundMask:_n,mask:Dn});case 33:case"end":return Wn.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()}],[{key:"dataURLtoBlob",value:function(M){for(var T=M.split(","),A=T[0].match(/:(.*?);/)[1],P=atob(T[1]),J=P.length,ie=new Uint8Array(J);J;)ie[J]=P.charCodeAt(J),J-=1;return new Blob([ie],{type:A})}}]),$}(),Ol=function($,M,T){var A=null,P={},J=T;return $ instanceof HTMLVideoElement?A=$:we()($)==="object"&&$.elt instanceof HTMLVideoElement?A=$.elt:typeof $=="function"?J=$:we()($)==="object"&&(P=$),we()(M)==="object"?P=M:typeof M=="function"&&(J=M),new vd(A,P,J)},df=function(){function $(M,T){var A=this;ce()(this,$),this.ready=!1,this.model={},this.latentDim=I.randomUniform([1,16]);var P=M.split("manifest.json"),J=Pn()(P,1)[0];jt.a.get(M).then(function(ie){var pe=ie.data;A.ready=Ge(A.loadCVAEModel(J+pe.model),T),A.labels=pe.labels,A.labelVector=Array(A.labels.length+1).fill(0)})}return Ee()($,[{key:"loadCVAEModel",value:function(){var M=G()(ge.a.mark(function T(A){return ge.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,I.loadLayersModel(A);case 2:return this.model=P.sent,P.abrupt("return",this);case 4:case"end":return P.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"generate",value:function(){var M=G()(ge.a.mark(function T(A,P){return ge.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.abrupt("return",Ge(this.generateInternal(A),P));case 1:case"end":return J.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()},{key:"loadAsync",value:function(M){var T=this;return new Promise(function(A,P){T.ready||P(),loadImage(M,function(J){A(J)})})}},{key:"getBlob",value:function(M){var T=this;return new Promise(function(A,P){T.ready||P(),M.toBlob(function(J){A(J)})})}},{key:"generateInternal",value:function(){var M=G()(ge.a.mark(function T(A){var P,J,ie,pe,Ae,Ie,De,et,ot,Bt,Vt,yn,_n=this;return ge.a.wrap(function(Dn){for(;;)switch(Dn.prev=Dn.next){case 0:return P=I.tidy(function(){_n.latentDim=I.randomUniform([1,16]);var Nn=_n.labels.indexOf(A);if(Nn<0)return console.log("Wrong input of the label!"),[void 0,void 0];_n.labelVector=_n.labelVector.map(function(){return 0}),_n.labelVector[Nn+1]=1;var Wn=I.tensor([_n.labelVector]),Jn=_n.model.predict([_n.latentDim,Wn]);return Jn.reshape([Jn.shape[1],Jn.shape[2],Jn.shape[3]])}),Dn.next=3,I.browser.toPixels(P);case 3:for(J=Dn.sent,P.dispose(),ie=document.createElement("canvas"),pe=ie.getContext("2d"),Ae=Pn()(P.shape,2),Ie=Ae[0],De=Ae[1],ie.width=Ie,ie.height=De,et=pe.createImageData(Ie,De),ot=et.data,Bt=0;Bt<Ie*De*4;Bt+=1)ot[Bt]=J[Bt];return pe.putImageData(et,0,0),Dn.t0=URL,Dn.next=17,this.getBlob(ie);case 17:if(Dn.t1=Dn.sent,Vt=Dn.t0.createObjectURL.call(Dn.t0,Dn.t1),!Ht.checkP5()){Dn.next=23;break}return Dn.next=22,this.loadAsync(Vt);case 22:yn=Dn.sent;case 23:return Dn.abrupt("return",{src:Vt,raws:J,image:yn});case 24:case"end":return Dn.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()}]),$}(),Xp=function($,M){return new df($,M)},Qm=function(){function $(M,T,A){ce()(this,$),this.model={},this.modelPath=M,this.modelInfo={},this.modelPathPrefix="",this.modelReady=!1,this.config={returnTensors:T.returnTensors||!1},this.ready=Ge(this.loadModel(),A)}return Ee()($,[{key:"loadModel",value:function(){var M=G()(ge.a.mark(function T(){var A,P,J,ie,pe,Ae;return ge.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return Ie.next=2,jt.a.get(this.modelPath);case 2:return A=Ie.sent,P=A.data,this.modelInfo=P,J=this.modelPath.split("manifest.json"),ie=Pn()(J,1),pe=ie[0],Ae=this.isAbsoluteURL(pe)?this.modelInfo.model:this.modelPathPrefix+this.modelInfo.model,Ie.next=9,I.loadLayersModel(Ae);case 9:return this.model=Ie.sent,this.modelReady=!0,Ie.abrupt("return",this);case 12:case"end":return Ie.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"generate",value:function(){var M=G()(ge.a.mark(function T(A,P){return ge.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,this.ready;case 2:return J.abrupt("return",Ge(this.generateInternal(P),A));case 3:case"end":return J.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()},{key:"compute",value:function(){var M=G()(ge.a.mark(function T(A,P){var J,ie=this;return ge.a.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return J=I.tidy(function(){var Ae;if(Array.isArray(P)===!1)Ae=I.randomNormal([1,A]);else{for(var Ie=I.buffer([1,A]),De=0;De<A;De+=1)Ie.set(P[De],0,De);Ae=Ie.toTensor()}return ie.model.predict(Ae).squeeze().transpose([1,2,0]).div(I.scalar(2)).add(I.scalar(.5))}),pe.abrupt("return",J);case 2:case"end":return pe.stop()}},T)}));return function(T,A){return M.apply(this,arguments)}}()},{key:"generateInternal",value:function(){var M=G()(ge.a.mark(function T(A){var P,J,ie,pe,Ae,Ie,De,et,ot;return ge.a.wrap(function(Bt){for(;;)switch(Bt.prev=Bt.next){case 0:return P=this.modelInfo.modelLatentDim,Bt.next=3,this.compute(P,A);case 3:return J=Bt.sent,Bt.next=6,I.browser.toPixels(J);case 6:return ie=Bt.sent,pe=Pn()(J.shape,2),Ae=pe[0],Ie=pe[1],Bt.next=10,Ht.rawToBlob(ie,Ie,Ae);case 10:if(De=Bt.sent,!Ht.checkP5()){Bt.next=15;break}return Bt.next=14,Ht.blobToP5Image(De);case 14:et=Bt.sent;case 15:return(ot={}).blob=De,ot.raw=ie,Ht.checkP5()&&(ot.image=et),this.config.returnTensors?ot.tensor=J:(ot.tensor=null,J.dispose()),Bt.abrupt("return",ot);case 21:case"end":return Bt.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"isAbsoluteURL",value:function(M){return!!new RegExp("^(?:[a-z]+:)?//","i").test(M)}}]),$}(),hf=function($,M,T){var A,P={};if(typeof $!="string")throw new Error(`Please specify a path to a "manifest.json" file: 

         "models/face/manifest.json" 


         This "manifest.json" file should include:

         {
            "description": "DCGAN, human faces, 64x64",
            "model": "https://raw.githubusercontent.com/viztopia/ml5dcgan/master/model/model.json", // "https://github.com/viztopia/ml5dcgan/blob/master/model/model.json",
            "modelSize": 64,
            "modelLatentDim": 128 
         }
         `);typeof M=="function"?A=M:we()(M)==="object"&&(P=M,A=T);var J=new Qm($,P,A);return A?J:J.ready},Ih=r(30),Go=r.n(Ih),Fh=r(132),pf=0,Rh=function(){function $(M,T){ce()(this,$),this.ready=Ge(this.loadModel(M),T)}return Ee()($,[{key:"loadModel",value:function(){var M=G()(ge.a.mark(function T(A){var P,J,ie,pe;return ge.a.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:if(P={model:null,metadata:null},A.toLowerCase()!=="moviereviews"){Ae.next=6;break}P.model="https://storage.googleapis.com/tfjs-models/tfjs/sentiment_cnn_v1/model.json",P.metadata="https://storage.googleapis.com/tfjs-models/tfjs/sentiment_cnn_v1/metadata.json",Ae.next=14;break;case 6:if(uc.isAbsoluteURL(A)!==!0){Ae.next=12;break}J=uc.getModelPath(A),P.model="".concat(J,"/model.json"),P.metadata="".concat(J,"/metadata.json"),Ae.next=14;break;case 12:return console.error("problem loading model"),Ae.abrupt("return",this);case 14:return Ae.next=16,I.loadLayersModel(P.model);case 16:return this.model=Ae.sent,Ae.next=19,jt.a.get(P.metadata);case 19:return ie=Ae.sent,pe=ie.data,this.indexFrom=pe.index_from,this.maxLen=pe.max_len,this.wordIndex=pe.word_index,this.vocabularySize=pe.vocabulary_size,Ae.abrupt("return",this);case 26:case"end":return Ae.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"predict",value:function(M){var T=this,A=function(pe,Ae){var Ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"pre",De=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"pre",et=arguments.length>4&&arguments[4]!==void 0?arguments[4]:pf;return pe.map(function(ot){if(ot.length>Ae&&(De==="pre"?ot.splice(0,ot.length-Ae):ot.splice(Ae,ot.length-Ae)),ot.length<Ae){for(var Bt=[],Vt=0;Vt<Ae-ot.length;Vt+=1)Bt.push(et);ot=Ie==="pre"?Bt.concat(ot):ot.concat(Bt)}return ot})}([M.trim().toLowerCase().replace(/[.,?!]/g,"").split(" ").map(function(pe){var Ae=T.wordIndex[pe]+T.indexFrom;return Ae>T.vocabularySize&&(Ae=2),Ae})],this.maxLen),P=I.tensor2d(A,[1,this.maxLen]),J=this.model.predict(P),ie=J.dataSync()[0];return J.dispose(),P.dispose(),{score:ie}}}]),$}(),mf=function($,M){return new Rh($,M)};function Tl($,M,T,A){return new(T||(T=Promise))(function(P,J){function ie(Ie){try{Ae(A.next(Ie))}catch(De){J(De)}}function pe(Ie){try{Ae(A.throw(Ie))}catch(De){J(De)}}function Ae(Ie){Ie.done?P(Ie.value):new T(function(De){De(Ie.value)}).then(ie,pe)}Ae((A=A.apply($,M||[])).next())})}function el($,M){var T,A,P,J,ie={label:0,sent:function(){if(1&P[0])throw P[1];return P[1]},trys:[],ops:[]};return J={next:pe(0),throw:pe(1),return:pe(2)},typeof Symbol=="function"&&(J[Symbol.iterator]=function(){return this}),J;function pe(Ae){return function(Ie){return function(De){if(T)throw new TypeError("Generator is already executing.");for(;ie;)try{if(T=1,A&&(P=2&De[0]?A.return:De[0]?A.throw||((P=A.return)&&P.call(A),0):A.next)&&!(P=P.call(A,De[1])).done)return P;switch(A=0,P&&(De=[2&De[0],P.value]),De[0]){case 0:case 1:P=De;break;case 4:return ie.label++,{value:De[1],done:!1};case 5:ie.label++,A=De[1],De=[0];continue;case 7:De=ie.ops.pop(),ie.trys.pop();continue;default:if(!(P=(P=ie.trys).length>0&&P[P.length-1])&&(De[0]===6||De[0]===2)){ie=0;continue}if(De[0]===3&&(!P||De[1]>P[0]&&De[1]<P[3])){ie.label=De[1];break}if(De[0]===6&&ie.label<P[1]){ie.label=P[1],P=De;break}if(P&&ie.label<P[2]){ie.label=P[2],ie.ops.push(De);break}P[2]&&ie.ops.pop(),ie.trys.pop();continue}De=M.call($,ie)}catch(et){De=[6,et],A=0}finally{T=P=0}if(5&De[0])throw De[1];return{value:De[0]?De[1]:void 0,done:!0}}([Ae,Ie])}}}var Ph=[["conv2d",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1]],yd=[8,16,32];function gf($){ze.util.assert(typeof $=="number",function(){return"outputStride is not a number"}),ze.util.assert(yd.indexOf($)>=0,function(){return"outputStride of "+$+" is invalid. It must be either 8, 16, or 32"})}var tl={100:[["conv2d",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",2],["separableConv",1]],75:[["conv2d",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",2],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1],["separableConv",1]],50:Ph,25:Ph},Xg=function(){function $(M,T){this.PREPROCESS_DIVISOR=Object(ze.scalar)(127.5),this.ONE=Object(ze.scalar)(1),this.modelWeights=M,this.convolutionDefinitions=T}return $.prototype.predict=function(M,T){var A=this,P=Object(ze.div)(M.toFloat(),this.PREPROCESS_DIVISOR),J=Object(ze.sub)(P,this.ONE);return function(ie,pe){var Ae=1,Ie=1;return ie.map(function(De,et){var ot,Bt,Vt=De[0],yn=De[1];return Ae===pe?(ot=1,Bt=Ie,Ie*=yn):(ot=yn,Bt=1,Ae*=yn),{blockId:et,convType:Vt,stride:ot,rate:Bt,outputStride:Ae}})}(this.convolutionDefinitions,T).reduce(function(ie,pe){var Ae=pe.blockId,Ie=pe.stride,De=pe.convType,et=pe.rate;if(De==="conv2d")return A.conv(ie,Ie,Ae);if(De==="separableConv")return A.separableConv(ie,Ie,Ae,et);throw Error("Unknown conv type of "+De)},J)},$.prototype.convToOutput=function(M,T){return M.conv2d(this.weights(T),1,"same").add(this.convBias(T,!1))},$.prototype.conv=function(M,T,A){var P=this.weights("Conv2d_"+String(A));return M.conv2d(P,T,"same").add(this.convBias("Conv2d_"+String(A))).clipByValue(0,6)},$.prototype.separableConv=function(M,T,A,P){P===void 0&&(P=1);var J="Conv2d_"+String(A)+"_depthwise",ie="Conv2d_"+String(A)+"_pointwise";return M.depthwiseConv2D(this.depthwiseWeights(J),T,"same","NHWC",P).add(this.depthwiseBias(J)).clipByValue(0,6).conv2d(this.weights(ie),[1,1],"same").add(this.convBias(ie)).clipByValue(0,6)},$.prototype.weights=function(M){return this.modelWeights.weights(M)},$.prototype.convBias=function(M,T){return T===void 0&&(T=!0),this.modelWeights.convBias(M,T)},$.prototype.depthwiseBias=function(M){return this.modelWeights.depthwiseBias(M)},$.prototype.depthwiseWeights=function(M){return this.modelWeights.depthwiseWeights(M)},$.prototype.dispose=function(){this.modelWeights.dispose()},$}(),vf="https://storage.googleapis.com/tfjs-models/savedmodel/",la={1:{url:vf+"posenet_mobilenet_100_partmap/",architecture:tl[100]},.75:{url:vf+"posenet_mobilenet_075_partmap/",architecture:tl[75]},.5:{url:vf+"posenet_mobilenet_050_partmap/",architecture:tl[50]},.25:{url:vf+"posenet_mobilenet_025_partmap/",architecture:tl[25]}};function La($,M){return Object(ze.tidy)(function(){return $.greater(Object(ze.scalar)(M)).toInt()})}function Wa($,M){var T=M.shape,A=T[0],P=T[1],J=T[2];return Object(ze.tidy)(function(){var ie=function(Ae){var Ie=Ae.shape[2],De=Ae.argMax(2).reshape([-1]);return Object(ze.oneHot)(De,Ie)}(M),pe=Object(ze.range)(0,J,1,"int32").expandDims(1);return function(Ae,Ie){return Ae.mul(Ie)}(ie.matMul(pe).toInt().reshape([A,P]).add(Object(ze.scalar)(1,"int32")),$).sub(Object(ze.scalar)(1,"int32"))})}var qi=function(){function $(M){this.graphModel=M}return $.prototype.weights=function(M){return this.getVariable("MobilenetV1/"+M+"/weights")},$.prototype.convBias=function(M,T){return this.getVariable("MobilenetV1/"+M+"/Conv2D_bias")},$.prototype.depthwiseBias=function(M){return this.getVariable("MobilenetV1/"+M+"/depthwise_bias")},$.prototype.depthwiseWeights=function(M){return this.getVariable("MobilenetV1/"+M+"/depthwise_weights")},$.prototype.getVariable=function(M){return this.graphModel.weights[""+M][0]},$.prototype.dispose=function(){this.graphModel.dispose()},$}();function Rs($){return $ instanceof ze.Tensor?$:ze.browser.fromPixels($)}function nl($,M,T){var A=M[0],P=M[1];T===void 0&&(T=!1);var J,ie,pe,Ae,Ie,De,et=$.shape,ot=et[0],Bt=et[1]/ot;if(Bt>P/A){J=P;var Vt=A-(ie=Math.ceil(J/Bt));pe=0,Ae=0,Ie=Math.floor(Vt/2),De=A-(ie+Ie)}else{ie=A;var yn=P-(J=Math.ceil(A*Bt));pe=Math.floor(yn/2),Ae=P-(J+pe),Ie=0,De=0}return{resizedAndPadded:Object(ze.tidy)(function(){var _n;return _n=T?$.reverse(1).resizeBilinear([ie,J]):$.resizeBilinear([ie,J]),Object(ze.pad3d)(_n,[[Ie,De],[pe,Ae],[0,0]])}),paddedBy:[[Ie,De],[pe,Ae]]}}function Va($,M,T,A){var P=M[0],J=M[1],ie=T[0],pe=T[1],Ae=A[0],Ie=Ae[0],De=Ae[1],et=A[1],ot=et[0],Bt=et[1];return Object(ze.tidy)(function(){return function(Vt,yn,_n){var Dn=yn[0],Nn=yn[1],Wn=_n[0],Jn=Wn[0],Cn=Wn[1],wr=_n[1],Dr=wr[0],Nr=wr[1],Yr=Vt.shape,jr=Yr[0],Si=Yr[1],Fi=jr-(Jn+Cn),Ni=Si-(Dr+Nr);return Object(ze.tidy)(function(){return Object(ze.slice3d)(Vt,[Jn,Dr,0],[Fi,Ni,Vt.shape[2]]).resizeBilinear([Dn,Nn],!0)})}($.resizeBilinear([ie,pe],!0),[P,J],[[Ie,De],[ot,Bt]])})}var rl=[353,257],fc=function(){function $(M){this.mobileNet=M}return $.prototype.predictForSegmentation=function(M,T){var A=this;return T===void 0&&(T=16),gf(T),Object(ze.tidy)(function(){var P=A.mobileNet.predict(M,T);return A.mobileNet.convToOutput(P,"segment_2").sigmoid()})},$.prototype.predictForPartMap=function(M,T){var A=this;return T===void 0&&(T=16),gf(T),Object(ze.tidy)(function(){var P=A.mobileNet.predict(M,T),J=A.mobileNet.convToOutput(P,"segment_2"),ie=A.mobileNet.convToOutput(P,"part_heatmap_2");return{segmentScores:J.sigmoid(),partHeatmapScores:ie.sigmoid()}})},$.prototype.estimatePersonSegmentationActivation=function(M,T,A){var P=this;return T===void 0&&(T=16),A===void 0&&(A=.5),gf(T),Object(ze.tidy)(function(){var J=Rs(M),ie=nl(J,rl),pe=ie.resizedAndPadded,Ae=ie.paddedBy,Ie=P.predictForSegmentation(pe,T),De=pe.shape,et=De[0],ot=De[1],Bt=J.shape;return La(Va(Ie,[Bt[0],Bt[1]],[et,ot],Ae).squeeze(),A)})},$.prototype.estimatePersonSegmentation=function(M,T,A){return T===void 0&&(T=16),A===void 0&&(A=.5),Tl(this,void 0,void 0,function(){var P,J,ie,pe,Ae;return el(this,function(Ie){switch(Ie.label){case 0:return P=this.estimatePersonSegmentationActivation(M,T,A),J=P.shape,ie=J[0],pe=J[1],[4,P.data()];case 1:return Ae=Ie.sent(),P.dispose(),[2,{height:ie,width:pe,data:Ae}]}})})},$.prototype.estimatePartSegmentationActivation=function(M,T,A){var P=this;return T===void 0&&(T=16),A===void 0&&(A=.5),gf(T),Object(ze.tidy)(function(){var J=Rs(M),ie=nl(J,rl),pe=ie.resizedAndPadded,Ae=ie.paddedBy,Ie=P.predictForPartMap(pe,T),De=Ie.segmentScores,et=Ie.partHeatmapScores,ot=pe.shape,Bt=ot[0],Vt=ot[1],yn=J.shape,_n=yn[0],Dn=yn[1],Nn=Va(De,[_n,Dn],[Bt,Vt],Ae),Wn=Va(et,[_n,Dn],[Bt,Vt],Ae);return Wa(La(Nn.squeeze(),A),Wn)})},$.prototype.estimatePartSegmentation=function(M,T,A){return T===void 0&&(T=16),A===void 0&&(A=.5),Tl(this,void 0,void 0,function(){var P,J,ie,pe,Ae;return el(this,function(Ie){switch(Ie.label){case 0:return P=this.estimatePartSegmentationActivation(M,T,A),J=P.shape,ie=J[0],pe=J[1],[4,P.data()];case 1:return Ae=Ie.sent(),P.dispose(),[2,{height:ie,width:pe,data:Ae}]}})})},$.prototype.dispose=function(){this.mobileNet.dispose()},$}();function bd($){return $===void 0&&($=.75),Tl(this,void 0,void 0,function(){var M,T;return el(this,function(A){switch(A.label){case 0:if(ze==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");return M=Object.keys(la),ze.util.assert(typeof $=="number",function(){return"got multiplier type of "+typeof $+" when it should be a number."}),ze.util.assert(M.indexOf($.toString())>=0,function(){return"invalid multiplier value of "+$+".  No checkpoint exists for that multiplier. Must be one of "+M.join(",")+"."}),[4,xd.load($)];case 1:return T=A.sent(),[2,new fc(T)]}})})}var xd={load:function($){return Tl(void 0,void 0,void 0,function(){var M,T,A,P;return el(this,function(J){switch(J.label){case 0:return M=la[$],T=M.url,[4,Object(Mt.loadGraphModel)(T+"model.json")];case 1:return A=J.sent(),P=new qi(A),[2,new Xg(P,M.architecture)]}})})}};function Ml($,M){M===void 0&&(M=!0);for(var T=$.width,A=$.height,P=$.data,J=new Uint8ClampedArray(T*A*4),ie=0;ie<A*T;++ie){var pe=255*(M?1-P[ie]:P[ie]),Ae=4*ie;J[Ae+0]=0,J[Ae+1]=0,J[Ae+2]=0,J[Ae+3]=Math.round(pe)}return new ImageData(J,T,A)}function Kp($,M){for(var T=$.width,A=$.height,P=$.data,J=new Uint8ClampedArray(T*A*4),ie=0;ie<A*T;++ie){var pe=Math.round(P[ie]),Ae=4*ie;if(pe===-1)J[Ae+0]=255,J[Ae+1]=255,J[Ae+2]=255,J[Ae+3]=255;else{var Ie=M[pe];if(!Ie)throw new Error("No color could be found for part id "+pe);J[Ae+0]=Ie[0],J[Ae+1]=Ie[1],J[Ae+2]=Ie[2],J[Ae+3]=255}}return new ImageData(J,T,A)}var dc={multiplier:.75,outputStride:16,segmentationThreshold:.5,palette:{leftFace:{id:0,color:[110,64,170]},rightFace:{id:1,color:[106,72,183]},rightUpperLegFront:{id:2,color:[100,81,196]},rightLowerLegBack:{id:3,color:[92,91,206]},rightUpperLegBack:{id:4,color:[84,101,214]},leftLowerLegFront:{id:5,color:[75,113,221]},leftUpperLegFront:{id:6,color:[66,125,224]},leftUpperLegBack:{id:7,color:[56,138,226]},leftLowerLegBack:{id:8,color:[48,150,224]},rightFeet:{id:9,color:[40,163,220]},rightLowerLegFront:{id:10,color:[33,176,214]},leftFeet:{id:11,color:[29,188,205]},torsoFront:{id:12,color:[26,199,194]},torsoBack:{id:13,color:[26,210,182]},rightUpperArmFront:{id:14,color:[28,219,169]},rightUpperArmBack:{id:15,color:[33,227,155]},rightLowerArmBack:{id:16,color:[41,234,141]},leftLowerArmFront:{id:17,color:[51,240,128]},leftUpperArmFront:{id:18,color:[64,243,116]},leftUpperArmBack:{id:19,color:[79,246,105]},leftLowerArmBack:{id:20,color:[96,247,97]},rightHand:{id:21,color:[115,246,91]},rightLowerArmFront:{id:22,color:[134,245,88]},leftHand:{id:23,color:[155,243,88]}},returnTensors:!1},Kg=function(){function $(M,T,A){ce()(this,$),this.video=M,this.model=null,this.modelReady=!1,this.modelPath="",this.config={multiplier:T.multiplier||dc.multiplier,outputStride:T.outputStride||dc.outputStride,segmentationThreshold:T.segmentationThreshold||dc.segmentationThreshold,palette:T.palette||dc.palette,returnTensors:T.returnTensors||dc.returnTensors},this.ready=Ge(this.loadModel(),A)}return Ee()($,[{key:"loadModel",value:function(){var M=G()(ge.a.mark(function T(){return ge.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,bd(this.config.multiplier);case 2:return this.model=A.sent,this.modelReady=!0,A.abrupt("return",this);case 5:case"end":return A.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"p5Color2RGB",value:function(M){var T=/\(([^)]+)\)/.exec(M.toString("rgb"))[1].split(","),A=Pn()(T,3);return[A[0],A[1],A[2]]}},{key:"convertToP5Image",value:function(){var M=G()(ge.a.mark(function T(A,P,J){var ie,pe;return ge.a.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:return Ae.next=2,Ht.rawToBlob(A,P,J);case 2:return ie=Ae.sent,Ae.next=5,Ht.blobToP5Image(ie);case 5:return pe=Ae.sent,Ae.abrupt("return",pe);case 7:case"end":return Ae.stop()}},T)}));return function(T,A,P){return M.apply(this,arguments)}}()},{key:"bodyPartsSpec",value:function(M){var T=this,A=M!==void 0||Object.keys(M).length>=24?M:this.config.palette,P=Ht.p5Instance;return P&&A!==void 0&&Object.keys(A).length>=24&&Object.keys(A).forEach(function(J){A[J].color instanceof P.Color&&(A[J].color=T.p5Color2RGB(A[J].color))}),A}},{key:"segmentWithPartsInternal",value:function(){var M=G()(ge.a.mark(function T(A,P){var J,ie,pe,Ae,Ie,De,et,ot,Bt,Vt,yn,_n=this;return ge.a.wrap(function(Dn){for(;;)switch(Dn.prev=Dn.next){case 0:return Dn.next=2,this.ready;case 2:return Dn.next=4,I.nextFrame();case 4:if(!this.video||this.video.readyState!==0){Dn.next=7;break}return Dn.next=7,new Promise(function(Nn){_n.video.onloadeddata=function(){return Nn()}});case 7:return this.config.palette=P.palette||this.config.palette,this.config.outputStride=P.outputStride||this.config.outputStride,this.config.segmentationThreshold=P.segmentationThreshold||this.config.segmentationThreshold,Dn.next=12,this.model.estimatePartSegmentation(A,this.config.outputStride,this.config.segmentationThreshold);case 12:return J=Dn.sent,ie=this.bodyPartsSpec(this.config.palette),pe=Object.keys(ie).map(function(Nn){return ie[Nn].color}),(Ae={segmentation:J,raw:{personMask:null,backgroundMask:null,partMask:null},tensor:{personMask:null,backgroundMask:null,partMask:null},personMask:null,backgroundMask:null,partMask:null,bodyParts:ie}).raw.backgroundMask=Ml(J,!0),Ae.raw.personMask=Ml(J,!1),Ae.raw.partMask=Kp(J,pe),Ie=I.tidy(function(){var Nn=I.browser.fromPixels(A),Wn=I.ones([J.height,J.width,1]).tile([1,1,1]).mul(255);Nn=Nn.concat(Wn,2);var Jn=I.tensor(J.data,[J.height,J.width,1]),Cn=I.tensor(J.data,[J.height,J.width,1]),wr=I.tensor(Go()(Ae.raw.partMask.data),[J.height,J.width,4]);return{personMask:Jn=I.cast(Jn.add(.2).sign().relu().mul(Nn),"int32"),backgroundMask:Cn=I.cast(Cn.add(.2).sign().neg().relu().mul(Nn),"int32"),partMask:wr=I.cast(wr,"int32")}}),De=Ie.personMask,et=Ie.backgroundMask,ot=Ie.partMask,Dn.next=22,I.browser.toPixels(De);case 22:return Bt=Dn.sent,Dn.next=25,I.browser.toPixels(et);case 25:return Vt=Dn.sent,Dn.next=28,I.browser.toPixels(ot);case 28:if(yn=Dn.sent,Ae.personMask=Bt,Ae.backgroundMask=Vt,Ae.partMask=yn,!Ht.checkP5()){Dn.next=42;break}return Dn.next=35,this.convertToP5Image(Bt,J.width,J.height);case 35:return Ae.personMask=Dn.sent,Dn.next=38,this.convertToP5Image(Vt,J.width,J.height);case 38:return Ae.backgroundMask=Dn.sent,Dn.next=41,this.convertToP5Image(yn,J.width,J.height);case 41:Ae.partMask=Dn.sent;case 42:return this.config.returnTensors?(Ae.tensor.personMask=De,Ae.tensor.backgroundMask=et,Ae.tensor.partMask=ot):(De.dispose(),et.dispose(),ot.dispose()),Dn.abrupt("return",Ae);case 44:case"end":return Dn.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()},{key:"segmentWithParts",value:function(){var M=G()(ge.a.mark(function T(A,P,J){var ie,pe,Ae;return ge.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:if(ie=this.video,Ae=this.config,typeof A!="function"){Ie.next=7;break}ie=this.video,pe=A,Ie.next=25;break;case 7:if(!(A instanceof HTMLImageElement||A instanceof HTMLCanvasElement||A instanceof HTMLVideoElement||A instanceof ImageData)){Ie.next=11;break}ie=A,Ie.next=25;break;case 11:if(we()(A)!=="object"||!(A.elt instanceof HTMLImageElement||A.elt instanceof HTMLCanvasElement||A.elt instanceof ImageData)){Ie.next=15;break}ie=A.elt,Ie.next=25;break;case 15:if(!(we()(A)==="object"&&A.canvas instanceof HTMLCanvasElement)){Ie.next=19;break}ie=A.canvas,Ie.next=25;break;case 19:if(!(we()(A)==="object"&&A.elt instanceof HTMLVideoElement)){Ie.next=23;break}ie=A.elt,Ie.next=25;break;case 23:if(this.video instanceof HTMLVideoElement){Ie.next=25;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 25:return we()(P)==="object"?Ae=P:typeof P=="function"&&(pe=P),typeof J=="function"&&(pe=J),Ie.abrupt("return",Ge(this.segmentWithPartsInternal(ie,Ae),pe));case 28:case"end":return Ie.stop()}},T,this)}));return function(T,A,P){return M.apply(this,arguments)}}()},{key:"segmentInternal",value:function(){var M=G()(ge.a.mark(function T(A,P){var J,ie,pe,Ae,Ie,De,et,ot=this;return ge.a.wrap(function(Bt){for(;;)switch(Bt.prev=Bt.next){case 0:return Bt.next=2,this.ready;case 2:return Bt.next=4,I.nextFrame();case 4:if(!this.video||this.video.readyState!==0){Bt.next=7;break}return Bt.next=7,new Promise(function(Vt){ot.video.onloadeddata=function(){return Vt()}});case 7:return this.config.outputStride=P.outputStride||this.config.outputStride,this.config.segmentationThreshold=P.segmentationThreshold||this.config.segmentationThreshold,Bt.next=11,this.model.estimatePersonSegmentation(A,this.config.outputStride,this.config.segmentationThreshold);case 11:return J=Bt.sent,(ie={segmentation:J,raw:{personMask:null,backgroundMask:null},tensor:{personMask:null,backgroundMask:null},personMask:null,backgroundMask:null}).raw.backgroundMask=Ml(J,!0),ie.raw.personMask=Ml(J,!1),pe=I.tidy(function(){var Vt=I.browser.fromPixels(A),yn=I.ones([J.height,J.width,1]).tile([1,1,1]).mul(255);Vt=Vt.concat(yn,2);var _n=I.tensor(J.data,[J.height,J.width,1]),Dn=I.tensor(J.data,[J.height,J.width,1]);return{personMask:_n=I.cast(_n.neg().add(1).mul(Vt),"int32"),backgroundMask:Dn=I.cast(Dn.mul(Vt),"int32")}}),Ae=pe.personMask,Ie=pe.backgroundMask,Bt.next=18,I.browser.toPixels(Ae);case 18:return De=Bt.sent,Bt.next=21,I.browser.toPixels(Ie);case 21:if(et=Bt.sent,!Ht.checkP5()){Bt.next=31;break}return Bt.next=25,this.convertToP5Image(De,J.width,J.height);case 25:return ie.personMask=Bt.sent,Bt.next=28,this.convertToP5Image(et,J.width,J.height);case 28:ie.backgroundMask=Bt.sent,Bt.next=33;break;case 31:ie.personMask=De,ie.backgroundMask=et;case 33:return this.config.returnTensors?(ie.tensor.personMask=Ae,ie.tensor.backgroundMask=Ie):(Ae.dispose(),Ie.dispose()),Bt.abrupt("return",ie);case 35:case"end":return Bt.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()},{key:"segment",value:function(){var M=G()(ge.a.mark(function T(A,P,J){var ie,pe,Ae;return ge.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:if(ie=this.video,Ae=this.config,typeof A!="function"){Ie.next=7;break}ie=this.video,pe=A,Ie.next=25;break;case 7:if(!(A instanceof HTMLImageElement||A instanceof HTMLCanvasElement||A instanceof HTMLVideoElement||A instanceof ImageData)){Ie.next=11;break}ie=A,Ie.next=25;break;case 11:if(we()(A)!=="object"||!(A.elt instanceof HTMLImageElement||A.elt instanceof HTMLCanvasElement||A.elt instanceof ImageData)){Ie.next=15;break}ie=A.elt,Ie.next=25;break;case 15:if(!(we()(A)==="object"&&A.canvas instanceof HTMLCanvasElement)){Ie.next=19;break}ie=A.canvas,Ie.next=25;break;case 19:if(!(we()(A)==="object"&&A.elt instanceof HTMLVideoElement)){Ie.next=23;break}ie=A.elt,Ie.next=25;break;case 23:if(this.video instanceof HTMLVideoElement){Ie.next=25;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 25:return we()(P)==="object"?Ae=P:typeof P=="function"&&(pe=P),typeof J=="function"&&(pe=J),Ie.abrupt("return",Ge(this.segmentInternal(ie,Ae),pe));case 28:case"end":return Ie.stop()}},T,this)}));return function(T,A,P){return M.apply(this,arguments)}}()}]),$}(),Yp=function($,M,T){var A,P={},J=T;$ instanceof HTMLVideoElement?A=$:we()($)==="object"&&$.elt instanceof HTMLVideoElement?A=$.elt:we()($)==="object"?P=$:typeof $=="function"&&(J=$),we()(M)==="object"?P=M:typeof M=="function"&&(J=M);var ie=new Kg(A,P,J);return J?ie:ie.ready},yf=function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return Math.random()*(M-$)+$},Zm=function(){var $,M,T,A,P,J,ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(J)$=M,J=!1;else{do P=(T=yf(0,2)-1)*T+(A=yf(0,2)-1)*A;while(P>=1);$=T*(P=Math.sqrt(-2*Math.log(P)/P)),M=A*P,J=!0}return $*pe+ie},wd=function($,M){var T;if((arguments.length>2&&arguments[2]!==void 0&&arguments[2])===!0)T=Array.from({length:M},function(){return $[Math.floor(Math.random()*$.length)]});else{if(M>$.length)throw new RangeError("Sample size must be less than or equal to array length when sampling without replacement.");T=$.map(function(A){return[A,Math.random()]}).sort(function(A,P){return A[1]<P[1]?-1:1}).slice(0,M).map(function(A){return A[0]})}return T},Dl=function(){function $(){ce()(this,$),this.isTrained=!1,this.isCompiled=!1,this.isLayered=!1,this.model=null,this.init=this.init.bind(this),this.createModel=this.createModel.bind(this),this.addLayer=this.addLayer.bind(this),this.compile=this.compile.bind(this),this.setOptimizerFunction=this.setOptimizerFunction.bind(this),this.train=this.train.bind(this),this.trainInternal=this.trainInternal.bind(this),this.predict=this.predict.bind(this),this.classify=this.classify.bind(this),this.save=this.save.bind(this),this.load=this.load.bind(this),this.init()}return Ee()($,[{key:"init",value:function(){this.createModel()}},{key:"createModel",value:function(){switch((arguments.length>0&&arguments[0]!==void 0?arguments[0]:"sequential").toLowerCase()){case"sequential":default:return this.model=I.sequential(),this.model}}},{key:"addLayer",value:function(M){var T=M||{};this.model.add(T),this.model.layers.length>=2&&(this.isLayered=!0)}},{key:"compile",value:function(M){this.model.compile(M),this.isCompiled=!0}},{key:"setOptimizerFunction",value:function(M,T){return T.call(this,M)}},{key:"train",value:function(M,T){return Ge(this.trainInternal(M),T)}},{key:"trainInternal",value:function(){var M=G()(ge.a.mark(function T(A){var P,J,ie,pe,Ae,Ie,De,et;return ge.a.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:return J=(P=A).inputs,ie=P.outputs,pe=P.batchSize,Ae=P.epochs,Ie=P.shuffle,De=P.validationSplit,et=P.whileTraining,ot.next=6,this.model.fit(J,ie,{batchSize:pe,epochs:Ae,shuffle:Ie,validationSplit:De,callbacks:et});case 6:J.dispose(),ie.dispose(),this.isTrained=!0;case 9:case"end":return ot.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"predictSync",value:function(M){var T=this,A=I.tidy(function(){return T.model.predict(M)}),P=A.arraySync();return A.dispose(),M.dispose(),P}},{key:"predict",value:function(){var M=G()(ge.a.mark(function T(A){var P,J,ie=this;return ge.a.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return P=I.tidy(function(){return ie.model.predict(A)}),pe.next=3,P.array();case 3:return J=pe.sent,P.dispose(),A.dispose(),pe.abrupt("return",J);case 7:case"end":return pe.stop()}},T)}));return function(T){return M.apply(this,arguments)}}()},{key:"classify",value:function(){var M=G()(ge.a.mark(function T(A){return ge.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.abrupt("return",this.predict(A));case 1:case"end":return P.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"classifySync",value:function(M){return this.predictSync(M)}},{key:"save",value:function(){var M=G()(ge.a.mark(function T(A,P){var J,ie,pe=this;return ge.a.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:typeof A=="function"?(J="model",ie=A):typeof A=="string"?(J=A,typeof P=="function"&&(ie=P)):J="model",this.model.save(I.io.withSaveHandler(function(){var Ie=G()(ge.a.mark(function De(et){return ge.a.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:return pe.weightsManifest={modelTopology:et.modelTopology,weightsManifest:[{paths:["./".concat(J,".weights.bin")],weights:et.weightSpecs}]},ot.next=3,Xr(et.weightData,"".concat(J,".weights.bin"),"application/octet-stream");case 3:return ot.next=5,Xr(JSON.stringify(pe.weightsManifest),"".concat(J,".json"),"text/plain");case 5:ie&&ie();case 6:case"end":return ot.stop()}},De)}));return function(De){return Ie.apply(this,arguments)}}()));case 2:case"end":return Ae.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()},{key:"load",value:function(){var M=G()(ge.a.mark(function T(){var A,P,J,ie,pe,Ae,Ie,De,et,ot,Bt,Vt=arguments;return ge.a.wrap(function(yn){for(;;)switch(yn.prev=yn.next){case 0:if(A=Vt.length>0&&Vt[0]!==void 0?Vt[0]:null,P=Vt.length>1?Vt[1]:void 0,!(A instanceof FileList)){yn.next=13;break}return yn.next=5,Promise.all(Array.from(A).map(function(){var _n=G()(ge.a.mark(function Dn(Nn){var Wn;return ge.a.wrap(function(Jn){for(;;)switch(Jn.prev=Jn.next){case 0:if(!Nn.name.includes(".json")||Nn.name.includes("_meta")){Jn.next=4;break}return Jn.abrupt("return",{name:"model",file:Nn});case 4:if(!Nn.name.includes(".json")||!Nn.name.includes("_meta.json")){Jn.next=11;break}return Jn.next=7,Nn.text();case 7:return Wn=Jn.sent,Jn.abrupt("return",{name:"metadata",file:Wn});case 11:if(!Nn.name.includes(".bin")){Jn.next=13;break}return Jn.abrupt("return",{name:"weights",file:Nn});case 13:return Jn.abrupt("return",{name:null,file:null});case 14:case"end":return Jn.stop()}},Dn)}));return function(Dn){return _n.apply(this,arguments)}}()));case 5:return J=yn.sent,ie=J.find(function(_n){return _n.name==="model"}).file,pe=J.find(function(_n){return _n.name==="weights"}).file,yn.next=10,I.loadLayersModel(I.io.browserFiles([ie,pe]));case 10:this.model=yn.sent,yn.next=32;break;case 13:if(!(A instanceof Object)){yn.next=29;break}return yn.next=16,jt.a.get(A.model,{responseType:"text"});case 16:return Ae=yn.sent,Ie=JSON.stringify(Ae.data),De=new File([Ie],"model.json",{type:"application/json"}),yn.next=21,jt.a.get(A.weights,{responseType:"blob"});case 21:return et=yn.sent,ot=et.data,Bt=new File([ot],"model.weights.bin",{type:"application/macbinary"}),yn.next=26,I.loadLayersModel(I.io.browserFiles([De,Bt]));case 26:this.model=yn.sent,yn.next=32;break;case 29:return yn.next=31,I.loadLayersModel(A);case 31:this.model=yn.sent;case 32:return this.isCompiled=!0,this.isLayered=!0,this.isTrained=!0,P&&P(),yn.abrupt("return",this.model);case 37:case"end":return yn.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"dispose",value:function(){this.model.dispose()}},{key:"mutate",value:function(){var M=this,T=arguments.length>0&&arguments[0]!==void 0?arguments[0]:.1,A=arguments.length>1?arguments[1]:void 0;I.tidy(function(){for(var P=M.model.getWeights(),J=[],ie=0;ie<P.length;ie+=1){for(var pe=P[ie],Ae=P[ie].shape,Ie=pe.dataSync().slice(),De=0;De<Ie.length;De+=1)Math.random()<T&&(Ie[De]=A?A(Ie[De]):Math.min(Math.max(Ie[De]+Zm(),-1),1));var et=I.tensor(Ie,Ae);J[ie]=et}M.model.setWeights(J)})}},{key:"crossover",value:function(M){var T=this;return I.tidy(function(){for(var A=T.model.getWeights(),P=M.model.getWeights(),J=[],ie=0;ie<A.length;ie+=1){for(var pe=A[ie],Ae=P[ie],Ie=A[ie].shape,De=pe.dataSync().slice(),et=Ae.dataSync().slice(),ot=0;ot<De.length;ot+=1)Math.random()<.5&&(De[ot]=et[ot]);var Bt=I.tensor(De,Ie);J[ie]=Bt}T.model.setWeights(J)})}}]),$}();function Jp($,M){var T=Object.keys($);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols($);M&&(A=A.filter(function(P){return Object.getOwnPropertyDescriptor($,P).enumerable})),T.push.apply(T,A)}return T}function Lh($){for(var M=1;M<arguments.length;M++){var T=arguments[M]!=null?arguments[M]:{};M%2?Jp(Object(T),!0).forEach(function(A){q()($,A,T[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(T)):Jp(Object(T)).forEach(function(A){Object.defineProperty($,A,Object.getOwnPropertyDescriptor(T,A))})}return $}var Oa=new(function(){function $(M){ce()(this,$),this.options=M||{}}return Ee()($,[{key:"normalizeValue",value:function(M,T,A){return(M-T)/(A-T)}},{key:"unnormalizeValue",value:function(M,T,A){return M*(A-T)+T}},{key:"getMin",value:function(M){return M.reduce(function(T,A){return Math.min(T,A)})}},{key:"getMax",value:function(M){return M.reduce(function(T,A){return Math.max(T,A)})}},{key:"isJsonOrString",value:function(M){try{JSON.parse(M)}catch{return!1}return!0}},{key:"zipArrays",value:function(M,T){return M.length!==T.length?(console.error("arrays do not have the same length"),[]):Go()(new Array(M.length).fill(null)).map(function(A,P){return Lh(Lh({},M[P]),T[P])})}},{key:"createLabelsFromArrayValues",value:function(M,T){var A;return Array.isArray(M)&&(A=M.map(function(P,J){return"".concat(T,"_").concat(J)})),A}},{key:"formatDataAsObject",value:function(M,T){var A={};if(Array.isArray(M))return M.forEach(function(P,J){var ie=T[J];A[ie]=P}),A;if(we()(M)==="object")return A=M;throw new Error("input provided is not supported or does not match your output label specifications")}},{key:"getDataType",value:function(M){var T=we()(M);return T==="object"&&Array.isArray(M)&&(T="array"),T}}]),$}());function bf($,M){var T=Object.keys($);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols($);M&&(A=A.filter(function(P){return Object.getOwnPropertyDescriptor($,P).enumerable})),T.push.apply(T,A)}return T}function Ps($){for(var M=1;M<arguments.length;M++){var T=arguments[M]!=null?arguments[M]:{};M%2?bf(Object(T),!0).forEach(function(A){q()($,A,T[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(T)):bf(Object(T)).forEach(function(A){Object.defineProperty($,A,Object.getOwnPropertyDescriptor(T,A))})}return $}var xf=function(){function $(){ce()(this,$),this.meta={inputUnits:null,outputUnits:null,inputs:{},outputs:{},isNormalized:!1},this.isMetadataReady=!1,this.isWarmedUp=!1,this.data={raw:[]},this.createMetadata=this.createMetadata.bind(this),this.getDataStats=this.getDataStats.bind(this),this.getInputMetaStats=this.getInputMetaStats.bind(this),this.getDataUnits=this.getDataUnits.bind(this),this.getInputMetaUnits=this.getInputMetaUnits.bind(this),this.getDTypesFromData=this.getDTypesFromData.bind(this),this.addData=this.addData.bind(this),this.convertRawToTensors=this.convertRawToTensors.bind(this),this.normalizeDataRaw=this.normalizeDataRaw.bind(this),this.normalizeInputData=this.normalizeInputData.bind(this),this.normalizeArray=this.normalizeArray.bind(this),this.unnormalizeArray=this.unnormalizeArray.bind(this),this.applyOneHotEncodingsToDataRaw=this.applyOneHotEncodingsToDataRaw.bind(this),this.getDataOneHot=this.getDataOneHot.bind(this),this.getInputMetaOneHot=this.getInputMetaOneHot.bind(this),this.createOneHotEncodings=this.createOneHotEncodings.bind(this),this.loadDataFromUrl=this.loadDataFromUrl.bind(this),this.loadJSON=this.loadJSON.bind(this),this.loadCSV=this.loadCSV.bind(this),this.loadBlob=this.loadBlob.bind(this),this.loadData=this.loadData.bind(this),this.saveData=this.saveData.bind(this),this.saveMeta=this.saveMeta.bind(this),this.loadMeta=this.loadMeta.bind(this),this.findEntries=this.findEntries.bind(this),this.formatRawData=this.formatRawData.bind(this),this.csvToJSON=this.csvToJSON.bind(this)}return Ee()($,[{key:"createMetadata",value:function(M){var T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return this.getDTypesFromData(M),this.getDataStats(M),this.getDataOneHot(M),this.getDataUnits(M,T),this.isMetadataReady=!0,Ps({},this.meta)}},{key:"getDataStats",value:function(M){var T=Object.assign({},this.meta),A=this.getInputMetaStats(M,T.inputs,"xs"),P=this.getInputMetaStats(M,T.outputs,"ys");return T.inputs=A,T.outputs=P,this.meta=Ps(Ps({},this.meta),T),T}},{key:"getInputMetaStats",value:function(M,T,A){var P=Object.assign({},T);return Object.keys(P).forEach(function(J){if(P[J].dtype==="string")P[J].min=0,P[J].max=1;else if(P[J].dtype==="number"){var ie=M.map(function(Ae){return Ae[A][J]});P[J].min=Oa.getMin(ie),P[J].max=Oa.getMax(ie)}else if(P[J].dtype==="array"){var pe=M.map(function(Ae){return Ae[A][J]}).flat();P[J].min=Oa.getMin(pe),P[J].max=Oa.getMax(pe)}}),P}},{key:"getDataUnits",value:function(M){var T,A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,P=A!==null?A:void 0,J=Object.assign({},this.meta);T=P||[this.getInputMetaUnits(M,J.inputs)].flat();var ie=this.getInputMetaUnits(M,J.outputs);return J.inputUnits=T,J.outputUnits=ie,this.meta=Ps(Ps({},this.meta),J),J}},{key:"getInputMetaUnits",value:function(M,T){var A=0,P=Object.assign({},T);return Object.entries(P).forEach(function(J){var ie=J[1].dtype;if(ie==="number")A+=1;else if(ie==="string"){var pe=J[1].uniqueValues.length;A+=pe}else ie==="array"&&(A=[])}),A}},{key:"getDTypesFromData",value:function(M){var T=Ps(Ps({},this.meta),{},{inputs:{},outputs:{}}),A=M[0],P=Object.keys(A.xs),J=Object.keys(A.ys);return P.forEach(function(ie){T.inputs[ie]={dtype:Oa.getDataType(A.xs[ie])}}),J.forEach(function(ie){T.outputs[ie]={dtype:Oa.getDataType(A.ys[ie])}}),this.meta=T,T}},{key:"addData",value:function(M,T){this.data.raw.push({xs:M,ys:T})}},{key:"convertRawToTensors",value:function(M){var T=Object.assign({},this.meta),A=M.length;return I.tidy(function(){var P=[],J=[];return M.forEach(function(ie){var pe=Object.keys(T.inputs).map(function(Ie){return ie.xs[Ie]}).flat();P.push(pe);var Ae=Object.keys(T.outputs).map(function(Ie){return ie.ys[Ie]}).flat();J.push(Ae)}),{inputs:I.tensor(P.flat(),[A].concat(Go()(T.inputUnits))),outputs:I.tensor(J.flat(),[A,T.outputUnits])}})}},{key:"normalizeDataRaw",value:function(M){var T=Object.assign({},this.meta),A=this.normalizeInputData(M,T.inputs,"xs"),P=this.normalizeInputData(M,T.outputs,"ys");return Oa.zipArrays(A,P)}},{key:"normalizeInputData",value:function(M,T,A){var P=this,J=M.length,ie=Object.assign({},T),pe={};return Object.keys(ie).forEach(function(Ae){var Ie={min:ie[Ae].min,max:ie[Ae].max},De=M.map(function(et){return et[A][Ae]});ie[Ae].dtype==="string"?(Ie.legend=ie[Ae].legend,pe[Ae]=P.normalizeArray(De,Ie)):ie[Ae].dtype==="number"?pe[Ae]=P.normalizeArray(De,Ie):ie[Ae].dtype==="array"&&(pe[Ae]=De.map(function(et){return P.normalizeArray(et,Ie)}))}),Go()(new Array(J).fill(null)).map(function(Ae,Ie){var De=q()({},A,{});return Object.keys(ie).forEach(function(et){De[A][et]=pe[et][Ie]}),De})}},{key:"normalizeArray",value:function(M,T){var A=T.min,P=T.max;if(T.legend)return M.map(function(J){return T.legend[J]?T.legend[J]:J});if(M.every(function(J){return typeof J=="number"}))return M.map(function(J){return Oa.normalizeValue(J,A,P)});throw new Error("error in inputArray of normalizeArray() function")}},{key:"unnormalizeArray",value:function(M,T){var A=T.min,P=T.max;if(T.legend)return M.map(function(J){var ie;return Object.entries(T.legend).forEach(function(pe){var Ae=pe[0],Ie=pe[1];J.map(function(De,et){return De===Ie[et]}).every(function(De){return De===!0})&&(ie=Ae)}),ie});if(M.every(function(J){return typeof J=="number"}))return M.map(function(J){return Oa.unnormalizeValue(J,A,P)});throw new Error("error in inputArray of normalizeArray() function")}},{key:"applyOneHotEncodingsToDataRaw",value:function(M){var T=Object.assign({},this.meta);return M.map(function(A){var P=Ps({},A.xs),J=Ps({},A.ys);return Object.keys(T.inputs).forEach(function(ie){T.inputs[ie].legend&&(P[ie]=T.inputs[ie].legend[A.xs[ie]])}),Object.keys(T.outputs).forEach(function(ie){T.outputs[ie].legend&&(J[ie]=T.outputs[ie].legend[A.ys[ie]])}),{xs:P,ys:J}})}},{key:"getDataOneHot",value:function(M){var T=Object.assign({},this.meta),A=this.getInputMetaOneHot(M,T.inputs,"xs"),P=this.getInputMetaOneHot(M,T.outputs,"ys");return T.inputs=A,T.outputs=P,this.meta=Ps(Ps({},this.meta),T),T}},{key:"getInputMetaOneHot",value:function(M,T,A){var P=this,J=Object.assign({},T);return Object.entries(J).forEach(function(ie){var pe=ie[0];if(ie[1].dtype==="string"){var Ae=Go()(new Set(M.map(function(De){return De[A][pe]}))),Ie=P.createOneHotEncodings(Ae);J[pe]=Ps(Ps({},J[pe]),Ie)}}),J}},{key:"createOneHotEncodings",value:function(M){return I.tidy(function(){var T={uniqueValues:M,legend:{}},A=M,P=A.map(function(ie,pe){return pe}),J=I.oneHot(I.tensor1d(P,"int32"),A.length).arraySync();return A.forEach(function(ie,pe){T.legend[ie]=J[pe]}),T})}},{key:"loadDataFromUrl",value:function(){var M=G()(ge.a.mark(function T(A,P,J){var ie;return ge.a.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:if(pe.prev=0,!A.endsWith(".csv")){pe.next=7;break}return pe.next=4,this.loadCSV(A,P,J);case 4:ie=pe.sent,pe.next=20;break;case 7:if(!A.endsWith(".json")){pe.next=13;break}return pe.next=10,this.loadJSON(A,P,J);case 10:ie=pe.sent,pe.next=20;break;case 13:if(!A.includes("blob")){pe.next=19;break}return pe.next=16,this.loadBlob(A,P,J);case 16:ie=pe.sent,pe.next=20;break;case 19:throw new Error("Not a valid data format. Must be csv or json");case 20:return pe.abrupt("return",ie);case 23:throw pe.prev=23,pe.t0=pe.catch(0),console.error(pe.t0),new Error(pe.t0);case 27:case"end":return pe.stop()}},T,this,[[0,23]])}));return function(T,A,P){return M.apply(this,arguments)}}()},{key:"loadJSON",value:function(){var M=G()(ge.a.mark(function T(A,P,J){var ie,pe,Ae,Ie;return ge.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(De.prev=0,!(A instanceof Object)){De.next=5;break}ie=Object.assign({},A),De.next=10;break;case 5:return De.next=7,jt.a.get(A);case 7:pe=De.sent,Ae=pe.data,ie=Ae;case 10:return Ie=this.formatRawData(ie,P,J),De.abrupt("return",Ie);case 14:throw De.prev=14,De.t0=De.catch(0),console.error("error loading json"),new Error(De.t0);case 18:case"end":return De.stop()}},T,this,[[0,14]])}));return function(T,A,P){return M.apply(this,arguments)}}()},{key:"loadCSV",value:function(){var M=G()(ge.a.mark(function T(A,P,J){var ie,pe,Ae,Ie;return ge.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return De.prev=0,ie=I.data.csv(A),De.next=4,ie.toArray();case 4:return pe=De.sent,Ae={entries:pe},Ie=this.formatRawData(Ae,P,J),De.abrupt("return",Ie);case 10:throw De.prev=10,De.t0=De.catch(0),console.error("error loading csv",De.t0),new Error(De.t0);case 14:case"end":return De.stop()}},T,this,[[0,10]])}));return function(T,A,P){return M.apply(this,arguments)}}()},{key:"loadBlob",value:function(){var M=G()(ge.a.mark(function T(A,P,J){var ie,pe,Ae,Ie,De,et;return ge.a.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:return ot.prev=0,ot.next=3,jt.a.get(A);case 3:if(ie=ot.sent,pe=ie.data,Ae=pe,!Oa.isJsonOrString(Ae)){ot.next=13;break}return De=JSON.parse(Ae),ot.next=10,this.loadJSON(De,P,J);case 10:Ie=ot.sent,ot.next=17;break;case 13:return et=this.csvToJSON(Ae),ot.next=16,this.loadJSON(et,P,J);case 16:Ie=ot.sent;case 17:return ot.abrupt("return",Ie);case 20:throw ot.prev=20,ot.t0=ot.catch(0),console.log("mmm might be passing in a string or something!",ot.t0),new Error(ot.t0);case 24:case"end":return ot.stop()}},T,this,[[0,20]])}));return function(T,A,P){return M.apply(this,arguments)}}()},{key:"loadData",value:function(){var M=G()(ge.a.mark(function T(){var A,P,J,ie,pe,Ae,Ie=arguments;return ge.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(A=Ie.length>0&&Ie[0]!==void 0?Ie[0]:null,P=Ie.length>1?Ie[1]:void 0,De.prev=2,typeof A=="string"){De.next=17;break}if(ie=A[0],new FileReader().readAsText(ie),!ie.name.includes(".json")){De.next=14;break}return De.next=10,ie.text();case 10:pe=De.sent,J=JSON.parse(pe),De.next=15;break;case 14:console.log('data must be a json object containing an array called "data" or "entries');case 15:De.next=22;break;case 17:return De.next=19,jt.a.get(A,{responseType:"text"});case 19:J=De.sent,Ae=JSON.stringify(J.data),Oa.isJsonOrString(Ae)?J=JSON.parse(Ae):console.log("Whoops! something went wrong. Either this kind of data is not supported yet or there is an issue with .loadData");case 22:this.data.raw=this.findEntries(J),!this.data.raw.length>0&&console.log('data must be a json object containing an array called "data" '),P&&P(),De.next=30;break;case 27:throw De.prev=27,De.t0=De.catch(2),new Error(De.t0);case 30:case"end":return De.stop()}},T,this,[[2,27]])}));return function(){return M.apply(this,arguments)}}()},{key:"saveData",value:function(){var M=G()(ge.a.mark(function T(A){var P,J,ie,pe,Ae,Ie;return ge.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return P=new Date,J="".concat(String(P.getFullYear()),"-").concat(String(P.getMonth()+1),"-").concat(String(P.getDate())),ie="".concat(String(P.getHours()),"-").concat(String(P.getMinutes()),"-").concat(String(P.getSeconds())),pe="".concat(J,"_").concat(ie),Ae=pe,A&&(Ae=A),Ie={data:this.data.raw},De.next=9,Xr(JSON.stringify(Ie),"".concat(Ae,".json"),"text/plain");case 9:case"end":return De.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"saveMeta",value:function(){var M=G()(ge.a.mark(function T(A,P){var J,ie;return ge.a.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return typeof A=="function"?(J="model",ie=A):typeof A=="string"?(J=A,typeof P=="function"&&(ie=P)):J="model",pe.next=3,Xr(JSON.stringify(this.meta),"".concat(J,"_meta.json"),"text/plain");case 3:ie&&ie();case 4:case"end":return pe.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()},{key:"loadMeta",value:function(){var M=G()(ge.a.mark(function T(){var A,P,J,ie,pe,Ae,Ie,De=arguments;return ge.a.wrap(function(et){for(;;)switch(et.prev=et.next){case 0:if(A=De.length>0&&De[0]!==void 0?De[0]:null,P=De.length>1?De[1]:void 0,!(A instanceof FileList)){et.next=10;break}return et.next=5,Promise.all(Array.from(A).map(function(){var ot=G()(ge.a.mark(function Bt(Vt){var yn;return ge.a.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:if(!Vt.name.includes(".json")||Vt.name.includes("_meta")){_n.next=4;break}return _n.abrupt("return",{name:"model",file:Vt});case 4:if(!Vt.name.includes(".json")||!Vt.name.includes("_meta.json")){_n.next=11;break}return _n.next=7,Vt.text();case 7:return yn=_n.sent,_n.abrupt("return",{name:"metadata",file:yn});case 11:if(!Vt.name.includes(".bin")){_n.next=13;break}return _n.abrupt("return",{name:"weights",file:Vt});case 13:return _n.abrupt("return",{name:null,file:null});case 14:case"end":return _n.stop()}},Bt)}));return function(Bt){return ot.apply(this,arguments)}}()));case 5:J=et.sent,ie=JSON.parse(J.find(function(ot){return ot.name==="metadata"}).file),this.meta=ie,et.next=25;break;case 10:if(!(A instanceof Object)){et.next=19;break}return et.next=13,jt.a.get(A.metadata,{responseType:"text"});case 13:pe=et.sent,pe=JSON.stringify(pe.data),pe=JSON.parse(pe),this.meta=pe,et.next=25;break;case 19:return Ae="".concat(A.substring(0,A.lastIndexOf("/")),"/model_meta.json"),et.next=22,jt.a.get(Ae);case 22:Ie=(Ie=et.sent).data,this.meta=Ie;case 25:return this.isMetadataReady=!0,this.isWarmedUp=!0,P&&P(),et.abrupt("return",this.meta);case 29:case"end":return et.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"formatRawData",value:function(M,T,A){var P=this.findEntries(M);!P.length>0&&console.log(`your data must be contained in an array in 

        a property called 'entries' or 'data' of your json object`);var J=P.map(function(ie,pe){var Ae={xs:{},ys:{}};return T.forEach(function(Ie){ie[Ie]!==void 0?Ae.xs[Ie]=ie[Ie]:console.error("the input label ".concat(Ie," does not exist at row ").concat(pe))}),A.forEach(function(Ie){ie[Ie]!==void 0?Ae.ys[Ie]=ie[Ie]:console.error("the output label ".concat(Ie," does not exist at row ").concat(pe))}),Ae});return this.data.raw=J,J}},{key:"csvToJSON",value:function(M){for(var T=M.split(`
`),A=[],P=T[0].split(","),J=function(pe){var Ae={},Ie=T[pe].split(",");P.forEach(function(De,et){Ae[De]=Ie[et]}),A.push(Ae)},ie=1;ie<T.length;ie+=1)J(ie);return{entries:A}}},{key:"findEntries",value:function(M){var T=this,A=Object.assign({},M);return A.entries&&A.entries instanceof Array?A.entries:A.data&&A.data instanceof Array?A.data:(Object.keys(A).forEach(function(P){if(we()(A[P])==="object")return T.findEntries(A[P])}),A)}},{key:"getData",value:function(){return this.data.raw}}]),$}();function _d($,M){var T=Object.keys($);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols($);M&&(A=A.filter(function(P){return Object.getOwnPropertyDescriptor($,P).enumerable})),T.push.apply(T,A)}return T}var Bh=function(){function $(){ce()(this,$),this.config={height:300}}return Ee()($,[{key:"modelSummary",value:function(M,T){var A=function(P){for(var J=1;J<arguments.length;J++){var ie=arguments[J]!=null?arguments[J]:{};J%2?_d(Object(ie),!0).forEach(function(pe){q()(P,pe,ie[pe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(P,Object.getOwnPropertyDescriptors(ie)):_d(Object(ie)).forEach(function(pe){Object.defineProperty(P,pe,Object.getOwnPropertyDescriptor(ie,pe))})}return P}({},M);Z.show.modelSummary(A,T)}},{key:"scatterplot",value:function(M,T,A){var P=A.map(function(ie){return{x:ie.xs[M],y:ie.ys[T]}}),J={xLabel:"X",yLabel:"Y",height:this.config.height};Z.render.scatterplot({name:"debug mode"},P,J)}},{key:"scatterplotAll",value:function(M,T,A){var P=[];M.forEach(function(ie){T.forEach(function(pe){var Ae=A.map(function(Ie){return{x:Ie.xs[ie],y:Ie.ys[pe]}});P=[].concat(Go()(P),Go()(Ae))})});var J={xLabel:"X",yLabel:"Y",height:this.config.height};Z.render.scatterplot({name:"debug mode"},P,J)}},{key:"barchart",value:function(M,T,A){var P=A.map(function(ie){return{value:ie.xs[M],index:ie.ys[T]}}),J={xLabel:"label",yLabel:"value",height:this.config.height};console.log(J),Z.render.barchart({name:"Bar chart"},P)}},{key:"trainingVis",value:function(){return Z.show.fitCallbacks({name:"Training Performance"},["loss","accuracy"],{height:this.config.height,callbacks:["onEpochEnd"]})}}]),$}();function Qp($,M){var T=Object.keys($);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols($);M&&(A=A.filter(function(P){return Object.getOwnPropertyDescriptor($,P).enumerable})),T.push.apply(T,A)}return T}function Ed($){for(var M=1;M<arguments.length;M++){var T=arguments[M]!=null?arguments[M]:{};M%2?Qp(Object(T),!0).forEach(function(A){q()($,A,T[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(T)):Qp(Object(T)).forEach(function(A){Object.defineProperty($,A,Object.getOwnPropertyDescriptor(T,A))})}return $}var wf={inputs:[],outputs:[],dataUrl:null,modelUrl:null,layers:[],task:null,debug:!1,learningRate:.2,hiddenUnits:16,noTraining:!1},Zp=function(){function $(M,T){ce()(this,$),this.callback=T,M.task==="imageClassification"&&(wf.learningRate=.02),this.options=Ed(Ed({},wf),M)||wf,this.neuralNetwork=new Dl,this.neuralNetworkData=new xf,this.neuralNetworkVis=new Bh,this.data={training:[]},this.ready=!1,this.init=this.init.bind(this),this.addData=this.addData.bind(this),this.loadDataFromUrl=this.loadDataFromUrl.bind(this),this.loadDataInternal=this.loadDataInternal.bind(this),this.createMetaData=this.createMetaData.bind(this),this.prepareForTraining=this.prepareForTraining.bind(this),this.normalizeData=this.normalizeData.bind(this),this.normalizeInput=this.normalizeInput.bind(this),this.searchAndFormat=this.searchAndFormat.bind(this),this.formatInputItem=this.formatInputItem.bind(this),this.convertTrainingDataToTensors=this.convertTrainingDataToTensors.bind(this),this.formatInputsForPrediction=this.formatInputsForPrediction.bind(this),this.formatInputsForPredictionAll=this.formatInputsForPredictionAll.bind(this),this.isOneHotEncodedOrNormalized=this.isOneHotEncodedOrNormalized.bind(this),this.train=this.train.bind(this),this.trainInternal=this.trainInternal.bind(this),this.addLayer=this.addLayer.bind(this),this.createNetworkLayers=this.createNetworkLayers.bind(this),this.addDefaultLayers=this.addDefaultLayers.bind(this),this.compile=this.compile.bind(this),this.predict=this.predict.bind(this),this.predictMultiple=this.predictMultiple.bind(this),this.classify=this.classify.bind(this),this.classifyMultiple=this.classifyMultiple.bind(this),this.predictInternal=this.predictInternal.bind(this),this.classifyInternal=this.classifyInternal.bind(this),this.saveData=this.saveData.bind(this),this.loadData=this.loadData.bind(this),this.save=this.save.bind(this),this.load=this.load.bind(this),this.dispose=this.dispose.bind(this),this.mutate=this.mutate.bind(this),this.crossover=this.crossover.bind(this),this.init(this.callback)}return Ee()($,[{key:"init",value:function(M){this.options.noTraining===!0&&this.createLayersNoTraining(),this.options.dataUrl!==null?this.ready=this.loadDataFromUrl(this.options,M):this.options.modelUrl!==null?this.ready=this.load(this.options.modelUrl,M):this.ready=!0}},{key:"createLayersNoTraining",value:function(){var M=this.options,T=M.inputs,A=M.outputs;if(M.task==="classification")for(var P=0;P<A.length;P+=1){var J=new Array(T).fill(0);this.addData(J,[A[P]])}else{var ie=new Array(T).fill(0),pe=new Array(A).fill(0);this.addData(ie,pe)}this.neuralNetworkData.createMetadata(this.neuralNetworkData.data.raw),this.addDefaultLayers(this.options.task,this.neuralNetworkData.meta)}},{key:"copy",value:function(){var M=this,T=new $(this.options);return I.tidy(function(){for(var A=M.neuralNetwork.model.getWeights(),P=[],J=0;J<A.length;J+=1)P[J]=A[J].clone();return T.neuralNetwork.model.setWeights(P),T})}},{key:"addData",value:function(M,T){var A,P,J=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,ie=this.options,pe=ie.inputs,Ae=ie.outputs;if(J!==null?(A=J.inputLabels,P=J.outputLabels):pe.length>0&&Ae.length>0?(pe.every(function(ot){return typeof ot=="string"})&&(A=pe),Ae.every(function(ot){return typeof ot=="string"})&&(P=Ae)):we()(M)==="object"&&we()(T)==="object"?(A=Object.keys(M),P=Object.keys(T)):(A=Oa.createLabelsFromArrayValues(M,"input"),P=Oa.createLabelsFromArrayValues(T,"output")),!(A instanceof Array))throw new Error("inputLabels must be an array");if(!(P instanceof Array))throw new Error("outputLabels must be an array");var Ie=this.searchAndFormat(M),De=Oa.formatDataAsObject(Ie,A),et=Oa.formatDataAsObject(T,P);this.neuralNetworkData.addData(De,et)}},{key:"loadDataFromUrl",value:function(M,T){return Ge(this.loadDataInternal(M),T)}},{key:"loadDataInternal",value:function(){var M=G()(ge.a.mark(function T(A){var P,J,ie,pe;return ge.a.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:return P=A.dataUrl,J=A.inputs,ie=A.outputs,Ae.next=3,this.neuralNetworkData.loadDataFromUrl(P,J,ie);case 3:pe=Ae.sent,this.createMetadata(pe),this.prepareForTraining(pe);case 6:case"end":return Ae.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"createMetaData",value:function(M){var T,A=this.options.inputs;Array.isArray(A)&&A.length>0&&(T=A.every(function(P){return typeof P=="number"})&&A.length>0?A:null),this.neuralNetworkData.createMetadata(M,T)}},{key:"prepareForTraining",value:function(){var M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,T=M===null?this.neuralNetworkData.data.raw:M,A=this.neuralNetworkData.applyOneHotEncodingsToDataRaw(T);return this.data.training=A,this.neuralNetworkData.isWarmedUp=!0,A}},{key:"normalizeData",value:function(){var M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,T=M===null?this.neuralNetworkData.data.raw:M;this.neuralNetworkData.isMetadataReady||this.createMetaData(T),this.neuralNetworkData.isWarmedUp||this.prepareForTraining(T);var A=this.neuralNetworkData.normalizeDataRaw(T);return this.data.training=A,this.neuralNetworkData.meta.isNormalized=!0,A}},{key:"normalizeInput",value:function(M,T,A){var P=A[T],J=P.min,ie=P.max;return Oa.normalizeValue(M,J,ie)}},{key:"searchAndFormat",value:function(M){var T,A=this;if(Array.isArray(M))T=M.map(function(J){return A.formatInputItem(J)});else if(we()(M)==="object"){var P=Object.assign({},M);Object.keys(M).forEach(function(J){var ie=M[J];P[J]=A.formatInputItem(ie)}),T=P}return T}},{key:"formatInputItem",value:function(M){var T;return xn(M)?T=M:we()(M)==="object"&&xn(M.elt)?T=M.elt:we()(M)==="object"&&xn(M.canvas)&&(T=M.canvas),T?Un(T):M}},{key:"convertTrainingDataToTensors",value:function(){var M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,A=M===null?this.data.training:M,P=T===null?this.neuralNetworkData.meta:T;return this.neuralNetworkData.convertRawToTensors(A,P)}},{key:"formatInputsForPrediction",value:function(M,T,A){var P=this,J=[];return M instanceof Array?J=A.map(function(ie,pe){return P.isOneHotEncodedOrNormalized(M[pe],ie,T.inputs)}):M instanceof Object&&(J=A.map(function(ie){return P.isOneHotEncodedOrNormalized(M[ie],ie,T.inputs)})),J=J.flat()}},{key:"formatInputsForPredictionAll",value:function(M,T,A){var P,J=this;return M instanceof Array&&M.every(function(ie){return Array.isArray(ie)})?(P=M.map(function(ie){return J.formatInputsForPrediction(ie,T,A)}),I.tensor(P,[M.length,A.length])):(P=this.formatInputsForPrediction(M,T,A),I.tensor([P]))}},{key:"isOneHotEncodedOrNormalized",value:function(M,T,A){var P,J=M,ie=T;return typeof M!="number"?P=A[ie].legend[J]:(P=M,this.neuralNetworkData.meta.isNormalized&&(P=this.normalizeInput(M,ie,A))),P}},{key:"train",value:function(M,T,A){var P,J,ie;we()(M)==="object"&&typeof T=="function"&&typeof A=="function"?(P=M,J=T,ie=A):we()(M)==="object"&&typeof T=="function"?(P=M,J=null,ie=T):typeof M=="function"&&typeof T=="function"?(P={},J=M,ie=T):(P={},J=null,ie=M),this.trainInternal(P,J,ie)}},{key:"trainInternal",value:function(M,T,A){var P=Ed({epochs:10,batchSize:32,validationSplit:.1,whileTraining:null},M);if(this.options.debug===!0||this.options.debug==="true"?P.whileTraining=[this.neuralNetworkVis.trainingVis(),{onEpochEnd:T}]:P.whileTraining=[{onEpochEnd:T}],this.neuralNetworkData.isMetadataReady||this.createMetaData(this.neuralNetworkData.data.raw),this.neuralNetworkData.isWarmedUp||this.prepareForTraining(this.neuralNetworkData.data.raw),!P.inputs&&!P.outputs){var J=this.convertTrainingDataToTensors(),ie=J.inputs,pe=J.outputs;P.inputs=ie,P.outputs=pe}this.neuralNetwork.isLayered||(this.options.layers=this.createNetworkLayers(this.options.layers,this.neuralNetworkData.meta)),this.neuralNetwork.isLayered||(this.options.layers=this.addDefaultLayers(this.options.task,this.neuralNetworkData.meta)),this.neuralNetwork.isCompiled||this.compile(),this.neuralNetwork.train(P,A)}},{key:"addLayer",value:function(M){this.neuralNetwork.addLayer(M)}},{key:"createNetworkLayers",value:function(M,T){var A=this,P=Go()(M),J=Object.assign({},T),ie=J.inputUnits,pe=J.outputUnits,Ae=P.length;if(!(P.length>=2))return!1;P[0].inputShape=P[0].inputShape?P[0].inputShape:ie;var Ie=P[Ae-1];return Ie.units=Ie.units?Ie.units:pe,P.forEach(function(De){A.addLayer(I.layers[De.type](De))}),P}},{key:"addDefaultLayers",value:function(M,T){var A;switch(M.toLowerCase()){case"classification":return A=[{type:"dense",units:this.options.hiddenUnits,activation:"relu"},{type:"dense",activation:"softmax"}],this.createNetworkLayers(A,T);case"regression":return A=[{type:"dense",units:this.options.hiddenUnits,activation:"relu"},{type:"dense",activation:"sigmoid"}],this.createNetworkLayers(A,T);case"imageclassification":return A=[{type:"conv2d",filters:8,kernelSize:5,strides:1,activation:"relu",kernelInitializer:"varianceScaling"},{type:"maxPooling2d",poolSize:[2,2],strides:[2,2]},{type:"conv2d",filters:16,kernelSize:5,strides:1,activation:"relu",kernelInitializer:"varianceScaling"},{type:"maxPooling2d",poolSize:[2,2],strides:[2,2]},{type:"flatten"},{type:"dense",kernelInitializer:"varianceScaling",activation:"softmax"}],this.createNetworkLayers(A,T);default:return console.log("no imputUnits or outputUnits defined"),A=[{type:"dense",units:this.options.hiddenUnits,activation:"relu"},{type:"dense",activation:"sigmoid"}],this.createNetworkLayers(A,T)}}},{key:"compile",value:function(){var M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,A=T===null?this.options.learningRate:T,P={};M!==null?P=Ed({},M):this.options.task==="classification"||this.options.task==="imageClassification"?P={loss:"categoricalCrossentropy",optimizer:I.train.sgd,metrics:["accuracy"]}:this.options.task==="regression"&&(P={loss:"meanSquaredError",optimizer:I.train.adam,metrics:["accuracy"]}),P.optimizer=P.optimizer?this.neuralNetwork.setOptimizerFunction(A,P.optimizer):this.neuralNetwork.setOptimizerFunction(A,I.train.sgd),this.neuralNetwork.compile(P),this.options.debug&&this.neuralNetworkVis.modelSummary({name:"Model Summary"},this.neuralNetwork.model)}},{key:"predictSync",value:function(M){return this.predictSyncInternal(M)}},{key:"predict",value:function(M,T){return Ge(this.predictInternal(M),T)}},{key:"predictMultiple",value:function(M,T){return Ge(this.predictInternal(M),T)}},{key:"classifySync",value:function(M){return this.classifySyncInternal(M)}},{key:"classify",value:function(M,T){return Ge(this.classifyInternal(M),T)}},{key:"classifyMultiple",value:function(M,T){return Ge(this.classifyInternal(M),T)}},{key:"predictSyncInternal",value:function(M){var T=this.neuralNetworkData.meta,A=Object.keys(T.inputs),P=this.formatInputsForPredictionAll(M,T,A),J=this.neuralNetwork.predictSync(P);if(P.dispose(),T!==null){var ie=Object.keys(T.outputs),pe=J.map(function(Ae){return ie.map(function(Ie,De){var et,ot,Bt;if(T.isNormalized){var Vt=T.outputs[Ie],yn=Vt.min,_n=Vt.max;ot=Oa.unnormalizeValue(Ae[De],yn,_n),Bt=Ae[De]}else ot=Ae[De];var Dn=(et={},q()(et,ie[De],ot),q()(et,"label",Ie),q()(et,"value",ot),et);return Bt&&(Dn.unNormalizedValue=Bt),Dn})});return pe.length<2?pe[0]:pe}return J}},{key:"predictInternal",value:function(){var M=G()(ge.a.mark(function T(A){var P,J,ie,pe,Ae,Ie;return ge.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return P=this.neuralNetworkData.meta,J=Object.keys(P.inputs),ie=this.formatInputsForPredictionAll(A,P,J),De.next=5,this.neuralNetwork.predict(ie);case 5:if(pe=De.sent,ie.dispose(),P===null){De.next=13;break}if(Ae=Object.keys(P.outputs),!((Ie=pe.map(function(et){return Ae.map(function(ot,Bt){var Vt,yn,_n;if(P.isNormalized){var Dn=P.outputs[ot],Nn=Dn.min,Wn=Dn.max;yn=Oa.unnormalizeValue(et[Bt],Nn,Wn),_n=et[Bt]}else yn=et[Bt];var Jn=(Vt={},q()(Vt,Ae[Bt],yn),q()(Vt,"label",ot),q()(Vt,"value",yn),Vt);return _n&&(Jn.unNormalizedValue=_n),Jn})})).length<2)){De.next=12;break}return De.abrupt("return",Ie[0]);case 12:return De.abrupt("return",Ie);case 13:return De.abrupt("return",pe);case 14:case"end":return De.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"classifySyncInternal",value:function(M){var T,A=this.neuralNetworkData.meta,P=Object.keys(A.inputs);if(this.options.task==="imageClassification"){if(T=this.searchAndFormat(M),T=Array.isArray(T)?T.flat():T[P[0]],A.isNormalized){var J=A.inputs[P[0]],ie=J.min,pe=J.max;T=this.neuralNetworkData.normalizeArray(Array.from(T),{min:ie,max:pe})}else T=Array.from(T);T=I.tensor([T],[1].concat(Go()(A.inputUnits)))}else T=this.formatInputsForPredictionAll(M,A,P);var Ae=this.neuralNetwork.classifySync(T);if(T.dispose(),A!==null){var Ie=Object.keys(A.outputs)[0],De=Object.entries(A.outputs[Ie].legend),et=Ae.map(function(ot){return De.map(function(Bt,Vt){var yn;return yn={},q()(yn,Bt[0],ot[Vt]),q()(yn,"label",Bt[0]),q()(yn,"confidence",ot[Vt]),yn}).sort(function(Bt,Vt){return Vt.confidence-Bt.confidence})});return et.length<2?et[0]:et}return Ae}},{key:"classifyInternal",value:function(){var M=G()(ge.a.mark(function T(A){var P,J,ie,pe,Ae,Ie,De,et,ot,Bt;return ge.a.wrap(function(Vt){for(;;)switch(Vt.prev=Vt.next){case 0:return P=this.neuralNetworkData.meta,J=Object.keys(P.inputs),this.options.task==="imageClassification"?(ie=this.searchAndFormat(A),ie=Array.isArray(ie)?ie.flat():ie[J[0]],P.isNormalized?(pe=P.inputs[J[0]],Ae=pe.min,Ie=pe.max,ie=this.neuralNetworkData.normalizeArray(Array.from(ie),{min:Ae,max:Ie})):ie=Array.from(ie),ie=I.tensor([ie],[1].concat(Go()(P.inputUnits)))):ie=this.formatInputsForPredictionAll(A,P,J),Vt.next=5,this.neuralNetwork.classify(ie);case 5:if(De=Vt.sent,ie.dispose(),P===null){Vt.next=14;break}if(et=Object.keys(P.outputs)[0],ot=Object.entries(P.outputs[et].legend),!((Bt=De.map(function(yn){return ot.map(function(_n,Dn){var Nn;return Nn={},q()(Nn,_n[0],yn[Dn]),q()(Nn,"label",_n[0]),q()(Nn,"confidence",yn[Dn]),Nn}).sort(function(_n,Dn){return Dn.confidence-_n.confidence})})).length<2)){Vt.next=13;break}return Vt.abrupt("return",Bt[0]);case 13:return Vt.abrupt("return",Bt);case 14:return Vt.abrupt("return",De);case 15:case"end":return Vt.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"saveData",value:function(M){this.neuralNetworkData.saveData(M)}},{key:"loadData",value:function(){var M=G()(ge.a.mark(function T(){var A,P,J=arguments;return ge.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:A=J.length>0&&J[0]!==void 0?J[0]:null,P=J.length>1?J[1]:void 0,this.neuralNetworkData.loadData(A,P);case 3:case"end":return ie.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"save",value:function(M,T){var A,P,J=this;typeof M=="function"?(A="model",P=M):typeof M=="string"?(A=M,typeof T=="function"&&(P=T)):A="model",this.neuralNetwork.save(A,function(){J.neuralNetworkData.saveMeta(A,P)})}},{key:"load",value:function(){var M=G()(ge.a.mark(function T(){var A,P,J,ie=this,pe=arguments;return ge.a.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:A=pe.length>0&&pe[0]!==void 0?pe[0]:null,(P=pe.length>1?pe[1]:void 0)&&(J=P),this.neuralNetwork.load(A,function(){return ie.neuralNetworkData.loadMeta(A,J),ie.neuralNetwork.model});case 4:case"end":return Ae.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"dispose",value:function(){this.neuralNetwork.dispose()}},{key:"mutate",value:function(M,T){this.neuralNetwork.mutate(M,T)}},{key:"crossover",value:function(M){var T=this.copy();return T.neuralNetwork.crossover(M.neuralNetwork),T}}]),$}(),em=function($,M,T){var A,P;return $ instanceof Object?(A=$,P=M):(A={inputs:$,outputs:M},P=T),new Zp(A,P)},vn=r(3);function ou($,M,T){if(T===void 0&&(T=!1),$.beginPath(),M.slice(1).forEach(function(J,ie){var pe=J.x,Ae=J.y,Ie=M[ie];$.moveTo(Ie.x,Ie.y),$.lineTo(pe,Ae)}),T){var A=M[M.length-1],P=M[0];if(!A||!P)return;$.moveTo(A.x,A.y),$.lineTo(P.x,P.y)}$.stroke()}var tr=r(5),Ls=function(){function $(M,T){if(!hc(M)||!hc(T))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:M,height:T}));this._width=M,this._height=T}return Object.defineProperty($.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),$.prototype.reverse=function(){return new $(1/this.width,1/this.height)},$}();function mo($,M){return $ instanceof vn.Tensor&&$.shape.length===M}function _f($){return mo($,1)}function Sd($){return mo($,2)}function mr($){return mo($,3)}function ts($){return mo($,4)}function Ta($){return $%1!=0}function no($){return $%2==0}function Hu($,M){M===void 0&&(M=2);var T=Math.pow(10,M);return Math.floor($*T)/T}function Nc($){return $&&$.width&&$.height}function au($,M){var T=$.width,A=$.height,P=M/Math.max(A,T);return new Ls(Math.round(T*P),Math.round(A*P))}function Ic($){return $.reduce(function(M,T){return M.add(T)},new vo(0,0)).div(new vo($.length,$.length))}function na($,M,T){return Array($).fill(0).map(function(A,P){return M+P*T})}function hc($){return!!$&&$!==1/0&&$!==-1/0&&!isNaN($)||$===0}function su($){return hc($)&&0<=$&&$<=1}var vo=function(){function $(M,T){this._x=M,this._y=T}return Object.defineProperty($.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),$.prototype.add=function(M){return new $(this.x+M.x,this.y+M.y)},$.prototype.sub=function(M){return new $(this.x-M.x,this.y-M.y)},$.prototype.mul=function(M){return new $(this.x*M.x,this.y*M.y)},$.prototype.div=function(M){return new $(this.x/M.x,this.y/M.y)},$.prototype.abs=function(){return new $(Math.abs(this.x),Math.abs(this.y))},$.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},$.prototype.floor=function(){return new $(Math.floor(this.x),Math.floor(this.y))},$}(),ws=function(){function $(M,T){T===void 0&&(T=!0);var A=M||{},P=[A.left,A.top,A.right,A.bottom].every(hc),J=[A.x,A.y,A.width,A.height].every(hc);if(!J&&!P)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(A));var ie=J?[A.x,A.y,A.width,A.height]:[A.left,A.top,A.right-A.left,A.bottom-A.top],pe=ie[0],Ae=ie[1],Ie=ie[2],De=ie[3];$.assertIsValidBox({x:pe,y:Ae,width:Ie,height:De},"Box.constructor",T),this._x=pe,this._y=Ae,this._width=Ie,this._height=De}return $.isRect=function(M){return!!M&&[M.x,M.y,M.width,M.height].every(hc)},$.assertIsValidBox=function(M,T,A){if(A===void 0&&(A=!1),!$.isRect(M))throw new Error(T+" - invalid box: "+JSON.stringify(M)+", expected object with properties x, y, width, height");if(!A&&(M.width<0||M.height<0))throw new Error(T+" - width ("+M.width+") and height ("+M.height+") must be positive numbers")},Object.defineProperty($.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"topLeft",{get:function(){return new vo(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"topRight",{get:function(){return new vo(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"bottomLeft",{get:function(){return new vo(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"bottomRight",{get:function(){return new vo(this.right,this.bottom)},enumerable:!0,configurable:!0}),$.prototype.round=function(){var M=[this.x,this.y,this.width,this.height].map(function(T){return Math.round(T)});return new $({x:M[0],y:M[1],width:M[2],height:M[3]})},$.prototype.floor=function(){var M=[this.x,this.y,this.width,this.height].map(function(T){return Math.floor(T)});return new $({x:M[0],y:M[1],width:M[2],height:M[3]})},$.prototype.toSquare=function(){var M=this.x,T=this.y,A=this.width,P=this.height,J=Math.abs(A-P);return A<P&&(M-=J/2,A+=J),P<A&&(T-=J/2,P+=J),new $({x:M,y:T,width:A,height:P})},$.prototype.rescale=function(M){var T=Nc(M)?M.width:M,A=Nc(M)?M.height:M;return new $({x:this.x*T,y:this.y*A,width:this.width*T,height:this.height*A})},$.prototype.pad=function(M,T){var A=[this.x-M/2,this.y-T/2,this.width+M,this.height+T];return new $({x:A[0],y:A[1],width:A[2],height:A[3]})},$.prototype.clipAtImageBorders=function(M,T){var A=this.x,P=this.y,J=this.right,ie=this.bottom,pe=Math.max(A,0),Ae=Math.max(P,0),Ie=J-pe,De=ie-Ae;return new $({x:pe,y:Ae,width:Math.min(Ie,M-pe),height:Math.min(De,T-Ae)}).floor()},$.prototype.shift=function(M,T){var A=this.width,P=this.height;return new $({x:this.x+M,y:this.y+T,width:A,height:P})},$.prototype.padAtBorders=function(M,T){var A=this.width+1,P=this.height+1,J=A,ie=P,pe=this.left,Ae=this.top,Ie=this.right,De=this.bottom;return Ie>T&&(J=-Ie+T+A,Ie=T),De>M&&(ie=-De+M+P,De=M),pe<1&&(ie=2-pe,pe=1),Ae<1&&(ie=2-Ae,Ae=1),{dy:1,edy:ie,dx:1,edx:J,y:Ae,ey:De,x:pe,ex:Ie,w:A,h:P}},$.prototype.calibrate=function(M){return new $({left:this.left+M.left*this.width,top:this.top+M.top*this.height,right:this.right+M.right*this.width,bottom:this.bottom+M.bottom*this.height}).toSquare().round()},$}(),Ba=function($){function M(T,A,P,J,ie){return ie===void 0&&(ie=!1),$.call(this,{left:T,top:A,right:P,bottom:J},ie)||this}return Object(tr.c)(M,$),M}(ws),_s=function(){function $(M,T,A,P,J){this._imageDims=new Ls(J.width,J.height),this._score=M,this._classScore=T,this._className=A,this._box=new ws(P).rescale(this._imageDims)}return Object.defineProperty($.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"relativeBox",{get:function(){return new ws(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),$.prototype.forSize=function(M,T){return new $(this.score,this.classScore,this.className,this.relativeBox,{width:M,height:T})},$}(),ra=function($){function M(T,A,P){return $.call(this,T,T,"",A,P)||this}return Object(tr.c)(M,$),M.prototype.forSize=function(T,A){var P=$.prototype.forSize.call(this,T,A);return new M(P.score,P.relativeBox,P.imageDims)},M}(_s);function uu($,M,T){T===void 0&&(T=!0);var A=Math.max(0,Math.min($.right,M.right)-Math.max($.left,M.left))*Math.max(0,Math.min($.bottom,M.bottom)-Math.max($.top,M.top));return T?A/($.area+M.area-A):A/Math.min($.area,M.area)}function Gu($){var M=$.map(function(pe){return pe.x}),T=$.map(function(pe){return pe.y}),A=M.reduce(function(pe,Ae){return Ae<pe?Ae:pe},1/0),P=T.reduce(function(pe,Ae){return Ae<pe?Ae:pe},1/0),J=M.reduce(function(pe,Ae){return pe<Ae?Ae:pe},0),ie=T.reduce(function(pe,Ae){return pe<Ae?Ae:pe},0);return new Ba(A,P,J,ie)}function pc($,M,T,A){A===void 0&&(A=!0);for(var P=M.map(function(pe,Ae){return{score:pe,boxIndex:Ae}}).sort(function(pe,Ae){return pe.score-Ae.score}).map(function(pe){return pe.boxIndex}),J=[],ie=function(){var pe=P.pop();J.push(pe);for(var Ae=P,Ie=[],De=0;De<Ae.length;De++){var et=Ae[De],ot=$[pe],Bt=$[et];Ie.push(uu(ot,Bt,A))}P=P.filter(function(Vt,yn){return Ie[yn]<=T})};P.length>0;)ie();return J}function Fc($,M){return vn.tidy(function(){var T=M[0],A=M[1],P=M[2],J=vn.fill(Object(tr.e)($.shape.slice(0,3),[1]),T),ie=vn.fill(Object(tr.e)($.shape.slice(0,3),[1]),A),pe=vn.fill(Object(tr.e)($.shape.slice(0,3),[1]),P),Ae=vn.concat([J,ie,pe],3);return vn.sub($,Ae)})}function qu($,M){return M===void 0&&(M=!1),vn.tidy(function(){var T=$.shape.slice(1),A=T[0],P=T[1];if(A===P)return $;var J=Math.abs(A-P),ie=Math.round(J*(M?.5:1)),pe=A>P?2:1,Ae=function(ot){var Bt=$.shape.slice();return Bt[pe]=ot,vn.fill(Bt,0)},Ie=Ae(ie),De=J-Ie.shape[pe],et=[M&&De?Ae(De):null,$,Ie].filter(function(ot){return!!ot}).map(function(ot){return ot.toFloat()});return vn.concat(et,pe)})}function Nl($){for(var M=$.slice(),T=M.length-1;T>0;T--){var A=Math.floor(Math.random()*(T+1)),P=M[T];M[T]=M[A],M[A]=P}return M}function Il($){return 1/(1+Math.exp(-$))}function jh($){return Math.log($/(1-$))}var Fl=function($){function M(T,A,P,J,ie){return ie===void 0&&(ie=!1),$.call(this,{x:T,y:A,width:P,height:J},ie)||this}return Object(tr.c)(M,$),M}(ws),cu=function(){function $(M,T,A){A===void 0&&(A=new vo(0,0));var P=T.width,J=T.height;this._imgDims=new Ls(P,J),this._shift=A,this._positions=M.map(function(ie){return ie.mul(new vo(P,J)).add(A)})}return Object.defineProperty($.prototype,"shift",{get:function(){return new vo(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"relativePositions",{get:function(){var M=this;return this._positions.map(function(T){return T.sub(M._shift).div(new vo(M.imageWidth,M.imageHeight))})},enumerable:!0,configurable:!0}),$.prototype.forSize=function(M,T){return new this.constructor(this.relativePositions,{width:M,height:T})},$.prototype.shiftBy=function(M,T){return new this.constructor(this.relativePositions,this._imgDims,new vo(M,T))},$.prototype.shiftByPoint=function(M){return this.shiftBy(M.x,M.y)},$.prototype.align=function(M,T){if(T===void 0&&(T={}),M){var A=M instanceof ra?M.box.floor():new ws(M);return this.shiftBy(A.x,A.y).align(null,T)}var P=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},T),J=P.useDlibAlignment,ie=P.minBoxPadding;return J?this.alignDlib():this.alignMinBbox(ie)},$.prototype.alignDlib=function(){var M=this.getRefPointsForAlignment(),T=M[0],A=M[1],P=M[2],J=function(et){return P.sub(et).magnitude()},ie=(J(T)+J(A))/2,pe=Math.floor(ie/.45),Ae=Ic(M),Ie=Math.floor(Math.max(0,Ae.x-.5*pe)),De=Math.floor(Math.max(0,Ae.y-.43*pe));return new Fl(Ie,De,Math.min(pe,this.imageWidth+Ie),Math.min(pe,this.imageHeight+De))},$.prototype.alignMinBbox=function(M){var T=Gu(this.positions);return T.pad(T.width*M,T.height*M)},$.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},$}(),$u=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.getRefPointsForAlignment=function(){var T=this.positions;return[T[0],T[1],Ic([T[3],T[4]])]},M}(cu),Xu=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.getJawOutline=function(){return this.positions.slice(0,17)},M.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},M.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},M.prototype.getNose=function(){return this.positions.slice(27,36)},M.prototype.getLeftEye=function(){return this.positions.slice(36,42)},M.prototype.getRightEye=function(){return this.positions.slice(42,48)},M.prototype.getMouth=function(){return this.positions.slice(48,68)},M.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Ic)},M}(cu),_u=function(){function $(M,T){this._label=M,this._distance=T}return Object.defineProperty($.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),$.prototype.toString=function(M){return M===void 0&&(M=!0),this.label+(M?" ("+Hu(this.distance)+")":"")},$}(),zh=function($){function M(T,A){var P=$.call(this,T)||this;return P._label=A,P}return Object(tr.c)(M,$),M.assertIsValidLabeledBox=function(T,A){if(ws.assertIsValidBox(T,A),!hc(T.label))throw new Error(A+" - expected property label ("+T.label+") to be a number")},Object.defineProperty(M.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),M}(ws),kd=function(){function $(M,T){if(typeof M!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(T)||T.some(function(A){return!(A instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=M,this._descriptors=T}return Object.defineProperty($.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),$.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(M){return Array.from(M)})}},$.fromJSON=function(M){var T=M.descriptors.map(function(A){return new Float32Array(A)});return new $(M.label,T)},$}(),Cd=function($){function M(T,A,P,J){var ie=$.call(this,T,A)||this;return ie._score=P,ie._classScore=J,ie}return Object(tr.c)(M,$),M.assertIsValidPredictedBox=function(T,A){if(zh.assertIsValidLabeledBox(T,A),!su(T.score)||!su(T.classScore))throw new Error(A+" - expected properties score ("+T.score+") and ("+T.classScore+") to be a number between [0, 1]")},Object.defineProperty(M.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),M}(zh);function Ef($){return $.detection instanceof ra}function Ad($,M){var T={detection:M};return Object.assign({},$,T)}function ae(){var $=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:$,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}var ne=r(131),D=r(178);function H(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}var ue,je=r(177);function Je($){ue=$}function vt(){H()&&Je(ae()),Object(je.a)()&&Je(Object(D.a)())}var Gt,on={getEnv:function(){if(!ue)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return ue},setEnv:Je,initialize:vt,createBrowserEnv:ae,createFileSystem:ne.a,createNodejsEnv:D.a,monkeyPatch:function($){if(ue||vt(),!ue)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var M=$.Canvas,T=M===void 0?ue.Canvas:M,A=$.Image,P=A===void 0?ue.Image:A;ue.Canvas=T,ue.Image=P,ue.createCanvasElement=$.createCanvasElement||function(){return new T},ue.createImageElement=$.createImageElement||function(){return new P},ue.ImageData=$.ImageData||ue.ImageData,ue.Video=$.Video||ue.Video,ue.fetch=$.fetch||ue.fetch,ue.readFile=$.readFile||ue.readFile},isBrowser:H,isNodejs:je.a};function dt($){return on.isNodejs()||typeof $!="string"?$:document.getElementById($)}function Mn($){var M=on.getEnv(),T=M.Canvas;if($ instanceof M.CanvasRenderingContext2D)return $;var A=dt($);if(!(A instanceof T))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var P=A.getContext("2d");if(!P)throw new Error("resolveContext2d - canvas 2d context is null");return P}vt(),function($){$.TOP_LEFT="TOP_LEFT",$.TOP_RIGHT="TOP_RIGHT",$.BOTTOM_LEFT="BOTTOM_LEFT",$.BOTTOM_RIGHT="BOTTOM_RIGHT"}(Gt||(Gt={}));var zn=function(){return function($){$===void 0&&($={});var M=$.anchorPosition,T=$.backgroundColor,A=$.fontColor,P=$.fontSize,J=$.fontStyle,ie=$.padding;this.anchorPosition=M||Gt.TOP_LEFT,this.backgroundColor=T||"rgba(0, 0, 0, 0.5)",this.fontColor=A||"rgba(255, 255, 255, 1)",this.fontSize=P||14,this.fontStyle=J||"Georgia",this.padding=ie||4}}(),Hn=function(){function $(M,T,A){A===void 0&&(A={}),this.text=typeof M=="string"?[M]:M instanceof $?M.text:M,this.anchor=T,this.options=new zn(A)}return $.prototype.measureWidth=function(M){var T=this.options.padding;return this.text.map(function(A){return M.measureText(A).width}).reduce(function(A,P){return A<P?P:A},0)+2*T},$.prototype.measureHeight=function(){var M=this.options,T=M.fontSize,A=M.padding;return this.text.length*T+2*A},$.prototype.getUpperLeft=function(M,T){var A=this.options.anchorPosition,P=A===Gt.BOTTOM_RIGHT||A===Gt.TOP_RIGHT,J=A===Gt.BOTTOM_LEFT||A===Gt.BOTTOM_RIGHT,ie=this.measureWidth(M),pe=this.measureHeight(),Ae=P?this.anchor.x-ie:this.anchor.x,Ie=J?this.anchor.y-pe:this.anchor.y;if(T){var De=T.width,et=T.height;return{x:Math.max(Math.min(Ae,De-ie),0),y:Math.max(Math.min(Ie,et-pe),0)}}return{x:Ae,y:Ie}},$.prototype.draw=function(M){var T=dt(M),A=Mn(T),P=this.options,J=P.backgroundColor,ie=P.fontColor,pe=P.fontSize,Ae=P.fontStyle,Ie=P.padding;A.font=pe+"px "+Ae;var De=this.measureWidth(A),et=this.measureHeight();A.fillStyle=J;var ot=this.getUpperLeft(A,T);A.fillRect(ot.x,ot.y,De,et),A.fillStyle=ie,this.text.forEach(function(Bt,Vt){var yn=Ie+ot.x,_n=Ie+ot.y+(Vt+1)*pe;A.fillText(Bt,yn,_n)})},$}(),nr=function(){return function($){$===void 0&&($={});var M=$.boxColor,T=$.lineWidth,A=$.label,P=$.drawLabelOptions;this.boxColor=M||"rgba(0, 0, 255, 1)",this.lineWidth=T||2,this.label=A;var J={anchorPosition:Gt.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new zn(Object.assign({},J,P))}}(),Yn=function(){function $(M,T){T===void 0&&(T={}),this.box=new ws(M),this.options=new nr(T)}return $.prototype.draw=function(M){var T=Mn(M),A=this.options,P=A.boxColor,J=A.lineWidth,ie=this.box,pe=ie.x,Ae=ie.y,Ie=ie.width,De=ie.height;T.strokeStyle=P,T.lineWidth=J,T.strokeRect(pe,Ae,Ie,De);var et=this.options.label;et&&new Hn([et],{x:pe-J/2,y:Ae},this.options.drawLabelOptions).draw(M)},$}();function dr($,M){(Array.isArray(M)?M:[M]).forEach(function(T){var A=T instanceof ra?T.score:Ef(T)?T.detection.score:void 0,P=T instanceof ra?T.box:Ef(T)?T.detection.box:new ws(T),J=A?""+Hu(A):void 0;new Yn(P,{label:J}).draw($)})}function gr($){var M=on.getEnv(),T=M.Image,A=M.Video;return $ instanceof T&&$.complete||$ instanceof A&&$.readyState>=3}function Ar($){return new Promise(function(M,T){if($ instanceof on.getEnv().Canvas||gr($))return M();function A(J){J.currentTarget&&(J.currentTarget.removeEventListener("load",A),J.currentTarget.removeEventListener("error",P),M(J))}function P(J){J.currentTarget&&(J.currentTarget.removeEventListener("load",A),J.currentTarget.removeEventListener("error",P),T(J))}$.addEventListener("load",A),$.addEventListener("error",P)})}function Gr($){return new Promise(function(M,T){if(!($ instanceof Blob))return T("bufferToImage - expected buf to be of type: Blob");var A=new FileReader;A.onload=function(){if(typeof A.result!="string")return T("bufferToImage - expected reader.result to be a string, in onload");var P=on.getEnv().createImageElement();P.onload=function(){return M(P)},P.onerror=T,P.src=A.result},A.onerror=T,A.readAsDataURL($)})}function ii($){var M=on.getEnv(),T=M.Image,A=M.Video;return $ instanceof T?new Ls($.naturalWidth,$.naturalHeight):$ instanceof A?new Ls($.videoWidth,$.videoHeight):new Ls($.width,$.height)}function Ir($){var M=$.width,T=$.height,A=(0,on.getEnv().createCanvasElement)();return A.width=M,A.height=T,A}function ai($,M){var T=on.getEnv().ImageData;if(!($ instanceof T||gr($)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var A=M||ii($),P=A.width,J=A.height,ie=Ir({width:P,height:J});return $ instanceof T?Mn(ie).putImageData($,0,0):Mn(ie).drawImage($,0,0,P,J),ie}function ni($,M){return Object(tr.b)(this,void 0,void 0,function(){var T,A,P,J,ie,pe;return Object(tr.d)(this,function(Ae){switch(Ae.label){case 0:return T=M||on.getEnv().createCanvasElement(),A=$.shape.slice(ts($)?1:0),P=A[0],J=A[1],ie=A[2],pe=vn.tidy(function(){return $.as3D(P,J,ie).toInt()}),[4,vn.browser.toPixels(pe,T)];case 1:return Ae.sent(),pe.dispose(),[2,T]}})})}function bi($){var M=on.getEnv(),T=M.Image,A=M.Canvas,P=M.Video;return $ instanceof T||$ instanceof A||$ instanceof P}function _i($,M,T){T===void 0&&(T=!1);var A=on.getEnv(),P=A.Image,J=A.Canvas;if(!($ instanceof P||$ instanceof J))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var ie=ii($),pe=M/Math.max(ie.height,ie.width),Ae=pe*ie.width,Ie=pe*ie.height,De=Ir({width:M,height:M}),et=$ instanceof J?$:ai($),ot=Math.abs(Ae-Ie)/2,Bt=T&&Ae<Ie?ot:0,Vt=T&&Ie<Ae?ot:0;return Mn(De).drawImage(et,Bt,Vt,Ae,Ie),De}var oi=function(){function $(M,T){var A=this;if(T===void 0&&(T=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(M))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+M);this._treatAsBatchInput=T,this._batchSize=M.length,M.forEach(function(P,J){if(mr(P))return A._imageTensors[J]=P,void(A._inputDimensions[J]=P.shape);if(ts(P)){var ie=P.shape[0];if(ie!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+ie+" passed, but not supported in input array");return A._imageTensors[J]=P,void(A._inputDimensions[J]=P.shape.slice(1))}var pe=P instanceof on.getEnv().Canvas?P:ai(P);A._canvases[J]=pe,A._inputDimensions[J]=[pe.height,pe.width,3]})}return Object.defineProperty($.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"reshapedInputDimensions",{get:function(){var M=this;return na(this.batchSize,0,1).map(function(T,A){return M.getReshapedInputDimensions(A)})},enumerable:!0,configurable:!0}),$.prototype.getInput=function(M){return this.canvases[M]||this.imageTensors[M]},$.prototype.getInputDimensions=function(M){return this._inputDimensions[M]},$.prototype.getInputHeight=function(M){return this._inputDimensions[M][0]},$.prototype.getInputWidth=function(M){return this._inputDimensions[M][1]},$.prototype.getReshapedInputDimensions=function(M){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return au({width:this.getInputWidth(M),height:this.getInputHeight(M)},this.inputSize)},$.prototype.toBatchTensor=function(M,T){var A=this;return T===void 0&&(T=!0),this._inputSize=M,vn.tidy(function(){var P=na(A.batchSize,0,1).map(function(J){var ie=A.getInput(J);if(ie instanceof vn.Tensor){var pe=ts(ie)?ie:ie.expandDims();return(pe=qu(pe,T)).shape[1]===M&&pe.shape[2]===M||(pe=vn.image.resizeBilinear(pe,[M,M])),pe.as3D(M,M,3)}if(ie instanceof on.getEnv().Canvas)return vn.browser.fromPixels(_i(ie,M,T));throw new Error("toBatchTensor - at batchIdx "+J+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+ie)});return vn.stack(P.map(function(J){return J.toFloat()})).as4D(A.batchSize,M,M,3)})},$}();function pi($){return Object(tr.b)(this,void 0,void 0,function(){var M,T,A;return Object(tr.d)(this,function(P){switch(P.label){case 0:if($ instanceof oi)return[2,$];if(!(M=Array.isArray($)?$:[$]).length)throw new Error("toNetInput - empty array passed as input");return T=function(J){return Array.isArray($)?" at input index "+J+":":""},(A=M.map(dt)).forEach(function(J,ie){if(!bi(J)&&!mr(J)&&!ts(J))throw typeof M[ie]=="string"?new Error("toNetInput -"+T(ie)+" string passed, but could not resolve HTMLElement for element id "+M[ie]):new Error("toNetInput -"+T(ie)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(ts(J)){var pe=J.shape[0];if(pe!==1)throw new Error("toNetInput -"+T(ie)+" tf.Tensor4D with batchSize "+pe+" passed, but not supported in input array")}}),[4,Promise.all(A.map(function(J){return bi(J)&&Ar(J)}))];case 1:return P.sent(),[2,new oi(A,Array.isArray($))]}})})}function fo($,M){return Object(tr.b)(this,void 0,void 0,function(){var T,A,P,J,ie,pe;return Object(tr.d)(this,function(Ae){switch(Ae.label){case 0:return T=on.getEnv().Canvas,A=$,$ instanceof T?[3,5]:[4,pi($)];case 1:if((P=Ae.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(J=P.getInput(0))instanceof T?(ie=J,[3,4]):[3,2];case 2:return[4,ni(J)];case 3:ie=Ae.sent(),Ae.label=4;case 4:A=ie,Ae.label=5;case 5:return pe=Mn(A),[2,M.map(function(Ie){return Ie instanceof ra?Ie.forSize(A.width,A.height).box.floor():Ie}).map(function(Ie){return Ie.clipAtImageBorders(A.width,A.height)}).map(function(Ie){var De=Ie.x,et=Ie.y,ot=Ie.width,Bt=Ie.height,Vt=Ir({width:ot,height:Bt});return Mn(Vt).putImageData(pe.getImageData(De,et,ot,Bt),0,0),Vt})]}})})}function lo($,M){return Object(tr.b)(this,void 0,void 0,function(){return Object(tr.d)(this,function(T){if(!mr($)&&!ts($))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(ts($)&&$.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,vn.tidy(function(){var A=$.shape.slice(ts($)?1:0),P=A[0],J=A[1],ie=A[2];return M.map(function(pe){return pe instanceof ra?pe.forSize(J,P).box:pe}).map(function(pe){return pe.clipAtImageBorders(J,P)}).map(function(pe){var Ae=pe.x,Ie=pe.y,De=pe.width,et=pe.height;return vn.slice3d($.as3D(P,J,ie),[Ie,Ae,0],[et,De,ie])})})]})})}function qo($,M){return Object(tr.b)(this,void 0,void 0,function(){var T;return Object(tr.d)(this,function(A){switch(A.label){case 0:return[4,(0,on.getEnv().fetch)($,M)];case 1:if(!((T=A.sent()).status<400))throw new Error("failed to fetch: ("+T.status+") "+T.statusText+", from url: "+T.url);return[2,T]}})})}function $i($){return Object(tr.b)(this,void 0,void 0,function(){var M,T;return Object(tr.d)(this,function(A){switch(A.label){case 0:return[4,qo($)];case 1:return[4,(M=A.sent()).blob()];case 2:if(!(T=A.sent()).type.startsWith("image/"))throw new Error("fetchImage - expected blob type to be of type image/*, instead have: "+T.type+", for url: "+M.url);return[2,Gr(T)]}})})}function ho($){return Object(tr.b)(this,void 0,void 0,function(){return Object(tr.d)(this,function(M){switch(M.label){case 0:return[4,qo($)];case 1:return[2,M.sent().json()]}})})}function fa($){return Object(tr.b)(this,void 0,void 0,function(){var M;return Object(tr.d)(this,function(T){switch(T.label){case 0:return M=Float32Array.bind,[4,qo($)];case 1:return[4,T.sent().arrayBuffer()];case 2:return[2,new(M.apply(Float32Array,[void 0,T.sent()]))]}})})}function Wo($,M){var T=M+"-weights_manifest.json";if(!$)return{modelBaseUri:"",manifestUri:T};if($==="/")return{modelBaseUri:"/",manifestUri:"/"+T};var A=$.startsWith("http://")?"http://":$.startsWith("https://")?"https://":"",P=($=$.replace(A,"")).split("/").filter(function(pe){return pe}),J=$.endsWith(".json")?P[P.length-1]:T,ie=A+($.endsWith(".json")?P.slice(0,P.length-1):P).join("/");return{modelBaseUri:ie=$.startsWith("/")?"/"+ie:ie,manifestUri:ie==="/"?"/"+J:ie+"/"+J}}function ia($,M){return Object(tr.b)(this,void 0,void 0,function(){var T,A,P,J;return Object(tr.d)(this,function(ie){switch(ie.label){case 0:return T=Wo($,M),A=T.manifestUri,P=T.modelBaseUri,[4,ho(A)];case 1:return J=ie.sent(),[2,vn.io.loadWeights(J,P)]}})})}function Vi($,M,T){T===void 0&&(T=!1);var A=T?ii(M):M,P=A.width,J=A.height;return $.width=P,$.height=J,{width:P,height:J}}var Ui=function(){function $(M){this._name=M,this._params=void 0,this._paramMappings=[]}return Object.defineProperty($.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),$.prototype.getParamFromPath=function(M){var T=this.traversePropertyPath(M);return T.obj[T.objProp]},$.prototype.reassignParamFromPath=function(M,T){var A=this.traversePropertyPath(M),P=A.obj,J=A.objProp;P[J].dispose(),P[J]=T},$.prototype.getParamList=function(){var M=this;return this._paramMappings.map(function(T){var A=T.paramPath;return{path:A,tensor:M.getParamFromPath(A)}})},$.prototype.getTrainableParams=function(){return this.getParamList().filter(function(M){return M.tensor instanceof vn.Variable})},$.prototype.getFrozenParams=function(){return this.getParamList().filter(function(M){return!(M.tensor instanceof vn.Variable)})},$.prototype.variable=function(){var M=this;this.getFrozenParams().forEach(function(T){var A=T.path,P=T.tensor;M.reassignParamFromPath(A,P.variable())})},$.prototype.freeze=function(){var M=this;this.getTrainableParams().forEach(function(T){var A=T.path,P=T.tensor,J=vn.tensor(P.dataSync());P.dispose(),M.reassignParamFromPath(A,J)})},$.prototype.dispose=function(M){M===void 0&&(M=!0),this.getParamList().forEach(function(T){if(M&&T.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+T.path);T.tensor.dispose()}),this._params=void 0},$.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(M){var T=M.tensor;return Array.from(T.dataSync())}).reduce(function(M,T){return M.concat(T)}))},$.prototype.load=function(M){return Object(tr.b)(this,void 0,void 0,function(){return Object(tr.d)(this,function(T){switch(T.label){case 0:return M instanceof Float32Array?(this.extractWeights(M),[2]):[4,this.loadFromUri(M)];case 1:return T.sent(),[2]}})})},$.prototype.loadFromUri=function(M){return Object(tr.b)(this,void 0,void 0,function(){var T;return Object(tr.d)(this,function(A){switch(A.label){case 0:if(M&&typeof M!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,ia(M,this.getDefaultModelName())];case 1:return T=A.sent(),this.loadFromWeightMap(T),[2]}})})},$.prototype.loadFromDisk=function(M){return Object(tr.b)(this,void 0,void 0,function(){var T,A,P,J,ie,pe,Ae,Ie,De,et;return Object(tr.d)(this,function(ot){switch(ot.label){case 0:if(M&&typeof M!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return T=on.getEnv().readFile,A=Wo(M,this.getDefaultModelName()),P=A.manifestUri,J=A.modelBaseUri,ie=function(Bt){return Promise.all(Bt.map(function(Vt){return T(Vt).then(function(yn){return yn.buffer})}))},pe=vn.io.weightsLoaderFactory(ie),De=(Ie=JSON).parse,[4,T(P)];case 1:return Ae=De.apply(Ie,[ot.sent().toString()]),[4,pe(Ae,J)];case 2:return et=ot.sent(),this.loadFromWeightMap(et),[2]}})})},$.prototype.loadFromWeightMap=function(M){var T=this.extractParamsFromWeigthMap(M),A=T.paramMappings,P=T.params;this._paramMappings=A,this._params=P},$.prototype.extractWeights=function(M){var T=this.extractParams(M),A=T.paramMappings,P=T.params;this._paramMappings=A,this._params=P},$.prototype.traversePropertyPath=function(M){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var T=M.split("/").reduce(function(J,ie){if(!J.nextObj.hasOwnProperty(ie))throw new Error("traversePropertyPath - object does not have property "+ie+", for path "+M);return{obj:J.nextObj,objProp:ie,nextObj:J.nextObj[ie]}},{nextObj:this.params}),A=T.obj,P=T.objProp;if(!(A&&P&&A[P]instanceof vn.Tensor))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+M);return{obj:A,objProp:P}},$}();function So($,M,T){return vn.tidy(function(){var A=vn.separableConv2d($,M.depthwise_filter,M.pointwise_filter,T,"same");return A=vn.add(A,M.bias)})}function ya($,M,T){return T===void 0&&(T=!1),vn.tidy(function(){var A=vn.relu(T?vn.add(vn.conv2d($,M.conv0.filters,[2,2],"same"),M.conv0.bias):So($,M.conv0,[2,2])),P=So(A,M.conv1,[1,1]),J=So(vn.relu(vn.add(A,P)),M.conv2,[1,1]);return vn.relu(vn.add(A,vn.add(P,J)))})}function wa($,M,T,A){return T===void 0&&(T=!1),A===void 0&&(A=!0),vn.tidy(function(){var P=vn.relu(T?vn.add(vn.conv2d($,M.conv0.filters,A?[2,2]:[1,1],"same"),M.conv0.bias):So($,M.conv0,A?[2,2]:[1,1])),J=So(P,M.conv1,[1,1]),ie=So(vn.relu(vn.add(P,J)),M.conv2,[1,1]),pe=So(vn.relu(vn.add(P,vn.add(J,ie))),M.conv3,[1,1]);return vn.relu(vn.add(P,vn.add(J,vn.add(ie,pe))))})}function ha($,M,T,A){return T===void 0&&(T="same"),A===void 0&&(A=!1),vn.tidy(function(){var P=vn.add(vn.conv2d($,M.filters,[1,1],T),M.bias);return A?vn.relu(P):P})}function oa($,M){Object.keys($).forEach(function(T){M.some(function(A){return A.originalPath===T})||$[T].dispose()})}function ls($,M){return function(T,A,P,J){var ie=vn.tensor4d($(T*A*P*P),[P,P,T,A]),pe=vn.tensor1d($(A));return M.push({paramPath:J+"/filters"},{paramPath:J+"/bias"}),{filters:ie,bias:pe}}}function _a($,M){return function(T,A,P){var J=vn.tensor2d($(T*A),[T,A]),ie=vn.tensor1d($(A));return M.push({paramPath:P+"/weights"},{paramPath:P+"/bias"}),{weights:J,bias:ie}}}var ko=function(){return function($,M,T){this.depthwise_filter=$,this.pointwise_filter=M,this.bias=T}}();function Ma($,M){return function(T,A,P){var J=vn.tensor4d($(9*T),[3,3,T,1]),ie=vn.tensor4d($(T*A),[1,1,T,A]),pe=vn.tensor1d($(A));return M.push({paramPath:P+"/depthwise_filter"},{paramPath:P+"/pointwise_filter"},{paramPath:P+"/bias"}),new ko(J,ie,pe)}}function Ku($){return function(M){var T=$(M+"/depthwise_filter",4),A=$(M+"/pointwise_filter",4),P=$(M+"/bias",1);return new ko(T,A,P)}}function Es($,M){return function(T,A,P){var J=$[T];if(!mo(J,A))throw new Error("expected weightMap["+T+"] to be a Tensor"+A+"D, instead have "+J);return M.push({originalPath:T,paramPath:P||T}),J}}function Ha($){var M=$;return{extractWeights:function(T){var A=M.slice(0,T);return M=M.slice(T),A},getRemainingWeights:function(){return M}}}function Bo($,M){var T=ls($,M),A=Ma($,M);function P(J,ie,pe,Ae){return Ae===void 0&&(Ae=!1),{conv0:Ae?T(J,ie,3,pe+"/conv0"):A(J,ie,pe+"/conv0"),conv1:A(ie,ie,pe+"/conv1"),conv2:A(ie,ie,pe+"/conv2")}}return{extractDenseBlock3Params:P,extractDenseBlock4Params:function(J,ie,pe,Ae){Ae===void 0&&(Ae=!1);var Ie=P(J,ie,pe,Ae);return{conv0:Ie.conv0,conv1:Ie.conv1,conv2:Ie.conv2,conv3:A(ie,ie,pe+"/conv3")}}}}function Rc($){return function(M){return{filters:$(M+"/filters",4),bias:$(M+"/bias",1)}}}function lu($,M){var T=Es($,M),A=Rc(T),P=Ku(T);return{extractDenseBlock3Params:function(J,ie){return ie===void 0&&(ie=!1),{conv0:ie?A(J+"/conv0"):P(J+"/conv0"),conv1:P(J+"/conv1"),conv2:P(J+"/conv2")}},extractDenseBlock4Params:function(J,ie){return ie===void 0&&(ie=!1),{conv0:ie?A(J+"/conv0"):P(J+"/conv0"),conv1:P(J+"/conv1"),conv2:P(J+"/conv2"),conv3:P(J+"/conv3")}}}}var $s=function($){function M(){return $.call(this,"FaceFeatureExtractor")||this}return Object(tr.c)(M,$),M.prototype.forwardInput=function(T){var A=this.params;if(!A)throw new Error("FaceFeatureExtractor - load model before inference");return vn.tidy(function(){var P=wa(Fc(T.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(vn.scalar(255)),A.dense0,!0);return P=wa(P=wa(P=wa(P,A.dense1),A.dense2),A.dense3),P=vn.avgPool(P,[7,7],[2,2],"valid")})},M.prototype.forward=function(T){return Object(tr.b)(this,void 0,void 0,function(){var A;return Object(tr.d)(this,function(P){switch(P.label){case 0:return A=this.forwardInput,[4,pi(T)];case 1:return[2,A.apply(this,[P.sent()])]}})})},M.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},M.prototype.extractParamsFromWeigthMap=function(T){return function(A){var P=[],J=lu(A,P).extractDenseBlock4Params,ie={dense0:J("dense0",!0),dense1:J("dense1"),dense2:J("dense2"),dense3:J("dense3")};return oa(A,P),{params:ie,paramMappings:P}}(T)},M.prototype.extractParams=function(T){return function(A){var P=[],J=Ha(A),ie=J.extractWeights,pe=J.getRemainingWeights,Ae=Bo(ie,P).extractDenseBlock4Params,Ie=Ae(3,32,"dense0",!0),De=Ae(32,64,"dense1"),et=Ae(64,128,"dense2"),ot=Ae(128,256,"dense3");if(pe().length!==0)throw new Error("weights remaing after extract: "+pe().length);return{paramMappings:P,params:{dense0:Ie,dense1:De,dense2:et,dense3:ot}}}(T)},M}(Ui);function aa($,M){return vn.tidy(function(){return vn.add(vn.matMul($,M.weights),M.bias)})}function Xs($){var M={},T={};return Object.keys($).forEach(function(A){(A.startsWith("fc")?T:M)[A]=$[A]}),{featureExtractorMap:M,classifierMap:T}}var jo=function($){function M(T,A){var P=$.call(this,T)||this;return P._faceFeatureExtractor=A,P}return Object(tr.c)(M,$),Object.defineProperty(M.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),M.prototype.runNet=function(T){var A=this,P=this.params;if(!P)throw new Error(this._name+" - load model before inference");return vn.tidy(function(){var J=T instanceof oi?A.faceFeatureExtractor.forwardInput(T):T;return aa(J.as2D(J.shape[0],-1),P.fc)})},M.prototype.dispose=function(T){T===void 0&&(T=!0),this.faceFeatureExtractor.dispose(T),$.prototype.dispose.call(this,T)},M.prototype.loadClassifierParams=function(T){var A=this.extractClassifierParams(T),P=A.params,J=A.paramMappings;this._params=P,this._paramMappings=J},M.prototype.extractClassifierParams=function(T){return function(A,P,J){var ie=[],pe=Ha(A),Ae=pe.extractWeights,Ie=pe.getRemainingWeights,De=_a(Ae,ie)(P,J,"fc");if(Ie().length!==0)throw new Error("weights remaing after extract: "+Ie().length);return{paramMappings:ie,params:{fc:De}}}(T,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},M.prototype.extractParamsFromWeigthMap=function(T){var A=Xs(T),P=A.featureExtractorMap,J=A.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(P),function(ie){var pe=[],Ae=Es(ie,pe),Ie={fc:function(De){return{weights:Ae(De+"/weights",2),bias:Ae(De+"/bias",1)}}("fc")};return oa(ie,pe),{params:Ie,paramMappings:pe}}(J)},M.prototype.extractParams=function(T){var A=this.getClassifierChannelsIn(),P=this.getClassifierChannelsOut(),J=P*A+P,ie=T.slice(0,T.length-J),pe=T.slice(T.length-J);return this.faceFeatureExtractor.extractWeights(ie),this.extractClassifierParams(pe)},M}(Ui),Bs=["neutral","happy","sad","angry","fearful","disgusted","surprised"],Ss=function(){function $(M){var T=this;if(M.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+M.length);Bs.forEach(function(A,P){T[A]=M[P]})}return $.prototype.asSortedArray=function(){var M=this;return Bs.map(function(T){return{expression:T,probability:M[T]}}).sort(function(T,A){return A.probability-T.probability})},$}(),go=function($){function M(T){return T===void 0&&(T=new $s),$.call(this,"FaceExpressionNet",T)||this}return Object(tr.c)(M,$),M.prototype.forwardInput=function(T){var A=this;return vn.tidy(function(){return vn.softmax(A.runNet(T))})},M.prototype.forward=function(T){return Object(tr.b)(this,void 0,void 0,function(){var A;return Object(tr.d)(this,function(P){switch(P.label){case 0:return A=this.forwardInput,[4,pi(T)];case 1:return[2,A.apply(this,[P.sent()])]}})})},M.prototype.predictExpressions=function(T){return Object(tr.b)(this,void 0,void 0,function(){var A,P,J,ie,pe=this;return Object(tr.d)(this,function(Ae){switch(Ae.label){case 0:return[4,pi(T)];case 1:return A=Ae.sent(),[4,this.forwardInput(A)];case 2:return P=Ae.sent(),[4,Promise.all(vn.unstack(P).map(function(Ie){return Object(tr.b)(pe,void 0,void 0,function(){var De;return Object(tr.d)(this,function(et){switch(et.label){case 0:return[4,Ie.data()];case 1:return De=et.sent(),Ie.dispose(),[2,De]}})})}))];case 3:return J=Ae.sent(),P.dispose(),ie=J.map(function(Ie){return new Ss(Ie)}),[2,A.isBatchInput?ie:ie[0]]}})})},M.prototype.getDefaultModelName=function(){return"face_expression_model"},M.prototype.getClassifierChannelsIn=function(){return 256},M.prototype.getClassifierChannelsOut=function(){return 7},M}(jo);function js($){return $.expressions instanceof Ss}function ns($,M){var T={expressions:M};return Object.assign({},$,T)}function fu($,M,T,A){T===void 0&&(T=.1),(Array.isArray(M)?M:[M]).forEach(function(P){var J=P instanceof Ss?P:js(P)?P.expressions:void 0;if(!J)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var ie=J.asSortedArray().filter(function(Ae){return Ae.probability>T}),pe=Ef(P)?P.detection.box.bottomLeft:A||new vo(0,0);new Hn(ie.map(function(Ae){return Ae.expression+" ("+Hu(Ae.probability)+")"}),pe).draw($)})}function il($){return Ef($)&&$.landmarks instanceof cu&&$.unshiftedLandmarks instanceof cu&&$.alignedRect instanceof ra}function $o($,M){var T=$.detection.box,A=M.shiftBy(T.x,T.y),P=A.align(),J=$.detection.imageDims,ie={landmarks:A,unshiftedLandmarks:M,alignedRect:new ra($.detection.score,P.rescale(J.reverse()),J)};return Object.assign({},$,ie)}var fs=function(){return function($){$===void 0&&($={});var M=$.drawLines,T=M===void 0||M,A=$.drawPoints,P=A===void 0||A,J=$.lineWidth,ie=$.lineColor,pe=$.pointSize,Ae=$.pointColor;this.drawLines=T,this.drawPoints=P,this.lineWidth=J||1,this.pointSize=pe||2,this.lineColor=ie||"rgba(0, 255, 255, 1)",this.pointColor=Ae||"rgba(255, 0, 255, 1)"}}(),Ga=function(){function $(M,T){T===void 0&&(T={}),this.faceLandmarks=M,this.options=new fs(T)}return $.prototype.draw=function(M){var T=Mn(M),A=this.options,P=A.drawLines,J=A.drawPoints,ie=A.lineWidth,pe=A.lineColor,Ae=A.pointSize,Ie=A.pointColor;P&&this.faceLandmarks instanceof Xu&&(T.strokeStyle=pe,T.lineWidth=ie,ou(T,this.faceLandmarks.getJawOutline()),ou(T,this.faceLandmarks.getLeftEyeBrow()),ou(T,this.faceLandmarks.getRightEyeBrow()),ou(T,this.faceLandmarks.getNose()),ou(T,this.faceLandmarks.getLeftEye(),!0),ou(T,this.faceLandmarks.getRightEye(),!0),ou(T,this.faceLandmarks.getMouth(),!0)),J&&(T.strokeStyle=Ie,T.fillStyle=Ie,this.faceLandmarks.positions.forEach(function(De){T.beginPath(),T.arc(De.x,De.y,Ae,0,2*Math.PI),T.fill()}))},$}();function Pc($,M){(Array.isArray(M)?M:[M]).forEach(function(T){var A=T instanceof cu?T:il(T)?T.landmarks:void 0;if(!A)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new Ga(A).draw($)})}function Rl($,M){var T=[],A=Ha($),P=A.extractWeights,J=A.getRemainingWeights,ie=function(Vt,yn){var _n=ls(Vt,yn),Dn=Ma(Vt,yn);return{extractConvParams:_n,extractSeparableConvParams:Dn,extractReductionBlockParams:function(Nn,Wn,Jn){return{separable_conv0:Dn(Nn,Wn,Jn+"/separable_conv0"),separable_conv1:Dn(Wn,Wn,Jn+"/separable_conv1"),expansion_conv:_n(Nn,Wn,1,Jn+"/expansion_conv")}},extractMainBlockParams:function(Nn,Wn){return{separable_conv0:Dn(Nn,Nn,Wn+"/separable_conv0"),separable_conv1:Dn(Nn,Nn,Wn+"/separable_conv1"),separable_conv2:Dn(Nn,Nn,Wn+"/separable_conv2")}}}}(P,T),pe=ie.extractConvParams,Ae=ie.extractSeparableConvParams,Ie=ie.extractReductionBlockParams,De=ie.extractMainBlockParams,et={conv_in:pe(3,32,3,"entry_flow/conv_in"),reduction_block_0:Ie(32,64,"entry_flow/reduction_block_0"),reduction_block_1:Ie(64,128,"entry_flow/reduction_block_1")},ot={};na(M,0,1).forEach(function(Vt){ot["main_block_"+Vt]=De(128,"middle_flow/main_block_"+Vt)});var Bt={reduction_block:Ie(128,256,"exit_flow/reduction_block"),separable_conv:Ae(256,512,"exit_flow/separable_conv")};if(J().length!==0)throw new Error("weights remaing after extract: "+J().length);return{paramMappings:T,params:{entry_flow:et,middle_flow:ot,exit_flow:Bt}}}function wi($,M){var T=[],A=function(et,ot){var Bt=Es(et,ot),Vt=Rc(Bt),yn=Ku(Bt);return{extractConvParams:Vt,extractSeparableConvParams:yn,extractReductionBlockParams:function(_n){return{separable_conv0:yn(_n+"/separable_conv0"),separable_conv1:yn(_n+"/separable_conv1"),expansion_conv:Vt(_n+"/expansion_conv")}},extractMainBlockParams:function(_n){return{separable_conv0:yn(_n+"/separable_conv0"),separable_conv1:yn(_n+"/separable_conv1"),separable_conv2:yn(_n+"/separable_conv2")}}}}($,T),P=A.extractConvParams,J=A.extractSeparableConvParams,ie=A.extractReductionBlockParams,pe=A.extractMainBlockParams,Ae={conv_in:P("entry_flow/conv_in"),reduction_block_0:ie("entry_flow/reduction_block_0"),reduction_block_1:ie("entry_flow/reduction_block_1")},Ie={};na(M,0,1).forEach(function(et){Ie["main_block_"+et]=pe("middle_flow/main_block_"+et)});var De={reduction_block:ie("exit_flow/reduction_block"),separable_conv:J("exit_flow/separable_conv")};return oa($,T),{params:{entry_flow:Ae,middle_flow:Ie,exit_flow:De},paramMappings:T}}function tm($,M,T){return vn.add(vn.conv2d($,M.filters,T,"same"),M.bias)}function Pl($,M,T){T===void 0&&(T=!0);var A=T?vn.relu($):$;return A=So(A,M.separable_conv0,[1,1]),A=So(vn.relu(A),M.separable_conv1,[1,1]),A=vn.maxPool(A,[3,3],[2,2],"same"),A=vn.add(A,tm($,M.expansion_conv,[2,2]))}var Sf,rv=function($){function M(T){var A=$.call(this,"TinyXception")||this;return A._numMainBlocks=T,A}return Object(tr.c)(M,$),M.prototype.forwardInput=function(T){var A=this,P=this.params;if(!P)throw new Error("TinyXception - load model before inference");return vn.tidy(function(){var J=Fc(T.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(vn.scalar(256)),ie=vn.relu(tm(J,P.entry_flow.conv_in,[2,2]));return ie=Pl(ie=Pl(ie,P.entry_flow.reduction_block_0,!1),P.entry_flow.reduction_block_1),na(A._numMainBlocks,0,1).forEach(function(pe){ie=function(Ae,Ie){var De=So(vn.relu(Ae),Ie.separable_conv0,[1,1]);return De=So(vn.relu(De),Ie.separable_conv1,[1,1]),De=So(vn.relu(De),Ie.separable_conv2,[1,1]),De=vn.add(De,Ae)}(ie,P.middle_flow["main_block_"+pe])}),ie=Pl(ie,P.exit_flow.reduction_block),ie=vn.relu(So(ie,P.exit_flow.separable_conv,[1,1]))})},M.prototype.forward=function(T){return Object(tr.b)(this,void 0,void 0,function(){var A;return Object(tr.d)(this,function(P){switch(P.label){case 0:return A=this.forwardInput,[4,pi(T)];case 1:return[2,A.apply(this,[P.sent()])]}})})},M.prototype.getDefaultModelName=function(){return"tiny_xception_model"},M.prototype.extractParamsFromWeigthMap=function(T){return wi(T,this._numMainBlocks)},M.prototype.extractParams=function(T){return Rl(T,this._numMainBlocks)},M}(Ui);(function($){$.FEMALE="female",$.MALE="male"})(Sf||(Sf={}));var iv=function($){function M(T){T===void 0&&(T=new rv(2));var A=$.call(this,"AgeGenderNet")||this;return A._faceFeatureExtractor=T,A}return Object(tr.c)(M,$),Object.defineProperty(M.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),M.prototype.runNet=function(T){var A=this,P=this.params;if(!P)throw new Error(this._name+" - load model before inference");return vn.tidy(function(){var J=T instanceof oi?A.faceFeatureExtractor.forwardInput(T):T,ie=vn.avgPool(J,[7,7],[2,2],"valid").as2D(J.shape[0],-1);return{age:aa(ie,P.fc.age).as1D(),gender:aa(ie,P.fc.gender)}})},M.prototype.forwardInput=function(T){var A=this;return vn.tidy(function(){var P=A.runNet(T),J=P.age,ie=P.gender;return{age:J,gender:vn.softmax(ie)}})},M.prototype.forward=function(T){return Object(tr.b)(this,void 0,void 0,function(){var A;return Object(tr.d)(this,function(P){switch(P.label){case 0:return A=this.forwardInput,[4,pi(T)];case 1:return[2,A.apply(this,[P.sent()])]}})})},M.prototype.predictAgeAndGender=function(T){return Object(tr.b)(this,void 0,void 0,function(){var A,P,J,ie,pe,Ae,Ie=this;return Object(tr.d)(this,function(De){switch(De.label){case 0:return[4,pi(T)];case 1:return A=De.sent(),[4,this.forwardInput(A)];case 2:return P=De.sent(),J=vn.unstack(P.age),ie=vn.unstack(P.gender),pe=J.map(function(et,ot){return{ageTensor:et,genderTensor:ie[ot]}}),[4,Promise.all(pe.map(function(et){var ot=et.ageTensor,Bt=et.genderTensor;return Object(tr.b)(Ie,void 0,void 0,function(){var Vt,yn,_n,Dn,Nn;return Object(tr.d)(this,function(Wn){switch(Wn.label){case 0:return[4,ot.data()];case 1:return Vt=Wn.sent()[0],[4,Bt.data()];case 2:return yn=Wn.sent()[0],Dn=(_n=yn>.5)?Sf.MALE:Sf.FEMALE,Nn=_n?yn:1-yn,ot.dispose(),Bt.dispose(),[2,{age:Vt,gender:Dn,genderProbability:Nn}]}})})}))];case 3:return Ae=De.sent(),P.age.dispose(),P.gender.dispose(),[2,A.isBatchInput?Ae:Ae[0]]}})})},M.prototype.getDefaultModelName=function(){return"age_gender_model"},M.prototype.dispose=function(T){T===void 0&&(T=!0),this.faceFeatureExtractor.dispose(T),$.prototype.dispose.call(this,T)},M.prototype.loadClassifierParams=function(T){var A=this.extractClassifierParams(T),P=A.params,J=A.paramMappings;this._params=P,this._paramMappings=J},M.prototype.extractClassifierParams=function(T){return function(A){var P=[],J=Ha(A),ie=J.extractWeights,pe=J.getRemainingWeights,Ae=_a(ie,P),Ie=Ae(512,1,"fc/age"),De=Ae(512,2,"fc/gender");if(pe().length!==0)throw new Error("weights remaing after extract: "+pe().length);return{paramMappings:P,params:{fc:{age:Ie,gender:De}}}}(T)},M.prototype.extractParamsFromWeigthMap=function(T){var A=Xs(T),P=A.featureExtractorMap,J=A.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(P),function(ie){var pe=[],Ae=Es(ie,pe);function Ie(et){return{weights:Ae(et+"/weights",2),bias:Ae(et+"/bias",1)}}var De={fc:{age:Ie("fc/age"),gender:Ie("fc/gender")}};return oa(ie,pe),{params:De,paramMappings:pe}}(J)},M.prototype.extractParams=function(T){var A=T.slice(0,T.length-1539),P=T.slice(T.length-1539);return this.faceFeatureExtractor.extractWeights(A),this.extractClassifierParams(P)},M}(Ui),Yg=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.postProcess=function(T,A,P){var J=P.map(function(pe){var Ae=pe.width,Ie=pe.height,De=A/Math.max(Ie,Ae);return{width:Ae*De,height:Ie*De}}),ie=J.length;return vn.tidy(function(){var pe=function(Ie,De){return vn.stack([vn.fill([68],Ie),vn.fill([68],De)],1).as2D(1,136).as1D()},Ae=function(Ie,De){var et=J[Ie],ot=et.width,Bt=et.height;return De(ot,Bt)?Math.abs(ot-Bt)/2:0};return T.mul(vn.fill([ie,136],A)).sub(vn.stack(Array.from(Array(ie),function(Ie,De){return pe(function(et){return Ae(et,function(ot,Bt){return ot<Bt})}(De),function(et){return Ae(et,function(ot,Bt){return Bt<ot})}(De))}))).div(vn.stack(Array.from(Array(ie),function(Ie,De){return pe(J[De].width,J[De].height)})))})},M.prototype.forwardInput=function(T){var A=this;return vn.tidy(function(){var P=A.runNet(T);return A.postProcess(P,T.inputSize,T.inputDimensions.map(function(J){return{height:J[0],width:J[1]}}))})},M.prototype.forward=function(T){return Object(tr.b)(this,void 0,void 0,function(){var A;return Object(tr.d)(this,function(P){switch(P.label){case 0:return A=this.forwardInput,[4,pi(T)];case 1:return[2,A.apply(this,[P.sent()])]}})})},M.prototype.detectLandmarks=function(T){return Object(tr.b)(this,void 0,void 0,function(){var A,P,J,ie=this;return Object(tr.d)(this,function(pe){switch(pe.label){case 0:return[4,pi(T)];case 1:return A=pe.sent(),P=vn.tidy(function(){return vn.unstack(ie.forwardInput(A))}),[4,Promise.all(P.map(function(Ae,Ie){return Object(tr.b)(ie,void 0,void 0,function(){var De,et,ot,Bt,Vt;return Object(tr.d)(this,function(yn){switch(yn.label){case 0:return ot=(et=Array).from,[4,Ae.data()];case 1:return De=ot.apply(et,[yn.sent()]),Bt=De.filter(function(_n,Dn){return no(Dn)}),Vt=De.filter(function(_n,Dn){return!no(Dn)}),[2,new Xu(Array(68).fill(0).map(function(_n,Dn){return new vo(Bt[Dn],Vt[Dn])}),{height:A.getInputHeight(Ie),width:A.getInputWidth(Ie)})]}})})}))];case 2:return J=pe.sent(),P.forEach(function(Ae){return Ae.dispose()}),[2,A.isBatchInput?J:J[0]]}})})},M.prototype.getClassifierChannelsOut=function(){return 136},M}(jo),Jg=function($){function M(T){return T===void 0&&(T=new $s),$.call(this,"FaceLandmark68Net",T)||this}return Object(tr.c)(M,$),M.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},M.prototype.getClassifierChannelsIn=function(){return 256},M}(Yg),ov=function($){function M(){return $.call(this,"TinyFaceFeatureExtractor")||this}return Object(tr.c)(M,$),M.prototype.forwardInput=function(T){var A=this.params;if(!A)throw new Error("TinyFaceFeatureExtractor - load model before inference");return vn.tidy(function(){var P=ya(Fc(T.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(vn.scalar(255)),A.dense0,!0);return P=ya(P=ya(P,A.dense1),A.dense2),P=vn.avgPool(P,[14,14],[2,2],"valid")})},M.prototype.forward=function(T){return Object(tr.b)(this,void 0,void 0,function(){var A;return Object(tr.d)(this,function(P){switch(P.label){case 0:return A=this.forwardInput,[4,pi(T)];case 1:return[2,A.apply(this,[P.sent()])]}})})},M.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},M.prototype.extractParamsFromWeigthMap=function(T){return function(A){var P=[],J=lu(A,P).extractDenseBlock3Params,ie={dense0:J("dense0",!0),dense1:J("dense1"),dense2:J("dense2")};return oa(A,P),{params:ie,paramMappings:P}}(T)},M.prototype.extractParams=function(T){return function(A){var P=[],J=Ha(A),ie=J.extractWeights,pe=J.getRemainingWeights,Ae=Bo(ie,P).extractDenseBlock3Params,Ie=Ae(3,32,"dense0",!0),De=Ae(32,64,"dense1"),et=Ae(64,128,"dense2");if(pe().length!==0)throw new Error("weights remaing after extract: "+pe().length);return{paramMappings:P,params:{dense0:Ie,dense1:De,dense2:et}}}(T)},M}(Ui),Qg=function($){function M(T){return T===void 0&&(T=new ov),$.call(this,"FaceLandmark68TinyNet",T)||this}return Object(tr.c)(M,$),M.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},M.prototype.getClassifierChannelsIn=function(){return 128},M}(Yg),av=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M}(Jg);function Od($,M,T,A,P){P===void 0&&(P="same");var J=M.conv,ie=J.filters,pe=J.bias,Ae=vn.conv2d($,ie,T,P);return Ae=function(Ie,De){return vn.add(vn.mul(Ie,De.weights),De.biases)}(Ae=vn.add(Ae,pe),M.scale),A?vn.relu(Ae):Ae}function nm($,M){return Od($,M,[1,1],!1)}function sv($,M){return Od($,M,[2,2],!0,"valid")}function uv($,M){function T(P,J,ie,pe){var Ae=function(De,et,ot){var Bt=$(De),Vt=Bt.length/(et*ot*ot);if(Ta(Vt))throw new Error("depth has to be an integer: "+Vt+", weights.length: "+Bt.length+", numFilters: "+et+", filterSize: "+ot);return vn.tidy(function(){return vn.transpose(vn.tensor4d(Bt,[et,Vt,ot,ot]),[2,3,1,0])})}(P,J,ie),Ie=vn.tensor1d($(J));return M.push({paramPath:pe+"/filters"},{paramPath:pe+"/bias"}),{filters:Ae,bias:Ie}}function A(P,J,ie,pe){return{conv:T(P,J,ie,pe+"/conv"),scale:function(Ae,Ie){var De=vn.tensor1d($(Ae)),et=vn.tensor1d($(Ae));return M.push({paramPath:Ie+"/weights"},{paramPath:Ie+"/biases"}),{weights:De,biases:et}}(J,pe+"/scale")}}return{extractConvLayerParams:A,extractResidualLayerParams:function(P,J,ie,pe,Ae){return Ae===void 0&&(Ae=!1),{conv1:A((Ae?.5:1)*P,J,ie,pe+"/conv1"),conv2:A(P,J,ie,pe+"/conv2")}}}}function cv($,M){var T=Es($,M);function A(P){return{conv:{filters:T(P+"/conv/filters",4),bias:T(P+"/conv/bias",1)},scale:function(J){return{weights:T(J+"/scale/weights",1),biases:T(J+"/scale/biases",1)}}(P)}}return{extractConvLayerParams:A,extractResidualLayerParams:function(P){return{conv1:A(P+"/conv1"),conv2:A(P+"/conv2")}}}}function ol($,M){var T=function(A,P){return Od(A,P,[1,1],!0)}($,M.conv1);return T=nm(T,M.conv2),T=vn.add(T,$),T=vn.relu(T)}function Td($,M){var T=sv($,M.conv1);T=nm(T,M.conv2);var A=vn.avgPool($,2,2,"valid"),P=vn.zeros(A.shape),J=A.shape[3]!==T.shape[3];if(A.shape[1]!==T.shape[1]||A.shape[2]!==T.shape[2]){var ie=Object(tr.e)(T.shape);ie[1]=1;var pe=vn.zeros(ie);T=vn.concat([T,pe],1);var Ae=Object(tr.e)(T.shape);Ae[2]=1;var Ie=vn.zeros(Ae);T=vn.concat([T,Ie],2)}return A=J?vn.concat([A,P],3):A,T=vn.add(A,T),T=vn.relu(T)}var rm=function($){function M(){return $.call(this,"FaceRecognitionNet")||this}return Object(tr.c)(M,$),M.prototype.forwardInput=function(T){var A=this.params;if(!A)throw new Error("FaceRecognitionNet - load model before inference");return vn.tidy(function(){var P=sv(Fc(T.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(vn.scalar(256)),A.conv32_down),J=(P=Td(P=ol(P=ol(P=Td(P=ol(P=ol(P=Td(P=ol(P=ol(P=ol(P=Td(P=ol(P=ol(P=ol(P=vn.maxPool(P,3,2,"valid"),A.conv32_1),A.conv32_2),A.conv32_3),A.conv64_down),A.conv64_1),A.conv64_2),A.conv64_3),A.conv128_down),A.conv128_1),A.conv128_2),A.conv256_down),A.conv256_1),A.conv256_2),A.conv256_down_out)).mean([1,2]);return vn.matMul(J,A.fc)})},M.prototype.forward=function(T){return Object(tr.b)(this,void 0,void 0,function(){var A;return Object(tr.d)(this,function(P){switch(P.label){case 0:return A=this.forwardInput,[4,pi(T)];case 1:return[2,A.apply(this,[P.sent()])]}})})},M.prototype.computeFaceDescriptor=function(T){return Object(tr.b)(this,void 0,void 0,function(){var A,P,J,ie=this;return Object(tr.d)(this,function(pe){switch(pe.label){case 0:return[4,pi(T)];case 1:return A=pe.sent(),P=vn.tidy(function(){return vn.unstack(ie.forwardInput(A))}),[4,Promise.all(P.map(function(Ae){return Ae.data()}))];case 2:return J=pe.sent(),P.forEach(function(Ae){return Ae.dispose()}),[2,A.isBatchInput?J:J[0]]}})})},M.prototype.getDefaultModelName=function(){return"face_recognition_model"},M.prototype.extractParamsFromWeigthMap=function(T){return function(A){var P=[],J=cv(A,P),ie=J.extractConvLayerParams,pe=J.extractResidualLayerParams,Ae=ie("conv32_down"),Ie=pe("conv32_1"),De=pe("conv32_2"),et=pe("conv32_3"),ot=pe("conv64_down"),Bt=pe("conv64_1"),Vt=pe("conv64_2"),yn=pe("conv64_3"),_n=pe("conv128_down"),Dn=pe("conv128_1"),Nn=pe("conv128_2"),Wn=pe("conv256_down"),Jn=pe("conv256_1"),Cn=pe("conv256_2"),wr=pe("conv256_down_out"),Dr=A.fc;if(P.push({originalPath:"fc",paramPath:"fc"}),!Sd(Dr))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+Dr);var Nr={conv32_down:Ae,conv32_1:Ie,conv32_2:De,conv32_3:et,conv64_down:ot,conv64_1:Bt,conv64_2:Vt,conv64_3:yn,conv128_down:_n,conv128_1:Dn,conv128_2:Nn,conv256_down:Wn,conv256_1:Jn,conv256_2:Cn,conv256_down_out:wr,fc:Dr};return oa(A,P),{params:Nr,paramMappings:P}}(T)},M.prototype.extractParams=function(T){return function(A){var P=Ha(A),J=P.extractWeights,ie=P.getRemainingWeights,pe=[],Ae=uv(J,pe),Ie=Ae.extractConvLayerParams,De=Ae.extractResidualLayerParams,et=Ie(4704,32,7,"conv32_down"),ot=De(9216,32,3,"conv32_1"),Bt=De(9216,32,3,"conv32_2"),Vt=De(9216,32,3,"conv32_3"),yn=De(36864,64,3,"conv64_down",!0),_n=De(36864,64,3,"conv64_1"),Dn=De(36864,64,3,"conv64_2"),Nn=De(36864,64,3,"conv64_3"),Wn=De(147456,128,3,"conv128_down",!0),Jn=De(147456,128,3,"conv128_1"),Cn=De(147456,128,3,"conv128_2"),wr=De(589824,256,3,"conv256_down",!0),Dr=De(589824,256,3,"conv256_1"),Nr=De(589824,256,3,"conv256_2"),Yr=De(589824,256,3,"conv256_down_out"),jr=vn.tidy(function(){return vn.transpose(vn.tensor2d(J(32768),[128,256]),[1,0])});if(pe.push({paramPath:"fc"}),ie().length!==0)throw new Error("weights remaing after extract: "+ie().length);return{params:{conv32_down:et,conv32_1:ot,conv32_2:Bt,conv32_3:Vt,conv64_down:yn,conv64_1:_n,conv64_2:Dn,conv64_3:Nn,conv128_down:Wn,conv128_1:Jn,conv128_2:Cn,conv256_down:wr,conv256_1:Dr,conv256_2:Nr,conv256_down_out:Yr,fc:jr},paramMappings:pe}}(T)},M}(Ui);function Zg($){var M=new rm;return M.extractWeights($),M}function e0($,M){var T={descriptor:M};return Object.assign({},$,T)}function Sy($){return typeof $.age=="number"}function t0($,M){var T={age:M};return Object.assign({},$,T)}function Uh($){return($.gender===Sf.MALE||$.gender===Sf.FEMALE)&&su($.genderProbability)}function Md($,M,T){var A={gender:M,genderProbability:T};return Object.assign({},$,A)}var al=function(){function $(M){var T=M===void 0?{}:M,A=T.minFaceSize,P=T.scaleFactor,J=T.maxNumScales,ie=T.scoreThresholds,pe=T.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=A||20,this._scaleFactor=P||.709,this._maxNumScales=J||10,this._scoreThresholds=ie||[.6,.7,.7],this._scaleSteps=pe,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(Ae){return typeof Ae!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(Ae){return typeof Ae!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty($.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),$}();function n0($,M){function T(J,ie,pe,Ae,Ie){var De=vn.tensor4d($(J*ie*pe*pe),[pe,pe,J,ie]),et=vn.tensor1d($(ie));return M.push({paramPath:Ae+"/filters"},{paramPath:Ae+"/"+(Ie?"batch_norm_offset":"bias")}),{filters:De,bias:et}}function A(J,ie,pe,Ae){var Ie=T(J,ie,pe,Ae,!0);return{filters:Ie.filters,batch_norm_offset:Ie.bias}}function P(J,ie,pe){return{depthwise_conv:function(Ae,Ie){var De=vn.tensor4d($(9*Ae),[3,3,Ae,1]),et=vn.tensor1d($(Ae)),ot=vn.tensor1d($(Ae)),Bt=vn.tensor1d($(Ae)),Vt=vn.tensor1d($(Ae));return M.push({paramPath:Ie+"/filters"},{paramPath:Ie+"/batch_norm_scale"},{paramPath:Ie+"/batch_norm_offset"},{paramPath:Ie+"/batch_norm_mean"},{paramPath:Ie+"/batch_norm_variance"}),{filters:De,batch_norm_scale:et,batch_norm_offset:ot,batch_norm_mean:Bt,batch_norm_variance:Vt}}(J,pe+"/depthwise_conv"),pointwise_conv:A(J,ie,1,pe+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:A(3,32,3,"mobilenetv1/conv_0"),conv_1:P(32,64,"mobilenetv1/conv_1"),conv_2:P(64,128,"mobilenetv1/conv_2"),conv_3:P(128,128,"mobilenetv1/conv_3"),conv_4:P(128,256,"mobilenetv1/conv_4"),conv_5:P(256,256,"mobilenetv1/conv_5"),conv_6:P(256,512,"mobilenetv1/conv_6"),conv_7:P(512,512,"mobilenetv1/conv_7"),conv_8:P(512,512,"mobilenetv1/conv_8"),conv_9:P(512,512,"mobilenetv1/conv_9"),conv_10:P(512,512,"mobilenetv1/conv_10"),conv_11:P(512,512,"mobilenetv1/conv_11"),conv_12:P(512,1024,"mobilenetv1/conv_12"),conv_13:P(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:A(1024,256,1,"prediction_layer/conv_0"),conv_1:A(256,512,3,"prediction_layer/conv_1"),conv_2:A(512,128,1,"prediction_layer/conv_2"),conv_3:A(128,256,3,"prediction_layer/conv_3"),conv_4:A(256,128,1,"prediction_layer/conv_4"),conv_5:A(128,256,3,"prediction_layer/conv_5"),conv_6:A(256,64,1,"prediction_layer/conv_6"),conv_7:A(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:T(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:T(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:T(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:T(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:T(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:T(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:T(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:T(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:T(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:T(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:T(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:T(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function r0($){var M=[],T=function(pe,Ae){var Ie=Es(pe,Ae);function De(Vt,yn,_n){return{filters:Ie(Vt+"/Conv2d_"+yn+"_pointwise/weights",4,_n+"/filters"),batch_norm_offset:Ie(Vt+"/Conv2d_"+yn+"_pointwise/convolution_bn_offset",1,_n+"/batch_norm_offset")}}function et(Vt){var yn="mobilenetv1/conv_"+Vt,_n="MobilenetV1/Conv2d_"+Vt+"_depthwise",Dn=yn+"/depthwise_conv",Nn=yn+"/pointwise_conv";return{depthwise_conv:{filters:Ie(_n+"/depthwise_weights",4,Dn+"/filters"),batch_norm_scale:Ie(_n+"/BatchNorm/gamma",1,Dn+"/batch_norm_scale"),batch_norm_offset:Ie(_n+"/BatchNorm/beta",1,Dn+"/batch_norm_offset"),batch_norm_mean:Ie(_n+"/BatchNorm/moving_mean",1,Dn+"/batch_norm_mean"),batch_norm_variance:Ie(_n+"/BatchNorm/moving_variance",1,Dn+"/batch_norm_variance")},pointwise_conv:De("MobilenetV1",Vt,Nn)}}function ot(Vt,yn){return{filters:Ie(Vt+"/weights",4,yn+"/filters"),bias:Ie(Vt+"/biases",1,yn+"/bias")}}function Bt(Vt){return{box_encoding_predictor:ot("Prediction/BoxPredictor_"+Vt+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+Vt+"/box_encoding_predictor"),class_predictor:ot("Prediction/BoxPredictor_"+Vt+"/ClassPredictor","prediction_layer/box_predictor_"+Vt+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:De("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:et(1),conv_2:et(2),conv_3:et(3),conv_4:et(4),conv_5:et(5),conv_6:et(6),conv_7:et(7),conv_8:et(8),conv_9:et(9),conv_10:et(10),conv_11:et(11),conv_12:et(12),conv_13:et(13)}},extractPredictionLayerParams:function(){return{conv_0:De("Prediction",0,"prediction_layer/conv_0"),conv_1:De("Prediction",1,"prediction_layer/conv_1"),conv_2:De("Prediction",2,"prediction_layer/conv_2"),conv_3:De("Prediction",3,"prediction_layer/conv_3"),conv_4:De("Prediction",4,"prediction_layer/conv_4"),conv_5:De("Prediction",5,"prediction_layer/conv_5"),conv_6:De("Prediction",6,"prediction_layer/conv_6"),conv_7:De("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:Bt(0),box_predictor_1:Bt(1),box_predictor_2:Bt(2),box_predictor_3:Bt(3),box_predictor_4:Bt(4),box_predictor_5:Bt(5)}}}}($,M),A=T.extractMobilenetV1Params,P=T.extractPredictionLayerParams,J=$["Output/extra_dim"];if(M.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!mr(J))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+J);var ie={mobilenetv1:A(),prediction_layer:P(),output_layer:{extra_dim:J}};return oa($,M),{params:ie,paramMappings:M}}function Yu($,M,T){return vn.tidy(function(){var A=vn.conv2d($,M.filters,T,"same");return A=vn.add(A,M.batch_norm_offset),vn.clipByValue(A,0,6)})}var i0=.0010000000474974513;function Wh($,M){return vn.tidy(function(){var T=null,A=Yu($,M.conv_0,[2,2]);if([M.conv_1,M.conv_2,M.conv_3,M.conv_4,M.conv_5,M.conv_6,M.conv_7,M.conv_8,M.conv_9,M.conv_10,M.conv_11,M.conv_12,M.conv_13].forEach(function(P,J){var ie=J+1,pe=function(Ae){return[2,4,6,12].some(function(Ie){return Ie===Ae})?[2,2]:[1,1]}(ie);A=Yu(A=function(Ae,Ie,De){return vn.tidy(function(){var et=vn.depthwiseConv2d(Ae,Ie.filters,De,"same");return et=vn.batchNorm(et,Ie.batch_norm_mean,Ie.batch_norm_variance,Ie.batch_norm_offset,Ie.batch_norm_scale,i0),vn.clipByValue(et,0,6)})}(A,P.depthwise_conv,pe),P.pointwise_conv,[1,1]),ie===11&&(T=A)}),T===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:A,conv11:T}})}function im($,M,T){var A=$.arraySync(),P=Math.min(A[M][0],A[M][2]),J=Math.min(A[M][1],A[M][3]),ie=Math.max(A[M][0],A[M][2]),pe=Math.max(A[M][1],A[M][3]),Ae=Math.min(A[T][0],A[T][2]),Ie=Math.min(A[T][1],A[T][3]),De=Math.max(A[T][0],A[T][2]),et=Math.max(A[T][1],A[T][3]),ot=(ie-P)*(pe-J),Bt=(De-Ae)*(et-Ie);if(ot<=0||Bt<=0)return 0;var Vt=Math.max(P,Ae),yn=Math.max(J,Ie),_n=Math.min(ie,De),Dn=Math.min(pe,et),Nn=Math.max(_n-Vt,0)*Math.max(Dn-yn,0);return Nn/(ot+Bt-Nn)}function ky($,M){var T=function(De){var et=vn.unstack(vn.transpose(De,[1,0])),ot=[vn.sub(et[2],et[0]),vn.sub(et[3],et[1])];return{sizes:ot,centers:[vn.add(et[0],vn.div(ot[0],vn.scalar(2))),vn.add(et[1],vn.div(ot[1],vn.scalar(2)))]}}($),A=T.sizes,P=T.centers,J=vn.unstack(vn.transpose(M,[1,0])),ie=vn.div(vn.mul(vn.exp(vn.div(J[2],vn.scalar(5))),A[0]),vn.scalar(2)),pe=vn.add(vn.mul(vn.div(J[0],vn.scalar(10)),A[0]),P[0]),Ae=vn.div(vn.mul(vn.exp(vn.div(J[3],vn.scalar(5))),A[1]),vn.scalar(2)),Ie=vn.add(vn.mul(vn.div(J[1],vn.scalar(10)),A[1]),P[1]);return vn.transpose(vn.stack([vn.sub(pe,ie),vn.sub(Ie,Ae),vn.add(pe,ie),vn.add(Ie,Ae)]),[1,0])}function om($,M){return vn.tidy(function(){var T=$.shape[0];return{boxPredictionEncoding:vn.reshape(ha($,M.box_encoding_predictor),[T,-1,1,4]),classPrediction:vn.reshape(ha($,M.class_predictor),[T,-1,3])}})}var sl=function(){function $(M){var T=M===void 0?{}:M,A=T.minConfidence,P=T.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=A||.5,this._maxResults=P||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty($.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),$}(),am=function($){function M(){return $.call(this,"SsdMobilenetv1")||this}return Object(tr.c)(M,$),M.prototype.forwardInput=function(T){var A=this.params;if(!A)throw new Error("SsdMobilenetv1 - load model before inference");return vn.tidy(function(){var P=T.toBatchTensor(512,!1).toFloat(),J=Wh(vn.sub(vn.mul(P,vn.scalar(.007843137718737125)),vn.scalar(1)),A.mobilenetv1),ie=function(pe,Ae,Ie){return vn.tidy(function(){var De=Yu(Yu(pe,Ie.conv_0,[1,1]),Ie.conv_1,[2,2]),et=Yu(Yu(De,Ie.conv_2,[1,1]),Ie.conv_3,[2,2]),ot=Yu(Yu(et,Ie.conv_4,[1,1]),Ie.conv_5,[2,2]),Bt=Yu(Yu(ot,Ie.conv_6,[1,1]),Ie.conv_7,[2,2]),Vt=om(Ae,Ie.box_predictor_0),yn=om(pe,Ie.box_predictor_1),_n=om(De,Ie.box_predictor_2),Dn=om(et,Ie.box_predictor_3),Nn=om(ot,Ie.box_predictor_4),Wn=om(Bt,Ie.box_predictor_5);return{boxPredictions:vn.concat([Vt.boxPredictionEncoding,yn.boxPredictionEncoding,_n.boxPredictionEncoding,Dn.boxPredictionEncoding,Nn.boxPredictionEncoding,Wn.boxPredictionEncoding],1),classPredictions:vn.concat([Vt.classPrediction,yn.classPrediction,_n.classPrediction,Dn.classPrediction,Nn.classPrediction,Wn.classPrediction],1)}})}(J.out,J.conv11,A.prediction_layer);return function(pe,Ae,Ie){return vn.tidy(function(){var De=pe.shape[0],et=ky(vn.reshape(vn.tile(Ie.extra_dim,[De,1,1]),[-1,4]),vn.reshape(pe,[-1,4]));et=vn.reshape(et,[De,et.shape[0]/De,4]);var ot=vn.sigmoid(vn.slice(Ae,[0,0,1],[-1,-1,-1])),Bt=vn.slice(ot,[0,0,0],[-1,-1,1]);return Bt=vn.reshape(Bt,[De,Bt.shape[1]]),{boxes:vn.unstack(et),scores:vn.unstack(Bt)}})}(ie.boxPredictions,ie.classPredictions,A.output_layer)})},M.prototype.forward=function(T){return Object(tr.b)(this,void 0,void 0,function(){var A;return Object(tr.d)(this,function(P){switch(P.label){case 0:return A=this.forwardInput,[4,pi(T)];case 1:return[2,A.apply(this,[P.sent()])]}})})},M.prototype.locateFaces=function(T,A){return A===void 0&&(A={}),Object(tr.b)(this,void 0,void 0,function(){var P,J,ie,pe,Ae,Ie,De,et,ot,Bt,Vt,yn,_n,Dn,Nn,Wn,Jn,Cn,wr,Dr;return Object(tr.d)(this,function(Nr){switch(Nr.label){case 0:return P=new sl(A),J=P.maxResults,ie=P.minConfidence,[4,pi(T)];case 1:for(pe=Nr.sent(),Ae=this.forwardInput(pe),Ie=Ae.boxes,De=Ae.scores,et=Ie[0],ot=De[0],Bt=1;Bt<Ie.length;Bt++)Ie[Bt].dispose(),De[Bt].dispose();return _n=(yn=Array).from,[4,ot.data()];case 2:return Vt=_n.apply(yn,[Nr.sent()]),Dn=function(Yr,jr,Si,Fi,Ni){var Ao=Yr.shape[0],Xo=Math.min(Si,Ao),Po=function(Uo){return Uo<=Fi?1:0},Ro=[];return jr.map(function(Uo,sa){return{score:Uo,boxIndex:sa}}).filter(function(Uo){return Uo.score>Ni}).sort(function(Uo,sa){return sa.score-Uo.score}).forEach(function(Uo){if(!(Ro.length>=Xo)){for(var sa=Uo.score,pa=Ro.length-1;pa>=0;--pa){var Da=im(Yr,Uo.boxIndex,Ro[pa]);if(Da!==0&&(Uo.score*=Po(Da),Uo.score<=Ni))break}sa===Uo.score&&Ro.push(Uo.boxIndex)}}),Ro}(et,Vt,J,.5,ie),Nn=pe.getReshapedInputDimensions(0),Wn=pe.inputSize,Jn=Wn/Nn.width,Cn=Wn/Nn.height,wr=et.arraySync(),Dr=Dn.map(function(Yr){var jr=[Math.max(0,wr[Yr][0]),Math.min(1,wr[Yr][2])].map(function(Po){return Po*Cn}),Si=jr[0],Fi=jr[1],Ni=[Math.max(0,wr[Yr][1]),Math.min(1,wr[Yr][3])].map(function(Po){return Po*Jn}),Ao=Ni[0],Xo=Ni[1];return new ra(Vt[Yr],new Fl(Ao,Si,Xo-Ao,Fi-Si),{height:pe.getInputHeight(0),width:pe.getInputWidth(0)})}),et.dispose(),ot.dispose(),[2,Dr]}})})},M.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},M.prototype.extractParamsFromWeigthMap=function(T){return r0(T)},M.prototype.extractParams=function(T){return function(A){var P=[],J=Ha(A),ie=J.extractWeights,pe=J.getRemainingWeights,Ae=n0(ie,P),Ie=Ae.extractMobilenetV1Params,De=Ae.extractPredictionLayerParams,et=Ie(),ot=De(),Bt={extra_dim:vn.tensor3d(ie(20472),[1,5118,4])};if(P.push({paramPath:"output_layer/extra_dim"}),pe().length!==0)throw new Error("weights remaing after extract: "+pe().length);return{params:{mobilenetv1:et,prediction_layer:ot,output_layer:Bt},paramMappings:P}}(T)},M}(Ui);function lv($){var M=new am;return M.extractWeights($),M}function fv($){return lv($)}var o0,D1=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M}(am),N1=.4,yo=[new vo(.738768,.874946),new vo(2.42204,2.65704),new vo(4.30971,7.04493),new vo(10.246,4.59428),new vo(12.6868,11.8741)],dv=[new vo(1.603231,2.094468),new vo(6.041143,7.080126),new vo(2.882459,3.518061),new vo(4.266906,5.178857),new vo(9.041765,10.66308)],hv=[117.001,114.697,97.404],eg=function($){return typeof $=="number"};function pv($){if(!$)throw new Error("invalid config: "+$);if(typeof $.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+$.withSeparableConvs);if(!eg($.iouThreshold)||$.iouThreshold<0||$.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+$.iouThreshold);if(!Array.isArray($.classes)||!$.classes.length||!$.classes.every(function(M){return typeof M=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify($.classes));if(!Array.isArray($.anchors)||!$.anchors.length||!$.anchors.map(function(M){return M||{}}).every(function(M){return eg(M.x)&&eg(M.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify($.anchors));if($.meanRgb&&(!Array.isArray($.meanRgb)||$.meanRgb.length!==3||!$.meanRgb.every(eg)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify($.meanRgb))}function sm($){return vn.tidy(function(){var M=vn.mul($,vn.scalar(.10000000149011612));return vn.add(vn.relu(vn.sub($,M)),M)})}function Ll($,M){return vn.tidy(function(){var T=vn.pad($,[[0,0],[1,1],[1,1],[0,0]]);return T=vn.conv2d(T,M.conv.filters,[1,1],"valid"),T=vn.sub(T,M.bn.sub),T=vn.mul(T,M.bn.truediv),sm(T=vn.add(T,M.conv.bias))})}function Bl($,M){return vn.tidy(function(){var T=vn.pad($,[[0,0],[1,1],[1,1],[0,0]]);return T=vn.separableConv2d(T,M.depthwise_filter,M.pointwise_filter,[1,1],"valid"),sm(T=vn.add(T,M.bias))})}function mv($,M){var T=ls($,M),A=Ma($,M);return{extractConvParams:T,extractConvWithBatchNormParams:function(P,J,ie){return{conv:T(P,J,3,ie+"/conv"),bn:function(pe,Ae){var Ie=vn.tensor1d($(pe)),De=vn.tensor1d($(pe));return M.push({paramPath:Ae+"/sub"},{paramPath:Ae+"/truediv"}),{sub:Ie,truediv:De}}(J,ie+"/bn")}},extractSeparableConvParams:A}}function gv($,M){var T=Es($,M);function A(P){return{filters:T(P+"/filters",4),bias:T(P+"/bias",1)}}return{extractConvParams:A,extractConvWithBatchNormParams:function(P){return{conv:A(P+"/conv"),bn:function(J){return{sub:T(J+"/sub",1),truediv:T(J+"/truediv",1)}}(P+"/bn")}},extractSeparableConvParams:Ku(T)}}(function($){$[$.XS=224]="XS",$[$.SM=320]="SM",$[$.MD=416]="MD",$[$.LG=608]="LG"})(o0||(o0={}));var Vh=function(){function $(M){var T=M===void 0?{}:M,A=T.inputSize,P=T.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=A||416,this._scoreThreshold=P||.5,typeof this._inputSize!="number"||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty($.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),$}(),Dd=function($){function M(T){var A=$.call(this,"TinyYolov2")||this;return pv(T),A._config=T,A}return Object(tr.c)(M,$),Object.defineProperty(M.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),M.prototype.runTinyYolov2=function(T,A){var P=Ll(T,A.conv0);return P=Ll(P=vn.maxPool(P,[2,2],[2,2],"same"),A.conv1),P=Ll(P=vn.maxPool(P,[2,2],[2,2],"same"),A.conv2),P=Ll(P=vn.maxPool(P,[2,2],[2,2],"same"),A.conv3),P=Ll(P=vn.maxPool(P,[2,2],[2,2],"same"),A.conv4),P=Ll(P=vn.maxPool(P,[2,2],[2,2],"same"),A.conv5),ha(P=Ll(P=Ll(P=vn.maxPool(P,[2,2],[1,1],"same"),A.conv6),A.conv7),A.conv8,"valid",!1)},M.prototype.runMobilenet=function(T,A){var P=this.config.isFirstLayerConv2d?sm(ha(T,A.conv0,"valid",!1)):Bl(T,A.conv0);return P=Bl(P=vn.maxPool(P,[2,2],[2,2],"same"),A.conv1),P=Bl(P=vn.maxPool(P,[2,2],[2,2],"same"),A.conv2),P=Bl(P=vn.maxPool(P,[2,2],[2,2],"same"),A.conv3),P=Bl(P=vn.maxPool(P,[2,2],[2,2],"same"),A.conv4),P=Bl(P=vn.maxPool(P,[2,2],[2,2],"same"),A.conv5),P=vn.maxPool(P,[2,2],[1,1],"same"),P=A.conv6?Bl(P,A.conv6):P,ha(P=A.conv7?Bl(P,A.conv7):P,A.conv8,"valid",!1)},M.prototype.forwardInput=function(T,A){var P=this,J=this.params;if(!J)throw new Error("TinyYolov2 - load model before inference");return vn.tidy(function(){var ie=T.toBatchTensor(A,!1).toFloat();return ie=(ie=P.config.meanRgb?Fc(ie,P.config.meanRgb):ie).div(vn.scalar(256)),P.config.withSeparableConvs?P.runMobilenet(ie,J):P.runTinyYolov2(ie,J)})},M.prototype.forward=function(T,A){return Object(tr.b)(this,void 0,void 0,function(){var P;return Object(tr.d)(this,function(J){switch(J.label){case 0:return P=this.forwardInput,[4,pi(T)];case 1:return[4,P.apply(this,[J.sent(),A])];case 2:return[2,J.sent()]}})})},M.prototype.detect=function(T,A){return A===void 0&&(A={}),Object(tr.b)(this,void 0,void 0,function(){var P,J,ie,pe,Ae,Ie,De,et,ot,Bt,Vt,yn,_n,Dn=this;return Object(tr.d)(this,function(Nn){switch(Nn.label){case 0:return P=new Vh(A),J=P.inputSize,ie=P.scoreThreshold,[4,pi(T)];case 1:return pe=Nn.sent(),[4,this.forwardInput(pe,J)];case 2:return Ae=Nn.sent(),Ie=vn.tidy(function(){return vn.unstack(Ae)[0].expandDims()}),De={width:pe.getInputWidth(0),height:pe.getInputHeight(0)},[4,this.extractBoxes(Ie,pe.getReshapedInputDimensions(0),ie)];case 3:return et=Nn.sent(),Ae.dispose(),Ie.dispose(),ot=et.map(function(Wn){return Wn.box}),Bt=et.map(function(Wn){return Wn.score}),Vt=et.map(function(Wn){return Wn.classScore}),yn=et.map(function(Wn){return Dn.config.classes[Wn.label]}),_n=pc(ot.map(function(Wn){return Wn.rescale(J)}),Bt,this.config.iouThreshold,!0),[2,_n.map(function(Wn){return new _s(Bt[Wn],Vt[Wn],yn[Wn],ot[Wn],De)})]}})})},M.prototype.getDefaultModelName=function(){return""},M.prototype.extractParamsFromWeigthMap=function(T){return function(A,P){var J,ie=[],pe=gv(A,ie),Ae=pe.extractConvParams,Ie=pe.extractConvWithBatchNormParams,De=pe.extractSeparableConvParams;if(P.withSeparableConvs){var et=P.filterSizes&&P.filterSizes.length||9;J={conv0:P.isFirstLayerConv2d?Ae("conv0"):De("conv0"),conv1:De("conv1"),conv2:De("conv2"),conv3:De("conv3"),conv4:De("conv4"),conv5:De("conv5"),conv6:et>7?De("conv6"):void 0,conv7:et>8?De("conv7"):void 0,conv8:Ae("conv8")}}else J={conv0:Ie("conv0"),conv1:Ie("conv1"),conv2:Ie("conv2"),conv3:Ie("conv3"),conv4:Ie("conv4"),conv5:Ie("conv5"),conv6:Ie("conv6"),conv7:Ie("conv7"),conv8:Ae("conv8")};return oa(A,ie),{params:J,paramMappings:ie}}(T,this.config)},M.prototype.extractParams=function(T){var A=this.config.filterSizes||M.DEFAULT_FILTER_SIZES,P=A?A.length:void 0;if(P!==7&&P!==8&&P!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+P+" filterSizes in config");return function(J,ie,pe,Ae){var Ie,De=Ha(J),et=De.extractWeights,ot=De.getRemainingWeights,Bt=[],Vt=mv(et,Bt),yn=Vt.extractConvParams,_n=Vt.extractConvWithBatchNormParams,Dn=Vt.extractSeparableConvParams;if(ie.withSeparableConvs){var Nn=Ae[0],Wn=Ae[1],Jn=Ae[2],Cn=Ae[3],wr=Ae[4],Dr=Ae[5],Nr=Ae[6],Yr=Ae[7],jr=Ae[8];Ie={conv0:ie.isFirstLayerConv2d?yn(Nn,Wn,3,"conv0"):Dn(Nn,Wn,"conv0"),conv1:Dn(Wn,Jn,"conv1"),conv2:Dn(Jn,Cn,"conv2"),conv3:Dn(Cn,wr,"conv3"),conv4:Dn(wr,Dr,"conv4"),conv5:Dn(Dr,Nr,"conv5"),conv6:Yr?Dn(Nr,Yr,"conv6"):void 0,conv7:jr?Dn(Yr,jr,"conv7"):void 0,conv8:yn(jr||Yr||Nr,5*pe,1,"conv8")}}else Nn=Ae[0],Wn=Ae[1],Jn=Ae[2],Cn=Ae[3],wr=Ae[4],Dr=Ae[5],Nr=Ae[6],Yr=Ae[7],jr=Ae[8],Ie={conv0:_n(Nn,Wn,"conv0"),conv1:_n(Wn,Jn,"conv1"),conv2:_n(Jn,Cn,"conv2"),conv3:_n(Cn,wr,"conv3"),conv4:_n(wr,Dr,"conv4"),conv5:_n(Dr,Nr,"conv5"),conv6:_n(Nr,Yr,"conv6"),conv7:_n(Yr,jr,"conv7"),conv8:yn(jr,5*pe,1,"conv8")};if(ot().length!==0)throw new Error("weights remaing after extract: "+ot().length);return{params:Ie,paramMappings:Bt}}(T,this.config,this.boxEncodingSize,A)},M.prototype.extractBoxes=function(T,A,P){return Object(tr.b)(this,void 0,void 0,function(){var J,ie,pe,Ae,Ie,De,et,ot,Bt,Vt,yn,_n,Dn,Nn,Wn,Jn,Cn,wr,Dr,Nr,Yr,jr,Si,Fi,Ni,Ao,Xo,Po,Ro,Uo=this;return Object(tr.d)(this,function(sa){switch(sa.label){case 0:return J=A.width,ie=A.height,pe=Math.max(J,ie),Ae=pe/J,Ie=pe/ie,De=T.shape[1],et=this.config.anchors.length,ot=vn.tidy(function(){var pa=T.reshape([De,De,et,Uo.boxEncodingSize]);return[pa.slice([0,0,0,0],[De,De,et,4]),pa.slice([0,0,0,4],[De,De,et,1]),Uo.withClassScores?vn.softmax(pa.slice([0,0,0,5],[De,De,et,Uo.config.classes.length]),3):vn.scalar(0)]}),Bt=ot[0],Vt=ot[1],yn=ot[2],_n=[],[4,Vt.array()];case 1:return Dn=sa.sent(),[4,Bt.array()];case 2:Nn=sa.sent(),Wn=0,sa.label=3;case 3:if(!(Wn<De))return[3,12];Jn=0,sa.label=4;case 4:if(!(Jn<De))return[3,11];Cn=0,sa.label=5;case 5:return Cn<et?(wr=Il(Dn[Wn][Jn][Cn][0]),!P||wr>P?(Dr=(Jn+Il(Nn[Wn][Jn][Cn][0]))/De*Ae,Nr=(Wn+Il(Nn[Wn][Jn][Cn][1]))/De*Ie,Yr=Math.exp(Nn[Wn][Jn][Cn][2])*this.config.anchors[Cn].x/De*Ae,jr=Math.exp(Nn[Wn][Jn][Cn][3])*this.config.anchors[Cn].y/De*Ie,Si=Dr-Yr/2,Fi=Nr-jr/2,Ni={row:Wn,col:Jn,anchor:Cn},this.withClassScores?[4,this.extractPredictedClass(yn,Ni)]:[3,7]):[3,9]):[3,10];case 6:return Ro=sa.sent(),[3,8];case 7:Ro={classScore:1,label:0},sa.label=8;case 8:Xo=(Ao=Ro).classScore,Po=Ao.label,_n.push(Object(tr.a)({box:new Ba(Si,Fi,Si+Yr,Fi+jr),score:wr,classScore:wr*Xo,label:Po},Ni)),sa.label=9;case 9:return Cn++,[3,5];case 10:return Jn++,[3,4];case 11:return Wn++,[3,3];case 12:return Bt.dispose(),Vt.dispose(),yn.dispose(),[2,_n]}})})},M.prototype.extractPredictedClass=function(T,A){return Object(tr.b)(this,void 0,void 0,function(){var P,J,ie,pe;return Object(tr.d)(this,function(Ae){switch(Ae.label){case 0:return P=A.row,J=A.col,ie=A.anchor,[4,T.array()];case 1:return pe=Ae.sent(),[2,Array(this.config.classes.length).fill(0).map(function(Ie,De){return pe[P][J][ie][De]}).map(function(Ie,De){return{classScore:Ie,label:De}}).reduce(function(Ie,De){return Ie.classScore>De.classScore?Ie:De})]}})})},M.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],M}(Ui),Hh=function($){function M(T){T===void 0&&(T=!0);var A=Object.assign({},{withSeparableConvs:T,iouThreshold:N1,classes:["face"]},T?{anchors:dv,meanRgb:hv}:{anchors:yo,withClassScores:!0});return $.call(this,A)||this}return Object(tr.c)(M,$),Object.defineProperty(M.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),M.prototype.locateFaces=function(T,A){return Object(tr.b)(this,void 0,void 0,function(){return Object(tr.d)(this,function(P){switch(P.label){case 0:return[4,this.detect(T,A)];case 1:return[2,P.sent().map(function(J){return new ra(J.score,J.relativeBox,{width:J.imageWidth,height:J.imageHeight})})]}})})},M.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},M.prototype.extractParamsFromWeigthMap=function(T){return $.prototype.extractParamsFromWeigthMap.call(this,T)},M}(Dd);function I1($,M){M===void 0&&(M=!0);var T=new Hh(M);return T.extractWeights($),T}var tg=function($){function M(){var T=$!==null&&$.apply(this,arguments)||this;return T._name="TinyFaceDetectorOptions",T}return Object(tr.c)(M,$),M}(Vh),jl=function(){function $(){}return $.prototype.then=function(M){return Object(tr.b)(this,void 0,void 0,function(){var T;return Object(tr.d)(this,function(A){switch(A.label){case 0:return T=M,[4,this.run()];case 1:return[2,T.apply(void 0,[A.sent()])]}})})},$.prototype.run=function(){return Object(tr.b)(this,void 0,void 0,function(){return Object(tr.d)(this,function(M){throw new Error("ComposableTask - run is not implemented")})})},$}();function Ju($,M,T,A,P){return P===void 0&&(P=function(J){return J.alignedRect}),Object(tr.b)(this,void 0,void 0,function(){var J,ie,pe,Ae,Ie;return Object(tr.d)(this,function(De){switch(De.label){case 0:return J=$.map(function(et){return il(et)?P(et):et.detection}),(pe=A)?[3,5]:M instanceof vn.Tensor?[4,lo(M,J)]:[3,2];case 1:return Ae=De.sent(),[3,4];case 2:return[4,fo(M,J)];case 3:Ae=De.sent(),De.label=4;case 4:pe=Ae,De.label=5;case 5:return[4,T(ie=pe)];case 6:return Ie=De.sent(),ie.forEach(function(et){return et instanceof vn.Tensor&&et.dispose()}),[2,Ie]}})})}function kf($,M,T,A,P){return Object(tr.b)(this,void 0,void 0,function(){var J=this;return Object(tr.d)(this,function(ie){return[2,Ju([$],M,function(pe){return Object(tr.b)(J,void 0,void 0,function(){return Object(tr.d)(this,function(Ae){return[2,T(pe[0])]})})},A,P)]})})}var Cf=2,Af=12;function vv($){var M=Ha($),T=M.extractWeights,A=M.getRemainingWeights,P=[],J=function(ot,Bt){var Vt=ls(ot,Bt),yn=_a(ot,Bt);function _n(Nn,Wn){var Jn=vn.tensor1d(ot(Nn));return Bt.push({paramPath:Wn}),Jn}function Dn(Nn,Wn,Jn){return Jn===void 0&&(Jn=!1),{conv1:Vt(Nn[0],Nn[1],3,Wn+"/conv1"),prelu1_alpha:_n(Nn[1],Wn+"/prelu1_alpha"),conv2:Vt(Nn[1],Nn[2],3,Wn+"/conv2"),prelu2_alpha:_n(Nn[2],Wn+"/prelu2_alpha"),conv3:Vt(Nn[2],Nn[3],Jn?2:3,Wn+"/conv3"),prelu3_alpha:_n(Nn[3],Wn+"/prelu3_alpha")}}return{extractPNetParams:function(){var Nn=Dn([3,10,16,32],"pnet"),Wn=Vt(32,2,1,"pnet/conv4_1"),Jn=Vt(32,4,1,"pnet/conv4_2");return Object(tr.a)(Object(tr.a)({},Nn),{conv4_1:Wn,conv4_2:Jn})},extractRNetParams:function(){var Nn=Dn([3,28,48,64],"rnet",!0),Wn=yn(576,128,"rnet/fc1"),Jn=_n(128,"rnet/prelu4_alpha"),Cn=yn(128,2,"rnet/fc2_1"),wr=yn(128,4,"rnet/fc2_2");return Object(tr.a)(Object(tr.a)({},Nn),{fc1:Wn,prelu4_alpha:Jn,fc2_1:Cn,fc2_2:wr})},extractONetParams:function(){var Nn=Dn([3,32,64,64],"onet"),Wn=Vt(64,128,2,"onet/conv4"),Jn=_n(128,"onet/prelu4_alpha"),Cn=yn(1152,256,"onet/fc1"),wr=_n(256,"onet/prelu5_alpha"),Dr=yn(256,2,"onet/fc2_1"),Nr=yn(256,4,"onet/fc2_2"),Yr=yn(256,10,"onet/fc2_3");return Object(tr.a)(Object(tr.a)({},Nn),{conv4:Wn,prelu4_alpha:Jn,fc1:Cn,prelu5_alpha:wr,fc2_1:Dr,fc2_2:Nr,fc2_3:Yr})}}}(T,P),ie=J.extractPNetParams,pe=J.extractRNetParams,Ae=J.extractONetParams,Ie=ie(),De=pe(),et=Ae();if(A().length!==0)throw new Error("weights remaing after extract: "+A().length);return{params:{pnet:Ie,rnet:De,onet:et},paramMappings:P}}function ng($){var M=[],T=function(Ie,De){var et=Es(Ie,De);function ot(_n){return{filters:et(_n+"/weights",4,_n+"/filters"),bias:et(_n+"/bias",1)}}function Bt(_n){return{weights:et(_n+"/weights",2),bias:et(_n+"/bias",1)}}function Vt(_n){return et(_n,1)}function yn(_n){return{conv1:ot(_n+"/conv1"),prelu1_alpha:Vt(_n+"/prelu1_alpha"),conv2:ot(_n+"/conv2"),prelu2_alpha:Vt(_n+"/prelu2_alpha"),conv3:ot(_n+"/conv3"),prelu3_alpha:Vt(_n+"/prelu3_alpha")}}return{extractPNetParams:function(){var _n=yn("pnet"),Dn=ot("pnet/conv4_1"),Nn=ot("pnet/conv4_2");return Object(tr.a)(Object(tr.a)({},_n),{conv4_1:Dn,conv4_2:Nn})},extractRNetParams:function(){var _n=yn("rnet"),Dn=Bt("rnet/fc1"),Nn=Vt("rnet/prelu4_alpha"),Wn=Bt("rnet/fc2_1"),Jn=Bt("rnet/fc2_2");return Object(tr.a)(Object(tr.a)({},_n),{fc1:Dn,prelu4_alpha:Nn,fc2_1:Wn,fc2_2:Jn})},extractONetParams:function(){var _n=yn("onet"),Dn=ot("onet/conv4"),Nn=Vt("onet/prelu4_alpha"),Wn=Bt("onet/fc1"),Jn=Vt("onet/prelu5_alpha"),Cn=Bt("onet/fc2_1"),wr=Bt("onet/fc2_2"),Dr=Bt("onet/fc2_3");return Object(tr.a)(Object(tr.a)({},_n),{conv4:Dn,prelu4_alpha:Nn,fc1:Wn,prelu5_alpha:Jn,fc2_1:Cn,fc2_2:wr,fc2_3:Dr})}}}($,M),A=T.extractPNetParams,P=T.extractRNetParams,J=T.extractONetParams,ie=A(),pe=P(),Ae=J();return oa($,M),{params:{pnet:ie,rnet:pe,onet:Ae},paramMappings:M}}function Qu($,M){var T=M[0],A=M[1];return{height:Math.floor(T*$),width:Math.floor(A*$)}}var mc=function($){function M(T,A,P,J){return $.call(this,{left:T,top:A,right:P,bottom:J},!0)||this}return Object(tr.c)(M,$),M}(ws);function yv($){return vn.tidy(function(){return vn.mul(vn.sub($,vn.scalar(127.5)),vn.scalar(.0078125))})}function um($,M){return vn.tidy(function(){return vn.add(vn.relu($),vn.mul(M,vn.neg(vn.relu(vn.neg($)))))})}function a0($,M,T){return T===void 0&&(T=!1),vn.tidy(function(){var A=ha($,M.conv1,"valid");return A=um(A,M.prelu1_alpha),A=um(A=ha(A=vn.maxPool(A,T?[2,2]:[3,3],[2,2],"same"),M.conv2,"valid"),M.prelu2_alpha),A=um(A=ha(A=T?A:vn.maxPool(A,[3,3],[2,2],"valid"),M.conv3,"valid"),M.prelu3_alpha)})}function F1($,M,T,A,P){P.stage1=[];var J=M.map(function(De){return vn.tidy(function(){var et={scale:De},ot=function(Dn,Nn){return vn.tidy(function(){var Wn=Qu(Nn,Dn.shape.slice(1)),Jn=Wn.height,Cn=Wn.width,wr=yv(vn.image.resizeBilinear(Dn,[Jn,Cn]));return vn.transpose(wr,[0,2,1,3])})}($,De),Bt=Date.now(),Vt=function(Dn,Nn){return vn.tidy(function(){var Wn=a0(Dn,Nn,!0),Jn=ha(Wn,Nn.conv4_1,"valid"),Cn=vn.expandDims(vn.max(Jn,3),3);return{prob:vn.softmax(vn.sub(Jn,Cn),3),regions:ha(Wn,Nn.conv4_2,"valid")}})}(ot,A),yn=Vt.prob,_n=Vt.regions;return et.pnet=Date.now()-Bt,{scoresTensor:vn.unstack(vn.unstack(yn,3)[1])[0],regionsTensor:vn.unstack(_n)[0],scale:De,statsForScale:et}})}).map(function(De){var et=De.scoresTensor,ot=De.regionsTensor,Bt=De.scale,Vt=De.statsForScale,yn=function(Nn,Wn,Jn,Cn){for(var wr=[],Dr=Nn.arraySync(),Nr=0;Nr<Nn.shape[0];Nr++)for(var Yr=0;Yr<Nn.shape[1];Yr++)Dr[Nr][Yr]>=Cn&&wr.push(new vo(Yr,Nr));return wr.map(function(jr){var Si=new Ba(Math.round((jr.y*Cf+1)/Jn),Math.round((jr.x*Cf+1)/Jn),Math.round((jr.y*Cf+Af)/Jn),Math.round((jr.x*Cf+Af)/Jn)),Fi=Dr[jr.y][jr.x],Ni=Wn.arraySync();return{cell:Si,score:Fi,region:new mc(Ni[jr.y][jr.x][0],Ni[jr.y][jr.x][1],Ni[jr.y][jr.x][2],Ni[jr.y][jr.x][3])}})}(et,ot,Bt,T);if(et.dispose(),ot.dispose(),!yn.length)return P.stage1.push(Vt),[];var _n=Date.now(),Dn=pc(yn.map(function(Nn){return Nn.cell}),yn.map(function(Nn){return Nn.score}),.5);return Vt.nms=Date.now()-_n,Vt.numBoxes=Dn.length,P.stage1.push(Vt),Dn.map(function(Nn){return yn[Nn]})}).reduce(function(De,et){return De.concat(et)},[]),ie=[],pe=[];if(J.length>0){var Ae=Date.now(),Ie=pc(J.map(function(De){return De.cell}),J.map(function(De){return De.score}),.7);P.stage1_nms=Date.now()-Ae,pe=Ie.map(function(De){return J[De].score}),ie=Ie.map(function(De){return J[De]}).map(function(De){var et=De.cell,ot=De.region;return new Ba(et.left+ot.left*et.width,et.top+ot.top*et.height,et.right+ot.right*et.width,et.bottom+ot.bottom*et.height).toSquare().round()})}return{boxes:ie,scores:pe}}function Cy($,M,T){var A=T.width,P=T.height;return Object(tr.b)(this,void 0,void 0,function(){var J,ie,pe,Ae=this;return Object(tr.d)(this,function(Ie){switch(Ie.label){case 0:return J=Mn($),[4,Promise.all(M.map(function(De){return Object(tr.b)(Ae,void 0,void 0,function(){var et,ot,Bt,Vt,yn,_n,Dn,Nn;return Object(tr.d)(this,function(Wn){return et=De.padAtBorders($.height,$.width),ot=et.y,Bt=et.ey,Vt=et.x,yn=et.ex,_n=Vt-1,Dn=ot-1,Nn=J.getImageData(_n,Dn,yn-_n,Bt-Dn),[2,on.isNodejs()?ai(Nn):createImageBitmap(Nn)]})})}))];case 1:return ie=Ie.sent(),pe=[],ie.forEach(function(De){var et=Mn(Ir({width:A,height:P}));et.drawImage(De,0,0,A,P);for(var ot=et.getImageData(0,0,A,P).data,Bt=[],Vt=0;Vt<ot.length;Vt+=4)Bt.push(ot[Vt+2]),Bt.push(ot[Vt+1]),Bt.push(ot[Vt]);pe.push(Bt)}),[2,pe.map(function(De){return vn.tidy(function(){return yv(vn.transpose(vn.tensor4d(De,[1,A,P,3]),[0,2,1,3]).toFloat())})})]}})})}function Of($,M,T,A,P){return Object(tr.b)(this,void 0,void 0,function(){var J,ie,pe,Ae,Ie,De,et,ot,Bt,Vt,yn,_n,Dn,Nn;return Object(tr.d)(this,function(Wn){switch(Wn.label){case 0:return J=Date.now(),[4,Cy($,M,{width:24,height:24})];case 1:return ie=Wn.sent(),P.stage2_extractImagePatches=Date.now()-J,J=Date.now(),pe=ie.map(function(Jn){var Cn=function(wr,Dr){return vn.tidy(function(){var Nr=a0(wr,Dr),Yr=um(aa(vn.reshape(Nr,[Nr.shape[0],Dr.fc1.weights.shape[0]]),Dr.fc1),Dr.prelu4_alpha),jr=aa(Yr,Dr.fc2_1),Si=vn.expandDims(vn.max(jr,1),1),Fi=vn.softmax(vn.sub(jr,Si),1),Ni=aa(Yr,Dr.fc2_2);return{scores:vn.unstack(Fi,1)[1],regions:Ni}})}(Jn,A);return Jn.dispose(),Cn}),P.stage2_rnet=Date.now()-J,Ae=pe.length>1?vn.concat(pe.map(function(Jn){return Jn.scores})):pe[0].scores,et=(De=Array).from,[4,Ae.data()];case 2:return Ie=et.apply(De,[Wn.sent()]),Ae.dispose(),ot=Ie.map(function(Jn,Cn){return{score:Jn,idx:Cn}}).filter(function(Jn){return Jn.score>T}).map(function(Jn){return Jn.idx}),Bt=ot.map(function(Jn){return M[Jn]}),Vt=ot.map(function(Jn){return Ie[Jn]}),yn=[],_n=[],Bt.length>0&&(J=Date.now(),Dn=pc(Bt,Vt,.7),P.stage2_nms=Date.now()-J,Nn=Dn.map(function(Jn){var Cn=pe[ot[Jn]].regions.arraySync();return new mc(Cn[0][0],Cn[0][1],Cn[0][2],Cn[0][3])}),_n=Dn.map(function(Jn){return Vt[Jn]}),yn=Dn.map(function(Jn,Cn){return Bt[Jn].calibrate(Nn[Cn])})),pe.forEach(function(Jn){Jn.regions.dispose(),Jn.scores.dispose()}),[2,{boxes:yn,scores:_n}]}})})}function Gh($,M,T,A,P){return Object(tr.b)(this,void 0,void 0,function(){var J,ie,pe,Ae,Ie,De,et,ot,Bt,Vt,yn,_n,Dn,Nn,Wn;return Object(tr.d)(this,function(Jn){switch(Jn.label){case 0:return J=Date.now(),[4,Cy($,M,{width:48,height:48})];case 1:return ie=Jn.sent(),P.stage3_extractImagePatches=Date.now()-J,J=Date.now(),pe=ie.map(function(Cn){var wr=function(Dr,Nr){return vn.tidy(function(){var Yr=a0(Dr,Nr);Yr=um(Yr=ha(Yr=vn.maxPool(Yr,[2,2],[2,2],"same"),Nr.conv4,"valid"),Nr.prelu4_alpha);var jr=um(aa(vn.reshape(Yr,[Yr.shape[0],Nr.fc1.weights.shape[0]]),Nr.fc1),Nr.prelu5_alpha),Si=aa(jr,Nr.fc2_1),Fi=vn.expandDims(vn.max(Si,1),1),Ni=vn.softmax(vn.sub(Si,Fi),1),Ao=aa(jr,Nr.fc2_2),Xo=aa(jr,Nr.fc2_3);return{scores:vn.unstack(Ni,1)[1],regions:Ao,points:Xo}})}(Cn,A);return Cn.dispose(),wr}),P.stage3_onet=Date.now()-J,Ae=pe.length>1?vn.concat(pe.map(function(Cn){return Cn.scores})):pe[0].scores,et=(De=Array).from,[4,Ae.data()];case 2:return Ie=et.apply(De,[Jn.sent()]),Ae.dispose(),ot=Ie.map(function(Cn,wr){return{score:Cn,idx:wr}}).filter(function(Cn){return Cn.score>T}).map(function(Cn){return Cn.idx}),Bt=ot.map(function(Cn){var wr=pe[Cn].regions.arraySync();return new mc(wr[0][0],wr[0][1],wr[0][2],wr[0][3])}),Vt=ot.map(function(Cn,wr){return M[Cn].calibrate(Bt[wr])}),yn=ot.map(function(Cn){return Ie[Cn]}),_n=[],Dn=[],Nn=[],Vt.length>0&&(J=Date.now(),Wn=pc(Vt,yn,.7,!1),P.stage3_nms=Date.now()-J,_n=Wn.map(function(Cn){return Vt[Cn]}),Dn=Wn.map(function(Cn){return yn[Cn]}),Nn=Wn.map(function(Cn,wr){return Array(5).fill(0).map(function(Dr,Nr){var Yr=pe[Cn].points.arraySync();return new vo(Yr[0][Nr]*(_n[wr].width+1)+_n[wr].left,Yr[0][Nr+5]*(_n[wr].height+1)+_n[wr].top)})})),pe.forEach(function(Cn){Cn.regions.dispose(),Cn.scores.dispose(),Cn.points.dispose()}),[2,{boxes:_n,scores:Dn,points:Nn}]}})})}var Nd=function($){function M(){return $.call(this,"Mtcnn")||this}return Object(tr.c)(M,$),M.prototype.load=function(T){return Object(tr.b)(this,void 0,void 0,function(){return Object(tr.d)(this,function(A){return console.warn("mtcnn is deprecated and will be removed soon"),[2,$.prototype.load.call(this,T)]})})},M.prototype.loadFromDisk=function(T){return Object(tr.b)(this,void 0,void 0,function(){return Object(tr.d)(this,function(A){return console.warn("mtcnn is deprecated and will be removed soon"),[2,$.prototype.loadFromDisk.call(this,T)]})})},M.prototype.forwardInput=function(T,A){return A===void 0&&(A={}),Object(tr.b)(this,void 0,void 0,function(){var P,J,ie,pe,Ae,Ie,De,et,ot,Bt,Vt,yn,_n,Dn,Nn,Wn,Jn,Cn,wr,Dr,Nr;return Object(tr.d)(this,function(Yr){switch(Yr.label){case 0:if(!(P=this.params))throw new Error("Mtcnn - load model before inference");if(!(J=T.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return ie={},pe=Date.now(),Ae=vn.tidy(function(){return function(jr){return vn.tidy(function(){return vn.stack(vn.unstack(jr,3).reverse(),3)})}(vn.expandDims(vn.browser.fromPixels(J)).toFloat())}),Ie=function(jr){return Ae.dispose(),ie.total=Date.now()-pe,jr},De=Ae.shape.slice(1),et=De[0],ot=De[1],Bt=new al(A),Vt=Bt.minFaceSize,yn=Bt.scaleFactor,_n=Bt.maxNumScales,Dn=Bt.scoreThresholds,Nn=Bt.scaleSteps,Wn=(Nn||function(jr,Si,Fi){for(var Ni=Fi[0],Ao=Fi[1],Xo=Af/jr,Po=[],Ro=Math.min(Ni,Ao)*Xo,Uo=0;Ro>=12;)Po.push(Xo*Math.pow(Si,Uo)),Ro*=Si,Uo+=1;return Po}(Vt,yn,[et,ot])).filter(function(jr){var Si=Qu(jr,[et,ot]);return Math.min(Si.width,Si.height)>Af}).slice(0,_n),ie.scales=Wn,ie.pyramid=Wn.map(function(jr){return Qu(jr,[et,ot])}),Jn=Date.now(),[4,F1(Ae,Wn,Dn[0],P.pnet,ie)];case 1:return Cn=Yr.sent(),ie.total_stage1=Date.now()-Jn,Cn.boxes.length?(ie.stage2_numInputBoxes=Cn.boxes.length,Jn=Date.now(),[4,Of(J,Cn.boxes,Dn[1],P.rnet,ie)]):[2,Ie({results:[],stats:ie})];case 2:return wr=Yr.sent(),ie.total_stage2=Date.now()-Jn,wr.boxes.length?(ie.stage3_numInputBoxes=wr.boxes.length,Jn=Date.now(),[4,Gh(J,wr.boxes,Dn[2],P.onet,ie)]):[2,Ie({results:[],stats:ie})];case 3:return Dr=Yr.sent(),ie.total_stage3=Date.now()-Jn,Nr=Dr.boxes.map(function(jr,Si){return $o(Ad({},new ra(Dr.scores[Si],new Fl(jr.left/ot,jr.top/et,jr.width/ot,jr.height/et),{height:et,width:ot})),new $u(Dr.points[Si].map(function(Fi){return Fi.sub(new vo(jr.left,jr.top)).div(new vo(jr.width,jr.height))}),{width:jr.width,height:jr.height}))}),[2,Ie({results:Nr,stats:ie})]}})})},M.prototype.forward=function(T,A){return A===void 0&&(A={}),Object(tr.b)(this,void 0,void 0,function(){var P;return Object(tr.d)(this,function(J){switch(J.label){case 0:return P=this.forwardInput,[4,pi(T)];case 1:return[4,P.apply(this,[J.sent(),A])];case 2:return[2,J.sent().results]}})})},M.prototype.forwardWithStats=function(T,A){return A===void 0&&(A={}),Object(tr.b)(this,void 0,void 0,function(){var P;return Object(tr.d)(this,function(J){switch(J.label){case 0:return P=this.forwardInput,[4,pi(T)];case 1:return[2,P.apply(this,[J.sent(),A])]}})})},M.prototype.getDefaultModelName=function(){return"mtcnn_model"},M.prototype.extractParamsFromWeigthMap=function(T){return ng(T)},M.prototype.extractParams=function(T){return vv(T)},M}(Ui),Id=.4,bv=[new vo(1.603231,2.094468),new vo(6.041143,7.080126),new vo(2.882459,3.518061),new vo(4.266906,5.178857),new vo(9.041765,10.66308)],s0=[117.001,114.697,97.404],Fd=function($){function M(){var T={withSeparableConvs:!0,iouThreshold:Id,classes:["face"],anchors:bv,meanRgb:s0,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return $.call(this,T)||this}return Object(tr.c)(M,$),Object.defineProperty(M.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),M.prototype.locateFaces=function(T,A){return Object(tr.b)(this,void 0,void 0,function(){return Object(tr.d)(this,function(P){switch(P.label){case 0:return[4,this.detect(T,A)];case 1:return[2,P.sent().map(function(J){return new ra(J.score,J.relativeBox,{width:J.imageWidth,height:J.imageHeight})})]}})})},M.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},M.prototype.extractParamsFromWeigthMap=function(T){return $.prototype.extractParamsFromWeigthMap.call(this,T)},M}(Dd),po={ssdMobilenetv1:new am,tinyFaceDetector:new Fd,tinyYolov2:new Hh,mtcnn:new Nd,faceLandmark68Net:new Jg,faceLandmark68TinyNet:new Qg,faceRecognitionNet:new rm,faceExpressionNet:new go,ageGenderNet:new iv},Tf=function($,M){return po.ssdMobilenetv1.locateFaces($,M)},qh=function($,M){return po.tinyFaceDetector.locateFaces($,M)},Ay=function($,M){return po.tinyYolov2.locateFaces($,M)},Oy=function($,M){return po.mtcnn.forward($,M)},rg=function($){return po.faceLandmark68Net.detectLandmarks($)},Mf=function($){return po.faceLandmark68TinyNet.detectLandmarks($)},zl=function($){return po.faceRecognitionNet.computeFaceDescriptor($)},cm=function($){return po.faceExpressionNet.predictExpressions($)},$h=function($){return po.ageGenderNet.predictAgeAndGender($)},Rd=function($){return po.ssdMobilenetv1.load($)},Df=function($){return po.tinyFaceDetector.load($)},Nf=function($){return po.mtcnn.load($)},Zu=function($){return po.tinyYolov2.load($)},Xh=function($){return po.faceLandmark68Net.load($)},Pd=function($){return po.faceLandmark68TinyNet.load($)},Ul=function($){return po.faceRecognitionNet.load($)},ul=function($){return po.faceExpressionNet.load($)},Ld=function($){return po.ageGenderNet.load($)},ig=Rd,Bd=Tf,cl=rg,ds=function($){function M(T,A,P){var J=$.call(this)||this;return J.parentTask=T,J.input=A,J.extractedFaces=P,J}return Object(tr.c)(M,$),M}(jl),Lc=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.run=function(){return Object(tr.b)(this,void 0,void 0,function(){var T,A,P=this;return Object(tr.d)(this,function(J){switch(J.label){case 0:return[4,this.parentTask];case 1:return[4,Ju(T=J.sent(),this.input,function(ie){return Object(tr.b)(P,void 0,void 0,function(){return Object(tr.d)(this,function(pe){switch(pe.label){case 0:return[4,Promise.all(ie.map(function(Ae){return po.faceExpressionNet.predictExpressions(Ae)}))];case 1:return[2,pe.sent()]}})})},this.extractedFaces)];case 2:return A=J.sent(),[2,T.map(function(ie,pe){return ns(ie,A[pe])})]}})})},M.prototype.withAgeAndGender=function(){return new u0(this,this.input)},M}(ds),ec=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.run=function(){return Object(tr.b)(this,void 0,void 0,function(){var T,A;return Object(tr.d)(this,function(P){switch(P.label){case 0:return[4,this.parentTask];case 1:return(T=P.sent())?[4,kf(T,this.input,function(J){return po.faceExpressionNet.predictExpressions(J)},this.extractedFaces)]:[2];case 2:return A=P.sent(),[2,ns(T,A)]}})})},M.prototype.withAgeAndGender=function(){return new c0(this,this.input)},M}(ds),Nu=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.withAgeAndGender=function(){return new lm(this,this.input)},M.prototype.withFaceDescriptors=function(){return new Bc(this,this.input)},M}(Lc),Kh=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.withAgeAndGender=function(){return new zo(this,this.input)},M.prototype.withFaceDescriptor=function(){return new jd(this,this.input)},M}(ec),og=function($){function M(T,A,P){var J=$.call(this)||this;return J.parentTask=T,J.input=A,J.extractedFaces=P,J}return Object(tr.c)(M,$),M}(jl),u0=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.run=function(){return Object(tr.b)(this,void 0,void 0,function(){var T,A,P=this;return Object(tr.d)(this,function(J){switch(J.label){case 0:return[4,this.parentTask];case 1:return[4,Ju(T=J.sent(),this.input,function(ie){return Object(tr.b)(P,void 0,void 0,function(){return Object(tr.d)(this,function(pe){switch(pe.label){case 0:return[4,Promise.all(ie.map(function(Ae){return po.ageGenderNet.predictAgeAndGender(Ae)}))];case 1:return[2,pe.sent()]}})})},this.extractedFaces)];case 2:return A=J.sent(),[2,T.map(function(ie,pe){var Ae=A[pe],Ie=Ae.age;return t0(Md(ie,Ae.gender,Ae.genderProbability),Ie)})]}})})},M.prototype.withFaceExpressions=function(){return new Lc(this,this.input)},M}(og),c0=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.run=function(){return Object(tr.b)(this,void 0,void 0,function(){var T,A,P,J,ie;return Object(tr.d)(this,function(pe){switch(pe.label){case 0:return[4,this.parentTask];case 1:return(T=pe.sent())?[4,kf(T,this.input,function(Ae){return po.ageGenderNet.predictAgeAndGender(Ae)},this.extractedFaces)]:[2];case 2:return A=pe.sent(),P=A.age,J=A.gender,ie=A.genderProbability,[2,t0(Md(T,J,ie),P)]}})})},M.prototype.withFaceExpressions=function(){return new ec(this,this.input)},M}(og),lm=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.withFaceExpressions=function(){return new Nu(this,this.input)},M.prototype.withFaceDescriptors=function(){return new Bc(this,this.input)},M}(u0),zo=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.withFaceExpressions=function(){return new Kh(this,this.input)},M.prototype.withFaceDescriptor=function(){return new jd(this,this.input)},M}(c0),fm=function($){function M(T,A){var P=$.call(this)||this;return P.parentTask=T,P.input=A,P}return Object(tr.c)(M,$),M}(jl),Bc=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.run=function(){return Object(tr.b)(this,void 0,void 0,function(){var T;return Object(tr.d)(this,function(A){switch(A.label){case 0:return[4,this.parentTask];case 1:return[4,Ju(T=A.sent(),this.input,function(P){return Promise.all(P.map(function(J){return po.faceRecognitionNet.computeFaceDescriptor(J)}))},null,function(P){return P.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,A.sent().map(function(P,J){return e0(T[J],P)})]}})})},M.prototype.withFaceExpressions=function(){return new Nu(this,this.input)},M.prototype.withAgeAndGender=function(){return new lm(this,this.input)},M}(fm),jd=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.run=function(){return Object(tr.b)(this,void 0,void 0,function(){var T,A;return Object(tr.d)(this,function(P){switch(P.label){case 0:return[4,this.parentTask];case 1:return(T=P.sent())?[4,kf(T,this.input,function(J){return po.faceRecognitionNet.computeFaceDescriptor(J)},null,function(J){return J.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return A=P.sent(),[2,e0(T,A)]}})})},M.prototype.withFaceExpressions=function(){return new Kh(this,this.input)},M.prototype.withAgeAndGender=function(){return new zo(this,this.input)},M}(fm),zd=function($){function M(T,A,P){var J=$.call(this)||this;return J.parentTask=T,J.input=A,J.useTinyLandmarkNet=P,J}return Object(tr.c)(M,$),Object.defineProperty(M.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?po.faceLandmark68TinyNet:po.faceLandmark68Net},enumerable:!0,configurable:!0}),M}(jl),dm=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.run=function(){return Object(tr.b)(this,void 0,void 0,function(){var T,A,P,J,ie,pe=this;return Object(tr.d)(this,function(Ae){switch(Ae.label){case 0:return[4,this.parentTask];case 1:return T=Ae.sent(),A=T.map(function(Ie){return Ie.detection}),this.input instanceof vn.Tensor?[4,lo(this.input,A)]:[3,3];case 2:return J=Ae.sent(),[3,5];case 3:return[4,fo(this.input,A)];case 4:J=Ae.sent(),Ae.label=5;case 5:return P=J,[4,Promise.all(P.map(function(Ie){return pe.landmarkNet.detectLandmarks(Ie)}))];case 6:return ie=Ae.sent(),P.forEach(function(Ie){return Ie instanceof vn.Tensor&&Ie.dispose()}),[2,T.map(function(Ie,De){return $o(Ie,ie[De])})]}})})},M.prototype.withFaceExpressions=function(){return new Nu(this,this.input)},M.prototype.withAgeAndGender=function(){return new lm(this,this.input)},M.prototype.withFaceDescriptors=function(){return new Bc(this,this.input)},M}(zd),ag=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.run=function(){return Object(tr.b)(this,void 0,void 0,function(){var T,A,P,J,ie;return Object(tr.d)(this,function(pe){switch(pe.label){case 0:return[4,this.parentTask];case 1:return(T=pe.sent())?(A=T.detection,this.input instanceof vn.Tensor?[4,lo(this.input,[A])]:[3,3]):[2];case 2:return J=pe.sent(),[3,5];case 3:return[4,fo(this.input,[A])];case 4:J=pe.sent(),pe.label=5;case 5:return P=J,[4,this.landmarkNet.detectLandmarks(P[0])];case 6:return ie=pe.sent(),P.forEach(function(Ae){return Ae instanceof vn.Tensor&&Ae.dispose()}),[2,$o(T,ie)]}})})},M.prototype.withFaceExpressions=function(){return new Kh(this,this.input)},M.prototype.withAgeAndGender=function(){return new zo(this,this.input)},M.prototype.withFaceDescriptor=function(){return new jd(this,this.input)},M}(zd),sg=function($){function M(T,A){A===void 0&&(A=new sl);var P=$.call(this)||this;return P.input=T,P.options=A,P}return Object(tr.c)(M,$),M}(jl),ug=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.run=function(){return Object(tr.b)(this,void 0,void 0,function(){var T,A,P,J;return Object(tr.d)(this,function(ie){switch(ie.label){case 0:return A=(T=this).input,(P=T.options)instanceof al?[4,po.mtcnn.forward(A,P)]:[3,2];case 1:return[2,ie.sent().map(function(pe){return pe.detection})];case 2:if(!(J=P instanceof tg?function(pe){return po.tinyFaceDetector.locateFaces(pe,P)}:P instanceof sl?function(pe){return po.ssdMobilenetv1.locateFaces(pe,P)}:P instanceof Vh?function(pe){return po.tinyYolov2.locateFaces(pe,P)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,J(A)]}})})},M.prototype.runAndExtendWithFaceDetections=function(){var T=this;return new Promise(function(A){return Object(tr.b)(T,void 0,void 0,function(){var P;return Object(tr.d)(this,function(J){switch(J.label){case 0:return[4,this.run()];case 1:return P=J.sent(),[2,A(P.map(function(ie){return Ad({},ie)}))]}})})})},M.prototype.withFaceLandmarks=function(T){return T===void 0&&(T=!1),new dm(this.runAndExtendWithFaceDetections(),this.input,T)},M.prototype.withFaceExpressions=function(){return new Lc(this.runAndExtendWithFaceDetections(),this.input)},M.prototype.withAgeAndGender=function(){return new u0(this.runAndExtendWithFaceDetections(),this.input)},M}(sg),xv=function($){function M(){return $!==null&&$.apply(this,arguments)||this}return Object(tr.c)(M,$),M.prototype.run=function(){return Object(tr.b)(this,void 0,void 0,function(){var T,A;return Object(tr.d)(this,function(P){switch(P.label){case 0:return[4,new ug(this.input,this.options)];case 1:return T=P.sent(),A=T[0],T.forEach(function(J){J.score>A.score&&(A=J)}),[2,A]}})})},M.prototype.runAndExtendWithFaceDetection=function(){var T=this;return new Promise(function(A){return Object(tr.b)(T,void 0,void 0,function(){var P;return Object(tr.d)(this,function(J){switch(J.label){case 0:return[4,this.run()];case 1:return P=J.sent(),[2,A(P?Ad({},P):void 0)]}})})})},M.prototype.withFaceLandmarks=function(T){return T===void 0&&(T=!1),new ag(this.runAndExtendWithFaceDetection(),this.input,T)},M.prototype.withFaceExpressions=function(){return new ec(this.runAndExtendWithFaceDetection(),this.input)},M.prototype.withAgeAndGender=function(){return new c0(this.runAndExtendWithFaceDetection(),this.input)},M}(sg);function cg($,M){return M===void 0&&(M=new sl),new xv($,M)}function If($,M){return M===void 0&&(M=new sl),new ug($,M)}function lg($,M){return Object(tr.b)(this,void 0,void 0,function(){return Object(tr.d)(this,function(T){switch(T.label){case 0:return console.warn("allFacesSsdMobilenetv1 is deprecated and will be removed soon, use the high level api instead"),[4,If($,new sl(M?{minConfidence:M}:{})).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,T.sent()]}})})}function Yh($,M){return M===void 0&&(M={}),Object(tr.b)(this,void 0,void 0,function(){return Object(tr.d)(this,function(T){switch(T.label){case 0:return console.warn("allFacesTinyYolov2 is deprecated and will be removed soon, use the high level api instead"),[4,If($,new Vh(M)).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,T.sent()]}})})}function fg($,M){return M===void 0&&(M={}),Object(tr.b)(this,void 0,void 0,function(){return Object(tr.d)(this,function(T){switch(T.label){case 0:return console.warn("allFacesMtcnn is deprecated and will be removed soon, use the high level api instead"),[4,If($,new al(M)).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,T.sent()]}})})}var l0=lg;function f0($,M){if($.length!==M.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var T=Array.from($),A=Array.from(M);return Math.sqrt(T.map(function(P,J){return P-A[J]}).reduce(function(P,J){return P+Math.pow(J,2)},0))}var hm=function(){function $(M,T){T===void 0&&(T=.6),this._distanceThreshold=T;var A=Array.isArray(M)?M:[M];if(!A.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var P=1,J=function(){return"person "+P++};this._labeledDescriptors=A.map(function(ie){if(ie instanceof kd)return ie;if(ie instanceof Float32Array)return new kd(J(),[ie]);if(ie.descriptor&&ie.descriptor instanceof Float32Array)return new kd(J(),[ie.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty($.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),$.prototype.computeMeanDistance=function(M,T){return T.map(function(A){return f0(A,M)}).reduce(function(A,P){return A+P},0)/(T.length||1)},$.prototype.matchDescriptor=function(M){var T=this;return this.labeledDescriptors.map(function(A){var P=A.descriptors,J=A.label;return new _u(J,T.computeMeanDistance(M,P))}).reduce(function(A,P){return A.distance<P.distance?A:P})},$.prototype.findBestMatch=function(M){var T=this.matchDescriptor(M);return T.distance<this.distanceThreshold?T:new _u("unknown",T.distance)},$.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(M){return M.toJSON()})}},$.fromJSON=function(M){return new $(M.labeledDescriptors.map(function(T){return kd.fromJSON(T)}),M.distanceThreshold)},$}();function d0($){var M=new Nd;return M.extractWeights($),M}function dg($){var M=new Fd;return M.extractWeights($),M}function wv($,M){var T=new Ls(M.width,M.height),A=T.width,P=T.height;if(A<=0||P<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:A,height:P}));if(Array.isArray($))return $.map(function(pe){return wv(pe,{width:A,height:P})});if(il($)){var J=$.detection.forSize(A,P),ie=$.unshiftedLandmarks.forSize(J.box.width,J.box.height);return $o(Ad($,J),ie)}return Ef($)?Ad($,$.detection.forSize(A,P)):$ instanceof cu||$ instanceof ra?$.forSize(A,P):$}var Wl={withLandmarks:!0,withDescriptors:!0,minConfidence:.5,withTinyNet:!0,MODEL_URLS:{Mobilenetv1Model:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/ssd_mobilenetv1_model-weights_manifest.json",TinyFaceDetectorModel:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/tiny_face_detector_model-weights_manifest.json",FaceLandmarkModel:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/face_landmark_68_model-weights_manifest.json",FaceLandmark68TinyNet:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/face_landmark_68_tiny_model-weights_manifest.json",FaceRecognitionModel:"https://raw.githubusercontent.com/ml5js/ml5-data-and-models/main/models/faceapi/face_recognition_model-weights_manifest.json"}},Ty=function(){function $(M,T,A){ce()(this,$),this.video=M,this.model=null,this.modelReady=!1,this.detectorOptions=null,this.config={minConfidence:this.checkUndefined(T.minConfidence,Wl.minConfidence),withLandmarks:this.checkUndefined(T.withLandmarks,Wl.withLandmarks),withDescriptors:this.checkUndefined(T.withDescriptors,Wl.withDescriptors),withTinyNet:this.checkUndefined(T.withTinyNet,Wl.withTinyNet),MODEL_URLS:{Mobilenetv1Model:this.checkUndefined(T.Mobilenetv1Model,Wl.MODEL_URLS.Mobilenetv1Model),TinyFaceDetectorModel:this.checkUndefined(T.TinyFaceDetectorModel,Wl.MODEL_URLS.TinyFaceDetectorModel),FaceLandmarkModel:this.checkUndefined(T.FaceLandmarkModel,Wl.MODEL_URLS.FaceLandmarkModel),FaceLandmark68TinyNet:this.checkUndefined(T.FaceLandmark68TinyNet,Wl.MODEL_URLS.FaceLandmark68TinyNet),FaceRecognitionModel:this.checkUndefined(T.FaceRecognitionModel,Wl.MODEL_URLS.FaceRecognitionModel)}},this.ready=Ge(this.loadModel(),A)}return Ee()($,[{key:"loadModel",value:function(){var M=G()(ge.a.mark(function T(){var A,P,J,ie,pe,Ae,Ie,De=this;return ge.a.wrap(function(et){for(;;)switch(et.prev=et.next){case 0:if(A=["Mobilenetv1Model","TinyFaceDetectorModel","FaceLandmarkModel","FaceLandmark68TinyNet","FaceRecognitionModel"],Object.keys(this.config.MODEL_URLS).forEach(function(ot){A.includes(ot)&&(De.config.MODEL_URLS[ot]=uc.getModelPath(De.config.MODEL_URLS[ot]))}),P=this.config.MODEL_URLS,J=P.Mobilenetv1Model,ie=P.TinyFaceDetectorModel,pe=P.FaceLandmarkModel,Ae=P.FaceRecognitionModel,Ie=P.FaceLandmark68TinyNet,this.model=L,this.config.withTinyNet===!0?this.detectorOptions=new tg({minConfidence:this.minConfidence,inputSize:512}):this.detectorOptions=new sl({minConfidence:this.minConfidence}),this.config.withTinyNet!==!0){et.next=12;break}return et.next=8,this.model.loadFaceLandmarkTinyModel(Ie);case 8:return et.next=10,this.model.loadTinyFaceDetectorModel(ie);case 10:et.next=16;break;case 12:return et.next=14,this.model.loadFaceLandmarkModel(pe);case 14:return et.next=16,this.model.loadSsdMobilenetv1Model(J);case 16:return et.next=18,this.model.loadFaceRecognitionModel(Ae);case 18:return this.modelReady=!0,et.abrupt("return",this);case 20:case"end":return et.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"detect",value:function(){var M=G()(ge.a.mark(function T(A,P,J){var ie,pe,Ae;return ge.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:if(ie=this.video,Ae=this.config,typeof A!="function"){Ie.next=7;break}ie=this.video,pe=A,Ie.next=21;break;case 7:if(!(A instanceof HTMLImageElement||A instanceof HTMLCanvasElement||A instanceof HTMLVideoElement||A instanceof ImageData)){Ie.next=11;break}ie=A,Ie.next=21;break;case 11:if(we()(A)!=="object"||!(A.elt instanceof HTMLImageElement||A.elt instanceof HTMLCanvasElement||A.elt instanceof HTMLVideoElement||A.elt instanceof ImageData)){Ie.next=15;break}ie=A.elt,Ie.next=21;break;case 15:if(!(we()(A)==="object"&&A.canvas instanceof HTMLCanvasElement)){Ie.next=19;break}ie=A.canvas,Ie.next=21;break;case 19:if(this.video instanceof HTMLVideoElement){Ie.next=21;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 21:return we()(P)==="object"?Ae=P:typeof P=="function"&&(pe=P),typeof J=="function"&&(pe=J),Ie.abrupt("return",Ge(this.detectInternal(ie,Ae),pe));case 24:case"end":return Ie.stop()}},T,this)}));return function(T,A,P){return M.apply(this,arguments)}}()},{key:"detectInternal",value:function(){var M=G()(ge.a.mark(function T(A,P){var J,ie,pe,Ae,Ie=this;return ge.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return De.next=2,this.ready;case 2:return De.next=4,I.nextFrame();case 4:if(!this.video||this.video.readyState!==0){De.next=7;break}return De.next=7,new Promise(function(et){Ie.video.onloadeddata=function(){return et()}});case 7:if(this.config=this.setReturnOptions(P),J=this.config,ie=J.withLandmarks,pe=J.withDescriptors,!ie){De.next=21;break}if(!pe){De.next=16;break}return De.next=13,this.model.detectAllFaces(A,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptors();case 13:Ae=De.sent,De.next=19;break;case 16:return De.next=18,this.model.detectAllFaces(A,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet);case 18:Ae=De.sent;case 19:De.next=30;break;case 21:if(ie){De.next=27;break}return De.next=24,this.model.detectAllFaces(A);case 24:Ae=De.sent,De.next=30;break;case 27:return De.next=29,this.model.detectAllFaces(A,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptors();case 29:Ae=De.sent;case 30:return Ae=this.resizeResults(Ae,A.width,A.height),Ae=this.landmarkParts(Ae),De.abrupt("return",Ae);case 33:case"end":return De.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()},{key:"detectSingle",value:function(){var M=G()(ge.a.mark(function T(A,P,J){var ie,pe,Ae;return ge.a.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:if(ie=this.video,Ae=this.config,typeof A!="function"){Ie.next=7;break}ie=this.video,pe=A,Ie.next=21;break;case 7:if(!(A instanceof HTMLImageElement||A instanceof HTMLCanvasElement||A instanceof HTMLVideoElement||A instanceof ImageData)){Ie.next=11;break}ie=A,Ie.next=21;break;case 11:if(we()(A)!=="object"||!(A.elt instanceof HTMLImageElement||A.elt instanceof HTMLCanvasElement||A.elt instanceof HTMLVideoElement||A.elt instanceof ImageData)){Ie.next=15;break}ie=A.elt,Ie.next=21;break;case 15:if(!(we()(A)==="object"&&A.canvas instanceof HTMLCanvasElement)){Ie.next=19;break}ie=A.canvas,Ie.next=21;break;case 19:if(this.video instanceof HTMLVideoElement){Ie.next=21;break}throw new Error("No input image provided. If you want to classify a video, pass the video element in the constructor. ");case 21:return we()(P)==="object"?Ae=P:typeof P=="function"&&(pe=P),typeof J=="function"&&(pe=J),Ie.abrupt("return",Ge(this.detectSingleInternal(ie,Ae),pe));case 24:case"end":return Ie.stop()}},T,this)}));return function(T,A,P){return M.apply(this,arguments)}}()},{key:"detectSingleInternal",value:function(){var M=G()(ge.a.mark(function T(A,P){var J,ie,pe,Ae,Ie=this;return ge.a.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return De.next=2,this.ready;case 2:return De.next=4,I.nextFrame();case 4:if(!this.video||this.video.readyState!==0){De.next=7;break}return De.next=7,new Promise(function(et){Ie.video.onloadeddata=function(){return et()}});case 7:if(this.config=this.setReturnOptions(P),J=this.config,ie=J.withLandmarks,pe=J.withDescriptors,!ie){De.next=21;break}if(!pe){De.next=16;break}return De.next=13,this.model.detectSingleFace(A,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptor();case 13:Ae=De.sent,De.next=19;break;case 16:return De.next=18,this.model.detectSingleFace(A,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet);case 18:Ae=De.sent;case 19:De.next=30;break;case 21:if(ie){De.next=27;break}return De.next=24,this.model.detectSingleFace(A);case 24:Ae=De.sent,De.next=30;break;case 27:return De.next=29,this.model.detectSingleFace(A,this.detectorOptions).withFaceLandmarks(this.config.withTinyNet).withFaceDescriptor();case 29:Ae=De.sent;case 30:return Ae=this.resizeResults(Ae,A.width,A.height),Ae=this.landmarkParts(Ae),De.abrupt("return",Ae);case 33:case"end":return De.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()},{key:"checkUndefined",value:function(M,T){return M!==void 0?M:T}},{key:"setReturnOptions",value:function(M){var T=this,A=Object.assign({},this.config);return["withLandmarks","withDescriptors"].forEach(function(P){M[P]!==void 0?T.config[P]=M[P]:A[P]=T.config[P]}),A}},{key:"resizeResults",value:function(M,T,A){if(T===void 0||A===void 0)throw new Error("width and height must be defined");return this.model.resizeResults(M,{width:T,height:A})}},{key:"landmarkParts",value:function(M){var T;if(Array.isArray(M)===!0)T=M.map(function(P){var J=Object.assign({},P);if(J.landmarks){var ie=J.landmarks;J.parts={mouth:ie.getMouth(),nose:ie.getNose(),leftEye:ie.getLeftEye(),leftEyeBrow:ie.getLeftEyeBrow(),rightEye:ie.getRightEye(),rightEyeBrow:ie.getRightEyeBrow(),jawOutline:ie.getJawOutline()}}else J.parts={mouth:[],nose:[],leftEye:[],leftEyeBrow:[],rightEye:[],rightEyeBrow:[],jawOutline:[]};return J});else if((T=Object.assign({},M)).landmarks){var A=M.landmarks;T.parts={mouth:A.getMouth(),nose:A.getNose(),leftEye:A.getLeftEye(),leftEyeBrow:A.getLeftEyeBrow(),rightEye:A.getRightEye(),rightEyeBrow:A.getRightEyeBrow()}}else T.parts={mouth:[],nose:[],leftEye:[],leftEyeBrow:[],rightEye:[],rightEyeBrow:[]};return T}}]),$}(),_v=function($,M,T){var A,P={},J=T;$ instanceof HTMLVideoElement?A=$:we()($)==="object"&&$.elt instanceof HTMLVideoElement?A=$.elt:we()($)==="object"?P=$:typeof $=="function"&&(J=$),we()(M)==="object"?(P=M,console.log(P)):typeof M=="function"&&(J=M);var ie=new Ty(A,P,J);return J?ie:ie.ready},pm={k:3,maxIter:5,threshold:.5};function Ev($){return Ff.apply(this,arguments)}function Ff(){return(Ff=G()(ge.a.mark(function $(M){var T,A;return ge.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return T=I.data.csv(M),P.next=3,T.toArray();case 3:return A=P.sent,P.abrupt("return",A);case 5:case"end":return P.stop()}},$)}))).apply(this,arguments)}function Sv($){return mm.apply(this,arguments)}function mm(){return(mm=G()(ge.a.mark(function $(M){var T,A;return ge.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(typeof M!="string"){P.next=6;break}return P.next=3,Ev(M);case 3:T=P.sent,P.next=7;break;case 6:T=M;case 7:return A=T.map(function(J){return Object.values(J)}),P.abrupt("return",A);case 9:case"end":return P.stop()}},$)}))).apply(this,arguments)}var hg=function(){function $(M,T,A){ce()(this,$),this.config={k:T.k||pm.k,maxIter:T.maxIter||pm.maxIter,threshold:T.threshold||pm.threshold},this.ready=Ge(this.load(M),A)}return Ee()($,[{key:"load",value:function(){var M=G()(ge.a.mark(function T(A){var P=this;return ge.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,Sv(A);case 2:return this.dataset=J.sent,I.tidy(function(){P.dataTensor=I.tensor2d(P.dataset),P.dataset.forEach(function(ie){var pe=I.tensor1d(Object.values(ie));ie.tensor=pe}),P.centroids=I.tensor2d(wd(P.dataset,P.config.k,!1)),P.fit()}),J.abrupt("return",this);case 5:case"end":return J.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"fit",value:function(){this.getClosestCentroids(),this.recenterCentroids();for(var M=$.getEuclidianDistance(this.centroids,this.centroidsOld),T=0;M>this.config.threshold&&T<this.config.maxIter;)this.getClosestCentroids(),this.recenterCentroids(),M=$.getEuclidianDistance(this.centroids,this.centroidsOld),T+=1}},{key:"getClosestCentroids",value:function(){var M=this;this.dataset.forEach(function(T){var A=M.closestCentroid(T.tensor);T.centroid=A})}},{key:"closestCentroid",value:function(M){var T=this;return I.tidy(function(){return T.centroids.squaredDifference(M).sum(1).sqrt().argMin().arraySync()})}},{key:"classify",value:function(M){var T=this;return I.tidy(function(){var A=I.tensor1d(Object.values(M));return T.closestCentroid(A)})}},{key:"recenterCentroids",value:function(){var M=this,T=I.tidy(function(){return M.centroidsOld=M.centroids,I.stack(M.centroids.unstack().map(function(A,P){var J=M.dataset.filter(function(ie){return ie.centroid===P}).map(function(ie){return ie.tensor});return J.length===0?A:J.length===1?J[0]:I.tidy(function(){return I.stack(J).mean(0)})}))});this.centroids=T}}],[{key:"getEuclidianDistance",value:function(M,T){return I.tidy(function(){return I.squaredDifference(M,T).sum().sqrt().dataSync()})[0]}}]),$}(),kv=function($,M,T){return new hg($,M,T)};function Cv($){return h0.apply(this,arguments)}function h0(){return(h0=G()(ge.a.mark(function $(M){var T,A;return ge.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return T=I.data.csv(M),P.next=3,T.toArray();case 3:return A=P.sent,P.abrupt("return",A);case 5:case"end":return P.stop()}},$)}))).apply(this,arguments)}function Av($){return Ov.apply(this,arguments)}function Ov(){return(Ov=G()(ge.a.mark(function $(M){var T,A;return ge.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(typeof M!="string"){P.next=6;break}return P.next=3,Cv(M);case 3:T=P.sent,P.next=7;break;case 6:T=M;case 7:return A=T.map(function(J){return Object.values(J)}),P.abrupt("return",A);case 9:case"end":return P.stop()}},$)}))).apply(this,arguments)}var Ud={eps:50,minPts:3},My=function(){function $(M,T,A){ce()(this,$),this.config={eps:T.eps||Ud.eps,minPts:T.minPts||Ud.minPts},this.lastClusterId=0,this.status=[],this.ready=Ge(this.load(M),A)}return Ee()($,[{key:"load",value:function(){var M=G()(ge.a.mark(function T(A){var P=this;return ge.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,Av(A);case 2:return this.dataset=J.sent,I.tidy(function(){P.dataTensor=I.tensor2d(P.dataset),P.dataset.forEach(function(ie){var pe=I.tensor1d(Object.values(ie));ie.tensor=pe}),P.fit()}),J.abrupt("return",this);case 5:case"end":return J.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"fit",value:function(){var M=this;this.dataset.forEach(function(T,A){if(T.status===void 0){T.status=0;var P=M.getNeighboursIndices(T);P.length<M.config.minPts?T.status=0:(M.incrementClusterId(),M.extend(A,P))}})}},{key:"extend",value:function(M,T){var A=this;this.dataset[M].clusterid=this.getClusterId(),this.dataset[M].status=this.dataset[M].clusterid,T.forEach(function(P){if(A.dataset[P].status===void 0){A.dataset[P].status=0;var J=A.getNeighboursIndices(A.dataset[P]);J.length>=A.config.minPts&&A.extend(P,J)}A.dataset[P].status<1&&(A.dataset[P].status=A.dataset[M].clusterid,A.dataset[P].clusterid=A.dataset[M].clusterid)})}},{key:"getClusterId",value:function(){return this.lastClusterId}},{key:"incrementClusterId",value:function(){this.lastClusterId+=1}},{key:"getNeighboursIndices",value:function(M){var T=this;try{return I.tidy(function(){var A=I.squaredDifference(M.tensor,T.dataTensor).sum(1).sqrt().topk(T.dataTensor.shape[0],!0),P=A.values,J=A.indices;return I.stack([P.asType("float32"),J.asType("float32")],1).arraySync().filter(function(ie){return ie[0]<=T.config.eps}).reduce(function(ie,pe){return ie.push(pe[1]),ie},[])})||[]}catch(A){console.log("error ".concat(A))}return[]}}]),$}(),Tv=function($,M,T){return new My($,M,T)},Vl={hosoda:"https://raw.githubusercontent.com/leemengtaiwan/tfjs-models/master/cartoongan/tfjs_json_models/hosoda/model.json",miyazaki:"https://raw.githubusercontent.com/Derek-Wds/training_CartoonGAN/master/tfModels/Miyazaki/model.json"},p0=function(){function $(M,T){ce()(this,$),this.config={modelUrl:M.modelUrl?M.modelUrl:Vl.miyazaki,returnTensors:!!M.returnTensors&&M.returnTensors},this.model={},this.ready=!1,this.ready=Ge(this.loadModel(this.config.modelUrl),T)}return Ee()($,[{key:"loadModel",value:function(){var M=G()(ge.a.mark(function T(A){return ge.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,I.loadGraphModel(A);case 2:return this.model=P.sent,P.abrupt("return",this);case 4:case"end":return P.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"generate",value:function(){var M=G()(ge.a.mark(function T(A,P){var J,ie;return ge.a.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:if(ie=P,!xn(A)){pe.next=5;break}J=A,pe.next=19;break;case 5:if(we()(A)!=="object"||!xn(A.elt)){pe.next=9;break}J=A.elt,pe.next=19;break;case 9:if(we()(A)!=="object"||!xn(A.canvas)){pe.next=13;break}J=A.canvas,pe.next=19;break;case 13:if(typeof A!="function"){pe.next=18;break}J=this.video,ie=A,pe.next=19;break;case 18:throw new Error("Detection subject not supported");case 19:return pe.abrupt("return",Ge(this.generateInternal(J),ie));case 20:case"end":return pe.stop()}},T,this)}));return function(T,A){return M.apply(this,arguments)}}()},{key:"generateInternal",value:function(){var M=G()(ge.a.mark(function T(A){var P,J,ie,pe;return ge.a.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:return Ae.next=2,this.ready;case 2:return Ae.next=4,I.nextFrame();case 4:if((P=I.browser.fromPixels(A).resizeBilinear([256,256])).shape[0]===256&&P.shape[1]===256){Ae.next=9;break}throw new Error("Input size should be ".concat(256,"*").concat(256," but ").concat(P.shape," is found"));case 9:if(P.shape[2]===3){Ae.next=11;break}throw new Error("Input color channel number should be 3 but ".concat(P.shape[2]," is found"));case 11:if(P=P.sub(127.5).div(127.5).reshape([1,256,256,3]),J=I.ones([256,256,1]).tile([1,1,1]).mul(255),ie=(ie=(ie=this.model.predict(P)).add(1).mul(127.5).reshape([256,256,3]).floor()).concat(J,2),pe=this.resultFinalize(ie),!this.config.returnTensors){Ae.next=19;break}return Ae.abrupt("return",pe);case 19:return P.dispose(),ie.dispose(),Ae.abrupt("return",pe);case 22:case"end":return Ae.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()},{key:"resultFinalize",value:function(){var M=G()(ge.a.mark(function T(A){var P,J,ie,pe;return ge.a.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:return P=A,Ae.next=3,A.data();case 3:return J=Ae.sent,Ae.next=6,Ht.rawToBlob(J,A.shape[0],A.shape[1]);case 6:return ie=Ae.sent,Ae.next=9,Ht.blobToP5Image(ie);case 9:if(pe=Ae.sent,!this.config.returnTensors){Ae.next=12;break}return Ae.abrupt("return",{tensor:P,raw:J,blob:ie,image:pe});case 12:return Ae.abrupt("return",{raw:J,blob:ie,image:pe});case 13:case"end":return Ae.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()}]),$}(),Mv=function($,M){var T=we()($)==="object"?$:{},A=typeof $=="function"?$:M;return typeof $=="string"&&(T.modelUrl=$),new p0(T,A)};function Wd($,M,T,A){return new(T||(T=Promise))(function(P,J){function ie(Ie){try{Ae(A.next(Ie))}catch(De){J(De)}}function pe(Ie){try{Ae(A.throw(Ie))}catch(De){J(De)}}function Ae(Ie){var De;Ie.done?P(Ie.value):(De=Ie.value,De instanceof T?De:new T(function(et){et(De)})).then(ie,pe)}Ae((A=A.apply($,M||[])).next())})}function Hl($,M){var T,A,P,J,ie={label:0,sent:function(){if(1&P[0])throw P[1];return P[1]},trys:[],ops:[]};return J={next:pe(0),throw:pe(1),return:pe(2)},typeof Symbol=="function"&&(J[Symbol.iterator]=function(){return this}),J;function pe(Ae){return function(Ie){return function(De){if(T)throw new TypeError("Generator is already executing.");for(;ie;)try{if(T=1,A&&(P=2&De[0]?A.return:De[0]?A.throw||((P=A.return)&&P.call(A),0):A.next)&&!(P=P.call(A,De[1])).done)return P;switch(A=0,P&&(De=[2&De[0],P.value]),De[0]){case 0:case 1:P=De;break;case 4:return ie.label++,{value:De[1],done:!1};case 5:ie.label++,A=De[1],De=[0];continue;case 7:De=ie.ops.pop(),ie.trys.pop();continue;default:if(!(P=(P=ie.trys).length>0&&P[P.length-1])&&(De[0]===6||De[0]===2)){ie=0;continue}if(De[0]===3&&(!P||De[1]>P[0]&&De[1]<P[3])){ie.label=De[1];break}if(De[0]===6&&ie.label<P[1]){ie.label=P[1],P=De;break}if(P&&ie.label<P[2]){ie.label=P[2],ie.ops.push(De);break}P[2]&&ie.ops.pop(),ie.trys.pop();continue}De=M.call($,ie)}catch(et){De=[6,et],A=0}finally{T=P=0}if(5&De[0])throw De[1];return{value:De[0]?De[1]:void 0,done:!0}}([Ae,Ie])}}}var pg=function($){for(var M=[],T=0,A=$;T<A.length;T++){var P=A[T];M.push(P)}return M},m0=function(){this.parent=null,this.children={},this.end=!1,this.word=[[],0,0]},jc=function(){function $(){this.root=new m0}return $.prototype.insert=function(M,T,A){for(var P=this.root,J=pg(M),ie=0;ie<J.length;ie++)P.children[J[ie]]||(P.children[J[ie]]=new m0,P.children[J[ie]].parent=P,P.children[J[ie]].word[0]=P.word[0].concat(J[ie])),P=P.children[J[ie]],ie===J.length-1&&(P.end=!0,P.word[1]=T,P.word[2]=A)},$.prototype.commonPrefixSearch=function(M){for(var T=[],A=this.root.children[M[0]],P=0;P<M.length&&A;P++)A.end&&T.push(A.word),A=A.children[M[P+1]];return T.length||T.push([[M[0]],0,0]),T},$}(),g0="",Dv=6,Rf=function(){function $(M,T){T===void 0&&(T=Dv),this.vocabulary=M,this.reservedSymbolsCount=T,this.trie=new jc;for(var A=this.reservedSymbolsCount;A<this.vocabulary.length;A++)this.trie.insert(this.vocabulary[A][0],this.vocabulary[A][1],A)}return $.prototype.encode=function(M){var T=[],A=[],P=[];M=function(Cn){var wr=Cn.normalize("NFKC");return wr.length>0?g0+wr.replace(/ /g,g0):wr}(M);for(var J=pg(M),ie=0;ie<=J.length;ie++)T.push({}),A.push(0),P.push(0);for(ie=0;ie<J.length;ie++)for(var pe=this.trie.commonPrefixSearch(J.slice(ie)),Ae=0;Ae<pe.length;Ae++){var Ie=pe[Ae],De={key:Ie[0],score:Ie[1],index:Ie[2]};T[ie+(et=Ie[0].length)][ie]==null&&(T[ie+et][ie]=[]),T[ie+et][ie].push(De)}for(var et=0;et<=J.length;et++)for(var ot in T[et]){var Bt=T[et][ot];for(Ae=0;Ae<Bt.length;Ae++){var Vt=Bt[Ae],yn=Vt.score+P[et-Vt.key.length];(P[et]===0||yn>=P[et])&&(P[et]=yn,A[et]=Bt[Ae].index)}}for(var _n=[],Dn=A.length-1;Dn>0;)_n.push(A[Dn]),Dn-=this.vocabulary[A[Dn]][0].length;var Nn=[],Wn=!1;for(ie=0;ie<_n.length;ie++){var Jn=_n[ie];Wn&&Jn===0||Nn.push(Jn),Wn=Jn===0}return Nn.reverse()},$}();function Dy($){return Wd(this,void 0,void 0,function(){var M;return Hl(this,function(T){switch(T.label){case 0:return[4,Jh($)];case 1:return M=T.sent(),[2,new Rf(M)]}})})}function Jh($){return Wd(this,void 0,void 0,function(){return Hl(this,function(M){switch(M.label){case 0:return[4,ze.util.fetch($)];case 1:return[2,M.sent().json()]}})})}function Qh($){return Wd(this,void 0,void 0,function(){var M;return Hl(this,function(T){switch(T.label){case 0:return[4,(M=new Pf).load($)];case 1:return T.sent(),[2,M]}})})}var Pf=function(){function $(){}return $.prototype.loadModel=function(M){return Wd(this,void 0,void 0,function(){return Hl(this,function(T){return[2,M?Object(Mt.loadGraphModel)(M):Object(Mt.loadGraphModel)("https://tfhub.dev/tensorflow/tfjs-model/universal-sentence-encoder-lite/1/default/1",{fromTFHub:!0})]})})},$.prototype.load=function(M){return M===void 0&&(M={}),Wd(this,void 0,void 0,function(){var T,A,P;return Hl(this,function(J){switch(J.label){case 0:return[4,Promise.all([this.loadModel(M.modelUrl),Jh(M.vocabUrl||"https://storage.googleapis.com/tfjs-models/savedmodel/universal_sentence_encoder/vocab.json")])];case 1:return T=J.sent(),A=T[0],P=T[1],this.model=A,this.tokenizer=new Rf(P),[2]}})})},$.prototype.embed=function(M){return Wd(this,void 0,void 0,function(){var T,A,P,J,ie,pe,Ae,Ie,De=this;return Hl(this,function(et){switch(et.label){case 0:for(typeof M=="string"&&(M=[M]),T=M.map(function(ot){return De.tokenizer.encode(ot)}),A=T.map(function(ot,Bt){return ot.map(function(Vt,yn){return[Bt,yn]})}),P=[],J=0;J<A.length;J++)P=P.concat(A[J]);return ie=Object(ze.tensor2d)(P,[P.length,2],"int32"),pe=Object(ze.tensor1d)(ze.util.flatten(T),"int32"),Ae={indices:ie,values:pe},[4,this.model.executeAsync(Ae)];case 1:return Ie=et.sent(),ie.dispose(),pe.dispose(),[2,Ie]}})})},$}(),Nv={withTokenizer:!1},Vd=function(){function $(M,T){ce()(this,$),this.model=null,this.tokenizer=null,this.config={withTokenizer:M.withTokenizer||Nv.withTokenizer},Ge(this.loadModel(),T)}return Ee()($,[{key:"loadModel",value:function(){var M=G()(ge.a.mark(function T(){return ge.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(this.config.withTokenizer!==!0){A.next=4;break}return A.next=3,Dy();case 3:this.tokenizer=A.sent;case 4:return A.next=6,Qh();case 6:return this.model=A.sent,A.abrupt("return",this);case 8:case"end":return A.stop()}},T,this)}));return function(){return M.apply(this,arguments)}}()},{key:"predict",value:function(M,T){return Ge(this.predictInternal(M),T)}},{key:"predictInternal",value:function(){var M=G()(ge.a.mark(function T(A){var P,J;return ge.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.prev=0,ie.next=3,this.model.embed(A);case 3:return P=ie.sent,ie.next=6,P.array();case 6:return J=ie.sent,P.dispose(),ie.abrupt("return",J);case 11:return ie.prev=11,ie.t0=ie.catch(0),console.error(ie.t0),ie.abrupt("return",ie.t0);case 15:case"end":return ie.stop()}},T,this,[[0,11]])}));return function(T){return M.apply(this,arguments)}}()},{key:"encode",value:function(M,T){return Ge(this.encodeInternal(M),T)}},{key:"encodeInternal",value:function(){var M=G()(ge.a.mark(function T(A){return ge.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(this.config.withTokenizer!==!0){P.next=2;break}return P.abrupt("return",this.tokenizer.encode(A));case 2:return console.error('withTokenizer must be set to true - please pass "withTokenizer:true" as an option in the constructor'),P.abrupt("return",!1);case 4:case"end":return P.stop()}},T,this)}));return function(T){return M.apply(this,arguments)}}()}]),$}(),zc=function($,M){var T=we()($)==="object"?$:{};return new Vd(T,typeof $=="function"?$:M)};const Zh=$=>{$.startEndTensor.dispose(),$.startPoint.dispose(),$.endPoint.dispose()},gm=$=>({startEndTensor:$,startPoint:Object(ze.slice)($,[0,0],[-1,2]),endPoint:Object(ze.slice)($,[0,2],[-1,2])}),mg=($,M)=>{const T=Object(ze.mul)($.startPoint,M),A=Object(ze.mul)($.endPoint,M),P=Object(ze.concat2d)([T,A],1);return gm(P)},v0={strides:[8,16],anchors:[2,6]},Iv=6;function hs($,M){let T,A,P;if($.topLeft instanceof ze.Tensor&&$.bottomRight instanceof ze.Tensor){const[ie,pe]=Object(ze.tidy)(()=>[Object(ze.concat)([Object(ze.sub)(M-1,$.topLeft.slice(0,1)),$.topLeft.slice(1,1)]),Object(ze.concat)([Object(ze.sub)(M-1,$.bottomRight.slice(0,1)),$.bottomRight.slice(1,1)])]);T=ie,A=pe,$.landmarks!=null&&(P=Object(ze.tidy)(()=>{const Ae=Object(ze.sub)(Object(ze.tensor1d)([M-1,0]),$.landmarks),Ie=Object(ze.tensor1d)([1,-1]);return Object(ze.mul)(Ae,Ie)}))}else{const[ie,pe]=$.topLeft,[Ae,Ie]=$.bottomRight;T=[M-1-ie,pe],A=[M-1-Ae,Ie],$.landmarks!=null&&(P=$.landmarks.map(De=>[M-1-De[0],De[1]]))}const J={topLeft:T,bottomRight:A};return P!=null&&(J.landmarks=P),$.probability!=null&&(J.probability=$.probability instanceof ze.Tensor?$.probability.clone():$.probability),J}function Fv($,M){return Object(ze.tidy)(()=>{let T;return T=$.hasOwnProperty("box")?$.box:$,mg(T,M).startEndTensor.squeeze()})}class ep{constructor(M,T,A,P,J,ie){this.blazeFaceModel=M,this.width=T,this.height=A,this.maxFaces=P,this.anchorsData=function(pe,Ae,Ie){const De=[];for(let et=0;et<Ie.strides.length;et++){const ot=Ie.strides[et],Bt=Math.floor((Ae+ot-1)/ot),Vt=Math.floor((pe+ot-1)/ot),yn=Ie.anchors[et];for(let _n=0;_n<Bt;_n++){const Dn=ot*(_n+.5);for(let Nn=0;Nn<Vt;Nn++){const Wn=ot*(Nn+.5);for(let Jn=0;Jn<yn;Jn++)De.push([Wn,Dn])}}}return De}(T,A,v0),this.anchors=Object(ze.tensor2d)(this.anchorsData),this.inputSizeData=[T,A],this.inputSize=Object(ze.tensor1d)([T,A]),this.iouThreshold=J,this.scoreThreshold=ie}async getBoundingBoxes(M,T,A=!0){const[P,J,ie]=Object(ze.tidy)(()=>{const yn=M.resizeBilinear([this.width,this.height]),_n=Object(ze.mul)(Object(ze.sub)(yn.div(255),.5),2),Dn=this.blazeFaceModel.predict(_n).squeeze(),Nn=function(Jn,Cn,wr){const Dr=Object(ze.slice)(Jn,[0,1],[-1,2]),Nr=Object(ze.add)(Dr,Cn),Yr=Object(ze.slice)(Jn,[0,3],[-1,2]),jr=Object(ze.div)(Yr,wr),Si=Object(ze.div)(Nr,wr),Fi=Object(ze.div)(jr,2),Ni=Object(ze.sub)(Si,Fi),Ao=Object(ze.add)(Si,Fi),Xo=Object(ze.mul)(Ni,wr),Po=Object(ze.mul)(Ao,wr);return Object(ze.concat2d)([Xo,Po],1)}(Dn,this.anchors,this.inputSize),Wn=Object(ze.slice)(Dn,[0,0],[-1,1]);return[Dn,Nn,Object(ze.sigmoid)(Wn).squeeze()]}),pe=console.warn;console.warn=()=>{};const Ae=ze.image.nonMaxSuppression(J,ie,this.maxFaces,this.iouThreshold,this.scoreThreshold);console.warn=pe;const Ie=await Ae.array();Ae.dispose();let De=Ie.map(yn=>Object(ze.slice)(J,[yn,0],[1,-1]));T||(De=await Promise.all(De.map(async yn=>{const _n=await yn.array();return yn.dispose(),_n})));const et=M.shape[1],ot=M.shape[2];let Bt;Bt=T?Object(ze.div)([ot,et],this.inputSize):[ot/this.inputSizeData[0],et/this.inputSizeData[1]];const Vt=[];for(let yn=0;yn<De.length;yn++){const _n=De[yn],Dn=Object(ze.tidy)(()=>{const Nn=gm(_n instanceof ze.Tensor?_n:Object(ze.tensor2d)(_n));if(!A)return Nn;const Wn=Ie[yn];let Jn;return Jn=T?this.anchors.slice([Wn,0],[1,2]):this.anchorsData[Wn],{box:Nn,landmarks:Object(ze.slice)(P,[Wn,Iv-1],[1,-1]).squeeze().reshape([Iv,-1]),probability:Object(ze.slice)(ie,[Wn],[1]),anchor:Jn}});Vt.push(Dn)}return J.dispose(),ie.dispose(),P.dispose(),{boxes:Vt,scaleFactor:Bt}}async estimateFaces(M,T=!1,A=!1,P=!0){const[,J]=function(Ie){return Ie instanceof ze.Tensor?[Ie.shape[0],Ie.shape[1]]:[Ie.height,Ie.width]}(M),ie=Object(ze.tidy)(()=>(M instanceof ze.Tensor||(M=ze.browser.fromPixels(M)),M.toFloat().expandDims(0))),{boxes:pe,scaleFactor:Ae}=await this.getBoundingBoxes(ie,T,P);return ie.dispose(),T?pe.map(Ie=>{const De=Fv(Ie,Ae);let et={topLeft:De.slice([0],[2]),bottomRight:De.slice([2],[2])};if(P){const{landmarks:ot,probability:Bt,anchor:Vt}=Ie,yn=ot.add(Vt).mul(Ae);et.landmarks=yn,et.probability=Bt}return A&&(et=hs(et,J)),et}):Promise.all(pe.map(async Ie=>{const De=Fv(Ie,Ae);let et;if(P){const[ot,Bt,Vt]=await Promise.all([Ie.landmarks,De,Ie.probability].map(async Wn=>Wn.array())),yn=Ie.anchor,[_n,Dn]=Ae,Nn=ot.map(Wn=>[(Wn[0]+yn[0])*_n,(Wn[1]+yn[1])*Dn]);et={topLeft:Bt.slice(0,2),bottomRight:Bt.slice(2),landmarks:Nn,probability:Vt},Zh(Ie.box),Ie.landmarks.dispose(),Ie.probability.dispose()}else{const ot=await De.array();et={topLeft:ot.slice(0,2),bottomRight:ot.slice(2)}}return De.dispose(),A&&(et=hs(et,J)),et}))}}const Rv="https://tfhub.dev/tensorflow/tfjs-model/blazeface/1/default/1",gg={silhouette:[10,338,297,332,284,251,389,356,454,323,361,288,397,365,379,378,400,377,152,148,176,149,150,136,172,58,132,93,234,127,162,21,54,103,67,109],lipsUpperOuter:[61,185,40,39,37,0,267,269,270,409,291],lipsLowerOuter:[146,91,181,84,17,314,405,321,375,291],lipsUpperInner:[78,191,80,81,82,13,312,311,310,415,308],lipsLowerInner:[78,95,88,178,87,14,317,402,318,324,308],rightEyeUpper0:[246,161,160,159,158,157,173],rightEyeLower0:[33,7,163,144,145,153,154,155,133],rightEyeUpper1:[247,30,29,27,28,56,190],rightEyeLower1:[130,25,110,24,23,22,26,112,243],rightEyeUpper2:[113,225,224,223,222,221,189],rightEyeLower2:[226,31,228,229,230,231,232,233,244],rightEyeLower3:[143,111,117,118,119,120,121,128,245],rightEyebrowUpper:[156,70,63,105,66,107,55,193],rightEyebrowLower:[35,124,46,53,52,65],leftEyeUpper0:[466,388,387,386,385,384,398],leftEyeLower0:[263,249,390,373,374,380,381,382,362],leftEyeUpper1:[467,260,259,257,258,286,414],leftEyeLower1:[359,255,339,254,253,252,256,341,463],leftEyeUpper2:[342,445,444,443,442,441,413],leftEyeLower2:[446,261,448,449,450,451,452,453,464],leftEyeLower3:[372,340,346,347,348,349,350,357,465],leftEyebrowUpper:[383,300,293,334,296,336,285,417],leftEyebrowLower:[265,353,276,283,282,295],midwayBetweenEyes:[168],noseTip:[1],noseBottom:[2],noseRightCorner:[98],noseLeftCorner:[327],rightCheek:[205],leftCheek:[425]};function Lf($){$!=null&&$.startPoint!=null&&($.startEndTensor.dispose(),$.startPoint.dispose(),$.endPoint.dispose())}function vm($,M,T){return{startEndTensor:$,startPoint:M??Object(ze.slice)($,[0,0],[-1,2]),endPoint:T??Object(ze.slice)($,[0,2],[-1,2])}}function Gl($){return Object(ze.tidy)(()=>{const M=Object(ze.sub)($.endPoint,$.startPoint);return Object(ze.abs)(M)})}function Pv($,M=1.5){return Object(ze.tidy)(()=>{const T=function(pe){return Object(ze.tidy)(()=>{const Ae=Object(ze.div)(Object(ze.sub)(pe.endPoint,pe.startPoint),2);return Object(ze.add)(pe.startPoint,Ae)})}($),A=Gl($),P=Object(ze.mul)(Object(ze.div)(A,2),M),J=Object(ze.sub)(T,P),ie=Object(ze.add)(T,P);return vm(Object(ze.concat2d)([J,ie],1),J,ie)})}const vg=468,yg=.25;class y0{constructor(M,T,A,P,J,ie){this.regionsOfInterest=[],this.runsWithoutFaceDetector=0,this.boundingBoxDetector=M,this.meshDetector=T,this.meshWidth=A,this.meshHeight=P,this.maxContinuousChecks=J,this.maxFaces=ie}async predict(M){if(this.shouldUpdateRegionsOfInterest()){const{boxes:P,scaleFactor:J}=await this.boundingBoxDetector.getBoundingBoxes(M,!0,!1);if(P.length===0)return J.dispose(),this.clearAllRegionsOfInterest(),null;const ie=P.map(pe=>Pv(function(Ae,Ie){const De=Object(ze.mul)(Ae.startPoint,Ie),et=Object(ze.mul)(Ae.endPoint,Ie);return vm(Object(ze.concat2d)([De,et],1))}(pe,J)));P.forEach(Lf),this.updateRegionsOfInterest(ie),this.runsWithoutFaceDetector=0}else this.runsWithoutFaceDetector++;return Object(ze.tidy)(()=>this.regionsOfInterest.map((T,A)=>{const P=function(et,ot,Bt){const Vt=ot.shape[1],yn=ot.shape[2],_n=et.startEndTensor;return Object(ze.tidy)(()=>{const Dn=Object(ze.concat2d)([_n.slice([0,1],[-1,1]),_n.slice([0,0],[-1,1]),_n.slice([0,3],[-1,1]),_n.slice([0,2],[-1,1])],0),Nn=Object(ze.div)(Dn.transpose(),[Vt,yn,Vt,yn]);return ze.image.cropAndResize(ot,Nn,[0],Bt)})}(T,M,[this.meshHeight,this.meshWidth]).div(255),[,J,ie]=this.meshDetector.predict(P),pe=Object(ze.reshape)(ie,[-1,3]),Ae=Object(ze.div)(Gl(T),[this.meshWidth,this.meshHeight]),Ie=Object(ze.mul)(pe,Ae.concat(Object(ze.tensor2d)([1],[1,1]),1)).add(T.startPoint.concat(Object(ze.tensor2d)([0],[1,1]),1)),De=this.calculateLandmarksBoundingBox(Ie);return Lf(this.regionsOfInterest[A]),this.regionsOfInterest[A]=De,{coords:pe,scaledCoords:Ie,box:De,flag:J.squeeze()}}))}updateRegionsOfInterest(M){for(let T=0;T<M.length;T++){const A=M[T],P=this.regionsOfInterest[T];let J=0;if(P&&P.startPoint){const[ie,pe,Ae,Ie]=A.startEndTensor.arraySync()[0],[De,et,ot,Bt]=P.startEndTensor.arraySync()[0],Vt=Math.max(ie,De),yn=Math.max(pe,et),_n=(Math.min(Ae,ot)-Vt)*(Math.min(Ie,Bt)-yn);J=_n/((Ae-ie)*(Ie-pe)+(ot-De)*(Bt-pe)-_n)}J>yg?Lf(A):(this.regionsOfInterest[T]=A,Lf(P))}for(let T=M.length;T<this.regionsOfInterest.length;T++)Lf(this.regionsOfInterest[T]);this.regionsOfInterest=this.regionsOfInterest.slice(0,M.length)}clearRegionOfInterest(M){this.regionsOfInterest[M]!=null&&(Lf(this.regionsOfInterest[M]),this.regionsOfInterest=[...this.regionsOfInterest.slice(0,M),...this.regionsOfInterest.slice(M+1)])}clearAllRegionsOfInterest(){for(let M=0;M<this.regionsOfInterest.length;M++)Lf(this.regionsOfInterest[M]);this.regionsOfInterest=[]}shouldUpdateRegionsOfInterest(){const M=this.regionsOfInterest.length,T=M===0;return this.maxFaces===1||T?T:M!==this.maxFaces&&this.runsWithoutFaceDetector>=this.maxContinuousChecks}calculateLandmarksBoundingBox(M){const T=M.slice([0,0],[vg,1]),A=M.slice([0,1],[vg,1]);return Pv(vm(Object(ze.stack)([T.min(),A.min(),T.max(),A.max()]).expandDims(0)))}}const ll=[[.499976992607117,.652534008026123],[.500025987625122,.547487020492554],[.499974012374878,.602371990680695],[.482113003730774,.471979022026062],[.500150978565216,.527155995368958],[.499909996986389,.498252987861633],[.499523013830185,.40106201171875],[.289712011814117,.380764007568359],[.499954998493195,.312398016452789],[.499987006187439,.269918978214264],[.500023007392883,.107050001621246],[.500023007392883,.666234016418457],[.5000159740448,.679224014282227],[.500023007392883,.692348003387451],[.499976992607117,.695277988910675],[.499976992607117,.70593398809433],[.499976992607117,.719385027885437],[.499976992607117,.737019002437592],[.499967992305756,.781370997428894],[.499816000461578,.562981009483337],[.473773002624512,.573909997940063],[.104906998574734,.254140973091125],[.365929991006851,.409575998783112],[.338757991790771,.41302502155304],[.311120003461838,.409460008144379],[.274657994508743,.389131009578705],[.393361985683441,.403706014156342],[.345234006643295,.344011008739471],[.370094001293182,.346076011657715],[.319321990013123,.347265005111694],[.297903001308441,.353591024875641],[.24779200553894,.410809993743896],[.396889001131058,.842755019664764],[.280097991228104,.375599980354309],[.106310002505779,.399955987930298],[.2099249958992,.391353011131287],[.355807989835739,.534406006336212],[.471751004457474,.65040397644043],[.474155008792877,.680191993713379],[.439785003662109,.657229006290436],[.414617002010345,.66654098033905],[.450374007225037,.680860996246338],[.428770989179611,.682690978050232],[.374971002340317,.727805018424988],[.486716985702515,.547628998756409],[.485300987958908,.527395009994507],[.257764995098114,.314490020275116],[.401223003864288,.455172002315521],[.429818987846375,.548614978790283],[.421351999044418,.533740997314453],[.276895999908447,.532056987285614],[.483370006084442,.499586999416351],[.33721199631691,.282882988452911],[.296391993761063,.293242990970612],[.169294998049736,.193813979625702],[.447580009698868,.302609980106354],[.392390012741089,.353887975215912],[.354490011930466,.696784019470215],[.067304998636246,.730105042457581],[.442739009857178,.572826027870178],[.457098007202148,.584792017936707],[.381974011659622,.694710969924927],[.392388999462128,.694203019142151],[.277076005935669,.271932005882263],[.422551989555359,.563233017921448],[.385919004678726,.281364023685455],[.383103013038635,.255840003490448],[.331431001424789,.119714021682739],[.229923993349075,.232002973556519],[.364500999450684,.189113974571228],[.229622006416321,.299540996551514],[.173287004232407,.278747975826263],[.472878992557526,.666198015213013],[.446828007698059,.668527007102966],[.422762006521225,.673889994621277],[.445307999849319,.580065965652466],[.388103008270264,.693961024284363],[.403039008378983,.706539988517761],[.403629004955292,.693953037261963],[.460041999816895,.557139039039612],[.431158006191254,.692366003990173],[.452181994915009,.692366003990173],[.475387006998062,.692366003990173],[.465828001499176,.779190003871918],[.472328990697861,.736225962638855],[.473087012767792,.717857003211975],[.473122000694275,.704625964164734],[.473033010959625,.695277988910675],[.427942007780075,.695277988910675],[.426479011774063,.703539967536926],[.423162013292313,.711845993995667],[.4183090031147,.720062971115112],[.390094995498657,.639572978019714],[.013953999616206,.560034036636353],[.499913990497589,.58014702796936],[.413199990987778,.69539999961853],[.409626007080078,.701822996139526],[.468080013990402,.601534962654114],[.422728985548019,.585985004901886],[.463079988956451,.593783974647522],[.37211999297142,.47341400384903],[.334562003612518,.496073007583618],[.411671012639999,.546965003013611],[.242175996303558,.14767599105835],[.290776997804642,.201445996761322],[.327338010072708,.256527006626129],[.399509996175766,.748921036720276],[.441727995872498,.261676013469696],[.429764986038208,.187834024429321],[.412198007106781,.108901023864746],[.288955003023148,.398952007293701],[.218936994671822,.435410976409912],[.41278201341629,.398970007896423],[.257135003805161,.355440020561218],[.427684992551804,.437960982322693],[.448339998722076,.536936044692993],[.178560003638268,.45755398273468],[.247308000922203,.457193970680237],[.286267012357712,.467674970626831],[.332827985286713,.460712015628815],[.368755996227264,.447206974029541],[.398963987827301,.432654976844788],[.476410001516342,.405806005001068],[.189241006970406,.523923993110657],[.228962004184723,.348950982093811],[.490725994110107,.562400996685028],[.404670000076294,.485132992267609],[.019469000399113,.401564002037048],[.426243007183075,.420431017875671],[.396993011236191,.548797011375427],[.266469985246658,.376977026462555],[.439121007919312,.51895797252655],[.032313998788595,.644356966018677],[.419054001569748,.387154996395111],[.462783008813858,.505746960639954],[.238978996872902,.779744982719421],[.198220998048782,.831938028335571],[.107550002634525,.540755033493042],[.183610007166862,.740257024765015],[.134409993886948,.333683013916016],[.385764002799988,.883153975009918],[.490967005491257,.579378008842468],[.382384985685349,.508572995662689],[.174399003386497,.397670984268188],[.318785011768341,.39623498916626],[.343364000320435,.400596976280212],[.396100014448166,.710216999053955],[.187885001301765,.588537991046906],[.430987000465393,.944064974784851],[.318993002176285,.898285031318665],[.266247987747192,.869701027870178],[.500023007392883,.190576016902924],[.499976992607117,.954452991485596],[.366169989109039,.398822009563446],[.393207013607025,.39553701877594],[.410373002290726,.391080021858215],[.194993004202843,.342101991176605],[.388664990663528,.362284004688263],[.365961998701096,.355970978736877],[.343364000320435,.355356991291046],[.318785011768341,.35834002494812],[.301414996385574,.363156020641327],[.058132998645306,.319076001644135],[.301414996385574,.387449026107788],[.499987989664078,.618434011936188],[.415838003158569,.624195992946625],[.445681989192963,.566076993942261],[.465844005346298,.620640993118286],[.49992299079895,.351523995399475],[.288718998432159,.819945991039276],[.335278987884521,.852819979190826],[.440512001514435,.902418971061707],[.128294005990028,.791940987110138],[.408771991729736,.373893976211548],[.455606997013092,.451801002025604],[.499877005815506,.908990025520325],[.375436991453171,.924192011356354],[.11421000212431,.615022003650665],[.448662012815475,.695277988910675],[.4480200111866,.704632043838501],[.447111994028091,.715808033943176],[.444831997156143,.730794012546539],[.430011987686157,.766808986663818],[.406787008047104,.685672998428345],[.400738000869751,.681069016456604],[.392399996519089,.677703022956848],[.367855995893478,.663918972015381],[.247923001646996,.601333022117615],[.452769994735718,.420849978923798],[.43639200925827,.359887003898621],[.416164010763168,.368713974952698],[.413385987281799,.692366003990173],[.228018000721931,.683571994304657],[.468268007040024,.352671027183533],[.411361992359161,.804327011108398],[.499989002943039,.469825029373169],[.479153990745544,.442654013633728],[.499974012374878,.439637005329132],[.432112008333206,.493588984012604],[.499886006116867,.866917014122009],[.49991300702095,.821729004383087],[.456548988819122,.819200992584229],[.344549000263214,.745438992977142],[.37890899181366,.574010014533997],[.374292999505997,.780184984207153],[.319687992334366,.570737957954407],[.357154995203018,.604269981384277],[.295284003019333,.621580958366394],[.447750002145767,.862477004528046],[.410986006259918,.508723020553589],[.31395098567009,.775308012962341],[.354128003120422,.812552988529205],[.324548006057739,.703992962837219],[.189096003770828,.646299958229065],[.279776990413666,.71465802192688],[.1338230073452,.682700991630554],[.336768001317978,.644733011722565],[.429883986711502,.466521978378296],[.455527991056442,.548622965812683],[.437114000320435,.558896005153656],[.467287987470627,.529924988746643],[.414712011814117,.335219979286194],[.37704598903656,.322777986526489],[.344107985496521,.320150971412659],[.312875986099243,.32233202457428],[.283526003360748,.333190023899078],[.241245999932289,.382785975933075],[.102986000478268,.468762993812561],[.267612010240555,.424560010433197],[.297879010438919,.433175981044769],[.333433985710144,.433878004550934],[.366427004337311,.426115989685059],[.396012008190155,.416696012020111],[.420121014118195,.41022801399231],[.007561000064015,.480777025222778],[.432949006557465,.569517970085144],[.458638995885849,.479089021682739],[.473466008901596,.545744001865387],[.476087987422943,.563830018043518],[.468472003936768,.555056989192963],[.433990985155106,.582361996173859],[.483518004417419,.562983989715576],[.482482999563217,.57784903049469],[.42645001411438,.389798998832703],[.438998997211456,.39649498462677],[.450067013502121,.400434017181396],[.289712011814117,.368252992630005],[.276670008897781,.363372981548309],[.517862021923065,.471948027610779],[.710287988185883,.380764007568359],[.526226997375488,.573909997940063],[.895093023777008,.254140973091125],[.634069979190826,.409575998783112],[.661242008209229,.41302502155304],[.688880026340485,.409460008144379],[.725341975688934,.389131009578705],[.606630027294159,.40370500087738],[.654766023159027,.344011008739471],[.629905998706818,.346076011657715],[.680678009986877,.347265005111694],[.702096998691559,.353591024875641],[.75221198797226,.410804986953735],[.602918028831482,.842862963676453],[.719901978969574,.375599980354309],[.893692970275879,.399959981441498],[.790081977844238,.391354024410248],[.643998026847839,.534487962722778],[.528249025344849,.65040397644043],[.525849997997284,.680191040039062],[.560214996337891,.657229006290436],[.585384011268616,.66654098033905],[.549625992774963,.680860996246338],[.57122802734375,.682691991329193],[.624852001667023,.72809898853302],[.513050019741058,.547281980514526],[.51509702205658,.527251958847046],[.742246985435486,.314507007598877],[.598631024360657,.454979002475739],[.570338010787964,.548575043678284],[.578631997108459,.533622980117798],[.723087012767792,.532054007053375],[.516445994377136,.499638974666595],[.662801027297974,.282917976379395],[.70362401008606,.293271005153656],[.830704987049103,.193813979625702],[.552385985851288,.302568018436432],[.607609987258911,.353887975215912],[.645429015159607,.696707010269165],[.932694971561432,.730105042457581],[.557260990142822,.572826027870178],[.542901992797852,.584792017936707],[.6180260181427,.694710969924927],[.607590973377228,.694203019142151],[.722943007946014,.271963000297546],[.577413976192474,.563166975975037],[.614082992076874,.281386971473694],[.616907000541687,.255886018276215],[.668509006500244,.119913995265961],[.770092010498047,.232020974159241],[.635536015033722,.189248979091644],[.77039098739624,.299556016921997],[.826722025871277,.278755009174347],[.527121007442474,.666198015213013],[.553171992301941,.668527007102966],[.577238023281097,.673889994621277],[.554691970348358,.580065965652466],[.611896991729736,.693961024284363],[.59696102142334,.706539988517761],[.596370995044708,.693953037261963],[.539958000183105,.557139039039612],[.568841993808746,.692366003990173],[.547818005084991,.692366003990173],[.52461302280426,.692366003990173],[.534089982509613,.779141008853912],[.527670979499817,.736225962638855],[.526912987232208,.717857003211975],[.526877999305725,.704625964164734],[.526966989040375,.695277988910675],[.572058022022247,.695277988910675],[.573521018028259,.703539967536926],[.57683801651001,.711845993995667],[.581691026687622,.720062971115112],[.609944999217987,.639909982681274],[.986046016216278,.560034036636353],[.5867999792099,.69539999961853],[.590372025966644,.701822996139526],[.531915009021759,.601536989212036],[.577268004417419,.585934996604919],[.536915004253387,.593786001205444],[.627542972564697,.473352015018463],[.665585994720459,.495950996875763],[.588353991508484,.546862006187439],[.757824003696442,.14767599105835],[.709249973297119,.201507985591888],[.672684013843536,.256581008434296],[.600408971309662,.74900496006012],[.55826598405838,.261672019958496],[.570303976535797,.187870979309082],[.588165998458862,.109044015407562],[.711045026779175,.398952007293701],[.781069993972778,.435405015945435],[.587247014045715,.398931980133057],[.742869973182678,.355445981025696],[.572156012058258,.437651991844177],[.55186802148819,.536570012569427],[.821442008018494,.457556009292603],[.752701997756958,.457181990146637],[.71375697851181,.467626988887787],[.66711300611496,.460672974586487],[.631101012229919,.447153985500336],[.6008620262146,.432473003864288],[.523481011390686,.405627012252808],[.810747981071472,.523926019668579],[.771045982837677,.348959028720856],[.509127020835876,.562718033790588],[.595292985439301,.485023975372314],[.980530977249146,.401564002037048],[.573499977588654,.420000016689301],[.602994978427887,.548687994480133],[.733529984951019,.376977026462555],[.560611009597778,.519016981124878],[.967685997486115,.644356966018677],[.580985009670258,.387160003185272],[.537728011608124,.505385041236877],[.760966002941132,.779752969741821],[.801778972148895,.831938028335571],[.892440974712372,.54076099395752],[.816350996494293,.740260004997253],[.865594983100891,.333687007427216],[.614073991775513,.883246004581451],[.508952975273132,.579437971115112],[.617941975593567,.508316040039062],[.825608015060425,.397674977779388],[.681214988231659,.39623498916626],[.656635999679565,.400596976280212],[.603900015354156,.710216999053955],[.81208598613739,.588539004325867],[.56801301240921,.944564998149872],[.681007981300354,.898285031318665],[.733752012252808,.869701027870178],[.633830010890961,.398822009563446],[.606792986392975,.39553701877594],[.589659988880157,.391062021255493],[.805015981197357,.342108011245728],[.611334979534149,.362284004688263],[.634037971496582,.355970978736877],[.656635999679565,.355356991291046],[.681214988231659,.35834002494812],[.698584973812103,.363156020641327],[.941866993904114,.319076001644135],[.698584973812103,.387449026107788],[.584177017211914,.624107003211975],[.554318010807037,.566076993942261],[.534153997898102,.62064003944397],[.711217999458313,.819975018501282],[.664629995822906,.852871000766754],[.559099972248077,.902631998062134],[.871706008911133,.791940987110138],[.591234028339386,.373893976211548],[.544341027736664,.451583981513977],[.624562978744507,.924192011356354],[.88577002286911,.615028977394104],[.551338016986847,.695277988910675],[.551980018615723,.704632043838501],[.552887976169586,.715808033943176],[.555167973041534,.730794012546539],[.569944024085999,.767035007476807],[.593203008174896,.685675978660583],[.599261999130249,.681069016456604],[.607599973678589,.677703022956848],[.631937980651855,.663500010967255],[.752032995223999,.601315021514893],[.547226011753082,.420395016670227],[.563543975353241,.359827995300293],[.583841025829315,.368713974952698],[.586614012718201,.692366003990173],[.771915018558502,.683578014373779],[.531597018241882,.352482974529266],[.588370978832245,.804440975189209],[.52079701423645,.442565023899078],[.567984998226166,.493479013442993],[.543282985687256,.819254994392395],[.655317008495331,.745514988899231],[.621008992195129,.574018001556396],[.625559985637665,.78031200170517],[.680198013782501,.570719003677368],[.64276397228241,.604337990283966],[.704662978649139,.621529996395111],[.552012026309967,.862591981887817],[.589071989059448,.508637011051178],[.685944974422455,.775357007980347],[.645735025405884,.812640011310577],[.675342977046967,.703978002071381],[.810858011245728,.646304965019226],[.72012197971344,.714666962623596],[.866151988506317,.682704985141754],[.663187026977539,.644596993923187],[.570082008838654,.466325998306274],[.544561982154846,.548375964164734],[.562758982181549,.558784961700439],[.531987011432648,.530140042304993],[.585271000862122,.335177004337311],[.622952997684479,.32277899980545],[.655896008014679,.320163011550903],[.687132000923157,.322345972061157],[.716481983661652,.333200991153717],[.758756995201111,.382786989212036],[.897013008594513,.468769013881683],[.732392013072968,.424547016620636],[.70211398601532,.433162987232208],[.66652500629425,.433866024017334],[.633504986763,.426087975502014],[.603875994682312,.416586995124817],[.579657971858978,.409945011138916],[.992439985275269,.480777025222778],[.567192018032074,.569419980049133],[.54136598110199,.478899002075195],[.526564002037048,.546118021011353],[.523913025856018,.563830018043518],[.531529009342194,.555056989192963],[.566035985946655,.582329034805298],[.51631098985672,.563053965568542],[.5174720287323,.577877044677734],[.573594987392426,.389806985855103],[.560697972774506,.395331978797913],[.549755990505219,.399751007556915],[.710287988185883,.368252992630005],[.723330020904541,.363372981548309]],bg="https://tfhub.dev/mediapipe/tfjs-model/facemesh/1/default/1",Lv=192,ql=192;async function ym({maxContinuousChecks:$=5,detectionConfidence:M=.9,maxFaces:T=10,iouThreshold:A=.3,scoreThreshold:P=.75}={}){const[J,ie]=await Promise.all([async function(pe,Ae,Ie){return async function({maxFaces:De=10,inputWidth:et=128,inputHeight:ot=128,iouThreshold:Bt=.3,scoreThreshold:Vt=.75}={}){const yn=await Object(Mt.loadGraphModel)(Rv,{fromTFHub:!0});return new ep(yn,et,ot,De,Bt,Vt)}({maxFaces:pe,iouThreshold:Ae,scoreThreshold:Ie})}(T,A,P),async function(){return Object(Mt.loadGraphModel)(bg,{fromTFHub:!0})}()]);return new bm(J,ie,$,M,T)}function Hd($,M){if($.mesh instanceof ze.Tensor){const[T,A,P,J]=Object(ze.tidy)(()=>{const ie=Object(ze.tensor1d)([M-1,0,0]),pe=Object(ze.tensor1d)([1,-1,1]);return Object(ze.tidy)(()=>[Object(ze.concat)([Object(ze.sub)(M-1,$.boundingBox.topLeft.slice(0,1)),$.boundingBox.topLeft.slice(1,1)]),Object(ze.concat)([Object(ze.sub)(M-1,$.boundingBox.bottomRight.slice(0,1)),$.boundingBox.bottomRight.slice(1,1)]),Object(ze.sub)(ie,$.mesh).mul(pe),Object(ze.sub)(ie,$.scaledMesh).mul(pe)])});return Object.assign({},$,{boundingBox:{topLeft:T,bottomRight:A},mesh:P,scaledMesh:J})}return Object.assign({},$,{boundingBox:{topLeft:[M-1-$.boundingBox.topLeft[0],$.boundingBox.topLeft[1]],bottomRight:[M-1-$.boundingBox.bottomRight[0],$.boundingBox.bottomRight[1]]},mesh:$.mesh.map(T=>{const A=T.slice(0);return A[0]=M-1-T[0],A}),scaledMesh:$.scaledMesh.map(T=>{const A=T.slice(0);return A[0]=M-1-T[0],A})})}class bm{constructor(M,T,A,P,J){this.pipeline=new y0(M,T,Lv,ql,A,J),this.detectionConfidence=P}static getAnnotations(){return gg}static getUVCoords(){return ll}async estimateFaces(M,T=!1,A=!1){const[,P]=function(Ae){return Ae instanceof ze.Tensor?[Ae.shape[0],Ae.shape[1]]:[Ae.height,Ae.width]}(M),J=Object(ze.tidy)(()=>(M instanceof ze.Tensor||(M=ze.browser.fromPixels(M)),M.toFloat().expandDims(0))),ie=Object(ze.env)().get("WEBGL_PACK_DEPTHWISECONV");Object(ze.env)().set("WEBGL_PACK_DEPTHWISECONV",!0);const pe=await this.pipeline.predict(J);return Object(ze.env)().set("WEBGL_PACK_DEPTHWISECONV",ie),J.dispose(),pe!=null&&pe.length>0?Promise.all(pe.map(async(Ae,Ie)=>{const{coords:De,scaledCoords:et,box:ot,flag:Bt}=Ae;let Vt=[Bt];T||(Vt=Vt.concat([De,et,ot.startPoint,ot.endPoint]));const yn=await Promise.all(Vt.map(async Dr=>Dr.array())),_n=yn[0];if(Bt.dispose(),_n<this.detectionConfidence&&this.pipeline.clearRegionOfInterest(Ie),T){const Dr={faceInViewConfidence:_n,mesh:De,scaledMesh:et,boundingBox:{topLeft:ot.startPoint.squeeze(),bottomRight:ot.endPoint.squeeze()}};return A?Hd(Dr,P):Dr}const[Dn,Nn,Wn,Jn]=yn.slice(1);et.dispose(),De.dispose();let Cn={faceInViewConfidence:_n,boundingBox:{topLeft:Wn,bottomRight:Jn},mesh:Dn,scaledMesh:Nn};A&&(Cn=Hd(Cn,P));const wr={};for(const Dr in gg)wr[Dr]=gg[Dr].map(Nr=>Cn.scaledMesh[Nr]);return Cn.annotations=wr,Cn})):[]}}function ps($){var M=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var T,A=ys()($);if(M){var P=ys()(this).constructor;T=Reflect.construct(A,arguments,P)}else T=A.apply(this,arguments);return Jc()(this,T)}}var xg=function($){Yc()(T,$);var M=ps(T);function T(A,P,J){var ie;return ce()(this,T),(ie=M.call(this)).video=A,ie.model=null,ie.modelReady=!1,ie.config=P,ie.ready=Ge(ie.loadModel(),J),ie}return Ee()(T,[{key:"loadModel",value:function(){var A=G()(ge.a.mark(function P(){var J=this;return ge.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.next=2,ym(this.config);case 2:if(this.model=ie.sent,this.modelReady=!0,!this.video||this.video.readyState!==0){ie.next=7;break}return ie.next=7,new Promise(function(pe){J.video.onloadeddata=function(){pe()}});case 7:return this.video&&this.predict(),ie.abrupt("return",this);case 9:case"end":return ie.stop()}},P,this)}));return function(){return A.apply(this,arguments)}}()},{key:"predict",value:function(){var A=G()(ge.a.mark(function P(J,ie){var pe,Ae,Ie,De,et=this;return ge.a.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:if(pe=this.getInput(J)){ot.next=3;break}throw new Error("No input image found.");case 3:return Ae=this.config.flipHorizontal,ot.next=6,this.model.estimateFaces(pe,Ae);case 6:if(Ie=ot.sent,De=Ie,this.emit("predict",De),this.emit("face",De),!this.video){ot.next=12;break}return ot.abrupt("return",I.nextFrame().then(function(){return et.predict()}));case 12:return typeof ie=="function"&&ie(De),ot.abrupt("return",De);case 14:case"end":return ot.stop()}},P,this)}));return function(P,J){return A.apply(this,arguments)}}()},{key:"getInput",value:function(A){return A instanceof HTMLImageElement||A instanceof HTMLVideoElement||A instanceof HTMLCanvasElement||A instanceof ImageData?A:we()(A)==="object"&&(A.elt instanceof HTMLImageElement||A.elt instanceof HTMLVideoElement||A.elt instanceof ImageData)?A.elt:we()(A)==="object"&&A.canvas instanceof HTMLCanvasElement?A.canvas:this.video}}]),T}(Lp.EventEmitter),b0=function($,M,T){var A,P={},J=T;$ instanceof HTMLVideoElement?A=$:we()($)==="object"&&$.elt instanceof HTMLVideoElement?A=$.elt:we()($)==="object"?P=$:typeof $=="function"&&(J=$),we()(M)==="object"?P=M:typeof M=="function"&&(J=M);var ie=new xg(A,P,J);return J?ie:ie.ready};function xm($){return[Math.abs($.endPoint[0]-$.startPoint[0]),Math.abs($.endPoint[1]-$.startPoint[1])]}function wm($){return[$.startPoint[0]+($.endPoint[0]-$.startPoint[0])/2,$.startPoint[1]+($.endPoint[1]-$.startPoint[1])/2]}function x0($,M=1.5){const T=wm($),A=xm($),P=[M*A[0]/2,M*A[1]/2];return{startPoint:[T[0]-P[0],T[1]-P[1]],endPoint:[T[0]+P[0],T[1]+P[1]],palmLandmarks:$.palmLandmarks}}function Bv($){const M=wm($),T=xm($),A=Math.max(...T)/2;return{startPoint:[M[0]-A,M[1]-A],endPoint:[M[0]+A,M[1]+A],palmLandmarks:$.palmLandmarks}}function Ny($,M){const T=[$.endPoint[0]-$.startPoint[0],$.endPoint[1]-$.startPoint[1]],A=[T[0]*M[0],T[1]*M[1]];return{startPoint:[$.startPoint[0]+A[0],$.startPoint[1]+A[1]],endPoint:[$.endPoint[0]+A[0],$.endPoint[1]+A[1]],palmLandmarks:$.palmLandmarks}}class fl{constructor(M,T,A,P,J,ie){this.model=M,this.width=T,this.height=A,this.iouThreshold=J,this.scoreThreshold=ie,this.anchors=P.map(pe=>[pe.x_center,pe.y_center]),this.anchorsTensor=Object(ze.tensor2d)(this.anchors),this.inputSizeTensor=Object(ze.tensor1d)([T,A]),this.doubleInputSizeTensor=Object(ze.tensor1d)([2*T,2*A])}normalizeBoxes(M){return Object(ze.tidy)(()=>{const T=Object(ze.slice)(M,[0,0],[-1,2]),A=Object(ze.slice)(M,[0,2],[-1,2]),P=Object(ze.add)(Object(ze.div)(T,this.inputSizeTensor),this.anchorsTensor),J=Object(ze.div)(A,this.doubleInputSizeTensor),ie=Object(ze.mul)(Object(ze.sub)(P,J),this.inputSizeTensor),pe=Object(ze.mul)(Object(ze.add)(P,J),this.inputSizeTensor);return Object(ze.concat2d)([ie,pe],1)})}normalizeLandmarks(M,T){return Object(ze.tidy)(()=>{const A=Object(ze.add)(Object(ze.div)(M.reshape([-1,7,2]),this.inputSizeTensor),this.anchors[T]);return Object(ze.mul)(A,this.inputSizeTensor)})}getBoundingBoxes(M){return Object(ze.tidy)(()=>{const T=Object(ze.mul)(Object(ze.sub)(M,.5),2),A=Object(ze.env)().get("WEBGL_PACK_DEPTHWISECONV");Object(ze.env)().set("WEBGL_PACK_DEPTHWISECONV",!0);const P=this.model.predict(T).squeeze();Object(ze.env)().set("WEBGL_PACK_DEPTHWISECONV",A);const J=Object(ze.sigmoid)(Object(ze.slice)(P,[0,0],[-1,1])).squeeze(),ie=Object(ze.slice)(P,[0,1],[-1,4]),pe=this.normalizeBoxes(ie),Ae=console.warn;console.warn=()=>{};const Ie=ze.image.nonMaxSuppression(pe,J,1,this.iouThreshold,this.scoreThreshold).arraySync();if(console.warn=Ae,Ie.length===0)return null;const De=Ie[0],et=Object(ze.slice)(pe,[De,0],[1,-1]),ot=Object(ze.slice)(P,[De,5],[1,14]);return{boxes:et,palmLandmarks:this.normalizeLandmarks(ot,De).reshape([-1,2])}})}estimateHandBounds(M){const T=M.shape[1],A=M.shape[2],P=Object(ze.tidy)(()=>M.resizeBilinear([this.width,this.height]).div(255)),J=this.getBoundingBoxes(P);if(J===null)return P.dispose(),null;const ie=J.boxes.arraySync(),pe=ie[0].slice(0,2),Ae=ie[0].slice(2,4),Ie=J.palmLandmarks.arraySync();return P.dispose(),J.boxes.dispose(),J.palmLandmarks.dispose(),function(De,et){return{startPoint:[De.startPoint[0]*et[0],De.startPoint[1]*et[1]],endPoint:[De.endPoint[0]*et[0],De.endPoint[1]*et[1]],palmLandmarks:De.palmLandmarks.map(ot=>[ot[0]*et[0],ot[1]*et[1]])}}({startPoint:pe,endPoint:Ae,palmLandmarks:Ie},[A/this.width,T/this.height])}}const Gd={thumb:[1,2,3,4],indexFinger:[5,6,7,8],middleFinger:[9,10,11,12],ringFinger:[13,14,15,16],pinky:[17,18,19,20],palmBase:[0]};function Iy($,M){return function(T){return T-2*Math.PI*Math.floor((T+Math.PI)/(2*Math.PI))}(Math.PI/2-Math.atan2(-(M[1]-$[1]),M[0]-$[0]))}const jv=($,M)=>[[1,0,$],[0,1,M],[0,0,1]];function dl($,M){let T=0;for(let A=0;A<$.length;A++)T+=$[A]*M[A];return T}function rs($,M){const T=[];for(let A=0;A<$.length;A++)T.push($[A][M]);return T}function tp($,M){const T=[],A=$.length;for(let P=0;P<A;P++){T.push([]);for(let J=0;J<A;J++)T[P].push(dl($[P],rs(M,J)))}return T}function _m($,M){const T=Math.cos($),A=Math.sin($),P=[[T,-A,0],[A,T,0],[0,0,1]];return tp(tp(jv(M[0],M[1]),P),jv(-M[0],-M[1]))}function wg($,M){return[dl($,M[0]),dl($,M[1])]}const zv=.8,_g=[0,-.4],Bf=3,R1=[0,-.1],Eg=1.65,Ja=[0,5,9,13,17,1,2],Em=0,qd=2;class Sg{constructor(M,T,A,P,J,ie){this.regionsOfInterest=[],this.runsWithoutHandDetector=0,this.boundingBoxDetector=M,this.meshDetector=T,this.maxContinuousChecks=J,this.detectionConfidence=ie,this.meshWidth=A,this.meshHeight=P,this.maxHandsNumber=1}getBoxForPalmLandmarks(M,T){const A=M.map(P=>wg([...P,1],T));return x0(Bv(Ny(this.calculateLandmarksBoundingBox(A),_g)),Bf)}getBoxForHandLandmarks(M){const T=x0(Bv(Ny(this.calculateLandmarksBoundingBox(M),R1)),Eg),A=[];for(let P=0;P<Ja.length;P++)A.push(M[Ja[P]].slice(0,2));return T.palmLandmarks=A,T}transformRawCoords(M,T,A,P){const J=xm(T),ie=[J[0]/this.meshWidth,J[1]/this.meshHeight],pe=M.map(Bt=>[ie[0]*(Bt[0]-this.meshWidth/2),ie[1]*(Bt[1]-this.meshHeight/2),Bt[2]]),Ae=_m(A,[0,0]),Ie=pe.map(Bt=>[...wg(Bt,Ae),Bt[2]]),De=function(Bt){const Vt=[[Bt[0][0],Bt[1][0]],[Bt[0][1],Bt[1][1]]],yn=[Bt[0][2],Bt[1][2]],_n=[-dl(Vt[0],yn),-dl(Vt[1],yn)];return[Vt[0].concat(_n[0]),Vt[1].concat(_n[1]),[0,0,1]]}(P),et=[...wm(T),1],ot=[dl(et,De[0]),dl(et,De[1])];return Ie.map(Bt=>[Bt[0]+ot[0],Bt[1]+ot[1],Bt[2]])}async estimateHand(M){const T=this.shouldUpdateRegionsOfInterest();if(T===!0){const Cn=this.boundingBoxDetector.estimateHandBounds(M);if(Cn===null)return M.dispose(),this.regionsOfInterest=[],null;this.updateRegionsOfInterest(Cn,!0),this.runsWithoutHandDetector=0}else this.runsWithoutHandDetector++;const A=this.regionsOfInterest[0],P=Iy(A.palmLandmarks[Em],A.palmLandmarks[qd]),J=wm(A),ie=[J[0]/M.shape[2],J[1]/M.shape[1]];let pe;const Ae=Object(ze.getBackend)();if(Ae==="webgl")pe=function(Cn,wr,Dr,Nr){const Yr=Cn.shape,jr=Yr[1],Si=Yr[2],Fi=Math.sin(wr),Ni=Math.cos(wr),Ao=Math.floor(Si*(typeof Nr=="number"?Nr:Nr[0])),Xo=Math.floor(jr*(typeof Nr=="number"?Nr:Nr[1])),Po={variableNames:["Image"],outputShape:Yr,userCode:`
      void main() {
        ivec4 coords = getOutputCoords();
        int x = coords[2];
        int y = coords[1];
        int coordX = int(float(x - ${Ao}) * ${Ni} -
          float(y - ${Xo}) * ${Fi});
        int coordY = int(float(x - ${Ao}) * ${Fi} +
          float(y - ${Xo}) * ${Ni});
        coordX = int(coordX + ${Ao});
        coordY = int(coordY + ${Xo});

        ${typeof Dr=="number"?`float outputValue = ${Dr.toFixed(2)};`:`
      vec3 fill = vec3(${Dr.join(",")});
      float outputValue = fill[coords[3]];`}

        if(coordX > 0 && coordX < ${Si} && coordY > 0 && coordY < ${jr}) {
          outputValue = getImage(coords[0], coordY, coordX, coords[3]);
        }

      setOutput(outputValue);
    }`};return Object(ze.backend)().compileAndRun(Po,[Cn])}(M,P,0,ie);else{if(Ae!=="cpu")throw new Error(`Handpose is not yet supported by the ${Ae} backend - rotation kernel is not defined.`);pe=function(Cn,wr,Dr,Nr){const Yr=Object(ze.backend)(),jr=Object(ze.buffer)(Cn.shape,Cn.dtype),[Si,Fi,Ni,Ao]=Cn.shape,Xo=Ni*(typeof Nr=="number"?Nr:Nr[0]),Po=Fi*(typeof Nr=="number"?Nr:Nr[1]),Ro=Math.sin(-wr),Uo=Math.cos(-wr),sa=Yr.readSync(Cn.dataId);for(let pa=0;pa<Si;pa++)for(let Da=0;Da<Fi;Da++)for(let du=0;du<Ni;du++)for(let Ri=0;Ri<Ao;Ri++){const Qa=[Si,Da,du,Ri],is=Qa[2],hu=Qa[1];let zs=(is-Xo)*Uo-(hu-Po)*Ro,Iu=(is-Xo)*Ro+(hu-Po)*Uo;zs=Math.round(zs+Xo),Iu=Math.round(Iu+Po);let Fu=Dr;typeof Dr!="number"&&(Fu=Ri===3?255:Dr[Ri]),zs>=0&&zs<Ni&&Iu>=0&&Iu<Fi&&(Fu=sa[pa*Ni*Fi*Ao+Iu*(Ni*Ao)+zs*Ao+Ri]);const Ru=pa*Ni*Fi*Ao+Da*(Ni*Ao)+du*Ao+Ri;jr.values[Ru]=Fu}return jr.toTensor()}(M,P,0,ie)}const Ie=_m(-P,J);let De;const et=function(Cn,wr,Dr){const Nr=wr.shape[1],Yr=wr.shape[2],jr=[[Cn.startPoint[1]/Nr,Cn.startPoint[0]/Yr,Cn.endPoint[1]/Nr,Cn.endPoint[0]/Yr]];return ze.image.cropAndResize(wr,jr,[0],Dr)}(De=T===!0?this.getBoxForPalmLandmarks(A.palmLandmarks,Ie):A,pe,[this.meshWidth,this.meshHeight]),ot=et.div(255);et.dispose(),pe.dispose();const Bt=Object(ze.env)().get("WEBGL_PACK_DEPTHWISECONV");Object(ze.env)().set("WEBGL_PACK_DEPTHWISECONV",!0);const[Vt,yn]=this.meshDetector.predict(ot);Object(ze.env)().set("WEBGL_PACK_DEPTHWISECONV",Bt),ot.dispose();const _n=Vt.dataSync()[0];if(Vt.dispose(),_n<this.detectionConfidence)return yn.dispose(),this.regionsOfInterest=[],null;const Dn=Object(ze.reshape)(yn,[-1,3]),Nn=Dn.arraySync();yn.dispose(),Dn.dispose();const Wn=this.transformRawCoords(Nn,De,P,Ie),Jn=this.getBoxForHandLandmarks(Wn);return this.updateRegionsOfInterest(Jn,!1),{landmarks:Wn,handInViewConfidence:_n,boundingBox:{topLeft:Jn.startPoint,bottomRight:Jn.endPoint}}}calculateLandmarksBoundingBox(M){const T=M.map(P=>P[0]),A=M.map(P=>P[1]);return{startPoint:[Math.min(...T),Math.min(...A)],endPoint:[Math.max(...T),Math.max(...A)]}}updateRegionsOfInterest(M,T){if(T)this.regionsOfInterest=[M];else{const A=this.regionsOfInterest[0];let P=0;if(A!=null&&A.startPoint!=null){const[J,ie]=M.startPoint,[pe,Ae]=M.endPoint,[Ie,De]=A.startPoint,[et,ot]=A.endPoint,Bt=Math.max(J,Ie),Vt=Math.max(ie,De),yn=(Math.min(pe,et)-Bt)*(Math.min(Ae,ot)-Vt);P=yn/((pe-J)*(Ae-ie)+(et-Ie)*(ot-ie)-yn)}this.regionsOfInterest[0]=P>zv?A:M}}shouldUpdateRegionsOfInterest(){return this.regionsOfInterest.length!==this.maxHandsNumber||this.runsWithoutHandDetector>=this.maxContinuousChecks}}const Sm=256,w0=256;async function _0({maxContinuousChecks:$=1/0,detectionConfidence:M=.8,iouThreshold:T=.3,scoreThreshold:A=.5}={}){const[P,J,ie]=await Promise.all([async function(){return ze.util.fetch("https://tfhub.dev/mediapipe/tfjs-model/handskeleton/1/default/1/anchors.json?tfjs-format=file").then(Ie=>Ie.json())}(),async function(){return Object(Mt.loadGraphModel)("https://tfhub.dev/mediapipe/tfjs-model/handdetector/1/default/1",{fromTFHub:!0})}(),async function(){return Object(Mt.loadGraphModel)("https://tfhub.dev/mediapipe/tfjs-model/handskeleton/1/default/1",{fromTFHub:!0})}()]),pe=new fl(J,Sm,w0,P,T,A),Ae=new Sg(pe,ie,Sm,w0,$,M);return new jf(Ae)}class jf{constructor(M){this.pipeline=M}static getAnnotations(){return Gd}async estimateHands(M,T=!1){const[,A]=function(Ae){return Ae instanceof ze.Tensor?[Ae.shape[0],Ae.shape[1]]:[Ae.height,Ae.width]}(M),P=Object(ze.tidy)(()=>(M instanceof ze.Tensor||(M=ze.browser.fromPixels(M)),M.toFloat().expandDims(0))),J=await this.pipeline.estimateHand(P);if(P.dispose(),J===null)return[];let ie=J;T===!0&&(ie=function(Ae,Ie){const{handInViewConfidence:De,landmarks:et,boundingBox:ot}=Ae;return{handInViewConfidence:De,landmarks:et.map(Bt=>[Ie-1-Bt[0],Bt[1],Bt[2]]),boundingBox:{topLeft:[Ie-1-ot.topLeft[0],ot.topLeft[1]],bottomRight:[Ie-1-ot.bottomRight[0],ot.bottomRight[1]]}}}(J,A));const pe={};for(const Ae of Object.keys(Gd))pe[Ae]=Gd[Ae].map(Ie=>ie.landmarks[Ie]);return[{handInViewConfidence:ie.handInViewConfidence,boundingBox:ie.boundingBox,landmarks:ie.landmarks,annotations:pe}]}}function gc($){var M=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var T,A=ys()($);if(M){var P=ys()(this).constructor;T=Reflect.construct(A,arguments,P)}else T=A.apply(this,arguments);return Jc()(this,T)}}var Uv=function($){Yc()(T,$);var M=gc(T);function T(A,P,J){var ie;return ce()(this,T),(ie=M.call(this)).video=A,ie.model=null,ie.modelReady=!1,ie.config=P,ie.ready=Ge(ie.loadModel(),J),ie}return Ee()(T,[{key:"loadModel",value:function(){var A=G()(ge.a.mark(function P(){var J=this;return ge.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.next=2,_0(this.config);case 2:if(this.model=ie.sent,this.modelReady=!0,!this.video||this.video.readyState!==0){ie.next=7;break}return ie.next=7,new Promise(function(pe){J.video.onloadeddata=function(){pe()}});case 7:return this.video&&this.predict(),ie.abrupt("return",this);case 9:case"end":return ie.stop()}},P,this)}));return function(){return A.apply(this,arguments)}}()},{key:"predict",value:function(){var A=G()(ge.a.mark(function P(J,ie){var pe,Ae,Ie,De,et=this;return ge.a.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:if(pe=this.getInput(J)){ot.next=3;break}throw new Error("No input image found.");case 3:return Ae=this.config.flipHorizontal,ot.next=6,this.model.estimateHands(pe,Ae);case 6:if(Ie=ot.sent,De=Ie,this.emit("predict",De),this.emit("hand",De),!this.video){ot.next=12;break}return ot.abrupt("return",I.nextFrame().then(function(){return et.predict()}));case 12:return typeof ie=="function"&&ie(De),ot.abrupt("return",De);case 14:case"end":return ot.stop()}},P,this)}));return function(P,J){return A.apply(this,arguments)}}()},{key:"getInput",value:function(A){return A instanceof HTMLImageElement||A instanceof HTMLVideoElement||A instanceof HTMLCanvasElement||A instanceof ImageData?A:we()(A)==="object"&&(A.elt instanceof HTMLImageElement||A.elt instanceof HTMLVideoElement||A.elt instanceof ImageData)?A.elt:we()(A)==="object"&&A.canvas instanceof HTMLCanvasElement?A.canvas:this.video}}]),T}(Lp.EventEmitter),Wv=function($,M,T){var A,P={},J=T;$ instanceof HTMLVideoElement?A=$:we()($)==="object"&&$.elt instanceof HTMLVideoElement?A=$.elt:we()($)==="object"?P=$:typeof $=="function"&&(J=$),we()(M)==="object"?P=M:typeof M=="function"&&(J=M);var ie=new Uv(A,P,J);return J?ie:ie.ready},np=function(){console.log(`

 Thank you for using ml5.js v`.concat(Fh.a,` 

Please read our community statement to ensure 
that the use of this software reflects the values 
of the ml5.js community:
 https://ml5js.org/about

Reporting: 
 https://github.com/ml5js/ml5-library/issues
 Email: info@ml5js.org 
`))},km=function(){var $=G()(ge.a.mark(function M(){var T;return ge.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return(T=new Image).crossOrigin="",T.src="https://cdn.jsdelivr.net/gh/ml5js/ml5-library@main/assets/bird.jpg",A.next=5,new Promise(function(P){T.onload=P});case 5:return A.abrupt("return",T);case 6:case"end":return A.stop()}},M)}));return function(){return $.apply(this,arguments)}}(),Fy=function(){var $=G()(ge.a.mark(function M(){var T,A,P;return ge.a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:for(T=new Uint8ClampedArray(2e4),A=0;A<T.length;A+=4)T[A+0]=0,T[A+1]=190,T[A+2]=0,T[A+3]=255;return P=new ImageData(T,200),J.abrupt("return",P);case 4:case"end":return J.stop()}},M)}));return function(){return $.apply(this,arguments)}}();function E0($,M){var T=Object.keys($);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols($);M&&(A=A.filter(function(P){return Object.getOwnPropertyDescriptor($,P).enumerable})),T.push.apply(T,A)}return T}function kg($){for(var M=1;M<arguments.length;M++){var T=arguments[M]!=null?arguments[M]:{};M%2?E0(Object(T),!0).forEach(function(A){q()($,A,T[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(T)):E0(Object(T)).forEach(function(A){Object.defineProperty($,A,Object.getOwnPropertyDescriptor(T,A))})}return $}var $r={charRNN:qp,CVAE:Xp,cartoon:Mv,DCGAN:hf,featureExtractor:to,imageClassifier:Mr,kmeans:kv,dbscan:Tv,soundClassifier:Zr,pitchDetection:It,pix2pix:lc,poseNet:Dc,sketchRNN:Nh,styleTransfer:ff,word2vec:Cc,YOLO:cf,CocoSsd:cd,objectDetector:Eh,uNet:Ol,sentiment:mf,bodyPix:Yp,faceApi:_v,universalSentenceEncoder:zc,facemesh:b0,handpose:Wv};np(),s.default=Object.assign({p5Utils:Ht},function($){if(typeof window>"u"||window.p5===void 0||window.p5.prototype===void 0||window.p5.prototype.registerPreloadMethod===void 0)return $;var M=$;return Object.keys($).forEach(function(T){var A=$[T];M[T]=function(){for(var P=null,J=arguments.length,ie=new Array(J),pe=0;pe<J;pe++)ie[pe]=arguments[pe];var Ae=ie.length;return typeof ie[Ae-1]=="function"&&(P=ie[Ae-1],Ae-=1),A.apply($,[].concat(Go()(ie.slice(0,Ae)),[function(){try{P&&P()}catch(Ie){console.error(Ie)}return window._decrementPreload?window._decrementPreload():null}]))},window.p5.prototype.registerPreloadMethod("".concat(T),$)}),$}($r),kg(kg({KNNClassifier:Ei,communityStatement:np},O),{},{tf:I,tfvis:Z,version:Fh.a,neuralNetwork:em,testingUtils:W}))},function(u,s){},function(u,s){},function(u,s){},function(u,s){u.exports=function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)},u.exports.__esModule=!0,u.exports.default=u.exports},function(u,s){u.exports=function(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)},u.exports.__esModule=!0,u.exports.default=u.exports},function(u,s,r){var l=r(186);u.exports=function(C){if(Array.isArray(C))return l(C)},u.exports.__esModule=!0,u.exports.default=u.exports},function(u,s,r){function l(L){return new Uint8Array(atob(L).split("").map(function(W){return W.charCodeAt(0)}))}Object.defineProperty(s,"__esModule",{value:!0}),s.stringToUint8array=l,s.stringToArray=function(L){var W=l(L);return new Int16Array(W.buffer)};var C=!1,S=0;function O(){if(C)return C=!1,S;var L=2*Math.random()-1,W=2*Math.random()-1,z=L*L+W*W;if(z===0||z>1)return O();var q=Math.sqrt(-2*Math.log(z)/z);return S=W*q,C=!0,L*q}function U(L,W){return Math.random()*(W-L)+L}function j(L,W){return L+O()*W}function N(L,W){W===void 0&&(W=2);var z=W;function q(It,St){return[It[0]-St[0],It[1]-St[1]]}function I(It,St){return It[0]*St[0]+It[1]*St[1]}function Z(It){return It[0]*It[0]+It[1]*It[1]}function Y(It,St){return Z(q(It,St))}var G,oe,ce,be,Ee=L.length,ve=[],ge=z*z,Ge=[],ht=[];for(Ge[0]=L[0],G=oe=1,be=0;G<Ee;G++)Y(L[G],L[be])<ge||(Ge[oe++]=L[G],be=G);for(be<Ee-1&&(Ge[oe++]=L[Ee-1]),ht[0]=ht[oe-1]=1,function It(St,we,bt,jt,Mt){if(!(jt<=bt+1)){for(var ze,Ut,Ft,pt,yt=bt,nn=0,xt=St*St,_t=[we[bt],we[jt]],Yt=q(_t[1],_t[0]),Fn=Z(Yt),Rn=bt+1;Rn<jt;Rn++)(Ft=I(q(we[Rn],_t[0]),Yt))<=0?pt=Y(we[Rn],_t[0]):Fn<=Ft?pt=Y(we[Rn],_t[1]):(Ut=Ft/Fn,ze=[_t[0][0]+Ut*Yt[0],_t[0][1]+Ut*Yt[1]],pt=Y(we[Rn],ze)),pt<=nn||(yt=Rn,nn=pt);nn>xt&&(Mt[yt]=1,It(St,we,bt,yt,Mt),It(St,we,yt,jt,Mt))}}(z,Ge,0,oe-1,ht),G=ce=0;G<oe;G++)ht[G]&&(ve[ce++]=Ge[G]);return ve}s.gaussRandom=O,s.randf=U,s.randi=function(L,W){return Math.floor(Math.random()*(W-L)+L)},s.randn=j,s.birandn=function(L,W,z,q,I){var Z=j(0,1),Y=j(0,1);return[Math.sqrt(1-I*I)*z*Z+I*z*Y+L,q*Y+W]},s.sampleSoftmax=function(L){var W,z=U(0,1),q=L.length,I=0;for(W=0;W<q;W++)if((I+=L[W])>=z)return W;return console.log("error sampling pi index"),-1},s.simplifyLine=N,s.simplifyLines=function(L,W){var z=[],q=2;W&&(q=W);for(var I=0;I<L.length;I++)z.push(N(L[I],q));return z},s.linesToStrokes=function(L){var W,z,q,I,Z,Y,G,oe,ce,be,Ee=0,ve=0,ge=[];for(G=0;G<L.length;G++)if((ce=L[G].length)>1)for(oe=0;oe<ce;oe++)W=(be=L[G][oe])[0],z=be[1],oe===ce-1?(Y=1,Z=0):(Y=0,Z=1),q=W-Ee,I=z-ve,Ee=W,ve=z,ge.push([q,I,Z,Y,0]);return ge.push([0,0,0,0,1]),ge.slice(1)},s.lineToStroke=function(L,W){var z,q,I,Z,Y,G,oe,ce,be,Ee,ve,ge=[];if(be=W[0],Ee=W[1],(I=L.length)>1)for(ve=0;ve<I;ve++)oe=(Z=L[ve])[0],ce=Z[1],ve===I-1?(q=1,z=0):(q=0,z=1),Y=oe-be,G=ce-Ee,be=oe,Ee=ce,ge.push([Y,G,z,q,0]);return ge}},function(u,s,r){var l=this&&this.__awaiter||function(j,N,L,W){return new(L||(L=Promise))(function(z,q){function I(G){try{Y(W.next(G))}catch(oe){q(oe)}}function Z(G){try{Y(W.throw(G))}catch(oe){q(oe)}}function Y(G){G.done?z(G.value):new L(function(oe){oe(G.value)}).then(I,Z)}Y((W=W.apply(j,N||[])).next())})},C=this&&this.__generator||function(j,N){var L,W,z,q,I={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return q={next:Z(0),throw:Z(1),return:Z(2)},typeof Symbol=="function"&&(q[Symbol.iterator]=function(){return this}),q;function Z(Y){return function(G){return function(oe){if(L)throw new TypeError("Generator is already executing.");for(;I;)try{if(L=1,W&&(z=2&oe[0]?W.return:oe[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,oe[1])).done)return z;switch(W=0,z&&(oe=[2&oe[0],z.value]),oe[0]){case 0:case 1:z=oe;break;case 4:return I.label++,{value:oe[1],done:!1};case 5:I.label++,W=oe[1],oe=[0];continue;case 7:oe=I.ops.pop(),I.trys.pop();continue;default:if(!(z=(z=I.trys).length>0&&z[z.length-1])&&(oe[0]===6||oe[0]===2)){I=0;continue}if(oe[0]===3&&(!z||oe[1]>z[0]&&oe[1]<z[3])){I.label=oe[1];break}if(oe[0]===6&&I.label<z[1]){I.label=z[1],z=oe;break}if(z&&I.label<z[2]){I.label=z[2],I.ops.push(oe);break}z[2]&&I.ops.pop(),I.trys.pop();continue}oe=N.call(j,I)}catch(ce){oe=[6,ce],W=0}finally{L=z=0}if(5&oe[0])throw oe[1];return{value:oe[0]?oe[1]:void 0,done:!0}}([Y,G])}}};Object.defineProperty(s,"__esModule",{value:!0});var S=r(0),O=r(255),U=function(){function j(N){this.NMIXTURE=20,this.checkpointURL=N,this.initialized=!1}return j.prototype.isInitialized=function(){return this.initialized},j.prototype.instantiateFromJSON=function(N,L,W){var z;this.forgetBias=S.scalar(1),this.info=N,this.setPixelFactor(2),this.weightDims=L,this.numUnits=this.weightDims[0][0],this.weights=[];for(var q=0;q<W.length;q++){for(var I=(z=new Float32Array(O.stringToArray(W[q]))).length,Z=0;Z<I;Z++)z[Z]=10*z[Z]/32767;this.weights.push(z)}this.outputKernel=S.tensor2d(this.weights[0],[this.weightDims[0][0],this.weightDims[0][1]]),this.outputBias=S.tensor1d(this.weights[1]);var Y=S.tensor2d(this.weights[2],[this.weightDims[2][0],this.weightDims[2][1]]),G=S.tensor2d(this.weights[3],[this.weightDims[3][0],this.weightDims[3][1]]);this.lstmKernel=S.concat2d([Y,G],0),this.lstmBias=S.tensor1d(this.weights[4]),this.rawVars=[this.outputKernel,this.outputBias,this.lstmKernel,this.lstmBias]},j.prototype.initialize=function(){return l(this,void 0,void 0,function(){var N;return C(this,function(L){switch(L.label){case 0:return this.dispose(),[4,fetch(this.checkpointURL).then(function(W){return W.json()})];case 1:return N=L.sent(),this.instantiateFromJSON(N[0],N[1],N[2]),this.initialized=!0,console.log("Initialized SketchRNN."),[2]}})})},j.prototype.dispose=function(){if(this.rawVars){for(var N=0;N<this.rawVars.length;N++)this.rawVars[N].dispose();this.rawVars=void 0}this.forgetBias&&(this.forgetBias.dispose(),this.forgetBias=void 0),this.initialized=!1},j.prototype.setPixelFactor=function(N){this.pixelFactor=N,this.scaleFactor=this.info.scale_factor/this.pixelFactor},j.prototype.update=function(N,L){var W=this,z=S.tidy(function(){var Y=W.numUnits,G=W.scaleFactor,oe=[N[0]/G,N[1]/G,N[2],N[3],N[4]],ce=S.tensor2d(oe,[1,5]),be=S.tensor2d(L.c,[1,Y]),Ee=S.tensor2d(L.h,[1,Y]),ve=S.basicLSTMCell(W.forgetBias,W.lstmKernel,W.lstmBias,ce,be,Ee);return S.concat(ve,1)}),q=z.dataSync();z.dispose();var I=q.slice(0,this.numUnits),Z=q.slice(this.numUnits,2*this.numUnits);return{c:new Float32Array(I),h:new Float32Array(Z)}},j.prototype.updateStrokes=function(N,L,W){var z=this,q=S.tidy(function(){var G,oe,ce,be,Ee,ve=z.numUnits,ge=z.scaleFactor,Ge=N.length;W&&(Ge=W),ce=S.tensor2d(L.c,[1,ve]),be=S.tensor2d(L.h,[1,ve]);for(var ht=0;ht<Ge;ht++)G=[N[ht][0]/ge,N[ht][1]/ge,N[ht][2],N[ht][3],N[ht][4]],oe=S.tensor2d(G,[1,5]),ce=(Ee=S.basicLSTMCell(z.forgetBias,z.lstmKernel,z.lstmBias,oe,ce,be))[0],be=Ee[1];return S.concat(Ee,1)}),I=q.dataSync();q.dispose();var Z=I.slice(0,this.numUnits),Y=I.slice(this.numUnits,2*this.numUnits);return{c:new Float32Array(Z),h:new Float32Array(Y)}},j.prototype.getPDF=function(N,L,W){var z=this;L===void 0&&(L=.65);var q=L,I=.5+.5*q;W&&(I=W);var Z=this.NMIXTURE,Y=S.tidy(function(){var oe=z.numUnits,ce=S.tensor2d(N.h,[1,oe]),be=S.scalar(Math.sqrt(q)),Ee=S.scalar(I),ve=S.add(S.matMul(ce,z.outputKernel),z.outputBias).squeeze(),ge=S.split(ve,[3,6*Z]),Ge=ge[0],ht=ge[1],It=S.split(ht,6),St=It[0],we=It[1],bt=It[2],jt=It[3],Mt=It[4],ze=It[5],Ut=S.softmax(Ge.div(Ee)),Ft=[S.softmax(St.div(Ee)),we,bt,S.exp(jt).mul(be),S.exp(Mt).mul(be),S.tanh(ze),Ut];return S.concat(Ft)}),G=Y.dataSync();return Y.dispose(),{pi:new Float32Array(G.slice(0,Z)),muX:new Float32Array(G.slice(1*Z,2*Z)),muY:new Float32Array(G.slice(2*Z,3*Z)),sigmaX:new Float32Array(G.slice(3*Z,4*Z)),sigmaY:new Float32Array(G.slice(4*Z,15*Z)),corr:new Float32Array(G.slice(5*Z,6*Z)),pen:new Float32Array(G.slice(6*Z,6*Z+3))}},j.prototype.zeroState=function(){return{c:new Float32Array(this.numUnits),h:new Float32Array(this.numUnits)}},j.prototype.copyState=function(N){return{c:new Float32Array(N.c),h:new Float32Array(N.h)}},j.prototype.zeroInput=function(){return[0,0,1,0,0]},j.prototype.sample=function(N){var L=O.sampleSoftmax(N.pi),W=N.muX[L],z=N.muY[L],q=N.sigmaX[L],I=N.sigmaY[L],Z=N.corr[L],Y=[0,0,0];Y[O.sampleSoftmax(N.pen)]=1;var G=O.birandn(W,z,q,I,Z);return[G[0]*this.scaleFactor,G[1]*this.scaleFactor,Y[0],Y[1],Y[2]]},j.prototype.simplifyLine=function(N,L){return O.simplifyLine(N,L)},j.prototype.simplifyLines=function(N,L){return O.simplifyLines(N,L)},j.prototype.linesToStroke=function(N){return O.linesToStrokes(N)},j.prototype.lineToStroke=function(N,L){return O.lineToStroke(N,L)},j}();s.SketchRNN=U},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(256);s.SketchRNN=l.SketchRNN},function(u,s){u.exports=function(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r},u.exports.__esModule=!0,u.exports.default=u.exports},function(u,s){function r(l,C){return u.exports=r=Object.setPrototypeOf||function(S,O){return S.__proto__=O,S},u.exports.__esModule=!0,u.exports.default=u.exports,r(l,C)}u.exports=r,u.exports.__esModule=!0,u.exports.default=u.exports},function(u,s){u.exports=function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)},u.exports.__esModule=!0,u.exports.default=u.exports},function(u,s){u.exports=function(r,l){var C=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(C!=null){var S,O,U=[],j=!0,N=!1;try{for(C=C.call(r);!(j=(S=C.next()).done)&&(U.push(S.value),!l||U.length!==l);j=!0);}catch(L){N=!0,O=L}finally{try{j||C.return==null||C.return()}finally{if(N)throw O}}return U}},u.exports.__esModule=!0,u.exports.default=u.exports},function(u,s){u.exports=function(r){if(Array.isArray(r))return r},u.exports.__esModule=!0,u.exports.default=u.exports},function(u,s,r){u.exports=function(l){return typeof l=="object"&&l.isAxiosError===!0}},function(u,s,r){u.exports=function(l){return function(C){return l.apply(null,C)}}},function(u,s,r){var l=r(188);function C(S){if(typeof S!="function")throw new TypeError("executor must be a function.");var O;this.promise=new Promise(function(j){O=j});var U=this;S(function(j){U.reason||(U.reason=new l(j),O(U.reason))})}C.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},C.source=function(){var S;return{token:new C(function(O){S=O}),cancel:S}},u.exports=C},function(u){u.exports={name:"axios",version:"0.21.4",description:"Promise based HTTP client for the browser and node.js",main:"index.js",scripts:{test:"grunt test",start:"node ./sandbox/server.js",build:"NODE_ENV=production grunt build",preversion:"npm test",version:"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json",postversion:"git push && git push --tags",examples:"node ./examples/server.js",coveralls:"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js",fix:"eslint --fix lib/**/*.js"},repository:{type:"git",url:"https://github.com/axios/axios.git"},keywords:["xhr","http","ajax","promise","node"],author:"Matt Zabriskie",license:"MIT",bugs:{url:"https://github.com/axios/axios/issues"},homepage:"https://axios-http.com",devDependencies:{coveralls:"^3.0.0","es6-promise":"^4.2.4",grunt:"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1",karma:"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2",minimist:"^1.2.0",mocha:"^8.2.1",sinon:"^4.5.0","terser-webpack-plugin":"^4.2.3",typescript:"^4.0.5","url-search-params":"^0.10.0",webpack:"^4.44.2","webpack-dev-server":"^3.11.0"},browser:{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},jsdelivr:"dist/axios.min.js",unpkg:"dist/axios.min.js",typings:"./index.d.ts",dependencies:{"follow-redirects":"^1.14.0"},bundlesize:[{path:"./dist/axios.min.js",threshold:"5kB"}],_resolved:"https://registry.npmjs.org/axios/-/axios-0.21.4.tgz",_integrity:"sha512-ut5vewkiu8jjGBdqpM44XxjuCjq9LAKeHVmoVfHVzy8eHgxxq8SbAVQNovDA8mVi05kP0Ea/n/UzcSHcTJQfNg==",_from:"axios@0.21.4"}},function(u,s,r){var l=r(266),C={};["object","boolean","number","function","string","symbol"].forEach(function(j,N){C[j]=function(L){return typeof L===j||"a"+(N<1?"n ":" ")+j}});var S={},O=l.version.split(".");function U(j,N){for(var L=N?N.split("."):O,W=j.split("."),z=0;z<3;z++){if(L[z]>W[z])return!0;if(L[z]<W[z])return!1}return!1}C.transitional=function(j,N,L){var W=N&&U(N);function z(q,I){return"[Axios v"+l.version+"] Transitional option '"+q+"'"+I+(L?". "+L:"")}return function(q,I,Z){if(j===!1)throw new Error(z(I," has been removed in "+N));return W&&!S[I]&&(S[I]=!0,console.warn(z(I," has been deprecated since v"+N+" and will be removed in the near future"))),!j||j(q,I,Z)}},u.exports={isOlderVersion:U,assertOptions:function(j,N,L){if(typeof j!="object")throw new TypeError("options must be an object");for(var W=Object.keys(j),z=W.length;z-- >0;){var q=W[z],I=N[q];if(I){var Z=j[q],Y=Z===void 0||I(Z,q,j);if(Y!==!0)throw new TypeError("option "+q+" must be "+Y)}else if(L!==!0)throw Error("Unknown option "+q)}},validators:C}},function(u,s,r){var l=r(36);u.exports=l.isStandardBrowserEnv()?function(){var C,S=/(msie|trident)/i.test(navigator.userAgent),O=document.createElement("a");function U(j){var N=j;return S&&(O.setAttribute("href",N),N=O.href),O.setAttribute("href",N),{href:O.href,protocol:O.protocol?O.protocol.replace(/:$/,""):"",host:O.host,search:O.search?O.search.replace(/^\?/,""):"",hash:O.hash?O.hash.replace(/^#/,""):"",hostname:O.hostname,port:O.port,pathname:O.pathname.charAt(0)==="/"?O.pathname:"/"+O.pathname}}return C=U(window.location.href),function(j){var N=l.isString(j)?U(j):j;return N.protocol===C.protocol&&N.host===C.host}}():function(){return!0}},function(u,s,r){var l=r(36),C=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];u.exports=function(S){var O,U,j,N={};return S&&l.forEach(S.split(`
`),function(L){if(j=L.indexOf(":"),O=l.trim(L.substr(0,j)).toLowerCase(),U=l.trim(L.substr(j+1)),O){if(N[O]&&C.indexOf(O)>=0)return;N[O]=O==="set-cookie"?(N[O]?N[O]:[]).concat([U]):N[O]?N[O]+", "+U:U}}),N}},function(u,s,r){u.exports=function(l,C){return C?l.replace(/\/+$/,"")+"/"+C.replace(/^\/+/,""):l}},function(u,s,r){u.exports=function(l){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(l)}},function(u,s,r){var l=r(271),C=r(270);u.exports=function(S,O){return S&&!l(O)?C(S,O):O}},function(u,s,r){var l=r(36);u.exports=l.isStandardBrowserEnv()?{write:function(C,S,O,U,j,N){var L=[];L.push(C+"="+encodeURIComponent(S)),l.isNumber(O)&&L.push("expires="+new Date(O).toGMTString()),l.isString(U)&&L.push("path="+U),l.isString(j)&&L.push("domain="+j),N===!0&&L.push("secure"),document.cookie=L.join("; ")},read:function(C){var S=document.cookie.match(new RegExp("(^|;\\s*)("+C+")=([^;]*)"));return S?decodeURIComponent(S[3]):null},remove:function(C){this.write(C,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(u,s,r){var l=r(191);u.exports=function(C,S,O){var U=O.config.validateStatus;O.status&&U&&!U(O.status)?S(l("Request failed with status code "+O.status,O.config,null,O.request,O)):C(O)}},function(u,s,r){var l=r(36);u.exports=function(C,S){l.forEach(C,function(O,U){U!==S&&U.toUpperCase()===S.toUpperCase()&&(C[S]=O,delete C[U])})}},function(u,s,r){var l=r(36),C=r(136);u.exports=function(S,O,U){var j=this||C;return l.forEach(U,function(N){S=N.call(j,S,O)}),S}},function(u,s,r){var l=r(36),C=r(276),S=r(190),O=r(136);function U(j){j.cancelToken&&j.cancelToken.throwIfRequested()}u.exports=function(j){return U(j),j.headers=j.headers||{},j.data=C.call(j,j.data,j.headers,j.transformRequest),j.headers=l.merge(j.headers.common||{},j.headers[j.method]||{},j.headers),l.forEach(["delete","get","head","post","put","patch","common"],function(N){delete j.headers[N]}),(j.adapter||O.adapter)(j).then(function(N){return U(j),N.data=C.call(j,N.data,N.headers,j.transformResponse),N},function(N){return S(N)||(U(j),N&&N.response&&(N.response.data=C.call(j,N.response.data,N.response.headers,j.transformResponse))),Promise.reject(N)})}},function(u,s,r){var l=r(36);function C(){this.handlers=[]}C.prototype.use=function(S,O,U){return this.handlers.push({fulfilled:S,rejected:O,synchronous:!!U&&U.synchronous,runWhen:U?U.runWhen:null}),this.handlers.length-1},C.prototype.eject=function(S){this.handlers[S]&&(this.handlers[S]=null)},C.prototype.forEach=function(S){l.forEach(this.handlers,function(O){O!==null&&S(O)})},u.exports=C},function(u,s,r){var l=r(36),C=r(194),S=r(278),O=r(277),U=r(189),j=r(267),N=j.validators;function L(W){this.defaults=W,this.interceptors={request:new S,response:new S}}L.prototype.request=function(W){typeof W=="string"?(W=arguments[1]||{}).url=arguments[0]:W=W||{},(W=U(this.defaults,W)).method?W.method=W.method.toLowerCase():this.defaults.method?W.method=this.defaults.method.toLowerCase():W.method="get";var z=W.transitional;z!==void 0&&j.assertOptions(z,{silentJSONParsing:N.transitional(N.boolean,"1.0.0"),forcedJSONParsing:N.transitional(N.boolean,"1.0.0"),clarifyTimeoutError:N.transitional(N.boolean,"1.0.0")},!1);var q=[],I=!0;this.interceptors.request.forEach(function(Ee){typeof Ee.runWhen=="function"&&Ee.runWhen(W)===!1||(I=I&&Ee.synchronous,q.unshift(Ee.fulfilled,Ee.rejected))});var Z,Y=[];if(this.interceptors.response.forEach(function(Ee){Y.push(Ee.fulfilled,Ee.rejected)}),!I){var G=[O,void 0];for(Array.prototype.unshift.apply(G,q),G=G.concat(Y),Z=Promise.resolve(W);G.length;)Z=Z.then(G.shift(),G.shift());return Z}for(var oe=W;q.length;){var ce=q.shift(),be=q.shift();try{oe=ce(oe)}catch(Ee){be(Ee);break}}try{Z=O(oe)}catch(Ee){return Promise.reject(Ee)}for(;Y.length;)Z=Z.then(Y.shift(),Y.shift());return Z},L.prototype.getUri=function(W){return W=U(this.defaults,W),C(W.url,W.params,W.paramsSerializer).replace(/^\?/,"")},l.forEach(["delete","get","head","options"],function(W){L.prototype[W]=function(z,q){return this.request(U(q||{},{method:W,url:z,data:(q||{}).data}))}}),l.forEach(["post","put","patch"],function(W){L.prototype[W]=function(z,q,I){return this.request(U(I||{},{method:W,url:z,data:q}))}}),u.exports=L},function(u,s,r){var l=r(36),C=r(195),S=r(279),O=r(189);function U(N){var L=new S(N),W=C(S.prototype.request,L);return l.extend(W,S.prototype,L),l.extend(W,L),W}var j=U(r(136));j.Axios=S,j.create=function(N){return U(O(j.defaults,N))},j.Cancel=r(188),j.CancelToken=r(265),j.isCancel=r(190),j.all=function(N){return Promise.all(N)},j.spread=r(264),j.isAxiosError=r(263),u.exports=j,u.exports.default=j},function(u,s,r){var l=function(C){var S,O=Object.prototype,U=O.hasOwnProperty,j=typeof Symbol=="function"?Symbol:{},N=j.iterator||"@@iterator",L=j.asyncIterator||"@@asyncIterator",W=j.toStringTag||"@@toStringTag";function z(pt,yt,nn){return Object.defineProperty(pt,yt,{value:nn,enumerable:!0,configurable:!0,writable:!0}),pt[yt]}try{z({},"")}catch{z=function(yt,nn,xt){return yt[nn]=xt}}function q(pt,yt,nn,xt){var _t=yt&&yt.prototype instanceof be?yt:be,Yt=Object.create(_t.prototype),Fn=new ze(xt||[]);return Yt._invoke=function(Rn,cn,qe){var Qe=Z;return function($e,ft){if(Qe===G)throw new Error("Generator is already running");if(Qe===oe){if($e==="throw")throw ft;return Ft()}for(qe.method=$e,qe.arg=ft;;){var Jt=qe.delegate;if(Jt){var Qt=bt(Jt,qe);if(Qt){if(Qt===ce)continue;return Qt}}if(qe.method==="next")qe.sent=qe._sent=qe.arg;else if(qe.method==="throw"){if(Qe===Z)throw Qe=oe,qe.arg;qe.dispatchException(qe.arg)}else qe.method==="return"&&qe.abrupt("return",qe.arg);Qe=G;var Pn=I(Rn,cn,qe);if(Pn.type==="normal"){if(Qe=qe.done?oe:Y,Pn.arg===ce)continue;return{value:Pn.arg,done:qe.done}}Pn.type==="throw"&&(Qe=oe,qe.method="throw",qe.arg=Pn.arg)}}}(pt,nn,Fn),Yt}function I(pt,yt,nn){try{return{type:"normal",arg:pt.call(yt,nn)}}catch(xt){return{type:"throw",arg:xt}}}C.wrap=q;var Z="suspendedStart",Y="suspendedYield",G="executing",oe="completed",ce={};function be(){}function Ee(){}function ve(){}var ge={};z(ge,N,function(){return this});var Ge=Object.getPrototypeOf,ht=Ge&&Ge(Ge(Ut([])));ht&&ht!==O&&U.call(ht,N)&&(ge=ht);var It=ve.prototype=be.prototype=Object.create(ge);function St(pt){["next","throw","return"].forEach(function(yt){z(pt,yt,function(nn){return this._invoke(yt,nn)})})}function we(pt,yt){var nn;this._invoke=function(xt,_t){function Yt(){return new yt(function(Fn,Rn){(function cn(qe,Qe,$e,ft){var Jt=I(pt[qe],pt,Qe);if(Jt.type!=="throw"){var Qt=Jt.arg,Pn=Qt.value;return Pn&&typeof Pn=="object"&&U.call(Pn,"__await")?yt.resolve(Pn.__await).then(function(kn){cn("next",kn,$e,ft)},function(kn){cn("throw",kn,$e,ft)}):yt.resolve(Pn).then(function(kn){Qt.value=kn,$e(Qt)},function(kn){return cn("throw",kn,$e,ft)})}ft(Jt.arg)})(xt,_t,Fn,Rn)})}return nn=nn?nn.then(Yt,Yt):Yt()}}function bt(pt,yt){var nn=pt.iterator[yt.method];if(nn===S){if(yt.delegate=null,yt.method==="throw"){if(pt.iterator.return&&(yt.method="return",yt.arg=S,bt(pt,yt),yt.method==="throw"))return ce;yt.method="throw",yt.arg=new TypeError("The iterator does not provide a 'throw' method")}return ce}var xt=I(nn,pt.iterator,yt.arg);if(xt.type==="throw")return yt.method="throw",yt.arg=xt.arg,yt.delegate=null,ce;var _t=xt.arg;return _t?_t.done?(yt[pt.resultName]=_t.value,yt.next=pt.nextLoc,yt.method!=="return"&&(yt.method="next",yt.arg=S),yt.delegate=null,ce):_t:(yt.method="throw",yt.arg=new TypeError("iterator result is not an object"),yt.delegate=null,ce)}function jt(pt){var yt={tryLoc:pt[0]};1 in pt&&(yt.catchLoc=pt[1]),2 in pt&&(yt.finallyLoc=pt[2],yt.afterLoc=pt[3]),this.tryEntries.push(yt)}function Mt(pt){var yt=pt.completion||{};yt.type="normal",delete yt.arg,pt.completion=yt}function ze(pt){this.tryEntries=[{tryLoc:"root"}],pt.forEach(jt,this),this.reset(!0)}function Ut(pt){if(pt){var yt=pt[N];if(yt)return yt.call(pt);if(typeof pt.next=="function")return pt;if(!isNaN(pt.length)){var nn=-1,xt=function _t(){for(;++nn<pt.length;)if(U.call(pt,nn))return _t.value=pt[nn],_t.done=!1,_t;return _t.value=S,_t.done=!0,_t};return xt.next=xt}}return{next:Ft}}function Ft(){return{value:S,done:!0}}return Ee.prototype=ve,z(It,"constructor",ve),z(ve,"constructor",Ee),Ee.displayName=z(ve,W,"GeneratorFunction"),C.isGeneratorFunction=function(pt){var yt=typeof pt=="function"&&pt.constructor;return!!yt&&(yt===Ee||(yt.displayName||yt.name)==="GeneratorFunction")},C.mark=function(pt){return Object.setPrototypeOf?Object.setPrototypeOf(pt,ve):(pt.__proto__=ve,z(pt,W,"GeneratorFunction")),pt.prototype=Object.create(It),pt},C.awrap=function(pt){return{__await:pt}},St(we.prototype),z(we.prototype,L,function(){return this}),C.AsyncIterator=we,C.async=function(pt,yt,nn,xt,_t){_t===void 0&&(_t=Promise);var Yt=new we(q(pt,yt,nn,xt),_t);return C.isGeneratorFunction(yt)?Yt:Yt.next().then(function(Fn){return Fn.done?Fn.value:Yt.next()})},St(It),z(It,W,"Generator"),z(It,N,function(){return this}),z(It,"toString",function(){return"[object Generator]"}),C.keys=function(pt){var yt=[];for(var nn in pt)yt.push(nn);return yt.reverse(),function xt(){for(;yt.length;){var _t=yt.pop();if(_t in pt)return xt.value=_t,xt.done=!1,xt}return xt.done=!0,xt}},C.values=Ut,ze.prototype={constructor:ze,reset:function(pt){if(this.prev=0,this.next=0,this.sent=this._sent=S,this.done=!1,this.delegate=null,this.method="next",this.arg=S,this.tryEntries.forEach(Mt),!pt)for(var yt in this)yt.charAt(0)==="t"&&U.call(this,yt)&&!isNaN(+yt.slice(1))&&(this[yt]=S)},stop:function(){this.done=!0;var pt=this.tryEntries[0].completion;if(pt.type==="throw")throw pt.arg;return this.rval},dispatchException:function(pt){if(this.done)throw pt;var yt=this;function nn(cn,qe){return Yt.type="throw",Yt.arg=pt,yt.next=cn,qe&&(yt.method="next",yt.arg=S),!!qe}for(var xt=this.tryEntries.length-1;xt>=0;--xt){var _t=this.tryEntries[xt],Yt=_t.completion;if(_t.tryLoc==="root")return nn("end");if(_t.tryLoc<=this.prev){var Fn=U.call(_t,"catchLoc"),Rn=U.call(_t,"finallyLoc");if(Fn&&Rn){if(this.prev<_t.catchLoc)return nn(_t.catchLoc,!0);if(this.prev<_t.finallyLoc)return nn(_t.finallyLoc)}else if(Fn){if(this.prev<_t.catchLoc)return nn(_t.catchLoc,!0)}else{if(!Rn)throw new Error("try statement without catch or finally");if(this.prev<_t.finallyLoc)return nn(_t.finallyLoc)}}}},abrupt:function(pt,yt){for(var nn=this.tryEntries.length-1;nn>=0;--nn){var xt=this.tryEntries[nn];if(xt.tryLoc<=this.prev&&U.call(xt,"finallyLoc")&&this.prev<xt.finallyLoc){var _t=xt;break}}_t&&(pt==="break"||pt==="continue")&&_t.tryLoc<=yt&&yt<=_t.finallyLoc&&(_t=null);var Yt=_t?_t.completion:{};return Yt.type=pt,Yt.arg=yt,_t?(this.method="next",this.next=_t.finallyLoc,ce):this.complete(Yt)},complete:function(pt,yt){if(pt.type==="throw")throw pt.arg;return pt.type==="break"||pt.type==="continue"?this.next=pt.arg:pt.type==="return"?(this.rval=this.arg=pt.arg,this.method="return",this.next="end"):pt.type==="normal"&&yt&&(this.next=yt),ce},finish:function(pt){for(var yt=this.tryEntries.length-1;yt>=0;--yt){var nn=this.tryEntries[yt];if(nn.finallyLoc===pt)return this.complete(nn.completion,nn.afterLoc),Mt(nn),ce}},catch:function(pt){for(var yt=this.tryEntries.length-1;yt>=0;--yt){var nn=this.tryEntries[yt];if(nn.tryLoc===pt){var xt=nn.completion;if(xt.type==="throw"){var _t=xt.arg;Mt(nn)}return _t}}throw new Error("illegal catch attempt")},delegateYield:function(pt,yt,nn){return this.delegate={iterator:Ut(pt),resultName:yt,nextLoc:nn},this.method==="next"&&(this.arg=S),ce}},C}(u.exports);try{regeneratorRuntime=l}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=l:Function("r","regeneratorRuntime = r")(l)}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.version="1.5.1"},function(u,s,r){var l=this&&this.__awaiter||function(U,j,N,L){return new(N||(N=Promise))(function(W,z){function q(Y){try{Z(L.next(Y))}catch(G){z(G)}}function I(Y){try{Z(L.throw(Y))}catch(G){z(G)}}function Z(Y){Y.done?W(Y.value):new N(function(G){G(Y.value)}).then(q,I)}Z((L=L.apply(U,j||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0});const C=r(137),S=r(46),O=r(110);s.valuesDistribution=function(U,j){return l(this,void 0,void 0,function*(){const N=S.getDrawArea(U),L=yield O.tensorStats(j),W=yield j.data();C.histogram(N,W,{height:150,stats:L})})}},function(u,s,r){var l=this&&this.__awaiter||function(O,U,j,N){return new(j||(j=Promise))(function(L,W){function z(Z){try{I(N.next(Z))}catch(Y){W(Y)}}function q(Z){try{I(N.throw(Z))}catch(Y){W(Y)}}function I(Z){Z.done?L(Z.value):new j(function(Y){Y(Z.value)}).then(z,q)}I((N=N.apply(O,U||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0});const C=r(46),S=r(109);s.perClassAccuracy=function(O,U,j){return l(this,void 0,void 0,function*(){const N=C.getDrawArea(O),L=[];for(let W=0;W<U.length;W++){const z=j?j[W]:W.toString(),q=U[W];L.push([z,q.accuracy,q.count])}return S.table(N,{headers:["Class","Accuracy","# Samples"],values:L})})}},function(u,s,r){var l=this&&this.__awaiter||function(W,z,q,I){return new(q||(q=Promise))(function(Z,Y){function G(be){try{ce(I.next(be))}catch(Ee){Y(Ee)}}function oe(be){try{ce(I.throw(be))}catch(Ee){Y(Ee)}}function ce(be){be.done?Z(be.value):new q(function(Ee){Ee(be.value)}).then(G,oe)}ce((I=I.apply(W,z||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0});const C=r(137),S=r(46),O=r(109),U=r(64),j=r(110);function N(W){let z;return Array.isArray(W.outputShape[0])?z=`[${W.outputShape.map(q=>L(q)).join(", ")}]`:z=L(W.outputShape),{name:W.name,trainable:W.trainable,parameters:W.countParams(),outputShape:z}}function L(W){const z=W.slice();return z.length===0?"Scalar":(z[0]===null&&(z[0]="batch"),`[${z.join(",")}]`)}s.modelSummary=function(W,z){return l(this,void 0,void 0,function*(){const q=S.getDrawArea(W),I=function(Z){return{layers:Z.layers.map(N)}}(z).layers.map(Z=>[Z.name,Z.outputShape,Z.parameters,Z.trainable]);O.table(q,{headers:["Layer Name","Output Shape","# Of Params","Trainable"],values:I})})},s.layer=function(W,z){return l(this,void 0,void 0,function*(){const q=S.getDrawArea(W),I=yield function(ce){return l(this,void 0,void 0,function*(){const be=ce.getWeights(),Ee=ce.weights,ve=be.map(j.tensorStats),ge=yield Promise.all(ve),Ge=be.map(ht=>ht.shape);return be.map((ht,It)=>({name:Ee[It].name,stats:ge[It],shape:L(Ge[It]),weight:ht}))})}(z),Z=U.subSurface(q,"layer-weights-info"),Y=I.map(ce=>[ce.name,ce.shape,ce.stats.min,ce.stats.max,ce.weight.size,ce.stats.numZeros,ce.stats.numNans,ce.stats.numInfs]);O.table(Z,{headers:["Weight Name","Shape","Min","Max","# Params","# Zeros","# NaNs","# Infinity"],values:Y});const G=U.subSurface(q,"select-layer"),oe=U.subSurface(q,"param-distribution");(function(ce,be,Ee){const ve=`<div><button>Show Values Distribution for:</button>${`
    <select>
      ${ce.map(ht=>`<option value=${ht}>${ht}</option>`)}
    </select>
  `}</div>`;be.innerHTML=ve;const ge=be.querySelector("button"),Ge=be.querySelector("select");ge.addEventListener("click",()=>{Ee(Ge.selectedOptions[0].label)})})(I.map(ce=>ce.name),G,ce=>l(this,void 0,void 0,function*(){const be=yield I.filter(Ee=>Ee.name===ce)[0].weight.data();C.histogram(oe,be,{height:150,width:460,stats:!1})}))})}},function(u,s,r){var l=this&&this.__awaiter||function(W,z,q,I){return new(q||(q=Promise))(function(Z,Y){function G(be){try{ce(I.next(be))}catch(Ee){Y(Ee)}}function oe(be){try{ce(I.throw(be))}catch(Ee){Y(Ee)}}function ce(be){be.done?Z(be.value):new q(function(Ee){Ee(be.value)}).then(G,oe)}ce((I=I.apply(W,z||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0});const C=r(196),S=r(46),O=r(64);function U(W,z,q,I={}){return l(this,void 0,void 0,function*(){const Z=S.getDrawArea(W),Y={};for(const be of q)if(/val_/.test(be)){const Ee=be.replace("val_","");j(Y,Ee);const ve=N(z,be,q.indexOf(be));Y[Ee].series.push(be),Y[Ee].values.push(ve)}else{const Ee=N(z,be,q.indexOf(be));j(Y,be),Y[be].series.push(be),Y[be].values.push(Ee)}const G=Object.keys(Y),oe=Object.assign({},{xLabel:"Iteration",yLabel:"Value"},I),ce=[];for(const be of G){const Ee=O.subSurface(Z,be),ve=Y[be].series,ge=Y[be].values;ve.every(ht=>Boolean(ht.match("acc")))&&(oe.zoomToFitAccuracy?oe.zoomToFit=!0:(oe.yAxisDomain=[0,1],delete oe.zoomToFit));const Ge=C.linechart(Ee,{values:ge,series:ve},oe);ce.push(Ge)}yield Promise.all(ce)})}function j(W,z){W[z]==null&&(W[z]={series:[],values:[]})}function N(W,z,q){if(Array.isArray(W)){const I=Array.isArray(W[0])?W[q]:W,Z=[];for(let Y=0;Y<I.length;Y++){const G=I[Y];Z.push({x:Y,y:G[z]})}return Z}return W.history[z].map((I,Z)=>({x:Z,y:I}))}function L(W,z,q){return W[z]==null&&(W[z]={}),W[z][q]==null&&(W[z][q]=[]),W[z][q]}s.history=U,s.fitCallbacks=function(W,z,q={}){const I={},Z=q.callbacks||["onEpochEnd","onBatchEnd"],Y=S.getDrawArea(W),G=Object.assign({},q);delete G.callbacks;const oe={};return Z.forEach(ce=>{oe[ce]=function(be){return(Ee,ve)=>l(this,void 0,void 0,function*(){/batch/i.test(be)?G.xLabel="Batch":/epoch/i.test(be)&&(G.xLabel="Epoch");const ge=[],Ge=[];for(const ht of z)if(ve[ht]!=null){Ge.push(ht);const It=L(I,be,ht);It.push({[ht]:ve[ht]}),ge.push(It)}U(O.subSurface(Y,be,{title:be}),ge,Ge,G),yield S.nextFrame()})}(ce)}),oe}},function(u,s,r){var l=this&&this.__awaiter||function(L,W,z,q){return new(z||(z=Promise))(function(I,Z){function Y(ce){try{oe(q.next(ce))}catch(be){Z(be)}}function G(ce){try{oe(q.throw(ce))}catch(be){Z(be)}}function oe(ce){ce.done?I(ce.value):new z(function(be){be(ce.value)}).then(Y,G)}oe((q=q.apply(L,W||[])).next())})},C=this&&this.__importDefault||function(L){return L&&L.__esModule?L:{default:L}};Object.defineProperty(s,"__esModule",{value:!0});const S=C(r(88)),O=r(64),U=r(111),j=r(46);s.scatterplot=function(L,W,z={}){return l(this,void 0,void 0,function*(){let q=W.values;const I=W.series==null?[]:W.series,Z=[];(q=Array.isArray(q[0])?q:[q]).forEach((ce,be)=>{const Ee=I[be]!=null?I[be]:`Series ${be+1}`,ve=ce.map(ge=>Object.assign({},ge,{series:Ee}));Z.push(...ve)}),z.seriesColors!=null&&U.assert(z.seriesColors.length===q.length,"Must have an equal number of series colors as there are data series");const Y=j.getDrawArea(L),G=Object.assign({},N,z),oe={width:G.width||O.getDefaultWidth(Y),height:G.height||O.getDefaultHeight(Y),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:G.fontSize,titleFontSize:G.fontSize},text:{fontSize:G.fontSize},legend:{labelFontSize:G.fontSize,titleFontSize:G.fontSize}},data:{values:Z},mark:{type:"point",clip:!0,tooltip:{content:"data"}},encoding:{x:{field:"x",type:G.xType,title:G.xLabel,scale:G.zoomToFit?{zero:!1}:G.xAxisDomain!=null?{domain:G.xAxisDomain}:void 0},y:{field:"y",type:G.yType,title:G.yLabel,scale:G.zoomToFit?{zero:!1}:G.yAxisDomain!=null?{domain:G.yAxisDomain}:void 0},color:{field:"series",type:"nominal",scale:{range:G.seriesColors}},shape:{field:"series",type:"nominal"}}};return yield S.default(Y,oe,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()})};const N={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},function(u,s,r){var l=this&&this.__awaiter||function(q,I,Z,Y){return new(Z||(Z=Promise))(function(G,oe){function ce(ve){try{Ee(Y.next(ve))}catch(ge){oe(ge)}}function be(ve){try{Ee(Y.throw(ve))}catch(ge){oe(ge)}}function Ee(ve){ve.done?G(ve.value):new Z(function(ge){ge(ve.value)}).then(ce,be)}Ee((Y=Y.apply(q,I||[])).next())})},C=this&&this.__importStar||function(q){if(q&&q.__esModule)return q;var I={};if(q!=null)for(var Z in q)Object.hasOwnProperty.call(q,Z)&&(I[Z]=q[Z]);return I.default=q,I},S=this&&this.__importDefault||function(q){return q&&q.__esModule?q:{default:q}};Object.defineProperty(s,"__esModule",{value:!0});const O=C(r(0)),U=S(r(88)),j=r(64),N=r(111),L=r(46);function W(q,I,Z){const Y=q instanceof O.Tensor?q.shape:[q.length,q[0].length];Z===0?N.assert(Y[0]===I.length,`Length of xTickLabels (${I.length}) must match number of rows (${Y[0]})`):Z===1&&N.assert(Y[1]===I.length,`Length of yTickLabels (${I.length}) must match number of columns (${Y[1]})`)}s.heatmap=function(q,I,Z={}){return l(this,void 0,void 0,function*(){const Y=Object.assign({},z,Z),G=L.getDrawArea(q);let oe=I.values;Y.rowMajor&&(oe=yield function(It){return l(this,void 0,void 0,function*(){let St,we;It instanceof O.Tensor?(St=It.shape,we=It.transpose()):(St=[It.length,It[0].length],we=O.tidy(()=>O.tensor2d(It).transpose())),N.assert(we.rank===2,"Input to renderHeatmap must be a 2d array or Tensor2d");const bt=yield we.array();we.dispose();const jt=[bt.length,bt[0].length];return N.assert(St[0]===jt[1]&&St[1]===jt[0],`Unexpected transposed shape. Original ${St} : Transposed ${jt}`),bt})}(I.values));const{xTickLabels:ce,yTickLabels:be}=I;ce!=null&&W(oe,ce,0),be!=null&&W(oe,be,1);const Ee=[];if(oe instanceof O.Tensor){N.assert(oe.rank===2,"Input to renderHeatmap must be a 2d array or Tensor2d");const It=yield oe.data(),[St,we]=oe.shape;for(let bt=0;bt<St;bt++){const jt=ce?`${ce[bt]}@tfidx@${bt}`:bt;for(let Mt=0;Mt<we;Mt++){const ze=be?`${be[Mt]}@tfidx@${Mt}`:Mt,Ut=It[bt*we+Mt];Ee.push({x:jt,y:ze,value:Ut})}}}else{const It=oe;for(let St=0;St<It.length;St++){const we=ce?`${ce[St]}@tfidx@${St}`:St;for(let bt=0;bt<It[St].length;bt++){const jt=be?`${be[bt]}@tfidx@${bt}`:bt,Mt=It[St][bt];Ee.push({x:we,y:jt,value:Mt})}}}const ve={actions:!1,mode:"vega-lite",defaultStyle:!1},ge={width:Y.width||j.getDefaultWidth(G),height:Y.height||j.getDefaultHeight(G),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:Y.fontSize,titleFontSize:Y.fontSize},text:{fontSize:Y.fontSize},legend:{labelFontSize:Y.fontSize,titleFontSize:Y.fontSize},scale:{bandPaddingInner:0,bandPaddingOuter:0}},data:{values:Ee},mark:{type:"rect",tooltip:!0},encoding:{x:{field:"x",type:Y.xType,title:Y.xLabel,sort:!1},y:{field:"y",type:Y.yType,title:Y.yLabel,sort:!1},fill:{field:"value",type:"quantitative"}}},Ge=new RegExp("@tfidx@\\d+$");let ht;switch(ce&&(ge.encoding.x.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),be&&(ge.encoding.y.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),(ce||be)&&(ve.tooltip={sanitize:It=>String(It).replace(Ge,"")}),Y.colorMap){case"blues":ht=["#f7fbff","#4292c6"];break;case"greyscale":ht=["#000000","#ffffff"];break;case"viridis":default:ht="viridis"}if(ht!=="viridis"&&(ge.encoding.fill.scale={range:ht}),Y.domain){const It=ge.encoding.fill;It.scale!=null?It.scale=Object.assign({},It.scale,{domain:Y.domain}):It.scale={domain:Y.domain}}yield U.default(G,ge,ve)})};const z={xLabel:null,yLabel:null,xType:"ordinal",yType:"ordinal",colorMap:"viridis",fontSize:12,domain:null,rowMajor:!1}},function(u,s,r){var l=this&&this.__awaiter||function(N,L,W,z){return new(W||(W=Promise))(function(q,I){function Z(oe){try{G(z.next(oe))}catch(ce){I(ce)}}function Y(oe){try{G(z.throw(oe))}catch(ce){I(ce)}}function G(oe){oe.done?q(oe.value):new W(function(ce){ce(oe.value)}).then(Z,Y)}G((z=z.apply(N,L||[])).next())})},C=this&&this.__importDefault||function(N){return N&&N.__esModule?N:{default:N}};Object.defineProperty(s,"__esModule",{value:!0});const S=C(r(88)),O=r(64),U=r(46);s.confusionMatrix=function(N,L,W={}){return l(this,void 0,void 0,function*(){const z=Object.assign({},j,W),q=U.getDrawArea(N),I=[],Z=L.values,Y=L.tickLabels||[],G=Y.length===0;let oe=!0;for(let Ee=0;Ee<Z.length;Ee++){const ve=G?`Class ${Ee}`:Y[Ee];G&&Y.push(ve);for(let ge=0;ge<Z[Ee].length;ge++){const Ge=G?`Class ${ge}`:Y[ge],ht=Z[Ee][ge];Ee!==ge||z.shadeDiagonal?(I.push({label:ve,prediction:Ge,count:ht,scaleCount:ht}),ht!==0&&(oe=!1)):I.push({label:ve,prediction:Ge,count:ht,noFill:!0})}}if(!z.shadeDiagonal&&oe)for(const Ee of I)Ee.noFill===!0&&(Ee.noFill=!1,Ee.scaleCount=Ee.count);const ce={width:z.width||O.getDefaultWidth(q),height:z.height||O.getDefaultHeight(q),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:z.fontSize,titleFontSize:z.fontSize},text:{fontSize:z.fontSize},legend:{labelFontSize:z.fontSize,titleFontSize:z.fontSize}},data:{values:I},encoding:{x:{field:"prediction",type:"ordinal",title:z.xLabel||"prediction",scale:{domain:Y}},y:{field:"label",type:"ordinal",title:z.yLabel||"label",scale:{domain:Y}}},layer:[{transform:[{filter:"datum.noFill != true"}],mark:{type:"rect"},encoding:{color:{field:"scaleCount",type:"quantitative",scale:{range:z.colorMap}},tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}]};z.shadeDiagonal===!1&&ce.layer.push({transform:[{filter:"datum.noFill == true"}],mark:{type:"rect",fill:"white"},encoding:{tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}),z.showTextOverlay&&ce.layer.push({mark:{type:"text",baseline:"middle"},encoding:{text:{field:"count",type:"nominal"}}});const be=typeof z.colorMap=="string"?{scheme:z.colorMap}:z.colorMap;ce.layer[0].encoding.color.scale.range=be,yield S.default(q,ce,{actions:!1,mode:"vega-lite",defaultStyle:!1})})};const j={xLabel:null,yLabel:null,xType:"nominal",yType:"nominal",shadeDiagonal:!0,fontSize:12,showTextOverlay:!0,height:400,colorMap:["#f7fbff","#4292c6"]}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});const l=r(138),C=r(102);s.Tabs=class extends l.Component{render(){const{tabNames:O,activeTab:U,handleClick:j}=this.props,N=O.length>0?O.map(W=>l.h(S,{key:W,id:W,handleClick:j,isActive:W===U},W)):null,L=C.css({overflowX:"scroll",overflowY:"hidden",whiteSpace:"nowrap",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"#eee",paddingBottom:"1rem",marginTop:"1rem"});return l.h("div",{className:`${L} visor-tabs`},N)}};class S extends l.Component{render(){const{children:U,isActive:j,handleClick:N,id:L}=this.props,W=C.css({borderBottomColor:j?"#357EDD":"#AAAAAA",borderBottomWidth:"1px",borderBottomStyle:"solid",cursor:"pointer",":hover":{color:"#357EDD"},display:"inline-block",marginRight:"1rem",padding:".5rem",fontSize:"1rem",fontWeight:"bold"});return l.h("a",{className:`${W} tf-tab`,"data-isactive":j,onClick:()=>N(L)},U)}}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});const l=r(138),C=r(102);class S extends l.Component{componentDidMount(){const{name:U,tab:j}=this.props;this.props.registerSurface(U,j,this)}componentDidUpdate(){return!1}render(){const{name:U,visible:j,styles:N}=this.props,L=Object.assign({},S.defaultStyles,N),{width:W,height:z}=L;let{maxHeight:q,maxWidth:I}=L;q=z===S.defaultStyles.height?q:z,I=W===S.defaultStyles.width?I:W;const Z=C.css({display:j?"block":"none",backgroundColor:"white",marginTop:"10px",marginBottom:"10px",boxShadow:"0 0 6px -3px #777",padding:"10px !important",height:z,width:W,maxHeight:q,maxWidth:I,overflow:"auto"}),Y=C.css({backgroundColor:"white",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",marginBottom:"20px",fontWeight:"600",textAlign:"center"}),G=C.css({boxSizing:"border-box"});return l.h("div",{className:`${Z} tf-surface`,ref:oe=>this.container=oe,"data-visible":j},l.h("div",{className:`${Y} tf-label`,ref:oe=>this.label=oe},U),l.h("div",{className:`${G} tf-draw-area`,ref:oe=>this.drawArea=oe}))}}S.defaultStyles={maxWidth:"550px",maxHeight:"580px",height:"auto",width:"auto"},s.SurfaceComponent=S},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});const l=r(138),C=r(102),S=r(291),O=r(290);class U extends l.Component{static render(L,W,z){return l.render(l.h(U,Object.assign({},z)),L,W)}constructor(L){super(L),this.surfaces=new Map;const W=L.startOpen==null||L.startOpen;this.state={isOpen:W,isFullscreen:!1,activeTab:null,tabs:new Set},this.keyHandler=this.keyHandler.bind(this)}close(){this.setState({isOpen:!1})}open(){this.setState({isOpen:!0})}toggle(){this.setState({isOpen:!this.state.isOpen})}toggleFullScreen(){this.setState({isFullscreen:!this.state.isFullscreen})}isOpen(){return this.state.isOpen}isFullscreen(){return this.state.isFullscreen}getSurface(L,W){const z=this.surfaceId(L,W);let q;if(!this.surfaces.has(z))throw Error(`Surface not found with id: ${z}`);return{container:(q=this.surfaces.get(z)).container,label:q.label,drawArea:q.drawArea}}bindKeys(){document.addEventListener("keydown",this.keyHandler,!1)}unbindKeys(){document.removeEventListener("keydown",this.keyHandler)}surfaceId(L,W){return L+W}setTabs(L){const W=L.map(I=>I.tab),z=this.state.tabs;let q;for(const I of W)z.has(I)||(z.add(I),q=I);q!=null&&this.setState({tabs:z,activeTab:q})}getTabs(){return this.state.tabs}registerSurface(L,W,z){const q=this.surfaceId(L,W);this.surfaces.set(q,z)}keyHandler(L){L.keyCode===192&&(L.shiftKey?this.toggleFullScreen():this.toggle())}setActiveTab(L){this.setState({activeTab:L})}componentDidMount(){this.bindKeys()}componentWillMount(){this.setTabs(this.props.surfaceList)}componentWillReceiveProps(L){this.setTabs(L.surfaceList)}render(){const{isOpen:L,isFullscreen:W,activeTab:z}=this.state,{surfaceList:q}=this.props,I=Array.from(this.getTabs().values()),Z=W?"90vw":"550px",Y=C.css({width:Z,height:"100%",backgroundColor:"#fafafa",boxSizing:"border-box",padding:"10px",position:"fixed",top:"0px",transition:"right 0.5s cubic-bezier(0.645, 0.045, 0.355, 1), width 0.5s cubic-bezier(0.645, 0.045, 0.355, 1)",boxShadow:"0 2px 5px rgba(0, 0, 0, 0.12), 0 2px 5px rgba(0, 0, 0, 0.24)",overflow:"auto",fontFamily:"sans-serif",fontSize:"14px",zIndex:1e3}),G=C.css({right:"0"}),oe=C.css({right:`calc(-${Z} - 10px)`}),ce=L?G:oe,be=C.css({});return l.h("div",{className:`${Y} ${ce} visor`,"data-isopen":L,"data-isfullscreen":W},l.h(j,{fullScreenHandler:this.toggleFullScreen.bind(this),closeHandler:this.close.bind(this),isFullScreen:W}),l.h(O.Tabs,{tabNames:I,activeTab:z,handleClick:this.setActiveTab.bind(this)}),l.h("div",{className:`${be} visor-surfaces`},q.map(Ee=>l.h(S.SurfaceComponent,{key:Ee.name+Ee.tab,name:Ee.name,tab:Ee.tab,styles:Ee.styles,registerSurface:this.registerSurface.bind(this),visible:z===Ee.tab}))))}}function j(N){const{isFullScreen:L,fullScreenHandler:W,closeHandler:z}=N,q=C.css({display:"flex",backgroundColor:"white",border:"1px solid white",padding:"6px",paddingTop:"10px",marginBottom:"10px",borderRadius:"6px",marginTop:"-16px"}),I=C.css({fontSize:".875rem",borderRadius:".25rem",paddingLeft:"1rem",paddingRight:"1rem",paddingTop:".5rem",paddingBottom:".5rem",textDecoration:"none",transition:"color .15s ease-in",color:"#111"}),Z=C.css({marginLeft:"auto"});return l.h("div",{className:`${q} visor-controls`},l.h("button",{className:`${I}`,onClick:W},L?"Minimize":"Maximize"),l.h("button",{className:`${I} ${Z}`,onClick:z},"Hide"))}s.VisorComponent=U},function(u,s,r){function l(O,U){return O.charCodeAt(U++)+(O.charCodeAt(U++)<<8)+(O.charCodeAt(U++)<<16)+(O.charCodeAt(U)<<24)}function C(O,U){return O.charCodeAt(U++)+(O.charCodeAt(U++)<<8)}function S(O,U){return(65535&(O|=0))*(U|=0)+(((O>>>16)*U&65535)<<16)|0}Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(O,U){for(var j=1540483477,N=U^O.length,L=O.length,W=0;L>=4;){var z=l(O,W);z=S(z,j),z=S(z^=z>>>24,j),N=S(N,j),N^=z,W+=4,L-=4}switch(L){case 3:N^=C(O,W),N=S(N^=O.charCodeAt(W+2)<<16,j);break;case 2:N=S(N^=C(O,W),j);break;case 1:N=S(N^=O.charCodeAt(W),j)}return N=S(N^=N>>>13,j),(N^=N>>>15)>>>0}},function(u,s,r){r.r(s);var l=/[A-Z]/g,C=/^ms-/,S={};function O(U){return"-"+U.toLowerCase()}s.default=function(U){if(S.hasOwnProperty(U))return S[U];var j=U.replace(l,O);return S[U]=C.test(j)?"-"+j:j}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(C){return(0,l.default)(C)};var l=function(C){return C&&C.__esModule?C:{default:C}}(r(294));u.exports=s.default},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(N,L,W,z){if(typeof L=="string"&&U.hasOwnProperty(N)){var q=function(Y,G){if((0,C.default)(Y))return Y;for(var oe=Y.split(/,(?![^()]*(?:\([^()]*\))?\))/g),ce=0,be=oe.length;ce<be;++ce){var Ee=oe[ce],ve=[Ee];for(var ge in G){var Ge=(0,l.default)(ge);if(Ee.indexOf(Ge)>-1&&Ge!=="order")for(var ht=G[ge],It=0,St=ht.length;It<St;++It)ve.unshift(Ee.replace(Ge,j[ht[It]]+Ge))}oe[ce]=ve.join(",")}return oe.join(",")}(L,z),I=q.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter(function(Y){return!/-moz-|-ms-/.test(Y)}).join(",");if(N.indexOf("Webkit")>-1)return I;var Z=q.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter(function(Y){return!/-webkit-|-ms-/.test(Y)}).join(",");return N.indexOf("Moz")>-1?Z:(W["Webkit"+(0,S.default)(N)]=I,W["Moz"+(0,S.default)(N)]=Z,q)}};var l=O(r(295)),C=O(r(101)),S=O(r(199));function O(N){return N&&N.__esModule?N:{default:N}}var U={transition:!0,transitionProperty:!0,WebkitTransition:!0,WebkitTransitionProperty:!0,MozTransition:!0,MozTransitionProperty:!0},j={Webkit:"-webkit-",Moz:"-moz-",ms:"-ms-"};u.exports=s.default},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(O,U){if(C.hasOwnProperty(O)&&S.hasOwnProperty(U))return l.map(function(j){return j+U})};var l=["-webkit-","-moz-",""],C={maxHeight:!0,maxWidth:!0,width:!0,height:!0,columnWidth:!0,minWidth:!0,minHeight:!0},S={"min-content":!0,"max-content":!0,"fill-available":!0,"fit-content":!0,"contain-floats":!0};u.exports=s.default},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(l,C){if(l==="position"&&C==="sticky")return["-webkit-sticky","sticky"]},u.exports=s.default},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(S,O){if(typeof O=="string"&&!(0,l.default)(O)&&O.indexOf("image-set(")>-1)return C.map(function(U){return O.replace(/image-set\(/g,U+"image-set(")})};var l=function(S){return S&&S.__esModule?S:{default:S}}(r(101)),C=["-webkit-",""];u.exports=s.default},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(O,U){if(typeof U=="string"&&!(0,l.default)(U)&&S.test(U))return C.map(function(j){return j+U})};var l=function(O){return O&&O.__esModule?O:{default:O}}(r(101)),C=["-webkit-","-moz-",""],S=/linear-gradient|radial-gradient|repeating-linear-gradient|repeating-radial-gradient/;u.exports=s.default},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(S,O,U){S==="flexDirection"&&typeof O=="string"&&(O.indexOf("column")>-1?U.WebkitBoxOrient="vertical":U.WebkitBoxOrient="horizontal",O.indexOf("reverse")>-1?U.WebkitBoxDirection="reverse":U.WebkitBoxDirection="normal"),C.hasOwnProperty(S)&&(U[C[S]]=l[O]||O)};var l={"space-around":"justify","space-between":"justify","flex-start":"start","flex-end":"end","wrap-reverse":"multiple",wrap:"multiple"},C={alignItems:"WebkitBoxAlign",justifyContent:"WebkitBoxPack",flexWrap:"WebkitBoxLines"};u.exports=s.default},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(C,S){if(C==="display"&&l.hasOwnProperty(S))return l[S]};var l={flex:["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex","flex"],"inline-flex":["-webkit-inline-box","-moz-inline-box","-ms-inline-flexbox","-webkit-inline-flex","inline-flex"]};u.exports=s.default},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(S,O){if(typeof O=="string"&&!(0,l.default)(O)&&O.indexOf("filter(")>-1)return C.map(function(U){return O.replace(/filter\(/g,U+"filter(")})};var l=function(S){return S&&S.__esModule?S:{default:S}}(r(101)),C=["-webkit-",""];u.exports=s.default},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(S,O){if(typeof O=="string"&&!(0,l.default)(O)&&O.indexOf("cross-fade(")>-1)return C.map(function(U){return O.replace(/cross-fade\(/g,U+"cross-fade(")})};var l=function(S){return S&&S.__esModule?S:{default:S}}(r(101)),C=["-webkit-",""];u.exports=s.default},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(S,O){if(S==="cursor"&&C.hasOwnProperty(O))return l.map(function(U){return U+O})};var l=["-webkit-","-moz-",""],C={"zoom-in":!0,"zoom-out":!0,grab:!0,grabbing:!0};u.exports=s.default},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(l,C,S,O,U){for(var j=0,N=l.length;j<N;++j){var L=l[j](C,S,O,U);if(L)return L}},u.exports=s.default},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(C,S,O){if(C.hasOwnProperty(S))for(var U=C[S],j=0,N=U.length;j<N;++j)O[U[j]+(0,l.default)(S)]=O[S]};var l=function(C){return C&&C.__esModule?C:{default:C}}(r(199));u.exports=s.default},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=["Webkit"],C=["Moz"],S=["ms"],O=["Webkit","Moz"],U=["Webkit","ms"],j=["Webkit","Moz","ms"];s.default={plugins:[],prefixMap:{appearance:O,userSelect:j,textEmphasisPosition:l,textEmphasis:l,textEmphasisStyle:l,textEmphasisColor:l,boxDecorationBreak:l,clipPath:l,maskImage:l,maskMode:l,maskRepeat:l,maskPosition:l,maskClip:l,maskOrigin:l,maskSize:l,maskComposite:l,mask:l,maskBorderSource:l,maskBorderMode:l,maskBorderSlice:l,maskBorderWidth:l,maskBorderOutset:l,maskBorderRepeat:l,maskBorder:l,maskType:l,textDecorationStyle:l,textDecorationSkip:l,textDecorationLine:l,textDecorationColor:l,filter:l,fontFeatureSettings:l,breakAfter:j,breakBefore:j,breakInside:j,columnCount:O,columnFill:O,columnGap:O,columnRule:O,columnRuleColor:O,columnRuleStyle:O,columnRuleWidth:O,columns:O,columnSpan:O,columnWidth:O,writingMode:U,flex:l,flexBasis:l,flexDirection:l,flexGrow:l,flexFlow:l,flexShrink:l,flexWrap:l,alignContent:l,alignItems:l,alignSelf:l,justifyContent:l,order:l,transform:l,transformOrigin:l,transformOriginX:l,transformOriginY:l,backfaceVisibility:l,perspective:l,perspectiveOrigin:l,transformStyle:l,transformOriginZ:l,animation:l,animationDelay:l,animationDirection:l,animationFillMode:l,animationDuration:l,animationIterationCount:l,animationName:l,animationPlayState:l,animationTimingFunction:l,backdropFilter:l,fontKerning:l,scrollSnapType:U,scrollSnapPointsX:U,scrollSnapPointsY:U,scrollSnapDestination:U,scrollSnapCoordinate:U,shapeImageThreshold:l,shapeImageMargin:l,shapeImageOutside:l,hyphens:j,flowInto:U,flowFrom:U,regionFragment:U,textAlignLast:C,tabSize:C,wrapFlow:S,wrapThrough:S,wrapMargin:S,gridTemplateColumns:S,gridTemplateRows:S,gridTemplateAreas:S,gridTemplate:S,gridAutoColumns:S,gridAutoRows:S,gridAutoFlow:S,grid:S,gridRowStart:S,gridColumnStart:S,gridRowEnd:S,gridRow:S,gridColumn:S,gridColumnEnd:S,gridColumnGap:S,gridRowGap:S,gridArea:S,gridGap:S,textSizeAdjust:U,borderImage:l,borderImageOutset:l,borderImageRepeat:l,borderImageSlice:l,borderImageSource:l,borderImageWidth:l,transitionDelay:l,transitionDuration:l,transitionProperty:l,transitionTimingFunction:l}},u.exports=s.default},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(ce){for(var be in ce){var Ee=ce[be],ve=(0,S.default)(G,be,Ee,ce,oe);ve&&(ce[be]=ve),(0,C.default)(oe,be,ce)}return ce};var l=Y(r(308)),C=Y(r(307)),S=Y(r(306)),O=Y(r(305)),U=Y(r(304)),j=Y(r(303)),N=Y(r(302)),L=Y(r(301)),W=Y(r(300)),z=Y(r(299)),q=Y(r(298)),I=Y(r(297)),Z=Y(r(296));function Y(ce){return ce&&ce.__esModule?ce:{default:ce}}var G=[U.default,O.default,j.default,L.default,W.default,z.default,q.default,I.default,Z.default,N.default],oe=l.default.prefixMap},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=Object.assign||function(L){for(var W=1;W<arguments.length;W++){var z=arguments[W];for(var q in z)Object.prototype.hasOwnProperty.call(z,q)&&(L[q]=z[q])}return L};s.PluginSet=j,s.fallbacks=function(L){if(Object.keys(L.style).map(function(q){return Array.isArray(L.style[q])}).indexOf(!0)>=0){var W=L.style,z=Object.keys(W).reduce(function(q,I){return q[I]=Array.isArray(W[I])?W[I].join("; "+(0,S.processStyleName)(I)+": "):W[I],q},{});return(0,C.default)({},L,{style:z})}return L},s.contentWrap=function(L){if(L.style.content){var W=L.style.content;return N.indexOf(W)>=0||/^(attr|calc|counters?|url)\(/.test(W)?L:W.charAt(0)!==W.charAt(W.length-1)||W.charAt(0)!=='"'&&W.charAt(0)!=="'"?l({},L,{style:l({},L.style,{content:'"'+W+'"'})}):L}return L},s.prefixes=function(L){return(0,C.default)({},L,{style:(0,O.default)(l({},L.style))})};var C=U(r(139)),S=r(201),O=U(r(309));function U(L){return L&&L.__esModule?L:{default:L}}function j(L){this.fns=L||[]}(0,C.default)(j.prototype,{add:function(){for(var L=this,W=arguments.length,z=Array(W),q=0;q<W;q++)z[q]=arguments[q];z.forEach(function(I){L.fns.indexOf(I)>=0||(L.fns=[I].concat(L.fns))})},remove:function(L){this.fns=this.fns.filter(function(W){return W!==L})},clear:function(){this.fns=[]},transform:function(L){return this.fns.reduce(function(W,z){return z(W)},L)}});var N=["normal","none","counter","open-quote","close-quote","no-open-quote","no-close-quote","initial","inherit"]},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(O){return typeof O}:function(O){return O&&typeof Symbol=="function"&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O};function C(O){if(function(q){return q==null||q===!1||(q===void 0?"undefined":l(q))==="object"&&Object.keys(q).length===0}(O))return null;if((O===void 0?"undefined":l(O))!=="object")return O;for(var U={},j=Object.keys(O),N=!1,L=0;L<j.length;L++){var W=O[j[L]],z=S(W);z!==null&&z===W||(N=!0),z!==null&&(U[j[L]]=z)}return Object.keys(U).length===0?null:N?U:O}function S(O){return Array.isArray(O)?function(U){var j=!1,N=[];return U.forEach(function(L){var W=S(L);W!==null&&W===L||(j=!0),W!==null&&N.push(W)}),N.length==0?null:j?N:U}(O):C(O)}s.default=S},function(u,s,r){u.exports=function(l){var C={};return function(S){return C.hasOwnProperty(S)||(C[S]=l.call(this,S)),C[S]}}},function(u,s,r){var l=/([A-Z])/g;u.exports=function(C){return C.replace(l,"-$1").toLowerCase()}},function(u,s,r){var l=r(313),C=/^ms-/;u.exports=function(S){return l(S).replace(C,"-ms-")}},function(u,s,r){function l(S){return function(){return S}}var C=function(){};C.thatReturns=l,C.thatReturnsFalse=l(!1),C.thatReturnsTrue=l(!0),C.thatReturnsNull=l(null),C.thatReturnsThis=function(){return this},C.thatReturnsArgument=function(S){return S},u.exports=C},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowStart:!0,gridRowEnd:!0,gridColumn:!0,gridColumnStart:!0,gridColumnEnd:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},C=["Webkit","ms","Moz","O"];Object.keys(l).forEach(function(O){C.forEach(function(U){l[function(j,N){return j+N.charAt(0).toUpperCase()+N.substring(1)}(U,O)]=l[O]})});var S={isUnitlessNumber:l,shorthandPropertyExpansions:{background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}}};s.default=S},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=C(r(316));C(r(200));function C(O){return O&&O.__esModule?O:{default:O}}var S=l.default.isUnitlessNumber;s.default=function(O,U,j){return U==null||typeof U=="boolean"||U===""?"":isNaN(U)||U===0||S.hasOwnProperty(O)&&S[O]?""+U:(typeof U=="string"&&(U=U.trim()),U+"px")}},function(u,s,r){var l=/-(.)/g;u.exports=function(C){return C.replace(l,function(S,O){return O.toUpperCase()})}},function(u,s,r){var l=r(318),C=/^-ms-/;u.exports=function(S){return l(S.replace(C,"ms-"))}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),s.StyleSheet=L;var l=function(W){return W&&W.__esModule?W:{default:W}}(r(139));function C(W){return W[W.length-1]}function S(W){if(W.sheet)return W.sheet;for(var z=0;z<document.styleSheets.length;z++)if(document.styleSheets[z].ownerNode===W)return document.styleSheets[z]}var O=typeof window<"u",U=!1,j=function(){if(O){var W=document.createElement("div");return W.innerHTML="<!--[if lt IE 10]><i></i><![endif]-->",W.getElementsByTagName("i").length===1}}();function N(){var W=document.createElement("style");return W.type="text/css",W.setAttribute("data-glamor",""),W.appendChild(document.createTextNode("")),(document.head||document.getElementsByTagName("head")[0]).appendChild(W),W}function L(){var W=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},z=W.speedy,q=z===void 0?!U:z,I=W.maxLength,Z=I===void 0?O&&j?4e3:65e3:I;this.isSpeedy=q,this.sheet=void 0,this.tags=[],this.maxLength=Z,this.ctr=0}(0,l.default)(L.prototype,{getSheet:function(){return S(C(this.tags))},inject:function(){var W=this;if(this.injected)throw new Error("already injected stylesheet!");O?this.tags[0]=N():this.sheet={cssRules:[],insertRule:function(z){W.sheet.cssRules.push({cssText:z})}},this.injected=!0},speedy:function(W){if(this.ctr!==0)throw new Error("cannot change speedy mode after inserting any rule to sheet. Either call speedy("+W+") earlier in your app, or call flush() before speedy("+W+")");this.isSpeedy=!!W},_insert:function(W){try{var z=this.getSheet();z.insertRule(W,W.indexOf("@import")!==-1?0:z.cssRules.length)}catch{}},insert:function(W){if(O)if(this.isSpeedy&&this.getSheet().insertRule)this._insert(W);else if(W.indexOf("@import")!==-1){var z=C(this.tags);z.insertBefore(document.createTextNode(W),z.firstChild)}else C(this.tags).appendChild(document.createTextNode(W));else this.sheet.insertRule(W,W.indexOf("@import")!==-1?0:this.sheet.cssRules.length);return this.ctr++,O&&this.ctr%this.maxLength==0&&this.tags.push(N()),this.ctr-1},delete:function(W){return this.replace(W,"")},flush:function(){O?(this.tags.forEach(function(W){return W.parentNode.removeChild(W)}),this.tags=[],this.sheet=null,this.ctr=0):this.sheet.cssRules=[],this.injected=!1},rules:function(){if(!O)return this.sheet.cssRules;var W=[];return this.tags.forEach(function(z){return W.splice.apply(W,[W.length,0].concat(function(q){if(Array.isArray(q)){for(var I=0,Z=Array(q.length);I<q.length;I++)Z[I]=q[I];return Z}return Array.from(q)}(Array.from(S(z).cssRules))))}),W}})},function(u,s,r){r.r(s),r.d(s,"default",function(){return j});var l=r(null),C=r(87),S=r(null),O=r(null),U=r(null);function j(){var N=[],L=O.c;function W(z){if(z!=null&&!isNaN(z=+z))return L((Object(l.c)(N,z,1)-1)/(N.length-1))}return W.domain=function(z){if(!arguments.length)return N.slice();N=[];for(let q of z)q==null||isNaN(q=+q)||N.push(q);return N.sort(C.a),W},W.interpolator=function(z){return arguments.length?(L=z,W):L},W.range=function(){return N.map((z,q)=>L(q/(N.length-1)))},W.quantiles=function(z){return Array.from({length:z+1},(q,I)=>Object(S.b)(N,I/z))},W.copy=function(){return j(L).domain(N)},U.b.apply(W,arguments)}},function(u,s,r){r.r(s),r.d(s,"default",function(){return j});var l=r(null),C=r(null),S=r(null),O=r(null);function U(N){return Math.sign(N)*N*N}function j(){var N,L=Object(l.a)(),W=[0,1],z=!1;function q(I){var Z=function(Y){return Math.sign(Y)*Math.sqrt(Math.abs(Y))}(L(I));return isNaN(Z)?N:z?Math.round(Z):Z}return q.invert=function(I){return L.invert(U(I))},q.domain=function(I){return arguments.length?(L.domain(I),q):L.domain()},q.range=function(I){return arguments.length?(L.range((W=Array.from(I,O.a)).map(U)),q):W.slice()},q.rangeRound=function(I){return q.range(I).round(!0)},q.round=function(I){return arguments.length?(z=!!I,q):z},q.clamp=function(I){return arguments.length?(L.clamp(I),q):L.clamp()},q.unknown=function(I){return arguments.length?(N=I,q):N},q.copy=function(){return j(L.domain(),W).round(z).clamp(L.clamp()).unknown(N)},C.a.apply(q,arguments),Object(S.b)(q)}},function(u,s,r){const l=r(47),C=r(113),{ANY:S}=C,O=r(112),U=r(48),j=(W,z,q)=>{if(W===z)return!0;if(W.length===1&&W[0].semver===S){if(z.length===1&&z[0].semver===S)return!0;W=q.includePrerelease?[new C(">=0.0.0-0")]:[new C(">=0.0.0")]}if(z.length===1&&z[0].semver===S){if(q.includePrerelease)return!0;z=[new C(">=0.0.0")]}const I=new Set;let Z,Y,G,oe,ce,be,Ee;for(const Ge of W)Ge.operator===">"||Ge.operator===">="?Z=N(Z,Ge,q):Ge.operator==="<"||Ge.operator==="<="?Y=L(Y,Ge,q):I.add(Ge.semver);if(I.size>1||Z&&Y&&((G=U(Z.semver,Y.semver,q))>0||G===0&&(Z.operator!==">="||Y.operator!=="<=")))return null;for(const Ge of I){if(Z&&!O(Ge,String(Z),q)||Y&&!O(Ge,String(Y),q))return null;for(const ht of z)if(!O(Ge,String(ht),q))return!1;return!0}let ve=!(!Y||q.includePrerelease||!Y.semver.prerelease.length)&&Y.semver,ge=!(!Z||q.includePrerelease||!Z.semver.prerelease.length)&&Z.semver;ve&&ve.prerelease.length===1&&Y.operator==="<"&&ve.prerelease[0]===0&&(ve=!1);for(const Ge of z){if(Ee=Ee||Ge.operator===">"||Ge.operator===">=",be=be||Ge.operator==="<"||Ge.operator==="<=",Z){if(ge&&Ge.semver.prerelease&&Ge.semver.prerelease.length&&Ge.semver.major===ge.major&&Ge.semver.minor===ge.minor&&Ge.semver.patch===ge.patch&&(ge=!1),Ge.operator===">"||Ge.operator===">="){if((oe=N(Z,Ge,q))===Ge&&oe!==Z)return!1}else if(Z.operator===">="&&!O(Z.semver,String(Ge),q))return!1}if(Y){if(ve&&Ge.semver.prerelease&&Ge.semver.prerelease.length&&Ge.semver.major===ve.major&&Ge.semver.minor===ve.minor&&Ge.semver.patch===ve.patch&&(ve=!1),Ge.operator==="<"||Ge.operator==="<="){if((ce=L(Y,Ge,q))===Ge&&ce!==Y)return!1}else if(Y.operator==="<="&&!O(Y.semver,String(Ge),q))return!1}if(!Ge.operator&&(Y||Z)&&G!==0)return!1}return!(Z&&be&&!Y&&G!==0)&&!(Y&&Ee&&!Z&&G!==0)&&!ge&&!ve},N=(W,z,q)=>{if(!W)return z;const I=U(W.semver,z.semver,q);return I>0?W:I<0||z.operator===">"&&W.operator===">="?z:W},L=(W,z,q)=>{if(!W)return z;const I=U(W.semver,z.semver,q);return I<0?W:I>0||z.operator==="<"&&W.operator==="<="?z:W};u.exports=(W,z,q={})=>{if(W===z)return!0;W=new l(W,q),z=new l(z,q);let I=!1;e:for(const Z of W.set){for(const Y of z.set){const G=j(Z,Y,q);if(I=I||G!==null,G)continue e}if(I)return!1}return!0}},function(u,s,r){const l=r(112),C=r(48);u.exports=(S,O,U)=>{const j=[];let N=null,L=null;const W=S.sort((Z,Y)=>C(Z,Y,U));for(const Z of W)l(Z,O,U)?(L=Z,N||(N=Z)):(L&&j.push([N,L]),L=null,N=null);N&&j.push([N,null]);const z=[];for(const[Z,Y]of j)Z===Y?z.push(Z):Y||Z!==W[0]?Y?Z===W[0]?z.push(`<=${Y}`):z.push(`${Z} - ${Y}`):z.push(`>=${Z}`):z.push("*");const q=z.join(" || "),I=typeof O.raw=="string"?O.raw:String(O);return q.length<I.length?q:O}},function(u,s,r){const l=r(47);u.exports=(C,S,O)=>(C=new l(C,O),S=new l(S,O),C.intersects(S))},function(u,s,r){const l=r(140);u.exports=(C,S,O)=>l(C,S,"<",O)},function(u,s,r){const l=r(140);u.exports=(C,S,O)=>l(C,S,">",O)},function(u,s,r){const l=r(47);u.exports=(C,S)=>{try{return new l(C,S).range||"*"}catch{return null}}},function(u,s,r){const l=r(32),C=r(47),S=r(114);u.exports=(O,U)=>{O=new C(O,U);let j=new l("0.0.0");if(O.test(j)||(j=new l("0.0.0-0"),O.test(j)))return j;j=null;for(let N=0;N<O.set.length;++N){let L=null;O.set[N].forEach(W=>{const z=new l(W.semver.version);switch(W.operator){case">":z.prerelease.length===0?z.patch++:z.prerelease.push(0),z.raw=z.format();case"":case">=":L&&!S(z,L)||(L=z);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${W.operator}`)}}),!L||j&&!S(j,L)||(j=L)}return j&&O.test(j)?j:null}},function(u,s,r){const l=r(32),C=r(47);u.exports=(S,O,U)=>{let j=null,N=null,L=null;try{L=new C(O,U)}catch{return null}return S.forEach(W=>{L.test(W)&&(j&&N.compare(W)!==1||(N=new l(j=W,U)))}),j}},function(u,s,r){const l=r(32),C=r(47);u.exports=(S,O,U)=>{let j=null,N=null,L=null;try{L=new C(O,U)}catch{return null}return S.forEach(W=>{L.test(W)&&(j&&N.compare(W)!==-1||(N=new l(j=W,U)))}),j}},function(u,s,r){const l=r(47);u.exports=(C,S)=>new l(C,S).set.map(O=>O.map(U=>U.value).join(" ").trim().split(" "))},function(u,s,r){u.exports=function(l){l.prototype[Symbol.iterator]=function*(){for(let C=this.head;C;C=C.next)yield C.value}}},function(u,s,r){function l(j){var N=this;if(N instanceof l||(N=new l),N.tail=null,N.head=null,N.length=0,j&&typeof j.forEach=="function")j.forEach(function(z){N.push(z)});else if(arguments.length>0)for(var L=0,W=arguments.length;L<W;L++)N.push(arguments[L]);return N}function C(j,N,L){var W=N===j.head?new U(L,null,N,j):new U(L,N,N.next,j);return W.next===null&&(j.tail=W),W.prev===null&&(j.head=W),j.length++,W}function S(j,N){j.tail=new U(N,j.tail,null,j),j.head||(j.head=j.tail),j.length++}function O(j,N){j.head=new U(N,null,j.head,j),j.tail||(j.tail=j.head),j.length++}function U(j,N,L,W){if(!(this instanceof U))return new U(j,N,L,W);this.list=W,this.value=j,N?(N.next=this,this.prev=N):this.prev=null,L?(L.prev=this,this.next=L):this.next=null}u.exports=l,l.Node=U,l.create=l,l.prototype.removeNode=function(j){if(j.list!==this)throw new Error("removing node which does not belong to this list");var N=j.next,L=j.prev;return N&&(N.prev=L),L&&(L.next=N),j===this.head&&(this.head=N),j===this.tail&&(this.tail=L),j.list.length--,j.next=null,j.prev=null,j.list=null,N},l.prototype.unshiftNode=function(j){if(j!==this.head){j.list&&j.list.removeNode(j);var N=this.head;j.list=this,j.next=N,N&&(N.prev=j),this.head=j,this.tail||(this.tail=j),this.length++}},l.prototype.pushNode=function(j){if(j!==this.tail){j.list&&j.list.removeNode(j);var N=this.tail;j.list=this,j.prev=N,N&&(N.next=j),this.tail=j,this.head||(this.head=j),this.length++}},l.prototype.push=function(){for(var j=0,N=arguments.length;j<N;j++)S(this,arguments[j]);return this.length},l.prototype.unshift=function(){for(var j=0,N=arguments.length;j<N;j++)O(this,arguments[j]);return this.length},l.prototype.pop=function(){if(this.tail){var j=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,j}},l.prototype.shift=function(){if(this.head){var j=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,j}},l.prototype.forEach=function(j,N){N=N||this;for(var L=this.head,W=0;L!==null;W++)j.call(N,L.value,W,this),L=L.next},l.prototype.forEachReverse=function(j,N){N=N||this;for(var L=this.tail,W=this.length-1;L!==null;W--)j.call(N,L.value,W,this),L=L.prev},l.prototype.get=function(j){for(var N=0,L=this.head;L!==null&&N<j;N++)L=L.next;if(N===j&&L!==null)return L.value},l.prototype.getReverse=function(j){for(var N=0,L=this.tail;L!==null&&N<j;N++)L=L.prev;if(N===j&&L!==null)return L.value},l.prototype.map=function(j,N){N=N||this;for(var L=new l,W=this.head;W!==null;)L.push(j.call(N,W.value,this)),W=W.next;return L},l.prototype.mapReverse=function(j,N){N=N||this;for(var L=new l,W=this.tail;W!==null;)L.push(j.call(N,W.value,this)),W=W.prev;return L},l.prototype.reduce=function(j,N){var L,W=this.head;if(arguments.length>1)L=N;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");W=this.head.next,L=this.head.value}for(var z=0;W!==null;z++)L=j(L,W.value,z),W=W.next;return L},l.prototype.reduceReverse=function(j,N){var L,W=this.tail;if(arguments.length>1)L=N;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");W=this.tail.prev,L=this.tail.value}for(var z=this.length-1;W!==null;z--)L=j(L,W.value,z),W=W.prev;return L},l.prototype.toArray=function(){for(var j=new Array(this.length),N=0,L=this.head;L!==null;N++)j[N]=L.value,L=L.next;return j},l.prototype.toArrayReverse=function(){for(var j=new Array(this.length),N=0,L=this.tail;L!==null;N++)j[N]=L.value,L=L.prev;return j},l.prototype.slice=function(j,N){(N=N||this.length)<0&&(N+=this.length),(j=j||0)<0&&(j+=this.length);var L=new l;if(N<j||N<0)return L;j<0&&(j=0),N>this.length&&(N=this.length);for(var W=0,z=this.head;z!==null&&W<j;W++)z=z.next;for(;z!==null&&W<N;W++,z=z.next)L.push(z.value);return L},l.prototype.sliceReverse=function(j,N){(N=N||this.length)<0&&(N+=this.length),(j=j||0)<0&&(j+=this.length);var L=new l;if(N<j||N<0)return L;j<0&&(j=0),N>this.length&&(N=this.length);for(var W=this.length,z=this.tail;z!==null&&W>N;W--)z=z.prev;for(;z!==null&&W>j;W--,z=z.prev)L.push(z.value);return L},l.prototype.splice=function(j,N,...L){j>this.length&&(j=this.length-1),j<0&&(j=this.length+j);for(var W=0,z=this.head;z!==null&&W<j;W++)z=z.next;var q=[];for(W=0;z&&W<N;W++)q.push(z.value),z=this.removeNode(z);for(z===null&&(z=this.tail),z!==this.head&&z!==this.tail&&(z=z.prev),W=0;W<L.length;W++)z=C(this,z,L[W]);return q},l.prototype.reverse=function(){for(var j=this.head,N=this.tail,L=j;L!==null;L=L.prev){var W=L.prev;L.prev=L.next,L.next=W}return this.head=N,this.tail=j,this};try{r(333)(l)}catch{}},function(u,s,r){const l=r(334),C=Symbol("max"),S=Symbol("length"),O=Symbol("lengthCalculator"),U=Symbol("allowStale"),j=Symbol("maxAge"),N=Symbol("dispose"),L=Symbol("noDisposeOnSet"),W=Symbol("lruList"),z=Symbol("cache"),q=Symbol("updateAgeOnGet"),I=()=>1,Z=(Ee,ve,ge)=>{const Ge=Ee[z].get(ve);if(Ge){const ht=Ge.value;if(Y(Ee,ht)){if(oe(Ee,Ge),!Ee[U])return}else ge&&(Ee[q]&&(Ge.value.now=Date.now()),Ee[W].unshiftNode(Ge));return ht.value}},Y=(Ee,ve)=>{if(!ve||!ve.maxAge&&!Ee[j])return!1;const ge=Date.now()-ve.now;return ve.maxAge?ge>ve.maxAge:Ee[j]&&ge>Ee[j]},G=Ee=>{if(Ee[S]>Ee[C])for(let ve=Ee[W].tail;Ee[S]>Ee[C]&&ve!==null;){const ge=ve.prev;oe(Ee,ve),ve=ge}},oe=(Ee,ve)=>{if(ve){const ge=ve.value;Ee[N]&&Ee[N](ge.key,ge.value),Ee[S]-=ge.length,Ee[z].delete(ge.key),Ee[W].removeNode(ve)}};class ce{constructor(ve,ge,Ge,ht,It){this.key=ve,this.value=ge,this.length=Ge,this.now=ht,this.maxAge=It||0}}const be=(Ee,ve,ge,Ge)=>{let ht=ge.value;Y(Ee,ht)&&(oe(Ee,ge),Ee[U]||(ht=void 0)),ht&&ve.call(Ge,ht.value,ht.key,Ee)};u.exports=class{constructor(Ee){if(typeof Ee=="number"&&(Ee={max:Ee}),Ee||(Ee={}),Ee.max&&(typeof Ee.max!="number"||Ee.max<0))throw new TypeError("max must be a non-negative number");this[C]=Ee.max||1/0;const ve=Ee.length||I;if(this[O]=typeof ve!="function"?I:ve,this[U]=Ee.stale||!1,Ee.maxAge&&typeof Ee.maxAge!="number")throw new TypeError("maxAge must be a number");this[j]=Ee.maxAge||0,this[N]=Ee.dispose,this[L]=Ee.noDisposeOnSet||!1,this[q]=Ee.updateAgeOnGet||!1,this.reset()}set max(Ee){if(typeof Ee!="number"||Ee<0)throw new TypeError("max must be a non-negative number");this[C]=Ee||1/0,G(this)}get max(){return this[C]}set allowStale(Ee){this[U]=!!Ee}get allowStale(){return this[U]}set maxAge(Ee){if(typeof Ee!="number")throw new TypeError("maxAge must be a non-negative number");this[j]=Ee,G(this)}get maxAge(){return this[j]}set lengthCalculator(Ee){typeof Ee!="function"&&(Ee=I),Ee!==this[O]&&(this[O]=Ee,this[S]=0,this[W].forEach(ve=>{ve.length=this[O](ve.value,ve.key),this[S]+=ve.length})),G(this)}get lengthCalculator(){return this[O]}get length(){return this[S]}get itemCount(){return this[W].length}rforEach(Ee,ve){ve=ve||this;for(let ge=this[W].tail;ge!==null;){const Ge=ge.prev;be(this,Ee,ge,ve),ge=Ge}}forEach(Ee,ve){ve=ve||this;for(let ge=this[W].head;ge!==null;){const Ge=ge.next;be(this,Ee,ge,ve),ge=Ge}}keys(){return this[W].toArray().map(Ee=>Ee.key)}values(){return this[W].toArray().map(Ee=>Ee.value)}reset(){this[N]&&this[W]&&this[W].length&&this[W].forEach(Ee=>this[N](Ee.key,Ee.value)),this[z]=new Map,this[W]=new l,this[S]=0}dump(){return this[W].map(Ee=>!Y(this,Ee)&&{k:Ee.key,v:Ee.value,e:Ee.now+(Ee.maxAge||0)}).toArray().filter(Ee=>Ee)}dumpLru(){return this[W]}set(Ee,ve,ge){if((ge=ge||this[j])&&typeof ge!="number")throw new TypeError("maxAge must be a number");const Ge=ge?Date.now():0,ht=this[O](ve,Ee);if(this[z].has(Ee)){if(ht>this[C])return oe(this,this[z].get(Ee)),!1;const St=this[z].get(Ee).value;return this[N]&&(this[L]||this[N](Ee,St.value)),St.now=Ge,St.maxAge=ge,St.value=ve,this[S]+=ht-St.length,St.length=ht,this.get(Ee),G(this),!0}const It=new ce(Ee,ve,ht,Ge,ge);return It.length>this[C]?(this[N]&&this[N](Ee,ve),!1):(this[S]+=It.length,this[W].unshift(It),this[z].set(Ee,this[W].head),G(this),!0)}has(Ee){if(!this[z].has(Ee))return!1;const ve=this[z].get(Ee).value;return!Y(this,ve)}get(Ee){return Z(this,Ee,!0)}peek(Ee){return Z(this,Ee,!1)}pop(){const Ee=this[W].tail;return Ee?(oe(this,Ee),Ee.value):null}del(Ee){oe(this,this[z].get(Ee))}load(Ee){this.reset();const ve=Date.now();for(let ge=Ee.length-1;ge>=0;ge--){const Ge=Ee[ge],ht=Ge.e||0;if(ht===0)this.set(Ge.k,Ge.v);else{const It=ht-ve;It>0&&this.set(Ge.k,Ge.v,It)}}}prune(){this[z].forEach((Ee,ve)=>Z(this,ve,!1))}}},function(u,s,r){const l=r(32),C=r(89),{re:S,t:O}=r(90);u.exports=(U,j)=>{if(U instanceof l)return U;if(typeof U=="number"&&(U=String(U)),typeof U!="string")return null;let N=null;if((j=j||{}).rtl){let L;for(;(L=S[O.COERCERTL].exec(U))&&(!N||N.index+N[0].length!==U.length);)N&&L.index+L[0].length===N.index+N[0].length||(N=L),S[O.COERCERTL].lastIndex=L.index+L[1].length+L[2].length;S[O.COERCERTL].lastIndex=-1}else N=U.match(S[O.COERCE]);return N===null?null:C(`${N[2]}.${N[3]||"0"}.${N[4]||"0"}`,j)}},function(u,s,r){const l=r(144);u.exports=(C,S)=>C.sort((O,U)=>l(U,O,S))},function(u,s,r){const l=r(144);u.exports=(C,S)=>C.sort((O,U)=>l(O,U,S))},function(u,s,r){const l=r(48);u.exports=(C,S)=>l(C,S,!0)},function(u,s,r){const l=r(48);u.exports=(C,S,O)=>l(S,C,O)},function(u,s,r){const l=r(89);u.exports=(C,S)=>{const O=l(C,S);return O&&O.prerelease.length?O.prerelease:null}},function(u,s,r){const l=r(32);u.exports=(C,S)=>new l(C,S).patch},function(u,s,r){const l=r(32);u.exports=(C,S)=>new l(C,S).minor},function(u,s,r){const l=r(32);u.exports=(C,S)=>new l(C,S).major},function(u,s,r){const l=r(89),C=r(145);u.exports=(S,O)=>{if(C(S,O))return null;{const U=l(S),j=l(O),N=U.prerelease.length||j.prerelease.length,L=N?"pre":"",W=N?"prerelease":"";for(const z in U)if((z==="major"||z==="minor"||z==="patch")&&U[z]!==j[z])return L+z;return W}}},function(u,s,r){const l=r(32);u.exports=(C,S,O,U)=>{typeof O=="string"&&(U=O,O=void 0);try{return new l(C,O).inc(S,U).version}catch{return null}}},function(u,s,r){const l=r(89);u.exports=(C,S)=>{const O=l(C.trim().replace(/^[=v]+/,""),S);return O?O.version:null}},function(u,s,r){const l=r(89);u.exports=(C,S)=>{const O=l(C,S);return O?O.version:null}},function(u,s,r){var l=this&&this.__awaiter||function(L,W,z,q){return new(z||(z=Promise))(function(I,Z){function Y(ce){try{oe(q.next(ce))}catch(be){Z(be)}}function G(ce){try{oe(q.throw(ce))}catch(be){Z(be)}}function oe(ce){ce.done?I(ce.value):new z(function(be){be(ce.value)}).then(Y,G)}oe((q=q.apply(L,W||[])).next())})},C=this&&this.__importDefault||function(L){return L&&L.__esModule?L:{default:L}};Object.defineProperty(s,"__esModule",{value:!0});const S=C(r(88)),O=r(64),U=r(46);s.barchart=function(L,W,z={}){return l(this,void 0,void 0,function*(){const q=U.getDrawArea(L),I=W,Z=Object.assign({},j,z);if(N.has(q)){const ht=N.get(q);if(U.shallowEquals(Z,ht.lastOptions)){yield U.nextFrame();const It=ht.view,St=It.changeset().remove(()=>!0).insert(I);return void(yield It.change("values",St).runAsync())}}const{xLabel:Y,yLabel:G,xType:oe,yType:ce}=Z;let be=null;Y!=null&&(be={title:Y});let Ee,ve=null;G!=null&&(ve={title:G}),Ee=Z.color!=null?Array.isArray(Z.color)?{field:"index",type:"nominal",scale:{range:Z.color}}:{value:Z.color}:{value:"#4C78A0"};const ge={width:Z.width||O.getDefaultWidth(q),height:Z.height||O.getDefaultHeight(q),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:Z.fontSize,titleFontSize:Z.fontSize},text:{fontSize:Z.fontSize},legend:{labelFontSize:Z.fontSize,titleFontSize:Z.fontSize}},data:{values:I,name:"values"},mark:{type:"bar",tooltip:!0},encoding:{x:{field:"index",type:oe,axis:be},y:{field:"value",type:ce,axis:ve},color:Ee}};yield U.nextFrame();const Ge=yield S.default(q,ge,{actions:!1,mode:"vega-lite",defaultStyle:!1});N.set(q,{view:Ge.view,lastOptions:Z})})};const j={xLabel:"",yLabel:"",xType:"ordinal",yType:"quantitative",fontSize:11},N=new Map},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(25),C=r(103),S=r(33),O=r(74);function U(j){C.env().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(j+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}s.enableProdMode=function(){C.env().set("PROD",!0)},s.enableDebugMode=function(){C.env().set("DEBUG",!0)},s.disableDeprecationWarnings=function(){C.env().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},s.deprecationWarn=U,S.setDeprecationWarningFn(U),s.disposeVariables=function(){l.ENGINE.disposeVariables()},s.engine=function(){return l.ENGINE},s.memory=function(){return l.ENGINE.memory()},s.profile=function(j){return l.ENGINE.profile(j)},s.tidy=function(j,N){return l.ENGINE.tidy(j,N)},s.dispose=function(j){O.getTensorsInContainer(j).forEach(function(N){return N.dispose()})},s.keep=function(j){return l.ENGINE.keep(j)},s.time=function(j){return l.ENGINE.time(j)},s.setBackend=function(j){return l.ENGINE.setBackend(j)},s.ready=function(){return l.ENGINE.ready()},s.getBackend=function(){return l.ENGINE.backendName},s.removeBackend=function(j){l.ENGINE.removeBackend(j)},s.findBackend=function(j){return l.ENGINE.findBackend(j)},s.findBackendFactory=function(j){return l.ENGINE.findBackendFactory(j)},s.registerBackend=function(j,N,L){return L===void 0&&(L=1),l.ENGINE.registerBackend(j,N,L)},s.backend=function(){return l.ENGINE.backend},s.setPlatform=function(j,N){C.env().setPlatform(j,N)}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(350);s.warnDeprecation=function(){l.deprecationWarn("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")},s.xAs4D=function(C){return C.rank===0||C.rank===1?C.as4D(1,1,1,C.size):C.rank===2?C.as4D(1,1,C.shape[0],C.shape[1]):C.rank===3?C.as4D(1,C.shape[0],C.shape[1],C.shape[2]):C}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(25),C=r(29),S=r(21),O=r(351),U=r(28);function j(L,W,z,q,I,Z){Z==null&&(Z=.001);var Y,G,oe=C.convertToTensor(L,"x","batchNorm"),ce=C.convertToTensor(W,"mean","batchNorm"),be=C.convertToTensor(z,"variance","batchNorm");I!=null&&(Y=C.convertToTensor(I,"scale","batchNorm")),q!=null&&(G=C.convertToTensor(q,"offset","batchNorm")),S.assert(ce.rank===be.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),S.assert(G==null||ce.rank===G.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),S.assert(Y==null||ce.rank===Y.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var Ee={x:oe,scale:Y,offset:G,mean:ce,variance:be},ve={varianceEpsilon:Z};return l.ENGINE.runKernelFunc(function(ge,Ge){var ht=O.xAs4D(oe),It=ge.batchNormalization(ht,N(ce),N(be),Z,N(Y),N(G));return Ge([oe,ce,be,Y]),It},Ee,null,"FusedBatchNorm",ve).reshape(oe.shape)}function N(L){return L==null?null:L.rank===0?L.as1D():L.rank===1?L:L.rank===2?L.as4D(1,1,L.shape[0],L.shape[1]):L.rank===3?L.as4D(1,L.shape[0],L.shape[1],L.shape[2]):L}s.batchNormalization=U.op({batchNormalization_:function(L,W,z,q,I,Z){return q===void 0&&(q=.001),O.warnDeprecation(),j(L,W,z,Z,I,q)}}),s.batchNorm=U.op({batchNorm_:j})},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(352);r(33).Tensor.prototype.batchNorm=function(C,S,O,U,j){return l.batchNorm(this,C,S,O,U,j)}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(25),C=r(73),S=r(29),O=r(28);s.pad=O.op({pad_:function(U,j,N){N===void 0&&(N=0);var L=S.convertToTensor(U,"x","pad");if(L.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var W={paddings:j,constantValue:N},z={x:L};return l.ENGINE.runKernelFunc(function(q,I){return I([L]),q.pad(L,j,N)},z,null,C.PadV2,W)}})},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(354);r(33).Tensor.prototype.pad=function(C,S){return l.pad(this,C,S)}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(25),C=r(29),S=r(21),O=r(28);s.transpose=O.op({transpose_:function(U,j){var N=C.convertToTensor(U,"x","transpose");if(j==null&&(j=N.shape.map(function(W,z){return z}).reverse()),S.assert(N.rank===j.length,function(){return"Error in transpose: rank of input "+N.rank+" must match length of perm "+j+"."}),j.forEach(function(W){S.assert(W>=0&&W<N.rank,function(){return"All entries in 'perm' must be between 0 and "+(N.rank-1)+" but got "+j})}),N.rank<=1)return N.clone();var L={perm:j};return l.ENGINE.runKernelFunc(function(W){return W.transpose(N,j)},{x:N},null,"Transpose",L)}})},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(356);r(33).Tensor.prototype.transpose=function(C){return l.transpose(this,C)}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(25),C=r(73),S=r(29),O=r(28);s.oneHot=O.op({oneHot_:function(U,j,N,L){if(N===void 0&&(N=1),L===void 0&&(L=0),j<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+j);var W=S.convertToTensor(U,"indices","oneHot","int32"),z=W.shape.concat([j]),q={indices:W=W.flatten()},I={depth:j,onValue:N,offValue:L};return l.ENGINE.runKernelFunc(function(Z,Y){return Y([W]),Z.oneHot(W,j,N,L)},q,null,C.OneHot,I).reshape(z)}})},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(358);r(33).Tensor.prototype.oneHot=function(C,S,O){return S===void 0&&(S=1),O===void 0&&(O=0),l.oneHot(this,C,S,O)}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(25),C=r(73),S=r(29),O=r(21),U=r(28);s.tile=U.op({tile_:function(j,N){var L=S.convertToTensor(j,"x","tile",null);O.assert(L.rank===N.length,function(){return"Error in transpose: rank of input "+L.rank+" must match length of reps "+N+"."});var W=[L],z={x:L},q={reps:N};return l.ENGINE.runKernelFunc(function(I,Z){var Y=I.tile(L,N);return Z([L]),Y},z,null,C.Tile,q,W)}})},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(360);r(33).Tensor.prototype.tile=function(C){return l.tile(this,C)}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(25),C=r(73),S=r(74),O=r(29),U=r(147),j=r(28),N=r(91);s.squaredDifference=j.op({squaredDifference_:function(L,W){var z,q=O.convertToTensor(L,"a","squaredDifference"),I=O.convertToTensor(W,"b","squaredDifference");z=S.makeTypesMatch(q,I),q=z[0],I=z[1],U.assertAndGetBroadcastShape(q.shape,I.shape);var Z={a:q,b:I},Y=[q,I];return l.ENGINE.runKernelFunc(function(G,oe){var ce=G.squaredDifference(q,I);return oe([q,I]),ce},Z,function(G,oe){var ce=oe[0],be=oe[1],Ee=N.scalar(2);return{a:function(){return G.mul(ce.sub(be).mul(Ee))},b:function(){return G.mul(be.sub(ce).mul(Ee))}}},C.SquaredDifference,{},Y,[])}})},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(362);r(33).Tensor.prototype.squaredDifference=function(C){return l.squaredDifference(this,C)}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(21);s.assertParamsConsistent=function(C,S){var O=C[0].length;C.forEach(function(j,N){l.assert(j.length===O,function(){return"Error in concat"+O+"D: rank of tensors["+N+"] must be the same as the rank of the rest ("+O+")"})}),l.assert(S>=0&&S<O,function(){return"Error in concat"+O+"D: axis must be between 0 and "+(O-1)+"."});var U=C[0];C.forEach(function(j,N){for(var L=0;L<O;L++)l.assert(L===S||j[L]===U[L],function(){return"Error in concat"+O+"D: Shape of tensors["+N+"] ("+j+") does not match the shape of the rest ("+U+") along the non-concatenated axis "+N+"."})})},s.computeOutShape=function(C,S){for(var O=C[0].slice(),U=1;U<C.length;U++)O[S]+=C[U][S];return O}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(25),C=r(29),S=r(21),O=r(21),U=r(364),j=r(28),N=r(91);s.concat=j.op({concat_:function(L,W){W===void 0&&(W=0),S.assert(L.length>=1,function(){return"Pass at least one tensor to concat"});var z=C.convertToTensorArray(L,"tensors","concat");z[0].dtype==="complex64"&&z.forEach(function(G){if(G.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+G.dtype+". ")}),W=O.parseAxisParam(W,z[0].shape)[0];var q=U.computeOutShape(z.map(function(G){return G.shape}),W);if(S.sizeFromShape(q)===0)return N.tensor([],q);if((z=z.filter(function(G){return G.size>0})).length===1)return z[0];var I=z.map(function(G){return G.shape});U.assertParamsConsistent(I,W);var Z=z,Y={axis:W};return l.ENGINE.runKernelFunc(function(G){return G.concat(z,W)},Z,function(G){var oe=I.map(function(ce){return ce[W]});return s.split(G,oe,W).map(function(ce){return function(){return ce}})},"Concat",Y)}}),s.concat1d=j.op({concat1d_:function(L){return s.concat(L,0)}}),s.concat2d=j.op({concat2d_:function(L,W){return s.concat(L,W)}}),s.concat3d=j.op({concat3d_:function(L,W){return s.concat(L,W)}}),s.concat4d=j.op({concat4d_:function(L,W){return s.concat(L,W)}}),s.split=j.op({split_:function(L,W,z){z===void 0&&(z=0);var q,I=C.convertToTensor(L,"x","split");return z=O.parseAxisParam(z,I.shape)[0],typeof W=="number"?(S.assert(I.shape[z]%W==0,function(){return"Number of splits must evenly divide the axis."}),q=new Array(W).fill(I.shape[z]/W)):(S.assert(I.shape[z]===W.reduce(function(Z,Y){return Z+Y}),function(){return"The sum of sizes must match the size of the axis dimension."}),q=W),l.ENGINE.runKernelFunc(function(Z){return Z.split(I,q,z)},{$x:I},function(Z){return{$x:function(){return s.concat(Z,z)}}})}})},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(21);function C(O,U){for(var j=0;j<O.length;++j)if(O[O.length-j-1]!==U-1-j)return!1;return!0}function S(O,U,j){for(var N=O.length+U.length,L=[],W=0,z=0,q=0;q<N;q++)j.indexOf(q)===-1?L.push(O[W++]):L.push(U[z++]);return L}s.axesAreInnerMostDims=C,s.combineLocations=S,s.computeOutAndReduceShapes=function(O,U){for(var j=[],N=O.length,L=0;L<N;L++)U.indexOf(L)===-1&&j.push(O[L]);return[j,U.map(function(W){return O[W]})]},s.expandShapeToKeepDim=function(O,U){return S(O,U.map(function(j){return 1}),U)},s.assertAxesAreInnerMostDims=function(O,U,j){l.assert(C(U,j),function(){return O+" supports only inner-most axes for now. Got axes "+U+" and rank-"+j+" input."})},s.getAxesPermutation=function(O,U){if(C(O,U))return null;for(var j=[],N=0;N<U;++N)O.indexOf(N)===-1&&j.push(N);return O.forEach(function(L){return j.push(L)}),j},s.getUndoAxesPermutation=function(O){return O.map(function(U,j){return[j,U]}).sort(function(U,j){return U[1]-j[1]}).map(function(U){return U[0]})},s.getInnerMostAxes=function(O,U){for(var j=[],N=U-O;N<U;++N)j.push(N);return j}},function(u,s,r){var l=this&&this.__awaiter||function(z,q,I,Z){return new(I||(I=Promise))(function(Y,G){function oe(Ee){try{be(Z.next(Ee))}catch(ve){G(ve)}}function ce(Ee){try{be(Z.throw(Ee))}catch(ve){G(ve)}}function be(Ee){Ee.done?Y(Ee.value):new I(function(ve){ve(Ee.value)}).then(oe,ce)}be((Z=Z.apply(z,q||[])).next())})},C=this&&this.__generator||function(z,q){var I,Z,Y,G,oe={label:0,sent:function(){if(1&Y[0])throw Y[1];return Y[1]},trys:[],ops:[]};return G={next:ce(0),throw:ce(1),return:ce(2)},typeof Symbol=="function"&&(G[Symbol.iterator]=function(){return this}),G;function ce(be){return function(Ee){return function(ve){if(I)throw new TypeError("Generator is already executing.");for(;oe;)try{if(I=1,Z&&(Y=2&ve[0]?Z.return:ve[0]?Z.throw||((Y=Z.return)&&Y.call(Z),0):Z.next)&&!(Y=Y.call(Z,ve[1])).done)return Y;switch(Z=0,Y&&(ve=[2&ve[0],Y.value]),ve[0]){case 0:case 1:Y=ve;break;case 4:return oe.label++,{value:ve[1],done:!1};case 5:oe.label++,Z=ve[1],ve=[0];continue;case 7:ve=oe.ops.pop(),oe.trys.pop();continue;default:if(!(Y=(Y=oe.trys).length>0&&Y[Y.length-1])&&(ve[0]===6||ve[0]===2)){oe=0;continue}if(ve[0]===3&&(!Y||ve[1]>Y[0]&&ve[1]<Y[3])){oe.label=ve[1];break}if(ve[0]===6&&oe.label<Y[1]){oe.label=Y[1],Y=ve;break}if(Y&&oe.label<Y[2]){oe.label=Y[2],oe.ops.push(ve);break}Y[2]&&oe.ops.pop(),oe.trys.pop();continue}ve=q.call(z,oe)}catch(ge){ve=[6,ge],Z=0}finally{I=Y=0}if(5&ve[0])throw ve[1];return{value:ve[0]?ve[1]:void 0,done:!0}}([be,Ee])}}};Object.defineProperty(s,"__esModule",{value:!0});var S=r(25),O=r(33),U=r(29),j=r(21),N=r(366),L=r(365),W=r(28);s.buffer=function(z,q,I){return q===void 0&&(q="float32"),q=q||"float32",j.assertNonNegativeIntegerDimensions(z),new O.TensorBuffer(z,q,I)},s.print=function(z,q){q===void 0&&(q=!1),console.log(z.toString(q))},s.batchToSpaceND=W.op({batchToSpaceND_:function(z,q,I){var Z=U.convertToTensor(z,"x","batchToSpaceND"),Y=q.reduce(function(G,oe){return G*oe});return j.assert(Z.rank>=1+q.length,function(){return"input rank is "+Z.rank+" but should be > than blockShape.length "+q.length}),j.assert(I.length===q.length,function(){return"crops.length is "+I.length+" but should be equal to blockShape.length  "+q.length}),j.assert(Z.shape[0]%Y==0,function(){return"input tensor batch is "+Z.shape[0]+" but is not divisible by the product of the elements of blockShape "+q.join(" * ")+" === "+Y}),S.ENGINE.runKernelFunc(function(G){return G.batchToSpaceND(Z,q,I)},{$x:Z},function(G){return{$x:function(){return G.spaceToBatchND(q,I)}}})}}),s.cast=W.op({cast_:function(z,q){var I=U.convertToTensor(z,"x","cast");if(!j.isValidDtype(q))throw new Error("Failed to cast to unknown dtype "+q);if(q==="string"&&I.dtype!=="string"||q!=="string"&&I.dtype==="string")throw new Error("Only strings can be casted to strings");var Z={dtype:q};return S.ENGINE.runKernelFunc(function(Y){return Y.cast(I,q)},{x:I},function(Y){return{x:function(){return Y.clone()}}},"Cast",Z)}}),s.cumsum=W.op({cumsum_:function(z,q,I,Z){q===void 0&&(q=0),I===void 0&&(I=!1),Z===void 0&&(Z=!1);var Y=U.convertToTensor(z,"x","cumsum");q|=0;var G=N.getAxesPermutation([q],Y.rank),oe=Y;G!=null&&(oe=Y.transpose(G));var ce=N.getInnerMostAxes(1,Y.rank)[0],be=S.ENGINE.runKernelFunc(function(Ee){return Ee.cumsum(oe,ce,I,Z)},{permutedX:oe},function(Ee){return{permutedX:function(){return Ee.cumsum(q,I,!Z)}}});return G!=null&&(be=be.transpose(G)),be}}),s.depthToSpace=W.op({depthToSpace_:function(z,q,I){I===void 0&&(I="NHWC");var Z=U.convertToTensor(z,"x","depthToSpace"),Y=I==="NHWC"?Z.shape[1]:Z.shape[2],G=I==="NHWC"?Z.shape[2]:Z.shape[3],oe=I==="NHWC"?Z.shape[3]:Z.shape[1];return j.assert(Y*q>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+Y+" and "+q+`  for depthToSpace with input shape
      `+Z.shape}),j.assert(G*q>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+G+" and "+q+` for depthToSpace with input shape
          `+Z.shape}),j.assert(oe%(q*q)==0,function(){return"Dimension size must be evenly divisible by "+q*q+" but is "+oe+" for depthToSpace with input shape "+Z.shape}),S.ENGINE.runKernelFunc(function(ce){return ce.depthToSpace(Z,q,I)},{$x:Z})}}),s.expandDims=W.op({expandDims_:function(z,q){q===void 0&&(q=0);var I=U.convertToTensor(z,"x","expandDims",null);j.assert(q<=I.rank,function(){return"Axis must be <= rank of the tensor"});var Z=I.shape.slice();return q<0&&(j.assert(-(I.rank+1)<=q,function(){return"Axis must be in the interval ["+-(I.rank+1)+", "+I.rank+"]"}),q=I.rank+q+1),Z.splice(q,0,1),s.reshape(I,Z)}}),s.reshape=W.op({reshape_:function(z,q){var I=U.convertToTensor(z,"x","reshape",null);q=j.inferFromImplicitShape(q,I.size),j.assert(I.size===j.sizeFromShape(q),function(){return"new shape and old shape must have the same number of elements."});var Z={shape:q};return S.ENGINE.runKernelFunc(function(Y){return Y.reshape(I,q)},{x:I},function(Y){return{x:function(){return Y.reshape(I.shape)}}},"Reshape",Z)}}),s.spaceToBatchND=W.op({spaceToBatchND_:function(z,q,I){var Z=U.convertToTensor(z,"x","spaceToBatchND");return j.assert(Z.rank>=1+q.length,function(){return"input rank "+Z.rank+" should be > than [blockShape] "+q.length}),j.assert(I.length===q.length,function(){return"paddings.shape[0] "+I.length+" must be equal to [blockShape] "+q.length}),j.assert(Z.shape.reduce(function(Y,G,oe){return oe>0&&oe<=q.length?Y&&(G+I[oe-1][0]+I[oe-1][1])%q[oe-1]==0:Y},!0),function(){return"input spatial dimensions "+Z.shape.slice(1)+" with paddings "+I.toString()+" must be divisible by blockShapes "+q.toString()}),S.ENGINE.runKernelFunc(function(Y){return Y.spaceToBatchND(Z,q,I)},{$x:Z},function(Y){return{$x:function(){return Y.batchToSpaceND(q,I)}}})}}),s.squeeze=W.op({squeeze_:function(z,q){var I=U.convertToTensor(z,"x","squeeze");return s.reshape(I,j.squeezeShape(I.shape,q).newShape)}}),s.stack=W.op({stack_:function(z,q){q===void 0&&(q=0);var I=U.convertToTensorArray(z,"tensors","stack");if(j.assert(I.length>=1,function(){return"Pass at least one tensor to tf.stack"}),I.length===1)return I[0].expandDims(q);var Z=I[0].rank,Y=I[0].shape,G=I[0].dtype;j.assert(q<=Z,function(){return"Axis must be <= rank of the tensor"}),I.forEach(function(ce){j.assertShapesMatch(Y,ce.shape,"All tensors passed to stack must have matching shapes")}),I.forEach(function(ce){j.assert(G===ce.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var oe=I.map(function(ce){return ce.expandDims(q)});return L.concat(oe,q)}}),s.unstack=W.op({unstack_:function(z,q){q===void 0&&(q=0),q=q||0;var I=U.convertToTensor(z,"x","unstack");j.assert(q>=-I.shape.length&&q<I.shape.length,function(){return"Axis = "+q+" is not in [-"+I.shape.length+", "+I.shape.length+")"}),q<0&&(q+=I.shape.length);var Z={axis:q};return S.ENGINE.runKernelFunc(function(Y){return Y.unstack(I,q)},{x:I},function(Y){return{x:function(){return s.stack(Y,q)}}},"Unpack",Z)}}),s.setdiff1dAsync=function(z,q){return l(this,void 0,void 0,function(){var I,Z,Y,G,oe,ce,be,Ee,ve,ge;return C(this,function(Ge){switch(Ge.label){case 0:return I=U.convertToTensor(z,"x","setdiff1d"),Z=U.convertToTensor(q,"y","setdiff1d"),j.assert(I.dtype===Z.dtype,function(){return"x and y should have the same dtype, but got x ("+I.dtype+") and y ("+Z.dtype+")."}),j.assert(I.rank===1,function(){return"x should be 1D tensor, but got x ("+I.shape+")."}),j.assert(Z.rank===1,function(){return"y should be 1D tensor, but got y ("+Z.shape+")."}),[4,I.data()];case 1:return Y=Ge.sent(),[4,Z.data()];case 2:for(G=Ge.sent(),oe=new Set(G),ce=0,ve=0;ve<Y.length;ve++)oe.has(Y[ve])||ce++;for(be=new O.TensorBuffer([ce],I.dtype),Ee=new O.TensorBuffer([ce],"int32"),ve=0,ge=0;ve<Y.length;ve++)oe.has(Y[ve])||(be.values[ge]=Y[ve],Ee.values[ge]=ve,ge++);return[2,[be.toTensor(),Ee.toTensor()]]}})})}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(367);s.whereImpl=function(C,S){for(var O=[],U=0;U<S.length;U++)S[U]&&O.push(U);var j=l.buffer(C,"int32"),N=l.buffer([O.length,C.length],"int32");for(U=0;U<O.length;U++){var L=j.indexToLoc(O[U]),W=U*C.length;N.values.set(L,W)}return N.toTensor()}},function(u,s,r){var l=this&&this.__awaiter||function(z,q,I,Z){return new(I||(I=Promise))(function(Y,G){function oe(Ee){try{be(Z.next(Ee))}catch(ve){G(ve)}}function ce(Ee){try{be(Z.throw(Ee))}catch(ve){G(ve)}}function be(Ee){Ee.done?Y(Ee.value):new I(function(ve){ve(Ee.value)}).then(oe,ce)}be((Z=Z.apply(z,q||[])).next())})},C=this&&this.__generator||function(z,q){var I,Z,Y,G,oe={label:0,sent:function(){if(1&Y[0])throw Y[1];return Y[1]},trys:[],ops:[]};return G={next:ce(0),throw:ce(1),return:ce(2)},typeof Symbol=="function"&&(G[Symbol.iterator]=function(){return this}),G;function ce(be){return function(Ee){return function(ve){if(I)throw new TypeError("Generator is already executing.");for(;oe;)try{if(I=1,Z&&(Y=2&ve[0]?Z.return:ve[0]?Z.throw||((Y=Z.return)&&Y.call(Z),0):Z.next)&&!(Y=Y.call(Z,ve[1])).done)return Y;switch(Z=0,Y&&(ve=[2&ve[0],Y.value]),ve[0]){case 0:case 1:Y=ve;break;case 4:return oe.label++,{value:ve[1],done:!1};case 5:oe.label++,Z=ve[1],ve=[0];continue;case 7:ve=oe.ops.pop(),oe.trys.pop();continue;default:if(!(Y=(Y=oe.trys).length>0&&Y[Y.length-1])&&(ve[0]===6||ve[0]===2)){oe=0;continue}if(ve[0]===3&&(!Y||ve[1]>Y[0]&&ve[1]<Y[3])){oe.label=ve[1];break}if(ve[0]===6&&oe.label<Y[1]){oe.label=Y[1],Y=ve;break}if(Y&&oe.label<Y[2]){oe.label=Y[2],oe.ops.push(ve);break}Y[2]&&oe.ops.pop(),oe.trys.pop();continue}ve=q.call(z,oe)}catch(ge){ve=[6,ge],Z=0}finally{I=Y=0}if(5&ve[0])throw ve[1];return{value:ve[0]?ve[1]:void 0,done:!0}}([be,Ee])}}};Object.defineProperty(s,"__esModule",{value:!0});var S=r(368),O=r(25),U=r(29),j=r(21),N=r(147),L=r(28),W=r(91);s.logicalAnd=L.op({logicalAnd_:function(z,q){var I=U.convertToTensor(z,"a","logicalAnd","bool"),Z=U.convertToTensor(q,"b","logicalAnd","bool");return N.assertAndGetBroadcastShape(I.shape,Z.shape),O.ENGINE.runKernelFunc(function(Y){return Y.logicalAnd(I,Z)},{a:I,b:Z},null,"LogicalAnd")}}),s.logicalNot=L.op({logicalNot_:function(z){var q=U.convertToTensor(z,"x","logicalNot","bool");return O.ENGINE.runKernelFunc(function(I){return I.logicalNot(q)},{$x:q})}}),s.logicalOr=L.op({logicalOr_:function(z,q){var I=U.convertToTensor(z,"a","logicalOr","bool"),Z=U.convertToTensor(q,"b","logicalOr","bool");return N.assertAndGetBroadcastShape(I.shape,Z.shape),O.ENGINE.runKernelFunc(function(Y){return Y.logicalOr(I,Z)},{$a:I,$b:Z})}}),s.logicalXor=L.op({logicalXor_:function(z,q){var I=U.convertToTensor(z,"a","logicalXor","bool"),Z=U.convertToTensor(q,"b","logicalXor","bool");return N.assertAndGetBroadcastShape(I.shape,Z.shape),s.logicalOr(z,q).logicalAnd(s.logicalAnd(z,q).logicalNot())}}),s.where=L.op({where_:function(z,q,I){var Z=U.convertToTensor(q,"a","where"),Y=U.convertToTensor(I,"b","where"),G=U.convertToTensor(z,"condition","where","bool");return j.assertShapesMatch(Z.shape,Y.shape,"Error in where: "),G.rank===1?j.assert(G.shape[0]===Z.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):j.assertShapesMatch(G.shape,Y.shape,"Error in where: "),O.ENGINE.runKernelFunc(function(oe,ce){var be=oe.select(G,Z,Y);return ce([G]),be},{$condition:G,$a:Z,$b:Y},function(oe,ce){var be=ce[0];return{$condition:function(){return W.zerosLike(be).toFloat()},$a:function(){return oe.mul(be.cast(oe.dtype))},$b:function(){return oe.mul(be.logicalNot().cast(oe.dtype))}}})}}),s.whereAsync=function(z){return l(this,void 0,void 0,function(){var q,I,Z;return C(this,function(Y){switch(Y.label){case 0:return[4,(q=U.convertToTensor(z,"condition","whereAsync","bool")).data()];case 1:return I=Y.sent(),Z=S.whereImpl(q.shape,I),z!==q&&q.dispose(),[2,Z]}})})}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(74),C=r(29),S=r(205),O=r(369),U=r(28),j=r(91);s.divNoNan=U.op({divNoNan_:function(N,L){var W,z=C.convertToTensor(N,"a","div"),q=C.convertToTensor(L,"b","div");z=(W=l.makeTypesMatch(z,q))[0],q=W[1];var I=S.div(z,q),Z=j.zerosLike(I),Y=q.equal(Z);return O.where(Y,Z,I)}})},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(370);r(33).Tensor.prototype.divNoNan=function(C){return l.divNoNan(this,C)}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(25),C=r(29),S=r(21),O=r(28),U=r(91);s.abs=O.op({abs_:function(j){var N=C.convertToTensor(j,"x","abs");return N.dtype==="complex64"?l.ENGINE.runKernelFunc(function(L){return L.complexAbs(N)},{$x:N}):l.ENGINE.runKernelFunc(function(L,W){var z=L.abs(N);return W([N]),z},{x:N},function(L,W){var z=W[0];return{x:function(){return L.mul(z.toFloat().step(-1))}}},"Abs")}}),s.acos=O.op({acos_:function(j){var N=C.convertToTensor(j,"x","acos");return l.ENGINE.runKernelFunc(function(L,W){var z=L.acos(N);return W([N]),z},{$x:N},function(L,W){var z=W[0];return{$x:function(){return L.divStrict(U.scalar(1).sub(z.toFloat().square()).sqrt()).neg()}}})}}),s.acosh=O.op({acosh_:function(j){var N=C.convertToTensor(j,"x","acosh");return l.ENGINE.runKernelFunc(function(L,W){var z=L.acosh(N);return W([N]),z},{$x:N},function(L,W){var z=W[0];return{$x:function(){return L.divStrict(z.toFloat().square().sub(1).sqrt())}}})}}),s.asin=O.op({asin_:function(j){var N=C.convertToTensor(j,"x","asin");return l.ENGINE.runKernelFunc(function(L,W){var z=L.asin(N);return W([N]),z},{$x:N},function(L,W){var z=W[0];return{$x:function(){return L.divStrict(U.scalar(1).sub(z.toFloat().square()).sqrt())}}})}}),s.asinh=O.op({asinh_:function(j){var N=C.convertToTensor(j,"x","asinh");return l.ENGINE.runKernelFunc(function(L,W){var z=L.asinh(N);return W([N]),z},{$x:N},function(L,W){var z=W[0];return{$x:function(){return L.divStrict(U.scalar(1).add(z.toFloat().square()).sqrt())}}})}}),s.atan=O.op({atan_:function(j){var N=C.convertToTensor(j,"x","atan");return l.ENGINE.runKernelFunc(function(L,W){var z=L.atan(N);return W([N]),z},{$x:N},function(L,W){var z=W[0];return{$x:function(){return L.div(z.toFloat().square().add(1))}}})}}),s.atanh=O.op({atanh_:function(j){var N=C.convertToTensor(j,"x","atanh");return l.ENGINE.runKernelFunc(function(L,W){var z=L.atanh(N);return W([N]),z},{$x:N},function(L,W){var z=W[0];return{$x:function(){return L.div(U.scalar(1).sub(z.toFloat().square()))}}})}}),s.ceil=O.op({ceil_:function(j){var N=C.convertToTensor(j,"x","ceil");return l.ENGINE.runKernelFunc(function(L){return L.ceil(N)},{$x:N},function(L){return{$x:function(){return U.zerosLike(L)}}})}}),s.clipByValue=O.op({clipByValue_:function(j,N,L){var W=C.convertToTensor(j,"x","clipByValue");S.assert(N<=L,function(){return"Error in clip: min ("+N+") must be less than or equal to max ("+L+")."});var z=[W],q={min:N,max:L};return l.ENGINE.runKernelFunc(function(I,Z){var Y=I.clip(W,N,L);return Z([W]),Y},{x:W},function(I,Z){var Y=Z[0];return{x:function(){return I.where(Y.greaterEqual(N).logicalAnd(Y.lessEqual(L)),U.zerosLike(I))}}},"ClipByValue",q,z)}}),s.cos=O.op({cos_:function(j){var N=C.convertToTensor(j,"x","cos"),L=[N];return l.ENGINE.runKernelFunc(function(W,z){var q=W.cos(N);return z([N]),q},{x:N},function(W,z){var q=z[0];return{x:function(){return q.toFloat().sin().neg().mul(W)}}},"Cos",{},L)}}),s.cosh=O.op({cosh_:function(j){var N=C.convertToTensor(j,"x","cosh");return l.ENGINE.runKernelFunc(function(L,W){var z=L.cosh(N);return W([N]),z},{$x:N},function(L,W){var z=W[0];return{$x:function(){return z.toFloat().sinh().mulStrict(L)}}})}}),s.erf=O.op({erf_:function(j){var N=C.convertToTensor(j,"x","erf");return S.assert(N.dtype==="int32"||N.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),N.dtype==="int32"&&(N=N.toFloat()),l.ENGINE.runKernelFunc(function(L,W){var z=L.erf(N);return W([N]),z},{$x:N},function(L,W){var z=W[0];return{$x:function(){return L.mul(z.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),s.exp=O.op({exp_:function(j){var N=C.convertToTensor(j,"x","exp");return l.ENGINE.runKernelFunc(function(L,W){var z=L.exp(N);return W([z]),z},{x:N},function(L,W){return{x:function(){return L.mulStrict(W[0])}}},"Exp",{},[],[!0])}}),s.expm1=O.op({expm1_:function(j){var N=C.convertToTensor(j,"x","expm1");return l.ENGINE.runKernelFunc(function(L,W){var z=L.expm1(N);return W([N]),z},{$x:N},function(L,W){var z=W[0];return{$x:function(){return L.mul(z.exp())}}})}}),s.floor=O.op({floor_:function(j){var N=C.convertToTensor(j,"x","floor");return l.ENGINE.runKernelFunc(function(L){return L.floor(N)},{$x:N},function(L){return{$x:function(){return U.zerosLike(L)}}})}}),s.log=O.op({log_:function(j){var N=C.convertToTensor(j,"x","log"),L=[N];return l.ENGINE.runKernelFunc(function(W,z){var q=W.log(N);return z([N]),q},{x:N},function(W,z){var q=z[0];return{x:function(){return W.div(q.toFloat())}}},"Log",{},L)}}),s.log1p=O.op({log1p_:function(j){var N=C.convertToTensor(j,"x","log1p");return l.ENGINE.runKernelFunc(function(L,W){var z=L.log1p(N);return W([N]),z},{$x:N},function(L,W){var z=W[0];return{$x:function(){return L.div(z.add(1))}}})}}),s.logSigmoid=O.op({logSigmoid_:function(j){var N=C.convertToTensor(j,"x","logSigmoid");return l.ENGINE.runKernelFunc(function(L,W){var z=L.softplus(N.neg()).neg();return W([N]),z},{$x:N},function(L,W){var z=W[0];return{$x:function(){return L.mul(z.neg().sigmoid())}}})}}),s.neg=O.op({neg_:function(j){var N=C.convertToTensor(j,"x","neg"),L=[N];return l.ENGINE.runKernelFunc(function(W){return W.neg(N)},{x:N},function(W){return{x:function(){return W.neg()}}},"Neg",{},L)}}),s.reciprocal=O.op({reciprocal_:function(j){var N=C.convertToTensor(j,"x","reciprocal");return l.ENGINE.runKernelFunc(function(L,W){var z=L.reciprocal(N);return W([N]),z},{$x:N},function(L,W){var z=W[0];return{$x:function(){return L.div(z.square().neg())}}})}}),s.round=O.op({round_:function(j){var N=C.convertToTensor(j,"x","round");return l.ENGINE.runKernelFunc(function(L){return L.round(N)},{$x:N},function(L){return{$x:function(){return U.zerosLike(L)}}})}}),s.rsqrt=O.op({rsqrt_:function(j){var N=C.convertToTensor(j,"x","rsqrt"),L=[N];return l.ENGINE.runKernelFunc(function(W,z){var q=W.rsqrt(N);return z([N]),q},{x:N},function(W,z){var q=z[0];return{x:function(){return W.div(q.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},L)}}),s.sigmoid=O.op({sigmoid_:function(j){var N=C.convertToTensor(j,"x","sigmoid");return l.ENGINE.runKernelFunc(function(L,W){var z=L.sigmoid(N);return W([z]),z},{x:N},function(L,W){var z=W[0];return{x:function(){return L.mul(z.mul(U.scalar(1).sub(z)))}}},"Sigmoid")}}),s.sign=O.op({sign_:function(j){var N=C.convertToTensor(j,"x","sign");return l.ENGINE.runKernelFunc(function(L){return L.sign(N)},{$x:N},function(L){return{$x:function(){return U.zerosLike(L)}}})}}),s.isNaN=O.op({isNaN_:function(j){var N=C.convertToTensor(j,"x","isNaN");return l.ENGINE.runKernelFunc(function(L){return L.isNaN(N)},{$x:N},function(L){return{$x:function(){return U.zerosLike(L)}}})}}),s.isInf=O.op({isInf_:function(j){var N=C.convertToTensor(j,"x","isInf");return l.ENGINE.runKernelFunc(function(L){return L.isInf(N)},{$x:N},function(L){return{$x:function(){return U.zerosLike(L)}}})}}),s.isFinite=O.op({isFinite_:function(j){var N=C.convertToTensor(j,"x","isFinite");return l.ENGINE.runKernelFunc(function(L){return L.isFinite(N)},{$x:N},function(L){return{$x:function(){return U.zerosLike(L)}}})}}),s.sin=O.op({sin_:function(j){var N=C.convertToTensor(j,"x","sin"),L=[N];return l.ENGINE.runKernelFunc(function(W,z){var q=W.sin(N);return z([N]),q},{x:N},function(W,z){var q=z[0];return{x:function(){return q.toFloat().cos().mul(W)}}},"Sin",{},L)}}),s.sinh=O.op({sinh_:function(j){var N=C.convertToTensor(j,"x","sinh");return l.ENGINE.runKernelFunc(function(L,W){var z=L.sinh(N);return W([N]),z},{$x:N},function(L,W){var z=W[0];return{$x:function(){return z.toFloat().cosh().mulStrict(L)}}})}}),s.softplus=O.op({softplus_:function(j){var N=C.convertToTensor(j,"x","softplus");return l.ENGINE.runKernelFunc(function(L,W){var z=L.softplus(N);return W([N]),z},{$x:N},function(L,W){var z=W[0];return{$x:function(){return L.mul(z.sigmoid())}}})}}),s.sqrt=O.op({sqrt_:function(j){var N=C.convertToTensor(j,"x","sqrt");return l.ENGINE.runKernelFunc(function(L,W){var z=L.sqrt(N);return W([N]),z},{$x:N},function(L,W){var z=W[0];return{$x:function(){return L.div(z.toFloat().sqrt().mul(2))}}})}}),s.step=O.op({step_:function(j,N){N===void 0&&(N=0);var L=C.convertToTensor(j,"x","step");return l.ENGINE.runKernelFunc(function(W){return W.step(L,N)},{$x:L},function(W){return{$x:function(){return U.zerosLike(W)}}})}}),s.tan=O.op({tan_:function(j){var N=C.convertToTensor(j,"x","tan");return l.ENGINE.runKernelFunc(function(L,W){var z=L.tan(N);return W([N]),z},{$x:N},function(L,W){var z=W[0];return{$x:function(){return L.div(z.cos().square())}}})}}),s.tanh=O.op({tanh_:function(j){var N=C.convertToTensor(j,"x","tanh");return l.ENGINE.runKernelFunc(function(L,W){var z=L.tanh(N);return W([z]),z},{x:N},function(L,W){var z=W[0];return{x:function(){return U.scalar(1).sub(z.square()).mulStrict(L)}}},"Tanh",{},null,[!0])}})},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(25),C=r(29),S=r(21),O=r(28);s.complex=O.op({complex_:function(U,j){var N=C.convertToTensor(U,"real","complex"),L=C.convertToTensor(j,"imag","complex");return S.assertShapesMatch(N.shape,L.shape,"real and imag shapes, "+N.shape+" and "+L.shape+", must match in call to tf.complex()."),l.ENGINE.runKernelFunc(function(W){return W.complex(N,L)},{$real:N,$imag:L})}}),s.real=O.op({real_:function(U){var j=C.convertToTensor(U,"input","real");return l.ENGINE.runKernelFunc(function(N){return N.real(j)},{$input:j})}}),s.imag=O.op({imag_:function(U){var j=C.convertToTensor(U,"input","imag");return l.ENGINE.runKernelFunc(function(N){return N.imag(j)},{$input:j})}})},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(25),C=r(74),S=r(29),O=r(21),U=r(206),j=r(147),N=r(28),L=r(91),W=r(372);s.addStrict=N.op({addStrict_:function(z,q){var I=S.convertToTensor(z,"a","addStrict"),Z=S.convertToTensor(q,"b","addStrict");return O.assertShapesMatch(I.shape,Z.shape,"Error in addStrict: "),I.add(Z)}}),s.atan2=N.op({atan2_:function(z,q){var I,Z=S.convertToTensor(z,"a","atan2"),Y=S.convertToTensor(q,"b","atan2");I=C.makeTypesMatch(Z,Y),Z=I[0],Y=I[1];var G=j.assertAndGetBroadcastShape(Z.shape,Y.shape);return l.ENGINE.runKernelFunc(function(oe,ce){var be=oe.atan2(Z,Y);return ce([Z,Y]),be},{$a:Z,$b:Y},function(oe,ce){var be=ce[0],Ee=ce[1];return{$a:function(){var ve=U.add(be.square(),Ee.square()),ge=oe.mul(Ee.div(ve)),Ge=j.getReductionAxes(be.shape,G);return Ge.length>0&&(ge=ge.sum(Ge)),ge.reshape(be.shape)},$b:function(){var ve=U.add(be.square(),Ee.square()),ge=W.neg(oe.mul(be.div(ve))),Ge=j.getReductionAxes(Ee.shape,G);return Ge.length>0&&(ge=ge.sum(Ge)),ge.reshape(Ee.shape)}}})}}),s.divStrict=N.op({divStrict_:function(z,q){var I=S.convertToTensor(z,"a","div"),Z=S.convertToTensor(q,"b","div");return O.assertShapesMatch(I.shape,Z.shape,"Error in divideStrict: "),I.div(Z)}}),s.floorDiv=N.op({floorDiv_:function(z,q){var I,Z=S.convertToTensor(z,"a","floorDiv"),Y=S.convertToTensor(q,"b","floorDiv");I=C.makeTypesMatch(Z,Y),Z=I[0],Y=I[1];var G=j.assertAndGetBroadcastShape(Z.shape,Y.shape);return l.ENGINE.runKernelFunc(function(oe,ce){var be=oe.floorDiv(Z,Y);return ce([Z,Y]),be},{a:Z,b:Y},function(oe,ce){var be=ce[0],Ee=ce[1];return{a:function(){var ve=oe.div(Ee.toFloat()),ge=j.getReductionAxes(be.shape,G);return ge.length>0?ve.sum(ge).reshape(be.shape):ve},b:function(){var ve=oe.mul(be.toFloat()),ge=j.getReductionAxes(Ee.shape,G);ge.length>0&&(ve=ve.sum(ge).reshape(Ee.shape));var Ge=Ee.square();return ve.div(Ge.toFloat()).neg()}}},"FloorDiv")}}),s.maximum=N.op({maximum_:function(z,q){var I,Z=S.convertToTensor(z,"a","maximum"),Y=S.convertToTensor(q,"b","maximum");return I=C.makeTypesMatch(Z,Y),Z=I[0],Y=I[1],Z.dtype==="bool"&&(Z=Z.toInt(),Y=Y.toInt()),j.assertAndGetBroadcastShape(Z.shape,Y.shape),l.ENGINE.runKernelFunc(function(G,oe){var ce=G.maximum(Z,Y);return oe([Z,Y]),ce},{a:Z,b:Y},function(G,oe){var ce=oe[0],be=oe[1];return{a:function(){return G.mul(ce.greaterEqual(be).toFloat())},b:function(){return G.mul(ce.less(be).toFloat())}}},"Maximum")}}),s.maximumStrict=N.op({maximumStrict_:function(z,q){var I=S.convertToTensor(z,"a","maximumStrict"),Z=S.convertToTensor(q,"b","maximumStrict");return O.assertShapesMatch(I.shape,Z.shape,"Error in maximumStrict: "),I.maximum(Z)}}),s.minimum=N.op({minimum_:function(z,q){var I,Z=S.convertToTensor(z,"a","minimum"),Y=S.convertToTensor(q,"b","minimum");return I=C.makeTypesMatch(Z,Y),Z=I[0],Y=I[1],Z.dtype==="bool"&&(Z=Z.toInt(),Y=Y.toInt()),j.assertAndGetBroadcastShape(Z.shape,Y.shape),l.ENGINE.runKernelFunc(function(G,oe){var ce=G.minimum(Z,Y);return oe([Z,Y]),ce},{a:Z,b:Y},function(G,oe){var ce=oe[0],be=oe[1];return{a:function(){return G.mul(ce.lessEqual(be).toFloat())},b:function(){return G.mul(ce.greater(be).toFloat())}}},"Minimum")}}),s.minimumStrict=N.op({minimumStrict_:function(z,q){var I=S.convertToTensor(z,"a","minimumStrict"),Z=S.convertToTensor(q,"b","minimumStrict");return O.assertShapesMatch(I.shape,Z.shape,"Error in minimumStrict: "),I.minimum(Z)}}),s.mod=N.op({mod_:function(z,q){var I,Z=S.convertToTensor(z,"a","mod"),Y=S.convertToTensor(q,"b","mod");I=C.makeTypesMatch(Z,Y),Z=I[0],Y=I[1];var G=j.assertAndGetBroadcastShape(Z.shape,Y.shape);return l.ENGINE.runKernelFunc(function(oe,ce){var be=oe.mod(Z,Y);return ce([Z,Y]),be},{$a:Z,$b:Y},function(oe,ce){var be=ce[0],Ee=ce[1];return{$a:function(){var ve=j.getReductionAxes(be.shape,G);return ve.length>0?oe.sum(ve).reshape(be.shape):oe},$b:function(){var ve=oe.mul(be.div(Ee).floor().neg()),ge=j.getReductionAxes(Ee.shape,G);return ge.length>0?ve.sum(ge).reshape(Ee.shape):ve}}})}}),s.modStrict=N.op({modStrict_:function(z,q){var I=S.convertToTensor(z,"a","modStrict"),Z=S.convertToTensor(q,"b","modStrict");return O.assertShapesMatch(I.shape,Z.shape,"Error in modStrict: "),I.mod(Z)}}),s.mul=N.op({mul_:function(z,q){var I,Z=S.convertToTensor(z,"a","mul"),Y=S.convertToTensor(q,"b","mul");I=C.makeTypesMatch(Z,Y),Z=I[0],Y=I[1];var G=j.assertAndGetBroadcastShape(Z.shape,Y.shape);return l.ENGINE.runKernelFunc(function(oe,ce){var be=oe.multiply(Z,Y);return ce([Z,Y]),be},{a:Z,b:Y},function(oe,ce){var be=ce[0],Ee=ce[1];return{a:function(){var ve=oe.mul(Ee.toFloat()),ge=j.getReductionAxes(be.shape,G);return ge.length>0?ve.sum(ge).reshape(be.shape):ve},b:function(){var ve=oe.mul(be.toFloat()),ge=j.getReductionAxes(Ee.shape,G);return ge.length>0?ve.sum(ge).reshape(Ee.shape):ve}}},"Mul")}}),s.mulStrict=N.op({mulStrict_:function(z,q){var I=S.convertToTensor(z,"a","mul"),Z=S.convertToTensor(q,"b","mul");return O.assertShapesMatch(I.shape,Z.shape,"Error in multiplyStrict: "),I.mul(Z)}}),s.pow=N.op({pow_:function(z,q){var I,Z=S.convertToTensor(z,"base","pow"),Y=S.convertToTensor(q,"exp","pow");I=C.makeTypesMatch(Z,Y),Z=I[0],Y=I[1];var G=j.assertAndGetBroadcastShape(Z.shape,Y.shape),oe=[Z,Y];return l.ENGINE.runKernelFunc(function(ce,be){var Ee=ce.pow(Z,Y);return be([Z,Y,Ee]),Ee},{a:Z,b:Y},function(ce,be){var Ee=be[0],ve=be[1],ge=be[2];return{a:function(){var Ge=ve.toFloat(),ht=ce.mul(Ge.mul(Ee.pow(Ge.sub(L.scalar(1))))),It=j.getReductionAxes(Ee.shape,G);return It.length>0&&(ht=ht.sum(It)),ht.reshape(Ee.shape)},b:function(){var Ge=Ee.greater(0),ht=Ee.log().where(Ge,L.zerosLike(Ee)),It=ce.mul(ge.mul(ht)),St=j.getReductionAxes(ve.shape,G);return St.length>0&&(It=It.sum(St)),It.reshape(ve.shape)}}},"Pow",{},oe,[!0])}}),s.powStrict=N.op({powStrict_:function(z,q){return O.assertShapesMatch(z.shape,q.shape,"Error in powStrict: "),z.pow(q)}}),s.squaredDifferenceStrict=N.op({squaredDifferenceStrict_:function(z,q){var I=S.convertToTensor(z,"a","squaredDifferenceStrict"),Z=S.convertToTensor(q,"b","squaredDifferenceStrict");return O.assertShapesMatch(I.shape,Z.shape,"Error in squaredDifferenceStrict: "),I.squaredDifference(Z)}}),s.sub=N.op({sub_:function(z,q){var I,Z=S.convertToTensor(z,"a","sub"),Y=S.convertToTensor(q,"b","sub");I=C.makeTypesMatch(Z,Y),Z=I[0],Y=I[1];var G=j.assertAndGetBroadcastShape(Z.shape,Y.shape);return l.ENGINE.runKernelFunc(function(oe){return oe.subtract(Z,Y)},{a:Z,b:Y},function(oe){return{a:function(){var ce=oe,be=j.getReductionAxes(Z.shape,G);return be.length>0&&(ce=ce.sum(be)),ce.reshape(Z.shape)},b:function(){var ce=oe,be=j.getReductionAxes(Y.shape,G);return be.length>0&&(ce=ce.sum(be)),ce.neg().reshape(Y.shape)}}},"Sub")}}),s.subStrict=N.op({subStrict_:function(z,q){var I=S.convertToTensor(z,"a","subStrict"),Z=S.convertToTensor(q,"b","subStrict");return O.assertShapesMatch(I.shape,Z.shape,"Error in subStrict: "),I.sub(Z)}})},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(205);r(33).Tensor.prototype.div=function(C){return l.div(this,C)}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(25),C=r(73),S=r(29),O=r(28);s.broadcastTo=O.op({broadcastTo_:function(U,j){var N=S.convertToTensor(U,"broadcastTo","x"),L=N.shape;if(j.some(function(oe){return!(oe>0)||oe%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+j+"].");if(j.length<N.rank)throw new Error("broadcastTo(): shape.length="+j.length+" < input.rank="+N.rank+".");if(j.length>N.rank){for(var W=N.shape.slice();W.length<j.length;)W.unshift(1);N=N.reshape(W)}for(var z=N.shape,q=Array.from(j),I=j.length-1;I>=0;I--)if(z[I]===j[I])q[I]=1;else if(N.shape[I]!==1)throw new Error("broadcastTo(): ["+L+"] cannot be broadcast to ["+j+"].");var Z=q.map(function(oe,ce){return oe>1?ce:-1}).filter(function(oe){return oe>=0});if(Z.length===0)return N.clone();var Y={x:N},G={shape:j,inputShape:z};return l.ENGINE.runKernelFunc(function(oe){return oe.tile(N,q)},Y,function(oe){return{x:function(){return oe.sum(Z,!0)}}},C.BroadcastTo,G)}})},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(376);r(33).Tensor.prototype.broadcastTo=function(C){return l.broadcastTo(this,C)}},function(u,s,r){var l,C,S,O;Object.defineProperty(s,"__esModule",{value:!0}),function(N){N.R0="R0",N.R1="R1",N.R2="R2",N.R3="R3",N.R4="R4",N.R5="R5",N.R6="R6"}(s.Rank||(s.Rank={})),function(N){N.float32="float32",N.int32="int32",N.bool="int32",N.complex64="complex64"}(l||(l={})),function(N){N.float32="float32",N.int32="int32",N.bool="bool",N.complex64="complex64"}(C||(C={})),function(N){N.float32="float32",N.int32="float32",N.bool="float32",N.complex64="complex64"}(S||(S={})),function(N){N.float32="complex64",N.int32="complex64",N.bool="complex64",N.complex64="complex64"}(O||(O={}));var U={float32:S,int32:l,bool:C,complex64:O};function j(N,L){if(N==="string"||L==="string"){if(N==="string"&&L==="string")return"string";throw new Error("Can not upcast "+N+" with "+L)}return U[N][L]}s.upcastType=j,s.sumOutType=function(N){return j(N,"int32")}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(21),C=20,S=3,O=7;function U(L,W,z){var q;return q=Array.isArray(L)?parseFloat(L[0].toFixed(O))+" + "+parseFloat(L[1].toFixed(O))+"j":l.isString(L)?"'"+L+"'":z==="bool"?j(L):parseFloat(L.toFixed(O)).toString(),l.rightPad(q,W)}function j(L){return L===0?"false":"true"}function N(L){for(var W=[],z=0;z<L.length;z+=2)W.push([L[z],L[z+1]]);return W}s.tensorToString=function(L,W,z,q){var I=l.computeStrides(W),Z=function(ce,be,Ee,ve){var ge=l.sizeFromShape(be),Ge=ve[ve.length-1],ht=new Array(Ge).fill(0),It=be.length,St=Ee==="complex64"?N(ce):ce;if(It>1)for(var we=0;we<ge/Ge;we++)for(var bt=we*Ge,jt=0;jt<Ge;jt++)ht[jt]=Math.max(ht[jt],U(St[bt+jt],0,Ee).length);return ht}(L,W,z,I),Y=W.length,G=function ce(be,Ee,ve,ge,Ge,ht){ht===void 0&&(ht=!0);var It=ve==="complex64"?2:1,St=Ee[0],we=Ee.length;if(we===0){if(ve==="complex64"){var bt=N(be);return[U(bt[0],0,ve)]}return ve==="bool"?[j(be[0])]:[be[0].toString()]}if(we===1){if(St>C){var jt=S*It,Mt=Array.from(be.slice(0,jt)),ze=Array.from(be.slice((St-S)*It,St*It));return ve==="complex64"&&(Mt=N(Mt),ze=N(ze)),["["+Mt.map(function(cn,qe){return U(cn,Ge[qe],ve)}).join(", ")+", ..., "+ze.map(function(cn,qe){return U(cn,Ge[St-S+qe],ve)}).join(", ")+"]"]}var Ut=ve==="complex64"?N(be):Array.from(be);return["["+Ut.map(function(cn,qe){return U(cn,Ge[qe],ve)}).join(", ")+"]"]}var Ft=Ee.slice(1),pt=ge.slice(1),yt=ge[0]*It,nn=[];if(St>C){for(var xt=0;xt<S;xt++){var _t=xt*yt,Yt=_t+yt;nn.push.apply(nn,ce(be.slice(_t,Yt),Ft,ve,pt,Ge,!1))}nn.push("...");for(var xt=St-S;xt<St;xt++){var _t=xt*yt,Yt=_t+yt;nn.push.apply(nn,ce(be.slice(_t,Yt),Ft,ve,pt,Ge,xt===St-1))}}else for(var xt=0;xt<St;xt++){var _t=xt*yt,Yt=_t+yt;nn.push.apply(nn,ce(be.slice(_t,Yt),Ft,ve,pt,Ge,xt===St-1))}var Fn=we===2?",":"";nn[0]="["+nn[0]+Fn;for(var xt=1;xt<nn.length-1;xt++)nn[xt]=" "+nn[xt]+Fn;for(var Rn=`,
`,xt=2;xt<we;xt++)Rn+=`
`;return nn[nn.length-1]=" "+nn[nn.length-1]+"]"+(ht?"":Rn),nn}(L,W,z,I,Z),oe=["Tensor"];return q&&(oe.push("  dtype: "+z),oe.push("  rank: "+Y),oe.push("  shape: ["+W+"]"),oe.push("  values:")),oe.push(G.map(function(ce){return"    "+ce}).join(`
`)),oe.join(`
`)}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(21);s.getFilteredNodesXToY=function(C,S,O){for(var U={},j={},N=0;N<S.length;N++)U[S[N].id]=!0;for(N=0;N<C.length;N++){var L=(oe=C[N]).inputs;for(var W in L){for(var z=L[W],q=!1,I=0;I<S.length;I++)if(U[z.id]){oe.outputs.forEach(function(ve){return U[ve.id]=!0}),q=!0,j[oe.id]=!0;break}if(q)break}}var Z={};Z[O.id]=!0;var Y={};for(N=C.length-1;N>=0;N--)for(L=(oe=C[N]).inputs,I=0;I<oe.outputs.length;I++)if(Z[oe.outputs[I].id]){for(var W in L)Z[L[W].id]=!0,Y[oe.id]=!0;break}var G=[];for(N=0;N<C.length;N++){var oe;if(j[(oe=C[N]).id]&&Y[oe.id]){var ce={};for(var W in oe.inputs){var be=oe.inputs[W];U[be.id]&&(ce[W]=be)}var Ee=Object.assign({},oe);Ee.inputs=ce,Ee.outputs=oe.outputs,G.push(Ee)}}return G},s.backpropagateGradients=function(C,S,O){for(var U=function(N){var L=S[N],W=[];if(L.outputs.forEach(function(Z){var Y=C[Z.id];Y!=null?W.push(Y):W.push(null)}),L.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+L.kernelName+".");var z=L.gradient(W),q=function(Z){if(!(Z in z))throw new Error("Cannot backprop through input "+Z+". Available gradients found: "+Object.keys(z)+".");var Y=O(function(){return z[Z]()});if(Y.dtype!=="float32")throw new Error("Error in gradient for op "+L.kernelName+". The gradient of input "+Z+" must have 'float32' dtype, but has '"+Y.dtype+"'");var G=L.inputs[Z];if(!l.arraysEqual(Y.shape,G.shape))throw new Error("Error in gradient for op "+L.kernelName+". The gradient of input '"+Z+"' has shape '"+Y.shape+"', which does not match the shape of the input '"+G.shape+"'");if(C[G.id]==null)C[G.id]=Y;else{var oe=C[G.id];C[G.id]=oe.add(Y),oe.dispose()}};for(var I in L.inputs)q(I)},j=S.length-1;j>=0;j--)U(j)}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(21),C=function(){function U(j,N){this.backendTimer=j,this.logger=N,N==null&&(this.logger=new O)}return U.prototype.profileKernel=function(j,N,L){var W,z=this,q=this.backendTimer.time(function(){W=L()});return W.forEach(function(I){I.data().then(function(Z){S(Z,I.dtype,j),q.then(function(Y){var G="";Y.getExtraProfileInfo!=null&&(G=Y.getExtraProfileInfo()),z.logger.logKernelProfile(j,I,Z,Y.kernelMs,N,G)})})}),W},U}();function S(U,j,N){if(j!=="float32")return!1;for(var L=0;L<U.length;L++){var W=U[L];if(isNaN(W)||!isFinite(W))return console.warn("Found "+W+" in the result of '"+N+"'"),!0}return!1}s.Profiler=C,s.checkComputationForErrors=S;var O=function(){function U(){}return U.prototype.logKernelProfile=function(j,N,L,W,z,q){var I=typeof W=="number"?l.rightPad(W+"ms",9):W.error,Z=l.rightPad(j,25),Y=N.rank,G=N.size,oe=l.rightPad(N.shape.toString(),14),ce="";for(var be in z){var Ee=z[be].shape||N.shape,ve=Ee.length;ce+=be+": "+ve+"D "+(ve>0?Ee:"")+" "}console.log("%c"+Z+"	%c"+I+"	%c"+Y+"D "+oe+"	%c"+G+"	%c"+ce+"	%c"+q,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},U}();s.Logger=O},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=new Map,C=new Map;function S(O,U){return U+"_"+O}s.getKernel=function(O,U){var j=S(O,U);return l.get(j)},s.getGradient=function(O){return C.get(O)},s.getKernelsForBackend=function(O){for(var U=l.entries(),j=[];;){var N=U.next(),L=N.done,W=N.value;if(L)break;var z=W[0],q=W[1];z.split("_")[0]===O&&j.push(q)}return j},s.registerKernel=function(O){var U=O.kernelName,j=O.backendName,N=S(U,j);if(l.has(N))throw new Error("The kernel '"+U+"' for backend '"+j+"' is already registered");l.set(N,O)},s.registerGradient=function(O){var U=O.kernelName;C.has(U)&&console.warn("Overriding the gradient for '"+U+"'"),C.set(U,O)},s.unregisterKernel=function(O,U){var j=S(O,U);if(!l.has(j))throw new Error("The kernel '"+O+"' for backend '"+U+"' is not registered");l.delete(j)},s.unregisterGradient=function(O){if(!C.has(O))throw new Error("The gradient '"+O+"' for backend is not registered");C.delete(O)}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0});var l=r(206);r(33).Tensor.prototype.add=function(C){return l.add(this,C)}},function(u,s,r){Object.defineProperty(s,"__esModule",{value:!0}),r(383),r(377),r(375),r(371),r(363),r(361),r(359),r(357),r(355),r(353)},function(u,s){},function(u,s){},function(u,s){},function(u,s){},function(u,s){},function(u,s){},function(u,s,r){(function(l,C){(function(S,O){if(!S.setImmediate){var U,j=1,N={},L=!1,W=S.document,z=Object.getPrototypeOf&&Object.getPrototypeOf(S);z=z&&z.setTimeout?z:S,{}.toString.call(S.process)==="[object process]"?U=function(Z){C.nextTick(function(){I(Z)})}:function(){if(S.postMessage&&!S.importScripts){var Z=!0,Y=S.onmessage;return S.onmessage=function(){Z=!1},S.postMessage("","*"),S.onmessage=Y,Z}}()?function(){var Z="setImmediate$"+Math.random()+"$",Y=function(G){G.source===S&&typeof G.data=="string"&&G.data.indexOf(Z)===0&&I(+G.data.slice(Z.length))};S.addEventListener?S.addEventListener("message",Y,!1):S.attachEvent("onmessage",Y),U=function(G){S.postMessage(Z+G,"*")}}():S.MessageChannel?function(){var Z=new MessageChannel;Z.port1.onmessage=function(Y){I(Y.data)},U=function(Y){Z.port2.postMessage(Y)}}():W&&"onreadystatechange"in W.createElement("script")?function(){var Z=W.documentElement;U=function(Y){var G=W.createElement("script");G.onreadystatechange=function(){I(Y),G.onreadystatechange=null,Z.removeChild(G),G=null},Z.appendChild(G)}}():U=function(Z){setTimeout(I,0,Z)},z.setImmediate=function(Z){typeof Z!="function"&&(Z=new Function(""+Z));for(var Y=new Array(arguments.length-1),G=0;G<Y.length;G++)Y[G]=arguments[G+1];var oe={callback:Z,args:Y};return N[j]=oe,U(j),j++},z.clearImmediate=q}function q(Z){delete N[Z]}function I(Z){if(L)setTimeout(I,0,Z);else{var Y=N[Z];if(Y){L=!0;try{(function(G){var oe=G.callback,ce=G.args;switch(ce.length){case 0:oe();break;case 1:oe(ce[0]);break;case 2:oe(ce[0],ce[1]);break;case 3:oe(ce[0],ce[1],ce[2]);break;default:oe.apply(O,ce)}})(Y)}finally{q(Z),L=!1}}}}})(typeof self>"u"?l===void 0?this:l:self)}).call(this,r(59),r(75))},function(u,s){var r={}.toString;u.exports=Array.isArray||function(l){return r.call(l)=="[object Array]"}},function(u,s){s.read=function(r,l,C,S,O){var U,j,N=8*O-S-1,L=(1<<N)-1,W=L>>1,z=-7,q=C?O-1:0,I=C?-1:1,Z=r[l+q];for(q+=I,U=Z&(1<<-z)-1,Z>>=-z,z+=N;z>0;U=256*U+r[l+q],q+=I,z-=8);for(j=U&(1<<-z)-1,U>>=-z,z+=S;z>0;j=256*j+r[l+q],q+=I,z-=8);if(U===0)U=1-W;else{if(U===L)return j?NaN:1/0*(Z?-1:1);j+=Math.pow(2,S),U-=W}return(Z?-1:1)*j*Math.pow(2,U-S)},s.write=function(r,l,C,S,O,U){var j,N,L,W=8*U-O-1,z=(1<<W)-1,q=z>>1,I=O===23?Math.pow(2,-24)-Math.pow(2,-77):0,Z=S?0:U-1,Y=S?1:-1,G=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(N=isNaN(l)?1:0,j=z):(j=Math.floor(Math.log(l)/Math.LN2),l*(L=Math.pow(2,-j))<1&&(j--,L*=2),(l+=j+q>=1?I/L:I*Math.pow(2,1-q))*L>=2&&(j++,L/=2),j+q>=z?(N=0,j=z):j+q>=1?(N=(l*L-1)*Math.pow(2,O),j+=q):(N=l*Math.pow(2,q-1)*Math.pow(2,O),j=0));O>=8;r[C+Z]=255&N,Z+=Y,N/=256,O-=8);for(j=j<<O|N,W+=O;W>0;r[C+Z]=255&j,Z+=Y,j/=256,W-=8);r[C+Z-Y]|=128*G}},function(u,s,r){s.byteLength=function(z){var q=N(z),I=q[0],Z=q[1];return 3*(I+Z)/4-Z},s.toByteArray=function(z){var q,I,Z=N(z),Y=Z[0],G=Z[1],oe=new S(function(Ee,ve,ge){return 3*(ve+ge)/4-ge}(0,Y,G)),ce=0,be=G>0?Y-4:Y;for(I=0;I<be;I+=4)q=C[z.charCodeAt(I)]<<18|C[z.charCodeAt(I+1)]<<12|C[z.charCodeAt(I+2)]<<6|C[z.charCodeAt(I+3)],oe[ce++]=q>>16&255,oe[ce++]=q>>8&255,oe[ce++]=255&q;return G===2&&(q=C[z.charCodeAt(I)]<<2|C[z.charCodeAt(I+1)]>>4,oe[ce++]=255&q),G===1&&(q=C[z.charCodeAt(I)]<<10|C[z.charCodeAt(I+1)]<<4|C[z.charCodeAt(I+2)]>>2,oe[ce++]=q>>8&255,oe[ce++]=255&q),oe},s.fromByteArray=function(z){for(var q,I=z.length,Z=I%3,Y=[],G=0,oe=I-Z;G<oe;G+=16383)Y.push(W(z,G,G+16383>oe?oe:G+16383));return Z===1?(q=z[I-1],Y.push(l[q>>2]+l[q<<4&63]+"==")):Z===2&&(q=(z[I-2]<<8)+z[I-1],Y.push(l[q>>10]+l[q>>4&63]+l[q<<2&63]+"=")),Y.join("")};for(var l=[],C=[],S=typeof Uint8Array<"u"?Uint8Array:Array,O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",U=0,j=O.length;U<j;++U)l[U]=O[U],C[O.charCodeAt(U)]=U;function N(z){var q=z.length;if(q%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var I=z.indexOf("=");return I===-1&&(I=q),[I,I===q?0:4-I%4]}function L(z){return l[z>>18&63]+l[z>>12&63]+l[z>>6&63]+l[63&z]}function W(z,q,I){for(var Z,Y=[],G=q;G<I;G+=3)Z=(z[G]<<16&16711680)+(z[G+1]<<8&65280)+(255&z[G+2]),Y.push(L(Z));return Y.join("")}C["-".charCodeAt(0)]=62,C["_".charCodeAt(0)]=63},function(u,s){var r={}.hasOwnProperty;u.exports=function(l,C){return r.call(l,C)}},function(u,s){u.exports=function(r,l){return{enumerable:!(1&r),configurable:!(2&r),writable:!(4&r),value:l}}},function(u,s,r){var l=r(149);u.exports=function(C,S){if(!l(C))return C;var O,U;if(S&&typeof(O=C.toString)=="function"&&!l(U=O.call(C))||typeof(O=C.valueOf)=="function"&&!l(U=O.call(C))||!S&&typeof(O=C.toString)=="function"&&!l(U=O.call(C)))return U;throw TypeError("Can't convert object to primitive value")}},function(u,s,r){var l=r(149),C=r(150).document,S=l(C)&&l(C.createElement);u.exports=function(O){return S?C.createElement(O):{}}},function(u,s,r){u.exports=!r(148)&&!r(208)(function(){return Object.defineProperty(r(398)("div"),"a",{get:function(){return 7}}).a!=7})},function(u,s,r){var l=r(149);u.exports=function(C){if(!l(C))throw TypeError(C+" is not an object!");return C}},function(u,s,r){var l=r(400),C=r(399),S=r(397),O=Object.defineProperty;s.f=r(148)?Object.defineProperty:function(U,j,N){if(l(U),j=S(j,!0),l(N),C)try{return O(U,j,N)}catch{}if("get"in N||"set"in N)throw TypeError("Accessors not supported!");return"value"in N&&(U[j]=N.value),U}},function(u,s,r){var l=r(401),C=r(396);u.exports=r(148)?function(S,O,U){return l.f(S,O,C(1,U))}:function(S,O,U){return S[O]=U,S}},function(u,s){u.exports=function(r){if(typeof r!="function")throw TypeError(r+" is not a function!");return r}},function(u,s,r){var l=r(403);u.exports=function(C,S,O){if(l(C),S===void 0)return C;switch(O){case 1:return function(U){return C.call(S,U)};case 2:return function(U,j){return C.call(S,U,j)};case 3:return function(U,j,N){return C.call(S,U,j,N)}}return function(){return C.apply(S,arguments)}}},function(u,s,r){var l=r(150),C=r(209),S=r(404),O=r(402),U=r(395),j=function(N,L,W){var z,q,I,Z=N&j.F,Y=N&j.G,G=N&j.S,oe=N&j.P,ce=N&j.B,be=N&j.W,Ee=Y?C:C[L]||(C[L]={}),ve=Ee.prototype,ge=Y?l:G?l[L]:(l[L]||{}).prototype;for(z in Y&&(W=L),W)(q=!Z&&ge&&ge[z]!==void 0)&&U(Ee,z)||(I=q?ge[z]:W[z],Ee[z]=Y&&typeof ge[z]!="function"?W[z]:ce&&q?S(I,l):be&&ge[z]==I?function(Ge){var ht=function(It,St,we){if(this instanceof Ge){switch(arguments.length){case 0:return new Ge;case 1:return new Ge(It);case 2:return new Ge(It,St)}return new Ge(It,St,we)}return Ge.apply(this,arguments)};return ht.prototype=Ge.prototype,ht}(I):oe&&typeof I=="function"?S(Function.call,I):I,oe&&((Ee.virtual||(Ee.virtual={}))[z]=I,N&j.R&&ve&&!ve[z]&&O(ve,z,I)))};j.F=1,j.G=2,j.S=4,j.P=8,j.B=16,j.W=32,j.U=64,j.R=128,u.exports=j},function(u,s,r){var l=r(405);l(l.G,{global:r(150)})},function(u,s,r){r(406),u.exports=r(209).global},function(u,s,r){var l=function(C){var S,O=Object.prototype,U=O.hasOwnProperty,j=typeof Symbol=="function"?Symbol:{},N=j.iterator||"@@iterator",L=j.asyncIterator||"@@asyncIterator",W=j.toStringTag||"@@toStringTag";function z(pt,yt,nn){return Object.defineProperty(pt,yt,{value:nn,enumerable:!0,configurable:!0,writable:!0}),pt[yt]}try{z({},"")}catch{z=function(yt,nn,xt){return yt[nn]=xt}}function q(pt,yt,nn,xt){var _t=yt&&yt.prototype instanceof be?yt:be,Yt=Object.create(_t.prototype),Fn=new ze(xt||[]);return Yt._invoke=function(Rn,cn,qe){var Qe=Z;return function($e,ft){if(Qe===G)throw new Error("Generator is already running");if(Qe===oe){if($e==="throw")throw ft;return Ft()}for(qe.method=$e,qe.arg=ft;;){var Jt=qe.delegate;if(Jt){var Qt=bt(Jt,qe);if(Qt){if(Qt===ce)continue;return Qt}}if(qe.method==="next")qe.sent=qe._sent=qe.arg;else if(qe.method==="throw"){if(Qe===Z)throw Qe=oe,qe.arg;qe.dispatchException(qe.arg)}else qe.method==="return"&&qe.abrupt("return",qe.arg);Qe=G;var Pn=I(Rn,cn,qe);if(Pn.type==="normal"){if(Qe=qe.done?oe:Y,Pn.arg===ce)continue;return{value:Pn.arg,done:qe.done}}Pn.type==="throw"&&(Qe=oe,qe.method="throw",qe.arg=Pn.arg)}}}(pt,nn,Fn),Yt}function I(pt,yt,nn){try{return{type:"normal",arg:pt.call(yt,nn)}}catch(xt){return{type:"throw",arg:xt}}}C.wrap=q;var Z="suspendedStart",Y="suspendedYield",G="executing",oe="completed",ce={};function be(){}function Ee(){}function ve(){}var ge={};z(ge,N,function(){return this});var Ge=Object.getPrototypeOf,ht=Ge&&Ge(Ge(Ut([])));ht&&ht!==O&&U.call(ht,N)&&(ge=ht);var It=ve.prototype=be.prototype=Object.create(ge);function St(pt){["next","throw","return"].forEach(function(yt){z(pt,yt,function(nn){return this._invoke(yt,nn)})})}function we(pt,yt){var nn;this._invoke=function(xt,_t){function Yt(){return new yt(function(Fn,Rn){(function cn(qe,Qe,$e,ft){var Jt=I(pt[qe],pt,Qe);if(Jt.type!=="throw"){var Qt=Jt.arg,Pn=Qt.value;return Pn&&typeof Pn=="object"&&U.call(Pn,"__await")?yt.resolve(Pn.__await).then(function(kn){cn("next",kn,$e,ft)},function(kn){cn("throw",kn,$e,ft)}):yt.resolve(Pn).then(function(kn){Qt.value=kn,$e(Qt)},function(kn){return cn("throw",kn,$e,ft)})}ft(Jt.arg)})(xt,_t,Fn,Rn)})}return nn=nn?nn.then(Yt,Yt):Yt()}}function bt(pt,yt){var nn=pt.iterator[yt.method];if(nn===S){if(yt.delegate=null,yt.method==="throw"){if(pt.iterator.return&&(yt.method="return",yt.arg=S,bt(pt,yt),yt.method==="throw"))return ce;yt.method="throw",yt.arg=new TypeError("The iterator does not provide a 'throw' method")}return ce}var xt=I(nn,pt.iterator,yt.arg);if(xt.type==="throw")return yt.method="throw",yt.arg=xt.arg,yt.delegate=null,ce;var _t=xt.arg;return _t?_t.done?(yt[pt.resultName]=_t.value,yt.next=pt.nextLoc,yt.method!=="return"&&(yt.method="next",yt.arg=S),yt.delegate=null,ce):_t:(yt.method="throw",yt.arg=new TypeError("iterator result is not an object"),yt.delegate=null,ce)}function jt(pt){var yt={tryLoc:pt[0]};1 in pt&&(yt.catchLoc=pt[1]),2 in pt&&(yt.finallyLoc=pt[2],yt.afterLoc=pt[3]),this.tryEntries.push(yt)}function Mt(pt){var yt=pt.completion||{};yt.type="normal",delete yt.arg,pt.completion=yt}function ze(pt){this.tryEntries=[{tryLoc:"root"}],pt.forEach(jt,this),this.reset(!0)}function Ut(pt){if(pt){var yt=pt[N];if(yt)return yt.call(pt);if(typeof pt.next=="function")return pt;if(!isNaN(pt.length)){var nn=-1,xt=function _t(){for(;++nn<pt.length;)if(U.call(pt,nn))return _t.value=pt[nn],_t.done=!1,_t;return _t.value=S,_t.done=!0,_t};return xt.next=xt}}return{next:Ft}}function Ft(){return{value:S,done:!0}}return Ee.prototype=ve,z(It,"constructor",ve),z(ve,"constructor",Ee),Ee.displayName=z(ve,W,"GeneratorFunction"),C.isGeneratorFunction=function(pt){var yt=typeof pt=="function"&&pt.constructor;return!!yt&&(yt===Ee||(yt.displayName||yt.name)==="GeneratorFunction")},C.mark=function(pt){return Object.setPrototypeOf?Object.setPrototypeOf(pt,ve):(pt.__proto__=ve,z(pt,W,"GeneratorFunction")),pt.prototype=Object.create(It),pt},C.awrap=function(pt){return{__await:pt}},St(we.prototype),z(we.prototype,L,function(){return this}),C.AsyncIterator=we,C.async=function(pt,yt,nn,xt,_t){_t===void 0&&(_t=Promise);var Yt=new we(q(pt,yt,nn,xt),_t);return C.isGeneratorFunction(yt)?Yt:Yt.next().then(function(Fn){return Fn.done?Fn.value:Yt.next()})},St(It),z(It,W,"Generator"),z(It,N,function(){return this}),z(It,"toString",function(){return"[object Generator]"}),C.keys=function(pt){var yt=[];for(var nn in pt)yt.push(nn);return yt.reverse(),function xt(){for(;yt.length;){var _t=yt.pop();if(_t in pt)return xt.value=_t,xt.done=!1,xt}return xt.done=!0,xt}},C.values=Ut,ze.prototype={constructor:ze,reset:function(pt){if(this.prev=0,this.next=0,this.sent=this._sent=S,this.done=!1,this.delegate=null,this.method="next",this.arg=S,this.tryEntries.forEach(Mt),!pt)for(var yt in this)yt.charAt(0)==="t"&&U.call(this,yt)&&!isNaN(+yt.slice(1))&&(this[yt]=S)},stop:function(){this.done=!0;var pt=this.tryEntries[0].completion;if(pt.type==="throw")throw pt.arg;return this.rval},dispatchException:function(pt){if(this.done)throw pt;var yt=this;function nn(cn,qe){return Yt.type="throw",Yt.arg=pt,yt.next=cn,qe&&(yt.method="next",yt.arg=S),!!qe}for(var xt=this.tryEntries.length-1;xt>=0;--xt){var _t=this.tryEntries[xt],Yt=_t.completion;if(_t.tryLoc==="root")return nn("end");if(_t.tryLoc<=this.prev){var Fn=U.call(_t,"catchLoc"),Rn=U.call(_t,"finallyLoc");if(Fn&&Rn){if(this.prev<_t.catchLoc)return nn(_t.catchLoc,!0);if(this.prev<_t.finallyLoc)return nn(_t.finallyLoc)}else if(Fn){if(this.prev<_t.catchLoc)return nn(_t.catchLoc,!0)}else{if(!Rn)throw new Error("try statement without catch or finally");if(this.prev<_t.finallyLoc)return nn(_t.finallyLoc)}}}},abrupt:function(pt,yt){for(var nn=this.tryEntries.length-1;nn>=0;--nn){var xt=this.tryEntries[nn];if(xt.tryLoc<=this.prev&&U.call(xt,"finallyLoc")&&this.prev<xt.finallyLoc){var _t=xt;break}}_t&&(pt==="break"||pt==="continue")&&_t.tryLoc<=yt&&yt<=_t.finallyLoc&&(_t=null);var Yt=_t?_t.completion:{};return Yt.type=pt,Yt.arg=yt,_t?(this.method="next",this.next=_t.finallyLoc,ce):this.complete(Yt)},complete:function(pt,yt){if(pt.type==="throw")throw pt.arg;return pt.type==="break"||pt.type==="continue"?this.next=pt.arg:pt.type==="return"?(this.rval=this.arg=pt.arg,this.method="return",this.next="end"):pt.type==="normal"&&yt&&(this.next=yt),ce},finish:function(pt){for(var yt=this.tryEntries.length-1;yt>=0;--yt){var nn=this.tryEntries[yt];if(nn.finallyLoc===pt)return this.complete(nn.completion,nn.afterLoc),Mt(nn),ce}},catch:function(pt){for(var yt=this.tryEntries.length-1;yt>=0;--yt){var nn=this.tryEntries[yt];if(nn.tryLoc===pt){var xt=nn.completion;if(xt.type==="throw"){var _t=xt.arg;Mt(nn)}return _t}}throw new Error("illegal catch attempt")},delegateYield:function(pt,yt,nn){return this.delegate={iterator:Ut(pt),resultName:yt,nextLoc:nn},this.method==="next"&&(this.arg=S),ce}},C}(u.exports);try{regeneratorRuntime=l}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=l:Function("r","regeneratorRuntime = r")(l)}},function(u,s,r){for(var l=r(155),C=r(82),S=r(38),O=r(16),U=r(42),j=r(96),N=r(19),L=N("iterator"),W=N("toStringTag"),z=j.Array,q={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},I=C(q),Z=0;Z<I.length;Z++){var Y,G=I[Z],oe=q[G],ce=O[G],be=ce&&ce.prototype;if(be&&(be[L]||U(be,L,z),be[W]||U(be,W,G),j[G]=z,oe))for(Y in l)be[Y]||S(be,Y,l[Y],!0)}},function(u,s,r){var l=r(8),C=r(152);l(l.G+l.B,{setImmediate:C.set,clearImmediate:C.clear})},function(u,s,r){var l=r(16),C=r(8),S=r(120),O=[].slice,U=/MSIE .\./.test(S),j=function(N){return function(L,W){var z=arguments.length>2,q=!!z&&O.call(arguments,2);return N(z?function(){(typeof L=="function"?L:Function(L)).apply(this,q)}:L,W)}};C(C.G+C.B+C.F*U,{setTimeout:j(l.setTimeout),setInterval:j(l.setInterval)})},function(u,s,r){r(411),r(410),r(409),u.exports=r(24)},function(u,s,r){var l=r(8),C=r(24),S=r(16),O=r(104),U=r(216);l(l.P+l.R,"Promise",{finally:function(j){var N=O(this,C.Promise||S.Promise),L=typeof j=="function";return this.then(L?function(W){return U(N,j()).then(function(){return W})}:j,L?function(W){return U(N,j()).then(function(){throw W})}:j)}})},function(u,s,r){r(218),r(413),u.exports=r(24).Promise.finally},function(u,s,r){var l=r(8),C=r(210)(!0);l(l.S,"Object",{entries:function(S){return C(S)}})},function(u,s,r){r(415),u.exports=r(24).Object.entries},function(u,s,r){var l=r(8),C=r(210)(!1);l(l.S,"Object",{values:function(S){return C(S)}})},function(u,s,r){r(417),u.exports=r(24).Object.values},function(u,s,r){var l=r(8),C=r(212),S=r(41),O=r(53),U=r(158);l(l.S,"Object",{getOwnPropertyDescriptors:function(j){for(var N,L,W=S(j),z=O.f,q=C(W),I={},Z=0;q.length>Z;)(L=z(W,N=q[Z++]))!==void 0&&U(I,N,L);return I}})},function(u,s,r){r(419),u.exports=r(24).Object.getOwnPropertyDescriptors},function(u,s,r){r(239)("asyncIterator")},function(u,s,r){r(421),u.exports=r(174).f("asyncIterator")},function(u,s,r){r(97)("trimRight",function(l){return function(){return l(this,2)}},"trimEnd")},function(u,s,r){r(423),u.exports=r(24).String.trimRight},function(u,s,r){r(97)("trimLeft",function(l){return function(){return l(this,1)}},"trimStart")},function(u,s,r){r(425),u.exports=r(24).String.trimLeft},function(u,s,r){var l=r(8),C=r(211),S=r(120),O=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(S);l(l.P+l.F*O,"String",{padEnd:function(U){return C(this,U,arguments.length>1?arguments[1]:void 0,!1)}})},function(u,s,r){r(427),u.exports=r(24).String.padEnd},function(u,s,r){var l=r(8),C=r(211),S=r(120),O=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(S);l(l.P+l.F*O,"String",{padStart:function(U){return C(this,U,arguments.length>1?arguments[1]:void 0,!0)}})},function(u,s,r){r(429),u.exports=r(24).String.padStart},function(u,s,r){var l=r(126),C=r(13),S=r(22),O=r(56),U=r(19)("isConcatSpreadable");u.exports=function j(N,L,W,z,q,I,Z,Y){for(var G,oe,ce=q,be=0,Ee=!!Z&&O(Z,Y,3);be<z;){if(be in W){if(G=Ee?Ee(W[be],be,L):W[be],oe=!1,C(G)&&(oe=(oe=G[U])!==void 0?!!oe:l(G)),oe&&I>0)ce=j(N,L,G,S(G.length),ce,I-1)-1;else{if(ce>=9007199254740991)throw TypeError();N[ce]=G}ce++}be++}return ce}},function(u,s,r){var l=r(8),C=r(431),S=r(34),O=r(22),U=r(55),j=r(224);l(l.P,"Array",{flatMap:function(N){var L,W,z=S(this);return U(N),L=O(z.length),W=j(z,0),C(W,z,z,L,0,1,N,arguments[1]),W}}),r(77)("flatMap")},function(u,s,r){r(432),u.exports=r(24).Array.flatMap},function(u,s,r){var l=r(8),C=r(128)(!0);l(l.P,"Array",{includes:function(S){return C(this,S,arguments.length>1?arguments[1]:void 0)}}),r(77)("includes")},function(u,s,r){r(434),u.exports=r(24).Array.includes},function(u,s,r){var l=r(8),C=r(170);C&&l(l.S,"Reflect",{setPrototypeOf:function(S,O){C.check(S,O);try{return C.set(S,O),!0}catch{return!1}}})},function(u,s,r){var l=r(26),C=r(53),S=r(78),O=r(43),U=r(8),j=r(85),N=r(14),L=r(13);U(U.S,"Reflect",{set:function W(z,q,I){var Z,Y,G=arguments.length<4?z:arguments[3],oe=C.f(N(z),q);if(!oe){if(L(Y=S(z)))return W(Y,q,I,G);oe=j(0)}if(O(oe,"value")){if(oe.writable===!1||!L(G))return!1;if(Z=C.f(G,q)){if(Z.get||Z.set||Z.writable===!1)return!1;Z.value=I,l.f(G,q,Z)}else l.f(G,q,j(0,I));return!0}return oe.set!==void 0&&(oe.set.call(G,I),!0)}})},function(u,s,r){var l=r(8),C=r(14),S=Object.preventExtensions;l(l.S,"Reflect",{preventExtensions:function(O){C(O);try{return S&&S(O),!0}catch{return!1}}})},function(u,s,r){var l=r(8);l(l.S,"Reflect",{ownKeys:r(212)})},function(u,s,r){var l=r(8),C=r(14),S=Object.isExtensible;l(l.S,"Reflect",{isExtensible:function(O){return C(O),!S||S(O)}})},function(u,s,r){var l=r(8);l(l.S,"Reflect",{has:function(C,S){return S in C}})},function(u,s,r){var l=r(8),C=r(78),S=r(14);l(l.S,"Reflect",{getPrototypeOf:function(O){return C(S(O))}})},function(u,s,r){var l=r(53),C=r(8),S=r(14);C(C.S,"Reflect",{getOwnPropertyDescriptor:function(O,U){return l.f(S(O),U)}})},function(u,s,r){var l=r(53),C=r(78),S=r(43),O=r(8),U=r(13),j=r(14);O(O.S,"Reflect",{get:function N(L,W){var z,q,I=arguments.length<3?L:arguments[2];return j(L)===I?L[W]:(z=l.f(L,W))?S(z,"value")?z.value:z.get!==void 0?z.get.call(I):void 0:U(q=C(L))?N(q,W,I):void 0}})},function(u,s,r){var l=r(8),C=r(14),S=function(O){this._t=C(O),this._i=0;var U,j=this._k=[];for(U in O)j.push(U)};r(226)(S,"Object",function(){var O,U=this._k;do if(this._i>=U.length)return{value:void 0,done:!0};while(!((O=U[this._i++])in this._t));return{value:O,done:!1}}),l(l.S,"Reflect",{enumerate:function(O){return new S(O)}})},function(u,s,r){var l=r(8),C=r(53).f,S=r(14);l(l.S,"Reflect",{deleteProperty:function(O,U){var j=C(S(O),U);return!(j&&!j.configurable)&&delete O[U]}})},function(u,s,r){var l=r(26),C=r(8),S=r(14),O=r(66);C(C.S+C.F*r(15)(function(){Reflect.defineProperty(l.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(U,j,N){S(U),j=O(j,!0),S(N);try{return l.f(U,j,N),!0}catch{return!1}}})},function(u,s,r){var l=r(8),C=r(80),S=r(55),O=r(14),U=r(13),j=r(15),N=r(233),L=(r(16).Reflect||{}).construct,W=j(function(){function q(){}return!(L(function(){},[],q)instanceof q)}),z=!j(function(){L(function(){})});l(l.S+l.F*(W||z),"Reflect",{construct:function(q,I){S(q),O(I);var Z=arguments.length<3?q:S(arguments[2]);if(z&&!W)return L(q,I,Z);if(q==Z){switch(I.length){case 0:return new q;case 1:return new q(I[0]);case 2:return new q(I[0],I[1]);case 3:return new q(I[0],I[1],I[2]);case 4:return new q(I[0],I[1],I[2],I[3])}var Y=[null];return Y.push.apply(Y,I),new(N.apply(q,Y))}var G=Z.prototype,oe=C(U(G)?G:Object.prototype),ce=Function.apply.call(q,oe,I);return U(ce)?ce:oe}})},function(u,s,r){var l=r(8),C=r(55),S=r(14),O=(r(16).Reflect||{}).apply,U=Function.apply;l(l.S+l.F*!r(15)(function(){O(function(){})}),"Reflect",{apply:function(j,N,L){var W=C(j),z=S(L);return O?O(W,N,z):U.call(W,N,z)}})},function(u,s,r){r(60)("Float64",8,function(l){return function(C,S,O){return l(this,C,S,O)}})},function(u,s,r){r(60)("Float32",4,function(l){return function(C,S,O){return l(this,C,S,O)}})},function(u,s,r){r(60)("Uint32",4,function(l){return function(C,S,O){return l(this,C,S,O)}})},function(u,s,r){r(60)("Int32",4,function(l){return function(C,S,O){return l(this,C,S,O)}})},function(u,s,r){r(60)("Uint16",2,function(l){return function(C,S,O){return l(this,C,S,O)}})},function(u,s,r){r(60)("Int16",2,function(l){return function(C,S,O){return l(this,C,S,O)}})},function(u,s,r){r(60)("Uint8",1,function(l){return function(C,S,O){return l(this,C,S,O)}},!0)},function(u,s,r){r(60)("Uint8",1,function(l){return function(C,S,O){return l(this,C,S,O)}})},function(u,s,r){r(60)("Int8",1,function(l){return function(C,S,O){return l(this,C,S,O)}})},function(u,s,r){var l=r(8);l(l.G+l.W+l.F*!r(118).ABV,{DataView:r(151).DataView})},function(u,s,r){var l=r(8),C=r(118),S=r(151),O=r(14),U=r(81),j=r(22),N=r(13),L=r(16).ArrayBuffer,W=r(104),z=S.ArrayBuffer,q=S.DataView,I=C.ABV&&L.isView,Z=z.prototype.slice,Y=C.VIEW;l(l.G+l.W+l.F*(L!==z),{ArrayBuffer:z}),l(l.S+l.F*!C.CONSTR,"ArrayBuffer",{isView:function(G){return I&&I(G)||N(G)&&Y in G}}),l(l.P+l.U+l.F*r(15)(function(){return!new z(2).slice(1,void 0).byteLength}),"ArrayBuffer",{slice:function(G,oe){if(Z!==void 0&&oe===void 0)return Z.call(O(this),G);for(var ce=O(this).byteLength,be=U(G,ce),Ee=U(oe===void 0?ce:oe,ce),ve=new(W(this,z))(j(Ee-be)),ge=new q(this),Ge=new q(ve),ht=0;be<Ee;)Ge.setUint8(ht++,ge.getUint8(be++));return ve}}),r(95)("ArrayBuffer")},function(u,s,r){var l=r(214),C=r(76);r(119)("WeakSet",function(S){return function(){return S(this,arguments.length>0?arguments[0]:void 0)}},{add:function(S){return l.def(C(this,"WeakSet"),S,!0)}},l,!1,!0)},function(u,s,r){var l,C=r(16),S=r(51)(0),O=r(38),U=r(65),j=r(235),N=r(214),L=r(13),W=r(76),z=r(76),q=!C.ActiveXObject&&"ActiveXObject"in C,I=U.getWeak,Z=Object.isExtensible,Y=N.ufstore,G=function(be){return function(){return be(this,arguments.length>0?arguments[0]:void 0)}},oe={get:function(be){if(L(be)){var Ee=I(be);return Ee===!0?Y(W(this,"WeakMap")).get(be):Ee?Ee[this._i]:void 0}},set:function(be,Ee){return N.def(W(this,"WeakMap"),be,Ee)}},ce=u.exports=r(119)("WeakMap",G,oe,N,!0,!0);z&&q&&(j((l=N.getConstructor(G,"WeakMap")).prototype,oe),U.NEED=!0,S(["delete","has","get","set"],function(be){var Ee=ce.prototype,ve=Ee[be];O(Ee,be,function(ge,Ge){if(L(ge)&&!Z(ge)){this._f||(this._f=new l);var ht=this._f[be](ge,Ge);return be=="set"?this:ht}return ve.call(this,ge,Ge)})}))},function(u,s,r){var l=r(215),C=r(76);u.exports=r(119)("Set",function(S){return function(){return S(this,arguments.length>0?arguments[0]:void 0)}},{add:function(S){return l.def(C(this,"Set"),S=S===0?0:S,S)}},l)},function(u,s,r){var l=r(215),C=r(76);u.exports=r(119)("Map",function(S){return function(){return S(this,arguments.length>0?arguments[0]:void 0)}},{get:function(S){var O=l.getEntry(C(this,"Map"),S);return O&&O.v},set:function(S,O){return l.def(C(this,"Map"),S===0?0:S,O)}},l,!0)},function(u,s){u.exports=function(r){try{return{e:!1,v:r()}}catch(l){return{e:!0,v:l}}}},function(u,s,r){var l=r(16),C=r(152).set,S=l.MutationObserver||l.WebKitMutationObserver,O=l.process,U=l.Promise,j=r(62)(O)=="process";u.exports=function(){var N,L,W,z=function(){var Y,G;for(j&&(Y=O.domain)&&Y.exit();N;){G=N.fn,N=N.next;try{G()}catch(oe){throw N?W():L=void 0,oe}}L=void 0,Y&&Y.enter()};if(j)W=function(){O.nextTick(z)};else if(!S||l.navigator&&l.navigator.standalone)if(U&&U.resolve){var q=U.resolve(void 0);W=function(){q.then(z)}}else W=function(){C.call(l,z)};else{var I=!0,Z=document.createTextNode("");new S(z).observe(Z,{characterData:!0}),W=function(){Z.data=I=!I}}return function(Y){var G={fn:Y,next:void 0};L&&(L.next=G),N||(N=G,W()),L=G}}},function(u,s,r){var l=r(161),C=r(14),S=r(104),O=r(153),U=r(22),j=r(123),N=r(154),L=r(15),W=Math.min,z=[].push,q=!L(function(){});r(122)("split",2,function(I,Z,Y,G){var oe;return oe="abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||".".split(/()()/).length>1||"".split(/.?/).length?function(ce,be){var Ee=String(this);if(ce===void 0&&be===0)return[];if(!l(ce))return Y.call(Ee,ce,be);for(var ve,ge,Ge,ht=[],It=(ce.ignoreCase?"i":"")+(ce.multiline?"m":"")+(ce.unicode?"u":"")+(ce.sticky?"y":""),St=0,we=be===void 0?4294967295:be>>>0,bt=new RegExp(ce.source,It+"g");(ve=N.call(bt,Ee))&&!((ge=bt.lastIndex)>St&&(ht.push(Ee.slice(St,ve.index)),ve.length>1&&ve.index<Ee.length&&z.apply(ht,ve.slice(1)),Ge=ve[0].length,St=ge,ht.length>=we));)bt.lastIndex===ve.index&&bt.lastIndex++;return St===Ee.length?!Ge&&bt.test("")||ht.push(""):ht.push(Ee.slice(St)),ht.length>we?ht.slice(0,we):ht}:"0".split(void 0,0).length?function(ce,be){return ce===void 0&&be===0?[]:Y.call(this,ce,be)}:Y,[function(ce,be){var Ee=I(this),ve=ce==null?void 0:ce[Z];return ve!==void 0?ve.call(ce,Ee,be):oe.call(String(Ee),ce,be)},function(ce,be){var Ee=G(oe,ce,this,be,oe!==Y);if(Ee.done)return Ee.value;var ve=C(ce),ge=String(this),Ge=S(ve,RegExp),ht=ve.unicode,It=(ve.ignoreCase?"i":"")+(ve.multiline?"m":"")+(ve.unicode?"u":"")+(q?"y":"g"),St=new Ge(q?ve:"^(?:"+ve.source+")",It),we=be===void 0?4294967295:be>>>0;if(we===0)return[];if(ge.length===0)return j(St,ge)===null?[ge]:[];for(var bt=0,jt=0,Mt=[];jt<ge.length;){St.lastIndex=q?jt:0;var ze,Ut=j(St,q?ge:ge.slice(jt));if(Ut===null||(ze=W(U(St.lastIndex+(q?0:jt)),ge.length))===bt)jt=O(ge,jt,ht);else{if(Mt.push(ge.slice(bt,jt)),Mt.length===we)return Mt;for(var Ft=1;Ft<=Ut.length-1;Ft++)if(Mt.push(Ut[Ft]),Mt.length===we)return Mt;jt=bt=ze}}return Mt.push(ge.slice(bt)),Mt}]})},function(u,s,r){var l=r(14),C=r(234),S=r(123);r(122)("search",1,function(O,U,j,N){return[function(L){var W=O(this),z=L==null?void 0:L[U];return z!==void 0?z.call(L,W):new RegExp(L)[U](String(W))},function(L){var W=N(j,L,this);if(W.done)return W.value;var z=l(L),q=String(this),I=z.lastIndex;C(I,0)||(z.lastIndex=0);var Z=S(z,q);return C(z.lastIndex,I)||(z.lastIndex=I),Z===null?-1:Z.index}]})},function(u,s,r){var l=r(14),C=r(34),S=r(22),O=r(54),U=r(153),j=r(123),N=Math.max,L=Math.min,W=Math.floor,z=/\$([$&`']|\d\d?|<[^>]*>)/g,q=/\$([$&`']|\d\d?)/g,I=function(Z){return Z===void 0?Z:String(Z)};r(122)("replace",2,function(Z,Y,G,oe){return[function(be,Ee){var ve=Z(this),ge=be==null?void 0:be[Y];return ge!==void 0?ge.call(be,ve,Ee):G.call(String(ve),be,Ee)},function(be,Ee){var ve=oe(G,be,this,Ee);if(ve.done)return ve.value;var ge=l(be),Ge=String(this),ht=typeof Ee=="function";ht||(Ee=String(Ee));var It=ge.global;if(It){var St=ge.unicode;ge.lastIndex=0}for(var we=[];;){var bt=j(ge,Ge);if(bt===null||(we.push(bt),!It))break;String(bt[0])===""&&(ge.lastIndex=U(Ge,S(ge.lastIndex),St))}for(var jt="",Mt=0,ze=0;ze<we.length;ze++){bt=we[ze];for(var Ut=String(bt[0]),Ft=N(L(O(bt.index),Ge.length),0),pt=[],yt=1;yt<bt.length;yt++)pt.push(I(bt[yt]));var nn=bt.groups;if(ht){var xt=[Ut].concat(pt,Ft,Ge);nn!==void 0&&xt.push(nn);var _t=String(Ee.apply(void 0,xt))}else _t=ce(Ut,Ge,Ft,pt,nn,Ee);Ft>=Mt&&(jt+=Ge.slice(Mt,Ft)+_t,Mt=Ft+Ut.length)}return jt+Ge.slice(Mt)}];function ce(be,Ee,ve,ge,Ge,ht){var It=ve+be.length,St=ge.length,we=q;return Ge!==void 0&&(Ge=C(Ge),we=z),G.call(ht,we,function(bt,jt){var Mt;switch(jt.charAt(0)){case"$":return"$";case"&":return be;case"`":return Ee.slice(0,ve);case"'":return Ee.slice(It);case"<":Mt=Ge[jt.slice(1,-1)];break;default:var ze=+jt;if(ze===0)return bt;if(ze>St){var Ut=W(ze/10);return Ut===0?bt:Ut<=St?ge[Ut-1]===void 0?jt.charAt(1):ge[Ut-1]+jt.charAt(1):bt}Mt=ge[ze-1]}return Mt===void 0?"":Mt})}})},function(u,s,r){var l=r(14),C=r(22),S=r(153),O=r(123);r(122)("match",1,function(U,j,N,L){return[function(W){var z=U(this),q=W==null?void 0:W[j];return q!==void 0?q.call(W,z):new RegExp(W)[j](String(z))},function(W){var z=L(N,W,this);if(z.done)return z.value;var q=l(W),I=String(this);if(!q.global)return O(q,I);var Z=q.unicode;q.lastIndex=0;for(var Y,G=[],oe=0;(Y=O(q,I))!==null;){var ce=String(Y[0]);G[oe]=ce,ce===""&&(q.lastIndex=S(I,C(q.lastIndex),Z)),oe++}return oe===0?null:G}]})},function(u,s,r){r(219);var l=r(14),C=r(124),S=r(27),O=/./.toString,U=function(j){r(38)(RegExp.prototype,"toString",j,!0)};r(15)(function(){return O.call({source:"a",flags:"b"})!="/a/b"})?U(function(){var j=l(this);return"/".concat(j.source,"/","flags"in j?j.flags:!S&&j instanceof RegExp?C.call(j):void 0)}):O.name!="toString"&&U(function(){return O.call(this)})},function(u,s,r){var l=r(16),C=r(168),S=r(26).f,O=r(79).f,U=r(161),j=r(124),N=l.RegExp,L=N,W=N.prototype,z=/a/g,q=/a/g,I=new N(z)!==z;if(r(27)&&(!I||r(15)(function(){return q[r(19)("match")]=!1,N(z)!=z||N(q)==q||N(z,"i")!="/a/i"}))){N=function(oe,ce){var be=this instanceof N,Ee=U(oe),ve=ce===void 0;return!be&&Ee&&oe.constructor===N&&ve?oe:C(I?new L(Ee&&!ve?oe.source:oe,ce):L((Ee=oe instanceof N)?oe.source:oe,Ee&&ve?j.call(oe):ce),be?this:W,N)};for(var Z=function(oe){oe in N||S(N,oe,{configurable:!0,get:function(){return L[oe]},set:function(ce){L[oe]=ce}})},Y=O(L),G=0;Y.length>G;)Z(Y[G++]);W.constructor=N,N.prototype=W,r(38)(l,"RegExp",N)}r(95)("RegExp")},function(u,s,r){r(95)("Array")},function(u,s,r){var l=r(8),C=r(51)(6),S="findIndex",O=!0;S in[]&&Array(1)[S](function(){O=!1}),l(l.P+l.F*O,"Array",{findIndex:function(U){return C(this,U,arguments.length>1?arguments[1]:void 0)}}),r(77)(S)},function(u,s,r){var l=r(8),C=r(51)(5),S=!0;"find"in[]&&Array(1).find(function(){S=!1}),l(l.P+l.F*S,"Array",{find:function(O){return C(this,O,arguments.length>1?arguments[1]:void 0)}}),r(77)("find")},function(u,s,r){var l=r(8);l(l.P,"Array",{fill:r(156)}),r(77)("fill")},function(u,s,r){var l=r(8);l(l.P,"Array",{copyWithin:r(222)}),r(77)("copyWithin")},function(u,s,r){var l=r(8),C=r(41),S=r(54),O=r(22),U=[].lastIndexOf,j=!!U&&1/[1].lastIndexOf(1,-0)<0;l(l.P+l.F*(j||!r(49)(U)),"Array",{lastIndexOf:function(N){if(j)return U.apply(this,arguments)||0;var L=C(this),W=O(L.length),z=W-1;for(arguments.length>1&&(z=Math.min(z,S(arguments[1]))),z<0&&(z=W+z);z>=0;z--)if(z in L&&L[z]===N)return z||0;return-1}})},function(u,s,r){var l=r(8),C=r(128)(!1),S=[].indexOf,O=!!S&&1/[1].indexOf(1,-0)<0;l(l.P+l.F*(O||!r(49)(S)),"Array",{indexOf:function(U){return O?S.apply(this,arguments)||0:C(this,U,arguments[1])}})},function(u,s,r){var l=r(8),C=r(223);l(l.P+l.F*!r(49)([].reduceRight,!0),"Array",{reduceRight:function(S){return C(this,S,arguments.length,arguments[1],!0)}})},function(u,s,r){var l=r(8),C=r(223);l(l.P+l.F*!r(49)([].reduce,!0),"Array",{reduce:function(S){return C(this,S,arguments.length,arguments[1],!1)}})},function(u,s,r){var l=r(8),C=r(51)(4);l(l.P+l.F*!r(49)([].every,!0),"Array",{every:function(S){return C(this,S,arguments[1])}})},function(u,s,r){var l=r(8),C=r(51)(3);l(l.P+l.F*!r(49)([].some,!0),"Array",{some:function(S){return C(this,S,arguments[1])}})},function(u,s,r){var l=r(8),C=r(51)(2);l(l.P+l.F*!r(49)([].filter,!0),"Array",{filter:function(S){return C(this,S,arguments[1])}})},function(u,s,r){var l=r(8),C=r(51)(1);l(l.P+l.F*!r(49)([].map,!0),"Array",{map:function(S){return C(this,S,arguments[1])}})},function(u,s,r){var l=r(13),C=r(126),S=r(19)("species");u.exports=function(O){var U;return C(O)&&(typeof(U=O.constructor)!="function"||U!==Array&&!C(U.prototype)||(U=void 0),l(U)&&(U=U[S])===null&&(U=void 0)),U===void 0?Array:U}},function(u,s,r){var l=r(8),C=r(51)(0),S=r(49)([].forEach,!0);l(l.P+l.F*!S,"Array",{forEach:function(O){return C(this,O,arguments[1])}})},function(u,s,r){var l=r(8),C=r(55),S=r(34),O=r(15),U=[].sort,j=[1,2,3];l(l.P+l.F*(O(function(){j.sort(void 0)})||!O(function(){j.sort(null)})||!r(49)(U)),"Array",{sort:function(N){return N===void 0?U.call(S(this)):U.call(S(this),C(N))}})},function(u,s,r){var l=r(8),C=r(171),S=r(62),O=r(81),U=r(22),j=[].slice;l(l.P+l.F*r(15)(function(){C&&j.call(C)}),"Array",{slice:function(N,L){var W=U(this.length),z=S(this);if(L=L===void 0?W:L,z=="Array")return j.call(this,N,L);for(var q=O(N,W),I=O(L,W),Z=U(I-q),Y=new Array(Z),G=0;G<Z;G++)Y[G]=z=="String"?this.charAt(q+G):this[q+G];return Y}})},function(u,s,r){var l=r(8),C=r(41),S=[].join;l(l.P+l.F*(r(107)!=Object||!r(49)(S)),"Array",{join:function(O){return S.call(C(this),O===void 0?",":O)}})},function(u,s,r){var l=r(8),C=r(158);l(l.S+l.F*r(15)(function(){function S(){}return!(Array.of.call(S)instanceof S)}),"Array",{of:function(){for(var S=0,O=arguments.length,U=new(typeof this=="function"?this:Array)(O);O>S;)C(U,S,arguments[S++]);return U.length=O,U}})},function(u,s,r){var l=r(56),C=r(8),S=r(34),O=r(225),U=r(159),j=r(22),N=r(158),L=r(157);C(C.S+C.F*!r(125)(function(W){Array.from(W)}),"Array",{from:function(W){var z,q,I,Z,Y=S(W),G=typeof this=="function"?this:Array,oe=arguments.length,ce=oe>1?arguments[1]:void 0,be=ce!==void 0,Ee=0,ve=L(Y);if(be&&(ce=l(ce,oe>2?arguments[2]:void 0,2)),ve==null||G==Array&&U(ve))for(q=new G(z=j(Y.length));z>Ee;Ee++)N(q,Ee,be?ce(Y[Ee],Ee):Y[Ee]);else for(Z=ve.call(Y),q=new G;!(I=Z.next()).done;Ee++)N(q,Ee,be?O(Z,ce,[I.value,Ee],!0):I.value);return q.length=Ee,q}})},function(u,s,r){var l=r(8);l(l.S,"Array",{isArray:r(126)})},function(u,s,r){var l=r(14),C=r(66);u.exports=function(S){if(S!=="string"&&S!=="number"&&S!=="default")throw TypeError("Incorrect hint");return C(l(this),S!="number")}},function(u,s,r){var l=r(19)("toPrimitive"),C=Date.prototype;l in C||r(42)(C,l,r(494))},function(u,s,r){var l=Date.prototype,C=l.toString,S=l.getTime;new Date(NaN)+""!="Invalid Date"&&r(38)(l,"toString",function(){var O=S.call(this);return O==O?C.call(this):"Invalid Date"})},function(u,s,r){var l=r(15),C=Date.prototype.getTime,S=Date.prototype.toISOString,O=function(U){return U>9?U:"0"+U};u.exports=l(function(){return S.call(new Date(-5e13-1))!="0385-07-25T07:06:39.999Z"})||!l(function(){S.call(new Date(NaN))})?function(){if(!isFinite(C.call(this)))throw RangeError("Invalid time value");var U=this,j=U.getUTCFullYear(),N=U.getUTCMilliseconds(),L=j<0?"-":j>9999?"+":"";return L+("00000"+Math.abs(j)).slice(L?-6:-4)+"-"+O(U.getUTCMonth()+1)+"-"+O(U.getUTCDate())+"T"+O(U.getUTCHours())+":"+O(U.getUTCMinutes())+":"+O(U.getUTCSeconds())+"."+(N>99?N:"0"+O(N))+"Z"}:S},function(u,s,r){var l=r(8),C=r(497);l(l.P+l.F*(Date.prototype.toISOString!==C),"Date",{toISOString:C})},function(u,s,r){var l=r(8),C=r(34),S=r(66);l(l.P+l.F*r(15)(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1}),"Date",{toJSON:function(O){var U=C(this),j=S(U);return typeof j!="number"||isFinite(j)?U.toISOString():null}})},function(u,s,r){var l=r(8);l(l.S,"Date",{now:function(){return new Date().getTime()}})},function(u,s,r){r(37)("sup",function(l){return function(){return l(this,"sup","","")}})},function(u,s,r){r(37)("sub",function(l){return function(){return l(this,"sub","","")}})},function(u,s,r){r(37)("strike",function(l){return function(){return l(this,"strike","","")}})},function(u,s,r){r(37)("small",function(l){return function(){return l(this,"small","","")}})},function(u,s,r){r(37)("link",function(l){return function(C){return l(this,"a","href",C)}})},function(u,s,r){r(37)("italics",function(l){return function(){return l(this,"i","","")}})},function(u,s,r){r(37)("fontsize",function(l){return function(C){return l(this,"font","size",C)}})},function(u,s,r){r(37)("fontcolor",function(l){return function(C){return l(this,"font","color",C)}})},function(u,s,r){r(37)("fixed",function(l){return function(){return l(this,"tt","","")}})},function(u,s,r){r(37)("bold",function(l){return function(){return l(this,"b","","")}})},function(u,s,r){r(37)("blink",function(l){return function(){return l(this,"blink","","")}})},function(u,s,r){r(37)("big",function(l){return function(){return l(this,"big","","")}})},function(u,s,r){r(37)("anchor",function(l){return function(C){return l(this,"a","name",C)}})},function(u,s,r){var l=r(8),C=r(22),S=r(162),O="".startsWith;l(l.P+l.F*r(160)("startsWith"),"String",{startsWith:function(U){var j=S(this,U,"startsWith"),N=C(Math.min(arguments.length>1?arguments[1]:void 0,j.length)),L=String(U);return O?O.call(j,L,N):j.slice(N,N+L.length)===L}})},function(u,s,r){var l=r(8);l(l.P,"String",{repeat:r(167)})},function(u,s,r){var l=r(8),C=r(162);l(l.P+l.F*r(160)("includes"),"String",{includes:function(S){return!!~C(this,S,"includes").indexOf(S,arguments.length>1?arguments[1]:void 0)}})},function(u,s,r){var l=r(8),C=r(22),S=r(162),O="".endsWith;l(l.P+l.F*r(160)("endsWith"),"String",{endsWith:function(U){var j=S(this,U,"endsWith"),N=arguments.length>1?arguments[1]:void 0,L=C(j.length),W=N===void 0?L:Math.min(C(N),L),z=String(U);return O?O.call(j,z,W):j.slice(W-z.length,W)===z}})},function(u,s,r){var l=r(8),C=r(164)(!1);l(l.P,"String",{codePointAt:function(S){return C(this,S)}})},function(u,s,r){var l=r(164)(!0);r(163)(String,"String",function(C){this._t=String(C),this._i=0},function(){var C,S=this._t,O=this._i;return O>=S.length?{value:void 0,done:!0}:(C=l(S,O),this._i+=C.length,{value:C,done:!1})})},function(u,s,r){r(97)("trim",function(l){return function(){return l(this,3)}})},function(u,s,r){var l=r(8),C=r(41),S=r(22);l(l.S,"String",{raw:function(O){for(var U=C(O.raw),j=S(U.length),N=arguments.length,L=[],W=0;j>W;)L.push(String(U[W++])),W<N&&L.push(String(arguments[W]));return L.join("")}})},function(u,s,r){var l=r(8),C=r(81),S=String.fromCharCode,O=String.fromCodePoint;l(l.S+l.F*(!!O&&O.length!=1),"String",{fromCodePoint:function(U){for(var j,N=[],L=arguments.length,W=0;L>W;){if(j=+arguments[W++],C(j,1114111)!==j)throw RangeError(j+" is not a valid code point");N.push(j<65536?S(j):S(55296+((j-=65536)>>10),j%1024+56320))}return N.join("")}})},function(u,s,r){var l=r(8);l(l.S,"Math",{trunc:function(C){return(C>0?Math.floor:Math.ceil)(C)}})},function(u,s,r){var l=r(8),C=r(165),S=Math.exp;l(l.S,"Math",{tanh:function(O){var U=C(O=+O),j=C(-O);return U==1/0?1:j==1/0?-1:(U-j)/(S(O)+S(-O))}})},function(u,s,r){var l=r(8),C=r(165),S=Math.exp;l(l.S+l.F*r(15)(function(){return!Math.sinh(-2e-17)!=-2e-17}),"Math",{sinh:function(O){return Math.abs(O=+O)<1?(C(O)-C(-O))/2:(S(O-1)-S(-O-1))*(Math.E/2)}})},function(u,s,r){var l=r(8);l(l.S,"Math",{sign:r(166)})},function(u,s,r){var l=r(8);l(l.S,"Math",{log2:function(C){return Math.log(C)/Math.LN2}})},function(u,s,r){var l=r(8);l(l.S,"Math",{log1p:r(227)})},function(u,s,r){var l=r(8);l(l.S,"Math",{log10:function(C){return Math.log(C)*Math.LOG10E}})},function(u,s,r){var l=r(8),C=Math.imul;l(l.S+l.F*r(15)(function(){return C(4294967295,5)!=-5||C.length!=2}),"Math",{imul:function(S,O){var U=+S,j=+O,N=65535&U,L=65535&j;return 0|N*L+((65535&U>>>16)*L+N*(65535&j>>>16)<<16>>>0)}})},function(u,s,r){var l=r(8),C=Math.abs;l(l.S,"Math",{hypot:function(S,O){for(var U,j,N=0,L=0,W=arguments.length,z=0;L<W;)z<(U=C(arguments[L++]))?(N=N*(j=z/U)*j+1,z=U):N+=U>0?(j=U/z)*j:U;return z===1/0?1/0:z*Math.sqrt(N)}})},function(u,s,r){var l=r(166),C=Math.pow,S=C(2,-52),O=C(2,-23),U=C(2,127)*(2-O),j=C(2,-126);u.exports=Math.fround||function(N){var L,W,z=Math.abs(N),q=l(N);return z<j?q*function(I){return I+1/S-1/S}(z/j/O)*j*O:(W=(L=(1+O/S)*z)-(L-z))>U||W!=W?q*(1/0):q*W}},function(u,s,r){var l=r(8);l(l.S,"Math",{fround:r(532)})},function(u,s,r){var l=r(8),C=r(165);l(l.S+l.F*(C!=Math.expm1),"Math",{expm1:C})},function(u,s,r){var l=r(8),C=Math.exp;l(l.S,"Math",{cosh:function(S){return(C(S=+S)+C(-S))/2}})},function(u,s,r){var l=r(8);l(l.S,"Math",{clz32:function(C){return(C>>>=0)?31-Math.floor(Math.log(C+.5)*Math.LOG2E):32}})},function(u,s,r){var l=r(8),C=r(166);l(l.S,"Math",{cbrt:function(S){return C(S=+S)*Math.pow(Math.abs(S),1/3)}})},function(u,s,r){var l=r(8),C=Math.atanh;l(l.S+l.F*!(C&&1/C(-0)<0),"Math",{atanh:function(S){return(S=+S)==0?S:Math.log((1+S)/(1-S))/2}})},function(u,s,r){var l=r(8),C=Math.asinh;l(l.S+l.F*!(C&&1/C(0)>0),"Math",{asinh:function S(O){return isFinite(O=+O)&&O!=0?O<0?-S(-O):Math.log(O+Math.sqrt(O*O+1)):O}})},function(u,s,r){var l=r(8),C=r(227),S=Math.sqrt,O=Math.acosh;l(l.S+l.F*!(O&&Math.floor(O(Number.MAX_VALUE))==710&&O(1/0)==1/0),"Math",{acosh:function(U){return(U=+U)<1?NaN:U>9490626562425156e-8?Math.log(U)+Math.LN2:C(U-1+S(U-1)*S(U+1))}})},function(u,s,r){var l=r(8),C=r(231);l(l.S+l.F*(Number.parseInt!=C),"Number",{parseInt:C})},function(u,s,r){var l=r(8),C=r(230);l(l.S+l.F*(Number.parseFloat!=C),"Number",{parseFloat:C})},function(u,s,r){var l=r(8);l(l.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(u,s,r){var l=r(8);l(l.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(u,s,r){var l=r(8),C=r(228),S=Math.abs;l(l.S,"Number",{isSafeInteger:function(O){return C(O)&&S(O)<=9007199254740991}})},function(u,s,r){var l=r(8);l(l.S,"Number",{isNaN:function(C){return C!=C}})},function(u,s,r){var l=r(8);l(l.S,"Number",{isInteger:r(228)})},function(u,s,r){var l=r(8),C=r(16).isFinite;l(l.S,"Number",{isFinite:function(S){return typeof S=="number"&&C(S)}})},function(u,s,r){var l=r(8);l(l.S,"Number",{EPSILON:Math.pow(2,-52)})},function(u,s,r){var l=r(8),C=r(15),S=r(229),O=1 .toPrecision;l(l.P+l.F*(C(function(){return O.call(1,void 0)!=="1"})||!C(function(){O.call({})})),"Number",{toPrecision:function(U){var j=S(this,"Number#toPrecision: incorrect invocation!");return U===void 0?O.call(j):O.call(j,U)}})},function(u,s,r){var l=r(8),C=r(54),S=r(229),O=r(167),U=1 .toFixed,j=Math.floor,N=[0,0,0,0,0,0],L="Number.toFixed: incorrect invocation!",W=function(Z,Y){for(var G=-1,oe=Y;++G<6;)oe+=Z*N[G],N[G]=oe%1e7,oe=j(oe/1e7)},z=function(Z){for(var Y=6,G=0;--Y>=0;)G+=N[Y],N[Y]=j(G/Z),G=G%Z*1e7},q=function(){for(var Z=6,Y="";--Z>=0;)if(Y!==""||Z===0||N[Z]!==0){var G=String(N[Z]);Y=Y===""?G:Y+O.call("0",7-G.length)+G}return Y},I=function(Z,Y,G){return Y===0?G:Y%2==1?I(Z,Y-1,G*Z):I(Z*Z,Y/2,G)};l(l.P+l.F*(!!U&&(8e-5 .toFixed(3)!=="0.000"||.9 .toFixed(0)!=="1"||1.255 .toFixed(2)!=="1.25"||0xde0b6b3a7640080 .toFixed(0)!=="1000000000000000128")||!r(15)(function(){U.call({})})),"Number",{toFixed:function(Z){var Y,G,oe,ce,be=S(this,L),Ee=C(Z),ve="",ge="0";if(Ee<0||Ee>20)throw RangeError(L);if(be!=be)return"NaN";if(be<=-1e21||be>=1e21)return String(be);if(be<0&&(ve="-",be=-be),be>1e-21)if(G=(Y=function(Ge){for(var ht=0,It=Ge;It>=4096;)ht+=12,It/=4096;for(;It>=2;)ht+=1,It/=2;return ht}(be*I(2,69,1))-69)<0?be*I(2,-Y,1):be/I(2,Y,1),G*=4503599627370496,(Y=52-Y)>0){for(W(0,G),oe=Ee;oe>=7;)W(1e7,0),oe-=7;for(W(I(10,oe,1),0),oe=Y-1;oe>=23;)z(1<<23),oe-=23;z(1<<oe),W(1,1),z(2),ge=q()}else W(0,G),W(1<<-Y,0),ge=q()+O.call("0",Ee);return ge=Ee>0?ve+((ce=ge.length)<=Ee?"0."+O.call("0",Ee-ce)+ge:ge.slice(0,ce-Ee)+"."+ge.slice(ce-Ee)):ve+ge}})},function(u,s,r){var l=r(16),C=r(43),S=r(62),O=r(168),U=r(66),j=r(15),N=r(79).f,L=r(53).f,W=r(26).f,z=r(97).trim,q=l.Number,I=q,Z=q.prototype,Y=S(r(80)(Z))=="Number",G="trim"in String.prototype,oe=function(ve){var ge=U(ve,!1);if(typeof ge=="string"&&ge.length>2){var Ge,ht,It,St=(ge=G?ge.trim():z(ge,3)).charCodeAt(0);if(St===43||St===45){if((Ge=ge.charCodeAt(2))===88||Ge===120)return NaN}else if(St===48){switch(ge.charCodeAt(1)){case 66:case 98:ht=2,It=49;break;case 79:case 111:ht=8,It=55;break;default:return+ge}for(var we,bt=ge.slice(2),jt=0,Mt=bt.length;jt<Mt;jt++)if((we=bt.charCodeAt(jt))<48||we>It)return NaN;return parseInt(bt,ht)}}return+ge};if(!q(" 0o1")||!q("0b1")||q("+0x1")){q=function(ve){var ge=arguments.length<1?0:ve,Ge=this;return Ge instanceof q&&(Y?j(function(){Z.valueOf.call(Ge)}):S(Ge)!="Number")?O(new I(oe(ge)),Ge,q):oe(ge)};for(var ce,be=r(27)?N(I):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),Ee=0;be.length>Ee;Ee++)C(I,ce=be[Ee])&&!C(q,ce)&&W(q,ce,L(I,ce));q.prototype=Z,Z.constructor=q,r(38)(l,"Number",q)}},function(u,s,r){var l=r(8),C=r(230);l(l.G+l.F*(parseFloat!=C),{parseFloat:C})},function(u,s,r){var l=r(8),C=r(231);l(l.G+l.F*(parseInt!=C),{parseInt:C})},function(u,s,r){var l=r(13),C=r(78),S=r(19)("hasInstance"),O=Function.prototype;S in O||r(26).f(O,S,{value:function(U){if(typeof this!="function"||!l(U))return!1;if(!l(this.prototype))return U instanceof this;for(;U=C(U);)if(this.prototype===U)return!0;return!1}})},function(u,s,r){var l=r(26).f,C=Function.prototype,S=/^\s*function ([^ (]*)/;"name"in C||r(27)&&l(C,"name",{configurable:!0,get:function(){try{return(""+this).match(S)[1]}catch{return""}}})},function(u,s,r){var l=r(8);l(l.P,"Function",{bind:r(233)})},function(u,s,r){var l=r(105),C={};C[r(19)("toStringTag")]="z",C+""!="[object z]"&&r(38)(Object.prototype,"toString",function(){return"[object "+l(this)+"]"},!0)},function(u,s,r){var l=r(8);l(l.S,"Object",{setPrototypeOf:r(170).set})},function(u,s,r){var l=r(8);l(l.S,"Object",{is:r(234)})},function(u,s,r){var l=r(8);l(l.S+l.F,"Object",{assign:r(235)})},function(u,s,r){var l=r(13);r(52)("isExtensible",function(C){return function(S){return!!l(S)&&(!C||C(S))}})},function(u,s,r){var l=r(13);r(52)("isSealed",function(C){return function(S){return!l(S)||!!C&&C(S)}})},function(u,s,r){var l=r(13);r(52)("isFrozen",function(C){return function(S){return!l(S)||!!C&&C(S)}})},function(u,s,r){var l=r(13),C=r(65).onFreeze;r(52)("preventExtensions",function(S){return function(O){return S&&l(O)?S(C(O)):O}})},function(u,s,r){var l=r(13),C=r(65).onFreeze;r(52)("seal",function(S){return function(O){return S&&l(O)?S(C(O)):O}})},function(u,s,r){var l=r(13),C=r(65).onFreeze;r(52)("freeze",function(S){return function(O){return S&&l(O)?S(C(O)):O}})},function(u,s,r){r(52)("getOwnPropertyNames",function(){return r(236).f})},function(u,s,r){var l=r(34),C=r(82);r(52)("keys",function(){return function(S){return C(l(S))}})},function(u,s,r){var l=r(34),C=r(78);r(52)("getPrototypeOf",function(){return function(S){return C(l(S))}})},function(u,s,r){var l=r(41),C=r(53).f;r(52)("getOwnPropertyDescriptor",function(){return function(S,O){return C(l(S),O)}})},function(u,s,r){var l=r(8);l(l.S+l.F*!r(27),"Object",{defineProperties:r(237)})},function(u,s,r){var l=r(8);l(l.S+l.F*!r(27),"Object",{defineProperty:r(26).f})},function(u,s,r){var l=r(8);l(l.S,"Object",{create:r(80)})},function(u,s,r){var l=r(82),C=r(127),S=r(106);u.exports=function(O){var U=l(O),j=C.f;if(j)for(var N,L=j(O),W=S.f,z=0;L.length>z;)W.call(O,N=L[z++])&&U.push(N);return U}},function(u,s,r){u.exports=r(129)("native-function-to-string",Function.toString)},function(u,s,r){var l=r(16),C=r(43),S=r(27),O=r(8),U=r(38),j=r(65).KEY,N=r(15),L=r(129),W=r(98),z=r(84),q=r(19),I=r(174),Z=r(239),Y=r(575),G=r(126),oe=r(14),ce=r(13),be=r(34),Ee=r(41),ve=r(66),ge=r(85),Ge=r(80),ht=r(236),It=r(53),St=r(127),we=r(26),bt=r(82),jt=It.f,Mt=we.f,ze=ht.f,Ut=l.Symbol,Ft=l.JSON,pt=Ft&&Ft.stringify,yt=q("_hidden"),nn=q("toPrimitive"),xt={}.propertyIsEnumerable,_t=L("symbol-registry"),Yt=L("symbols"),Fn=L("op-symbols"),Rn=Object.prototype,cn=typeof Ut=="function"&&!!St.f,qe=l.QObject,Qe=!qe||!qe.prototype||!qe.prototype.findChild,$e=S&&N(function(){return Ge(Mt({},"a",{get:function(){return Mt(this,"a",{value:7}).a}})).a!=7})?function(Wt,Zt,Vn){var xn=jt(Rn,Zt);xn&&delete Rn[Zt],Mt(Wt,Zt,Vn),xn&&Wt!==Rn&&Mt(Rn,Zt,xn)}:Mt,ft=function(Wt){var Zt=Yt[Wt]=Ge(Ut.prototype);return Zt._k=Wt,Zt},Jt=cn&&typeof Ut.iterator=="symbol"?function(Wt){return typeof Wt=="symbol"}:function(Wt){return Wt instanceof Ut},Qt=function(Wt,Zt,Vn){return Wt===Rn&&Qt(Fn,Zt,Vn),oe(Wt),Zt=ve(Zt,!0),oe(Vn),C(Yt,Zt)?(Vn.enumerable?(C(Wt,yt)&&Wt[yt][Zt]&&(Wt[yt][Zt]=!1),Vn=Ge(Vn,{enumerable:ge(0,!1)})):(C(Wt,yt)||Mt(Wt,yt,ge(1,{})),Wt[yt][Zt]=!0),$e(Wt,Zt,Vn)):Mt(Wt,Zt,Vn)},Pn=function(Wt,Zt){oe(Wt);for(var Vn,xn=Y(Zt=Ee(Zt)),Un=0,ur=xn.length;ur>Un;)Qt(Wt,Vn=xn[Un++],Zt[Vn]);return Wt},kn=function(Wt){var Zt=xt.call(this,Wt=ve(Wt,!0));return!(this===Rn&&C(Yt,Wt)&&!C(Fn,Wt))&&(!(Zt||!C(this,Wt)||!C(Yt,Wt)||C(this,yt)&&this[yt][Wt])||Zt)},Qn=function(Wt,Zt){if(Wt=Ee(Wt),Zt=ve(Zt,!0),Wt!==Rn||!C(Yt,Zt)||C(Fn,Zt)){var Vn=jt(Wt,Zt);return!Vn||!C(Yt,Zt)||C(Wt,yt)&&Wt[yt][Zt]||(Vn.enumerable=!0),Vn}},ke=function(Wt){for(var Zt,Vn=ze(Ee(Wt)),xn=[],Un=0;Vn.length>Un;)C(Yt,Zt=Vn[Un++])||Zt==yt||Zt==j||xn.push(Zt);return xn},ar=function(Wt){for(var Zt,Vn=Wt===Rn,xn=ze(Vn?Fn:Ee(Wt)),Un=[],ur=0;xn.length>ur;)!C(Yt,Zt=xn[ur++])||Vn&&!C(Rn,Zt)||Un.push(Yt[Zt]);return Un};cn||(U((Ut=function(){if(this instanceof Ut)throw TypeError("Symbol is not a constructor!");var Wt=z(arguments.length>0?arguments[0]:void 0),Zt=function(Vn){this===Rn&&Zt.call(Fn,Vn),C(this,yt)&&C(this[yt],Wt)&&(this[yt][Wt]=!1),$e(this,Wt,ge(1,Vn))};return S&&Qe&&$e(Rn,Wt,{configurable:!0,set:Zt}),ft(Wt)}).prototype,"toString",function(){return this._k}),It.f=Qn,we.f=Qt,r(79).f=ht.f=ke,r(106).f=kn,St.f=ar,S&&!r(83)&&U(Rn,"propertyIsEnumerable",kn,!0),I.f=function(Wt){return ft(q(Wt))}),O(O.G+O.W+O.F*!cn,{Symbol:Ut});for(var Tr="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rn=0;Tr.length>rn;)q(Tr[rn++]);for(var Ht=bt(q.store),Gn=0;Ht.length>Gn;)Z(Ht[Gn++]);O(O.S+O.F*!cn,"Symbol",{for:function(Wt){return C(_t,Wt+="")?_t[Wt]:_t[Wt]=Ut(Wt)},keyFor:function(Wt){if(!Jt(Wt))throw TypeError(Wt+" is not a symbol!");for(var Zt in _t)if(_t[Zt]===Wt)return Zt},useSetter:function(){Qe=!0},useSimple:function(){Qe=!1}}),O(O.S+O.F*!cn,"Object",{create:function(Wt,Zt){return Zt===void 0?Ge(Wt):Pn(Ge(Wt),Zt)},defineProperty:Qt,defineProperties:Pn,getOwnPropertyDescriptor:Qn,getOwnPropertyNames:ke,getOwnPropertySymbols:ar});var Xt=N(function(){St.f(1)});O(O.S+O.F*Xt,"Object",{getOwnPropertySymbols:function(Wt){return St.f(be(Wt))}}),Ft&&O(O.S+O.F*(!cn||N(function(){var Wt=Ut();return pt([Wt])!="[null]"||pt({a:Wt})!="{}"||pt(Object(Wt))!="{}"})),"JSON",{stringify:function(Wt){for(var Zt,Vn,xn=[Wt],Un=1;arguments.length>Un;)xn.push(arguments[Un++]);if(Vn=Zt=xn[1],(ce(Zt)||Wt!==void 0)&&!Jt(Wt))return G(Zt)||(Zt=function(ur,sr){if(typeof Vn=="function"&&(sr=Vn.call(this,ur,sr)),!Jt(sr))return sr}),xn[1]=Zt,pt.apply(Ft,xn)}}),Ut.prototype[nn]||r(42)(Ut.prototype,nn,Ut.prototype.valueOf),W(Ut,"Symbol"),W(Math,"Math",!0),W(l.JSON,"JSON",!0)},function(u,s,r){r(577),r(574),r(573),r(572),r(571),r(570),r(569),r(568),r(567),r(566),r(565),r(564),r(563),r(562),r(561),r(560),r(559),r(558),r(557),r(556),r(555),r(554),r(553),r(552),r(551),r(550),r(549),r(548),r(547),r(546),r(545),r(544),r(543),r(542),r(541),r(540),r(539),r(538),r(537),r(536),r(535),r(534),r(533),r(531),r(530),r(529),r(528),r(527),r(526),r(525),r(524),r(523),r(522),r(521),r(520),r(519),r(518),r(517),r(516),r(515),r(514),r(513),r(512),r(511),r(510),r(509),r(508),r(507),r(506),r(505),r(504),r(503),r(502),r(501),r(500),r(499),r(498),r(496),r(495),r(493),r(492),r(491),r(490),r(489),r(488),r(487),r(485),r(484),r(483),r(482),r(481),r(480),r(479),r(478),r(477),r(476),r(475),r(474),r(473),r(155),r(472),r(220),r(471),r(219),r(470),r(469),r(468),r(467),r(218),r(464),r(463),r(462),r(461),r(460),r(459),r(458),r(457),r(456),r(455),r(454),r(453),r(452),r(451),r(450),r(449),r(448),r(447),r(446),r(445),r(444),r(443),r(442),r(441),r(440),r(439),r(438),r(437),r(436),u.exports=r(24)},function(u,s,r){r(578),r(435),r(433),r(430),r(428),r(426),r(424),r(422),r(420),r(418),r(416),r(414),r(412),r(408)},function(u,s,r){r(579);var l=function(C){return C&&C.__esModule?C:{default:C}}(r(407));l.default._babelPolyfill&&typeof console<"u"&&console.warn&&console.warn("@babel/polyfill is loaded more than once on this page. This is probably not desirable/intended and may have consequences if different versions of the polyfills are applied sequentially. If you do need to load the polyfill more than once, use @babel/polyfill/noConflict instead to bypass the warning."),l.default._babelPolyfill=!0},function(u,s,r){r(580),u.exports=r(248)},function(u,s,r){var l={},C={},S=34,O=10,U=13;function j(z){return new Function("d","return {"+z.map(function(q,I){return JSON.stringify(q)+": d["+I+'] || ""'}).join(",")+"}")}function N(z){var q=Object.create(null),I=[];return z.forEach(function(Z){for(var Y in Z)Y in q||I.push(q[Y]=Y)}),I}function L(z,q){var I=z+"",Z=I.length;return Z<q?new Array(q-Z+1).join(0)+I:I}function W(z){var q=z.getUTCHours(),I=z.getUTCMinutes(),Z=z.getUTCSeconds(),Y=z.getUTCMilliseconds();return isNaN(z)?"Invalid Date":function(G){return G<0?"-"+L(-G,6):G>9999?"+"+L(G,6):L(G,4)}(z.getUTCFullYear())+"-"+L(z.getUTCMonth()+1,2)+"-"+L(z.getUTCDate(),2)+(Y?"T"+L(q,2)+":"+L(I,2)+":"+L(Z,2)+"."+L(Y,3)+"Z":Z?"T"+L(q,2)+":"+L(I,2)+":"+L(Z,2)+"Z":I||q?"T"+L(q,2)+":"+L(I,2)+"Z":"")}s.a=function(z){var q=new RegExp('["'+z+`
\r]`),I=z.charCodeAt(0);function Z(ce,be){var Ee,ve=[],ge=ce.length,Ge=0,ht=0,It=ge<=0,St=!1;function we(){if(It)return C;if(St)return St=!1,l;var jt,Mt,ze=Ge;if(ce.charCodeAt(ze)===S){for(;Ge++<ge&&ce.charCodeAt(Ge)!==S||ce.charCodeAt(++Ge)===S;);return(jt=Ge)>=ge?It=!0:(Mt=ce.charCodeAt(Ge++))===O?St=!0:Mt===U&&(St=!0,ce.charCodeAt(Ge)===O&&++Ge),ce.slice(ze+1,jt-1).replace(/""/g,'"')}for(;Ge<ge;){if((Mt=ce.charCodeAt(jt=Ge++))===O)St=!0;else if(Mt===U)St=!0,ce.charCodeAt(Ge)===O&&++Ge;else if(Mt!==I)continue;return ce.slice(ze,jt)}return It=!0,ce.slice(ze,ge)}for(ce.charCodeAt(ge-1)===O&&--ge,ce.charCodeAt(ge-1)===U&&--ge;(Ee=we())!==C;){for(var bt=[];Ee!==l&&Ee!==C;)bt.push(Ee),Ee=we();be&&(bt=be(bt,ht++))==null||ve.push(bt)}return ve}function Y(ce,be){return ce.map(function(Ee){return be.map(function(ve){return oe(Ee[ve])}).join(z)})}function G(ce){return ce.map(oe).join(z)}function oe(ce){return ce==null?"":ce instanceof Date?W(ce):q.test(ce+="")?'"'+ce.replace(/"/g,'""')+'"':ce}return{parse:function(ce,be){var Ee,ve,ge=Z(ce,function(Ge,ht){if(Ee)return Ee(Ge,ht-1);ve=Ge,Ee=be?function(It,St){var we=j(It);return function(bt,jt){return St(we(bt),jt,It)}}(Ge,be):j(Ge)});return ge.columns=ve||[],ge},parseRows:Z,format:function(ce,be){return be==null&&(be=N(ce)),[be.map(oe).join(z)].concat(Y(ce,be)).join(`
`)},formatBody:function(ce,be){return be==null&&(be=N(ce)),Y(ce,be).join(`
`)},formatRows:function(ce){return ce.map(G).join(`
`)},formatRow:G,formatValue:oe}}}]).default})})(dG);const fse=eV(dG.exports),dse="_facemesh_152oh_1",hse="_video_152oh_7",FU={facemesh:dse,video:hse},eT=_l.exports.createContext({facemeshOptions:{flipHorizontal:!1,maxContinuousChecks:5,detectionConfidence:.9,maxFaces:1,scoreThreshold:.75,iouThreshold:.3},setFacemeshOptions:null,video:null,setVideo:null,predictions:[],setPredictions:null,loadingMask:!1,setLoadingMask:null});function pse(){const p=_l.exports.useRef(void 0),{facemeshOptions:o,setVideo:u,setPredictions:s,setLoadingMask:r}=_l.exports.useContext(eT),l=async()=>{const O=p.current;if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){const U=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});return O.srcObject=U,new Promise(j=>{O.onloadedmetadata=()=>{O.play(),j()}})}},C=O=>new Promise((U,j)=>{fse.facemesh(p.current,o,U).on("face",O)}),S=async()=>{r(!0),await l();const O=p.current;await C(U=>{u(O),s(U)}),r(!1)};return _l.exports.useEffect(()=>{p&&S()},[p]),Tp(cR,{children:Tp("div",{className:FU.facemesh,children:Tp("video",{className:FU.video,autoPlay:!0,ref:p})})})}const e5="148",mse=0,RU=1,gse=2,hG=1,vse=2,fS=3,iw=0,Wg=1,t5=2,OA=3,Ub=0,j2=1,PU=2,LU=3,BU=4,yse=5,b2=100,bse=101,xse=102,jU=103,zU=104,wse=200,_se=201,Ese=202,Sse=203,pG=204,mG=205,kse=206,Cse=207,Ase=208,Ose=209,Tse=210,Mse=0,Dse=1,Nse=2,JF=3,Ise=4,Fse=5,Rse=6,Pse=7,gG=0,Lse=1,Bse=2,k1=0,jse=1,zse=2,Use=3,Wse=4,Vse=5,vG=300,X2=301,K2=302,QF=303,ZF=304,tT=306,FO=1e3,Y0=1001,eR=1002,gh=1003,UU=1004,EI=1005,Ap=1006,Hse=1007,zS=1008,ow=1009,Gse=1010,qse=1011,yG=1012,$se=1013,$x=1014,Xx=1015,US=1016,Xse=1017,Kse=1018,z2=1020,Yse=1021,Jse=1022,J0=1023,Qse=1024,Zse=1025,Jx=1026,Y2=1027,eue=1028,tue=1029,nue=1030,rue=1031,iue=1033,SI=33776,kI=33777,CI=33778,AI=33779,WU=35840,VU=35841,HU=35842,GU=35843,oue=36196,qU=37492,$U=37496,XU=37808,KU=37809,YU=37810,JU=37811,QU=37812,ZU=37813,eW=37814,tW=37815,nW=37816,rW=37817,iW=37818,oW=37819,aW=37820,sW=37821,uW=36492,aw=3e3,tu=3001,aue=3200,sue=3201,uue=0,cue=1,yy="srgb",WS="srgb-linear",OI=7680,lue=519,cW=35044,lW="300 es",tR=1035;class t_{addEventListener(o,u){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[o]===void 0&&(s[o]=[]),s[o].indexOf(u)===-1&&s[o].push(u)}hasEventListener(o,u){if(this._listeners===void 0)return!1;const s=this._listeners;return s[o]!==void 0&&s[o].indexOf(u)!==-1}removeEventListener(o,u){if(this._listeners===void 0)return;const r=this._listeners[o];if(r!==void 0){const l=r.indexOf(u);l!==-1&&r.splice(l,1)}}dispatchEvent(o){if(this._listeners===void 0)return;const s=this._listeners[o.type];if(s!==void 0){o.target=this;const r=s.slice(0);for(let l=0,C=r.length;l<C;l++)r[l].call(this,o);o.target=null}}}const rd=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],TI=Math.PI/180,fW=180/Math.PI;function XS(){const p=Math.random()*4294967295|0,o=Math.random()*4294967295|0,u=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(rd[p&255]+rd[p>>8&255]+rd[p>>16&255]+rd[p>>24&255]+"-"+rd[o&255]+rd[o>>8&255]+"-"+rd[o>>16&15|64]+rd[o>>24&255]+"-"+rd[u&63|128]+rd[u>>8&255]+"-"+rd[u>>16&255]+rd[u>>24&255]+rd[s&255]+rd[s>>8&255]+rd[s>>16&255]+rd[s>>24&255]).toLowerCase()}function zm(p,o,u){return Math.max(o,Math.min(u,p))}function fue(p,o){return(p%o+o)%o}function MI(p,o,u){return(1-u)*p+u*o}function dW(p){return(p&p-1)===0&&p!==0}function nR(p){return Math.pow(2,Math.floor(Math.log(p)/Math.LN2))}function TA(p,o){switch(o.constructor){case Float32Array:return p;case Uint16Array:return p/65535;case Uint8Array:return p/255;case Int16Array:return Math.max(p/32767,-1);case Int8Array:return Math.max(p/127,-1);default:throw new Error("Invalid component type.")}}function Pm(p,o){switch(o.constructor){case Float32Array:return p;case Uint16Array:return Math.round(p*65535);case Uint8Array:return Math.round(p*255);case Int16Array:return Math.round(p*32767);case Int8Array:return Math.round(p*127);default:throw new Error("Invalid component type.")}}class cs{constructor(o=0,u=0){cs.prototype.isVector2=!0,this.x=o,this.y=u}get width(){return this.x}set width(o){this.x=o}get height(){return this.y}set height(o){this.y=o}set(o,u){return this.x=o,this.y=u,this}setScalar(o){return this.x=o,this.y=o,this}setX(o){return this.x=o,this}setY(o){return this.y=o,this}setComponent(o,u){switch(o){case 0:this.x=u;break;case 1:this.y=u;break;default:throw new Error("index is out of range: "+o)}return this}getComponent(o){switch(o){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+o)}}clone(){return new this.constructor(this.x,this.y)}copy(o){return this.x=o.x,this.y=o.y,this}add(o){return this.x+=o.x,this.y+=o.y,this}addScalar(o){return this.x+=o,this.y+=o,this}addVectors(o,u){return this.x=o.x+u.x,this.y=o.y+u.y,this}addScaledVector(o,u){return this.x+=o.x*u,this.y+=o.y*u,this}sub(o){return this.x-=o.x,this.y-=o.y,this}subScalar(o){return this.x-=o,this.y-=o,this}subVectors(o,u){return this.x=o.x-u.x,this.y=o.y-u.y,this}multiply(o){return this.x*=o.x,this.y*=o.y,this}multiplyScalar(o){return this.x*=o,this.y*=o,this}divide(o){return this.x/=o.x,this.y/=o.y,this}divideScalar(o){return this.multiplyScalar(1/o)}applyMatrix3(o){const u=this.x,s=this.y,r=o.elements;return this.x=r[0]*u+r[3]*s+r[6],this.y=r[1]*u+r[4]*s+r[7],this}min(o){return this.x=Math.min(this.x,o.x),this.y=Math.min(this.y,o.y),this}max(o){return this.x=Math.max(this.x,o.x),this.y=Math.max(this.y,o.y),this}clamp(o,u){return this.x=Math.max(o.x,Math.min(u.x,this.x)),this.y=Math.max(o.y,Math.min(u.y,this.y)),this}clampScalar(o,u){return this.x=Math.max(o,Math.min(u,this.x)),this.y=Math.max(o,Math.min(u,this.y)),this}clampLength(o,u){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(o,Math.min(u,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(o){return this.x*o.x+this.y*o.y}cross(o){return this.x*o.y-this.y*o.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(o){return Math.sqrt(this.distanceToSquared(o))}distanceToSquared(o){const u=this.x-o.x,s=this.y-o.y;return u*u+s*s}manhattanDistanceTo(o){return Math.abs(this.x-o.x)+Math.abs(this.y-o.y)}setLength(o){return this.normalize().multiplyScalar(o)}lerp(o,u){return this.x+=(o.x-this.x)*u,this.y+=(o.y-this.y)*u,this}lerpVectors(o,u,s){return this.x=o.x+(u.x-o.x)*s,this.y=o.y+(u.y-o.y)*s,this}equals(o){return o.x===this.x&&o.y===this.y}fromArray(o,u=0){return this.x=o[u],this.y=o[u+1],this}toArray(o=[],u=0){return o[u]=this.x,o[u+1]=this.y,o}fromBufferAttribute(o,u){return this.x=o.getX(u),this.y=o.getY(u),this}rotateAround(o,u){const s=Math.cos(u),r=Math.sin(u),l=this.x-o.x,C=this.y-o.y;return this.x=l*s-C*r+o.x,this.y=l*r+C*s+o.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Wm{constructor(){Wm.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(o,u,s,r,l,C,S,O,U){const j=this.elements;return j[0]=o,j[1]=r,j[2]=S,j[3]=u,j[4]=l,j[5]=O,j[6]=s,j[7]=C,j[8]=U,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(o){const u=this.elements,s=o.elements;return u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[8]=s[8],this}extractBasis(o,u,s){return o.setFromMatrix3Column(this,0),u.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(o){const u=o.elements;return this.set(u[0],u[4],u[8],u[1],u[5],u[9],u[2],u[6],u[10]),this}multiply(o){return this.multiplyMatrices(this,o)}premultiply(o){return this.multiplyMatrices(o,this)}multiplyMatrices(o,u){const s=o.elements,r=u.elements,l=this.elements,C=s[0],S=s[3],O=s[6],U=s[1],j=s[4],N=s[7],L=s[2],W=s[5],z=s[8],q=r[0],I=r[3],Z=r[6],Y=r[1],G=r[4],oe=r[7],ce=r[2],be=r[5],Ee=r[8];return l[0]=C*q+S*Y+O*ce,l[3]=C*I+S*G+O*be,l[6]=C*Z+S*oe+O*Ee,l[1]=U*q+j*Y+N*ce,l[4]=U*I+j*G+N*be,l[7]=U*Z+j*oe+N*Ee,l[2]=L*q+W*Y+z*ce,l[5]=L*I+W*G+z*be,l[8]=L*Z+W*oe+z*Ee,this}multiplyScalar(o){const u=this.elements;return u[0]*=o,u[3]*=o,u[6]*=o,u[1]*=o,u[4]*=o,u[7]*=o,u[2]*=o,u[5]*=o,u[8]*=o,this}determinant(){const o=this.elements,u=o[0],s=o[1],r=o[2],l=o[3],C=o[4],S=o[5],O=o[6],U=o[7],j=o[8];return u*C*j-u*S*U-s*l*j+s*S*O+r*l*U-r*C*O}invert(){const o=this.elements,u=o[0],s=o[1],r=o[2],l=o[3],C=o[4],S=o[5],O=o[6],U=o[7],j=o[8],N=j*C-S*U,L=S*O-j*l,W=U*l-C*O,z=u*N+s*L+r*W;if(z===0)return this.set(0,0,0,0,0,0,0,0,0);const q=1/z;return o[0]=N*q,o[1]=(r*U-j*s)*q,o[2]=(S*s-r*C)*q,o[3]=L*q,o[4]=(j*u-r*O)*q,o[5]=(r*l-S*u)*q,o[6]=W*q,o[7]=(s*O-U*u)*q,o[8]=(C*u-s*l)*q,this}transpose(){let o;const u=this.elements;return o=u[1],u[1]=u[3],u[3]=o,o=u[2],u[2]=u[6],u[6]=o,o=u[5],u[5]=u[7],u[7]=o,this}getNormalMatrix(o){return this.setFromMatrix4(o).invert().transpose()}transposeIntoArray(o){const u=this.elements;return o[0]=u[0],o[1]=u[3],o[2]=u[6],o[3]=u[1],o[4]=u[4],o[5]=u[7],o[6]=u[2],o[7]=u[5],o[8]=u[8],this}setUvTransform(o,u,s,r,l,C,S){const O=Math.cos(l),U=Math.sin(l);return this.set(s*O,s*U,-s*(O*C+U*S)+C+o,-r*U,r*O,-r*(-U*C+O*S)+S+u,0,0,1),this}scale(o,u){return this.premultiply(DI.makeScale(o,u)),this}rotate(o){return this.premultiply(DI.makeRotation(-o)),this}translate(o,u){return this.premultiply(DI.makeTranslation(o,u)),this}makeTranslation(o,u){return this.set(1,0,o,0,1,u,0,0,1),this}makeRotation(o){const u=Math.cos(o),s=Math.sin(o);return this.set(u,-s,0,s,u,0,0,0,1),this}makeScale(o,u){return this.set(o,0,0,0,u,0,0,0,1),this}equals(o){const u=this.elements,s=o.elements;for(let r=0;r<9;r++)if(u[r]!==s[r])return!1;return!0}fromArray(o,u=0){for(let s=0;s<9;s++)this.elements[s]=o[s+u];return this}toArray(o=[],u=0){const s=this.elements;return o[u]=s[0],o[u+1]=s[1],o[u+2]=s[2],o[u+3]=s[3],o[u+4]=s[4],o[u+5]=s[5],o[u+6]=s[6],o[u+7]=s[7],o[u+8]=s[8],o}clone(){return new this.constructor().fromArray(this.elements)}}const DI=new Wm;function bG(p){for(let o=p.length-1;o>=0;--o)if(p[o]>=65535)return!0;return!1}function RO(p){return document.createElementNS("http://www.w3.org/1999/xhtml",p)}function Qx(p){return p<.04045?p*.0773993808:Math.pow(p*.9478672986+.0521327014,2.4)}function uO(p){return p<.0031308?p*12.92:1.055*Math.pow(p,.41666)-.055}const NI={[yy]:{[WS]:Qx},[WS]:{[yy]:uO}},hh={legacyMode:!0,get workingColorSpace(){return WS},set workingColorSpace(p){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(p,o,u){if(this.legacyMode||o===u||!o||!u)return p;if(NI[o]&&NI[o][u]!==void 0){const s=NI[o][u];return p.r=s(p.r),p.g=s(p.g),p.b=s(p.b),p}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(p,o){return this.convert(p,this.workingColorSpace,o)},toWorkingColorSpace:function(p,o){return this.convert(p,o,this.workingColorSpace)}},xG={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Gc={r:0,g:0,b:0},H0={h:0,s:0,l:0},MA={h:0,s:0,l:0};function II(p,o,u){return u<0&&(u+=1),u>1&&(u-=1),u<1/6?p+(o-p)*6*u:u<1/2?o:u<2/3?p+(o-p)*6*(2/3-u):p}function DA(p,o){return o.r=p.r,o.g=p.g,o.b=p.b,o}class vs{constructor(o,u,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,u===void 0&&s===void 0?this.set(o):this.setRGB(o,u,s)}set(o){return o&&o.isColor?this.copy(o):typeof o=="number"?this.setHex(o):typeof o=="string"&&this.setStyle(o),this}setScalar(o){return this.r=o,this.g=o,this.b=o,this}setHex(o,u=yy){return o=Math.floor(o),this.r=(o>>16&255)/255,this.g=(o>>8&255)/255,this.b=(o&255)/255,hh.toWorkingColorSpace(this,u),this}setRGB(o,u,s,r=hh.workingColorSpace){return this.r=o,this.g=u,this.b=s,hh.toWorkingColorSpace(this,r),this}setHSL(o,u,s,r=hh.workingColorSpace){if(o=fue(o,1),u=zm(u,0,1),s=zm(s,0,1),u===0)this.r=this.g=this.b=s;else{const l=s<=.5?s*(1+u):s+u-s*u,C=2*s-l;this.r=II(C,l,o+1/3),this.g=II(C,l,o),this.b=II(C,l,o-1/3)}return hh.toWorkingColorSpace(this,r),this}setStyle(o,u=yy){function s(l){l!==void 0&&parseFloat(l)<1&&console.warn("THREE.Color: Alpha component of "+o+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(o)){let l;const C=r[1],S=r[2];switch(C){case"rgb":case"rgba":if(l=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(S))return this.r=Math.min(255,parseInt(l[1],10))/255,this.g=Math.min(255,parseInt(l[2],10))/255,this.b=Math.min(255,parseInt(l[3],10))/255,hh.toWorkingColorSpace(this,u),s(l[4]),this;if(l=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(S))return this.r=Math.min(100,parseInt(l[1],10))/100,this.g=Math.min(100,parseInt(l[2],10))/100,this.b=Math.min(100,parseInt(l[3],10))/100,hh.toWorkingColorSpace(this,u),s(l[4]),this;break;case"hsl":case"hsla":if(l=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(S)){const O=parseFloat(l[1])/360,U=parseFloat(l[2])/100,j=parseFloat(l[3])/100;return s(l[4]),this.setHSL(O,U,j,u)}break}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(o)){const l=r[1],C=l.length;if(C===3)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,hh.toWorkingColorSpace(this,u),this;if(C===6)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,hh.toWorkingColorSpace(this,u),this}return o&&o.length>0?this.setColorName(o,u):this}setColorName(o,u=yy){const s=xG[o.toLowerCase()];return s!==void 0?this.setHex(s,u):console.warn("THREE.Color: Unknown color "+o),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(o){return this.r=o.r,this.g=o.g,this.b=o.b,this}copySRGBToLinear(o){return this.r=Qx(o.r),this.g=Qx(o.g),this.b=Qx(o.b),this}copyLinearToSRGB(o){return this.r=uO(o.r),this.g=uO(o.g),this.b=uO(o.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(o=yy){return hh.fromWorkingColorSpace(DA(this,Gc),o),zm(Gc.r*255,0,255)<<16^zm(Gc.g*255,0,255)<<8^zm(Gc.b*255,0,255)<<0}getHexString(o=yy){return("000000"+this.getHex(o).toString(16)).slice(-6)}getHSL(o,u=hh.workingColorSpace){hh.fromWorkingColorSpace(DA(this,Gc),u);const s=Gc.r,r=Gc.g,l=Gc.b,C=Math.max(s,r,l),S=Math.min(s,r,l);let O,U;const j=(S+C)/2;if(S===C)O=0,U=0;else{const N=C-S;switch(U=j<=.5?N/(C+S):N/(2-C-S),C){case s:O=(r-l)/N+(r<l?6:0);break;case r:O=(l-s)/N+2;break;case l:O=(s-r)/N+4;break}O/=6}return o.h=O,o.s=U,o.l=j,o}getRGB(o,u=hh.workingColorSpace){return hh.fromWorkingColorSpace(DA(this,Gc),u),o.r=Gc.r,o.g=Gc.g,o.b=Gc.b,o}getStyle(o=yy){return hh.fromWorkingColorSpace(DA(this,Gc),o),o!==yy?`color(${o} ${Gc.r} ${Gc.g} ${Gc.b})`:`rgb(${Gc.r*255|0},${Gc.g*255|0},${Gc.b*255|0})`}offsetHSL(o,u,s){return this.getHSL(H0),H0.h+=o,H0.s+=u,H0.l+=s,this.setHSL(H0.h,H0.s,H0.l),this}add(o){return this.r+=o.r,this.g+=o.g,this.b+=o.b,this}addColors(o,u){return this.r=o.r+u.r,this.g=o.g+u.g,this.b=o.b+u.b,this}addScalar(o){return this.r+=o,this.g+=o,this.b+=o,this}sub(o){return this.r=Math.max(0,this.r-o.r),this.g=Math.max(0,this.g-o.g),this.b=Math.max(0,this.b-o.b),this}multiply(o){return this.r*=o.r,this.g*=o.g,this.b*=o.b,this}multiplyScalar(o){return this.r*=o,this.g*=o,this.b*=o,this}lerp(o,u){return this.r+=(o.r-this.r)*u,this.g+=(o.g-this.g)*u,this.b+=(o.b-this.b)*u,this}lerpColors(o,u,s){return this.r=o.r+(u.r-o.r)*s,this.g=o.g+(u.g-o.g)*s,this.b=o.b+(u.b-o.b)*s,this}lerpHSL(o,u){this.getHSL(H0),o.getHSL(MA);const s=MI(H0.h,MA.h,u),r=MI(H0.s,MA.s,u),l=MI(H0.l,MA.l,u);return this.setHSL(s,r,l),this}equals(o){return o.r===this.r&&o.g===this.g&&o.b===this.b}fromArray(o,u=0){return this.r=o[u],this.g=o[u+1],this.b=o[u+2],this}toArray(o=[],u=0){return o[u]=this.r,o[u+1]=this.g,o[u+2]=this.b,o}fromBufferAttribute(o,u){return this.r=o.getX(u),this.g=o.getY(u),this.b=o.getZ(u),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}vs.NAMES=xG;let o2;class wG{static getDataURL(o){if(/^data:/i.test(o.src)||typeof HTMLCanvasElement>"u")return o.src;let u;if(o instanceof HTMLCanvasElement)u=o;else{o2===void 0&&(o2=RO("canvas")),o2.width=o.width,o2.height=o.height;const s=o2.getContext("2d");o instanceof ImageData?s.putImageData(o,0,0):s.drawImage(o,0,0,o.width,o.height),u=o2}return u.width>2048||u.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",o),u.toDataURL("image/jpeg",.6)):u.toDataURL("image/png")}static sRGBToLinear(o){if(typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&o instanceof ImageBitmap){const u=RO("canvas");u.width=o.width,u.height=o.height;const s=u.getContext("2d");s.drawImage(o,0,0,o.width,o.height);const r=s.getImageData(0,0,o.width,o.height),l=r.data;for(let C=0;C<l.length;C++)l[C]=Qx(l[C]/255)*255;return s.putImageData(r,0,0),u}else if(o.data){const u=o.data.slice(0);for(let s=0;s<u.length;s++)u instanceof Uint8Array||u instanceof Uint8ClampedArray?u[s]=Math.floor(Qx(u[s]/255)*255):u[s]=Qx(u[s]);return{data:u,width:o.width,height:o.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),o}}class _G{constructor(o=null){this.isSource=!0,this.uuid=XS(),this.data=o,this.version=0}set needsUpdate(o){o===!0&&this.version++}toJSON(o){const u=o===void 0||typeof o=="string";if(!u&&o.images[this.uuid]!==void 0)return o.images[this.uuid];const s={uuid:this.uuid,url:""},r=this.data;if(r!==null){let l;if(Array.isArray(r)){l=[];for(let C=0,S=r.length;C<S;C++)r[C].isDataTexture?l.push(FI(r[C].image)):l.push(FI(r[C]))}else l=FI(r);s.url=l}return u||(o.images[this.uuid]=s),s}}function FI(p){return typeof HTMLImageElement<"u"&&p instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&p instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&p instanceof ImageBitmap?wG.getDataURL(p):p.data?{data:Array.from(p.data),width:p.width,height:p.height,type:p.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let due=0;class Ip extends t_{constructor(o=Ip.DEFAULT_IMAGE,u=Ip.DEFAULT_MAPPING,s=Y0,r=Y0,l=Ap,C=zS,S=J0,O=ow,U=Ip.DEFAULT_ANISOTROPY,j=aw){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:due++}),this.uuid=XS(),this.name="",this.source=new _G(o),this.mipmaps=[],this.mapping=u,this.wrapS=s,this.wrapT=r,this.magFilter=l,this.minFilter=C,this.anisotropy=U,this.format=S,this.internalFormat=null,this.type=O,this.offset=new cs(0,0),this.repeat=new cs(1,1),this.center=new cs(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Wm,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=j,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(o){this.source.data=o}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(o){return this.name=o.name,this.source=o.source,this.mipmaps=o.mipmaps.slice(0),this.mapping=o.mapping,this.wrapS=o.wrapS,this.wrapT=o.wrapT,this.magFilter=o.magFilter,this.minFilter=o.minFilter,this.anisotropy=o.anisotropy,this.format=o.format,this.internalFormat=o.internalFormat,this.type=o.type,this.offset.copy(o.offset),this.repeat.copy(o.repeat),this.center.copy(o.center),this.rotation=o.rotation,this.matrixAutoUpdate=o.matrixAutoUpdate,this.matrix.copy(o.matrix),this.generateMipmaps=o.generateMipmaps,this.premultiplyAlpha=o.premultiplyAlpha,this.flipY=o.flipY,this.unpackAlignment=o.unpackAlignment,this.encoding=o.encoding,this.userData=JSON.parse(JSON.stringify(o.userData)),this.needsUpdate=!0,this}toJSON(o){const u=o===void 0||typeof o=="string";if(!u&&o.textures[this.uuid]!==void 0)return o.textures[this.uuid];const s={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(o).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),u||(o.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(o){if(this.mapping!==vG)return o;if(o.applyMatrix3(this.matrix),o.x<0||o.x>1)switch(this.wrapS){case FO:o.x=o.x-Math.floor(o.x);break;case Y0:o.x=o.x<0?0:1;break;case eR:Math.abs(Math.floor(o.x)%2)===1?o.x=Math.ceil(o.x)-o.x:o.x=o.x-Math.floor(o.x);break}if(o.y<0||o.y>1)switch(this.wrapT){case FO:o.y=o.y-Math.floor(o.y);break;case Y0:o.y=o.y<0?0:1;break;case eR:Math.abs(Math.floor(o.y)%2)===1?o.y=Math.ceil(o.y)-o.y:o.y=o.y-Math.floor(o.y);break}return this.flipY&&(o.y=1-o.y),o}set needsUpdate(o){o===!0&&(this.version++,this.source.needsUpdate=!0)}}Ip.DEFAULT_IMAGE=null;Ip.DEFAULT_MAPPING=vG;Ip.DEFAULT_ANISOTROPY=1;class yu{constructor(o=0,u=0,s=0,r=1){yu.prototype.isVector4=!0,this.x=o,this.y=u,this.z=s,this.w=r}get width(){return this.z}set width(o){this.z=o}get height(){return this.w}set height(o){this.w=o}set(o,u,s,r){return this.x=o,this.y=u,this.z=s,this.w=r,this}setScalar(o){return this.x=o,this.y=o,this.z=o,this.w=o,this}setX(o){return this.x=o,this}setY(o){return this.y=o,this}setZ(o){return this.z=o,this}setW(o){return this.w=o,this}setComponent(o,u){switch(o){case 0:this.x=u;break;case 1:this.y=u;break;case 2:this.z=u;break;case 3:this.w=u;break;default:throw new Error("index is out of range: "+o)}return this}getComponent(o){switch(o){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+o)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(o){return this.x=o.x,this.y=o.y,this.z=o.z,this.w=o.w!==void 0?o.w:1,this}add(o){return this.x+=o.x,this.y+=o.y,this.z+=o.z,this.w+=o.w,this}addScalar(o){return this.x+=o,this.y+=o,this.z+=o,this.w+=o,this}addVectors(o,u){return this.x=o.x+u.x,this.y=o.y+u.y,this.z=o.z+u.z,this.w=o.w+u.w,this}addScaledVector(o,u){return this.x+=o.x*u,this.y+=o.y*u,this.z+=o.z*u,this.w+=o.w*u,this}sub(o){return this.x-=o.x,this.y-=o.y,this.z-=o.z,this.w-=o.w,this}subScalar(o){return this.x-=o,this.y-=o,this.z-=o,this.w-=o,this}subVectors(o,u){return this.x=o.x-u.x,this.y=o.y-u.y,this.z=o.z-u.z,this.w=o.w-u.w,this}multiply(o){return this.x*=o.x,this.y*=o.y,this.z*=o.z,this.w*=o.w,this}multiplyScalar(o){return this.x*=o,this.y*=o,this.z*=o,this.w*=o,this}applyMatrix4(o){const u=this.x,s=this.y,r=this.z,l=this.w,C=o.elements;return this.x=C[0]*u+C[4]*s+C[8]*r+C[12]*l,this.y=C[1]*u+C[5]*s+C[9]*r+C[13]*l,this.z=C[2]*u+C[6]*s+C[10]*r+C[14]*l,this.w=C[3]*u+C[7]*s+C[11]*r+C[15]*l,this}divideScalar(o){return this.multiplyScalar(1/o)}setAxisAngleFromQuaternion(o){this.w=2*Math.acos(o.w);const u=Math.sqrt(1-o.w*o.w);return u<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=o.x/u,this.y=o.y/u,this.z=o.z/u),this}setAxisAngleFromRotationMatrix(o){let u,s,r,l;const O=o.elements,U=O[0],j=O[4],N=O[8],L=O[1],W=O[5],z=O[9],q=O[2],I=O[6],Z=O[10];if(Math.abs(j-L)<.01&&Math.abs(N-q)<.01&&Math.abs(z-I)<.01){if(Math.abs(j+L)<.1&&Math.abs(N+q)<.1&&Math.abs(z+I)<.1&&Math.abs(U+W+Z-3)<.1)return this.set(1,0,0,0),this;u=Math.PI;const G=(U+1)/2,oe=(W+1)/2,ce=(Z+1)/2,be=(j+L)/4,Ee=(N+q)/4,ve=(z+I)/4;return G>oe&&G>ce?G<.01?(s=0,r=.707106781,l=.707106781):(s=Math.sqrt(G),r=be/s,l=Ee/s):oe>ce?oe<.01?(s=.707106781,r=0,l=.707106781):(r=Math.sqrt(oe),s=be/r,l=ve/r):ce<.01?(s=.707106781,r=.707106781,l=0):(l=Math.sqrt(ce),s=Ee/l,r=ve/l),this.set(s,r,l,u),this}let Y=Math.sqrt((I-z)*(I-z)+(N-q)*(N-q)+(L-j)*(L-j));return Math.abs(Y)<.001&&(Y=1),this.x=(I-z)/Y,this.y=(N-q)/Y,this.z=(L-j)/Y,this.w=Math.acos((U+W+Z-1)/2),this}min(o){return this.x=Math.min(this.x,o.x),this.y=Math.min(this.y,o.y),this.z=Math.min(this.z,o.z),this.w=Math.min(this.w,o.w),this}max(o){return this.x=Math.max(this.x,o.x),this.y=Math.max(this.y,o.y),this.z=Math.max(this.z,o.z),this.w=Math.max(this.w,o.w),this}clamp(o,u){return this.x=Math.max(o.x,Math.min(u.x,this.x)),this.y=Math.max(o.y,Math.min(u.y,this.y)),this.z=Math.max(o.z,Math.min(u.z,this.z)),this.w=Math.max(o.w,Math.min(u.w,this.w)),this}clampScalar(o,u){return this.x=Math.max(o,Math.min(u,this.x)),this.y=Math.max(o,Math.min(u,this.y)),this.z=Math.max(o,Math.min(u,this.z)),this.w=Math.max(o,Math.min(u,this.w)),this}clampLength(o,u){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(o,Math.min(u,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(o){return this.x*o.x+this.y*o.y+this.z*o.z+this.w*o.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(o){return this.normalize().multiplyScalar(o)}lerp(o,u){return this.x+=(o.x-this.x)*u,this.y+=(o.y-this.y)*u,this.z+=(o.z-this.z)*u,this.w+=(o.w-this.w)*u,this}lerpVectors(o,u,s){return this.x=o.x+(u.x-o.x)*s,this.y=o.y+(u.y-o.y)*s,this.z=o.z+(u.z-o.z)*s,this.w=o.w+(u.w-o.w)*s,this}equals(o){return o.x===this.x&&o.y===this.y&&o.z===this.z&&o.w===this.w}fromArray(o,u=0){return this.x=o[u],this.y=o[u+1],this.z=o[u+2],this.w=o[u+3],this}toArray(o=[],u=0){return o[u]=this.x,o[u+1]=this.y,o[u+2]=this.z,o[u+3]=this.w,o}fromBufferAttribute(o,u){return this.x=o.getX(u),this.y=o.getY(u),this.z=o.getZ(u),this.w=o.getW(u),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class sw extends t_{constructor(o=1,u=1,s={}){super(),this.isWebGLRenderTarget=!0,this.width=o,this.height=u,this.depth=1,this.scissor=new yu(0,0,o,u),this.scissorTest=!1,this.viewport=new yu(0,0,o,u);const r={width:o,height:u,depth:1};this.texture=new Ip(r,s.mapping,s.wrapS,s.wrapT,s.magFilter,s.minFilter,s.format,s.type,s.anisotropy,s.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=s.generateMipmaps!==void 0?s.generateMipmaps:!1,this.texture.internalFormat=s.internalFormat!==void 0?s.internalFormat:null,this.texture.minFilter=s.minFilter!==void 0?s.minFilter:Ap,this.depthBuffer=s.depthBuffer!==void 0?s.depthBuffer:!0,this.stencilBuffer=s.stencilBuffer!==void 0?s.stencilBuffer:!1,this.depthTexture=s.depthTexture!==void 0?s.depthTexture:null,this.samples=s.samples!==void 0?s.samples:0}setSize(o,u,s=1){(this.width!==o||this.height!==u||this.depth!==s)&&(this.width=o,this.height=u,this.depth=s,this.texture.image.width=o,this.texture.image.height=u,this.texture.image.depth=s,this.dispose()),this.viewport.set(0,0,o,u),this.scissor.set(0,0,o,u)}clone(){return new this.constructor().copy(this)}copy(o){this.width=o.width,this.height=o.height,this.depth=o.depth,this.viewport.copy(o.viewport),this.texture=o.texture.clone(),this.texture.isRenderTargetTexture=!0;const u=Object.assign({},o.texture.image);return this.texture.source=new _G(u),this.depthBuffer=o.depthBuffer,this.stencilBuffer=o.stencilBuffer,o.depthTexture!==null&&(this.depthTexture=o.depthTexture.clone()),this.samples=o.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class EG extends Ip{constructor(o=null,u=1,s=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:o,width:u,height:s,depth:r},this.magFilter=gh,this.minFilter=gh,this.wrapR=Y0,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class hue extends Ip{constructor(o=null,u=1,s=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:o,width:u,height:s,depth:r},this.magFilter=gh,this.minFilter=gh,this.wrapR=Y0,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class KS{constructor(o=0,u=0,s=0,r=1){this.isQuaternion=!0,this._x=o,this._y=u,this._z=s,this._w=r}static slerpFlat(o,u,s,r,l,C,S){let O=s[r+0],U=s[r+1],j=s[r+2],N=s[r+3];const L=l[C+0],W=l[C+1],z=l[C+2],q=l[C+3];if(S===0){o[u+0]=O,o[u+1]=U,o[u+2]=j,o[u+3]=N;return}if(S===1){o[u+0]=L,o[u+1]=W,o[u+2]=z,o[u+3]=q;return}if(N!==q||O!==L||U!==W||j!==z){let I=1-S;const Z=O*L+U*W+j*z+N*q,Y=Z>=0?1:-1,G=1-Z*Z;if(G>Number.EPSILON){const ce=Math.sqrt(G),be=Math.atan2(ce,Z*Y);I=Math.sin(I*be)/ce,S=Math.sin(S*be)/ce}const oe=S*Y;if(O=O*I+L*oe,U=U*I+W*oe,j=j*I+z*oe,N=N*I+q*oe,I===1-S){const ce=1/Math.sqrt(O*O+U*U+j*j+N*N);O*=ce,U*=ce,j*=ce,N*=ce}}o[u]=O,o[u+1]=U,o[u+2]=j,o[u+3]=N}static multiplyQuaternionsFlat(o,u,s,r,l,C){const S=s[r],O=s[r+1],U=s[r+2],j=s[r+3],N=l[C],L=l[C+1],W=l[C+2],z=l[C+3];return o[u]=S*z+j*N+O*W-U*L,o[u+1]=O*z+j*L+U*N-S*W,o[u+2]=U*z+j*W+S*L-O*N,o[u+3]=j*z-S*N-O*L-U*W,o}get x(){return this._x}set x(o){this._x=o,this._onChangeCallback()}get y(){return this._y}set y(o){this._y=o,this._onChangeCallback()}get z(){return this._z}set z(o){this._z=o,this._onChangeCallback()}get w(){return this._w}set w(o){this._w=o,this._onChangeCallback()}set(o,u,s,r){return this._x=o,this._y=u,this._z=s,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(o){return this._x=o.x,this._y=o.y,this._z=o.z,this._w=o.w,this._onChangeCallback(),this}setFromEuler(o,u){const s=o._x,r=o._y,l=o._z,C=o._order,S=Math.cos,O=Math.sin,U=S(s/2),j=S(r/2),N=S(l/2),L=O(s/2),W=O(r/2),z=O(l/2);switch(C){case"XYZ":this._x=L*j*N+U*W*z,this._y=U*W*N-L*j*z,this._z=U*j*z+L*W*N,this._w=U*j*N-L*W*z;break;case"YXZ":this._x=L*j*N+U*W*z,this._y=U*W*N-L*j*z,this._z=U*j*z-L*W*N,this._w=U*j*N+L*W*z;break;case"ZXY":this._x=L*j*N-U*W*z,this._y=U*W*N+L*j*z,this._z=U*j*z+L*W*N,this._w=U*j*N-L*W*z;break;case"ZYX":this._x=L*j*N-U*W*z,this._y=U*W*N+L*j*z,this._z=U*j*z-L*W*N,this._w=U*j*N+L*W*z;break;case"YZX":this._x=L*j*N+U*W*z,this._y=U*W*N+L*j*z,this._z=U*j*z-L*W*N,this._w=U*j*N-L*W*z;break;case"XZY":this._x=L*j*N-U*W*z,this._y=U*W*N-L*j*z,this._z=U*j*z+L*W*N,this._w=U*j*N+L*W*z;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+C)}return u!==!1&&this._onChangeCallback(),this}setFromAxisAngle(o,u){const s=u/2,r=Math.sin(s);return this._x=o.x*r,this._y=o.y*r,this._z=o.z*r,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(o){const u=o.elements,s=u[0],r=u[4],l=u[8],C=u[1],S=u[5],O=u[9],U=u[2],j=u[6],N=u[10],L=s+S+N;if(L>0){const W=.5/Math.sqrt(L+1);this._w=.25/W,this._x=(j-O)*W,this._y=(l-U)*W,this._z=(C-r)*W}else if(s>S&&s>N){const W=2*Math.sqrt(1+s-S-N);this._w=(j-O)/W,this._x=.25*W,this._y=(r+C)/W,this._z=(l+U)/W}else if(S>N){const W=2*Math.sqrt(1+S-s-N);this._w=(l-U)/W,this._x=(r+C)/W,this._y=.25*W,this._z=(O+j)/W}else{const W=2*Math.sqrt(1+N-s-S);this._w=(C-r)/W,this._x=(l+U)/W,this._y=(O+j)/W,this._z=.25*W}return this._onChangeCallback(),this}setFromUnitVectors(o,u){let s=o.dot(u)+1;return s<Number.EPSILON?(s=0,Math.abs(o.x)>Math.abs(o.z)?(this._x=-o.y,this._y=o.x,this._z=0,this._w=s):(this._x=0,this._y=-o.z,this._z=o.y,this._w=s)):(this._x=o.y*u.z-o.z*u.y,this._y=o.z*u.x-o.x*u.z,this._z=o.x*u.y-o.y*u.x,this._w=s),this.normalize()}angleTo(o){return 2*Math.acos(Math.abs(zm(this.dot(o),-1,1)))}rotateTowards(o,u){const s=this.angleTo(o);if(s===0)return this;const r=Math.min(1,u/s);return this.slerp(o,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(o){return this._x*o._x+this._y*o._y+this._z*o._z+this._w*o._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let o=this.length();return o===0?(this._x=0,this._y=0,this._z=0,this._w=1):(o=1/o,this._x=this._x*o,this._y=this._y*o,this._z=this._z*o,this._w=this._w*o),this._onChangeCallback(),this}multiply(o){return this.multiplyQuaternions(this,o)}premultiply(o){return this.multiplyQuaternions(o,this)}multiplyQuaternions(o,u){const s=o._x,r=o._y,l=o._z,C=o._w,S=u._x,O=u._y,U=u._z,j=u._w;return this._x=s*j+C*S+r*U-l*O,this._y=r*j+C*O+l*S-s*U,this._z=l*j+C*U+s*O-r*S,this._w=C*j-s*S-r*O-l*U,this._onChangeCallback(),this}slerp(o,u){if(u===0)return this;if(u===1)return this.copy(o);const s=this._x,r=this._y,l=this._z,C=this._w;let S=C*o._w+s*o._x+r*o._y+l*o._z;if(S<0?(this._w=-o._w,this._x=-o._x,this._y=-o._y,this._z=-o._z,S=-S):this.copy(o),S>=1)return this._w=C,this._x=s,this._y=r,this._z=l,this;const O=1-S*S;if(O<=Number.EPSILON){const W=1-u;return this._w=W*C+u*this._w,this._x=W*s+u*this._x,this._y=W*r+u*this._y,this._z=W*l+u*this._z,this.normalize(),this._onChangeCallback(),this}const U=Math.sqrt(O),j=Math.atan2(U,S),N=Math.sin((1-u)*j)/U,L=Math.sin(u*j)/U;return this._w=C*N+this._w*L,this._x=s*N+this._x*L,this._y=r*N+this._y*L,this._z=l*N+this._z*L,this._onChangeCallback(),this}slerpQuaternions(o,u,s){return this.copy(o).slerp(u,s)}random(){const o=Math.random(),u=Math.sqrt(1-o),s=Math.sqrt(o),r=2*Math.PI*Math.random(),l=2*Math.PI*Math.random();return this.set(u*Math.cos(r),s*Math.sin(l),s*Math.cos(l),u*Math.sin(r))}equals(o){return o._x===this._x&&o._y===this._y&&o._z===this._z&&o._w===this._w}fromArray(o,u=0){return this._x=o[u],this._y=o[u+1],this._z=o[u+2],this._w=o[u+3],this._onChangeCallback(),this}toArray(o=[],u=0){return o[u]=this._x,o[u+1]=this._y,o[u+2]=this._z,o[u+3]=this._w,o}fromBufferAttribute(o,u){return this._x=o.getX(u),this._y=o.getY(u),this._z=o.getZ(u),this._w=o.getW(u),this}_onChange(o){return this._onChangeCallback=o,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class hr{constructor(o=0,u=0,s=0){hr.prototype.isVector3=!0,this.x=o,this.y=u,this.z=s}set(o,u,s){return s===void 0&&(s=this.z),this.x=o,this.y=u,this.z=s,this}setScalar(o){return this.x=o,this.y=o,this.z=o,this}setX(o){return this.x=o,this}setY(o){return this.y=o,this}setZ(o){return this.z=o,this}setComponent(o,u){switch(o){case 0:this.x=u;break;case 1:this.y=u;break;case 2:this.z=u;break;default:throw new Error("index is out of range: "+o)}return this}getComponent(o){switch(o){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+o)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(o){return this.x=o.x,this.y=o.y,this.z=o.z,this}add(o){return this.x+=o.x,this.y+=o.y,this.z+=o.z,this}addScalar(o){return this.x+=o,this.y+=o,this.z+=o,this}addVectors(o,u){return this.x=o.x+u.x,this.y=o.y+u.y,this.z=o.z+u.z,this}addScaledVector(o,u){return this.x+=o.x*u,this.y+=o.y*u,this.z+=o.z*u,this}sub(o){return this.x-=o.x,this.y-=o.y,this.z-=o.z,this}subScalar(o){return this.x-=o,this.y-=o,this.z-=o,this}subVectors(o,u){return this.x=o.x-u.x,this.y=o.y-u.y,this.z=o.z-u.z,this}multiply(o){return this.x*=o.x,this.y*=o.y,this.z*=o.z,this}multiplyScalar(o){return this.x*=o,this.y*=o,this.z*=o,this}multiplyVectors(o,u){return this.x=o.x*u.x,this.y=o.y*u.y,this.z=o.z*u.z,this}applyEuler(o){return this.applyQuaternion(hW.setFromEuler(o))}applyAxisAngle(o,u){return this.applyQuaternion(hW.setFromAxisAngle(o,u))}applyMatrix3(o){const u=this.x,s=this.y,r=this.z,l=o.elements;return this.x=l[0]*u+l[3]*s+l[6]*r,this.y=l[1]*u+l[4]*s+l[7]*r,this.z=l[2]*u+l[5]*s+l[8]*r,this}applyNormalMatrix(o){return this.applyMatrix3(o).normalize()}applyMatrix4(o){const u=this.x,s=this.y,r=this.z,l=o.elements,C=1/(l[3]*u+l[7]*s+l[11]*r+l[15]);return this.x=(l[0]*u+l[4]*s+l[8]*r+l[12])*C,this.y=(l[1]*u+l[5]*s+l[9]*r+l[13])*C,this.z=(l[2]*u+l[6]*s+l[10]*r+l[14])*C,this}applyQuaternion(o){const u=this.x,s=this.y,r=this.z,l=o.x,C=o.y,S=o.z,O=o.w,U=O*u+C*r-S*s,j=O*s+S*u-l*r,N=O*r+l*s-C*u,L=-l*u-C*s-S*r;return this.x=U*O+L*-l+j*-S-N*-C,this.y=j*O+L*-C+N*-l-U*-S,this.z=N*O+L*-S+U*-C-j*-l,this}project(o){return this.applyMatrix4(o.matrixWorldInverse).applyMatrix4(o.projectionMatrix)}unproject(o){return this.applyMatrix4(o.projectionMatrixInverse).applyMatrix4(o.matrixWorld)}transformDirection(o){const u=this.x,s=this.y,r=this.z,l=o.elements;return this.x=l[0]*u+l[4]*s+l[8]*r,this.y=l[1]*u+l[5]*s+l[9]*r,this.z=l[2]*u+l[6]*s+l[10]*r,this.normalize()}divide(o){return this.x/=o.x,this.y/=o.y,this.z/=o.z,this}divideScalar(o){return this.multiplyScalar(1/o)}min(o){return this.x=Math.min(this.x,o.x),this.y=Math.min(this.y,o.y),this.z=Math.min(this.z,o.z),this}max(o){return this.x=Math.max(this.x,o.x),this.y=Math.max(this.y,o.y),this.z=Math.max(this.z,o.z),this}clamp(o,u){return this.x=Math.max(o.x,Math.min(u.x,this.x)),this.y=Math.max(o.y,Math.min(u.y,this.y)),this.z=Math.max(o.z,Math.min(u.z,this.z)),this}clampScalar(o,u){return this.x=Math.max(o,Math.min(u,this.x)),this.y=Math.max(o,Math.min(u,this.y)),this.z=Math.max(o,Math.min(u,this.z)),this}clampLength(o,u){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(o,Math.min(u,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(o){return this.x*o.x+this.y*o.y+this.z*o.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(o){return this.normalize().multiplyScalar(o)}lerp(o,u){return this.x+=(o.x-this.x)*u,this.y+=(o.y-this.y)*u,this.z+=(o.z-this.z)*u,this}lerpVectors(o,u,s){return this.x=o.x+(u.x-o.x)*s,this.y=o.y+(u.y-o.y)*s,this.z=o.z+(u.z-o.z)*s,this}cross(o){return this.crossVectors(this,o)}crossVectors(o,u){const s=o.x,r=o.y,l=o.z,C=u.x,S=u.y,O=u.z;return this.x=r*O-l*S,this.y=l*C-s*O,this.z=s*S-r*C,this}projectOnVector(o){const u=o.lengthSq();if(u===0)return this.set(0,0,0);const s=o.dot(this)/u;return this.copy(o).multiplyScalar(s)}projectOnPlane(o){return RI.copy(this).projectOnVector(o),this.sub(RI)}reflect(o){return this.sub(RI.copy(o).multiplyScalar(2*this.dot(o)))}angleTo(o){const u=Math.sqrt(this.lengthSq()*o.lengthSq());if(u===0)return Math.PI/2;const s=this.dot(o)/u;return Math.acos(zm(s,-1,1))}distanceTo(o){return Math.sqrt(this.distanceToSquared(o))}distanceToSquared(o){const u=this.x-o.x,s=this.y-o.y,r=this.z-o.z;return u*u+s*s+r*r}manhattanDistanceTo(o){return Math.abs(this.x-o.x)+Math.abs(this.y-o.y)+Math.abs(this.z-o.z)}setFromSpherical(o){return this.setFromSphericalCoords(o.radius,o.phi,o.theta)}setFromSphericalCoords(o,u,s){const r=Math.sin(u)*o;return this.x=r*Math.sin(s),this.y=Math.cos(u)*o,this.z=r*Math.cos(s),this}setFromCylindrical(o){return this.setFromCylindricalCoords(o.radius,o.theta,o.y)}setFromCylindricalCoords(o,u,s){return this.x=o*Math.sin(u),this.y=s,this.z=o*Math.cos(u),this}setFromMatrixPosition(o){const u=o.elements;return this.x=u[12],this.y=u[13],this.z=u[14],this}setFromMatrixScale(o){const u=this.setFromMatrixColumn(o,0).length(),s=this.setFromMatrixColumn(o,1).length(),r=this.setFromMatrixColumn(o,2).length();return this.x=u,this.y=s,this.z=r,this}setFromMatrixColumn(o,u){return this.fromArray(o.elements,u*4)}setFromMatrix3Column(o,u){return this.fromArray(o.elements,u*3)}setFromEuler(o){return this.x=o._x,this.y=o._y,this.z=o._z,this}equals(o){return o.x===this.x&&o.y===this.y&&o.z===this.z}fromArray(o,u=0){return this.x=o[u],this.y=o[u+1],this.z=o[u+2],this}toArray(o=[],u=0){return o[u]=this.x,o[u+1]=this.y,o[u+2]=this.z,o}fromBufferAttribute(o,u){return this.x=o.getX(u),this.y=o.getY(u),this.z=o.getZ(u),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const o=(Math.random()-.5)*2,u=Math.random()*Math.PI*2,s=Math.sqrt(1-o**2);return this.x=s*Math.cos(u),this.y=s*Math.sin(u),this.z=o,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const RI=new hr,hW=new KS;class YS{constructor(o=new hr(1/0,1/0,1/0),u=new hr(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=o,this.max=u}set(o,u){return this.min.copy(o),this.max.copy(u),this}setFromArray(o){let u=1/0,s=1/0,r=1/0,l=-1/0,C=-1/0,S=-1/0;for(let O=0,U=o.length;O<U;O+=3){const j=o[O],N=o[O+1],L=o[O+2];j<u&&(u=j),N<s&&(s=N),L<r&&(r=L),j>l&&(l=j),N>C&&(C=N),L>S&&(S=L)}return this.min.set(u,s,r),this.max.set(l,C,S),this}setFromBufferAttribute(o){let u=1/0,s=1/0,r=1/0,l=-1/0,C=-1/0,S=-1/0;for(let O=0,U=o.count;O<U;O++){const j=o.getX(O),N=o.getY(O),L=o.getZ(O);j<u&&(u=j),N<s&&(s=N),L<r&&(r=L),j>l&&(l=j),N>C&&(C=N),L>S&&(S=L)}return this.min.set(u,s,r),this.max.set(l,C,S),this}setFromPoints(o){this.makeEmpty();for(let u=0,s=o.length;u<s;u++)this.expandByPoint(o[u]);return this}setFromCenterAndSize(o,u){const s=Px.copy(u).multiplyScalar(.5);return this.min.copy(o).sub(s),this.max.copy(o).add(s),this}setFromObject(o,u=!1){return this.makeEmpty(),this.expandByObject(o,u)}clone(){return new this.constructor().copy(this)}copy(o){return this.min.copy(o.min),this.max.copy(o.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(o){return this.isEmpty()?o.set(0,0,0):o.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(o){return this.isEmpty()?o.set(0,0,0):o.subVectors(this.max,this.min)}expandByPoint(o){return this.min.min(o),this.max.max(o),this}expandByVector(o){return this.min.sub(o),this.max.add(o),this}expandByScalar(o){return this.min.addScalar(-o),this.max.addScalar(o),this}expandByObject(o,u=!1){o.updateWorldMatrix(!1,!1);const s=o.geometry;if(s!==void 0)if(u&&s.attributes!=null&&s.attributes.position!==void 0){const l=s.attributes.position;for(let C=0,S=l.count;C<S;C++)Px.fromBufferAttribute(l,C).applyMatrix4(o.matrixWorld),this.expandByPoint(Px)}else s.boundingBox===null&&s.computeBoundingBox(),PI.copy(s.boundingBox),PI.applyMatrix4(o.matrixWorld),this.union(PI);const r=o.children;for(let l=0,C=r.length;l<C;l++)this.expandByObject(r[l],u);return this}containsPoint(o){return!(o.x<this.min.x||o.x>this.max.x||o.y<this.min.y||o.y>this.max.y||o.z<this.min.z||o.z>this.max.z)}containsBox(o){return this.min.x<=o.min.x&&o.max.x<=this.max.x&&this.min.y<=o.min.y&&o.max.y<=this.max.y&&this.min.z<=o.min.z&&o.max.z<=this.max.z}getParameter(o,u){return u.set((o.x-this.min.x)/(this.max.x-this.min.x),(o.y-this.min.y)/(this.max.y-this.min.y),(o.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(o){return!(o.max.x<this.min.x||o.min.x>this.max.x||o.max.y<this.min.y||o.min.y>this.max.y||o.max.z<this.min.z||o.min.z>this.max.z)}intersectsSphere(o){return this.clampPoint(o.center,Px),Px.distanceToSquared(o.center)<=o.radius*o.radius}intersectsPlane(o){let u,s;return o.normal.x>0?(u=o.normal.x*this.min.x,s=o.normal.x*this.max.x):(u=o.normal.x*this.max.x,s=o.normal.x*this.min.x),o.normal.y>0?(u+=o.normal.y*this.min.y,s+=o.normal.y*this.max.y):(u+=o.normal.y*this.max.y,s+=o.normal.y*this.min.y),o.normal.z>0?(u+=o.normal.z*this.min.z,s+=o.normal.z*this.max.z):(u+=o.normal.z*this.max.z,s+=o.normal.z*this.min.z),u<=-o.constant&&s>=-o.constant}intersectsTriangle(o){if(this.isEmpty())return!1;this.getCenter(QE),NA.subVectors(this.max,QE),a2.subVectors(o.a,QE),s2.subVectors(o.b,QE),u2.subVectors(o.c,QE),Eb.subVectors(s2,a2),Sb.subVectors(u2,s2),Lx.subVectors(a2,u2);let u=[0,-Eb.z,Eb.y,0,-Sb.z,Sb.y,0,-Lx.z,Lx.y,Eb.z,0,-Eb.x,Sb.z,0,-Sb.x,Lx.z,0,-Lx.x,-Eb.y,Eb.x,0,-Sb.y,Sb.x,0,-Lx.y,Lx.x,0];return!LI(u,a2,s2,u2,NA)||(u=[1,0,0,0,1,0,0,0,1],!LI(u,a2,s2,u2,NA))?!1:(IA.crossVectors(Eb,Sb),u=[IA.x,IA.y,IA.z],LI(u,a2,s2,u2,NA))}clampPoint(o,u){return u.copy(o).clamp(this.min,this.max)}distanceToPoint(o){return Px.copy(o).clamp(this.min,this.max).sub(o).length()}getBoundingSphere(o){return this.getCenter(o.center),o.radius=this.getSize(Px).length()*.5,o}intersect(o){return this.min.max(o.min),this.max.min(o.max),this.isEmpty()&&this.makeEmpty(),this}union(o){return this.min.min(o.min),this.max.max(o.max),this}applyMatrix4(o){return this.isEmpty()?this:(h1[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(o),h1[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(o),h1[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(o),h1[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(o),h1[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(o),h1[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(o),h1[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(o),h1[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(o),this.setFromPoints(h1),this)}translate(o){return this.min.add(o),this.max.add(o),this}equals(o){return o.min.equals(this.min)&&o.max.equals(this.max)}}const h1=[new hr,new hr,new hr,new hr,new hr,new hr,new hr,new hr],Px=new hr,PI=new YS,a2=new hr,s2=new hr,u2=new hr,Eb=new hr,Sb=new hr,Lx=new hr,QE=new hr,NA=new hr,IA=new hr,Bx=new hr;function LI(p,o,u,s,r){for(let l=0,C=p.length-3;l<=C;l+=3){Bx.fromArray(p,l);const S=r.x*Math.abs(Bx.x)+r.y*Math.abs(Bx.y)+r.z*Math.abs(Bx.z),O=o.dot(Bx),U=u.dot(Bx),j=s.dot(Bx);if(Math.max(-Math.max(O,U,j),Math.min(O,U,j))>S)return!1}return!0}const pue=new YS,ZE=new hr,BI=new hr;class nT{constructor(o=new hr,u=-1){this.center=o,this.radius=u}set(o,u){return this.center.copy(o),this.radius=u,this}setFromPoints(o,u){const s=this.center;u!==void 0?s.copy(u):pue.setFromPoints(o).getCenter(s);let r=0;for(let l=0,C=o.length;l<C;l++)r=Math.max(r,s.distanceToSquared(o[l]));return this.radius=Math.sqrt(r),this}copy(o){return this.center.copy(o.center),this.radius=o.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(o){return o.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(o){return o.distanceTo(this.center)-this.radius}intersectsSphere(o){const u=this.radius+o.radius;return o.center.distanceToSquared(this.center)<=u*u}intersectsBox(o){return o.intersectsSphere(this)}intersectsPlane(o){return Math.abs(o.distanceToPoint(this.center))<=this.radius}clampPoint(o,u){const s=this.center.distanceToSquared(o);return u.copy(o),s>this.radius*this.radius&&(u.sub(this.center).normalize(),u.multiplyScalar(this.radius).add(this.center)),u}getBoundingBox(o){return this.isEmpty()?(o.makeEmpty(),o):(o.set(this.center,this.center),o.expandByScalar(this.radius),o)}applyMatrix4(o){return this.center.applyMatrix4(o),this.radius=this.radius*o.getMaxScaleOnAxis(),this}translate(o){return this.center.add(o),this}expandByPoint(o){if(this.isEmpty())return this.center.copy(o),this.radius=0,this;ZE.subVectors(o,this.center);const u=ZE.lengthSq();if(u>this.radius*this.radius){const s=Math.sqrt(u),r=(s-this.radius)*.5;this.center.addScaledVector(ZE,r/s),this.radius+=r}return this}union(o){return o.isEmpty()?this:this.isEmpty()?(this.copy(o),this):(this.center.equals(o.center)===!0?this.radius=Math.max(this.radius,o.radius):(BI.subVectors(o.center,this.center).setLength(o.radius),this.expandByPoint(ZE.copy(o.center).add(BI)),this.expandByPoint(ZE.copy(o.center).sub(BI))),this)}equals(o){return o.center.equals(this.center)&&o.radius===this.radius}clone(){return new this.constructor().copy(this)}}const p1=new hr,jI=new hr,FA=new hr,kb=new hr,zI=new hr,RA=new hr,UI=new hr;class SG{constructor(o=new hr,u=new hr(0,0,-1)){this.origin=o,this.direction=u}set(o,u){return this.origin.copy(o),this.direction.copy(u),this}copy(o){return this.origin.copy(o.origin),this.direction.copy(o.direction),this}at(o,u){return u.copy(this.direction).multiplyScalar(o).add(this.origin)}lookAt(o){return this.direction.copy(o).sub(this.origin).normalize(),this}recast(o){return this.origin.copy(this.at(o,p1)),this}closestPointToPoint(o,u){u.subVectors(o,this.origin);const s=u.dot(this.direction);return s<0?u.copy(this.origin):u.copy(this.direction).multiplyScalar(s).add(this.origin)}distanceToPoint(o){return Math.sqrt(this.distanceSqToPoint(o))}distanceSqToPoint(o){const u=p1.subVectors(o,this.origin).dot(this.direction);return u<0?this.origin.distanceToSquared(o):(p1.copy(this.direction).multiplyScalar(u).add(this.origin),p1.distanceToSquared(o))}distanceSqToSegment(o,u,s,r){jI.copy(o).add(u).multiplyScalar(.5),FA.copy(u).sub(o).normalize(),kb.copy(this.origin).sub(jI);const l=o.distanceTo(u)*.5,C=-this.direction.dot(FA),S=kb.dot(this.direction),O=-kb.dot(FA),U=kb.lengthSq(),j=Math.abs(1-C*C);let N,L,W,z;if(j>0)if(N=C*O-S,L=C*S-O,z=l*j,N>=0)if(L>=-z)if(L<=z){const q=1/j;N*=q,L*=q,W=N*(N+C*L+2*S)+L*(C*N+L+2*O)+U}else L=l,N=Math.max(0,-(C*L+S)),W=-N*N+L*(L+2*O)+U;else L=-l,N=Math.max(0,-(C*L+S)),W=-N*N+L*(L+2*O)+U;else L<=-z?(N=Math.max(0,-(-C*l+S)),L=N>0?-l:Math.min(Math.max(-l,-O),l),W=-N*N+L*(L+2*O)+U):L<=z?(N=0,L=Math.min(Math.max(-l,-O),l),W=L*(L+2*O)+U):(N=Math.max(0,-(C*l+S)),L=N>0?l:Math.min(Math.max(-l,-O),l),W=-N*N+L*(L+2*O)+U);else L=C>0?-l:l,N=Math.max(0,-(C*L+S)),W=-N*N+L*(L+2*O)+U;return s&&s.copy(this.direction).multiplyScalar(N).add(this.origin),r&&r.copy(FA).multiplyScalar(L).add(jI),W}intersectSphere(o,u){p1.subVectors(o.center,this.origin);const s=p1.dot(this.direction),r=p1.dot(p1)-s*s,l=o.radius*o.radius;if(r>l)return null;const C=Math.sqrt(l-r),S=s-C,O=s+C;return S<0&&O<0?null:S<0?this.at(O,u):this.at(S,u)}intersectsSphere(o){return this.distanceSqToPoint(o.center)<=o.radius*o.radius}distanceToPlane(o){const u=o.normal.dot(this.direction);if(u===0)return o.distanceToPoint(this.origin)===0?0:null;const s=-(this.origin.dot(o.normal)+o.constant)/u;return s>=0?s:null}intersectPlane(o,u){const s=this.distanceToPlane(o);return s===null?null:this.at(s,u)}intersectsPlane(o){const u=o.distanceToPoint(this.origin);return u===0||o.normal.dot(this.direction)*u<0}intersectBox(o,u){let s,r,l,C,S,O;const U=1/this.direction.x,j=1/this.direction.y,N=1/this.direction.z,L=this.origin;return U>=0?(s=(o.min.x-L.x)*U,r=(o.max.x-L.x)*U):(s=(o.max.x-L.x)*U,r=(o.min.x-L.x)*U),j>=0?(l=(o.min.y-L.y)*j,C=(o.max.y-L.y)*j):(l=(o.max.y-L.y)*j,C=(o.min.y-L.y)*j),s>C||l>r||((l>s||isNaN(s))&&(s=l),(C<r||isNaN(r))&&(r=C),N>=0?(S=(o.min.z-L.z)*N,O=(o.max.z-L.z)*N):(S=(o.max.z-L.z)*N,O=(o.min.z-L.z)*N),s>O||S>r)||((S>s||s!==s)&&(s=S),(O<r||r!==r)&&(r=O),r<0)?null:this.at(s>=0?s:r,u)}intersectsBox(o){return this.intersectBox(o,p1)!==null}intersectTriangle(o,u,s,r,l){zI.subVectors(u,o),RA.subVectors(s,o),UI.crossVectors(zI,RA);let C=this.direction.dot(UI),S;if(C>0){if(r)return null;S=1}else if(C<0)S=-1,C=-C;else return null;kb.subVectors(this.origin,o);const O=S*this.direction.dot(RA.crossVectors(kb,RA));if(O<0)return null;const U=S*this.direction.dot(zI.cross(kb));if(U<0||O+U>C)return null;const j=-S*kb.dot(UI);return j<0?null:this.at(j/C,l)}applyMatrix4(o){return this.origin.applyMatrix4(o),this.direction.transformDirection(o),this}equals(o){return o.origin.equals(this.origin)&&o.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class ac{constructor(){ac.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(o,u,s,r,l,C,S,O,U,j,N,L,W,z,q,I){const Z=this.elements;return Z[0]=o,Z[4]=u,Z[8]=s,Z[12]=r,Z[1]=l,Z[5]=C,Z[9]=S,Z[13]=O,Z[2]=U,Z[6]=j,Z[10]=N,Z[14]=L,Z[3]=W,Z[7]=z,Z[11]=q,Z[15]=I,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ac().fromArray(this.elements)}copy(o){const u=this.elements,s=o.elements;return u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15],this}copyPosition(o){const u=this.elements,s=o.elements;return u[12]=s[12],u[13]=s[13],u[14]=s[14],this}setFromMatrix3(o){const u=o.elements;return this.set(u[0],u[3],u[6],0,u[1],u[4],u[7],0,u[2],u[5],u[8],0,0,0,0,1),this}extractBasis(o,u,s){return o.setFromMatrixColumn(this,0),u.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(o,u,s){return this.set(o.x,u.x,s.x,0,o.y,u.y,s.y,0,o.z,u.z,s.z,0,0,0,0,1),this}extractRotation(o){const u=this.elements,s=o.elements,r=1/c2.setFromMatrixColumn(o,0).length(),l=1/c2.setFromMatrixColumn(o,1).length(),C=1/c2.setFromMatrixColumn(o,2).length();return u[0]=s[0]*r,u[1]=s[1]*r,u[2]=s[2]*r,u[3]=0,u[4]=s[4]*l,u[5]=s[5]*l,u[6]=s[6]*l,u[7]=0,u[8]=s[8]*C,u[9]=s[9]*C,u[10]=s[10]*C,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,this}makeRotationFromEuler(o){const u=this.elements,s=o.x,r=o.y,l=o.z,C=Math.cos(s),S=Math.sin(s),O=Math.cos(r),U=Math.sin(r),j=Math.cos(l),N=Math.sin(l);if(o.order==="XYZ"){const L=C*j,W=C*N,z=S*j,q=S*N;u[0]=O*j,u[4]=-O*N,u[8]=U,u[1]=W+z*U,u[5]=L-q*U,u[9]=-S*O,u[2]=q-L*U,u[6]=z+W*U,u[10]=C*O}else if(o.order==="YXZ"){const L=O*j,W=O*N,z=U*j,q=U*N;u[0]=L+q*S,u[4]=z*S-W,u[8]=C*U,u[1]=C*N,u[5]=C*j,u[9]=-S,u[2]=W*S-z,u[6]=q+L*S,u[10]=C*O}else if(o.order==="ZXY"){const L=O*j,W=O*N,z=U*j,q=U*N;u[0]=L-q*S,u[4]=-C*N,u[8]=z+W*S,u[1]=W+z*S,u[5]=C*j,u[9]=q-L*S,u[2]=-C*U,u[6]=S,u[10]=C*O}else if(o.order==="ZYX"){const L=C*j,W=C*N,z=S*j,q=S*N;u[0]=O*j,u[4]=z*U-W,u[8]=L*U+q,u[1]=O*N,u[5]=q*U+L,u[9]=W*U-z,u[2]=-U,u[6]=S*O,u[10]=C*O}else if(o.order==="YZX"){const L=C*O,W=C*U,z=S*O,q=S*U;u[0]=O*j,u[4]=q-L*N,u[8]=z*N+W,u[1]=N,u[5]=C*j,u[9]=-S*j,u[2]=-U*j,u[6]=W*N+z,u[10]=L-q*N}else if(o.order==="XZY"){const L=C*O,W=C*U,z=S*O,q=S*U;u[0]=O*j,u[4]=-N,u[8]=U*j,u[1]=L*N+q,u[5]=C*j,u[9]=W*N-z,u[2]=z*N-W,u[6]=S*j,u[10]=q*N+L}return u[3]=0,u[7]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,this}makeRotationFromQuaternion(o){return this.compose(mue,o,gue)}lookAt(o,u,s){const r=this.elements;return Lm.subVectors(o,u),Lm.lengthSq()===0&&(Lm.z=1),Lm.normalize(),Cb.crossVectors(s,Lm),Cb.lengthSq()===0&&(Math.abs(s.z)===1?Lm.x+=1e-4:Lm.z+=1e-4,Lm.normalize(),Cb.crossVectors(s,Lm)),Cb.normalize(),PA.crossVectors(Lm,Cb),r[0]=Cb.x,r[4]=PA.x,r[8]=Lm.x,r[1]=Cb.y,r[5]=PA.y,r[9]=Lm.y,r[2]=Cb.z,r[6]=PA.z,r[10]=Lm.z,this}multiply(o){return this.multiplyMatrices(this,o)}premultiply(o){return this.multiplyMatrices(o,this)}multiplyMatrices(o,u){const s=o.elements,r=u.elements,l=this.elements,C=s[0],S=s[4],O=s[8],U=s[12],j=s[1],N=s[5],L=s[9],W=s[13],z=s[2],q=s[6],I=s[10],Z=s[14],Y=s[3],G=s[7],oe=s[11],ce=s[15],be=r[0],Ee=r[4],ve=r[8],ge=r[12],Ge=r[1],ht=r[5],It=r[9],St=r[13],we=r[2],bt=r[6],jt=r[10],Mt=r[14],ze=r[3],Ut=r[7],Ft=r[11],pt=r[15];return l[0]=C*be+S*Ge+O*we+U*ze,l[4]=C*Ee+S*ht+O*bt+U*Ut,l[8]=C*ve+S*It+O*jt+U*Ft,l[12]=C*ge+S*St+O*Mt+U*pt,l[1]=j*be+N*Ge+L*we+W*ze,l[5]=j*Ee+N*ht+L*bt+W*Ut,l[9]=j*ve+N*It+L*jt+W*Ft,l[13]=j*ge+N*St+L*Mt+W*pt,l[2]=z*be+q*Ge+I*we+Z*ze,l[6]=z*Ee+q*ht+I*bt+Z*Ut,l[10]=z*ve+q*It+I*jt+Z*Ft,l[14]=z*ge+q*St+I*Mt+Z*pt,l[3]=Y*be+G*Ge+oe*we+ce*ze,l[7]=Y*Ee+G*ht+oe*bt+ce*Ut,l[11]=Y*ve+G*It+oe*jt+ce*Ft,l[15]=Y*ge+G*St+oe*Mt+ce*pt,this}multiplyScalar(o){const u=this.elements;return u[0]*=o,u[4]*=o,u[8]*=o,u[12]*=o,u[1]*=o,u[5]*=o,u[9]*=o,u[13]*=o,u[2]*=o,u[6]*=o,u[10]*=o,u[14]*=o,u[3]*=o,u[7]*=o,u[11]*=o,u[15]*=o,this}determinant(){const o=this.elements,u=o[0],s=o[4],r=o[8],l=o[12],C=o[1],S=o[5],O=o[9],U=o[13],j=o[2],N=o[6],L=o[10],W=o[14],z=o[3],q=o[7],I=o[11],Z=o[15];return z*(+l*O*N-r*U*N-l*S*L+s*U*L+r*S*W-s*O*W)+q*(+u*O*W-u*U*L+l*C*L-r*C*W+r*U*j-l*O*j)+I*(+u*U*N-u*S*W-l*C*N+s*C*W+l*S*j-s*U*j)+Z*(-r*S*j-u*O*N+u*S*L+r*C*N-s*C*L+s*O*j)}transpose(){const o=this.elements;let u;return u=o[1],o[1]=o[4],o[4]=u,u=o[2],o[2]=o[8],o[8]=u,u=o[6],o[6]=o[9],o[9]=u,u=o[3],o[3]=o[12],o[12]=u,u=o[7],o[7]=o[13],o[13]=u,u=o[11],o[11]=o[14],o[14]=u,this}setPosition(o,u,s){const r=this.elements;return o.isVector3?(r[12]=o.x,r[13]=o.y,r[14]=o.z):(r[12]=o,r[13]=u,r[14]=s),this}invert(){const o=this.elements,u=o[0],s=o[1],r=o[2],l=o[3],C=o[4],S=o[5],O=o[6],U=o[7],j=o[8],N=o[9],L=o[10],W=o[11],z=o[12],q=o[13],I=o[14],Z=o[15],Y=N*I*U-q*L*U+q*O*W-S*I*W-N*O*Z+S*L*Z,G=z*L*U-j*I*U-z*O*W+C*I*W+j*O*Z-C*L*Z,oe=j*q*U-z*N*U+z*S*W-C*q*W-j*S*Z+C*N*Z,ce=z*N*O-j*q*O-z*S*L+C*q*L+j*S*I-C*N*I,be=u*Y+s*G+r*oe+l*ce;if(be===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Ee=1/be;return o[0]=Y*Ee,o[1]=(q*L*l-N*I*l-q*r*W+s*I*W+N*r*Z-s*L*Z)*Ee,o[2]=(S*I*l-q*O*l+q*r*U-s*I*U-S*r*Z+s*O*Z)*Ee,o[3]=(N*O*l-S*L*l-N*r*U+s*L*U+S*r*W-s*O*W)*Ee,o[4]=G*Ee,o[5]=(j*I*l-z*L*l+z*r*W-u*I*W-j*r*Z+u*L*Z)*Ee,o[6]=(z*O*l-C*I*l-z*r*U+u*I*U+C*r*Z-u*O*Z)*Ee,o[7]=(C*L*l-j*O*l+j*r*U-u*L*U-C*r*W+u*O*W)*Ee,o[8]=oe*Ee,o[9]=(z*N*l-j*q*l-z*s*W+u*q*W+j*s*Z-u*N*Z)*Ee,o[10]=(C*q*l-z*S*l+z*s*U-u*q*U-C*s*Z+u*S*Z)*Ee,o[11]=(j*S*l-C*N*l-j*s*U+u*N*U+C*s*W-u*S*W)*Ee,o[12]=ce*Ee,o[13]=(j*q*r-z*N*r+z*s*L-u*q*L-j*s*I+u*N*I)*Ee,o[14]=(z*S*r-C*q*r-z*s*O+u*q*O+C*s*I-u*S*I)*Ee,o[15]=(C*N*r-j*S*r+j*s*O-u*N*O-C*s*L+u*S*L)*Ee,this}scale(o){const u=this.elements,s=o.x,r=o.y,l=o.z;return u[0]*=s,u[4]*=r,u[8]*=l,u[1]*=s,u[5]*=r,u[9]*=l,u[2]*=s,u[6]*=r,u[10]*=l,u[3]*=s,u[7]*=r,u[11]*=l,this}getMaxScaleOnAxis(){const o=this.elements,u=o[0]*o[0]+o[1]*o[1]+o[2]*o[2],s=o[4]*o[4]+o[5]*o[5]+o[6]*o[6],r=o[8]*o[8]+o[9]*o[9]+o[10]*o[10];return Math.sqrt(Math.max(u,s,r))}makeTranslation(o,u,s){return this.set(1,0,0,o,0,1,0,u,0,0,1,s,0,0,0,1),this}makeRotationX(o){const u=Math.cos(o),s=Math.sin(o);return this.set(1,0,0,0,0,u,-s,0,0,s,u,0,0,0,0,1),this}makeRotationY(o){const u=Math.cos(o),s=Math.sin(o);return this.set(u,0,s,0,0,1,0,0,-s,0,u,0,0,0,0,1),this}makeRotationZ(o){const u=Math.cos(o),s=Math.sin(o);return this.set(u,-s,0,0,s,u,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(o,u){const s=Math.cos(u),r=Math.sin(u),l=1-s,C=o.x,S=o.y,O=o.z,U=l*C,j=l*S;return this.set(U*C+s,U*S-r*O,U*O+r*S,0,U*S+r*O,j*S+s,j*O-r*C,0,U*O-r*S,j*O+r*C,l*O*O+s,0,0,0,0,1),this}makeScale(o,u,s){return this.set(o,0,0,0,0,u,0,0,0,0,s,0,0,0,0,1),this}makeShear(o,u,s,r,l,C){return this.set(1,s,l,0,o,1,C,0,u,r,1,0,0,0,0,1),this}compose(o,u,s){const r=this.elements,l=u._x,C=u._y,S=u._z,O=u._w,U=l+l,j=C+C,N=S+S,L=l*U,W=l*j,z=l*N,q=C*j,I=C*N,Z=S*N,Y=O*U,G=O*j,oe=O*N,ce=s.x,be=s.y,Ee=s.z;return r[0]=(1-(q+Z))*ce,r[1]=(W+oe)*ce,r[2]=(z-G)*ce,r[3]=0,r[4]=(W-oe)*be,r[5]=(1-(L+Z))*be,r[6]=(I+Y)*be,r[7]=0,r[8]=(z+G)*Ee,r[9]=(I-Y)*Ee,r[10]=(1-(L+q))*Ee,r[11]=0,r[12]=o.x,r[13]=o.y,r[14]=o.z,r[15]=1,this}decompose(o,u,s){const r=this.elements;let l=c2.set(r[0],r[1],r[2]).length();const C=c2.set(r[4],r[5],r[6]).length(),S=c2.set(r[8],r[9],r[10]).length();this.determinant()<0&&(l=-l),o.x=r[12],o.y=r[13],o.z=r[14],G0.copy(this);const U=1/l,j=1/C,N=1/S;return G0.elements[0]*=U,G0.elements[1]*=U,G0.elements[2]*=U,G0.elements[4]*=j,G0.elements[5]*=j,G0.elements[6]*=j,G0.elements[8]*=N,G0.elements[9]*=N,G0.elements[10]*=N,u.setFromRotationMatrix(G0),s.x=l,s.y=C,s.z=S,this}makePerspective(o,u,s,r,l,C){const S=this.elements,O=2*l/(u-o),U=2*l/(s-r),j=(u+o)/(u-o),N=(s+r)/(s-r),L=-(C+l)/(C-l),W=-2*C*l/(C-l);return S[0]=O,S[4]=0,S[8]=j,S[12]=0,S[1]=0,S[5]=U,S[9]=N,S[13]=0,S[2]=0,S[6]=0,S[10]=L,S[14]=W,S[3]=0,S[7]=0,S[11]=-1,S[15]=0,this}makeOrthographic(o,u,s,r,l,C){const S=this.elements,O=1/(u-o),U=1/(s-r),j=1/(C-l),N=(u+o)*O,L=(s+r)*U,W=(C+l)*j;return S[0]=2*O,S[4]=0,S[8]=0,S[12]=-N,S[1]=0,S[5]=2*U,S[9]=0,S[13]=-L,S[2]=0,S[6]=0,S[10]=-2*j,S[14]=-W,S[3]=0,S[7]=0,S[11]=0,S[15]=1,this}equals(o){const u=this.elements,s=o.elements;for(let r=0;r<16;r++)if(u[r]!==s[r])return!1;return!0}fromArray(o,u=0){for(let s=0;s<16;s++)this.elements[s]=o[s+u];return this}toArray(o=[],u=0){const s=this.elements;return o[u]=s[0],o[u+1]=s[1],o[u+2]=s[2],o[u+3]=s[3],o[u+4]=s[4],o[u+5]=s[5],o[u+6]=s[6],o[u+7]=s[7],o[u+8]=s[8],o[u+9]=s[9],o[u+10]=s[10],o[u+11]=s[11],o[u+12]=s[12],o[u+13]=s[13],o[u+14]=s[14],o[u+15]=s[15],o}}const c2=new hr,G0=new ac,mue=new hr(0,0,0),gue=new hr(1,1,1),Cb=new hr,PA=new hr,Lm=new hr,pW=new ac,mW=new KS;class JS{constructor(o=0,u=0,s=0,r=JS.DefaultOrder){this.isEuler=!0,this._x=o,this._y=u,this._z=s,this._order=r}get x(){return this._x}set x(o){this._x=o,this._onChangeCallback()}get y(){return this._y}set y(o){this._y=o,this._onChangeCallback()}get z(){return this._z}set z(o){this._z=o,this._onChangeCallback()}get order(){return this._order}set order(o){this._order=o,this._onChangeCallback()}set(o,u,s,r=this._order){return this._x=o,this._y=u,this._z=s,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(o){return this._x=o._x,this._y=o._y,this._z=o._z,this._order=o._order,this._onChangeCallback(),this}setFromRotationMatrix(o,u=this._order,s=!0){const r=o.elements,l=r[0],C=r[4],S=r[8],O=r[1],U=r[5],j=r[9],N=r[2],L=r[6],W=r[10];switch(u){case"XYZ":this._y=Math.asin(zm(S,-1,1)),Math.abs(S)<.9999999?(this._x=Math.atan2(-j,W),this._z=Math.atan2(-C,l)):(this._x=Math.atan2(L,U),this._z=0);break;case"YXZ":this._x=Math.asin(-zm(j,-1,1)),Math.abs(j)<.9999999?(this._y=Math.atan2(S,W),this._z=Math.atan2(O,U)):(this._y=Math.atan2(-N,l),this._z=0);break;case"ZXY":this._x=Math.asin(zm(L,-1,1)),Math.abs(L)<.9999999?(this._y=Math.atan2(-N,W),this._z=Math.atan2(-C,U)):(this._y=0,this._z=Math.atan2(O,l));break;case"ZYX":this._y=Math.asin(-zm(N,-1,1)),Math.abs(N)<.9999999?(this._x=Math.atan2(L,W),this._z=Math.atan2(O,l)):(this._x=0,this._z=Math.atan2(-C,U));break;case"YZX":this._z=Math.asin(zm(O,-1,1)),Math.abs(O)<.9999999?(this._x=Math.atan2(-j,U),this._y=Math.atan2(-N,l)):(this._x=0,this._y=Math.atan2(S,W));break;case"XZY":this._z=Math.asin(-zm(C,-1,1)),Math.abs(C)<.9999999?(this._x=Math.atan2(L,U),this._y=Math.atan2(S,l)):(this._x=Math.atan2(-j,W),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+u)}return this._order=u,s===!0&&this._onChangeCallback(),this}setFromQuaternion(o,u,s){return pW.makeRotationFromQuaternion(o),this.setFromRotationMatrix(pW,u,s)}setFromVector3(o,u=this._order){return this.set(o.x,o.y,o.z,u)}reorder(o){return mW.setFromEuler(this),this.setFromQuaternion(mW,o)}equals(o){return o._x===this._x&&o._y===this._y&&o._z===this._z&&o._order===this._order}fromArray(o){return this._x=o[0],this._y=o[1],this._z=o[2],o[3]!==void 0&&(this._order=o[3]),this._onChangeCallback(),this}toArray(o=[],u=0){return o[u]=this._x,o[u+1]=this._y,o[u+2]=this._z,o[u+3]=this._order,o}_onChange(o){return this._onChangeCallback=o,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}JS.DefaultOrder="XYZ";JS.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class kG{constructor(){this.mask=1}set(o){this.mask=(1<<o|0)>>>0}enable(o){this.mask|=1<<o|0}enableAll(){this.mask=-1}toggle(o){this.mask^=1<<o|0}disable(o){this.mask&=~(1<<o|0)}disableAll(){this.mask=0}test(o){return(this.mask&o.mask)!==0}isEnabled(o){return(this.mask&(1<<o|0))!==0}}let vue=0;const gW=new hr,l2=new KS,m1=new ac,LA=new hr,eS=new hr,yue=new hr,bue=new KS,vW=new hr(1,0,0),yW=new hr(0,1,0),bW=new hr(0,0,1),xue={type:"added"},xW={type:"removed"};class od extends t_{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:vue++}),this.uuid=XS(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=od.DefaultUp.clone();const o=new hr,u=new JS,s=new KS,r=new hr(1,1,1);function l(){s.setFromEuler(u,!1)}function C(){u.setFromQuaternion(s,void 0,!1)}u._onChange(l),s._onChange(C),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:o},rotation:{configurable:!0,enumerable:!0,value:u},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new ac},normalMatrix:{value:new Wm}}),this.matrix=new ac,this.matrixWorld=new ac,this.matrixAutoUpdate=od.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=od.DefaultMatrixWorldAutoUpdate,this.layers=new kG,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(o){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(o),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(o){return this.quaternion.premultiply(o),this}setRotationFromAxisAngle(o,u){this.quaternion.setFromAxisAngle(o,u)}setRotationFromEuler(o){this.quaternion.setFromEuler(o,!0)}setRotationFromMatrix(o){this.quaternion.setFromRotationMatrix(o)}setRotationFromQuaternion(o){this.quaternion.copy(o)}rotateOnAxis(o,u){return l2.setFromAxisAngle(o,u),this.quaternion.multiply(l2),this}rotateOnWorldAxis(o,u){return l2.setFromAxisAngle(o,u),this.quaternion.premultiply(l2),this}rotateX(o){return this.rotateOnAxis(vW,o)}rotateY(o){return this.rotateOnAxis(yW,o)}rotateZ(o){return this.rotateOnAxis(bW,o)}translateOnAxis(o,u){return gW.copy(o).applyQuaternion(this.quaternion),this.position.add(gW.multiplyScalar(u)),this}translateX(o){return this.translateOnAxis(vW,o)}translateY(o){return this.translateOnAxis(yW,o)}translateZ(o){return this.translateOnAxis(bW,o)}localToWorld(o){return this.updateWorldMatrix(!0,!1),o.applyMatrix4(this.matrixWorld)}worldToLocal(o){return this.updateWorldMatrix(!0,!1),o.applyMatrix4(m1.copy(this.matrixWorld).invert())}lookAt(o,u,s){o.isVector3?LA.copy(o):LA.set(o,u,s);const r=this.parent;this.updateWorldMatrix(!0,!1),eS.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?m1.lookAt(eS,LA,this.up):m1.lookAt(LA,eS,this.up),this.quaternion.setFromRotationMatrix(m1),r&&(m1.extractRotation(r.matrixWorld),l2.setFromRotationMatrix(m1),this.quaternion.premultiply(l2.invert()))}add(o){if(arguments.length>1){for(let u=0;u<arguments.length;u++)this.add(arguments[u]);return this}return o===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",o),this):(o&&o.isObject3D?(o.parent!==null&&o.parent.remove(o),o.parent=this,this.children.push(o),o.dispatchEvent(xue)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",o),this)}remove(o){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const u=this.children.indexOf(o);return u!==-1&&(o.parent=null,this.children.splice(u,1),o.dispatchEvent(xW)),this}removeFromParent(){const o=this.parent;return o!==null&&o.remove(this),this}clear(){for(let o=0;o<this.children.length;o++){const u=this.children[o];u.parent=null,u.dispatchEvent(xW)}return this.children.length=0,this}attach(o){return this.updateWorldMatrix(!0,!1),m1.copy(this.matrixWorld).invert(),o.parent!==null&&(o.parent.updateWorldMatrix(!0,!1),m1.multiply(o.parent.matrixWorld)),o.applyMatrix4(m1),this.add(o),o.updateWorldMatrix(!1,!0),this}getObjectById(o){return this.getObjectByProperty("id",o)}getObjectByName(o){return this.getObjectByProperty("name",o)}getObjectByProperty(o,u){if(this[o]===u)return this;for(let s=0,r=this.children.length;s<r;s++){const C=this.children[s].getObjectByProperty(o,u);if(C!==void 0)return C}}getObjectsByProperty(o,u){let s=[];this[o]===u&&s.push(this);for(let r=0,l=this.children.length;r<l;r++){const C=this.children[r].getObjectsByProperty(o,u);C.length>0&&(s=s.concat(C))}return s}getWorldPosition(o){return this.updateWorldMatrix(!0,!1),o.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(o){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(eS,o,yue),o}getWorldScale(o){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(eS,bue,o),o}getWorldDirection(o){this.updateWorldMatrix(!0,!1);const u=this.matrixWorld.elements;return o.set(u[8],u[9],u[10]).normalize()}raycast(){}traverse(o){o(this);const u=this.children;for(let s=0,r=u.length;s<r;s++)u[s].traverse(o)}traverseVisible(o){if(this.visible===!1)return;o(this);const u=this.children;for(let s=0,r=u.length;s<r;s++)u[s].traverseVisible(o)}traverseAncestors(o){const u=this.parent;u!==null&&(o(u),u.traverseAncestors(o))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(o){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||o)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,o=!0);const u=this.children;for(let s=0,r=u.length;s<r;s++){const l=u[s];(l.matrixWorldAutoUpdate===!0||o===!0)&&l.updateMatrixWorld(o)}}updateWorldMatrix(o,u){const s=this.parent;if(o===!0&&s!==null&&s.matrixWorldAutoUpdate===!0&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),u===!0){const r=this.children;for(let l=0,C=r.length;l<C;l++){const S=r[l];S.matrixWorldAutoUpdate===!0&&S.updateWorldMatrix(!1,!0)}}}toJSON(o){const u=o===void 0||typeof o=="string",s={};u&&(o={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function l(S,O){return S[O.uuid]===void 0&&(S[O.uuid]=O.toJSON(o)),O.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(o).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(o).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=l(o.geometries,this.geometry);const S=this.geometry.parameters;if(S!==void 0&&S.shapes!==void 0){const O=S.shapes;if(Array.isArray(O))for(let U=0,j=O.length;U<j;U++){const N=O[U];l(o.shapes,N)}else l(o.shapes,O)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(l(o.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const S=[];for(let O=0,U=this.material.length;O<U;O++)S.push(l(o.materials,this.material[O]));r.material=S}else r.material=l(o.materials,this.material);if(this.children.length>0){r.children=[];for(let S=0;S<this.children.length;S++)r.children.push(this.children[S].toJSON(o).object)}if(this.animations.length>0){r.animations=[];for(let S=0;S<this.animations.length;S++){const O=this.animations[S];r.animations.push(l(o.animations,O))}}if(u){const S=C(o.geometries),O=C(o.materials),U=C(o.textures),j=C(o.images),N=C(o.shapes),L=C(o.skeletons),W=C(o.animations),z=C(o.nodes);S.length>0&&(s.geometries=S),O.length>0&&(s.materials=O),U.length>0&&(s.textures=U),j.length>0&&(s.images=j),N.length>0&&(s.shapes=N),L.length>0&&(s.skeletons=L),W.length>0&&(s.animations=W),z.length>0&&(s.nodes=z)}return s.object=r,s;function C(S){const O=[];for(const U in S){const j=S[U];delete j.metadata,O.push(j)}return O}}clone(o){return new this.constructor().copy(this,o)}copy(o,u=!0){if(this.name=o.name,this.up.copy(o.up),this.position.copy(o.position),this.rotation.order=o.rotation.order,this.quaternion.copy(o.quaternion),this.scale.copy(o.scale),this.matrix.copy(o.matrix),this.matrixWorld.copy(o.matrixWorld),this.matrixAutoUpdate=o.matrixAutoUpdate,this.matrixWorldNeedsUpdate=o.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=o.matrixWorldAutoUpdate,this.layers.mask=o.layers.mask,this.visible=o.visible,this.castShadow=o.castShadow,this.receiveShadow=o.receiveShadow,this.frustumCulled=o.frustumCulled,this.renderOrder=o.renderOrder,this.userData=JSON.parse(JSON.stringify(o.userData)),u===!0)for(let s=0;s<o.children.length;s++){const r=o.children[s];this.add(r.clone())}return this}}od.DefaultUp=new hr(0,1,0);od.DefaultMatrixAutoUpdate=!0;od.DefaultMatrixWorldAutoUpdate=!0;const q0=new hr,g1=new hr,WI=new hr,v1=new hr,f2=new hr,d2=new hr,wW=new hr,VI=new hr,HI=new hr,GI=new hr;class w1{constructor(o=new hr,u=new hr,s=new hr){this.a=o,this.b=u,this.c=s}static getNormal(o,u,s,r){r.subVectors(s,u),q0.subVectors(o,u),r.cross(q0);const l=r.lengthSq();return l>0?r.multiplyScalar(1/Math.sqrt(l)):r.set(0,0,0)}static getBarycoord(o,u,s,r,l){q0.subVectors(r,u),g1.subVectors(s,u),WI.subVectors(o,u);const C=q0.dot(q0),S=q0.dot(g1),O=q0.dot(WI),U=g1.dot(g1),j=g1.dot(WI),N=C*U-S*S;if(N===0)return l.set(-2,-1,-1);const L=1/N,W=(U*O-S*j)*L,z=(C*j-S*O)*L;return l.set(1-W-z,z,W)}static containsPoint(o,u,s,r){return this.getBarycoord(o,u,s,r,v1),v1.x>=0&&v1.y>=0&&v1.x+v1.y<=1}static getUV(o,u,s,r,l,C,S,O){return this.getBarycoord(o,u,s,r,v1),O.set(0,0),O.addScaledVector(l,v1.x),O.addScaledVector(C,v1.y),O.addScaledVector(S,v1.z),O}static isFrontFacing(o,u,s,r){return q0.subVectors(s,u),g1.subVectors(o,u),q0.cross(g1).dot(r)<0}set(o,u,s){return this.a.copy(o),this.b.copy(u),this.c.copy(s),this}setFromPointsAndIndices(o,u,s,r){return this.a.copy(o[u]),this.b.copy(o[s]),this.c.copy(o[r]),this}setFromAttributeAndIndices(o,u,s,r){return this.a.fromBufferAttribute(o,u),this.b.fromBufferAttribute(o,s),this.c.fromBufferAttribute(o,r),this}clone(){return new this.constructor().copy(this)}copy(o){return this.a.copy(o.a),this.b.copy(o.b),this.c.copy(o.c),this}getArea(){return q0.subVectors(this.c,this.b),g1.subVectors(this.a,this.b),q0.cross(g1).length()*.5}getMidpoint(o){return o.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(o){return w1.getNormal(this.a,this.b,this.c,o)}getPlane(o){return o.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(o,u){return w1.getBarycoord(o,this.a,this.b,this.c,u)}getUV(o,u,s,r,l){return w1.getUV(o,this.a,this.b,this.c,u,s,r,l)}containsPoint(o){return w1.containsPoint(o,this.a,this.b,this.c)}isFrontFacing(o){return w1.isFrontFacing(this.a,this.b,this.c,o)}intersectsBox(o){return o.intersectsTriangle(this)}closestPointToPoint(o,u){const s=this.a,r=this.b,l=this.c;let C,S;f2.subVectors(r,s),d2.subVectors(l,s),VI.subVectors(o,s);const O=f2.dot(VI),U=d2.dot(VI);if(O<=0&&U<=0)return u.copy(s);HI.subVectors(o,r);const j=f2.dot(HI),N=d2.dot(HI);if(j>=0&&N<=j)return u.copy(r);const L=O*N-j*U;if(L<=0&&O>=0&&j<=0)return C=O/(O-j),u.copy(s).addScaledVector(f2,C);GI.subVectors(o,l);const W=f2.dot(GI),z=d2.dot(GI);if(z>=0&&W<=z)return u.copy(l);const q=W*U-O*z;if(q<=0&&U>=0&&z<=0)return S=U/(U-z),u.copy(s).addScaledVector(d2,S);const I=j*z-W*N;if(I<=0&&N-j>=0&&W-z>=0)return wW.subVectors(l,r),S=(N-j)/(N-j+(W-z)),u.copy(r).addScaledVector(wW,S);const Z=1/(I+q+L);return C=q*Z,S=L*Z,u.copy(s).addScaledVector(f2,C).addScaledVector(d2,S)}equals(o){return o.a.equals(this.a)&&o.b.equals(this.b)&&o.c.equals(this.c)}}let wue=0;class QS extends t_{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:wue++}),this.uuid=XS(),this.name="",this.type="Material",this.blending=j2,this.side=iw,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=pG,this.blendDst=mG,this.blendEquation=b2,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=JF,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=lue,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=OI,this.stencilZFail=OI,this.stencilZPass=OI,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(o){this._alphaTest>0!=o>0&&this.version++,this._alphaTest=o}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(o){if(o!==void 0)for(const u in o){const s=o[u];if(s===void 0){console.warn("THREE.Material: '"+u+"' parameter is undefined.");continue}const r=this[u];if(r===void 0){console.warn("THREE."+this.type+": '"+u+"' is not a property of this material.");continue}r&&r.isColor?r.set(s):r&&r.isVector3&&s&&s.isVector3?r.copy(s):this[u]=s}}toJSON(o){const u=o===void 0||typeof o=="string";u&&(o={textures:{},images:{}});const s={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.color&&this.color.isColor&&(s.color=this.color.getHex()),this.roughness!==void 0&&(s.roughness=this.roughness),this.metalness!==void 0&&(s.metalness=this.metalness),this.sheen!==void 0&&(s.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(s.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(s.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(s.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(s.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(s.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(s.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(s.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(s.shininess=this.shininess),this.clearcoat!==void 0&&(s.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(s.clearcoatMap=this.clearcoatMap.toJSON(o).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(s.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(o).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(s.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(o).uuid,s.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(s.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(s.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(s.iridescenceMap=this.iridescenceMap.toJSON(o).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(s.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(o).uuid),this.map&&this.map.isTexture&&(s.map=this.map.toJSON(o).uuid),this.matcap&&this.matcap.isTexture&&(s.matcap=this.matcap.toJSON(o).uuid),this.alphaMap&&this.alphaMap.isTexture&&(s.alphaMap=this.alphaMap.toJSON(o).uuid),this.lightMap&&this.lightMap.isTexture&&(s.lightMap=this.lightMap.toJSON(o).uuid,s.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(s.aoMap=this.aoMap.toJSON(o).uuid,s.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(s.bumpMap=this.bumpMap.toJSON(o).uuid,s.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(s.normalMap=this.normalMap.toJSON(o).uuid,s.normalMapType=this.normalMapType,s.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(s.displacementMap=this.displacementMap.toJSON(o).uuid,s.displacementScale=this.displacementScale,s.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(s.roughnessMap=this.roughnessMap.toJSON(o).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(s.metalnessMap=this.metalnessMap.toJSON(o).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(s.emissiveMap=this.emissiveMap.toJSON(o).uuid),this.specularMap&&this.specularMap.isTexture&&(s.specularMap=this.specularMap.toJSON(o).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(s.specularIntensityMap=this.specularIntensityMap.toJSON(o).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(s.specularColorMap=this.specularColorMap.toJSON(o).uuid),this.envMap&&this.envMap.isTexture&&(s.envMap=this.envMap.toJSON(o).uuid,this.combine!==void 0&&(s.combine=this.combine)),this.envMapIntensity!==void 0&&(s.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(s.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(s.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(s.gradientMap=this.gradientMap.toJSON(o).uuid),this.transmission!==void 0&&(s.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(s.transmissionMap=this.transmissionMap.toJSON(o).uuid),this.thickness!==void 0&&(s.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(s.thicknessMap=this.thicknessMap.toJSON(o).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(s.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(s.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(s.size=this.size),this.shadowSide!==null&&(s.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(s.sizeAttenuation=this.sizeAttenuation),this.blending!==j2&&(s.blending=this.blending),this.side!==iw&&(s.side=this.side),this.vertexColors&&(s.vertexColors=!0),this.opacity<1&&(s.opacity=this.opacity),this.transparent===!0&&(s.transparent=this.transparent),s.depthFunc=this.depthFunc,s.depthTest=this.depthTest,s.depthWrite=this.depthWrite,s.colorWrite=this.colorWrite,s.stencilWrite=this.stencilWrite,s.stencilWriteMask=this.stencilWriteMask,s.stencilFunc=this.stencilFunc,s.stencilRef=this.stencilRef,s.stencilFuncMask=this.stencilFuncMask,s.stencilFail=this.stencilFail,s.stencilZFail=this.stencilZFail,s.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(s.rotation=this.rotation),this.polygonOffset===!0&&(s.polygonOffset=!0),this.polygonOffsetFactor!==0&&(s.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(s.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(s.linewidth=this.linewidth),this.dashSize!==void 0&&(s.dashSize=this.dashSize),this.gapSize!==void 0&&(s.gapSize=this.gapSize),this.scale!==void 0&&(s.scale=this.scale),this.dithering===!0&&(s.dithering=!0),this.alphaTest>0&&(s.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(s.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(s.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(s.wireframe=this.wireframe),this.wireframeLinewidth>1&&(s.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(s.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(s.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(s.flatShading=this.flatShading),this.visible===!1&&(s.visible=!1),this.toneMapped===!1&&(s.toneMapped=!1),this.fog===!1&&(s.fog=!1),Object.keys(this.userData).length>0&&(s.userData=this.userData);function r(l){const C=[];for(const S in l){const O=l[S];delete O.metadata,C.push(O)}return C}if(u){const l=r(o.textures),C=r(o.images);l.length>0&&(s.textures=l),C.length>0&&(s.images=C)}return s}clone(){return new this.constructor().copy(this)}copy(o){this.name=o.name,this.blending=o.blending,this.side=o.side,this.vertexColors=o.vertexColors,this.opacity=o.opacity,this.transparent=o.transparent,this.blendSrc=o.blendSrc,this.blendDst=o.blendDst,this.blendEquation=o.blendEquation,this.blendSrcAlpha=o.blendSrcAlpha,this.blendDstAlpha=o.blendDstAlpha,this.blendEquationAlpha=o.blendEquationAlpha,this.depthFunc=o.depthFunc,this.depthTest=o.depthTest,this.depthWrite=o.depthWrite,this.stencilWriteMask=o.stencilWriteMask,this.stencilFunc=o.stencilFunc,this.stencilRef=o.stencilRef,this.stencilFuncMask=o.stencilFuncMask,this.stencilFail=o.stencilFail,this.stencilZFail=o.stencilZFail,this.stencilZPass=o.stencilZPass,this.stencilWrite=o.stencilWrite;const u=o.clippingPlanes;let s=null;if(u!==null){const r=u.length;s=new Array(r);for(let l=0;l!==r;++l)s[l]=u[l].clone()}return this.clippingPlanes=s,this.clipIntersection=o.clipIntersection,this.clipShadows=o.clipShadows,this.shadowSide=o.shadowSide,this.colorWrite=o.colorWrite,this.precision=o.precision,this.polygonOffset=o.polygonOffset,this.polygonOffsetFactor=o.polygonOffsetFactor,this.polygonOffsetUnits=o.polygonOffsetUnits,this.dithering=o.dithering,this.alphaTest=o.alphaTest,this.alphaToCoverage=o.alphaToCoverage,this.premultipliedAlpha=o.premultipliedAlpha,this.visible=o.visible,this.toneMapped=o.toneMapped,this.userData=JSON.parse(JSON.stringify(o.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(o){o===!0&&this.version++}}class _S extends QS{constructor(o){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new vs(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=gG,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.specularMap=o.specularMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.combine=o.combine,this.reflectivity=o.reflectivity,this.refractionRatio=o.refractionRatio,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.fog=o.fog,this}}const Sc=new hr,BA=new cs;class Ey{constructor(o,u,s=!1){if(Array.isArray(o))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=o,this.itemSize=u,this.count=o!==void 0?o.length/u:0,this.normalized=s,this.usage=cW,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(o){o===!0&&this.version++}setUsage(o){return this.usage=o,this}copy(o){return this.name=o.name,this.array=new o.array.constructor(o.array),this.itemSize=o.itemSize,this.count=o.count,this.normalized=o.normalized,this.usage=o.usage,this}copyAt(o,u,s){o*=this.itemSize,s*=u.itemSize;for(let r=0,l=this.itemSize;r<l;r++)this.array[o+r]=u.array[s+r];return this}copyArray(o){return this.array.set(o),this}applyMatrix3(o){if(this.itemSize===2)for(let u=0,s=this.count;u<s;u++)BA.fromBufferAttribute(this,u),BA.applyMatrix3(o),this.setXY(u,BA.x,BA.y);else if(this.itemSize===3)for(let u=0,s=this.count;u<s;u++)Sc.fromBufferAttribute(this,u),Sc.applyMatrix3(o),this.setXYZ(u,Sc.x,Sc.y,Sc.z);return this}applyMatrix4(o){for(let u=0,s=this.count;u<s;u++)Sc.fromBufferAttribute(this,u),Sc.applyMatrix4(o),this.setXYZ(u,Sc.x,Sc.y,Sc.z);return this}applyNormalMatrix(o){for(let u=0,s=this.count;u<s;u++)Sc.fromBufferAttribute(this,u),Sc.applyNormalMatrix(o),this.setXYZ(u,Sc.x,Sc.y,Sc.z);return this}transformDirection(o){for(let u=0,s=this.count;u<s;u++)Sc.fromBufferAttribute(this,u),Sc.transformDirection(o),this.setXYZ(u,Sc.x,Sc.y,Sc.z);return this}set(o,u=0){return this.array.set(o,u),this}getX(o){let u=this.array[o*this.itemSize];return this.normalized&&(u=TA(u,this.array)),u}setX(o,u){return this.normalized&&(u=Pm(u,this.array)),this.array[o*this.itemSize]=u,this}getY(o){let u=this.array[o*this.itemSize+1];return this.normalized&&(u=TA(u,this.array)),u}setY(o,u){return this.normalized&&(u=Pm(u,this.array)),this.array[o*this.itemSize+1]=u,this}getZ(o){let u=this.array[o*this.itemSize+2];return this.normalized&&(u=TA(u,this.array)),u}setZ(o,u){return this.normalized&&(u=Pm(u,this.array)),this.array[o*this.itemSize+2]=u,this}getW(o){let u=this.array[o*this.itemSize+3];return this.normalized&&(u=TA(u,this.array)),u}setW(o,u){return this.normalized&&(u=Pm(u,this.array)),this.array[o*this.itemSize+3]=u,this}setXY(o,u,s){return o*=this.itemSize,this.normalized&&(u=Pm(u,this.array),s=Pm(s,this.array)),this.array[o+0]=u,this.array[o+1]=s,this}setXYZ(o,u,s,r){return o*=this.itemSize,this.normalized&&(u=Pm(u,this.array),s=Pm(s,this.array),r=Pm(r,this.array)),this.array[o+0]=u,this.array[o+1]=s,this.array[o+2]=r,this}setXYZW(o,u,s,r,l){return o*=this.itemSize,this.normalized&&(u=Pm(u,this.array),s=Pm(s,this.array),r=Pm(r,this.array),l=Pm(l,this.array)),this.array[o+0]=u,this.array[o+1]=s,this.array[o+2]=r,this.array[o+3]=l,this}onUpload(o){return this.onUploadCallback=o,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const o={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(o.name=this.name),this.usage!==cW&&(o.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(o.updateRange=this.updateRange),o}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class CG extends Ey{constructor(o,u,s){super(new Uint16Array(o),u,s)}}class AG extends Ey{constructor(o,u,s){super(new Uint32Array(o),u,s)}}class Fp extends Ey{constructor(o,u,s){super(new Float32Array(o),u,s)}}let _ue=0;const Pg=new ac,qI=new od,h2=new hr,Bm=new YS,tS=new YS,xl=new hr;class nv extends t_{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_ue++}),this.uuid=XS(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(o){return Array.isArray(o)?this.index=new(bG(o)?AG:CG)(o,1):this.index=o,this}getAttribute(o){return this.attributes[o]}setAttribute(o,u){return this.attributes[o]=u,this}deleteAttribute(o){return delete this.attributes[o],this}hasAttribute(o){return this.attributes[o]!==void 0}addGroup(o,u,s=0){this.groups.push({start:o,count:u,materialIndex:s})}clearGroups(){this.groups=[]}setDrawRange(o,u){this.drawRange.start=o,this.drawRange.count=u}applyMatrix4(o){const u=this.attributes.position;u!==void 0&&(u.applyMatrix4(o),u.needsUpdate=!0);const s=this.attributes.normal;if(s!==void 0){const l=new Wm().getNormalMatrix(o);s.applyNormalMatrix(l),s.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(o),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(o){return Pg.makeRotationFromQuaternion(o),this.applyMatrix4(Pg),this}rotateX(o){return Pg.makeRotationX(o),this.applyMatrix4(Pg),this}rotateY(o){return Pg.makeRotationY(o),this.applyMatrix4(Pg),this}rotateZ(o){return Pg.makeRotationZ(o),this.applyMatrix4(Pg),this}translate(o,u,s){return Pg.makeTranslation(o,u,s),this.applyMatrix4(Pg),this}scale(o,u,s){return Pg.makeScale(o,u,s),this.applyMatrix4(Pg),this}lookAt(o){return qI.lookAt(o),qI.updateMatrix(),this.applyMatrix4(qI.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(h2).negate(),this.translate(h2.x,h2.y,h2.z),this}setFromPoints(o){const u=[];for(let s=0,r=o.length;s<r;s++){const l=o[s];u.push(l.x,l.y,l.z||0)}return this.setAttribute("position",new Fp(u,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new YS);const o=this.attributes.position,u=this.morphAttributes.position;if(o&&o.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new hr(-1/0,-1/0,-1/0),new hr(1/0,1/0,1/0));return}if(o!==void 0){if(this.boundingBox.setFromBufferAttribute(o),u)for(let s=0,r=u.length;s<r;s++){const l=u[s];Bm.setFromBufferAttribute(l),this.morphTargetsRelative?(xl.addVectors(this.boundingBox.min,Bm.min),this.boundingBox.expandByPoint(xl),xl.addVectors(this.boundingBox.max,Bm.max),this.boundingBox.expandByPoint(xl)):(this.boundingBox.expandByPoint(Bm.min),this.boundingBox.expandByPoint(Bm.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new nT);const o=this.attributes.position,u=this.morphAttributes.position;if(o&&o.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new hr,1/0);return}if(o){const s=this.boundingSphere.center;if(Bm.setFromBufferAttribute(o),u)for(let l=0,C=u.length;l<C;l++){const S=u[l];tS.setFromBufferAttribute(S),this.morphTargetsRelative?(xl.addVectors(Bm.min,tS.min),Bm.expandByPoint(xl),xl.addVectors(Bm.max,tS.max),Bm.expandByPoint(xl)):(Bm.expandByPoint(tS.min),Bm.expandByPoint(tS.max))}Bm.getCenter(s);let r=0;for(let l=0,C=o.count;l<C;l++)xl.fromBufferAttribute(o,l),r=Math.max(r,s.distanceToSquared(xl));if(u)for(let l=0,C=u.length;l<C;l++){const S=u[l],O=this.morphTargetsRelative;for(let U=0,j=S.count;U<j;U++)xl.fromBufferAttribute(S,U),O&&(h2.fromBufferAttribute(o,U),xl.add(h2)),r=Math.max(r,s.distanceToSquared(xl))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const o=this.index,u=this.attributes;if(o===null||u.position===void 0||u.normal===void 0||u.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const s=o.array,r=u.position.array,l=u.normal.array,C=u.uv.array,S=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ey(new Float32Array(4*S),4));const O=this.getAttribute("tangent").array,U=[],j=[];for(let Ge=0;Ge<S;Ge++)U[Ge]=new hr,j[Ge]=new hr;const N=new hr,L=new hr,W=new hr,z=new cs,q=new cs,I=new cs,Z=new hr,Y=new hr;function G(Ge,ht,It){N.fromArray(r,Ge*3),L.fromArray(r,ht*3),W.fromArray(r,It*3),z.fromArray(C,Ge*2),q.fromArray(C,ht*2),I.fromArray(C,It*2),L.sub(N),W.sub(N),q.sub(z),I.sub(z);const St=1/(q.x*I.y-I.x*q.y);isFinite(St)&&(Z.copy(L).multiplyScalar(I.y).addScaledVector(W,-q.y).multiplyScalar(St),Y.copy(W).multiplyScalar(q.x).addScaledVector(L,-I.x).multiplyScalar(St),U[Ge].add(Z),U[ht].add(Z),U[It].add(Z),j[Ge].add(Y),j[ht].add(Y),j[It].add(Y))}let oe=this.groups;oe.length===0&&(oe=[{start:0,count:s.length}]);for(let Ge=0,ht=oe.length;Ge<ht;++Ge){const It=oe[Ge],St=It.start,we=It.count;for(let bt=St,jt=St+we;bt<jt;bt+=3)G(s[bt+0],s[bt+1],s[bt+2])}const ce=new hr,be=new hr,Ee=new hr,ve=new hr;function ge(Ge){Ee.fromArray(l,Ge*3),ve.copy(Ee);const ht=U[Ge];ce.copy(ht),ce.sub(Ee.multiplyScalar(Ee.dot(ht))).normalize(),be.crossVectors(ve,ht);const St=be.dot(j[Ge])<0?-1:1;O[Ge*4]=ce.x,O[Ge*4+1]=ce.y,O[Ge*4+2]=ce.z,O[Ge*4+3]=St}for(let Ge=0,ht=oe.length;Ge<ht;++Ge){const It=oe[Ge],St=It.start,we=It.count;for(let bt=St,jt=St+we;bt<jt;bt+=3)ge(s[bt+0]),ge(s[bt+1]),ge(s[bt+2])}}computeVertexNormals(){const o=this.index,u=this.getAttribute("position");if(u!==void 0){let s=this.getAttribute("normal");if(s===void 0)s=new Ey(new Float32Array(u.count*3),3),this.setAttribute("normal",s);else for(let L=0,W=s.count;L<W;L++)s.setXYZ(L,0,0,0);const r=new hr,l=new hr,C=new hr,S=new hr,O=new hr,U=new hr,j=new hr,N=new hr;if(o)for(let L=0,W=o.count;L<W;L+=3){const z=o.getX(L+0),q=o.getX(L+1),I=o.getX(L+2);r.fromBufferAttribute(u,z),l.fromBufferAttribute(u,q),C.fromBufferAttribute(u,I),j.subVectors(C,l),N.subVectors(r,l),j.cross(N),S.fromBufferAttribute(s,z),O.fromBufferAttribute(s,q),U.fromBufferAttribute(s,I),S.add(j),O.add(j),U.add(j),s.setXYZ(z,S.x,S.y,S.z),s.setXYZ(q,O.x,O.y,O.z),s.setXYZ(I,U.x,U.y,U.z)}else for(let L=0,W=u.count;L<W;L+=3)r.fromBufferAttribute(u,L+0),l.fromBufferAttribute(u,L+1),C.fromBufferAttribute(u,L+2),j.subVectors(C,l),N.subVectors(r,l),j.cross(N),s.setXYZ(L+0,j.x,j.y,j.z),s.setXYZ(L+1,j.x,j.y,j.z),s.setXYZ(L+2,j.x,j.y,j.z);this.normalizeNormals(),s.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const o=this.attributes.normal;for(let u=0,s=o.count;u<s;u++)xl.fromBufferAttribute(o,u),xl.normalize(),o.setXYZ(u,xl.x,xl.y,xl.z)}toNonIndexed(){function o(S,O){const U=S.array,j=S.itemSize,N=S.normalized,L=new U.constructor(O.length*j);let W=0,z=0;for(let q=0,I=O.length;q<I;q++){S.isInterleavedBufferAttribute?W=O[q]*S.data.stride+S.offset:W=O[q]*j;for(let Z=0;Z<j;Z++)L[z++]=U[W++]}return new Ey(L,j,N)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const u=new nv,s=this.index.array,r=this.attributes;for(const S in r){const O=r[S],U=o(O,s);u.setAttribute(S,U)}const l=this.morphAttributes;for(const S in l){const O=[],U=l[S];for(let j=0,N=U.length;j<N;j++){const L=U[j],W=o(L,s);O.push(W)}u.morphAttributes[S]=O}u.morphTargetsRelative=this.morphTargetsRelative;const C=this.groups;for(let S=0,O=C.length;S<O;S++){const U=C[S];u.addGroup(U.start,U.count,U.materialIndex)}return u}toJSON(){const o={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),Object.keys(this.userData).length>0&&(o.userData=this.userData),this.parameters!==void 0){const O=this.parameters;for(const U in O)O[U]!==void 0&&(o[U]=O[U]);return o}o.data={attributes:{}};const u=this.index;u!==null&&(o.data.index={type:u.array.constructor.name,array:Array.prototype.slice.call(u.array)});const s=this.attributes;for(const O in s){const U=s[O];o.data.attributes[O]=U.toJSON(o.data)}const r={};let l=!1;for(const O in this.morphAttributes){const U=this.morphAttributes[O],j=[];for(let N=0,L=U.length;N<L;N++){const W=U[N];j.push(W.toJSON(o.data))}j.length>0&&(r[O]=j,l=!0)}l&&(o.data.morphAttributes=r,o.data.morphTargetsRelative=this.morphTargetsRelative);const C=this.groups;C.length>0&&(o.data.groups=JSON.parse(JSON.stringify(C)));const S=this.boundingSphere;return S!==null&&(o.data.boundingSphere={center:S.center.toArray(),radius:S.radius}),o}clone(){return new this.constructor().copy(this)}copy(o){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const u={};this.name=o.name;const s=o.index;s!==null&&this.setIndex(s.clone(u));const r=o.attributes;for(const U in r){const j=r[U];this.setAttribute(U,j.clone(u))}const l=o.morphAttributes;for(const U in l){const j=[],N=l[U];for(let L=0,W=N.length;L<W;L++)j.push(N[L].clone(u));this.morphAttributes[U]=j}this.morphTargetsRelative=o.morphTargetsRelative;const C=o.groups;for(let U=0,j=C.length;U<j;U++){const N=C[U];this.addGroup(N.start,N.count,N.materialIndex)}const S=o.boundingBox;S!==null&&(this.boundingBox=S.clone());const O=o.boundingSphere;return O!==null&&(this.boundingSphere=O.clone()),this.drawRange.start=o.drawRange.start,this.drawRange.count=o.drawRange.count,this.userData=o.userData,o.parameters!==void 0&&(this.parameters=Object.assign({},o.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const _W=new ac,p2=new SG,$I=new nT,nS=new hr,rS=new hr,iS=new hr,XI=new hr,jA=new hr,zA=new cs,UA=new cs,WA=new cs,KI=new hr,VA=new hr;class Q0 extends od{constructor(o=new nv,u=new _S){super(),this.isMesh=!0,this.type="Mesh",this.geometry=o,this.material=u,this.updateMorphTargets()}copy(o,u){return super.copy(o,u),o.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=o.morphTargetInfluences.slice()),o.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},o.morphTargetDictionary)),this.material=o.material,this.geometry=o.geometry,this}updateMorphTargets(){const u=this.geometry.morphAttributes,s=Object.keys(u);if(s.length>0){const r=u[s[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,C=r.length;l<C;l++){const S=r[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[S]=l}}}}getVertexPosition(o,u){const s=this.geometry,r=s.attributes.position,l=s.morphAttributes.position,C=s.morphTargetsRelative;u.fromBufferAttribute(r,o);const S=this.morphTargetInfluences;if(l&&S){jA.set(0,0,0);for(let O=0,U=l.length;O<U;O++){const j=S[O],N=l[O];j!==0&&(XI.fromBufferAttribute(N,o),C?jA.addScaledVector(XI,j):jA.addScaledVector(XI.sub(u),j))}u.add(jA)}return this.isSkinnedMesh&&this.boneTransform(o,u),u}raycast(o,u){const s=this.geometry,r=this.material,l=this.matrixWorld;if(r===void 0||(s.boundingSphere===null&&s.computeBoundingSphere(),$I.copy(s.boundingSphere),$I.applyMatrix4(l),o.ray.intersectsSphere($I)===!1)||(_W.copy(l).invert(),p2.copy(o.ray).applyMatrix4(_W),s.boundingBox!==null&&p2.intersectsBox(s.boundingBox)===!1))return;let C;const S=s.index,O=s.attributes.position,U=s.attributes.uv,j=s.attributes.uv2,N=s.groups,L=s.drawRange;if(S!==null)if(Array.isArray(r))for(let W=0,z=N.length;W<z;W++){const q=N[W],I=r[q.materialIndex],Z=Math.max(q.start,L.start),Y=Math.min(S.count,Math.min(q.start+q.count,L.start+L.count));for(let G=Z,oe=Y;G<oe;G+=3){const ce=S.getX(G),be=S.getX(G+1),Ee=S.getX(G+2);C=HA(this,I,o,p2,U,j,ce,be,Ee),C&&(C.faceIndex=Math.floor(G/3),C.face.materialIndex=q.materialIndex,u.push(C))}}else{const W=Math.max(0,L.start),z=Math.min(S.count,L.start+L.count);for(let q=W,I=z;q<I;q+=3){const Z=S.getX(q),Y=S.getX(q+1),G=S.getX(q+2);C=HA(this,r,o,p2,U,j,Z,Y,G),C&&(C.faceIndex=Math.floor(q/3),u.push(C))}}else if(O!==void 0)if(Array.isArray(r))for(let W=0,z=N.length;W<z;W++){const q=N[W],I=r[q.materialIndex],Z=Math.max(q.start,L.start),Y=Math.min(O.count,Math.min(q.start+q.count,L.start+L.count));for(let G=Z,oe=Y;G<oe;G+=3){const ce=G,be=G+1,Ee=G+2;C=HA(this,I,o,p2,U,j,ce,be,Ee),C&&(C.faceIndex=Math.floor(G/3),C.face.materialIndex=q.materialIndex,u.push(C))}}else{const W=Math.max(0,L.start),z=Math.min(O.count,L.start+L.count);for(let q=W,I=z;q<I;q+=3){const Z=q,Y=q+1,G=q+2;C=HA(this,r,o,p2,U,j,Z,Y,G),C&&(C.faceIndex=Math.floor(q/3),u.push(C))}}}}function Eue(p,o,u,s,r,l,C,S){let O;if(o.side===Wg?O=s.intersectTriangle(C,l,r,!0,S):O=s.intersectTriangle(r,l,C,o.side===iw,S),O===null)return null;VA.copy(S),VA.applyMatrix4(p.matrixWorld);const U=u.ray.origin.distanceTo(VA);return U<u.near||U>u.far?null:{distance:U,point:VA.clone(),object:p}}function HA(p,o,u,s,r,l,C,S,O){p.getVertexPosition(C,nS),p.getVertexPosition(S,rS),p.getVertexPosition(O,iS);const U=Eue(p,o,u,s,nS,rS,iS,KI);if(U){r&&(zA.fromBufferAttribute(r,C),UA.fromBufferAttribute(r,S),WA.fromBufferAttribute(r,O),U.uv=w1.getUV(KI,nS,rS,iS,zA,UA,WA,new cs)),l&&(zA.fromBufferAttribute(l,C),UA.fromBufferAttribute(l,S),WA.fromBufferAttribute(l,O),U.uv2=w1.getUV(KI,nS,rS,iS,zA,UA,WA,new cs));const j={a:C,b:S,c:O,normal:new hr,materialIndex:0};w1.getNormal(nS,rS,iS,j.normal),U.face=j}return U}class ZS extends nv{constructor(o=1,u=1,s=1,r=1,l=1,C=1){super(),this.type="BoxGeometry",this.parameters={width:o,height:u,depth:s,widthSegments:r,heightSegments:l,depthSegments:C};const S=this;r=Math.floor(r),l=Math.floor(l),C=Math.floor(C);const O=[],U=[],j=[],N=[];let L=0,W=0;z("z","y","x",-1,-1,s,u,o,C,l,0),z("z","y","x",1,-1,s,u,-o,C,l,1),z("x","z","y",1,1,o,s,u,r,C,2),z("x","z","y",1,-1,o,s,-u,r,C,3),z("x","y","z",1,-1,o,u,s,r,l,4),z("x","y","z",-1,-1,o,u,-s,r,l,5),this.setIndex(O),this.setAttribute("position",new Fp(U,3)),this.setAttribute("normal",new Fp(j,3)),this.setAttribute("uv",new Fp(N,2));function z(q,I,Z,Y,G,oe,ce,be,Ee,ve,ge){const Ge=oe/Ee,ht=ce/ve,It=oe/2,St=ce/2,we=be/2,bt=Ee+1,jt=ve+1;let Mt=0,ze=0;const Ut=new hr;for(let Ft=0;Ft<jt;Ft++){const pt=Ft*ht-St;for(let yt=0;yt<bt;yt++){const nn=yt*Ge-It;Ut[q]=nn*Y,Ut[I]=pt*G,Ut[Z]=we,U.push(Ut.x,Ut.y,Ut.z),Ut[q]=0,Ut[I]=0,Ut[Z]=be>0?1:-1,j.push(Ut.x,Ut.y,Ut.z),N.push(yt/Ee),N.push(1-Ft/ve),Mt+=1}}for(let Ft=0;Ft<ve;Ft++)for(let pt=0;pt<Ee;pt++){const yt=L+pt+bt*Ft,nn=L+pt+bt*(Ft+1),xt=L+(pt+1)+bt*(Ft+1),_t=L+(pt+1)+bt*Ft;O.push(yt,nn,_t),O.push(nn,xt,_t),ze+=6}S.addGroup(W,ze,ge),W+=ze,L+=Mt}}static fromJSON(o){return new ZS(o.width,o.height,o.depth,o.widthSegments,o.heightSegments,o.depthSegments)}}function J2(p){const o={};for(const u in p){o[u]={};for(const s in p[u]){const r=p[u][s];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?o[u][s]=r.clone():Array.isArray(r)?o[u][s]=r.slice():o[u][s]=r}}return o}function ph(p){const o={};for(let u=0;u<p.length;u++){const s=J2(p[u]);for(const r in s)o[r]=s[r]}return o}function Sue(p){const o=[];for(let u=0;u<p.length;u++)o.push(p[u].clone());return o}function OG(p){return p.getRenderTarget()===null&&p.outputEncoding===tu?yy:WS}const kue={clone:J2,merge:ph};var Cue=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Aue=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class uw extends QS{constructor(o){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Cue,this.fragmentShader=Aue,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,o!==void 0&&this.setValues(o)}copy(o){return super.copy(o),this.fragmentShader=o.fragmentShader,this.vertexShader=o.vertexShader,this.uniforms=J2(o.uniforms),this.uniformsGroups=Sue(o.uniformsGroups),this.defines=Object.assign({},o.defines),this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.fog=o.fog,this.lights=o.lights,this.clipping=o.clipping,this.extensions=Object.assign({},o.extensions),this.glslVersion=o.glslVersion,this}toJSON(o){const u=super.toJSON(o);u.glslVersion=this.glslVersion,u.uniforms={};for(const r in this.uniforms){const C=this.uniforms[r].value;C&&C.isTexture?u.uniforms[r]={type:"t",value:C.toJSON(o).uuid}:C&&C.isColor?u.uniforms[r]={type:"c",value:C.getHex()}:C&&C.isVector2?u.uniforms[r]={type:"v2",value:C.toArray()}:C&&C.isVector3?u.uniforms[r]={type:"v3",value:C.toArray()}:C&&C.isVector4?u.uniforms[r]={type:"v4",value:C.toArray()}:C&&C.isMatrix3?u.uniforms[r]={type:"m3",value:C.toArray()}:C&&C.isMatrix4?u.uniforms[r]={type:"m4",value:C.toArray()}:u.uniforms[r]={value:C}}Object.keys(this.defines).length>0&&(u.defines=this.defines),u.vertexShader=this.vertexShader,u.fragmentShader=this.fragmentShader;const s={};for(const r in this.extensions)this.extensions[r]===!0&&(s[r]=!0);return Object.keys(s).length>0&&(u.extensions=s),u}}class TG extends od{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ac,this.projectionMatrix=new ac,this.projectionMatrixInverse=new ac}copy(o,u){return super.copy(o,u),this.matrixWorldInverse.copy(o.matrixWorldInverse),this.projectionMatrix.copy(o.projectionMatrix),this.projectionMatrixInverse.copy(o.projectionMatrixInverse),this}getWorldDirection(o){this.updateWorldMatrix(!0,!1);const u=this.matrixWorld.elements;return o.set(-u[8],-u[9],-u[10]).normalize()}updateMatrixWorld(o){super.updateMatrixWorld(o),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(o,u){super.updateWorldMatrix(o,u),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class jg extends TG{constructor(o=50,u=1,s=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=o,this.zoom=1,this.near=s,this.far=r,this.focus=10,this.aspect=u,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(o,u){return super.copy(o,u),this.fov=o.fov,this.zoom=o.zoom,this.near=o.near,this.far=o.far,this.focus=o.focus,this.aspect=o.aspect,this.view=o.view===null?null:Object.assign({},o.view),this.filmGauge=o.filmGauge,this.filmOffset=o.filmOffset,this}setFocalLength(o){const u=.5*this.getFilmHeight()/o;this.fov=fW*2*Math.atan(u),this.updateProjectionMatrix()}getFocalLength(){const o=Math.tan(TI*.5*this.fov);return .5*this.getFilmHeight()/o}getEffectiveFOV(){return fW*2*Math.atan(Math.tan(TI*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(o,u,s,r,l,C){this.aspect=o/u,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=o,this.view.fullHeight=u,this.view.offsetX=s,this.view.offsetY=r,this.view.width=l,this.view.height=C,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const o=this.near;let u=o*Math.tan(TI*.5*this.fov)/this.zoom,s=2*u,r=this.aspect*s,l=-.5*r;const C=this.view;if(this.view!==null&&this.view.enabled){const O=C.fullWidth,U=C.fullHeight;l+=C.offsetX*r/O,u-=C.offsetY*s/U,r*=C.width/O,s*=C.height/U}const S=this.filmOffset;S!==0&&(l+=o*S/this.getFilmWidth()),this.projectionMatrix.makePerspective(l,l+r,u,u-s,o,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(o){const u=super.toJSON(o);return u.object.fov=this.fov,u.object.zoom=this.zoom,u.object.near=this.near,u.object.far=this.far,u.object.focus=this.focus,u.object.aspect=this.aspect,this.view!==null&&(u.object.view=Object.assign({},this.view)),u.object.filmGauge=this.filmGauge,u.object.filmOffset=this.filmOffset,u}}const m2=-90,g2=1;class Oue extends od{constructor(o,u,s){super(),this.type="CubeCamera",this.renderTarget=s;const r=new jg(m2,g2,o,u);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);const l=new jg(m2,g2,o,u);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(-1,0,0),this.add(l);const C=new jg(m2,g2,o,u);C.layers=this.layers,C.up.set(0,0,-1),C.lookAt(0,1,0),this.add(C);const S=new jg(m2,g2,o,u);S.layers=this.layers,S.up.set(0,0,1),S.lookAt(0,-1,0),this.add(S);const O=new jg(m2,g2,o,u);O.layers=this.layers,O.up.set(0,1,0),O.lookAt(0,0,1),this.add(O);const U=new jg(m2,g2,o,u);U.layers=this.layers,U.up.set(0,1,0),U.lookAt(0,0,-1),this.add(U)}update(o,u){this.parent===null&&this.updateMatrixWorld();const s=this.renderTarget,[r,l,C,S,O,U]=this.children,j=o.getRenderTarget(),N=o.toneMapping,L=o.xr.enabled;o.toneMapping=k1,o.xr.enabled=!1;const W=s.texture.generateMipmaps;s.texture.generateMipmaps=!1,o.setRenderTarget(s,0),o.render(u,r),o.setRenderTarget(s,1),o.render(u,l),o.setRenderTarget(s,2),o.render(u,C),o.setRenderTarget(s,3),o.render(u,S),o.setRenderTarget(s,4),o.render(u,O),s.texture.generateMipmaps=W,o.setRenderTarget(s,5),o.render(u,U),o.setRenderTarget(j),o.toneMapping=N,o.xr.enabled=L,s.texture.needsPMREMUpdate=!0}}class MG extends Ip{constructor(o,u,s,r,l,C,S,O,U,j){o=o!==void 0?o:[],u=u!==void 0?u:X2,super(o,u,s,r,l,C,S,O,U,j),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(o){this.image=o}}class Tue extends sw{constructor(o=1,u={}){super(o,o,u),this.isWebGLCubeRenderTarget=!0;const s={width:o,height:o,depth:1},r=[s,s,s,s,s,s];this.texture=new MG(r,u.mapping,u.wrapS,u.wrapT,u.magFilter,u.minFilter,u.format,u.type,u.anisotropy,u.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=u.generateMipmaps!==void 0?u.generateMipmaps:!1,this.texture.minFilter=u.minFilter!==void 0?u.minFilter:Ap}fromEquirectangularTexture(o,u){this.texture.type=u.type,this.texture.encoding=u.encoding,this.texture.generateMipmaps=u.generateMipmaps,this.texture.minFilter=u.minFilter,this.texture.magFilter=u.magFilter;const s={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new ZS(5,5,5),l=new uw({name:"CubemapFromEquirect",uniforms:J2(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,side:Wg,blending:Ub});l.uniforms.tEquirect.value=u;const C=new Q0(r,l),S=u.minFilter;return u.minFilter===zS&&(u.minFilter=Ap),new Oue(1,10,this).update(o,C),u.minFilter=S,C.geometry.dispose(),C.material.dispose(),this}clear(o,u,s,r){const l=o.getRenderTarget();for(let C=0;C<6;C++)o.setRenderTarget(this,C),o.clear(u,s,r);o.setRenderTarget(l)}}const YI=new hr,Mue=new hr,Due=new Wm;class Ux{constructor(o=new hr(1,0,0),u=0){this.isPlane=!0,this.normal=o,this.constant=u}set(o,u){return this.normal.copy(o),this.constant=u,this}setComponents(o,u,s,r){return this.normal.set(o,u,s),this.constant=r,this}setFromNormalAndCoplanarPoint(o,u){return this.normal.copy(o),this.constant=-u.dot(this.normal),this}setFromCoplanarPoints(o,u,s){const r=YI.subVectors(s,u).cross(Mue.subVectors(o,u)).normalize();return this.setFromNormalAndCoplanarPoint(r,o),this}copy(o){return this.normal.copy(o.normal),this.constant=o.constant,this}normalize(){const o=1/this.normal.length();return this.normal.multiplyScalar(o),this.constant*=o,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(o){return this.normal.dot(o)+this.constant}distanceToSphere(o){return this.distanceToPoint(o.center)-o.radius}projectPoint(o,u){return u.copy(this.normal).multiplyScalar(-this.distanceToPoint(o)).add(o)}intersectLine(o,u){const s=o.delta(YI),r=this.normal.dot(s);if(r===0)return this.distanceToPoint(o.start)===0?u.copy(o.start):null;const l=-(o.start.dot(this.normal)+this.constant)/r;return l<0||l>1?null:u.copy(s).multiplyScalar(l).add(o.start)}intersectsLine(o){const u=this.distanceToPoint(o.start),s=this.distanceToPoint(o.end);return u<0&&s>0||s<0&&u>0}intersectsBox(o){return o.intersectsPlane(this)}intersectsSphere(o){return o.intersectsPlane(this)}coplanarPoint(o){return o.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(o,u){const s=u||Due.getNormalMatrix(o),r=this.coplanarPoint(YI).applyMatrix4(o),l=this.normal.applyMatrix3(s).normalize();return this.constant=-r.dot(l),this}translate(o){return this.constant-=o.dot(this.normal),this}equals(o){return o.normal.equals(this.normal)&&o.constant===this.constant}clone(){return new this.constructor().copy(this)}}const v2=new nT,GA=new hr;class n5{constructor(o=new Ux,u=new Ux,s=new Ux,r=new Ux,l=new Ux,C=new Ux){this.planes=[o,u,s,r,l,C]}set(o,u,s,r,l,C){const S=this.planes;return S[0].copy(o),S[1].copy(u),S[2].copy(s),S[3].copy(r),S[4].copy(l),S[5].copy(C),this}copy(o){const u=this.planes;for(let s=0;s<6;s++)u[s].copy(o.planes[s]);return this}setFromProjectionMatrix(o){const u=this.planes,s=o.elements,r=s[0],l=s[1],C=s[2],S=s[3],O=s[4],U=s[5],j=s[6],N=s[7],L=s[8],W=s[9],z=s[10],q=s[11],I=s[12],Z=s[13],Y=s[14],G=s[15];return u[0].setComponents(S-r,N-O,q-L,G-I).normalize(),u[1].setComponents(S+r,N+O,q+L,G+I).normalize(),u[2].setComponents(S+l,N+U,q+W,G+Z).normalize(),u[3].setComponents(S-l,N-U,q-W,G-Z).normalize(),u[4].setComponents(S-C,N-j,q-z,G-Y).normalize(),u[5].setComponents(S+C,N+j,q+z,G+Y).normalize(),this}intersectsObject(o){const u=o.geometry;return u.boundingSphere===null&&u.computeBoundingSphere(),v2.copy(u.boundingSphere).applyMatrix4(o.matrixWorld),this.intersectsSphere(v2)}intersectsSprite(o){return v2.center.set(0,0,0),v2.radius=.7071067811865476,v2.applyMatrix4(o.matrixWorld),this.intersectsSphere(v2)}intersectsSphere(o){const u=this.planes,s=o.center,r=-o.radius;for(let l=0;l<6;l++)if(u[l].distanceToPoint(s)<r)return!1;return!0}intersectsBox(o){const u=this.planes;for(let s=0;s<6;s++){const r=u[s];if(GA.x=r.normal.x>0?o.max.x:o.min.x,GA.y=r.normal.y>0?o.max.y:o.min.y,GA.z=r.normal.z>0?o.max.z:o.min.z,r.distanceToPoint(GA)<0)return!1}return!0}containsPoint(o){const u=this.planes;for(let s=0;s<6;s++)if(u[s].distanceToPoint(o)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function DG(){let p=null,o=!1,u=null,s=null;function r(l,C){u(l,C),s=p.requestAnimationFrame(r)}return{start:function(){o!==!0&&u!==null&&(s=p.requestAnimationFrame(r),o=!0)},stop:function(){p.cancelAnimationFrame(s),o=!1},setAnimationLoop:function(l){u=l},setContext:function(l){p=l}}}function Nue(p,o){const u=o.isWebGL2,s=new WeakMap;function r(U,j){const N=U.array,L=U.usage,W=p.createBuffer();p.bindBuffer(j,W),p.bufferData(j,N,L),U.onUploadCallback();let z;if(N instanceof Float32Array)z=5126;else if(N instanceof Uint16Array)if(U.isFloat16BufferAttribute)if(u)z=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else z=5123;else if(N instanceof Int16Array)z=5122;else if(N instanceof Uint32Array)z=5125;else if(N instanceof Int32Array)z=5124;else if(N instanceof Int8Array)z=5120;else if(N instanceof Uint8Array)z=5121;else if(N instanceof Uint8ClampedArray)z=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+N);return{buffer:W,type:z,bytesPerElement:N.BYTES_PER_ELEMENT,version:U.version}}function l(U,j,N){const L=j.array,W=j.updateRange;p.bindBuffer(N,U),W.count===-1?p.bufferSubData(N,0,L):(u?p.bufferSubData(N,W.offset*L.BYTES_PER_ELEMENT,L,W.offset,W.count):p.bufferSubData(N,W.offset*L.BYTES_PER_ELEMENT,L.subarray(W.offset,W.offset+W.count)),W.count=-1),j.onUploadCallback()}function C(U){return U.isInterleavedBufferAttribute&&(U=U.data),s.get(U)}function S(U){U.isInterleavedBufferAttribute&&(U=U.data);const j=s.get(U);j&&(p.deleteBuffer(j.buffer),s.delete(U))}function O(U,j){if(U.isGLBufferAttribute){const L=s.get(U);(!L||L.version<U.version)&&s.set(U,{buffer:U.buffer,type:U.type,bytesPerElement:U.elementSize,version:U.version});return}U.isInterleavedBufferAttribute&&(U=U.data);const N=s.get(U);N===void 0?s.set(U,r(U,j)):N.version<U.version&&(l(N.buffer,U,j),N.version=U.version)}return{get:C,remove:S,update:O}}class rT extends nv{constructor(o=1,u=1,s=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:o,height:u,widthSegments:s,heightSegments:r};const l=o/2,C=u/2,S=Math.floor(s),O=Math.floor(r),U=S+1,j=O+1,N=o/S,L=u/O,W=[],z=[],q=[],I=[];for(let Z=0;Z<j;Z++){const Y=Z*L-C;for(let G=0;G<U;G++){const oe=G*N-l;z.push(oe,-Y,0),q.push(0,0,1),I.push(G/S),I.push(1-Z/O)}}for(let Z=0;Z<O;Z++)for(let Y=0;Y<S;Y++){const G=Y+U*Z,oe=Y+U*(Z+1),ce=Y+1+U*(Z+1),be=Y+1+U*Z;W.push(G,oe,be),W.push(oe,ce,be)}this.setIndex(W),this.setAttribute("position",new Fp(z,3)),this.setAttribute("normal",new Fp(q,3)),this.setAttribute("uv",new Fp(I,2))}static fromJSON(o){return new rT(o.width,o.height,o.widthSegments,o.heightSegments)}}var Iue=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,Fue=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Rue=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,Pue=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Lue=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Bue=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,jue="vec3 transformed = vec3( position );",zue=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Uue=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,Wue=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Vue=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Hue=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,Gue=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,que=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,$ue=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Xue=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Kue=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Yue=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Jue=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Que=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,Zue=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,ece=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,tce=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,nce=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,rce=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,ice=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,oce="gl_FragColor = linearToOutputTexel( gl_FragColor );",ace=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,sce=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,uce=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,cce=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,lce=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,fce=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,dce=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,hce=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,pce=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,mce=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gce=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,vce=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,yce=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,bce=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,xce=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,wce=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,_ce=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,Ece=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Sce=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,kce=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Cce=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Ace=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,Oce=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Tce=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Mce=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Dce=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,Nce=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Ice=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Fce=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,Rce=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,Pce=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,Lce=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Bce=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,jce=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,zce=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Uce=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Wce=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Vce=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,Hce=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,Gce=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,qce=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,$ce=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Xce=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Kce=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Yce=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Jce=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,Qce=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,Zce=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,ele=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,tle=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,nle=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,rle=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,ile=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,ole=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,ale=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,sle=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,ule=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,cle=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,lle=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,fle=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,dle=`#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,hle=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,ple=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,mle=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,gle=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,vle=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,yle=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,ble=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,xle=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,wle=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,_le=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,Ele=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,Sle=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,kle=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,Cle=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,Ale=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,Ole=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,Tle=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,Mle=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Dle=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Nle=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Ile=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Fle=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Rle=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Ple=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Lle=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Ble=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,jle=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,zle=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Ule=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Wle=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Vle=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Hle=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Gle=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,qle=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,$le=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Xle=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Kle=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Yle=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Jle=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Qle=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Zle=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,efe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,tfe=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,nfe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,rfe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,ife=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ofe=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,afe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,sfe=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,ufe=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,cfe=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,lfe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,ea={alphamap_fragment:Iue,alphamap_pars_fragment:Fue,alphatest_fragment:Rue,alphatest_pars_fragment:Pue,aomap_fragment:Lue,aomap_pars_fragment:Bue,begin_vertex:jue,beginnormal_vertex:zue,bsdfs:Uue,iridescence_fragment:Wue,bumpmap_pars_fragment:Vue,clipping_planes_fragment:Hue,clipping_planes_pars_fragment:Gue,clipping_planes_pars_vertex:que,clipping_planes_vertex:$ue,color_fragment:Xue,color_pars_fragment:Kue,color_pars_vertex:Yue,color_vertex:Jue,common:Que,cube_uv_reflection_fragment:Zue,defaultnormal_vertex:ece,displacementmap_pars_vertex:tce,displacementmap_vertex:nce,emissivemap_fragment:rce,emissivemap_pars_fragment:ice,encodings_fragment:oce,encodings_pars_fragment:ace,envmap_fragment:sce,envmap_common_pars_fragment:uce,envmap_pars_fragment:cce,envmap_pars_vertex:lce,envmap_physical_pars_fragment:_ce,envmap_vertex:fce,fog_vertex:dce,fog_pars_vertex:hce,fog_fragment:pce,fog_pars_fragment:mce,gradientmap_pars_fragment:gce,lightmap_fragment:vce,lightmap_pars_fragment:yce,lights_lambert_fragment:bce,lights_lambert_pars_fragment:xce,lights_pars_begin:wce,lights_toon_fragment:Ece,lights_toon_pars_fragment:Sce,lights_phong_fragment:kce,lights_phong_pars_fragment:Cce,lights_physical_fragment:Ace,lights_physical_pars_fragment:Oce,lights_fragment_begin:Tce,lights_fragment_maps:Mce,lights_fragment_end:Dce,logdepthbuf_fragment:Nce,logdepthbuf_pars_fragment:Ice,logdepthbuf_pars_vertex:Fce,logdepthbuf_vertex:Rce,map_fragment:Pce,map_pars_fragment:Lce,map_particle_fragment:Bce,map_particle_pars_fragment:jce,metalnessmap_fragment:zce,metalnessmap_pars_fragment:Uce,morphcolor_vertex:Wce,morphnormal_vertex:Vce,morphtarget_pars_vertex:Hce,morphtarget_vertex:Gce,normal_fragment_begin:qce,normal_fragment_maps:$ce,normal_pars_fragment:Xce,normal_pars_vertex:Kce,normal_vertex:Yce,normalmap_pars_fragment:Jce,clearcoat_normal_fragment_begin:Qce,clearcoat_normal_fragment_maps:Zce,clearcoat_pars_fragment:ele,iridescence_pars_fragment:tle,output_fragment:nle,packing:rle,premultiplied_alpha_fragment:ile,project_vertex:ole,dithering_fragment:ale,dithering_pars_fragment:sle,roughnessmap_fragment:ule,roughnessmap_pars_fragment:cle,shadowmap_pars_fragment:lle,shadowmap_pars_vertex:fle,shadowmap_vertex:dle,shadowmask_pars_fragment:hle,skinbase_vertex:ple,skinning_pars_vertex:mle,skinning_vertex:gle,skinnormal_vertex:vle,specularmap_fragment:yle,specularmap_pars_fragment:ble,tonemapping_fragment:xle,tonemapping_pars_fragment:wle,transmission_fragment:_le,transmission_pars_fragment:Ele,uv_pars_fragment:Sle,uv_pars_vertex:kle,uv_vertex:Cle,uv2_pars_fragment:Ale,uv2_pars_vertex:Ole,uv2_vertex:Tle,worldpos_vertex:Mle,background_vert:Dle,background_frag:Nle,backgroundCube_vert:Ile,backgroundCube_frag:Fle,cube_vert:Rle,cube_frag:Ple,depth_vert:Lle,depth_frag:Ble,distanceRGBA_vert:jle,distanceRGBA_frag:zle,equirect_vert:Ule,equirect_frag:Wle,linedashed_vert:Vle,linedashed_frag:Hle,meshbasic_vert:Gle,meshbasic_frag:qle,meshlambert_vert:$le,meshlambert_frag:Xle,meshmatcap_vert:Kle,meshmatcap_frag:Yle,meshnormal_vert:Jle,meshnormal_frag:Qle,meshphong_vert:Zle,meshphong_frag:efe,meshphysical_vert:tfe,meshphysical_frag:nfe,meshtoon_vert:rfe,meshtoon_frag:ife,points_vert:ofe,points_frag:afe,shadow_vert:sfe,shadow_frag:ufe,sprite_vert:cfe,sprite_frag:lfe},vi={common:{diffuse:{value:new vs(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Wm},uv2Transform:{value:new Wm},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new cs(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new vs(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new vs(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Wm}},sprite:{diffuse:{value:new vs(16777215)},opacity:{value:1},center:{value:new cs(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Wm}}},by={basic:{uniforms:ph([vi.common,vi.specularmap,vi.envmap,vi.aomap,vi.lightmap,vi.fog]),vertexShader:ea.meshbasic_vert,fragmentShader:ea.meshbasic_frag},lambert:{uniforms:ph([vi.common,vi.specularmap,vi.envmap,vi.aomap,vi.lightmap,vi.emissivemap,vi.bumpmap,vi.normalmap,vi.displacementmap,vi.fog,vi.lights,{emissive:{value:new vs(0)}}]),vertexShader:ea.meshlambert_vert,fragmentShader:ea.meshlambert_frag},phong:{uniforms:ph([vi.common,vi.specularmap,vi.envmap,vi.aomap,vi.lightmap,vi.emissivemap,vi.bumpmap,vi.normalmap,vi.displacementmap,vi.fog,vi.lights,{emissive:{value:new vs(0)},specular:{value:new vs(1118481)},shininess:{value:30}}]),vertexShader:ea.meshphong_vert,fragmentShader:ea.meshphong_frag},standard:{uniforms:ph([vi.common,vi.envmap,vi.aomap,vi.lightmap,vi.emissivemap,vi.bumpmap,vi.normalmap,vi.displacementmap,vi.roughnessmap,vi.metalnessmap,vi.fog,vi.lights,{emissive:{value:new vs(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ea.meshphysical_vert,fragmentShader:ea.meshphysical_frag},toon:{uniforms:ph([vi.common,vi.aomap,vi.lightmap,vi.emissivemap,vi.bumpmap,vi.normalmap,vi.displacementmap,vi.gradientmap,vi.fog,vi.lights,{emissive:{value:new vs(0)}}]),vertexShader:ea.meshtoon_vert,fragmentShader:ea.meshtoon_frag},matcap:{uniforms:ph([vi.common,vi.bumpmap,vi.normalmap,vi.displacementmap,vi.fog,{matcap:{value:null}}]),vertexShader:ea.meshmatcap_vert,fragmentShader:ea.meshmatcap_frag},points:{uniforms:ph([vi.points,vi.fog]),vertexShader:ea.points_vert,fragmentShader:ea.points_frag},dashed:{uniforms:ph([vi.common,vi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ea.linedashed_vert,fragmentShader:ea.linedashed_frag},depth:{uniforms:ph([vi.common,vi.displacementmap]),vertexShader:ea.depth_vert,fragmentShader:ea.depth_frag},normal:{uniforms:ph([vi.common,vi.bumpmap,vi.normalmap,vi.displacementmap,{opacity:{value:1}}]),vertexShader:ea.meshnormal_vert,fragmentShader:ea.meshnormal_frag},sprite:{uniforms:ph([vi.sprite,vi.fog]),vertexShader:ea.sprite_vert,fragmentShader:ea.sprite_frag},background:{uniforms:{uvTransform:{value:new Wm},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ea.background_vert,fragmentShader:ea.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:ea.backgroundCube_vert,fragmentShader:ea.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ea.cube_vert,fragmentShader:ea.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ea.equirect_vert,fragmentShader:ea.equirect_frag},distanceRGBA:{uniforms:ph([vi.common,vi.displacementmap,{referencePosition:{value:new hr},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ea.distanceRGBA_vert,fragmentShader:ea.distanceRGBA_frag},shadow:{uniforms:ph([vi.lights,vi.fog,{color:{value:new vs(0)},opacity:{value:1}}]),vertexShader:ea.shadow_vert,fragmentShader:ea.shadow_frag}};by.physical={uniforms:ph([by.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new cs(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new vs(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new cs},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new vs(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new vs(1,1,1)},specularColorMap:{value:null}}]),vertexShader:ea.meshphysical_vert,fragmentShader:ea.meshphysical_frag};const qA={r:0,b:0,g:0};function ffe(p,o,u,s,r,l,C){const S=new vs(0);let O=l===!0?0:1,U,j,N=null,L=0,W=null;function z(I,Z){let Y=!1,G=Z.isScene===!0?Z.background:null;G&&G.isTexture&&(G=(Z.backgroundBlurriness>0?u:o).get(G));const oe=p.xr,ce=oe.getSession&&oe.getSession();ce&&ce.environmentBlendMode==="additive"&&(G=null),G===null?q(S,O):G&&G.isColor&&(q(G,1),Y=!0),(p.autoClear||Y)&&p.clear(p.autoClearColor,p.autoClearDepth,p.autoClearStencil),G&&(G.isCubeTexture||G.mapping===tT)?(j===void 0&&(j=new Q0(new ZS(1,1,1),new uw({name:"BackgroundCubeMaterial",uniforms:J2(by.backgroundCube.uniforms),vertexShader:by.backgroundCube.vertexShader,fragmentShader:by.backgroundCube.fragmentShader,side:Wg,depthTest:!1,depthWrite:!1,fog:!1})),j.geometry.deleteAttribute("normal"),j.geometry.deleteAttribute("uv"),j.onBeforeRender=function(be,Ee,ve){this.matrixWorld.copyPosition(ve.matrixWorld)},Object.defineProperty(j.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(j)),j.material.uniforms.envMap.value=G,j.material.uniforms.flipEnvMap.value=G.isCubeTexture&&G.isRenderTargetTexture===!1?-1:1,j.material.uniforms.backgroundBlurriness.value=Z.backgroundBlurriness,j.material.uniforms.backgroundIntensity.value=Z.backgroundIntensity,j.material.toneMapped=G.encoding!==tu,(N!==G||L!==G.version||W!==p.toneMapping)&&(j.material.needsUpdate=!0,N=G,L=G.version,W=p.toneMapping),j.layers.enableAll(),I.unshift(j,j.geometry,j.material,0,0,null)):G&&G.isTexture&&(U===void 0&&(U=new Q0(new rT(2,2),new uw({name:"BackgroundMaterial",uniforms:J2(by.background.uniforms),vertexShader:by.background.vertexShader,fragmentShader:by.background.fragmentShader,side:iw,depthTest:!1,depthWrite:!1,fog:!1})),U.geometry.deleteAttribute("normal"),Object.defineProperty(U.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(U)),U.material.uniforms.t2D.value=G,U.material.uniforms.backgroundIntensity.value=Z.backgroundIntensity,U.material.toneMapped=G.encoding!==tu,G.matrixAutoUpdate===!0&&G.updateMatrix(),U.material.uniforms.uvTransform.value.copy(G.matrix),(N!==G||L!==G.version||W!==p.toneMapping)&&(U.material.needsUpdate=!0,N=G,L=G.version,W=p.toneMapping),U.layers.enableAll(),I.unshift(U,U.geometry,U.material,0,0,null))}function q(I,Z){I.getRGB(qA,OG(p)),s.buffers.color.setClear(qA.r,qA.g,qA.b,Z,C)}return{getClearColor:function(){return S},setClearColor:function(I,Z=1){S.set(I),O=Z,q(S,O)},getClearAlpha:function(){return O},setClearAlpha:function(I){O=I,q(S,O)},render:z}}function dfe(p,o,u,s){const r=p.getParameter(34921),l=s.isWebGL2?null:o.get("OES_vertex_array_object"),C=s.isWebGL2||l!==null,S={},O=I(null);let U=O,j=!1;function N(we,bt,jt,Mt,ze){let Ut=!1;if(C){const Ft=q(Mt,jt,bt);U!==Ft&&(U=Ft,W(U.object)),Ut=Z(we,Mt,jt,ze),Ut&&Y(we,Mt,jt,ze)}else{const Ft=bt.wireframe===!0;(U.geometry!==Mt.id||U.program!==jt.id||U.wireframe!==Ft)&&(U.geometry=Mt.id,U.program=jt.id,U.wireframe=Ft,Ut=!0)}ze!==null&&u.update(ze,34963),(Ut||j)&&(j=!1,ve(we,bt,jt,Mt),ze!==null&&p.bindBuffer(34963,u.get(ze).buffer))}function L(){return s.isWebGL2?p.createVertexArray():l.createVertexArrayOES()}function W(we){return s.isWebGL2?p.bindVertexArray(we):l.bindVertexArrayOES(we)}function z(we){return s.isWebGL2?p.deleteVertexArray(we):l.deleteVertexArrayOES(we)}function q(we,bt,jt){const Mt=jt.wireframe===!0;let ze=S[we.id];ze===void 0&&(ze={},S[we.id]=ze);let Ut=ze[bt.id];Ut===void 0&&(Ut={},ze[bt.id]=Ut);let Ft=Ut[Mt];return Ft===void 0&&(Ft=I(L()),Ut[Mt]=Ft),Ft}function I(we){const bt=[],jt=[],Mt=[];for(let ze=0;ze<r;ze++)bt[ze]=0,jt[ze]=0,Mt[ze]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:bt,enabledAttributes:jt,attributeDivisors:Mt,object:we,attributes:{},index:null}}function Z(we,bt,jt,Mt){const ze=U.attributes,Ut=bt.attributes;let Ft=0;const pt=jt.getAttributes();for(const yt in pt)if(pt[yt].location>=0){const xt=ze[yt];let _t=Ut[yt];if(_t===void 0&&(yt==="instanceMatrix"&&we.instanceMatrix&&(_t=we.instanceMatrix),yt==="instanceColor"&&we.instanceColor&&(_t=we.instanceColor)),xt===void 0||xt.attribute!==_t||_t&&xt.data!==_t.data)return!0;Ft++}return U.attributesNum!==Ft||U.index!==Mt}function Y(we,bt,jt,Mt){const ze={},Ut=bt.attributes;let Ft=0;const pt=jt.getAttributes();for(const yt in pt)if(pt[yt].location>=0){let xt=Ut[yt];xt===void 0&&(yt==="instanceMatrix"&&we.instanceMatrix&&(xt=we.instanceMatrix),yt==="instanceColor"&&we.instanceColor&&(xt=we.instanceColor));const _t={};_t.attribute=xt,xt&&xt.data&&(_t.data=xt.data),ze[yt]=_t,Ft++}U.attributes=ze,U.attributesNum=Ft,U.index=Mt}function G(){const we=U.newAttributes;for(let bt=0,jt=we.length;bt<jt;bt++)we[bt]=0}function oe(we){ce(we,0)}function ce(we,bt){const jt=U.newAttributes,Mt=U.enabledAttributes,ze=U.attributeDivisors;jt[we]=1,Mt[we]===0&&(p.enableVertexAttribArray(we),Mt[we]=1),ze[we]!==bt&&((s.isWebGL2?p:o.get("ANGLE_instanced_arrays"))[s.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](we,bt),ze[we]=bt)}function be(){const we=U.newAttributes,bt=U.enabledAttributes;for(let jt=0,Mt=bt.length;jt<Mt;jt++)bt[jt]!==we[jt]&&(p.disableVertexAttribArray(jt),bt[jt]=0)}function Ee(we,bt,jt,Mt,ze,Ut){s.isWebGL2===!0&&(jt===5124||jt===5125)?p.vertexAttribIPointer(we,bt,jt,ze,Ut):p.vertexAttribPointer(we,bt,jt,Mt,ze,Ut)}function ve(we,bt,jt,Mt){if(s.isWebGL2===!1&&(we.isInstancedMesh||Mt.isInstancedBufferGeometry)&&o.get("ANGLE_instanced_arrays")===null)return;G();const ze=Mt.attributes,Ut=jt.getAttributes(),Ft=bt.defaultAttributeValues;for(const pt in Ut){const yt=Ut[pt];if(yt.location>=0){let nn=ze[pt];if(nn===void 0&&(pt==="instanceMatrix"&&we.instanceMatrix&&(nn=we.instanceMatrix),pt==="instanceColor"&&we.instanceColor&&(nn=we.instanceColor)),nn!==void 0){const xt=nn.normalized,_t=nn.itemSize,Yt=u.get(nn);if(Yt===void 0)continue;const Fn=Yt.buffer,Rn=Yt.type,cn=Yt.bytesPerElement;if(nn.isInterleavedBufferAttribute){const qe=nn.data,Qe=qe.stride,$e=nn.offset;if(qe.isInstancedInterleavedBuffer){for(let ft=0;ft<yt.locationSize;ft++)ce(yt.location+ft,qe.meshPerAttribute);we.isInstancedMesh!==!0&&Mt._maxInstanceCount===void 0&&(Mt._maxInstanceCount=qe.meshPerAttribute*qe.count)}else for(let ft=0;ft<yt.locationSize;ft++)oe(yt.location+ft);p.bindBuffer(34962,Fn);for(let ft=0;ft<yt.locationSize;ft++)Ee(yt.location+ft,_t/yt.locationSize,Rn,xt,Qe*cn,($e+_t/yt.locationSize*ft)*cn)}else{if(nn.isInstancedBufferAttribute){for(let qe=0;qe<yt.locationSize;qe++)ce(yt.location+qe,nn.meshPerAttribute);we.isInstancedMesh!==!0&&Mt._maxInstanceCount===void 0&&(Mt._maxInstanceCount=nn.meshPerAttribute*nn.count)}else for(let qe=0;qe<yt.locationSize;qe++)oe(yt.location+qe);p.bindBuffer(34962,Fn);for(let qe=0;qe<yt.locationSize;qe++)Ee(yt.location+qe,_t/yt.locationSize,Rn,xt,_t*cn,_t/yt.locationSize*qe*cn)}}else if(Ft!==void 0){const xt=Ft[pt];if(xt!==void 0)switch(xt.length){case 2:p.vertexAttrib2fv(yt.location,xt);break;case 3:p.vertexAttrib3fv(yt.location,xt);break;case 4:p.vertexAttrib4fv(yt.location,xt);break;default:p.vertexAttrib1fv(yt.location,xt)}}}}be()}function ge(){It();for(const we in S){const bt=S[we];for(const jt in bt){const Mt=bt[jt];for(const ze in Mt)z(Mt[ze].object),delete Mt[ze];delete bt[jt]}delete S[we]}}function Ge(we){if(S[we.id]===void 0)return;const bt=S[we.id];for(const jt in bt){const Mt=bt[jt];for(const ze in Mt)z(Mt[ze].object),delete Mt[ze];delete bt[jt]}delete S[we.id]}function ht(we){for(const bt in S){const jt=S[bt];if(jt[we.id]===void 0)continue;const Mt=jt[we.id];for(const ze in Mt)z(Mt[ze].object),delete Mt[ze];delete jt[we.id]}}function It(){St(),j=!0,U!==O&&(U=O,W(U.object))}function St(){O.geometry=null,O.program=null,O.wireframe=!1}return{setup:N,reset:It,resetDefaultState:St,dispose:ge,releaseStatesOfGeometry:Ge,releaseStatesOfProgram:ht,initAttributes:G,enableAttribute:oe,disableUnusedAttributes:be}}function hfe(p,o,u,s){const r=s.isWebGL2;let l;function C(U){l=U}function S(U,j){p.drawArrays(l,U,j),u.update(j,l,1)}function O(U,j,N){if(N===0)return;let L,W;if(r)L=p,W="drawArraysInstanced";else if(L=o.get("ANGLE_instanced_arrays"),W="drawArraysInstancedANGLE",L===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}L[W](l,U,j,N),u.update(j,l,N)}this.setMode=C,this.render=S,this.renderInstances=O}function pfe(p,o,u){let s;function r(){if(s!==void 0)return s;if(o.has("EXT_texture_filter_anisotropic")===!0){const Ee=o.get("EXT_texture_filter_anisotropic");s=p.getParameter(Ee.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s}function l(Ee){if(Ee==="highp"){if(p.getShaderPrecisionFormat(35633,36338).precision>0&&p.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";Ee="mediump"}return Ee==="mediump"&&p.getShaderPrecisionFormat(35633,36337).precision>0&&p.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const C=typeof WebGL2RenderingContext<"u"&&p instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&p instanceof WebGL2ComputeRenderingContext;let S=u.precision!==void 0?u.precision:"highp";const O=l(S);O!==S&&(console.warn("THREE.WebGLRenderer:",S,"not supported, using",O,"instead."),S=O);const U=C||o.has("WEBGL_draw_buffers"),j=u.logarithmicDepthBuffer===!0,N=p.getParameter(34930),L=p.getParameter(35660),W=p.getParameter(3379),z=p.getParameter(34076),q=p.getParameter(34921),I=p.getParameter(36347),Z=p.getParameter(36348),Y=p.getParameter(36349),G=L>0,oe=C||o.has("OES_texture_float"),ce=G&&oe,be=C?p.getParameter(36183):0;return{isWebGL2:C,drawBuffers:U,getMaxAnisotropy:r,getMaxPrecision:l,precision:S,logarithmicDepthBuffer:j,maxTextures:N,maxVertexTextures:L,maxTextureSize:W,maxCubemapSize:z,maxAttributes:q,maxVertexUniforms:I,maxVaryings:Z,maxFragmentUniforms:Y,vertexTextures:G,floatFragmentTextures:oe,floatVertexTextures:ce,maxSamples:be}}function mfe(p){const o=this;let u=null,s=0,r=!1,l=!1;const C=new Ux,S=new Wm,O={value:null,needsUpdate:!1};this.uniform=O,this.numPlanes=0,this.numIntersection=0,this.init=function(N,L,W){const z=N.length!==0||L||s!==0||r;return r=L,u=j(N,W,0),s=N.length,z},this.beginShadows=function(){l=!0,j(null)},this.endShadows=function(){l=!1,U()},this.setState=function(N,L,W){const z=N.clippingPlanes,q=N.clipIntersection,I=N.clipShadows,Z=p.get(N);if(!r||z===null||z.length===0||l&&!I)l?j(null):U();else{const Y=l?0:s,G=Y*4;let oe=Z.clippingState||null;O.value=oe,oe=j(z,L,G,W);for(let ce=0;ce!==G;++ce)oe[ce]=u[ce];Z.clippingState=oe,this.numIntersection=q?this.numPlanes:0,this.numPlanes+=Y}};function U(){O.value!==u&&(O.value=u,O.needsUpdate=s>0),o.numPlanes=s,o.numIntersection=0}function j(N,L,W,z){const q=N!==null?N.length:0;let I=null;if(q!==0){if(I=O.value,z!==!0||I===null){const Z=W+q*4,Y=L.matrixWorldInverse;S.getNormalMatrix(Y),(I===null||I.length<Z)&&(I=new Float32Array(Z));for(let G=0,oe=W;G!==q;++G,oe+=4)C.copy(N[G]).applyMatrix4(Y,S),C.normal.toArray(I,oe),I[oe+3]=C.constant}O.value=I,O.needsUpdate=!0}return o.numPlanes=q,o.numIntersection=0,I}}function gfe(p){let o=new WeakMap;function u(C,S){return S===QF?C.mapping=X2:S===ZF&&(C.mapping=K2),C}function s(C){if(C&&C.isTexture&&C.isRenderTargetTexture===!1){const S=C.mapping;if(S===QF||S===ZF)if(o.has(C)){const O=o.get(C).texture;return u(O,C.mapping)}else{const O=C.image;if(O&&O.height>0){const U=new Tue(O.height/2);return U.fromEquirectangularTexture(p,C),o.set(C,U),C.addEventListener("dispose",r),u(U.texture,C.mapping)}else return null}}return C}function r(C){const S=C.target;S.removeEventListener("dispose",r);const O=o.get(S);O!==void 0&&(o.delete(S),O.dispose())}function l(){o=new WeakMap}return{get:s,dispose:l}}class rR extends TG{constructor(o=-1,u=1,s=1,r=-1,l=.1,C=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=o,this.right=u,this.top=s,this.bottom=r,this.near=l,this.far=C,this.updateProjectionMatrix()}copy(o,u){return super.copy(o,u),this.left=o.left,this.right=o.right,this.top=o.top,this.bottom=o.bottom,this.near=o.near,this.far=o.far,this.zoom=o.zoom,this.view=o.view===null?null:Object.assign({},o.view),this}setViewOffset(o,u,s,r,l,C){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=o,this.view.fullHeight=u,this.view.offsetX=s,this.view.offsetY=r,this.view.width=l,this.view.height=C,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const o=(this.right-this.left)/(2*this.zoom),u=(this.top-this.bottom)/(2*this.zoom),s=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let l=s-o,C=s+o,S=r+u,O=r-u;if(this.view!==null&&this.view.enabled){const U=(this.right-this.left)/this.view.fullWidth/this.zoom,j=(this.top-this.bottom)/this.view.fullHeight/this.zoom;l+=U*this.view.offsetX,C=l+U*this.view.width,S-=j*this.view.offsetY,O=S-j*this.view.height}this.projectionMatrix.makeOrthographic(l,C,S,O,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(o){const u=super.toJSON(o);return u.object.zoom=this.zoom,u.object.left=this.left,u.object.right=this.right,u.object.top=this.top,u.object.bottom=this.bottom,u.object.near=this.near,u.object.far=this.far,this.view!==null&&(u.object.view=Object.assign({},this.view)),u}}const N2=4,EW=[.125,.215,.35,.446,.526,.582],Vx=20,JI=new rR,SW=new vs;let QI=null;const Wx=(1+Math.sqrt(5))/2,y2=1/Wx,kW=[new hr(1,1,1),new hr(-1,1,1),new hr(1,1,-1),new hr(-1,1,-1),new hr(0,Wx,y2),new hr(0,Wx,-y2),new hr(y2,0,Wx),new hr(-y2,0,Wx),new hr(Wx,y2,0),new hr(-Wx,y2,0)];class CW{constructor(o){this._renderer=o,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(o,u=0,s=.1,r=100){QI=this._renderer.getRenderTarget(),this._setSize(256);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(o,s,r,l),u>0&&this._blur(l,0,0,u),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(o,u=null){return this._fromTexture(o,u)}fromCubemap(o,u=null){return this._fromTexture(o,u)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=TW(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=OW(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(o){this._lodMax=Math.floor(Math.log2(o)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let o=0;o<this._lodPlanes.length;o++)this._lodPlanes[o].dispose()}_cleanup(o){this._renderer.setRenderTarget(QI),o.scissorTest=!1,$A(o,0,0,o.width,o.height)}_fromTexture(o,u){o.mapping===X2||o.mapping===K2?this._setSize(o.image.length===0?16:o.image[0].width||o.image[0].image.width):this._setSize(o.image.width/4),QI=this._renderer.getRenderTarget();const s=u||this._allocateTargets();return this._textureToCubeUV(o,s),this._applyPMREM(s),this._cleanup(s),s}_allocateTargets(){const o=3*Math.max(this._cubeSize,112),u=4*this._cubeSize,s={magFilter:Ap,minFilter:Ap,generateMipmaps:!1,type:US,format:J0,encoding:aw,depthBuffer:!1},r=AW(o,u,s);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==o){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=AW(o,u,s);const{_lodMax:l}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=vfe(l)),this._blurMaterial=yfe(l,o,u)}return r}_compileMaterial(o){const u=new Q0(this._lodPlanes[0],o);this._renderer.compile(u,JI)}_sceneToCubeUV(o,u,s,r){const S=new jg(90,1,u,s),O=[1,-1,1,1,1,1],U=[1,1,1,-1,-1,-1],j=this._renderer,N=j.autoClear,L=j.toneMapping;j.getClearColor(SW),j.toneMapping=k1,j.autoClear=!1;const W=new _S({name:"PMREM.Background",side:Wg,depthWrite:!1,depthTest:!1}),z=new Q0(new ZS,W);let q=!1;const I=o.background;I?I.isColor&&(W.color.copy(I),o.background=null,q=!0):(W.color.copy(SW),q=!0);for(let Z=0;Z<6;Z++){const Y=Z%3;Y===0?(S.up.set(0,O[Z],0),S.lookAt(U[Z],0,0)):Y===1?(S.up.set(0,0,O[Z]),S.lookAt(0,U[Z],0)):(S.up.set(0,O[Z],0),S.lookAt(0,0,U[Z]));const G=this._cubeSize;$A(r,Y*G,Z>2?G:0,G,G),j.setRenderTarget(r),q&&j.render(z,S),j.render(o,S)}z.geometry.dispose(),z.material.dispose(),j.toneMapping=L,j.autoClear=N,o.background=I}_textureToCubeUV(o,u){const s=this._renderer,r=o.mapping===X2||o.mapping===K2;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=TW()),this._cubemapMaterial.uniforms.flipEnvMap.value=o.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=OW());const l=r?this._cubemapMaterial:this._equirectMaterial,C=new Q0(this._lodPlanes[0],l),S=l.uniforms;S.envMap.value=o;const O=this._cubeSize;$A(u,0,0,3*O,2*O),s.setRenderTarget(u),s.render(C,JI)}_applyPMREM(o){const u=this._renderer,s=u.autoClear;u.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const l=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),C=kW[(r-1)%kW.length];this._blur(o,r-1,r,l,C)}u.autoClear=s}_blur(o,u,s,r,l){const C=this._pingPongRenderTarget;this._halfBlur(o,C,u,s,r,"latitudinal",l),this._halfBlur(C,o,s,s,r,"longitudinal",l)}_halfBlur(o,u,s,r,l,C,S){const O=this._renderer,U=this._blurMaterial;C!=="latitudinal"&&C!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const j=3,N=new Q0(this._lodPlanes[r],U),L=U.uniforms,W=this._sizeLods[s]-1,z=isFinite(l)?Math.PI/(2*W):2*Math.PI/(2*Vx-1),q=l/z,I=isFinite(l)?1+Math.floor(j*q):Vx;I>Vx&&console.warn(`sigmaRadians, ${l}, is too large and will clip, as it requested ${I} samples when the maximum is set to ${Vx}`);const Z=[];let Y=0;for(let Ee=0;Ee<Vx;++Ee){const ve=Ee/q,ge=Math.exp(-ve*ve/2);Z.push(ge),Ee===0?Y+=ge:Ee<I&&(Y+=2*ge)}for(let Ee=0;Ee<Z.length;Ee++)Z[Ee]=Z[Ee]/Y;L.envMap.value=o.texture,L.samples.value=I,L.weights.value=Z,L.latitudinal.value=C==="latitudinal",S&&(L.poleAxis.value=S);const{_lodMax:G}=this;L.dTheta.value=z,L.mipInt.value=G-s;const oe=this._sizeLods[r],ce=3*oe*(r>G-N2?r-G+N2:0),be=4*(this._cubeSize-oe);$A(u,ce,be,3*oe,2*oe),O.setRenderTarget(u),O.render(N,JI)}}function vfe(p){const o=[],u=[],s=[];let r=p;const l=p-N2+1+EW.length;for(let C=0;C<l;C++){const S=Math.pow(2,r);u.push(S);let O=1/S;C>p-N2?O=EW[C-p+N2-1]:C===0&&(O=0),s.push(O);const U=1/(S-2),j=-U,N=1+U,L=[j,j,N,j,N,N,j,j,N,N,j,N],W=6,z=6,q=3,I=2,Z=1,Y=new Float32Array(q*z*W),G=new Float32Array(I*z*W),oe=new Float32Array(Z*z*W);for(let be=0;be<W;be++){const Ee=be%3*2/3-1,ve=be>2?0:-1,ge=[Ee,ve,0,Ee+2/3,ve,0,Ee+2/3,ve+1,0,Ee,ve,0,Ee+2/3,ve+1,0,Ee,ve+1,0];Y.set(ge,q*z*be),G.set(L,I*z*be);const Ge=[be,be,be,be,be,be];oe.set(Ge,Z*z*be)}const ce=new nv;ce.setAttribute("position",new Ey(Y,q)),ce.setAttribute("uv",new Ey(G,I)),ce.setAttribute("faceIndex",new Ey(oe,Z)),o.push(ce),r>N2&&r--}return{lodPlanes:o,sizeLods:u,sigmas:s}}function AW(p,o,u){const s=new sw(p,o,u);return s.texture.mapping=tT,s.texture.name="PMREM.cubeUv",s.scissorTest=!0,s}function $A(p,o,u,s,r){p.viewport.set(o,u,s,r),p.scissor.set(o,u,s,r)}function yfe(p,o,u){const s=new Float32Array(Vx),r=new hr(0,1,0);return new uw({name:"SphericalGaussianBlur",defines:{n:Vx,CUBEUV_TEXEL_WIDTH:1/o,CUBEUV_TEXEL_HEIGHT:1/u,CUBEUV_MAX_MIP:`${p}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:s},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:r5(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ub,depthTest:!1,depthWrite:!1})}function OW(){return new uw({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:r5(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Ub,depthTest:!1,depthWrite:!1})}function TW(){return new uw({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:r5(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Ub,depthTest:!1,depthWrite:!1})}function r5(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function bfe(p){let o=new WeakMap,u=null;function s(S){if(S&&S.isTexture){const O=S.mapping,U=O===QF||O===ZF,j=O===X2||O===K2;if(U||j)if(S.isRenderTargetTexture&&S.needsPMREMUpdate===!0){S.needsPMREMUpdate=!1;let N=o.get(S);return u===null&&(u=new CW(p)),N=U?u.fromEquirectangular(S,N):u.fromCubemap(S,N),o.set(S,N),N.texture}else{if(o.has(S))return o.get(S).texture;{const N=S.image;if(U&&N&&N.height>0||j&&N&&r(N)){u===null&&(u=new CW(p));const L=U?u.fromEquirectangular(S):u.fromCubemap(S);return o.set(S,L),S.addEventListener("dispose",l),L.texture}else return null}}}return S}function r(S){let O=0;const U=6;for(let j=0;j<U;j++)S[j]!==void 0&&O++;return O===U}function l(S){const O=S.target;O.removeEventListener("dispose",l);const U=o.get(O);U!==void 0&&(o.delete(O),U.dispose())}function C(){o=new WeakMap,u!==null&&(u.dispose(),u=null)}return{get:s,dispose:C}}function xfe(p){const o={};function u(s){if(o[s]!==void 0)return o[s];let r;switch(s){case"WEBGL_depth_texture":r=p.getExtension("WEBGL_depth_texture")||p.getExtension("MOZ_WEBGL_depth_texture")||p.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=p.getExtension("EXT_texture_filter_anisotropic")||p.getExtension("MOZ_EXT_texture_filter_anisotropic")||p.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=p.getExtension("WEBGL_compressed_texture_s3tc")||p.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||p.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=p.getExtension("WEBGL_compressed_texture_pvrtc")||p.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=p.getExtension(s)}return o[s]=r,r}return{has:function(s){return u(s)!==null},init:function(s){s.isWebGL2?u("EXT_color_buffer_float"):(u("WEBGL_depth_texture"),u("OES_texture_float"),u("OES_texture_half_float"),u("OES_texture_half_float_linear"),u("OES_standard_derivatives"),u("OES_element_index_uint"),u("OES_vertex_array_object"),u("ANGLE_instanced_arrays")),u("OES_texture_float_linear"),u("EXT_color_buffer_half_float"),u("WEBGL_multisampled_render_to_texture")},get:function(s){const r=u(s);return r===null&&console.warn("THREE.WebGLRenderer: "+s+" extension not supported."),r}}}function wfe(p,o,u,s){const r={},l=new WeakMap;function C(N){const L=N.target;L.index!==null&&o.remove(L.index);for(const z in L.attributes)o.remove(L.attributes[z]);L.removeEventListener("dispose",C),delete r[L.id];const W=l.get(L);W&&(o.remove(W),l.delete(L)),s.releaseStatesOfGeometry(L),L.isInstancedBufferGeometry===!0&&delete L._maxInstanceCount,u.memory.geometries--}function S(N,L){return r[L.id]===!0||(L.addEventListener("dispose",C),r[L.id]=!0,u.memory.geometries++),L}function O(N){const L=N.attributes;for(const z in L)o.update(L[z],34962);const W=N.morphAttributes;for(const z in W){const q=W[z];for(let I=0,Z=q.length;I<Z;I++)o.update(q[I],34962)}}function U(N){const L=[],W=N.index,z=N.attributes.position;let q=0;if(W!==null){const Y=W.array;q=W.version;for(let G=0,oe=Y.length;G<oe;G+=3){const ce=Y[G+0],be=Y[G+1],Ee=Y[G+2];L.push(ce,be,be,Ee,Ee,ce)}}else{const Y=z.array;q=z.version;for(let G=0,oe=Y.length/3-1;G<oe;G+=3){const ce=G+0,be=G+1,Ee=G+2;L.push(ce,be,be,Ee,Ee,ce)}}const I=new(bG(L)?AG:CG)(L,1);I.version=q;const Z=l.get(N);Z&&o.remove(Z),l.set(N,I)}function j(N){const L=l.get(N);if(L){const W=N.index;W!==null&&L.version<W.version&&U(N)}else U(N);return l.get(N)}return{get:S,update:O,getWireframeAttribute:j}}function _fe(p,o,u,s){const r=s.isWebGL2;let l;function C(L){l=L}let S,O;function U(L){S=L.type,O=L.bytesPerElement}function j(L,W){p.drawElements(l,W,S,L*O),u.update(W,l,1)}function N(L,W,z){if(z===0)return;let q,I;if(r)q=p,I="drawElementsInstanced";else if(q=o.get("ANGLE_instanced_arrays"),I="drawElementsInstancedANGLE",q===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}q[I](l,W,S,L*O,z),u.update(W,l,z)}this.setMode=C,this.setIndex=U,this.render=j,this.renderInstances=N}function Efe(p){const o={geometries:0,textures:0},u={frame:0,calls:0,triangles:0,points:0,lines:0};function s(l,C,S){switch(u.calls++,C){case 4:u.triangles+=S*(l/3);break;case 1:u.lines+=S*(l/2);break;case 3:u.lines+=S*(l-1);break;case 2:u.lines+=S*l;break;case 0:u.points+=S*l;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",C);break}}function r(){u.frame++,u.calls=0,u.triangles=0,u.points=0,u.lines=0}return{memory:o,render:u,programs:null,autoReset:!0,reset:r,update:s}}function Sfe(p,o){return p[0]-o[0]}function kfe(p,o){return Math.abs(o[1])-Math.abs(p[1])}function Cfe(p,o,u){const s={},r=new Float32Array(8),l=new WeakMap,C=new yu,S=[];for(let U=0;U<8;U++)S[U]=[U,0];function O(U,j,N,L){const W=U.morphTargetInfluences;if(o.isWebGL2===!0){const q=j.morphAttributes.position||j.morphAttributes.normal||j.morphAttributes.color,I=q!==void 0?q.length:0;let Z=l.get(j);if(Z===void 0||Z.count!==I){let jt=function(){we.dispose(),l.delete(j),j.removeEventListener("dispose",jt)};var z=jt;Z!==void 0&&Z.texture.dispose();const oe=j.morphAttributes.position!==void 0,ce=j.morphAttributes.normal!==void 0,be=j.morphAttributes.color!==void 0,Ee=j.morphAttributes.position||[],ve=j.morphAttributes.normal||[],ge=j.morphAttributes.color||[];let Ge=0;oe===!0&&(Ge=1),ce===!0&&(Ge=2),be===!0&&(Ge=3);let ht=j.attributes.position.count*Ge,It=1;ht>o.maxTextureSize&&(It=Math.ceil(ht/o.maxTextureSize),ht=o.maxTextureSize);const St=new Float32Array(ht*It*4*I),we=new EG(St,ht,It,I);we.type=Xx,we.needsUpdate=!0;const bt=Ge*4;for(let Mt=0;Mt<I;Mt++){const ze=Ee[Mt],Ut=ve[Mt],Ft=ge[Mt],pt=ht*It*4*Mt;for(let yt=0;yt<ze.count;yt++){const nn=yt*bt;oe===!0&&(C.fromBufferAttribute(ze,yt),St[pt+nn+0]=C.x,St[pt+nn+1]=C.y,St[pt+nn+2]=C.z,St[pt+nn+3]=0),ce===!0&&(C.fromBufferAttribute(Ut,yt),St[pt+nn+4]=C.x,St[pt+nn+5]=C.y,St[pt+nn+6]=C.z,St[pt+nn+7]=0),be===!0&&(C.fromBufferAttribute(Ft,yt),St[pt+nn+8]=C.x,St[pt+nn+9]=C.y,St[pt+nn+10]=C.z,St[pt+nn+11]=Ft.itemSize===4?C.w:1)}}Z={count:I,texture:we,size:new cs(ht,It)},l.set(j,Z),j.addEventListener("dispose",jt)}let Y=0;for(let oe=0;oe<W.length;oe++)Y+=W[oe];const G=j.morphTargetsRelative?1:1-Y;L.getUniforms().setValue(p,"morphTargetBaseInfluence",G),L.getUniforms().setValue(p,"morphTargetInfluences",W),L.getUniforms().setValue(p,"morphTargetsTexture",Z.texture,u),L.getUniforms().setValue(p,"morphTargetsTextureSize",Z.size)}else{const q=W===void 0?0:W.length;let I=s[j.id];if(I===void 0||I.length!==q){I=[];for(let ce=0;ce<q;ce++)I[ce]=[ce,0];s[j.id]=I}for(let ce=0;ce<q;ce++){const be=I[ce];be[0]=ce,be[1]=W[ce]}I.sort(kfe);for(let ce=0;ce<8;ce++)ce<q&&I[ce][1]?(S[ce][0]=I[ce][0],S[ce][1]=I[ce][1]):(S[ce][0]=Number.MAX_SAFE_INTEGER,S[ce][1]=0);S.sort(Sfe);const Z=j.morphAttributes.position,Y=j.morphAttributes.normal;let G=0;for(let ce=0;ce<8;ce++){const be=S[ce],Ee=be[0],ve=be[1];Ee!==Number.MAX_SAFE_INTEGER&&ve?(Z&&j.getAttribute("morphTarget"+ce)!==Z[Ee]&&j.setAttribute("morphTarget"+ce,Z[Ee]),Y&&j.getAttribute("morphNormal"+ce)!==Y[Ee]&&j.setAttribute("morphNormal"+ce,Y[Ee]),r[ce]=ve,G+=ve):(Z&&j.hasAttribute("morphTarget"+ce)===!0&&j.deleteAttribute("morphTarget"+ce),Y&&j.hasAttribute("morphNormal"+ce)===!0&&j.deleteAttribute("morphNormal"+ce),r[ce]=0)}const oe=j.morphTargetsRelative?1:1-G;L.getUniforms().setValue(p,"morphTargetBaseInfluence",oe),L.getUniforms().setValue(p,"morphTargetInfluences",r)}}return{update:O}}function Afe(p,o,u,s){let r=new WeakMap;function l(O){const U=s.render.frame,j=O.geometry,N=o.get(O,j);return r.get(N)!==U&&(o.update(N),r.set(N,U)),O.isInstancedMesh&&(O.hasEventListener("dispose",S)===!1&&O.addEventListener("dispose",S),u.update(O.instanceMatrix,34962),O.instanceColor!==null&&u.update(O.instanceColor,34962)),N}function C(){r=new WeakMap}function S(O){const U=O.target;U.removeEventListener("dispose",S),u.remove(U.instanceMatrix),U.instanceColor!==null&&u.remove(U.instanceColor)}return{update:l,dispose:C}}const NG=new Ip,IG=new EG,FG=new hue,RG=new MG,MW=[],DW=[],NW=new Float32Array(16),IW=new Float32Array(9),FW=new Float32Array(4);function n_(p,o,u){const s=p[0];if(s<=0||s>0)return p;const r=o*u;let l=MW[r];if(l===void 0&&(l=new Float32Array(r),MW[r]=l),o!==0){s.toArray(l,0);for(let C=1,S=0;C!==o;++C)S+=u,p[C].toArray(l,S)}return l}function Xc(p,o){if(p.length!==o.length)return!1;for(let u=0,s=p.length;u<s;u++)if(p[u]!==o[u])return!1;return!0}function Kc(p,o){for(let u=0,s=o.length;u<s;u++)p[u]=o[u]}function iT(p,o){let u=DW[o];u===void 0&&(u=new Int32Array(o),DW[o]=u);for(let s=0;s!==o;++s)u[s]=p.allocateTextureUnit();return u}function Ofe(p,o){const u=this.cache;u[0]!==o&&(p.uniform1f(this.addr,o),u[0]=o)}function Tfe(p,o){const u=this.cache;if(o.x!==void 0)(u[0]!==o.x||u[1]!==o.y)&&(p.uniform2f(this.addr,o.x,o.y),u[0]=o.x,u[1]=o.y);else{if(Xc(u,o))return;p.uniform2fv(this.addr,o),Kc(u,o)}}function Mfe(p,o){const u=this.cache;if(o.x!==void 0)(u[0]!==o.x||u[1]!==o.y||u[2]!==o.z)&&(p.uniform3f(this.addr,o.x,o.y,o.z),u[0]=o.x,u[1]=o.y,u[2]=o.z);else if(o.r!==void 0)(u[0]!==o.r||u[1]!==o.g||u[2]!==o.b)&&(p.uniform3f(this.addr,o.r,o.g,o.b),u[0]=o.r,u[1]=o.g,u[2]=o.b);else{if(Xc(u,o))return;p.uniform3fv(this.addr,o),Kc(u,o)}}function Dfe(p,o){const u=this.cache;if(o.x!==void 0)(u[0]!==o.x||u[1]!==o.y||u[2]!==o.z||u[3]!==o.w)&&(p.uniform4f(this.addr,o.x,o.y,o.z,o.w),u[0]=o.x,u[1]=o.y,u[2]=o.z,u[3]=o.w);else{if(Xc(u,o))return;p.uniform4fv(this.addr,o),Kc(u,o)}}function Nfe(p,o){const u=this.cache,s=o.elements;if(s===void 0){if(Xc(u,o))return;p.uniformMatrix2fv(this.addr,!1,o),Kc(u,o)}else{if(Xc(u,s))return;FW.set(s),p.uniformMatrix2fv(this.addr,!1,FW),Kc(u,s)}}function Ife(p,o){const u=this.cache,s=o.elements;if(s===void 0){if(Xc(u,o))return;p.uniformMatrix3fv(this.addr,!1,o),Kc(u,o)}else{if(Xc(u,s))return;IW.set(s),p.uniformMatrix3fv(this.addr,!1,IW),Kc(u,s)}}function Ffe(p,o){const u=this.cache,s=o.elements;if(s===void 0){if(Xc(u,o))return;p.uniformMatrix4fv(this.addr,!1,o),Kc(u,o)}else{if(Xc(u,s))return;NW.set(s),p.uniformMatrix4fv(this.addr,!1,NW),Kc(u,s)}}function Rfe(p,o){const u=this.cache;u[0]!==o&&(p.uniform1i(this.addr,o),u[0]=o)}function Pfe(p,o){const u=this.cache;if(o.x!==void 0)(u[0]!==o.x||u[1]!==o.y)&&(p.uniform2i(this.addr,o.x,o.y),u[0]=o.x,u[1]=o.y);else{if(Xc(u,o))return;p.uniform2iv(this.addr,o),Kc(u,o)}}function Lfe(p,o){const u=this.cache;if(o.x!==void 0)(u[0]!==o.x||u[1]!==o.y||u[2]!==o.z)&&(p.uniform3i(this.addr,o.x,o.y,o.z),u[0]=o.x,u[1]=o.y,u[2]=o.z);else{if(Xc(u,o))return;p.uniform3iv(this.addr,o),Kc(u,o)}}function Bfe(p,o){const u=this.cache;if(o.x!==void 0)(u[0]!==o.x||u[1]!==o.y||u[2]!==o.z||u[3]!==o.w)&&(p.uniform4i(this.addr,o.x,o.y,o.z,o.w),u[0]=o.x,u[1]=o.y,u[2]=o.z,u[3]=o.w);else{if(Xc(u,o))return;p.uniform4iv(this.addr,o),Kc(u,o)}}function jfe(p,o){const u=this.cache;u[0]!==o&&(p.uniform1ui(this.addr,o),u[0]=o)}function zfe(p,o){const u=this.cache;if(o.x!==void 0)(u[0]!==o.x||u[1]!==o.y)&&(p.uniform2ui(this.addr,o.x,o.y),u[0]=o.x,u[1]=o.y);else{if(Xc(u,o))return;p.uniform2uiv(this.addr,o),Kc(u,o)}}function Ufe(p,o){const u=this.cache;if(o.x!==void 0)(u[0]!==o.x||u[1]!==o.y||u[2]!==o.z)&&(p.uniform3ui(this.addr,o.x,o.y,o.z),u[0]=o.x,u[1]=o.y,u[2]=o.z);else{if(Xc(u,o))return;p.uniform3uiv(this.addr,o),Kc(u,o)}}function Wfe(p,o){const u=this.cache;if(o.x!==void 0)(u[0]!==o.x||u[1]!==o.y||u[2]!==o.z||u[3]!==o.w)&&(p.uniform4ui(this.addr,o.x,o.y,o.z,o.w),u[0]=o.x,u[1]=o.y,u[2]=o.z,u[3]=o.w);else{if(Xc(u,o))return;p.uniform4uiv(this.addr,o),Kc(u,o)}}function Vfe(p,o,u){const s=this.cache,r=u.allocateTextureUnit();s[0]!==r&&(p.uniform1i(this.addr,r),s[0]=r),u.setTexture2D(o||NG,r)}function Hfe(p,o,u){const s=this.cache,r=u.allocateTextureUnit();s[0]!==r&&(p.uniform1i(this.addr,r),s[0]=r),u.setTexture3D(o||FG,r)}function Gfe(p,o,u){const s=this.cache,r=u.allocateTextureUnit();s[0]!==r&&(p.uniform1i(this.addr,r),s[0]=r),u.setTextureCube(o||RG,r)}function qfe(p,o,u){const s=this.cache,r=u.allocateTextureUnit();s[0]!==r&&(p.uniform1i(this.addr,r),s[0]=r),u.setTexture2DArray(o||IG,r)}function $fe(p){switch(p){case 5126:return Ofe;case 35664:return Tfe;case 35665:return Mfe;case 35666:return Dfe;case 35674:return Nfe;case 35675:return Ife;case 35676:return Ffe;case 5124:case 35670:return Rfe;case 35667:case 35671:return Pfe;case 35668:case 35672:return Lfe;case 35669:case 35673:return Bfe;case 5125:return jfe;case 36294:return zfe;case 36295:return Ufe;case 36296:return Wfe;case 35678:case 36198:case 36298:case 36306:case 35682:return Vfe;case 35679:case 36299:case 36307:return Hfe;case 35680:case 36300:case 36308:case 36293:return Gfe;case 36289:case 36303:case 36311:case 36292:return qfe}}function Xfe(p,o){p.uniform1fv(this.addr,o)}function Kfe(p,o){const u=n_(o,this.size,2);p.uniform2fv(this.addr,u)}function Yfe(p,o){const u=n_(o,this.size,3);p.uniform3fv(this.addr,u)}function Jfe(p,o){const u=n_(o,this.size,4);p.uniform4fv(this.addr,u)}function Qfe(p,o){const u=n_(o,this.size,4);p.uniformMatrix2fv(this.addr,!1,u)}function Zfe(p,o){const u=n_(o,this.size,9);p.uniformMatrix3fv(this.addr,!1,u)}function ede(p,o){const u=n_(o,this.size,16);p.uniformMatrix4fv(this.addr,!1,u)}function tde(p,o){p.uniform1iv(this.addr,o)}function nde(p,o){p.uniform2iv(this.addr,o)}function rde(p,o){p.uniform3iv(this.addr,o)}function ide(p,o){p.uniform4iv(this.addr,o)}function ode(p,o){p.uniform1uiv(this.addr,o)}function ade(p,o){p.uniform2uiv(this.addr,o)}function sde(p,o){p.uniform3uiv(this.addr,o)}function ude(p,o){p.uniform4uiv(this.addr,o)}function cde(p,o,u){const s=this.cache,r=o.length,l=iT(u,r);Xc(s,l)||(p.uniform1iv(this.addr,l),Kc(s,l));for(let C=0;C!==r;++C)u.setTexture2D(o[C]||NG,l[C])}function lde(p,o,u){const s=this.cache,r=o.length,l=iT(u,r);Xc(s,l)||(p.uniform1iv(this.addr,l),Kc(s,l));for(let C=0;C!==r;++C)u.setTexture3D(o[C]||FG,l[C])}function fde(p,o,u){const s=this.cache,r=o.length,l=iT(u,r);Xc(s,l)||(p.uniform1iv(this.addr,l),Kc(s,l));for(let C=0;C!==r;++C)u.setTextureCube(o[C]||RG,l[C])}function dde(p,o,u){const s=this.cache,r=o.length,l=iT(u,r);Xc(s,l)||(p.uniform1iv(this.addr,l),Kc(s,l));for(let C=0;C!==r;++C)u.setTexture2DArray(o[C]||IG,l[C])}function hde(p){switch(p){case 5126:return Xfe;case 35664:return Kfe;case 35665:return Yfe;case 35666:return Jfe;case 35674:return Qfe;case 35675:return Zfe;case 35676:return ede;case 5124:case 35670:return tde;case 35667:case 35671:return nde;case 35668:case 35672:return rde;case 35669:case 35673:return ide;case 5125:return ode;case 36294:return ade;case 36295:return sde;case 36296:return ude;case 35678:case 36198:case 36298:case 36306:case 35682:return cde;case 35679:case 36299:case 36307:return lde;case 35680:case 36300:case 36308:case 36293:return fde;case 36289:case 36303:case 36311:case 36292:return dde}}class pde{constructor(o,u,s){this.id=o,this.addr=s,this.cache=[],this.setValue=$fe(u.type)}}class mde{constructor(o,u,s){this.id=o,this.addr=s,this.cache=[],this.size=u.size,this.setValue=hde(u.type)}}class gde{constructor(o){this.id=o,this.seq=[],this.map={}}setValue(o,u,s){const r=this.seq;for(let l=0,C=r.length;l!==C;++l){const S=r[l];S.setValue(o,u[S.id],s)}}}const ZI=/(\w+)(\])?(\[|\.)?/g;function RW(p,o){p.seq.push(o),p.map[o.id]=o}function vde(p,o,u){const s=p.name,r=s.length;for(ZI.lastIndex=0;;){const l=ZI.exec(s),C=ZI.lastIndex;let S=l[1];const O=l[2]==="]",U=l[3];if(O&&(S=S|0),U===void 0||U==="["&&C+2===r){RW(u,U===void 0?new pde(S,p,o):new mde(S,p,o));break}else{let N=u.map[S];N===void 0&&(N=new gde(S),RW(u,N)),u=N}}}class cO{constructor(o,u){this.seq=[],this.map={};const s=o.getProgramParameter(u,35718);for(let r=0;r<s;++r){const l=o.getActiveUniform(u,r),C=o.getUniformLocation(u,l.name);vde(l,C,this)}}setValue(o,u,s,r){const l=this.map[u];l!==void 0&&l.setValue(o,s,r)}setOptional(o,u,s){const r=u[s];r!==void 0&&this.setValue(o,s,r)}static upload(o,u,s,r){for(let l=0,C=u.length;l!==C;++l){const S=u[l],O=s[S.id];O.needsUpdate!==!1&&S.setValue(o,O.value,r)}}static seqWithValue(o,u){const s=[];for(let r=0,l=o.length;r!==l;++r){const C=o[r];C.id in u&&s.push(C)}return s}}function PW(p,o,u){const s=p.createShader(o);return p.shaderSource(s,u),p.compileShader(s),s}let yde=0;function bde(p,o){const u=p.split(`
`),s=[],r=Math.max(o-6,0),l=Math.min(o+6,u.length);for(let C=r;C<l;C++){const S=C+1;s.push(`${S===o?">":" "} ${S}: ${u[C]}`)}return s.join(`
`)}function xde(p){switch(p){case aw:return["Linear","( value )"];case tu:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",p),["Linear","( value )"]}}function LW(p,o,u){const s=p.getShaderParameter(o,35713),r=p.getShaderInfoLog(o).trim();if(s&&r==="")return"";const l=/ERROR: 0:(\d+)/.exec(r);if(l){const C=parseInt(l[1]);return u.toUpperCase()+`

`+r+`

`+bde(p.getShaderSource(o),C)}else return r}function wde(p,o){const u=xde(o);return"vec4 "+p+"( vec4 value ) { return LinearTo"+u[0]+u[1]+"; }"}function _de(p,o){let u;switch(o){case jse:u="Linear";break;case zse:u="Reinhard";break;case Use:u="OptimizedCineon";break;case Wse:u="ACESFilmic";break;case Vse:u="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",o),u="Linear"}return"vec3 "+p+"( vec3 color ) { return "+u+"ToneMapping( color ); }"}function Ede(p){return[p.extensionDerivatives||p.envMapCubeUVHeight||p.bumpMap||p.tangentSpaceNormalMap||p.clearcoatNormalMap||p.flatShading||p.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(p.extensionFragDepth||p.logarithmicDepthBuffer)&&p.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",p.extensionDrawBuffers&&p.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(p.extensionShaderTextureLOD||p.envMap||p.transmission)&&p.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(dS).join(`
`)}function Sde(p){const o=[];for(const u in p){const s=p[u];s!==!1&&o.push("#define "+u+" "+s)}return o.join(`
`)}function kde(p,o){const u={},s=p.getProgramParameter(o,35721);for(let r=0;r<s;r++){const l=p.getActiveAttrib(o,r),C=l.name;let S=1;l.type===35674&&(S=2),l.type===35675&&(S=3),l.type===35676&&(S=4),u[C]={type:l.type,location:p.getAttribLocation(o,C),locationSize:S}}return u}function dS(p){return p!==""}function BW(p,o){const u=o.numSpotLightShadows+o.numSpotLightMaps-o.numSpotLightShadowsWithMaps;return p.replace(/NUM_DIR_LIGHTS/g,o.numDirLights).replace(/NUM_SPOT_LIGHTS/g,o.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,o.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,u).replace(/NUM_RECT_AREA_LIGHTS/g,o.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,o.numPointLights).replace(/NUM_HEMI_LIGHTS/g,o.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,o.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,o.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,o.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,o.numPointLightShadows)}function jW(p,o){return p.replace(/NUM_CLIPPING_PLANES/g,o.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,o.numClippingPlanes-o.numClipIntersection)}const Cde=/^[ \t]*#include +<([\w\d./]+)>/gm;function iR(p){return p.replace(Cde,Ade)}function Ade(p,o){const u=ea[o];if(u===void 0)throw new Error("Can not resolve #include <"+o+">");return iR(u)}const Ode=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function zW(p){return p.replace(Ode,Tde)}function Tde(p,o,u,s){let r="";for(let l=parseInt(o);l<parseInt(u);l++)r+=s.replace(/\[\s*i\s*\]/g,"[ "+l+" ]").replace(/UNROLLED_LOOP_INDEX/g,l);return r}function UW(p){let o="precision "+p.precision+` float;
precision `+p.precision+" int;";return p.precision==="highp"?o+=`
#define HIGH_PRECISION`:p.precision==="mediump"?o+=`
#define MEDIUM_PRECISION`:p.precision==="lowp"&&(o+=`
#define LOW_PRECISION`),o}function Mde(p){let o="SHADOWMAP_TYPE_BASIC";return p.shadowMapType===hG?o="SHADOWMAP_TYPE_PCF":p.shadowMapType===vse?o="SHADOWMAP_TYPE_PCF_SOFT":p.shadowMapType===fS&&(o="SHADOWMAP_TYPE_VSM"),o}function Dde(p){let o="ENVMAP_TYPE_CUBE";if(p.envMap)switch(p.envMapMode){case X2:case K2:o="ENVMAP_TYPE_CUBE";break;case tT:o="ENVMAP_TYPE_CUBE_UV";break}return o}function Nde(p){let o="ENVMAP_MODE_REFLECTION";if(p.envMap)switch(p.envMapMode){case K2:o="ENVMAP_MODE_REFRACTION";break}return o}function Ide(p){let o="ENVMAP_BLENDING_NONE";if(p.envMap)switch(p.combine){case gG:o="ENVMAP_BLENDING_MULTIPLY";break;case Lse:o="ENVMAP_BLENDING_MIX";break;case Bse:o="ENVMAP_BLENDING_ADD";break}return o}function Fde(p){const o=p.envMapCubeUVHeight;if(o===null)return null;const u=Math.log2(o)-2,s=1/o;return{texelWidth:1/(3*Math.max(Math.pow(2,u),7*16)),texelHeight:s,maxMip:u}}function Rde(p,o,u,s){const r=p.getContext(),l=u.defines;let C=u.vertexShader,S=u.fragmentShader;const O=Mde(u),U=Dde(u),j=Nde(u),N=Ide(u),L=Fde(u),W=u.isWebGL2?"":Ede(u),z=Sde(l),q=r.createProgram();let I,Z,Y=u.glslVersion?"#version "+u.glslVersion+`
`:"";u.isRawShaderMaterial?(I=[z].filter(dS).join(`
`),I.length>0&&(I+=`
`),Z=[W,z].filter(dS).join(`
`),Z.length>0&&(Z+=`
`)):(I=[UW(u),"#define SHADER_NAME "+u.shaderName,z,u.instancing?"#define USE_INSTANCING":"",u.instancingColor?"#define USE_INSTANCING_COLOR":"",u.supportsVertexTextures?"#define VERTEX_TEXTURES":"",u.useFog&&u.fog?"#define USE_FOG":"",u.useFog&&u.fogExp2?"#define FOG_EXP2":"",u.map?"#define USE_MAP":"",u.envMap?"#define USE_ENVMAP":"",u.envMap?"#define "+j:"",u.lightMap?"#define USE_LIGHTMAP":"",u.aoMap?"#define USE_AOMAP":"",u.emissiveMap?"#define USE_EMISSIVEMAP":"",u.bumpMap?"#define USE_BUMPMAP":"",u.normalMap?"#define USE_NORMALMAP":"",u.normalMap&&u.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",u.normalMap&&u.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",u.clearcoatMap?"#define USE_CLEARCOATMAP":"",u.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",u.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",u.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",u.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",u.displacementMap&&u.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",u.specularMap?"#define USE_SPECULARMAP":"",u.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",u.specularColorMap?"#define USE_SPECULARCOLORMAP":"",u.roughnessMap?"#define USE_ROUGHNESSMAP":"",u.metalnessMap?"#define USE_METALNESSMAP":"",u.alphaMap?"#define USE_ALPHAMAP":"",u.transmission?"#define USE_TRANSMISSION":"",u.transmissionMap?"#define USE_TRANSMISSIONMAP":"",u.thicknessMap?"#define USE_THICKNESSMAP":"",u.sheenColorMap?"#define USE_SHEENCOLORMAP":"",u.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",u.vertexTangents?"#define USE_TANGENT":"",u.vertexColors?"#define USE_COLOR":"",u.vertexAlphas?"#define USE_COLOR_ALPHA":"",u.vertexUvs?"#define USE_UV":"",u.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",u.flatShading?"#define FLAT_SHADED":"",u.skinning?"#define USE_SKINNING":"",u.morphTargets?"#define USE_MORPHTARGETS":"",u.morphNormals&&u.flatShading===!1?"#define USE_MORPHNORMALS":"",u.morphColors&&u.isWebGL2?"#define USE_MORPHCOLORS":"",u.morphTargetsCount>0&&u.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",u.morphTargetsCount>0&&u.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+u.morphTextureStride:"",u.morphTargetsCount>0&&u.isWebGL2?"#define MORPHTARGETS_COUNT "+u.morphTargetsCount:"",u.doubleSided?"#define DOUBLE_SIDED":"",u.flipSided?"#define FLIP_SIDED":"",u.shadowMapEnabled?"#define USE_SHADOWMAP":"",u.shadowMapEnabled?"#define "+O:"",u.sizeAttenuation?"#define USE_SIZEATTENUATION":"",u.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",u.logarithmicDepthBuffer&&u.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(dS).join(`
`),Z=[W,UW(u),"#define SHADER_NAME "+u.shaderName,z,u.useFog&&u.fog?"#define USE_FOG":"",u.useFog&&u.fogExp2?"#define FOG_EXP2":"",u.map?"#define USE_MAP":"",u.matcap?"#define USE_MATCAP":"",u.envMap?"#define USE_ENVMAP":"",u.envMap?"#define "+U:"",u.envMap?"#define "+j:"",u.envMap?"#define "+N:"",L?"#define CUBEUV_TEXEL_WIDTH "+L.texelWidth:"",L?"#define CUBEUV_TEXEL_HEIGHT "+L.texelHeight:"",L?"#define CUBEUV_MAX_MIP "+L.maxMip+".0":"",u.lightMap?"#define USE_LIGHTMAP":"",u.aoMap?"#define USE_AOMAP":"",u.emissiveMap?"#define USE_EMISSIVEMAP":"",u.bumpMap?"#define USE_BUMPMAP":"",u.normalMap?"#define USE_NORMALMAP":"",u.normalMap&&u.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",u.normalMap&&u.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",u.clearcoat?"#define USE_CLEARCOAT":"",u.clearcoatMap?"#define USE_CLEARCOATMAP":"",u.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",u.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",u.iridescence?"#define USE_IRIDESCENCE":"",u.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",u.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",u.specularMap?"#define USE_SPECULARMAP":"",u.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",u.specularColorMap?"#define USE_SPECULARCOLORMAP":"",u.roughnessMap?"#define USE_ROUGHNESSMAP":"",u.metalnessMap?"#define USE_METALNESSMAP":"",u.alphaMap?"#define USE_ALPHAMAP":"",u.alphaTest?"#define USE_ALPHATEST":"",u.sheen?"#define USE_SHEEN":"",u.sheenColorMap?"#define USE_SHEENCOLORMAP":"",u.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",u.transmission?"#define USE_TRANSMISSION":"",u.transmissionMap?"#define USE_TRANSMISSIONMAP":"",u.thicknessMap?"#define USE_THICKNESSMAP":"",u.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",u.vertexTangents?"#define USE_TANGENT":"",u.vertexColors||u.instancingColor?"#define USE_COLOR":"",u.vertexAlphas?"#define USE_COLOR_ALPHA":"",u.vertexUvs?"#define USE_UV":"",u.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",u.gradientMap?"#define USE_GRADIENTMAP":"",u.flatShading?"#define FLAT_SHADED":"",u.doubleSided?"#define DOUBLE_SIDED":"",u.flipSided?"#define FLIP_SIDED":"",u.shadowMapEnabled?"#define USE_SHADOWMAP":"",u.shadowMapEnabled?"#define "+O:"",u.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",u.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",u.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",u.logarithmicDepthBuffer&&u.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",u.toneMapping!==k1?"#define TONE_MAPPING":"",u.toneMapping!==k1?ea.tonemapping_pars_fragment:"",u.toneMapping!==k1?_de("toneMapping",u.toneMapping):"",u.dithering?"#define DITHERING":"",u.opaque?"#define OPAQUE":"",ea.encodings_pars_fragment,wde("linearToOutputTexel",u.outputEncoding),u.useDepthPacking?"#define DEPTH_PACKING "+u.depthPacking:"",`
`].filter(dS).join(`
`)),C=iR(C),C=BW(C,u),C=jW(C,u),S=iR(S),S=BW(S,u),S=jW(S,u),C=zW(C),S=zW(S),u.isWebGL2&&u.isRawShaderMaterial!==!0&&(Y=`#version 300 es
`,I=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+I,Z=["#define varying in",u.glslVersion===lW?"":"layout(location = 0) out highp vec4 pc_fragColor;",u.glslVersion===lW?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+Z);const G=Y+I+C,oe=Y+Z+S,ce=PW(r,35633,G),be=PW(r,35632,oe);if(r.attachShader(q,ce),r.attachShader(q,be),u.index0AttributeName!==void 0?r.bindAttribLocation(q,0,u.index0AttributeName):u.morphTargets===!0&&r.bindAttribLocation(q,0,"position"),r.linkProgram(q),p.debug.checkShaderErrors){const ge=r.getProgramInfoLog(q).trim(),Ge=r.getShaderInfoLog(ce).trim(),ht=r.getShaderInfoLog(be).trim();let It=!0,St=!0;if(r.getProgramParameter(q,35714)===!1){It=!1;const we=LW(r,ce,"vertex"),bt=LW(r,be,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(q,35715)+`

Program Info Log: `+ge+`
`+we+`
`+bt)}else ge!==""?console.warn("THREE.WebGLProgram: Program Info Log:",ge):(Ge===""||ht==="")&&(St=!1);St&&(this.diagnostics={runnable:It,programLog:ge,vertexShader:{log:Ge,prefix:I},fragmentShader:{log:ht,prefix:Z}})}r.deleteShader(ce),r.deleteShader(be);let Ee;this.getUniforms=function(){return Ee===void 0&&(Ee=new cO(r,q)),Ee};let ve;return this.getAttributes=function(){return ve===void 0&&(ve=kde(r,q)),ve},this.destroy=function(){s.releaseStatesOfProgram(this),r.deleteProgram(q),this.program=void 0},this.name=u.shaderName,this.id=yde++,this.cacheKey=o,this.usedTimes=1,this.program=q,this.vertexShader=ce,this.fragmentShader=be,this}let Pde=0;class Lde{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(o){const u=o.vertexShader,s=o.fragmentShader,r=this._getShaderStage(u),l=this._getShaderStage(s),C=this._getShaderCacheForMaterial(o);return C.has(r)===!1&&(C.add(r),r.usedTimes++),C.has(l)===!1&&(C.add(l),l.usedTimes++),this}remove(o){const u=this.materialCache.get(o);for(const s of u)s.usedTimes--,s.usedTimes===0&&this.shaderCache.delete(s.code);return this.materialCache.delete(o),this}getVertexShaderID(o){return this._getShaderStage(o.vertexShader).id}getFragmentShaderID(o){return this._getShaderStage(o.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(o){const u=this.materialCache;let s=u.get(o);return s===void 0&&(s=new Set,u.set(o,s)),s}_getShaderStage(o){const u=this.shaderCache;let s=u.get(o);return s===void 0&&(s=new Bde(o),u.set(o,s)),s}}class Bde{constructor(o){this.id=Pde++,this.code=o,this.usedTimes=0}}function jde(p,o,u,s,r,l,C){const S=new kG,O=new Lde,U=[],j=r.isWebGL2,N=r.logarithmicDepthBuffer,L=r.vertexTextures;let W=r.precision;const z={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function q(ve,ge,Ge,ht,It){const St=ht.fog,we=It.geometry,bt=ve.isMeshStandardMaterial?ht.environment:null,jt=(ve.isMeshStandardMaterial?u:o).get(ve.envMap||bt),Mt=jt&&jt.mapping===tT?jt.image.height:null,ze=z[ve.type];ve.precision!==null&&(W=r.getMaxPrecision(ve.precision),W!==ve.precision&&console.warn("THREE.WebGLProgram.getParameters:",ve.precision,"not supported, using",W,"instead."));const Ut=we.morphAttributes.position||we.morphAttributes.normal||we.morphAttributes.color,Ft=Ut!==void 0?Ut.length:0;let pt=0;we.morphAttributes.position!==void 0&&(pt=1),we.morphAttributes.normal!==void 0&&(pt=2),we.morphAttributes.color!==void 0&&(pt=3);let yt,nn,xt,_t;if(ze){const Qe=by[ze];yt=Qe.vertexShader,nn=Qe.fragmentShader}else yt=ve.vertexShader,nn=ve.fragmentShader,O.update(ve),xt=O.getVertexShaderID(ve),_t=O.getFragmentShaderID(ve);const Yt=p.getRenderTarget(),Fn=ve.alphaTest>0,Rn=ve.clearcoat>0,cn=ve.iridescence>0;return{isWebGL2:j,shaderID:ze,shaderName:ve.type,vertexShader:yt,fragmentShader:nn,defines:ve.defines,customVertexShaderID:xt,customFragmentShaderID:_t,isRawShaderMaterial:ve.isRawShaderMaterial===!0,glslVersion:ve.glslVersion,precision:W,instancing:It.isInstancedMesh===!0,instancingColor:It.isInstancedMesh===!0&&It.instanceColor!==null,supportsVertexTextures:L,outputEncoding:Yt===null?p.outputEncoding:Yt.isXRRenderTarget===!0?Yt.texture.encoding:aw,map:!!ve.map,matcap:!!ve.matcap,envMap:!!jt,envMapMode:jt&&jt.mapping,envMapCubeUVHeight:Mt,lightMap:!!ve.lightMap,aoMap:!!ve.aoMap,emissiveMap:!!ve.emissiveMap,bumpMap:!!ve.bumpMap,normalMap:!!ve.normalMap,objectSpaceNormalMap:ve.normalMapType===cue,tangentSpaceNormalMap:ve.normalMapType===uue,decodeVideoTexture:!!ve.map&&ve.map.isVideoTexture===!0&&ve.map.encoding===tu,clearcoat:Rn,clearcoatMap:Rn&&!!ve.clearcoatMap,clearcoatRoughnessMap:Rn&&!!ve.clearcoatRoughnessMap,clearcoatNormalMap:Rn&&!!ve.clearcoatNormalMap,iridescence:cn,iridescenceMap:cn&&!!ve.iridescenceMap,iridescenceThicknessMap:cn&&!!ve.iridescenceThicknessMap,displacementMap:!!ve.displacementMap,roughnessMap:!!ve.roughnessMap,metalnessMap:!!ve.metalnessMap,specularMap:!!ve.specularMap,specularIntensityMap:!!ve.specularIntensityMap,specularColorMap:!!ve.specularColorMap,opaque:ve.transparent===!1&&ve.blending===j2,alphaMap:!!ve.alphaMap,alphaTest:Fn,gradientMap:!!ve.gradientMap,sheen:ve.sheen>0,sheenColorMap:!!ve.sheenColorMap,sheenRoughnessMap:!!ve.sheenRoughnessMap,transmission:ve.transmission>0,transmissionMap:!!ve.transmissionMap,thicknessMap:!!ve.thicknessMap,combine:ve.combine,vertexTangents:!!ve.normalMap&&!!we.attributes.tangent,vertexColors:ve.vertexColors,vertexAlphas:ve.vertexColors===!0&&!!we.attributes.color&&we.attributes.color.itemSize===4,vertexUvs:!!ve.map||!!ve.bumpMap||!!ve.normalMap||!!ve.specularMap||!!ve.alphaMap||!!ve.emissiveMap||!!ve.roughnessMap||!!ve.metalnessMap||!!ve.clearcoatMap||!!ve.clearcoatRoughnessMap||!!ve.clearcoatNormalMap||!!ve.iridescenceMap||!!ve.iridescenceThicknessMap||!!ve.displacementMap||!!ve.transmissionMap||!!ve.thicknessMap||!!ve.specularIntensityMap||!!ve.specularColorMap||!!ve.sheenColorMap||!!ve.sheenRoughnessMap,uvsVertexOnly:!(ve.map||ve.bumpMap||ve.normalMap||ve.specularMap||ve.alphaMap||ve.emissiveMap||ve.roughnessMap||ve.metalnessMap||ve.clearcoatNormalMap||ve.iridescenceMap||ve.iridescenceThicknessMap||ve.transmission>0||ve.transmissionMap||ve.thicknessMap||ve.specularIntensityMap||ve.specularColorMap||ve.sheen>0||ve.sheenColorMap||ve.sheenRoughnessMap)&&!!ve.displacementMap,fog:!!St,useFog:ve.fog===!0,fogExp2:St&&St.isFogExp2,flatShading:!!ve.flatShading,sizeAttenuation:ve.sizeAttenuation,logarithmicDepthBuffer:N,skinning:It.isSkinnedMesh===!0,morphTargets:we.morphAttributes.position!==void 0,morphNormals:we.morphAttributes.normal!==void 0,morphColors:we.morphAttributes.color!==void 0,morphTargetsCount:Ft,morphTextureStride:pt,numDirLights:ge.directional.length,numPointLights:ge.point.length,numSpotLights:ge.spot.length,numSpotLightMaps:ge.spotLightMap.length,numRectAreaLights:ge.rectArea.length,numHemiLights:ge.hemi.length,numDirLightShadows:ge.directionalShadowMap.length,numPointLightShadows:ge.pointShadowMap.length,numSpotLightShadows:ge.spotShadowMap.length,numSpotLightShadowsWithMaps:ge.numSpotLightShadowsWithMaps,numClippingPlanes:C.numPlanes,numClipIntersection:C.numIntersection,dithering:ve.dithering,shadowMapEnabled:p.shadowMap.enabled&&Ge.length>0,shadowMapType:p.shadowMap.type,toneMapping:ve.toneMapped?p.toneMapping:k1,physicallyCorrectLights:p.physicallyCorrectLights,premultipliedAlpha:ve.premultipliedAlpha,doubleSided:ve.side===t5,flipSided:ve.side===Wg,useDepthPacking:!!ve.depthPacking,depthPacking:ve.depthPacking||0,index0AttributeName:ve.index0AttributeName,extensionDerivatives:ve.extensions&&ve.extensions.derivatives,extensionFragDepth:ve.extensions&&ve.extensions.fragDepth,extensionDrawBuffers:ve.extensions&&ve.extensions.drawBuffers,extensionShaderTextureLOD:ve.extensions&&ve.extensions.shaderTextureLOD,rendererExtensionFragDepth:j||s.has("EXT_frag_depth"),rendererExtensionDrawBuffers:j||s.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:j||s.has("EXT_shader_texture_lod"),customProgramCacheKey:ve.customProgramCacheKey()}}function I(ve){const ge=[];if(ve.shaderID?ge.push(ve.shaderID):(ge.push(ve.customVertexShaderID),ge.push(ve.customFragmentShaderID)),ve.defines!==void 0)for(const Ge in ve.defines)ge.push(Ge),ge.push(ve.defines[Ge]);return ve.isRawShaderMaterial===!1&&(Z(ge,ve),Y(ge,ve),ge.push(p.outputEncoding)),ge.push(ve.customProgramCacheKey),ge.join()}function Z(ve,ge){ve.push(ge.precision),ve.push(ge.outputEncoding),ve.push(ge.envMapMode),ve.push(ge.envMapCubeUVHeight),ve.push(ge.combine),ve.push(ge.vertexUvs),ve.push(ge.fogExp2),ve.push(ge.sizeAttenuation),ve.push(ge.morphTargetsCount),ve.push(ge.morphAttributeCount),ve.push(ge.numDirLights),ve.push(ge.numPointLights),ve.push(ge.numSpotLights),ve.push(ge.numSpotLightMaps),ve.push(ge.numHemiLights),ve.push(ge.numRectAreaLights),ve.push(ge.numDirLightShadows),ve.push(ge.numPointLightShadows),ve.push(ge.numSpotLightShadows),ve.push(ge.numSpotLightShadowsWithMaps),ve.push(ge.shadowMapType),ve.push(ge.toneMapping),ve.push(ge.numClippingPlanes),ve.push(ge.numClipIntersection),ve.push(ge.depthPacking)}function Y(ve,ge){S.disableAll(),ge.isWebGL2&&S.enable(0),ge.supportsVertexTextures&&S.enable(1),ge.instancing&&S.enable(2),ge.instancingColor&&S.enable(3),ge.map&&S.enable(4),ge.matcap&&S.enable(5),ge.envMap&&S.enable(6),ge.lightMap&&S.enable(7),ge.aoMap&&S.enable(8),ge.emissiveMap&&S.enable(9),ge.bumpMap&&S.enable(10),ge.normalMap&&S.enable(11),ge.objectSpaceNormalMap&&S.enable(12),ge.tangentSpaceNormalMap&&S.enable(13),ge.clearcoat&&S.enable(14),ge.clearcoatMap&&S.enable(15),ge.clearcoatRoughnessMap&&S.enable(16),ge.clearcoatNormalMap&&S.enable(17),ge.iridescence&&S.enable(18),ge.iridescenceMap&&S.enable(19),ge.iridescenceThicknessMap&&S.enable(20),ge.displacementMap&&S.enable(21),ge.specularMap&&S.enable(22),ge.roughnessMap&&S.enable(23),ge.metalnessMap&&S.enable(24),ge.gradientMap&&S.enable(25),ge.alphaMap&&S.enable(26),ge.alphaTest&&S.enable(27),ge.vertexColors&&S.enable(28),ge.vertexAlphas&&S.enable(29),ge.vertexUvs&&S.enable(30),ge.vertexTangents&&S.enable(31),ge.uvsVertexOnly&&S.enable(32),ve.push(S.mask),S.disableAll(),ge.fog&&S.enable(0),ge.useFog&&S.enable(1),ge.flatShading&&S.enable(2),ge.logarithmicDepthBuffer&&S.enable(3),ge.skinning&&S.enable(4),ge.morphTargets&&S.enable(5),ge.morphNormals&&S.enable(6),ge.morphColors&&S.enable(7),ge.premultipliedAlpha&&S.enable(8),ge.shadowMapEnabled&&S.enable(9),ge.physicallyCorrectLights&&S.enable(10),ge.doubleSided&&S.enable(11),ge.flipSided&&S.enable(12),ge.useDepthPacking&&S.enable(13),ge.dithering&&S.enable(14),ge.specularIntensityMap&&S.enable(15),ge.specularColorMap&&S.enable(16),ge.transmission&&S.enable(17),ge.transmissionMap&&S.enable(18),ge.thicknessMap&&S.enable(19),ge.sheen&&S.enable(20),ge.sheenColorMap&&S.enable(21),ge.sheenRoughnessMap&&S.enable(22),ge.decodeVideoTexture&&S.enable(23),ge.opaque&&S.enable(24),ve.push(S.mask)}function G(ve){const ge=z[ve.type];let Ge;if(ge){const ht=by[ge];Ge=kue.clone(ht.uniforms)}else Ge=ve.uniforms;return Ge}function oe(ve,ge){let Ge;for(let ht=0,It=U.length;ht<It;ht++){const St=U[ht];if(St.cacheKey===ge){Ge=St,++Ge.usedTimes;break}}return Ge===void 0&&(Ge=new Rde(p,ge,ve,l),U.push(Ge)),Ge}function ce(ve){if(--ve.usedTimes===0){const ge=U.indexOf(ve);U[ge]=U[U.length-1],U.pop(),ve.destroy()}}function be(ve){O.remove(ve)}function Ee(){O.dispose()}return{getParameters:q,getProgramCacheKey:I,getUniforms:G,acquireProgram:oe,releaseProgram:ce,releaseShaderCache:be,programs:U,dispose:Ee}}function zde(){let p=new WeakMap;function o(l){let C=p.get(l);return C===void 0&&(C={},p.set(l,C)),C}function u(l){p.delete(l)}function s(l,C,S){p.get(l)[C]=S}function r(){p=new WeakMap}return{get:o,remove:u,update:s,dispose:r}}function Ude(p,o){return p.groupOrder!==o.groupOrder?p.groupOrder-o.groupOrder:p.renderOrder!==o.renderOrder?p.renderOrder-o.renderOrder:p.material.id!==o.material.id?p.material.id-o.material.id:p.z!==o.z?p.z-o.z:p.id-o.id}function WW(p,o){return p.groupOrder!==o.groupOrder?p.groupOrder-o.groupOrder:p.renderOrder!==o.renderOrder?p.renderOrder-o.renderOrder:p.z!==o.z?o.z-p.z:p.id-o.id}function VW(){const p=[];let o=0;const u=[],s=[],r=[];function l(){o=0,u.length=0,s.length=0,r.length=0}function C(N,L,W,z,q,I){let Z=p[o];return Z===void 0?(Z={id:N.id,object:N,geometry:L,material:W,groupOrder:z,renderOrder:N.renderOrder,z:q,group:I},p[o]=Z):(Z.id=N.id,Z.object=N,Z.geometry=L,Z.material=W,Z.groupOrder=z,Z.renderOrder=N.renderOrder,Z.z=q,Z.group=I),o++,Z}function S(N,L,W,z,q,I){const Z=C(N,L,W,z,q,I);W.transmission>0?s.push(Z):W.transparent===!0?r.push(Z):u.push(Z)}function O(N,L,W,z,q,I){const Z=C(N,L,W,z,q,I);W.transmission>0?s.unshift(Z):W.transparent===!0?r.unshift(Z):u.unshift(Z)}function U(N,L){u.length>1&&u.sort(N||Ude),s.length>1&&s.sort(L||WW),r.length>1&&r.sort(L||WW)}function j(){for(let N=o,L=p.length;N<L;N++){const W=p[N];if(W.id===null)break;W.id=null,W.object=null,W.geometry=null,W.material=null,W.group=null}}return{opaque:u,transmissive:s,transparent:r,init:l,push:S,unshift:O,finish:j,sort:U}}function Wde(){let p=new WeakMap;function o(s,r){const l=p.get(s);let C;return l===void 0?(C=new VW,p.set(s,[C])):r>=l.length?(C=new VW,l.push(C)):C=l[r],C}function u(){p=new WeakMap}return{get:o,dispose:u}}function Vde(){const p={};return{get:function(o){if(p[o.id]!==void 0)return p[o.id];let u;switch(o.type){case"DirectionalLight":u={direction:new hr,color:new vs};break;case"SpotLight":u={position:new hr,direction:new hr,color:new vs,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":u={position:new hr,color:new vs,distance:0,decay:0};break;case"HemisphereLight":u={direction:new hr,skyColor:new vs,groundColor:new vs};break;case"RectAreaLight":u={color:new vs,position:new hr,halfWidth:new hr,halfHeight:new hr};break}return p[o.id]=u,u}}}function Hde(){const p={};return{get:function(o){if(p[o.id]!==void 0)return p[o.id];let u;switch(o.type){case"DirectionalLight":u={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new cs};break;case"SpotLight":u={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new cs};break;case"PointLight":u={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new cs,shadowCameraNear:1,shadowCameraFar:1e3};break}return p[o.id]=u,u}}}let Gde=0;function qde(p,o){return(o.castShadow?2:0)-(p.castShadow?2:0)+(o.map?1:0)-(p.map?1:0)}function $de(p,o){const u=new Vde,s=Hde(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let j=0;j<9;j++)r.probe.push(new hr);const l=new hr,C=new ac,S=new ac;function O(j,N){let L=0,W=0,z=0;for(let ht=0;ht<9;ht++)r.probe[ht].set(0,0,0);let q=0,I=0,Z=0,Y=0,G=0,oe=0,ce=0,be=0,Ee=0,ve=0;j.sort(qde);const ge=N!==!0?Math.PI:1;for(let ht=0,It=j.length;ht<It;ht++){const St=j[ht],we=St.color,bt=St.intensity,jt=St.distance,Mt=St.shadow&&St.shadow.map?St.shadow.map.texture:null;if(St.isAmbientLight)L+=we.r*bt*ge,W+=we.g*bt*ge,z+=we.b*bt*ge;else if(St.isLightProbe)for(let ze=0;ze<9;ze++)r.probe[ze].addScaledVector(St.sh.coefficients[ze],bt);else if(St.isDirectionalLight){const ze=u.get(St);if(ze.color.copy(St.color).multiplyScalar(St.intensity*ge),St.castShadow){const Ut=St.shadow,Ft=s.get(St);Ft.shadowBias=Ut.bias,Ft.shadowNormalBias=Ut.normalBias,Ft.shadowRadius=Ut.radius,Ft.shadowMapSize=Ut.mapSize,r.directionalShadow[q]=Ft,r.directionalShadowMap[q]=Mt,r.directionalShadowMatrix[q]=St.shadow.matrix,oe++}r.directional[q]=ze,q++}else if(St.isSpotLight){const ze=u.get(St);ze.position.setFromMatrixPosition(St.matrixWorld),ze.color.copy(we).multiplyScalar(bt*ge),ze.distance=jt,ze.coneCos=Math.cos(St.angle),ze.penumbraCos=Math.cos(St.angle*(1-St.penumbra)),ze.decay=St.decay,r.spot[Z]=ze;const Ut=St.shadow;if(St.map&&(r.spotLightMap[Ee]=St.map,Ee++,Ut.updateMatrices(St),St.castShadow&&ve++),r.spotLightMatrix[Z]=Ut.matrix,St.castShadow){const Ft=s.get(St);Ft.shadowBias=Ut.bias,Ft.shadowNormalBias=Ut.normalBias,Ft.shadowRadius=Ut.radius,Ft.shadowMapSize=Ut.mapSize,r.spotShadow[Z]=Ft,r.spotShadowMap[Z]=Mt,be++}Z++}else if(St.isRectAreaLight){const ze=u.get(St);ze.color.copy(we).multiplyScalar(bt),ze.halfWidth.set(St.width*.5,0,0),ze.halfHeight.set(0,St.height*.5,0),r.rectArea[Y]=ze,Y++}else if(St.isPointLight){const ze=u.get(St);if(ze.color.copy(St.color).multiplyScalar(St.intensity*ge),ze.distance=St.distance,ze.decay=St.decay,St.castShadow){const Ut=St.shadow,Ft=s.get(St);Ft.shadowBias=Ut.bias,Ft.shadowNormalBias=Ut.normalBias,Ft.shadowRadius=Ut.radius,Ft.shadowMapSize=Ut.mapSize,Ft.shadowCameraNear=Ut.camera.near,Ft.shadowCameraFar=Ut.camera.far,r.pointShadow[I]=Ft,r.pointShadowMap[I]=Mt,r.pointShadowMatrix[I]=St.shadow.matrix,ce++}r.point[I]=ze,I++}else if(St.isHemisphereLight){const ze=u.get(St);ze.skyColor.copy(St.color).multiplyScalar(bt*ge),ze.groundColor.copy(St.groundColor).multiplyScalar(bt*ge),r.hemi[G]=ze,G++}}Y>0&&(o.isWebGL2||p.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=vi.LTC_FLOAT_1,r.rectAreaLTC2=vi.LTC_FLOAT_2):p.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=vi.LTC_HALF_1,r.rectAreaLTC2=vi.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=L,r.ambient[1]=W,r.ambient[2]=z;const Ge=r.hash;(Ge.directionalLength!==q||Ge.pointLength!==I||Ge.spotLength!==Z||Ge.rectAreaLength!==Y||Ge.hemiLength!==G||Ge.numDirectionalShadows!==oe||Ge.numPointShadows!==ce||Ge.numSpotShadows!==be||Ge.numSpotMaps!==Ee)&&(r.directional.length=q,r.spot.length=Z,r.rectArea.length=Y,r.point.length=I,r.hemi.length=G,r.directionalShadow.length=oe,r.directionalShadowMap.length=oe,r.pointShadow.length=ce,r.pointShadowMap.length=ce,r.spotShadow.length=be,r.spotShadowMap.length=be,r.directionalShadowMatrix.length=oe,r.pointShadowMatrix.length=ce,r.spotLightMatrix.length=be+Ee-ve,r.spotLightMap.length=Ee,r.numSpotLightShadowsWithMaps=ve,Ge.directionalLength=q,Ge.pointLength=I,Ge.spotLength=Z,Ge.rectAreaLength=Y,Ge.hemiLength=G,Ge.numDirectionalShadows=oe,Ge.numPointShadows=ce,Ge.numSpotShadows=be,Ge.numSpotMaps=Ee,r.version=Gde++)}function U(j,N){let L=0,W=0,z=0,q=0,I=0;const Z=N.matrixWorldInverse;for(let Y=0,G=j.length;Y<G;Y++){const oe=j[Y];if(oe.isDirectionalLight){const ce=r.directional[L];ce.direction.setFromMatrixPosition(oe.matrixWorld),l.setFromMatrixPosition(oe.target.matrixWorld),ce.direction.sub(l),ce.direction.transformDirection(Z),L++}else if(oe.isSpotLight){const ce=r.spot[z];ce.position.setFromMatrixPosition(oe.matrixWorld),ce.position.applyMatrix4(Z),ce.direction.setFromMatrixPosition(oe.matrixWorld),l.setFromMatrixPosition(oe.target.matrixWorld),ce.direction.sub(l),ce.direction.transformDirection(Z),z++}else if(oe.isRectAreaLight){const ce=r.rectArea[q];ce.position.setFromMatrixPosition(oe.matrixWorld),ce.position.applyMatrix4(Z),S.identity(),C.copy(oe.matrixWorld),C.premultiply(Z),S.extractRotation(C),ce.halfWidth.set(oe.width*.5,0,0),ce.halfHeight.set(0,oe.height*.5,0),ce.halfWidth.applyMatrix4(S),ce.halfHeight.applyMatrix4(S),q++}else if(oe.isPointLight){const ce=r.point[W];ce.position.setFromMatrixPosition(oe.matrixWorld),ce.position.applyMatrix4(Z),W++}else if(oe.isHemisphereLight){const ce=r.hemi[I];ce.direction.setFromMatrixPosition(oe.matrixWorld),ce.direction.transformDirection(Z),I++}}}return{setup:O,setupView:U,state:r}}function HW(p,o){const u=new $de(p,o),s=[],r=[];function l(){s.length=0,r.length=0}function C(N){s.push(N)}function S(N){r.push(N)}function O(N){u.setup(s,N)}function U(N){u.setupView(s,N)}return{init:l,state:{lightsArray:s,shadowsArray:r,lights:u},setupLights:O,setupLightsView:U,pushLight:C,pushShadow:S}}function Xde(p,o){let u=new WeakMap;function s(l,C=0){const S=u.get(l);let O;return S===void 0?(O=new HW(p,o),u.set(l,[O])):C>=S.length?(O=new HW(p,o),S.push(O)):O=S[C],O}function r(){u=new WeakMap}return{get:s,dispose:r}}class Kde extends QS{constructor(o){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=aue,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(o)}copy(o){return super.copy(o),this.depthPacking=o.depthPacking,this.map=o.map,this.alphaMap=o.alphaMap,this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this}}class Yde extends QS{constructor(o){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new hr,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(o)}copy(o){return super.copy(o),this.referencePosition.copy(o.referencePosition),this.nearDistance=o.nearDistance,this.farDistance=o.farDistance,this.map=o.map,this.alphaMap=o.alphaMap,this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this}}const Jde=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Qde=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Zde(p,o,u){let s=new n5;const r=new cs,l=new cs,C=new yu,S=new Kde({depthPacking:sue}),O=new Yde,U={},j=u.maxTextureSize,N={0:Wg,1:iw,2:t5},L=new uw({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new cs},radius:{value:4}},vertexShader:Jde,fragmentShader:Qde}),W=L.clone();W.defines.HORIZONTAL_PASS=1;const z=new nv;z.setAttribute("position",new Ey(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const q=new Q0(z,L),I=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=hG,this.render=function(oe,ce,be){if(I.enabled===!1||I.autoUpdate===!1&&I.needsUpdate===!1||oe.length===0)return;const Ee=p.getRenderTarget(),ve=p.getActiveCubeFace(),ge=p.getActiveMipmapLevel(),Ge=p.state;Ge.setBlending(Ub),Ge.buffers.color.setClear(1,1,1,1),Ge.buffers.depth.setTest(!0),Ge.setScissorTest(!1);for(let ht=0,It=oe.length;ht<It;ht++){const St=oe[ht],we=St.shadow;if(we===void 0){console.warn("THREE.WebGLShadowMap:",St,"has no shadow.");continue}if(we.autoUpdate===!1&&we.needsUpdate===!1)continue;r.copy(we.mapSize);const bt=we.getFrameExtents();if(r.multiply(bt),l.copy(we.mapSize),(r.x>j||r.y>j)&&(r.x>j&&(l.x=Math.floor(j/bt.x),r.x=l.x*bt.x,we.mapSize.x=l.x),r.y>j&&(l.y=Math.floor(j/bt.y),r.y=l.y*bt.y,we.mapSize.y=l.y)),we.map===null){const Mt=this.type!==fS?{minFilter:gh,magFilter:gh}:{};we.map=new sw(r.x,r.y,Mt),we.map.texture.name=St.name+".shadowMap",we.camera.updateProjectionMatrix()}p.setRenderTarget(we.map),p.clear();const jt=we.getViewportCount();for(let Mt=0;Mt<jt;Mt++){const ze=we.getViewport(Mt);C.set(l.x*ze.x,l.y*ze.y,l.x*ze.z,l.y*ze.w),Ge.viewport(C),we.updateMatrices(St,Mt),s=we.getFrustum(),G(ce,be,we.camera,St,this.type)}we.isPointLightShadow!==!0&&this.type===fS&&Z(we,be),we.needsUpdate=!1}I.needsUpdate=!1,p.setRenderTarget(Ee,ve,ge)};function Z(oe,ce){const be=o.update(q);L.defines.VSM_SAMPLES!==oe.blurSamples&&(L.defines.VSM_SAMPLES=oe.blurSamples,W.defines.VSM_SAMPLES=oe.blurSamples,L.needsUpdate=!0,W.needsUpdate=!0),oe.mapPass===null&&(oe.mapPass=new sw(r.x,r.y)),L.uniforms.shadow_pass.value=oe.map.texture,L.uniforms.resolution.value=oe.mapSize,L.uniforms.radius.value=oe.radius,p.setRenderTarget(oe.mapPass),p.clear(),p.renderBufferDirect(ce,null,be,L,q,null),W.uniforms.shadow_pass.value=oe.mapPass.texture,W.uniforms.resolution.value=oe.mapSize,W.uniforms.radius.value=oe.radius,p.setRenderTarget(oe.map),p.clear(),p.renderBufferDirect(ce,null,be,W,q,null)}function Y(oe,ce,be,Ee,ve,ge){let Ge=null;const ht=be.isPointLight===!0?oe.customDistanceMaterial:oe.customDepthMaterial;if(ht!==void 0)Ge=ht;else if(Ge=be.isPointLight===!0?O:S,p.localClippingEnabled&&ce.clipShadows===!0&&Array.isArray(ce.clippingPlanes)&&ce.clippingPlanes.length!==0||ce.displacementMap&&ce.displacementScale!==0||ce.alphaMap&&ce.alphaTest>0||ce.map&&ce.alphaTest>0){const It=Ge.uuid,St=ce.uuid;let we=U[It];we===void 0&&(we={},U[It]=we);let bt=we[St];bt===void 0&&(bt=Ge.clone(),we[St]=bt),Ge=bt}return Ge.visible=ce.visible,Ge.wireframe=ce.wireframe,ge===fS?Ge.side=ce.shadowSide!==null?ce.shadowSide:ce.side:Ge.side=ce.shadowSide!==null?ce.shadowSide:N[ce.side],Ge.alphaMap=ce.alphaMap,Ge.alphaTest=ce.alphaTest,Ge.map=ce.map,Ge.clipShadows=ce.clipShadows,Ge.clippingPlanes=ce.clippingPlanes,Ge.clipIntersection=ce.clipIntersection,Ge.displacementMap=ce.displacementMap,Ge.displacementScale=ce.displacementScale,Ge.displacementBias=ce.displacementBias,Ge.wireframeLinewidth=ce.wireframeLinewidth,Ge.linewidth=ce.linewidth,be.isPointLight===!0&&Ge.isMeshDistanceMaterial===!0&&(Ge.referencePosition.setFromMatrixPosition(be.matrixWorld),Ge.nearDistance=Ee,Ge.farDistance=ve),Ge}function G(oe,ce,be,Ee,ve){if(oe.visible===!1)return;if(oe.layers.test(ce.layers)&&(oe.isMesh||oe.isLine||oe.isPoints)&&(oe.castShadow||oe.receiveShadow&&ve===fS)&&(!oe.frustumCulled||s.intersectsObject(oe))){oe.modelViewMatrix.multiplyMatrices(be.matrixWorldInverse,oe.matrixWorld);const ht=o.update(oe),It=oe.material;if(Array.isArray(It)){const St=ht.groups;for(let we=0,bt=St.length;we<bt;we++){const jt=St[we],Mt=It[jt.materialIndex];if(Mt&&Mt.visible){const ze=Y(oe,Mt,Ee,be.near,be.far,ve);p.renderBufferDirect(be,null,ht,ze,oe,jt)}}}else if(It.visible){const St=Y(oe,It,Ee,be.near,be.far,ve);p.renderBufferDirect(be,null,ht,St,oe,null)}}const Ge=oe.children;for(let ht=0,It=Ge.length;ht<It;ht++)G(Ge[ht],ce,be,Ee,ve)}}function ehe(p,o,u){const s=u.isWebGL2;function r(){let jn=!1;const ir=new yu;let Cr=null;const Hr=new yu(0,0,0,0);return{setMask:function(qr){Cr!==qr&&!jn&&(p.colorMask(qr,qr,qr,qr),Cr=qr)},setLocked:function(qr){jn=qr},setClear:function(qr,Ot,Fr,$t,Se){Se===!0&&(qr*=$t,Ot*=$t,Fr*=$t),ir.set(qr,Ot,Fr,$t),Hr.equals(ir)===!1&&(p.clearColor(qr,Ot,Fr,$t),Hr.copy(ir))},reset:function(){jn=!1,Cr=null,Hr.set(-1,0,0,0)}}}function l(){let jn=!1,ir=null,Cr=null,Hr=null;return{setTest:function(qr){qr?Fn(2929):Rn(2929)},setMask:function(qr){ir!==qr&&!jn&&(p.depthMask(qr),ir=qr)},setFunc:function(qr){if(Cr!==qr){switch(qr){case Mse:p.depthFunc(512);break;case Dse:p.depthFunc(519);break;case Nse:p.depthFunc(513);break;case JF:p.depthFunc(515);break;case Ise:p.depthFunc(514);break;case Fse:p.depthFunc(518);break;case Rse:p.depthFunc(516);break;case Pse:p.depthFunc(517);break;default:p.depthFunc(515)}Cr=qr}},setLocked:function(qr){jn=qr},setClear:function(qr){Hr!==qr&&(p.clearDepth(qr),Hr=qr)},reset:function(){jn=!1,ir=null,Cr=null,Hr=null}}}function C(){let jn=!1,ir=null,Cr=null,Hr=null,qr=null,Ot=null,Fr=null,$t=null,Se=null;return{setTest:function(me){jn||(me?Fn(2960):Rn(2960))},setMask:function(me){ir!==me&&!jn&&(p.stencilMask(me),ir=me)},setFunc:function(me,Ce,Me){(Cr!==me||Hr!==Ce||qr!==Me)&&(p.stencilFunc(me,Ce,Me),Cr=me,Hr=Ce,qr=Me)},setOp:function(me,Ce,Me){(Ot!==me||Fr!==Ce||$t!==Me)&&(p.stencilOp(me,Ce,Me),Ot=me,Fr=Ce,$t=Me)},setLocked:function(me){jn=me},setClear:function(me){Se!==me&&(p.clearStencil(me),Se=me)},reset:function(){jn=!1,ir=null,Cr=null,Hr=null,qr=null,Ot=null,Fr=null,$t=null,Se=null}}}const S=new r,O=new l,U=new C,j=new WeakMap,N=new WeakMap;let L={},W={},z=new WeakMap,q=[],I=null,Z=!1,Y=null,G=null,oe=null,ce=null,be=null,Ee=null,ve=null,ge=!1,Ge=null,ht=null,It=null,St=null,we=null;const bt=p.getParameter(35661);let jt=!1,Mt=0;const ze=p.getParameter(7938);ze.indexOf("WebGL")!==-1?(Mt=parseFloat(/^WebGL (\d)/.exec(ze)[1]),jt=Mt>=1):ze.indexOf("OpenGL ES")!==-1&&(Mt=parseFloat(/^OpenGL ES (\d)/.exec(ze)[1]),jt=Mt>=2);let Ut=null,Ft={};const pt=p.getParameter(3088),yt=p.getParameter(2978),nn=new yu().fromArray(pt),xt=new yu().fromArray(yt);function _t(jn,ir,Cr){const Hr=new Uint8Array(4),qr=p.createTexture();p.bindTexture(jn,qr),p.texParameteri(jn,10241,9728),p.texParameteri(jn,10240,9728);for(let Ot=0;Ot<Cr;Ot++)p.texImage2D(ir+Ot,0,6408,1,1,0,6408,5121,Hr);return qr}const Yt={};Yt[3553]=_t(3553,3553,1),Yt[34067]=_t(34067,34069,6),S.setClear(0,0,0,1),O.setClear(1),U.setClear(0),Fn(2929),O.setFunc(JF),Pn(!1),kn(RU),Fn(2884),Jt(Ub);function Fn(jn){L[jn]!==!0&&(p.enable(jn),L[jn]=!0)}function Rn(jn){L[jn]!==!1&&(p.disable(jn),L[jn]=!1)}function cn(jn,ir){return W[jn]!==ir?(p.bindFramebuffer(jn,ir),W[jn]=ir,s&&(jn===36009&&(W[36160]=ir),jn===36160&&(W[36009]=ir)),!0):!1}function qe(jn,ir){let Cr=q,Hr=!1;if(jn)if(Cr=z.get(ir),Cr===void 0&&(Cr=[],z.set(ir,Cr)),jn.isWebGLMultipleRenderTargets){const qr=jn.texture;if(Cr.length!==qr.length||Cr[0]!==36064){for(let Ot=0,Fr=qr.length;Ot<Fr;Ot++)Cr[Ot]=36064+Ot;Cr.length=qr.length,Hr=!0}}else Cr[0]!==36064&&(Cr[0]=36064,Hr=!0);else Cr[0]!==1029&&(Cr[0]=1029,Hr=!0);Hr&&(u.isWebGL2?p.drawBuffers(Cr):o.get("WEBGL_draw_buffers").drawBuffersWEBGL(Cr))}function Qe(jn){return I!==jn?(p.useProgram(jn),I=jn,!0):!1}const $e={[b2]:32774,[bse]:32778,[xse]:32779};if(s)$e[jU]=32775,$e[zU]=32776;else{const jn=o.get("EXT_blend_minmax");jn!==null&&($e[jU]=jn.MIN_EXT,$e[zU]=jn.MAX_EXT)}const ft={[wse]:0,[_se]:1,[Ese]:768,[pG]:770,[Tse]:776,[Ase]:774,[kse]:772,[Sse]:769,[mG]:771,[Ose]:775,[Cse]:773};function Jt(jn,ir,Cr,Hr,qr,Ot,Fr,$t){if(jn===Ub){Z===!0&&(Rn(3042),Z=!1);return}if(Z===!1&&(Fn(3042),Z=!0),jn!==yse){if(jn!==Y||$t!==ge){if((G!==b2||be!==b2)&&(p.blendEquation(32774),G=b2,be=b2),$t)switch(jn){case j2:p.blendFuncSeparate(1,771,1,771);break;case PU:p.blendFunc(1,1);break;case LU:p.blendFuncSeparate(0,769,0,1);break;case BU:p.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",jn);break}else switch(jn){case j2:p.blendFuncSeparate(770,771,1,771);break;case PU:p.blendFunc(770,1);break;case LU:p.blendFuncSeparate(0,769,0,1);break;case BU:p.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",jn);break}oe=null,ce=null,Ee=null,ve=null,Y=jn,ge=$t}return}qr=qr||ir,Ot=Ot||Cr,Fr=Fr||Hr,(ir!==G||qr!==be)&&(p.blendEquationSeparate($e[ir],$e[qr]),G=ir,be=qr),(Cr!==oe||Hr!==ce||Ot!==Ee||Fr!==ve)&&(p.blendFuncSeparate(ft[Cr],ft[Hr],ft[Ot],ft[Fr]),oe=Cr,ce=Hr,Ee=Ot,ve=Fr),Y=jn,ge=!1}function Qt(jn,ir){jn.side===t5?Rn(2884):Fn(2884);let Cr=jn.side===Wg;ir&&(Cr=!Cr),Pn(Cr),jn.blending===j2&&jn.transparent===!1?Jt(Ub):Jt(jn.blending,jn.blendEquation,jn.blendSrc,jn.blendDst,jn.blendEquationAlpha,jn.blendSrcAlpha,jn.blendDstAlpha,jn.premultipliedAlpha),O.setFunc(jn.depthFunc),O.setTest(jn.depthTest),O.setMask(jn.depthWrite),S.setMask(jn.colorWrite);const Hr=jn.stencilWrite;U.setTest(Hr),Hr&&(U.setMask(jn.stencilWriteMask),U.setFunc(jn.stencilFunc,jn.stencilRef,jn.stencilFuncMask),U.setOp(jn.stencilFail,jn.stencilZFail,jn.stencilZPass)),ke(jn.polygonOffset,jn.polygonOffsetFactor,jn.polygonOffsetUnits),jn.alphaToCoverage===!0?Fn(32926):Rn(32926)}function Pn(jn){Ge!==jn&&(jn?p.frontFace(2304):p.frontFace(2305),Ge=jn)}function kn(jn){jn!==mse?(Fn(2884),jn!==ht&&(jn===RU?p.cullFace(1029):jn===gse?p.cullFace(1028):p.cullFace(1032))):Rn(2884),ht=jn}function Qn(jn){jn!==It&&(jt&&p.lineWidth(jn),It=jn)}function ke(jn,ir,Cr){jn?(Fn(32823),(St!==ir||we!==Cr)&&(p.polygonOffset(ir,Cr),St=ir,we=Cr)):Rn(32823)}function ar(jn){jn?Fn(3089):Rn(3089)}function Tr(jn){jn===void 0&&(jn=33984+bt-1),Ut!==jn&&(p.activeTexture(jn),Ut=jn)}function rn(jn,ir,Cr){Cr===void 0&&(Ut===null?Cr=33984+bt-1:Cr=Ut);let Hr=Ft[Cr];Hr===void 0&&(Hr={type:void 0,texture:void 0},Ft[Cr]=Hr),(Hr.type!==jn||Hr.texture!==ir)&&(Ut!==Cr&&(p.activeTexture(Cr),Ut=Cr),p.bindTexture(jn,ir||Yt[jn]),Hr.type=jn,Hr.texture=ir)}function Ht(){const jn=Ft[Ut];jn!==void 0&&jn.type!==void 0&&(p.bindTexture(jn.type,null),jn.type=void 0,jn.texture=void 0)}function Gn(){try{p.compressedTexImage2D.apply(p,arguments)}catch(jn){console.error("THREE.WebGLState:",jn)}}function Xt(){try{p.compressedTexImage3D.apply(p,arguments)}catch(jn){console.error("THREE.WebGLState:",jn)}}function Wt(){try{p.texSubImage2D.apply(p,arguments)}catch(jn){console.error("THREE.WebGLState:",jn)}}function Zt(){try{p.texSubImage3D.apply(p,arguments)}catch(jn){console.error("THREE.WebGLState:",jn)}}function Vn(){try{p.compressedTexSubImage2D.apply(p,arguments)}catch(jn){console.error("THREE.WebGLState:",jn)}}function xn(){try{p.compressedTexSubImage3D.apply(p,arguments)}catch(jn){console.error("THREE.WebGLState:",jn)}}function Un(){try{p.texStorage2D.apply(p,arguments)}catch(jn){console.error("THREE.WebGLState:",jn)}}function ur(){try{p.texStorage3D.apply(p,arguments)}catch(jn){console.error("THREE.WebGLState:",jn)}}function sr(){try{p.texImage2D.apply(p,arguments)}catch(jn){console.error("THREE.WebGLState:",jn)}}function Er(){try{p.texImage3D.apply(p,arguments)}catch(jn){console.error("THREE.WebGLState:",jn)}}function Mr(jn){nn.equals(jn)===!1&&(p.scissor(jn.x,jn.y,jn.z,jn.w),nn.copy(jn))}function pr(jn){xt.equals(jn)===!1&&(p.viewport(jn.x,jn.y,jn.z,jn.w),xt.copy(jn))}function ri(jn,ir){let Cr=N.get(ir);Cr===void 0&&(Cr=new WeakMap,N.set(ir,Cr));let Hr=Cr.get(jn);Hr===void 0&&(Hr=p.getUniformBlockIndex(ir,jn.name),Cr.set(jn,Hr))}function Kr(jn,ir){const Hr=N.get(ir).get(jn);j.get(ir)!==Hr&&(p.uniformBlockBinding(ir,Hr,jn.__bindingPointIndex),j.set(ir,Hr))}function ti(){p.disable(3042),p.disable(2884),p.disable(2929),p.disable(32823),p.disable(3089),p.disable(2960),p.disable(32926),p.blendEquation(32774),p.blendFunc(1,0),p.blendFuncSeparate(1,0,1,0),p.colorMask(!0,!0,!0,!0),p.clearColor(0,0,0,0),p.depthMask(!0),p.depthFunc(513),p.clearDepth(1),p.stencilMask(4294967295),p.stencilFunc(519,0,4294967295),p.stencilOp(7680,7680,7680),p.clearStencil(0),p.cullFace(1029),p.frontFace(2305),p.polygonOffset(0,0),p.activeTexture(33984),p.bindFramebuffer(36160,null),s===!0&&(p.bindFramebuffer(36009,null),p.bindFramebuffer(36008,null)),p.useProgram(null),p.lineWidth(1),p.scissor(0,0,p.canvas.width,p.canvas.height),p.viewport(0,0,p.canvas.width,p.canvas.height),L={},Ut=null,Ft={},W={},z=new WeakMap,q=[],I=null,Z=!1,Y=null,G=null,oe=null,ce=null,be=null,Ee=null,ve=null,ge=!1,Ge=null,ht=null,It=null,St=null,we=null,nn.set(0,0,p.canvas.width,p.canvas.height),xt.set(0,0,p.canvas.width,p.canvas.height),S.reset(),O.reset(),U.reset()}return{buffers:{color:S,depth:O,stencil:U},enable:Fn,disable:Rn,bindFramebuffer:cn,drawBuffers:qe,useProgram:Qe,setBlending:Jt,setMaterial:Qt,setFlipSided:Pn,setCullFace:kn,setLineWidth:Qn,setPolygonOffset:ke,setScissorTest:ar,activeTexture:Tr,bindTexture:rn,unbindTexture:Ht,compressedTexImage2D:Gn,compressedTexImage3D:Xt,texImage2D:sr,texImage3D:Er,updateUBOMapping:ri,uniformBlockBinding:Kr,texStorage2D:Un,texStorage3D:ur,texSubImage2D:Wt,texSubImage3D:Zt,compressedTexSubImage2D:Vn,compressedTexSubImage3D:xn,scissor:Mr,viewport:pr,reset:ti}}function the(p,o,u,s,r,l,C){const S=r.isWebGL2,O=r.maxTextures,U=r.maxCubemapSize,j=r.maxTextureSize,N=r.maxSamples,L=o.has("WEBGL_multisampled_render_to_texture")?o.get("WEBGL_multisampled_render_to_texture"):null,W=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),z=new WeakMap;let q;const I=new WeakMap;let Z=!1;try{Z=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function Y(rn,Ht){return Z?new OffscreenCanvas(rn,Ht):RO("canvas")}function G(rn,Ht,Gn,Xt){let Wt=1;if((rn.width>Xt||rn.height>Xt)&&(Wt=Xt/Math.max(rn.width,rn.height)),Wt<1||Ht===!0)if(typeof HTMLImageElement<"u"&&rn instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&rn instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&rn instanceof ImageBitmap){const Zt=Ht?nR:Math.floor,Vn=Zt(Wt*rn.width),xn=Zt(Wt*rn.height);q===void 0&&(q=Y(Vn,xn));const Un=Gn?Y(Vn,xn):q;return Un.width=Vn,Un.height=xn,Un.getContext("2d").drawImage(rn,0,0,Vn,xn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+rn.width+"x"+rn.height+") to ("+Vn+"x"+xn+")."),Un}else return"data"in rn&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+rn.width+"x"+rn.height+")."),rn;return rn}function oe(rn){return dW(rn.width)&&dW(rn.height)}function ce(rn){return S?!1:rn.wrapS!==Y0||rn.wrapT!==Y0||rn.minFilter!==gh&&rn.minFilter!==Ap}function be(rn,Ht){return rn.generateMipmaps&&Ht&&rn.minFilter!==gh&&rn.minFilter!==Ap}function Ee(rn){p.generateMipmap(rn)}function ve(rn,Ht,Gn,Xt,Wt=!1){if(S===!1)return Ht;if(rn!==null){if(p[rn]!==void 0)return p[rn];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+rn+"'")}let Zt=Ht;return Ht===6403&&(Gn===5126&&(Zt=33326),Gn===5131&&(Zt=33325),Gn===5121&&(Zt=33321)),Ht===33319&&(Gn===5126&&(Zt=33328),Gn===5131&&(Zt=33327),Gn===5121&&(Zt=33323)),Ht===6408&&(Gn===5126&&(Zt=34836),Gn===5131&&(Zt=34842),Gn===5121&&(Zt=Xt===tu&&Wt===!1?35907:32856),Gn===32819&&(Zt=32854),Gn===32820&&(Zt=32855)),(Zt===33325||Zt===33326||Zt===33327||Zt===33328||Zt===34842||Zt===34836)&&o.get("EXT_color_buffer_float"),Zt}function ge(rn,Ht,Gn){return be(rn,Gn)===!0||rn.isFramebufferTexture&&rn.minFilter!==gh&&rn.minFilter!==Ap?Math.log2(Math.max(Ht.width,Ht.height))+1:rn.mipmaps!==void 0&&rn.mipmaps.length>0?rn.mipmaps.length:rn.isCompressedTexture&&Array.isArray(rn.image)?Ht.mipmaps.length:1}function Ge(rn){return rn===gh||rn===UU||rn===EI?9728:9729}function ht(rn){const Ht=rn.target;Ht.removeEventListener("dispose",ht),St(Ht),Ht.isVideoTexture&&z.delete(Ht)}function It(rn){const Ht=rn.target;Ht.removeEventListener("dispose",It),bt(Ht)}function St(rn){const Ht=s.get(rn);if(Ht.__webglInit===void 0)return;const Gn=rn.source,Xt=I.get(Gn);if(Xt){const Wt=Xt[Ht.__cacheKey];Wt.usedTimes--,Wt.usedTimes===0&&we(rn),Object.keys(Xt).length===0&&I.delete(Gn)}s.remove(rn)}function we(rn){const Ht=s.get(rn);p.deleteTexture(Ht.__webglTexture);const Gn=rn.source,Xt=I.get(Gn);delete Xt[Ht.__cacheKey],C.memory.textures--}function bt(rn){const Ht=rn.texture,Gn=s.get(rn),Xt=s.get(Ht);if(Xt.__webglTexture!==void 0&&(p.deleteTexture(Xt.__webglTexture),C.memory.textures--),rn.depthTexture&&rn.depthTexture.dispose(),rn.isWebGLCubeRenderTarget)for(let Wt=0;Wt<6;Wt++)p.deleteFramebuffer(Gn.__webglFramebuffer[Wt]),Gn.__webglDepthbuffer&&p.deleteRenderbuffer(Gn.__webglDepthbuffer[Wt]);else{if(p.deleteFramebuffer(Gn.__webglFramebuffer),Gn.__webglDepthbuffer&&p.deleteRenderbuffer(Gn.__webglDepthbuffer),Gn.__webglMultisampledFramebuffer&&p.deleteFramebuffer(Gn.__webglMultisampledFramebuffer),Gn.__webglColorRenderbuffer)for(let Wt=0;Wt<Gn.__webglColorRenderbuffer.length;Wt++)Gn.__webglColorRenderbuffer[Wt]&&p.deleteRenderbuffer(Gn.__webglColorRenderbuffer[Wt]);Gn.__webglDepthRenderbuffer&&p.deleteRenderbuffer(Gn.__webglDepthRenderbuffer)}if(rn.isWebGLMultipleRenderTargets)for(let Wt=0,Zt=Ht.length;Wt<Zt;Wt++){const Vn=s.get(Ht[Wt]);Vn.__webglTexture&&(p.deleteTexture(Vn.__webglTexture),C.memory.textures--),s.remove(Ht[Wt])}s.remove(Ht),s.remove(rn)}let jt=0;function Mt(){jt=0}function ze(){const rn=jt;return rn>=O&&console.warn("THREE.WebGLTextures: Trying to use "+rn+" texture units while this GPU supports only "+O),jt+=1,rn}function Ut(rn){const Ht=[];return Ht.push(rn.wrapS),Ht.push(rn.wrapT),Ht.push(rn.wrapR||0),Ht.push(rn.magFilter),Ht.push(rn.minFilter),Ht.push(rn.anisotropy),Ht.push(rn.internalFormat),Ht.push(rn.format),Ht.push(rn.type),Ht.push(rn.generateMipmaps),Ht.push(rn.premultiplyAlpha),Ht.push(rn.flipY),Ht.push(rn.unpackAlignment),Ht.push(rn.encoding),Ht.join()}function Ft(rn,Ht){const Gn=s.get(rn);if(rn.isVideoTexture&&ar(rn),rn.isRenderTargetTexture===!1&&rn.version>0&&Gn.__version!==rn.version){const Xt=rn.image;if(Xt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Xt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Rn(Gn,rn,Ht);return}}u.bindTexture(3553,Gn.__webglTexture,33984+Ht)}function pt(rn,Ht){const Gn=s.get(rn);if(rn.version>0&&Gn.__version!==rn.version){Rn(Gn,rn,Ht);return}u.bindTexture(35866,Gn.__webglTexture,33984+Ht)}function yt(rn,Ht){const Gn=s.get(rn);if(rn.version>0&&Gn.__version!==rn.version){Rn(Gn,rn,Ht);return}u.bindTexture(32879,Gn.__webglTexture,33984+Ht)}function nn(rn,Ht){const Gn=s.get(rn);if(rn.version>0&&Gn.__version!==rn.version){cn(Gn,rn,Ht);return}u.bindTexture(34067,Gn.__webglTexture,33984+Ht)}const xt={[FO]:10497,[Y0]:33071,[eR]:33648},_t={[gh]:9728,[UU]:9984,[EI]:9986,[Ap]:9729,[Hse]:9985,[zS]:9987};function Yt(rn,Ht,Gn){if(Gn?(p.texParameteri(rn,10242,xt[Ht.wrapS]),p.texParameteri(rn,10243,xt[Ht.wrapT]),(rn===32879||rn===35866)&&p.texParameteri(rn,32882,xt[Ht.wrapR]),p.texParameteri(rn,10240,_t[Ht.magFilter]),p.texParameteri(rn,10241,_t[Ht.minFilter])):(p.texParameteri(rn,10242,33071),p.texParameteri(rn,10243,33071),(rn===32879||rn===35866)&&p.texParameteri(rn,32882,33071),(Ht.wrapS!==Y0||Ht.wrapT!==Y0)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),p.texParameteri(rn,10240,Ge(Ht.magFilter)),p.texParameteri(rn,10241,Ge(Ht.minFilter)),Ht.minFilter!==gh&&Ht.minFilter!==Ap&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),o.has("EXT_texture_filter_anisotropic")===!0){const Xt=o.get("EXT_texture_filter_anisotropic");if(Ht.magFilter===gh||Ht.minFilter!==EI&&Ht.minFilter!==zS||Ht.type===Xx&&o.has("OES_texture_float_linear")===!1||S===!1&&Ht.type===US&&o.has("OES_texture_half_float_linear")===!1)return;(Ht.anisotropy>1||s.get(Ht).__currentAnisotropy)&&(p.texParameterf(rn,Xt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Ht.anisotropy,r.getMaxAnisotropy())),s.get(Ht).__currentAnisotropy=Ht.anisotropy)}}function Fn(rn,Ht){let Gn=!1;rn.__webglInit===void 0&&(rn.__webglInit=!0,Ht.addEventListener("dispose",ht));const Xt=Ht.source;let Wt=I.get(Xt);Wt===void 0&&(Wt={},I.set(Xt,Wt));const Zt=Ut(Ht);if(Zt!==rn.__cacheKey){Wt[Zt]===void 0&&(Wt[Zt]={texture:p.createTexture(),usedTimes:0},C.memory.textures++,Gn=!0),Wt[Zt].usedTimes++;const Vn=Wt[rn.__cacheKey];Vn!==void 0&&(Wt[rn.__cacheKey].usedTimes--,Vn.usedTimes===0&&we(Ht)),rn.__cacheKey=Zt,rn.__webglTexture=Wt[Zt].texture}return Gn}function Rn(rn,Ht,Gn){let Xt=3553;(Ht.isDataArrayTexture||Ht.isCompressedArrayTexture)&&(Xt=35866),Ht.isData3DTexture&&(Xt=32879);const Wt=Fn(rn,Ht),Zt=Ht.source;u.bindTexture(Xt,rn.__webglTexture,33984+Gn);const Vn=s.get(Zt);if(Zt.version!==Vn.__version||Wt===!0){u.activeTexture(33984+Gn),p.pixelStorei(37440,Ht.flipY),p.pixelStorei(37441,Ht.premultiplyAlpha),p.pixelStorei(3317,Ht.unpackAlignment),p.pixelStorei(37443,0);const xn=ce(Ht)&&oe(Ht.image)===!1;let Un=G(Ht.image,xn,!1,j);Un=Tr(Ht,Un);const ur=oe(Un)||S,sr=l.convert(Ht.format,Ht.encoding);let Er=l.convert(Ht.type),Mr=ve(Ht.internalFormat,sr,Er,Ht.encoding,Ht.isVideoTexture);Yt(Xt,Ht,ur);let pr;const ri=Ht.mipmaps,Kr=S&&Ht.isVideoTexture!==!0,ti=Vn.__version===void 0||Wt===!0,jn=ge(Ht,Un,ur);if(Ht.isDepthTexture)Mr=6402,S?Ht.type===Xx?Mr=36012:Ht.type===$x?Mr=33190:Ht.type===z2?Mr=35056:Mr=33189:Ht.type===Xx&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Ht.format===Jx&&Mr===6402&&Ht.type!==yG&&Ht.type!==$x&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Ht.type=$x,Er=l.convert(Ht.type)),Ht.format===Y2&&Mr===6402&&(Mr=34041,Ht.type!==z2&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Ht.type=z2,Er=l.convert(Ht.type))),ti&&(Kr?u.texStorage2D(3553,1,Mr,Un.width,Un.height):u.texImage2D(3553,0,Mr,Un.width,Un.height,0,sr,Er,null));else if(Ht.isDataTexture)if(ri.length>0&&ur){Kr&&ti&&u.texStorage2D(3553,jn,Mr,ri[0].width,ri[0].height);for(let ir=0,Cr=ri.length;ir<Cr;ir++)pr=ri[ir],Kr?u.texSubImage2D(3553,ir,0,0,pr.width,pr.height,sr,Er,pr.data):u.texImage2D(3553,ir,Mr,pr.width,pr.height,0,sr,Er,pr.data);Ht.generateMipmaps=!1}else Kr?(ti&&u.texStorage2D(3553,jn,Mr,Un.width,Un.height),u.texSubImage2D(3553,0,0,0,Un.width,Un.height,sr,Er,Un.data)):u.texImage2D(3553,0,Mr,Un.width,Un.height,0,sr,Er,Un.data);else if(Ht.isCompressedTexture)if(Ht.isCompressedArrayTexture){Kr&&ti&&u.texStorage3D(35866,jn,Mr,ri[0].width,ri[0].height,Un.depth);for(let ir=0,Cr=ri.length;ir<Cr;ir++)pr=ri[ir],Ht.format!==J0?sr!==null?Kr?u.compressedTexSubImage3D(35866,ir,0,0,0,pr.width,pr.height,Un.depth,sr,pr.data,0,0):u.compressedTexImage3D(35866,ir,Mr,pr.width,pr.height,Un.depth,0,pr.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Kr?u.texSubImage3D(35866,ir,0,0,0,pr.width,pr.height,Un.depth,sr,Er,pr.data):u.texImage3D(35866,ir,Mr,pr.width,pr.height,Un.depth,0,sr,Er,pr.data)}else{Kr&&ti&&u.texStorage2D(3553,jn,Mr,ri[0].width,ri[0].height);for(let ir=0,Cr=ri.length;ir<Cr;ir++)pr=ri[ir],Ht.format!==J0?sr!==null?Kr?u.compressedTexSubImage2D(3553,ir,0,0,pr.width,pr.height,sr,pr.data):u.compressedTexImage2D(3553,ir,Mr,pr.width,pr.height,0,pr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Kr?u.texSubImage2D(3553,ir,0,0,pr.width,pr.height,sr,Er,pr.data):u.texImage2D(3553,ir,Mr,pr.width,pr.height,0,sr,Er,pr.data)}else if(Ht.isDataArrayTexture)Kr?(ti&&u.texStorage3D(35866,jn,Mr,Un.width,Un.height,Un.depth),u.texSubImage3D(35866,0,0,0,0,Un.width,Un.height,Un.depth,sr,Er,Un.data)):u.texImage3D(35866,0,Mr,Un.width,Un.height,Un.depth,0,sr,Er,Un.data);else if(Ht.isData3DTexture)Kr?(ti&&u.texStorage3D(32879,jn,Mr,Un.width,Un.height,Un.depth),u.texSubImage3D(32879,0,0,0,0,Un.width,Un.height,Un.depth,sr,Er,Un.data)):u.texImage3D(32879,0,Mr,Un.width,Un.height,Un.depth,0,sr,Er,Un.data);else if(Ht.isFramebufferTexture){if(ti)if(Kr)u.texStorage2D(3553,jn,Mr,Un.width,Un.height);else{let ir=Un.width,Cr=Un.height;for(let Hr=0;Hr<jn;Hr++)u.texImage2D(3553,Hr,Mr,ir,Cr,0,sr,Er,null),ir>>=1,Cr>>=1}}else if(ri.length>0&&ur){Kr&&ti&&u.texStorage2D(3553,jn,Mr,ri[0].width,ri[0].height);for(let ir=0,Cr=ri.length;ir<Cr;ir++)pr=ri[ir],Kr?u.texSubImage2D(3553,ir,0,0,sr,Er,pr):u.texImage2D(3553,ir,Mr,sr,Er,pr);Ht.generateMipmaps=!1}else Kr?(ti&&u.texStorage2D(3553,jn,Mr,Un.width,Un.height),u.texSubImage2D(3553,0,0,0,sr,Er,Un)):u.texImage2D(3553,0,Mr,sr,Er,Un);be(Ht,ur)&&Ee(Xt),Vn.__version=Zt.version,Ht.onUpdate&&Ht.onUpdate(Ht)}rn.__version=Ht.version}function cn(rn,Ht,Gn){if(Ht.image.length!==6)return;const Xt=Fn(rn,Ht),Wt=Ht.source;u.bindTexture(34067,rn.__webglTexture,33984+Gn);const Zt=s.get(Wt);if(Wt.version!==Zt.__version||Xt===!0){u.activeTexture(33984+Gn),p.pixelStorei(37440,Ht.flipY),p.pixelStorei(37441,Ht.premultiplyAlpha),p.pixelStorei(3317,Ht.unpackAlignment),p.pixelStorei(37443,0);const Vn=Ht.isCompressedTexture||Ht.image[0].isCompressedTexture,xn=Ht.image[0]&&Ht.image[0].isDataTexture,Un=[];for(let ir=0;ir<6;ir++)!Vn&&!xn?Un[ir]=G(Ht.image[ir],!1,!0,U):Un[ir]=xn?Ht.image[ir].image:Ht.image[ir],Un[ir]=Tr(Ht,Un[ir]);const ur=Un[0],sr=oe(ur)||S,Er=l.convert(Ht.format,Ht.encoding),Mr=l.convert(Ht.type),pr=ve(Ht.internalFormat,Er,Mr,Ht.encoding),ri=S&&Ht.isVideoTexture!==!0,Kr=Zt.__version===void 0||Xt===!0;let ti=ge(Ht,ur,sr);Yt(34067,Ht,sr);let jn;if(Vn){ri&&Kr&&u.texStorage2D(34067,ti,pr,ur.width,ur.height);for(let ir=0;ir<6;ir++){jn=Un[ir].mipmaps;for(let Cr=0;Cr<jn.length;Cr++){const Hr=jn[Cr];Ht.format!==J0?Er!==null?ri?u.compressedTexSubImage2D(34069+ir,Cr,0,0,Hr.width,Hr.height,Er,Hr.data):u.compressedTexImage2D(34069+ir,Cr,pr,Hr.width,Hr.height,0,Hr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):ri?u.texSubImage2D(34069+ir,Cr,0,0,Hr.width,Hr.height,Er,Mr,Hr.data):u.texImage2D(34069+ir,Cr,pr,Hr.width,Hr.height,0,Er,Mr,Hr.data)}}}else{jn=Ht.mipmaps,ri&&Kr&&(jn.length>0&&ti++,u.texStorage2D(34067,ti,pr,Un[0].width,Un[0].height));for(let ir=0;ir<6;ir++)if(xn){ri?u.texSubImage2D(34069+ir,0,0,0,Un[ir].width,Un[ir].height,Er,Mr,Un[ir].data):u.texImage2D(34069+ir,0,pr,Un[ir].width,Un[ir].height,0,Er,Mr,Un[ir].data);for(let Cr=0;Cr<jn.length;Cr++){const qr=jn[Cr].image[ir].image;ri?u.texSubImage2D(34069+ir,Cr+1,0,0,qr.width,qr.height,Er,Mr,qr.data):u.texImage2D(34069+ir,Cr+1,pr,qr.width,qr.height,0,Er,Mr,qr.data)}}else{ri?u.texSubImage2D(34069+ir,0,0,0,Er,Mr,Un[ir]):u.texImage2D(34069+ir,0,pr,Er,Mr,Un[ir]);for(let Cr=0;Cr<jn.length;Cr++){const Hr=jn[Cr];ri?u.texSubImage2D(34069+ir,Cr+1,0,0,Er,Mr,Hr.image[ir]):u.texImage2D(34069+ir,Cr+1,pr,Er,Mr,Hr.image[ir])}}}be(Ht,sr)&&Ee(34067),Zt.__version=Wt.version,Ht.onUpdate&&Ht.onUpdate(Ht)}rn.__version=Ht.version}function qe(rn,Ht,Gn,Xt,Wt){const Zt=l.convert(Gn.format,Gn.encoding),Vn=l.convert(Gn.type),xn=ve(Gn.internalFormat,Zt,Vn,Gn.encoding);s.get(Ht).__hasExternalTextures||(Wt===32879||Wt===35866?u.texImage3D(Wt,0,xn,Ht.width,Ht.height,Ht.depth,0,Zt,Vn,null):u.texImage2D(Wt,0,xn,Ht.width,Ht.height,0,Zt,Vn,null)),u.bindFramebuffer(36160,rn),ke(Ht)?L.framebufferTexture2DMultisampleEXT(36160,Xt,Wt,s.get(Gn).__webglTexture,0,Qn(Ht)):(Wt===3553||Wt>=34069&&Wt<=34074)&&p.framebufferTexture2D(36160,Xt,Wt,s.get(Gn).__webglTexture,0),u.bindFramebuffer(36160,null)}function Qe(rn,Ht,Gn){if(p.bindRenderbuffer(36161,rn),Ht.depthBuffer&&!Ht.stencilBuffer){let Xt=33189;if(Gn||ke(Ht)){const Wt=Ht.depthTexture;Wt&&Wt.isDepthTexture&&(Wt.type===Xx?Xt=36012:Wt.type===$x&&(Xt=33190));const Zt=Qn(Ht);ke(Ht)?L.renderbufferStorageMultisampleEXT(36161,Zt,Xt,Ht.width,Ht.height):p.renderbufferStorageMultisample(36161,Zt,Xt,Ht.width,Ht.height)}else p.renderbufferStorage(36161,Xt,Ht.width,Ht.height);p.framebufferRenderbuffer(36160,36096,36161,rn)}else if(Ht.depthBuffer&&Ht.stencilBuffer){const Xt=Qn(Ht);Gn&&ke(Ht)===!1?p.renderbufferStorageMultisample(36161,Xt,35056,Ht.width,Ht.height):ke(Ht)?L.renderbufferStorageMultisampleEXT(36161,Xt,35056,Ht.width,Ht.height):p.renderbufferStorage(36161,34041,Ht.width,Ht.height),p.framebufferRenderbuffer(36160,33306,36161,rn)}else{const Xt=Ht.isWebGLMultipleRenderTargets===!0?Ht.texture:[Ht.texture];for(let Wt=0;Wt<Xt.length;Wt++){const Zt=Xt[Wt],Vn=l.convert(Zt.format,Zt.encoding),xn=l.convert(Zt.type),Un=ve(Zt.internalFormat,Vn,xn,Zt.encoding),ur=Qn(Ht);Gn&&ke(Ht)===!1?p.renderbufferStorageMultisample(36161,ur,Un,Ht.width,Ht.height):ke(Ht)?L.renderbufferStorageMultisampleEXT(36161,ur,Un,Ht.width,Ht.height):p.renderbufferStorage(36161,Un,Ht.width,Ht.height)}}p.bindRenderbuffer(36161,null)}function $e(rn,Ht){if(Ht&&Ht.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(u.bindFramebuffer(36160,rn),!(Ht.depthTexture&&Ht.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!s.get(Ht.depthTexture).__webglTexture||Ht.depthTexture.image.width!==Ht.width||Ht.depthTexture.image.height!==Ht.height)&&(Ht.depthTexture.image.width=Ht.width,Ht.depthTexture.image.height=Ht.height,Ht.depthTexture.needsUpdate=!0),Ft(Ht.depthTexture,0);const Xt=s.get(Ht.depthTexture).__webglTexture,Wt=Qn(Ht);if(Ht.depthTexture.format===Jx)ke(Ht)?L.framebufferTexture2DMultisampleEXT(36160,36096,3553,Xt,0,Wt):p.framebufferTexture2D(36160,36096,3553,Xt,0);else if(Ht.depthTexture.format===Y2)ke(Ht)?L.framebufferTexture2DMultisampleEXT(36160,33306,3553,Xt,0,Wt):p.framebufferTexture2D(36160,33306,3553,Xt,0);else throw new Error("Unknown depthTexture format")}function ft(rn){const Ht=s.get(rn),Gn=rn.isWebGLCubeRenderTarget===!0;if(rn.depthTexture&&!Ht.__autoAllocateDepthBuffer){if(Gn)throw new Error("target.depthTexture not supported in Cube render targets");$e(Ht.__webglFramebuffer,rn)}else if(Gn){Ht.__webglDepthbuffer=[];for(let Xt=0;Xt<6;Xt++)u.bindFramebuffer(36160,Ht.__webglFramebuffer[Xt]),Ht.__webglDepthbuffer[Xt]=p.createRenderbuffer(),Qe(Ht.__webglDepthbuffer[Xt],rn,!1)}else u.bindFramebuffer(36160,Ht.__webglFramebuffer),Ht.__webglDepthbuffer=p.createRenderbuffer(),Qe(Ht.__webglDepthbuffer,rn,!1);u.bindFramebuffer(36160,null)}function Jt(rn,Ht,Gn){const Xt=s.get(rn);Ht!==void 0&&qe(Xt.__webglFramebuffer,rn,rn.texture,36064,3553),Gn!==void 0&&ft(rn)}function Qt(rn){const Ht=rn.texture,Gn=s.get(rn),Xt=s.get(Ht);rn.addEventListener("dispose",It),rn.isWebGLMultipleRenderTargets!==!0&&(Xt.__webglTexture===void 0&&(Xt.__webglTexture=p.createTexture()),Xt.__version=Ht.version,C.memory.textures++);const Wt=rn.isWebGLCubeRenderTarget===!0,Zt=rn.isWebGLMultipleRenderTargets===!0,Vn=oe(rn)||S;if(Wt){Gn.__webglFramebuffer=[];for(let xn=0;xn<6;xn++)Gn.__webglFramebuffer[xn]=p.createFramebuffer()}else{if(Gn.__webglFramebuffer=p.createFramebuffer(),Zt)if(r.drawBuffers){const xn=rn.texture;for(let Un=0,ur=xn.length;Un<ur;Un++){const sr=s.get(xn[Un]);sr.__webglTexture===void 0&&(sr.__webglTexture=p.createTexture(),C.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(S&&rn.samples>0&&ke(rn)===!1){const xn=Zt?Ht:[Ht];Gn.__webglMultisampledFramebuffer=p.createFramebuffer(),Gn.__webglColorRenderbuffer=[],u.bindFramebuffer(36160,Gn.__webglMultisampledFramebuffer);for(let Un=0;Un<xn.length;Un++){const ur=xn[Un];Gn.__webglColorRenderbuffer[Un]=p.createRenderbuffer(),p.bindRenderbuffer(36161,Gn.__webglColorRenderbuffer[Un]);const sr=l.convert(ur.format,ur.encoding),Er=l.convert(ur.type),Mr=ve(ur.internalFormat,sr,Er,ur.encoding,rn.isXRRenderTarget===!0),pr=Qn(rn);p.renderbufferStorageMultisample(36161,pr,Mr,rn.width,rn.height),p.framebufferRenderbuffer(36160,36064+Un,36161,Gn.__webglColorRenderbuffer[Un])}p.bindRenderbuffer(36161,null),rn.depthBuffer&&(Gn.__webglDepthRenderbuffer=p.createRenderbuffer(),Qe(Gn.__webglDepthRenderbuffer,rn,!0)),u.bindFramebuffer(36160,null)}}if(Wt){u.bindTexture(34067,Xt.__webglTexture),Yt(34067,Ht,Vn);for(let xn=0;xn<6;xn++)qe(Gn.__webglFramebuffer[xn],rn,Ht,36064,34069+xn);be(Ht,Vn)&&Ee(34067),u.unbindTexture()}else if(Zt){const xn=rn.texture;for(let Un=0,ur=xn.length;Un<ur;Un++){const sr=xn[Un],Er=s.get(sr);u.bindTexture(3553,Er.__webglTexture),Yt(3553,sr,Vn),qe(Gn.__webglFramebuffer,rn,sr,36064+Un,3553),be(sr,Vn)&&Ee(3553)}u.unbindTexture()}else{let xn=3553;(rn.isWebGL3DRenderTarget||rn.isWebGLArrayRenderTarget)&&(S?xn=rn.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),u.bindTexture(xn,Xt.__webglTexture),Yt(xn,Ht,Vn),qe(Gn.__webglFramebuffer,rn,Ht,36064,xn),be(Ht,Vn)&&Ee(xn),u.unbindTexture()}rn.depthBuffer&&ft(rn)}function Pn(rn){const Ht=oe(rn)||S,Gn=rn.isWebGLMultipleRenderTargets===!0?rn.texture:[rn.texture];for(let Xt=0,Wt=Gn.length;Xt<Wt;Xt++){const Zt=Gn[Xt];if(be(Zt,Ht)){const Vn=rn.isWebGLCubeRenderTarget?34067:3553,xn=s.get(Zt).__webglTexture;u.bindTexture(Vn,xn),Ee(Vn),u.unbindTexture()}}}function kn(rn){if(S&&rn.samples>0&&ke(rn)===!1){const Ht=rn.isWebGLMultipleRenderTargets?rn.texture:[rn.texture],Gn=rn.width,Xt=rn.height;let Wt=16384;const Zt=[],Vn=rn.stencilBuffer?33306:36096,xn=s.get(rn),Un=rn.isWebGLMultipleRenderTargets===!0;if(Un)for(let ur=0;ur<Ht.length;ur++)u.bindFramebuffer(36160,xn.__webglMultisampledFramebuffer),p.framebufferRenderbuffer(36160,36064+ur,36161,null),u.bindFramebuffer(36160,xn.__webglFramebuffer),p.framebufferTexture2D(36009,36064+ur,3553,null,0);u.bindFramebuffer(36008,xn.__webglMultisampledFramebuffer),u.bindFramebuffer(36009,xn.__webglFramebuffer);for(let ur=0;ur<Ht.length;ur++){Zt.push(36064+ur),rn.depthBuffer&&Zt.push(Vn);const sr=xn.__ignoreDepthValues!==void 0?xn.__ignoreDepthValues:!1;if(sr===!1&&(rn.depthBuffer&&(Wt|=256),rn.stencilBuffer&&(Wt|=1024)),Un&&p.framebufferRenderbuffer(36008,36064,36161,xn.__webglColorRenderbuffer[ur]),sr===!0&&(p.invalidateFramebuffer(36008,[Vn]),p.invalidateFramebuffer(36009,[Vn])),Un){const Er=s.get(Ht[ur]).__webglTexture;p.framebufferTexture2D(36009,36064,3553,Er,0)}p.blitFramebuffer(0,0,Gn,Xt,0,0,Gn,Xt,Wt,9728),W&&p.invalidateFramebuffer(36008,Zt)}if(u.bindFramebuffer(36008,null),u.bindFramebuffer(36009,null),Un)for(let ur=0;ur<Ht.length;ur++){u.bindFramebuffer(36160,xn.__webglMultisampledFramebuffer),p.framebufferRenderbuffer(36160,36064+ur,36161,xn.__webglColorRenderbuffer[ur]);const sr=s.get(Ht[ur]).__webglTexture;u.bindFramebuffer(36160,xn.__webglFramebuffer),p.framebufferTexture2D(36009,36064+ur,3553,sr,0)}u.bindFramebuffer(36009,xn.__webglMultisampledFramebuffer)}}function Qn(rn){return Math.min(N,rn.samples)}function ke(rn){const Ht=s.get(rn);return S&&rn.samples>0&&o.has("WEBGL_multisampled_render_to_texture")===!0&&Ht.__useRenderToTexture!==!1}function ar(rn){const Ht=C.render.frame;z.get(rn)!==Ht&&(z.set(rn,Ht),rn.update())}function Tr(rn,Ht){const Gn=rn.encoding,Xt=rn.format,Wt=rn.type;return rn.isCompressedTexture===!0||rn.isVideoTexture===!0||rn.format===tR||Gn!==aw&&(Gn===tu?S===!1?o.has("EXT_sRGB")===!0&&Xt===J0?(rn.format=tR,rn.minFilter=Ap,rn.generateMipmaps=!1):Ht=wG.sRGBToLinear(Ht):(Xt!==J0||Wt!==ow)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",Gn)),Ht}this.allocateTextureUnit=ze,this.resetTextureUnits=Mt,this.setTexture2D=Ft,this.setTexture2DArray=pt,this.setTexture3D=yt,this.setTextureCube=nn,this.rebindTextures=Jt,this.setupRenderTarget=Qt,this.updateRenderTargetMipmap=Pn,this.updateMultisampleRenderTarget=kn,this.setupDepthRenderbuffer=ft,this.setupFrameBufferTexture=qe,this.useMultisampledRTT=ke}function nhe(p,o,u){const s=u.isWebGL2;function r(l,C=null){let S;if(l===ow)return 5121;if(l===Xse)return 32819;if(l===Kse)return 32820;if(l===Gse)return 5120;if(l===qse)return 5122;if(l===yG)return 5123;if(l===$se)return 5124;if(l===$x)return 5125;if(l===Xx)return 5126;if(l===US)return s?5131:(S=o.get("OES_texture_half_float"),S!==null?S.HALF_FLOAT_OES:null);if(l===Yse)return 6406;if(l===J0)return 6408;if(l===Qse)return 6409;if(l===Zse)return 6410;if(l===Jx)return 6402;if(l===Y2)return 34041;if(l===Jse)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(l===tR)return S=o.get("EXT_sRGB"),S!==null?S.SRGB_ALPHA_EXT:null;if(l===eue)return 6403;if(l===tue)return 36244;if(l===nue)return 33319;if(l===rue)return 33320;if(l===iue)return 36249;if(l===SI||l===kI||l===CI||l===AI)if(C===tu)if(S=o.get("WEBGL_compressed_texture_s3tc_srgb"),S!==null){if(l===SI)return S.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(l===kI)return S.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(l===CI)return S.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(l===AI)return S.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(S=o.get("WEBGL_compressed_texture_s3tc"),S!==null){if(l===SI)return S.COMPRESSED_RGB_S3TC_DXT1_EXT;if(l===kI)return S.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(l===CI)return S.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(l===AI)return S.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(l===WU||l===VU||l===HU||l===GU)if(S=o.get("WEBGL_compressed_texture_pvrtc"),S!==null){if(l===WU)return S.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(l===VU)return S.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(l===HU)return S.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(l===GU)return S.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(l===oue)return S=o.get("WEBGL_compressed_texture_etc1"),S!==null?S.COMPRESSED_RGB_ETC1_WEBGL:null;if(l===qU||l===$U)if(S=o.get("WEBGL_compressed_texture_etc"),S!==null){if(l===qU)return C===tu?S.COMPRESSED_SRGB8_ETC2:S.COMPRESSED_RGB8_ETC2;if(l===$U)return C===tu?S.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:S.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(l===XU||l===KU||l===YU||l===JU||l===QU||l===ZU||l===eW||l===tW||l===nW||l===rW||l===iW||l===oW||l===aW||l===sW)if(S=o.get("WEBGL_compressed_texture_astc"),S!==null){if(l===XU)return C===tu?S.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:S.COMPRESSED_RGBA_ASTC_4x4_KHR;if(l===KU)return C===tu?S.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:S.COMPRESSED_RGBA_ASTC_5x4_KHR;if(l===YU)return C===tu?S.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:S.COMPRESSED_RGBA_ASTC_5x5_KHR;if(l===JU)return C===tu?S.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:S.COMPRESSED_RGBA_ASTC_6x5_KHR;if(l===QU)return C===tu?S.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:S.COMPRESSED_RGBA_ASTC_6x6_KHR;if(l===ZU)return C===tu?S.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:S.COMPRESSED_RGBA_ASTC_8x5_KHR;if(l===eW)return C===tu?S.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:S.COMPRESSED_RGBA_ASTC_8x6_KHR;if(l===tW)return C===tu?S.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:S.COMPRESSED_RGBA_ASTC_8x8_KHR;if(l===nW)return C===tu?S.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:S.COMPRESSED_RGBA_ASTC_10x5_KHR;if(l===rW)return C===tu?S.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:S.COMPRESSED_RGBA_ASTC_10x6_KHR;if(l===iW)return C===tu?S.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:S.COMPRESSED_RGBA_ASTC_10x8_KHR;if(l===oW)return C===tu?S.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:S.COMPRESSED_RGBA_ASTC_10x10_KHR;if(l===aW)return C===tu?S.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:S.COMPRESSED_RGBA_ASTC_12x10_KHR;if(l===sW)return C===tu?S.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:S.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(l===uW)if(S=o.get("EXT_texture_compression_bptc"),S!==null){if(l===uW)return C===tu?S.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:S.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return l===z2?s?34042:(S=o.get("WEBGL_depth_texture"),S!==null?S.UNSIGNED_INT_24_8_WEBGL:null):p[l]!==void 0?p[l]:null}return{convert:r}}class rhe extends jg{constructor(o=[]){super(),this.isArrayCamera=!0,this.cameras=o}}class XA extends od{constructor(){super(),this.isGroup=!0,this.type="Group"}}const ihe={type:"move"};class eF{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new XA,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new XA,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new hr,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new hr),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new XA,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new hr,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new hr),this._grip}dispatchEvent(o){return this._targetRay!==null&&this._targetRay.dispatchEvent(o),this._grip!==null&&this._grip.dispatchEvent(o),this._hand!==null&&this._hand.dispatchEvent(o),this}connect(o){if(o&&o.hand){const u=this._hand;if(u)for(const s of o.hand.values())this._getHandJoint(u,s)}return this.dispatchEvent({type:"connected",data:o}),this}disconnect(o){return this.dispatchEvent({type:"disconnected",data:o}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(o,u,s){let r=null,l=null,C=null;const S=this._targetRay,O=this._grip,U=this._hand;if(o&&u.session.visibilityState!=="visible-blurred"){if(U&&o.hand){C=!0;for(const q of o.hand.values()){const I=u.getJointPose(q,s),Z=this._getHandJoint(U,q);I!==null&&(Z.matrix.fromArray(I.transform.matrix),Z.matrix.decompose(Z.position,Z.rotation,Z.scale),Z.jointRadius=I.radius),Z.visible=I!==null}const j=U.joints["index-finger-tip"],N=U.joints["thumb-tip"],L=j.position.distanceTo(N.position),W=.02,z=.005;U.inputState.pinching&&L>W+z?(U.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:o.handedness,target:this})):!U.inputState.pinching&&L<=W-z&&(U.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:o.handedness,target:this}))}else O!==null&&o.gripSpace&&(l=u.getPose(o.gripSpace,s),l!==null&&(O.matrix.fromArray(l.transform.matrix),O.matrix.decompose(O.position,O.rotation,O.scale),l.linearVelocity?(O.hasLinearVelocity=!0,O.linearVelocity.copy(l.linearVelocity)):O.hasLinearVelocity=!1,l.angularVelocity?(O.hasAngularVelocity=!0,O.angularVelocity.copy(l.angularVelocity)):O.hasAngularVelocity=!1));S!==null&&(r=u.getPose(o.targetRaySpace,s),r===null&&l!==null&&(r=l),r!==null&&(S.matrix.fromArray(r.transform.matrix),S.matrix.decompose(S.position,S.rotation,S.scale),r.linearVelocity?(S.hasLinearVelocity=!0,S.linearVelocity.copy(r.linearVelocity)):S.hasLinearVelocity=!1,r.angularVelocity?(S.hasAngularVelocity=!0,S.angularVelocity.copy(r.angularVelocity)):S.hasAngularVelocity=!1,this.dispatchEvent(ihe)))}return S!==null&&(S.visible=r!==null),O!==null&&(O.visible=l!==null),U!==null&&(U.visible=C!==null),this}_getHandJoint(o,u){if(o.joints[u.jointName]===void 0){const s=new XA;s.matrixAutoUpdate=!1,s.visible=!1,o.joints[u.jointName]=s,o.add(s)}return o.joints[u.jointName]}}class ohe extends Ip{constructor(o,u,s,r,l,C,S,O,U,j){if(j=j!==void 0?j:Jx,j!==Jx&&j!==Y2)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");s===void 0&&j===Jx&&(s=$x),s===void 0&&j===Y2&&(s=z2),super(null,r,l,C,S,O,j,s,U),this.isDepthTexture=!0,this.image={width:o,height:u},this.magFilter=S!==void 0?S:gh,this.minFilter=O!==void 0?O:gh,this.flipY=!1,this.generateMipmaps=!1}}class ahe extends t_{constructor(o,u){super();const s=this;let r=null,l=1,C=null,S="local-floor",O=null,U=null,j=null,N=null,L=null,W=null;const z=u.getContextAttributes();let q=null,I=null;const Z=[],Y=[],G=new Set,oe=new Map,ce=new jg;ce.layers.enable(1),ce.viewport=new yu;const be=new jg;be.layers.enable(2),be.viewport=new yu;const Ee=[ce,be],ve=new rhe;ve.layers.enable(1),ve.layers.enable(2);let ge=null,Ge=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(pt){let yt=Z[pt];return yt===void 0&&(yt=new eF,Z[pt]=yt),yt.getTargetRaySpace()},this.getControllerGrip=function(pt){let yt=Z[pt];return yt===void 0&&(yt=new eF,Z[pt]=yt),yt.getGripSpace()},this.getHand=function(pt){let yt=Z[pt];return yt===void 0&&(yt=new eF,Z[pt]=yt),yt.getHandSpace()};function ht(pt){const yt=Y.indexOf(pt.inputSource);if(yt===-1)return;const nn=Z[yt];nn!==void 0&&nn.dispatchEvent({type:pt.type,data:pt.inputSource})}function It(){r.removeEventListener("select",ht),r.removeEventListener("selectstart",ht),r.removeEventListener("selectend",ht),r.removeEventListener("squeeze",ht),r.removeEventListener("squeezestart",ht),r.removeEventListener("squeezeend",ht),r.removeEventListener("end",It),r.removeEventListener("inputsourceschange",St);for(let pt=0;pt<Z.length;pt++){const yt=Y[pt];yt!==null&&(Y[pt]=null,Z[pt].disconnect(yt))}ge=null,Ge=null,o.setRenderTarget(q),L=null,N=null,j=null,r=null,I=null,Ft.stop(),s.isPresenting=!1,s.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(pt){l=pt,s.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(pt){S=pt,s.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return O||C},this.setReferenceSpace=function(pt){O=pt},this.getBaseLayer=function(){return N!==null?N:L},this.getBinding=function(){return j},this.getFrame=function(){return W},this.getSession=function(){return r},this.setSession=async function(pt){if(r=pt,r!==null){if(q=o.getRenderTarget(),r.addEventListener("select",ht),r.addEventListener("selectstart",ht),r.addEventListener("selectend",ht),r.addEventListener("squeeze",ht),r.addEventListener("squeezestart",ht),r.addEventListener("squeezeend",ht),r.addEventListener("end",It),r.addEventListener("inputsourceschange",St),z.xrCompatible!==!0&&await u.makeXRCompatible(),r.renderState.layers===void 0||o.capabilities.isWebGL2===!1){const yt={antialias:r.renderState.layers===void 0?z.antialias:!0,alpha:z.alpha,depth:z.depth,stencil:z.stencil,framebufferScaleFactor:l};L=new XRWebGLLayer(r,u,yt),r.updateRenderState({baseLayer:L}),I=new sw(L.framebufferWidth,L.framebufferHeight,{format:J0,type:ow,encoding:o.outputEncoding,stencilBuffer:z.stencil})}else{let yt=null,nn=null,xt=null;z.depth&&(xt=z.stencil?35056:33190,yt=z.stencil?Y2:Jx,nn=z.stencil?z2:$x);const _t={colorFormat:32856,depthFormat:xt,scaleFactor:l};j=new XRWebGLBinding(r,u),N=j.createProjectionLayer(_t),r.updateRenderState({layers:[N]}),I=new sw(N.textureWidth,N.textureHeight,{format:J0,type:ow,depthTexture:new ohe(N.textureWidth,N.textureHeight,nn,void 0,void 0,void 0,void 0,void 0,void 0,yt),stencilBuffer:z.stencil,encoding:o.outputEncoding,samples:z.antialias?4:0});const Yt=o.properties.get(I);Yt.__ignoreDepthValues=N.ignoreDepthValues}I.isXRRenderTarget=!0,this.setFoveation(1),O=null,C=await r.requestReferenceSpace(S),Ft.setContext(r),Ft.start(),s.isPresenting=!0,s.dispatchEvent({type:"sessionstart"})}};function St(pt){for(let yt=0;yt<pt.removed.length;yt++){const nn=pt.removed[yt],xt=Y.indexOf(nn);xt>=0&&(Y[xt]=null,Z[xt].disconnect(nn))}for(let yt=0;yt<pt.added.length;yt++){const nn=pt.added[yt];let xt=Y.indexOf(nn);if(xt===-1){for(let Yt=0;Yt<Z.length;Yt++)if(Yt>=Y.length){Y.push(nn),xt=Yt;break}else if(Y[Yt]===null){Y[Yt]=nn,xt=Yt;break}if(xt===-1)break}const _t=Z[xt];_t&&_t.connect(nn)}}const we=new hr,bt=new hr;function jt(pt,yt,nn){we.setFromMatrixPosition(yt.matrixWorld),bt.setFromMatrixPosition(nn.matrixWorld);const xt=we.distanceTo(bt),_t=yt.projectionMatrix.elements,Yt=nn.projectionMatrix.elements,Fn=_t[14]/(_t[10]-1),Rn=_t[14]/(_t[10]+1),cn=(_t[9]+1)/_t[5],qe=(_t[9]-1)/_t[5],Qe=(_t[8]-1)/_t[0],$e=(Yt[8]+1)/Yt[0],ft=Fn*Qe,Jt=Fn*$e,Qt=xt/(-Qe+$e),Pn=Qt*-Qe;yt.matrixWorld.decompose(pt.position,pt.quaternion,pt.scale),pt.translateX(Pn),pt.translateZ(Qt),pt.matrixWorld.compose(pt.position,pt.quaternion,pt.scale),pt.matrixWorldInverse.copy(pt.matrixWorld).invert();const kn=Fn+Qt,Qn=Rn+Qt,ke=ft-Pn,ar=Jt+(xt-Pn),Tr=cn*Rn/Qn*kn,rn=qe*Rn/Qn*kn;pt.projectionMatrix.makePerspective(ke,ar,Tr,rn,kn,Qn)}function Mt(pt,yt){yt===null?pt.matrixWorld.copy(pt.matrix):pt.matrixWorld.multiplyMatrices(yt.matrixWorld,pt.matrix),pt.matrixWorldInverse.copy(pt.matrixWorld).invert()}this.updateCamera=function(pt){if(r===null)return;ve.near=be.near=ce.near=pt.near,ve.far=be.far=ce.far=pt.far,(ge!==ve.near||Ge!==ve.far)&&(r.updateRenderState({depthNear:ve.near,depthFar:ve.far}),ge=ve.near,Ge=ve.far);const yt=pt.parent,nn=ve.cameras;Mt(ve,yt);for(let _t=0;_t<nn.length;_t++)Mt(nn[_t],yt);ve.matrixWorld.decompose(ve.position,ve.quaternion,ve.scale),pt.matrix.copy(ve.matrix),pt.matrix.decompose(pt.position,pt.quaternion,pt.scale);const xt=pt.children;for(let _t=0,Yt=xt.length;_t<Yt;_t++)xt[_t].updateMatrixWorld(!0);nn.length===2?jt(ve,ce,be):ve.projectionMatrix.copy(ce.projectionMatrix)},this.getCamera=function(){return ve},this.getFoveation=function(){if(N!==null)return N.fixedFoveation;if(L!==null)return L.fixedFoveation},this.setFoveation=function(pt){N!==null&&(N.fixedFoveation=pt),L!==null&&L.fixedFoveation!==void 0&&(L.fixedFoveation=pt)},this.getPlanes=function(){return G};let ze=null;function Ut(pt,yt){if(U=yt.getViewerPose(O||C),W=yt,U!==null){const nn=U.views;L!==null&&(o.setRenderTargetFramebuffer(I,L.framebuffer),o.setRenderTarget(I));let xt=!1;nn.length!==ve.cameras.length&&(ve.cameras.length=0,xt=!0);for(let _t=0;_t<nn.length;_t++){const Yt=nn[_t];let Fn=null;if(L!==null)Fn=L.getViewport(Yt);else{const cn=j.getViewSubImage(N,Yt);Fn=cn.viewport,_t===0&&(o.setRenderTargetTextures(I,cn.colorTexture,N.ignoreDepthValues?void 0:cn.depthStencilTexture),o.setRenderTarget(I))}let Rn=Ee[_t];Rn===void 0&&(Rn=new jg,Rn.layers.enable(_t),Rn.viewport=new yu,Ee[_t]=Rn),Rn.matrix.fromArray(Yt.transform.matrix),Rn.projectionMatrix.fromArray(Yt.projectionMatrix),Rn.viewport.set(Fn.x,Fn.y,Fn.width,Fn.height),_t===0&&ve.matrix.copy(Rn.matrix),xt===!0&&ve.cameras.push(Rn)}}for(let nn=0;nn<Z.length;nn++){const xt=Y[nn],_t=Z[nn];xt!==null&&_t!==void 0&&_t.update(xt,yt,O||C)}if(ze&&ze(pt,yt),yt.detectedPlanes){s.dispatchEvent({type:"planesdetected",data:yt.detectedPlanes});let nn=null;for(const xt of G)yt.detectedPlanes.has(xt)||(nn===null&&(nn=[]),nn.push(xt));if(nn!==null)for(const xt of nn)G.delete(xt),oe.delete(xt),s.dispatchEvent({type:"planeremoved",data:xt});for(const xt of yt.detectedPlanes)if(!G.has(xt))G.add(xt),oe.set(xt,yt.lastChangedTime),s.dispatchEvent({type:"planeadded",data:xt});else{const _t=oe.get(xt);xt.lastChangedTime>_t&&(oe.set(xt,xt.lastChangedTime),s.dispatchEvent({type:"planechanged",data:xt}))}}W=null}const Ft=new DG;Ft.setAnimationLoop(Ut),this.setAnimationLoop=function(pt){ze=pt},this.dispose=function(){}}}function she(p,o){function u(q,I){I.color.getRGB(q.fogColor.value,OG(p)),I.isFog?(q.fogNear.value=I.near,q.fogFar.value=I.far):I.isFogExp2&&(q.fogDensity.value=I.density)}function s(q,I,Z,Y,G){I.isMeshBasicMaterial||I.isMeshLambertMaterial?r(q,I):I.isMeshToonMaterial?(r(q,I),j(q,I)):I.isMeshPhongMaterial?(r(q,I),U(q,I)):I.isMeshStandardMaterial?(r(q,I),N(q,I),I.isMeshPhysicalMaterial&&L(q,I,G)):I.isMeshMatcapMaterial?(r(q,I),W(q,I)):I.isMeshDepthMaterial?r(q,I):I.isMeshDistanceMaterial?(r(q,I),z(q,I)):I.isMeshNormalMaterial?r(q,I):I.isLineBasicMaterial?(l(q,I),I.isLineDashedMaterial&&C(q,I)):I.isPointsMaterial?S(q,I,Z,Y):I.isSpriteMaterial?O(q,I):I.isShadowMaterial?(q.color.value.copy(I.color),q.opacity.value=I.opacity):I.isShaderMaterial&&(I.uniformsNeedUpdate=!1)}function r(q,I){q.opacity.value=I.opacity,I.color&&q.diffuse.value.copy(I.color),I.emissive&&q.emissive.value.copy(I.emissive).multiplyScalar(I.emissiveIntensity),I.map&&(q.map.value=I.map),I.alphaMap&&(q.alphaMap.value=I.alphaMap),I.bumpMap&&(q.bumpMap.value=I.bumpMap,q.bumpScale.value=I.bumpScale,I.side===Wg&&(q.bumpScale.value*=-1)),I.displacementMap&&(q.displacementMap.value=I.displacementMap,q.displacementScale.value=I.displacementScale,q.displacementBias.value=I.displacementBias),I.emissiveMap&&(q.emissiveMap.value=I.emissiveMap),I.normalMap&&(q.normalMap.value=I.normalMap,q.normalScale.value.copy(I.normalScale),I.side===Wg&&q.normalScale.value.negate()),I.specularMap&&(q.specularMap.value=I.specularMap),I.alphaTest>0&&(q.alphaTest.value=I.alphaTest);const Z=o.get(I).envMap;if(Z&&(q.envMap.value=Z,q.flipEnvMap.value=Z.isCubeTexture&&Z.isRenderTargetTexture===!1?-1:1,q.reflectivity.value=I.reflectivity,q.ior.value=I.ior,q.refractionRatio.value=I.refractionRatio),I.lightMap){q.lightMap.value=I.lightMap;const oe=p.physicallyCorrectLights!==!0?Math.PI:1;q.lightMapIntensity.value=I.lightMapIntensity*oe}I.aoMap&&(q.aoMap.value=I.aoMap,q.aoMapIntensity.value=I.aoMapIntensity);let Y;I.map?Y=I.map:I.specularMap?Y=I.specularMap:I.displacementMap?Y=I.displacementMap:I.normalMap?Y=I.normalMap:I.bumpMap?Y=I.bumpMap:I.roughnessMap?Y=I.roughnessMap:I.metalnessMap?Y=I.metalnessMap:I.alphaMap?Y=I.alphaMap:I.emissiveMap?Y=I.emissiveMap:I.clearcoatMap?Y=I.clearcoatMap:I.clearcoatNormalMap?Y=I.clearcoatNormalMap:I.clearcoatRoughnessMap?Y=I.clearcoatRoughnessMap:I.iridescenceMap?Y=I.iridescenceMap:I.iridescenceThicknessMap?Y=I.iridescenceThicknessMap:I.specularIntensityMap?Y=I.specularIntensityMap:I.specularColorMap?Y=I.specularColorMap:I.transmissionMap?Y=I.transmissionMap:I.thicknessMap?Y=I.thicknessMap:I.sheenColorMap?Y=I.sheenColorMap:I.sheenRoughnessMap&&(Y=I.sheenRoughnessMap),Y!==void 0&&(Y.isWebGLRenderTarget&&(Y=Y.texture),Y.matrixAutoUpdate===!0&&Y.updateMatrix(),q.uvTransform.value.copy(Y.matrix));let G;I.aoMap?G=I.aoMap:I.lightMap&&(G=I.lightMap),G!==void 0&&(G.isWebGLRenderTarget&&(G=G.texture),G.matrixAutoUpdate===!0&&G.updateMatrix(),q.uv2Transform.value.copy(G.matrix))}function l(q,I){q.diffuse.value.copy(I.color),q.opacity.value=I.opacity}function C(q,I){q.dashSize.value=I.dashSize,q.totalSize.value=I.dashSize+I.gapSize,q.scale.value=I.scale}function S(q,I,Z,Y){q.diffuse.value.copy(I.color),q.opacity.value=I.opacity,q.size.value=I.size*Z,q.scale.value=Y*.5,I.map&&(q.map.value=I.map),I.alphaMap&&(q.alphaMap.value=I.alphaMap),I.alphaTest>0&&(q.alphaTest.value=I.alphaTest);let G;I.map?G=I.map:I.alphaMap&&(G=I.alphaMap),G!==void 0&&(G.matrixAutoUpdate===!0&&G.updateMatrix(),q.uvTransform.value.copy(G.matrix))}function O(q,I){q.diffuse.value.copy(I.color),q.opacity.value=I.opacity,q.rotation.value=I.rotation,I.map&&(q.map.value=I.map),I.alphaMap&&(q.alphaMap.value=I.alphaMap),I.alphaTest>0&&(q.alphaTest.value=I.alphaTest);let Z;I.map?Z=I.map:I.alphaMap&&(Z=I.alphaMap),Z!==void 0&&(Z.matrixAutoUpdate===!0&&Z.updateMatrix(),q.uvTransform.value.copy(Z.matrix))}function U(q,I){q.specular.value.copy(I.specular),q.shininess.value=Math.max(I.shininess,1e-4)}function j(q,I){I.gradientMap&&(q.gradientMap.value=I.gradientMap)}function N(q,I){q.roughness.value=I.roughness,q.metalness.value=I.metalness,I.roughnessMap&&(q.roughnessMap.value=I.roughnessMap),I.metalnessMap&&(q.metalnessMap.value=I.metalnessMap),o.get(I).envMap&&(q.envMapIntensity.value=I.envMapIntensity)}function L(q,I,Z){q.ior.value=I.ior,I.sheen>0&&(q.sheenColor.value.copy(I.sheenColor).multiplyScalar(I.sheen),q.sheenRoughness.value=I.sheenRoughness,I.sheenColorMap&&(q.sheenColorMap.value=I.sheenColorMap),I.sheenRoughnessMap&&(q.sheenRoughnessMap.value=I.sheenRoughnessMap)),I.clearcoat>0&&(q.clearcoat.value=I.clearcoat,q.clearcoatRoughness.value=I.clearcoatRoughness,I.clearcoatMap&&(q.clearcoatMap.value=I.clearcoatMap),I.clearcoatRoughnessMap&&(q.clearcoatRoughnessMap.value=I.clearcoatRoughnessMap),I.clearcoatNormalMap&&(q.clearcoatNormalScale.value.copy(I.clearcoatNormalScale),q.clearcoatNormalMap.value=I.clearcoatNormalMap,I.side===Wg&&q.clearcoatNormalScale.value.negate())),I.iridescence>0&&(q.iridescence.value=I.iridescence,q.iridescenceIOR.value=I.iridescenceIOR,q.iridescenceThicknessMinimum.value=I.iridescenceThicknessRange[0],q.iridescenceThicknessMaximum.value=I.iridescenceThicknessRange[1],I.iridescenceMap&&(q.iridescenceMap.value=I.iridescenceMap),I.iridescenceThicknessMap&&(q.iridescenceThicknessMap.value=I.iridescenceThicknessMap)),I.transmission>0&&(q.transmission.value=I.transmission,q.transmissionSamplerMap.value=Z.texture,q.transmissionSamplerSize.value.set(Z.width,Z.height),I.transmissionMap&&(q.transmissionMap.value=I.transmissionMap),q.thickness.value=I.thickness,I.thicknessMap&&(q.thicknessMap.value=I.thicknessMap),q.attenuationDistance.value=I.attenuationDistance,q.attenuationColor.value.copy(I.attenuationColor)),q.specularIntensity.value=I.specularIntensity,q.specularColor.value.copy(I.specularColor),I.specularIntensityMap&&(q.specularIntensityMap.value=I.specularIntensityMap),I.specularColorMap&&(q.specularColorMap.value=I.specularColorMap)}function W(q,I){I.matcap&&(q.matcap.value=I.matcap)}function z(q,I){q.referencePosition.value.copy(I.referencePosition),q.nearDistance.value=I.nearDistance,q.farDistance.value=I.farDistance}return{refreshFogUniforms:u,refreshMaterialUniforms:s}}function uhe(p,o,u,s){let r={},l={},C=[];const S=u.isWebGL2?p.getParameter(35375):0;function O(Y,G){const oe=G.program;s.uniformBlockBinding(Y,oe)}function U(Y,G){let oe=r[Y.id];oe===void 0&&(z(Y),oe=j(Y),r[Y.id]=oe,Y.addEventListener("dispose",I));const ce=G.program;s.updateUBOMapping(Y,ce);const be=o.render.frame;l[Y.id]!==be&&(L(Y),l[Y.id]=be)}function j(Y){const G=N();Y.__bindingPointIndex=G;const oe=p.createBuffer(),ce=Y.__size,be=Y.usage;return p.bindBuffer(35345,oe),p.bufferData(35345,ce,be),p.bindBuffer(35345,null),p.bindBufferBase(35345,G,oe),oe}function N(){for(let Y=0;Y<S;Y++)if(C.indexOf(Y)===-1)return C.push(Y),Y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function L(Y){const G=r[Y.id],oe=Y.uniforms,ce=Y.__cache;p.bindBuffer(35345,G);for(let be=0,Ee=oe.length;be<Ee;be++){const ve=oe[be];if(W(ve,be,ce)===!0){const ge=ve.__offset,Ge=Array.isArray(ve.value)?ve.value:[ve.value];let ht=0;for(let It=0;It<Ge.length;It++){const St=Ge[It],we=q(St);typeof St=="number"?(ve.__data[0]=St,p.bufferSubData(35345,ge+ht,ve.__data)):St.isMatrix3?(ve.__data[0]=St.elements[0],ve.__data[1]=St.elements[1],ve.__data[2]=St.elements[2],ve.__data[3]=St.elements[0],ve.__data[4]=St.elements[3],ve.__data[5]=St.elements[4],ve.__data[6]=St.elements[5],ve.__data[7]=St.elements[0],ve.__data[8]=St.elements[6],ve.__data[9]=St.elements[7],ve.__data[10]=St.elements[8],ve.__data[11]=St.elements[0]):(St.toArray(ve.__data,ht),ht+=we.storage/Float32Array.BYTES_PER_ELEMENT)}p.bufferSubData(35345,ge,ve.__data)}}p.bindBuffer(35345,null)}function W(Y,G,oe){const ce=Y.value;if(oe[G]===void 0){if(typeof ce=="number")oe[G]=ce;else{const be=Array.isArray(ce)?ce:[ce],Ee=[];for(let ve=0;ve<be.length;ve++)Ee.push(be[ve].clone());oe[G]=Ee}return!0}else if(typeof ce=="number"){if(oe[G]!==ce)return oe[G]=ce,!0}else{const be=Array.isArray(oe[G])?oe[G]:[oe[G]],Ee=Array.isArray(ce)?ce:[ce];for(let ve=0;ve<be.length;ve++){const ge=be[ve];if(ge.equals(Ee[ve])===!1)return ge.copy(Ee[ve]),!0}}return!1}function z(Y){const G=Y.uniforms;let oe=0;const ce=16;let be=0;for(let Ee=0,ve=G.length;Ee<ve;Ee++){const ge=G[Ee],Ge={boundary:0,storage:0},ht=Array.isArray(ge.value)?ge.value:[ge.value];for(let It=0,St=ht.length;It<St;It++){const we=ht[It],bt=q(we);Ge.boundary+=bt.boundary,Ge.storage+=bt.storage}if(ge.__data=new Float32Array(Ge.storage/Float32Array.BYTES_PER_ELEMENT),ge.__offset=oe,Ee>0){be=oe%ce;const It=ce-be;be!==0&&It-Ge.boundary<0&&(oe+=ce-be,ge.__offset=oe)}oe+=Ge.storage}return be=oe%ce,be>0&&(oe+=ce-be),Y.__size=oe,Y.__cache={},this}function q(Y){const G={boundary:0,storage:0};return typeof Y=="number"?(G.boundary=4,G.storage=4):Y.isVector2?(G.boundary=8,G.storage=8):Y.isVector3||Y.isColor?(G.boundary=16,G.storage=12):Y.isVector4?(G.boundary=16,G.storage=16):Y.isMatrix3?(G.boundary=48,G.storage=48):Y.isMatrix4?(G.boundary=64,G.storage=64):Y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",Y),G}function I(Y){const G=Y.target;G.removeEventListener("dispose",I);const oe=C.indexOf(G.__bindingPointIndex);C.splice(oe,1),p.deleteBuffer(r[G.id]),delete r[G.id],delete l[G.id]}function Z(){for(const Y in r)p.deleteBuffer(r[Y]);C=[],r={},l={}}return{bind:O,update:U,dispose:Z}}function che(){const p=RO("canvas");return p.style.display="block",p}function PG(p={}){this.isWebGLRenderer=!0;const o=p.canvas!==void 0?p.canvas:che(),u=p.context!==void 0?p.context:null,s=p.depth!==void 0?p.depth:!0,r=p.stencil!==void 0?p.stencil:!0,l=p.antialias!==void 0?p.antialias:!1,C=p.premultipliedAlpha!==void 0?p.premultipliedAlpha:!0,S=p.preserveDrawingBuffer!==void 0?p.preserveDrawingBuffer:!1,O=p.powerPreference!==void 0?p.powerPreference:"default",U=p.failIfMajorPerformanceCaveat!==void 0?p.failIfMajorPerformanceCaveat:!1;let j;u!==null?j=u.getContextAttributes().alpha:j=p.alpha!==void 0?p.alpha:!1;let N=null,L=null;const W=[],z=[];this.domElement=o,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=aw,this.physicallyCorrectLights=!1,this.toneMapping=k1,this.toneMappingExposure=1;const q=this;let I=!1,Z=0,Y=0,G=null,oe=-1,ce=null;const be=new yu,Ee=new yu;let ve=null,ge=o.width,Ge=o.height,ht=1,It=null,St=null;const we=new yu(0,0,ge,Ge),bt=new yu(0,0,ge,Ge);let jt=!1;const Mt=new n5;let ze=!1,Ut=!1,Ft=null;const pt=new ac,yt=new cs,nn=new hr,xt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function _t(){return G===null?ht:1}let Yt=u;function Fn(Nt,Kt){for(let hn=0;hn<Nt.length;hn++){const un=Nt[hn],mt=o.getContext(un,Kt);if(mt!==null)return mt}return null}try{const Nt={alpha:!0,depth:s,stencil:r,antialias:l,premultipliedAlpha:C,preserveDrawingBuffer:S,powerPreference:O,failIfMajorPerformanceCaveat:U};if("setAttribute"in o&&o.setAttribute("data-engine",`three.js r${e5}`),o.addEventListener("webglcontextlost",Mr,!1),o.addEventListener("webglcontextrestored",pr,!1),o.addEventListener("webglcontextcreationerror",ri,!1),Yt===null){const Kt=["webgl2","webgl","experimental-webgl"];if(q.isWebGL1Renderer===!0&&Kt.shift(),Yt=Fn(Kt,Nt),Yt===null)throw Fn(Kt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Yt.getShaderPrecisionFormat===void 0&&(Yt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Nt){throw console.error("THREE.WebGLRenderer: "+Nt.message),Nt}let Rn,cn,qe,Qe,$e,ft,Jt,Qt,Pn,kn,Qn,ke,ar,Tr,rn,Ht,Gn,Xt,Wt,Zt,Vn,xn,Un,ur;function sr(){Rn=new xfe(Yt),cn=new pfe(Yt,Rn,p),Rn.init(cn),xn=new nhe(Yt,Rn,cn),qe=new ehe(Yt,Rn,cn),Qe=new Efe,$e=new zde,ft=new the(Yt,Rn,qe,$e,cn,xn,Qe),Jt=new gfe(q),Qt=new bfe(q),Pn=new Nue(Yt,cn),Un=new dfe(Yt,Rn,Pn,cn),kn=new wfe(Yt,Pn,Qe,Un),Qn=new Afe(Yt,kn,Pn,Qe),Wt=new Cfe(Yt,cn,ft),Ht=new mfe($e),ke=new jde(q,Jt,Qt,Rn,cn,Un,Ht),ar=new she(q,$e),Tr=new Wde,rn=new Xde(Rn,cn),Xt=new ffe(q,Jt,Qt,qe,Qn,j,C),Gn=new Zde(q,Qn,cn),ur=new uhe(Yt,Qe,cn,qe),Zt=new hfe(Yt,Rn,Qe,cn),Vn=new _fe(Yt,Rn,Qe,cn),Qe.programs=ke.programs,q.capabilities=cn,q.extensions=Rn,q.properties=$e,q.renderLists=Tr,q.shadowMap=Gn,q.state=qe,q.info=Qe}sr();const Er=new ahe(q,Yt);this.xr=Er,this.getContext=function(){return Yt},this.getContextAttributes=function(){return Yt.getContextAttributes()},this.forceContextLoss=function(){const Nt=Rn.get("WEBGL_lose_context");Nt&&Nt.loseContext()},this.forceContextRestore=function(){const Nt=Rn.get("WEBGL_lose_context");Nt&&Nt.restoreContext()},this.getPixelRatio=function(){return ht},this.setPixelRatio=function(Nt){Nt!==void 0&&(ht=Nt,this.setSize(ge,Ge,!1))},this.getSize=function(Nt){return Nt.set(ge,Ge)},this.setSize=function(Nt,Kt,hn){if(Er.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}ge=Nt,Ge=Kt,o.width=Math.floor(Nt*ht),o.height=Math.floor(Kt*ht),hn!==!1&&(o.style.width=Nt+"px",o.style.height=Kt+"px"),this.setViewport(0,0,Nt,Kt)},this.getDrawingBufferSize=function(Nt){return Nt.set(ge*ht,Ge*ht).floor()},this.setDrawingBufferSize=function(Nt,Kt,hn){ge=Nt,Ge=Kt,ht=hn,o.width=Math.floor(Nt*hn),o.height=Math.floor(Kt*hn),this.setViewport(0,0,Nt,Kt)},this.getCurrentViewport=function(Nt){return Nt.copy(be)},this.getViewport=function(Nt){return Nt.copy(we)},this.setViewport=function(Nt,Kt,hn,un){Nt.isVector4?we.set(Nt.x,Nt.y,Nt.z,Nt.w):we.set(Nt,Kt,hn,un),qe.viewport(be.copy(we).multiplyScalar(ht).floor())},this.getScissor=function(Nt){return Nt.copy(bt)},this.setScissor=function(Nt,Kt,hn,un){Nt.isVector4?bt.set(Nt.x,Nt.y,Nt.z,Nt.w):bt.set(Nt,Kt,hn,un),qe.scissor(Ee.copy(bt).multiplyScalar(ht).floor())},this.getScissorTest=function(){return jt},this.setScissorTest=function(Nt){qe.setScissorTest(jt=Nt)},this.setOpaqueSort=function(Nt){It=Nt},this.setTransparentSort=function(Nt){St=Nt},this.getClearColor=function(Nt){return Nt.copy(Xt.getClearColor())},this.setClearColor=function(){Xt.setClearColor.apply(Xt,arguments)},this.getClearAlpha=function(){return Xt.getClearAlpha()},this.setClearAlpha=function(){Xt.setClearAlpha.apply(Xt,arguments)},this.clear=function(Nt=!0,Kt=!0,hn=!0){let un=0;Nt&&(un|=16384),Kt&&(un|=256),hn&&(un|=1024),Yt.clear(un)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){o.removeEventListener("webglcontextlost",Mr,!1),o.removeEventListener("webglcontextrestored",pr,!1),o.removeEventListener("webglcontextcreationerror",ri,!1),Tr.dispose(),rn.dispose(),$e.dispose(),Jt.dispose(),Qt.dispose(),Qn.dispose(),Un.dispose(),ur.dispose(),ke.dispose(),Er.dispose(),Er.removeEventListener("sessionstart",Hr),Er.removeEventListener("sessionend",qr),Ft&&(Ft.dispose(),Ft=null),Ot.stop()};function Mr(Nt){Nt.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),I=!0}function pr(){console.log("THREE.WebGLRenderer: Context Restored."),I=!1;const Nt=Qe.autoReset,Kt=Gn.enabled,hn=Gn.autoUpdate,un=Gn.needsUpdate,mt=Gn.type;sr(),Qe.autoReset=Nt,Gn.enabled=Kt,Gn.autoUpdate=hn,Gn.needsUpdate=un,Gn.type=mt}function ri(Nt){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Nt.statusMessage)}function Kr(Nt){const Kt=Nt.target;Kt.removeEventListener("dispose",Kr),ti(Kt)}function ti(Nt){jn(Nt),$e.remove(Nt)}function jn(Nt){const Kt=$e.get(Nt).programs;Kt!==void 0&&(Kt.forEach(function(hn){ke.releaseProgram(hn)}),Nt.isShaderMaterial&&ke.releaseShaderCache(Nt))}this.renderBufferDirect=function(Nt,Kt,hn,un,mt,Tt){Kt===null&&(Kt=xt);const fn=mt.isMesh&&mt.matrixWorld.determinant()<0,tn=kt(Nt,Kt,hn,un,mt);qe.setMaterial(un,fn);let Ve=hn.index,Ln=1;un.wireframe===!0&&(Ve=kn.getWireframeAttribute(hn),Ln=2);const Xn=hn.drawRange,Zn=hn.attributes.position;let cr=Xn.start*Ln,Br=(Xn.start+Xn.count)*Ln;Tt!==null&&(cr=Math.max(cr,Tt.start*Ln),Br=Math.min(Br,(Tt.start+Tt.count)*Ln)),Ve!==null?(cr=Math.max(cr,0),Br=Math.min(Br,Ve.count)):Zn!=null&&(cr=Math.max(cr,0),Br=Math.min(Br,Zn.count));const Sr=Br-cr;if(Sr<0||Sr===1/0)return;Un.setup(mt,un,tn,hn,Ve);let yi,ki=Zt;if(Ve!==null&&(yi=Pn.get(Ve),ki=Vn,ki.setIndex(yi)),mt.isMesh)un.wireframe===!0?(qe.setLineWidth(un.wireframeLinewidth*_t()),ki.setMode(1)):ki.setMode(4);else if(mt.isLine){let Zr=un.linewidth;Zr===void 0&&(Zr=1),qe.setLineWidth(Zr*_t()),mt.isLineSegments?ki.setMode(1):mt.isLineLoop?ki.setMode(2):ki.setMode(3)}else mt.isPoints?ki.setMode(0):mt.isSprite&&ki.setMode(4);if(mt.isInstancedMesh)ki.renderInstances(cr,Sr,mt.count);else if(hn.isInstancedBufferGeometry){const Zr=hn._maxInstanceCount!==void 0?hn._maxInstanceCount:1/0,Zi=Math.min(hn.instanceCount,Zr);ki.renderInstances(cr,Sr,Zi)}else ki.render(cr,Sr)},this.compile=function(Nt,Kt){function hn(un,mt,Tt){un.transparent===!0&&un.side===OA?(un.side=Wg,un.needsUpdate=!0,Me(un,mt,Tt),un.side=iw,un.needsUpdate=!0,Me(un,mt,Tt),un.side=OA):Me(un,mt,Tt)}L=rn.get(Nt),L.init(),z.push(L),Nt.traverseVisible(function(un){un.isLight&&un.layers.test(Kt.layers)&&(L.pushLight(un),un.castShadow&&L.pushShadow(un))}),L.setupLights(q.physicallyCorrectLights),Nt.traverse(function(un){const mt=un.material;if(mt)if(Array.isArray(mt))for(let Tt=0;Tt<mt.length;Tt++){const fn=mt[Tt];hn(fn,Nt,un)}else hn(mt,Nt,un)}),z.pop(),L=null};let ir=null;function Cr(Nt){ir&&ir(Nt)}function Hr(){Ot.stop()}function qr(){Ot.start()}const Ot=new DG;Ot.setAnimationLoop(Cr),typeof self<"u"&&Ot.setContext(self),this.setAnimationLoop=function(Nt){ir=Nt,Er.setAnimationLoop(Nt),Nt===null?Ot.stop():Ot.start()},Er.addEventListener("sessionstart",Hr),Er.addEventListener("sessionend",qr),this.render=function(Nt,Kt){if(Kt!==void 0&&Kt.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(I===!0)return;Nt.matrixWorldAutoUpdate===!0&&Nt.updateMatrixWorld(),Kt.parent===null&&Kt.matrixWorldAutoUpdate===!0&&Kt.updateMatrixWorld(),Er.enabled===!0&&Er.isPresenting===!0&&(Er.cameraAutoUpdate===!0&&Er.updateCamera(Kt),Kt=Er.getCamera()),Nt.isScene===!0&&Nt.onBeforeRender(q,Nt,Kt,G),L=rn.get(Nt,z.length),L.init(),z.push(L),pt.multiplyMatrices(Kt.projectionMatrix,Kt.matrixWorldInverse),Mt.setFromProjectionMatrix(pt),Ut=this.localClippingEnabled,ze=Ht.init(this.clippingPlanes,Ut,Kt),N=Tr.get(Nt,W.length),N.init(),W.push(N),Fr(Nt,Kt,0,q.sortObjects),N.finish(),q.sortObjects===!0&&N.sort(It,St),ze===!0&&Ht.beginShadows();const hn=L.state.shadowsArray;if(Gn.render(hn,Nt,Kt),ze===!0&&Ht.endShadows(),this.info.autoReset===!0&&this.info.reset(),Xt.render(N,Nt),L.setupLights(q.physicallyCorrectLights),Kt.isArrayCamera){const un=Kt.cameras;for(let mt=0,Tt=un.length;mt<Tt;mt++){const fn=un[mt];$t(N,Nt,fn,fn.viewport)}}else $t(N,Nt,Kt);G!==null&&(ft.updateMultisampleRenderTarget(G),ft.updateRenderTargetMipmap(G)),Nt.isScene===!0&&Nt.onAfterRender(q,Nt,Kt),Un.resetDefaultState(),oe=-1,ce=null,z.pop(),z.length>0?L=z[z.length-1]:L=null,W.pop(),W.length>0?N=W[W.length-1]:N=null};function Fr(Nt,Kt,hn,un){if(Nt.visible===!1)return;if(Nt.layers.test(Kt.layers)){if(Nt.isGroup)hn=Nt.renderOrder;else if(Nt.isLOD)Nt.autoUpdate===!0&&Nt.update(Kt);else if(Nt.isLight)L.pushLight(Nt),Nt.castShadow&&L.pushShadow(Nt);else if(Nt.isSprite){if(!Nt.frustumCulled||Mt.intersectsSprite(Nt)){un&&nn.setFromMatrixPosition(Nt.matrixWorld).applyMatrix4(pt);const fn=Qn.update(Nt),tn=Nt.material;tn.visible&&N.push(Nt,fn,tn,hn,nn.z,null)}}else if((Nt.isMesh||Nt.isLine||Nt.isPoints)&&(Nt.isSkinnedMesh&&Nt.skeleton.frame!==Qe.render.frame&&(Nt.skeleton.update(),Nt.skeleton.frame=Qe.render.frame),!Nt.frustumCulled||Mt.intersectsObject(Nt))){un&&nn.setFromMatrixPosition(Nt.matrixWorld).applyMatrix4(pt);const fn=Qn.update(Nt),tn=Nt.material;if(Array.isArray(tn)){const Ve=fn.groups;for(let Ln=0,Xn=Ve.length;Ln<Xn;Ln++){const Zn=Ve[Ln],cr=tn[Zn.materialIndex];cr&&cr.visible&&N.push(Nt,fn,cr,hn,nn.z,Zn)}}else tn.visible&&N.push(Nt,fn,tn,hn,nn.z,null)}}const Tt=Nt.children;for(let fn=0,tn=Tt.length;fn<tn;fn++)Fr(Tt[fn],Kt,hn,un)}function $t(Nt,Kt,hn,un){const mt=Nt.opaque,Tt=Nt.transmissive,fn=Nt.transparent;L.setupLightsView(hn),Tt.length>0&&Se(mt,Kt,hn),un&&qe.viewport(be.copy(un)),mt.length>0&&me(mt,Kt,hn),Tt.length>0&&me(Tt,Kt,hn),fn.length>0&&me(fn,Kt,hn),qe.buffers.depth.setTest(!0),qe.buffers.depth.setMask(!0),qe.buffers.color.setMask(!0),qe.setPolygonOffset(!1)}function Se(Nt,Kt,hn){const un=cn.isWebGL2;Ft===null&&(Ft=new sw(1,1,{generateMipmaps:!0,type:Rn.has("EXT_color_buffer_half_float")?US:ow,minFilter:zS,samples:un&&l===!0?4:0})),q.getDrawingBufferSize(yt),un?Ft.setSize(yt.x,yt.y):Ft.setSize(nR(yt.x),nR(yt.y));const mt=q.getRenderTarget();q.setRenderTarget(Ft),q.clear();const Tt=q.toneMapping;q.toneMapping=k1,me(Nt,Kt,hn),q.toneMapping=Tt,ft.updateMultisampleRenderTarget(Ft),ft.updateRenderTargetMipmap(Ft),q.setRenderTarget(mt)}function me(Nt,Kt,hn){const un=Kt.isScene===!0?Kt.overrideMaterial:null;for(let mt=0,Tt=Nt.length;mt<Tt;mt++){const fn=Nt[mt],tn=fn.object,Ve=fn.geometry,Ln=un===null?fn.material:un,Xn=fn.group;tn.layers.test(hn.layers)&&Ce(tn,Kt,hn,Ve,Ln,Xn)}}function Ce(Nt,Kt,hn,un,mt,Tt){Nt.onBeforeRender(q,Kt,hn,un,mt,Tt),Nt.modelViewMatrix.multiplyMatrices(hn.matrixWorldInverse,Nt.matrixWorld),Nt.normalMatrix.getNormalMatrix(Nt.modelViewMatrix),mt.onBeforeRender(q,Kt,hn,un,Nt,Tt),mt.transparent===!0&&mt.side===OA?(mt.side=Wg,mt.needsUpdate=!0,q.renderBufferDirect(hn,Kt,un,mt,Nt,Tt),mt.side=iw,mt.needsUpdate=!0,q.renderBufferDirect(hn,Kt,un,mt,Nt,Tt),mt.side=OA):q.renderBufferDirect(hn,Kt,un,mt,Nt,Tt),Nt.onAfterRender(q,Kt,hn,un,mt,Tt)}function Me(Nt,Kt,hn){Kt.isScene!==!0&&(Kt=xt);const un=$e.get(Nt),mt=L.state.lights,Tt=L.state.shadowsArray,fn=mt.state.version,tn=ke.getParameters(Nt,mt.state,Tt,Kt,hn),Ve=ke.getProgramCacheKey(tn);let Ln=un.programs;un.environment=Nt.isMeshStandardMaterial?Kt.environment:null,un.fog=Kt.fog,un.envMap=(Nt.isMeshStandardMaterial?Qt:Jt).get(Nt.envMap||un.environment),Ln===void 0&&(Nt.addEventListener("dispose",Kr),Ln=new Map,un.programs=Ln);let Xn=Ln.get(Ve);if(Xn!==void 0){if(un.currentProgram===Xn&&un.lightsStateVersion===fn)return rt(Nt,tn),Xn}else tn.uniforms=ke.getUniforms(Nt),Nt.onBuild(hn,tn,q),Nt.onBeforeCompile(tn,q),Xn=ke.acquireProgram(tn,Ve),Ln.set(Ve,Xn),un.uniforms=tn.uniforms;const Zn=un.uniforms;(!Nt.isShaderMaterial&&!Nt.isRawShaderMaterial||Nt.clipping===!0)&&(Zn.clippingPlanes=Ht.uniform),rt(Nt,tn),un.needsLights=En(Nt),un.lightsStateVersion=fn,un.needsLights&&(Zn.ambientLightColor.value=mt.state.ambient,Zn.lightProbe.value=mt.state.probe,Zn.directionalLights.value=mt.state.directional,Zn.directionalLightShadows.value=mt.state.directionalShadow,Zn.spotLights.value=mt.state.spot,Zn.spotLightShadows.value=mt.state.spotShadow,Zn.rectAreaLights.value=mt.state.rectArea,Zn.ltc_1.value=mt.state.rectAreaLTC1,Zn.ltc_2.value=mt.state.rectAreaLTC2,Zn.pointLights.value=mt.state.point,Zn.pointLightShadows.value=mt.state.pointShadow,Zn.hemisphereLights.value=mt.state.hemi,Zn.directionalShadowMap.value=mt.state.directionalShadowMap,Zn.directionalShadowMatrix.value=mt.state.directionalShadowMatrix,Zn.spotShadowMap.value=mt.state.spotShadowMap,Zn.spotLightMatrix.value=mt.state.spotLightMatrix,Zn.spotLightMap.value=mt.state.spotLightMap,Zn.pointShadowMap.value=mt.state.pointShadowMap,Zn.pointShadowMatrix.value=mt.state.pointShadowMatrix);const cr=Xn.getUniforms(),Br=cO.seqWithValue(cr.seq,Zn);return un.currentProgram=Xn,un.uniformsList=Br,Xn}function rt(Nt,Kt){const hn=$e.get(Nt);hn.outputEncoding=Kt.outputEncoding,hn.instancing=Kt.instancing,hn.skinning=Kt.skinning,hn.morphTargets=Kt.morphTargets,hn.morphNormals=Kt.morphNormals,hn.morphColors=Kt.morphColors,hn.morphTargetsCount=Kt.morphTargetsCount,hn.numClippingPlanes=Kt.numClippingPlanes,hn.numIntersection=Kt.numClipIntersection,hn.vertexAlphas=Kt.vertexAlphas,hn.vertexTangents=Kt.vertexTangents,hn.toneMapping=Kt.toneMapping}function kt(Nt,Kt,hn,un,mt){Kt.isScene!==!0&&(Kt=xt),ft.resetTextureUnits();const Tt=Kt.fog,fn=un.isMeshStandardMaterial?Kt.environment:null,tn=G===null?q.outputEncoding:G.isXRRenderTarget===!0?G.texture.encoding:aw,Ve=(un.isMeshStandardMaterial?Qt:Jt).get(un.envMap||fn),Ln=un.vertexColors===!0&&!!hn.attributes.color&&hn.attributes.color.itemSize===4,Xn=!!un.normalMap&&!!hn.attributes.tangent,Zn=!!hn.morphAttributes.position,cr=!!hn.morphAttributes.normal,Br=!!hn.morphAttributes.color,Sr=un.toneMapped?q.toneMapping:k1,yi=hn.morphAttributes.position||hn.morphAttributes.normal||hn.morphAttributes.color,ki=yi!==void 0?yi.length:0,Zr=$e.get(un),Zi=L.state.lights;if(ze===!0&&(Ut===!0||Nt!==ce)){const zi=Nt===ce&&un.id===oe;Ht.setState(un,Nt,zi)}let gi=!1;un.version===Zr.__version?(Zr.needsLights&&Zr.lightsStateVersion!==Zi.state.version||Zr.outputEncoding!==tn||mt.isInstancedMesh&&Zr.instancing===!1||!mt.isInstancedMesh&&Zr.instancing===!0||mt.isSkinnedMesh&&Zr.skinning===!1||!mt.isSkinnedMesh&&Zr.skinning===!0||Zr.envMap!==Ve||un.fog===!0&&Zr.fog!==Tt||Zr.numClippingPlanes!==void 0&&(Zr.numClippingPlanes!==Ht.numPlanes||Zr.numIntersection!==Ht.numIntersection)||Zr.vertexAlphas!==Ln||Zr.vertexTangents!==Xn||Zr.morphTargets!==Zn||Zr.morphNormals!==cr||Zr.morphColors!==Br||Zr.toneMapping!==Sr||cn.isWebGL2===!0&&Zr.morphTargetsCount!==ki)&&(gi=!0):(gi=!0,Zr.__version=un.version);let ei=Zr.currentProgram;gi===!0&&(ei=Me(un,Kt,mt));let Xr=!1,Kn=!1,di=!1;const Ei=ei.getUniforms(),zr=Zr.uniforms;if(qe.useProgram(ei.program)&&(Xr=!0,Kn=!0,di=!0),un.id!==oe&&(oe=un.id,Kn=!0),Xr||ce!==Nt){if(Ei.setValue(Yt,"projectionMatrix",Nt.projectionMatrix),cn.logarithmicDepthBuffer&&Ei.setValue(Yt,"logDepthBufFC",2/(Math.log(Nt.far+1)/Math.LN2)),ce!==Nt&&(ce=Nt,Kn=!0,di=!0),un.isShaderMaterial||un.isMeshPhongMaterial||un.isMeshToonMaterial||un.isMeshStandardMaterial||un.envMap){const zi=Ei.map.cameraPosition;zi!==void 0&&zi.setValue(Yt,nn.setFromMatrixPosition(Nt.matrixWorld))}(un.isMeshPhongMaterial||un.isMeshToonMaterial||un.isMeshLambertMaterial||un.isMeshBasicMaterial||un.isMeshStandardMaterial||un.isShaderMaterial)&&Ei.setValue(Yt,"isOrthographic",Nt.isOrthographicCamera===!0),(un.isMeshPhongMaterial||un.isMeshToonMaterial||un.isMeshLambertMaterial||un.isMeshBasicMaterial||un.isMeshStandardMaterial||un.isShaderMaterial||un.isShadowMaterial||mt.isSkinnedMesh)&&Ei.setValue(Yt,"viewMatrix",Nt.matrixWorldInverse)}if(mt.isSkinnedMesh){Ei.setOptional(Yt,mt,"bindMatrix"),Ei.setOptional(Yt,mt,"bindMatrixInverse");const zi=mt.skeleton;zi&&(cn.floatVertexTextures?(zi.boneTexture===null&&zi.computeBoneTexture(),Ei.setValue(Yt,"boneTexture",zi.boneTexture,ft),Ei.setValue(Yt,"boneTextureSize",zi.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const oo=hn.morphAttributes;if((oo.position!==void 0||oo.normal!==void 0||oo.color!==void 0&&cn.isWebGL2===!0)&&Wt.update(mt,hn,un,ei),(Kn||Zr.receiveShadow!==mt.receiveShadow)&&(Zr.receiveShadow=mt.receiveShadow,Ei.setValue(Yt,"receiveShadow",mt.receiveShadow)),un.isMeshGouraudMaterial&&un.envMap!==null&&(zr.envMap.value=Ve,zr.flipEnvMap.value=Ve.isCubeTexture&&Ve.isRenderTargetTexture===!1?-1:1),Kn&&(Ei.setValue(Yt,"toneMappingExposure",q.toneMappingExposure),Zr.needsLights&&en(zr,di),Tt&&un.fog===!0&&ar.refreshFogUniforms(zr,Tt),ar.refreshMaterialUniforms(zr,un,ht,Ge,Ft),cO.upload(Yt,Zr.uniformsList,zr,ft)),un.isShaderMaterial&&un.uniformsNeedUpdate===!0&&(cO.upload(Yt,Zr.uniformsList,zr,ft),un.uniformsNeedUpdate=!1),un.isSpriteMaterial&&Ei.setValue(Yt,"center",mt.center),Ei.setValue(Yt,"modelViewMatrix",mt.modelViewMatrix),Ei.setValue(Yt,"normalMatrix",mt.normalMatrix),Ei.setValue(Yt,"modelMatrix",mt.matrixWorld),un.isShaderMaterial||un.isRawShaderMaterial){const zi=un.uniformsGroups;for(let eo=0,wo=zi.length;eo<wo;eo++)if(cn.isWebGL2){const ba=zi[eo];ur.update(ba,ei),ur.bind(ba,ei)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return ei}function en(Nt,Kt){Nt.ambientLightColor.needsUpdate=Kt,Nt.lightProbe.needsUpdate=Kt,Nt.directionalLights.needsUpdate=Kt,Nt.directionalLightShadows.needsUpdate=Kt,Nt.pointLights.needsUpdate=Kt,Nt.pointLightShadows.needsUpdate=Kt,Nt.spotLights.needsUpdate=Kt,Nt.spotLightShadows.needsUpdate=Kt,Nt.rectAreaLights.needsUpdate=Kt,Nt.hemisphereLights.needsUpdate=Kt}function En(Nt){return Nt.isMeshLambertMaterial||Nt.isMeshToonMaterial||Nt.isMeshPhongMaterial||Nt.isMeshStandardMaterial||Nt.isShadowMaterial||Nt.isShaderMaterial&&Nt.lights===!0}this.getActiveCubeFace=function(){return Z},this.getActiveMipmapLevel=function(){return Y},this.getRenderTarget=function(){return G},this.setRenderTargetTextures=function(Nt,Kt,hn){$e.get(Nt.texture).__webglTexture=Kt,$e.get(Nt.depthTexture).__webglTexture=hn;const un=$e.get(Nt);un.__hasExternalTextures=!0,un.__hasExternalTextures&&(un.__autoAllocateDepthBuffer=hn===void 0,un.__autoAllocateDepthBuffer||Rn.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),un.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Nt,Kt){const hn=$e.get(Nt);hn.__webglFramebuffer=Kt,hn.__useDefaultFramebuffer=Kt===void 0},this.setRenderTarget=function(Nt,Kt=0,hn=0){G=Nt,Z=Kt,Y=hn;let un=!0,mt=null,Tt=!1,fn=!1;if(Nt){const Ve=$e.get(Nt);Ve.__useDefaultFramebuffer!==void 0?(qe.bindFramebuffer(36160,null),un=!1):Ve.__webglFramebuffer===void 0?ft.setupRenderTarget(Nt):Ve.__hasExternalTextures&&ft.rebindTextures(Nt,$e.get(Nt.texture).__webglTexture,$e.get(Nt.depthTexture).__webglTexture);const Ln=Nt.texture;(Ln.isData3DTexture||Ln.isDataArrayTexture||Ln.isCompressedArrayTexture)&&(fn=!0);const Xn=$e.get(Nt).__webglFramebuffer;Nt.isWebGLCubeRenderTarget?(mt=Xn[Kt],Tt=!0):cn.isWebGL2&&Nt.samples>0&&ft.useMultisampledRTT(Nt)===!1?mt=$e.get(Nt).__webglMultisampledFramebuffer:mt=Xn,be.copy(Nt.viewport),Ee.copy(Nt.scissor),ve=Nt.scissorTest}else be.copy(we).multiplyScalar(ht).floor(),Ee.copy(bt).multiplyScalar(ht).floor(),ve=jt;if(qe.bindFramebuffer(36160,mt)&&cn.drawBuffers&&un&&qe.drawBuffers(Nt,mt),qe.viewport(be),qe.scissor(Ee),qe.setScissorTest(ve),Tt){const Ve=$e.get(Nt.texture);Yt.framebufferTexture2D(36160,36064,34069+Kt,Ve.__webglTexture,hn)}else if(fn){const Ve=$e.get(Nt.texture),Ln=Kt||0;Yt.framebufferTextureLayer(36160,36064,Ve.__webglTexture,hn||0,Ln)}oe=-1},this.readRenderTargetPixels=function(Nt,Kt,hn,un,mt,Tt,fn){if(!(Nt&&Nt.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let tn=$e.get(Nt).__webglFramebuffer;if(Nt.isWebGLCubeRenderTarget&&fn!==void 0&&(tn=tn[fn]),tn){qe.bindFramebuffer(36160,tn);try{const Ve=Nt.texture,Ln=Ve.format,Xn=Ve.type;if(Ln!==J0&&xn.convert(Ln)!==Yt.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Zn=Xn===US&&(Rn.has("EXT_color_buffer_half_float")||cn.isWebGL2&&Rn.has("EXT_color_buffer_float"));if(Xn!==ow&&xn.convert(Xn)!==Yt.getParameter(35738)&&!(Xn===Xx&&(cn.isWebGL2||Rn.has("OES_texture_float")||Rn.has("WEBGL_color_buffer_float")))&&!Zn){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Kt>=0&&Kt<=Nt.width-un&&hn>=0&&hn<=Nt.height-mt&&Yt.readPixels(Kt,hn,un,mt,xn.convert(Ln),xn.convert(Xn),Tt)}finally{const Ve=G!==null?$e.get(G).__webglFramebuffer:null;qe.bindFramebuffer(36160,Ve)}}},this.copyFramebufferToTexture=function(Nt,Kt,hn=0){const un=Math.pow(2,-hn),mt=Math.floor(Kt.image.width*un),Tt=Math.floor(Kt.image.height*un);ft.setTexture2D(Kt,0),Yt.copyTexSubImage2D(3553,hn,0,0,Nt.x,Nt.y,mt,Tt),qe.unbindTexture()},this.copyTextureToTexture=function(Nt,Kt,hn,un=0){const mt=Kt.image.width,Tt=Kt.image.height,fn=xn.convert(hn.format),tn=xn.convert(hn.type);ft.setTexture2D(hn,0),Yt.pixelStorei(37440,hn.flipY),Yt.pixelStorei(37441,hn.premultiplyAlpha),Yt.pixelStorei(3317,hn.unpackAlignment),Kt.isDataTexture?Yt.texSubImage2D(3553,un,Nt.x,Nt.y,mt,Tt,fn,tn,Kt.image.data):Kt.isCompressedTexture?Yt.compressedTexSubImage2D(3553,un,Nt.x,Nt.y,Kt.mipmaps[0].width,Kt.mipmaps[0].height,fn,Kt.mipmaps[0].data):Yt.texSubImage2D(3553,un,Nt.x,Nt.y,fn,tn,Kt.image),un===0&&hn.generateMipmaps&&Yt.generateMipmap(3553),qe.unbindTexture()},this.copyTextureToTexture3D=function(Nt,Kt,hn,un,mt=0){if(q.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Tt=Nt.max.x-Nt.min.x+1,fn=Nt.max.y-Nt.min.y+1,tn=Nt.max.z-Nt.min.z+1,Ve=xn.convert(un.format),Ln=xn.convert(un.type);let Xn;if(un.isData3DTexture)ft.setTexture3D(un,0),Xn=32879;else if(un.isDataArrayTexture)ft.setTexture2DArray(un,0),Xn=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Yt.pixelStorei(37440,un.flipY),Yt.pixelStorei(37441,un.premultiplyAlpha),Yt.pixelStorei(3317,un.unpackAlignment);const Zn=Yt.getParameter(3314),cr=Yt.getParameter(32878),Br=Yt.getParameter(3316),Sr=Yt.getParameter(3315),yi=Yt.getParameter(32877),ki=hn.isCompressedTexture?hn.mipmaps[0]:hn.image;Yt.pixelStorei(3314,ki.width),Yt.pixelStorei(32878,ki.height),Yt.pixelStorei(3316,Nt.min.x),Yt.pixelStorei(3315,Nt.min.y),Yt.pixelStorei(32877,Nt.min.z),hn.isDataTexture||hn.isData3DTexture?Yt.texSubImage3D(Xn,mt,Kt.x,Kt.y,Kt.z,Tt,fn,tn,Ve,Ln,ki.data):hn.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Yt.compressedTexSubImage3D(Xn,mt,Kt.x,Kt.y,Kt.z,Tt,fn,tn,Ve,ki.data)):Yt.texSubImage3D(Xn,mt,Kt.x,Kt.y,Kt.z,Tt,fn,tn,Ve,Ln,ki),Yt.pixelStorei(3314,Zn),Yt.pixelStorei(32878,cr),Yt.pixelStorei(3316,Br),Yt.pixelStorei(3315,Sr),Yt.pixelStorei(32877,yi),mt===0&&un.generateMipmaps&&Yt.generateMipmap(Xn),qe.unbindTexture()},this.initTexture=function(Nt){Nt.isCubeTexture?ft.setTextureCube(Nt,0):Nt.isData3DTexture?ft.setTexture3D(Nt,0):Nt.isDataArrayTexture||Nt.isCompressedArrayTexture?ft.setTexture2DArray(Nt,0):ft.setTexture2D(Nt,0),qe.unbindTexture()},this.resetState=function(){Z=0,Y=0,G=null,qe.reset(),Un.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class lhe extends PG{}lhe.prototype.isWebGL1Renderer=!0;class fhe extends od{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(o,u){return super.copy(o,u),o.background!==null&&(this.background=o.background.clone()),o.environment!==null&&(this.environment=o.environment.clone()),o.fog!==null&&(this.fog=o.fog.clone()),this.backgroundBlurriness=o.backgroundBlurriness,this.backgroundIntensity=o.backgroundIntensity,o.overrideMaterial!==null&&(this.overrideMaterial=o.overrideMaterial.clone()),this.matrixAutoUpdate=o.matrixAutoUpdate,this}toJSON(o){const u=super.toJSON(o);return this.fog!==null&&(u.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(u.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(u.backgroundIntensity=this.backgroundIntensity),u}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(o){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=o}}class i5 extends QS{constructor(o){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new vs(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.linewidth=o.linewidth,this.linecap=o.linecap,this.linejoin=o.linejoin,this.fog=o.fog,this}}const GW=new hr,qW=new hr,$W=new ac,tF=new SG,KA=new nT;class LG extends od{constructor(o=new nv,u=new i5){super(),this.isLine=!0,this.type="Line",this.geometry=o,this.material=u,this.updateMorphTargets()}copy(o,u){return super.copy(o,u),this.material=o.material,this.geometry=o.geometry,this}computeLineDistances(){const o=this.geometry;if(o.index===null){const u=o.attributes.position,s=[0];for(let r=1,l=u.count;r<l;r++)GW.fromBufferAttribute(u,r-1),qW.fromBufferAttribute(u,r),s[r]=s[r-1],s[r]+=GW.distanceTo(qW);o.setAttribute("lineDistance",new Fp(s,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(o,u){const s=this.geometry,r=this.matrixWorld,l=o.params.Line.threshold,C=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),KA.copy(s.boundingSphere),KA.applyMatrix4(r),KA.radius+=l,o.ray.intersectsSphere(KA)===!1)return;$W.copy(r).invert(),tF.copy(o.ray).applyMatrix4($W);const S=l/((this.scale.x+this.scale.y+this.scale.z)/3),O=S*S,U=new hr,j=new hr,N=new hr,L=new hr,W=this.isLineSegments?2:1,z=s.index,I=s.attributes.position;if(z!==null){const Z=Math.max(0,C.start),Y=Math.min(z.count,C.start+C.count);for(let G=Z,oe=Y-1;G<oe;G+=W){const ce=z.getX(G),be=z.getX(G+1);if(U.fromBufferAttribute(I,ce),j.fromBufferAttribute(I,be),tF.distanceSqToSegment(U,j,L,N)>O)continue;L.applyMatrix4(this.matrixWorld);const ve=o.ray.origin.distanceTo(L);ve<o.near||ve>o.far||u.push({distance:ve,point:N.clone().applyMatrix4(this.matrixWorld),index:G,face:null,faceIndex:null,object:this})}}else{const Z=Math.max(0,C.start),Y=Math.min(I.count,C.start+C.count);for(let G=Z,oe=Y-1;G<oe;G+=W){if(U.fromBufferAttribute(I,G),j.fromBufferAttribute(I,G+1),tF.distanceSqToSegment(U,j,L,N)>O)continue;L.applyMatrix4(this.matrixWorld);const be=o.ray.origin.distanceTo(L);be<o.near||be>o.far||u.push({distance:be,point:N.clone().applyMatrix4(this.matrixWorld),index:G,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const u=this.geometry.morphAttributes,s=Object.keys(u);if(s.length>0){const r=u[s[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,C=r.length;l<C;l++){const S=r[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[S]=l}}}}}const XW=new hr,KW=new hr;class dhe extends LG{constructor(o,u){super(o,u),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const o=this.geometry;if(o.index===null){const u=o.attributes.position,s=[];for(let r=0,l=u.count;r<l;r+=2)XW.fromBufferAttribute(u,r),KW.fromBufferAttribute(u,r+1),s[r]=r===0?0:s[r-1],s[r+1]=s[r]+XW.distanceTo(KW);o.setAttribute("lineDistance",new Fp(s,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class hhe extends LG{constructor(o,u){super(o,u),this.isLineLoop=!0,this.type="LineLoop"}}class phe extends Ip{constructor(o,u,s,r,l,C,S,O,U){super(o,u,s,r,l,C,S,O,U),this.isVideoTexture=!0,this.minFilter=C!==void 0?C:Ap,this.magFilter=l!==void 0?l:Ap,this.generateMipmaps=!1;const j=this;function N(){j.needsUpdate=!0,o.requestVideoFrameCallback(N)}"requestVideoFrameCallback"in o&&o.requestVideoFrameCallback(N)}clone(){return new this.constructor(this.image).copy(this)}update(){const o=this.image;"requestVideoFrameCallback"in o===!1&&o.readyState>=o.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class PO extends nv{constructor(o=1,u=32,s=16,r=0,l=Math.PI*2,C=0,S=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:o,widthSegments:u,heightSegments:s,phiStart:r,phiLength:l,thetaStart:C,thetaLength:S},u=Math.max(3,Math.floor(u)),s=Math.max(2,Math.floor(s));const O=Math.min(C+S,Math.PI);let U=0;const j=[],N=new hr,L=new hr,W=[],z=[],q=[],I=[];for(let Z=0;Z<=s;Z++){const Y=[],G=Z/s;let oe=0;Z==0&&C==0?oe=.5/u:Z==s&&O==Math.PI&&(oe=-.5/u);for(let ce=0;ce<=u;ce++){const be=ce/u;N.x=-o*Math.cos(r+be*l)*Math.sin(C+G*S),N.y=o*Math.cos(C+G*S),N.z=o*Math.sin(r+be*l)*Math.sin(C+G*S),z.push(N.x,N.y,N.z),L.copy(N).normalize(),q.push(L.x,L.y,L.z),I.push(be+oe,1-G),Y.push(U++)}j.push(Y)}for(let Z=0;Z<s;Z++)for(let Y=0;Y<u;Y++){const G=j[Z][Y+1],oe=j[Z][Y],ce=j[Z+1][Y],be=j[Z+1][Y+1];(Z!==0||C>0)&&W.push(G,oe,be),(Z!==s-1||O<Math.PI)&&W.push(oe,ce,be)}this.setIndex(W),this.setAttribute("position",new Fp(z,3)),this.setAttribute("normal",new Fp(q,3)),this.setAttribute("uv",new Fp(I,2))}static fromJSON(o){return new PO(o.radius,o.widthSegments,o.heightSegments,o.phiStart,o.phiLength,o.thetaStart,o.thetaLength)}}class o5 extends od{constructor(o,u=1){super(),this.isLight=!0,this.type="Light",this.color=new vs(o),this.intensity=u}dispose(){}copy(o,u){return super.copy(o,u),this.color.copy(o.color),this.intensity=o.intensity,this}toJSON(o){const u=super.toJSON(o);return u.object.color=this.color.getHex(),u.object.intensity=this.intensity,this.groundColor!==void 0&&(u.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(u.object.distance=this.distance),this.angle!==void 0&&(u.object.angle=this.angle),this.decay!==void 0&&(u.object.decay=this.decay),this.penumbra!==void 0&&(u.object.penumbra=this.penumbra),this.shadow!==void 0&&(u.object.shadow=this.shadow.toJSON()),u}}class mhe extends o5{constructor(o,u,s){super(o,s),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(od.DefaultUp),this.updateMatrix(),this.groundColor=new vs(u)}copy(o,u){return super.copy(o,u),this.groundColor.copy(o.groundColor),this}}const nF=new ac,YW=new hr,JW=new hr;class ghe{constructor(o){this.camera=o,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new cs(512,512),this.map=null,this.mapPass=null,this.matrix=new ac,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new n5,this._frameExtents=new cs(1,1),this._viewportCount=1,this._viewports=[new yu(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(o){const u=this.camera,s=this.matrix;YW.setFromMatrixPosition(o.matrixWorld),u.position.copy(YW),JW.setFromMatrixPosition(o.target.matrixWorld),u.lookAt(JW),u.updateMatrixWorld(),nF.multiplyMatrices(u.projectionMatrix,u.matrixWorldInverse),this._frustum.setFromProjectionMatrix(nF),s.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),s.multiply(nF)}getViewport(o){return this._viewports[o]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(o){return this.camera=o.camera.clone(),this.bias=o.bias,this.radius=o.radius,this.mapSize.copy(o.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const o={};return this.bias!==0&&(o.bias=this.bias),this.normalBias!==0&&(o.normalBias=this.normalBias),this.radius!==1&&(o.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(o.mapSize=this.mapSize.toArray()),o.camera=this.camera.toJSON(!1).object,delete o.camera.matrix,o}}const QW=new ac,oS=new hr,rF=new hr;class vhe extends ghe{constructor(){super(new jg(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new cs(4,2),this._viewportCount=6,this._viewports=[new yu(2,1,1,1),new yu(0,1,1,1),new yu(3,1,1,1),new yu(1,1,1,1),new yu(3,0,1,1),new yu(1,0,1,1)],this._cubeDirections=[new hr(1,0,0),new hr(-1,0,0),new hr(0,0,1),new hr(0,0,-1),new hr(0,1,0),new hr(0,-1,0)],this._cubeUps=[new hr(0,1,0),new hr(0,1,0),new hr(0,1,0),new hr(0,1,0),new hr(0,0,1),new hr(0,0,-1)]}updateMatrices(o,u=0){const s=this.camera,r=this.matrix,l=o.distance||s.far;l!==s.far&&(s.far=l,s.updateProjectionMatrix()),oS.setFromMatrixPosition(o.matrixWorld),s.position.copy(oS),rF.copy(s.position),rF.add(this._cubeDirections[u]),s.up.copy(this._cubeUps[u]),s.lookAt(rF),s.updateMatrixWorld(),r.makeTranslation(-oS.x,-oS.y,-oS.z),QW.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),this._frustum.setFromProjectionMatrix(QW)}}class aS extends o5{constructor(o,u,s=0,r=2){super(o,u),this.isPointLight=!0,this.type="PointLight",this.distance=s,this.decay=r,this.shadow=new vhe}get power(){return this.intensity*4*Math.PI}set power(o){this.intensity=o/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(o,u){return super.copy(o,u),this.distance=o.distance,this.decay=o.decay,this.shadow=o.shadow.clone(),this}}class yhe extends o5{constructor(o,u){super(o,u),this.isAmbientLight=!0,this.type="AmbientLight"}}class bhe extends dhe{constructor(o=1){const u=[0,0,0,o,0,0,0,0,0,0,o,0,0,0,0,0,0,o],s=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new nv;r.setAttribute("position",new Fp(u,3)),r.setAttribute("color",new Fp(s,3));const l=new i5({vertexColors:!0,toneMapped:!1});super(r,l),this.type="AxesHelper"}setColors(o,u,s){const r=new vs,l=this.geometry.attributes.color.array;return r.set(o),r.toArray(l,0),r.toArray(l,3),r.set(u),r.toArray(l,6),r.toArray(l,9),r.set(s),r.toArray(l,12),r.toArray(l,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:e5}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=e5);class xhe{constructor(){this.DEFAULT_CAMERA=new rR(-50,50,50,-50,-1500,1500),this.DEFAULT_CAMERA.name="CameraBoxy",this.DEFAULT_CAMERA.position.set(0,0,1e3),this.container=null,this.width=100,this.height=100,this.scene=null,this.camera=this.DEFAULT_CAMERA.clone(),this.renderer=null,this.light=null,this.orbitControl=null,this.trackballControl=null,this.objects=[],this.timer=null,this.video=null,this.videoScale=null,this.scale=1,this.predictions=[]}init(o){const u=this;this.container=o,this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.scene=new fhe,this.scene.background=new vs("#ffffff"),this.renderer=new PG({}),this.renderer.setClearColor(0,0),this.renderer.setSize(this.width,this.height),this.container.appendChild(this.renderer.domElement),this.renderer.domElement.style.position="absolute",this.setCamera(),window.addEventListener("resize",function(){clearTimeout(u.timer),u.timer=setTimeout(function(){u.width=u.container.offsetWidth,u.height=u.container.offsetHeight,u.camera.left=-u.width*.5,u.camera.right=u.width*.5,u.camera.top=u.height*.5,u.camera.bottom=-u.height*.5,u.camera.updateProjectionMatrix(),u.renderer.setSize(u.width,u.height),u.videoScale={width:u.width/u.video.videoWidth,height:u.height/u.video.videoHeight}},500)})}setCamera(){const{width:o,height:u}=this;this.camera=new rR(-o*.5,o*.5,u*.5,-u*.5,-1500,1500),this.camera.position.copy(new hr(0,0,1e3)),this.camera.zoom=1,this.camera.updateProjectionMatrix(),this.scene.add(this.camera)}setLight(){const o=new yhe(16777215,.3);this.scene.add(o);const u=new aS(16777215,.1,0),s=new aS(16777215,.1,0),r=new aS(16777215,.1,0),l=new aS(16777215,.1,0),C=new aS(16777215,.3,0);u.position.set(1e3,1e3,1e3),s.position.set(-1e3,1e3,1e3),r.position.set(1e3,-1e3,1e3),l.position.set(-1e3,-1e3,1e3),C.position.set(0,0,1e3),this.camera.add(u),this.camera.add(s),this.camera.add(r),this.camera.add(l),this.camera.add(C);const S=new mhe(7693392,4547202,.1);this.scene.add(S)}animate(){window.requestAnimationFrame(this.animate.bind(this)),this.orbitControl&&this.orbitControl.update(),this.trackballControl&&this.trackballControl.update(),this.render()}render(){this.renderer.render(this.scene,this.camera)}addMesh(o){return this.scene.add(o),o}getMesh(o){const u=this.scene.getObjectByName(o);return u||null}addHelper(){const o=new bhe(100);this.scene.add(o)}addRectangle(o){const u=new i5({color:255}),s=[];s.push(new hr(-10,10,0)),s.push(new hr(10,10,0)),s.push(new hr(10,-10,0)),s.push(new hr(-10,-10,0));const r=new nv().setFromPoints(s),l=new hhe(r,u);return l.name=o,this.scene.add(l),l}addSphere(){const o=new PO(15,32,16),u=new _S({color:16711680}),s=new Q0(o,u);return s.name="sphere",this.scene.add(s),s}addMultiSphere(o,u){for(let s=0;s<u;s++){const r=new PO(2,8,8),l=new _S({color:255}),C=new Q0(r,l);C.name=`${o}_${s}`,this.scene.add(C)}}updateSphere(o){const u=this.scene.getObjectByName(o);if(!u)return null;const{scaledMesh:s}=this.predictions[0],r=[...s[0]];r[0]=this.width*.5-this.videoScale.width*r[0],r[1]=this.height*.5-this.videoScale.height*r[1];let l=new hr(...r);return u.position.copy(l),u}updateMultiSphere(o,u){for(let s=0;s<u;s++){const r=this.predictions[0].scaledMesh[s],l=this.scene.getObjectByName(`${o}_${s}`);l&&this.video&&(l.position.x=this.video.videoWidth*.5-r[0],l.position.y=this.video.videoHeight*.5-r[1])}}addVideo(o,u){if(!u)return;const s=new rT(u.videoWidth,u.videoHeight),r=new phe(u);r.wrapS=FO,r.repeat.x=-1;const l=new _S({map:r}),C=new Q0(s,l);return C.name=o,this.scene.add(C),C}updateVideoSize(o){this.video=o,this.videoScale={width:this.width/o.videoWidth,height:this.height/o.videoHeight}}updatePredictions(o){this.predictions=o}}const y1=new xhe,whe="_container_1uf3d_1",_he={container:whe};function Ehe(){const p=_l.exports.useRef(void 0),{video:o,predictions:u}=_l.exports.useContext(eT);return _l.exports.useEffect(()=>{if(p){if(y1.container)return;y1.init(p.current),y1.addMultiSphere("sphere",468),y1.animate()}},[p]),_l.exports.useEffect(()=>{u&&u.length>0&&(y1.updatePredictions(u),y1.updateMultiSphere("sphere",468))},[u]),_l.exports.useEffect(()=>{if(o){if(y1.video)return;y1.addVideo("video",o),y1.updateVideoSize(o)}},[o]),Tp(cR,{children:Tp("div",{ref:p,id:"container",className:_he.container})})}const She="_loadingMask_1bktm_1",khe="_loader_1bktm_13",Che="_rotate_1bktm_1",Ahe="_prixClipFix_1bktm_1",ZW={loadingMask:She,loader:khe,rotate:Che,prixClipFix:Ahe};function BG(){const{loadingMask:p}=_l.exports.useContext(eT);return Tp(cR,{children:p&&Tp("div",{className:ZW.loadingMask,children:Tp("span",{className:ZW.loader})})})}BG.defaultProps={visible:!1};const jG=({children:p})=>{const[o,u]=_l.exports.useState({flipHorizontal:!1,maxContinuousChecks:5,detectionConfidence:.9,maxFaces:1,scoreThreshold:.75,iouThreshold:.3}),[s,r]=_l.exports.useState(null),[l,C]=_l.exports.useState([]),[S,O]=_l.exports.useState(!1),U={video:s,setVideo:r,facemeshOptions:o,setFacemeshOptions:u,predictions:l,setPredictions:C,loadingMask:S,setLoadingMask:O};return Tp(eT.Provider,{value:U,children:p})};jG.propTypes={children:uV.Node};function Ohe(){return uoe(jG,{children:[Tp(pse,{}),Tp(Ehe,{}),Tp(BG,{})]})}iF.createRoot(document.getElementById("root")).render(Tp(uV.StrictMode,{children:Tp(Ohe,{})}));
